# åœ¨å¤šè¿›ç¨‹åº”ç”¨ä¸­ä½¿ç”¨å·¥ä½œç®¡ç†å™¨

> åŸæ–‡ï¼š<https://medium.com/androiddevelopers/workmanager-2-5-0-stable-released-701b668cd064?source=collection_archive---------3----------------------->

![](img/04f37d6cf32867fc471946c8f217ac5d.png)

**ğŸ“æœ€è¿‘å‘å¸ƒçš„ WorkManager 2.5.0 æ”¯æŒåœ¨å¤šè¿›ç¨‹ç¯å¢ƒä¸­æ›´è½»æ¾åœ°ä½¿ç”¨ï¼Œå¹¶æä¾›äº†å¤šé¡¹ç¨³å®šæ€§æ”¹è¿›ã€‚**

å› æ­¤ï¼Œå¦‚æœä½ æœ‰ä¸€ä¸ªç®¡ç†å¤šä¸ªè¿›ç¨‹çš„åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”ä½ éœ€è¦ä¸€ç§å¥å£®çš„æ–¹å¼æ¥ç®¡ç†åå°å·¥ä½œ(*ä¸å†æœ‰åˆå§‹åŒ–é”™è¯¯* ï¸ï¸âš )ï¼Œé‚£ä¹ˆè¿™å°±æ˜¯ä¸ºä½ å‘å¸ƒçš„ç‰ˆæœ¬ã€‚

æ‚¨éœ€è¦å¯¹ä»£ç è¿›è¡Œä¸€äº›æ›´æ”¹ï¼Œæ‰€ä»¥è¯·ç»§ç»­é˜…è¯»ä»¥äº†è§£æ›´å¤šä¿¡æ¯ã€‚

> åœ¨æœ¬æ–‡çš„æœ€åï¼Œæˆ‘è¿˜å°†åˆ—å‡ºè¿™ä¸ªç‰ˆæœ¬çš„ WorkManager åº“ä¸­çš„ä¸€äº›å…¶ä»–è¡Œä¸ºå˜åŒ–å’Œæœ€æ–°æ·»åŠ çš„å†…å®¹ã€‚

# ç®€ä»‹:å·¥ä½œ-å¤šé‡å¤„ç†

æ–°çš„å¤šè¿›ç¨‹å·¥ä»¶é€šè¿‡å°†ä½œä¸šè°ƒåº¦ç»Ÿä¸€åˆ°å•ä¸ªè¿›ç¨‹ä¸­æ¥æé«˜æ€§èƒ½ã€‚è‹¥è¦å¼€å§‹ï¼Œè¯·å°†å…¶æ·»åŠ åˆ°æ‚¨çš„åº”ç”¨ä¸­ã€‚

```
Implementation "androidx.work:work-multiprocess:2.5.0"
```

ç°åœ¨æ‚¨å¯ä»¥[é€‰æ‹©](https://developer.android.com/topic/libraries/architecture/workmanager/advanced/custom-configuration)å·¥ä½œç®¡ç†å™¨ç”¨æ¥å°†å·¥ä½œè¯·æ±‚æ’é˜Ÿçš„æŒ‡å®šè¿›ç¨‹ï¼Œå¹¶è¿è¡Œå…¶è¿›ç¨‹å†…è°ƒåº¦ç¨‹åºã€‚

ä½¿ç”¨`Configuration.Provider`çš„é…ç½®å¯ä»¥æ˜¯è¿™æ ·çš„ã€‚

```
class MyApplication() : Application(), Configuration.Provider {  override fun getWorkManagerConfiguration() =
    Configuration.Builder()
      .setDefaultProcessName("***com.example:remote***")
      .build()
}
```

> **æ³¨æ„**:`setProcessName`ä¸Šçš„å‚æ•°è¦æ±‚æ‚¨ä¼ é€’å®Œå…¨é™å®šçš„è¿›ç¨‹åï¼ŒåŒ…æ‹¬æ‚¨çš„åº”ç”¨ç¨‹åºçš„åŒ…åï¼Œåè·Ÿä¸€ä¸ªå†’å·ï¼Œç„¶åæ˜¯ä¸»æœºçš„è¿›ç¨‹åï¼Œä¾‹å¦‚`com.example:remote`ã€‚

å½“ä½¿ç”¨å·¥ä½œå¤šè¿›ç¨‹æ—¶ï¼Œä½ ä¹Ÿæƒ³ä½¿ç”¨`RemoteWorkManager`è€Œä¸æ˜¯`WorkManager`æ¥ç®¡ç†ä½ çš„å·¥ä½œè¯·æ±‚ã€‚ [RemoteWorkManager](https://developer.android.com/reference/androidx/work/multiprocess/RemoteWorkManager) å°†æ€»æ˜¯è”ç³»æŒ‡å®šçš„è¿›ç¨‹æ¥ä¸ºæ‚¨æ’é˜Ÿå·¥ä½œã€‚è¿™å¯ä»¥ç¡®ä¿æ‚¨ä¸ä¼šåœ¨è°ƒç”¨è¿‡ç¨‹ä¸­æ„å¤–åˆå§‹åŒ–æ–°çš„å·¥ä½œç®¡ç†å™¨ã€‚è¿›ç¨‹å†…è°ƒåº¦ç¨‹åºä¹Ÿåœ¨åŒä¸€ä¸ªæŒ‡å®šçš„è¿›ç¨‹ä¸­è¿è¡Œã€‚

## **å¥½å¤„**

é€šè¿‡åƒè¿™æ ·é…ç½® WorkManager å¹¶ä½¿ç”¨ RemoteWorkManager æ¥è°ƒåº¦æ‚¨çš„ä½œä¸šï¼Œæ‚¨å¯ä»¥åœ¨æ‚¨çš„å¤šè¿›ç¨‹åº”ç”¨ç¨‹åºä¸­æ›´å¿«ã€æ›´å¯é åœ°ç®¡ç†æ‚¨çš„å·¥ä½œã€‚è¿™æ˜¯å› ä¸º SQLite [äº‰ç”¨](https://en.wikipedia.org/wiki/Resource_contention)å¯ä»¥å¤§å¤§å‡å°‘(å› ä¸ºæˆ‘ä»¬ä¸å†ä¾èµ–åŸºäºæ–‡ä»¶çš„é”),å¹¶ä¸”è·¨è¿›ç¨‹çš„ä½œä¸šåè°ƒä¸å†æ˜¯å¿…è¦çš„ï¼Œå› ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºå°†åªæœ‰ä¸€ä¸ªå·¥ä½œç®¡ç†å™¨å®ä¾‹åœ¨æ‚¨å¯ä»¥æŒ‡å®šçš„è¿›ç¨‹ä¸­è¿è¡Œã€‚

# è¡Œä¸ºæ”¹å˜ğŸ”€

## **å·¥ä½œå¯¹å¸**

ä»¥å‰ï¼Œå½“`ActivityManager`æ— æ³•å®ä¾‹åŒ–`JobService`æ¥å¯åŠ¨ä¸€ä¸ªä½œä¸šæ—¶ï¼Œè¯¥ä½œä¸šä¼šå› ä¸ºå¹³å°ä¸­çš„ä¸€ä¸ªåº•å±‚é”™è¯¯è€Œè¢«æ‚„æ‚„ä¸¢å¼ƒã€‚WorkManager ç°åœ¨å¯ä»¥ç¡®ä¿å½“é€šè¿‡åè°ƒ`WorkRequest`å¯¹è±¡å’Œä½œä¸šæ¥åˆ›å»º`Application`å®ä¾‹æ—¶ï¼Œæ¯ä¸ª`WorkRequest`éƒ½æœ‰ä¸€ä¸ªåå¤‡è°ƒåº¦ç¨‹åºä½œä¸šã€‚

## **é™åˆ¶å†…éƒ¨æ•°æ®åº“å¢é•¿**

æˆ‘ä»¬çœ‹åˆ°åº”ç”¨å´©æºƒçš„åŸå› ä¹‹ä¸€æ˜¯è®¾å¤‡å­˜å‚¨ä¸è¶³ã€‚è¿™ä¸»è¦å‘ç”Ÿåœ¨å­˜å‚¨å®¹é‡ä½çš„è®¾å¤‡ä¸Šã€‚ç„¶è€Œï¼Œå½“åº”ç”¨ç¨‹åºä¸º**å®‰æ’äº†å¤§é‡**å·¥ä½œæ—¶ï¼ŒWorkManager å¯¹è®¾å¤‡çš„ä½å­˜å‚¨è¿è¡Œè´Ÿæœ‰éƒ¨åˆ†è´£ä»»ã€‚

> é»˜è®¤æƒ…å†µä¸‹ï¼Œå·²å®Œæˆçš„ä½œä¸šä¼šåœ¨å†…éƒ¨ WorkManager æ•°æ®åº“ä¸­è®°å½• 7 å¤©ã€‚è¿™ä¸ªæ—¶é—´å·²ç»å‡å°‘åˆ° 1 å¤©ï¼Œè¿™å¤§å¤§å‡å°äº†æ•°æ®åº“çš„å¤§å°ã€‚

è™½ç„¶æˆ‘ä»¬ç¼©çŸ­äº†ç¼“å†²æŒç»­æ—¶é—´ï¼Œä½†æ˜¯æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨`keepResultsForAtLeast()` API æ¥æ§åˆ¶æ‚¨çš„ä½œä¸šåº”è¯¥è¢«è®°ä½å¤šé•¿æ—¶é—´ã€‚

# âœ¨æ–°æµ‹è¯• API

å¦‚æœæ‚¨å°†`ListenableFuture`ä¸ WorkManager ä¸€èµ·ä½¿ç”¨ï¼Œé‚£ä¹ˆæµ‹è¯•ä¼šå˜å¾—æ›´å®¹æ˜“â€”â€”`TestListenableWorkerBuilder`kot Lin æ‰©å±•ç°åœ¨æ¥å—ä»»ä½•æ‰©å±•`ListenableWorker`çš„ç±»ï¼Œåœ¨æµ‹è¯•è¿‡ç¨‹ä¸­ä¸ºæ‚¨æä¾›æ›´å¤šçš„çµæ´»æ€§ã€‚

# é”™è¯¯ä¿®å¤ğŸ›

é™¤äº†æ–°åŠŸèƒ½ä¹‹å¤–ï¼Œæ­¤ç‰ˆæœ¬è¿˜åŒ…å«å‡ ä¸ªé”™è¯¯ä¿®å¤ï¼Œå¯æé«˜ WorkManager çš„ç¨³å®šæ€§ã€å¯é æ€§å’Œæ€§èƒ½ã€‚æ‚¨å¯ä»¥åœ¨[å‘è¡Œè¯´æ˜](https://developer.android.com/jetpack/androidx/releases/work#2.5.0)ä¸­é˜…è¯»æ‰€æœ‰å˜æ›´ä»¥åŠå·²ä¿®å¤çš„é”™è¯¯ã€‚

# æ‚¨å¯ä»¥åšäº›ä»€ä¹ˆæ¥æ”¹è¿›å·¥ä½œç®¡ç†å™¨

## **é€šè¿‡ GitHub è´¡çŒ®ç»™å·¥ä½œç®¡ç†å™¨ğŸ‘©â€ğŸ’»**

WorkManager ä»¥åŠå…¶ä»–å‡ ä¸ª Jetpack åº“å¯ä»¥é€šè¿‡ GitHub æ¥å—æŠ•ç¨¿ã€‚

[Alan Viverette](https://medium.com/u/d42e45d76c8a?source=post_page-----701b668cd064--------------------------------) å†™äº†ä¸€ç¯‡[å…¨é¢çš„åšæ–‡](/androiddevelopers/introducing-jetpack-on-github-c2c9f12e62a9)è®²è¿°äº†æ•´ä¸ªè¿‡ç¨‹ã€‚

## **å‡ºé—®é¢˜æ—¶è¯·å‘Šè¯‰æˆ‘ä»¬ğŸ“**

2.5.0 ç‰ˆæœ¬ä¸­ä¿®å¤çš„å¤§å¤šæ•°é”™è¯¯éƒ½æ˜¯é€šè¿‡[å…¬å…±é—®é¢˜è¿½è¸ªå™¨](https://issuetracker.google.com/issues?q=componentid:409906)è¾“å…¥çš„ã€‚

åˆ›é€ ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥è§£å†³çš„é—®é¢˜çš„æœ€å¥½æ–¹æ³•æ˜¯é€šè¿‡[åˆ›é€ ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥é‡ç°çš„é—®é¢˜](https://issuetracker.google.com/issues/new?component=409906)ã€‚ä¸ºäº†å¸®åŠ©æˆ‘ä»¬é‡ç°é—®é¢˜ï¼Œæˆ‘ä»¬å»ºè®®æ‚¨ä½¿ç”¨[å·¥ä½œç®¡ç†å™¨ç¤ºä¾‹](https://github.com/android/architecture-components-samples/tree/main/WorkManagerSample)æˆ–è€…åœ¨é—®é¢˜æè¿°ä¸­æä¾›æ‚¨è‡ªå·±çš„å¸¦æœ‰è¯´æ˜çš„ç¤ºä¾‹ä»£ç ã€‚

ç°åœ¨æ˜¯å¼€å§‹å·¥ä½œå¹¶ç®¡ç†æ›´æ–°åº”ç”¨ç¨‹åºä¸­çš„åº“ç‰ˆæœ¬çš„æœ€ä½³æ—¶æœºã€‚