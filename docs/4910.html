<html>
<head>
<title>Item: Consider aggregating elements to a map</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">é¡¹ç›®:è€ƒè™‘å°†å…ƒç´ èšåˆåˆ°ä¸€ä¸ªæ˜ å°„ä¸­</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://blog.kotlin-academy.com/item-consider-aggregating-elements-to-map-a5a35a7b6c61?source=collection_archive---------1-----------------------#2020-04-20">https://blog.kotlin-academy.com/item-consider-aggregating-elements-to-map-a5a35a7b6c61?source=collection_archive---------1-----------------------#2020-04-20</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/146ae6999c4b5b579cc3df68e7eb54ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ySvlYWhj8NE334_5.jpg"/></div></div></figure><div class=""/><p id="9154" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">æˆ‘ä»¬éœ€è¦å¤šæ¬¡è®¿é—®å¤§é‡çš„å…ƒç´ ï¼Œè¿™ç§æƒ…å†µå¹¶ä¸å°‘è§ã€‚å¯èƒ½æ˜¯:</p><ul class=""><li id="e732" class="kt ku iy jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">ç¼“å­˜â€”â€”æˆ‘ä»¬ä»ä¸€äº›æœåŠ¡ä¸‹è½½æ•°æ®ï¼Œç„¶åä¿å­˜åœ¨æœ¬åœ°å†…å­˜ä¸­ä»¥ä¾¿æ›´å¿«åœ°è®¿é—®å®ƒä»¬</li><li id="72a5" class="kt ku iy jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">ä»æŸä¸ªæ–‡ä»¶åŠ è½½æ•°æ®çš„å­˜å‚¨åº“</li><li id="400f" class="kt ku iy jx b jy lc kc ld kg le kk lf ko lg ks ky kz la lb bi translated">ç”¨äºä¸åŒç±»å‹æµ‹è¯•çš„å†…å­˜å­˜å‚¨åº“</li></ul><p id="3289" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">è¿™äº›æ•°æ®å¯èƒ½ä»£è¡¨ç”¨æˆ·ã€idã€é…ç½®ç­‰çš„åˆ—è¡¨ã€‚å®ƒä»¬é€šå¸¸ä»¥åˆ—è¡¨çš„å½¢å¼æä¾›ç»™æˆ‘ä»¬ï¼Œåœ¨æˆ‘ä»¬çš„è®°å¿†ä¸­ä»¥åŒæ ·çš„æ–¹å¼å‘ˆç°å®ƒä»¬æ˜¯å¾ˆæœ‰è¯±æƒ‘åŠ›çš„:</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="9d0c" class="lq lr iy lm b gy ls lt l lu lv"><strong class="lm iz">class </strong>NetworkUserRepo(<strong class="lm iz">val userService</strong>: UserService): UserRepo {<br/>    <strong class="lm iz">private var users</strong>: List&lt;User&gt;? = <strong class="lm iz">null</strong></span><span id="f8d8" class="lq lr iy lm b gy lw lt l lu lv"><strong class="lm iz">    override fun </strong>getUser(id: UserId): User? {<br/>        <strong class="lm iz">if</strong>(<strong class="lm iz">users </strong>== <strong class="lm iz">null</strong>) {<br/>            <strong class="lm iz">users </strong>= <strong class="lm iz">userService</strong>.getUsers()<br/>        }<br/>        <strong class="lm iz">return users</strong>?.<em class="lx">firstOrNull </em><strong class="lm iz">{ it</strong>.<strong class="lm iz">id </strong>== id <strong class="lm iz">}<br/>    </strong>}<br/>}<br/><br/><strong class="lm iz">class </strong>ConfigurationsRepository(<br/>    <strong class="lm iz">val configurations</strong>: List&lt;Configuration&gt;<br/>) {<br/>    <strong class="lm iz">fun </strong>getByName(name: String) = <strong class="lm iz">configurations<br/>        </strong>.<em class="lx">firstOrNull </em><strong class="lm iz">{ it</strong>.<strong class="lm iz">name </strong>== name <strong class="lm iz">}<br/></strong>}</span><span id="7e9e" class="lq lr iy lm b gy lw lt l lu lv">class InMemoryUserRepo: UserRepo {<br/>   private val users: MutableList&lt;User&gt; = mutableListOf()</span><span id="b417" class="lq lr iy lm b gy lw lt l lu lv">   override fun getUser(id: UserId): User?<br/>      = users.firstOrNull { it.id == id }<br/>   <br/>   fun addUser(user: User) {<br/>      user.add(user)<br/>   }<br/>}</span></pre><p id="3005" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">è¿™å¾ˆå°‘æ˜¯å­˜å‚¨è¿™äº›å…ƒç´ çš„æœ€ä½³æ–¹å¼ã€‚æ³¨æ„æˆ‘ä»¬åŠ è½½çš„æ•°æ®æ˜¯å¦‚ä½•ä½¿ç”¨çš„ã€‚æˆ‘ä»¬é€šå¸¸é€šè¿‡ä¸€äº›æ ‡è¯†ç¬¦æˆ–åç§°æ¥è®¿é—®ä¸€ä¸ªå…ƒç´ (è¿™ä¸æˆ‘ä»¬å¦‚ä½•åœ¨æ•°æ®åº“ä¸­è®¾è®¡å…·æœ‰å”¯ä¸€é”®çš„æ•°æ®æœ‰å…³)ã€‚åœ¨åˆ—è¡¨ä¸­æŸ¥æ‰¾å…ƒç´ çš„å¤æ‚åº¦ä¸ºO(n)ï¼Œå…¶ä¸­næ˜¯åˆ—è¡¨çš„å¤§å°ã€‚æ›´å…·ä½“åœ°è¯´ï¼Œå¹³å‡éœ€è¦n/2æ¬¡æ¯”è¾ƒæ‰èƒ½æ‰¾åˆ°ä¸€ä¸ªå…ƒç´ ã€‚è¿™å¯¹äºæ›´å¤§çš„åˆ—è¡¨æ¥è¯´å°¤å…¶æˆé—®é¢˜ã€‚è§£å†³è¿™ä¸ªé—®é¢˜çš„å¥½åŠæ³•æ˜¯ç”¨<code class="fe ly lz ma lm b">Map</code>ä»£æ›¿<code class="fe ly lz ma lm b">List</code>ã€‚Kotliné»˜è®¤ä½¿ç”¨å“ˆå¸Œæ˜ å°„(å…·ä½“æ˜¯<code class="fe ly lz ma lm b">LinkedHashMap</code>)ï¼Œæ­£å¦‚æˆ‘ä»¬åœ¨<a class="ae mb" href="https://leanpub.com/effectivekotlin/" rel="noopener ugc nofollow" target="_blank"> Item 41:å°Šé‡hashCode </a>çš„å¥‘çº¦ä¸­æ‰€æè¿°çš„ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨å“ˆå¸Œæ˜ å°„æ—¶ï¼ŒæŸ¥æ‰¾å…ƒç´ çš„æ€§èƒ½è¦å¥½å¾—å¤šã€‚å®é™…ä¸Šï¼Œåœ¨JVMä¸­ï¼Œç”±äºæ‰€ä½¿ç”¨çš„hash mapçš„å¤§å°è¢«è°ƒæ•´ä¸ºmapæœ¬èº«çš„å¤§å°ï¼Œå¦‚æœ<code class="fe ly lz ma lm b">hashCode</code>è¢«æ­£ç¡®å®ç°ï¼ŒæŸ¥æ‰¾ä¸€ä¸ªå…ƒç´ åº”è¯¥åªéœ€è¦ä¸€æ¬¡æ¯”è¾ƒã€‚</p><p id="7899" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">è¿™æ˜¯<code class="fe ly lz ma lm b">InMemoryRepo</code>ç”¨åœ°å›¾ä»£æ›¿åˆ—è¡¨:</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="3369" class="lq lr iy lm b gy ls lt l lu lv">class InMemoryUserRepo: UserRepo {<br/>   private val users: MutableMap&lt;UserId, User&gt; = mutableMapOf()</span><span id="fdee" class="lq lr iy lm b gy lw lt l lu lv">   override fun getUser(id: UserId): User? = users[id]<br/>   <br/>   fun addUser(user: User) {<br/>      user.put(user.id, user)<br/>   }<br/>}</span></pre><p id="d88b" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">å¤§å¤šæ•°å…¶ä»–æ“ä½œï¼Œå¦‚ä¿®æ”¹æˆ–è¿­ä»£è¿™äº›æ•°æ®(å¯èƒ½ä½¿ç”¨é›†åˆå¤„ç†æ–¹æ³•ï¼Œå¦‚è¿‡æ»¤ã€æ˜ å°„ã€å¹³é¢æ˜ å°„ã€æ’åºã€æ±‚å’Œç­‰ã€‚)å¯¹äºæ ‡å‡†åˆ—è¡¨å’Œåœ°å›¾å…·æœ‰æˆ–å¤šæˆ–å°‘ç›¸åŒçš„æ€§èƒ½ã€‚</p><figure class="lh li lj lk gt ip gh gi paragraph-image"><a href="https://www.kt.academy/workshop/refactoringToPatterns"><div class="gh gi mc"><img src="../Images/62520e901df6820dab70ac182f9613ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lyoUl26C3O3OEdhpbEuN0A.png"/></div></a></figure><p id="e2a4" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">é—®é¢˜æ˜¯æˆ‘ä»¬å¦‚ä½•ä»åˆ—è¡¨è½¬æ¢åˆ°åœ°å›¾ï¼Œåä¹‹äº¦ç„¶ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä½¿ç”¨<code class="fe ly lz ma lm b">associate</code>åŠŸèƒ½ã€‚æœ€å¸¸è§çš„æ˜¯<code class="fe ly lz ma lm b">associateBy</code>,å®ƒæ„å»ºä¸€ä¸ªæ˜ å°„ï¼Œå…¶ä¸­å€¼æ˜¯åˆ—è¡¨ä¸­çš„å…ƒç´ ï¼Œé”®æ˜¯åœ¨lambdaè¡¨è¾¾å¼ä¸Šç”Ÿæˆçš„:</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="f04b" class="lq lr iy lm b gy ls lt l lu lv">data class User(val id: Int, val name: String)<br/>val users = listOf(User(1, "Michal"), User(2, "Marek"))</span><span id="a911" class="lq lr iy lm b gy lw lt l lu lv">val byId = users.associateBy { it.id }<br/>byId == mapOf(1 to User(1, "Michal"), 2 to User(2, "Marek")) </span><span id="d55d" class="lq lr iy lm b gy lw lt l lu lv">val byName = users.associateBy { it.name }<br/>byName == mapOf("Michal" to User(1, "Michal"), <br/>              "Marek" to User(2, "Marek"))</span></pre><p id="ffc9" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">è¯·æ³¨æ„ï¼Œæ˜ å°„ä¸­çš„é”®å¿…é¡»æ˜¯å”¯ä¸€çš„ï¼Œå¦åˆ™é‡å¤é¡¹å°†è¢«åˆ é™¤ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬åº”è¯¥åªé€šè¿‡ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦æ¥å…³è”(è¦é€šè¿‡ä¸å”¯ä¸€çš„ä¸œè¥¿æ¥åˆ†ç»„ï¼Œä½¿ç”¨<code class="fe ly lz ma lm b"><a class="ae mb" href="https://kotlinlang.org/api/latest/jvm/stdlib/kotlin.collections/group-by.html" rel="noopener ugc nofollow" target="_blank">groupBy</a></code>)ã€‚</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="010d" class="lq lr iy lm b gy ls lt l lu lv">val users = listOf(User(1, "Michal"), User(2, "Michal"))</span><span id="9bbb" class="lq lr iy lm b gy lw lt l lu lv">val byName = users.associateBy { it.name }<br/>byName == mapOf("Michal" to User(2, "Michal"))</span></pre><p id="c29f" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">è¦åè¿‡æ¥è½¬æ¢ï¼Œå¯ä»¥ä½¿ç”¨<code class="fe ly lz ma lm b">values</code>:</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="eeec" class="lq lr iy lm b gy ls lt l lu lv"><strong class="lm iz">val </strong>users = <em class="lx">listOf</em>(User(1, <strong class="lm iz">"Michal"</strong>), User(2, <strong class="lm iz">"Michal"</strong>))<br/><strong class="lm iz">val </strong>byId = users.<em class="lx">associateBy </em><strong class="lm iz">{ it</strong>.<strong class="lm iz">id }<br/></strong>users == byId.<strong class="lm iz">values</strong></span></pre><p id="7390" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">è¿™å°±æ˜¯ä½¿ç”¨mapå®ç°å…¶ä»–å­˜å‚¨åº“ä»¥æé«˜å…ƒç´ è®¿é—®æ€§èƒ½çš„æ–¹å¼:</p><pre class="lh li lj lk gt ll lm ln lo aw lp bi"><span id="0569" class="lq lr iy lm b gy ls lt l lu lv"><strong class="lm iz">class </strong>NetworkUserRepo(<strong class="lm iz">val userService</strong>: UserService): UserRepo {<br/>    <strong class="lm iz">private var users</strong>: Map&lt;UserId, User&gt;? = <strong class="lm iz">null<br/>    override fun </strong>getUser(id: UserId): User? {<br/>        <strong class="lm iz">if</strong>(<strong class="lm iz">users </strong>== <strong class="lm iz">null</strong>) {<br/>            <strong class="lm iz">users </strong>= <strong class="lm iz">userService</strong>.getUsers().<em class="lx">associateBy </em><strong class="lm iz">{ it</strong>.<strong class="lm iz">id }<br/>        </strong>}<br/>        <strong class="lm iz">return users</strong>?.get(id)<br/>    }<br/>}<br/><br/><strong class="lm iz">class </strong>ConfigurationsRepository(<br/>    configurations: List&lt;Configuration&gt;<br/>) {<br/>    <strong class="lm iz">val configurations</strong>: Map&lt;String, Configuration&gt; = <br/>        configurations.<em class="lx">associateBy </em><strong class="lm iz">{ it</strong>.<strong class="lm iz">name }<br/>    <br/>    fun </strong>getByName(name: String) = <strong class="lm iz">configurations</strong>[name]<br/>}</span></pre><p id="e8da" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">è¿™é¡¹æŠ€æœ¯å¾ˆé‡è¦ï¼Œä½†å¹¶ä¸é€‚ç”¨äºæ‰€æœ‰æƒ…å†µã€‚å½“æˆ‘ä»¬ç»å¸¸éœ€è¦è®¿é—®è¿™äº›å…ƒç´ æ—¶ï¼Œå®ƒä¼šæ›´æœ‰ç”¨ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå®ƒåœ¨åç«¯ç‰¹åˆ«é‡è¦ï¼Œå› ä¸ºè¿™äº›é›†åˆå¯èƒ½æ¯ç§’è¢«è®¿é—®å¾ˆå¤šæ¬¡ã€‚åœ¨å‰ç«¯(æˆ‘æŒ‡çš„ä¹Ÿæ˜¯Androidæˆ–iOS)ç”¨æˆ·æœ€å¤šè®¿é—®å‡ æ¬¡è¿™ä¸ªå­˜å‚¨åº“å¹¶ä¸é‡è¦ã€‚æˆ‘ä»¬è¿˜éœ€è¦è®°ä½ï¼Œä»åˆ—è¡¨åˆ°æ˜ å°„ä¹Ÿéœ€è¦ä¸€äº›æ—¶é—´ï¼Œæ‰€ä»¥å¦‚æœæˆ‘ä»¬ç»å¸¸è¿™æ ·åšï¼Œä¹Ÿå¯èƒ½ä¼šå½±å“æˆ‘ä»¬çš„æ€§èƒ½ã€‚</p></div><div class="ab cl md me hr mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="ig ih ii ij ik"><h1 id="1ec2" class="mk lr iy bd ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng bi translated">å•å‡»ğŸ‘è¯´â€œè°¢è°¢ï¼â€å¹¶å¸®åŠ©ä»–äººæ‰¾åˆ°è¿™ç¯‡æ–‡ç« ã€‚</h1><p id="99f2" class="pw-post-body-paragraph jv jw iy jx b jy nh ka kb kc ni ke kf kg nj ki kj kk nk km kn ko nl kq kr ks ig bi translated">äº†è§£å¡å¸•å¤´æœ€æ–°çš„é‡å¤§æ–°é—»ã€‚å­¦é™¢ï¼Œ<a class="ae mb" href="https://kotlin-academy.us17.list-manage.com/subscribe?u=5d3a48e1893758cb5be5c2919&amp;id=d2ba84960a" rel="noopener ugc nofollow" target="_blank">è®¢é˜…æ—¶äº‹é€šè®¯</a>ï¼Œ<a class="ae mb" href="https://twitter.com/ktdotacademy" rel="noopener ugc nofollow" target="_blank">è§‚å¯Ÿæ¨ç‰¹</a>å¹¶åœ¨åª’ä½“ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚</p><p id="72b8" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">å¦‚æœä½ éœ€è¦ä¸€ä¸ªç§‘ç‰¹æ—å·¥ä½œå®¤ï¼Œçœ‹çœ‹æˆ‘ä»¬å¦‚ä½•èƒ½å¸®åŠ©ä½ :<a class="ae mb" href="https://www.kt.academy/" rel="noopener ugc nofollow" target="_blank"> kt.academy </a>ã€‚</p><figure class="lh li lj lk gt ip gh gi paragraph-image"><a href="https://kotlin-academy.us17.list-manage.com/subscribe?u=5d3a48e1893758cb5be5c2919&amp;id=d2ba84960a"><div class="gh gi mc"><img src="../Images/3146970f03e44cb07afe660b0d43e045.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*54OqlYA4etu7wfpmMP5TKQ.png"/></div></a></figure></div></div>    
</body>
</html>