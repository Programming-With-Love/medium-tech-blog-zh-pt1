<html>
<head>
<title>Nested KVM Virtualization on Oracle Cloud Infrastructure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Oracle云基础架构上的嵌套KVM虚拟化</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/nested-kvm-virtualization-on-oracle-cloud-infrastructure-5559bdd2213d?source=collection_archive---------0-----------------------#2017-10-04">https://medium.com/oracledevs/nested-kvm-virtualization-on-oracle-cloud-infrastructure-5559bdd2213d?source=collection_archive---------0-----------------------#2017-10-04</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="b5cf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">嵌套虚拟化允许您在另一个虚拟机内运行一个虚拟机，同时仍然使用来自主机的硬件加速。在Oracle云基础架构(OCI)上，您还可以为KVM虚拟机管理程序使用裸机实例形状，而不是嵌套的虚拟机。</p><p id="b5a2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">查看我们的<a class="ae jc" href="https://docs.us-phoenix-1.oraclecloud.com/Content/Resources/Assets/installing_kvm_multi_vnics.pdf" rel="noopener ugc nofollow" target="_blank">在裸机实例上使用多虚拟网卡安装和配置KVM</a>白皮书，如果您打算使用裸机形状而不是虚拟机形状，该白皮书详细解释了这一过程。</p><p id="96bf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这篇博客描述了如何在OCI KVM虚拟机管理程序上安装、配置和使用KVM Guests虚拟机。这个过程也称为嵌套KVM虚拟化。</p><h1 id="1009" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">入门指南</h1><p id="51d7" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">如上所述，在Oracle云基础设施上，您的KVM虚拟机管理程序可以安装在裸机或虚拟机主机上。</p><p id="e8b8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以下是您可以用于KVM虚拟机管理程序的当前形状选项:</p><p id="24e8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">裸机形状</strong></p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/c639507cd79804d05418da741325b0ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uByZE6Wlv39JeoXF.png"/></div></div></figure><p id="81e0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">虚拟机形状</strong></p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/b2fda2dae67ee1bcfe457b4049e4c548.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OumQ7S3Ek-f83_2y.png"/></div></div></figure><p id="d765" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">建议查看<a class="ae jc" href="https://docs.us-phoenix-1.oraclecloud.com/Content/Compute/Tasks/launchinginstance.htm" rel="noopener ugc nofollow" target="_blank">我们的公共文档</a>以了解您可以在自己的环境中使用的当前选项和功能。</p><p id="c908" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">根据您的工作负载要求选择一个虚拟机形状，并在继续操作之前进行配置。</p><h1 id="7f84" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">要求</h1><ul class=""><li id="7eb9" class="ks kt hh ig b ih kb il kc ip ku it kv ix kw jb kx ky kz la bi translated">运行Oracle Linux 7.x的OCI虚拟机实例(只要支持KVM，也可以使用其他Linux发行版)</li><li id="f7ff" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">在Windows服务器实例上运行时，Microsoft Windows应用程序许可证可能需要通过软件保障进行许可证移动。有关您的许可权的问题应该向Microsoft或您的Microsoft经销商提出</li><li id="db05" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">请注意，将第三方应用程序许可引入Oracle云基础架构时，您需要独自承担在KVM服务器实例上使用的任何第三方操作系统/应用程序供应商的许可义务</li><li id="4d52" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">您的KVM虚拟机操作系统ISO需要上传到KVM服务器实例中，以便安装来宾虚拟机</li><li id="605b" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">建议使用额外的块存储卷，并将其连接到嵌套的KVM服务器实例，以保存KVM VM qco w2磁盘映像。您还可以使用NVMe磁盘的OCI形状来代替iSCSI块存储。</li></ul><p id="6f48" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">发出以下命令来安装最新的qemu包和virt-manager，它提供了管理虚拟机的图形界面。</p><p id="4251" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ sudo yum-y install QEMU-KVM QEMU-img virt-manager lib virt lib virt-python lib virt-client virt-install virt-viewer</p><h1 id="c66b" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">为GUI远程连接安装VNC</h1><p id="3e96" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">运行以下命令安装VNC软件包</p><p id="80c2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ sudo yum groupinstall "带GUI的服务器"-y</p><p id="39f5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ sudo yum install xorg-X11-xauth xorg-X11-fonts-* xorg-X11-utils tiger VNC-server-y</p><p id="152a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，复制vncserver@。对vncserver@的服务:1.service。</p><p id="7a19" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ cd /lib/systemd/system</p><p id="6521" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ sudo cp vncserver@。服务vncserver@:1 .服务</p><p id="ba7b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ sudo vi vncserver\@\:1.service</p><p id="0115" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将vncserver@1.service中的<user>替换为“opc”用户名，现在为vncserver@中定义的opc用户设置VNC密码。服务</user></p><p id="1952" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"># su — opc</p><p id="cb21" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"># vncpasswd</p><p id="5cb8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">密码:</p><p id="e3a4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">验证:</p><p id="1f99" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">#退出</p><p id="61bf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">配置防火墙以允许VNC连接</p><p id="83b1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ sudo firewall-cmd-permanent-zone = public-add-service VNC-server</p><p id="5ff7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将VNC配置为自动启动</p><p id="bf0a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ sudo systemctl后台程序-重新加载</p><p id="e4a9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ sudo system CTL enable VNC server @:1 . service</p><p id="17bf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ sudo system CTL start vncserver @:1 . service</p><h1 id="f3b3" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">为多虚拟网卡和嵌套虚拟化准备KVM服务器</h1><p id="9688" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">在Oracle Linux 7.x KVM服务器实例上，执行以下操作:</p><p id="210b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ sudo vi /etc/default/grub</p><p id="0ae7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">#在GRUB_CMDLINE_LINUX行中追加以下参数</p><p id="bf46" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">kvm上的Intel _ io MMU = Intel . nested = 1</p><p id="bf54" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是一个例子:</p><p id="cff4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ sudo cat /etc/default/grub |grep命令行</p><p id="11bf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">GRUB _ CMDLINE _ LINUX = " crash kernel = auto LANG = en _ US。UTF-8控制台=tty0控制台=ttyS0，9600 rd . luks = 0 rd . LVM = 0 rd . MD = 0dm = 0 IP = DHCP net root = iscsi:169 . 254 . 0 . 2::::iqn . 2015–02 . Oracle . boot:uefi iscsi _ param = node . session . timeo . replacement _ time out = 6000<strong class="ig hi">Intel _ io MMU = on</strong><strong class="ig hi">KVM-Intel . nested = 1【T4</strong></p><p id="c594" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">保存并退出vi。</p><p id="fe17" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，运行以下命令来</p><p id="9376" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">-启用调谐</p><p id="caa8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ sudo systemctl启用优化</p><p id="d704" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ sudo systemctl开始调整</p><p id="a284" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ sudo tuned-adm配置文件虚拟主机</p><p id="0c75" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">-重新创建grub以验证所有更改</p><p id="cf9e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ sudo CP/boot/EFI/EFI/red hat/grub . CFG/boot/EFI/EFI/red hat/grub . CFG . orig</p><p id="8b3e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ sudo grub 2-mkconfig-o/boot/EFI/EFI/red hat/grub . CFG</p><p id="a7ec" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用您的OCI控制台，编辑您的虚拟云网络安全列表，并启用端口5901(如果该端口对应于您正在使用的VNC端口)</p><p id="6188" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">资料来源:0.0.0.0/0</p><p id="5d9f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">IP协议:TCP</p><p id="53d9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">源端口范围:所有</p><p id="e626" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">目标端口范围:5901</p><p id="215c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">允许:端口的TCP流量:5901</p><p id="29b8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">重新启动OCI KVM嵌套虚拟机实例，以加载KVM内核模块。一旦您的虚拟机恢复在线，您应该能够通过任何VNC应用程序(如<a class="ae jc" href="https://www.realvnc.com/en/download/viewer/" rel="noopener ugc nofollow" target="_blank"> vncviewer </a>)访问您的KVM虚拟机管理程序实例</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lg"><img src="../Images/b773907c0001147d43b4ea4eb02af337.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xeMmgeAA80ilVQiM.png"/></div></div></figure><h1 id="daa6" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">创建OCI辅助虚拟网卡</h1><p id="f4ea" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">下一步是创建一个辅助vNIC，并将其连接到KVM嵌套VM实例。这个辅助vNIC将用于您的嵌套VM客户机。</p><p id="7d10" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用OCI仪表板，单击KVM实例的详细信息，选择“附加的vNIC ”,然后单击“创建vNIC”选项。</p><p id="9244" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是一个在可用性域1 (AD1)上使用名为“New-BM-172”的虚拟云网络(VCN)的示例</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lh"><img src="../Images/854f860ca67b43cc33f6b87150653ec8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*s155iH-rwSeZfYr0.png"/></div></div></figure><p id="27f6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建之后，您应该会看到以下内容:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es li"><img src="../Images/3cf7d82591cd87e5b5c0fe0f98539851.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-yg8DSlAr1PLlQVC.png"/></div></div></figure><p id="4879" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请注意“MAC地址”和IP地址信息，因为您稍后会用到它们。</p><h1 id="5352" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">将OCI辅助虚拟网卡与您的KVM来宾虚拟机关联</h1><p id="1271" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">在开始客户机安装过程之前，在KVM虚拟机管理程序上运行以下命令</p><p id="7016" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ sudo ip链接</p><p id="3695" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">1: lo: <loopback> mtu 65536 qdisc noqueue状态未知模式默认</loopback></p><p id="22c2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">链路/回送00:00:00:00:00:00 brd 00:00:00:00:00:00</p><p id="22e8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2: ens3: <broadcast> mtu 9000 qdisc mq状态UP模式默认qlen 1000</broadcast></p><p id="a7c2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">link/ether 00:00:17:01:16:5d brd ff:ff:ff:ff:ff:ff:ff</p><p id="5644" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 3: ens4: &lt;广播，组播，UP，LOWER_UP &gt; mtu 1500 qdisc mq状态UP模式默认qlen 1000 </strong></p><p id="867f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">link/ether 00:00:17:01:ce:47 brd ff:ff:ff:ff:ff:ff</strong></p><p id="68b6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">4:virbr 0:<no-carrier>MTU 1500 qdisc no queue状态关闭模式默认值</no-carrier></p><p id="bb82" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">link/ether 52:54:00:40:76:12 brd ff:ff:ff:ff:ff:ff</p><p id="1932" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">5:virbr 0-NIC:<broadcast>MTU 1500 qdisc p FIFO _ fast master virbr 0状态下降模式默认qlen 500</broadcast></p><p id="cbe7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">link/ether 52:54:00:40:76:12 brd ff:ff:ff:ff:ff:ff</p><p id="c52e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">并确定与您的OCI辅助vNIC mac地址匹配的接口。如上所示，ens4将在本博客中与KVM Guest一起使用。</p><p id="c3a3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下一步是调配KVM来宾虚拟机，并将上述虚拟网卡添加到其中。</p><h1 id="1f8e" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">创建KVM来宾实例</h1><p id="16fc" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">建议在继续操作之前，将iSCSI块卷连接到OCI嵌套虚拟机管理程序，以存储KVM qcow2文件。如果您对嵌套的KVM虚拟机管理程序使用NVMe虚拟机形状选项，也可以使用NVMe磁盘。</p><p id="b064" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">KVM可以使用命令行或可用的图形工具来管理，所以让我们使用VNC连接到您的OCI KVM管理程序实例，然后打开gnome终端并运行以下命令</p><p id="1934" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果这是您第一次运行virt-manager，您将需要创建一个本地QEMU/KVM连接，然后单击“创建一个新的虚拟机”按钮，并按照所需的选项进行操作，如下所示</p><p id="81a5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">选择ISO图像</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es lj"><img src="../Images/fe01a7001d583da2ca3953118a3939ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/0*T1OlHjADv_-dqrT9.png"/></div></figure><p id="ac60" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">来宾操作系统信息</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es lk"><img src="../Images/fbad2f33326603ea00e090be8b7f1dbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/0*wkNWIYwY_mO2FyX3.png"/></div></figure><p id="76c4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">内存/CPU</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es ll"><img src="../Images/a80df788d3918dd529364c2c934326de.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/0*ax6n6-X0liy9UMkX.png"/></div></figure><p id="b572" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">存储大小和位置</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es lm"><img src="../Images/af3a8048daf612fe423d20053bdecc14.png" data-original-src="https://miro.medium.com/v2/resize:fit:782/format:webp/0*vA8PjTVQcQ70dKzP.png"/></div></figure><p id="2e37" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">注意:</strong>确保选择“安装前自定义配置”选项，然后单击“完成”</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es ln"><img src="../Images/f0691cce9b1f7ddce4f200b69d63c17e.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/0*vogd59xnNv1A5_KR.png"/></div></figure><p id="8e0f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，在virt-manager上单击在上述来宾创建过程中添加的默认NIC，将其更改为“Passthrough”，添加上面标识的OCI辅助vNIC mac地址以及正确的接口名称(即；ens4)</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lo"><img src="../Images/f356e3dea8be31e038e9c1da9802a3ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nK5dp3IVHT-98Ifi.png"/></div></div></figure><p id="8fdd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">单击“应用”和“开始安装”按钮，并照常遵循操作系统安装流程。请记住，您需要在安装期间或之后添加网络信息。</p><p id="a943" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">确保您的网络配置设置为静态IP(使用基于您在上面创建的辅助vNIC的IP信息)、DNS(服务器和名称搜索选项)和网关IP。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lp"><img src="../Images/e3c438bcd4086335e4f3dc5062c4ae11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yzseBKmmeDHvjnvA.png"/></div></div></figure><p id="dd36" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">配置完成！作为一个例子，下面是一个嵌套的KVM虚拟机。运行2 KVM客户机的Standard1.8实例。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lq"><img src="../Images/f97c0ccdc1d850a5cce35af1528246ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ibiBH7dsBFdeGNCi.png"/></div></div></figure><h1 id="28cb" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">其他安全建议:</h1><ul class=""><li id="8f0f" class="ks kt hh ig b ih kb il kc ip ku it kv ix kw jb kx ky kz la bi translated">禁用ssh密码认证并启用SSH密钥认证(在/home/opc/中添加您的SSH公钥。ssh/授权密钥文件)</li><li id="84af" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">保持KVM客户机防火墙处于启用状态，仅打开所需的端口</li><li id="cbb8" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">定期修补您的KVM来宾虚拟机</li><li id="72cc" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">如果可能，使用VPN</li><li id="18e2" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">保持VNC端口阻塞，并使用“ssh -L”在OCI嵌套KVM虚拟机管理程序和本地主机之间创建一个隧道，以便能够使用VNC</li></ul></div></div>    
</body>
</html>