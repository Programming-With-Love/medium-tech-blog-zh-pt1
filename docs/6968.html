<html>
<head>
<title>Python Type Hinting: Eliminating ImportError Due to Circular Imports</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python类型提示:消除循环导入导致的导入错误</h1>
<blockquote>原文：<a href="https://medium.com/quick-code/python-type-hinting-eliminating-importerror-due-to-circular-imports-265dfb0580f8?source=collection_archive---------0-----------------------#2021-07-30">https://medium.com/quick-code/python-type-hinting-eliminating-importerror-due-to-circular-imports-265dfb0580f8?source=collection_archive---------0-----------------------#2021-07-30</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/c0714b38db62e8ec8611ba843ff6a17c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*StVFZZgHoZcAvFVX"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo by <a class="ae it" href="https://unsplash.com/@cdr6934?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Chris Ried</a> on <a class="ae it" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="db59" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">由于循环导入只发生在类型提示中，我们有时都会遇到<code class="du js jt ju jv b">ImportError</code>。处理这类问题有一个简单的方法。</p><p id="c1b8" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">假设我们有如下两个文件:</p><figure class="jw jx jy jz fd ii"><div class="bz dy l di"><div class="ka kb l"/></div></figure><p id="0616" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">另一个文件:</p><figure class="jw jx jy jz fd ii"><div class="bz dy l di"><div class="ka kb l"/></div></figure><p id="fe8d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这两个文件将很好地工作，因为我们没有添加任何类型提示。只有<code class="du js jt ju jv b">BookManager</code>被导入到<code class="du js jt ju jv b">book_model.py</code>文件中。但是如果我们将类型提示添加到来自<code class="du js jt ju jv b">BookManager</code>的<code class="du js jt ju jv b">create_new_version_of_book</code>方法中，那么它将如下所示:</p><figure class="jw jx jy jz fd ii"><div class="bz dy l di"><div class="ka kb l"/></div></figure><p id="9c19" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，由于循环导入，我们将得到一个<code class="du js jt ju jv b">ImportError</code>，当我们想要运行项目/文件时，我们将得到类似下面的消息:</p><pre class="jw jx jy jz fd kc jv kd ke aw kf bi"><span id="84bd" class="kg kh hh jv b fi ki kj l kk kl">ImportError: cannot import name 'BookManager' from partially initialized module 'mymodule.models' (most likely due to a circular import)</span></pre><p id="c67e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">解决方法是使用<code class="du js jt ju jv b">typing.TYPE_CHECKING</code>常量，如下所示:</p><figure class="jw jx jy jz fd ii"><div class="bz dy l di"><div class="ka kb l"/></div></figure><p id="359e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">第1行:</strong>我们导入了<code class="du js jt ju jv b">annotations</code>。<code class="du js jt ju jv b">__future__.annotations</code>现在在Python中不是默认的；但在Python 3.11中会成为默认。详细情况你看一下<a class="ae it" href="https://www.python.org/dev/peps/pep-0563/#abstract" rel="noopener ugc nofollow" target="_blank"> PEP 563 </a>。如果不导入，可以将类型提示作为字符串使用。在我们的例子中，它将是<code class="du js jt ju jv b">old_book_object: ‘Book’</code>。</p><p id="2e1b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">第3行:</strong>我们导入了<code class="du js jt ju jv b">typing.TYPE_CHECKING</code>特殊常量。常量的值始终是<code class="du js jt ju jv b">False</code>，但是被任何类型检查器设置为<code class="du js jt ju jv b">True</code>，例如<code class="du js jt ju jv b">Mypy</code>。我们已经使用this常量使我们的导入有条件。</p><p id="119d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">第7–8行:</strong>我们已经带条件导入了模型，所以只有当<code class="du js jt ju jv b">TYPE_CHECKING</code>变量为<code class="du js jt ju jv b">True</code>时才会导入。</p><p id="4160" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">希望，这能有所帮助。:)</p></div></div>    
</body>
</html>