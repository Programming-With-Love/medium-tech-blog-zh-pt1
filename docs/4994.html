<html>
<head>
<title>The Experience Writing Kotlin Multiplatform Mobile Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编写Kotlin多平台移动应用的体验</h1>
<blockquote>原文：<a href="https://blog.kotlin-academy.com/the-experience-writing-kotlin-multiplatform-mobile-apps-6f9677d7cc1f?source=collection_archive---------0-----------------------#2022-10-04">https://blog.kotlin-academy.com/the-experience-writing-kotlin-multiplatform-mobile-apps-6f9677d7cc1f?source=collection_archive---------0-----------------------#2022-10-04</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/fff66fde0ad6e65638d9263e9a4eab3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UKBR42QPi_8CjjqCYop9Gw.png"/></div></div></figure><p id="70fe" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="kt">去https://github.com/itmaginationdemos/KMM-Sample-App</em><a class="ae ku" href="https://github.com/itmaginationdemos/KMM-Sample-App" rel="noopener ugc nofollow" target="_blank"><em class="kt"/></a>看看我们的知识库，里面有一个在KMM帮助下编写的示例应用</p><p id="f69e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在进入文章的主要部分之前，我们想先解释一下我们的出发点。我们对KMM (Kotlin <a class="ae ku" href="https://www.itmagination.com/clients-scope/mobile-application-development" rel="noopener ugc nofollow" target="_blank">多平台</a>移动)的早期知识知之甚少，完全不知情，我们遇到的一些问题是由于缺乏使用该框架的经验，因为它还是新鲜的。只需一些时间，您就可以很快熟悉这个工具。</p><p id="4a22" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">顺便提一下，大公司已经意识到了新框架的好处——包括<a class="ae ku" href="https://kotlinlang.org/lp/mobile/case-studies/philips" rel="noopener ugc nofollow" target="_blank">飞利浦</a>、<a class="ae ku" href="https://netflixtechblog.com/netflix-android-and-ios-studio-apps-kotlin-multiplatform-d6d4d8d25d23" rel="noopener ugc nofollow" target="_blank">网飞、</a>和<a class="ae ku" href="https://kotlinlang.org/lp/mobile/case-studies/vmware/" rel="noopener ugc nofollow" target="_blank"> VMWare。</a>尽管在这个过程中有一些小问题，但KMM是大型组织中跨平台移动开发的一个非凡工具。</p><h1 id="8cb7" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">建立</h1><ul class=""><li id="9a7f" class="lt lu in jx b jy lv kc lw kg lx kk ly ko lz ks ma mb mc md bi translated">马科斯蒙特雷12.5.1</li><li id="448a" class="lt lu in jx b jy me kc mf kg mg kk mh ko mi ks ma mb mc md bi translated">Android Studio电鳗金丝雀10(但我们也尝试了海豚和花栗鼠)</li><li id="5965" class="lt lu in jx b jy me kc mf kg mg kk mh ko mi ks ma mb mc md bi translated">XCode 14.0</li><li id="53cd" class="lt lu in jx b jy me kc mf kg mg kk mh ko mi ks ma mb mc md bi translated">格拉德</li><li id="6cd9" class="lt lu in jx b jy me kc mf kg mg kk mh ko mi ks ma mb mc md bi translated">科特林1.7.20-RC</li></ul><h1 id="2f78" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">好人</h1><p id="ee75" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg mj ki kj kk mk km kn ko ml kq kr ks ig bi translated">当你输入短语“KMM教程”时，谷歌搜索结果是<a class="ae ku" href="https://kotlinlang.org/docs/multiplatform-mobile-getting-started.html#join-the-community" rel="noopener ugc nofollow" target="_blank">官方文件</a>，它们非常有用。告诉读者我们应该将必要的代码放在哪个Gradle文件中会很有帮助，因为这并不明显(每个文件都被称为相同的)。这有点像你第一次开始学习Android编程和Android Studio。</p><p id="11b5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">教程中提到的官方网站上的一个很棒的工具是KDoctor，事实证明它对发现任何出现的问题都有很大的帮助。例如，当KDoctor在几秒钟内诊断出KMM插件被移除(似乎没有任何原因)时，有很多人挠头(尽管我们确实花了几个小时向好医生寻求帮助)。</p><p id="6f9f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">基本的<a class="ae ku" href="https://insert-koin.io/docs/reference/koin-mp/kmp/" rel="noopener ugc nofollow" target="_blank"> Koin </a>设置非常棒。它清晰而简洁。打开文档几分钟后，一切都井井有条。如果你需要任何进一步的解释，这里有一些Android和iOS的样本代码。有一个小问题，但在下一节中会有更多。</p><h1 id="33ab" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">坏事</h1><p id="3b49" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg mj ki kj kk mk km kn ko ml kq kr ks ig bi translated">开始一个新项目是势不可挡的。你必须掌握许多新概念。我们也受到大量不必要的文件夹/子集的轰炸。可以说，最初的几分钟可能会让新人却步。</p><p id="f10b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们回到Koin。正如我们已经提到的，基本设置是一个梦想，但有一个小问题——在Android和iOS之间共享代码，以防构造函数因任何原因而不同。更准确地说，当实例化SQLDelight数据库时，我们必须手动创建每个实例(这不是一个大问题，但可以添加到文档中)。</p><p id="f5b9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">要创建iOS应用程序，您需要XCode。不管出于什么原因，在2022年，我们在苹果方面的带宽有限，这使得下载需要5个小时(作为参考，Android Studio下载需要1到2分钟)。反正就像90年代一样，睡觉前开始下载。</p><h1 id="7552" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">丑陋的</h1><p id="0384" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg mj ki kj kk mk km kn ko ml kq kr ks ig bi translated">我们采访了一些也尝试过KMM的人，有些人确实有这些问题，有些人有不同的问题，有些人没有。我们下面描述的经历可能和你的不一样。</p><p id="a394" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">遗憾的是，我们在Gradle、Android Studio、Kotlin和KMM插件本身上遇到了相当多的问题，很难准确指出是什么问题。从教程第一次开始到写这篇文章的时候，我们已经改变了所有的版本(它们定期改变)。</p><p id="460c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们甚至尝试了Android Studio花栗鼠、海豚和电鳗，其中后者被证明是最稳定的(这很奇怪)。</p><p id="59c5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">此外，正如我们已经提到的，KMM插件只是在某个时候被删除了，我们甚至没有注意到，直到我们调用KDoctor。回想起来，这可能是这里最大的问题。没有它，许多奇怪的错误和假警报就会出现。例如，我们在共享的iOS和Android代码上有一堆错误，但是代码编译正确。</p><p id="68f5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">空的源集也有一些恼人的问题，它们被解释为模块。当IDE(集成开发编辑器)确定我们缺少实现时，这就导致了使用expect关键字的问题(更多关于这个<a class="ae ku" href="https://kotlinlang.org/docs/multiplatform-connect-to-apis.html" rel="noopener ugc nofollow" target="_blank">这里</a>)。</p><p id="12ae" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">不确定这是否与KMM有关，但撰写导航也有一些问题。即使我们正确地遵循了说明，我们也无法导入NavHostController。经过一番搜索，我们找到了一些清除Gradle缓存和重置Java类路径的建议。在无效缓存和重启的帮助下，40分钟后，导入成功了。一点都不好玩。</p><h1 id="77e5" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">荣誉奖</h1><p id="2a85" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg mj ki kj kk mk km kn ko ml kq kr ks ig bi translated">我们想给这个项目添加一些更复杂的东西，所以我们开始录制语音笔记，就像这个应用程序的名字所暗示的那样。</p><p id="f4e4" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们一开始犯了一个新手的错误，那就是信任谷歌的文档。我们遇到的问题是写入外部存储。在最近几个Android版本中，这样做变得非常复杂，文档也没有太大帮助。文档的作者瞄准了忽略了大部分这些问题的Android API 28。</p><p id="1c21" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">此外，我们需要获得用户许可来录制语音消息，我们开始用老方法来做这件事(在Compose之前)。解决方案本来可以改进很多，但是很乱，我们不喜欢。所以，我们用谷歌搜索了一些更好的东西。输入<a class="ae ku" href="https://github.com/google/accompanist" rel="noopener ugc nofollow" target="_blank">伴奏</a>，这是一套与Compose一起使用的工具。在这方面，谷歌确实帮了我们一个大忙。这里有很多有用的特性，但是我们只使用了权限部分——它用三行代码处理语音权限。</p><h1 id="e7b7" class="kv kw in bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">我们学到了什么</h1><h2 id="e7e3" class="mm kw in bd kx mn mo dn lb mp mq dp lf kg mr ms lj kk mt mu ln ko mv mw lr mx bi translated">开发商</h2><p id="b050" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg mj ki kj kk mk km kn ko ml kq kr ks ig bi translated">也许当你读到这里时，你会觉得一切都不好，不值得。这与事实相去甚远。更应该把这看作是一张避免陷阱的地图(至少是其中的一些)。您将会遇到一些我们在这里没有涉及的潜在问题，这些问题大多与iOS上的多线程相关——但那是另一个时间的主题。</p><p id="a9bf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当你设置好一切后，你可以把它想象成一个多模块的Android应用程序，重点是与主模块(Android和iOS)共享尽可能多的代码。假设一个应用程序有一个相对简单的用户界面，但有很多逻辑(映射或离线优先)，你可以真正限制重复代码的数量，从而限制花在编写代码上的时间以及随之而来的不可避免的错误。</p><h2 id="055d" class="mm kw in bd kx mn mo dn lb mp mq dp lf kg mr ms lj kk mt mu ln ko mv mw lr mx bi translated">经理</h2><p id="25df" class="pw-post-body-paragraph jv jw in jx b jy lv ka kb kc lw ke kf kg mj ki kj kk mk km kn ko ml kq kr ks ig bi translated"><strong class="jx io">我们可能对较小的团队甚至个人有更偏见的看法，因为列出的一些问题在较大的团队中不是问题。当你有一个10人或更多开发人员的团队时，花几天时间设置好一切在大计划中并不算多。此外，代码重用的主要好处与更大的团队和更大的代码库相适应(共享模块中的代码越多，意味着跨平台重复的代码就越少)。</strong></p><p id="dd1e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们最近写了关于大型应用程序中代码可重用性的主题，你可以在这里查看。它的要点是，如果你有一个复杂的产品，你可能有许多复杂的代码和领域规则。这些东西必须写两遍(Android和iOS ),这意味着两倍的错误，两倍的成本，可能在功能上没有100%的重叠。</p><p id="802b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后，与其他多平台解决方案不同的是，通过设计，KMM不会以任何方式触及应用程序的UI部分。UI 100%基于每个平台，因此它将具有原生应用程序的真实感觉。另一方面，你需要雇佣更多有编写原生iOS界面经验的开发人员。</p><p id="34cc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们鼓励你去尝试，你永远不知道，也许这正是你在寻找的。如果你需要在你的公司实施新应用的帮助，<a class="ae ku" href="https://itmagination.com/contact" rel="noopener ugc nofollow" target="_blank">请随时联系我们的专家。</a></p></div><div class="ab cl my mz hr na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ig ih ii ij ik"><p id="0978" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">【https://www.itmagination.com】最初发表于<a class="ae ku" href="https://www.itmagination.com/blog/the-experience-writing-kotlin-multiplatform-mobile-apps" rel="noopener ugc nofollow" target="_blank"><em class="kt"/></a><em class="kt">。</em></p><figure class="ng nh ni nj gt jo gh gi paragraph-image"><a href="https://kotlin-academy.us17.list-manage.com/subscribe?u=5d3a48e1893758cb5be5c2919&amp;id=d2ba84960a"><div class="gh gi nf"><img src="../Images/7cc3e53c80b722128adb3c22f527646e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4PRlebsP2nkBq-WA8pLJew.png"/></div></a></figure><figure class="ng nh ni nj gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nk"><img src="../Images/e452e4fc7b1eea8b55443068d2db3db8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ExZwKRzrcaf2GDll17v8Lw.gif"/></div></div></figure></div></div>    
</body>
</html>