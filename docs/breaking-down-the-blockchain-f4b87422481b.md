# 打破区块链

> 原文：<https://medium.com/capital-one-tech/breaking-down-the-blockchain-f4b87422481b?source=collection_archive---------3----------------------->

## (只字未提比特币)

![](img/7fd88731790c5684706eae84aa218335.png)

区块链现在被谈论得很多。但是抛开炒作不谈，区块链是什么？区块链是一种开放的分布式账本技术，代表了一种全新的应用基础设施，由于其被认为具有民主化的潜力，许多人认为它是下一个大的商业颠覆者。

作为一名软件开发人员，区块链对我来说只是一个令人讨厌的时髦词汇，直到我花了一点时间来克服行话和加密货币热潮，学习这项技术的基础知识。让我们浏览一下区块链的一些技术组件(有趣的东西，如数字指纹、散列拼图和 Merkle 树！)并分解每一部分对这项技术的贡献。

# 区块链是什么？

让我们把区块链的人类语言定义和它如何工作的快速解释放在一起，开始理解它如何解决集中交易系统中固有的问题。

从本质上讲，区块链是交易的记录。它是一个不可变的、只可追加的数据库(或分类帐)——可以添加交易记录，但不能编辑或删除它们。任何保存到区块链的数据都不能更改。根据设计，区块链不是作为一个中央系统运行，而是作为一个分散的分布式计算机网络运行，这些计算机都通过互联网连接在一起，我们称之为点对点网络。网络中的所有成员都保存着数据库的一份完全相同的副本，并且他们都集体同意遵循一套规则来收集、验证和添加新数据。

为了快速解释，让我们考虑一个简单的例子，其中我们跟踪区块链的所有权。把一个交易想象成一个带有收据信息的文本文件。它列出了买方和卖方，有多少是易手，有一个时间戳来捕捉何时转让生效。

![](img/dc187c2f81a1afdb4aad9f2413cf1ead.png)

然后，将多个交易的交易数据打包成一个块，并将该块作为消息发送给网络中的每台计算机。网络中的每台计算机(或节点)遵循区块链协议定义的规则，并验证新块的有效性。

![](img/d73ff105188b31253110daaaa3dca413.png)

如果发现该数据块有效，就将其添加到区块链中，后者基本上是一个不断增长的交易数据链表，代表被跟踪的特定资产的整个交易历史。

![](img/e4d7b075b8241dd360f66b23bcfd53da.png)

因为每个节点都保留了一份区块链，所以实际上对事务的历史有一个共识——一个协议。每个节点都充当独立的见证人，证明整个事务历史的真实性。只要大多数节点同意区块链的真实副本，它就是有效的，并且可以被信任为真实的、合法的账本。

这是一个非常快速的解释，但它显示了区块链的架构如何解决集中式系统的问题。因为区块链是使用分布式对等网络编排的，所以没有管理记录保存的中央机构。在这个分布式系统中也没有单点故障，因为每个节点都有一份区块链的副本。

尽管如此，区块链并没有一个统一的定义。你会听到有人把它说成是分布式计算体系结构，你会听到有人把它说成是一种特殊的数据库，你会听到有人把它说成是一个块链。但是，如果你记住区块链设计模式的三个基本方面，你会处于非常好的状态。

1.  **有一种点对点方式连接的计算机网络。**如果您的电脑是区块链网络的一部分，它将直接与该网络上的其他电脑对话，而不是通过中央第三方拥有的中央服务器。
2.  **有一个共识算法**。网络中连接的计算机都运行相同软件的某个版本，该软件中编写了一些规则，这些规则定义了所有节点如何保持同步，并就它们保存到区块链的交易数据达成一致。
3.  **还有，就是区块链数据结构**。它分解成一个哈希链接的块链…本质上是一个非常长的，有点花哨的链表。

我们上面一直在谈论的是一个[公共区块链模型](https://en.wikipedia.org/wiki/Blockchain#Public_blockchains)，但它不是建造区块链的唯一方式——还有一个[私人模型](https://en.wikipedia.org/wiki/Blockchain#Private_blockchains)。在公共模型中，任何人—你、我、地球另一端的某个人—都可以读取区块链上的数据并将数据写入区块链。在私有模型中，只有经过授权的用户才能访问网络，因此协议中内置了一个访问控制层。

![](img/89dc8c8e3139c766a1ff6da5d87e37a8.png)

如果你加上[许可](/@akadiyala/nuances-between-permissionless-and-permissioned-blockchains-f5b566f5d483)的想法，那就给了我们四个区块链版本可供选择——*公开且无许可，私有且无许可，公开且有许可，*和*私有且有许可*。公共和无许可是最雄心勃勃的类型，因为它是一个完全去中心化的模型。在实践中，当用例与加密货币无关时，我们会更多地看到其他三种组合。

# 区块链是怎么做到的？

这时你可能会说，*“当然，太好了，听起来是个很好的理论……”*但似乎我们仍有一些问题需要回答:

*   我们怎么知道区块链上的交易记录不会被更改呢？
*   我们如何知道交易的双方是他们所说的，并且同意交易？
*   在一个有很多节点的分布式系统中，哪些是计算机，哪些是用户(读作:实际的人类)，如何才能相互验证？

为了找到答案，让我们深入了解一下，讨论一些技术问题，并开始构建一些心智模型。

## 加密哈希和 Merkle 树

密码术是区块链大量使用的核心技术。如果您曾经使用 Git 来处理数字文件的版本控制，那么您对加密散列函数应该很熟悉。

从单个字母到文件目录，任何数量的数据都可以用作哈希函数的输入，输出将是哈希(字母和数字的固定长度字符串)，可以用作数字指纹来唯一地表示该数据集。对于任何相同的数据集，输出将*总是*相同，但即使是一个变化——不同的字母或数字、标点符号或添加的空格——也会导致完全不同的哈希，给我们一个不同的、独特的数字指纹。

![](img/a5fdac70db048fdff7c99cf4cd5a820c.png)

算法如何工作的*的一个非常重要的部分是，基本上不可能预测输入的变化将如何影响输出。因此，记录在区块链上的每个交易都通过一个散列函数运行，然后可以用该散列来表示和标识。*

![](img/e1bb06ad3b04673db299a1aea08ba414.png)

让我们考虑一下，我们正在跟踪的资产每天将被处理多次，因此我们希望将多个事务打包到一个块中以提高效率。因为您可以散列任何数据集——比方说，两个散列字符串——所以可以获得一个散列集合，表示多个事务，并通过散列算法运行它们。因此，我们将每个单独的事务进行散列，然后获取这些散列，并将它们作为组进行散列。

我们正在创建的是一种数据结构，称为 Merkle 树。这是一种用哈希指针构建的二叉树，是一种非常有用的结构，用于将不同的数据分组，并使它们可以通过单个哈希引用进行访问。代表所有事务的最后一个哈希是我们的根哈希——它是我们的 Merkle 树的 Merkle 根——根哈希是包装在其中的所有事务的代表。

![](img/c9ba758801f154a5e4928c645e221126.png)

我们的*区块链*中的每个*块*都将有一个由根哈希表示的事务集合。块头是我们的块的元数据所在的地方，所以我们将把根散列放在我们的块头中，连同指示块何时被创建的时间戳，并且我们将包括被称为 *nonce* 的东西，它只是一个数字值。(我们稍后将回到这实际上代表了什么。)

现在，我们谈到了区块链是一个哈希链接的块链。块如何链接在一起是通过在每个块中包含链中前一个块的散列引用。因为块最终只是一段数据，所以我们可以通过哈希算法运行它，并获得一个代表整个块的哈希。为了将我们的块链接到链上，我们包含了前一个块的散列引用作为指向它的指针。在我们的块之后创建的下一个块将向我们的块添加一个引用指针。这就是我们如何得到一个哈希链接的块链！

![](img/cb6f9d274b009e544e8df4af681e6d29.png)

但是，我还没有真正回答我们的问题——我们如何验证这些交易记录中的任何一个都没有被更改过？如果我们再放大一秒钟，这个问题就很容易回答了。

因为我们知道，即使更改数据集中的单个字符也会完全更改其数字指纹，所以我们可以肯定，如果事务记录中的数字或名称发生更改，该事务的哈希也会完全更改。

![](img/0fcd5b57d2eb6b85f45d3c0dccfab89d.png)

当我们想到这会对我们的 Merkle 事务树产生什么影响时，我们知道它会彻底改变哈希。如果我们的根哈希不同，我们的块哈希就会改变，这会使整个块失效。如果我们的块散列发生变化，链中下一个块的引用指针就会中断，从而中断链上的所有引用。

![](img/ec239d1e7fef35e4fb64a9cbf2bae081.png)

根据历史上某人试图改变的事务最初发生的时间，它可能会破坏整个链的相当一部分。

![](img/5a06c818a3e8d7d1c6e5ab273f408665.png)

现在，即使这个恶意行为的人做了工作来改变*所有那些在 Merkle 树和块头中的被破坏的散列和引用指针，记住我们谈论的是一个计算机网络，所有的计算机都有一个链的副本。这个坏演员只能改变他们*在他们的计算机上的*的区块链的副本，这导致区块链历史与所有其余节点都验证并集体同意的链的版本不匹配。*

![](img/3e6313d8d4d0c5686bae9d63907c017b.png)

这是一种非常简单而又巧妙的方法，可以确保区块链的交易历史不会在不明显的情况下被篡改。确保区块链的一个独立版本与区块链的真实历史相匹配，就像比较两个哈希值、两个数据字符串是否相等一样简单。

## 数字签名

让我们来看看我们的第二个问题:我们如何验证交易的各方是他们所说的人，并且已经同意交易？

公钥加密是区块链的另一项核心技术，用于确保交易中的每一方都是他们所说的那个人；只有他们才是有权消费或出售其资产的合法所有者。

公钥加密使用数字密钥来保护数据。简单解释一下，每个人都有两把钥匙。一个密钥被标识为公钥，一个被标识为私钥。公钥可以与任何人共享，没有必要保证它的安全；但是私钥需要非常安全，并且需要由你单独保管。

![](img/23926721d0afcc45af92ba75028a1aab.png)

私钥可以用作加密数据的函数的输入——例如，我们的交易数据。输出(称为密文)对人和计算机来说都是不可读的。只有双公钥才能解密密文，并将其转换回可读数据。其思想是，交易中的卖方使用他们的私钥来加密交易数据，他们将得到的密文作为一种数字签名添加到交易中。

![](img/7234b3eeb77edf7c519e99e936b1e304.png)

然后，卖方的公钥被包含在交易中，买方使用该密钥来解密已签名的交易。如果解密成功，各方可以确信发起和授权交易的确实是卖方。

![](img/991384717f87d20b73c3183806d2211f.png)

每一个被广播的交易都是数字签名的，公钥——唯一能够成功解密所包含的密文签名的公钥——是交易数据的一部分。只要私钥没有被盗或泄露，这就给了我们一个非常可靠的方法来确保交易中的卖家是他们所说的那个人。

## 哈希拼图

最后，最大的信任问题——在由许多节点组成的分布式系统中，我们如何验证每个对等点是可靠的和值得信任的？

答案？ ***哈希拼图。***

集中式软件系统的一个好处是，通常有可管理数量的需要安全的节点，以及可管理数量的网络可信成员。相反，这意味着具有大量节点的分布式、分散式系统的一个缺点是，其中一些节点不可信的可能性更高。

因为分散式系统的好处首先使区块链成为一个可行的想法，所以如何在分散式系统中实现和保持信任的问题是使该技术可行所需要解决的最大问题之一。这是使用[“工作证明”](https://en.wikipedia.org/wiki/Proof-of-work_system)概念完成的。

工作证明是一个术语，指的是很难产生的一段数据(意味着它是昂贵和耗时的——从计算上来说，是一项非常繁重的任务)，但对其他人来说很容易验证。其思想是，为了使网络中的节点能够成功地产生有效的事务数据块，它们需要满足工作证明要求，然后该块才能被接受并添加到区块链历史中。并且在实践中，工作证明被实现为散列难题。

回到我们的交易——区块链协议规定，每个新创建的区块都需要满足一定的难度。难度意味着代表块的散列需要满足散列目标，它必须采用某种形式。例如，散列可能需要以一串四个零开始。

因为我们知道不可能预测输出的散列字符串，所以这个难题涉及向块数据添加一个数字，散列这个块，并通过在它的开头有一个四个零的字符串来检查结果散列是否满足目标。如果没有，这个数字将被递增并再次散列。这个过程一直重复，直到我们添加的数字——nonce——给我们一个符合哈希目标的哈希。

举个简单的例子，如果我们正在处理字符串“Hello，world！”我们给它加一个零，我们得到一个以`1312af`开始的散列。如果我们把它改成 1，它就完全不同了，如果我们把它改成 2，它又完全不同了，但还是没有 0。如果我们继续递增，直到 4250 我们才能得到一个以 4 个零(`0000c3`)开始的散列。所以，4250 是我们的随机数，基本上是这个谜题的答案。

![](img/86d72ee74a7279fc2b782c21c0d7e829.png)

如果我们回到我们的事务，这是完全相同的想法——因为我们无法*以任何方式*预测散列输出将是什么，这只是计算机的一个大猜谜游戏。找到正确随机数并解决这个难题的唯一方法是强行破解它，一个一个地测试这个数字。

这是我们的 nonce 为 0 的事务，以`BA49`开头的哈希不符合我们一开始 4 个零的哈希目标。

![](img/6e4406b93a3ccac04c2893b78cfc1078.png)

递增到 1 不行，递增到 2 也不行。

![](img/9c2d3a377ee7e4c08e6ee7f4e718adca.png)

这个想法是，要找到满足我们的散列目标的随机数需要很长时间。

![](img/b94d33734fc516df4085a5ea550d1f79.png)

这是一个计算量非常大的练习，尤其是在较高的难度水平上——它需要计算机花费大量的时间来计算，计算需要能量来为计算机提供动力，而能量耗费了计算机用户的实际金钱。

因此，工作证明概念在区块链实现中起着极其重要的作用，因为它意味着验证事务和向链中添加新块是一项计算量很大的工作。它通过消耗用户真正的精力和金钱来迫使用户“参与游戏”。如果我们还奖励首先解决难题的节点进行所有这些计算的经济激励，这将是一个非常强大的威慑，阻止节点试图改变交易或块。它有一个*理由*来遵守规则并保持系统的可信成员，这有助于加强分布式对等网络的完整性。

# 区块链在什么地方、什么时候能有所帮助？

那么，何时何地使用区块链技术进行探索是有意义的呢？让我们从提到哪里不需要**——如果你从这篇博文中只拿走一样东西，那就这样:**

> *如果关系数据库可以满足你的需求，你* ***就不需要*** *区块链了。区块链是一种用于共享数据库场景的技术，在这种场景中，您不必信任所有能够访问它的实体。*

如果你认为区块链可能是一个有趣的解决方案，但它必须是私人的，*和*可能是允许的，请认真考虑区块链是否真的是正确的解决方案。

当然，在某些领域，区块链可以提供帮助，甚至可能彻底改变现状。在交易和数字资产、健康记录、身份文档、供应链和产品生命周期、城市服务、物联网、加密货币和数字游戏(如 [CryptoKitties](https://www.cryptokitties.co/) )中，正在探索有趣的应用。

好奇区块链科技的下一步是什么吗？读一些关于区块链的书，然后再多读一些关于区块链的书，之后再多读一些。你会发现对这项新技术的看法各不相同。有人称之为互联网的第二次到来，有人称之为劣质技术，将导致一个无法无天、互不信任的世界，等等。阅读大量的观点，并决定你和你的潜在用例的位置。区块链也是一个非常深入的话题，随着你在引擎盖下探索得越深入，它会变得更加技术化。

# 有关系的

为了帮助联系这些点，这里有一些我认为非常有用的资源:

*   [区块链基础知识](http://www.blockchain-basics.com/)丹尼尔·德雷舍
*   [TED 演讲:区块链如何改变金钱和商业](https://bit.ly/2Ho8rD2)
*   [关于区块链的真相](https://hbr.org/2017/01/the-truth-about-blockchain)
*   为什么 Des [igners 需要开始思考区块链](https://www.ideo.com/blog/why-designers-need-to-start-thinking-about-blockchain-technology)

*声明:这些观点仅代表作者个人观点。除非本帖中另有说明，否则 Capital One 不属于所提及的任何公司，也不被其认可。使用或展示的所有商标和其他知识产权都是其各自所有者的所有权。本文为 Capital One 2018。*