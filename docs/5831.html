<html>
<head>
<title>Migrate PostgreSQL from AWS RDS to Oracle Cloud Infrastructure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将PostgreSQL从AWS RDS迁移到Oracle云基础架构</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/migrate-postgresql-from-aws-rds-to-oracle-cloud-infrastructure-2c5fdff50135?source=collection_archive---------0-----------------------#2021-10-28">https://medium.com/oracledevs/migrate-postgresql-from-aws-rds-to-oracle-cloud-infrastructure-2c5fdff50135?source=collection_archive---------0-----------------------#2021-10-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="e7b8" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">第1条— <strong class="ak">将PostgreSQL从AWS RDS迁移到OCI PostgreSQL </strong></h2></div><p id="9f09" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">OCI提供了一种经济高效的超大规模云，可用于构建企业应用和云原生应用。PostgreSQL是商业RDS引擎的流行开源替代方案。</p><p id="61cc" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在本文中，我们将使用pgAdmin4工具将数据库从AWS RDS PostgreSQL迁移到OCI PostgreSQL。Oracle云基础设施(OCI)目前没有针对PostgreSQL的完全托管服务，但是您可以使用<a class="ae js" href="https://github.com/oracle-quickstart/oci-postgresql" rel="noopener ugc nofollow" target="_blank"> Oracle OCI快速入门指南</a>构建高度可用的PostgreSQL堆栈</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es jt"><img src="../Images/a0e95f215dfc59b840386ad575ad8603.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XubDET_VTBDM7beH5N0iAA.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">OCI PostgreSQL</figcaption></figure><p id="672e" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">PostgreSQL的构建和部署可以通过5个简单的步骤完成。</p><p id="aaac" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iy hi">入门需要什么</strong></p><ul class=""><li id="b5b2" class="kj kk hh iy b iz ja jc jd jf kl jj km jn kn jr ko kp kq kr bi translated">AWS RDS实例，其数据库包含模式中的对象</li><li id="3e97" class="kj kk hh iy b iz ks jc kt jf ku jj kv jn kw jr ko kp kq kr bi translated">OCI帐户访问</li><li id="1b95" class="kj kk hh iy b iz ks jc kt jf ku jj kv jn kw jr ko kp kq kr bi translated">PostgreSQL平台的OCI快速入门指南</li><li id="dd30" class="kj kk hh iy b iz ks jc kt jf ku jj kv jn kw jr ko kp kq kr bi translated">在你的客户端机器上安装pgAdmin 4工具，或者作为Docker容器，连接AWS和OCI</li></ul><p id="6dcc" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iy hi">第一步:</strong></p><p id="31b5" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><a class="ae js" href="https://www.pgadmin.org/download/" rel="noopener ugc nofollow" target="_blank">在您的客户端机器上安装pgAdmin4 </a>。从PgAdmin4连接到AWS RDS实例并备份数据库。从RDS实例中复制端点以及端口号</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es kx"><img src="../Images/5f9df15e4fceaa9f58c319f90725e963.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r8l_8uDvH6UrsgsYYvR6yw.png"/></div></div></figure><p id="5159" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在我的例子中，我使用了RDS中著名的DVDRental示例数据库来测试这个迁移。DVD租赁数据库具有复杂的表映射和存储过程，非常适合测试迁移。</p><p id="f0bd" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">你可以在这里找到加载DVDrental样本数据库<a class="ae js" href="https://www.postgresqltutorial.com/postgresql-sample-database/" rel="noopener ugc nofollow" target="_blank">的步骤</a></p><p id="b040" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，让我们打开pgAdmin4，开始备份AWS RDS数据库</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es ky"><img src="../Images/c4cab715f03c60c6812a3375cc1ecccb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eY0b7ZSO8FBHppfeavTMBQ.png"/></div></div></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es kz"><img src="../Images/98e3571a820e177c16207a947022fb26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UZR5ONRVDaWqV2G3ZCnuUQ.png"/></div></div></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es la"><img src="../Images/4b8acaa9572721c4818eb8582ded97f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*05pTUbcTXwu0uIOQAaJquA.png"/></div></div></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lb"><img src="../Images/cf54341455460c1ebaa44970729ccef1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G9N_fGxInjTpthyNnKvVnA.png"/></div></div></figure><p id="c3a0" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iy hi">第二步:</strong></p><p id="05c7" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">使用pgAdmin4将RDS数据库备份到tar存档。如果您的数据库很大，最好的方法是创建S3作为文件系统，并使用pg_dump从可以访问RDS和OCI PostgreSQL实例的位置备份和恢复数据库。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lc"><img src="../Images/d140d3dc4353aa1d496bddcc2e8026d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6kQhIMiJbGVEDfQ9vu4ZNg.png"/></div></div></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es ld"><img src="../Images/5fb41006bf726323ae4cce247af7b496.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XPwnRnBnWoFxQDHQl0GhQA.png"/></div></div></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es le"><img src="../Images/0dd07e487dc5f44cd55c6f3a923c5221.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ddQ1JIDl2HIuQoyxvl4OYw.png"/></div></div></figure><p id="8792" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在从AWS RDS完成了这些步骤，我们已经生成了整个数据库DVDRental.tar的备份文件。这种方法适用于迁移停机时间可以忍受的小型数据库，但如果您有一个更大的数据库，那么pg_dump将更适合使用cdc复制工具，如PostgreSQL的Airbyte</p><p id="9939" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iy hi">使用pg_dump的示例备份脚本</strong></p><pre class="ju jv jw jx fd lf lg lh li aw lj bi"><span id="44c1" class="lk ll hh lg b fi lm ln l lo lp">#!/bin/bash<br/>hostname=`hostname`<br/># Dump DBs<br/>  date=`date +"%Y%m%d_%H%M%N"`<br/>  backupdir='/home/opc'<br/>  dbname='demo'<br/>  filename="$backupdir/${hostname}_${dbname}_${date}"<br/> pg_dump <!-- -->-h &lt;public/private dns&gt; <!-- -->-U postgres --encoding utf8 -F c -f $filename.dump $dbname</span><span id="d96a" class="lk ll hh lg b fi lq ln l lo lp">exit 0</span></pre><p id="126a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iy hi">第三步:</strong></p><p id="8c9f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">使用Github Repo<a class="ae js" href="https://github.com/oracle-quickstart/oci-postgresql" rel="noopener ugc nofollow" target="_blank">https://github.com/oracle-quickstart/oci-postgresql</a>在OCI部署PostgreSQL</p><p id="593e" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">单击“部署到Oracle云”并使用您的租赁和帐户详细信息登录</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lr"><img src="../Images/8dfe5a704903f6b325f3b6fd741b95d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BQWjGaIe6CWb-64uJ_X_tA.png"/></div></div></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es ls"><img src="../Images/403fc65cf82a453ac150d030f0428ad0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f3Xa_jxvy0idsfjgw9vsXw.png"/></div></div></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lt"><img src="../Images/4b5f727c19cb1ac081231d8eb23ea660.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dYHWqmvBUEiylfoDiFF7ew.png"/></div></div></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lu"><img src="../Images/d94242dab69bc753f5e4978a23f4317e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_ijeY9-wtBxRkWiojeROKA.png"/></div></div></figure><p id="97ea" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这将为HA在三个不同的容错域中提供一个VCN +Bastion主机服务+ PostgreSQL Master和2个备用实例的堆栈</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lv"><img src="../Images/a0fc4f0c02a4a3f7a0bab2a287e675a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vYStfQiqYp1Q-oJiaBtFuA.png"/></div></div></figure><p id="7504" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iy hi">第四步:</strong></p><p id="26d9" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为远程连接配置OCI上的PostgreSQL实例</p><p id="4591" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">通过作为OCI快速入门堆栈的一部分创建的堡垒主机服务登录到PostgreSQL实例</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lw"><img src="../Images/ff0084f44f508fffef7c18804ebc155c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BQF_zoRaJjFKW5-Pxt30Kw.png"/></div></div></figure><p id="e2a1" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">创建一个新的托管SSH会话，或者使用映射到您在配置堆栈时使用的公钥的私钥对中的现有会话。登录到PostgreSQL主实例</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lx"><img src="../Images/f2d589c81cba6486253fe559e55a2b09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YPLOCyn23FSl08ocnnuIKw.png"/></div></div></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es ly"><img src="../Images/42ba9417de436eec8076985eae5beee9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i_F5T6pMfjSCITRXW5-ftw.png"/></div></div></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lz"><img src="../Images/4c221fd1f5df88542c156b54011fb10a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AS0sAKHGRmtBuEpGYO2pvA.png"/></div></div></figure><p id="29e0" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">登录到实例并检查PostgreSQL服务</p><pre class="ju jv jw jx fd lf lg lh li aw lj bi"><span id="99ae" class="lk ll hh lg b fi lm ln l lo lp">sudo systemctl restart postgresql-13.service<br/>sudo systemctl list-units | grep postgres</span></pre><p id="b374" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在防火墙-cmd中添加tcp端口5432</p><pre class="ju jv jw jx fd lf lg lh li aw lj bi"><span id="979f" class="lk ll hh lg b fi lm ln l lo lp">sudo firewall-cmd --zone=public --permanent --add-port=5432/tcp<br/>sudo firewall-cmd --reload<br/>sudo firewall-cmd --list-ports</span></pre><p id="3044" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">更改监听地址</p><pre class="ju jv jw jx fd lf lg lh li aw lj bi"><span id="d959" class="lk ll hh lg b fi lm ln l lo lp">sudo su postgres</span><span id="ac76" class="lk ll hh lg b fi lq ln l lo lp">cd</span><span id="7f42" class="lk ll hh lg b fi lq ln l lo lp">find / -name “postgresql.conf”</span><span id="82ed" class="lk ll hh lg b fi lq ln l lo lp">vi /data/pgsql/postgresql.conf</span></pre><p id="b67c" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">—添加此行，保存并退出</p><pre class="ju jv jw jx fd lf lg lh li aw lj bi"><span id="b9bf" class="lk ll hh lg b fi lm ln l lo lp">listen_addresses = ‘*’</span></pre><p id="e57f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">检查服务器是否正在监听端口</p><pre class="ju jv jw jx fd lf lg lh li aw lj bi"><span id="2be3" class="lk ll hh lg b fi lm ln l lo lp">netstat -tldpn</span><span id="7c8b" class="lk ll hh lg b fi lq ln l lo lp">Active Internet connections (only servers)<br/>Proto Recv-Q Send-Q Local Address Foreign Address State PID/Program name<br/>tcp 0 0 0.0.0.0:5432 0.0.0.0:* LISTEN</span></pre><p id="4b03" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">允许所有主机连接</p><pre class="ju jv jw jx fd lf lg lh li aw lj bi"><span id="22a5" class="lk ll hh lg b fi lm ln l lo lp">find / -name “pg_hba.conf”</span><span id="4fe2" class="lk ll hh lg b fi lq ln l lo lp">vi /data/pgsql/pg_hba.conf</span></pre><p id="76bd" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">—在文件末尾添加这两行，保存并退出(确保每列之间有空格，否则会导致PostgreSQL服务无法运行)</p><pre class="ju jv jw jx fd lf lg lh li aw lj bi"><span id="d7a1" class="lk ll hh lg b fi lm ln l lo lp">host      all     all     0.0.0.0/0     md5<br/>host      all     all     ::/0          md5</span></pre><p id="9334" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">—使用opc os用户重新启动Postgres服务</p><pre class="ju jv jw jx fd lf lg lh li aw lj bi"><span id="36a4" class="lk ll hh lg b fi lm ln l lo lp">sudo systemctl restart postgresql-13.service<br/>sudo systemctl list-units | grep postgres</span></pre><p id="52a9" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">更改超级用户密码</p><pre class="ju jv jw jx fd lf lg lh li aw lj bi"><span id="d817" class="lk ll hh lg b fi lm ln l lo lp">sudo su postgres<br/>cd<br/>psql -h localhost<br/>postgres=# ALTER USER postgres WITH PASSWORD ‘P@ssword31344$#’;</span></pre><p id="5f92" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">将端口5432作为入口规则添加到子网或NSG的安全列表中，现在您可以远程连接到OCI PostgreSQL实例</p><p id="bb8c" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iy hi">第五步:</strong></p><p id="e619" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">从pgAdmin4连接到OCI PostgreSQL实例，并将tar备份文件恢复到新的OCI PostgreSQL实例</p><p id="357b" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为OCI堡垒服务的端口5432创建端口转发会话</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es ma"><img src="../Images/8970eb8bc8fa8f72ddccad5c29c7da78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8v1l0b5O_exSRGSSUJFJOw.png"/></div></div></figure><p id="33f9" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">打开SSH隧道</p><pre class="ju jv jw jx fd lf lg lh li aw lj bi"><span id="9b0b" class="lk ll hh lg b fi lm ln l lo lp">ssh -i mydemo_vcn.priv -N -L 5432:10.1.20.207:5432 -p 22 <a class="ae js" href="mailto:ocid1.bastionsession.oc1.iad.amaaaaaaqcins5ya37hkgsd2uhtjsxx2kelarznlkvtqhspt7i5i2hiipqya@host.bastion.us-ashburn-1.oci.oraclecloud.com" rel="noopener ugc nofollow" target="_blank">ocid1.bastionsession.oc1.iad.amaaaaaaqc***********pqya@host.bastion.us-ashburn-1.oci.oraclecloud.com</a></span></pre><p id="e2ff" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">登录到pgAdmin4，并使用我们之前设置的用户名“postgres”和密码将主机名用作本地主机</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mb"><img src="../Images/b1c29b4a0490a4b48cc3cd54939e0426.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2SjEOA07FedHAmk20usHPg.png"/></div></div></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mc"><img src="../Images/09643b0be03aeaeb830f029a95e9086f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qd9uBp4qEkOtuLuvnntoTA.png"/></div></div></figure><p id="5169" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">恢复。tar文件，包含RDS中的示例数据库备份，首先创建一个占位符数据库</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es md"><img src="../Images/5fd5cea969cc77beac1b7d4420060867.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mYe9a0BOGhMmy4bzg7N2Zw.png"/></div></div></figure><p id="c75b" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">恢复文件。确保选择恢复选项&gt;不保存权限= "是"</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es me"><img src="../Images/df8308dedb5e5bc54f91ce2b7a97ed54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f_1Oi2DWobfwNzNHTkcvmA.png"/></div></div></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mf"><img src="../Images/1564384f23bfb13b26c6d2f9cd675512.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6Hn3LR7mmxf2kLdtNP9xSg.png"/></div></div></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mg"><img src="../Images/dee8cc991498727ae71d36c6722432a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qQJzQoH8CfQnLN79XlrrFw.png"/></div></div></figure><p id="0580" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在让我们在OCI的DVDRental数据库中检查对象</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mh"><img src="../Images/f848f03e86ff704efd9ee5ddc1dc1786.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NivD-KHSjLaETxuHwXJjnQ.png"/></div></div></figure><p id="8dc2" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们现在可以看到，所有对象都已经从RDS实例导入到OCI PostgreSQL数据库中。</p><p id="532a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果您有一个大型数据库，那么您可以使用pg_restore而不是GUI进行恢复。</p><p id="f58d" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iy hi">使用pg_restore的示例恢复脚本</strong></p><pre class="ju jv jw jx fd lf lg lh li aw lj bi"><span id="7237" class="lk ll hh lg b fi lm ln l lo lp">#!/bin/bash<br/># Restore DB<br/>dbname='demo'<br/>filename='/home/opc/demo.dump'<br/>  #pg_restore -U postgres -d $dbname -c &lt; ./$1<br/>  pg_restore -U postgres -d $dbname -c &lt; $filename<br/>exit 0</span></pre><h2 id="e7fe" class="lk ll hh bd mi mj mk ml mm mn mo mp mq jf mr ms mt jj mu mv mw jn mx my mz na bi translated"><strong class="ak">总结</strong></h2><p id="09e1" class="pw-post-body-paragraph iw ix hh iy b iz nb ii jb jc nc il je jf nd jh ji jj ne jl jm jn nf jp jq jr ha bi translated">我们可以看到使用OCI资源管理器在OCI上构建一个完全生产级PostgreSQL服务器是多么容易。可以通过任何标准PostgreSQL工具将AWS RDS PostgreSQL迁移到OCI PostgreSQL。这个想法是为了展示PostgreSQL的强大功能和灵活性，它能够在任何平台上运行，而不会局限于AWS RDS这样的完全托管的服务。</p><h2 id="f79f" class="lk ll hh bd mi mj mk ml mm mn mo mp mq jf mr ms mt jj mu mv mw jn mx my mz na bi translated"><strong class="ak">接下来会发生什么</strong></h2><p id="f02a" class="pw-post-body-paragraph iw ix hh iy b iz nb ii jb jc nc il je jf nd jh ji jj ne jl jm jn nf jp jq jr ha bi translated">这是一系列关于OCI的PostgreSQL的文章。请继续关注此空间，了解更多信息:)即将推出..</p><ol class=""><li id="a930" class="kj kk hh iy b iz ja jc jd jf kl jj km jn kn jr ng kp kq kr bi translated">将OCI PostgreSQL实例备份到Oracle的对象存储中</li><li id="d9cd" class="kj kk hh iy b iz ks jc kt jf ku jj kv jn kw jr ng kp kq kr bi translated">修补您的OCI PostgreSQL实例</li><li id="8f2e" class="kj kk hh iy b iz ks jc kt jf ku jj kv jn kw jr ng kp kq kr bi translated">不要Kubernetize您的PostgreSQL。不是一个帖子，只是一个非常重要的提示；)</li></ol><h2 id="5b39" class="lk ll hh bd mi mj mk ml mm mn mo mp mq jf mr ms mt jj mu mv mw jn mx my mz na bi translated">参考</h2><p id="e0f3" class="pw-post-body-paragraph iw ix hh iy b iz nb ii jb jc nc il je jf nd jh ji jj ne jl jm jn nf jp jq jr ha bi translated">[1]<a class="ae js" href="https://docs.oracle.com/en/solutions/deploy-postgresql-db/index.html" rel="noopener ugc nofollow" target="_blank">https://docs . Oracle . com/en/solutions/deploy-PostgreSQL-db/index . html</a></p><p id="d0ea" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">[2]<a class="ae js" href="https://github.com/oracle-quickstart/oci-postgresql/" rel="noopener ugc nofollow" target="_blank">https://github.com/oracle-quickstart/oci-postgresql/</a></p><p id="04f4" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">[3]https://www.pgadmin.org/download/<a class="ae js" href="https://www.pgadmin.org/download/" rel="noopener ugc nofollow" target="_blank"/></p><p id="bfc8" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">[4]https://www.postgresqltutorial.com/<a class="ae js" href="https://www.postgresqltutorial.com/" rel="noopener ugc nofollow" target="_blank"/></p></div></div>    
</body>
</html>