<html>
<head>
<title>Using Squid Proxy Service on Oracle Cloud Infrastructure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Oracle云基础设施上使用Squid代理服务</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/using-a-proxy-service-on-bare-metal-cloud-services-8deda5dcfc7e?source=collection_archive---------0-----------------------#2017-07-07">https://medium.com/oracledevs/using-a-proxy-service-on-bare-metal-cloud-services-8deda5dcfc7e?source=collection_archive---------0-----------------------#2017-07-07</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="cda0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当供应没有公共IP地址的云实例(或者是一个<a class="ae jc" href="https://www.oracle.com/cloud/compute/virtual-machines/what-is-virtual-machine/" rel="noopener ugc nofollow" target="_blank">虚拟机</a>或者是裸机形状)时，它将无法与外部通信，因此您将需要一个堡垒服务器来登录它，并且需要一个代理服务器来访问互联网或获取更新，例如，因此每个实例(需要互联网访问)都应该配置有代理服务器的详细信息。</p><p id="0844" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">代理服务的一个可能选项是Squid，本教程解释了它在Oracle云基础设施(OCI)上的部署步骤。</p><h1 id="2858" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">鱿鱼是什么？</h1><p id="61e4" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated"><a class="ae jc" href="http://www.squid-cache.org/" rel="noopener ugc nofollow" target="_blank"> Squid </a>是一个Web缓存代理，支持HTTP、HTTPS、FTP等等。它通过缓存和重用频繁请求的网页来减少带宽和提高响应时间，它有广泛的访问控制，是一个很好的服务器加速器。</p><p id="0b40" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">它可以在大多数可用的操作系统上运行，包括Windows，并在GNU GPL下获得许可。</p><h1 id="1219" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">入门指南</h1><p id="a636" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">本教程基于<a class="ae jc" href="http://broexperts.com/how-to-configure-squid-3-x-as-transparent-proxy-on-centos-7-rhel-7/" rel="noopener ugc nofollow" target="_blank">“如何在CentOS 7 / RHEL 7上配置Squid 3.x作为代理”</a>的文章，并对其进行了修改，以使其与OCI兼容</p><h1 id="bed1" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">环境</h1><p id="2237" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">这是本教程中Squid配置的一个例子</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/4100d3c157204e97b1ff6db8bfdd1e16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*J2xPu32CxzaGnrYd.png"/></div></div></figure><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ks"><img src="../Images/15450010f0bee4b35d955662ede2a28f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B3GJYE0RBJZgl1tB50Z8nw.png"/></div></div></figure><p id="7e6f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果没有代理配置，虚拟客户端网络(VM)客户端VM就无法与外部通信，因此下面是一个在没有代理服务器的情况下尝试使用“yum”的示例:</p><p id="e48e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要修复上面的“网络不可达”错误信息，你需要一个代理服务器，下面是你如何配置它。</p><h1 id="c05a" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">Squid服务器安装</h1><p id="f954" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">运行以下命令安装squid软件包:</p><p id="47fc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ sudo yum安装squid -y</p><p id="575d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">编辑squid配置文件。在编辑默认配置文件之前，强烈建议创建一个备份</p><p id="abc2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ sudo CP/etc/squid/squid . conf/etc/squid/squid . conf . bk</p><p id="b25b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">打开配置文件并添加下面提到的参数</p><p id="9567" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ sudo vi /etc/squid/squid.conf</p><p id="928b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">添加代理设置并添加以下选项，以允许“我们的网络”通过代理进行通信。确保您更改了以下网络(即:与您当前的VCN网络掩码相匹配。</p><p id="8e78" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">#允许局域网</p><p id="0509" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">acl我们的网络src 172.0.0.0/255.255.255.0</p><p id="7dce" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">#允许网络ACL允许/拒绝部分#</p><p id="8f66" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">http_access允许我们网络</p><p id="a227" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">#代理参数</p><p id="99a7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">http_port 3128</p><p id="1d05" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">visible _主机名squid</p><p id="1f8f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">保存并退出。</p><p id="a494" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在启动squid服务，并确保它在启动时被添加。</p><p id="4840" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ sudo systemctl启动squid</p><p id="83d2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ sudo systemctl启用squid</p><p id="ce5b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用firewall-cmd工具在OL/RHEL7/CentOS7防火墙中添加端口重定向和伪装规则。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kt"><img src="../Images/0ac91f3bbdafd229f2b11ff115d2c163.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_wFB4Bfy20EnmS7gb0lUNw.png"/></div></div></figure><p id="07d4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，您需要更新裸机VCN安全列表，以允许内部使用端口3128，有两种方法可以做到这一点。</p><p id="151d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第一个是只开放端口3128到本地网络，如下图所示，通过OCI VCN仪表板</p><p id="5702" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">资料来源:172.0.0.0/16</p><p id="4a8c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">IP协议:TCP</p><p id="e144" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">源端口范围:所有</p><p id="7d03" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">目标端口范围:3128</p><p id="40a8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">允许:端口的TCP流量:3128</p><p id="6189" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您也可以只向内部网络开放所有端口！</p><p id="2c6f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">资料来源:172.0.0.0/16</p><p id="d96f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">IP协议:所有协议</p><p id="e66d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">允许:所有端口的所有流量</p><p id="290b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">注意:</strong>确保您使用的是内部网络IP范围，而不是公共互联网IP范围。</p><p id="0a9f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下一步是将您的裸机VCN虚拟机指向您的Squid服务器。</p><h1 id="6fab" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">Squid客户端配置</h1><h1 id="0d53" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">Linux代理客户端</h1><p id="3586" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">根据您当前使用的操作系统和您想要提供的公共访问，有不同的方法可以实现这一点。</p><p id="8917" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">例如，您可以通过终端配置裸机实例代理设置，如下所示，这应该适用于所有应用程序。以下过程基于<a class="ae jc" href="https://www.server-world.info/en/note?os=CentOS_7&amp;p=squid&amp;f=2" rel="noopener ugc nofollow" target="_blank">代理客户端文章</a>。</p><p id="1342" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ sudo vi /etc/profile</p><p id="4d82" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">#在末尾加上这几行。将代理设置设置为环境变量</p><p id="3e35" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我的_ PROXY _ URL = "【http://squid.publicsubnetad1.baremetal.oraclevcn.com:3128/】T4</p><p id="de8a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">HTTP_PROXY=$MY_PROXY_URL</p><p id="8d10" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">HTTPS代理= $我的代理网址</p><p id="676e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">FTP_PROXY=$MY_PROXY_URL</p><p id="2991" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">http_proxy=$MY_PROXY_URL</p><p id="5c19" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">https_proxy=$MY_PROXY_URL</p><p id="09be" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ftp_proxy=$MY_PROXY_URL</p><p id="cef7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">导出HTTP _代理https _代理FTP _代理HTTP _代理https _代理FTP _代理</p><p id="e25b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">$ source /etc/profile</p><p id="38be" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您愿意，您可以更具体地指定允许哪些应用程序进行外部通信。</p><h1 id="bc1d" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">妙的</h1><p id="92e4" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">$ sudo vi /etc/yum.conf</p><p id="4c85" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">#设置代理设置</p><p id="a0ec" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">代理=<a class="ae jc" href="http://squid.publicsubnetad1.baremetal.oraclevcn.com:3128/" rel="noopener ugc nofollow" target="_blank">http://squid.publicsubnetad1.baremetal.oraclevcn.com:3128</a></p><h1 id="3403" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">WGET</h1><p id="efa7" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">$ sudo vi /etc/wgetrc</p><p id="ab3c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">http://squid.publicsubnetad1.baremetal.oraclevcn.com:3128/</p><p id="343e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">http://squid.publicsubnetad1.baremetal.oraclevcn.com:3128/</p><p id="527b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">http://squid.publicsubnetad1.baremetal.oraclevcn.com:3128/</p><h1 id="4498" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">Windows代理客户端</h1><p id="b117" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">在Firefox上，点击[编辑]—[首选项]，进入[高级]—[网络]选项卡，点击[设置]按钮。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ku"><img src="../Images/17a9d01c894331189fba847b9f7f3935.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*t54Znjbhn0Hqdpym.png"/></div></div></figure><p id="cfc3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">选中“手动代理配置”框，输入您的代理服务器的主机名或IP地址。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es kv"><img src="../Images/baa691ae58f0db008510b080080baa5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/format:webp/0*sqgmjwzL5yRpeSVK.png"/></div></figure><p id="71d5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上述过程也可以在谷歌Chrome、MS Internet Explorer等浏览器上完成。</p><h1 id="f052" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">测试您的代理配置</h1><p id="30bd" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">在Squid代理服务器和客户机配置完成之后，您应该可以正常使用您的应用程序了。</p><p id="d74f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当重新运行“yum install ksh”命令时，您可以看到“网络不可达”问题现已修复。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kw"><img src="../Images/5d6344c317766423b5b6a24a44f67a16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yYshU0KeMxJJuPUn1FqzqQ.png"/></div></div></figure></div></div>    
</body>
</html>