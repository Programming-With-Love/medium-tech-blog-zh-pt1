<html>
<head>
<title>The new way to call Mendix microflows from Java actions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Java动作调用Mendix微流的新方法</h1>
<blockquote>原文：<a href="https://medium.com/mendix/the-new-way-to-call-mendix-microflows-from-java-actions-46152923dbbc?source=collection_archive---------0-----------------------#2020-03-03">https://medium.com/mendix/the-new-way-to-call-mendix-microflows-from-java-actions-46152923dbbc?source=collection_archive---------0-----------------------#2020-03-03</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/6a63e901eee3186f9a9902cec9814dab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0_npHYQFAgOYOU9E9U0wbw.png"/></div></div></figure><p id="8449" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">Mendix 8.7刚刚发布，随之而来的是一种在Java动作中调用微流的新方法。</p><p id="b76e" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">添加了一组新的流畅的Java动作来替换内核中旧的<a class="ae jz" href="https://apidocs.mendix.com/8/runtime/com/mendix/core/Core.html#execute(com.mendix.systemwideinterfaces.core.IContext,java.lang.String,boolean,java.util.Map)" rel="noopener ugc nofollow" target="_blank">执行方法</a>。我们现在使用<a class="ae jz" href="https://apidocs.mendix.com/8/runtime/com/mendix/core/Core.html#microflowCall(java.lang.String)" rel="noopener ugc nofollow" target="_blank">微流调用</a>来调用微流，以及相关的inTransaction、withParam、withParams和execute方法。这些构成了新的<a class="ae jz" href="https://apidocs.mendix.com/8/runtime/com/mendix/core/actionmanagement/MicroflowCallBuilder.html" rel="noopener ugc nofollow" target="_blank">微流调用生成器</a>界面的一部分。</p><h1 id="10f0" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">让我们来看几个实际的例子。</h1><p id="1d74" class="pw-post-body-paragraph jc jd hu bd b je ky jg jh ji kz jk jl jm la jo jp jq lb js jt ju lc jw jx jy hn dt translated">首先，我们需要构建一个供Java操作调用的微流。在这种情况下，微流将接受两个参数，一个名为Name的字符串和一个名为MessageCount的Integer/Long。微流中有一个活动，只说“您好，您有MessageCount条消息。”。微流参数中的Name和MessageCount被替换。我们会保存它SUB_ShowMessageCount。</p><figure class="le lf lg lh fq iv fe ff paragraph-image"><div class="fe ff ld"><img src="../Images/9f3d1498e1a7368719971387f05571fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*XGz2rTqrEnqdDoDc2IN__Q.png"/></div></figure><p id="ef0f" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">我们的第一个Java动作将在调用微流时使用withParam选项。首先，我们创建Java动作。当我们“为Eclipse部署”时，这将创建一个存根Java操作供我们填充。在这种情况下，我们想告诉Donald他有1234条消息。</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="9789" class="ln kb hu lj b fv lo lp l lq lr">// BEGIN USER CODE</span><span id="fda3" class="ln kb hu lj b fv ls lp l lq lr">com.mendix.core.Core.microflowCall("TestCallingJava.SUB_ShowMessageCount")</span><span id="efc8" class="ln kb hu lj b fv ls lp l lq lr">.inTransaction(true)</span><span id="105a" class="ln kb hu lj b fv ls lp l lq lr">.withParam("Name", "Donald")</span><span id="5c38" class="ln kb hu lj b fv ls lp l lq lr">.withParam("MessageCount", "1234")</span><span id="f43c" class="ln kb hu lj b fv ls lp l lq lr">.execute(this.getContext());</span><span id="e6a6" class="ln kb hu lj b fv ls lp l lq lr">return null;</span><span id="f6ab" class="ln kb hu lj b fv ls lp l lq lr">// END USER CODE</span></pre><p id="71f2" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">如果我们调用这个Java动作，我们调用TestCallingJava模块中的SUB_ShowMessageCount微流。我们说我们希望它出现在事务中，我们也传递Name和MessageCount参数和值，然后最终在当前上下文中执行它。这将给我们以下信息。</p><figure class="le lf lg lh fq iv fe ff paragraph-image"><div class="fe ff lt"><img src="../Images/64894ec2f096e238620cb1da7509235e.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*q2hoF84olyFZbB4pTRDs2A.png"/></div><figcaption class="lu lv fg fe ff lw lx bd b be z ek">Donald sees this message.</figcaption></figure><p id="178c" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">如果我们不想使用多个withParam方法，我们可以构建一个键值的Java <a class="ae jz" href="https://docs.oracle.com/javase/8/docs/api/java/util/Map.html" rel="noopener ugc nofollow" target="_blank">映射</a>，并使用withParams方法传递它。要调用同一个示例，但是要告诉Boris他有3条消息，我们可以使用下面的Java代码。</p><pre class="le lf lg lh fq li lj lk ll aw lm dt"><span id="1033" class="ln kb hu lj b fv lo lp l lq lr">// BEGIN USER CODE</span><span id="cc95" class="ln kb hu lj b fv ls lp l lq lr">java.util.Map&lt;String, Object&gt; params = new java.util.HashMap&lt;&gt;();</span><span id="ea33" class="ln kb hu lj b fv ls lp l lq lr">params.put("Name", "Boris");</span><span id="5b1c" class="ln kb hu lj b fv ls lp l lq lr">params.put("MessageCount", 3);</span><span id="459f" class="ln kb hu lj b fv ls lp l lq lr">com.mendix.core.Core.microflowCall("TestCallingJava.SUB_ShowMessageCount")</span><span id="ac47" class="ln kb hu lj b fv ls lp l lq lr">.inTransaction(true)</span><span id="6e71" class="ln kb hu lj b fv ls lp l lq lr">.withParams(params)</span><span id="7b78" class="ln kb hu lj b fv ls lp l lq lr">.execute(this.getContext());</span><span id="4162" class="ln kb hu lj b fv ls lp l lq lr">return null;</span><span id="cc92" class="ln kb hu lj b fv ls lp l lq lr">// END USER CODE</span></pre><p id="8b95" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">这看起来非常类似于我们之前的例子，但是在开始，我们构建了一个键值的HashMap<a class="ae jz" href="https://docs.oracle.com/javase/8/docs/api/java/util/HashMap.html" rel="noopener ugc nofollow" target="_blank">来使用withParams传递。运行这个程序，我们会在屏幕上看到以下消息。</a></p><figure class="le lf lg lh fq iv fe ff paragraph-image"><div class="fe ff ly"><img src="../Images/83ba88a75e0c199d976deae689cca8dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/1*yzJGs4TwEZQWqzxHrYXnKg.png"/></div><figcaption class="lu lv fg fe ff lw lx bd b be z ek">Boris sees this message.</figcaption></figure><h1 id="4393" class="ka kb hu bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx dt translated">概括起来</h1><p id="571f" class="pw-post-body-paragraph jc jd hu bd b je ky jg jh ji kz jk jl jm la jo jp jq lb js jt ju lc jw jx jy hn dt translated">我希望这已经给出了关于从Java动作调用Mendix微流的有用概述。Mendix在这里所做的更改让人感觉更加容易和清晰，这应该会带来更好的代码可维护性。现在…去做吧！</p></div></div>    
</body>
</html>