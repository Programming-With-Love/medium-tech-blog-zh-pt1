<html>
<head>
<title>Integrating Siri Shortcuts using Custom Intent and Interface in iOS 14</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在iOS 14中使用自定义意图和界面集成Siri快捷方式</h1>
<blockquote>原文：<a href="https://medium.com/globant/integrating-siri-shortcuts-using-custom-intent-and-interface-in-ios-14-d3a84a933103?source=collection_archive---------0-----------------------#2020-12-07">https://medium.com/globant/integrating-siri-shortcuts-using-custom-intent-and-interface-in-ios-14-d3a84a933103?source=collection_archive---------0-----------------------#2020-12-07</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/4f6ec6d09e70ca86d8cbf76a957c22db.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/1*yUcDI3z52StodvAwgAKpYg.gif"/></div><figcaption class="il im et er es in io bd b be z dx">Handling Siri shortcuts — iOS 14.2</figcaption></figure><p id="f7cd" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">快捷方式允许用户从Spotlight搜索、锁屏和Siri手表界面访问应用程序的功能。可以使用快捷方式应用程序自动执行例行程序。快捷方式可让您通过提供应用程序操作的快捷方式，将应用程序的主要功能展示给Siri。</p><p id="c934" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在本文中，我们将创建自定义意图，并为iOS添加意图和IntentsUI扩展。我们将为Siri响应定制用户界面。</p></div><div class="ab cl jn jo go jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ha hb hc hd he"><h1 id="355b" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">创建快捷方式的步骤</h1><ol class=""><li id="91b3" class="ks kt hh ir b is ku iw kv ja kw je kx ji ky jm kz la lb lc bi translated"><strong class="ir hi">定义快捷方式:</strong>定义应用程序中的哪些功能将被公开，以便Siri了解应用程序中的功能。</li><li id="4d51" class="ks kt hh ir b is ld iw le ja lf je lg ji lh jm kz la lb lc bi translated"><strong class="ir hi">捐赠快捷方式:</strong>这有助于Siri理解何时建议特定的快捷方式。当执行特定操作时，为应用程序中的特定功能提供快捷方式。</li><li id="691b" class="ks kt hh ir b is ld iw le ja lf je lg ji lh jm kz la lb lc bi translated"><strong class="ir hi">处理快捷方式:</strong>实现/定义快捷方式的处理。</li></ol><p id="d44b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">让我们看看如何在演示项目中实现这些步骤。</p><p id="d098" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">首先，创建一个包含框架和应用目标的项目。所有共享代码，如意图定义文件、符合意图处理协议的类、数据管理器等，都可以添加到共享框架中。</p><p id="45be" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要在应用程序中添加对快捷方式的支持，应该启用Siri功能。对于包含Intents应用程序扩展的iOS或watchOS应用程序，App Store需要此权限来处理除快捷方式请求之外的任何Siri请求。</p></div><div class="ab cl jn jo go jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ha hb hc hd he"><h1 id="1378" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">定义快捷方式</h1><p id="4036" class="pw-post-body-paragraph ip iq hh ir b is ku iu iv iw kv iy iz ja li jc jd je lj jg jh ji lk jk jl jm ha bi translated">意图可用于提供关于可在应用中执行的动作的细节。如果除了可用的系统意图之外，还要提供定制的功能，我们可以创建定制的意图。我们将从创建意图定义文件开始。</p><p id="c050" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">创建新文件并选择以下模板:</p><figure class="lm ln lo lp fd ii er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es ll"><img src="../Images/61b9e77519740499684adfe8c9e99411.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hKdo7na_InYFUWhR3jplYA.png"/></div></div><figcaption class="il im et er es in io bd b be z dx">Create an Intent Definition file</figcaption></figure><ul class=""><li id="eeee" class="ks kt hh ir b is it iw ix ja lu je lv ji lw jm lx la lb lc bi translated">单击下面的“+”符号，在意图定义文件中添加自定义意图。使用动词名词惯例来命名你的意图。</li><li id="7aa9" class="ks kt hh ir b is ld iw le ja lf je lg ji lh jm lx la lb lc bi translated">意图类别应该与处理程序提供的功能相匹配。这将定义在处理意图时作为响应显示的默认Siri对话框。</li><li id="16ea" class="ks kt hh ir b is ld iw le ja lf je lg ji lh jm lx la lb lc bi translated">通过单击参数字段中的加号按钮创建一个新参数。可以为传递参数创建自定义类型。可以为每个参数解析结果定制Siri对话框。</li></ul><figure class="lm ln lo lp fd ii er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es ly"><img src="../Images/d4f6b4d8772a369bc69f35e827788c75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*39Qsty-6SLXwWqtMN9AFHA.png"/></div></div></figure><ul class=""><li id="abe6" class="ks kt hh ir b is it iw ix ja lu je lv ji lw jm lx la lb lc bi translated">可以从以下部分设置自定义响应消息。意向反应是意向行动的结果。在<em class="lz">响应模板</em>中定义成功和失败响应。可以添加属性来将数据传递到Siri对话框或快捷方式输出中。在HomePod、CarPlay和AirPods上只使用语音对话。</li></ul><figure class="lm ln lo lp fd ii er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es ly"><img src="../Images/97c617b2f1008bfd12ab14d2c99df7de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fj__IkXubGnySKWMb89TCA.png"/></div></div></figure><p id="2af4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Xcode自动为自定义意图创建以下响应代码:<em class="lz">未指定、就绪、继续应用、进行中、成功、失败和失败请求鼓掌</em>。</p><p id="aa2e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">既然我们已经为定制意图和响应消息定义了所有必需的细节，让我们理解创建快捷方式的下一步。</p></div><div class="ab cl jn jo go jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ha hb hc hd he"><h1 id="acfd" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated"><strong class="ak">捐赠快捷方式</strong></h1><p id="5f40" class="pw-post-body-paragraph ip iq hh ir b is ku iu iv iw kv iy iz ja li jc jd je lj jg jh ji lk jk jl jm ha bi translated">Siri通过您的应用程序向Siri捐款来了解您的应用程序可用的快捷方式。然后，可以在Spotlight搜索、锁屏和Siri手表界面中向用户建议这些快捷方式。</p><ul class=""><li id="2ab6" class="ks kt hh ir b is it iw ix ja lu je lv ji lw jm lx la lb lc bi translated">可以在交互中使用<strong class="ir hi">类型的交互对象来提供快捷方式。意图对象可以被设置为交互对象。</strong></li><li id="169d" class="ks kt hh ir b is ld iw le ja lf je lg ji lh jm lx la lb lc bi translated">使用INIntent的<strong class="ir hi">suggestedInvocationPhrase</strong>属性，我们可以为短语提供默认值。使用以下代码片段，可以通过交互来提供快捷方式:</li></ul><figure class="lm ln lo lp fd ii"><div class="bz dy l di"><div class="ma mb l"/></div></figure><ul class=""><li id="288f" class="ks kt hh ir b is it iw ix ja lu je lv ji lw jm lx la lb lc bi translated">我们可以提供功能，使用户能够使用协议<strong class="ir hi">INUIAddVoiceShortcutButtonDelegate、INUIEditVoiceShortcutViewControllerDelegate</strong>和<strong class="ir hi">INUIAddVoiceShortcutViewControllerDelegate</strong>从应用程序本身添加/编辑/删除快捷方式。</li><li id="06f6" class="ks kt hh ir b is ld iw le ja lf je lg ji lh jm lx la lb lc bi translated">从IntentsUI添加<strong class="ir hi">inuiaddvoiceshortcut button</strong>并将delegate设置为ShortcutsManager的对象。</li></ul><figure class="lm ln lo lp fd ii"><div class="bz dy l di"><div class="ma mb l"/></div></figure><figure class="lm ln lo lp fd ii er es paragraph-image"><div class="er es ie"><img src="../Images/16aee21b01e53b39b0f5d43ce29491bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/1*l8vf_3iNcShk_lImxRqv6A.gif"/></div><figcaption class="il im et er es in io bd b be z dx">Add Shortcut from the app</figcaption></figure><figure class="lm ln lo lp fd ii er es paragraph-image"><div class="er es ie"><img src="../Images/e50e0ce1193af1debeebdd46c9fc6bce.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/1*82Dldl0x9Odk-hWhc-feVA.gif"/></div><figcaption class="il im et er es in io bd b be z dx">Delete shortcut from the app</figcaption></figure></div><div class="ab cl jn jo go jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ha hb hc hd he"><h1 id="d1f1" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">处理快捷方式</h1><p id="5de5" class="pw-post-body-paragraph ip iq hh ir b is ku iu iv iw kv iy iz ja li jc jd je lj jg jh ji lk jk jl jm ha bi translated">添加intents应用程序扩展。选择“文件”&gt;“新建”&gt;“目标”,然后从iOS的“应用程序扩展”组中选择“意图扩展”。</p><p id="571e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在项目编辑器的扩展或UI扩展目标的支持的意图部分添加扩展支持的意图。这将在Info.plist中为适当的目标添加意图。选择意图所需的适当身份验证。该值应该与在意图定义文件中为特定意图指定的身份验证相同。</p><p id="5011" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">SiriKit使用您的分机的Info.plist文件中的信息来确定将哪些意图路由到您的分机。</p><p id="a64f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">当收到用户请求时，SiriKit会加载intents应用程序扩展，并创建一个<strong class="ir hi"> INExtension </strong>子类的对象。扩展返回意图的处理程序。</p><p id="ea39" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">对于每个意图对象，创建一个意图处理协议。</p><p id="78b2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">将意图定义文件添加到将访问意图的所有目标中。将为框架生成公共意图类，对于其他目标，选择“不生成类”。</p><figure class="lm ln lo lp fd ii er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mc"><img src="../Images/3240b797b546c3953b7b72490fc0a5d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8eDKn1lOuwbEkkwWfBDcbQ.png"/></div></div><figcaption class="il im et er es in io bd b be z dx">Intent definition target membership</figcaption></figure><p id="0b4d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">一个意向按以下3个步骤处理:<br/> 1 .<strong class="ir hi">解析</strong>:解析每个参数，如果收到所有参数，从SiriKit澄清。一旦解析了参数，就验证该值，并返回成功或失败的结果。<br/> 2。<strong class="ir hi">确认</strong>:一旦所有参数都通过验证，返回意向响应。意向可以通过打开app或者意向扩展来处理。<br/> 3。<strong class="ir hi">处理:</strong>在这个阶段，将处理意图，并将响应对象发送给SiriKit。</p><p id="2292" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">意图处理协议还包含一种在快捷方式应用程序中配置意图参数时提供参数选项的方法。这些自定义参数类型被添加到意图定义文件中。对于示例项目中类型为<em class="lz"> ExpenseResponse </em>的<em class="lz"> expense </em>参数，提供选项方法返回一个选项集合。为输入的每个搜索项调用此方法。一般来说，下面代码片段中的这个功能应该适用于大型列表，但它只是作为参考添加的。以下代码片段实现了所讨论的句柄意图步骤的方法:</p><figure class="lm ln lo lp fd ii"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="b6b3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在所有的意图处理代码都完成了，我们需要返回类的对象来确认<em class="lz">意图处理协议。</em></p><p id="e1a0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">创建Intents扩展时，还会创建<em class="lz"/><strong class="ir hi">intent handler . swift</strong>文件。该文件包含一个符合<strong class="ir hi">扩展协议的类。</strong>从<strong class="ir hi">处理程序</strong>方法返回正确的处理程序对象，如下所示:</p><figure class="lm ln lo lp fd ii"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="d98c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">当应用程序必须启动来处理意图时，可以实现与用户活动相关的UISceneDelegate方法。</p></div><div class="ab cl jn jo go jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ha hb hc hd he"><p id="0dc0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">创建<strong class="ir hi">intens UI应用程序扩展</strong>是可选的。</p><p id="36b7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要设置每个意图UI应用程序扩展，您必须向Xcode项目添加一个自定义目标，并在项目编辑器的UI扩展目标的“支持的意图”部分添加扩展支持的意图。这将在Info.plist中为适当的目标添加意图。</p><p id="d27d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在向用户显示界面之前，Siri构建了一个代表它想要显示的数据的<strong class="ir hi"> INParameter </strong>对象列表。稍后，SiriKit会创建一个或多个视图控制器实例，并调用<strong class="ir hi"> configureView </strong>方法。按如下方式配置自定义界面:</p><figure class="lm ln lo lp fd ii"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="fd63" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">完成实现后，创建并测试快捷方式。<br/>感谢阅读！</p></div><div class="ab cl jn jo go jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ha hb hc hd he"><h1 id="d5f6" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">参考</h1><ul class=""><li id="4659" class="ks kt hh ir b is ku iw kv ja kw je kx ji ky jm lx la lb lc bi translated"><a class="ae md" href="https://developer.apple.com/documentation/uikit/uiscenedelegate" rel="noopener ugc nofollow" target="_blank">https://developer . apple . com/documentation/ui kit/uiscenedelegate</a></li><li id="4886" class="ks kt hh ir b is ld iw le ja lf je lg ji lh jm lx la lb lc bi translated"><a class="ae md" href="https://developer.apple.com/documentation/sirikit/soup_chef_accelerating_app_interactions_with_shortcuts" rel="noopener ugc nofollow" target="_blank">https://developer . apple . com/documentation/sirikit/soup _ chef _ accelerating _ app _ interactions _ with _ shortcut s</a></li></ul></div></div>    
</body>
</html>