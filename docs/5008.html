<html>
<head>
<title>Using PowerShell to apply CI/CD in Mendix</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用PowerShell在Mendix中应用CI/CD</h1>
<blockquote>原文：<a href="https://medium.com/mendix/using-powershell-to-apply-ci-for-mendix-35296748e800?source=collection_archive---------2-----------------------#2020-01-28">https://medium.com/mendix/using-powershell-to-apply-ci-for-mendix-35296748e800?source=collection_archive---------2-----------------------#2020-01-28</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/ee391682c135788e5a73e65fd055b72d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qwyRzHsNhHrYYVeaYMks7A.png"/></div></div></figure><p id="761b" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">Mendix是一个构建各种大小应用程序的绝佳平台。Mendix平台甚至为部署开发的Mendix应用程序提供了一个非常有用的服务门户。然而，所有这些都是手工完成的。必须有人手动创建部署包，然后将其部署到正确的环境中。当只有几个应用程序要部署时，这是可以的，但是当您构建越来越多的应用程序时，这就变得很麻烦了。这时，持续集成(CI)和持续交付(CD)为我们提供了更多的速度和控制。</p><h1 id="6087" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">如何用Mendix实现这一点</h1><p id="abff" class="pw-post-body-paragraph jc jd hu bd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hn dt translated">Mendix提供了一个免费的API来与CI工具一起使用，也称为Mendix Deploy API。所有功能的链接可以在<a class="ae lc" href="https://docs.mendix.com/apidocs-mxsdk/apidocs/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。Mendix deploy API具有为各种场景实现适当管道的所有功能。从检查新提交、构建新包到部署新构建的包。除了这些主要功能之外，还有更多功能可用于通过API配置完整的环境。想想常量、预定事件和自定义运行时设置。</p><h1 id="f05e" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">让我们开始工作吧</h1><p id="5c20" class="pw-post-body-paragraph jc jd hu bd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hn dt translated">在下面的示例中，我将使用Windows PowerShell作为为Mendix提供CI的工具。为什么选择Powershell？首先，它预装在任何Mendix开发机器上，也就是Windows上。由于微软在开源社区中的贡献越来越大，PowerShell的下一个版本Powershell Core也在其他操作系统中得到支持，如Linux、macOS甚至ARM。这使得每个人都可以在本地和任何服务器上使用它，并有可能通过后台作业自动执行它。</p><p id="ed12" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">我对它产生了兴趣，因为PowerShell示例已经出现在<a class="ae lc" href="https://docs.mendix.com/apidocs-mxsdk/apidocs/example-implementation" rel="noopener ugc nofollow" target="_blank"> Mendix文档站点</a>上。这里提到的先决条件包括拥有当前的Powershell，确保您可以使用'<em class="ld">Set-execution policy remote signed</em>'在您的系统上运行它，以及如何获得构建和部署应用程序的凭据。</p><p id="33c0" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">现在，我想进一步增强脚本，使其更加模块化，并遵循一些最佳实践来共享脚本，而不损害安全性。所以我们把词的核心部分分开了。</p><figure class="lf lg lh li fq iv fe ff paragraph-image"><div class="fe ff le"><img src="../Images/4f3a7fcb65a9aba5e389ea04b9c85686.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/1*-zDznO44y-Ngvc8B-RrFXQ.png"/></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek">The structure set up to keep a nice CI script that can be updated and shared.</figcaption></figure><ol class=""><li id="32bd" class="ln lo hu bd b je jf ji jj jm lp jq lq ju lr jy ls lt lu lv dt translated">我们有一个脚本函数文件，其中包含所有的函数和逻辑，可以让它正常工作。这可以放在一些中央，像Github回购。</li><li id="f629" class="ln lo hu bd b je lw ji lx jm ly jq lz ju ma jy ls lt lu lv dt translated">我们有一个包含所有特定环境数据的脚本数据文件，可以在CI管道中使用。这可以放在你的应用程序的Mendix库里面。</li><li id="dd1b" class="ln lo hu bd b je lw ji lx jm ly jq lz ju ma jy ls lt lu lv dt translated">我们有一个带有Mendix凭证的脚本数据文件。你应该把这个留给自己。</li></ol><p id="40c6" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">通过将应用程序的脚本函数文件和脚本数据文件放在相应的存储库中，参与项目的每个人都可以自动完成更新。</p><h1 id="d30a" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">一些关于文件的解释</h1><p id="0241" class="pw-post-body-paragraph jc jd hu bd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hn dt translated">脚本函数文件是完成工作最重要的文件，但它不包含关于应用程序和应用程序环境的数据和信息，也不包含任何安全细节。它包含了创建一个构建并将其部署到所选环境的所有功能。默认情况下，这将是Test。</p><p id="6f43" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">在撰写本文时，它包含四个参数。两个用于数据文件，两个用于脚本使用。我要直接部署吗？我是否希望在部署期间设置配置？后者仍在进行中。两者都是可选的，如果没有提供，则值被解释为“false”。</p><p id="ad60" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">应用程序环境的脚本数据文件包含一些主要信息，例如，我们希望使用哪个分支进行构建，以及要部署到哪个环境。不久还包括了环境设置，如常数和预定事件。</p><p id="01dd" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">Mendix API凭证的脚本数据文件是不言自明的。</p><h1 id="da22" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">部署它的流程</h1><figure class="lf lg lh li fq iv fe ff paragraph-image"><div class="fe ff mb"><img src="../Images/ec205763bfb59d757014229689242a99.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*Nrw7MW_gQHBlrUKQ_YKGBg.png"/></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek">The flow to get a new package deployed.</figcaption></figure><p id="84f5" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">上面显示了在指定环境中进行新部署的步骤。第一个决定是为了增强性能，而不是每次为相同的版本创建一个新的构建。第二个是基于参数'-dodeploy '确定的。</p><h1 id="add3" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">让脚本在您的电脑上运行</h1><p id="9f4e" class="pw-post-body-paragraph jc jd hu bd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hn dt translated">请确保以管理员权限启动PowerShell，以便可以执行该脚本。记住必需文件所在的绝对路径，并通过PowerShell控制台运行脚本。</p><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mc"><img src="../Images/faec3bda5a6e80829f89ed2eb78c93ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HrE-Z6x0M6N93MErBQnsvA.png"/></div></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek">Example with a build only.</figcaption></figure><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff md"><img src="../Images/6a4cdfc6fb2ce7d5f3d5002a0509eeb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9S6KHIZxueUtHfrn6VI8wg.png"/></div></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek">Example with a build and a deploy.</figcaption></figure><h1 id="fafa" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">自动化it</h1><p id="f678" class="pw-post-body-paragraph jc jd hu bd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hn dt translated">现在我们已经设置了所有必要的方面，我们可以自动化它。创建一个批处理文件，用于计划任务(每5分钟一次)或在需要时双击。当然，请记住，这个批处理文件也不要在存储库中，除非您在批处理文件中共享相同的位置和文件名。现在你不需要去云门户，不需要等待，就可以走得更远。自动化可以为您每次部署节省15分钟或更多的时间，所以我建议如果可能的话，从一开始就这样做。</p><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff me"><img src="../Images/bca636993ac1498a77a7dd9f9aac1f5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-sQd0pqfaJpvtQAkrUe-uA.png"/></div></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek">Example of batch file contents.</figcaption></figure><figure class="lf lg lh li fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mf"><img src="../Images/27fe25b58ef39e9e88e907f68a48f65b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q7xufnH2_Qyl6k2fhx1wHw.png"/></div></div><figcaption class="lj lk fg fe ff ll lm bd b be z ek">A test of the created batch file. It works!</figcaption></figure><h1 id="69e4" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">接下来要做的事情</h1><p id="6975" class="pw-post-body-paragraph jc jd hu bd b je kx jg jh ji ky jk jl jm kz jo jp jq la js jt ju lb jw jx jy hn dt translated">该脚本目前正在按照它应该做的那样工作。但是，我有一些可能会添加到脚本中的增强功能，比如为了可追溯性而记录到外部文件，以及设置环境配置。</p><p id="aca8" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">我用来构建脚本和测试每个迭代的工具是Powershell ISE和带有Powershell扩展的Visual Studio代码。</p><p id="2523" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">我使用和更新的脚本可以在这里找到。该存储库还包括一些模板文件，可用于更改您的应用程序详细信息。</p></div><div class="ab cl mg mh hb mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="hn ho hp hq hr"><p id="ecfc" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">我希望你在项目的第一个sprint阶段花些时间做好准备，然后建立CI-pipeline。这很简单，从一开始就能节省你很多时间。</p><p id="cacb" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">再见！</p></div></div>    
</body>
</html>