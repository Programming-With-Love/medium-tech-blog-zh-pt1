<html>
<head>
<title>Apache Pulsar — One Cluster for the Entire Enterprise Using Multi Tenancy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Apache Pulsar —使用多租户的整个企业的一个集群</h1>
<blockquote>原文：<a href="https://medium.com/capital-one-tech/apache-pulsar-one-cluster-for-the-entire-enterprise-using-multi-tenancy-ac0bd925fbdf?source=collection_archive---------4-----------------------#2019-11-07">https://medium.com/capital-one-tech/apache-pulsar-one-cluster-for-the-entire-enterprise-using-multi-tenancy-ac0bd925fbdf?source=collection_archive---------4-----------------------#2019-11-07</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/6c9807b9ee143b9c007d3fc3846b0152.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hJvYSdB066UkOLVF"/></div></div></figure><p id="5a1b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">正如我们在<a class="ae jn" rel="noopener" href="/capital-one-tech/apache-pulsar-apaches-newest-pub-sub-messaging-platform-1c1ba1a6c673">上一篇文章</a>中提到的，<a class="ae jn" href="https://pulsar.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache Pulsar </a>是一个新的开源分布式发布-订阅消息平台，由雅虎创建，现在是Apache软件基金会的一部分。Pulsar提供了各种开箱即用的特性，我们将在本文中评估/测试多租户特性。</p><p id="07e0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">多租户功能允许不同的软件、应用程序或平台在共享环境中安全运行。共享环境中的每个单元被称为“租户”，我们将在下面深入讨论。</p><h1 id="cd81" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">什么是租户？</h1><p id="7e1f" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">租户可以是组织内的客户或团队，或者是生产者或消费者的分类组，需要将数据和处理与其他客户或团队隔离。租户可以管理不同区域的不同应用程序，如开发、测试或生产。</p><p id="2611" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在零售店中，库存、采购、记账、订购、补货等。可能是房客。对于金融科技公司、银行、信用卡、贷款等。可能是房客。以金融科技为例，在信用卡中可以有支付、信用记录等应用。内部分为子系统或部署区域，如开发、QA或生产。在这个例子中，支付和信用历史将形成命名空间，以便根据环境为每个子系统创建主题。</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kr"><img src="../Images/de533b28c495c7296ba20d2c80f74389.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FA99iTq_3LsFicrS"/></div></div><figcaption class="kw kx et er es ky kz bd b be z dx"><em class="la">Generic example of Multi Tenancy for a fintech org</em></figcaption></figure><h1 id="2e56" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">多租户有什么好处？</h1><p id="f46b" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">多租户允许企业或零售商为整个组织拥有一个全局集群，不同部门之间的数据或硬件隔离。多租户带来了几个优势:</p><ul class=""><li id="b12c" class="lb lc hh ir b is it iw ix ja ld je le ji lf jm lg lh li lj bi translated"><strong class="ir hi">成本</strong> —多租户允许组织规划更少的集群，这与花费在基础架构和维护上的更少资金或时间成比例。</li><li id="0f10" class="lb lc hh ir b is lk iw ll ja lm je ln ji lo jm lg lh li lj bi translated"><strong class="ir hi">集群大小</strong> —这取决于组织的需求，因为与本地化实例相比，从多集群环境压缩到单个企业集群会产生更大的集群。Pulsar架构支持水平和垂直的可伸缩性，以满足这一需求。</li><li id="9715" class="lb lc hh ir b is lk iw ll ja lm je ln ji lo jm lg lh li lj bi translated"><strong class="ir hi">复制和弹性</strong> —答案很简单；Pulsar是由无状态代理设计的，由记账员提供的持久存储支持。这意味着Pulsar可以水平和垂直扩展，通过其内置的地理复制功能支持n-mesh复制。</li></ul><h1 id="6cf1" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">我们如何实现多租户？</h1><p id="24e0" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">假设我们的零售组织中有两个部门——库存和计费。我们可以指定如下租户:</p><ul class=""><li id="1602" class="lb lc hh ir b is it iw ix ja ld je le ji lf jm lg lh li lj bi translated">库存</li><li id="f5a0" class="lb lc hh ir b is lk iw ll ja lm je ln ji lo jm lg lh li lj bi translated">演员表</li></ul><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lp"><img src="../Images/882fb7fecd651b691292487b07bd73ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zESLl5gm9cha3wSf"/></div></div></figure><p id="971a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这两个租户必须通过Pulsar与他们部门内部或部门之间的不同系统进行交互。Pulsar支持<a class="ae jn" href="https://pulsar.apache.org/docs/en/security-overview/#authentication-providers" rel="noopener ugc nofollow" target="_blank"> TLS或Athenz或Kerberos </a>进行认证和授权，多租户特性是使用该工具实现的。对于这个例子，我们将使用TLS。</p><p id="9374" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要使用TLS加密，我们需要生成信任、服务器和客户端证书。</p><p id="b852" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> 1。信任证书<br/> </strong>第一步是创建信任证书。在https://pulsar.apache.org/docs/en/security-tls-transport/<a class="ae jn" href="https://pulsar.apache.org/docs/en/security-tls-transport/" rel="noopener ugc nofollow" target="_blank">遵循Pulsar文档中的说明。</a></p><p id="856e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> 2。服务器证书<br/> </strong>按照上述文档中的描述，为代理(Pulsar)生成服务器证书和私钥。如果您需要使用SAN生成，请遵循以下说明:</p><p id="5527" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">将以下文件另存为<code class="du lq lr ls lt b">csr_server.txt</code></p><pre class="ks kt ku kv fd lu lt lv lw aw lx bi"><span id="3db4" class="ly jp hh lt b fi lz ma l mb mc">[req]<br/>default_bits = 2048<br/>prompt = no<br/>default_md = sha256<br/>req_extensions = req_ext<br/>distinguished_name = dn<br/>[ dn ]<br/>C=US<br/>ST=STATE<br/>L=CITY<br/>O=COMPANYNAME<br/>OU=DEPT<br/><a class="ae jn" href="mailto:emailAddress=karthik@domain.com" rel="noopener ugc nofollow" target="_blank">emailAddress=karthik@domain.com</a><br/>CN = *.retailer.com<br/>[ req_ext ]<br/>subjectAltName = <a class="ae jn" href="http://twitter.com/alt_names" rel="noopener ugc nofollow" target="_blank">@alt_names</a><br/>[ alt_names ]<br/>DNS.1 = *.abc.cloud.retailer.com<br/>DNS.2 = *.retailer.com<br/>DNS.3 = localhost</span></pre><p id="4c15" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">使用下面的生成服务器证书:</p><pre class="ks kt ku kv fd lu lt lv lw aw lx bi"><span id="c81e" class="ly jp hh lt b fi lz ma l mb mc">openssl req \<br/> -newkey rsa:2048 \<br/> -sha256 \<br/> -nodes \<br/> -out broker-cert.csr \<br/> -keyout privkey.pem \<br/> -outform PEM \<br/> -config &lt;( cat csr_server.txt )</span></pre><p id="e4a8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">遵循<a class="ae jn" href="https://pulsar.apache.org/docs/en/security-tls-transport/" rel="noopener ugc nofollow" target="_blank"> Pulsar文档</a>中概述的剩余步骤。</p><p id="aec5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> 3。类似地，您还需要生成三个客户端证书:</strong></p><ul class=""><li id="8664" class="lb lc hh ir b is it iw ix ja ld je le ji lf jm lg lh li lj bi translated">一个用于管理CLI工具，如pulsar-admin。</li><li id="86be" class="lb lc hh ir b is lk iw ll ja lm je ln ji lo jm lg lh li lj bi translated">一个用于库存，CN=inventory(对于SAN，使用上面的示例)。</li><li id="fd94" class="lb lc hh ir b is lk iw ll ja lm je ln ji lo jm lg lh li lj bi translated">一个用于CN=billing的计费(在SAN的情况下，使用上面的示例)。</li></ul><h2 id="d6cc" class="ly jp hh bd jq md me mf ju mg mh mi jy ja mj mk kc je ml mm kg ji mn mo kk mp bi translated"><strong class="ak">现在你有以下:</strong></h2><ul class=""><li id="4c92" class="lb lc hh ir b is km iw kn ja mq je mr ji ms jm lg lh li lj bi translated">一个代理服务器证书。</li><li id="56fb" class="lb lc hh ir b is lk iw ll ja lm je ln ji lo jm lg lh li lj bi translated">一份CLI工具、清单和计费的客户证书。</li></ul><h2 id="589f" class="ly jp hh bd jq md me mf ju mg mh mi jy ja mj mk kc je ml mm kg ji mn mo kk mp bi translated"><strong class="ak">按照</strong> <a class="ae jn" href="https://pulsar.apache.org/docs/en/security-tls-transport/#broker-configuration" rel="noopener ugc nofollow" target="_blank"> <strong class="ak"> Pulsar文档</strong> </a> <strong class="ak">中的说明配置以下文件:</strong></h2><ul class=""><li id="037f" class="lb lc hh ir b is km iw kn ja mq je mr ji ms jm lg lh li lj bi translated"><code class="du lq lr ls lt b">broker.conf</code>(服务器证书和信任库证书)</li><li id="616b" class="lb lc hh ir b is lk iw ll ja lm je ln ji lo jm lg lh li lj bi translated"><code class="du lq lr ls lt b">client.conf</code> <strong class="ir hi"> <em class="mt"> (pulsar-admin使用此配置—使用各自的客户端证书)</em> </strong></li><li id="d3f1" class="lb lc hh ir b is lk iw ll ja lm je ln ji lo jm lg lh li lj bi translated"><code class="du lq lr ls lt b">discovery.conf</code>(服务器证书和信任库证书)</li></ul><p id="5671" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">一旦动物园管理员、赌注登记经纪人和经纪人(<code class="du lq lr ls lt b">Cluster Name = Retailer</code>)都在启用认证和授权的情况下运行，使用<code class="du lq lr ls lt b">pulsar-admin</code>来创建租户:</p><pre class="ks kt ku kv fd lu lt lv lw aw lx bi"><span id="5733" class="ly jp hh lt b fi lz ma l mb mc">./pulsar-admin tenants create inventory-tenant \</span><span id="7777" class="ly jp hh lt b fi mu ma l mb mc">— -admin-roles inventory — allowed-clusters retailer</span></pre><p id="3d76" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">用于计费:</strong></p><pre class="ks kt ku kv fd lu lt lv lw aw lx bi"><span id="78ef" class="ly jp hh lt b fi lz ma l mb mc">./pulsar-admin tenants create billing-tenant \</span><span id="7bdc" class="ly jp hh lt b fi mu ma l mb mc">— -admin-roles billing — allowed-clusters retailer</span></pre><p id="41f3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，让我们考虑他们部门内部的沟通。</p><h2 id="a2af" class="ly jp hh bd jq md me mf ju mg mh mi jy ja mj mk kc je ml mm kg ji mn mo kk mp bi translated"><strong class="ak">下一步是为每个租户创建名称空间。</strong></h2><p id="fbf6" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">对于库存-ns1:</p><pre class="ks kt ku kv fd lu lt lv lw aw lx bi"><span id="8887" class="ly jp hh lt b fi lz ma l mb mc">./pulsar-admin namespaces create inventory-tenant/ns1</span><span id="80d9" class="ly jp hh lt b fi mu ma l mb mc">./pulsar-admin namespaces set-clusters inventory-tenant/ns1 — clusters retailer</span></pre><p id="1d4a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">对于计费-ns1:</p><pre class="ks kt ku kv fd lu lt lv lw aw lx bi"><span id="2c44" class="ly jp hh lt b fi lz ma l mb mc">./pulsar-admin namespaces create billing-tenant/ns1</span><span id="5642" class="ly jp hh lt b fi mu ma l mb mc">./pulsar-admin namespaces set-clusters billing-tenant/ns1 — clusters retailer</span></pre><h2 id="03ee" class="ly jp hh bd jq md me mf ju mg mh mi jy ja mj mk kc je ml mm kg ji mn mo kk mp bi translated"><strong class="ak">下一步是授予访问名称空间的权限。</strong></h2><p id="e818" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">可以使用通配符，但不支持总括通配符。角色应该与各自的客户端证书的CN相匹配。</p><pre class="ks kt ku kv fd lu lt lv lw aw lx bi"><span id="3409" class="ly jp hh lt b fi lz ma l mb mc">./pulsar-admin namespaces grant-permission inventory-tenant/ns1 \<br/> - actions produce,consume \<br/> - role 'inventory*'</span><span id="59b8" class="ly jp hh lt b fi mu ma l mb mc">./pulsar-admin namespaces grant-permission billing-tenant/ns1 \<br/> - actions produce,consume \<br/> - role 'billing*'</span></pre><h2 id="e825" class="ly jp hh bd jq md me mf ju mg mh mi jy ja mj mk kc je ml mm kg ji mn mo kk mp bi translated"><strong class="ak">下一步是主题创建。</strong></h2><p id="5619" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">我们按如下方式创建它:</p><ul class=""><li id="f1eb" class="lb lc hh ir b is it iw ix ja ld je le ji lf jm lg lh li lj bi translated">对于库存—主题1</li><li id="f634" class="lb lc hh ir b is lk iw ll ja lm je ln ji lo jm lg lh li lj bi translated">用于计费—主题1</li></ul><h1 id="f954" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">在云端还是Kubernetes？</strong></h1><p id="68a2" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">Pulsar有一个名为<a class="ae jn" href="https://pulsar.apache.org/docs/en/concepts-architecture-overview/#pulsar-proxy" rel="noopener ugc nofollow" target="_blank"> Proxy </a>的内置特性，需要在云或Kubernetes上部署Pulsar时进行配置。代理本身可以提供我们在Broker中讨论过的身份验证和授权特性。代理还可以再次与代理通信，或者与TLS或非TLS通信。</p><p id="60ef" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要在代理中启用TLS，请将服务器证书配置为<code class="du lq lr ls lt b">“tlsCertificateFilePath”</code>和<code class="du lq lr ls lt b">“tlsKeyFilePath”</code>。</p><p id="bab1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">设置</p><pre class="ks kt ku kv fd lu lt lv lw aw lx bi"><span id="ef0f" class="ly jp hh lt b fi lz ma l mb mc">tlsEnabledWithBroker=true</span><span id="9b89" class="ly jp hh lt b fi mu ma l mb mc">tlsEnabledInProxy=true</span></pre><p id="d24f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">并将客户端证书设置为使用以下命令与Broker进行握手:</p><pre class="ks kt ku kv fd lu lt lv lw aw lx bi"><span id="6a3e" class="ly jp hh lt b fi lz ma l mb mc">brokerClientAuthenticationPlugin=org.apache.pulsar.client.impl.auth.AuthenticationTls</span><span id="7208" class="ly jp hh lt b fi mu ma l mb mc">brokerClientAuthenticationParameters=tlsCertFile:&lt;CLIENT-CERT-FILE&gt;,tlsKeyFile:&lt;CLIENT-KEY-FILE&gt;</span><span id="527c" class="ly jp hh lt b fi mu ma l mb mc">brokerClientTrustCertsFilePath=&lt;TRUST-CERT-FILE&gt;</span></pre><p id="2649" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要使授权令牌能够被传递，请启用以下属性:</p><pre class="ks kt ku kv fd lu lt lv lw aw lx bi"><span id="9c24" class="ly jp hh lt b fi lz ma l mb mc">forwardAuthorizationCredentials=true</span></pre><p id="afbc" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要在代理设置处终止SSL，<code class="du lq lr ls lt b">tlsEnabledWithBroker=false</code>并不要求它配置客户端证书。您仍然可以将授权令牌传递给代理来验证权限。</p><p id="3302" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，我们已经准备好测试多租户特性，分别为库存和计费编写生产者和消费者。下面是生产者和消费者的样本片段。</p><p id="9a93" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">Producer.java</strong></p><pre class="ks kt ku kv fd lu lt lv lw aw lx bi"><span id="d56e" class="ly jp hh lt b fi lz ma l mb mc">public class Producer {<br/>    public static void main(String[] args) {<br/>        String localClusterUrl = "pulsar+ssl://localhost:6651";<br/>        String namespace = "inventory-tenant/ns1";<br/>        String topic = String.<em class="mt">format</em>("persistent://%s/topic1", namespace);<br/>        Map&lt;String, String&gt; authParams = new HashMap&lt;&gt;();<br/>        authParams.put("tlsCertFile", "client-inventory-cert.pem");<br/>        authParams.put("tlsKeyFile", "client-inventory-key.pem");<br/>        Authentication tlsAuth = AuthenticationFactory<br/>                .create(AuthenticationTls.class.getName(), authParams);<br/>        PulsarClient client = PulsarClient.builder().serviceUrl(localClusterUrl)<br/>                .enableTls(true)<br/>                .tlsTrustCertsFilePath("/demoCA/cacert.pem")<br/>                .authentication(tlsAuth)<br/>                .build();<br/>        Producer producer = client.newProducer()<br/>                .topic(topic)<br/>                .sendTimeout(10, TimeUnit.SECONDS)<br/>                .create();<br/>        for (int i = 0; i &lt; 10; i++) {<br/>            String msg = String.<em class="mt">format</em>("Inventory-message-W-%d", i);<br/>            producer.send(msg.getBytes());<br/>            System.<em class="mt">out</em>.println("Sending Message - -&gt; " + msg);<br/>        }<br/>        producer.close();<br/>        client.close();<br/>    }<br/>}</span></pre><p id="e1dc" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">Consumer.java</strong></p><pre class="ks kt ku kv fd lu lt lv lw aw lx bi"><span id="0480" class="ly jp hh lt b fi lz ma l mb mc">public class Consumer {<br/>    public static void main(String[] args) {<br/>        String localClusterUrl = "pulsar+ssl://localhost:6651";<br/>        String namespace = "inventory-tenant/ns1";<br/>        String topic = String.<em class="mt">format</em>("persistent://%s/topic1", namespace);<br/>        Map&lt;String, String&gt; authParams = new HashMap&lt;&gt;();<br/>        authParams.put("tlsCertFile", "client-inventory-cert.pem");<br/>        authParams.put("tlsKeyFile", "client-inventory-key.pem");<br/>        Authentication tlsAuth = AuthenticationFactory<br/>                .create(AuthenticationTls.class.getName(), authParams);\<br/>        PulsarClient client = PulsarClient.builder().serviceUrl(localClusterUrl)<br/>                .enableTls(true)<br/>                .tlsTrustCertsFilePath("/demoCA/cacert.pem")<br/>                .authentication(tlsAuth).build();\<br/>        Consumer consumer = client.newConsumer()<br/>                .topic(topic)<br/>                .subscriptionName("my-sub")<br/>                .subscriptionType(SubscriptionType.Exclusive)<br/>                .subscribe();<br/>        while (true) {<br/>            Message msg = consumer.receive();<br/>            System.<em class="mt">out</em>.println("Received message: " + StringUtils.newStringUtf8(msg.getData()));<br/>            consumer.acknowledge(msg);<br/>        }<br/>    }<br/>}</span></pre><p id="82ed" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果客户端证书在库存/计费之间切换，测试应用程序生成/消费将抛出<code class="du lq lr ls lt b">AuthorizationException</code>，表明生成者/消费者无权在<code class="du lq lr ls lt b">&lt;tenant&gt;/ns1/topic1</code>上生成/消费消息，即使名称空间和主题匹配。</p><h1 id="e68d" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">结论</strong></h1><p id="55fd" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">Apache Pulsar是一个强大的发布-订阅模型，构建在分层架构上，开箱即用，具有地理复制、多租户、零重新平衡时间、统一队列和流、持久性等功能。</p><p id="ad80" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">多租户是一种特性，组织可以利用它来最大限度地减少成本、工作量和维护等。多租户将帮助应用程序在共享环境中安全地工作。在这篇文章中，我们配置了多个应用程序来使用TLS传输加密共享一个集群。</p><p id="8be5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">测试并填写您的反馈。</p><p id="7b97" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> <em class="mt">脉动快乐！</em> </strong></p><h1 id="7c4c" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">本系列的相关文章</h1><p id="cc89" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated"><a class="ae jn" rel="noopener" href="/capital-one-tech/apache-pulsar-apaches-newest-pub-sub-messaging-platform-1c1ba1a6c673">Apache Pulsar——对Apache最新发布-订阅消息平台</a> <br/> <a class="ae jn" rel="noopener" href="/capital-one-tech/apache-pulsar-geo-replication-and-hybrid-deployment-model-to-achieve-synchronous-replication-35f30e8b0f2">的简要介绍——Apache Pulsar——地理复制和混合部署模式，以实现同步复制</a></p></div><div class="ab cl mv mw go mx" role="separator"><span class="my bw bk mz na nb"/><span class="my bw bk mz na nb"/><span class="my bw bk mz na"/></div><div class="ha hb hc hd he"><p id="7347" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="mt">披露声明:2019首创一。观点是作者个人的观点。除非本帖中另有说明，否则Capital One不隶属于所提及的任何公司，也不被这些公司认可。使用或展示的所有商标和其他知识产权是其各自所有者的财产。</em></p></div></div>    
</body>
</html>