<html>
<head>
<title>Drilling it down with Apache Drill</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用阿帕奇钻孔机往下钻</h1>
<blockquote>原文：<a href="https://medium.com/globant/drilling-it-down-with-apache-drill-e40be8336fd6?source=collection_archive---------1-----------------------#2022-03-29">https://medium.com/globant/drilling-it-down-with-apache-drill-e40be8336fd6?source=collection_archive---------1-----------------------#2022-03-29</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="7859" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">第一部分:结识</h2></div><p id="6060" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我必须承认，Apache Drill并不是该行业有史以来最受欢迎的工具，但问题是，如果它足够有价值，那么为什么它还不为人所知呢？还和学习有关系吗？如果让我来回答这些，我会说绝对值得一试。并不是每个人都知道它，因为到目前为止它专注于服务于有限数量的用例，但是一直在发展。因此，这个博客的目标是让更多的人了解它。</p><p id="8a8f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在本文结束时，你应该熟悉什么，什么时候，为什么，为什么不钻；如何将在后续部分中涉及。这里唯一的先决条件是基本的SQL知识。本文面向数据分析师、工程师和其他数据爱好者。</p><h1 id="0f70" class="js jt hh bd ju jv jw jx jy jz ka kb kc in kd io ke iq kf ir kg it kh iu ki kj bi translated"><strong class="ak">前言</strong></h1><p id="e64e" class="pw-post-body-paragraph iw ix hh iy b iz kk ii jb jc kl il je jf km jh ji jj kn jl jm jn ko jp jq jr ha bi translated">随着每秒钟产生大量的数据，管理、存储、分析和建模数据的挑战越来越紧迫。在任何IT项目中，数据分析对于推动有效决策是绝对必要的。数据分析是一个繁琐的过程，当您的数据分布在不同的来源时，它会大大增加整个工作的复杂性。钻头来救援了。</p><figure class="kq kr ks kt fd ku er es paragraph-image"><div class="er es kp"><img src="../Images/d8806c1e491b9dae8ac8205cbc851911.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/1*jfKos1YsTp_GtEVz6GTMVQ.gif"/></div><figcaption class="kx ky et er es kz la bd b be z dx">Source: <a class="ae lb" href="https://twitter.com/microsoftteams/status/1288547380065959939" rel="noopener ugc nofollow" target="_blank">Twitter</a></figcaption></figure><h1 id="32fa" class="js jt hh bd ju jv jw jx jy jz ka kb kc in kd io ke iq kf ir kg it kh iu ki kj bi translated"><strong class="ak">什么是阿帕奇演习？</strong></h1><p id="272f" class="pw-post-body-paragraph iw ix hh iy b iz kk ii jb jc kl il je jf km jh ji jj kn jl jm jn ko jp jq jr ha bi translated">Apache Drill是一个开源、分布式、交互式查询引擎，灵感来自Google的Dremel系统(由Google开发，用于交互式查询大型数据集，现在称为<a class="ae lb" href="https://cloud.google.com/bigquery/docs/introduction" rel="noopener ugc nofollow" target="_blank"> BigQuery </a>)。与<a class="ae lb" href="https://impala.apache.org/overview.html" rel="noopener ugc nofollow" target="_blank"> Impala </a>不同，它不仅仅是一个基于Hadoop平台的SQL，而是一个基于一切的SQL。它可以集成各种数据源，如本地文件、RDBMS、HDFS、Hive、HBase、Kafka、MongoDB、Cassandra、亚马逊S3、Azure blob存储、谷歌云存储等。Drill也是世界上第一个也是唯一一个不需要模式的分布式SQL引擎。</p><h1 id="e353" class="js jt hh bd ju jv jw jx jy jz ka kb kc in kd io ke iq kf ir kg it kh iu ki kj bi translated"><strong class="ak">引擎盖下</strong></h1><p id="469c" class="pw-post-body-paragraph iw ix hh iy b iz kk ii jb jc kl il je jf km jh ji jj kn jl jm jn ko jp jq jr ha bi translated">在Drill的核心，<a class="ae lb" href="https://drill.apache.org/architecture/" rel="noopener ugc nofollow" target="_blank"> Drillbit </a>服务负责接受来自客户端的请求，处理查询，并将结果返回给客户端。钻头在群集中的每个数据节点上运行，在查询执行期间最大化数据局部性。Drill使用<a class="ae lb" href="https://zookeeper.apache.org/" rel="noopener ugc nofollow" target="_blank"> ZooKeeper </a>来维护集群成员和健康检查信息。</p><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es lc"><img src="../Images/cad108c7140a9ed00f5fe8c948d8b83f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OJCgQfvHy_Dknh-2CitCVw.jpeg"/></div></div></figure><h1 id="b5c6" class="js jt hh bd ju jv jw jx jy jz ka kb kc in kd io ke iq kf ir kg it kh iu ki kj bi translated"><strong class="ak">Wow因素</strong></h1><p id="780a" class="pw-post-body-paragraph iw ix hh iy b iz kk ii jb jc kl il je jf km jh ji jj kn jl jm jn ko jp jq jr ha bi translated">在本节中，我们将了解使Drill独一无二的最佳特性。</p><h2 id="baf6" class="lh jt hh bd ju li lj lk jy ll lm ln kc jf lo lp ke jj lq lr kg jn ls lt ki lu bi translated"><strong class="ak">标准SQL支持</strong></h2><p id="923b" class="pw-post-body-paragraph iw ix hh iy b iz kk ii jb jc kl il je jf km jh ji jj kn jl jm jn ko jp jq jr ha bi translated">Drill支持标准的ANSI SQL:2003。这保留了人们熟悉的、无处不在的SQL行为。当部分SQL支持不够时，Drill就派上了用场。</p><p id="ec23" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">例如，<a class="ae lb" href="https://hive.apache.org/" rel="noopener ugc nofollow" target="_blank"> Hive </a>不能计算<a class="ae lb" href="https://www.geeksforgeeks.org/sql-correlated-subqueries/" rel="noopener ugc nofollow" target="_blank">相关子查询</a>，但是Drill可以:</p><pre class="kq kr ks kt fd lv lw lx ly aw lz bi"><span id="3f6b" class="lh jt hh lw b fi ma mb l mc md">SELECT column_name(s) FROM table_name WHERE EXISTS (SELECT column_name FROM table_name WHERE condition);</span></pre><p id="1836" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们可以简单地使用点符号，通过drill来向下钻取一列。在<a class="ae lb" href="https://hbase.apache.org/" rel="noopener ugc nofollow" target="_blank"> HBase </a>的情况下，以表格格式读取和表示多级数据并不容易:</p><pre class="kq kr ks kt fd lv lw lx ly aw lz bi"><span id="6f4b" class="lh jt hh lw b fi ma mb l mc md">SELECT table_name.columnfamilyname.column_1, table_name.columnfamilyname.column_2 FROM hbase.table_name;</span></pre><h2 id="9ba5" class="lh jt hh bd ju li lj lk jy ll lm ln kc jf lo lp ke jj lq lr kg jn ls lt ki lu bi translated"><strong class="ak">无模式</strong></h2><p id="c42e" class="pw-post-body-paragraph iw ix hh iy b iz kk ii jb jc kl il je jf km jh ji jj kn jl jm jn ko jp jq jr ha bi translated">模式在这里是可选的。如果没有明确提到，它们可以自动检测。尽管支持标准的SQL结构，Drill还是遵循一种读模式机制。这使得动态引入新数据源变得更加容易，并允许模式快速发展。在当今世界，没有一个严格的模式是非常实际的，事实上，每条记录都有不同的模式，Drill很好地支持这一点。</p><h2 id="26b4" class="lh jt hh bd ju li lj lk jy ll lm ln kc jf lo lp ke jj lq lr kg jn ls lt ki lu bi translated"><strong class="ak">嵌套数据支持</strong></h2><p id="dd4a" class="pw-post-body-paragraph iw ix hh iy b iz kk ii jb jc kl il je jf km jh ji jj kn jl jm jn ko jp jq jr ha bi translated">在任何其他结构化查询引擎如Hive、<a class="ae lb" href="https://prestodb.io/docs/current/overview.html" rel="noopener ugc nofollow" target="_blank"> Presto </a>等。，数据需要扁平化和模式化。展平具有分层或多级结构的嵌套数据容易出错，而且通常是不可能的。Drill支持JSON和XML等复杂的嵌套数据集进行直接分析。</p><h2 id="84da" class="lh jt hh bd ju li lj lk jy ll lm ln kc jf lo lp ke jj lq lr kg jn ls lt ki lu bi translated">敏捷</h2><p id="2032" class="pw-post-body-paragraph iw ix hh iy b iz kk ii jb jc kl il je jf km jh ji jj kn jl jm jn ko jp jq jr ha bi translated">Drill并不要求每个数据集都本地存在于其中，而是就地检索数据并即时计算。它可以很快上手，因为它不需要数据库管理员。这样也节省了很多细致的资料准备时间。</p><h2 id="b4f2" class="lh jt hh bd ju li lj lk jy ll lm ln kc jf lo lp ke jj lq lr kg jn ls lt ki lu bi translated"><strong class="ak">临时合并</strong></h2><p id="dfcb" class="pw-post-body-paragraph iw ix hh iy b iz kk ii jb jc kl il je jf km jh ji jj kn jl jm jn ko jp jq jr ha bi translated">筒仓使得数据分析变得困难，并且整合多个模式也不容易。通过Drill，用户可以在单个查询中将多个不同的数据源作为不同的表进行联接，而不必事先定义相关的模式。</p><p id="8985" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">SQL无法立即计算以下连接不同来源数据的查询，但Drill可以:</p><pre class="kq kr ks kt fd lv lw lx ly aw lz bi"><span id="62d8" class="lh jt hh lw b fi ma mb l mc md">SELECT a.<!-- -->column_1, b.column_1<!-- --> FROM hive.table<!-- -->_name <!-- -->as a JOIN dfs.`file_name.json` b on a.<!-- -->column_1<!-- -->=b.<!-- -->column_2</span></pre><h2 id="5394" class="lh jt hh bd ju li lj lk jy ll lm ln kc jf lo lp ke jj lq lr kg jn ls lt ki lu bi translated"><strong class="ak">灵活可扩展的架构</strong></h2><p id="872f" class="pw-post-body-paragraph iw ix hh iy b iz kk ii jb jc kl il je jf km jh ji jj kn jl jm jn ko jp jq jr ha bi translated">Drill支持一套全面的存储系统和文件格式，从关系到非关系，即插即用。它提供了内置的类路径扫描和插件概念，以最小的配置添加额外的<a class="ae lb" href="https://drill.apache.org/docs/connect-a-data-source/" rel="noopener ugc nofollow" target="_blank">存储插件</a>和<a class="ae lb" href="https://drill.apache.org/docs/develop-custom-functions/" rel="noopener ugc nofollow" target="_blank">海关功能</a>。有记录良好的API和接口可用于演练。此外，它还可以部署在Hadoop集群上，具有很强的可扩展性。Drill可以灵活地集成所有主要的BI工具，如Tableau、MicroStrategy、QlikView、Excel等。</p><h2 id="64b6" class="lh jt hh bd ju li lj lk jy ll lm ln kc jf lo lp ke jj lq lr kg jn ls lt ki lu bi translated"><strong class="ak">高性能</strong></h2><p id="a801" class="pw-post-body-paragraph iw ix hh iy b iz kk ii jb jc kl il je jf km jh ji jj kn jl jm jn ko jp jq jr ha bi translated">Drill提供了一个分布式计算引擎。它不仅利用了像<a class="ae lb" href="https://spark.apache.org" rel="noopener ugc nofollow" target="_blank"> Spark </a>这样的内存处理，还对列存储和执行进行了优化。类似于<a class="ae lb" href="https://hive.apache.org/index.html" rel="noopener ugc nofollow" target="_blank"> Hive </a>、<a class="ae lb" href="https://arrow.apache.org/docs/" rel="noopener ugc nofollow" target="_blank"> Arrow </a>和极少数其他平台，Drill too支持<a class="ae lb" href="https://docs.cloudera.com/HDPDocuments/HDP2/HDP-2.6.3/bk_data-access/content/query-vectorization.html" rel="noopener ugc nofollow" target="_blank">矢量化</a>，这是一种成批执行记录而不是一次执行一条记录的属性。钻取查询在运行时编译。它遵循乐观的流水线查询执行，节省了通常投资在预先规划恢复上的时间，并且在节点级故障时表现良好。</p><h2 id="0dd9" class="lh jt hh bd ju li lj lk jy ll lm ln kc jf lo lp ke jj lq lr kg jn ls lt ki lu bi translated"><strong class="ak">性价比高</strong></h2><p id="9730" class="pw-post-body-paragraph iw ix hh iy b iz kk ii jb jc kl il je jf km jh ji jj kn jl jm jn ko jp jq jr ha bi translated">为了规划查询，Drill结合使用了优化器和并行化器。优化器读取逻辑计划，然后通过应用各种规则重新排列运算符和函数来优化SQL运算符在语句中的顺序，最终创建物理计划。并行化器将物理计划转换成多个片段，这些片段重写查询并并行执行它。这个过程确保了基于成本的优化查询计划和并行处理。因此，对于大数据问题，Drill是一种经济的解决方案。</p><h2 id="48e5" class="lh jt hh bd ju li lj lk jy ll lm ln kc jf lo lp ke jj lq lr kg jn ls lt ki lu bi translated"><strong class="ak">安全</strong></h2><p id="bd03" class="pw-post-body-paragraph iw ix hh iy b iz kk ii jb jc kl il je jf km jh ji jj kn jl jm jn ko jp jq jr ha bi translated">Drill通过不维护数据的任何物理副本来确保第一级<a class="ae lb" href="https://drill.apache.org/docs/securing-drill/" rel="noopener ugc nofollow" target="_blank">安全性</a>。它提供细粒度的行和列级安全控制，支持<a class="ae lb" href="https://www.redhat.com/sysadmin/pluggable-authentication-modules-pam" rel="noopener ugc nofollow" target="_blank"> PAM </a>、<a class="ae lb" href="https://en.wikipedia.org/wiki/Kerberos_(protocol)" rel="noopener ugc nofollow" target="_blank"> Kerberos </a>、<a class="ae lb" href="https://en.wikipedia.org/wiki/Digest_access_authentication" rel="noopener ugc nofollow" target="_blank"> Digest </a>等。用于用户验证。Drill还可以配置Kerberos来维护数据的机密性和完整性。要记住的另一个关键事实是，它具有用户模拟属性，允许钻取代表客户端执行客户端请求的操作，以防止未经授权的访问。</p><h1 id="2ad6" class="js jt hh bd ju jv jw jx jy jz ka kb kc in kd io ke iq kf ir kg it kh iu ki kj bi translated"><strong class="ak">一个值得注意的对比</strong></h1><p id="d3c8" class="pw-post-body-paragraph iw ix hh iy b iz kk ii jb jc kl il je jf km jh ji jj kn jl jm jn ko jp jq jr ha bi translated">每种工具都有自己的优点和局限性，这是为任何应用选择合适工具时要考虑的一个重要方面。让我们看看下表中Drill与几个流行的查询平台的比较:</p><figure class="kq kr ks kt fd ku er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es me"><img src="../Images/eb5630b0e97da0e8725384f147bd483f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p4D4geP_S_yTLDJSz9UwsQ.png"/></div></div></figure><p id="d1ef" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">通过查看上表，很明显，与SQL Server和MongoDB不同，Drill可以处理关系和非关系数据。与Hive相比，它具有更快的响应时间，并支持高并发性。它几乎可以处理任何大小的数据。此外，与其他三个主题相比，Drill可以支持更多的文件格式。</p></div><div class="ab cl mf mg go mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ha hb hc hd he"><h1 id="5f8c" class="js jt hh bd ju jv mm jx jy jz mn kb kc in mo io ke iq mp ir kg it mq iu ki kj bi translated"><strong class="ak">我的判决</strong></h1><p id="754b" class="pw-post-body-paragraph iw ix hh iy b iz kk ii jb jc kl il je jf km jh ji jj kn jl jm jn ko jp jq jr ha bi translated">Drill无疑是我见过的最灵活、最易用的查询平台之一，但最有说服力的论点是它是否名副其实。</p><p id="0dc0" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">根据我的说法，它因其易用性和灵活的即席探索而赢得了好感，但由于其可疑的读取模式方法和在嵌套数据集情况下对层次差异的错误处理，未能在生产环境中留下深刻印象。</p><p id="8fc8" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">然而，随着每一个新版本的发布，Drill都在努力使其产品更加强大。也就是说，通过选择正确的文件格式、分配适当的内存、理解查询计划和执行配置文件、处理数据偏斜以及实现一组正确的优化(如分区修剪和元数据缓存),它仍然可以用于生产系统。</p></div><div class="ab cl mf mg go mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ha hb hc hd he"><p id="b01e" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我希望我能够清晰地描绘出阿帕奇演习的画面。如果这激发你进一步学习，那么在我的下一篇博客中加入我，我将谈论它的实际实现。</p></div></div>    
</body>
</html>