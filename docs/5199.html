<html>
<head>
<title>Limiting the amount of REST calls in Mendix (most of the time)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">限制Mendix中REST调用的数量(大部分时间)</h1>
<blockquote>原文：<a href="https://medium.com/mendix/limiting-your-amount-of-calls-in-mendix-most-of-the-time-rest-835dde55b10e?source=collection_archive---------4-----------------------#2022-09-01">https://medium.com/mendix/limiting-your-amount-of-calls-in-mendix-most-of-the-time-rest-835dde55b10e?source=collection_archive---------4-----------------------#2022-09-01</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="c293" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">你有没有构建一个集成，得到一个HTTP代码429的响应作为回报？或者供应商抱怨您对他们的系统调用太多？</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/849b1052d13451f3c79ffa177d55afe6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vXbCkSOUgxiD-QVQKwNAyw.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Limiting the amount of REST calls in Mendix (most of the time)</figcaption></figure><blockquote class="jz ka kb"><p id="92b8" class="kc kd ke bd b kf kg iv kh ki kj iy kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">合著者:Martijn Booij和Remco van der Gaag</p></blockquote><blockquote class="ky"><p id="cd4f" class="kz la hu bd lb lc ld le lf lg lh kx ek translated">HTTP <strong class="ak"> 429太多请求</strong>响应状态代码表示用户在给定时间内发送了太多请求(“速率限制”)。</p></blockquote><p id="dd84" class="pw-post-body-paragraph kc kd hu bd b kf li iv kh ki lj iy kk lk ll kn ko lm ln kr ks lo lp kv kw kx hn dt translated">在这种情况下，您在特定的时间范围内向服务器发送了太多的调用，服务器将阻止您在该时间访问它。这主要是为了防止端点服务器过载。</p><p id="f3d3" class="pw-post-body-paragraph kc kd hu bd b kf kg iv kh ki kj iy kk lk km kn ko lm kq kr ks lo ku kv kw kx hn dt translated">使用队列机制的增量重试是这个问题的解决方案之一，但是，您仍然无法解决这个问题:您仍然不知道每个时间范围内您向端点发送了多少个呼叫。</p></div><div class="ab cl lq lr hb ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hn ho hp hq hr"><h1 id="ddad" class="lx ly hu bd lz ma mb mc md me mf mg mh ja mi jb mj jd mk je ml jg mm jh mn mo dt translated"><strong class="ak">解决方案</strong></h1><p id="196b" class="pw-post-body-paragraph kc kd hu bd b kf mp iv kh ki mq iy kk lk mr kn ko lm ms kr ks lo mt kv kw kx hn dt translated">有时，供应商会记录特定端点的速率限制。在这种情况下，您不希望在任何时候超过这个限制(否则您将再次得到429错误)。</p><p id="f087" class="pw-post-body-paragraph kc kd hu bd b kf kg iv kh ki kj iy kk lk km kn ko lm kq kr ks lo ku kv kw kx hn dt translated">在Appronto，<strong class="bd mu">我们已经建立了一个速率限制模块</strong>，它将允许你执行一个你可以控制的速率限制的微流！<strong class="bd mu">指定的微流</strong>将由带有<strong class="bd mu">内部限速队列</strong>的Java动作执行<strong class="bd mu">。</strong></p><p id="e9d6" class="pw-post-body-paragraph kc kd hu bd b kf kg iv kh ki kj iy kk lk km kn ko lm kq kr ks lo ku kv kw kx hn dt translated">该模块不仅为单个速率受限集成提供了解决方案，还为具有不同速率限制的多个集成提供了解决方案。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff mv"><img src="../Images/e2106667725e34cdc5c0ab330c4cd536.png" data-original-src="https://miro.medium.com/v2/resize:fit:438/format:webp/1*KXoU-JBt02-MuSPEVnN99Q.png"/></div></figure><p id="b5ee" class="pw-post-body-paragraph kc kd hu bd b kf kg iv kh ki kj iy kk lk km kn ko lm kq kr ks lo ku kv kw kx hn dt translated">在这里下载:<a class="ae mw" href="https://marketplace.mendix.com/link/component/120637" rel="noopener ugc nofollow" target="_blank">https://marketplace.mendix.com/link/component/120637</a>。</p></div><div class="ab cl lq lr hb ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hn ho hp hq hr"><h1 id="69a2" class="lx ly hu bd lz ma mb mc md me mf mg mh ja mi jb mj jd mk je ml jg mm jh mn mo dt translated"><strong class="ak">简化示例</strong></h1><p id="c099" class="pw-post-body-paragraph kc kd hu bd b kf mp iv kh ki mq iy kk lk mr kn ko lm ms kr ks lo mt kv kw kx hn dt translated">您的应用程序有两个速率受限的集成:</p><ol class=""><li id="013d" class="mx my hu bd b kf kg ki kj lk mz lm na lo nb kx nc nd ne nf dt translated">集成到<strong class="bd mu"> ERP </strong>允许每分钟<strong class="bd mu"> 30次呼叫</strong> =每秒0.5次</li><li id="227c" class="mx my hu bd b kf ng ki nh lk ni lm nj lo nk kx nc nd ne nf dt translated">集成到<strong class="bd mu"> CRM </strong>允许每秒<strong class="bd mu"> 1次呼叫</strong> = 1次</li></ol><p id="9e8e" class="pw-post-body-paragraph kc kd hu bd b kf kg iv kh ki kj iy kk lk km kn ko lm kq kr ks lo ku kv kw kx hn dt translated">除了这些数字，积分将开始给你429个答案。</p><p id="024b" class="pw-post-body-paragraph kc kd hu bd b kf kg iv kh ki kj iy kk lk km kn ko lm kq kr ks lo ku kv kw kx hn dt translated">在这种情况下，您必须执行所有运行ERP集成调用的微流，以及那些从模块中的Java操作调用CRM集成的微流，您希望在该模块中执行微流。</p><p id="27c5" class="pw-post-body-paragraph kc kd hu bd b kf kg iv kh ki kj iy kk lk km kn ko lm kq kr ks lo ku kv kw kx hn dt translated">所有调用ERP集成的微流都将具有以下设置:</p><ul class=""><li id="a602" class="mx my hu bd b kf kg ki kj lk mz lm na lo nb kx nl nd ne nf dt translated">速率限制:0.5</li><li id="95ff" class="mx my hu bd b kf ng ki nh lk ni lm nj lo nk kx nl nd ne nf dt translated">RatelimitQueue:“integration ERP”(这定义了微流将在哪个队列中执行，从而限制了速率)。</li></ul><p id="a25f" class="pw-post-body-paragraph kc kd hu bd b kf kg iv kh ki kj iy kk lk km kn ko lm kq kr ks lo ku kv kw kx hn dt translated">所有调用CRM集成的微流都将具有以下设置:</p><ul class=""><li id="7e7c" class="mx my hu bd b kf kg ki kj lk mz lm na lo nb kx nl nd ne nf dt translated">速率限制1</li><li id="0779" class="mx my hu bd b kf ng ki nh lk ni lm nj lo nk kx nl nd ne nf dt translated">RatelimitQueue: "integrationCRM "</li></ul></div><div class="ab cl lq lr hb ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hn ho hp hq hr"><h1 id="0780" class="lx ly hu bd lz ma mb mc md me mf mg mh ja mi jb mj jd mk je ml jg mm jh mn mo dt translated"><strong class="ak">速率限制</strong></h1><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nm"><img src="../Images/1bcb45c2763b0a4de8aab3ccc50122f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZNdGM_t5YlQJWvUNPeM20Q.png"/></div></div></figure><p id="234f" class="pw-post-body-paragraph kc kd hu bd b kf kg iv kh ki kj iy kk lk km kn ko lm kq kr ks lo ku kv kw kx hn dt translated">Java操作接受以下参数:</p><ul class=""><li id="e44a" class="mx my hu bd b kf kg ki kj lk mz lm na lo nb kx nl nd ne nf dt translated"><strong class="bd mu">要执行的微流程</strong></li></ul><p id="8595" class="pw-post-body-paragraph kc kd hu bd b kf kg iv kh ki kj iy kk lk km kn ko lm kq kr ks lo ku kv kw kx hn dt translated">基于指定的限制，Java队列处理后将执行的微流。</p><ul class=""><li id="a6f5" class="mx my hu bd b kf kg ki kj lk mz lm na lo nb kx nl nd ne nf dt translated"><strong class="bd mu">微流量参数</strong></li></ul><p id="fb62" class="pw-post-body-paragraph kc kd hu bd b kf kg iv kh ki kj iy kk lk km kn ko lm kq kr ks lo ku kv kw kx hn dt translated">可以传递给微流的参数。如果您需要向您的微流传递多个参数，您可以修改它，使用一个临时对象来保存不同的对象ID和您的微流的必要参数。</p><ul class=""><li id="daf0" class="mx my hu bd b kf kg ki kj lk mz lm na lo nb kx nl nd ne nf dt translated"><strong class="bd mu">极限尺寸</strong></li></ul><p id="d14b" class="pw-post-body-paragraph kc kd hu bd b kf kg iv kh ki kj iy kk lk km kn ko lm kq kr ks lo ku kv kw kx hn dt translated">每秒执行队列中微流的限制。将此项设置为1将每秒执行一个微流。当未指定限制时，操作将恢复到常量“RateLimit”中指定的默认限制。建议使用常数，因为每次积分使用一个极限。</p><ul class=""><li id="da4f" class="mx my hu bd b kf kg ki kj lk mz lm na lo nb kx nl nd ne nf dt translated"><strong class="bd mu">限速队列</strong></li></ul><p id="3985" class="pw-post-body-paragraph kc kd hu bd b kf kg iv kh ki kj iy kk lk km kn ko lm kq kr ks lo ku kv kw kx hn dt translated">呼叫将添加到的ratelimit队列的名称。</p><p id="8cf0" class="pw-post-body-paragraph kc kd hu bd b kf kg iv kh ki kj iy kk lk km kn ko lm kq kr ks lo ku kv kw kx hn dt translated">Java动作将在指定的速率限制内执行微流。它使用一种内部排队机制，在这种机制下，将执行队列中的第一项，然后等待指定的时间(基于限制)，并执行队列中的第二项。Java队列不知道应该执行哪个微流，因此一个集成的所有微流应该使用同一个队列。</p></div><div class="ab cl lq lr hb ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hn ho hp hq hr"><h1 id="b2d1" class="lx ly hu bd lz ma mb mc md me mf mg mh ja mi jb mj jd mk je ml jg mm jh mn mo dt translated"><strong class="ak">动态速率限制</strong></h1><p id="a4a2" class="pw-post-body-paragraph kc kd hu bd b kf mp iv kh ki mq iy kk lk mr kn ko lm ms kr ks lo mt kv kw kx hn dt translated">该模块不会自动为您管理费率限额。如果您调用的集成有动态速率限制(如Spotify ),请确定一个较低的速率限制，以防止出现HTTP错误，如429(请求太多)。</p><p id="1f18" class="pw-post-body-paragraph kc kd hu bd b kf kg iv kh ki kj iy kk lk km kn ko lm kq kr ks lo ku kv kw kx hn dt translated">集成通常会在响应中回复一个HTTP状态代码429和一个Retry-After标头，指示在发出新请求之前要等待多长时间。根据这些消息调整您的速率限制。</p><h1 id="776a" class="lx ly hu bd lz ma nn mc md me no mg mh ja np jb mj jd nq je ml jg nr jh mn mo dt translated"><strong class="ak">例子</strong></h1><p id="91a8" class="pw-post-body-paragraph kc kd hu bd b kf mp iv kh ki mq iy kk lk mr kn ko lm ms kr ks lo mt kv kw kx hn dt translated">在我们的例子中，我们正在<strong class="bd mu">与两个外部音乐平台</strong>集成，每个平台都有不同的速率限制。<strong class="bd mu"> Spotify API </strong>服务根据连续30秒时间内的呼叫数量设置了动态速率限制。根据测试，我们发现<strong class="bd mu"> Spotify每分钟允许大约180个请求</strong>而不会返回错误429。<strong class="bd mu"> Discogs API </strong>服务<strong class="bd mu">允许每分钟60个请求</strong>。</p><h1 id="1a9f" class="lx ly hu bd lz ma nn mc md me no mg mh ja np jb mj jd nq je ml jg nr jh mn mo dt translated">Spotify </h1><p id="8eb7" class="pw-post-body-paragraph kc kd hu bd b kf mp iv kh ki mq iy kk lk mr kn ko lm ms kr ks lo mt kv kw kx hn dt translated">我们的艺术家数据库每天都会更新新信息。在本例中，我们只检索艺术家的基本信息:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff ns"><img src="../Images/e48c31bc20deadc12dc696e055ac9897.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iDd5KbMcYVA6m9jckC-GmQ.png"/></div></div></figure><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nt"><img src="../Images/433e627367cd7873d70aad9ad7a431d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iGQDOnHSsdGqwXt1IojVPg.png"/></div></div></figure><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nu"><img src="../Images/9f483856fff809a155322e47b1c9e5aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rxP4VAw0E932ts5nc0G92A.png"/></div></div></figure><h1 id="75d0" class="lx ly hu bd lz ma nn mc md me no mg mh ja np jb mj jd nq je ml jg nr jh mn mo dt translated"><strong class="ak">迪斯科舞厅</strong></h1><p id="b270" class="pw-post-body-paragraph kc kd hu bd b kf mp iv kh ki mq iy kk lk mr kn ko lm ms kr ks lo mt kv kw kx hn dt translated">在我们更新了我们的artist对象之后，我们希望根据找到的名称查询Discogs数据库。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nv"><img src="../Images/7700069b1354d7000b97965533e45857.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U6_41slnQCsN9vBNHtBVGg.png"/></div></div></figure><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nw"><img src="../Images/6188ef01364fc5649d347c1f85da0523.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wYz7GfvYyUPJB1op2lKAJg.png"/></div></div></figure><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nx"><img src="../Images/2406ef30a0c934a4f5fdf6b1e7c62b51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VbfrjfllBJUd7ThAtCKSxA.png"/></div></div></figure><h2 id="ec68" class="ny ly hu bd lz nz oa ob md oc od oe mh lk of og mj lm oh oi ml lo oj ok mn ol dt translated">感谢您的阅读！</h2><p id="953a" class="pw-post-body-paragraph kc kd hu bd b kf mp iv kh ki mq iy kk lk mr kn ko lm ms kr ks lo mt kv kw kx hn dt translated">我们希望你喜欢阅读这篇文章，如果你有任何想法或问题，请在这里留下评论。</p><h2 id="df74" class="ny ly hu bd lz nz oa ob md oc od oe mh lk of og mj lm oh oi ml lo oj ok mn ol dt translated">阅读更多</h2><div class="om on fm fo oo op"><a href="https://github.com/appronto/ratelimiter" rel="noopener  ugc nofollow" target="_blank"><div class="oq ab ej"><div class="or ab os cl cj ot"><h2 class="bd hv fv z el ou eo ep ov er et ht dt translated">GitHub-approto/rate limiter:限制一段时间内微流调用的数量</h2><div class="ow l"><h3 class="bd b fv z el ou eo ep ov er et ek translated">Ratelimiter限制一段时间内每秒的微流调用次数。特点:极限可由…设定</h3></div><div class="ox l"><p class="bd b gc z el ou eo ep ov er et ek translated">github.com</p></div></div><div class="oy l"><div class="oz l pa pb pc oy pd jt op"/></div></div></a></div><div class="om on fm fo oo op"><a href="https://developer.spotify.com/documentation/web-api/guides/rate-limits/" rel="noopener  ugc nofollow" target="_blank"><div class="oq ab ej"><div class="or ab os cl cj ot"><h2 class="bd hv fv z el ou eo ep ov er et ht dt translated">费率限制|面向开发者的Spotify</h2><div class="ow l"><h3 class="bd b fv z el ou eo ep ov er et ek translated">如果您的应用程序在短时间内发出大量的Web API请求，那么它可能会收到来自…的429错误响应</h3></div><div class="ox l"><p class="bd b gc z el ou eo ep ov er et ek translated">developer.spotify.com</p></div></div><div class="oy l"><div class="pe l pa pb pc oy pd jt op"/></div></div></a></div><div class="om on fm fo oo op"><a href="https://www.discogs.com/developers" rel="noopener  ugc nofollow" target="_blank"><div class="oq ab ej"><div class="or ab os cl cj ot"><h2 class="bd hv fv z el ou eo ep ov er et ht dt translated">Discogs API文档</h2><div class="ow l"><h3 class="bd b fv z el ou eo ep ov er et ek translated">这里是你编码所有东西的地方！Discogs API允许开发人员构建他们自己的Discogs驱动的…</h3></div><div class="ox l"><p class="bd b gc z el ou eo ep ov er et ek translated">www.discogs.com</p></div></div></div></a></div></div><div class="ab cl lq lr hb ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="hn ho hp hq hr"><p id="9df3" class="pw-post-body-paragraph kc kd hu bd b kf kg iv kh ki kj iy kk lk km kn ko lm kq kr ks lo ku kv kw kx hn dt translated"><em class="ke">来自发布者- </em></p><p id="e041" class="pw-post-body-paragraph kc kd hu bd b kf kg iv kh ki kj iy kk lk km kn ko lm kq kr ks lo ku kv kw kx hn dt translated"><em class="ke">如果你喜欢这篇文章，你可以在我们的</em> <a class="ae mw" href="https://medium.com/mendix" rel="noopener"> <em class="ke">中页</em> </a> <em class="ke">找到更多喜欢的。对于精彩的视频和直播会话，您可以前往</em><a class="ae mw" href="https://www.mendix.com/live/" rel="noopener ugc nofollow" target="_blank"><em class="ke">MxLive</em></a><em class="ke">或我们的社区</em><a class="ae mw" href="https://www.youtube.com/c/MendixCommunity/community" rel="noopener ugc nofollow" target="_blank"><em class="ke">Youtube PAG</em></a><em class="ke">e .</em></p><p id="5aab" class="pw-post-body-paragraph kc kd hu bd b kf kg iv kh ki kj iy kk lk km kn ko lm kq kr ks lo ku kv kw kx hn dt translated"><em class="ke">希望入门的创客，可以注册一个</em> <a class="ae mw" href="https://signup.mendix.com/link/signup/?source=direct" rel="noopener ugc nofollow" target="_blank"> <em class="ke">免费账号</em> </a> <em class="ke">，通过我们的</em> <a class="ae mw" href="https://academy.mendix.com/link/home" rel="noopener ugc nofollow" target="_blank"> <em class="ke">学苑</em> </a> <em class="ke">获得即时学习。</em></p><p id="f08d" class="pw-post-body-paragraph kc kd hu bd b kf kg iv kh ki kj iy kk lk km kn ko lm kq kr ks lo ku kv kw kx hn dt translated">有兴趣加入我们的社区吗？加入我们的 <a class="ae mw" href="https://join.slack.com/t/mendixcommunity/shared_invite/zt-hwhwkcxu-~59ywyjqHlUHXmrw5heqpQ" rel="noopener ugc nofollow" target="_blank"> <em class="ke">松弛社区频道</em> </a> <em class="ke">。</em></p></div></div>    
</body>
</html>