<html>
<head>
<title>Making Purple Eye DIY Dancing Robot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">制作紫眼DIY跳舞机器人</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/making-purple-eye-diy-dancing-robot-fa03d0f658e2?source=collection_archive---------5-----------------------#2016-11-24">https://medium.com/google-developer-experts/making-purple-eye-diy-dancing-robot-fa03d0f658e2?source=collection_archive---------5-----------------------#2016-11-24</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="df26" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">用跳舞的紫色机器人演示网络蓝牙和物理网络</h2></div><p id="9224" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在过去一年左右的时间里，我已经就像网络蓝牙T2和物理网络T4这样的技术做了很多演讲和研讨会。在这些演示过程中，我喜欢给人们一个玩技术的机会，让他们专心致志地研究代码，通常会玩得很开心。我也喜欢使用像<a class="ae js" rel="noopener" href="/@urish/building-simon-with-angular2-iot-fceb78bb18e5#.afwk8lctc"> ng-simon </a>游戏和<a class="ae js" rel="noopener" href="/ionic-and-the-mobile-web/smart-bulbs-in-the-angularconnect-iot-workshop-845a41882dfb#.di9zungks">智能灯泡</a>这样的道具来真正“接触”这项技术。本着这种精神，我制造了一个机器人！</p><p id="0398" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">见见<a class="ae js" href="https://twitter.com/PurpleEyeBot" rel="noopener ugc nofollow" target="_blank">紫眼</a>，一个3D打印的蓝牙低能耗机器人，我用它来演示网络蓝牙是如何工作的:</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es jt"><img src="../Images/879a97f113567db01d87323fef81f2a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Q7zwU7qLcTnxk6cm9zZiZw.gif"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Yum, candy!</figcaption></figure><p id="9f9c" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">整洁，对不对？我根据我在<a class="ae js" href="http://www.thingiverse.com/thing:39263" rel="noopener ugc nofollow" target="_blank"> Thingiverse </a>上找到的一个模型设计了这个机器人，并在<a class="ae js" href="https://printm3d.com/themicro/" rel="noopener ugc nofollow" target="_blank"> M3D Micro </a>上打印了它。</p><p id="7604" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">该机器人有四个伺服系统为其运动提供动力，所有这些都可以通过ble控制，每条腿都由两个伺服系统提供动力，一个控制腿的角度，一个控制脚的旋转。</p><p id="5225" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">紫眼公开了两项服务:电池服务，报告电池剩余电量的百分比，以及另一项控制伺服系统的服务(编号<code class="du kj kk kl km b">5100</code>)。此外，它使用物理网络广播控制机器人的web应用程序的地址，因此周围的每个人都会收到关于其存在的通知，可以单击它打开网页，连接到机器人并控制它:</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es kn"><img src="../Images/3ee4103ed0e5a5f35543a063a85410b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X7NmYdRCixMUfjA0nhp2ag.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Purple Eye’s Physical Web notification</figcaption></figure><p id="16f6" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">你可以在GitHub上找到这个机器人背后的所有代码:<a class="ae js" href="https://github.com/urish/purple-eye" rel="noopener ugc nofollow" target="_blank">https://github.com/urish/purple-eye</a></p><h2 id="66bb" class="ko kp hh bd kq kr ks kt ku kv kw kx ky jf kz la lb jj lc ld le jn lf lg lh li bi translated">部件和零件</h2><p id="e4e3" class="pw-post-body-paragraph iw ix hh iy b iz lj ii jb jc lk il je jf ll jh ji jj lm jl jm jn ln jp jq jr ha bi translated">虽然紫眼最酷的部分可能是它的网络蓝牙和物理网络演示功能，但它仍然很有趣。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es lo"><img src="../Images/b0c0f7cad805b74ca95a0b36330a7168.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KVCE_C91VXZqQso78YSgOA.jpeg"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">“We can rebuild him. We have the technology.”</figcaption></figure><p id="a2b6" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这些部件组成了机器人:</p><ul class=""><li id="e175" class="lp lq hh iy b iz ja jc jd jf lr jj ls jn lt jr lu lv lw lx bi translated">3D打印的身体(头顶，头底，两个膝盖，两条腿，眼白，眼睛虹膜，瞳孔)，基于我在Thingiverse上找到的一个模型:<a class="ae js" href="http://www.thingiverse.com/thing:39263" rel="noopener ugc nofollow" target="_blank">http://www.thingiverse.com/thing:39263</a></li><li id="e619" class="lp lq hh iy b iz ly jc lz jf ma jj mb jn mc jr lu lv lw lx bi translated">微控制器板(详情如下)</li><li id="c8e3" class="lp lq hh iy b iz ly jc lz jf ma jj mb jn mc jr lu lv lw lx bi translated">电机板(用于将电源分配给电机)</li><li id="7481" class="lp lq hh iy b iz ly jc lz jf ma jj mb jn mc jr lu lv lw lx bi translated">一束连接线</li><li id="ff9d" class="lp lq hh iy b iz ly jc lz jf ma jj mb jn mc jr lu lv lw lx bi translated">4个微伺服电机——我用的是PowerHD <a class="ae js" href="https://www.pololu.com/product/2145" rel="noopener ugc nofollow" target="_blank"> HD-1600A </a></li><li id="e4c1" class="lp lq hh iy b iz ly jc lz jf ma jj mb jn mc jr lu lv lw lx bi translated"><a class="ae js" href="https://www.adafruit.com/products/1578" rel="noopener ugc nofollow" target="_blank"> 500毫安脂电池</a>和一个<a class="ae js" href="https://www.adafruit.com/product/261" rel="noopener ugc nofollow" target="_blank"> 2针JST连接器</a></li><li id="0ae6" class="lp lq hh iy b iz ly jc lz jf ma jj mb jn mc jr lu lv lw lx bi translated">12个用于安装伺服系统的螺钉</li></ul><h2 id="038e" class="ko kp hh bd kq kr ks kt ku kv kw kx ky jf kz la lb jj lc ld le jn lf lg lh li bi translated">3D打印和一种特殊的紫色</h2><p id="5a20" class="pw-post-body-paragraph iw ix hh iy b iz lj ii jb jc lk il je jf ll jh ji jj lm jl jm jn ln jp jq jr ha bi translated">为了让紫色眼睛更加有趣，我使用了一种特殊的紫色细丝来进行3D打印:一种当被触摸时会从紫色变成粉红色的细丝，或者通常被加热到30摄氏度以上。这也意味着如果你将机器人放在阳光下几分钟，它就会变成粉红色(与它的创造者没有什么不同)。</p><p id="2159" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">由于喷嘴的热量，零件在离开打印机时已经是粉红色的了。它们需要一两天才会变成紫色(除非你把它们放在冰箱里几分钟)。</p><p id="d88f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你想复制这个造型，你可能会想用白色细丝印出白色的眼睛，黑色印出瞳孔，其他颜色(可能是蓝色或绿色)印出虹膜——我用的是青色。在M3D Micro上打印所有东西总共需要大约24小时，尽管它不是市场上最快的打印机。</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="9783" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">此外，我不得不改变一些部分的尺寸，以便获得紧密的配合:特别是，头顶部(ShellTop_fixed.stl)是按原始大小的102%打印的，瞳孔是按原始大小的90%打印的。</p><p id="87db" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">打印完所有东西后，我用强力胶把眼睛、瞳孔和虹膜粘在一起，然后把整个单元粘在头部底座上。头顶部通过摩擦安装在所有东西的顶部，当我需要访问它的大脑时，这很方便:</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mf"><img src="../Images/d82b9b7714d4ca481a49b30e698a8961.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yyHK5p5JT7IoIDkwGj9duA.jpeg"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Brain surgery! Photo credit to my friend <a class="ae js" href="https://plus.google.com/+FrancoisBeaufort/posts/E2fC7sKXKLF" rel="noopener ugc nofollow" target="_blank">François</a></figcaption></figure><p id="39ba" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">以下是打印/构建过程中的一些照片:</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mg"><img src="../Images/26e9d6257342bdde1320c7f6af62c522.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7Ec4wC9IfT-hFd5UtuBw2w.jpeg"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Fresh-printed body piece</figcaption></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mh"><img src="../Images/96bb72641a621f7628237382fe64a8f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UZjaL2znM53lGV7VrkBTJw.jpeg"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">The foot on the right is fresh from the printer, while the foot on the left has had time to cool</figcaption></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mi"><img src="../Images/8390bb5100849cb80a92d8508972ac18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZXjgITw0aHgxehkjsnPSbg.jpeg"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Another top view</figcaption></figure><h2 id="44d4" class="ko kp hh bd kq kr ks kt ku kv kw kx ky jf kz la lb jj lc ld le jn lf lg lh li bi translated">机器人大脑:选择微控制器板</h2><p id="2d45" class="pw-post-body-paragraph iw ix hh iy b iz lj ii jb jc lk il je jf ll jh ji jj lm jl jm jn ln jp jq jr ha bi translated">最初我使用的是<a class="ae js" href="https://learn.adafruit.com/adafruit-feather-32u4-bluefruit-le/overview" rel="noopener ugc nofollow" target="_blank">Adafruit Feather 32u 4 blue fruit LE</a>，这是一块结合了<a class="ae js" href="http://www.atmel.com/devices/atmega32.aspx" rel="noopener ugc nofollow" target="_blank"> ATmega32 </a>微控制器(与Arduino使用的相同)和nRF51822(一种高性价比的BLE芯片，简称nRF51)的小电路板。</p><p id="5caf" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">虽然它做到了，但我对结果并不满意——我需要大量代码来在ATmega32微控制器和nRF51芯片之间进行通信。你可以在这里找到我为那块板<a class="ae js" href="https://github.com/urish/purple-eye/blob/master/firmware/purple-eye/purple-eye.ino" rel="noopener ugc nofollow" target="_blank">使用的固件代码</a>。</p><p id="a415" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我去寻找一种替代解决方案，并发现nRF51芯片实际上可以编程，这意味着我应该能够在没有ATMega微控制器的情况下使用它。这将降低功耗(给机器人更长的电池寿命)，也减少了电路板的尺寸(毕竟，我们在机器人头部内的空间有限)。它还通过消除两个微控制器相互通信和同步的需要，简化了代码。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mi"><img src="../Images/76aab2bebf2961b2cd7d4d7efba69d6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7rUJOyWLw7Yyk6s2-bpXzA.jpeg"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Brain #1 on the left, Brain #2 on the right. Brain #2 fits much better!</figcaption></figure><p id="c4d8" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在寻找只携带nRF51而没有一堆额外东西的电路板后，我找到了<a class="ae js" href="http://redbearlab.com/blenano/" rel="noopener ugc nofollow" target="_blank"> RedBearLab BLE纳米</a>，我用它对机器人的硬件进行了第二次修订。该板的优点是它带有一个USB编程器MK20，允许您使用熟悉的Arduino软件直接对其进行编程，因此您不需要复杂的设置。如果您设置了Arduino开发环境，您可以在几分钟内启动并运行。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mj"><img src="../Images/30848f87bb90388cebb0e6c13fcf629a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kAbUnoxSlk_CMArBSNkBEA.png"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Add BLE Nano support through Arduino’s Board Manager</figcaption></figure><p id="577f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">你可以找到nRF51专用固件的源代码，它运行在BLE纳米<a class="ae js" href="https://github.com/urish/purple-eye/tree/master/firmware/purple-eye-nano" rel="noopener ugc nofollow" target="_blank">这里</a>(别担心！下面我来解释代码)。</p><h2 id="4d6a" class="ko kp hh bd kq kr ks kt ku kv kw kx ky jf kz la lb jj lc ld le jn lf lg lh li bi translated">接线图</h2><p id="ae2f" class="pw-post-body-paragraph iw ix hh iy b iz lj ii jb jc lk il je jf ll jh ji jj lm jl jm jn ln jp jq jr ha bi translated">这是显示如何将CPU板与4个伺服系统和外部LiPo电池连接的连接图:</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es mk"><img src="../Images/fa14432749f685e5c20af170b93a8d65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*z4HhoisUIYq027E8mK9KFA.png"/></div></figure><p id="cef2" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">连接非常简单P28、P29、P15、P07引脚连接到不同的伺服电机，电池正极连接到VIN引脚，负极连接到GND引脚。</p><p id="e80b" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我用一对10KΩ的电阻组成了一个<a class="ae js" href="https://en.wikipedia.org/wiki/Voltage_divider" rel="noopener ugc nofollow" target="_blank">分压器</a>——将电池的电压分压2，并将结果连接到BLE Nano的P06引脚。你需要将电压除以2，因为LiPo电池可以产生高达4.2伏的电压，这可能会损害BLE纳米(仅3.3伏)。P06是一个模拟输入引脚，它允许我们读取电池的电压水平，并通过BLE电池服务报告。</p><h2 id="b32a" class="ko kp hh bd kq kr ks kt ku kv kw kx ky jf kz la lb jj lc ld le jn lf lg lh li bi translated">伺服+电源板</h2><p id="1559" class="pw-post-body-paragraph iw ix hh iy b iz lj ii jb jc lk il je jf ll jh ji jj lm jl jm jn ln jp jq jr ha bi translated">我决定制作一个PCB来分割电机的电源，并添加一个小开关，让我可以打开/关闭机器人，而不必每次都连接/断开电池，而不是手动连接所有东西，这将在机器人的头部内造成混乱。</p><p id="cfaa" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我从<a class="ae js" href="https://oshpark.com/" rel="noopener ugc nofollow" target="_blank"> OSH Park </a>订购了这块电路板，它非常适合紫眼公司——因为他们生产紫色PCB:</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es ml"><img src="../Images/bcd0babdd6622febce60e78624622255.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/format:webp/1*wgRoG0iYIYlavRXlFVAEIQ.png"/></div></figure><p id="2e98" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">你可以在这里找到棋盘<a class="ae js" href="https://oshpark.com/shared_projects/8y2vaFC5" rel="noopener ugc nofollow" target="_blank">，在这里</a>找到老鹰源文件<a class="ae js" href="https://github.com/urish/purple-eye/tree/master/pcb" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mi"><img src="../Images/64b5ec28ee38dc36f96991059b4cef72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z95buZstJUW8cNNIMWEhQw.jpeg"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">An early revision of the PCB boards (the assembled version is on the right)</figcaption></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mi"><img src="../Images/1876eb3178bbd5c8d00421eea85f3496.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bdoGGHwq7s6CL-SZxNQWAw.jpeg"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Hooked up and ready to go!</figcaption></figure><h2 id="0798" class="ko kp hh bd kq kr ks kt ku kv kw kx ky jf kz la lb jj lc ld le jn lf lg lh li bi translated">功率消耗</h2><p id="9926" class="pw-post-body-paragraph iw ix hh iy b iz lj ii jb jc lk il je jf ll jh ji jj lm jl jm jn ln jp jq jr ha bi translated">我为机器人设定的目标之一是能够长时间使用电池(几天以上)。</p><p id="8721" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我测得修订版1的功耗(使用Adafruit Feather 32u4 Bluefruit LE芯片)在空闲状态下约为10mA，而修订版2的Nano BLE板功耗约为1.4mA，只需关闭板上的LED即可进一步降至1.1mA。</p><p id="42ee" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">然而，电路上还有另一个饥饿的消费者:伺服消耗约26mA，而闲置。这意味着总功耗约为27mA。电池的容量为500毫安时，这意味着我们可以在空闲模式下运行机器人500/27，或18.5小时。</p><p id="24a2" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这还不算太糟糕，但在下一版电路板中，我计划添加一个MOSFET晶体管，允许在空闲时切断电机的电源，这将导致300-400小时的空闲时间，或大约两周。</p><h2 id="a7f6" class="ko kp hh bd kq kr ks kt ku kv kw kx ky jf kz la lb jj lc ld le jn lf lg lh li bi translated">代码分解</h2><p id="0dc4" class="pw-post-body-paragraph iw ix hh iy b iz lj ii jb jc lk il je jf ll jh ji jj lm jl jm jn ln jp jq jr ha bi translated"><em class="mm">这是一个针对BLE Nano的分解固件，在这里可以找到</em><a class="ae js" href="https://github.com/urish/purple-eye/tree/3d53cd315897919a7ec53d500fc1a8d1951fc6b9/firmware/purple-eye-nano" rel="noopener ugc nofollow" target="_blank"><em class="mm"/></a><em class="mm">。</em></p><p id="d3fb" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">源代码由两部分组成:实际的固件和一个用于控制nRF51伺服系统的小库。BLE nano附带的Arduino库包括一个内置的伺服库，但它不能很好地与蓝牙无线电配合使用——在某些情况下，蓝牙无线电代码在发送伺服控制脉冲的过程中发生作用，它打乱了脉冲的定时，导致机器人不情愿地扭曲。因此，我编写了自己的兼容实现，它使用nRF51无线电功能来安排“安静时间”，这时它可以向伺服系统发送控制信号，而不会被无线电中断。</p><p id="aa3a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">至于实际的机器人逻辑，<code class="du kj kk kl km b"><a class="ae js" href="https://github.com/urish/purple-eye/blob/3d53cd315897919a7ec53d500fc1a8d1951fc6b9/firmware/purple-eye-nano/purple-eye-nano.ino#L84" rel="noopener ugc nofollow" target="_blank">setup()</a></code>函数初始化一切。它设置了一个用于调试的串行控制台，并关闭内置的LED以节省电能。</p><p id="1837" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如上所述，机器人使用物理网络来宣布其存在，并共享控制它的网页的链接。你可以<a class="ae js" href="https://github.com/urish/purple-eye/blob/3d53cd315897919a7ec53d500fc1a8d1951fc6b9/firmware/purple-eye-nano/purple-eye-nano.ino#L19" rel="noopener ugc nofollow" target="_blank">在这里</a>看到实际的Eddystone广告有效载荷——机器人定期广播的那个，这就是我们如何实现物理网络的。</p><p id="344b" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">可能有点令人困惑的一件事是<code class="du kj kk kl km b"><em class="mm">accumulateAdvertisingPayload</em></code>。这配置了设备向附近的设备通告什么数据。它公布了机器人提供的服务列表(见第101行)，因此Web Bluetooth将能够看到这些服务，并让网页与设备连接。它还向全世界发送物理网络(eddystone)有效载荷(第102行)。如果你想了解更多关于这种方法与传统蓝牙扫描的对比，这里有一个关于扫描响应与广告有效载荷的<a class="ae js" href="http://PurpleEye" rel="noopener ugc nofollow" target="_blank">解释。</a></p><h2 id="24c4" class="ko kp hh bd kq kr ks kt ku kv kw kx ky jf kz la lb jj lc ld le jn lf lg lh li bi translated">控制机器人</h2><p id="cf78" class="pw-post-body-paragraph iw ix hh iy b iz lj ii jb jc lk il je jf ll jh ji jj lm jl jm jn ln jp jq jr ha bi translated">我建立了一个简单的网页来控制机器人，它利用网络蓝牙连接到nRF51芯片并命令它。通过向服务号<code class="du kj kk kl km b">5100</code>的特征号<code class="du kj kk kl km b">5200</code>写入4个字节来控制伺服系统(如代码中的<a class="ae js" href="https://github.com/urish/purple-eye/blob/3d53cd315897919a7ec53d500fc1a8d1951fc6b9/firmware/purple-eye-nano/purple-eye-nano.ino#L33" rel="noopener ugc nofollow" target="_blank">所示)，每个字节控制单个伺服系统的位置。</a></p><p id="0cf8" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">网页包括一个<a class="ae js" href="https://github.com/urish/purple-eye/blob/3d53cd315897919a7ec53d500fc1a8d1951fc6b9/web/purple-eye.js#L24" rel="noopener ugc nofollow" target="_blank">连接按钮</a>，一个显示电池当前状态的小电池指示器(<a class="ae js" href="https://github.com/urish/purple-eye/blob/3d53cd315897919a7ec53d500fc1a8d1951fc6b9/web/purple-eye.js#L10" rel="noopener ugc nofollow" target="_blank">使用字体Awesome </a>)，两个让机器人站直或张开腿的按钮，一个关闭电机的休息按钮，还有一个让机器人摇摆的<a class="ae js" href="https://github.com/urish/purple-eye/blob/3d53cd315897919a7ec53d500fc1a8d1951fc6b9/web/purple-eye.js#L118" rel="noopener ugc nofollow" target="_blank">舞蹈按钮</a>，以及一个由我的朋友<a class="ae js" rel="noopener" href="/@tomteman">汤姆·特曼</a>贡献的<a class="ae js" href="https://github.com/urish/purple-eye/blob/3d53cd315897919a7ec53d500fc1a8d1951fc6b9/web/purple-eye.js#L100" rel="noopener ugc nofollow" target="_blank">摆振按钮</a>。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es mn"><img src="../Images/45f68bd5443ed1e582e2e5203d29355b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/1*kz1m0U5LrNfj8CmGRvx5Nw.gif"/></div><figcaption class="kf kg et er es kh ki bd b be z dx">Using Web Bluetooth to pair with the robot: this is what you see if you click the Physical Web notification</figcaption></figure><p id="7317" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">正如您通过上面的链接所看到的，Dance和Shimmy实际上都是在浏览器中使用计时器实现的，这意味着这些运动的实际时间取决于您的手机有多忙，还取决于机器人和手机之间的蓝牙链接质量:</p><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="mo me l"/></div></figure><p id="40f1" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">一个有趣的结果是，如果你锁定设备的屏幕或切换到不同的应用程序，Chrome标签的优先级会很低，机器人会开始缓慢移动——因为计时器会每秒钟左右触发一次，而不是每隔几毫秒。</p><p id="ced6" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">该网页是超级基本的，可以使用一些CSS爱。这是一个开源项目，所以如果你愿意，你可以发送一个pull请求，让它看起来更漂亮，或者甚至分叉它，建立你自己的控制页面，也许有一些新的动作:)</p><h2 id="13b3" class="ko kp hh bd kq kr ks kt ku kv kw kx ky jf kz la lb jj lc ld le jn lf lg lh li bi translated">未来的增强</h2><p id="bae3" class="pw-post-body-paragraph iw ix hh iy b iz lj ii jb jc lk il je jf ll jh ji jj lm jl jm jn ln jp jq jr ha bi translated">如上所述，我想通过在不使用时切断伺服系统的电源来降低机器人的功耗，从而接近一次电池充电连续运行几周的时间。</p><p id="5e34" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在展示机器人时，我收到了许多其他的改进建议，包括在眼睛里放一个小摄像头，并添加一个小扬声器，这样它就可以在跳舞时播放音乐或发出声音。这两个肯定都很有趣，但我不认为nRF51将能够处理相机或合成有趣的声音。此外，BLE不适合流视频，因为带宽低，每秒只有几千字节。也就是说，我可以使用我在Kickstarter上支持的一个<a class="ae js" href="https://onion.io/" rel="noopener ugc nofollow" target="_blank"> Onion Omega 2 </a>板，通过WiFi播放视频。</p><p id="e5e8" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我可以走的另一个方向——我认为这将是非常有趣和有趣的工作——是添加一些传感器:加速度计、磁力计或陀螺仪，这样机器人就可以感知其方向并采取相应的行动。最终，我甚至可以根据这些传感器的输入数据教它如何行走，这将会是<em class="mm">非常</em>酷。</p><p id="b01c" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">不过，在那之前，紫色机器人和我会继续去工作室，观光，交朋友！</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mg"><img src="../Images/9ddf59a9bc2227efc318f72861792416.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kaEmwZnj_F3aqKe2IN0ucQ.jpeg"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Purple Eye surveys the crowd in Chrome Dev Summit</figcaption></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mi"><img src="../Images/eb55570bfa6e90790c58321f7acb179e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_abaBpJJL0vvpvzf3Mh3jw.jpeg"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Purple Eye visits the London Eye</figcaption></figure><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="mp me l"/></div></figure><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mg"><img src="../Images/cf91e3ccc7c56713683fb3fde59ad0b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YcIvNiCC7VR8jChVBVBiOA.jpeg"/></div></div><figcaption class="kf kg et er es kh ki bd b be z dx">Robots just wanna have fun, too!</figcaption></figure><figure class="ju jv jw jx fd jy"><div class="bz dy l di"><div class="mp me l"/></div></figure><p id="2746" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="mm">一如既往，如果你有其他的建议，或者关于紫眼的问题，请在评论中告诉我:)</em></p></div></div>    
</body>
</html>