<html>
<head>
<title>Preparing your apps for the latest features in Google Play’s billing system</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为您的应用程序准备Google Play计费系统的最新功能</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/preparing-your-apps-for-the-latest-features-in-google-plays-billing-system-210ed5e50eaa?source=collection_archive---------0-----------------------#2020-10-02">https://medium.com/androiddevelopers/preparing-your-apps-for-the-latest-features-in-google-plays-billing-system-210ed5e50eaa?source=collection_archive---------0-----------------------#2020-10-02</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/45014fa411aaeb19d171c4eaf5474773.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4tFID6X2eXj09s9wsIn4ug.jpeg"/></div></div></figure><div class=""/><p id="65f8" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">作为Android 11发布的一部分，<a class="ae jn" href="https://android-developers.googleblog.com/2020/06/new-features-to-acquire-and-retain-subscribers.html" rel="noopener ugc nofollow" target="_blank"> Google Play团队宣布了新功能</a>来帮助你<a class="ae jn" href="https://developer.android.com/google/play/billing/subs" rel="noopener ugc nofollow" target="_blank">获得和保留你的Android应用的订户</a>。作为这项工作的一部分，Google Play将改变一些订阅功能的默认设置。在本帖中，我们将看看这些变化，以及如何确保您的应用程序准备就绪。</p><p id="482f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">首先，让我们看看从2020年11月1日开始将会发生的变化。</p><figure class="jp jq jr js fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es jo"><img src="../Images/3d7f130861b51c08fffd561a6de348b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XkHluRlZJzwKccHbf7fxtQ.png"/></div></div></figure><p id="9b3b" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在本文的其余部分，我们将深入探讨这些变化如何影响你的应用或游戏。对于每个功能，我们将基于两种不同的情况讨论它如何影响您的应用程序:1)您的应用程序不使用后端服务器跟踪订阅状态2)您的应用程序有一个后端服务器，它也利用实时开发者通知来跟踪订阅状态。</p><h1 id="a43e" class="jt ju hs bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">账户持有</h1><p id="9ade" class="pw-post-body-paragraph ip iq hs ir b is kr iu iv iw ks iy iz ja kt jc jd je ku jg jh ji kv jk jl jm ha bi translated"><strong class="ir ht">此功能的含义</strong>:当用户尝试续订，但由于付款问题而导致续订失败时，用户将进入<em class="kw">帐户冻结</em>期。此期限最长为30天，在此期间，用户将失去对订阅的访问权限。</p><p id="878f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">如果你的应用没有跟踪后端服务器的订阅状态</strong>:如果你的应用依赖于<code class="du kx ky kz la b">queryPurchases()</code>的结果来获得最新的订阅状态，你就不需要做任何额外的事情来支持账户持有。<code class="du kx ky kz la b"><a class="ae jn" href="https://developer.android.com/reference/com/android/billingclient/api/BillingClient#queryPurchases(java.lang.String)" rel="noopener ugc nofollow" target="_blank">BillingClient.queryPurchases()</a></code>如果套餐处于账户持有期，将不会退还套餐。一旦用户确定他们的支付方式，订阅将作为<code class="du kx ky kz la b">queryPurchases()</code>的一部分再次返还。</p><p id="22a5" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">如果你的应用有一个利用RTDN跟踪订阅状态的后端服务器</strong>:一旦用户进入账户持有期，就会发送<code class="du kx ky kz la b">SUBSCRIPTION_ON_HOLD</code>通知。一旦用户解决了支付问题并再次成功订阅，将会发送<code class="du kx ky kz la b">SUBSCRIPTION_RECOVERED</code>通知。确保您的后端处理这些<a class="ae jn" href="https://developer.android.com/google/play/billing/rtdn-reference" rel="noopener ugc nofollow" target="_blank">通知</a>以获得用户订阅的最新状态。</p><p id="6b31" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在<a class="ae jn" href="https://developer.android.com/google/play/billing/subs#account-hold" rel="noopener ugc nofollow" target="_blank">官方文档</a>中阅读更多关于账户冻结以及如何正确处理这种状态的信息。</p><h1 id="3960" class="jt ju hs bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">帐户恢复</h1><p id="dc2b" class="pw-post-body-paragraph ip iq hs ir b is kr iu iv iw ks iy iz ja kt jc jd je ku jg jh ji kv jk jl jm ha bi translated"><strong class="ir ht">此功能的含义</strong>:用户可以在当前计费周期的订阅到期之前取消续订。当帐户恢复打开时，用户可以在订阅到期前通过点击Play Store应用程序中的<strong class="ir ht">重新订阅</strong>选项来恢复他们已取消的订阅。这将恢复订阅，就像用户从未取消过它一样。如果订阅已过期，用户必须重新订阅。</p><p id="c7e8" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">如果你的应用没有通过后端服务器</strong>跟踪订阅状态:如果你的应用依靠<code class="du kx ky kz la b">queryPurchases()</code>的结果来获得最新的订阅状态，你就不需要做任何额外的事情来支持账户恢复。<code class="du kx ky kz la b"><a class="ae jn" href="https://developer.android.com/reference/com/android/billingclient/api/BillingClient#queryPurchases(java.lang.String)" rel="noopener ugc nofollow" target="_blank">BillingClient.queryPurchases()</a></code>将继续返还套餐，直到套餐到期，即使用户在下一个计费周期之前提前取消了套餐。</p><p id="af1d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">如果你的应用有一个利用RTDN跟踪订阅状态的后端服务器</strong>:当用户恢复订阅时会发送<code class="du kx ky kz la b">SUBSCRIPTION_RESTARTED</code>通知。如果你的应用程序显示用户界面来通知用户一个即将到期的订阅，请确保在你的后端收到这个通知后更新用户界面。</p><p id="b7d5" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在<a class="ae jn" href="https://developer.android.com/google/play/billing/subs#restore" rel="noopener ugc nofollow" target="_blank">官方文档</a>中阅读更多关于账户恢复以及如何正确处理这种状态的信息。</p><h1 id="e010" class="jt ju hs bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">帐户暂停</h1><p id="5c89" class="pw-post-body-paragraph ip iq hs ir b is kr iu iv iw ks iy iz ja kt jc jd je ku jg jh ji kv jk jl jm ha bi translated"><strong class="ir ht">该功能的含义</strong>:用户可以选择将订阅暂停一周到三个月。只有在当前计费周期结束后，套餐暂停才会生效。当订阅暂停时，用户不应访问订阅的功能。<code class="du kx ky kz la b"><a class="ae jn" href="https://developer.android.com/reference/com/android/billingclient/api/BillingClient#queryPurchases(java.lang.String)" rel="noopener ugc nofollow" target="_blank">queryPurchases()</a></code>中不返回暂停的订阅。</p><p id="63d5" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">目前在Play Console中默认不开启账号暂停，但从2020年11月1日开始会自动开启。如果您的应用程序尚未准备好处理帐户暂停，您可以在Play Console中手动关闭该功能。</p><p id="8417" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">如果你的应用没有通过后端服务器</strong>跟踪订阅状态:如果你的应用依靠<code class="du kx ky kz la b">queryPurchases()</code>的结果来获得最新的订阅状态，你就不需要做任何额外的事情。<code class="du kx ky kz la b"><a class="ae jn" href="https://developer.android.com/reference/com/android/billingclient/api/BillingClient#queryPurchases(java.lang.String)" rel="noopener ugc nofollow" target="_blank">BillingClient.queryPurchases()</a></code>不返回暂停的订阅。</p><p id="5642" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">如果你的应用有一个利用RTDN跟踪订阅状态的后端服务器</strong>:当用户开始暂停订阅时，会发送<code class="du kx ky kz la b">SUBSCRIPTION_PAUSE_SCHEDULE_CHANGED</code>通知。此时，在当前计费周期结束之前，订阅仍然有效。当订阅进入暂停状态时，会发送一个<code class="du kx ky kz la b">SUBSCRIPTION_PAUSED </code>通知。当订阅自动恢复或者如果用户手动恢复订阅，则发送<code class="du kx ky kz la b">SUBSCRIPTION_RENEWED </code>通知。</p><p id="3403" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在<a class="ae jn" href="https://developer.android.com/google/play/billing/subs#pause" rel="noopener ugc nofollow" target="_blank">官方文档</a>中阅读更多关于账户暂停以及如何正确处理这种状态的信息。</p><h1 id="d33e" class="jt ju hs bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">重新订阅</h1><p id="0fe3" class="pw-post-body-paragraph ip iq hs ir b is kr iu iv iw ks iy iz ja kt jc jd je ku jg jh ji kv jk jl jm ha bi translated"><strong class="ir ht">此功能的含义</strong>:开启重新订阅功能允许您的用户在订阅处于非活动状态后的一年内购买相同的订阅。此功能还允许用户在当前订阅到期前再次购买订阅。</p><p id="5cfd" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Play Console中的重新订阅功能目前默认不打开，但将从2020年11月1日起自动打开。如果您的应用程序尚未准备好在该日期之前处理重新订阅，您可以在Play控制台中手动关闭该功能。</p><p id="4f17" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">如果你的应用没有通过后端服务器</strong>跟踪订阅状态:如果你的应用依靠<code class="du kx ky kz la b">queryPurchases() </code>的结果来获得最新的订阅状态，你就不需要做任何额外的事情。<code class="du kx ky kz la b"><a class="ae jn" href="https://developer.android.com/reference/com/android/billingclient/api/BillingClient#queryPurchases(java.lang.String)" rel="noopener ugc nofollow" target="_blank">BillingClient.queryPurchases()</a></code>将继续返还套餐，直到套餐到期。</p><p id="9fcb" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">如果你的应用有一个利用RTDN跟踪订阅状态的后端服务器</strong>:当用户重新订阅时，会发送<code class="du kx ky kz la b">SUBSCRIPTION_RESTARTED</code>通知。收到此通知后，您的应用程序应处理恢复用户对订阅功能的访问。</p><p id="dad4" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在<a class="ae jn" href="https://developer.android.com/google/play/billing/subs#resubscribe" rel="noopener ugc nofollow" target="_blank">官方文档</a>中阅读更多关于重新订阅以及如何正确处理这种状态的信息。</p><p id="c830" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">对这些订阅功能的更改将于2020年11月1日生效，请仔细检查以确保您的应用已准备就绪！</strong></p></div></div>    
</body>
</html>