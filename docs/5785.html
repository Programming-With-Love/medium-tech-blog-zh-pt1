<html>
<head>
<title>Pi to OCI: using ARM to develop and deploy apps to Kubernetes (OKE)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Pi到OCI:使用ARM开发和部署应用到Kubernetes (OKE)</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/pi-to-oci-using-arm-to-develop-and-deploy-apps-to-kubernetes-oke-18ddd2a6ffc3?source=collection_archive---------1-----------------------#2021-06-03">https://medium.com/oracledevs/pi-to-oci-using-arm-to-develop-and-deploy-apps-to-kubernetes-oke-18ddd2a6ffc3?source=collection_archive---------1-----------------------#2021-06-03</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="8cac" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">手臂上的OKE</strong></p><p id="fc1c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最近，我对<a class="ae jc" href="https://blogs.oracle.com/cloud-infrastructure/arm-based-cloud-computing-is-the-next-big-thing-introducing-arm-on-oci?source=:ex:tb:::::RC_WWMK210625P00070:PItoIOCI&amp;SC=:ex:tb:::::RC_WWMK210625P00070:PItoIOCI&amp;pcode=WWMK210625P00070" rel="noopener ugc nofollow" target="_blank">宣布</a>OCI上的Ampere A1的可用性感到兴奋，更一般地说，基于ARM的计算是我们过去处理的RISC架构的更新实例。ARM可用于基础设施层面，尤其是在使用世界领先的编排引擎设计和实施云和容器原生应用程序时:无处不在的K8S，可通过Kubernetes ( <a class="ae jc" href="https://docs.oracle.com/en-us/iaas/Content/ContEng/Concepts/contengoverview.htm/?source=:ex:tb:::::RC_WWMK210625P00070:PItoOCI&amp;SC=:ex:tb:::::RC_WWMK210625P00070:PItoOCI&amp;pcode=WWMK210625P00070" rel="noopener ugc nofollow" target="_blank"> OKE </a>)的容器引擎在OCI获得。</p><p id="d970" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">块圆周率</strong></p><p id="62f9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">紧接着这个消息，我想到我的一个本地Raspberry Pi栈(RPi 4，8 GB RAM)，目前托管着<a class="ae jc" href="https://microk8s.io" rel="noopener ugc nofollow" target="_blank"> microK8S </a>集群的一个节点，也可以作为ARM开发者工作站。此外，检查兼容性问题或我可能遇到的任何其他问题也很有趣。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/820198e771e36147de20a15e75298209.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c6O3TQnqpb4SVuhOI5fS5A.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">The Pi</figcaption></figure><p id="0538" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所需组件的简化模式如下:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jt"><img src="../Images/3495a188c04fef88ad45ac30c80cf7d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ybPf4rZT5gQzNKD5G_dqTQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Yes, it’s that simple.</figcaption></figure><p id="32d0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，我需要为这个测试找到一个合适的Docker图像。我比较了Ampere A1和RPi CPU的规格，两者都采用64位的ARM v8架构，所以我选择了这个修补会议的<a class="ae jc" href="https://hub.docker.com/r/arm64v8/ubuntu" rel="noopener ugc nofollow" target="_blank"> arm64v8/ubuntu </a>映像。</p><p id="6e38" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在预订我的OKE集群之前，我尝试了一个用node.js、express.js和<a class="ae jc" href="http://jade-lang.com" rel="noopener ugc nofollow" target="_blank"> Jade </a>制作的简单应用程序，只是在我的RPi上有Docker。这是Dockerfile文件:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ju"><img src="../Images/0bd3c759c994b626d05046924c9d705e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*me4BoMcwYKvRyLjVUQHlZg.png"/></div></figure><p id="bd72" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Docker build命令使用了该Docker文件:</p><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="3ef8" class="ka kb hh jw b fi kc kd l ke kf">docker build -t gabba/gabbasite-armv8 .</span></pre><p id="cf3e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，我通过Docker run命令在本地运行应用程序:</p><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="5fc7" class="ka kb hh jw b fi kc kd l ke kf">docker run --rm -d --name gabbasite -p 3000:3000 gabba/gabbasite-armv8:latest</span></pre><p id="1c19" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在端口3000上公开了web应用程序后，我访问了它:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kg"><img src="../Images/c6d985fed8c4a57683ca4dbe0a9273b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CQYtlC_VYBcubpNv94OEVw.png"/></div></div></figure><p id="b417" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">臂上的OKE</strong></p><p id="435d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以，第一部分还可以。我们只需要将映像推送到一个repo以备将来使用:</p><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="88e3" class="ka kb hh jw b fi kc kd l ke kf">docker push gabba/gabbasite-armv8</span></pre><p id="16e7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，在ARM-OKE power combo上尝试这个应用程序。</p><p id="3d23" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，我需要在Oracle云基础架构上启动OKE快速创建，以创建一个具有可用臂形状的K8S集群(我们将坚持这种最少三个节点的设置)。</p><p id="f977" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">OKE服务允许通过快速创建选项，预留必要的计算和网络资源，在几分钟内创建一个集群。方便开发者！跟随指南<a class="ae jc" href="https://docs.oracle.com/en/learn/arm_oke_cluster_oci/index.html?source=:ex:tb:::::RC_WWMK210625P00070:PItoOCI&amp;SC=:ex:tb:::::RC_WWMK210625P00070:PItoOCI&amp;pcode=WWMK210625P00070#introduction" rel="noopener ugc nofollow" target="_blank">这里</a>了解详情，记得选择名为<strong class="ig hi"> VM的形状。标准. A1.Flex </strong>。</p><p id="8d27" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，我用RPi shell配置本地环境来访问K8S集群，这意味着设置oci-cli <a class="ae jc" href="https://docs.oracle.com/en-us/iaas/Content/API/SDKDocs/cliconfigure.htm?source=:ex:tb:::::RC_WWMK210625P00070:PitoOCI&amp;SC=:ex:tb:::::RC_WWMK210625P00070:PitoOCI&amp;pcode=WWMK210625P00070" rel="noopener ugc nofollow" target="_blank">配置</a>和<a class="ae jc" href="https://docs.oracle.com/en-us/iaas/Content/ContEng/Tasks/contengdownloadkubeconfigfile.htm?source=:ex:tb:::::RC_WWMK210625P00070:PitoOCI&amp;SC=:ex:tb:::::RC_WWMK210625P00070:PitoOCI&amp;pcode=WWMK210625P00070" rel="noopener ugc nofollow" target="_blank">生成</a>~/。kube/配置文件。在过程的最后，可以从RPi shell访问OKE集群:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kh"><img src="../Images/ceacfc413225e6415b2ae5b33ac30311.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CtSGAhWFZL_8YRkM5IssSQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Good old kubectl…</figcaption></figure><p id="0e17" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">编写部署文件</strong></p><p id="a574" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">旧习难改。我没有将部署指令与服务定义混合在一起:两者都是yaml文件，可以组合在一起发出一个命令，但是我在生产环境中使用OKE/K8S部署的经验告诉我应该有单独的文件。不管怎样，这是部署:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ki"><img src="../Images/bae97313ad59f200ccccb0f7322b2324.png" data-original-src="https://miro.medium.com/v2/resize:fit:1306/format:webp/1*bJ-TJ-1U2xbNTufdDo0Oyw.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx">deployment.yaml</figcaption></figure><p id="93b8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是service.yaml，它通过负载平衡器将应用程序暴露给残酷的世界:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kj"><img src="../Images/3acf168d0730afe2da0804c6b38fb9f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*Ttac8wXkB-_pKjkF0N7V2g.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx">service.yaml</figcaption></figure><p id="c90f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一些简单的命令就足以测试这两种配置:</p><pre class="je jf jg jh fd jv jw jx jy aw jz bi"><span id="ed65" class="ka kb hh jw b fi kc kd l ke kf">kubectl apply -f deployment.yaml</span><span id="92ee" class="ka kb hh jw b fi kk kd l ke kf">kubectl apply -f service.yaml</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kl"><img src="../Images/a683a58165cf5aff6ca642483fca2cb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P7oufZH0-pRPv6rrBJakuA.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Results…</figcaption></figure><p id="58c7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">检查我们的部署状态:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es km"><img src="../Images/3ec560d2ef10028629868d010b817450.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*onAoFg0UgTQfS-x4F-3OgQ.png"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Nodes, services and pods</figcaption></figure><p id="e885" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">OKE非常友好地向我提供了一个与负载平衡器相关联的公共IP地址，我将通过web浏览器访问这个地址。结果似乎很有希望:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kn"><img src="../Images/c3b5e73d0b9667095406c9f674f12ca3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0LppoKADiLfDso8wJckfGA.png"/></div></div></figure><p id="6c3e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">结果</strong></p><ul class=""><li id="d47e" class="ko kp hh ig b ih ii il im ip kq it kr ix ks jb kt ku kv kw bi translated">您可以轻松地使用RPi 4来构建软件和在ARM上运行OKE所需的Docker映像。这种方法可能没有你最喜欢的水果品牌的基于ARM的笔记本电脑那么花哨和快速(而且价格过高)，但它便宜一个数量级。</li><li id="3482" class="ko kp hh ig b ih kx il ky ip kz it la ix lb jb kt ku kv kw bi translated">在使用有效的OCI和K8S凭证对其进行配置之后，您可以将应用程序直接部署到OKE (ARM到ARM)。</li><li id="71cc" class="ko kp hh ig b ih kx il ky ip kz it la ix lb jb kt ku kv kw bi translated">ARM是下一件大事。使用OCI的<a class="ae jc" href="https://www.oracle.com/cloud/free/?source=:ex:tb:::::RC_WWMK210625P00070:PitoOCI&amp;SC=:ex:tb:::::RC_WWMK210625P00070:PitoOCI&amp;pcode=WWMK210625P00070" rel="noopener ugc nofollow" target="_blank">免费层</a>和<a class="ae jc" href="https://www.oracle.com/cloud/free/?source=:ex:tb:::::RC_WWMK210625P00070:PItoOCI&amp;SC=:ex:tb:::::RC_WWMK210625P00070:PItoOCI&amp;pcode=WWMK210625P00070#always-free" rel="noopener ugc nofollow" target="_blank">永远免费层</a>来查看。</li></ul><p id="5fec" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">快乐修补！</p></div></div>    
</body>
</html>