<html>
<head>
<title>Performance/Functional tests in CICD</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CICD的性能/功能测试</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/performance-functional-tests-in-cicd-7d6e889f0a1f?source=collection_archive---------1-----------------------#2020-11-09">https://medium.com/walmartglobaltech/performance-functional-tests-in-cicd-7d6e889f0a1f?source=collection_archive---------1-----------------------#2020-11-09</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/2d3f15ddfebf0b985ba32478f8276aa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oFSoF_BpnkDiwHidR98qvg.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo Credit: <a class="ae it" href="https://pixabay.com/users/herbert2512-2929941/" rel="noopener ugc nofollow" target="_blank">herbert2512</a></figcaption></figure><p id="3a92" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在本文中，我们将讨论CI/CD期间应用程序服务的性能/功能测试的角色和重要性。</p><p id="a27e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">想象一个在CI/CD管道中没有自动化测试的应用程序，没有明确的方法</p><ul class=""><li id="8037" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">测试稳定性，自动微调满足SLA需求所需的合适内存/CPU内核。</li><li id="730b" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">对于开发人员以自动化方式提交的每个更改，测试应用程序整体的端到端功能是完整的。</li></ul><h2 id="4cd4" class="kg kh hh bd ki kj kk kl km kn ko kp kq jf kr ks kt jj ku kv kw jn kx ky kz la bi translated">性能测试:</h2><p id="4edb" class="pw-post-body-paragraph iu iv hh iw b ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn lf jp jq jr ha bi translated">编写性能测试是为了确保应用程序</p><ul class=""><li id="86c8" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">满足预期的响应时间</li><li id="1093" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">可以处理应用程序的SLA活动用户</li><li id="c829" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">变化负载下的应用稳定性</li></ul><p id="1e9e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">有多种工具可以自动化性能测试。我们在沃尔玛使用一个名为Automaton的自制SAAS工具，它利用JMeter代理来自动化性能测试。设置非常简单，只需在一个json文件中配置应用程序SLA需求，该文件配置虚拟用户、SLA响应时间等。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="1bfd" class="kg kh hh ll b fi lp lq l lr ls">{<br/>  "projectName": "some-project",<br/>  "request": [<br/>    {<br/>      "transactionName": "some-action",<br/>      "rampUp": {<br/>        "totalVU": 30,<br/>        "initaldelay": 0,<br/>        "rampupvu": 30,<br/>        "rampduration": 1,<br/>        "holdrampup": 1,<br/>        "duration": 1<br/>      },<br/>      "api": [<br/>        {<br/>          "name": "some-action",<br/>          "method": "GET",<br/>          "url": "https://some-endpoint",<br/>          "headers": {<br/>            "content-type": "application/json"<br/>          },<br/>          "validate": [<br/>            {<br/>              "validation_type": "response_code",<br/>              "condition": "equals",<br/>              "text": "200",<br/>              "scope": "all"<br/>            }<br/>          ]<br/>        }<br/>      ]<br/>    }<br/>  ]<br/>}</span></pre><h2 id="cbff" class="kg kh hh bd ki kj kk kl km kn ko kp kq jf kr ks kt jj ku kv kw jn kx ky kz la bi translated">功能测试:</h2><p id="3fe1" class="pw-post-body-paragraph iu iv hh iw b ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn lf jp jq jr ha bi translated">编写功能测试是为了测试应用程序的端到端功能，这可能涉及与多个服务的交互。</p><p id="c2b2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们有用Java Cucumber framework编写的服务功能测试，其中测试是用gherkin语言以行为驱动的开发方式编写的。一个典型的测试可能如下所示，来自JIRA测试套件，通过JIRA集成。</p><pre class="lg lh li lj fd lk ll lm ln aw lo bi"><span id="f048" class="kg kh hh ll b fi lp lq l lr ls">Feature: Is it Friday yet?<br/>  Everybody wants to know when it's Friday<br/><br/>  Scenario: Sunday isn't Friday<br/>    Given today is Sunday<br/>    When I ask whether it's Friday yet<br/>    Then I should be told "Nope"</span></pre><h2 id="c9f4" class="kg kh hh bd ki kj kk kl km kn ko kp kq jf kr ks kt jj ku kv kw jn kx ky kz la bi translated">CICD的性能/功能测试:</h2><p id="3681" class="pw-post-body-paragraph iu iv hh iw b ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn lf jp jq jr ha bi translated">在成功的应用服务构建(在此阶段执行单元测试)和成功的部署之后，性能和功能测试在CICD管道中被调用。</p><ul class=""><li id="d691" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">性能测试确保服务稳定、快速、可靠，并满足SLA需求。</li><li id="0c84" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">功能测试确保在将更改作为服务的一部分进行部署后，应用程序的端到端功能仍然保持良好。</li></ul><figure class="lg lh li lj fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lt"><img src="../Images/adcf52b939e9fdaea06dbfff278da24b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mV2Qr_3Ac4hKetpIPdxviQ.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Performance/Functional tests in CICD pipeline</figcaption></figure><p id="2eeb" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">从上图中可以看出，在将应用程序部署到开发/qa环境后不久，性能和功能测试开始执行，报告被发送到slack渠道/电子邮件。如果执行性能或功能测试失败，部署将被标记为失败，并开始部署的回滚。</p><p id="241b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在测试成功的情况下，性能测试报告/功能测试报告被发送给团队。</p><h2 id="4928" class="kg kh hh bd ki kj kk kl km kn ko kp kq jf kr ks kt jj ku kv kw jn kx ky kz la bi translated">性能测试报告:</h2><p id="752a" class="pw-post-body-paragraph iu iv hh iw b ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn lf jp jq jr ha bi translated">发送的性能测试报告包括</p><ul class=""><li id="b458" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">成功请求的数量</li><li id="1f2f" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">达到的TPS(每秒事务数)</li><li id="416b" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">失败请求的数量</li></ul><p id="dd60" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这些指标始终可用于调整容器的给定pod上的内存/CPU核心，以满足SLA需求。</p><h2 id="d0f0" class="kg kh hh bd ki kj kk kl km kn ko kp kq jf kr ks kt jj ku kv kw jn kx ky kz la bi translated">功能测试报告:</h2><p id="506e" class="pw-post-body-paragraph iu iv hh iw b ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn lf jp jq jr ha bi translated">部署日志中的功能测试报告将帮助开发人员确保端到端的功能不会受到应用程序中添加的每个新功能的干扰。在典型的微服务架构中，这将涉及功能测试，其中多个服务可以相互通信，以确保通信仍然完好无损，并符合业务需求。</p><h2 id="c391" class="kg kh hh bd ki kj kk kl km kn ko kp kq jf kr ks kt jj ku kv kw jn kx ky kz la bi translated">结论:</h2><p id="132b" class="pw-post-body-paragraph iu iv hh iw b ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn lf jp jq jr ha bi translated">对CI/CD管道进行自动化的性能/功能测试只会使应用程序以自动化的方式为最坏的情况做好准备。明智的做法是预见到未来可能出现的问题，因为活动用户数量会出现意想不到的高峰，应用程序功能会自动检查每一个变化。</p><p id="e0fe" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">最后，一个好的开发人员会睡个好觉，并保持适当的工作生活平衡，这只能通过尽可能地自动化事情来实现，只有当计算之神生气时才进行人工干预。</p></div></div>    
</body>
</html>