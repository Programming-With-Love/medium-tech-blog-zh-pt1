<html>
<head>
<title>Using Electrode to Improve React Server Side Render Performance By Up To 70%</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用电极将React服务器端渲染性能提高了70%</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/using-electrode-to-improve-react-server-side-render-performance-by-up-to-70-e43f9494eb8b?source=collection_archive---------1-----------------------#2016-10-10">https://medium.com/walmartglobaltech/using-electrode-to-improve-react-server-side-render-performance-by-up-to-70-e43f9494eb8b?source=collection_archive---------1-----------------------#2016-10-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/c7696a7c7039c8d8480d75ef2dc41731.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KpTtADCLhV4GW7z4lTokXQ.png"/></div></div></figure><div class=""/><p id="b508" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们构建了<a class="ae jn" rel="noopener" href="/walmartlabs/introducing-electrode-an-open-source-release-from-walmartlabs-14b836135319#.7j2n6ec6x">电极</a>，react/node.js应用平台为walmart.com提供了几个目标，包括易用性、跨应用的组件可重用性，以及最重要的性能。</p><p id="3d9d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们在几乎所有的应用程序中使用服务器端渲染有两个原因:</p><ol class=""><li id="949c" class="jo jp hs ir b is it iw ix ja jq je jr ji js jm jt ju jv jw bi translated">为客户提高性能</li><li id="7115" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">更适合搜索引擎优化</li></ol><p id="9126" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然而，在我们的测试中，我们发现React的<code class="du kc kd ke kf b">renderToString()</code>需要相当长的时间来执行——由于<code class="du kc kd ke kf b">renderToString()</code>是同步的，服务器在运行时会被阻塞。每个服务器端渲染执行<code class="du kc kd ke kf b">renderToString()</code>来构建应用服务器将发送给浏览器的HTML。</p><p id="4430" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了解决这个问题，我们创建了两个电极模块:<a class="ae jn" href="http://www.electrode.io/docs/above_fold_rendering.html" rel="noopener ugc nofollow" target="_blank">折叠渲染(ATF) </a>和<a class="ae jn" href="http://www.electrode.io/docs/server_side_render_cache.html" rel="noopener ugc nofollow" target="_blank">服务器端渲染剖析和缓存(SSR缓存)</a>。让我们看看这些是如何工作的，使用Walmart.com主页应用程序作为我们的用例。这是<strong class="ir ht">真正的</strong>首页应用，不是被嘲讽的app。它包括10个旋转木马(很多交易！)，而且它已经使用了我们的性能增强<a class="ae jn" href="http://www.electrode.io/docs/redux_router_engine.html" rel="noopener ugc nofollow" target="_blank"> redux-router-engine </a>。出于测试的目的，它运行在Macbook Pro上，而不是商用服务器硬件上(这在<code class="du kc kd ke kf b">renderToString()</code>性能上有很大差异)。</p><h1 id="9136" class="kg kh hs bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">基线</h1><p id="098c" class="pw-post-body-paragraph ip iq hs ir b is le iu iv iw lf iy iz ja lg jc jd je lh jg jh ji li jk jl jm ha bi translated">作为基线测试，我们首先配置应用程序，没有ATF模块，没有SSR缓存模块，有<code class="du kc kd ke kf b">renderWithIds:true</code>，我们同步运行它30次。这种配置下的平均<code class="du kc kd ke kf b">renderToString()</code>通话时间为<strong class="ir ht"> 153.80毫秒</strong>。</p><h1 id="92fd" class="kg kh hs bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">电极默认值— renderWithIds:False</h1><p id="c41a" class="pw-post-body-paragraph ip iq hs ir b is le iu iv iw lf iy iz ja lg jc jd je lh jg jh ji li jk jl jm ha bi translated">不过，默认情况下，电极带有<code class="du kc kd ke kf b">renderWithIds:false</code>，这给我们一个<code class="du kc kd ke kf b">renderToString()</code>时间<strong class="ir ht"> 124.80毫秒</strong>。不错——电极的默认配置已经提高了19%的渲染时间！</p><h1 id="1c0d" class="kg kh hs bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">服务器端渲染配置文件和缓存</h1><p id="f946" class="pw-post-body-paragraph ip iq hs ir b is le iu iv iw lf iy iz ja lg jc jd je lh jg jh ji li jk jl jm ha bi translated">接下来，我们添加了页眉、页脚和转盘的<a class="ae jn" href="http://www.electrode.io/docs/server_side_render_cache.html" rel="noopener ugc nofollow" target="_blank"> SSR缓存</a>，这为我们提供了96.80 ms 的平均<code class="du kc kd ke kf b">renderToString()</code>。非常好！这比Electrode的默认值提高了23%。</p><h1 id="d6db" class="kg kh hs bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">在折叠渲染之上</h1><p id="d46e" class="pw-post-body-paragraph ip iq hs ir b is le iu iv iw lf iy iz ja lg jc jd je lh jg jh ji li jk jl jm ha bi translated">假设我们没有实现缓存，而是实现了仅用于渲染的<a class="ae jn" href="http://www.electrode.io/docs/above_fold_rendering.html" rel="noopener ugc nofollow" target="_blank"> ATF渲染</a>。这样，我们的<code class="du kc kd ke kf b">renderToString()</code>时间为<strong class="ir ht"> 65.73 ms </strong>。哇，降低了48%！也就是说，很多旋转木马的价格都低于正常水平。</p><h1 id="d8d8" class="kg kh hs bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">SSR缓存+ ATF渲染</h1><p id="30e2" class="pw-post-body-paragraph ip iq hs ir b is le iu iv iw lf iy iz ja lg jc jd je lh jg jh ji li jk jl jm ha bi translated">最后，让我们一起使用<a class="ae jn" href="http://www.electrode.io/docs/server_side_render_cache.html" rel="noopener ugc nofollow" target="_blank"> SSR缓存</a>和<a class="ae jn" href="http://www.electrode.io/docs/above_fold_rendering.html" rel="noopener ugc nofollow" target="_blank"> ATF渲染</a>。这样一来，我们的<code class="du kc kd ke kf b">renderToString()</code>时间一路下降到了<strong class="ir ht">36.56 ms</strong>——与默认的Electrode配置相比，提高了71%，与原始的未优化测试相比，提高了76%。还要记住，这是同步代码，这意味着它会阻止Node.js应用程序执行任何其他操作，直到完成为止。我们还没有将<code class="du kc kd ke kf b">DOMContentLoaded()</code>引入到讨论中，但是通过<a class="ae jn" href="http://www.electrode.io/docs/above_fold_rendering.html" rel="noopener ugc nofollow" target="_blank"> ATF渲染</a>，我们看到了近30%的改进，因为我们只是将内容呈现在文件夹的上方，然后立即在客户端启动React渲染。</p><h1 id="e3bd" class="kg kh hs bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">结论</h1><p id="693e" class="pw-post-body-paragraph ip iq hs ir b is le iu iv iw lf iy iz ja lg jc jd je lh jg jh ji li jk jl jm ha bi translated">这就是了，电极棒极了，你应该使用它。将您的反应服务器端性能提高高达70%。我们正在使用这个@ WalmartLabs，通过这两个模块(+ redux路由器引擎)，我们的生产应用程序的性能得到了显著提升。如您所见，主页的本地性能提高了70%。</p><p id="1ffe" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">但请记住，这些测试是在快速硬件上运行的。在商品服务器CPU上，<code class="du kc kd ke kf b">renderToString()</code>可能需要两倍的时间。这意味着70%的改进并不意味着90 ms，而是节省了180 ms。</p><h1 id="a098" class="kg kh hs bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated"><strong class="ak">特别感谢:</strong></h1><p id="39c8" class="pw-post-body-paragraph ip iq hs ir b is le iu iv iw lf iy iz ja lg jc jd je lh jg jh ji li jk jl jm ha bi translated">感谢<a class="lj lk ge" href="https://medium.com/u/f034b4cfef9f?source=post_page-----e43f9494eb8b--------------------------------" rel="noopener" target="_blank">阿鲁内什·乔希</a>、<a class="lj lk ge" href="https://medium.com/u/f658c22b63be?source=post_page-----e43f9494eb8b--------------------------------" rel="noopener" target="_blank">德米特里·耶辛</a>和主页团队，他们已经实现了电极模块，并正在生产中的主页上使用它们。</p><p id="68c5" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">感谢<a class="lj lk ge" href="https://medium.com/u/e16a73e715e3?source=post_page-----e43f9494eb8b--------------------------------" rel="noopener" target="_blank">石</a>，感谢他帮助我们收集数据，确保我们得到正确的数字！</p><h1 id="6e38" class="kg kh hs bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated"><strong class="ak">更多信息:</strong></h1><p id="2c61" class="pw-post-body-paragraph ip iq hs ir b is le iu iv iw lf iy iz ja lg jc jd je lh jg jh ji li jk jl jm ha bi translated">查看<a class="lj lk ge" href="https://medium.com/u/9f67cc98eb00?source=post_page-----e43f9494eb8b--------------------------------" rel="noopener" target="_blank"> Joel Chen </a>关于<a class="ae jn" rel="noopener" href="/walmartlabs/reactjs-ssr-profiling-and-caching-5d8e9e49240c#.q8jblqb6z"> ReactJS SSR剖析和缓存</a>的帖子或<a class="lj lk ge" href="https://medium.com/u/d8fa8407b711?source=post_page-----e43f9494eb8b--------------------------------" rel="noopener" target="_blank"> Arpan Nanavati </a>关于<a class="ae jn" rel="noopener" href="/walmartlabs/building-react-js-at-enterprise-scale-17c17a36fd1f#.9j3wmrza6">构建企业级React.js的帖子</a>。</p><p id="a3bc" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><a class="ae jn" rel="noopener" href="/walmartlabs/introducing-electrode-an-open-source-release-from-walmartlabs-14b836135319#.7j2n6ec6x">查看我关于Electrode发布的帖子，这是支持Walmart.com的面向客户的平台</a>。</p><p id="ebdd" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">焊条网址:<a class="ae jn" href="http://www.electrode.io" rel="noopener ugc nofollow" target="_blank"> www.electrode.io </a></p></div></div>    
</body>
</html>