<html>
<head>
<title>Intent Resolving in Android M</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android M中的意图解析</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/intent-resolving-in-android-m-c17d39d27048?source=collection_archive---------1-----------------------#2015-10-09">https://medium.com/google-developer-experts/intent-resolving-in-android-m-c17d39d27048?source=collection_archive---------1-----------------------#2015-10-09</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="38c6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">警告！Android棉花糖中“隐含意图”的解析不再像以前一样工作。这可能会破坏你的应用程序的行为。</p><p id="4705" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我解释一下预期的行为以及为什么不起作用:</p><p id="8a84" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我最近一直在做一个名为“<a class="ae jc" href="https://github.com/tasomaniac/OpenLinkWith/" rel="noopener ugc nofollow" target="_blank"> <em class="jd">与</em> </a>开放链接”的小型开源项目。它将有希望很快出现在游戏商店。</p><p id="c8ce" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我的应用程序让您能够在其他应用程序之间切换。当你与我分享一个链接时，我基本上抓取链接并查询所有可以处理该链接的活动。最后，我模仿系统对话框，让你切换应用程序。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/a1acaabc6fe9a846f9aa4e06dfe27168.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/1*rW8I8aCpJ2q8fnfKH_51_g.gif"/></div><figcaption class="jm jn et er es jo jp bd b be z dx">Switching from already opened youtube web-page to Youtube app.</figcaption></figure><p id="fe11" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我一直使用下面的方法:</p><pre class="jf jg jh ji fd jq jr js jt aw ju bi"><span id="e788" class="jv jw hh jr b fi jx jy l jz ka">List&lt;ResolveInfo&gt; infos = packageManager<br/>        .queryIntentActivities(intent, MATCH_DEFAULT_ONLY);</span></pre><p id="4dc0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是几乎所有Android开发人员都熟悉的方法，我确信它目前正在许多应用程序中使用。</p><p id="1445" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我的手机里有<strong class="ig hi"> 2浏览器</strong>。"<em class="jd">使用Google+ URL </em>的意图预计会给出一个<em class="jd"> 3 ResolveInfo </em> <strong class="ig hi"> </strong>对象的列表(Google+应用程序和2个浏览器)。</p><p id="304f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">嗯，不再是了！</p><p id="2f07" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">欢迎来到安卓棉花糖！</p><p id="ebb8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jd">安卓棉花糖</em>引入<a class="ae jc" href="https://www.youtube.com/watch?v=LQoohRwojmw" rel="noopener ugc nofollow" target="_blank"> App链接。</a>系统基本上对你的网页进行认证，并使用你的应用程序自动打开那些URL，而不询问用户任何事情。或者，您可以进入系统设置、应用程序，单击某个应用程序，单击<em class="jd">“默认打开”</em>，然后设置<em class="jd">“在此应用程序中打开”</em>以始终使用该应用程序。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es kb"><img src="../Images/dff88079943ea518abcc7a3c7f06005c.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*MVZbYKhwu-7qnyGAFWuNsw.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx">Application default setting page in Marshmallow</figcaption></figure><p id="49c8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这种情况下，<em class="jd">queryintactivities</em>方法将为开发者提供一个只有<strong class="ig hi"> 1个活动</strong>(在本例中是Google+)的列表。</p><p id="d180" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">即使这是期望的行为，也应该记录下来，因为它破坏了公共API的行为。</p><p id="c789" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我稍微研究了一下，发现<em class="jd"> MATCH_ALL </em> flag。它的文档说，它将禁用所有系统级过滤器。</p><pre class="jf jg jh ji fd jq jr js jt aw ju bi"><span id="d5b6" class="jv jw hh jr b fi jx jy l jz ka"><em class="jd">/**<br/> * Querying flag: if set and if the platform is doing any filtering of the results, then<br/> * the filtering will not happen. This is a synonym for saying that all results should<br/> * be returned.<br/> */</em><br/>public static final int <em class="jd">MATCH_ALL </em>= 0x00020000;</span></pre><p id="8f89" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">它对我没有任何作用。我打开了<a class="ae jc" href="https://github.com/android/platform_frameworks_base/blob/marshmallow-release/services/core/java/com/android/server/pm/PackageManagerService.java" rel="noopener ugc nofollow" target="_blank">源代码</a>(至少我们有那个！)并调查了方法。</p><p id="7e09" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">看起来他们优先考虑域验证的应用程序。他们不仅在内部系统中划分优先级，还在公共API中划分优先级。</p><p id="5b49" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果有一个<em class="jd">域验证的应用程序</em>，它不返回任何其他内容。<em class="jd"> MATCH_ALL </em>标志移除一些系统过滤器，但仅当没有验证的应用程序时。</p></div><div class="ab cl kc kd go ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="ha hb hc hd he"><p id="4832" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我找不到任何方法来解决这个问题。它只是排除浏览器应用程序，即使它们的<em class="jd">意图过滤器</em>匹配。</p><p id="bd8e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">没有解决办法，因为它是一个内部组件(我们无法访问)，Android SDK使用AIDL通过IPC通信与它进行通信。</p><p id="d470" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">大多数开发人员使用这种方法来确定是否至少有一个活动来处理隐含的意图。在大多数情况下，列表中的第一项就是你想要的。</p><p id="c693" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在花了几个小时了解发生了什么并试图找到一个解决方法后，我认为每个人都应该知道这一点。</p><p id="1128" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Android M中有很多行为变化，Google实际上提供了一个行为变化列表。这里可以找到<a class="ae jc" href="https://developer.android.com/intl/zh-cn/about/versions/marshmallow/android-6.0-changes.html" rel="noopener ugc nofollow" target="_blank">。我确信就像这样，有许多隐藏的行为变化可能会破坏应用程序。</a></p><p id="cf32" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以要小心这一点，如果你使用<em class="jd"> PackageManager </em>方法，检查你的情况。</p><p id="9006" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jd">感谢校对本文的人:</em> <a class="ae jc" href="https://twitter.com/yagmurdalman" rel="noopener ugc nofollow" target="_blank"> <em class="jd">亚古穆尔·达尔曼</em></a><em class="jd"/><a class="kj kk ge" href="https://medium.com/u/9706138c9bfb?source=post_page-----c17d39d27048--------------------------------" rel="noopener" target="_blank"><em class="jd">塞巴斯蒂安·波吉</em></a><a class="kj kk ge" href="https://medium.com/u/73761c65c602?source=post_page-----c17d39d27048--------------------------------" rel="noopener" target="_blank">萨利姆·卡亚巴希</a><a class="kj kk ge" href="https://medium.com/u/24a0490cd588?source=post_page-----c17d39d27048--------------------------------" rel="noopener" target="_blank">哈桑·凯克利克</a></p><p id="0621" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">关注我的<a class="ae jc" href="https://twitter.com/tasomaniac" rel="noopener ugc nofollow" target="_blank">@塔斯曼尼亚克</a>和<a class="ae jc" href="https://plus.google.com/+SaidTahsinDane/posts" rel="noopener ugc nofollow" target="_blank"> +SaidTahsinDane </a></p></div></div>    
</body>
</html>