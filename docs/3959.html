<html>
<head>
<title>How to upload file on AWS server using Server-side Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用服务器端Swift在AWS服务器上上传文件</h1>
<blockquote>原文：<a href="https://medium.com/globant/how-to-upload-file-on-aws-server-using-server-side-swift-ede0f75e1c5f?source=collection_archive---------5-----------------------#2022-08-25">https://medium.com/globant/how-to-upload-file-on-aws-server-using-server-side-swift-ede0f75e1c5f?source=collection_archive---------5-----------------------#2022-08-25</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="0096" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">今天，我们将学习如何使用服务器端Swift和Vapor框架上传文件。我们可以使用名为Soto的库将文件直接上传到云服务。SPM工具已经在Soto中用于代码依赖。将soto依赖项添加到Package.swift文件中的包，如下所示。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/88acf4ce07eab38e547f57226824a09f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KKgNWpcEmk768voWY8Kr-A.png"/></div></div></figure><p id="5734" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要使用Soto，我们需要为AWS服务创建一个AWSClient和一个service对象。AWSClient与AWS通信，服务对象提供与AWS服务通信的配置和API。</p><p id="527b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，我们需要AWS凭证来签署您的所有请求。可以通过以下方式向库提供凭据。</p><ul class=""><li id="eaeb" class="jo jp hh ig b ih ii il im ip jq it jr ix js jb jt ju jv jw bi translated">环境变量AWS_ACCESS_KEY_ID和AWS_SECRET_ACCESS_KEY</li><li id="d28b" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb jt ju jv jw bi translated">ECS容器IAM策略</li><li id="a84f" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb jt ju jv jw bi translated">EC2 IAM实例配置文件</li><li id="c037" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb jt ju jv jw bi translated">主目录中的共享凭据文件</li><li id="335f" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb jt ju jv jw bi translated">运行时提供的静态凭据</li></ul><p id="05b2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">访问密钥由一个访问密钥ID和一个秘密访问密钥组成，它们用于对您向AWS发出的编程请求进行签名。</p><p id="b4c5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">AWS中的用户类型</strong></p><p id="79cf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">AWS中有两种不同类型的用户。您要么是帐户所有者(root用户)，要么是IAM用户。当使用创建帐户时使用的电子邮件地址和密码创建AWS帐户时，就会创建root用户。IAM用户由根用户或AWS帐户中的IAM管理员创建。</p><p id="3c4c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">使用root用户获取访问密钥ID和秘密访问密钥。</strong></p><ol class=""><li id="59b3" class="jo jp hh ig b ih ii il im ip jq it jr ix js jb kc ju jv jw bi translated">通过选择<strong class="ig hi">根用户</strong>并输入您的AWS帐户电子邮件地址，以帐户所有者的身份登录到<a class="ae kd" href="https://console.aws.amazon.com/iam/" rel="noopener ugc nofollow" target="_blank"> IAM控制台</a>。在下一页上，输入您的密码。</li><li id="82d9" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb kc ju jv jw bi translated">在导航栏中选择您的帐户名称，然后选择<strong class="ig hi">我的安全凭证</strong>。如果您看到有关访问AWS帐户的安全凭据的警告，请选择继续访问安全凭据。</li><li id="61de" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb kc ju jv jw bi translated">展开访问密钥(访问密钥ID和秘密访问密钥)部分。</li><li id="087c" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb kc ju jv jw bi translated">选择创建新的访问密钥。如果禁用此功能，则必须删除一个现有的访问键，然后才能创建新的键。更多信息，请参见<em class="ke"> IAM用户</em> <a class="ae kd" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html" rel="noopener ugc nofollow" target="_blank"> <em class="ke">指南</em> </a>中的<a class="ae kd" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/reference_iam-quotas.html#reference_iam-quotas-entities" rel="noopener ugc nofollow" target="_blank"> IAM实体对象限制</a>。<br/>警告说明您只有一次机会查看或下载密钥。以后就无法检索了。</li></ol><ul class=""><li id="c388" class="jo jp hh ig b ih ii il im ip jq it jr ix js jb jt ju jv jw bi translated">如果选择“显示访问密钥”,可以从浏览器窗口中复制访问密钥ID和密钥，并将其粘贴到其他地方。</li><li id="d55d" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb jt ju jv jw bi translated">如果选择下载密钥文件，您将收到一个名为rootkey.csv的文件，其中包含访问密钥ID和密钥。将文件保存在安全的地方。</li></ul><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/dc3eec93e637363ad0495a83fd3cf377.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6y5meV0BRecV-ASbBBeClA.png"/></div></div></figure><p id="9b5d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">使用IAM用户获取访问密钥ID和秘密访问密钥。</strong></p><ol class=""><li id="fcd7" class="jo jp hh ig b ih ii il im ip jq it jr ix js jb kc ju jv jw bi translated">打开<a class="ae kd" href="https://docs.aws.amazon.com/IAM/latest/UserGuide/console.html" rel="noopener ugc nofollow" target="_blank"> IAM控制台。</a></li><li id="a887" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb kc ju jv jw bi translated">在导航菜单中，选择用户。</li><li id="1958" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb kc ju jv jw bi translated">选择您的IAM用户名(不是复选框)。</li><li id="d0d6" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb kc ju jv jw bi translated">打开安全凭证选项卡，然后选择创建访问密钥。</li><li id="8262" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb kc ju jv jw bi translated">若要查看新的访问密钥，请选择“显示”。您的凭据如下所示:</li></ol><ul class=""><li id="1315" class="jo jp hh ig b ih ii il im ip jq it jr ix js jb jt ju jv jw bi translated">访问密钥ID: <strong class="ig hi">您的访问密钥ID </strong></li><li id="44e7" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb jt ju jv jw bi translated">秘密访问密钥:<strong class="ig hi">你的秘密访问密钥</strong></li></ul><p id="d6d2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">6.要下载密钥对，请选择下载。csv文件并存储密钥。</p><p id="a7e9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> AWS数据存储</strong></p><p id="6fac" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以存储的数据总量和对象数量是无限的。对于自由层，单个亚马逊S3对象的大小可以从最小0字节到最大5 GB不等。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/104d0a3508c2fbb5b21944c3d6d7b1f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eiTc6VbW7ATaOIb-veXX1w.png"/></div></div></figure><p id="5dd2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用<a class="ae kd" href="https://aws.amazon.com/s3/pricing/" rel="noopener ugc nofollow" target="_blank">此</a>链接查找有关S3定价的更多信息。</p><p id="d61b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们将在运行时使用静态凭证。下面的函数返回一个EventLoopFuture，该函数创建一个S3桶，将一个文件放入桶中，从桶中读回文件，最后打印文件的内容。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/9f612de1f3410110f88cffeaf3174fa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YAvXf78ZjmGFdw7vP5eBJw.png"/></div></div></figure><ol class=""><li id="9fd4" class="jo jp hh ig b ih ii il im ip jq it jr ix js jb kc ju jv jw bi translated">我们需要通过提供accesskey、accessId和region值来创建S3对象。默认区域将被选择为使用1。</li><li id="d3ec" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb kc ju jv jw bi translated">其次，我们需要发出一个带有bucket名称的bucket请求。存储桶名称应该是唯一的。在本例中，我们使用了fileUploadTests。</li><li id="28be" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb kc ju jv jw bi translated">然后，我们需要用一个Bucket请求调用createBucket API。</li><li id="43e7" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb kc ju jv jw bi translated">因为我们将把文件上传到服务器，所以我们必须使用带有上述参数的PutObjectRequest。</li><li id="5edd" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb kc ju jv jw bi translated">在这个例子中，我们上传了一个文本文件，键名为testFile。</li><li id="9399" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb kc ju jv jw bi translated">使用GetObjectRequest API，我们可以获取提供bucket名称和上传文件名的相同文件。</li></ol><p id="be4a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦上面的代码没有任何错误地执行，您将能够看到您上传到s3存储桶的文件，如下所示。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/2d99d66f7fd347fb6ba87855ded7bdc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ha6uvNMtBeZJgLHzQBH6jQ.png"/></div></div></figure><p id="d1ca" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过点击testFile，我们可以看到上传文件的完整URL、文件大小、时间戳和其他属性。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/ed93c163b09d4532202d6aaecf02177f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ThmtChE083Hf5wEp7TyNSg.png"/></div></div></figure><p id="78be" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我希望这篇文章对你有所帮助。感谢您的阅读。</p></div></div>    
</body>
</html>