<html>
<head>
<title>PinnerSage: Multi-Modal User Embedding Framework for Recommendations at Pinterest</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">PinnerSage:Pinterest推荐的多模态用户嵌入框架</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/pinnersage-multi-modal-user-embedding-framework-for-recommendations-at-pinterest-bfd116b49475?source=collection_archive---------1-----------------------#2020-08-10">https://medium.com/pinterest-engineering/pinnersage-multi-modal-user-embedding-framework-for-recommendations-at-pinterest-bfd116b49475?source=collection_archive---------1-----------------------#2020-08-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="3db0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Aditya Pal |应用科学，Chantat Eksombatchai |应用科学，周奕彤|用户理解，赵波|用户理解，Charles Rosenberg |应用科学，Jure Leskovec |应用科学</p><p id="5466" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在我们构建支持2B+pin的视觉发现引擎时，了解用户的兴趣和偏好以提供相关内容至关重要。编码用户偏好的一种标准方法是通过高维空间中基于嵌入的表示。在Pinterest尝试的大多数现有方法为每个用户推断与内容嵌入兼容的单个高维嵌入。这是一个很好的起点，但不足以充分理解用户。</p><p id="0366" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这项工作中，我们假设单个嵌入不足以编码用户兴趣的多个方面，这些方面之间可能没有明显的联系。它们可以演变，有些兴趣会持续很长时间，而有些兴趣会持续很短时间。推荐的项目也在相同的嵌入空间中表示。一个好的嵌入必须编码用户的多种口味、兴趣、风格等。，而推荐项目(视频、图像、新闻文章、房屋列表、大头针等。)通常只有一个焦点。因此，用多个嵌入来表示用户变得很重要，每个嵌入捕获他们感兴趣的特定方面。</p><h1 id="65ea" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">PinnerSage模型</h1><p id="ce48" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">为了更好地了解我们用户的偏好，我们开发了PinnerSage，这是一个高度可伸缩、灵活和可扩展的推荐系统，它在内部用多个嵌入表示每个用户。图1提供了PinnerSage推荐模型的端到端概述。我们的模型的起点是通过运行<a class="ae kf" href="https://en.wikipedia.org/wiki/Ward%27s_method" rel="noopener ugc nofollow" target="_blank"> Ward聚类模型</a>将用户的repins和clicks组织成多个兴趣聚类，然后使用medoid、嵌入和聚类重要性分数生成每个聚类的摘要。接下来，通过在线聚类选择来挑选这些聚类的子集，并且它采用最近邻索引来向用户生成推荐。用户的行为被实时处理以更新兴趣聚类。为了让PinnerSage向我们每月4亿多的活跃用户提供相关建议并实时调整，我们做出了几个模型设计选择，下面我们将对此进行介绍。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/385c896689f03315b9a31cee6db9d755.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s2bL7Ym3KiE3Y0Pm"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx"><strong class="bd je">Figure 1: Overview of PinnerSage model</strong></figcaption></figure><h2 id="69ec" class="kw jd hh bd je kx ky kz ji la lb lc jm ip ld le jq it lf lg ju ix lh li jy lj bi translated">设计选择1:引脚嵌入是固定的</h2><p id="2f2b" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">图1中的兴趣聚类是通过对嵌入的repins和用户的点击进行聚类而生成的。repins和clicks的嵌入通过<a class="ae kf" rel="noopener" href="/pinterest-engineering/pinsage-a-new-graph-convolutional-neural-network-for-web-scale-recommender-systems-88795a107f48"> PinSage模型</a>进行训练，该模型通过图形卷积模型对pin之间的上下文和视觉相似性进行优化。因为我们的目标是将用户投影到与Pin嵌入空间相同的空间中，所以我们认为Pin嵌入是固定的。这种设计选择大大简化了我们的模型，并允许我们为每个用户并行运行推理管道。</p><p id="afb2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">联合嵌入推断模型，其中用户和Pin嵌入被一起推断，可能太复杂并且难以扩展。此外，我们假设在实践中它们损害了推荐相关性，因为pin之间的一些虚假连接可以通过用户建立。要了解这一点，请考虑图2中的例子。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lk"><img src="../Images/50943bc96ce4eefe4b20ad737e496384.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KB50oLyVlnzoGuen"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx"><strong class="bd je">Figure 2: Three interests of a given user.</strong></figcaption></figure><p id="5be6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在上面的示例图中，用户对绘画、鞋子和科幻感兴趣。共同学习的用户和pin嵌入将使这些不同主题上的Pin嵌入更接近，这可能损害基于最近邻的推荐器的相关性。引脚嵌入应仅根据以下基本原则进行操作:使相似的引脚靠得更近，同时使其余引脚保持尽可能远。出于这个原因，我们使用PinSage，它可以精确地实现这个目标，没有任何稀释。</p><h2 id="b7c9" class="kw jd hh bd je kx ky kz ji la lb lc jm ip ld le jq it lf lg ju ix lh li jy lj bi translated">设计选择2:无限制的用户嵌入</h2><p id="8d7e" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">先前的工作要么将嵌入的数目固定为一个小数目，要么对它们设定一个上限。在最好的情况下，这种限制阻碍了对用户的全面理解，在最坏的情况下，将不同的概念融合在一起，导致糟糕的推荐。例如，合并嵌入可能会产生位于完全不同区域的嵌入。图2显示了三个不同的pin嵌入的合并导致了由概念<em class="ll">能量提升早餐最好地表示的嵌入。</em>不用说，基于这种合并的推荐可能会有问题。</p><p id="843d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">PinnerSage生成底层数据支持的尽可能多的兴趣聚类。这是通过分层凝聚聚类算法(Ward)将用户的动作聚类成概念上一致的簇来实现的。轻度用户可能由3-5个集群代表，而重度用户可能由75-100个集群代表。</p><h2 id="2565" class="kw jd hh bd je kx ky kz ji la lb lc jm ip ld le jq it lf lg ju ix lh li jy lj bi translated">设计选择3:基于Medoid的聚类表示</h2><p id="ed7f" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">通常，聚类由质心表示，这需要存储嵌入。此外，质心可能对群集中的异常值敏感。为了简洁地表示一个集群，我们选择一个集群成员pin，称为medoid。根据定义，Medoid是用户最初交互的pin集合的成员。因此，它避免了主题漂移的陷阱，并对异常值具有鲁棒性。从系统的角度来看，medoid是一种简洁的表示集群的方式，因为它只需要存储medoid的pin id，并导致跨用户甚至跨应用程序的缓存共享。它还允许我们的系统与其他非基于嵌入的推荐系统兼容，例如<a class="ae kf" rel="noopener" href="/pinterest-engineering/introducing-pixie-an-advanced-graph-based-recommendation-system-e7b4229b664b"> Pixie </a>。</p><h2 id="3cc4" class="kw jd hh bd je kx ky kz ji la lb lc jm ip ld le jq it lf lg ju ix lh li jy lj bi translated">设计选择4:用于候选人检索的中间抽样</h2><p id="f6e3" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">PinnerSage通过集群medoids提供了丰富的用户表示。然而，在实践中，由于成本问题，我们不能同时使用所有的medoids进行候选检索。此外，用户会受到太多不同项目的轰炸。为了解决这些问题，我们对3个与其重要性分数成比例的medoids进行了采样，并推荐了它们最近的相邻引脚。medoids的重要性分数每天都在更新，它们可以随着用户口味的变化而适应。</p><h2 id="5dd6" class="kw jd hh bd je kx ky kz ji la lb lc jm ip ld le jq it lf lg ju ix lh li jy lj bi translated">设计选择5:处理实时更新的双管齐下的方法</h2><p id="7dab" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">推荐系统适应用户当前的需求是非常重要的。同时，用户的准确表现需要查看他们过去60-90天的活动。数据的庞大规模和增长速度使得很难同时考虑这两个方面。我们通过结合两种方法来解决这个问题:(a)基于用户的长期交互历史推断每个用户的多个medoid的每日批量推断作业，以及(b)基于用户当天的交互推断medoid的同一模型的在线版本。当新的活动到来时，只有在线版本被更新。在一天结束时，批处理版本消耗当天的活动，并解决任何不一致。这种方法确保我们的系统快速适应用户当前的需求，同时不会损害他们的长期利益。</p><h1 id="a12c" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">A/B测试</h1><p id="68fa" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">PinnerSage目前已部署在生产中，并被Pinterest中的许多产品使用，包括Homefeed、相关pin、广告、购物和创作者，以及它们的检索和排名ML模型。我们在两个表面上的初始A/B测试中的胜利如表1所示。</p><p id="c02d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">表1显示，PinnerSage在增加总体参与量(重复次数和点击次数)以及增加参与倾向(每个用户的重复次数和点击次数)方面提供了显著的参与收益。任何收益都可以直接归因于PinnerSage推荐的质量和多样性的提高。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es lm"><img src="../Images/920afb7335db5d2ec10b8c3f9bdca54c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*Uf87knJ-HlkxRJch"/></div><figcaption class="ks kt et er es ku kv bd b be z dx"><strong class="bd je">Table 1: A/B test of PinnerSage vs current production, which includes a single embedding model.</strong></figcaption></figure><h1 id="2bc7" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">结论</h1><p id="680a" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">我们提出了一个名为PinnerSage的端到端系统，该系统支持Pinterest上的个性化推荐。与基于单个基于嵌入的用户表示的现有生产系统相比，PinnerSage提出了一种基于多重嵌入的用户表示方案。我们提出的聚类方案确保我们充分了解用户的需求，并更好地理解他们。为了实现这一点，我们采用了几种设计选择，使我们的系统能够高效运行。我们的大型A/B测试表明，PinnerSage在用户参与度方面有显著提高。我们的模型所带来的许多改进可以归功于它对用户兴趣的更好理解和对用户需求的快速响应。</p><h1 id="709b" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">附录</h1><p id="0e70" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">PinnerSage纸将于2020年出现在KDD。在这里阅读更多关于这篇论文的细节:<a class="ae kf" href="https://arxiv.org/abs/2007.03634" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/abs/2007.03634</a></p><h1 id="8c10" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">承认</h1><p id="f7bb" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated"><em class="ll">我们非常感谢Homefeed和购物团队帮助我们建立在线A/B实验。我们特别感谢嵌入式基础设施团队为嵌入式最近邻搜索提供支持。</em></p></div></div>    
</body>
</html>