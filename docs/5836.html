<html>
<head>
<title>Using OCI Instance Pool and KMS to deploy K3S</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用OCI实例池和KMS部署K3S</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/using-oci-instance-pool-and-kms-to-deploy-k3s-fe8e2c0db926?source=collection_archive---------0-----------------------#2021-11-09">https://medium.com/oracledevs/using-oci-instance-pool-and-kms-to-deploy-k3s-fe8e2c0db926?source=collection_archive---------0-----------------------#2021-11-09</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="b899" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了继续我们在OCI上使用K3S的探索，我想使用OCI实例池来提供服务器和代理。在这个过程中，我还想使用嵌入式etcd作为数据存储。回想一下，<a class="ae jc" rel="noopener" href="/oracledevs/k3s-on-oci-a-kubernetes-cluster-in-under-5-mins-d7c194c19d59">我们对K3S的第一次尝试</a>是采用嵌入式sqlite的单服务器设置。<a class="ae jc" rel="noopener" href="/oracledevs/travel-light-k3s-mysql-on-oci-9b2befda989c">随后的尝试</a>是一个服务器和代理，但也有一个外部数据存储，形式为<a class="ae jc" href="https://docs.oracle.com/en-us/iaas/mysql-database/index.html" rel="noopener ugc nofollow" target="_blank"> MySQL数据库服务(MDS) </a>，我们只是为代理添加了另一个计算实例。在本帖中，我们将尝试另一种数据存储方法，采用<a class="ae jc" href="https://rancher.com/docs/k3s/latest/en/installation/ha-embedded/" rel="noopener ugc nofollow" target="_blank">嵌入式etcd </a>的形式，并为代理和服务器使用实例池。</p><h2 id="8bb9" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">安装K3S服务器</h2><p id="de3c" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">为了运行嵌入etcd的服务器，我们需要奇数台服务器。因此，我们将创建一台计算机，并将K3S安装为服务器:</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="b030" class="jd je hh ki b fi km kn l ko kp">NODE_IP=$(hostname -I | awk '{print $1}')</span><span id="b525" class="jd je hh ki b fi kq kn l ko kp">curl -sfL https://get.k3s.io | K3S_KUBECONFIG_MODE="644" K3S_NODE_NAME=$NODE_IP K3S_CLUSTER_INIT="true" sh -</span></pre><p id="4d16" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这将提供单个服务器节点。</p><h2 id="8a5b" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">使用KMS</h2><p id="380b" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">在<a class="ae jc" rel="noopener" href="/oracledevs/travel-light-k3s-mysql-on-oci-9b2befda989c">之前的示例</a>中，我们还在代理上硬编码了K3S_TOKEN值。如果我们想实现自动化，那么我们需要找到一种安全可靠地存储这个令牌的方法，以便将来服务器或代理可以检索它们。我们可以用<a class="ae jc" href="https://docs.oracle.com/en-us/iaas/Content/KeyManagement/home.htm#top" rel="noopener ugc nofollow" target="_blank"> OCI KMS </a>来做这个。按照文档<a class="ae jc" href="https://docs.oracle.com/en-us/iaas/Content/KeyManagement/Tasks/managingvaults.htm#createnewvault" rel="noopener ugc nofollow" target="_blank">创建保险库</a>。接下来，<a class="ae jc" href="https://docs.oracle.com/en-us/iaas/Content/KeyManagement/Tasks/managingsecrets.htm" rel="noopener ugc nofollow" target="_blank">创建一个秘密</a>并将令牌值存储在该秘密中。可以在以下位置找到群集的令牌:</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="f8be" class="jd je hh ki b fi km kn l ko kp">cat /var/lib/rancher/k3s/server/node-token</span></pre><h2 id="80e2" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">为服务器配置IAM</h2><p id="9964" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">同样，这是手动的。如果我们也想自动化这一步呢？为此，您可以使用<a class="ae jc" href="https://docs.oracle.com/en-us/iaas/Content/API/Concepts/cliconcepts.htm" rel="noopener ugc nofollow" target="_blank"> oci cli </a>。但是，为了让oci cli在实例上工作，您需要使用oci身份验证令牌，或者您可以设置一个具有正确策略的动态组，以允许实例创建机密。这将允许我们使用<a class="ae jc" href="https://docs.oracle.com/en-us/iaas/Content/Identity/Tasks/callingservicesfrominstances.htm" rel="noopener ugc nofollow" target="_blank">实例_主体</a>。</p><p id="8862" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，创建一个标记名称空间(k3s ),然后创建一个标记键定义，选择一个值列表(服务器、代理)。</p><figure class="kd ke kf kg fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es kr"><img src="../Images/653285bfb9368e122e1179ca2186ff64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DEGmO0ovfyLsQd85yvNCDA.png"/></div></div><figcaption class="kz la et er es lb lc bd b be z dx">Creating a Tag Key definition with list of values</figcaption></figure><p id="0f08" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，创建一个动态组(称之为k3s-server ),并创建一个匹配规则，该规则使用以下标记选择服务器作为该动态组的一部分:</p><figure class="kd ke kf kg fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es ld"><img src="../Images/55504336e6572e27d109fa26c8314053.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DbwGqOQsQs8NiJu1nzUJGw.png"/></div></div><figcaption class="kz la et er es lb lc bd b be z dx">Dynamic Group matching rules using tag keys</figcaption></figure><p id="997c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，创建一个策略，允许该组的成员使用密钥和保管库以及管理机密:</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="d4da" class="jd je hh ki b fi km kn l ko kp">Allow dynamic-group dev-k3s-server to manage secrets in compartment id ocid1.compartment.oc1…<br/>Allow dynamic-group dev-k3s-server to use keys in compartment id ocid1.compartment.oc1.<br/>Allow dynamic-group dev-k3s-server to manage vaults in compartment id ocid1.compartment.oc1..<br/>Allow dynamic-group dev-k3s-server to read secret-family in compartment id ocid1.compartment.oc1..</span></pre><p id="76ab" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，在OCI控制台中导航到您的服务器实例，并设置define标记:</p><figure class="kd ke kf kg fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es le"><img src="../Images/9da04bca86b77aebc22fe89ee0878e9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y4Ielere0V79sJ2Nvnuj5g.png"/></div></div><figcaption class="kz la et er es lb lc bd b be z dx">Setting tags on instance</figcaption></figure><p id="b69c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下一次，在创建计算之前，我们可以在创建时设置标签。</p><p id="0be9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们现在可以使用oci cli和instance_principal来创建存储令牌的密码。该令牌相当长，当您以base64格式(OCI KMS要求的格式)对其进行编码时，它可能会被截断。要避免这种情况，请通过将该值设置为0来禁用换行:</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="a304" class="jd je hh ki b fi km kn l ko kp">K3S_TOKEN_SECRET=$(base64 -w 0 /var/lib/rancher/k3s/server/node-token)</span></pre><p id="6f09" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要将oci cli与实例主体一起使用，我们需要添加身份验证机制:</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="37af" class="jd je hh ki b fi km kn l ko kp">oci vault secret create-base64 --compartment-id ${compartment_id} --secret-name ${secret_name} --vault-id ${vault_id} --description "k3s token" --key-id ${key_id} --secret-content-content $K3S_TOKEN_SECRET --auth instance_principal</span></pre><h2 id="21c9" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">为剩余的服务器配置实例池</h2><p id="5bb6" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">现在，我们可以创建一个实例池。因为我们需要奇数个服务器，所以我们可以创建一个2的实例池，使总数达到3。</p><p id="c2c1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，创建一个实例配置来设置计算参数，如形状、子网和NSG。滚动到底部，查找cloud-init脚本文件。您可以输入以下内容</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="086c" class="jd je hh ki b fi km kn l ko kp">NODE_IP=$(hostname -I | awk '{print $1}')</span><span id="a180" class="jd je hh ki b fi kq kn l ko kp">dnf config-manager --enable ol8_developer &amp;&amp; dnf -y install python3-oci-cli</span><span id="05d3" class="jd je hh ki b fi kq kn l ko kp">firewall-offline-cmd --add-port=6443/tcp<br/>firewall-offline-cmd --add-port=10250/tcp<br/>firewall-offline-cmd --add-port=2379/tcp<br/>firewall-offline-cmd --add-port=2380/tcp<br/>firewall-offline-cmd --add-port=8472/udp<br/>systemctl restart firewalld</span><span id="c682" class="jd je hh ki b fi kq kn l ko kp">while [[ $K3S_TOKEN = "" ]]<br/>do<br/>  K3S_TOKEN=$(oci secrets secret-bundle get --secret-id "${secret_id}" --auth instance_principal | jq '[.data."secret-bundle-content"."content" ]' | tr -d "[ \" ]" | base64 -d)<br/>done</span><span id="f3a1" class="jd je hh ki b fi kq kn l ko kp">curl -sfL https://get.k3s.io | K3S_NODE_NAME=$NODE_IP K3S_CLUSTER_INIT="false" K3S_URL=${K3S_URL} K3S_TOKEN=$K3S_TOKEN INSTALL_K3S_EXEC="server" sh -s</span></pre><p id="c24d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">K3S_URL指向https:// <server_ip> :6443/。用实际的id替换secret_id。还要确保您已经设置了已定义的标签。通过设置K3S_URL变量，这将确保作为池的一部分调配的服务器将加入现有群集，通过将INSTALL_K3S_EXEC设置为“server”，这将确保节点池将作为服务器节点加入。</server_ip></p><p id="2d66" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您现在可以创建一个实例池。</p><h2 id="61ea" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">安装代理</h2><p id="edf8" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">创建实例配置和实例池。与服务器类似，为代理和策略创建第二个动态组，允许它读取机密:</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="ad5e" class="jd je hh ki b fi km kn l ko kp">Allow dynamic-group dev-k3s-agent to read secret-family in compartment id ocid1.compartment.oc1..</span></pre><p id="9b90" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">标签的匹配规则显然应该是匹配代理:</p><figure class="kd ke kf kg fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es lf"><img src="../Images/f89e2e405d0484520daee4b03c7ade2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gWJjMlTCONm3yKc4rKZOew.png"/></div></div></figure><p id="4795" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，您可以让代理从OCI保管库检索令牌，如下所示:</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="ddc5" class="jd je hh ki b fi km kn l ko kp">K3S_TOKEN=$(oci secrets secret-bundle get --secret-id "<strong class="ki hi">${secret_id}</strong>" --auth instance_principal | jq '[.data."secret-bundle-content"."content" ]' | tr -d "[ \" ]" | base64 -d)</span></pre><p id="11ce" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上面的＄{ secret _ id }可以参数化，这可以通过cloud-init执行。</p><p id="9b23" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">像以前一样使用云初始化安装K3S代理:</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="90ca" class="jd je hh ki b fi km kn l ko kp">NODE_IP=$(hostname -I | awk '{print $1}')</span><span id="43e3" class="jd je hh ki b fi kq kn l ko kp">dnf config-manager --enable ol8_developer &amp;&amp; dnf -y install python3-oci-cli</span><span id="ef6b" class="jd je hh ki b fi kq kn l ko kp">firewall-offline-cmd --add-port=6443/tcp<br/>firewall-offline-cmd --add-port=10250/tcp<br/>firewall-offline-cmd --add-port=2379/tcp<br/>firewall-offline-cmd --add-port=2380/tcp<br/>firewall-offline-cmd --add-port=8472/udp</span><span id="ac31" class="jd je hh ki b fi kq kn l ko kp"># give 60s for policies to propagate<br/>sleep 60</span><span id="253e" class="jd je hh ki b fi kq kn l ko kp">while [[ $K3S_TOKEN = "" ]]<br/>do<br/>  K3S_TOKEN=$(oci secrets secret-bundle get --secret-id "${secret_id}" --auth instance_principal | jq '[.data."secret-bundle-content"."content" ]' | tr -d "[ \" ]" | base64 -d)<br/>done</span><span id="bba4" class="jd je hh ki b fi kq kn l ko kp">curl -sfL https://get.k3s.io | K3S_NODE_NAME=$NODE_IP K3S_URL=${K3S_URL} K3S_TOKEN=$K3S_TOKEN sh -</span></pre><p id="58ff" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">其中K3S_URL指向https:// <server_ip> :6443/。正如您对服务器池所做的那样，相应地替换secret_id。</server_ip></p><p id="a3b6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">设置完成后，您可以获得一个节点列表:</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="16df" class="jd je hh ki b fi km kn l ko kp">[opc@server ~]$ kubectl get nodes</span><span id="27d6" class="jd je hh ki b fi kq kn l ko kp">NAME          STATUS   ROLES                       AGE     VERSION</span><span id="698e" class="jd je hh ki b fi kq kn l ko kp">10.0.0.18     Ready    control-plane,etcd,master   3h35m   v1.21.5+k3s2<br/>10.0.0.19     Ready    control-plane,etcd,master   3h29m   v1.21.5+k3s2<br/>10.0.0.22     Ready    control-plane,etcd,master   3h29m   v1.21.5+k3s2<br/>10.0.74.32    Ready    &lt;none&gt;                      3h27m   v1.21.5+k3s2<br/>10.0.86.229   Ready    &lt;none&gt;                      3h27m   v1.21.5+k3s2<br/>10.0.99.46    Ready    &lt;none&gt;                      177m    v1.21.5+k3s2</span></pre><p id="f1ff" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从上面可以看到，我们有3个服务器和3个代理。</p><h2 id="05c8" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">测试服务器高可用性</h2><p id="3750" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">我们现在想通过模拟1个服务器节点的崩溃来测试服务器的高可用性。导航到您的计算实例页面，确定在服务器实例池中运行的一个实例，并终止它。我们想检查是否:</p><ol class=""><li id="eb86" class="lg lh hh ig b ih ii il im ip li it lj ix lk jb ll lm ln lo bi translated">实例池自动脱离另一台服务器(相当标准)</li><li id="ffaf" class="lg lh hh ig b ih lp il lq ip lr it ls ix lt jb ll lm ln lo bi translated">新服务器也加入现有集群</li></ol><p id="ce04" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您观察服务器的实例池，您将首先看到一个实例终止:</p><figure class="kd ke kf kg fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es lu"><img src="../Images/31e5ec1f30e83bc318870dfaaa06ff6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B89tEH7Hifm2u4ZjyiZQCA.png"/></div></div></figure><p id="667d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">随后，服务器实例池将进入扩展模式，以满足其运行2个实例的义务:</p><figure class="kd ke kf kg fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es lv"><img src="../Images/eacb117659e3b3c1231f3e245929431d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eafczfaPjf6TvhjqpM2HdQ.png"/></div></div></figure><p id="83dd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">同时，我们的集群如下所示(10.0.0.22是终止的实例，显示为NotReady)。</p><figure class="kd ke kf kg fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es lw"><img src="../Images/d7753b6188740acc0ee14c29f0a0bb95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wa9-XZLObFPtTCGuSZfJbg.png"/></div></div></figure><p id="b9ee" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因为我们正在模拟一次崩溃，所以我们可以省去排水等细节，只需删除节点:</p><pre class="kd ke kf kg fd kh ki kj kk aw kl bi"><span id="d9ad" class="jd je hh ki b fi km kn l ko kp">kubectl delete node 10.0.0.22 </span></pre><p id="42d7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当我们再次列出我们的节点时:</p><figure class="kd ke kf kg fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es lx"><img src="../Images/d6fef22d354d172c35b6819f64785d19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pofpPdkYJSBUgoWffJCnYQ.png"/></div></div><figcaption class="kz la et er es lb lc bd b be z dx">1 server node missing</figcaption></figure><p id="0c03" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们看到少了一个服务器节点。过了一会儿，我们再次列出，我们可以看到一个新的节点已经加入。巧合的是，它也被分配了相同的IP地址。</p><figure class="kd ke kf kg fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es ly"><img src="../Images/df25469d8622e416f098c9e33e3f06af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sBLQLpfhaDhfXx_khDYx4Q.png"/></div></div></figure><h2 id="fca9" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">扩展代理</h2><p id="c3c2" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">如果我们想扩展代理呢？我们可以增加代理池的大小。导航到实例池页面，对其进行编辑，并将大小设置为所需的数字。在这里，我将代理池的大小增加了两倍:</p><figure class="kd ke kf kg fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es lz"><img src="../Images/111adf4d15b954eb03e26e69b7b840e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Efc7lD8GL7XNSnRprPVFg.png"/></div></div></figure><figure class="kd ke kf kg fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es ma"><img src="../Images/a02e00208db40f5a88f3512dbe2a82f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c1L0tbcegk44juqpLgWPKg.png"/></div></div></figure><p id="f4f5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在所有代理加入后，我们现在可以看到代理数量的增加:</p><figure class="kd ke kf kg fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es mb"><img src="../Images/eaedb8b2b2a578cf697567b24ee79c3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-8U2Ow4OCV-OAhQrLACmgg.png"/></div></div></figure><h2 id="ebd0" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">未来改进</h2><p id="2b39" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">我们还可以在其他几个方面有所改进:</p><ul class=""><li id="b9cb" class="lg lh hh ig b ih ii il im ip li it lj ix lk jb mc lm ln lo bi translated">初始服务器也可以创建为实例池的一部分</li><li id="7b66" class="lg lh hh ig b ih lp il lq ip lr it ls ix lt jb mc lm ln lo bi translated">我们可以在API服务器前使用内部负载平衡器</li><li id="221b" class="lg lh hh ig b ih lp il lq ip lr it ls ix lt jb mc lm ln lo bi translated">我们可以生成一个秘密并预先存储在保险库中。这样，我们只需要向动态组授予读取权限。</li></ul><p id="1fbb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但是现在，我对上述内容相当满意。我要感谢我的同事和朋友们对本文的贡献和非常有帮助的建议:<a class="md me ge" href="https://medium.com/u/963da490a63?source=post_page-----fe8e2c0db926--------------------------------" rel="noopener" target="_blank">阿维·米勒</a>、<a class="md me ge" href="https://medium.com/u/9f864653bb16?source=post_page-----fe8e2c0db926--------------------------------" rel="noopener" target="_blank">斯蒂芬·克罗斯</a>和<a class="md me ge" href="https://medium.com/u/a4deeec35158?source=post_page-----fe8e2c0db926--------------------------------" rel="noopener" target="_blank">肖恩·利维</a>。</p></div></div>    
</body>
</html>