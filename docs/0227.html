<html>
<head>
<title>Announcing Lottie 4.0 for iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">宣布Lottie 4.0 for版</h1>
<blockquote>原文：<a href="https://medium.com/airbnb-engineering/announcing-lottie-4-0-for-ios-d4d226862a54?source=collection_archive---------0-----------------------#2022-12-06">https://medium.com/airbnb-engineering/announcing-lottie-4-0-for-ios-d4d226862a54?source=collection_archive---------0-----------------------#2022-12-06</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="0182" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一个新的渲染引擎，由核心动画提供支持，显著提高了性能</p><p id="6967" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">作者:</strong> <a class="ae jc" href="https://www.linkedin.com/in/calstephens/" rel="noopener ugc nofollow" target="_blank">卡尔·斯蒂芬斯</a></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/108f980b0f645ceab52024aa1ad4ee27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y4aQ-u0Mnh0S5b71sKr-Fg.jpeg"/></div></div></figure><p id="c043" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jc" href="https://airbnb.design/lottie/" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi">洛蒂</strong> </a>是Airbnb的<a class="ae jc" href="https://airbnb.io/lottie/#/README" rel="noopener ugc nofollow" target="_blank">跨平台</a>，<a class="ae jc" href="https://github.com/airbnb/lottie-ios" rel="noopener ugc nofollow" target="_blank">开源</a>库，用于渲染矢量运动图形。我们在Airbnb广泛使用Lottie，它也为整个行业数以千计的其他应用程序提供动画。</p><div class="je jf jg jh fd ab cb"><figure class="jp ji jq jr js jt ju paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><img src="../Images/640d35d6a187dbc17ace0399e90561e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/1*YncHlVnpvqU3hnjwo4g7dg.gif"/></div></figure><figure class="jp ji jv jr js jt ju paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><img src="../Images/196e0aa12cf509a2826e2a312ae48482.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/1*-69VqnYxgYdp8xOyiaDGSQ.gif"/></div></figure><figure class="jp ji jw jr js jt ju paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><img src="../Images/ee086c802dc4e191e730b234e6ace6f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/1*Ie-4EfSyrNjA9sZnAo6ASA.gif"/></div><figcaption class="jx jy et er es jz ka bd b be z dx kb di kc kd">Example Lottie animations included in Airbnb’s iOS app</figcaption></figure></div><p id="0939" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">今天我们发布iOS版的<a class="ae jc" href="https://github.com/airbnb/lottie-ios/releases/tag/4.0.0" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi">洛蒂4.0 </strong> </a> <strong class="ig hi"> </strong>。这个重要的新版本为所有洛蒂动画带来了<strong class="ig hi">显著的性能提升</strong>，它拥有一个由核心动画驱动的全新渲染引擎。</p><p id="c346" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在大规模使用Lottie多年后，我们已经了解了它在真实使用案例中的许多性能特征。我们发现洛蒂动画在一些更复杂的屏幕上丢帧是相对常见的。为了理解为什么，我们首先要看看洛蒂以前是如何渲染动画的。</p><p id="2f07" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Lottie以前的版本在应用程序的主线程上播放动画，有效地使用了一个<a class="ae jc" href="https://developer.apple.com/documentation/quartzcore/cadisplaylink?language=objc" rel="noopener ugc nofollow" target="_blank"><em class="ke">CADisplayLink</em></a>。每帧一次，Lottie将在主线程上执行代码，以推进动画的进度并重新呈现其内容。这意味着动画在播放时将消耗5–20%以上的CPU，留给应用程序其余部分的CPU周期更少:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kf"><img src="../Images/66f497878291b8c826ac3fc6e916ffe9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Z4DbWMMV2dHCQoETuW0taQ.gif"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx"><em class="kg">Playing an animation with Lottie 3.5.0, using the original main thread rendering engine</em></figcaption></figure><p id="c207" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这也意味着当主线程繁忙时，动画不会更新。这可能会导致动画丢帧或完全冻结，从而导致用户体验不佳:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kh"><img src="../Images/9a4242d71a3524d55d91d6ecf42c025e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Nnlh9Fk_Im--KvAyL1v5KQ.gif"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx"><em class="kg">Lottie animations dropping frames when the main thread is overloaded</em></figcaption></figure><p id="ead0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这些问题是使用主线程绑定渲染架构的固有限制。</p><p id="c0e5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在iOS上，播放动画最高效的方式是使用<a class="ae jc" href="https://developer.apple.com/documentation/quartzcore?language=objc" rel="noopener ugc nofollow" target="_blank">核心动画</a>。该系统框架通过GPU硬件加速在进程外渲染动画。动画回放由一个称为“渲染服务器”的独立系统进程管理。这意味着核心动画驱动的动画不会影响应用程序进程本身的CPU利用率，即使其主线程被阻塞或繁忙，也可以继续运行。</p><p id="c752" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在整个2022年，我们一直在为Lottie开发一个基于核心动画的新渲染引擎。对于动画JSON文件中的每个层，新引擎都会构建一个<em class="ke"> CALayer </em>并应用<em class="ke"> CAAnimation </em> s以及层的动画属性的关键帧。Lottie将这些动画关键帧传递给核心动画，核心动画负责将它们实际渲染到屏幕上，并更新每一帧的动画。</p><p id="0c3d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这个新的引擎消除了播放洛蒂动画的CPU开销，并有效地保证了洛蒂动画将以60或120 fps的速度流畅地播放，而不管应用的CPU负载如何。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ki"><img src="../Images/881a5925f6bb4736909ebae4ebc889c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*QmNCLz3e_Zuez3nFBvu_LA.gif"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx"><em class="kg">Playing an animation with Lottie 4.0, using the new Core Animation rendering engine</em></figcaption></figure><p id="7e8a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">由于新引擎渲染的动画不会在应用程序的主线程上执行任何代码，因此应用程序现在有更多资源可用于其他功能。这在运行高CPU负载的任务时尤其有价值。例如，Airbnb应用程序在第一次启动时会显示一个Lottie动画。我们在这里做了一个实验，发现切换到新的渲染引擎<em class="ke">减少了</em>我们应用的总启动时间，而<em class="ke">也提高了启动动画的帧率和UX。</em></p><p id="9d74" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们<a class="ae jc" href="https://github.com/airbnb/lottie-ios/discussions/1627" rel="noopener ugc nofollow" target="_blank">在今年早些时候首次在Lottie 3.4.0中引入了核心动画渲染引擎</a>，隐藏在一个选择加入功能标志之后。六个多月来，我们一直在默认情况下为Airbnb应用程序中的所有Lottie动画使用新引擎，并一直在努力解决社区中早期采用者报告的问题。</p><p id="9083" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从今天的Lottie 4.0版本开始，核心动画渲染引擎默认为所有使用Lottie的应用程序启用，应用程序开发人员无需额外工作或迁移。这是一个重要的里程碑，我们已经为此努力了很长时间，我们希望它有助于提高整个行业的动画质量和性能！</p><p id="8502" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Lottie 4.0 for iOS还包括社区成员贡献的几项重大增强功能:</p><ul class=""><li id="1af5" class="kj kk hh ig b ih ii il im ip kl it km ix kn jb ko kp kq kr bi translated">支持<a class="ae jc" href="https://dotlottie.io/" rel="noopener ugc nofollow" target="_blank"> dotLottie动画文件</a>，比标准JSON文件小得多</li><li id="8f53" class="kj kk hh ig b ih ks il kt ip ku it kv ix kw jb ko kp kq kr bi translated">新的动画解码实现比之前基于<em class="ke">可编码</em>的实现快2倍</li></ul><p id="9fa6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在我们之前发布的帖子中，您可以了解更多关于Lottie的信息，以及我们对开源的承诺:</p><ul class=""><li id="95cc" class="kj kk hh ig b ih ii il im ip kl it km ix kn jb ko kp kq kr bi translated"><a class="ae jc" href="https://airbnb.design/introducing-lottie/" rel="noopener ugc nofollow" target="_blank">介绍洛蒂</a>:我们新的开源动画工具的幕后</li><li id="80cf" class="kj kk hh ig b ih ks il kt ip ku it kv ix kw jb ko kp kq kr bi translated">将洛蒂迅速带入未来 : <strong class="ig hi"> </strong>这是一个关于Airbnb如何用一种新语言改写流行的开源图书馆洛蒂的个人故事</li></ul><p id="e642" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有兴趣在Airbnb工作吗？查看这些开放的角色:</p><p id="b137" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jc" href="https://careers.airbnb.com/positions/4693375/" rel="noopener ugc nofollow" target="_blank">软件工程师，愿望清单</a></p><p id="bb29" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jc" href="https://careers.airbnb.com/positions/4665949/" rel="noopener ugc nofollow" target="_blank">员工软件工程师，嘉宾&amp;主持人</a></p><h1 id="f38f" class="kx ky hh bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">感谢</h1><p id="b6ca" class="pw-post-body-paragraph ie if hh ig b ih lv ij ik il lw in io ip lx ir is it ly iv iw ix lz iz ja jb ha bi translated">非常感谢Eric Horacek首先提出这个项目，并在过去的一年里审查了100多个拉请求。还要感谢《洛蒂》的原作者布兰登·威斯罗，以及这些年来给予帮助的许多其他贡献者。</p></div><div class="ab cl ma mb go mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ha hb hc hd he"><p id="b8ba" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="ke">所有产品名称、标识和品牌均为其各自所有者的财产。本网站中使用的所有公司、产品和服务名称仅用于识别目的。使用这些名称、标志和品牌并不意味着认可。</em></p></div></div>    
</body>
</html>