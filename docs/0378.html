<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/introducing-workmanager-2083bcfc4712?source=collection_archive---------0-----------------------#2018-12-19">https://medium.com/androiddevelopers/introducing-workmanager-2083bcfc4712?source=collection_archive---------0-----------------------#2018-12-19</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/3af6f7d7fb39e2a609d58e08a7b7e4fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Feqy3ufsr7NRCFSDuQfWw.png"/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx">Illustration by <a class="ae hu" href="https://twitter.com/VPoltrack" rel="noopener ugc nofollow" target="_blank">Virginia Poltrack</a></figcaption></figure><p id="761e" class="pw-post-body-paragraph hv hw hx hy b hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq ir is it ha bi translated">欢迎来到我们的工作管理器系列的第一篇文章。WorkManager是一个<a class="ae hu" href="https://developer.android.com/jetpack/" rel="noopener ugc nofollow" target="_blank"> Android Jetpack </a>库，当工作的约束得到满足时，它运行可推迟的、有保证的后台工作。这是目前在Android上进行此类工作的最佳实践。</p><p id="673d" class="pw-post-body-paragraph hv hw hx hy b hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq ir is it ha bi translated">在这些文章中，我们涵盖了:</p><ul class=""><li id="f2aa" class="iu iv hx hy b hz ia id ie ih iw il ix ip iy it iz ja jb jc bi translated">什么是工作管理器以及何时使用工作管理器(本文)</li><li id="dbdc" class="iu iv hx hy b hz jd id je ih jf il jg ip jh it iz ja jb jc bi translated"><a class="ae hu" rel="noopener" href="/androiddevelopers/workmanager-basics-beba51e94048">如何使用工作管理器API调度工作</a></li><li id="2a68" class="iu iv hx hy b hz jd id je ih jf il jg ip jh it iz ja jb jc bi translated"><a class="ae hu" rel="noopener" href="/androiddevelopers/workmanager-meets-kotlin-b9ad02f7405e">工作管理器和科特林</a></li><li id="9acb" class="iu iv hx hy b hz jd id je ih jf il jg ip jh it iz ja jb jc bi translated"><a class="ae hu" rel="noopener" href="/androiddevelopers/workmanager-periodicity-ff35185ff006">工作管理器周期</a></li><li id="faf8" class="iu iv hx hy b hz jd id je ih jf il jg ip jh it iz ja jb jc bi translated"><a class="ae hu" rel="noopener" href="/androiddevelopers/customizing-workmanager-fundamentals-fdaa17c46dd2">定制工作管理器—基础</a></li><li id="620c" class="iu iv hx hy b hz jd id je ih jf il jg ip jh it iz ja jb jc bi translated"><a class="ae hu" rel="noopener" href="/androiddevelopers/customizing-workmanager-with-dagger-1029688c0978">用匕首定制工作管理器</a></li></ul><h1 id="6e5d" class="ji jj hx bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">工作管理器简介</h1><p id="3256" class="pw-post-body-paragraph hv hw hx hy b hz kg ib ic id kh if ig ih ki ij ik il kj in io ip kk ir is it ha bi kl translated">这里有很多处理后台工作的注意事项和最佳实践，在谷歌的Power博客系列文章中有概述。其中一个反复出现的调用是一个名为<a class="ae hu" href="https://developer.android.com/topic/libraries/architecture/workmanager/" rel="noopener ugc nofollow" target="_blank">工作管理器</a>的<a class="ae hu" href="https://developer.android.com/jetpack/" rel="noopener ugc nofollow" target="_blank"> Android Jetpack </a>库，它扩展了<a class="ae hu" href="https://developer.android.com/reference/android/app/job/JobScheduler" rel="noopener ugc nofollow" target="_blank">作业调度器</a>框架API的功能，并支持Android 4.0+ (API 14+)。<a class="ae hu" href="https://developer.android.com/jetpack/docs/release-notes#december_19_2018" rel="noopener ugc nofollow" target="_blank"> WorkManager beta </a>今天刚刚发布！</p><p id="c590" class="pw-post-body-paragraph hv hw hx hy b hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq ir is it ha bi translated">这篇博文是关于WorkManager的新系列的第一篇。我们将探索WorkManager的基础知识，如何以及何时使用它，以及幕后发生了什么。然后我们将深入更复杂的用例。</p><h1 id="dd60" class="ji jj hx bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">什么是工作管理器？</h1><p id="a968" class="pw-post-body-paragraph hv hw hx hy b hz kg ib ic id kh if ig ih ki ij ik il kj in io ip kk ir is it ha bi translated">WorkManager是Android架构组件之一，也是Android Jetpack的一部分，这是一个关于如何构建现代Android应用程序的新观点。</p><blockquote class="ku kv kw"><p id="b573" class="hv hw kx hy b hz ia ib ic id ie if ig ky ii ij ik kz im in io la iq ir is it ha bi translated"><em class="hx"> WorkManager是一个Android库，当工作的</em> <strong class="hy lb"> <em class="hx">约束</em> </strong> <em class="hx">满足时，运行</em> <strong class="hy lb"> <em class="hx">可推迟</em> </strong> <em class="hx">后台工作。</em></p><p id="054f" class="hv hw kx hy b hz ia ib ic id ie if ig ky ii ij ik kz im in io la iq ir is it ha bi translated"><em class="hx">工作管理器适用于需要</em> <strong class="hy lb"> <em class="hx">保证</em> </strong> <em class="hx">即使应用程序退出</em>系统也会运行它们的任务</p></blockquote><p id="9efa" class="pw-post-body-paragraph hv hw hx hy b hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq ir is it ha bi translated">换句话说，WorkManager提供了一个电池友好的API，封装了Android后台行为限制的多年演变。这对于需要执行后台任务的Android应用来说至关重要！</p><h1 id="1483" class="ji jj hx bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">何时使用工作管理器</h1><p id="4085" class="pw-post-body-paragraph hv hw hx hy b hz kg ib ic id kh if ig ih ki ij ik il kj in io ip kk ir is it ha bi translated">WorkManager处理满足各种约束时需要运行的后台工作，而不管应用程序进程是否处于活动状态。后台工作可以在app在后台的时候开始，也可以在app在前台的时候开始，也可以在app在前台启动但转到后台的时候开始。不管应用程序正在做什么，后台工作应该继续执行，或者如果Android终止了它的进程，应该重新启动。</p><p id="2b92" class="pw-post-body-paragraph hv hw hx hy b hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq ir is it ha bi translated">关于WorkManager的一个常见混淆是，它用于需要在“后台”线程中运行但不需要在进程死亡后存活的任务。事实并非如此。对于这个用例，还有其他的解决方案，比如Kotlin的协程、线程池或RxJava之类的库。您可以在<a class="ae hu" href="https://developer.android.com/guide/background/" rel="noopener ugc nofollow" target="_blank">后台处理指南</a>中找到关于该用例的更多信息。</p><p id="114c" class="pw-post-body-paragraph hv hw hx hy b hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq ir is it ha bi translated">在许多不同的情况下，您需要运行后台工作，因此运行后台工作有不同的解决方案。这篇关于后台处理的博文提供了很多关于何时使用WorkManager的有用信息。看看博客上的这张图表:</p><figure class="ld le lf lg fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lc"><img src="../Images/6d41eab9bf38b65a6711d1728e6c309b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K-jWMXQbAK98EdkuuaZCFg.png"/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx">Diagram from <a class="ae hu" href="https://android-developers.googleblog.com/2018/10/modern-background-execution-in-android.html" rel="noopener ugc nofollow" target="_blank">Modern background execution in Android</a></figcaption></figure><p id="7434" class="pw-post-body-paragraph hv hw hx hy b hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq ir is it ha bi translated">对于工作管理器来说，最好是那些必须<strong class="hy lb">完成</strong>并且<strong class="hy lb">可以推迟</strong>的后台工作。</p><p id="5189" class="pw-post-body-paragraph hv hw hx hy b hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq ir is it ha bi translated">首先，问问你自己:</p><ul class=""><li id="f896" class="iu iv hx hy b hz ia id ie ih iw il ix ip iy it iz ja jb jc bi translated"><strong class="hy lb">这个任务<em class="kx">需要</em>来完成吗？</strong> <br/>如果应用被用户关闭，还需要完成任务吗？一个例子是具有远程同步的笔记记录应用；一旦你写完笔记，你希望应用程序将你的笔记与后端服务器同步。即使您切换到另一个应用程序，并且操作系统需要关闭该应用程序来回收一些内存，也会发生这种情况。即使重新启动设备，也会发生这种情况。工作管理器确保任务完成。</li><li id="eb6f" class="iu iv hx hy b hz jd id je ih jf il jg ip jh it iz ja jb jc bi translated">这个任务可以推迟吗？ <br/>我们可以以后再运行任务吗，还是只有现在运行<strong class="hy lb"/>才有用？如果任务可以稍后运行，那么它是可推迟的。回到前面的例子，立即上传你的笔记是很好的，但是，如果这是不可能的，同步发生在以后，这不是一个大问题。WorkManager尊重操作系统后台限制，并尝试以电池高效的方式运行您的工作。</li></ul><p id="71a7" class="pw-post-body-paragraph hv hw hx hy b hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq ir is it ha bi translated">因此，作为一项指导原则，WorkManager适用于需要保证系统会运行它们的任务，即使应用程序存在。它不适用于需要立即执行或需要在精确时间执行的后台工作。如果你需要你的工作在一个精确的时间执行(比如闹钟，或者事件提醒)，使用<a class="ae hu" href="https://developer.android.com/training/scheduling/alarms" rel="noopener ugc nofollow" target="_blank"> AlarmManager </a>。对于需要立即执行但需要长时间运行的工作，您通常需要确保工作在前台执行；无论是通过将执行限制在前台(在这种情况下，工作不再是真正的后台工作)还是使用<a class="ae hu" href="https://android-developers.googleblog.com/2018/12/effective-foreground-services-on-android_11.html" rel="noopener ugc nofollow" target="_blank">前台服务</a>。</p><p id="9cb2" class="pw-post-body-paragraph hv hw hx hy b hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq ir is it ha bi translated">当您需要在更复杂的场景中触发一些后台工作时，WorkManager可以并且应该与其他API配对:</p><ul class=""><li id="de4b" class="iu iv hx hy b hz ia id ie ih iw il ix ip iy it iz ja jb jc bi translated">如果您的服务器触发工作，WorkManager可以与Firebase Cloud Messaging配对。</li><li id="4b3d" class="iu iv hx hy b hz jd id je ih jf il jg ip jh it iz ja jb jc bi translated">如果您正在使用广播接收器收听广播，然后需要触发长时间运行的工作，您可以使用工作管理器。注意，WorkManager提供了对许多常见的<a class="ae hu" href="https://developer.android.com/reference/androidx/work/Constraints" rel="noopener ugc nofollow" target="_blank">约束</a>的支持，这些约束通常以广播的形式出现——在这些情况下，您不需要注册自己的广播接收器。</li></ul><h1 id="e415" class="ji jj hx bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">为什么使用工作管理器？</h1><p id="ef7c" class="pw-post-body-paragraph hv hw hx hy b hz kg ib ic id kh if ig ih ki ij ik il kj in io ip kk ir is it ha bi translated">WorkManager运行后台工作，同时为您处理电池和系统健康的兼容性问题和最佳实践。</p><p id="7102" class="pw-post-body-paragraph hv hw hx hy b hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq ir is it ha bi translated">此外，使用WorkManager，您可以调度周期性任务和复杂的依赖任务链:后台工作可以并行或顺序执行，您可以指定执行顺序。WorkManager无缝地处理任务之间的输入和输出传递。</p><p id="b199" class="pw-post-body-paragraph hv hw hx hy b hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq ir is it ha bi translated">您还可以设置后台任务何时运行的标准。例如，如果设备没有网络连接，就没有理由向远程服务器发出HTTP请求。因此，您可以设置一个约束，该任务只能在网络连接存在时运行。</p><p id="76b4" class="pw-post-body-paragraph hv hw hx hy b hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq ir is it ha bi translated">作为保证执行的一部分，WorkManager负责在设备或应用程序重启时保持您的工作。如果您的工作被停止，并且您想要稍后重试，您也可以很容易地定义重试策略。</p><p id="c591" class="pw-post-body-paragraph hv hw hx hy b hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq ir is it ha bi translated">最后，WorkManager允许您观察工作请求的状态，以便您可以更新您的UI。</p><p id="db6b" class="pw-post-body-paragraph hv hw hx hy b hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq ir is it ha bi translated">总而言之，WorkManager具有以下优势:</p><ul class=""><li id="7382" class="iu iv hx hy b hz ia id ie ih iw il ix ip iy it iz ja jb jc bi translated">处理与不同操作系统版本的兼容性</li><li id="3a16" class="iu iv hx hy b hz jd id je ih jf il jg ip jh it iz ja jb jc bi translated">遵循系统健康最佳实践</li><li id="546a" class="iu iv hx hy b hz jd id je ih jf il jg ip jh it iz ja jb jc bi translated">支持异步一次性和周期性任务</li><li id="15b2" class="iu iv hx hy b hz jd id je ih jf il jg ip jh it iz ja jb jc bi translated">支持带输入/输出的链式任务</li><li id="d657" class="iu iv hx hy b hz jd id je ih jf il jg ip jh it iz ja jb jc bi translated">允许您设置任务运行时间的限制</li><li id="fa34" class="iu iv hx hy b hz jd id je ih jf il jg ip jh it iz ja jb jc bi translated">即使应用或设备重启，也能保证任务执行</li></ul><p id="55cf" class="pw-post-body-paragraph hv hw hx hy b hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq ir is it ha bi translated">让我们看一个具体的例子，其中我们建立了一个并行任务的管道，将过滤器应用于图像。然后将结果发送到压缩任务，然后发送到上传任务。</p><p id="3c0e" class="pw-post-body-paragraph hv hw hx hy b hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq ir is it ha bi translated">我们可以为这些任务定义一组约束，并指定何时可以执行它们:</p><figure class="ld le lf lg fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lh"><img src="../Images/c136b2488025c8b57d202065f2373c5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2arjXq_bwgaNwVBCiLgiOw.png"/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx">Sample chain of tasks with constraints</figcaption></figure><p id="f283" class="pw-post-body-paragraph hv hw hx hy b hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq ir is it ha bi translated">所有这些工作器都定义了一个精确的顺序:例如，我们不知道图像过滤的顺序，但是我们知道压缩工作器只有在所有的过滤工作器都完成之后才会启动。</p><h1 id="66ef" class="ji jj hx bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">工作管理器调度程序如何工作</h1><p id="07a5" class="pw-post-body-paragraph hv hw hx hy b hz kg ib ic id kh if ig ih ki ij ik il kj in io ip kk ir is it ha bi translated">为了确保与API级别14的兼容性，WorkManager会根据设备API级别选择合适的方式来调度后台任务。WorkManager可能使用JobScheduler或BroadcastReceiver和AlarmManager的组合。</p><figure class="ld le lf lg fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es li"><img src="../Images/31f942d81072db1d9bbbc4eb112e197f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FxHlzZfv4Q0XBRBV2WmvPQ.png"/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx">How WorkManager determines which scheduler to use</figcaption></figure><h1 id="c9ff" class="ji jj hx bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">工作管理器准备好投入生产使用了吗？</h1><p id="6254" class="pw-post-body-paragraph hv hw hx hy b hz kg ib ic id kh if ig ih ki ij ik il kj in io ip kk ir is it ha bi translated">工作管理器现在处于测试阶段。这意味着在这个主要版本中不会有突破性的API变化。</p><p id="efbe" class="pw-post-body-paragraph hv hw hx hy b hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq ir is it ha bi translated">当WorkManager作为稳定版发布时，它将是运行后台任务的首选方式。因此，现在是开始使用WorkManager并帮助<a class="ae hu" href="https://issuetracker.google.com/issues?q=componentid:409906" rel="noopener ugc nofollow" target="_blank">改进它的大好时机</a>！</p><p id="d4d0" class="pw-post-body-paragraph hv hw hx hy b hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq ir is it ha bi translated"><em class="kx">拜</em><a class="ae hu" rel="noopener" href="/@lylalyla">T5】林珈安藤原 </a> <em class="kx">。</em></p><h1 id="05fe" class="ji jj hx bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">工作经理的资源</h1><ul class=""><li id="5716" class="iu iv hx hy b hz kg id kh ih lj il lk ip ll it iz ja jb jc bi translated"><a class="ae hu" href="https://developer.android.com/topic/libraries/architecture/workmanager/" rel="noopener ugc nofollow" target="_blank">文档</a></li><li id="e26b" class="iu iv hx hy b hz jd id je ih jf il jg ip jh it iz ja jb jc bi translated"><a class="ae hu" href="https://developer.android.com/reference/androidx/work/package-summary" rel="noopener ugc nofollow" target="_blank">参考指南</a></li><li id="8a76" class="iu iv hx hy b hz jd id je ih jf il jg ip jh it iz ja jb jc bi translated"><a class="ae hu" href="https://developer.android.com/jetpack/docs/release-notes#december_19_2018" rel="noopener ugc nofollow" target="_blank">工作管理器1.0.0-beta01发行说明</a></li><li id="bf6e" class="iu iv hx hy b hz jd id je ih jf il jg ip jh it iz ja jb jc bi translated"><a class="ae hu" href="https://codelabs.developers.google.com/codelabs/android-workmanager-kt/index.html" rel="noopener ugc nofollow" target="_blank"> Codelab </a></li><li id="9f7e" class="iu iv hx hy b hz jd id je ih jf il jg ip jh it iz ja jb jc bi translated"><a class="ae hu" href="https://android.googlesource.com/platform/frameworks/support/+/master/work" rel="noopener ugc nofollow" target="_blank">源代码(AOSP的一部分)</a></li><li id="cc66" class="iu iv hx hy b hz jd id je ih jf il jg ip jh it iz ja jb jc bi translated"><a class="ae hu" href="https://issuetracker.google.com/issues?q=componentid:409906" rel="noopener ugc nofollow" target="_blank">发行跟踪者</a></li><li id="9124" class="iu iv hx hy b hz jd id je ih jf il jg ip jh it iz ja jb jc bi translated"><a class="ae hu" href="https://stackoverflow.com/questions/tagged/android-workmanager" rel="noopener ugc nofollow" target="_blank">工作管理器关于StackOverflow的问题</a></li><li id="0b19" class="iu iv hx hy b hz jd id je ih jf il jg ip jh it iz ja jb jc bi translated"><a class="ae hu" href="https://android-developers.googleblog.com/search/label/Power%20series" rel="noopener ugc nofollow" target="_blank">谷歌的权力博客系列文章</a></li></ul></div></div>    
</body>
</html>