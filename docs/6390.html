<html>
<head>
<title>Using Google’s SafetyNet reCAPTCHA API with Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Android上使用Google的SafetyNet reCAPTCHA API</h1>
<blockquote>原文：<a href="https://medium.com/quick-code/using-googles-safetynet-recaptcha-api-with-android-48e2cf12f370?source=collection_archive---------1-----------------------#2018-01-28">https://medium.com/quick-code/using-googles-safetynet-recaptcha-api-with-android-48e2cf12f370?source=collection_archive---------1-----------------------#2018-01-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div class="er es hf"><img src="../Images/95250ffdbeecee0bca9235d49dacef1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*y0ebtcYB9RbLwLMrcRb2-A.jpeg"/></div></figure><div class=""/><p id="4c7e" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">SafetyNet服务包括一个reCAPTCHA API，您可以使用它来保护您的应用程序免受恶意流量的攻击。</p><p id="0433" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">reCAPTCHA是一项免费服务，使用先进的风险分析引擎来保护您的应用程序免受垃圾邮件和其他滥用行为的影响。</p><h2 id="c8d6" class="jj jk ho bd jl jm jn jo jp jq jr js jt iw ju jv jw ja jx jy jz je ka kb kc kd bi translated"><strong class="ak">第一步:浏览reCAPTCHA服务条款</strong></h2><p id="9dab" class="pw-post-body-paragraph il im ho in b io ke iq ir is kf iu iv iw kg iy iz ja kh jc jd je ki jg jh ji ha bi translated">在访问API之前，请阅读并理解所有适用的<a class="ae kj" href="https://developers.google.com/terms/" rel="noopener ugc nofollow" target="_blank">服务条款</a>。</p><h2 id="d094" class="jj jk ho bd jl jm jn jo jp jq jr js jt iw ju jv jw ja jx jy jz je ka kb kc kd bi translated"><strong class="ak">步骤2: </strong>注册一个reCAPTCHA密钥对</h2><p id="58e1" class="pw-post-body-paragraph il im ho in b io ke iq ir is kf iu iv iw kg iy iz ja kh jc jd je ki jg jh ji ha bi translated">要注册密钥对，请访问<a class="ae kj" href="https://g.co/recaptcha/androidsignup" rel="noopener ugc nofollow" target="_blank"> reCAPTCHA Android注册网站</a>，为您的密钥添加一个唯一的标签，提供使用此API密钥的每个应用程序的包名，并获取出现在下一页的站点密钥和秘密密钥。</p><h2 id="f6ec" class="jj jk ho bd jl jm jn jo jp jq jr js jt iw ju jv jw ja jx jy jz je ka kb kc kd bi translated">步骤3:添加安全网API依赖项</h2><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="f1bb" class="jj jk ho kp b fi kt ku l kv kw">apply plugin: 'com.android.application'<br/>...<br/>dependencies {<br/>    <strong class="kp hp">compile 'com.google.android.gms:play-services-safetynet:11.8.0'</strong><br/>}</span></pre><h2 id="91e6" class="jj jk ho bd jl jm jn jo jp jq jr js jt iw ju jv jw ja jx jy jz je ka kb kc kd bi translated">第四步:终于到了成为人类的时候了😎</h2><p id="3e27" class="pw-post-body-paragraph il im ho in b io ke iq ir is kf iu iv iw kg iy iz ja kh jc jd je ki jg jh ji ha bi translated">只要您想调用captcha小部件，就使用下面的代码:</p><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="544e" class="jj jk ho kp b fi kt ku l kv kw">SafetyNet.getClient(this).verifyWithRecaptcha(<strong class="kp hp">YOUR_API_SITE_KEY</strong>)<br/>        .addOnSuccessListener((Executor) this,<br/>            new OnSuccessListener&lt;SafetyNetApi.RecaptchaTokenResponse&gt;() {<br/>                @Override<br/>                public void onSuccess(SafetyNetApi.RecaptchaTokenResponse response) {<br/>                  // Indicates communication with reCAPTCHA service was successful.<br/>                 String userResponseToken=response.getTokenResult();<br/>                    if (!userResponseToken.isEmpty()) {<br/>                       // Validate the user response token using the<br/>                       // <a class="ae kj" href="https://developers.google.com/recaptcha/docs/verify" rel="noopener ugc nofollow" target="_blank">reCAPTCHA siteverify API</a>.<br/>                    }<br/>                }<br/>        })<br/>        .addOnFailureListener((Executor) this, new OnFailureListener() {<br/>                @Override<br/>                public void onFailure(@NonNull Exception e) {<br/>                    if (e instanceof ApiException) {<br/>                     ApiException apiException = (ApiException) e;<br/>                     int statusCode = apiException.getStatusCode();<br/>                    } else {<br/>                        // A unknown type of error occurred.<br/>                        Log.d(TAG, "Error: " + e.getMessage());<br/>                    }<br/>                }<br/>        });</span></pre><h2 id="848d" class="jj jk ho bd jl jm jn jo jp jq jr js jt iw ju jv jw ja jx jy jz je ka kb kc kd bi translated">步骤5:最后一步在服务器上验证用户的响应令牌</h2><p id="ca88" class="pw-post-body-paragraph il im ho in b io ke iq ir is kf iu iv iw kg iy iz ja kh jc jd je ki jg jh ji ha bi translated">当reCAPTCHA API执行<code class="du kx ky kz kp b"><a class="ae kj" href="https://developers.google.com/android/reference/com/google/android/gms/tasks/OnSuccessListener.html#onSuccess(TResult)" rel="noopener ugc nofollow" target="_blank">onSuccess()</a></code>方法时，用户已经成功完成了验证码挑战&amp;我们仍然需要验证来自后端服务器的用户响应令牌。</p><p id="bede" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">因此，您需要发送一个post请求到URL:</p><p id="1e64" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">API请求URL:<a class="ae kj" href="https://www.google.com/recaptcha/api/siteverify" rel="noopener ugc nofollow" target="_blank">https://www.google.com/recaptcha/api/siteverify</a></p><p id="576c" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">方法:邮寄</p><p id="4bf3" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">发布参数:</p><ol class=""><li id="e4a8" class="la lb ho in b io ip is it iw lc ja ld je le ji lf lg lh li bi translated">机密—必需。您的站点和reCAPTCHA之间的共享密钥。</li><li id="4ec3" class="la lb ho in b io lj is lk iw ll ja lm je ln ji lf lg lh li bi translated">响应—必需。reCAPTCHA提供的用户响应令牌，用于验证您站点上的用户。</li><li id="1c0a" class="la lb ho in b io lj is lk iw ll ja lm je ln ji lf lg lh li bi translated">remoteip —可选。用户的IP地址。</li></ol><p id="1352" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">API响应:</p><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="6c75" class="jj jk ho kp b fi kt ku l kv kw">{<br/>  "success": true|false,<br/>  "challenge_ts": timestamp,  // timestamp of the challenge load <br/>  "apk_package_name": string, // the package name of the app<br/>  "error-codes": [...]        // optional<br/>}</span></pre><p id="c7c1" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">快乐编码:)</p><h2 id="ccda" class="jj jk ho bd jl jm jn jo jp jq jr js jt iw ju jv jw ja jx jy jz je ka kb kc kd bi translated">结论</h2><p id="4269" class="pw-post-body-paragraph il im ho in b io ke iq ir is kf iu iv iw kg iy iz ja kh jc jd je ki jg jh ji ha bi translated">您现在知道如何使用SafetyNet reCAPTCHA API来保护您的Android应用程序和后端基础设施免受僵尸程序的攻击。你再也不用担心自动注册、屏幕抓取或机器人生成的垃圾邮件。</p><p id="d720" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如果你喜欢这篇文章，请给它竖起大拇指，评论它，并与你的朋友分享。 </p></div><div class="ab cl lp lq go lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ha hb hc hd he"><figure class="kk kl km kn fd hj"><div class="bz dy l di"><div class="lw lx l"/></div></figure><p id="2af5" class="pw-post-body-paragraph il im ho in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">请点击👏按钮下面几下，以示支持！⬇⬇谢谢！不要忘记<strong class="in hp">遵循下面的</strong>快速代码。</p><blockquote class="ly"><p id="6aba" class="lz ma ho bd mb mc md me mf mg mh ji dx translated">找到关于各种编程语言的<a class="ae kj" href="http://www.quickcode.co/" rel="noopener ugc nofollow" target="_blank">快速代码</a>的免费课程。获取<a class="ae kj" href="https://www.messenger.com/t/1493528657352302" rel="noopener ugc nofollow" target="_blank"> Messenger </a>的新更新。</p></blockquote></div></div>    
</body>
</html>