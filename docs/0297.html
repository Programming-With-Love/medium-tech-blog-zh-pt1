<html>
<head>
<title>Building a simple audio app in Android (Part 1/3)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Android中构建简单的音频应用程序(第1/3部分)</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/building-a-simple-audio-app-in-android-part-1-3-c14d1a66e0f1?source=collection_archive---------0-----------------------#2017-08-22">https://medium.com/androiddevelopers/building-a-simple-audio-app-in-android-part-1-3-c14d1a66e0f1?source=collection_archive---------0-----------------------#2017-08-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="f417" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">媒体播放器游戏攻略</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/19ab8a3676dff6e8dcb10d5e8c7c8669.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zYuz-VGdYcFcVG3mMSohLQ.png"/></div></div></figure><h1 id="c11c" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">介绍</h1><p id="37e5" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">Android媒体API包含许多高级功能，允许开发人员创建丰富的媒体体验。它们包括像<code class="du kw kx ky kz b">ExoPlayer</code>、<code class="du kw kx ky kz b"><a class="ae la" rel="noopener" href="/google-developers/understanding-mediasession-part-1-3-e4d2725f18e4">MediaSession</a></code>、音频聚焦、音量调整和许多其他围绕媒体播放和控制的惊人功能。</p><p id="64f7" class="pw-post-body-paragraph ka kb hh kc b kd lb ii kf kg lc il ki kj ld kl km kn le kp kq kr lf kt ku kv ha bi translated">这一系列文章的目标是通过创建一个叫做“简单媒体播放器”的非常基本的音频播放应用程序，让你开始使用Android <code class="du kw kx ky kz b"><a class="ae la" href="https://developer.android.com/reference/android/media/MediaPlayer.html" rel="noopener ugc nofollow" target="_blank">MediaPlayer</a></code> API。这是3部分系列的第一部分，包括:</p><ol class=""><li id="7c62" class="lg lh hh kc b kd lb kg lc kj li kn lj kr lk kv ll lm ln lo bi translated"><strong class="kc hi"> MediaPlayer简介</strong> ( <em class="lp">本文</em>)</li><li id="c8dc" class="lg lh hh kc b kd lq kg lr kj ls kn lt kr lu kv ll lm ln lo bi translated"><a class="ae la" rel="noopener" href="/@nazmul/building-a-simple-audio-app-in-android-part-2-3-a514f6224b83">构建应用</a></li><li id="edcc" class="lg lh hh kc b kd lq kg lr kj ls kn lt kr lu kv ll lm ln lo bi translated"><a class="ae la" rel="noopener" href="/@nazmul/building-a-simple-audio-app-in-android-part-3-3-ead4a0e10673">与滚动条同步</a></li></ol><h1 id="4cef" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">第1/3部分— MediaPlayer简介</h1><p id="437b" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">本文将涵盖以下内容:</p><ul class=""><li id="1c10" class="lg lh hh kc b kd lb kg lc kj li kn lj kr lk kv lv lm ln lo bi translated">通过考虑一些简单的音频回放任务以及它们如何映射到<code class="du kw kx ky kz b">MediaPlayer</code>状态机，<code class="du kw kx ky kz b">MediaPlayer</code>是如何工作的。</li></ul><h1 id="1a5e" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">基本MediaPlayer任务</h1><p id="2423" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">以下是<code class="du kw kx ky kz b">MediaPlayer</code>需要处理的基本任务:</p><ul class=""><li id="d711" class="lg lh hh kc b kd lb kg lc kj li kn lj kr lk kv lv lm ln lo bi translated"><strong class="kc hi">加载媒体文件进行播放</strong>。这是通过方法<code class="du kw kx ky kz b"><a class="ae la" href="https://developer.android.com/reference/android/media/MediaPlayer.html#setDataSource(android.content.res.AssetFileDescriptor)" rel="noopener ugc nofollow" target="_blank">setDataSource()</a></code>、<code class="du kw kx ky kz b"><a class="ae la" href="https://developer.android.com/reference/android/media/MediaPlayer.html#prepare()" rel="noopener ugc nofollow" target="_blank">prepare()</a></code>和<code class="du kw kx ky kz b"><a class="ae la" href="https://developer.android.com/reference/android/media/MediaPlayer.html#prepareAsync()" rel="noopener ugc nofollow" target="_blank">prepareAsync()</a></code>完成的。</li><li id="8df6" class="lg lh hh kc b kd lq kg lr kj ls kn lt kr lu kv lv lm ln lo bi translated"><strong class="kc hi">开始回放/播放音频</strong>。这个由<code class="du kw kx ky kz b"><a class="ae la" href="https://developer.android.com/reference/android/media/MediaPlayer.html#StateDiagram" rel="noopener ugc nofollow" target="_blank">start()</a></code>处理。</li><li id="d999" class="lg lh hh kc b kd lq kg lr kj ls kn lt kr lu kv lv lm ln lo bi translated"><strong class="kc hi">暂停播放(一旦开始播放)</strong>。这个由<code class="du kw kx ky kz b"><a class="ae la" href="https://developer.android.com/reference/android/media/MediaPlayer.html#StateDiagram" rel="noopener ugc nofollow" target="_blank">pause()</a></code>处理。</li><li id="8cac" class="lg lh hh kc b kd lq kg lr kj ls kn lt kr lu kv lv lm ln lo bi translated"><strong class="kc hi">停止播放并重置MediaPlayer，以便您可以向其加载另一个媒体文件</strong>。这个由<code class="du kw kx ky kz b"><a class="ae la" href="https://developer.android.com/reference/android/media/MediaPlayer.html#StateDiagram" rel="noopener ugc nofollow" target="_blank">reset()</a></code>处理。</li><li id="f27e" class="lg lh hh kc b kd lq kg lr kj ls kn lt kr lu kv lv lm ln lo bi translated"><strong class="kc hi">求一首歌的长度(毫秒)</strong>。此事由<code class="du kw kx ky kz b"><a class="ae la" href="https://developer.android.com/reference/android/media/MediaPlayer.html#StateDiagram" rel="noopener ugc nofollow" target="_blank">getDuration()</a></code>处理。</li><li id="68f2" class="lg lh hh kc b kd lq kg lr kj ls kn lt kr lu kv lv lm ln lo bi translated"><strong class="kc hi">查找歌曲正在播放的部分</strong>。这个由<code class="du kw kx ky kz b"><a class="ae la" href="https://developer.android.com/reference/android/media/MediaPlayer.html#StateDiagram" rel="noopener ugc nofollow" target="_blank">getCurrentPosition()</a></code>处理。</li><li id="1dd8" class="lg lh hh kc b kd lq kg lr kj ls kn lt kr lu kv lv lm ln lo bi translated"><strong class="kc hi">跳到歌曲中的特定时间位置(毫秒),并从该位置开始播放</strong>。此事由<code class="du kw kx ky kz b"><a class="ae la" href="https://developer.android.com/reference/android/media/MediaPlayer.html#StateDiagram" rel="noopener ugc nofollow" target="_blank">seekTo(position)</a></code>处理。</li><li id="3957" class="lg lh hh kc b kd lq kg lr kj ls kn lt kr lu kv lv lm ln lo bi translated"><strong class="kc hi">检查音频是否正在播放</strong>。这是由<code class="du kw kx ky kz b"><a class="ae la" href="https://developer.android.com/reference/android/media/MediaPlayer.html#StateDiagram" rel="noopener ugc nofollow" target="_blank">isPlaying()</a></code>处理的。</li><li id="7b3a" class="lg lh hh kc b kd lq kg lr kj ls kn lt kr lu kv lv lm ln lo bi translated"><strong class="kc hi">找出一首歌曲何时播放完毕</strong>。这通过附加一个<code class="du kw kx ky kz b"><a class="ae la" href="https://developer.android.com/reference/android/media/MediaPlayer.html#setOnCompletionListener(android.media.MediaPlayer.OnCompletionListener)" rel="noopener ugc nofollow" target="_blank">MediaPlayer.OnCompletionListener</a></code>来处理。您的代码将从监听器获得一个<code class="du kw kx ky kz b"><a class="ae la" href="https://developer.android.com/reference/android/media/MediaPlayer.OnCompletionListener.html#onCompletion(android.media.MediaPlayer)" rel="noopener ugc nofollow" target="_blank">onCompletion()</a></code>回调。</li><li id="053e" class="lg lh hh kc b kd lq kg lr kj ls kn lt kr lu kv lv lm ln lo bi translated"><strong class="kc hi">解除分配玩家使用的资源</strong>。这是由<code class="du kw kx ky kz b"><a class="ae la" href="https://developer.android.com/reference/android/media/MediaPlayer.html#release()" rel="noopener ugc nofollow" target="_blank">release()</a></code>处理的，它会释放所有附属于播放器的资源。释放后，播放器不再可用。</li></ul><p id="a7df" class="pw-post-body-paragraph ka kb hh kc b kd lb ii kf kg lc il ki kj ld kl km kn le kp kq kr lf kt ku kv ha bi translated">此列表涵盖了音频内容的基本回放任务，但并不详尽。对于流媒体等复杂的音频应用程序，还有更复杂的功能，处理音频聚焦、音量整形和使用<code class="du kw kx ky kz b"><a class="ae la" rel="noopener" href="/google-developers/understanding-mediasession-part-1-3-e4d2725f18e4">MediaSession</a></code>。有关这些高级主题的更多信息，请参考<code class="du kw kx ky kz b">MediaPlayer</code> <a class="ae la" href="https://developer.android.com/reference/android/media/MediaPlayer.html" rel="noopener ugc nofollow" target="_blank"> API指南</a>。</p><h1 id="bdfa" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">简化状态机</h1><p id="0c46" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">下面是对用于音频回放的<code class="du kw kx ky kz b">MediaPlayer’s</code>状态机的简化描述:</p><p id="59b7" class="pw-post-body-paragraph ka kb hh kc b kd lb ii kf kg lc il ki kj ld kl km kn le kp kq kr lf kt ku kv ha bi translated">首先创建一个<code class="du kw kx ky kz b">MediaPlayer</code>的实例。</p><ol class=""><li id="1506" class="lg lh hh kc b kd lb kg lc kj li kn lj kr lk kv ll lm ln lo bi translated">然后将您想要的媒体文件加载到播放器中。这意味着使用带有描述媒体文件来源的参数的<code class="du kw kx ky kz b">setDataSource()</code>方法。</li><li id="c499" class="lg lh hh kc b kd lq kg lr kj ls kn lt kr lu kv ll lm ln lo bi translated">现在您需要准备您的数据源。有两种方法可以做到这一点:</li></ol><ul class=""><li id="816c" class="lg lh hh kc b kd lb kg lc kj li kn lj kr lk kv lv lm ln lo bi translated">使用<code class="du kw kx ky kz b">prepare()</code>。此方法将阻塞调用线程，因此应该只用于本地存储在设备上的数据源。</li><li id="110c" class="lg lh hh kc b kd lq kg lr kj ls kn lt kr lu kv lv lm ln lo bi translated">使用<code class="du kw kx ky kz b">prepareAsync()</code>。此方法将异步准备数据源，应该用于远程或大型数据源。使用这种方法，当您的媒体准备好播放时，您会收到一个回调，此时您可以在应用程序的UI中启用媒体播放控件。您可以使用<code class="du kw kx ky kz b"><a class="ae la" href="https://developer.android.com/reference/android/media/MediaPlayer.OnPreparedListener.html" rel="noopener ugc nofollow" target="_blank">MediaPlayer.OnPreparedListener</a></code>在播放器为您加载内容并开始播放时获得通知。您可以使用<code class="du kw kx ky kz b"><a class="ae la" href="https://developer.android.com/reference/android/media/MediaPlayer.html#setOnPreparedListener(android.media.MediaPlayer.OnPreparedListener)" rel="noopener ugc nofollow" target="_blank">setOnPreparedListener(listener)</a></code>将该监听器连接到您的播放器。</li></ul><p id="6aa0" class="pw-post-body-paragraph ka kb hh kc b kd lb ii kf kg lc il ki kj ld kl km kn le kp kq kr lf kt ku kv ha bi translated">现在您的音频已经加载，您可以播放和暂停您的音频。您可以停止和重新开始播放。</p><ol class=""><li id="e89e" class="lg lh hh kc b kd lb kg lc kj li kn lj kr lk kv ll lm ln lo bi translated"><strong class="kc hi">播放</strong> —使用<code class="du kw kx ky kz b">start()</code>告诉播放器开始播放。您可以使用<code class="du kw kx ky kz b">isPlaying()</code>询问播放器是否正在播放。</li><li id="d2f8" class="lg lh hh kc b kd lq kg lr kj ls kn lt kr lu kv ll lm ln lo bi translated"><strong class="kc hi">暂停</strong> —只有当<code class="du kw kx ky kz b">isPlaying()</code>为真时才能暂停，因此在调用<code class="du kw kx ky kz b">pause()</code>之前，请务必检查这一点。</li><li id="7725" class="lg lh hh kc b kd lq kg lr kj ls kn lt kr lu kv ll lm ln lo bi translated"><strong class="kc hi">停止</strong> —使用<code class="du kw kx ky kz b">reset()</code>方法来完成。它将停止播放并重置播放器，以便您可以将其他媒体文件加载到其中。</li><li id="c6dc" class="lg lh hh kc b kd lq kg lr kj ls kn lt kr lu kv ll lm ln lo bi translated"><strong class="kc hi"> Seek </strong> —使用带有时间偏移的<code class="du kw kx ky kz b">seekTo()</code>方法将音频回放移动到所需位置。当您允许用户将回放移动到当前加载的媒体中的任何位置时，这是必需的。</li></ol><p id="7c2c" class="pw-post-body-paragraph ka kb hh kc b kd lb ii kf kg lc il ki kj ld kl km kn le kp kq kr lf kt ku kv ha bi translated">当你完成MediaPlayer的实例时，一定要<code class="du kw kx ky kz b">release()</code>它。一旦释放，您必须创建一个新的<code class="du kw kx ky kz b">MediaPlayer</code>对象，并从步骤1开始，以便播放另一个媒体文件。</p><p id="724f" class="pw-post-body-paragraph ka kb hh kc b kd lb ii kf kg lc il ki kj ld kl km kn le kp kq kr lf kt ku kv ha bi translated">要开始构建应用程序，请查看本系列的第2/3部分<a class="ae la" rel="noopener" href="/@nazmul/introduction-to-mediaplayer-part-2-3-a514f6224b83">构建应用程序</a>。</p><div class="lw lx ez fb ly lz"><a rel="noopener follow" target="_blank" href="/@nazmul/building-a-simple-audio-app-in-android-part-2-3-a514f6224b83"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hi fi z dy me ea eb mf ed ef hg bi translated">在Android中构建一个简单的音频应用程序(第2/3部分)</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">构建应用程序</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">medium.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn jg lz"/></div></div></a></div><h1 id="2875" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">Android媒体资源</h1><ul class=""><li id="b6fe" class="lg lh hh kc b kd ke kg kh kj mo kn mp kr mq kv lv lm ln lo bi translated"><a class="ae la" rel="noopener" href="/google-developers/understanding-mediasession-part-1-3-e4d2725f18e4">了解媒体会话</a></li><li id="32ea" class="lg lh hh kc b kd lq kg lr kj ls kn lt kr lu kv lv lm ln lo bi translated"><a class="ae la" href="https://developer.android.com/guide/topics/media-apps/media-apps-overview.html" rel="noopener ugc nofollow" target="_blank"> Android媒体API指南—媒体应用概述</a></li><li id="2fcc" class="lg lh hh kc b kd lq kg lr kj ls kn lt kr lu kv lv lm ln lo bi translated"><a class="ae la" href="https://developer.android.com/guide/topics/media-apps/working-with-a-media-session.html" rel="noopener ugc nofollow" target="_blank"> Android媒体API指南—使用媒体会话</a></li></ul></div></div>    
</body>
</html>