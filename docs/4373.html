<html>
<head>
<title>Refactoring Kotlin type-signatures for fun and profit</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">重构Kotlin类型-为了乐趣和利益的签名</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/refactoring-kotlin-type-signatures-for-fun-and-profit-fe65351dc221?source=collection_archive---------4-----------------------#2021-06-29">https://medium.com/google-developer-experts/refactoring-kotlin-type-signatures-for-fun-and-profit-fe65351dc221?source=collection_archive---------4-----------------------#2021-06-29</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="efc0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这篇文章中，我从一个意想不到的来源获得了<a class="ae jc" href="https://http4k.org" rel="noopener ugc nofollow" target="_blank"> http4k </a>的核心类型签名，使用了重构和FP技术，这些技术通常与编码相关联。</p><h1 id="8a0a" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">TL；速度三角形定位法(dead reckoning)</h1><blockquote class="kb kc kd"><p id="f3d4" class="ie if ke ig b ih ii ij ik il im in io kf iq ir is kg iu iv iw kh iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="hh">“你可以应用简单的重构和函数技术，比如替换和奉承，来提炼函数签名。没有任何实现细节，以这种方式定义系统概念可能是一种令人耳目一新的强大技术。”</em> </strong></p></blockquote><figure class="kj kk kl km fd kn er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es ki"><img src="../Images/43dd11442c9dcf90dcd616c2117f3c8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I6fGAryWi0zcBH2fVw2pVQ.jpeg"/></div></div></figure><p id="7876" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在最近的一集<a class="ae jc" href="https://talkingkotlin.com/http-as-a-function-with-http4k/" rel="noopener ugc nofollow" target="_blank"> TalkingKotlin </a>探索<a class="ae jc" href="https://http4k.org" rel="noopener ugc nofollow" target="_blank"> http4k </a>中，我们与<a class="ae jc" href="https://hadihariri.com/" rel="noopener ugc nofollow" target="_blank"> Hadi Hariri </a>讨论了http4k的起源受到了最初的<a class="ae jc" href="https://monkey.org/~marius/funsrv.pdf" rel="noopener ugc nofollow" target="_blank">“你的服务器作为一种功能”</a> (SaaF)论文的启发。我注意到其中描述的模式与Java <a class="ae jc" href="https://www.oracle.com/java/technologies/filters.html" rel="noopener ugc nofollow" target="_blank"> Servlet Filter </a> API中使用的模式相同，并且我们已经从中派生出了最终的<a class="ae jc" href="https://http4k.org" rel="noopener ugc nofollow" target="_blank"> http4k </a>核心类型<code class="du ku kv kw kx b">HttpHandler</code>和<code class="du ku kv kw kx b">Filter</code>。</p><p id="b740" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">只是为了再次确认我没有记错，我觉得重温这个过程会很有趣。回过头来看，这与我们重构代码的过程非常相似，但是在更概念性的层面上。在这种情况下，我们可以将各个步骤映射到IntelliJ提供的强大重构功能上。</p><p id="2de5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">回顾一下，Java Servlet过滤器API定义了以下内容:</p><figure class="kj kk kl km fd kn"><div class="bz dy l di"><div class="ky kz l"/></div></figure><p id="8e58" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果我们把这些签名转换成科特林，我们得到:</p><figure class="kj kk kl km fd kn"><div class="bz dy l di"><div class="ky kz l"/></div></figure><p id="da7d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">由于http4k是一个受函数式编程启发很大的库，所以我们希望使我们的类型不可变，而Servlet类型依赖于改变http消息。为了保持函数的纯粹性和无副作用，我们应该从我们的服务中返回一个不可变的<code class="du ku kv kw kx b">ServletResponse</code>，而不是对其进行变异并返回<code class="du ku kv kw kx b">Unit</code>，所以让我们使用<strong class="ig hi"> <em class="ke">更改签名(Cmd+F6) </em> </strong>来实现:</p><figure class="kj kk kl km fd kn"><div class="bz dy l di"><div class="ky kz l"/></div></figure><p id="35d9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以接着<strong class="ig hi"> <em class="ke">改变签名(Cmd+F6) </em> </strong>再对<code class="du ku kv kw kx b">Filter</code>的参数重新排序:</p><figure class="kj kk kl km fd kn"><div class="bz dy l di"><div class="ky kz l"/></div></figure><p id="a965" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一件在函数式语言中很常见的事情，但是我们目前不能在IDE中做(提示提示JetBrains！)就是应用<a class="ae jc" href="https://en.wikipedia.org/wiki/Currying" rel="noopener ugc nofollow" target="_blank">curry</a>将<code class="du ku kv kw kx b">Filter</code>拆分成高阶函数(即。返回另一个函数的函数):</p><figure class="kj kk kl km fd kn"><div class="bz dy l di"><div class="ky kz l"/></div></figure><p id="730d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过这样做，我们可以看到，当类型签名匹配时，我们可以将<code class="du ku kv kw kx b">FilterChain</code>替换为<code class="du ku kv kw kx b">Filter</code>:</p><figure class="kj kk kl km fd kn"><div class="bz dy l di"><div class="ky kz l"/></div></figure><p id="2171" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，我们可以做一些Kotlin替换和<strong class="ig hi"> <em class="ke">重命名(Shift+F6) </em> </strong>来让我们回到我们所知道和喜爱的<a class="ae jc" href="https://http4k.org" rel="noopener ugc nofollow" target="_blank"> http4k </a>类型:</p><figure class="kj kk kl km fd kn"><div class="bz dy l di"><div class="ky kz l"/></div></figure><p id="ff33" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以你有它。原来<a class="ae jc" href="https://www.youtube.com/watch?v=w36J7HDszcI" rel="noopener ugc nofollow" target="_blank">一切旧的(其实)又是新的</a>！</p></div><div class="ab cl la lb go lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ha hb hc hd he"><p id="1ddc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="ke">喜欢这篇文章吗？你可以在</em><a class="ae jc" href="https://dentondav.id/writing" rel="noopener ugc nofollow" target="_blank"><strong class="ig hi"><em class="ke">https://dentondav.id/writing</em></strong></a><em class="ke">阅读我所有的科技文章。</em></p></div></div>    
</body>
</html>