<html>
<head>
<title>Improving your Web API performance with Azure Redis Cache</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Azure Redis缓存提高您的Web API性能</h1>
<blockquote>原文：<a href="https://medium.com/globant/improving-your-web-api-performance-with-azure-redis-cache-b7d1c3c24898?source=collection_archive---------0-----------------------#2021-01-22">https://medium.com/globant/improving-your-web-api-performance-with-azure-redis-cache-b7d1c3c24898?source=collection_archive---------0-----------------------#2021-01-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/0019df3c814c27bd1c088e02fc8b619c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MOV4tgDKqs5R4FyKi0LXBA.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Image courtesy <a class="ae it" href="https://docs.microsoft.com/en-us/learn/achievements/improve-api-performance-with-apim-caching-policy-social.png" rel="noopener ugc nofollow" target="_blank">Microsoft Azure Doc</a></figcaption></figure><p id="6cf5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在本文中，我们将通过了解缓存的基础知识和一个使用StackExchange从web API调用Azure Redis cache的示例，了解如何使用Azure Redis cache提高API性能。Redis C#库。</p><p id="84f4" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为什么我们需要缓存？</p><p id="5ce4" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们先来了解一下为什么需要缓存？考虑一个例子，我们调用一个API，它从数据库中找到用户的公共细节并返回。现在，如果我们多次调用同一个API，那么它将增加网络和数据库调用，如果有的话，还会重新计算。为了避免这种数据库往返和重新计算，我们可以在某个地方用某个键保存响应并使用它。这个地方除了宝藏什么都没有。它可以在服务器端、客户端或单独的地方。</p><p id="5021" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">什么是缓存策略？</strong></p><p id="1b50" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，如果我们开始将API的每个响应都保存到缓存中，这将增加缓存的大小，并再次影响性能。因此，为了避免这种情况，我们使用缓存策略<strong class="iw hi"> </strong>，它只不过是确定缓存上相关数据的规则。有不同类型的缓存访问模式，如直写、回写和回写。我们还有缓存回收策略，如最近最少使用(LRU)、最少使用(LFU)、滑动窗口等。缓存策略要么基于位置，要么基于时间。</p><p id="61ca" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">缓存放在哪里？</strong></p><p id="fad1" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">一旦我们决定使用什么策略，实现缓存的主要部分就是在哪里放置缓存<strong class="iw hi">。</strong>这里我们有三个选项:服务器端、客户端和独立/分布式。在本文中，我们使用第三种类型的带有Redis缓存的缓存<strong class="iw hi">。</strong></p><p id="753f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">什么是Redis？</strong></p><p id="11e4" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Redis是开源内存数据结构存储，可用作缓存、二级数据库或消息传递代理。这是NoSQL和关键价值商店。它支持多种数据结构，如字符串、列表、集合等。它速度快，可扩展。</p><p id="599d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Twitter、Pinterest和Stack overflow之类的应用程序使用Redis作为缓存。</p><p id="7329" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> Azure Redis缓存</strong></p><p id="5ad1" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Azure Redis Cache是微软基于开源Redis引擎的专用缓存服务。</p><p id="29bb" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">优点</strong></p><p id="b7b6" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Azure Redis缓存有许多优点，比如，与许多键值数据存储相比，它有相对丰富的数据类型集，并且缓存操作是原子的。</p><p id="a08e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Azure上的Redis也提供了对SSL的支持，如果我们通过公共网络连接到一个未注册的端点，那么我们的数据在传输时会被加密。</p><p id="c64b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Redis在所有地区都可用，包括美国政府和Azure China，我们可以创建从250 MEGS到120 GB数据的缓存。</p><p id="9bbe" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Azure Redis缓存有三种方案:基本、标准和高级。基本层计划中没有SLA，对于开发和测试目的，基本层很好，但对于大多数生产环境，建议使用标准层。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es js"><img src="../Images/bbd89bfab66e3651f239259b3de8320e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MJMVZdwi4AjsRpIzKp3vOQ.jpeg"/></div></div></figure><p id="2b59" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><a class="ae it" href="https://azure.microsoft.com/en-in/pricing/details/cache/" rel="noopener ugc nofollow" target="_blank">在此参考更新的定价</a></p><p id="96c6" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在让我们看看如何在API调用中使用Azure Redis。</p><p id="8f26" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">第1部分:在Azure门户中创建新的Redis缓存</strong></p><p id="dcbf" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">转到Azure portal搜索Redis缓存，然后单击新建，选择订阅、资源组DSN名称、位置和缓存类型。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es jx"><img src="../Images/4f7e41c590580ef2c3e2277cd9fead45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PemOZwH6Q9_PO-xK1wvS5A.png"/></div></div></figure><p id="6991" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">出于演示目的，我选择了Basic。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es jy"><img src="../Images/2301157762b32fbc3146cc9369c09407.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HGIwDcAFW5-X4g6qTgje0g.png"/></div></div></figure><p id="f8f3" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">单击创建，创建需要一些时间。成功创建Redis缓存后，转到访问键并为其他用户复制主连接字符串。从代码连接到Azure Redis缓存需要主连接字符串。我们将在<strong class="iw hi"> StackExchange中看到它的使用。Redis </strong>很快。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es jz"><img src="../Images/aaad441bde49da3422fb9f96d7a630a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LHuFkIBWw_McuRcuh9sbow.png"/></div></div></figure><p id="cad2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">第2部分:创建API项目并设置Redis缓存</strong></p><p id="e9f0" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在打开Visual studio代码，选择web &gt; Asp.net web应用程序(。Net框架)并创建。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ka"><img src="../Images/947f4d97a132aab4bbbf393401024be9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-T1AUFzpOeT30CF9aM4YsA.jpeg"/></div></div></figure><p id="cf12" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在打开新创建项目的web配置，并添加一个带有复制的Redis缓存连接字符串的新键。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kb"><img src="../Images/4f159f198b4957c3705c50600ce2e179.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wQnFPQOQ-YHS8F_ZVx-d0w.jpeg"/></div></div></figure><p id="59ee" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在我们需要Radis缓存库与Redis缓存进行通信。对于点击项目并选择管理NuGet包</p><p id="7d60" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在NuGet中，搜索StackExchange。Redis并安装</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kc"><img src="../Images/f7c1f4b7d5ac6aca8d7014b4e414eea1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5SnctUVDh31fZKzVpKiZCw.png"/></div></div></figure><p id="2031" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">第3部分:在API中使用Redis缓存</strong></p><p id="a1bf" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">最后，我们将在API中使用Redis缓存，首先我们需要连接到Redis缓存，为此我们需要创建连接。</p><p id="2e4c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在下面的代码片段中，你可以看到我已经在构造函数中连接到Redis缓存。然后，在API调用操作方法中，我使用连接对象来检查Redis缓存中是否存在数据，如果存在，则返回数据，否则创建结果，然后保存到缓存中供以后调用。这也被称为<a class="ae it" href="https://docs.microsoft.com/en-us/azure/architecture/patterns/cache-aside" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hi">缓存预留模式</strong> </a>。这可以提高性能，也有助于保持一致性。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kd"><img src="../Images/c08956648c220aa1015a5d83eef62d54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fkz402sWeBKjdmrBxHSz3A.jpeg"/></div></div></figure><p id="cdbf" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在让我们检查一下API的性能</p><p id="71d2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在上面代码片段中的Get调用中，我取了一个数字并对其进行了一些计算，还从数据库中检索了该数字的一些数据，然后创建并返回最终结果。</p><p id="1c4a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，第一次在缓存中没有数据，所以它将做计算和数据库部分，因此当我从邮递员点击API时，将需要4.06秒</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ke"><img src="../Images/62ba9460aae55820ba8eb3957652fd47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5G-4IlkbfLmZzv6dnTrIJg.jpeg"/></div></div></figure><p id="7dbb" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下一次，当我用相同的值点击相同的API时，它会在Redis缓存中找到结果，并且只需要377毫秒，因为它不需要任何计算和数据库调用。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kf"><img src="../Images/2e9089cc71b63069938480e06f7b5748.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LbVuozvxVKk6cxbPPj88cA.jpeg"/></div></div></figure><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kg"><img src="../Images/8dbdf5ddaa51a42ac099dda223c6f70e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wzTAej4e6k7xm9pSPAHnhw.jpeg"/></div></div></figure><p id="6d54" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">收尾思路</strong></p><p id="aa7c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这就是当需要在缓存中存储数据时，如何在API调用中使用Redis缓存，以避免数据库调用并提高性能。我们还可以使用Azure key vault来保存连接字符串。也可以为Redis创建一个单独的服务类，它可以注入优化代码。</p><p id="0213" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">感谢阅读！快乐缓存！！</p></div></div>    
</body>
</html>