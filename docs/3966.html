<html>
<head>
<title>Webhook Trigger using Azure DevOps and Jenkins</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Azure DevOps和Jenkins的Webhook触发器</h1>
<blockquote>原文：<a href="https://medium.com/globant/webhook-trigger-using-azure-devops-and-jenkins-75656c0c56c4?source=collection_archive---------0-----------------------#2022-08-30">https://medium.com/globant/webhook-trigger-using-azure-devops-and-jenkins-75656c0c56c4?source=collection_archive---------0-----------------------#2022-08-30</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/166515fa72e7bd52ddfa51b9854961a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SeGiBQo18pnzNM_PFg80KQ.jpeg"/></div></div></figure><p id="a851" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在本文中，我们将学习如何远程触发Jenkins作业。</p><h1 id="f650" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated"><strong class="ak">简介- </strong></h1><p id="e624" class="pw-post-body-paragraph ip iq hh ir b is kl iu iv iw km iy iz ja kn jc jd je ko jg jh ji kp jk jl jm ha bi translated">Azure DevOps提供开发人员服务，允许团队规划工作、协作开发代码，以及构建和部署应用程序。</p><p id="fc73" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Jenkins是一个开源自动化服务器，它使开发人员能够构建、测试和部署他们的软件。</p><p id="4702" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">触发器是执行作业的事件发生。Jenkins中有五种类型的触发器:</p><p id="fc52" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">1]远程构建触发器(即webhook):当一个事件发生在一个端点URL上并且它需要一个认证令牌时触发。</p><p id="2aa7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">2]在其他项目建立之后建立:如其所说，你需要指定其他项目的列表。当它们被构建时，当前项目开始构建。</p><p id="eeec" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">3]定期构建:这就像一个cron任务。它在每个指定的时间间隔触发。</p><p id="ae9e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">4]git SCM轮询的Github钩子触发器:与Github钩子关联。</p><p id="871a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">5]轮询SCM:在被触发之前，它首先检查是否有任何变化。</p><p id="05a0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在本文中，我们使用了第一个触发器。</p><p id="c1f3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">轮询意味着向新事件发送请求，并等待端点对其做出响应。所以基本上当你使用Poll SCM时，它首先发送一个请求到一个端点来检查任何提交。如果有任何提交或新事件发生，那么只有它被触发。而webhook只有在端点发生新的提交时才会被触发。</p><p id="4bd2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">本文将涵盖以下部分:</p><ul class=""><li id="b504" class="kq kr hh ir b is it iw ix ja ks je kt ji ku jm kv kw kx ky bi translated">先决条件</li><li id="c94d" class="kq kr hh ir b is kz iw la ja lb je lc ji ld jm kv kw kx ky bi translated">履行</li><li id="a02c" class="kq kr hh ir b is kz iw la ja lb je lc ji ld jm kv kw kx ky bi translated">注意</li><li id="d028" class="kq kr hh ir b is kz iw la ja lb je lc ji ld jm kv kw kx ky bi translated">结论</li></ul><h1 id="635e" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated"><strong class="ak">先决条件</strong></h1><ul class=""><li id="1df3" class="kq kr hh ir b is kl iw km ja le je lf ji lg jm kv kw kx ky bi translated">AWS帐户</li><li id="7dfc" class="kq kr hh ir b is kz iw la ja lb je lc ji ld jm kv kw kx ky bi translated">Azure DevOps帐户</li></ul><h1 id="f5a5" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated"><strong class="ak">实现</strong></h1><p id="a58a" class="pw-post-body-paragraph ip iq hh ir b is kl iu iv iw km iy iz ja kn jc jd je ko jg jh ji kp jk jl jm ha bi translated"><strong class="ir hi">步骤1】</strong><strong class="ir hi">创建Azure资源库</strong></p><p id="6e28" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">创建一个Azure存储库并添加一个Jenkinsfile。下面是示例代码。</p><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lh"><img src="../Images/cd755ce420c93e32fd9c721b1c1e15f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*18SS9TrWBlmPC0yrBqVBVg.png"/></div></div></figure><p id="dbf5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤2】</strong><strong class="ir hi">安装和配置Jenkins </strong></p><p id="6a60" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">通过SSH连接到您的EC2实例(使用公共IP ),然后按照以下步骤安装Jenkins，或者您可以在此处参考官方文档<a class="ae lm" href="https://www.jenkins.io/doc/tutorials/tutorial-for-installing-jenkins-on-AWS/#install-and-configure-jenkins" rel="noopener ugc nofollow" target="_blank"/></p><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ln"><img src="../Images/63fef8fb1541f4609557ec8d006e56cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L02-kdqLBKHRLEU3-udJbQ.png"/></div></div></figure><p id="1411" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">状态应处于运行状态。</p><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lo"><img src="../Images/03909cebc20124d95b13803a9300f423.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z1NS6sibj1KhWi1RBfthtQ.png"/></div></div></figure><p id="1d8e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">步骤2a]在浏览器中粘贴公共URL并设置Jenkins。</p><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lp"><img src="../Images/871c58fed9a186c9124d2c7c26d9a1d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UYqQZPH15Gp1Eb2li_iWjg.png"/></div></div></figure><p id="8717" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">步骤2b]连接到EC2实例并输入</p><p id="4057" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="lq">sudo cat/var/lib/Jenkins/secrets/initial admin password</em></p><p id="129b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">复制并粘贴密码，然后点击继续。并完成设置。</p><p id="56e6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤3】创建服务挂钩</strong></p><p id="2387" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在Azure DevOps中，转到项目设置–&gt;服务挂钩–&gt;创建订阅–&gt;选择Jenkins，然后单击下一步。选择要触发的事件并配置过滤器。</p><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lr"><img src="../Images/3207604601d9d80f9030cd3307e4a4ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dYyJWWtUzYjTqNJd-Y_CjQ.png"/></div></div></figure><p id="bb84" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">步骤3a]在单击“下一步”之前，请转到Jenkins –&gt;单击右上角的用户名–&gt;选择“配置”–&gt;添加新令牌并将该令牌临时保存在其他地方并保存它。</p><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ls"><img src="../Images/38f46a6e30ca2ec5be4c3af300e3e0b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6S0WuVKU55zk7GV9egUeIQ.jpeg"/></div></div></figure><p id="2355" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">步骤3b]单击“下一步”并填写所需的详细信息。在API令牌下，粘贴上一步中创建的令牌。</p><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lt"><img src="../Images/997778191a0ebcafb326c78e9dafd97a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zw411w1z5tRgpBa2WmlO0g.png"/></div></div></figure><p id="93dc" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">步骤3c]点击测试。如果它显示<strong class="ir hi">成功，</strong>那么我们就可以开始了，最后点击Finish。</p><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lu"><img src="../Images/85d81a9aaa6be9b71dc963be72f6a0bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z-LsmBb6oFUxPcEuYDY7ig.png"/></div></div></figure><p id="6780" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤4】创建和配置Jenkins管道</strong></p><p id="463b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">创建新管道。</p><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lv"><img src="../Images/325004eb84168b5fb4b1e24b860fc605.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1aM8UYU--UQvllbf5b1CaQ.png"/></div></div></figure><p id="f145" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">步骤4a]要使用Webhook触发器，请选择远程构建触发器选项，并提供您的Jenkins URL，如屏幕截图所示。</p><p id="d965" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在URL的末尾，身份验证令牌可以是您选择的文本。</p><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lw"><img src="../Images/8538ee06516d00744b651fe361d3fffe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m9UY3W9vT1w9IIxR0f_W3g.png"/></div></div></figure><p id="7f54" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">步骤4b]运行脚本有两种方式，但我使用了第二种方式。</p><p id="c0c1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">i]直接在管道中编写和嵌入脚本。</p><p id="5bdb" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">ii]通过给定来自Azure DevOps的Git凭证来访问Jenkinsfile。</p><p id="0487" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">(转到Azure DevOps存储库–&gt;点击克隆-&gt;生成Git凭证)</p><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lp"><img src="../Images/93f913720c717c8103f3701c924bbd02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c4YU0ghaRDR4_ied5nur_g.png"/></div></div></figure><p id="3d31" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">步骤4c]保存管道。</p><p id="48b0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">步骤4d]在Jenkinsfile中进行一些更改，并将更改推送到repo中。</p><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lx"><img src="../Images/bce4d6205de7aa6c908da6c8981f105d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6HfIjjiUq-hvTUhnxx4gcg.png"/></div></div></figure><p id="7154" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">几秒钟内，管道将自动触发。</p><h1 id="50bc" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated"><strong class="ak">注:</strong></h1><p id="da5d" class="pw-post-body-paragraph ip iq hh ir b is kl iu iv iw km iy iz ja kn jc jd je ko jg jh ji kp jk jl jm ha bi translated">在步骤3中，选择了代码推送触发器，因此当代码在回购中被推送时，管道被触发。类似地，您可以为构建完成、请求合并尝试和发布部署完成添加触发器。</p><h1 id="3f2e" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated"><strong class="ak">结论:</strong></h1><p id="34d4" class="pw-post-body-paragraph ip iq hh ir b is kl iu iv iw km iy iz ja kn jc jd je ko jg jh ji kp jk jl jm ha bi translated">任务由Webhook和Poll SCM共同完成，虽然据统计，Poll SCM浪费了近98%的轮询，而Webhook以100%的准确率完成操作。因此，Webhook触发器是最有效的触发器。</p></div></div>    
</body>
</html>