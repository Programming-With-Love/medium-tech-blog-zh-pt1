<html>
<head>
<title>StreamAlert: Real-time Data Analysis and Alerting</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">StreamAlert:实时数据分析和警报</h1>
<blockquote>原文：<a href="https://medium.com/airbnb-engineering/streamalert-real-time-data-analysis-and-alerting-e8619e3e5043?source=collection_archive---------0-----------------------#2017-01-31">https://medium.com/airbnb-engineering/streamalert-real-time-data-analysis-and-alerting-e8619e3e5043?source=collection_archive---------0-----------------------#2017-01-31</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="3d47" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">今天，我们非常兴奋地宣布StreamAlert的开源版本，这是一个具有时间点警报的实时数据分析框架。StreamAlert的独特之处在于它无需服务器，可扩展至TB/小时，基础架构部署是自动化的，并且默认情况下是安全的。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/cb7aebaea0c2efbcd44e6af2be5e939d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QPwg24YqZQ2XuOMyMdhdCA.png"/></div></div></figure><p id="8e95" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这篇博文中，我们将介绍我们为什么要构建它，额外的好处，支持的用例，它是如何工作的等等！</p><h1 id="575c" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">为什么是StreamAlert？</strong></h1><p id="cbb8" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">Airbnb需要一款产品，让工程师和管理员能够从各自的环境中实时获取、分析数据并发出警报。</p><p id="ed3f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">随着我们对用例的推理和对可用选项的探索，我们整理了我们的需求:</p><ul class=""><li id="5642" class="kr ks hh ig b ih ii il im ip kt it ku ix kv jb kw kx ky kz bi translated">对于任何AWS客户来说，部署都是简单、安全和可重复的</li><li id="274e" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">每天轻松从兆字节扩展到兆兆字节</li><li id="d91c" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">基础架构维护最少，不需要开发运维专业知识</li><li id="3bff" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">基础设施安全是默认的，不需要安全专业知识</li><li id="6296" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">支持来自不同环境的数据(例如:IT、PCI、工程)</li><li id="aca3" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">支持来自不同环境类型(如云、数据中心、办公室)的数据</li><li id="517f" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">支持不同类型的数据(例如:JSON、CSV、键值、Syslog)</li><li id="65f5" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">支持不同的使用案例，如安全性、基础架构、合规性等</li></ul><p id="8f03" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们找不到符合这些要求的产品，所以我们自己造了一个。因为我们的一个需求要求产品必须是环境不可知的，所以它很自然地成为了一个开源项目。</p><h2 id="1534" class="lf jp hh bd jq lg lh li ju lj lk ll jy ip lm ln kc it lo lp kg ix lq lr kk ls bi translated"><strong class="ak">好处</strong></h2><p id="24c4" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">如上所述，StreamAlert具有一些独特的优势:</p><ul class=""><li id="e7c0" class="kr ks hh ig b ih ii il im ip kt it ku ix kv jb kw kx ky kz bi translated">无服务器— StreamAlert利用AWS Lambda，这意味着您不必管理、修补或加固任何新服务器</li><li id="6fbc" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">可扩展— StreamAlert利用AWS Kinesis流，这将“每小时从兆字节扩展到太字节，每秒从数千个PUT记录扩展到数百万个”</li><li id="b48d" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">自动化— StreamAlert利用Terraform，这意味着基础架构和支持服务以代码形式呈现，并通过自动化进行部署</li><li id="34a1" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">安全— StreamAlert使用安全传输(TLS)，在容器/沙盒中执行数据分析，根据您定义的环境对数据进行分段，并使用基于角色的访问控制(RBAC)</li><li id="8a8f" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">开源——任何人都可以使用或贡献给StreamAlert</li></ul><h2 id="05d6" class="lf jp hh bd jq lg lh li ju lj lk ll jy ip lm ln kc it lo lp kg ix lq lr kk ls bi translated"><strong class="ak">用例</strong></h2><p id="c13c" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">下图显示了StreamAlert可以分析的一些示例数据集:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lt"><img src="../Images/58ee6645f3eb10e60af3a914b14e1c92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ADry_R8k4ybPBC_1ktZnfA.png"/></div></div></figure><p id="20f5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">StreamAlert旨在尽可能做到不可知，以支持最广泛的数据分析和警报用例。</p><p id="1ffa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在高层次上，SteamAlert支持:</p><ul class=""><li id="da56" class="kr ks hh ig b ih ii il im ip kt it ku ix kv jb kw kx ky kz bi translated">任何来源——stream alert可以接受来自S3存储桶或任何支持发送到亚马逊Kinesis流的代理/服务的数据。示例:fluentd、logstash、aws-kinesis-agent、osquery、Java、JavaScript、Ruby、PHP或AWS SDK支持的任何语言</li><li id="174e" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">任何操作系统— StreamAlert可以接受来自任何支持日志转发的设备的数据(Linux、MacOS、Windows等)</li><li id="da17" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">任何环境— StreamAlert可以接受来自任何具有互联网连接的环境(云、数据中心、办公室、混合环境)的数据</li></ul><p id="3d14" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从数据的角度来看，StreamAlert支持JSON、CSV、Key-Value和Syslog等文件格式。</p><p id="cf20" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您是AWS客户，这些数据格式的gzip版本在S3存储桶中受支持。因此，StreamAlert支持CloudTrail、AWS配置和S3服务器访问日志。</p><p id="39a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您不是AWS客户，StreamAlert可以支持以下数据:</p><ul class=""><li id="9b3d" class="kr ks hh ig b ih ii il im ip kt it ku ix kv jb kw kx ky kz bi translated">主机日志(例如Syslog、osquery、auditd)</li><li id="9edc" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">网络日志(例如Palo Alto Networks、Cisco)</li><li id="00a6" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">Web应用程序日志(例如Apache、nginx)</li><li id="7a6a" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">SaaS提供商(例如Box、OneLogin)</li></ul><p id="35a8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">应该注意的是，StreamAlert并不用于分析、度量或时间序列用例。这一领域有许多优秀的开源和商业产品，包括但不限于Prometheus、DataDog和NewRelic。</p><h1 id="70fb" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">进入引擎盖下</h1><h2 id="3b4d" class="lf jp hh bd jq lg lh li ju lj lk ll jy ip lm ln kc it lo lp kg ix lq lr kk ls bi translated"><strong class="ak">数据分析</strong></h2><p id="e6eb" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">规则包含数据分析和警报逻辑，并且是用Python编写的。下面是一个在PCI环境中使用sudo的例子:</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lv lw l"/></div><figcaption class="lx ly et er es lz ma bd b be z dx">StreamAlert Python Example</figcaption></figure><p id="de21" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以灵活地执行简单或复杂的数据分析。这种方法的一些显著特征是:</p><ul class=""><li id="924b" class="kr ks hh ig b ih ii il im ip kt it ku ix kv jb kw kx ky kz bi translated">规则是用原生Python编写的，不是专有语言</li><li id="090b" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">规则可以利用任何Python函数或库</li><li id="5cbe" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">如果需要，可以针对多个日志源运行规则</li><li id="4cc7" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">规则可以被隔离到定义的环境/集群中</li><li id="356c" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">规则警报可以发送到一个或多个输出，如S3、页面负载或Slack</li><li id="2101" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">规则可以进行集成测试</li></ul><h2 id="3015" class="lf jp hh bd jq lg lh li ju lj lk ll jy ip lm ln kc it lo lp kg ix lq lr kk ls bi translated"><strong class="ak">警戒</strong></h2><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mb"><img src="../Images/43a189cb76fcf030f210afe5f3848a57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eN__F25VrPI1JzUoNBiGig.png"/></div></div></figure><p id="8f6b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如上所述，StreamAlert附带了一个灵活的警报框架，可以与新的或现有的案例/事件管理工具集成。StreamAlert使您的规则能够向一个或多个输出发送警报。</p><p id="2fb8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">开箱即用，StreamAlert支持S3、PagerDuty和Slack。它还可以扩展到支持任何API。在不久的将来，产出将更加模块化，以更好地支持额外的产出和公共贡献。</p><p id="50e4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">遵循默认安全原则，所有API凭证都使用AWS密钥管理服务(KMS)进行加密和解密。</p><h2 id="77eb" class="lf jp hh bd jq lg lh li ju lj lk ll jy ip lm ln kc it lo lp kg ix lq lr kk ls bi translated"><strong class="ak">建筑</strong></h2><p id="e3a7" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">StreamAlert利用以下服务:</p><ul class=""><li id="40f1" class="kr ks hh ig b ih ii il im ip kt it ku ix kv jb kw kx ky kz bi translated">AWS Kinesis流—数据流；AWS Lambda轮询此流(基于流的模型)</li><li id="d590" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">AWS Kinesis Firehose —将流数据加载到S3长期数据存储中</li><li id="2558" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">AWS Lambda(Python)-数据分析和警报</li><li id="19d2" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">AWS SNS —警报队列</li><li id="7f43" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">AWS S3 —可选数据源、长期数据存储和长期警报存储</li><li id="08c5" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">AWS Cloudwatch —基础设施指标</li><li id="6517" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">AWS KMS —应用程序机密的加密和解密</li><li id="5846" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated">AWS IAM —基于角色的访问控制(RBAC)</li></ul><p id="74a8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果这看起来势不可挡，不要担心-请记住，基础架构部署是通过<a class="ae lu" href="https://www.terraform.io/" rel="noopener ugc nofollow" target="_blank"> Terraform </a>自动完成的，确保您不必管理、修补或加固任何新服务器！</p><h1 id="c50f" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">未来</strong></h1><p id="d72a" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">众包提醒的想法并不新鲜。Slack <a class="ae lu" href="https://slack.engineering/distributed-security-alerting-c89414c992d6" rel="noopener ugc nofollow" target="_blank">做到了这一点</a>，博客详细讲述了它的好处。在不久的将来，StreamAlert将支持这种用例，允许您分散您的分类工作，将警报发送给那些具有最多上下文的人。我们的目标是17年的Q1/Q2。</p><p id="08ec" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在不久的将来，StreamAlert将支持将日志与传统的危害指示器(IOCs)进行比较，后者的数量从数千到数百万不等。这将以一种与提供商无关的方式构建，允许您使用ThreatStream、ThreatExchange或任何您想要的东西。我们的目标是17年的Q1/Q2。</p><p id="d947" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">StreamAlert还将支持通过HTTP端点接收数据。这适用于仅支持HTTP端点进行日志记录的服务提供商或设备。我们的目标是Q2 17年</p><p id="ea7e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于历史搜索，StreamAlert将使用AWS Athena，这是一种无服务器的交互式查询服务，使用Presto来查询S3的数据。这将允许您使用SQL对特定查询和计划查询进行数据分析。我们的目标是2017年第3/4季度。</p><h1 id="b2e7" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">总结思路</strong></h1><p id="97e2" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">开源允许我们作为一个社区，在共同的需求和目标上共享、合作和迭代。现在有了将基础设施表示为代码的能力，这个目标可以进一步实现，同时降低开发和部署的成本。</p><p id="8705" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们希望StreamAlert可以作为一个例子，让部署变得简单、可重复和安全，这样任何人都可以轻松使用它。</p><p id="34d2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">信用和贡献:</p><ul class=""><li id="8cb7" class="kr ks hh ig b ih ii il im ip kt it ku ix kv jb kw kx ky kz bi translated"><a class="ae lu" href="https://twitter.com/@jack_naglieri" rel="noopener ugc nofollow" target="_blank"> @jack_naglieri </a>(核心架构师兼工程师)</li><li id="e2a1" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated"><a class="ae lu" href="https://twitter.com/@mimeframe" rel="noopener ugc nofollow" target="_blank"> @mimeframe </a>(概念、网站、文档、代码&amp;内容审核)</li><li id="26ce" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated"><a class="ae lu" href="https://twitter.com/@strcrzy" rel="noopener ugc nofollow" target="_blank"> @strcrzy </a>(规则装饰代码)</li><li id="d040" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated"><a class="ae lu" href="https://twitter.com/@zwass" rel="noopener ugc nofollow" target="_blank"> @zwass </a> (osquery kinesis插件)</li><li id="2c30" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated"><a class="ae lu" href="https://twitter.com/@hackgnar" rel="noopener ugc nofollow" target="_blank">@ hackgnar</a>(osquery kinesis插件bug修复)</li><li id="0f28" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated"><a class="ae lu" href="https://twitter.com/@austinbbyers" rel="noopener ugc nofollow" target="_blank"> @austinbbyers </a>(代码审核)</li><li id="c998" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated"><a class="ae lu" href="https://twitter.com/@emma_c_lin" rel="noopener ugc nofollow" target="_blank"> @emma_c_lin </a>(代码审查)</li><li id="e841" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated"><a class="ae lu" href="https://twitter.com/@awscloud" rel="noopener ugc nofollow" target="_blank"> @awscloud </a>团队(AWS服务和支持)</li><li id="47b8" class="kr ks hh ig b ih la il lb ip lc it ld ix le jb kw kx ky kz bi translated"><a class="ae lu" href="https://twitter.com/@hashicorp" rel="noopener ugc nofollow" target="_blank"> @hashicorp </a>团队(地形)</li></ul><p id="6dda" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，如果您想开始使用StreamAlert或为其做出贡献，请访问https://github.com/airbnb/streamalert<a class="ae lu" href="https://github.com/airbnb/streamalert" rel="noopener ugc nofollow" target="_blank"/></p><p id="c447" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">谢谢！</p><p id="4648" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">安全团队@ Airbnb</p></div></div>    
</body>
</html>