<html>
<head>
<title>PEG away at evaluating expressions in JavaScript</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">专注于计算JavaScript中的表达式</h1>
<blockquote>原文：<a href="https://medium.com/globant/peg-away-at-evaluating-expressions-in-javascript-15159511fa97?source=collection_archive---------0-----------------------#2020-10-20">https://medium.com/globant/peg-away-at-evaluating-expressions-in-javascript-15159511fa97?source=collection_archive---------0-----------------------#2020-10-20</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="38cf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过使用解析表达式语法，以简单而强大的方式安全地评估JavaScript中的表达式</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/bf6a05c559a8625ad7e29b65672fbe51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xKi3EgTh-CEVIyz-AKDnXg.jpeg"/></div></div></figure><p id="2388" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最近，在我从事的一个前端项目中，客户需要能够通过输入使用数字、变量和函数的公式来定义计算。问题是:如何验证和(安全地)评估这样的表达式？</p><p id="21b9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你想让用户编写纯JavaScript代码(这不是一个非常友好的解决方案，除非用户是开发人员……)，你可以使用<code class="du jo jp jq jr b">eval()</code> <a class="ae js" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/eval" rel="noopener ugc nofollow" target="_blank">函数</a>，但这可能会允许用户输入<em class="jt">任何</em> JavaScript代码——这可能会破坏应用程序，或者创建一个<a class="ae js" href="https://en.wikipedia.org/wiki/Code_injection" rel="noopener ugc nofollow" target="_blank">安全漏洞</a>！</p><p id="0544" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本文中，我们将看到如何使用解析表达式语法(PEG)来轻松地允许我们定义自己的表达式语言，并且我们将看到它的完整JavaScript实现。</p><h1 id="5308" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">定义我们的目标</h1><p id="7de6" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip ku ir is it kv iv iw ix kw iz ja jb ha bi translated">让我们从定义我们想要达到的目标开始。如上所述，允许用户输入纯JavaScript代码，用<code class="du jo jp jq jr b">eval()</code>评估，并不能真正削减它——不友好(用户不是开发者！)而且，此外，容易有风险。</p><p id="9b19" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">由于网站的大多数(如果不是全部)用户都熟悉<a class="ae js" href="https://support.microsoft.com/en-us/office/overview-of-formulas-in-excel-ecfdc708-9162-49e8-b993-c311f47ca173" rel="noopener ugc nofollow" target="_blank"> Excel </a>，所以决定使用这种风格的公式，并根据用户的实际需要提供一组函数。然后，我们应该接受如下公式——注意，最初的等号是Excel中的标准符号，所以我也需要它:</p><ul class=""><li id="cbf5" class="kx ky hh ig b ih ii il im ip kz it la ix lb jb lc ld le lf bi translated">简单算术:<code class="du jo jp jq jr b">=(1+2)/3</code></li><li id="bc83" class="kx ky hh ig b ih lg il lh ip li it lj ix lk jb lc ld le lf bi translated">变量:<code class="du jo jp jq jr b">=SPEED*TIME</code></li><li id="b865" class="kx ky hh ig b ih lg il lh ip li it lj ix lk jb lc ld le lf bi translated">数学函数:<code class="du jo jp jq jr b">=POWER(1+INTEREST/100, MONTHS)</code></li><li id="954e" class="kx ky hh ig b ih lg il lh ip li it lj ix lk jb lc ld le lf bi translated">逻辑表达式:<code class="du jo jp jq jr b">=IF(DAYS&gt;0, DAILY_FEE*DAYS, 0)</code></li></ul><p id="d6c9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们看看如何建立这个！</p><h1 id="0fbf" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">定义和识别语法</h1><p id="0944" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip ku ir is it kv iv iw ix kw iz ja jb ha bi translated">我们在这里写的是一种表达式语言——那么语言通常是如何定义的呢？一些常见的工具(其中包括)是<a class="ae js" href="https://en.wikipedia.org/wiki/Context-free_grammar" rel="noopener ugc nofollow" target="_blank">上下文无关文法</a>(CFG)<a class="ae js" href="https://en.wikipedia.org/wiki/Extended_Backus%E2%80%93Naur_form" rel="noopener ugc nofollow" target="_blank">扩展的巴科斯诺尔形式</a> (EBNF)，甚至<a class="ae js" href="https://en.wikipedia.org/wiki/Syntax_diagram" rel="noopener ugc nofollow" target="_blank">铁路图</a>。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ll"><img src="../Images/ce1a6b5add433860255df539a756d4b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*79VmPYbj9QMAcGMd.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx">A sample railroad diagram for <a class="ae js" href="http://openddl.org/" rel="noopener ugc nofollow" target="_blank">OpenDDL</a></figcaption></figure><p id="c89e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为一种语言编写编译器或解释器通常需要首先编写一个<em class="jt">扫描器</em>或<em class="jt">标记器</em>(它将读取输入语言并将其分成标记，如操作符或变量名)，然后是一个解析器和解释器(它将检查输入是否满足语法规则，然后正确地评估它)。</p><p id="7f44" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有很多工具可以用来编写编译器和解释器，但是我决定使用<a class="ae js" href="https://pegjs.org/" rel="noopener ugc nofollow" target="_blank"> PEG.js </a>，因为它可以简化编码。PEG代表<em class="jt">解析表达式语法</em>，让你用一个工具定义要处理的语言的语法，以及如何评估它。更好的是，它有一个<a class="ae js" href="https://pegjs.org/online" rel="noopener ugc nofollow" target="_blank">在线页面</a>，你可以在其中输入一个PEG并以一种非常简单的方式尝试:这对开发帮助很大！</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lq"><img src="../Images/7a8926c37e174b9d5c54e37f56d8ba72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DRGa8L_jKp2oPtJ6m-Gj9g.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx">PEG.js provides an <a class="ae js" href="https://pegjs.org/online" rel="noopener ugc nofollow" target="_blank">online environment</a> that allows faster and simpler development</figcaption></figure><p id="2e88" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">安装PEG.js相当简单；只需遵循网上找到的简短说明。之后，您必须为您的语言编写语法，然后使用<code class="du jo jp jq jr b">peg.js</code>生成一个JavaScript文件，该文件将解析和评估表达式。在我的例子中，需要的命令如下:</p><pre class="jd je jf jg fd lr jr ls lt aw lu bi"><span id="4077" class="lv jv hh jr b fi lw lx l ly lz">./node_modules/pegjs/bin/peg.js article.pegjs -f commonjs</span></pre><p id="9a4c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">运行这个命令将读取源文件(<code class="du jo jp jq jr b">article.pegjs</code>)并产生一个名称相似的输出文件(<code class="du jo jp jq jr b">article.js</code>)，由于有了<code class="du jo jp jq jr b">-f commonjs</code>参数，它适合与Node.js一起使用。在浏览器中，你可以用<code class="du jo jp jq jr b">-f es</code>来代替。为了以防万一，看看所有的<a class="ae js" href="https://github.com/pegjs/pegjs/blob/master/docs/guides/command-line.md" rel="noopener ugc nofollow" target="_blank"> CLI选项</a>。</p><p id="5334" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">生成JavaScript文件后，您可以如下使用它。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="35d1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了解析(在我们的例子中，是评估)一个字符串，您必须仅仅<code class="du jo jp jq jr b">require(...)</code>(对于浏览器是<code class="du jo jp jq jr b">import</code>)生成的JavaScript文件，并调用它的<code class="du jo jp jq jr b">parse(...)</code>方法。你可以传递一个额外的带有变量值的options对象，就像我在这里做的那样，当你计算表达式时，这些变量将是可用的，我们将在下面看到。</p><h1 id="8481" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">识别数字</h1><p id="af63" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip ku ir is it kv iv iw ix kw iz ja jb ha bi translated">让我们从下往上开始，看看什么是数字，以及如何使用它们。识别数字并不太难，但是对于实数和整数，我们需要两个不同的规则。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="7d0d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">很明显，规则似乎与数字有关，但是下划线是怎么回事，为什么它们无处不在？使用PEG，我们没有单独的输入扫描器，所以如果我们想允许(但忽略)额外的空白，我们必须自己做。最后一行的规则定义了空白:零个或多个空格、制表符、换行符或回车符。(一些怪异的符号，像方括号、<code class="du jo jp jq jr b">+ </code>和<code class="du jo jp jq jr b">*</code>，是<a class="ae js" href="https://en.wikipedia.org/wiki/Regular_expression" rel="noopener ugc nofollow" target="_blank">正则表达式</a>的一部分；它们的用法在PEG中很常见。)我们必须在任何我们希望用户能够输入空白的地方都包含<code class="du jo jp jq jr b">_</code>符号。</p><blockquote class="mc md me"><p id="d5e6" class="ie if jt ig b ih ii ij ik il im in io mf iq ir is mg iu iv iw mh iy iz ja jb ha bi translated">在PEG中，数字规则的顺序非常重要:在我们的例子中，如果我们颠倒这两个规则的顺序，带句点的数字将被理解为整数(因为第一个规则是完全匹配的)，而不是实数。</p></blockquote><p id="5649" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在让我们来看看如何解释数字。在第一种情况下，我们得到一个包含三个元素的数组，它的第一个和第三个元素本身就是数组，具有匹配的数字。例如，当解析22.0960时，数字会是<code class="du jo jp jq jr b">[["2", "2"], ".", ["0", "9", "6", "0"]]</code>，所以应用<code class="du jo jp jq jr b">flat()</code>会将数组转换为<code class="du jo jp jq jr b">["2", "2", ".", "0", "9", "6", "0"]</code>，然后将它们连接起来，成为<code class="du jo jp jq jr b">"22.0960"</code>，其求值最终会产生等价的数字。对于整数我们不需要展平，所以逻辑更简单。</p><blockquote class="mc md me"><p id="836a" class="ie if jt ig b ih ii ij ik il im in io mf iq ir is mg iu iv iw mh iy iz ja jb ha bi translated">每个语法规则后面的JavaScript代码定义了当输入文本匹配相应的模式时将返回什么值。对于数字，我们只返回等值；对于更复杂的表达式，返回值将取决于相关子表达式的单个值。</p></blockquote><p id="efdf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们还没有看到如何<em class="jt">使用</em>数字(只是如何识别和评估它们),但让我们先看看如何处理变量，然后我们将返回到在表达式中使用两者。</p><h1 id="84d5" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">包括变量</h1><p id="1698" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip ku ir is it kv iv iw ix kw iz ja jb ha bi translated">现在我们知道了如何处理数字，让我们添加变量。让我们定义变量名将使用小写字母、数字和下划线。识别变量并不困难；我们再次使用正则表达式。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="31a4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">正如我前面提到的，当您使用您生成的JavaScript解析器时，您可以向它传递一个<code class="du jo jp jq jr b">options</code>对象。在我们的例子中，我传递了一个带有<code class="du jo jp jq jr b">values</code>属性的对象，它本身是一个带有我想要共享的变量的对象。所以，我们需要做的是将变量名称中的字符连接在一起，然后在<code class="du jo jp jq jr b">options.values</code>中访问相应的属性；简单！</p><p id="6bd6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们现在有了一种既能识别数字又能识别变量的方法；我们如何在表达式中使用它？那是我们必须处理的下一个项目。</p><h1 id="ee69" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">做基本算术</h1><p id="17c7" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip ku ir is it kv iv iw ix kw iz ja jb ha bi translated">如何用语法定义算术运算是一个众所周知的课题。这里的关键问题是组织语法，以便正确处理运算符优先级。基本模式如下，将根据通常的<a class="ae js" href="https://en.wikipedia.org/wiki/Order_of_operations" rel="noopener ugc nofollow" target="_blank"> PEMDAS </a>规则计算涉及加、减、乘、除和取幂的表达式。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="c78e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们一条一条来。第一个，<code class="du jo jp jq jr b">EXCEL</code>，将是我们语法的入口点(初始符号):公式以等号开始，后面是表达式。我们将暂时跳过下一行(关于<code class="du jo jp jq jr b">EXPR</code>的那一行),但是我们很快会回来的！</p><blockquote class="mc md me"><p id="f290" class="ie if jt ig b ih ii ij ik il im in io mf iq ir is mg iu iv iw mh iy iz ja jb ha bi translated">我们再次在所有允许空格的地方加上了下划线。</p></blockquote><p id="21e6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以下三个规则(用于<code class="du jo jp jq jr b">EXP_AS</code>、<code class="du jo jp jq jr b">EXP_PD</code>和<code class="du jo jp jq jr b">EXP_X</code>)正确地应用了操作符优先级，确保1+2*3将被计算为7，而不是9。我想使用mnemotecnic名称来表示操作的符号(所以<code class="du jo jp jq jr b">EXP_AS</code>是因为“AS”=“加法/减法”)，但是我也想使用<code class="du jo jp jq jr b">EXPR</code>来表示表达式，这就是为什么我添加了<code class="du jo jp jq jr b">EXPR = EXP_AS</code>规则，这碰巧节省了我很多时间，正如我们将看到的！</p><blockquote class="mc md me"><p id="659a" class="ie if jt ig b ih ii ij ik il im in io mf iq ir is mg iu iv iw mh iy iz ja jb ha bi translated">对于所有一元和二元运算符，计算值取决于表达式中单个术语的先前计算值。</p></blockquote><p id="2ffd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，什么是<code class="du jo jp jq jr b">VALUE</code>？第一个规则允许前导减号，所以你可以写<code class="du jo jp jq jr b">-2</code>，例如。第二个规则提供了括号，最后两个规则表明，如果数字或变量被识别，则使用它们的值。</p><h1 id="183d" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">添加数学函数</h1><p id="1b0e" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip ku ir is it kv iv iw ix kw iz ja jb ha bi translated">让我们添加一些数学函数！用户希望拥有他们已经习惯的功能，如<code class="du jo jp jq jr b">ROUND()</code>或<code class="du jo jp jq jr b">POWER()</code>。为了添加它们，我们必须修改<code class="du jo jp jq jr b">VALUE</code>的语法。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ma mb l"/></div></figure><blockquote class="mc md me"><p id="2975" class="ie if jt ig b ih ii ij ik il im in io mf iq ir is mg iu iv iw mh iy iz ja jb ha bi translated"><code class="du jo jp jq jr b">"POWER"i"</code>末尾的<code class="du jo jp jq jr b">i</code>意味着大写和小写字符将被认为是相等的，因此用户可以键入<code class="du jo jp jq jr b">POWER(...)</code>或<code class="du jo jp jq jr b">power(...)</code>或任何其他类似的方式。</p></blockquote><p id="79ab" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我还包括了一些对数函数，我们可以很容易地添加更多的函数。为了简洁，我使用了几个辅助函数，定义在代码的顶部。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="d2d8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们现在有了算术表达式，包括函数调用——但是能够使用逻辑函数(如<code class="du jo jp jq jr b">IF()</code>或<code class="du jo jp jq jr b">AND()</code>)和比较运算符被认为是非常重要的；让我们添加那些。</p><h1 id="6acb" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">允许逻辑表达式</h1><p id="c88c" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip ku ir is it kv iv iw ix kw iz ja jb ha bi translated">逻辑函数在概念上与数学函数非常相似，所以添加逻辑函数很容易也就不足为奇了。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="7daf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">增加的函数(<code class="du jo jp jq jr b">IF()</code>、<code class="du jo jp jq jr b">OR()</code>、<code class="du jo jp jq jr b">AND()</code>、<code class="du jo jp jq jr b">NOT()</code>、<code class="du jo jp jq jr b">FALSE()</code>、<code class="du jo jp jq jr b">TRUE()</code>)是大家熟知的<a class="ae js" href="https://support.microsoft.com/en-us/office/logical-functions-reference-e093c192-278b-43f6-8c3a-b6ce299931f5" rel="noopener ugc nofollow" target="_blank"> Excel逻辑函数</a>，经常使用。</p><p id="e801" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们也应该可以比较表达式，所以我们把这个加上吧……但是我们有一个问题:比较是在加减之后进行的，所以<code class="du jo jp jq jr b">a+b&gt;c-d</code>应该求值为<code class="du jo jp jq jr b">(a+b)&gt;(c-d)</code>。这意味着我必须修改PEG，添加一个新的比较符号(<code class="du jo jp jq jr b">EXP_C</code>来匹配我们的命名标准)，这就是中间的<code class="du jo jp jq jr b">EXPR</code>符号有所回报的地方；变化很小。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="f398" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有了这些函数，客户获得了计算所需的一切——即使后来需要一些额外的功能，它们也很容易被包含进来。</p><h1 id="6a67" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">进一步试验</h1><p id="c84b" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip ku ir is it kv iv iw ix kw iz ja jb ha bi translated">如果你做到了这一步，那么你可以开始给我们的表情添加更多的功能，这是我后来加入的一些功能列表:</p><ul class=""><li id="3dbc" class="kx ky hh ig b ih ii il im ip kz it la ix lb jb lc ld le lf bi translated">使用<code class="du jo jp jq jr b">%</code>后缀表示百分比；<code class="du jo jp jq jr b">22%</code>应解释为0.22</li><li id="1cfc" class="kx ky hh ig b ih lg il lh ip li it lj ix lk jb lc ld le lf bi translated">在<code class="du jo jp jq jr b">AND()</code>和<code class="du jo jp jq jr b">OR()</code>中允许多个术语，如<code class="du jo jp jq jr b">AND(a,b,c,d)</code></li><li id="5baa" class="kx ky hh ig b ih lg il lh ip li it lj ix lk jb lc ld le lf bi translated">添加字符串和与字符串相关的运算符(如<code class="du jo jp jq jr b">&amp;</code>)和函数(如<code class="du jo jp jq jr b">CONCAT()</code>和<code class="du jo jp jq jr b">FIND()</code>)</li><li id="fb21" class="kx ky hh ig b ih lg il lh ip li it lj ix lk jb lc ld le lf bi translated">用操作符和函数添加日期——像<code class="du jo jp jq jr b">"2020–09–22"</code>这样的字符串应该被解释为一个日期，并且您应该能够将一个数字添加到一个日期(并获得一个未来的日期)或者将两个日期相减以得到它们之间的天数。</li><li id="8a29" class="kx ky hh ig b ih lg il lh ip li it lj ix lk jb lc ld le lf bi translated">除了单个变量，允许数组和矩阵。</li></ul><p id="a756" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">不言而喻，您还可以添加更多的函数——而且在大多数情况下，Excel函数可以用一两行JavaScript实现，所以没什么大问题。</p><h1 id="b0de" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">总结</h1><p id="163c" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip ku ir is it kv iv iw ix kw iz ja jb ha bi translated">让我们用表达式计算器的完整代码来结束这篇文章；正如我们之前说过的，如果你愿意，你可以<a class="ae js" href="https://pegjs.org/online" rel="noopener ugc nofollow" target="_blank">在线</a>测试它。我认为用不到80行代码编写这段代码已经很不错了——而且代码也很容易扩展！</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="0091" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们在这里已经看到了使用PEG是如何轻松地为类似Excel的表达式实现解析器和求值器的。这只是触及了PEG.js所允许的表面，您还可以用它来处理更复杂的语法；我建议看一下文档，了解一下您可以处理的所有<a class="ae js" href="https://pegjs.org/documentation#grammar-syntax-and-semantics-parsing-expression-types" rel="noopener ugc nofollow" target="_blank">表达式类型</a>。</p><p id="5b3e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">总结一下:一个简短的，很好的解决难题的方法！</p><blockquote class="mc md me"><p id="8731" class="ie if jt ig b ih ii ij ik il im in io mf iq ir is mg iu iv iw mh iy iz ja jb ha bi translated">D <!-- -->不要错过我关于这个主题的第二篇文章，展示了对这里显示的代码的一些增强和修正。</p></blockquote><h1 id="bca8" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">阅读更多</h1><p id="fa9e" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip ku ir is it kv iv iw ix kw iz ja jb ha bi translated">在PEG.js自己的网站<a class="ae js" href="https://pegjs.org" rel="noopener ugc nofollow" target="_blank">上阅读所有关于peg . js的内容。</a></p><p id="51c8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你对钉住汇率的理论基础感兴趣，你应该读一读布莱恩·福特2004年的原始论文。</p><p id="0daf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，<a class="ae js" href="http://ceur-ws.org/Vol-1698/CS&amp;P2016_01_Redziejowski_Trying-to-understand-PEG.pdf" rel="noopener ugc nofollow" target="_blank">理解Roman Redziejowski的PEG </a>，可以帮助弥合CFG和PEG的经典解析之间的鸿沟。<a class="ae js" href="http://ceur-ws.org/Vol-1032/paper-33.pdf" rel="noopener ugc nofollow" target="_blank">一些</a> <a class="ae js" href="https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.416.7378&amp;rep=rep1&amp;type=pdf" rel="noopener ugc nofollow" target="_blank">其他</a> <a class="ae js" href="https://www.researchgate.net/publication/262239402_From_EBNF_to_PEG/link/597845830f7e9b2777264725/download" rel="noopener ugc nofollow" target="_blank">文章</a>由同一作者帮忙从EBNF搬到钉住。</p></div></div>    
</body>
</html>