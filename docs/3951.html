<html>
<head>
<title>Fluent Database in Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift中的流畅数据库</h1>
<blockquote>原文：<a href="https://medium.com/globant/fluent-database-in-swift-464feb9c2952?source=collection_archive---------2-----------------------#2022-08-18">https://medium.com/globant/fluent-database-in-swift-464feb9c2952?source=collection_archive---------2-----------------------#2022-08-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/4d546eaaaf521d4f6bfd274bb43c9f1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/1*70uaDEHk1ND-4Bbv7F9RXA.png"/></div><figcaption class="il im et er es in io bd b be z dx">image source: <a class="ae ip" href="https://github.com/vapor/fluent" rel="noopener ugc nofollow" target="_blank">https://github.com/vapor/fluent</a></figcaption></figure><h1 id="31fd" class="iq ir hh bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">什么是流利？</h1><p id="5f6c" class="pw-post-body-paragraph jo jp hh jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ha bi translated">Fluent是一个开源的ORM(对象关系映射器)框架，是Vapor项目的一部分。它在Vapor应用程序和数据库之间提供了一个抽象层。它使我们不必编写查询来直接与数据库交互，而是为我们的数据库提供了一个易于使用的接口。</p><p id="813f" class="pw-post-body-paragraph jo jp hh jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl ha bi translated">虽然Fluent是Vapor项目的一部分，但它是独立的，并且有足够的能力独自管理数据库连接。</p><h1 id="1510" class="iq ir hh bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">ORM是什么？</h1><p id="42a4" class="pw-post-body-paragraph jo jp hh jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ha bi translated">当我们有一个关系数据库时，我们总是可以使用SQL并编写我们的SQL查询来获取数据。但是如果我们不想自己写SQL，想借助Swift或者其他任何编程语言的力量，只是使用一些辅助函数，以我们想要的方式获取所有数据，那该怎么办呢？比如只写Movie.all()就可以得到所有的电影数据。这就是ORM出现的原因！</p><p id="5320" class="pw-post-body-paragraph jo jp hh jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl ha bi translated">ORM在关系数据库上工作，并允许我们以对象的形式交流关系数据库表和记录。所以换句话说，它是对象和关系数据库之间的映射。</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es kr"><img src="../Images/f3cca7f5979e1d58ede20abb01933468.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JCcknj5rvHRZQt8HiNwVxQ.png"/></div></div></figure><p id="37e8" class="pw-post-body-paragraph jo jp hh jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl ha bi translated"><strong class="jq hi"> Fluent Driver </strong>可以用来连接上述两个东西，这意味着我们可以在我们的swift代码中创建这些模型和这些类，它们实际上可以与数据库对话，并从数据库中获取内容，就像从数据库中获取所有电影一样。</p><p id="ecf1" class="pw-post-body-paragraph jo jp hh jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl ha bi translated">所以我们使用ORM的真正好处是我们不用写SQL查询，我们只处理对象和类，不管我们用的是JavaScript还是Java等等。每个类都有自己的形式，我们使用这些类来访问数据库表。在类模型中，每个表由类名表示，每个列由属性表示。</p><h1 id="e6a9" class="iq ir hh bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">向Vapor项目添加Fluent</h1><p id="7154" class="pw-post-body-paragraph jo jp hh jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ha bi translated">要在我们的Vapor项目中使用Fluent，我们需要在创建项目时包含Fluent，或者可以在以后将它添加到现有项目中。</p><p id="7ce5" class="pw-post-body-paragraph jo jp hh jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl ha bi translated">两者的步骤如下-</p><p id="28ae" class="pw-post-body-paragraph jo jp hh jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl ha bi translated">步骤1:创建Vapor项目时添加Fluent。</p><ul class=""><li id="27d5" class="la lb hh jq b jr km jv kn jz lc kd ld kh le kl lf lg lh li bi translated">进入终端&gt;运行蒸汽新<project-name> <br/></project-name></li><li id="6c68" class="la lb hh jq b jr lj jv lk jz ll kd lm kh ln kl lf lg lh li bi translated">按下回车键后，我们会得到一个提示，询问<strong class="jq hi">“你要用Fluent吗？”</strong>选择<strong class="jq hi"> y </strong></li></ul><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es lo"><img src="../Images/a7fdd90d039fed297bf1ad7b4c24d6e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SwDfPC5k_AQNJHCa"/></div></div></figure><ul class=""><li id="9f23" class="la lb hh jq b jr km jv kn jz lc kd ld kh le kl lf lg lh li bi translated">然后我们会得到一个提示，询问<strong class="jq hi">“您想使用哪个数据库？”</strong>选择与提到的数据库名称相对应的数字。</li></ul><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es lp"><img src="../Images/5f877f54a2fc2f8a848e831ab9ffc7f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oAvStdrAgn6ZMFF9"/></div></div></figure><ul class=""><li id="98fd" class="la lb hh jq b jr km jv kn jz lc kd ld kh le kl lf lg lh li bi translated">按回车键后，我们会得到一个提示，询问<strong class="jq hi">“你要使用Leaf吗？”</strong>根据需要选择选项，按enter键。</li></ul><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es lq"><img src="../Images/ca4cd9b0303718d73ae2ed6996ec9337.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nXdE3pazcglpcBrR"/></div></div></figure><ul class=""><li id="b533" class="la lb hh jq b jr km jv kn jz lc kd ld kh le kl lf lg lh li bi translated">按下enter键后，我们的具有流畅配置的项目将被创建。</li><li id="30f4" class="la lb hh jq b jr lj jv lk jz ll kd lm kh ln kl lf lg lh li bi translated">导航到项目文件夹，键入命令“<strong class="jq hi">open package . swift”</strong>并按回车键。这将在<strong class="jq hi"> Xcode </strong>编辑器中打开我们的项目。</li><li id="a93e" class="la lb hh jq b jr lj jv lk jz ll kd lm kh ln kl lf lg lh li bi translated">可以在我们项目的根级别在<strong class="jq hi"> Package.swift </strong>文件中验证Fluent配置，并且可以在<strong class="jq hi">项目依赖关系</strong>下验证fluent依赖关系，如下所示。</li></ul><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es lr"><img src="../Images/d54d5407bc98db093fe259519327271b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GzPB1czYnsWheEI_"/></div></div></figure><p id="5360" class="pw-post-body-paragraph jo jp hh jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl ha bi translated">步骤2:将Fluent添加到现有的Vapor项目中</p><p id="0b11" class="pw-post-body-paragraph jo jp hh jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl ha bi translated">要将Fluent添加到现有项目中，我们需要将两个依赖项添加到我们的包中:</p><ul class=""><li id="89fa" class="la lb hh jq b jr km jv kn jz lc kd ld kh le kl lf lg lh li bi translated">蒸汽/流体@4.0.0</li><li id="c701" class="la lb hh jq b jr lj jv lk jz ll kd lm kh ln kl lf lg lh li bi translated">我们选择的一名(或多名)熟练驾驶员</li><li id="6751" class="la lb hh jq b jr lj jv lk jz ll kd lm kh ln kl lf lg lh li bi translated">这些可在Fluent的官方Vapor文档中通过以下链接获得—<a class="ae ip" href="https://docs.vapor.codes/4.0/fluent/overview/" rel="noopener ugc nofollow" target="_blank">https://docs . Vapor . codes/4.0/Fluent/overview/</a></li></ul><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es ls"><img src="../Images/09ec2b09847112cb742007e479076bde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xG7OYhL0izE_O3iogG3seA.png"/></div></div></figure><p id="d24b" class="pw-post-body-paragraph jo jp hh jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl ha bi translated">第二个URL中的<strong class="jq hi"> &lt; db &gt; </strong>是我们用来连接Fluent和数据库的数据库驱动程序。例如:流利的英语。</p><p id="d665" class="pw-post-body-paragraph jo jp hh jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl ha bi translated">这个驱动程序URL也可以在上面提到的Fluent的官方Vapor文档中找到。</p><ul class=""><li id="9415" class="la lb hh jq b jr km jv kn jz lc kd ld kh le kl lf lg lh li bi translated">将Fluent依赖项添加到<strong class="jq hi"> Package.swift. </strong>中的目标依赖项，如下-</li></ul><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es lt"><img src="../Images/3b23fc9efd6338eed74e552cad08108b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fFi5NFUNOfuUkOwLe0ogqw.png"/></div></div></figure><ul class=""><li id="4f18" class="la lb hh jq b jr km jv kn jz lc kd ld kh le kl lf lg lh li bi translated">一旦这些包被添加为依赖项，我们就可以使用文件<strong class="jq hi"> configure.swift </strong>中的<strong class="jq hi"> app.databases </strong>来配置我们的数据库。</li></ul><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es lu"><img src="../Images/2f3cb95b0b8f35b58dc3ff0817e59709.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F-sV7Q4YXYISqhpOckfZ2g.png"/></div></div></figure><h1 id="3652" class="iq ir hh bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">Fluent中的模型</h1><p id="5cb1" class="pw-post-body-paragraph jo jp hh jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ha bi translated">在数据库中，我们有模型，它是数据库管理系统中的主要工件。模型显示了数据库的逻辑结构，包括确定如何存储和访问数据的关系和约束。数据库模型可以包括实体、它们的关系、数据流、表格等。</p><p id="7892" class="pw-post-body-paragraph jo jp hh jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl ha bi translated">同样，我们在Fluent中也有模型。模特是流畅的核心。它们是我们数据的快速表示，并在整个Fluent中使用。根据Vapor的官方文档，“模型代表我们数据库中的固定数据结构，比如表或集合。”。下面是来自Vapor docs的一个模型，它代表了一个星系。</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es lv"><img src="../Images/5c859a0dc63ac93263e28e48560b5171.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V-EFBZqL-Rm2eTY-sNmw5Q.png"/></div></div></figure><p id="1ee0" class="pw-post-body-paragraph jo jp hh jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl ha bi translated">如果我们看上面的模型，它只是一个符合一个<strong class="jq hi">模型协议的Swift <strong class="jq hi">类</strong>。</strong>一个<strong class="jq hi">协议</strong>定义了适合特定任务或功能的方法、属性和其他需求的蓝图。类、结构或枚举可以采用该协议来提供这些需求的实际实现。当我们扩展一个<strong class="jq hi">协议时，</strong>除了协议的实际实现，我们还可以根据我们的需求实现一些额外的功能。多个协议可以通过用逗号分隔来扩展。像下面这样-</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es lw"><img src="../Images/052a57a71f414f3080dce913b56e5444.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mqVTca2QjWftSnViH7K-KQ.png"/></div></div></figure><p id="7307" class="pw-post-body-paragraph jo jp hh jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl ha bi translated">所以总的来说，我们可以说模型是我们在数据库中保存和访问的对象。fluent中的模型是类型安全的，所以当我们在Fluent中与数据库交互时，模型给了我们编译时的安全性。</p><p id="3cce" class="pw-post-body-paragraph jo jp hh jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl ha bi translated">在swift项目中，我们在<strong class="jq hi"> Sources &gt; Apps </strong>下创建模型目录，并存储我们的模型。没有必要创建一个单独的模型目录，这只是为了保持关注点的分离。</p><p id="cb44" class="pw-post-body-paragraph jo jp hh jq b jr km jt ju jv kn jx jy jz ko kb kc kd kp kf kg kh kq kj kk kl ha bi translated">下面的代码片段显示了一个符合两个协议的Todo模型。</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es lr"><img src="../Images/d9a7d142179c7cabe75b4338260a0aa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*O3RuTBJMlLPRoS9w"/></div></div></figure><h1 id="fe2f" class="iq ir hh bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">结论</h1><p id="b324" class="pw-post-body-paragraph jo jp hh jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ha bi translated">这篇文章只是谈论Fluent ORM，如何将它添加到我们的Vapor项目和Fluent中的模型。为了在项目中正确使用Fluent，需要了解Fluent中的更多子主题，例如Fluent模式、Fluent中的迁移等。这些可以参考Vapor在Fluent上的官方文档。</p><h1 id="77a7" class="iq ir hh bd is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn bi translated">参考</h1><ul class=""><li id="f6ce" class="la lb hh jq b jr js jv jw jz lx kd ly kh lz kl lf lg lh li bi translated">Swift Vapor官方文档— <a class="ae ip" href="https://docs.vapor.codes/4.0/fluent/overview/" rel="noopener ugc nofollow" target="_blank"> Vapor: Fluent →概述</a></li><li id="f800" class="la lb hh jq b jr lj jv lk jz ll kd lm kh ln kl lf lg lh li bi translated"><a class="ae ip" href="https://martinlasek.medium.com/tutorial-how-to-write-models-using-fluent-e9482d335a5f" rel="noopener">教程:如何使用Fluent编写模型|作者马丁·拉塞克| Medium </a></li><li id="06c8" class="la lb hh jq b jr lj jv lk jz ll kd lm kh ln kl lf lg lh li bi translated"><a class="ae ip" href="https://www.raywenderlich.com/15249598-using-fluent-and-persisting-models-in-vapor" rel="noopener ugc nofollow" target="_blank">https://www . raywenderlich . com/15249598-使用-流畅-持续-蒸汽模型</a></li></ul></div></div>    
</body>
</html>