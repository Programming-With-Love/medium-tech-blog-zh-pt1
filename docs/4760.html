<html>
<head>
<title>Unit Tests for Random Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">随机函数的单元测试</h1>
<blockquote>原文：<a href="https://medium.com/javascript-scene/unit-tests-for-random-functions-e79a2524ab60?source=collection_archive---------1-----------------------#2019-11-07">https://medium.com/javascript-scene/unit-tests-for-random-functions-e79a2524ab60?source=collection_archive---------1-----------------------#2019-11-07</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="96ec" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">猎枪后置第3集</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/991d0b9dbb03bab579fb88c41f2f5453.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lo8cD5m7VqUXPlKF3lgfNQ.jpeg"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Photo: <a class="ae jm" href="https://www.flickr.com/photos/luxurydesigner/" rel="noopener ugc nofollow" target="_blank">Brandon Bailey</a> — Midnight Cowboy (CC-BY-2.0)</figcaption></figure><p id="a94d" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">shotgun是一个视频系列，当我为真正的应用和库解决真正的编程挑战时，你可以和我一起乘坐Shotgun。这些视频只对EricElliottJS.com<a class="ae jm" href="https://ericelliottjs.com/product/lifetime-access-pass/" rel="noopener ugc nofollow" target="_blank"><em class="kj"/></a><em class="kj">的成员开放，但我在这里记录这些冒险。</em></p><p id="808a" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">当你使用TDD足够长的时间时，你将面临的挑战之一是这个问题:“我如何测试随机函数？”</p><p id="5b7d" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">在Shotgun系列的这一集中，我们遇到了这个问题，因为我们想要生成一个随机的时间表来发送自动化的社交媒体更新。</p><p id="fe1a" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">如果我们想要富有成效，那么珍惜我们的时间是很重要的，所以<a class="ae jm" href="https://mypostamp.com/" rel="noopener ugc nofollow" target="_blank"> PostAmp </a>允许我们一次批量创建一堆社交媒体帖子是很好的，但我们不想每周一次向我们的粉丝大量发送30条推文。人们会很快不关注你，因为你破坏了他们的通知。</p><p id="737a" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">相反，如果我们可以将它们全部分批，PostAmp可以生成一个随机的时间表，在一周内为我们发布它们，这不是很好吗？</p><p id="4351" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">但是要做到这一点，我们需要写一些函数，来产生随机输出。</p><p id="d7dc" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">纯函数是最容易进行单元测试的函数。只需调用它们，然后断言输出是您所期望的。</p><p id="ae55" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">但是随机输出的函数呢？我们不能断言输出是我们所期望的。相反，我们需要断言输出服从一些约束。</p><p id="177a" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">生成随机发布时间表过程的第一步，我们需要分解问题。让我们从生成一个给定范围内的随机数开始。签名将如下所示:</p><pre class="ix iy iz ja fd kk kl km kn aw ko bi"><span id="ca0c" class="kp kq hh kl b fi kr ks l kt ku">randomNumber = (start: Number, end: Number) =&gt; Number</span></pre><p id="16b7" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我们的约束非常简单:</p><ul class=""><li id="790e" class="kv kw hh jp b jq jr jt ju jw kx ka ky ke kz ki la lb lc ld bi translated">给定没有开始和结束，生成一个大于或等于开始的随机数</li><li id="160f" class="kv kw hh jp b jq le jt lf jw lg ka lh ke li ki la lb lc ld bi translated">给定开始和结束，生成一个小于或等于结束的随机数</li></ul><p id="b6af" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">当我们处理随机数时，我们希望确保不仅仅是单个数字符合我们的约束。我们需要相当程度的确定性，所有生成的数字都将符合我们的约束。</p><p id="80be" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">为了做到这一点，我通常会生成一大堆，然后全部测试。这是我想到的:</p><pre class="ix iy iz ja fd kk kl km kn aw ko bi"><span id="1e10" class="kp kq hh kl b fi kr ks l kt ku">import { describe } from 'riteway';<br/>import { randomNumber } from './utils.js';</span><span id="0e13" class="kp kq hh kl b fi lj ks l kt ku">describe('randomNumber', async assert =&gt; {<br/>  const start = 3;<br/>  const end = 20;<br/>  const numbers = Array.from({ length: 100 }, () =&gt; randomNumber(start, end));</span><span id="7eac" class="kp kq hh kl b fi lj ks l kt ku">assert({<br/>    given: 'start, end',<br/>    should: 'generate a random number greater than or equal to start',<br/>    actual: numbers.every(n =&gt; n &gt;= start),<br/>    expected: true<br/>  });</span><span id="278b" class="kp kq hh kl b fi lj ks l kt ku">assert({<br/>    given: 'start, end',<br/>    should: 'generate a random number less than or equal to end',<br/>    actual: numbers.every(n =&gt; n &lt;= end),<br/>    expected: true<br/>  });<br/>});</span></pre><h1 id="2c04" class="lk kq hh bd ll lm ln lo lp lq lr ls lt in lu io lv iq lw ir lx it ly iu lz ma bi translated">首先，写一个测试，让它通过</h1><p id="16e7" class="pw-post-body-paragraph jn jo hh jp b jq mb ii js jt mc il jv jw md jy jz ka me kc kd ke mf kg kh ki ha bi translated">如果你看了视频，你可能会注意到一些事情。首先，我的测试描述是错误的。我说，“假定没有争论”——我已经在这篇博文中更正了。哎呀。</p><p id="ffbe" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">但是你也会注意到我一次只写了一个测试。我开始说:</p><pre class="ix iy iz ja fd kk kl km kn aw ko bi"><span id="2175" class="kp kq hh kl b fi kr ks l kt ku">assert({<br/>  given: 'start, end',<br/>  should: 'generate a random number greater than or equal to start',<br/>  actual: numbers.every(n =&gt; n &gt;= start),<br/>  expected: true<br/>});</span></pre><p id="3a01" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">在进行下一个测试之前，我看到这个测试失败了，然后编写了实现:</p><pre class="ix iy iz ja fd kk kl km kn aw ko bi"><span id="453f" class="kp kq hh kl b fi kr ks l kt ku">export const randomNumber = (start, end) =&gt;<br/>  Math.round(Math.random() * (end - start) + start);</span></pre><p id="efdf" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">然后我写了下一个测试:</p><pre class="ix iy iz ja fd kk kl km kn aw ko bi"><span id="3b45" class="kp kq hh kl b fi kr ks l kt ku">assert({<br/>  given: 'start, end',<br/>  should: 'generate a random number less than or equal to end',<br/>  actual: numbers.every(n =&gt; n &lt;= end),<br/>  expected: true<br/>});</span></pre><p id="68cb" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">下一个测试已经通过了，因为我写了整个实现。有时候，如果我知道我希望实现是什么样的，我会写出来，然后做一个改变来打破测试，然后看着测试失败，然后修复代码，看着它再次通过。</p><p id="def0" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我为什么要这么做？去测试测试！</p><blockquote class="mg"><p id="2e3e" class="mh mi hh bd mj mk ml mm mn mo mp ki dx translated">如果你没有见过测试失败，你不知道测试是否有效。</p></blockquote><p id="a365" class="pw-post-body-paragraph jn jo hh jp b jq mq ii js jt mr il jv jw ms jy jz ka mt kc kd ke mu kg kh ki ha bi translated">如果你看了视频，你也会注意到我在最后犯了一个愚蠢的错误，当我试图破坏<code class="du mv mw mx kl b">end</code>测试时，我像这样修改了代码:</p><pre class="ix iy iz ja fd kk kl km kn aw ko bi"><span id="390f" class="kp kq hh kl b fi kr ks l kt ku">export const randomNumber = (start, end) =&gt;<br/>  Math.round(Math.random() * (5 - start) + start);</span></pre><p id="b279" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">当然，这并没有破坏测试，因为<code class="du mv mw mx kl b">5</code>仍然在有效范围内。为了找出这个问题，我将实际的输出数组记录到控制台中。你们中比较聪明的人可能已经猜到我故意这么做有两个原因:</p><ol class=""><li id="b45f" class="kv kw hh jp b jq jr jt ju jw kx ka ky ke kz ki my lb lc ld bi translated">我想展示测试调试技术</li><li id="bdf0" class="kv kw hh jp b jq le jt lf jw lg ka lh ke li ki my lb lc ld bi translated">我想让你知道<em class="kj">每个人</em>都会犯错。</li></ol><p id="8dc9" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">猜得好！但是那是一个真正的错误，也是一个特别愚蠢的错误。我们得到那些额外的课程只是一个幸运的意外。记住，每个人都会犯错。如果没有，我们就不需要TDD了。</p><p id="281f" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">TDD就像一个复式记账分类账。对于每一个变更，您都有两个变更记录:在代码中，以及在您的测试中。如果你能让两个记录一致，你就有双倍的信心你写的代码是正确的。</p><h1 id="85cc" class="lk kq hh bd ll lm ln lo lp lq lr ls lt in lu io lv iq lw ir lx it ly iu lz ma bi translated">后续步骤</h1><p id="dfee" class="pw-post-body-paragraph jn jo hh jp b jq mb ii js jt mc il jv jw md jy jz ka me kc kd ke mf kg kh ki ha bi translated">会员可以在EricElliottJS.com<a class="ae jm" href="https://ericelliottjs.com" rel="noopener ugc nofollow" target="_blank">上</a><a class="ae jm" href="https://ericelliottjs.com/shotgun-postamp-episode-3-testing-random-outputs" rel="noopener ugc nofollow" target="_blank">观看新一集</a>。如果你不是会员，现在是一个伟大的时间来看看你错过了什么！</p><figure class="ix iy iz ja fd jb er es paragraph-image"><a href="https://ericelliottjs.com/premium-content/lesson-pure-functions"><div class="er es mz"><img src="../Images/1477d1002811845a63c46835ce48f127.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pwT_C6VPkOwygEQ4.png"/></div></a></figure><p id="255e" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><a class="ae jm" href="https://ericelliottjs.com/premium-content/lesson-pure-functions" rel="noopener ugc nofollow" target="_blank">开始您的EricElliottJS.com免费课程</a></p></div><div class="ab cl na nb go nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ha hb hc hd he"><p id="c55d" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi"> <em class="kj">艾里克·艾略特</em> </strong> <em class="kj">著有《书籍》、</em> <a class="ae jm" href="https://leanpub.com/composingsoftware" rel="noopener ugc nofollow" target="_blank"> <em class="kj">【排版软件】</em></a><em class="kj"/><a class="ae jm" href="https://www.amazon.com/Programming-JavaScript-Applications-Architecture-Libraries-dp-1491950293/dp/1491950293/ref=as_li_ss_tl?_encoding=UTF8&amp;language=en_US&amp;linkCode=ll1&amp;linkId=06971c7a0f2b13309e5af242b2483609&amp;me=&amp;qid=&amp;tag=eejs-20" rel="noopener ugc nofollow" target="_blank"><em class="kj">【编程JavaScript应用】</em> </a> <em class="kj">。作为</em><a class="ae jm" href="https://ericelliottjs.com/" rel="noopener ugc nofollow" target="_blank"><em class="kj">【EricElliottJS.com】</em></a><em class="kj">和</em><a class="ae jm" href="https://devanywhere.io/" rel="noopener ugc nofollow" target="_blank"><em class="kj">devanywhere . io</em></a><em class="kj">的联合创始人，他教授开发者必备的软件开发技能。他为加密项目组建开发团队并提供建议，为Adobe Systems、</em> <strong class="jp hi"> <em class="kj">、Zumba Fitness、</em> </strong> <em class="kj"> </em> <strong class="jp hi"> <em class="kj">【华尔街日报、</em></strong><em class="kj"/><strong class="jp hi"><em class="kj">【ESPN、</em></strong><em class="kj"/><strong class="jp hi"><em class="kj">BBC、</em> </strong> <em class="kj">以及包括</em> <strong class="jp hi"> <em class="kj"> Usher、弗兰克·奥申、金属乐队在内的顶级录音</em></strong></p><p id="cffb" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">他和世界上最美丽的女人享受着与世隔绝的生活方式。</p></div></div>    
</body>
</html>