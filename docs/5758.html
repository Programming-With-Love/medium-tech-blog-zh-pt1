<html>
<head>
<title>ODI Migration To OCI — Python Based Automated Process</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ODI迁移到OCI —基于Python的自动化流程</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/odi-migration-to-oci-python-based-automated-process-97d282b13e4f?source=collection_archive---------1-----------------------#2021-03-12">https://medium.com/oracledevs/odi-migration-to-oci-python-based-automated-process-97d282b13e4f?source=collection_archive---------1-----------------------#2021-03-12</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="4e97" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ODI代表Oracle Data Integrator，这是一个全面的数据集成平台，涵盖了所有的数据集成需求:从大容量、高性能的批量加载，到事件驱动的涓流集成流程，再到支持SOA的数据服务。</p><p id="12c8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ODI迁移通常意味着将“主存储库”和“工作存储库”从源环境迁移到目标环境。尽管ODI Studio提供了用于导出和导入ODI主存储库和工作存储库的工具，但是只有当源和目标实例在相同的ODI存储库版本上时，它才起作用。这种方法适用于全新的ODI实施，可以将ODI工件从较低的环境迁移到较高的环境，但对于ODI从内部/OCI经典/其他云迁移到OCI的迁移场景，由于ODI版本的差异，我们需要采用数据库存储库迁移方法(如下图所示)。</p><p id="eb6c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这篇博客中，我采用了OCI-Classic上的源ODI实例，但是如果源是在本地或其他云上，也可以使用这种方法。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/fb40097ca7b9822ade19d32f10c0bf89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o-rV3Vn5dKhUQmgQIwrftg.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">ODI “Database Repository Migration” Approach</figcaption></figure><p id="ad1b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="js">注意:-黄色方框是迁移后步骤，将根据客户要求手动执行。</em></p><p id="d324" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">目前，上述流程中提到的所有步骤都需要手动执行，ODI没有任何可用的自动化迁移工具。然而，我已经使用Python为这种ODI迁移方法设计了一个自动化过程。</p><p id="9a22" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="js">为什么要使用这种基于Python的自动化流程？</em>T5】</strong></p><ol class=""><li id="9d12" class="jt ju hh ig b ih ii il im ip jv it jw ix jx jb jy jz ka kb bi translated">您只需要提供源和目标环境的详细信息，所有迁移步骤都会自动执行，您可以在很短的时间内迁移许多环境。</li><li id="fb6e" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">您不需要依赖DBA来迁移存储库数据库模式，只需拥有ODI专业知识就可以完成端到端迁移。</li></ol><p id="3480" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="js">这个基于Python的自动化流程会做什么？</em>T9】</strong></p><ol class=""><li id="d5b7" class="jt ju hh ig b ih ii il im ip jv it jw ix jx jb jy jz ka kb bi translated">它将连接到源ODI实例，并使用Oracle数据泵导出ODI资料档案库。</li><li id="ed9c" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">它会将导出转储文件移动到OCI上的目标ODI实例。</li><li id="6795" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">它将创建所需的表空间，并使用OCI的数据泵将转储文件导入ODI存储库数据库。</li><li id="2c27" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">它将从源ODI资料档案库数据库中获取SCHEMA_VERSION_REGISTRY条目，并插入到OCI上的目标ODI资料档案库数据库中(这是ODI Upgrade Assistant所必需的)。</li><li id="9882" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">它将运行“ODI升级助手”,并将迁移的ODI资料档案库升级到OCI上ODI实例的当前版本。</li></ol><p id="1599" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi kh translated"><span class="l ki kj kk bm kl km kn ko kp di">M</span>T12】移植架构</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kq"><img src="../Images/81c9f3dfe24e60de805633304a284037.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7AAloDNmu8yIt5I_n1djRw.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">ODI Migration Architecture</figcaption></figure><p id="c23b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如迁移架构中所示，这个基于Python的工具可以从本地机器或任何OCI计算机上执行，但是它需要OCI上的ZDM/堡垒/跳转主机，该主机可以连接到源和目标ODI实例。以下是ZDM/堡垒/跳跃主机的连接要求。</p><ol class=""><li id="bc96" class="jt ju hh ig b ih ii il im ip jv it jw ix jx jb jy jz ka kb bi translated">ZDM/堡垒/跳转主机应该能够在OCI和OCI的“Oracle”用户上使用SSH密钥连接源ODI存储库数据库和目标ODI存储库数据库</li><li id="cde4" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">ZDM/堡垒/跳转主机应该能够在源ODI库(OCI-C)和目标ODI库数据库(OCI)的端口1521上建立SQL连接。</li><li id="ef14" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">应该在源ODI资料档案库数据库和目标ODI资料档案库数据库上配置Tnsnames.ora。</li></ol><p id="6d07" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi kh translated"><span class="l ki kj kk bm kl km kn ko kp di">P</span>T2】基于ython的自动化方法</p><p id="ee81" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="js">蟒蛇神器</em> </strong></p><p id="6106" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="js">主脚本</em></p><p id="b1ea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">odirepmigration.py :-此主脚本将使用SSH连接到源ODI资料档案库数据库，创建所需的Oracle目录，导出资料档案库模式，将导出文件移动到目标ODI资料档案库数据库，创建表空间，将转储文件导入目标ODI资料档案库数据库，并将记录插入SCHEMA_VERSION_REGISTRY。</p><p id="afc0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">odiupgrdasst.py :-此主脚本将执行ODI Upgrade Assistant，并将迁移的ODI资料档案库升级到OCI上ODI实例的当前版本。</p><p id="816e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="js">子脚本</em></p><ol class=""><li id="d8f4" class="jt ju hh ig b ih ii il im ip jv it jw ix jx jb jy jz ka kb bi translated">odiconfig.py :-提供源和目标环境所有细节的配置脚本。</li><li id="66a4" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">odrepopreexport . py:-这是一个必备的导出脚本，将创建Oracle目录以进行导出。</li><li id="ba8f" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">odirepoexport.py :-该脚本将运行数据泵导出并生成源ODI存储库的dmp文件。</li><li id="4bc7" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">odiexpdmpmove.py :-该脚本将导出转储文件移动到目标ODI存储库数据库VM。</li><li id="28ba" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">odrepopreimport . py:-这是一个必备的导入脚本，将为导入创建Oracle目录、用户和临时表空间。</li><li id="3951" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">odrepoimport . py:-该脚本将运行数据泵，并将dmp文件导入目标ODI存储库数据库。</li><li id="49d8" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">odiregupdate.py :-此脚本将从源ODI资料档案库数据库中获取SCHEMA_VERSION_REGISTRY条目，并插入到OCI上的目标ODI资料档案库数据库中。</li><li id="3f7d" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">odiupgrdasst . py:-此脚本将运行“ODI升级助手”，并将迁移的ODI资料档案库升级到OCI上ODI实例的当前版本。</li></ol><p id="ab4c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi kh translated"><span class="l ki kj kk bm kl km kn ko kp di"> H </span> <strong class="ig hi"> <em class="js">如何使用这个自动化流程</em> </strong></p><p id="4b54" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="js">先决条件</em> </strong></p><ol class=""><li id="cc02" class="jt ju hh ig b ih ii il im ip jv it jw ix jx jb jy jz ka kb bi translated">应提供OCI的ODI Marketplace/ODI CS，并应用所有推荐的补丁程序。</li><li id="b117" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">Python3应该安装在您计划执行这个过程的机器上。</li><li id="8cd3" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">应该能够访问源和目标ODI资料档案库数据库实例上的目录，这些数据库实例可用于数据泵的导出和导入。</li><li id="e1fe" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">为ZDM/堡垒/跳转主机、源ODI实例和目标ODI实例设置odiconfig.py中的所有参数值。(odiconfig.py本身提供了参数描述)。</li><li id="9195" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">在ODI Upgrade Assistant响应文件中设置以下参数，并将该文件放在ODI server上odiconfig.py中“oci_odi_response_file”参数提供的位置。这些参数是:- ODI.databaseConnectionString、ODI.schemaConnectionString、ODI.schemaUserName、ODI.cleartextSchemaPassword、ODI.cleartextDbaPassword、ODI_SUPER_NAME.string、ODI _ SUPER _ password . cleartext password(示例文件在迁移过程脚本部分提到的GitHub路径中提供)</li></ol><p id="442d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="js">执行</em> </strong></p><ol class=""><li id="c421" class="jt ju hh ig b ih ii il im ip jv it jw ix jx jb jy jz ka kb bi translated">创建一个目录并复制所有Python工件。</li><li id="7d72" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">执行odirepmigration.py(例如python3 odirepmigration.py)。(将在odiconfig.py中指定的位置创建数据泵导出和导入的日志，在出现故障时可以参考这些日志)。</li><li id="c9ad" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">使用与源ODI实例版本相同的ODI Studio打开迁移的“主”存储库，并将存储库连接(JDBC、模式凭据)更改为目标ODI存储库模式，如屏幕截图所示。</li></ol><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kr"><img src="../Images/7a7f26e4e5904162ade3aa305f085b28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pzoNzQbgdSvQo4zZrWoitw.png"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ks"><img src="../Images/1bf6e56ecac5f80a684d5b404134968d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*64WKBgPPezetSa1uufU7EA.png"/></div></div></figure><p id="00e3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">4.执行odiupgrdasst.py(例如python3 odiupgrdasst.py)</p><p id="b3a5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="js">输出</em> </strong></p><ol class=""><li id="7098" class="jt ju hh ig b ih ii il im ip jv it jw ix jx jb jy jz ka kb bi translated">将在OCI的目标ODI资料档案库数据库中创建ODI资料档案库方案</li><li id="b874" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">将通过OCI上的ODI Studio访问目标ODI库，所有ODI对象都将可见。</li></ol><p id="6d9b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi kh translated"><span class="l ki kj kk bm kl km kn ko kp di"> P </span> <strong class="ig hi"> ython ODI迁移脚本</strong></p><p id="3257" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以从这个GitHub资源库下载Python ODI迁移脚本。</p><p id="2ff0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae kt" href="https://github.com/amittyagi27/MYBLOGS/tree/ODI-Migration" rel="noopener ugc nofollow" target="_blank">https://github.com/amittyagi27/MYBLOGS/tree/ODI-Migration</a></p><p id="6b7a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi kh translated"><span class="l ki kj kk bm kl km kn ko kp di"> S </span> <strong class="ig hi">这种基于Python的方法的改进范围</strong></p><p id="477c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这个版本中，有一个手动更新存储库连接的步骤(步骤3)，为了自动化这个步骤，我们需要使用python编程来更新ODI存储库，我将在下一个版本中探索这个选项。</p></div></div>    
</body>
</html>