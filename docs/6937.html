<html>
<head>
<title>How to Automate Medium with NodeJS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用NodeJS自动化媒体</h1>
<blockquote>原文：<a href="https://medium.com/quick-code/how-to-automate-medium-with-nodejs-73c7ceed74bc?source=collection_archive---------1-----------------------#2020-12-21">https://medium.com/quick-code/how-to-automate-medium-with-nodejs-73c7ceed74bc?source=collection_archive---------1-----------------------#2020-12-21</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="eed6" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated"><a class="ae iw" href="https://avendesta.medium.com/puppeteer-is-awesome-96fe4266534f" rel="noopener">这个</a>故事每5分钟自动更新一次</h2></div><p id="6ffa" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated"><a class="ae iw" href="https://avendesta.medium.com/puppeteer-is-awesome-96fe4266534f" rel="noopener">该</a>页面显示纽约市的当前日期和时间。页面会每五分钟更新一次，永远更新(当然，除非Medium出了问题！😂).我设法用<strong class="iz hi">木偶师</strong>做到了。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es jt"><img src="../Images/322c0012df6ccafe4a2f31760a340204.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-gIJRwHceESotpMqvIDncQ.jpeg"/></div></div></figure><p id="674a" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">P <a class="ae iw" href="https://www.npmjs.com/package/puppeteer" rel="noopener ugc nofollow" target="_blank"> uppeteer </a>是Google开发的一个开源库，旨在自动化和简化前端测试和开发。基本上，一个人可以在浏览器上做的任何事情都可以用木偶师自动化。</p><p id="5e7e" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">木偶师可以自动执行的一些操作有:</p><ul class=""><li id="11b5" class="kf kg hh iz b ja jb jd je jg kh jk ki jo kj js kk kl km kn bi translated">生成页面的截图和pdf。</li><li id="cda1" class="kf kg hh iz b ja ko jd kp jg kq jk kr jo ks js kk kl km kn bi translated">自动化表单提交、UI测试、键盘输入</li><li id="acb1" class="kf kg hh iz b ja ko jd kp jg kq jk kr jo ks js kk kl km kn bi translated">更改页面中的HTML元素</li><li id="dff7" class="kf kg hh iz b ja ko jd kp jg kq jk kr jo ks js kk kl km kn bi translated">创建一个最新的自动化测试环境。使用最新的JavaScript和浏览器功能，在最新版本的Chrome中直接运行测试。</li></ul><p id="1997" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated"><em class="kt">还有更多</em>。</p><p id="0ac1" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">希望，这是足够的介绍。现在让我们深入技术层面。</p><h1 id="24c9" class="ku kv hh bd kw kx ky kz la lb lc ld le in lf io lg iq lh ir li it lj iu lk ll bi translated">1.初始设置</h1><p id="de10" class="pw-post-body-paragraph ix iy hh iz b ja lm ii jc jd ln il jf jg lo ji jj jk lp jm jn jo lq jq jr js ha bi translated">与任何其他节点包一样，我们需要确保已经安装了<a class="ae iw" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> nodejs </a>和<a class="ae iw" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank"> npm </a>。如果您使用的是Linux或macOS，使用这两个简单的命令来检查是否一切就绪。</p><pre class="ju jv jw jx fd lr ls lt lu aw lv bi"><span id="13ed" class="lw kv hh ls b fi lx ly l lz ma">&gt; node --version<br/>&gt; npm --version</span></pre><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mb"><img src="../Images/782ece2f4cf242ef2b7c471b2fcfa1a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nJi6tbjlJZ3WGOfCvYwWPQ.png"/></div></div></figure><p id="d862" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">接下来，创建一个项目文件夹/目录，并初始化节点环境。然后用npm安装<a class="ae iw" href="https://www.npmjs.com/package/puppeteer" rel="noopener ugc nofollow" target="_blank">操纵器</a>。</p><pre class="ju jv jw jx fd lr ls lt lu aw lv bi"><span id="d8df" class="lw kv hh ls b fi lx ly l lz ma">&gt; mkdir medium-automate-proj &amp;&amp; cd medium-automate-proj<br/>&gt; npm init --yes<br/>&gt; npm install puppeteer</span></pre><p id="8ef8" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">最后，确保一切都正常运行。让我们试着运行一个来自木偶师文档的样本脚本。脚本转到<code class="du mc md me ls b"><a class="ae iw" href="http://www.example.com%60/" rel="noopener ugc nofollow" target="_blank">www.medium.com</a></code>，然后对页面进行截图并保存为<code class="du mc md me ls b">medium.png</code>。</p><p id="7c8d" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated"><em class="kt">文件:index.js </em></p><pre class="ju jv jw jx fd lr ls lt lu aw lv bi"><span id="6857" class="lw kv hh ls b fi lx ly l lz ma">const puppeteer <strong class="ls hi">=</strong> require('puppeteer');</span><span id="80b2" class="lw kv hh ls b fi mf ly l lz ma">(async () =&gt; {<br/>const browser <strong class="ls hi">=</strong> <strong class="ls hi">await </strong>puppeteer.launch({headless:false});<br/>const page <strong class="ls hi">=</strong> <strong class="ls hi">await</strong> browser.newPage();<br/><strong class="ls hi">await</strong> page.goto('https://medium.com');<br/><strong class="ls hi">await</strong> page.screenshot({path<strong class="ls hi">:</strong> 'medium.png'});<br/><strong class="ls hi">await</strong> browser.close();<br/>})();</span></pre><p id="60e1" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated"><em class="kt">输出:medium.png</em></p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mg"><img src="../Images/e1dd0d5b06d01468ca92e51deecb7f33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gbEDDkgc8dv41tjgOu_aIA.png"/></div></div></figure><h1 id="764f" class="ku kv hh bd kw kx ky kz la lb lc ld le in lf io lg iq lh ir li it lj iu lk ll bi translated">2.自动登录到介质</h1><p id="1c1d" class="pw-post-body-paragraph ix iy hh iz b ja lm ii jc jd ln il jf jg lo ji jj jk lp jm jn jo lq jq jr js ha bi translated">不登录您的媒体帐户，您无法编辑已发布的文章。那么我们如何自动化登录过程呢？</p><p id="d201" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">中提供了不同的登录方式。出于我们的目的，我们将使用“<em class="kt">通过电子邮件</em>登录。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div class="er es mh"><img src="../Images/09b409e08d16fff1df477d0e66ad1868.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*b4ymY1JV3FsqnmYRihUReQ.png"/></div></figure><p id="b7e7" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">输入您的电子邮件地址后，Medium会给您发送一个指向您的电子邮件的特殊链接。任何人都可以使用此链接登录您的帐户。请注意，此链接只能使用<strong class="iz hi">一次</strong>，如果2小时未使用，将会过期。</p><p id="2a1c" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">您的令牌看起来像这样</p><pre class="ju jv jw jx fd lr ls lt lu aw lv bi"><span id="ecb8" class="lw kv hh ls b fi lx ly l lz ma"><em class="kt">https://medium.com/m/callback/email?token=1a2b3c4d5678&amp;operation=login&amp;state=medium</em></span></pre><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mi"><img src="../Images/a8ffa88d0527b6e903767c408d875aff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2tJYyN8l-HckJKsPhdFxzQ.png"/></div></div></figure><p id="3ec2" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">在这个阶段，理解下面的代码应该不难</p><pre class="ju jv jw jx fd lr ls lt lu aw lv bi"><span id="9a72" class="lw kv hh ls b fi lx ly l lz ma">const puppeteer = require('puppeteer');</span><span id="d594" class="lw kv hh ls b fi mf ly l lz ma">(async () =&gt; {<br/>const browser = await puppeteer.launch({headless:false});<br/>const page = await browser.newPage();</span><span id="1ce4" class="lw kv hh ls b fi mf ly l lz ma">// login_link is the link from email<br/>const login_link = "YOUR LOGIN LINK";<br/>await page.goto(login_link);<br/>await page.screenshot({path: 'medium.png'});<br/>await browser.close();<br/>})();</span></pre><p id="42da" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">上面的代码只是转到<code class="du mc md me ls b">www.medium.com</code>并截图保存为<code class="du mc md me ls b">medium.png</code></p><h1 id="fdf3" class="ku kv hh bd kw kx ky kz la lb lc ld le in lf io lg iq lh ir li it lj iu lk ll bi translated">3.编辑已发布的文章</h1><p id="832a" class="pw-post-body-paragraph ix iy hh iz b ja lm ii jc jd ln il jf jg lo ji jj jk lp jm jn jo lq jq jr js ha bi translated">不截图了，来做简单的自动化编辑吧。为了做到这一点，我们首先选择一个已出版的故事。然后尝试手动编辑。</p><p id="eaff" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">当您尝试编辑一个故事时，Medium会将您重定向到类似“https://Medium . com/p/96fe 4266534 f/edit”的URL。这个URL实际上是我为那个故事编辑页面。</p><p id="9f79" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">登录到我们的媒体帐户后，我们希望代码将我们重定向到编辑页面。所以让我们把这两行代码添加到我们的代码中</p><pre class="ju jv jw jx fd lr ls lt lu aw lv bi"><span id="34a2" class="lw kv hh ls b fi lx ly l lz ma">const edit_page = "https://medium.com/p/96fe4266534f/edit";<br/>await page.goto(edit_page);</span></pre><p id="1a74" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">在您的编辑页面上，假设您想要编辑故事中的一行。你是怎么做到的？</p><p id="479c" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">木偶师为我们提供了<code class="du mc md me ls b">$eval()</code>功能来编辑页面上的元素。该函数接受两个参数。第一个是我们HTML页面上的一个元素，第二个是一个告诉Puppeteer如何处理该元素的函数。</p><p id="1a42" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">例如:</p><pre class="ju jv jw jx fd lr ls lt lu aw lv bi"><span id="3c2a" class="lw kv hh ls b fi lx ly l lz ma">await page.waitForSelector("p[name='a46a']");<br/>await page.$eval("p[name='a46a']", e =&gt; e.innerHTML = "WOW");</span></pre><p id="756e" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">这段代码将搜索一个<code class="du mc md me ls b">&lt;p name='a46a' ...&gt;</code>(并等待标签被加载)，然后将标签中的文本改为“WOW”。</p><p id="482f" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">即<code class="du mc md me ls b">&lt;p name='a46a'...&gt;WOW&lt;/p&gt;</code></p><p id="8ab2" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">注意<code class="du mc md me ls b">name='a46a'</code>对你来说不一样。你必须检查你的故事，找出你标签的名字。</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mj"><img src="../Images/01b2f6124aefb689d76bcabd2af3c3d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6hqiu7zY2AezervWQM88Ug.png"/></div></div></figure><p id="08c8" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">现在我们的代码是:</p><pre class="ju jv jw jx fd lr ls lt lu aw lv bi"><span id="b398" class="lw kv hh ls b fi lx ly l lz ma">const puppeteer = require('puppeteer');</span><span id="3956" class="lw kv hh ls b fi mf ly l lz ma">(async () =&gt; {<br/>const browser = await puppeteer.launch({headless:true});<br/>const page = await browser.newPage();</span><span id="57fb" class="lw kv hh ls b fi mf ly l lz ma">// login_link is the link from email<br/>const login_link = "YOUR_LOGIN_LINK_FROM_EMAIL";<br/>await page.goto(login_link);<br/>const edit_page = "https://medium.com/p/96fe4266534f/edit";<br/>await page.goto(edit_page);</span><span id="dd0b" class="lw kv hh ls b fi mf ly l lz ma">await page.waitForSelector(p[name="a46a"]);<br/>await page.$eval("p[name='a46a']", e =&gt;{<br/>   e.innerHTML = "WOW";<br/>})</span><span id="4537" class="lw kv hh ls b fi mf ly l lz ma">//await page.screenshot({path: 'medium.png'});<br/>await browser.close();<br/>})();</span></pre><p id="5bb9" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">但是我们想要的不仅仅是把文本改成'<em class="kt"> WOW </em>'。也许我们想显示当前的时间和日期。好了，不要再说了。让我们使用<code class="du mc md me ls b">new Date</code>对象。</p><pre class="ju jv jw jx fd lr ls lt lu aw lv bi"><span id="9681" class="lw kv hh ls b fi lx ly l lz ma">const puppeteer = require('puppeteer');</span><span id="5f1c" class="lw kv hh ls b fi mf ly l lz ma">(async () =&gt; {<br/>const browser = await puppeteer.launch({headless:true});<br/>const page = await browser.newPage();</span><span id="e9ee" class="lw kv hh ls b fi mf ly l lz ma">// login_link is the link from email<br/>const login_link = "YOUR_LOGIN_LINK_FROM_EMAIL";<br/>await page.goto(login_link);<br/>const edit_page = "https://medium.com/p/YOUR_STORY_ID/edit";<br/>await page.goto(edit_page);</span><span id="defd" class="lw kv hh ls b fi mf ly l lz ma">await page.waitForSelector(p[name="a46a"]);<br/>await page.$eval("p[name='a46a']", e =&gt;{<br/>   e.innerHTML = (new Date()).toLocaleString('en-US');<br/>})</span><span id="cf7a" class="lw kv hh ls b fi mf ly l lz ma">//await page.screenshot({path: 'medium.png'});<br/>await browser.close();<br/>})();</span></pre><h1 id="8d69" class="ku kv hh bd kw kx ky kz la lb lc ld le in lf io lg iq lh ir li it lj iu lk ll bi translated">4.发布编辑过的故事</h1><p id="fd26" class="pw-post-body-paragraph ix iy hh iz b ja lm ii jc jd ln il jf jg lo ji jj jk lp jm jn jo lq jq jr js ha bi translated">编辑完故事后，我们需要重新发布我们的故事，以使效果生效。为此，我们需要点击页面右上角的<code class="du mc md me ls b">save and publish</code>按钮。木偶师为我们提供了<code class="du mc md me ls b">click</code>功能来完成任务。该函数接受一个参数—要单击的HTML元素(按钮)。</p><pre class="ju jv jw jx fd lr ls lt lu aw lv bi"><span id="e59d" class="lw kv hh ls b fi lx ly l lz ma">await page.click("button[data-action='republish']");</span></pre><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es mk"><img src="../Images/6d09a89f5d3160ec89df4c55dff3224f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mFKclI3rP33CB3WoFlsQkQ.png"/></div></div></figure><p id="b579" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">但是这里有一个警告。用户需要等待几秒钟才能点击<code class="du mc md me ls b">Save and publish</code>按钮。这是我们代码的编辑。</p><pre class="ju jv jw jx fd lr ls lt lu aw lv bi"><span id="3f79" class="lw kv hh ls b fi lx ly l lz ma">// wait 6000 miliseconds then click<br/>await page.waitFor(6000);<br/>await page.click('button[data-action="republish"]');</span></pre><h1 id="5641" class="ku kv hh bd kw kx ky kz la lb lc ld le in lf io lg iq lh ir li it lj iu lk ll bi translated">5.前进的道路</h1><p id="c138" class="pw-post-body-paragraph ix iy hh iz b ja lm ii jc jd ln il jf jg lo ji jj jk lp jm jn jo lq jq jr js ha bi translated">我们目前的代码是</p><figure class="ju jv jw jx fd jy er es paragraph-image"><div role="button" tabindex="0" class="jz ka di kb bf kc"><div class="er es ml"><img src="../Images/24004b6d3d90e225e3871ad6fc547877.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9fW80A2Vp3tOrvFd_y_8ug.png"/></div></div></figure><p id="e22b" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">这里有几点需要注意。</p><ul class=""><li id="766a" class="kf kg hh iz b ja jb jd je jg kh jk ki jo kj js kk kl km kn bi translated">首先，<code class="du mc md me ls b">login_link</code>应该在每次运行代码时更新。</li><li id="20a2" class="kf kg hh iz b ja ko jd kp jg kq jk kr jo ks js kk kl km kn bi translated">如果不希望每次运行代码时都启动GUI浏览器，可以编辑<code class="du mc md me ls b">headless</code>属性。<code class="du mc md me ls b">{headless:true}</code>将避免启动GUI (Chromium-browser ),一切都将在幕后完成。</li><li id="0217" class="kf kg hh iz b ja ko jd kp jg kq jk kr jo ks js kk kl km kn bi translated">您的代码只更新一次故事。但是你可以用<code class="du mc md me ls b">setInterval.</code>每分钟或每小时更新一次</li></ul><p id="4e6f" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi mm translated"><span class="l mn mo mp bm mq mr ms mt mu di">到</span>总结，我们能够使用Puppeteer自动编辑一篇中型文章，并且只需要不超过20行代码。上面的代码只是将我们故事的一个段落更改为日期时间，一次。但是那样做一点也不好玩。我想看看你能做什么有创意的事情！！</p><p id="5328" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">另外，你可以在这里找到我的代码<a class="ae iw" href="https://gist.github.com/avendesta/a88286c1fa7d77e177d98384988c0b9d" rel="noopener ugc nofollow" target="_blank"/>。</p></div></div>    
</body>
</html>