<html>
<head>
<title>Recording Video with CameraX VideoCapture API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用CameraX VideoCapture API录制视频</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/recording-video-with-camerax-videocapture-api-a36cfd8a48c8?source=collection_archive---------1-----------------------#2022-02-23">https://medium.com/androiddevelopers/recording-video-with-camerax-videocapture-api-a36cfd8a48c8?source=collection_archive---------1-----------------------#2022-02-23</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/acf44d3a263e482e8b8f38a6d69bbedb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GZmhCFMCrG4L_mOtwSb0zA.png"/></div></div></figure><div class=""/><div class=""><h2 id="9036" class="pw-subtitle-paragraph ip hr hs bd b iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg dx translated">由软件工程师Trevor McGuire和Android DevRel工程师Gerry Fan发布</h2></div><p id="36a8" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">一张图片胜过千言万语，CameraX <code class="du kd ke kf kg b"><a class="ae kh" href="https://developer.android.com/reference/androidx/camera/core/ImageCapture" rel="noopener ugc nofollow" target="_blank">ImageCapture</a> </code>已经让通过Android上的静态图像讲述你的故事变得更加容易。现在有了新的<code class="du kd ke kf kg b">VideoCapture API</code>，CameraX可以帮助您创建数以千计的连续图片来讲述一个更好、更吸引人的故事！<code class="du kd ke kf kg b"><a class="ae kh" href="https://developer.android.com/reference/androidx/camera/video/VideoCapture" rel="noopener ugc nofollow" target="_blank">VideoCapture API</a> </code>极大地简化了视频录制任务，以便您可以专注于尖端应用程序的其他重要部分！</p><p id="3b69" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">在本帖中，我们将介绍新的<code class="du kd ke kf kg b">CameraX VideoCapture API</code>以及如何在您的应用中使用它。</p><h1 id="ec1c" class="ki kj hs bd kk kl km kn ko kp kq kr ks iy kt iz ku jb kv jc kw je kx jf ky kz bi translated">设计为易于使用</h1><p id="68cb" class="pw-post-body-paragraph jh ji hs jj b jk la it jm jn lb iw jp jq lc js jt ju ld jw jx jy le ka kb kc ha bi translated"><code class="du kd ke kf kg b">VideoCapture</code>是一款新的CameraX <code class="du kd ke kf kg b">UseCase</code>，与其他三款预定义的<code class="du kd ke kf kg b"><a class="ae kh" href="https://developer.android.com/training/camerax/preview" rel="noopener ugc nofollow" target="_blank">UseCases</a></code>一起满足您应用中不同的相机需求:</p><figure class="lg lh li lj fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lf"><img src="../Images/973612619ffbf33f42160eb410cb9295.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KZ9yuPgYwqUO8RYx9VEFJA.png"/></div></div></figure><p id="40f3" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">在架构层面，CameraX (1.1.0-beta01及更高版本)中的CameraX VideoCapture API是这样工作的:</p><figure class="lg lh li lj fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lk"><img src="../Images/84d6748265229a508f9c70378ab514e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GVJH6rybbDxm1kbe"/></div></div></figure><ul class=""><li id="1478" class="ll lm hs jj b jk jl jn jo jq ln ju lo jy lp kc lq lr ls lt bi translated"><code class="du kd ke kf kg b">VideoCapture</code>配置摄像机生成视频帧(启用视频稳定等。).</li><li id="d091" class="ll lm hs jj b jk lu jn lv jq lw ju lx jy ly kc lq lr ls lt bi translated"><code class="du kd ke kf kg b">Recorder</code>以适当的比特率对视频帧进行编码和压缩(如果启用了音频录制，还会与音频流同步)。</li><li id="971f" class="ll lm hs jj b jk lu jn lv jq lw ju lx jy ly kc lq lr ls lt bi translated"><code class="du kd ke kf kg b">Recorder</code>将视频和音频流合并成一个流。</li><li id="7ec7" class="ll lm hs jj b jk lu jn lv jq lw ju lx jy ly kc lq lr ls lt bi translated"><code class="du kd ke kf kg b">Recorder</code>将合并后的流写入磁盘上的文件。</li></ul><p id="fffb" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">这很可能类似于您已经熟悉的其他捕获系统，但请注意，它隐藏了使所有这些部分无缝协作所需的复杂逻辑。现在让我们看看如何启动<code class="du kd ke kf kg b">VideoCapture</code>会话。</p><p id="bea1" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">在接口层面，应用在以下两个阶段配置一个<code class="du kd ke kf kg b"><a class="ae kh" href="https://developer.android.com/reference/androidx/camera/video/VideoCapture" rel="noopener ugc nofollow" target="_blank">VideoCapture UseCase</a></code>:</p><ul class=""><li id="03fd" class="ll lm hs jj b jk jl jn jo jq ln ju lo jy lp kc lq lr ls lt bi translated">首先，配置一个输出类型:<code class="du kd ke kf kg b">Recorder</code>是目前使用的类型，但是将来会有更多的类型。</li><li id="1fbf" class="ll lm hs jj b jk lu jn lv jq lw ju lx jy ly kc lq lr ls lt bi translated">其次，创建并配置一个<code class="du kd ke kf kg b">Recording</code>会话:可以从同一个<code class="du kd ke kf kg b">Recorder</code>创建多个记录，但是在任何时候都只能有一个处于活动状态(记录视频)。</li></ul><p id="e55c" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">这里是API配置步骤的高级视图。阴影部分是<code class="du kd ke kf kg b">VideoCapture API</code>的一部分:</p><figure class="lg lh li lj fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lz"><img src="../Images/2acfef4dfdd80fe526a8bd05473bfa0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aPJGbdb-r3QrvPCP"/></div></div></figure><h1 id="ed8f" class="ki kj hs bd kk kl km kn ko kp kq kr ks iy kt iz ku jb kv jc kw je kx jf ky kz bi translated">使用视频捕获API</h1><p id="bcdf" class="pw-post-body-paragraph jh ji hs jj b jk la it jm jn lb iw jp jq lc js jt ju ld jw jx jy le ka kb kc ha bi translated">与其他相机<code class="du kd ke kf kg b">UseCases</code>类似，按照以下通用步骤使用<code class="du kd ke kf kg b">VideoCapture</code>进行录制:</p><ol class=""><li id="f259" class="ll lm hs jj b jk jl jn jo jq ln ju lo jy lp kc ma lr ls lt bi translated">添加CameraX依赖项。</li><li id="f3f8" class="ll lm hs jj b jk lu jn lv jq lw ju lx jy ly kc ma lr ls lt bi translated">创建一个<code class="du kd ke kf kg b">VideoCapture UseCase</code>和一个<code class="du kd ke kf kg b">CameraSelector</code>。</li><li id="746d" class="ll lm hs jj b jk lu jn lv jq lw ju lx jy ly kc ma lr ls lt bi translated">绑定到生命周期所有者。</li><li id="c717" class="ll lm hs jj b jk lu jn lv jq lw ju lx jy ly kc ma lr ls lt bi translated">创建一个<code class="du kd ke kf kg b">Recording</code>会话(特定于<code class="du kd ke kf kg b">VideoCapture UseCase</code>)。</li><li id="9c61" class="ll lm hs jj b jk lu jn lv jq lw ju lx jy ly kc ma lr ls lt bi translated">启动和停止会话(特定于<code class="du kd ke kf kg b">VideoCapture UseCase</code>)。</li></ol><p id="45d2" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">下面的部分有详细信息。</p><h1 id="177d" class="ki kj hs bd kk kl km kn ko kp kq kr ks iy kt iz ku jb kv jc kw je kx jf ky kz bi translated">添加CameraX依赖项</h1><p id="60b9" class="pw-post-body-paragraph jh ji hs jj b jk la it jm jn lb iw jp jq lc js jt ju ld jw jx jy le ka kb kc ha bi translated">首先将CameraX库添加到您的依赖项中。<code class="du kd ke kf kg b">VideoCapture </code>是用<code class="du kd ke kf kg b">camera-video</code>库实现的，但是您还需要其他CameraX库，所以我们建议简单地将它们全部添加进来，这样会更容易。从<code class="du kd ke kf kg b">1.1.0-beta01</code>版本开始，所有的Camerax组件都已经融合到统一的版本中:在<code class="du kd ke kf kg b">1.1.0-beta01</code>及以后的版本中，所有的组件都是同一个版本，包括<code class="du kd ke kf kg b">camera-video</code>。这使得管理依赖关系更加简单。</p><figure class="lg lh li lj fd hj"><div class="bz dy l di"><div class="mb mc l"/></div></figure><h1 id="9f00" class="ki kj hs bd kk kl km kn ko kp kq kr ks iy kt iz ku jb kv jc kw je kx jf ky kz bi translated">创建视频捕获用例</h1><p id="6013" class="pw-post-body-paragraph jh ji hs jj b jk la it jm jn lb iw jp jq lc js jt ju ld jw jx jy le ka kb kc ha bi translated">要创建一个<code class="du kd ke kf kg b">VideoCapture</code>实例，您的应用程序需要知道<code class="du kd ke kf kg b">VideoCapture UseCase</code>的<code class="du kd ke kf kg b">VideoOutput</code>的类型。在此版本中，<code class="du kd ke kf kg b">Recorder</code>执行文件录制，将录制的视频保存到本地存储器，在后面的步骤中进行描述。当构建<code class="du kd ke kf kg b">Recorder</code>对象时，您的应用程序可以使用默认设置或指定一个视频<code class="du kd ke kf kg b">Quality</code>，如下所述。</p><h1 id="9ffb" class="ki kj hs bd kk kl km kn ko kp kq kr ks iy kt iz ku jb kv jc kw je kx jf ky kz bi translated">选择视频分辨率</h1><p id="c422" class="pw-post-body-paragraph jh ji hs jj b jk la it jm jn lb iw jp jq lc js jt ju ld jw jx jy le ka kb kc ha bi translated">视频分辨率在不同的硬件平台上有所不同。为了提供通用API并鼓励平台创新，CameraX实现了这两个促进类:</p><ul class=""><li id="af8e" class="ll lm hs jj b jk jl jn jo jq ln ju lo jy lp kc lq lr ls lt bi translated"><code class="du kd ke kf kg b">Quality</code>，用于指定目标分辨率，包括超高清(<code class="du kd ke kf kg b">UHD</code>)、全高清(<code class="du kd ke kf kg b">FHD</code>)、高清(<code class="du kd ke kf kg b">HD</code>)和标清(<code class="du kd ke kf kg b">SD</code>)。每个分辨率的确切尺寸取决于平台实现。</li><li id="219f" class="ll lm hs jj b jk lu jn lv jq lw ju lx jy ly kc lq lr ls lt bi translated"><code class="du kd ke kf kg b">QualitySelector</code>，用于从预定义的<code class="du kd ke kf kg b">Quality</code>分辨率中定义选择策略。</li></ul><p id="1efc" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">应用程序可以指定几个<code class="du kd ke kf kg b">Quality</code>选项中的一个，带或不带<code class="du kd ke kf kg b">FallbackStrategy</code>，以授权CameraX选择最佳的视频录制分辨率。例如，下面的代码用平台支持的最高分辨率创建了一个<code class="du kd ke kf kg b">QualitySelector</code>，如果最高分辨率不能用请求的<code class="du kd ke kf kg b">UseCase</code>组合或其他原因实现，让CameraX选择任何支持的分辨率。</p><figure class="lg lh li lj fd hj"><div class="bz dy l di"><div class="mb mc l"/></div></figure><p id="0c1c" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">类似地，应用程序也可以用一个有序的<code class="du kd ke kf kg b">Quality</code>选项列表指定一个<code class="du kd ke kf kg b">QualitySelector</code>，外加一个可选的<code class="du kd ke kf kg b">FallbackStrategy</code>。查看<a class="ae kh" href="https://developer.android.com/reference/androidx/camera/video/QualitySelector#fromOrderedList(java.util.List%3Candroidx.camera.video.Quality%3E,%20androidx.camera.video.FallbackStrategy)" rel="noopener ugc nofollow" target="_blank">参考文件</a>了解使用细节。</p><p id="8b5a" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">应用程序还可以使用<code class="du kd ke kf kg b">QualitySelector</code>类，根据<code class="du kd ke kf kg b">Quality</code>和<code class="du kd ke kf kg b">Size</code>查询底层平台解析能力。例如，下面的代码可以提取支持的<code class="du kd ke kf kg b">VideoCapture Qualities</code>及其相应分辨率的列表:</p><figure class="lg lh li lj fd hj"><div class="bz dy l di"><div class="mb mc l"/></div></figure><p id="3e9d" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">请注意，当<code class="du kd ke kf kg b">UseCase</code>组合改变时，或者当需要额外的摄像机功能时，例如<code class="du kd ke kf kg b">Extensions</code>，返回的分辨率可能不被支持。出于这些原因，我们强烈建议在创建您的<code class="du kd ke kf kg b">QualitySelector</code>时设置一个后备策略。</p><h1 id="9c6b" class="ki kj hs bd kk kl km kn ko kp kq kr ks iy kt iz ku jb kv jc kw je kx jf ky kz bi translated">创建一个记录器和一个视频捕获用例实例</h1><p id="6eef" class="pw-post-body-paragraph jh ji hs jj b jk la it jm jn lb iw jp jq lc js jt ju ld jw jx jy le ka kb kc ha bi translated">有了<code class="du kd ke kf kg b">QualitySelector</code>，创建<code class="du kd ke kf kg b">Recorder</code>类型的<code class="du kd ke kf kg b">VideoCapture</code>很简单:</p><figure class="lg lh li lj fd hj"><div class="bz dy l di"><div class="mb mc l"/></div></figure><h1 id="086d" class="ki kj hs bd kk kl km kn ko kp kq kr ks iy kt iz ku jb kv jc kw je kx jf ky kz bi translated">将用例绑定到生命周期摄像机</h1><p id="2b7d" class="pw-post-body-paragraph jh ji hs jj b jk la it jm jn lb iw jp jq lc js jt ju ld jw jx jy le ka kb kc ha bi translated">CameraX提供了代表应用程序管理相机生命周期的接口<code class="du kd ke kf kg b">LifecycleCamera</code>。应用程序通过将一个<code class="du kd ke kf kg b">CameraSelector</code>和用例组合绑定到一个<code class="du kd ke kf kg b">LifecycleOwner</code>来创建一个<code class="du kd ke kf kg b">LifecycleCamera</code>，比如您的活动或片段:</p><figure class="lg lh li lj fd hj"><div class="bz dy l di"><div class="mb mc l"/></div></figure><p id="7017" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">上面的代码片段将一个<code class="du kd ke kf kg b">Preview</code>和<code class="du kd ke kf kg b">VideoCapture</code>的组合，默认的后置摄像头绑定到一个<code class="du kd ke kf kg b"><a class="ae kh" href="https://developer.android.com/jetpack/androidx/releases/fragment" rel="noopener ugc nofollow" target="_blank">AndroidX Fragment</a></code>。当<code class="du kd ke kf kg b">LifecycleOwner</code>停止时，该摄像机将关闭，任何正在进行的记录也将自动停止。</p><p id="2cee" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">您可以进一步配置从<code class="du kd ke kf kg b">ProcessCameraProvider.bindToLifecycle()</code>返回的<code class="du kd ke kf kg b">Camera</code>实例。例如，<code class="du kd ke kf kg b">Torch</code>可在录制前或录制过程中启用，而<code class="du kd ke kf kg b">Zoom</code>控件也可在录制过程中使用。详细说明参见<a class="ae kh" href="https://developer.android.com/training/camerax/configuration#camera-output" rel="noopener ugc nofollow" target="_blank">官方文件</a>。</p><p id="daba" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">注意这个步骤是所有CameraX <code class="du kd ke kf kg b">UseCases</code>(如<code class="du kd ke kf kg b">Preview</code>、<code class="du kd ke kf kg b">ImageCapture</code>和<code class="du kd ke kf kg b">ImageAnalysis</code>)共有的。</p><p id="acca" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">在当前版本中，有效的<code class="du kd ke kf kg b">UseCase</code>组合有:</p><ul class=""><li id="2d36" class="ll lm hs jj b jk jl jn jo jq ln ju lo jy lp kc lq lr ls lt bi translated"><code class="du kd ke kf kg b">VideoCapture</code> + <code class="du kd ke kf kg b">Preview</code> —支持所有摄像设备。</li><li id="a437" class="ll lm hs jj b jk lu jn lv jq lw ju lx jy ly kc lq lr ls lt bi translated"><code class="du kd ke kf kg b">VideoCapture</code> + <code class="du kd ke kf kg b">Preview</code> + <code class="du kd ke kf kg b">ImageCapture</code> —需要<a class="ae kh" href="https://developer.android.com/reference/android/hardware/camera2/CameraMetadata#INFO_SUPPORTED_HARDWARE_LEVEL_LIMITED" rel="noopener ugc nofollow" target="_blank">限定</a>及以上的摄像机2装置。</li><li id="40d2" class="ll lm hs jj b jk lu jn lv jq lw ju lx jy ly kc lq lr ls lt bi translated"><code class="du kd ke kf kg b">VideoCapture</code> + <code class="du kd ke kf kg b">Preview</code> + <code class="du kd ke kf kg b">ImageAnalysis</code> —需要Android N (API Level 24)及以上版本的<a class="ae kh" href="https://developer.android.com/reference/android/hardware/camera2/CameraMetadata#INFO_SUPPORTED_HARDWARE_LEVEL_3" rel="noopener ugc nofollow" target="_blank"> LEVEL_3 </a> Camera2设备。</li></ul><p id="3253" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">你可以根据你的特殊要求建造一个<code class="du kd ke kf kg b">CameraSelector</code>;例如，下面的代码创建一个LEVEL_3摄像机设备<code class="du kd ke kf kg b">CameraSelector</code>(如果平台有一个的话):</p><figure class="lg lh li lj fd hj"><div class="bz dy l di"><div class="mb mc l"/></div></figure><p id="8b99" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">要查看最新支持的组合，请查看文档。</p><h1 id="63c8" class="ki kj hs bd kk kl km kn ko kp kq kr ks iy kt iz ku jb kv jc kw je kx jf ky kz bi translated">创建录制会话</h1><p id="6607" class="pw-post-body-paragraph jh ji hs jj b jk la it jm jn lb iw jp jq lc js jt ju ld jw jx jy le ka kb kc ha bi translated">在<code class="du kd ke kf kg b">VideoCapture UseCase</code>绑定到<code class="du kd ke kf kg b">LifecycleCamera</code>之后，包含的<code class="du kd ke kf kg b">Recorder</code>就可以使用了，从<code class="du kd ke kf kg b">Recorder</code>开始，应用程序可以创建<code class="du kd ke kf kg b">Recording</code>实例来记录视频(和音频)。<code class="du kd ke kf kg b">Recording</code>有两个阶段，用于配置的<code class="du kd ke kf kg b">PendingRecording</code>阶段和用于运行时控制的<strong class="jj ht">活动</strong> <code class="du kd ke kf kg b">Recording</code>阶段:</p><p id="31a8" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">你需要准备一把<code class="du kd ke kf kg b">Recording</code>，包括:</p><ul class=""><li id="dee3" class="ll lm hs jj b jk jl jn jo jq ln ju lo jy lp kc lq lr ls lt bi translated"><code class="du kd ke kf kg b">OutputOptions</code>，可以是<code class="du kd ke kf kg b">Android MediaStore, File</code>，也可以是<code class="du kd ke kf kg b">FileDescriptor</code></li><li id="d253" class="ll lm hs jj b jk lu jn lv jq lw ju lx jy ly kc lq lr ls lt bi translated">响应运行时记录事件的<code class="du kd ke kf kg b">VideoRecordEvent</code>监听器</li></ul><p id="0c5c" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">并且可选地:</p><ul class=""><li id="7539" class="ll lm hs jj b jk jl jn jo jq ln ju lo jy lp kc lq lr ls lt bi translated">在本次录音中包含<code class="du kd ke kf kg b">Audio</code>(录音默认关闭)</li></ul><p id="990e" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">在应用程序调用<code class="du kd ke kf kg b">start()</code>方法启动记录后，<code class="du kd ke kf kg b">PendingRecording</code>立即变成活动的<code class="du kd ke kf kg b">Recording</code>对象。<code class="du kd ke kf kg b">PendingRecording</code>类为配置<code class="du kd ke kf kg b">Recording</code>提供了一个流畅的API，在大多数情况下不需要被应用程序存储。这个版本不支持并发记录，一个应用程序在任何时候都可以有一个活动的<code class="du kd ke kf kg b">Recording</code>。要录制多个剪辑，在当前捕获完成后创建一个新的<code class="du kd ke kf kg b">Recording</code>。</p><p id="a5d2" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">CameraX视频捕获异步运行:应用程序请求(如开始捕获)将在后台执行器上发生；当这些请求确实由CameraX执行时，应用程序会在稍后通过捕获事件得到通知。从这个意义上说，应用程序在调用本文后面描述的<code class="du kd ke kf kg b">PendingRecording.start()</code>方法时，需要创建并传递一个<code class="du kd ke kf kg b">VideoRecordEvent</code>监听器。例如，下面的代码创建了一个简单的监听器来通知用户关于<code class="du kd ke kf kg b">Start</code>和<code class="du kd ke kf kg b">Finalize</code>事件的信息:</p><figure class="lg lh li lj fd hj"><div class="bz dy l di"><div class="mb mc l"/></div></figure><p id="f455" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">CameraX实现了一组丰富的<code class="du kd ke kf kg b"><a class="ae kh" href="https://developer.android.com/reference/androidx/camera/video/VideoRecordEvent" rel="noopener ugc nofollow" target="_blank">VideoRecordEvents</a></code>，包括<code class="du kd ke kf kg b">start() </code>方法和其他我们将在下一节触及的方法。请务必查看<a class="ae kh" href="https://developer.android.com/reference/androidx/camera/video/VideoRecordEvent" rel="noopener ugc nofollow" target="_blank"> API文档</a>以了解完整的事件和描述。作为一般准则，对于您使用的任何运行时控件，您都需要处理其对应的<code class="du kd ke kf kg b">VideoRecordEvent</code>。</p><p id="f42f" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">需要注意的一点是，每个<code class="du kd ke kf kg b">VideoRecordEvent</code>都包含一个<code class="du kd ke kf kg b">RecordingStats</code>对象，指示音频和视频捕获统计信息，比如文件大小和当前录制的持续时间。您的应用程序可以使用此功能向用户显示录制进度。</p><p id="9d78" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">一旦有了一个<code class="du kd ke kf kg b">VideoRecordEvent</code>监听器，创建一个<code class="du kd ke kf kg b">Recording</code>就很简单了。例如，下面的代码创建一个<code class="du kd ke kf kg b">Recording</code>来捕获<a class="ae kh" href="https://developer.android.com/reference/android/provider/MediaStore" rel="noopener ugc nofollow" target="_blank"> Android </a> <code class="du kd ke kf kg b"><a class="ae kh" href="https://developer.android.com/reference/android/provider/MediaStore" rel="noopener ugc nofollow" target="_blank">MediaStore</a></code>中的一个媒体文件:</p><figure class="lg lh li lj fd hj"><div class="bz dy l di"><div class="mb mc l"/></div></figure><p id="3dd5" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">随着<code class="du kd ke kf kg b">Recording</code>的开始，现在让我们看看应用程序下一步可以做什么。</p><h1 id="6978" class="ki kj hs bd kk kl km kn ko kp kq kr ks iy kt iz ku jb kv jc kw je kx jf ky kz bi translated">运行时控制录音</h1><p id="1f67" class="pw-post-body-paragraph jh ji hs jj b jk la it jm jn lb iw jp jq lc js jt ju ld jw jx jy le ka kb kc ha bi translated">对于活动的<code class="du kd ke kf kg b">Recording</code>，应用程序可以采取以下动作:</p><figure class="lg lh li lj fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es md"><img src="../Images/322765c1aab85e9e281a02d7e7f263c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cO5O-y-rPYp8vYuM5dMDbw.png"/></div></div></figure><p id="f9eb" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">所有对CameraX <code class="du kd ke kf kg b">Recording</code>的运行时控制请求，包括<code class="du kd ke kf kg b">PendingRecording.start()</code>，都由<code class="du kd ke kf kg b">CameraX</code>异步执行:</p><ol class=""><li id="98d0" class="ll lm hs jj b jk jl jn jo jq ln ju lo jy lp kc ma lr ls lt bi translated"><code class="du kd ke kf kg b">CameraX</code>将请求排入队列，并立即将控制权返回给应用程序。</li><li id="fbe1" class="ll lm hs jj b jk lu jn lv jq lw ju lx jy ly kc ma lr ls lt bi translated"><code class="du kd ke kf kg b">CameraX</code>当请求完成时，用相应的事件对象通知应用程序。</li></ol><p id="33a1" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">应用程序需要处理其<code class="du kd ke kf kg b">VideoRecordEvent</code>监听器中的事件，以便知道运行时控制请求的结果，并更新应用程序的其他部分，例如更新UI或回放捕获的视频。例如，下面的代码使用一个<code class="du kd ke kf kg b">Inten.ACTION_VIEW</code>来回放录制的视频:</p><figure class="lg lh li lj fd hj"><div class="bz dy l di"><div class="mb mc l"/></div></figure><p id="b0c8" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">这就是使用新的<code class="du kd ke kf kg b">CameraX VideoCapture</code> API录制视频所需的全部内容！</p><h1 id="d973" class="ki kj hs bd kk kl km kn ko kp kq kr ks iy kt iz ku jb kv jc kw je kx jf ky kz bi translated">VideoCapture API的下一步是什么？</h1><p id="5eb0" class="pw-post-body-paragraph jh ji hs jj b jk la it jm jn lb iw jp jq lc js jt ju ld jw jx jy le ka kb kc ha bi translated">与朋友和在社交媒体上分享视频比以往任何时候都更受欢迎，CameraX希望帮助您支持这一增长趋势。我们正在考虑您所要求的新功能，例如缓冲区转换和在同一记录中使用多个摄像机源，并且我们将继续投资于API，以在所有Android上为您提供简单一致的视频捕捉体验。</p><p id="56f1" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">我们认为CameraX项目是我们的设备制造商Android和我们的相机应用程序开发者你们之间的合作。我们邀请您通过创建<a class="ae kh" href="https://github.com/androidx/androidx/tree/androidx-main/camera" rel="noopener ugc nofollow" target="_blank">拉动请求</a>，在<a class="ae kh" href="https://groups.google.com/a/android.com/g/camerax-developers" rel="noopener ugc nofollow" target="_blank"> CameraX开发团队</a>中分享您的反馈和想法，或者在<a class="ae kh" href="https://issuetracker.google.com/issues/new?component=618491&amp;template=1257717" rel="noopener ugc nofollow" target="_blank"> CameraX问题跟踪器</a>中提交问题来加入这个项目。感谢您迄今为止提供的反馈！</p><p id="71f0" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">要了解更多关于CameraX的信息，请访问<a class="ae kh" href="https://developer.android.com/training/camerax" rel="noopener ugc nofollow" target="_blank">CameraX文档</a>、<a class="ae kh" href="https://developer.android.com/codelabs/camerax-getting-started#0" rel="noopener ugc nofollow" target="_blank"> CameraX代码实验室</a>和<a class="ae kh" href="https://github.com/android/camera-samples" rel="noopener ugc nofollow" target="_blank"> github示例</a>；为了跟上CameraX的最新发展，如果您还没有参加CameraX开发者论坛，请参加<a class="ae kh" href="https://groups.google.com/a/android.com/g/camerax-developers" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>