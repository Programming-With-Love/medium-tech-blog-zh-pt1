<html>
<head>
<title>How to add a basic unit test to a Python Flask app using Pytest</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Pytest向Python Flask应用程序添加基本单元测试</h1>
<blockquote>原文：<a href="https://medium.com/globant/how-to-add-a-basic-unit-test-to-a-python-flask-app-using-pytest-79e61da76fc2?source=collection_archive---------0-----------------------#2022-07-21">https://medium.com/globant/how-to-add-a-basic-unit-test-to-a-python-flask-app-using-pytest-79e61da76fc2?source=collection_archive---------0-----------------------#2022-07-21</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/f46eca599c37bdd38069cc15ca75da52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ej1NAqK3YfXJr0wNcHJRLA.jpeg"/></div></div></figure><p id="4ee8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们都同意我们需要给我们的应用程序增加一些测试，对吗？如果你不相信，请看看这篇关于<a class="ae jn" rel="noopener" href="/globant/unit-tests-refactoring-should-i-bother-e7b3e65e19c9">单元测试和重构</a>的文章。在这篇小文章中，我们将向您展示如何使用<a class="ae jn" href="https://docs.pytest.org/en/latest/" rel="noopener ugc nofollow" target="_blank"> Pytest </a>向一个非常基本的<a class="ae jn" href="https://flask.palletsprojects.com/en/1.1.x/" rel="noopener ugc nofollow" target="_blank"> Flask </a>应用程序添加一个单独的测试。</p><p id="83b6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">奖励:</strong>我们还将向您展示如何将Github Actions CI添加到您的repo中。</p><p id="6363" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">假设在我们的home ( <code class="du jo jp jq jr b">/</code>)路线中有一个简单的<code class="du jo jp jq jr b">hello world</code>响应，就像:</p><pre class="js jt ju jv fd jw jr jx jy aw jz bi"><span id="3aee" class="ka kb hh jr b fi kc kd l ke kf">from flask import Flask, jsonify<br/><br/>app = Flask(__name__)<br/><br/><br/>@app.route('/')<br/>def index():<br/>    return jsonify({'hello': 'world'})<br/><br/><br/>if __name__ == '__main__':<br/>    app.run(debug=True)</span></pre><p id="a45d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">因此，让我们首先创建一个<code class="du jo jp jq jr b">tests</code>目录和包含以下内容的<code class="du jo jp jq jr b">conftest.py</code>文件:</p><pre class="js jt ju jv fd jw jr jx jy aw jz bi"><span id="5a75" class="ka kb hh jr b fi kc kd l ke kf">import pytest</span><span id="b884" class="ka kb hh jr b fi kg kd l ke kf">from app import app as flask_app<br/></span><span id="7845" class="ka kb hh jr b fi kg kd l ke kf">@pytest.fixture<br/>def app():<br/>    yield flask_app<br/></span><span id="8a36" class="ka kb hh jr b fi kg kd l ke kf">@pytest.fixture<br/>def client(app):<br/>    return app.test_client()</span></pre><p id="a146" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这个文件将初始化我们的Flask应用程序和所有你需要的<a class="ae jn" href="https://docs.pytest.org/en/latest/fixture.html" rel="noopener ugc nofollow" target="_blank">夹具</a>。</p><p id="fa54" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，Pytest会发现你所有的测试文件，让我们在同一个目录下创建一些带有<code class="du jo jp jq jr b">test_</code>前缀的测试文件。在这种情况下，我们将测试路由是否以预期的hello world dict作出响应。</p><pre class="js jt ju jv fd jw jr jx jy aw jz bi"><span id="0111" class="ka kb hh jr b fi kc kd l ke kf">import json<br/></span><span id="bd99" class="ka kb hh jr b fi kg kd l ke kf">def test_index(app, client):<br/>    res = client.get('/')<br/>    assert res.status_code == 200<br/>    expected = {'hello': 'world'}<br/>    assert expected == json.loads(res.get_data(as_text=True))</span></pre><p id="c145" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">就是这样！现在，您可以用下面的代码行运行测试:</p><pre class="js jt ju jv fd jw jr jx jy aw jz bi"><span id="6b9b" class="ka kb hh jr b fi kc kd l ke kf">python -m pytest</span></pre><p id="f607" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><a class="ae jn" href="https://docs.pytest.org/en/latest/usage.html#calling-pytest-through-python-m-pytest" rel="noopener ugc nofollow" target="_blank">上面的命令看起来不典型的原因是我们需要将目录添加到当前的<code class="du jo jp jq jr b">sys.path</code>中。</a></p><h1 id="5424" class="kh kb hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">奖金</h1><p id="db5e" class="pw-post-body-paragraph ip iq hh ir b is le iu iv iw lf iy iz ja lg jc jd je lh jg jh ji li jk jl jm ha bi translated">要设置<a class="ae jn" href="https://github.com/features/actions" rel="noopener ugc nofollow" target="_blank"> GitHub actions </a>并为您的自述文件获取珍贵的徽章，您只需将以下任务添加到您的YAML文件中</p><pre class="js jt ju jv fd jw jr jx jy aw jz bi"><span id="2500" class="ka kb hh jr b fi kc kd l ke kf">- name: Install Dependencies<br/>      run: |<br/>        python -m pip install --upgrade pip<br/>        pip install -r requirements.txt<br/>    - name: Run Tests<br/>      run: |<br/>        python -m pytest</span></pre><p id="df88" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你想把它作为你的应用程序的参考，你可以在这个<a class="ae jn" href="https://github.com/po5i/flask-mini-tests" rel="noopener ugc nofollow" target="_blank">样本回购</a>中看到完整的<a class="ae jn" href="https://github.com/po5i/flask-mini-tests/blob/master/.github/workflows/flask.yml" rel="noopener ugc nofollow" target="_blank"> YAML文件</a>。</p><p id="19f2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们希望这个小教程在你启动一个新项目或者只是在一个现有的应用程序中添加测试时会有用。</p></div></div>    
</body>
</html>