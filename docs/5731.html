<html>
<head>
<title>Disaster Recovery: Backing Up your Oracle Database with Oracle Database Cloud Backup Service, RMAN, and Object Storage</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">灾难恢复:使用Oracle数据库云备份服务、RMAN和对象存储备份您的Oracle数据库</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/disaster-recovery-backing-up-your-oracle-database-with-oracle-database-cloud-backup-service-rman-e28b86876ad2?source=collection_archive---------2-----------------------#2020-08-06">https://medium.com/oracledevs/disaster-recovery-backing-up-your-oracle-database-with-oracle-database-cloud-backup-service-rman-e28b86876ad2?source=collection_archive---------2-----------------------#2020-08-06</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="85f4" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">如何备份Oracle云数据库</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/183ca9df66b72aed0b1f2c6c1a9728a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*c0E4ha1oWLOvVOh_"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Photo by <a class="ae jm" href="https://unsplash.com/@ikukevk?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Kevin Ku</a> on <a class="ae jm" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="9622" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我们如何为灾难做准备？如果服务器崩溃，技术人员拔掉机器插头，或者流星击中数据中心，企业如何恢复关键数据？在本教程中，我们将演示如何使用Oracle数据库云备份服务、RMAN(恢复管理器)和对象存储来备份Oracle云数据库。在这里，Oracle数据库云备份服务支持与Oracle云基础架构(OCI)的连接和通信，而RMAN则负责将您的Oracle云数据库备份到OCI对象存储。</p><blockquote class="kj kk kl"><p id="7334" class="jn jo km jp b jq jr ii js jt ju il jv kn jx jy jz ko kb kc kd kp kf kg kh ki ha bi translated">注意:有许多不同的方法来备份Oracle云数据库，这代表了一种选择。</p><p id="9d20" class="jn jo km jp b jq jr ii js jt ju il jv kn jx jy jz ko kb kc kd kp kf kg kh ki ha bi translated">注意:鉴于客户环境的多样性以及Oracle云基础架构的不断变化，请半信半疑地接受下面列出的命令及其解释。</p></blockquote><h1 id="44bb" class="kq kr hh bd ks kt ku kv kw kx ky kz la in lb io lc iq ld ir le it lf iu lg lh bi translated">轮廓:</h1><ol class=""><li id="8478" class="li lj hh jp b jq lk jt ll jw lm ka ln ke lo ki lp lq lr ls bi translated">使用Oracle数据库云备份服务的先决条件</li><li id="2dbd" class="li lj hh jp b jq lt jt lu jw lv ka lw ke lx ki lp lq lr ls bi translated">安装Oracle数据库云备份服务的命令完整列表</li><li id="24ee" class="li lj hh jp b jq lt jt lu jw lv ka lw ke lx ki lp lq lr ls bi translated">安装Oracle云备份数据库服务的先决条件</li><li id="4a5e" class="li lj hh jp b jq lt jt lu jw lv ka lw ke lx ki lp lq lr ls bi translated">安装RMAN</li><li id="906a" class="li lj hh jp b jq lt jt lu jw lv ka lw ke lx ki lp lq lr ls bi translated">配置RMAN和备份数据库</li><li id="e647" class="li lj hh jp b jq lt jt lu jw lv ka lw ke lx ki lp lq lr ls bi translated">通过SQL Plus访问数据库表</li><li id="554e" class="li lj hh jp b jq lt jt lu jw lv ka lw ke lx ki lp lq lr ls bi translated">结论</li></ol><h2 id="9a41" class="ly kr hh bd ks lz ma mb kw mc md me la jw mf mg lc ka mh mi le ke mj mk lg ml bi translated">使用Oracle数据库云备份服务的先决条件</h2><p id="74bf" class="pw-post-body-paragraph jn jo hh jp b jq lk ii js jt ll il jv jw mm jy jz ka mn kc kd ke mo kg kh ki ha bi translated">在我们开始之前，<a class="ae jm" href="https://docs.oracle.com/en/cloud/paas/db-backup-cloud/csdbb/installing-oracle-database-cloud-backup-module-oci.html#GUID-8BAB6043-F8BD-44CE-AED3-87B57743AE72" rel="noopener ugc nofollow" target="_blank">这里有一个链接，指向使用Oracle云备份服务所需的所有先决条件</a>。我会尽量为每个先决条件提供尽可能多的上下文，并提供有用的链接和例子。</p><ul class=""><li id="13c1" class="li lj hh jp b jq jr jt ju jw mp ka mq ke mr ki ms lq lr ls bi translated">检查并确保您运行的是<a class="ae jm" href="https://docs.oracle.com/en/cloud/paas/db-backup-cloud/csdbb/supported-databases-and-operating-systems.html" rel="noopener ugc nofollow" target="_blank">正确的数据库版本和操作系统</a>。在本模块中，我使用的是企业极限性能版版本19c。</li><li id="a492" class="li lj hh jp b jq lt jt lu jw lv ka lw ke lx ki ms lq lr ls bi translated"><a class="ae jm" href="https://docs.cloud.oracle.com/en-us/iaas/Content/Object/Concepts/objectstorageoverview.htm" rel="noopener ugc nofollow" target="_blank">在OCI设置对象存储</a>(Oracle云基础架构)。我建议简单地使用控制台，访问对象存储，并创建一个存储桶。</li><li id="879d" class="li lj hh jp b jq lt jt lu jw lv ka lw ke lx ki ms lq lr ls bi translated">在托管数据库的虚拟机中，<a class="ae jm" href="https://docs.cloud.oracle.com/en-us/iaas/Content/API/Concepts/apisigningkey.htm" rel="noopener ugc nofollow" target="_blank">生成密钥</a>以访问OCI。本质上，这就是它的样子。(下面的脚本假设您已经在托管数据库的VM实例中。)<a class="ae jm" href="https://docs.cloud.oracle.com/en-us/iaas/Content/API/Concepts/apisigningkey.htm#three" rel="noopener ugc nofollow" target="_blank">这就是</a>你将密钥上传到OCI的方式，这样你的虚拟机就可以与OCI通信/连接。</li></ul><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mt mu l"/></div></figure><ul class=""><li id="c975" class="li lj hh jp b jq jr jt ju jw mp ka mq ke mr ki ms lq lr ls bi translated">检查您是否有JDK 1.7或更高版本。您可以通过在linux终端中键入“java -version”来检查您拥有的版本。您应该会得到类似如下的输出:</li></ul><pre class="ix iy iz ja fd mv mw mx my aw mz bi"><span id="8ab6" class="ly kr hh mw b fi na nb l nc nd">java version “1.8.0_191”<br/>Java(TM) SE Runtime Environment (build 1.8.0_191-b12)<br/>Java HotSpot(TM) 64-Bit Server VM (build 25.191-b12, mixed mode)</span></pre><ul class=""><li id="3b58" class="li lj hh jp b jq jr jt ju jw mp ka mq ke mr ki ms lq lr ls bi translated">最后，您希望下载最新版本的Oracle云备份服务。<a class="ae jm" href="https://www.oracle.com/database/technologies/oracle-cloud-backup-downloads.html" rel="noopener ugc nofollow" target="_blank">这是下载备份服务的链接</a>。这应该下载一个名为opc_installer的zip文件。解压后，你应该有两个文件夹，opc_installer和oci_installer。这是安装云备份服务的两种方式。在本教程中，我将使用oci版的oci_installer(不是OCI经典版)。</li></ul><blockquote class="kj kk kl"><p id="a8e8" class="jn jo km jp b jq jr ii js jt ju il jv kn jx jy jz ko kb kc kd kp kf kg kh ki ha bi translated">注意:如果您在不同于托管数据库的计算机上下载了Oracle云备份服务，则可以使用此命令将密钥从本地计算机复制到数据库主机实例:</p></blockquote><pre class="ix iy iz ja fd mv mw mx my aw mz bi"><span id="f4b1" class="ly kr hh mw b fi na nb l nc nd">#generic command<br/>cp -i &lt;file/path/to/your/private_key&gt; oci_install.jar opc@&lt;vm_db_ip&gt;:~”. </span><span id="e4c6" class="ly kr hh mw b fi ne nb l nc nd">#example<br/>cp -i /Users/abibi/.ssh/id_rsa oci_install.jar <a class="ae jm" href="mailto:opc@129.146.56.93" rel="noopener ugc nofollow" target="_blank">opc@130.147.26.83</a> :~</span></pre><blockquote class="kj kk kl"><p id="be11" class="jn jo km jp b jq jr ii js jt ju il jv kn jx jy jz ko kb kc kd kp kf kg kh ki ha bi translated">注意:要SSH到托管数据库的虚拟机:</p></blockquote><pre class="ix iy iz ja fd mv mw mx my aw mz bi"><span id="147b" class="ly kr hh mw b fi na nb l nc nd">#example<br/>ssh -i /Users/abibi/.ssh/id_rsa <a class="ae jm" href="mailto:opc@129.146.58.214" rel="noopener ugc nofollow" target="_blank">opc@130.246.38.51</a>1</span></pre><h2 id="235f" class="ly kr hh bd ks lz ma mb kw mc md me la jw mf mg lc ka mh mi le ke mj mk lg ml bi translated">安装Oracle数据库云备份服务的完整命令列表</h2><p id="fade" class="pw-post-body-paragraph jn jo hh jp b jq lk ii js jt ll il jv jw mm jy jz ka mn kc kd ke mo kg kh ki ha bi translated">我这样做有点倒退，在详细说明命令的先决条件之前，提供了安装oci_install.jar文件的命令列表。我这样做是因为我想提供一个良好的命令流。如果您想了解有关这些命令的更多详细信息或遇到问题，只需参考下一节中列出的先决条件。</p><blockquote class="kj kk kl"><p id="66d6" class="jn jo km jp b jq jr ii js jt ju il jv kn jx jy jz ko kb kc kd kp kf kg kh ki ha bi translated">注意:如果你已经执行了上面列出的一些命令，就不需要重复了。</p></blockquote><pre class="ix iy iz ja fd mv mw mx my aw mz bi"><span id="ccb1" class="ly kr hh mw b fi na nb l nc nd">#copy the newly downloaded oci_install.jar file to your database instance, assumes that the oci_install file in your current directory</span><span id="ac89" class="ly kr hh mw b fi ne nb l nc nd">scp -i &lt;private_key&gt; oci_install.jar opc@&lt;db_ip&gt;:~</span><span id="4017" class="ly kr hh mw b fi ne nb l nc nd">#SSH into the instance<br/>ssh -i &lt;private_key&gt; opc@&lt;db_ip&gt;</span><span id="e3b5" class="ly kr hh mw b fi ne nb l nc nd">#maybe log into your Oracle user--see note below<br/>#sudo su - oracle</span><span id="eb29" class="ly kr hh mw b fi ne nb l nc nd">#create directories for installing jar file<br/>mkdir ~/lib<br/>mkdir ~/wallet</span><span id="8704" class="ly kr hh mw b fi ne nb l nc nd">#directory for oci credentials<br/>mkdir .oci</span><span id="e0a8" class="ly kr hh mw b fi ne nb l nc nd">#generating key for OCI<br/>openssl genrsa -out ~/.oci/oci_api_key.pem 2048<br/>openssl rsa -pubout -in ~/.oci/oci_api_key.pem -out ~/.oci/oci_api_key_public.pem</span><span id="c68a" class="ly kr hh mw b fi ne nb l nc nd">#change directory to oci folder<br/>cd .oci</span><span id="4dfa" class="ly kr hh mw b fi ne nb l nc nd">#note: to see hidden files, enter "ls -a"</span><span id="2570" class="ly kr hh mw b fi ne nb l nc nd">#output the key, copy and paste into user ssh key<br/>cat oci_api_key_public.pem</span><span id="7d6d" class="ly kr hh mw b fi ne nb l nc nd">#cd into folder containing oci_install.jar file, should be in opc folder</span><span id="5c51" class="ly kr hh mw b fi ne nb l nc nd">#I assume the opc directory is where the jar file is located<br/>cd opc</span><span id="65a1" class="ly kr hh mw b fi ne nb l nc nd">#generic command to install backup service<br/>java -jar oci_install.jar -host &lt;object storage endpoint&gt; -pvtKeyFile ~/.oci/oci_api_key.pem -pubFingerprint &lt;fingerprint&gt; -tOCID &lt;tOCID&gt; -cOCID &lt;cOCID&gt; -uOCID &lt;uOCID&gt; -walletDir ~/wallet -libDir ~/lib -bucket &lt;bucketname&gt;</span></pre><blockquote class="kj kk kl"><p id="8640" class="jn jo km jp b jq jr ii js jt ju il jv kn jx jy jz ko kb kc kd kp kf kg kh ki ha bi translated">注意:根据您正在安装的数据库版本，您可能需要将文件从数据库实例中的一个目录复制到另一个目录。为此，我建议访问root用户，复制文件，并更改文件的权限:</p></blockquote><pre class="ix iy iz ja fd mv mw mx my aw mz bi"><span id="c470" class="ly kr hh mw b fi na nb l nc nd">#becoming root user<br/>sudo su</span><span id="c758" class="ly kr hh mw b fi ne nb l nc nd">#example of copying wallet credentials from opc to oracle user<br/>cp /home/opc/wallet/cwallet.sso /u01/app/oracle</span><span id="c509" class="ly kr hh mw b fi ne nb l nc nd">#changing permission access for a particular file such that other users can access the file<br/>chmod 775 /home/opc/wallet/cwallet.sso</span></pre><blockquote class="kj kk kl"><p id="4ac6" class="jn jo km jp b jq jr ii js jt ju il jv kn jx jy jz ko kb kc kd kp kf kg kh ki ha bi translated">注意:另一个选项是以实例的Oracle用户身份登录，并运行上面的命令。要做到这一点，您可以在通过SSH连接到实例后输入以下命令:</p></blockquote><pre class="ix iy iz ja fd mv mw mx my aw mz bi"><span id="2540" class="ly kr hh mw b fi na nb l nc nd">sudo su - oracle</span></pre><h2 id="8d84" class="ly kr hh bd ks lz ma mb kw mc md me la jw mf mg lc ka mh mi le ke mj mk lg ml bi translated">安装Oracle云备份数据库服务的先决条件</h2><p id="5d9d" class="pw-post-body-paragraph jn jo hh jp b jq lk ii js jt ll il jv jw mm jy jz ka mn kc kd ke mo kg kh ki ha bi translated">为了执行将安装Oracle云备份数据库服务的jar文件，我们需要从Oracle云租赁中收集一些信息:</p><ul class=""><li id="d8e5" class="li lj hh jp b jq jr jt ju jw mp ka mq ke mr ki ms lq lr ls bi translated">Host:我们的对象存储端点，指示我们创建bucket的区域。下面是有效值的<a class="ae jm" href="https://docs.cloud.oracle.com/en-us/iaas/api/#/en/objectstorage/20160918/" rel="noopener ugc nofollow" target="_blank">列表。</a></li><li id="3ecc" class="li lj hh jp b jq lt jt lu jw lv ka lw ke lx ki ms lq lr ls bi translated">pvtKeyFile:OCI _ API _ key的位置，它是我们之前在数据库虚拟机中生成的。</li><li id="1b6a" class="li lj hh jp b jq lt jt lu jw lv ka lw ke lx ki ms lq lr ls bi translated">pubFingerprint:对应于oci_api_key的指纹。</li><li id="d672" class="li lj hh jp b jq lt jt lu jw lv ka lw ke lx ki ms lq lr ls bi translated">托西德:我们的租赁OCID</li><li id="678f" class="li lj hh jp b jq lt jt lu jw lv ka lw ke lx ki ms lq lr ls bi translated">cOCID:存放对象存储和数据库实例的隔离舱OCID。</li><li id="e287" class="li lj hh jp b jq lt jt lu jw lv ka lw ke lx ki ms lq lr ls bi translated">我们的用户是OCID。</li></ul><blockquote class="kj kk kl"><p id="8fac" class="jn jo km jp b jq jr ii js jt ju il jv kn jx jy jz ko kb kc kd kp kf kg kh ki ha bi translated">注意:OCID是一个唯一的值，它标识OCI的特定组件，如用户、隔离专区、租用和服务。了解更多关于OCIDs，<a class="ae jm" href="https://docs.cloud.oracle.com/en-us/iaas/Content/General/Concepts/identifiers.htm" rel="noopener ugc nofollow" target="_blank">这里</a>。</p></blockquote><ul class=""><li id="db14" class="li lj hh jp b jq jr jt ju jw mp ka mq ke mr ki ms lq lr ls bi translated">walletDir:新创建的钱包的位置。</li></ul><blockquote class="kj kk kl"><p id="e6d6" class="jn jo km jp b jq jr ii js jt ju il jv kn jx jy jz ko kb kc kd kp kf kg kh ki ha bi translated">注意:如果您想在当前工作目录中创建一个文件夹，只需键入以下内容:</p></blockquote><pre class="ix iy iz ja fd mv mw mx my aw mz bi"><span id="73c7" class="ly kr hh mw b fi na nb l nc nd">mkdir ~/wallet</span></pre><ul class=""><li id="550d" class="li lj hh jp b jq jr jt ju jw mp ka mq ke mr ki ms lq lr ls bi translated">libDir:新创建的库的位置。</li></ul><blockquote class="kj kk kl"><p id="80bf" class="jn jo km jp b jq jr ii js jt ju il jv kn jx jy jz ko kb kc kd kp kf kg kh ki ha bi translated">注意:如果您想在当前工作目录中创建一个文件夹，只需键入以下内容。</p></blockquote><pre class="ix iy iz ja fd mv mw mx my aw mz bi"><span id="dd65" class="ly kr hh mw b fi na nb l nc nd">mkdir ~/lib</span></pre><p id="fa2c" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">以下是安装Oracle云备份数据库服务的通用命令:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mt mu l"/></div></figure><p id="63d8" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">以下是一个命令示例:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mt mu l"/></div></figure><blockquote class="kj kk kl"><p id="8256" class="jn jo km jp b jq jr ii js jt ju il jv kn jx jy jz ko kb kc kd kp kf kg kh ki ha bi translated">注意:为了更容易理解，我把命令分开了，但是当在linux中执行这些命令时，它们应该都在一行中，用空格隔开。</p><p id="0389" class="jn jo km jp b jq jr ii js jt ju il jv kn jx jy jz ko kb kc kd kp kf kg kh ki ha bi translated">注意:如果您遇到错误，<a class="ae jm" href="https://docs.oracle.com/en/cloud/paas/db-backup-cloud/csdbb/problems-installing-backup-module.html" rel="noopener ugc nofollow" target="_blank">这里有一些文档</a>有助于诊断一些常见问题。</p></blockquote><p id="009f" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我们可以通过<a class="ae jm" href="https://docs.oracle.com/en/cloud/paas/db-backup-cloud/csdbb/installing-oracle-database-cloud-backup-module-oci.html#GUID-3DB64657-43CD-4100-8326-6EF78C1A7139" rel="noopener ugc nofollow" target="_blank">检查</a>是否创建了wallet和lib文件夹，以及是否看到包含OPC_HOST、OPC_WALLET、OPC_CONTAINER、OPC_COMPARTMENT和OPC_AUTH_SCHEME值的“config”文件来验证jar文件安装成功。</p><blockquote class="kj kk kl"><p id="2735" class="jn jo km jp b jq jr ii js jt ju il jv kn jx jy jz ko kb kc kd kp kf kg kh ki ha bi translated">注意:要打开和读取linux文件，我建议通过键入以下命令来安装nano(假设您位于可以访问配置文件的目录中):</p></blockquote><pre class="ix iy iz ja fd mv mw mx my aw mz bi"><span id="4645" class="ly kr hh mw b fi na nb l nc nd">yum install nano<br/>nano config</span></pre><h2 id="d8ec" class="ly kr hh bd ks lz ma mb kw mc md me la jw mf mg lc ka mh mi le ke mj mk lg ml bi translated">安装RMAN</h2><p id="a7a2" class="pw-post-body-paragraph jn jo hh jp b jq lk ii js jt ll il jv jw mm jy jz ka mn kc kd ke mo kg kh ki ha bi translated">现在，我们已经成功安装了Oracle数据库云备份服务并建立了到OCI的连接，让我们设置RMAN (Oracle Recovery Manager)来管理我们的数据库到对象存储的备份。</p><p id="a129" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">先决条件:</p><ul class=""><li id="67ca" class="li lj hh jp b jq jr jt ju jw mp ka mq ke mr ki ms lq lr ls bi translated">Oracle DB口令，预配Oracle云数据库实例时输入的口令。</li><li id="8b94" class="li lj hh jp b jq lt jt lu jw lv ka lw ke lx ki ms lq lr ls bi translated">RMAN二进制文件的安装位置</li></ul><pre class="ix iy iz ja fd mv mw mx my aw mz bi"><span id="6a1d" class="ly kr hh mw b fi na nb l nc nd">#to find the rman binaries<br/>find / -iname rman</span></pre><blockquote class="kj kk kl"><p id="73f2" class="jn jo km jp b jq jr ii js jt ju il jv kn jx jy jz ko kb kc kd kp kf kg kh ki ha bi translated">注意:如果有权限错误，请输入命令成为根用户</p></blockquote><pre class="ix iy iz ja fd mv mw mx my aw mz bi"><span id="c574" class="ly kr hh mw b fi na nb l nc nd">#example output should look something like this:<br/>/opt/oracle/dcs/log/ary/rman<br/>/tmp/dcsserver/rman<br/>/u01/app/19.0.0.0/grid/bin/rman<br/>/u01/app/oracle/product/19.0.0.0/dbhome_1/bin/rman</span></pre><ul class=""><li id="8e90" class="li lj hh jp b jq jr jt ju jw mp ka mq ke mr ki ms lq lr ls bi translated">将RMAN二进制位置添加到当前路径</li></ul><pre class="ix iy iz ja fd mv mw mx my aw mz bi"><span id="d827" class="ly kr hh mw b fi na nb l nc nd">#generic example of path<br/>export PATH=/u01/app/oracle/product/&lt;insert DB version number&gt;/dbhome_1/bin</span></pre><ul class=""><li id="142e" class="li lj hh jp b jq jr jt ju jw mp ka mq ke mr ki ms lq lr ls bi translated">设置环境变量ORACLE_HOME和ORACLE_SID</li></ul><pre class="ix iy iz ja fd mv mw mx my aw mz bi"><span id="4e0f" class="ly kr hh mw b fi na nb l nc nd">#not really sure how important this, but points to database path<br/>export ORACLE_HOME=/u01/app/oracle/product/19.0.0.0/dbhome_1</span><span id="f4d6" class="ly kr hh mw b fi ne nb l nc nd">#a unique identifier for your database, can find this in the console where you database is provisioned<br/>export ORACLE_SID=DB1111</span><span id="7ce7" class="ly kr hh mw b fi ne nb l nc nd">#outputs all environment variables to confirm<br/>env</span><span id="9a38" class="ly kr hh mw b fi ne nb l nc nd">#outputs config info for the database<br/>srvctl config database -d &lt;database unique identifier&gt;</span></pre><h2 id="b21d" class="ly kr hh bd ks lz ma mb kw mc md me la jw mf mg lc ka mh mi le ke mj mk lg ml bi translated">配置RMAN和备份数据库</h2><p id="1056" class="pw-post-body-paragraph jn jo hh jp b jq lk ii js jt ll il jv jw mm jy jz ka mn kc kd ke mo kg kh ki ha bi translated">现在，我们已经准备好配置RMAN，以便将Oracle云数据库备份到对象存储。只需输入以下命令来设置/授权到数据库的RMAN连接:</p><pre class="ix iy iz ja fd mv mw mx my aw mz bi"><span id="8699" class="ly kr hh mw b fi na nb l nc nd">#generic, TARGET is the command, SYS is the user, oracle is the password, and trgt2 is the database unique identifier <br/>rman TARGET SYS/oracle@trgt2</span><span id="0229" class="ly kr hh mw b fi ne nb l nc nd">#example<br/>rman TARGET SYS/mypassword@DB111_asc3fp</span></pre><p id="6621" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">此时，您应该会在终端底部看到一个挥之不去的“RMAN ”,并在上面显示一条消息，说明您已经成功连接到数据库。</p><blockquote class="kj kk kl"><p id="dddc" class="jn jo km jp b jq jr ii js jt ju il jv kn jx jy jz ko kb kc kd kp kf kg kh ki ha bi translated">注意:<a class="ae jm" href="https://docs.oracle.com/cd/B10501_01/server.920/a96566/rcmcnctg.htm#445078" rel="noopener ugc nofollow" target="_blank">这里有一些额外的文档</a>和<a class="ae jm" href="https://docs.oracle.com/database/121/ADMQS/GUID-7ACCA8DF-537B-4DA9-A7C7-306FBFC9D903.htm#ADMQS12427" rel="noopener ugc nofollow" target="_blank">另一个来源</a>，有助于使用RMAN登录数据库。</p></blockquote><p id="d03f" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">接下来，我们需要在备份数据库之前配置一些RMAN参数:</p><pre class="ix iy iz ja fd mv mw mx my aw mz bi"><span id="36d0" class="ly kr hh mw b fi na nb l nc nd">CONFIGURE CHANNEL DEVICE TYPE 'SBT_TAPE' PARMS 'SBT_LIBRARY=/path/to/libopc.so, SBT_PARMS=(OPC_PFILE=/path/to/config)';</span></pre><p id="c6ac" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">一些附加命令:</p><pre class="ix iy iz ja fd mv mw mx my aw mz bi"><span id="9b94" class="ly kr hh mw b fi na nb l nc nd">CONFIGURE CONTROLFILE AUTOBACKUP ON;<br/>CONFIGURE DEFAULT DEVICE TYPE TO SBT_TAPE;<br/>CONFIGURE BACKUP OPTIMIZATION ON;<br/>CONFIGURE CONTROLFILE AUTOBACKUP FORMAT FOR DEVICE TYPE SBT_TAPE TO '%F';<br/>CONFIGURE ENCRYPTION FOR DATABASE ON;<br/>SET ENCRYPTION IDENTIFIED BY "password" ONLY;</span></pre><blockquote class="kj kk kl"><p id="d21e" class="jn jo km jp b jq jr ii js jt ju il jv kn jx jy jz ko kb kc kd kp kf kg kh ki ha bi translated">注意:关于上面列出的命令和其他选项的细节可以在<a class="ae jm" href="https://docs.oracle.com/cd/B19306_01/backup.102/b14192/setup004.htm" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></blockquote><p id="1a23" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">最后:</p><pre class="ix iy iz ja fd mv mw mx my aw mz bi"><span id="beeb" class="ly kr hh mw b fi na nb l nc nd">BACKUP DATABASE;</span></pre><p id="8860" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">此时，该命令应该会将数据库备份到前面定义的对象存储中。要确认备份成功，只需检查数据库内容和元数据文件以及其他相关对象的对象存储。</p><h2 id="52a4" class="ly kr hh bd ks lz ma mb kw mc md me la jw mf mg lc ka mh mi le ke mj mk lg ml bi translated">通过SQL Plus访问数据库表</h2><p id="f963" class="pw-post-body-paragraph jn jo hh jp b jq lk ii js jt ll il jv jw mm jy jz ka mn kc kd ke mo kg kh ki ha bi translated">顺便说一下，为了连接到数据库表，这里有一个到一些文档的链接。<a class="ae jm" href="https://docs.cloud.oracle.com/en-us/iaas/Content/Database/Tasks/connectingDB.htm" rel="noopener ugc nofollow" target="_blank">关于连接数据库的更多信息</a>。下面是一个通过SQL Plus访问数据库表的命令。</p><pre class="ix iy iz ja fd mv mw mx my aw mz bi"><span id="ea67" class="ly kr hh mw b fi na nb l nc nd">#generic script to access database tables as system user<br/>sqlplus system/@<em class="km">(DESCRIPTION=(CONNECT_TIMEOUT=5)(TRANSPORT_CONNECT_TIMEOUT=3)(RETRY_COUNT=3)(ADDRESS_LIST=(LOAD_BALANCE=on)(ADDRESS=(PROTOCOL=TCP)(HOST=10.0.0.3)(PORT=1521)))(CONNECT_DATA=(SERVICE_NAME=&lt;unique service name defined in database console under database connection&gt;)))</em></span><span id="cfd7" class="ly kr hh mw b fi ne nb l nc nd">#example script to access database tables as system user<br/>sqlplus system/@meee.subnet.vcn.oraclevcn.com:1521/DB1111_asb3bs.subnet.vcn.oraclevcn.com</span></pre><h2 id="d1aa" class="ly kr hh bd ks lz ma mb kw mc md me la jw mf mg lc ka mh mi le ke mj mk lg ml bi translated">结论</h2><p id="bf13" class="pw-post-body-paragraph jn jo hh jp b jq lk ii js jt ll il jv jw mm jy jz ka mn kc kd ke mo kg kh ki ha bi translated">备份Oracle云数据库还有其他方法，为什么选择此选项？我相信这提供了细粒度的控制和设置cron作业来调度备份的能力。在涉及对象存储的情况下，可以将数据库备份到数据库没有运行的另一个区域，以便在灾难期间提供高可用性。尽管如此，在控制台、Oracle OCI Python SDK和许多其他选项中仍有自动备份可用以备份您的数据库。我建议在选择此备份解决方案之前考虑使用情形、RPO、RTO和其他因素，因为实施此解决方案既繁琐又耗时。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><a href="https://www.buymeacoffee.com/arshyasharifian"><div class="er es nf"><img src="../Images/9feb2f59889762b163b5adb2600d8f85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e7fPIkcYCVESpBrkCPdEuQ.png"/></div></a></figure></div></div>    
</body>
</html>