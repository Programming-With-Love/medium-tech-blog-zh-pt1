<html>
<head>
<title>Building reusable Angular NPM packages</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建可重复使用的角度NPM包</h1>
<blockquote>原文：<a href="https://medium.com/compendium/building-reusable-angular-npm-packages-c9930e92d57e?source=collection_archive---------0-----------------------#2018-03-13">https://medium.com/compendium/building-reusable-angular-npm-packages-c9930e92d57e?source=collection_archive---------0-----------------------#2018-03-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="c8a5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首席工程师Magnus Stuhr</p><p id="166f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我的<a class="ae jd" href="https://grensesnittet.computas.com/implementing-your-own-code-sharing-platform/" rel="noopener ugc nofollow" target="_blank">前一篇博客文章</a>认为，编程最重要的原则之一是避免代码重复，而是重用现有的代码来实现相同的功能——它旨在提供关于任何人如何实现自己的代码共享策略的见解。这篇博文将通过展示一个具体的例子来进一步阐述这一点，这个例子将告诉你如何快速地开发和发布你自己的Angular NPM包，这些包可以在你的不同应用中重用。</p><p id="712b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当发布我们自己的NPM包时，我们需要做的第一件事是确保我们有一个NPM注册中心来推送我们的包。如果您想将您的包推送到公共存储库，您不需要设置任何身份验证。但是，如果您有某种类型的私有NPM注册中心，您需要遵循该存储库的身份验证设置说明，因为在本文中我们不会详细讨论这一点。无论哪种方式，你都应该得到一个<em class="jc">。项目根文件夹中的npmrc </em>文件，包含应用程序应该从中检索包的注册表列表:</p><p id="b450" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">。npmrc </strong></p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="f601" class="jn jo hh jj b fi jp jq l jr js">@&lt;your_registry_name&gt;:registry=&lt;your_registry_url&gt;<br/>always-auth=true</span></pre><h1 id="04e4" class="jt jo hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">构建和发布NPM包</h1><p id="001e" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">本节包括如何构建和发布您自己的NPM软件包的分步指南。</p><p id="0611" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，当开发NPM包时，我们通常希望包含对等依赖和开发依赖，而不是常规的直接依赖。对等依赖是包含我们自制的NPM包所需的包，而开发依赖是用于开发我们的NPM包的依赖。我们应该包含库的常规依赖，这些库只在我们的NPM包中需要，并且不需要在包范围之外被引用。完整文档见<a class="ae jd" href="https://docs.npmjs.com/files/package.json#dependencies" rel="noopener ugc nofollow" target="_blank"> package.json依赖关系</a>。</p><h1 id="c5d5" class="jt jo hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">1所有组件和服务都应该有自己的“index.ts”文件</h1><p id="d632" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">当编码NPM包时，确保正确地导出你的代码，以便从外部正确地使用它。我们所有的组件和服务都应该有自己的index.ts文件来导出功能。</p><p id="b466" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> &lt;组件/服务&gt; /index.ts </strong></p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="5af7" class="jn jo hh jj b fi jp jq l jr js">export * from '&lt;your_component/service_name.component/service/module&gt;';</span></pre><p id="ba87" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">示例:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="9fb3" class="jn jo hh jj b fi jp jq l jr js">export * from './dialog-provider.module';<br/>export * from './dialog-provider.service';</span></pre><h1 id="d819" class="jt jo hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">2你的应用程序模块应该有一个“index.ts”文件</h1><p id="012f" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">最后，我们需要创建一个包含所有模块功能的入口点:</p><p id="a974" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">索引. ts </strong></p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="f01f" class="jn jo hh jj b fi jp jq l jr js">export * from '&lt;your_component/service_paths&gt;'; (no file extension declaration after path)</span></pre><p id="29a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">示例:</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="e4e6" class="jn jo hh jj b fi jp jq l jr js">export * from './dialog-provider';</span></pre><h1 id="8714" class="jt jo hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">3为正确的建筑增加吞咽集成</h1><p id="6098" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">当构建我们的包时，我们需要将HTML和CSS内联到Angular组件装饰器中。</p><h1 id="9bf8" class="jt jo hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">3.1安装Gulp插件</h1><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="9ae1" class="jn jo hh jj b fi jp jq l jr js">npm install gulp gulp-inline-ng2-template --save-dev</span></pre><h1 id="c549" class="jt jo hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">3.2添加新的吞咽任务</h1><p id="1d0a" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">如果您的项目结构不同，请确保包含您自己的相对路径，而不是下面的路径。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="a05f" class="jn jo hh jj b fi jp jq l jr js">const inlineNg2Template = require('gulp-inline-ng2-template');<br/>gulp.task('inline-build-templates', () =&gt; {<br/>    return gulp.src(['./src/app/**/*.ts', '!./src/app/**/**.spec.ts', '!./src/app/app.*'])<br/>        .pipe(inlineNg2Template({<br/>            target: 'es5',<br/>            useRelativePaths: true,<br/>         }))<br/>         .pipe(gulp.dest('./build'));<br/>});</span></pre><h1 id="7e71" class="jt jo hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">4在package.json的“脚本”对象中添加构建步骤</h1><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="2815" class="jn jo hh jj b fi jp jq l jr js">"scripts": {<br/>...<br/>	"inline-build-templates": "gulp inline-build-templates",<br/>	"ngc-build": "ngc -p ./tsconfig.lib.json<br/>...<br/>}</span></pre><h1 id="31fe" class="jt jo hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">5安装类型</h1><p id="44db" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">我们需要安装必要的类型，以便软件包构建时没有错误。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="f707" class="jn jo hh jj b fi jp jq l jr js">npm install --save-dev @types/core-js</span></pre><h1 id="1790" class="jt jo hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">5.1确保您的根文件夹中有一个“tsconfig.lib.json”文件</h1><p id="d70b" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated"><strong class="ig hi"> tsconfig.lib.json </strong></p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="3334" class="jn jo hh jj b fi jp jq l jr js">{<br/>  "compilerOptions": {<br/>    "target": "es5",<br/>    "module": "commonjs",<br/>    "moduleResolution": "node",<br/>    "sourceMap": true,<br/>    "emitDecoratorMetadata": true,<br/>    "experimentalDecorators": true,<br/>    "removeComments": false,<br/>    "noImplicitAny": true,<br/>    "declaration": true,<br/>    "outDir": "./lib",<br/>    "stripInternal": true,<br/>    "lib": [<br/>      "es6",<br/>      "dom"<br/>    ]<br/>  },<br/>  "include": [<br/>    "./build/*"<br/>  ],<br/>  "files": [<br/>    "./node_modules/@types/core-js/index.d.ts"<br/>  ],<br/>  "angularCompilerOptions": {<br/>    "skipTemplateCodegen": true<br/>  }<br/>}</span></pre><h1 id="709d" class="jt jo hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">5.2为我们的包添加类型脚本类型和入口点</h1><p id="994e" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated"><strong class="ig hi"> package.json </strong></p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="74e4" class="jn jo hh jj b fi jp jq l jr js">...<br/>"main": "./lib/index.js",<br/>"typings": "./lib/index.d.ts"<br/>...</span></pre><h1 id="a047" class="jt jo hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">6将“lib”文件夹添加到package.json中的“files”数组中</h1><p id="dabf" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">“lib”文件夹是我们构建的包的原始输出。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="1e2e" class="jn jo hh jj b fi jp jq l jr js">"files": [<br/>...<br/>   "lib"<br/>...<br/> ]</span></pre><h1 id="da9d" class="jt jo hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">7添加rimraf集成</h1><p id="5390" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">添加rimraf-integration，以便清除每个构建的现有文件。</p><h1 id="cd7b" class="jt jo hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">7.1安装rimraf</h1><p id="1cfe" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">我们希望确保新版本中没有旧文件。</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="87e7" class="jn jo hh jj b fi jp jq l jr js">npm install rimraf --save-dev</span></pre><h1 id="d2d7" class="jt jo hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">7.2将rimraf build命令添加到package.json文件中的“scripts”对象</h1><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="e3ca" class="jn jo hh jj b fi jp jq l jr js">"scripts": {<br/>    ...<br/>   "cleardown": "rimraf build lib",<br/>   "package": "npm run cleardown &amp;&amp; npm run inline-build-templates &amp;&amp; npm run ngc-build"<br/>    ...<br/>}</span></pre><h1 id="1f49" class="jt jo hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">8构建您的包</h1><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="98bb" class="jn jo hh jj b fi jp jq l jr js">npm run package</span></pre><h1 id="6fd7" class="jt jo hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">9将您的包推送到NPM注册中心</h1><p id="bf28" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">对于您的最终版本(即1.0.0版):</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="19c0" class="jn jo hh jj b fi jp jq l jr js">npm publish</span></pre><p id="0bbd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于测试版(即1 . 0 . 0-1版):</p><pre class="je jf jg jh fd ji jj jk jl aw jm bi"><span id="147b" class="jn jo hh jj b fi jp jq l jr js">npm publish --tag beta</span></pre><p id="2376" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">恭喜你，你的包现在应该已经被推到NPM注册！</p></div><div class="ab cl kv kw go kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ha hb hc hd he"><h1 id="5d07" class="jt jo hh bd ju jv lc jx jy jz ld kb kc kd le kf kg kh lf kj kk kl lg kn ko kp bi translated">马格努斯·斯托尔</h1><p id="0f55" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated"><em class="jc">首席工程师Computas数据科学社区负责人，meetup.com语义技术小组组织者。最重要的是热爱编码。</em></p></div></div>    
</body>
</html>