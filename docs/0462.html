<html>
<head>
<title>What’s new in CameraX</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CameraX的新功能</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/whats-new-in-camerax-fb8568d6ddc?source=collection_archive---------0-----------------------#2020-02-24">https://medium.com/androiddevelopers/whats-new-in-camerax-fb8568d6ddc?source=collection_archive---------0-----------------------#2020-02-24</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/b4cda54482b96f18d9e79cc4e024ff6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LK_RoDHQaheBgMPW"/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx">Illustration by <a class="ae hu" href="https://twitter.com/VPoltrack" rel="noopener ugc nofollow" target="_blank">Virginia Poltrack</a></figcaption></figure><div class=""/><div class=""><h2 id="b187" class="pw-subtitle-paragraph iu hw hx bd b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl dx translated">如何将高级相机控件添加到您的应用程序中？</h2></div><p id="7318" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">与开发者项目工程师<a class="ae hu" rel="noopener" href="/@calren24"> Caren Chang </a>合著</p><p id="fee2" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated"><em class="ki">本文基于2019年</em><em class="ki">Android Dev Summit</em><a class="ae hu" href="https://www.youtube.com/playlist?list=PLWz5rJ2EKKc_xXXubDti2eRnIKU0p7wHd" rel="noopener ugc nofollow" target="_blank"><em class="ki">的一篇演示文稿，更新反映了CameraX API的当前状态。点击此处观看完整演示:</em></a></p><figure class="kj kk kl km fd hj"><div class="bz dy l di"><div class="kn ko l"/></div></figure><p id="8942" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">Camera2 API功能强大，但要充分利用它可能有些困难，尤其是由于不同设备提供的各种相机功能，如HDR或夜间模式。为了解决这个问题，在去年的谷歌I/O上，我们宣布了CameraX，这是一个新的Jetpack库，旨在消除在应用程序中添加相机功能的挫折感。</p><p id="6d85" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">为了帮助开发人员更轻松地将相机功能集成到他们的应用程序中，CameraX团队专注于以下几个关键方面:</p><ul class=""><li id="408a" class="kp kq hx jo b jp jq js jt jv kr jz ks kd kt kh ku kv kw kx bi translated">新功能和API，帮助您在应用中轻松启用更多相机功能。这些现在包括对点击对焦、缩放控制和设备旋转信息的支持。这使得根据镜头处理不同的配置和闪光能力变得更容易——因此你可以查询相机镜头是否具有闪光能力，以及更多。</li><li id="fb87" class="kp kq hx jo b jp ky js kz jv la jz lb kd lc kh ku kv kw kx bi translated">扩大了提供扩展功能的设备范围，因此应用程序可以在更多设备上使用相机功能，如夜间模式或HDR。在撰写本文时，我们可以兼容三星、LG、OPPO、小米和摩托罗拉的手机(从Android 10开始)。</li><li id="b145" class="kp kq hx jo b jp ky js kz jv la jz lb kd lc kh ku kv kw kx bi translated">测试，特别关注API的一致性和稳定性，使用一个拥有52种不同设备型号的实验室，从低端到高端设备，代表超过2亿台活动设备。</li></ul><p id="6c15" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">作为这项工作的一部分，CameraX团队正在与Lens Go团队密切合作，以了解该库在野外的表现。Lens Go是一款应用程序，用户可以将相机对准某个物体，如机场标志，分析图像，并实时给出反馈，如翻译标志。这一合作被证明是测试CameraX库如何工作的好方法，特别是在低端设备上Lens Go的一个关键设备细分市场。此外，随着每月有数百万用户在数百种设备上使用Lens Go，了解CameraX库在Lens Go中的表现对提供更稳定的库有很大帮助。</p><p id="a685" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">Lens Go团队从集成CameraX中看到的最大好处之一是更小的APK尺寸，因为CameraX已经针对性能和尺寸进行了大量优化。他们还能够更快地发布功能，而不必维护自己的摄像头代码。</p><h2 id="791b" class="ld le hx bd lf lg lh li lj lk ll lm ln jv lo lp lq jz lr ls lt kd lu lv lw lx bi translated"><strong class="ak">使用CameraX </strong></h2><p id="0ba1" class="pw-post-body-paragraph jm jn hx jo b jp ly iy jr js lz jb ju jv ma jx jy jz mb kb kc kd mc kf kg kh ha bi translated">CameraX支持最常见相机场景的3种使用情形:</p><ul class=""><li id="258f" class="kp kq hx jo b jp jq js jt jv kr jz ks kd kt kh ku kv kw kx bi translated"><a class="ae hu" href="https://developer.android.com/reference/androidx/camera/core/Preview" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">预览</strong> </a>，使您能够在应用程序中包含一个显示实时相机馈送的取景器。</li><li id="e57f" class="kp kq hx jo b jp ky js kz jv la jz lb kd lc kh ku kv kw kx bi translated"><a class="ae hu" href="https://developer.android.com/reference/androidx/camera/core/ImageAnalysis" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">图像分析</strong> </a>，使您能够访问相机帧数据，以实现对象检测和增强现实等功能。</li><li id="882e" class="kp kq hx jo b jp ky js kz jv la jz lb kd lc kh ku kv kw kx bi translated"><a class="ae hu" href="https://developer.android.com/reference/androidx/camera/core/ImageCapture" rel="noopener ugc nofollow" target="_blank"><strong class="jo hy"/></a>，可以拍摄照片并保存到磁盘。</li></ul><p id="1f3f" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">对于每个用例，都有三个设置步骤:配置、绑定和交互。</p><p id="4499" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">为了说明这是如何工作的，让我们以图像捕捉为例:在你的应用程序中拍照。</p><figure class="kj kk kl km fd hj"><div class="bz dy l di"><div class="md ko l"/></div></figure><p id="8745" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">第一步是创建一个图像捕获用例。您可以指定图片分辨率等参数。但是，您不必担心用户设备上的设置分辨率。如果设备不支持请求的分辨率，CameraX只需回到最接近的分辨率。这意味着配置总是成功的。</p><p id="e658" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">第二步是绑定。需要考虑不同的生命周期，例如活动的生命周期、相机和捕获会话的生命周期。通过将用例绑定到一个<a class="ae hu" href="https://developer.android.com/reference/androidx/lifecycle/LifecycleOwner" rel="noopener ugc nofollow" target="_blank">生命周期所有者</a>，CameraX管理所有的生命周期，因此您不必自己管理状态机。例如，相机在需要时打开，完成后释放。</p><p id="351f" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">最后一步是互动。当你打电话给<code class="du me mf mg mh b">takePicture</code>时，你的应用程序会抓拍一张照片。</p><p id="aaab" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">因此，只需几行代码，您就有了一个图像捕获管道。</p><h2 id="711f" class="ld le hx bd lf lg lh li lj lk ll lm ln jv lo lp lq jz lr ls lt kd lu lv lw lx bi translated"><strong class="ak">高级功能</strong></h2><p id="6072" class="pw-post-body-paragraph jm jn hx jo b jp ly iy jr js lz jb ju jv ma jx jy jz mb kb kc kd mc kf kg kh ha bi translated">为了让您对CameraX提供的高级功能有所了解，让我们来看看相机控制和相机信息功能。这些是高级API，使您能够独立于用例直接控制摄像机。这意味着，如果您有一个预览和图像捕捉用例，当您更新相机状态时，如变焦或闪光灯，它将为所有用例更新它。</p><h2 id="f0b2" class="ld le hx bd lf lg lh li lj lk ll lm ln jv lo lp lq jz lr ls lt kd lu lv lw lx bi translated"><strong class="ak">实现点击聚焦</strong></h2><p id="b202" class="pw-post-body-paragraph jm jn hx jo b jp ly iy jr js lz jb ju jv ma jx jy jz mb kb kc kd mc kf kg kh ha bi translated">CameraX支持自动对焦，但在某些情况下，您可能希望让用户能够手动控制对焦目标。</p><p id="d8b5" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">如果你用Camera2 API做这个，你需要找出UI(取景器)坐标和相机传感器(图像)坐标之间的转换，并指定聚焦区域的大小。</p><p id="8491" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">使用CameraX的方法如下:</p><figure class="kj kk kl km fd hj"><div class="bz dy l di"><div class="md ko l"/></div></figure><p id="b265" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">首先，通过创建一个接受显示器、相机选择器和宽度/高度的<code class="du me mf mg mh b">DisplayOrientedMeteringPointFactory</code>来转换坐标。然后用它把UI坐标中的测光点转换成归一化的传感器坐标。</p><p id="2d9d" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">接下来，创建一个操作。要在同一点对焦和测光，使用<code class="du me mf mg mh b">FocusMeteringAction</code>，经过归一化测光点。</p><p id="ba01" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">最后，你把这个动作交给<code class="du me mf mg mh b">cameraControl</code>，CameraX处理剩下的工作。</p><h2 id="2091" class="ld le hx bd lf lg lh li lj lk ll lm ln jv lo lp lq jz lr ls lt kd lu lv lw lx bi translated"><strong class="ak">实现缩放</strong></h2><p id="eebc" class="pw-post-body-paragraph jm jn hx jo b jp ly iy jr js lz jb ju jv ma jx jy jz mb kb kc kd mc kf kg kh ha bi translated">使用Camera2实现缩放需要您找出变换和裁剪区域。</p><p id="9aa9" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">使用CameraX的方法如下:</p><figure class="kj kk kl km fd hj"><div class="bz dy l di"><div class="md ko l"/></div></figure><p id="026d" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">为了实现缩放，我们需要两个值:基本值和增量值。基本值是当前的缩放比例，增量值是随着用户手指的收缩而改变的比例。</p><p id="d3ab" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">要获得增量值，创建<code class="du me mf mg mh b">ScaleGestureDetector</code>。这个Android对象将触摸事件转换成比例因子。这里的比例因子是增量值。</p><p id="c343" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">然后，从<code class="du me mf mg mh b">cameraInfo</code>获取基值，该API用于获取相机功能的状态，如变焦比、闪光灯可用性和传感器旋转角度。</p><p id="ec0f" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">有了这两个值，现在调用相机控件上的大小和比例。CameraX将计算出裁剪区域，并向相机发送请求，就这样，您实现了缩放。</p><h2 id="6eb5" class="ld le hx bd lf lg lh li lj lk ll lm ln jv lo lp lq jz lr ls lt kd lu lv lw lx bi translated"><strong class="ak">实现缩放滑块</strong></h2><p id="2524" class="pw-post-body-paragraph jm jn hx jo b jp ly iy jr js lz jb ju jv ma jx jy jz mb kb kc kd mc kf kg kh ha bi translated">要实现缩放滑块，我们需要采用不同的缩放方法。原因是，假设你有一台可以从1倍变焦到10倍的相机，从1倍变焦到2倍会缩小50%的视野。然而，从9缩放到10，尽管在滑块上的距离是相同的，但视野缩小了10%。</p><figure class="kj kk kl km fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/88cac9af7ab0605beae3c0a115741e8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-XgKMHJ_5fE0XrnZ"/></div></div></figure><p id="fcac" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">这不是最好的用户体验，这也是CameraX包含<code class="du me mf mg mh b">setLinearZoom</code> API的原因。这个API接受一个滑块值，并进行必要的转换来提供线性缩放。</p><p id="1c21" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">因此，实现缩放滑块只需一行代码:</p><figure class="kj kk kl km fd hj"><div class="bz dy l di"><div class="md ko l"/></div></figure><h2 id="5014" class="ld le hx bd lf lg lh li lj lk ll lm ln jv lo lp lq jz lr ls lt kd lu lv lw lx bi translated"><strong class="ak">了解更多信息</strong></h2><p id="bfe5" class="pw-post-body-paragraph jm jn hx jo b jp ly iy jr js lz jb ju jv ma jx jy jz mb kb kc kd mc kf kg kh ha bi translated">希望这能让你深入了解CameraX API让你将相机功能集成到你的应用程序中是多么容易。要了解更多信息，请查看CameraX文档。在那里，除了完整的API文档，你还会找到一个示例应用和动手<a class="ae hu" href="https://codelabs.developers.google.com/codelabs/camerax-getting-started" rel="noopener ugc nofollow" target="_blank"> codelab </a>。你可能也想读一些我们早期的博客文章:和<a class="ae hu" rel="noopener" href="/androiddevelopers/core-principles-behind-camerax-jetpack-library-8e8380f7604c"> CameraX Jetpack库</a>背后的<a class="ae hu" rel="noopener" href="/androiddevelopers/core-principles-behind-camerax-jetpack-library-8e8380f7604c">核心原则。</a></p><p id="17e0" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">如果您有任何问题或反馈，请发表在<a class="ae hu" href="https://groups.google.com/a/android.com/forum/#!forum/camerax-developers" rel="noopener ugc nofollow" target="_blank"> CameraX Google group </a>上。</p><h2 id="d3c7" class="ld le hx bd lf lg lh li lj lk ll lm ln jv lo lp lq jz lr ls lt kd lu lv lw lx bi translated"><strong class="ak">你怎么看？</strong></h2><p id="ba39" class="pw-post-body-paragraph jm jn hx jo b jp ly iy jr js lz jb ju jv ma jx jy jz mb kb kc kd mc kf kg kh ha bi translated">你对CameraX有什么想法吗？请在下面的评论中告诉我们，或者使用#AndroidStudio发推文，我们将从@AndroidDev回复，在那里我们定期分享关于如何在Android上取得成功的新闻和提示。</p></div></div>    
</body>
</html>