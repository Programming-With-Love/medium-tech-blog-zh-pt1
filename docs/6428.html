<html>
<head>
<title>Working with Arrays in GraphQL Ruby</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在GraphQL Ruby中使用数组</h1>
<blockquote>原文：<a href="https://medium.com/quick-code/working-with-arrays-in-graphql-ruby-d3321fb7a910?source=collection_archive---------0-----------------------#2018-02-11">https://medium.com/quick-code/working-with-arrays-in-graphql-ruby-d3321fb7a910?source=collection_archive---------0-----------------------#2018-02-11</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/cdfdd9c1aee1f97a04c57045b21fb702.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M3GIWyUavRUAZYQj5PcfeA.jpeg"/></div></div></figure><p id="17f0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这是一个关于如何在Ruby的graphQL中用数组mutate查询的快速教程。</p><h2 id="a97c" class="jo jp hh bd jq jr js jt ju jv jw jx jy ja jz ka kb je kc kd ke ji kf kg kh ki bi translated">先决条件</h2><p id="8bf2" class="pw-post-body-paragraph ip iq hh ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated">本教程假设您正在使用gem<a class="ae jn" href="https://github.com/rmosolgo/graphql-ruby" rel="noopener ugc nofollow" target="_blank"><em class="ko">graphQL-ruby</em></a>在<a class="ae jn" href="http://rubyonrails.org/" rel="noopener ugc nofollow" target="_blank"><em class="ko">ruby on rails</em></a><em class="ko"/>中开发graph QL。并且正在使用rails的app内graphiQL客户端或者一个<a class="ae jn" href="https://github.com/graphql/graphiql" rel="noopener ugc nofollow" target="_blank"> <em class="ko">单独的graphiQL客户端</em> </a> <em class="ko">。</em></p><p id="307d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="ko">完整的代码示例在</em> <a class="ae jn" href="https://github.com/moseslucas/working-with-arrays-graphql" rel="noopener ugc nofollow" target="_blank"> <strong class="ir hi"> <em class="ko">这里</em> </strong> </a> <em class="ko">。</em></p></div><div class="ab cl kp kq go kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="ha hb hc hd he"><h1 id="70e0" class="kw jp hh bd jq kx ky kz ju la lb lc jy ld le lf kb lg lh li ke lj lk ll kh lm bi translated">模型</h1><p id="66e4" class="pw-post-body-paragraph ip iq hh ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated"><em class="ko">场景</em>:让我们有一个<strong class="ir hi">帖子</strong>模型和一个<strong class="ir hi">评论</strong>模型，一个<strong class="ir hi">帖子</strong>可以有多个<em class="ko"/><strong class="ir hi">评论</strong>。</p><p id="5a9e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> <em class="ko">岗位型号</em> </strong></p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="160a" class="jo jp hh ls b fi lw lx l ly lz"># models/post.rb</span><span id="00fd" class="jo jp hh ls b fi ma lx l ly lz">field :title, type: String</span><span id="73da" class="jo jp hh ls b fi ma lx l ly lz">has_many :comments</span></pre><p id="8849" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> <em class="ko">评论模式</em> </strong></p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="c589" class="jo jp hh ls b fi lw lx l ly lz"># models/comment.rb</span><span id="0f71" class="jo jp hh ls b fi ma lx l ly lz">field :content, type: String</span><span id="097a" class="jo jp hh ls b fi ma lx l ly lz">belongs_to :post</span></pre><h1 id="1bd2" class="kw jp hh bd jq kx mb kz ju la mc lc jy ld md lf kb lg me li ke lj mf ll kh lm bi translated">GraphQL类型</h1><p id="a98b" class="pw-post-body-paragraph ip iq hh ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated"><strong class="ir hi"> <em class="ko">岗位类型</em> </strong></p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="b1b1" class="jo jp hh ls b fi lw lx l ly lz"># app/graphql/types/post_type.rb</span><span id="e85a" class="jo jp hh ls b fi ma lx l ly lz">Types::PostType = GraphQL::ObjectType.define do<br/>  name "PostType"<br/></span><span id="320c" class="jo jp hh ls b fi ma lx l ly lz">  field :id, !types.ID<br/>  field :title, types.String  <br/>end</span></pre><blockquote class="mg mh mi"><p id="ba53" class="ip iq ko ir b is it iu iv iw ix iy iz mj jb jc jd mk jf jg jh ml jj jk jl jm ha bi translated"><code class="du mm mn mo ls b">PostType</code>将返回一个<code class="du mm mn mo ls b">id</code>和<code class="du mm mn mo ls b">title</code>字段。</p></blockquote><p id="213a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> <em class="ko">注释类型</em> </strong></p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="e1c9" class="jo jp hh ls b fi lw lx l ly lz"># app/graphql/types/comment_type.rb</span><span id="0aa0" class="jo jp hh ls b fi ma lx l ly lz">Types::CommentType = GraphQL::ObjectType.define do<br/>  name "CommentType"<br/></span><span id="893e" class="jo jp hh ls b fi ma lx l ly lz">  field :id, !types.ID<br/>  field :content, types.String<br/>  <br/>end</span></pre><blockquote class="mg mh mi"><p id="ea81" class="ip iq ko ir b is it iu iv iw ix iy iz mj jb jc jd mk jf jg jh ml jj jk jl jm ha bi translated"><code class="du mm mn mo ls b">CommentType</code>将返回一个<code class="du mm mn mo ls b">id</code>和<code class="du mm mn mo ls b">content</code>字段。</p></blockquote></div><div class="ab cl kp kq go kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="ha hb hc hd he"><h1 id="faeb" class="kw jp hh bd jq kx ky kz ju la lb lc jy ld le lf kb lg lh li ke lj lk ll kh lm bi translated">询问</h1><p id="83c8" class="pw-post-body-paragraph ip iq hh ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated">让我们有一个返回所有<code class="du mm mn mo ls b">Post</code>记录的graphQL查询。</p><p id="9809" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><code class="du mm mn mo ls b"><strong class="ir hi"><em class="ko">allPosts</em></strong></code>查询<strong class="ir hi">查询查询</strong></p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="40cc" class="jo jp hh ls b fi lw lx l ly lz"># app/graphql/types/query_type.rb<br/></span><span id="4849" class="jo jp hh ls b fi ma lx l ly lz">Types::QueryType = GraphQL::ObjectType.define do<br/>  name "Query"</span><span id="fec6" class="jo jp hh ls b fi ma lx l ly lz">field :allPosts, types[Types::PostType] do<br/>    resolve -&gt; (obj, args, ctx) {<br/>      Post.all<br/>    }<br/>end</span></pre><p id="8300" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">上面有一个返回散列数组的查询<code class="du mm mn mo ls b">Post.all</code>，将<code class="du mm mn mo ls b">types[Types::PostType]</code>声明为返回类型。这意味着，我们将返回一个<strong class="ir hi"> ObjectType </strong> <code class="du mm mn mo ls b">PostType</code>的<strong class="ir hi">列表</strong>。Ruby仍然是十大编程语言之一。因此，强烈推荐<a class="ae jn" href="https://coursesity.com/free-tutorials-learn/ruby" rel="noopener ugc nofollow" target="_blank">在2021年学习Ruby编程</a>。</p><blockquote class="mg mh mi"><p id="1597" class="ip iq ko ir b is it iu iv iw ix iy iz mj jb jc jd mk jf jg jh ml jj jk jl jm ha bi translated">将一个<strong class="ir hi">对象类型</strong>放入<code class="du mm mn mo ls b">types[]</code>中，将其作为一个列表。</p></blockquote><p id="08c5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">因此，如果我们运行我们的查询:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="650c" class="jo jp hh ls b fi lw lx l ly lz">query {<br/>  allPosts {<br/>    id,<br/>    title<br/>  }<br/>}</span></pre><p id="a445" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">它将返回一个包含<code class="du mm mn mo ls b">id</code>和<code class="du mm mn mo ls b">title</code>字段的<code class="du mm mn mo ls b">Post</code>记录列表。</p><p id="3075" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> <em class="ko">样本查询结果</em> </strong></p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="0d51" class="jo jp hh ls b fi lw lx l ly lz">{<br/>  "data": {<br/>    "allPosts": [  <br/>      {<br/>        "id": 1,<br/>        "title": "Sample Post"<br/>      },<br/>      {<br/>        "id": 2,<br/>        "title": "Another Post"<br/>      },<br/>      {<br/>        "id": 3,<br/>        "title": "Isa pang Post"<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><h1 id="a699" class="kw jp hh bd jq kx mb kz ju la mc lc jy ld md lf kb lg me li ke lj mf ll kh lm bi translated">用数组查询</h1><p id="8075" class="pw-post-body-paragraph ip iq hh ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated">上面的<code class="du mm mn mo ls b">allPosts</code>查询只返回<code class="du mm mn mo ls b">id</code>和<code class="du mm mn mo ls b">title</code>字段。</p><p id="eba3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，我们想根据<code class="du mm mn mo ls b">Post</code>显示<strong class="ir hi">评论</strong>记录。由于<code class="du mm mn mo ls b">Post</code>模型与<code class="du mm mn mo ls b">Comment</code>模型相关联，我们应该能够通过向<code class="du mm mn mo ls b">PostType</code>添加一个新的<code class="du mm mn mo ls b">comments</code>字段来实现这一点。但是没有用标量类型<em class="ko">(例如</em> <code class="du mm mn mo ls b"><em class="ko">String</em></code> <em class="ko">，</em> <code class="du mm mn mo ls b"><em class="ko">Float</em></code> <em class="ko">，</em> <code class="du mm mn mo ls b"><em class="ko">Integer</em></code> <em class="ko">)来定义它，</em>我们将类型定义为<code class="du mm mn mo ls b">CommentType</code>。</p><p id="1eb3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">向<code class="du mm mn mo ls b">PostType</code>添加一个新的<code class="du mm mn mo ls b">comments</code>字段:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="9ec8" class="jo jp hh ls b fi lw lx l ly lz">field :comments, types[Types::CommentType]</span></pre><blockquote class="mg mh mi"><p id="2505" class="ip iq ko ir b is it iu iv iw ix iy iz mj jb jc jd mk jf jg jh ml jj jk jl jm ha bi translated"><strong class="ir hi">重要</strong>:字段名称应该是关联模型的名称。在我们的<code class="du mm mn mo ls b">Post</code>模型中，它具有关联:<code class="du mm mn mo ls b">has_many :comments</code>因此，我们必须将我们的字段命名为<code class="du mm mn mo ls b">:comments</code>。</p></blockquote><p id="30ac" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们的<code class="du mm mn mo ls b">PostType</code>现在应该是这样的:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="2b48" class="jo jp hh ls b fi lw lx l ly lz"># app/graphql/types/post_type.rb</span><span id="e165" class="jo jp hh ls b fi ma lx l ly lz">Types::PostType = GraphQL::ObjectType.define do<br/>  name "PostType"<br/></span><span id="598c" class="jo jp hh ls b fi ma lx l ly lz">  field :id, !types.ID<br/>  field :title, types.String<br/>  field :comments, types[Types::CommentType]<br/>  <br/>end</span></pre><p id="e032" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><code class="du mm mn mo ls b">PostType</code>现在将返回一个<code class="du mm mn mo ls b">id</code>、<code class="du mm mn mo ls b">title</code>和一个<code class="du mm mn mo ls b">comments</code>的列表。</p><p id="8d25" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">就是这样！测试我们的查询:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="2107" class="jo jp hh ls b fi lw lx l ly lz">query {<br/>  allPosts {<br/>    id,<br/>    title,<br/>    comments {<br/>      id,<br/>      content<br/>    }<br/>  }<br/>}</span></pre><p id="e9b5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> <em class="ko">样本查询结果</em> </strong></p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="4c45" class="jo jp hh ls b fi lw lx l ly lz">{<br/>  "data": {<br/>    "allPosts": [<br/>      {<br/>        "id": 1,<br/>        "title": "Sample Post",<br/>        "comments": [<br/>          {<br/>            "id": 1,<br/>            "content": "GraphQL is GraphCool"<br/>          }<br/>        ]<br/>      },<br/>      {<br/>        "id": 2,<br/>        "title": "Another Post",<br/>        "comments": [<br/>          {<br/>            "id": 2,<br/>            "content": "GraphQL Ruby"<br/>          },<br/>          {<br/>            "id": 3,<br/>            "content": "Ruby on Rails"<br/>          },<br/>          {<br/>            "id": 4,<br/>            "content": "GraphiQL"<br/>          }<br/>        ]<br/>      },<br/>      {<br/>        "id": 3,<br/>        "title": "Isa pang Post"<br/>      }<br/>    ]<br/>  }<br/>}</span></pre><figure class="ln lo lp lq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mp"><img src="../Images/a88d50d0169a1a8db9f545e98c975194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MkFjGXcr7L1zt4hHmPjk_A.png"/></div></div></figure><h1 id="27cf" class="kw jp hh bd jq kx mb kz ju la mc lc jy ld md lf kb lg me li ke lj mf ll kh lm bi translated">变化</h1><p id="c5bb" class="pw-post-body-paragraph ip iq hh ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated">让我们为<code class="du mm mn mo ls b">Post</code>设计一个graphQL变体，它接受一个<code class="du mm mn mo ls b">String</code>的<code class="du mm mn mo ls b">title</code>参数。</p><p id="58e1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><code class="du mm mn mo ls b"><strong class="ir hi"><em class="ko">addPost</em></strong></code> <strong class="ir hi"> <em class="ko">突变</em> </strong></p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="11e8" class="jo jp hh ls b fi lw lx l ly lz"># app/graphql/types/mutation_type.rb</span><span id="a53c" class="jo jp hh ls b fi ma lx l ly lz">Types::MutationType = GraphQL::ObjectType.define do <br/>  name "Mutation"</span><span id="7870" class="jo jp hh ls b fi ma lx l ly lz">  <br/>  field :addPost, Types::PostType do<br/>    argument :title, types.String</span><span id="5391" class="jo jp hh ls b fi ma lx l ly lz">    resolve -&gt; (obj, args, ctx) {   <br/>      Post.create title: args[:title]<br/>    }<br/>  end<br/>end</span></pre><p id="5373" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">运行我们的突变:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="3fa7" class="jo jp hh ls b fi lw lx l ly lz">mutation {<br/>  addPost (title: "New Post"){<br/>    id,<br/>    title,<br/>    comments{<br/>      id,<br/>      content<br/>    }<br/>  }<br/>}</span></pre><p id="9e7d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> <em class="ko">样本突变结果:</em> </strong></p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="8069" class="jo jp hh ls b fi lw lx l ly lz">{<br/>  "data": {<br/>    "addPost": {<br/>      "id": "5",<br/>      "title": "New Post",<br/>      "comments": []<br/>    }<br/>  }<br/>}</span></pre><p id="4bd8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">上面的<code class="du mm mn mo ls b">addPost</code>突变只保存<code class="du mm mn mo ls b">title</code>到<code class="du mm mn mo ls b">Post</code>记录。但是如果我们想同时保存很多评论到<code class="du mm mn mo ls b">Post</code>呢？</p><h1 id="a7ed" class="kw jp hh bd jq kx mb kz ju la mc lc jy ld md lf kb lg me li ke lj mf ll kh lm bi translated">数组变异</h1><p id="3016" class="pw-post-body-paragraph ip iq hh ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated">与我们之前的查询类似，我们可以向<code class="du mm mn mo ls b">addPost</code>添加一个新的<code class="du mm mn mo ls b">comments</code> <strong class="ir hi">参数</strong>。但是这一次，我们不能给它分配一个<strong class="ir hi">对象类型</strong>。我们需要的是一个接受注释参数的对象类型。我们需要的是一个<a class="ae jn" href="http://www.rubydoc.info/github/rmosolgo/graphql-ruby/GraphQL/InputObjectType" rel="noopener ugc nofollow" target="_blank"><strong class="ir hi">input object type</strong></a><strong class="ir hi">。</strong></p><p id="81df" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在<code class="du mm mn mo ls b">app/graphql</code>中创建一个名为<code class="du mm mn mo ls b">inputs</code>的新文件夹/目录，然后添加一个新文件<code class="du mm mn mo ls b">comment_input.rb</code>。</p><figure class="ln lo lp lq fd ii er es paragraph-image"><div class="er es mq"><img src="../Images/afb4862061bf01baf5e344c3603c914b.png" data-original-src="https://miro.medium.com/v2/resize:fit:426/format:webp/1*ElQdrAa-1-jDEbG1BJamig.png"/></div></figure><p id="23cb" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><code class="du mm mn mo ls b"><strong class="ir hi"><em class="ko">comment_input</em></strong></code> <strong class="ir hi"> <em class="ko">突变</em> </strong></p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="9fb0" class="jo jp hh ls b fi lw lx l ly lz"># app/graphql/inputs/comment_input.rb</span><span id="53e2" class="jo jp hh ls b fi ma lx l ly lz">Inputs::CommentInput = GraphQL::InputObjectType.define do<br/>  name "CommentInput"</span><span id="f753" class="jo jp hh ls b fi ma lx l ly lz">  argument :content, !types.String<br/>end</span></pre><p id="58d2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在我们可以将这个<a class="ae jn" href="http://www.rubydoc.info/github/rmosolgo/graphql-ruby/GraphQL/InputObjectType" rel="noopener ugc nofollow" target="_blank"><strong class="ir hi">input object type</strong></a>赋值给一个参数。</p><p id="0387" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> <em class="ko">添加</em> </strong> <code class="du mm mn mo ls b"><strong class="ir hi"><em class="ko">comments</em></strong></code> <strong class="ir hi"> <em class="ko">自变量到</em> </strong> <code class="du mm mn mo ls b"><strong class="ir hi"><em class="ko">addPost</em></strong></code> <strong class="ir hi"> <em class="ko">突变</em> </strong></p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="be56" class="jo jp hh ls b fi lw lx l ly lz"># app/graphql/types/mutation_type.rb</span><span id="3412" class="jo jp hh ls b fi ma lx l ly lz">Types::MutationType = GraphQL::ObjectType.define do <br/>  name "Mutation"</span><span id="45dd" class="jo jp hh ls b fi ma lx l ly lz">    field :addPost, Types::PostType do</span><span id="b610" class="jo jp hh ls b fi ma lx l ly lz">      argument :title, types.String<br/>      argument :comments, types[Inputs::CommentInput]</span><span id="56a5" class="jo jp hh ls b fi ma lx l ly lz">      resolve -&gt; (obj, args, ctx) {   <br/>        Post.create title: args[:title]<br/>      }<br/>  end<br/>end</span></pre><p id="a858" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在我们的<code class="du mm mn mo ls b">addPost</code>将接受一个<code class="du mm mn mo ls b">comment_input</code>数组，其中每个<code class="du mm mn mo ls b">comment_input</code>都有一个<code class="du mm mn mo ls b">content</code>参数。</p><p id="88f3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> <em class="ko">重构</em> </strong> <code class="du mm mn mo ls b"><strong class="ir hi"><em class="ko">addPost</em></strong></code> <strong class="ir hi"> <em class="ko">保存评论:</em> </strong></p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="2a98" class="jo jp hh ls b fi lw lx l ly lz">Types::MutationType = GraphQL::ObjectType.define do <br/>  name "Mutation"<br/>  <br/>  field :addPost, Types::PostType do</span><span id="26aa" class="jo jp hh ls b fi ma lx l ly lz">    argument :title, types.String   <br/>    argument :comments, types[Inputs::CommentInput]</span><span id="831f" class="jo jp hh ls b fi ma lx l ly lz">    resolve -&gt; (obj, args, ctx) {   <br/>      post = Post.create title: args[:title] <br/><br/>      # if comments arguments are not empty, save it to post </span><span id="f08b" class="jo jp hh ls b fi ma lx l ly lz">      if args[:comments]<br/>        args[:comments].each do |comment|<br/>          post.comments.create content: comment.content<br/>        end<br/>      end</span><span id="f6f0" class="jo jp hh ls b fi ma lx l ly lz">      #returns post <br/>      post<br/>    }<br/>  end<br/>end </span></pre><p id="eb2f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，让我们试试我们的突变:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="0829" class="jo jp hh ls b fi lw lx l ly lz">mutation {<br/>  addPost(<br/>    title:"Mutating Post",<br/>    comments: [<br/>      {content:"Sun shiny day"},<br/>      {content:"Chocolate Shake"},<br/>      {content:"The Beatles"}<br/>    ]<br/>  ){<br/>    id,<br/>    title,<br/>    comments{<br/>      id,<br/>      content<br/>    }<br/>  }<br/>}</span></pre><p id="c2bd" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> <em class="ko">结果:</em> </strong></p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="21d2" class="jo jp hh ls b fi lw lx l ly lz">{<br/>  "data": {<br/>    "addPost": {<br/>      "id": "6",<br/>      "title": "Mutating Post",<br/>      "comments": [<br/>        {<br/>          "id": "8",<br/>          "content": "Sun shiny day"<br/>        },<br/>        {<br/>          "id": "9",<br/>          "content": "Chocolate Shake"<br/>        },<br/>        {<br/>          "id": "10",<br/>          "content": "The Beatles"<br/>        }<br/>      ]<br/>    }<br/>  }<br/>}</span></pre><figure class="ln lo lp lq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mr"><img src="../Images/a255986c3cdf86bcc587b1445c5df204.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FZjyBif4FV4w_BRuCYAR3Q.png"/></div></div></figure><h1 id="5a8c" class="kw jp hh bd jq kx mb kz ju la mc lc jy ld md lf kb lg me li ke lj mf ll kh lm bi translated"><strong class="ak">总结</strong></h1><ol class=""><li id="61ef" class="ms mt hh ir b is kj iw kk ja mu je mv ji mw jm mx my mz na bi translated">查询数组-使用<strong class="ir hi">对象类型</strong>作为字段类型。然后将其放入<code class="du mm mn mo ls b">types[]</code>中声明为列表。例:<code class="du mm mn mo ls b">field :comments, types[Types::CommentType]</code>。</li><li id="8e34" class="ms mt hh ir b is nb iw nc ja nd je ne ji nf jm mx my mz na bi translated">变异数组-使用<strong class="ir hi"> InputObjectType </strong>作为参数类型。然后将其封装在<code class="du mm mn mo ls b">types[]</code>中，作为列表。如<code class="du mm mn mo ls b">argument :comments, types[Inputs::CommentInput]</code>。</li></ol><figure class="ln lo lp lq fd ii er es paragraph-image"><div class="er es ng"><img src="../Images/9c6ea2d4fc76418637f037229e19c6cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*YdlkQdwMHHHGZWc0uAdQpw.gif"/></div></figure><blockquote class="nh"><p id="2e39" class="ni nj hh bd nk nl nm nn no np nq jm dx translated">就是这样！幸福的graphQL。谢谢！\m/</p></blockquote></div></div>    
</body>
</html>