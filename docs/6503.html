<html>
<head>
<title>Creating Custom Directives in Akka HTTP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">åœ¨Akka HTTPä¸­åˆ›å»ºè‡ªå®šä¹‰æŒ‡ä»¤</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/quick-code/creating-custom-directives-in-akka-http-f179755ef60?source=collection_archive---------0-----------------------#2018-08-23">https://medium.com/quick-code/creating-custom-directives-in-akka-http-f179755ef60?source=collection_archive---------0-----------------------#2018-08-23</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="4099" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jc">æ•´ç†å¥½ä½ çš„è·¯çº¿ã€‚</em></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/5d72fc7ff78e5d82e6e57f5b8a29bd06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HL-kNNC1XPUbMU_p4GVpHQ.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Photo by <a class="ae jt" href="https://unsplash.com/photos/U0tBTn8UR8I?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Fabian Grohs</a> on <a class="ae jt" href="https://unsplash.com/search/photos/code?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="5473" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">å¦‚æœæ‚¨æ›¾ç»ç”¨Akka HTTPç¼–å†™è¿‡æ¯”Hello World APIæ›´å¤æ‚çš„ä¸œè¥¿ï¼Œæ‚¨å¯èƒ½ä¼šå‘ç°è·¯ç”±DSLå¯èƒ½ä¼šå¾ˆå¿«å¤±æ§ã€‚</p><p id="745d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">åœ¨ä½ çš„è·¯çº¿ä¸­æœ‰å¾ˆæ·±çš„åµŒå¥—å±‚ï¼Œç”šè‡³å¯èƒ½æœ‰ä¸€äº›ä»£ç é‡å¤ã€‚</p><p id="0b02" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">è¿™å°±æ˜¯æŒ‡ä»¤çš„ä½œç”¨ã€‚ä½†æ˜¯ä»€ä¹ˆæ˜¯æŒ‡ä»¤å‘¢ï¼Ÿ</p><p id="b52f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jt" href="https://doc.akka.io/docs/akka-http/current/routing-dsl/directives/index.html" rel="noopener ugc nofollow" target="_blank">æŒ‡ä»¤æ˜¯å°çš„ã€å¯ç»„åˆçš„æ„å»ºå—</a>ï¼Œå…è®¸ä½ ä¸€ç‚¹ä¸€ç‚¹åœ°åˆ›å»ºä½ çš„è·¯çº¿ã€‚</p><p id="4621" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">å…¸å‹çš„è·¯çº¿å¦‚ä¸‹æ‰€ç¤º:</p><pre class="je jf jg jh fd ju jv jw jx aw jy bi"><span id="6f46" class="jz ka hh jv b fi kb kc l kd ke">pathPrefix("todos") {<br/>  pathEndOrSingleSlash {<br/>    get {<br/>      onComplete(todoRepository.all()) {<br/>        <strong class="jv hi">case </strong><em class="jc">Success</em>(todos) =&gt;<br/>          complete(todos)<br/>        <strong class="jv hi">case </strong><em class="jc">Failure</em>(exception) =&gt;<br/>          <em class="jc">println</em>(exception.getMessage)<br/>          complete(ApiError.<em class="jc">generic</em>.statusCode, ApiError.<em class="jc">generic</em>.message)<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="1dbb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ä¸Šé¢çš„è·¯ç”±æ¥å—è·¯å¾„<code class="du kf kg kh jv b">/todos</code>æˆ–<code class="du kf kg kh jv b">/todos/</code>ä¸­çš„GETè¯·æ±‚ã€‚å½“<code class="du kf kg kh jv b">todoRepository.all()</code>è¿”å›çš„æœªæ¥å®Œæˆæ—¶ï¼Œå®ƒä¹Ÿåšä¸€äº›é”™è¯¯å¤„ç†ã€‚</p><p id="a3c7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ç„¶è€Œï¼Œåœ¨æˆ‘ä»¬çš„å¤§å¤šæ•°(å¦‚æœä¸æ˜¯å…¨éƒ¨)è·¯ç”±ä¸­ï¼Œæˆ‘ä»¬å°†éœ€è¦è¿™ç§é”™è¯¯å¤„ç†ã€‚å°±åƒç°åœ¨è¿™æ ·ï¼Œæˆ‘ä»¬ä¸å¾—ä¸åˆ°å¤„å¤åˆ¶ç²˜è´´ã€‚</p><p id="e22d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">è¿™åªæ˜¯é”™è¯¯å¤„ç†ï¼Œæˆ‘ä»¬å¯èƒ½è¿˜æƒ³åœ¨è·¯ç”±ä¸­å¤„ç†å…¶ä»–é—®é¢˜ï¼Œæ¯”å¦‚èº«ä»½éªŒè¯ã€‚</p><p id="a6e3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•é‡ç”¨è¿™äº›é”™è¯¯å¤„ç†ä½å‘¢ï¼Ÿ</p><p id="34b6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">æˆ‘ä»¬å¯ä»¥åˆ›å»ºè‡ªå·±çš„è‡ªå®šä¹‰æŒ‡ä»¤ã€‚</p><h2 id="9c77" class="jz ka hh bd ki kj kk kl km kn ko kp kq ip kr ks kt it ku kv kw ix kx ky kz la bi translated">è®¾ç½®é¡¹ç›®</h2><p id="2fb1" class="pw-post-body-paragraph ie if hh ig b ih lb ij ik il lc in io ip ld ir is it le iv iw ix lf iz ja jb ha bi translated">æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ª<a class="ae jt" href="http://link.codemunity.io/m-custom-directives-repo" rel="noopener ugc nofollow" target="_blank">åŸºç¡€é¡¹ç›®</a>ï¼Œç¡®ä¿å…‹éš†å®ƒå¹¶æ£€æŸ¥<code class="du kf kg kh jv b">6.3-api-errors</code>åˆ†æ”¯ä»¥è·Ÿè¿›ã€‚</p><p id="1769" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">åœ¨åˆ›å»ºè‡ªå®šä¹‰æŒ‡ä»¤ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å¯¹é¡¹ç›®åšä¸€ä¸ªå¿«é€Ÿçš„æ¦‚è¿°ã€‚</p><p id="6370" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">è¯¥é¡¹ç›®ä½¿ç”¨Scala <code class="du kf kg kh jv b">2.12.6</code>å’ŒSBT <code class="du kf kg kh jv b">1.1.6</code>ï¼Œæ‚¨å¯ä»¥åˆ†åˆ«åœ¨<code class="du kf kg kh jv b">build.sbt</code>å’Œ<code class="du kf kg kh jv b">build.properties</code>æ–‡ä»¶ä¸­ç¡®è®¤ç‰ˆæœ¬ã€‚</p><p id="75cb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">è¯¥é¡¹ç›®æ˜¯todoåº”ç”¨ç¨‹åºçš„APIã€‚åœ¨é¡¹ç›®çš„æ ¹çº§åˆ«è¿è¡Œ<code class="du kf kg kh jv b">tree src</code>ä¼šç»™æˆ‘ä»¬å¸¦æ¥ä»¥ä¸‹ç»“æœ:</p><pre class="je jf jg jh fd ju jv jw jx aw jy bi"><span id="7ba2" class="jz ka hh jv b fi kb kc l kd ke">src<br/>â”œâ”€â”€ main<br/>â”‚   â””â”€â”€ scala<br/>â”‚       â”œâ”€â”€ ApiError.scala<br/>â”‚       â”œâ”€â”€ Main.scala<br/>â”‚       â”œâ”€â”€ Router.scala<br/>â”‚       â”œâ”€â”€ Server.scala<br/>â”‚       â”œâ”€â”€ Todo.scala<br/>â”‚       â””â”€â”€ TodoRepository.scala<br/>â””â”€â”€ test<br/>    â””â”€â”€ scala<br/>        â”œâ”€â”€ TodoMocks.scala<br/>        â””â”€â”€ TodoRouterListSpec.scala</span><span id="c984" class="jz ka hh jv b fi lg kc l kd ke">4 directories, 8 files</span></pre><p id="5bd0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ç®€è€Œè¨€ä¹‹ï¼Œè¿™äº›ç­çº§çš„èŒè´£æ˜¯:</p><ul class=""><li id="bfd9" class="lh li hh ig b ih ii il im ip lj it lk ix ll jb lm ln lo lp bi translated"><strong class="ig hi"> ApiError: </strong>æ¨¡å‹é”™è¯¯ã€‚</li><li id="4abe" class="lh li hh ig b ih lq il lr ip ls it lt ix lu jb lm ln lo lp bi translated"><strong class="ig hi">ä¸»:</strong>ç”³è¯·å…¥å£ç‚¹ã€‚</li><li id="737f" class="lh li hh ig b ih lq il lr ip ls it lt ix lu jb lm ln lo lp bi translated"><strong class="ig hi">è·¯ç”±å™¨:</strong>æˆ‘ä»¬çš„è·¯ç”±ä½çš„åœ°æ–¹ã€‚</li><li id="c077" class="lh li hh ig b ih lq il lr ip ls it lt ix lu jb lm ln lo lp bi translated"><strong class="ig hi">æœåŠ¡å™¨:</strong>å–ä¸€ä¸ªè·¯ç”±å™¨ï¼Œç»‘å®šåˆ°ä¸»æœºå’Œç«¯å£ã€‚</li><li id="9fcb" class="lh li hh ig b ih lq il lr ip ls it lt ix lu jb lm ln lo lp bi translated"><strong class="ig hi">å¾…åŠäº‹é¡¹:</strong>åº”ç”¨æ¨¡å‹ã€‚</li><li id="03de" class="lh li hh ig b ih lq il lr ip ls it lt ix lu jb lm ln lo lp bi translated"><strong class="ig hi"> TodoRepository: </strong>ä¸ºtodoså¤„ç†CRUDã€‚</li></ul><p id="d528" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">åœ¨<code class="du kf kg kh jv b">TodoRouter</code>å®ç°ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬ä¸Šé¢è®¨è®ºè¿‡çš„è·¯ç”±ï¼Œæˆ‘ä»¬æ­£åœ¨åšä¸€äº›æ‰‹åŠ¨é”™è¯¯å¤„ç†ï¼Œæˆ‘ä»¬å¸Œæœ›åœ¨å…¶ä»–è·¯ç”±ä¸­åšåŒæ ·çš„äº‹æƒ…ã€‚</p><p id="f2db" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">å¦‚æœä½ çœ‹ä¸€ä¸‹<code class="du kf kg kh jv b">build.sbt</code>æ–‡ä»¶ï¼Œä½ å¯ä»¥çœ‹åˆ°æˆ‘ä»¬éœ€è¦çš„ä¾èµ–å…³ç³»ï¼Œ<a class="ae jt" href="https://akka.io/docs/" rel="noopener ugc nofollow" target="_blank"> Akka </a> actorsï¼Œstreamså’ŒHTTPæ¨¡å—ï¼Œ<a class="ae jt" href="https://circe.github.io/circe/" rel="noopener ugc nofollow" target="_blank">å–€å°”åˆ»</a>ç”¨äºJSONï¼Œä»¥åŠä¸€ä¸ªé¢å¤–çš„åº“ç”¨äºAkka HTTPã€‚</p><h2 id="45cb" class="jz ka hh bd ki kj kk kl km kn ko kp kq ip kr ks kt it ku kv kw ix kx ky kz la bi translated">åˆ›å»ºè‡ªå®šä¹‰æŒ‡ä»¤</h2><p id="67b4" class="pw-post-body-paragraph ie if hh ig b ih lb ij ik il lc in io ip ld ir is it le iv iw ix lf iz ja jb ha bi translated">æœ‰å¤šç§æ–¹æ³•å¯ä»¥åˆ›å»ºè‡ªå®šä¹‰æŒ‡ä»¤ï¼Œä½†æ˜¯æˆ‘ä»¬å°†è½¬æ¢ç°æœ‰çš„æŒ‡ä»¤æ¥åˆ›å»ºæ–°çš„æŒ‡ä»¤ã€‚</p><p id="ed94" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">åœ¨åä¸º<code class="du kf kg kh jv b">TodoDirectives</code>çš„<code class="du kf kg kh jv b">src/main/scala</code>ä¸‹åˆ›å»ºä¸€ä¸ªæ–°çš„<code class="du kf kg kh jv b">trait</code>ï¼Œå®ƒå°†æ‰©å±•ç‰¹å¾<code class="du kf kg kh jv b">Directives</code>ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¼å…¥å–€å°”åˆ»åŠå…¶æ”¯æŒåº“ï¼Œæˆ‘ä»¬æ­£åœ¨ä½¿ç”¨å®ƒä»¬è¿›è¡ŒJSONåºåˆ—åŒ–ã€‚</p><pre class="je jf jg jh fd ju jv jw jx aw jy bi"><span id="1987" class="jz ka hh jv b fi kb kc l kd ke"><strong class="jv hi">import </strong>akka.http.scaladsl.server.Directives<br/><br/><strong class="jv hi">trait </strong>TodoDirectives <strong class="jv hi">extends </strong>Directives {<br/>  <strong class="jv hi">import </strong>de.heikoseeberger.akkahttpcirce.FailFastCirceSupport._<br/>  <strong class="jv hi">import </strong>io.circe.generic.auto._<br/><br/>}</span></pre><p id="f032" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªé€šç”¨å‡½æ•°ï¼Œå®ƒå°†å¤„ç†æœªæ¥çš„å¤±è´¥ï¼Œç»™å®šä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå†³å®šå½“æ„å¤–å‘ç”Ÿæ—¶åº”è¯¥è¿”å›å“ªä¸ª<code class="du kf kg kh jv b">ApiError</code>:</p><pre class="je jf jg jh fd ju jv jw jx aw jy bi"><span id="4333" class="jz ka hh jv b fi kb kc l kd ke"><strong class="jv hi">def </strong>handle[T](f: Future[T])(e: Throwable =&gt; ApiError): Directive1[T] =<br/>  onComplete(f) flatMap {<br/>    <strong class="jv hi">case </strong><em class="jc">Success</em>(t) =&gt;<br/>      provide(t)<br/>    <strong class="jv hi">case </strong><em class="jc">Failure</em>(error) =&gt;<br/>      <strong class="jv hi">val </strong>apiError = e(error)<br/>      complete(apiError.statusCode, apiError.message)<br/>  }</span></pre><p id="f0a9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">è¿™ä¸æˆ‘ä»¬è·¯ç”±ä¸­çš„é”™è¯¯å¤„ç†é€»è¾‘éå¸¸ç›¸ä¼¼ï¼Œä½†æ˜¯è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸åŒä¹‹å¤„ã€‚</p><p id="1388" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">æˆ‘ä»¬æ¥æ”¶ä¸€ä¸ªæ¥æ”¶ä¸€ä¸ª<code class="du kf kg kh jv b">Throwable</code>å¹¶è¿”å›ä¸€ä¸ª<code class="du kf kg kh jv b">ApiError</code>çš„å‡½æ•°ï¼Œè¿™å°†å…è®¸æˆ‘ä»¬åœ¨å¤–éƒ¨å¤„ç†è¿™ä¸ªé—®é¢˜ï¼Œå¹¶ä½¿æŒ‡ä»¤æ›´åŠ é€šç”¨ã€‚</p><p id="3b4e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">æ­¤å¤–ï¼Œæˆ‘ä»¬ä½¿ç”¨<code class="du kf kg kh jv b">flatMap</code>æ˜¯å› ä¸ºæˆ‘ä»¬æ­£åœ¨è½¬æ¢æŒ‡ä»¤ä»¥åˆ›å»ºæ–°çš„æŒ‡ä»¤ï¼Œè€Œä¸æ˜¯åº”ç”¨å®ƒä»¬ã€‚</p><p id="2c25" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">å¦‚æœæœªæ¥æˆåŠŸï¼Œæˆ‘ä»¬<code class="du kf kg kh jv b">provide</code>è¯¥å€¼ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘ä»¬çš„è¿”å›ç±»å‹æ˜¯ä¸€ä¸ª<code class="du kf kg kh jv b">Directive1[T]</code>ï¼Œæˆ‘ä»¬çš„æŒ‡ä»¤å°†è¿”å›æˆ–æä¾›ä¸€ä¸ªå€¼ï¼Œè¿™æ˜¯åŒ…å«åœ¨æœªæ¥çš„å€¼ã€‚</p><p id="af1a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ç„¶è€Œï¼Œå¦‚æœfutureå¤±è´¥äº†ï¼Œæˆ‘ä»¬ä»å‡½æ•°ä¸­å¾—åˆ°<code class="du kf kg kh jv b">ApiError</code>,ç„¶åæˆ‘ä»¬å°†å¸¦æœ‰ç›¸åº”çŠ¶æ€ä»£ç å’Œæ¶ˆæ¯çš„å“åº”å‘é€å›å®¢æˆ·ç«¯ã€‚</p><p id="647c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">å¦‚æœæ‚¨æŸ¥çœ‹<code class="du kf kg kh jv b">ApiError.scala</code>æ–‡ä»¶ï¼Œæˆ‘ä»¬åªæœ‰ä¸€ä¸ªä¸€èˆ¬æ€§é”™è¯¯ã€‚ç°åœ¨æˆ‘ä»¬çš„å­˜å‚¨åº“åœ¨å¾ˆå¤šæ–¹é¢éƒ½ä¸ä¼šå¤±è´¥ï¼Œå› ä¸ºæˆ‘ä»¬åªåˆ—å‡ºäº†å¾…åŠäº‹é¡¹ã€‚</p><p id="51d1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">è®©æˆ‘ä»¬åˆ›å»ºå¦ä¸€ä¸ªæŒ‡ä»¤ï¼Œæ— è®ºå¼‚å¸¸æ˜¯ä»€ä¹ˆï¼Œå®ƒæ€»æ˜¯ç”¨ä¸€èˆ¬çš„<code class="du kf kg kh jv b">ApiError</code>è¿›è¡Œå›å¤:</p><pre class="je jf jg jh fd ju jv jw jx aw jy bi"><span id="5d9c" class="jz ka hh jv b fi kb kc l kd ke"><strong class="jv hi">def </strong>handleWithGeneric[T](f: Future[T]): Directive1[T] =<br/>  handle[T](f)(_ =&gt; ApiError.<em class="jc">generic</em>)</span></pre><p id="52ef" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">è®©æˆ‘ä»¬ç”¨å®ƒæ¥æ•´ç†æˆ‘ä»¬çš„<code class="du kf kg kh jv b">TodoRouter</code>ä¸­çš„é”™è¯¯å¤„ç†ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ‰©å±•æˆ‘ä»¬çš„<code class="du kf kg kh jv b">TodoDirective</code>ç‰¹å¾æ¥è®¿é—®æˆ‘ä»¬çš„è‡ªå®šä¹‰æŒ‡ä»¤ã€‚</p><p id="f170" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ç„¶åæˆ‘ä»¬å¯ä»¥æ›´æ–°è·¯çº¿ï¼Œå®ƒå°†çœ‹èµ·æ¥åƒ:</p><pre class="je jf jg jh fd ju jv jw jx aw jy bi"><span id="c72c" class="jz ka hh jv b fi kb kc l kd ke">pathPrefix("todos") {<br/>  pathEndOrSingleSlash {<br/>    get {<br/>      handleWithGeneric(todoRepository.all()) { todos =&gt;<br/>        complete(todos)<br/>      }<br/>    }<br/>  } ~ ...</span></pre><p id="b389" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">å®ƒæ¯”æœ€åˆçš„æ›´å¹²å‡€ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥ç”¨æ›´å°‘çš„æ ·æ¿æ–‡ä»¶æ›´æ–°å…¶ä»–è·¯ç”±ã€‚æˆ‘ä»¬çš„<code class="du kf kg kh jv b">TodoRouter</code>æœ€ç»ˆçœ‹èµ·æ¥åƒ:</p><pre class="je jf jg jh fd ju jv jw jx aw jy bi"><span id="845b" class="jz ka hh jv b fi kb kc l kd ke"><strong class="jv hi">import </strong>akka.http.scaladsl.server.{Directives, Route}<br/><br/><strong class="jv hi">trait </strong>Router {<br/>  <strong class="jv hi">def </strong>route: Route<br/>}<br/><br/><strong class="jv hi">class </strong>TodoRouter(todoRepository: TodoRepository) <strong class="jv hi">extends </strong>Router <strong class="jv hi">with </strong>Directives <strong class="jv hi">with </strong>TodoDirectives {<br/>  <strong class="jv hi">import </strong>de.heikoseeberger.akkahttpcirce.FailFastCirceSupport._<br/>  <strong class="jv hi">import </strong>io.circe.generic.auto._<br/><br/>  <strong class="jv hi">override def </strong>route: Route = pathPrefix("todos") {<br/>    pathEndOrSingleSlash {<br/>      get {<br/>        handleWithGeneric(todoRepository.all()) { todos =&gt;<br/>          complete(todos)<br/>        }<br/>      }<br/>    } ~ path("done") {<br/>      get {<br/>        handleWithGeneric(todoRepository.done()) { todos =&gt;<br/>          complete(todos)<br/>        }<br/>      }<br/>    } ~ path("pending") {<br/>      get {<br/>        handleWithGeneric(todoRepository.pending()) { todos =&gt;<br/>          complete(todos)<br/>        }<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="f738" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">æˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡è¿è¡Œ<code class="du kf kg kh jv b">TodoRouterListSpec</code>æµ‹è¯•ï¼Œæˆ–è€…ä»é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„å‘½ä»¤è¡Œè¿è¡Œ<code class="du kf kg kh jv b">sbt test</code>,æ¥ç¡®ä¿(æˆ–è®¸åº”è¯¥)æˆ‘ä»¬çš„è·¯ç”±ä»ç„¶æŒ‰ç…§é¢„æœŸå·¥ä½œã€‚</p><p id="d321" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">è¿è¡Œ<code class="du kf kg kh jv b">sbt test</code>åº”è¯¥ä¼šå¾—åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡º:</p><pre class="je jf jg jh fd ju jv jw jx aw jy bi"><span id="be80" class="jz ka hh jv b fi kb kc l kd ke">[info] TodoRouterListSpec:<br/>[info] A TodoRouter<br/>[info] - should return all the todos<br/>[info] - should return all the done todos<br/>[info] - should return all the pending todos<br/>[info] - should handle repository failure in the todos route<br/>[info] - should handle repository failure in the done todos route<br/>[info] - should handle repository failure in the pending todos route<br/>[info] Run completed in 1 second, 859 milliseconds.<br/>[info] Total number of tests run: 6<br/>[info] Suites: completed 1, aborted 0<br/>[info] Tests: succeeded 6, failed 0, canceled 0, ignored 0, pending 0<br/>[info] All tests passed.<br/>[success] Total time: 13 s, completed 20-Aug-2018 23:21:12</span></pre><p id="d30b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰çš„æµ‹è¯•éƒ½é€šè¿‡äº†ã€‚å‰å®³ï¼ğŸ‘ğŸ½</p></div><div class="ab cl lv lw go lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ha hb hc hd he"><p id="eae2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">å¦‚æœä½ å–œæ¬¢è¿™ä¸ªæ•™ç¨‹ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªå…è´¹çš„Akka HTTPè¯¾ç¨‹ï¼Œä½ å¯ä»¥ä»å¤´å¼€å§‹æ„å»ºæˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨çš„Todoé¡¹ç›®ï¼Œä¸€æ­¥ä¸€æ­¥åœ°è§£é‡Šã€‚é‡Œé¢è§ï¼ğŸ‘‡ğŸ½</p><div class="mc md ez fb me mf"><a href="http://link.codemunity.io/cd-akka-http-quickstart-course" rel="noopener  ugc nofollow" target="_blank"><div class="mg ab dw"><div class="mh ab mi cl cj mj"><h2 class="bd hi fi z dy mk ea eb ml ed ef hg bi translated">Akka HTTPå¿«é€Ÿå…¥é—¨</h2><div class="mm l"><h3 class="bd b fi z dy mk ea eb ml ed ef dx translated">äº†è§£å¦‚ä½•åˆ›å»ºè¿™ä¸ªå…è´¹çš„è¯¾ç¨‹ä¸Akka HTTPçš„webåº”ç”¨ç¨‹åºå’ŒAPIï¼</h3></div><div class="mn l"><p class="bd b fp z dy mk ea eb ml ed ef dx translated">link . code community . io</p></div></div><div class="mo l"><div class="mp l mq mr ms mo mt jn mf"/></div></div></a></div></div></div>    
</body>
</html>