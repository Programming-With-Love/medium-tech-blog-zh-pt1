<html>
<head>
<title>Moving Lottie Swiftly into the Future</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将洛蒂迅速带入未来</h1>
<blockquote>原文：<a href="https://medium.com/airbnb-engineering/lottie-and-swift-at-airbnb-e0c85dc365e7?source=collection_archive---------0-----------------------#2019-05-07">https://medium.com/airbnb-engineering/lottie-and-swift-at-airbnb-e0c85dc365e7?source=collection_archive---------0-----------------------#2019-05-07</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="9c19" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">一个关于Airbnb如何用一种新语言重写流行的开源库Lottie的个人故事</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/14b9a95738cbdaa1ac1a1cf85b94469c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dBfxceyq7nI5uDWnhSTEgg.jpeg"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Come and join us in working on Swift development in our gorgeous office!</figcaption></figure><p id="9647" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated"><a class="ae ki" href="https://airbnb.io/lottie/" rel="noopener ugc nofollow" target="_blank"> Lottie </a>是一个适用于Android、iOS、web和Windows的库，它解析用<a class="ae ki" href="https://github.com/airbnb/lottie-web" rel="noopener ugc nofollow" target="_blank"> Bodymovin </a>导出为JSON的<a class="ae ki" href="http://www.adobe.com/products/aftereffects.html" rel="noopener ugc nofollow" target="_blank"> Adobe After Effects </a>动画，并在移动设备和Web上自然呈现它们。如果你还没有读过Brandon关于Lottie在iOS上被迅速改写的帖子，请查看一下！我们想提供更多一点的背景，为什么我们决定投资于这次重写。</p><p id="7327" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">Lottie是两年前用Objective-C编写的，当时Airbnb还没有完全迁移到Swift，大多数公司还没有采用Swift。快进到2019年— <a class="ae ki" href="https://blog.andrewmadsen.com/post/182862756395/how-many-apps-use-swift-in-2019" rel="noopener ugc nofollow" target="_blank">超过50%的顶级非游戏应用程序正在使用Swift </a>。Airbnb应用程序90%以上是Swift代码，我们已经多年没有编写Objective-C了。是时候通过在Swift中重写Lottie了，Lottie是我们最受欢迎的开源回购之一。</p><h2 id="20d0" class="kj kk hh bd kl km kn ko kp kq kr ks kt jv ku kv kw jz kx ky kz kd la lb lc ld bi translated">为什么要重写？</h2><p id="b485" class="pw-post-body-paragraph jm jn hh jo b jp le ii jr js lf il ju jv lg jx jy jz lh kb kc kd li kf kg kh ha bi translated">如果你告诉很多开发人员你打算从头开始重写一个大型开源库，他们会犹豫不决。为什么不在它的基础上建造呢？Objective-C版本运行良好；为什么不维持现状？我们意识到，考虑到Objective-C和Swift之间的差异，重写是合适的，原因如下:</p><ul class=""><li id="71c4" class="lj lk hh jo b jp jq js jt jv ll jz lm kd ln kh lo lp lq lr bi translated"><strong class="jo hi"> Objective-C与Swift的互操作性仍然不够好</strong>。这是可行的，但你只能说这么多了。如果我们只在Swift中编写Lottie的一些层，我们最终会得到一个混合代码库，迫使贡献者更长时间地处理这一挑战，而不会推动库向前发展。</li><li id="acd1" class="lj lk hh jo b jp ls js lt jv lu jz lv kd lw kh lo lp lq lr bi translated"><strong class="jo hi"> Swift有许多精彩的语言改进</strong>，如结构、模式匹配、更好的不变性、更严格的访问控制、强大的枚举类型、函数式编程范例等等。这些特性在Objective-C中都不可用，这意味着Lottie代码库也将错过所有这些特性以及将来引入的任何新特性。</li><li id="cc4d" class="lj lk hh jo b jp ls js lt jv lu jz lv kd lw kh lo lp lq lr bi translated"><strong class="jo hi">从Objective-C到Swift的上下文切换需要时间</strong>，这使得同时在Lottie和现代代码库中工作更加困难和令人沮丧。</li><li id="596c" class="lj lk hh jo b jp ls js lt jv lu jz lv kd lw kh lo lp lq lr bi translated"><strong class="jo hi">越来越多的工程师在从未接触过Objective-C的情况下先学习Swift】随着有这种背景的工程师数量的增加，用Objective-C编写的项目变得过时，这些较新的iOS工程师无法接触到。</strong></li></ul><h2 id="5392" class="kj kk hh bd kl km kn ko kp kq kr ks kt jv ku kv kw jz kx ky kz kd la lb lc ld bi translated">我自己的快速故事</h2><p id="70e7" class="pw-post-body-paragraph jm jn hh jo b jp le ii jr js lf il ju jv lg jx jy jz lh kb kc kd li kf kg kh ha bi translated">当我刚开始在Airbnb工作时，我根本不了解Swift。我真的很舒服，很高兴写Objective-C；为什么要改变呢？2017年，Swift经历了许多变化，与Objective-C的互操作性是一个需要应对的重大挑战。错误消息通常很难理解，编译器也没有提供多少帮助。Objective-C是一种更成熟的语言，并且工作得更好。由于这些原因，我非常不喜欢Swift，尽可能避免使用它。</p><p id="5b6f" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">奇怪的是，我加入Airbnb的主要原因之一是因为我知道我需要学习Swift来推进我作为iOS工程师的职业生涯。Airbnb是向Swift过渡的领导者，他们在2016年底将大部分应用程序改写为Swift 2。当我加入时，该应用程序刚刚被<a class="ae ki" rel="noopener" href="/airbnb-engineering/getting-to-swift-3-at-airbnb-79a257d2b656">更新为支持Swift 3 </a>，我对强迫自己使用我多年来避免使用的语言持谨慎乐观态度。就像任何语言(编程与否)一样，如果你完全沉浸其中，你可以非常快地学会它。我了解了结构、强大的函数式编程范例以及编写面向协议的代码。我很兴奋地来工作，想更多地了解这门语言，每天都变得更容易了。是的，在这个过程中有一些障碍(主要是编译速度慢)，但是几个月后，我真的喜欢上了这门语言及其所有的复杂性。</p><p id="64fd" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">我写Objective-C已经两年了，现在我在拥有和维护洛蒂库的团队中。作为其中的一部分，我不得不不时查看Lottie源代码，以解决其他工程师提出的错误或问题。这样做已经变成了一个回到目标C的大的环境切换，把我带出我通常的流程，并且变得越来越困难。</p><p id="3c60" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">当我使用Lottie动画实现一个新的动画按钮时，我遇到了一个bug，动画的某些层没有根据按钮状态正确隐藏。当我深入渲染源代码寻找罪魁祸首时，我很快发现自己迷失在像洋葱一样分层的Objective-C代码中。Lottie有不同类型的图层、遮罩、形状、渐变、笔画和变换的类。许多其他以不同风格编写代码的工程师都对它做出了贡献。添加了一些方法，它们以稍微不同的方式做同样的事情。我越来越难以理解什么是重要的，什么只是需要过滤掉的噪音。</p><p id="7a31" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">很明显，试图在没有帮助的情况下调试这个问题几乎是不可能的。为了让更多的人直接为图书馆做出贡献来解决这类问题，我们意识到我们的最佳选择是将Lottie转移到未来并用Swift重写。</p><p id="8b1e" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">在重写过程中，我可以和Brandon一起直接开发新的Lottie版本，并提出改进意见。当我们将新版本集成到Airbnb应用程序中时，我能够发现新的错误并报告它们，或者自己做出贡献并修复它们。我增加了对目标C兼容性的支持，并修正了一些关于T2新动画开关类的问题。能够在这个库上工作已经被授权了，我终于觉得我不仅可以调试新的问题，还可以通过为每个人改进它来回馈社区。</p><h2 id="abeb" class="kj kk hh bd kl km kn ko kp kq kr ks kt jv ku kv kw jz kx ky kz kd la lb lc ld bi translated">Airbnb对开源的承诺</h2><p id="7704" class="pw-post-body-paragraph jm jn hh jo b jp le ii jr js lf il ju jv lg jx jy jz lh kb kc kd li kf kg kh ha bi translated">Airbnb喜欢与开源社区合作。如果没有过多的开源软件，我们将无法快速、轻松地构建我们的应用和服务，我们希望尽我们所能回馈社会。这是我们两年前开源Lottie的主要动机。当我们与Brandon Withrow合作在Swift中重写Lottie时，我们知道唯一的选择是公开进行，并尽早提供社区访问。自从Lottie的开源版本更新到3.0版本后，我们收到了大量来自社区的评论、问题和请求，这极大地改进了这个新版本。</p><p id="38e1" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">我们希望你和你的团队喜欢这个更新，并且社区中的其他人将继续在这个新的现代化平台上与我们合作，使它变得更好。非常感谢您对Lottie和Airbnb开源项目的支持！</p></div><div class="ab cl lx ly go lz" role="separator"><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc md"/><span class="ma bw bk mb mc"/></div><div class="ha hb hc hd he"><p id="e5d4" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated"><em class="me">如果你对Swift和iOS开发充满热情，我们鼓励你申请我们已经开放的</em> <a class="ae ki" href="https://grnh.se/1cb1ce351" rel="noopener ugc nofollow" target="_blank"> <em class="me">不同角色</em> </a> <em class="me">！我们希望你能加入我们的团队！</em></p><p id="94ae" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">非常感谢Maja Wichrowska和Stephanie Teng的写作和编辑支持。</p></div></div>    
</body>
</html>