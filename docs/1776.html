<html>
<head>
<title>Time Travel is Real-Building Offline Evaluation Frameworks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间旅行是真实的——建立离线评估框架</h1>
<blockquote>原文：<a href="https://medium.com/capital-one-tech/time-travel-is-real-building-offline-evaluation-frameworks-a78103613ef9?source=collection_archive---------4-----------------------#2021-02-04">https://medium.com/capital-one-tech/time-travel-is-real-building-offline-evaluation-frameworks-a78103613ef9?source=collection_archive---------4-----------------------#2021-02-04</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="e313" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">“虫洞”框架如何帮助个性化平台利用机器学习</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/6a7931a4df2373523d8f419acdf4fd94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AL2oJwCzeBSUsNss.png"/></div></div></figure><p id="73f8" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">数字革命和通过多种设备访问互联网增加了世界各地人们的选择余地。例如，仅YouTube就有<a class="ae ke" href="https://www.youtube.com/about/press/" rel="noopener ugc nofollow" target="_blank"> 2B+用户每天在PC、移动、OTT(over-the-top)设备上观看超过10亿小时的视频</a>。这是几乎永无止境的视频内容，触手可及[1]。令人惊讶的是，人类不善于在众多选项中做出选择，这可能导致糟糕的决策。我们中的许多人花了数小时在流媒体网站上搜索新闻或专业内容，但最终却观看了随机的狗视频。这就是个性化体验平台可以帮助用户在正确的时间做出正确选择的地方。</p><p id="1fe9" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">个性化平台预测每个客户的期望，并帮助他们做出最佳决策，从而提高参与度。几十年来，提供个性化推荐的能力推动了在线广告、视频/游戏流媒体平台和搜索引擎的发展。类似的个性化也可以应用在金融服务中，以帮助客户按时付款，选择金融产品，或接收个性化消息，以帮助他们管理自己的财务健康。营销渠道沟通也可以通过个性化平台进行优化。</p><p id="2904" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">机器学习是任何高级个性化平台的核心，旨在帮助客户做出这些决定。最大化机器学习系统收益的显而易见但最有效的方法是提供更好的数据并建立强大的离线评估框架。但是，为了获得最大收益，还需要应对一些挑战。</p><h1 id="aeac" class="kf kg hh bd kh ki kj kk kl km kn ko kp in kq io kr iq ks ir kt it ku iu kv kw bi translated">构建强大的离线评估框架的挑战</h1><p id="ea24" class="pw-post-body-paragraph ji jj hh jk b jl kx ii jn jo ky il jq jr kz jt ju jv la jx jy jz lb kb kc kd ha bi translated">机器学习算法通常在离线环境中使用历史数据进行评估。原始数据集被转换成进入离线模型开发阶段的特征向量。将这些相同的模型部署到生产中需要使用实时服务来生成特性。保持在线和离线特征生成同步是一个复杂的问题，学术界和工业界都在这方面做了大量工作[3]。</p><p id="9e1f" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">机器学习工程师需要超越特征生成，解决这三大挑战:</p><ol class=""><li id="7321" class="lc ld hh jk b jl jm jo jp jr le jv lf jz lg kd lh li lj lk bi translated"><strong class="jk hi">数据收集</strong>n——提供数据生成特征的上游微服务，往往没有考虑到机器学习需求而构建。然而，考虑到机器学习需求的进化性质，这样做可能不切实际。从如此不同的来源收集数据总是一个挑战。</li><li id="d478" class="lc ld hh jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated"><strong class="jk hi">时态数据处理</strong> —跨系统的多个数据源的时态视图可以让我们将它们缝合在一起，并在给定的时间点(客户旅程)建立客户交互。为无状态系统的数据和处理添加时间维度以识别客户交互随时间的状态是一项挑战。</li><li id="d5ab" class="lc ld hh jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated"><strong class="jk hi">离线模拟环境</strong> —基于上述数据为不断变化的机器学习生态系统建立一个稳健的离线评估系统是一个复杂而又需要解决的关键问题。</li></ol><p id="e806" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在构建框架时，一个恰当代表这些挑战的概念是<a class="ae ke" href="https://en.wikipedia.org/wiki/Wormhole" rel="noopener ugc nofollow" target="_blank">虫洞</a>。[4]就像虫洞链接时空中的两个不同点一样，我们希望我们的解决方案能够从各种微服务中检索数据，并构建一致的客户行为时间视图，同时提供“时间旅行”功能。这些时间旅行功能将大致还原给定时间系统中的数据状态。<em class="lq">这导致创建了一个强大的离线评估框架，其中新的机器学习算法可以</em><strong class="jk hi"><em class="lq">*模拟* </em> </strong> <em class="lq">在伪生产环境中进行测试。本质上，人们可以简单地回到过去，问一个新的算法/系统在那个时候会如何响应客户的请求。</em></p><h1 id="b0fa" class="kf kg hh bd kh ki kj kk kl km kn ko kp in kq io kr iq ks ir kt it ku iu kv kw bi translated">构建虫洞离线评估框架的初步考虑</h1><p id="86cd" class="pw-post-body-paragraph ji jj hh jk b jl kx ii jn jo ky il jq jr kz jt ju jv la jx jy jz lb kb kc kd ha bi translated">为了构建这个“虫洞”来连接来自我们众多微服务/系统的数据，并为我们提供客户状态的时态视图，我们需要两件东西— <em class="lq">状态持久性和被动时态数据快照构建器。</em></p><h1 id="662b" class="kf kg hh bd kh ki kj kk kl km kn ko kp in kq io kr iq ks ir kt it ku iu kv kw bi translated">1.状态持久性</h1><p id="b176" class="pw-post-body-paragraph ji jj hh jk b jl kx ii jn jo ky il jq jr kz jt ju jv la jx jy jz lb kb kc kd ha bi translated">任何系统都可以概括为<a class="ae ke" href="https://en.wikipedia.org/wiki/Finite-state_machine" rel="noopener ugc nofollow" target="_blank">有限状态机</a> (FSM)，或者FSM的组合，其中它在任何给定时间都可以处于有限数量的<em class="lq">状态</em>中的一个状态。基于一些输入，系统也可以从一种状态转移到另一种状态<em class="lq">。</em></p><p id="4ab3" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">人们可以把个性化平台看作一个复杂的有限状态机。在这种情况下，用户登录并采取一些行动，如浏览内容、网页、视频等。借助于提供这些功能的底层微服务和子系统。如果在所有微服务和子系统中保持这些<em class="lq">状态转换</em>，那么本质上它们将拥有在给定时间点重建体验平台状态所需的所有数据点。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lr"><img src="../Images/04dbda475090b251b9d6dc6354726eb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Yd_4wb1qeK-vQFS9"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">Fig1: FSM example of elevator system</figcaption></figure><p id="4779" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><em class="lq">图1 </em>以一个简单的电梯系统为例展示了这一点。相同的状态转换可以在下面的表格中定义。用时间维度来保持这些状态转换将允许我们计算出电梯系统在任何时间点的状态。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lw"><img src="../Images/7516d93514e1ee142305aa4d370bd1d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zt0q_2jz-3OiReRi9HJFJg.png"/></div></div></figure><h1 id="8612" class="kf kg hh bd kh ki kj kk kl km kn ko kp in kq io kr iq ks ir kt it ku iu kv kw bi translated">2.被动时态数据快照构建器</h1><p id="23d5" class="pw-post-body-paragraph ji jj hh jk b jl kx ii jn jo ky il jq jr kz jt ju jv la jx jy jz lb kb kc kd ha bi translated">由于遗留、工程或监管方面的挑战，个性化平台中的每个微服务或子系统可能都无法保持状态。相反，我们可以<em class="lq">被动地</em>从这些上游微服务的日志、内部数据库和流中读取数据，以构建时态数据快照。为这些数据添加时间维度以实现数据拼接和时间旅行功能非常重要。</p><ul class=""><li id="ef5c" class="lc ld hh jk b jl jm jo jp jr le jv lf jz lg kd lx li lj lk bi translated"><strong class="jk hi">时态数据拼接</strong> —来自所有上游微服务和子系统的时态数据快照可以基于基于近似时间窗口的匹配进行拼接或链接，以提供所有服务/系统在给定时间点的近似状态。</li><li id="f935" class="lc ld hh jk b jl ll jo lm jr ln jv lo jz lp kd lx li lj lk bi translated"><strong class="jk hi">离线模拟环境</strong> —具有拼接功能的时态数据集支持强大的离线模拟环境。在Spark或其他离线环境(Python，R)中读取这种拼接数据的编程API有助于标准化模型评估工具。它使数据科学家能够满怀信心地大规模评估新算法和模型，从而缩短了从原型到生产发布的时间。它还为实时A/B测试提供了一个可靠的替代方案，后者的范围有限，并且在生产环境中会有开发成本。</li></ul><h1 id="5dd3" class="kf kg hh bd kh ki kj kk kl km kn ko kp in kq io kr iq ks ir kt it ku iu kv kw bi translated">构建虫洞离线评估框架</h1><p id="e9d4" class="pw-post-body-paragraph ji jj hh jk b jl kx ii jn jo ky il jq jr kz jt ju jv la jx jy jz lb kb kc kd ha bi translated">任何个性化机器学习平台都广泛接受数据集，例如:</p><ul class=""><li id="4689" class="lc ld hh jk b jl jm jo jp jr le jv lf jz lg kd lx li lj lk bi translated"><strong class="jk hi">客户背景</strong> —客户当前状态的丰富特征数据集。</li><li id="8e45" class="lc ld hh jk b jl ll jo lm jr ln jv lo jz lp kd lx li lj lk bi translated"><strong class="jk hi">内容元数据</strong> —可供推荐的内容。例如，视频、图像、消息、网页布局、产品供应等。</li><li id="e8f8" class="lc ld hh jk b jl ll jo lm jr ln jv lo jz lp kd lx li lj lk bi translated"><strong class="jk hi">反馈数据</strong> —客户对建议采取的行动。例如，印象、点击、浏览、喜欢、购买等。</li></ul><p id="c08f" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这些数据集来自各种实时微服务和子系统。虫洞应该被动地工作，从这些系统收集数据——保持数据的时间状态——以提供时间旅行能力。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ly"><img src="../Images/7e91f99d046df2ab6106c0e738effcd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*POsYMopBYhJK69Vx"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">Figure2: High level architecture</figcaption></figure><p id="6627" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><em class="lq">图2 </em>显示了虫洞的高级架构。它包括:</p><ul class=""><li id="5606" class="lc ld hh jk b jl jm jo jp jr le jv lf jz lg kd lx li lj lk bi translated"><strong class="jk hi">快照生成器</strong> —该组件提供可扩展的通用快照功能，连接到微服务的内部临时存储层，并生成增量快照。它可以扩展为使用各种数据库连接、缓存层和流来生成快照。提供被动数据收集(以避免提供者系统过载)和时间维度至关重要。为了尽量减少由于失败造成的数据丢失，我们使用推测执行。我们构建了一个快照状态跟踪器来主动识别任何数据丢失。出于监管原因，有些快照会对某些敏感属性进行模糊处理和加密。我们重用内部工具和标准来满足这些法规要求。该组件的最终目标是使添加任何数据源和构建可靠的快照变得更加容易。</li><li id="f501" class="lc ld hh jk b jl ll jo lm jr ln jv lo jz lp kd lx li lj lk bi translated"><strong class="jk hi">数据质量检查</strong> —快照上的基本数据质量检查跟踪数据问题，如缺失值和异常。这有助于为下游组件提供干净的数据集。这可以发展成通用的数据质量框架，超越类似于[4]和[5]的简单的基于规则的检查。</li><li id="dc4e" class="lc ld hh jk b jl ll jo lm jr ln jv lo jz lp kd lx li lj lk bi translated"><strong class="jk hi">时态快照缝合器</strong> —用近似时态连接合并各种快照。它是一个由spark APIs组成的JVM库，用于缝合各种数据集。存在构建有用的拼接数据集的计划作业。它还使数据科学家能够从他们的spark笔记本电脑中生成自定义数据集进行即席分析。</li><li id="2091" class="lc ld hh jk b jl ll jo lm jr ln jv lo jz lp kd lx li lj lk bi translated"><strong class="jk hi">时间旅行功能</strong> —该组件提供面向用户的API，用于在给定时间点构建特定数据源的状态或系统的集体状态。这可以让用户跟踪过去的客户登录，并询问当时可用的客户上下文、可用内容和反馈数据。本质上，这可以跨所有子系统重新创建数据状态。这就是为什么我们称之为时间旅行系统——虫洞！数据科学家可以使用这些API，调试推荐算法在过去的工作方式——恢复该时间点的系统数据——测试新算法。它提供了强大的大规模离线评估功能，可以更快地、充满信心地迭代新想法。</li><li id="5f51" class="lc ld hh jk b jl ll jo lm jr ln jv lo jz lp kd lx li lj lk bi translated"><strong class="jk hi">其他用途</strong>-该系统和可用的时态数据集有许多其他用途。例如，探索生产系统的新功能、监控和有价值的见解。</li></ul><h1 id="2850" class="kf kg hh bd kh ki kj kk kl km kn ko kp in kq io kr iq ks ir kt it ku iu kv kw bi translated">提高</h1><p id="9d31" class="pw-post-body-paragraph ji jj hh jk b jl kx ii jn jo ky il jq jr kz jt ju jv la jx jy jz lb kb kc kd ha bi translated">一个被动地从所有子系统生成时态数据并提供时间旅行能力的功能系统对于个性化平台来说是非常强大的。通过使用模块化的、可扩展的和可伸缩的体系结构，人们可以毫不费力地添加更多的数据源。然而，还有几个额外的功能可以添加，主要集中在离线评估框架。虫洞可以利用Spark的分布式计算，或者可以扩展到在本地机器上的独立Python环境中工作。这样，人们可以用最少的努力为新算法测试提供开箱即用的支持。任何虫洞的目标都应该是通过提供高质量的数据和坚实的基础设施，以高度自信地大规模探索新算法，从而减少原型开发到生产的时间。实现这一点有助于形成一个丰富的个性化平台，帮助客户在正确的时间做出正确的决定。</p><h1 id="621b" class="kf kg hh bd kh ki kj kk kl km kn ko kp in kq io kr iq ks ir kt it ku iu kv kw bi translated">参考资料和相关工作</h1><p id="cecb" class="pw-post-body-paragraph ji jj hh jk b jl kx ii jn jo ky il jq jr kz jt ju jv la jx jy jz lb kb kc kd ha bi translated">[1] YouTube上的https://www.youtube.com/about/press/</p><p id="ce47" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">[2]施瓦茨，巴里。(2015).选择的悖论。10.1002/9781118996874.ch8</p><p id="1b16" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">[3]https://www.featurestore.org/<a class="ae ke" href="https://www.featurestore.org/" rel="noopener ugc nofollow" target="_blank"/></p><p id="1744" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">[4]https://en.wikipedia.org/wiki/Wormhole<a class="ae ke" href="https://en.wikipedia.org/wiki/Wormhole" rel="noopener ugc nofollow" target="_blank"/></p><p id="3123" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">[5]<a class="ae ke" href="https://en.wikipedia.org/wiki/Finite-state_machine" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Finite-state_machine</a></p><p id="c19b" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">[4]<a class="ae ke" href="https://databricks.com/session_na20/an-approach-to-data-quality-for-netflix-personalization-systems" rel="noopener ugc nofollow" target="_blank">https://databricks . com/session _ na20/an-approach-to-data-quality-for-网飞个性化系统</a></p><p id="8809" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">[5] Dasu，t .等人，“时间流的数据质量”<em class="lq"> IEEE数据工程。公牛。</em>39(2016):78–92。</p><p id="d26c" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">[6]<a class="ae ke" href="https://netflixtechblog.com/distributed-time-travel-for-feature-generation-389cccdd3907" rel="noopener ugc nofollow" target="_blank">https://netflixtechblog . com/distributed-time-travel-for-feature-generation-389 cccdd 3907</a></p></div><div class="ab cl lz ma go mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ha hb hc hd he"><p id="30ef" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><em class="lq">披露声明:2021资本一。观点是作者个人的观点。除非本帖中另有说明，否则Capital One不隶属于所提及的任何公司，也不被这些公司认可。使用或展示的所有商标和其他知识产权是其各自所有者的财产。</em></p><p id="764d" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><em class="lq">原载于</em><a class="ae ke" href="https://www.capitalone.com/tech/machine-learning/how-to-build-offline-evaluation-frameworks/" rel="noopener ugc nofollow" target="_blank"><em class="lq"/></a><em class="lq">。</em></p></div></div>    
</body>
</html>