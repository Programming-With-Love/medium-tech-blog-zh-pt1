<html>
<head>
<title>Access Recovery to AWS Instances if .Pem Key/File is lost</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">访问AWS实例的恢复，如果。Pem密钥/文件丢失</h1>
<blockquote>原文：<a href="https://medium.com/globant/access-recovery-to-aws-instances-if-pem-key-file-is-lost-928c63301643?source=collection_archive---------0-----------------------#2021-08-10">https://medium.com/globant/access-recovery-to-aws-instances-if-pem-key-file-is-lost-928c63301643?source=collection_archive---------0-----------------------#2021-08-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="0062" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak">简介</strong></h1><p id="72db" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">在AWS中，Linux实例通过。pem密钥/文件，。pem是一个私钥，其对应的公钥存储在服务器/实例上。当我们通过SSH访问实例时，身份验证使用私钥和公钥，如果这两者匹配，我们就可以访问实例。</p><h1 id="19d3" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak">背景</strong></h1><p id="98aa" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">有时，系统管理员或开发人员会在AWS中启动实例。他们曾经通过。pem key但有时系统会损坏或有人离开组织。在这种情况下，我们失去了信心。pem文件，最终无法访问实例。本文将帮助您理解连接实例的不同方式。</p><h1 id="6711" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak">点数覆盖</strong></h1><ol class=""><li id="c761" class="ka kb hh je b jf jg jj jk jn kc jr kd jv ke jz kf kg kh ki bi translated">先决条件</li><li id="ed31" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki bi translated">解决方法</li><li id="59d4" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki bi translated">摘要</li><li id="5073" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki bi translated">参考</li></ol><h1 id="ed83" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak"> 1)先决条件</strong></h1><ul class=""><li id="8185" class="ka kb hh je b jf jg jj jk jn kc jr kd jv ke jz ko kg kh ki bi translated">访问AWS平台</li><li id="ec3a" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">对EC2、EBS、IAM服务的写访问权限</li></ul><h1 id="7b46" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak"> 2)问题陈述</strong></h1><p id="88bc" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">在假设的情况下，如果你放错/丢失了。PEM AWS Linux实例的密钥，并且您希望出于任何目的访问您的服务器，那么我们可以获得它吗？</p><h1 id="59bd" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak"> 3)解了。Pem密钥/文件丢失问题</strong></h1><p id="157e" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">如果缺少实例，我们可以访问它。pem键使用以下任一解决方案。</p><p id="0fd5" class="pw-post-body-paragraph jc jd hh je b jf kp jh ji jj kq jl jm jn kr jp jq jr ks jt ju jv kt jx jy jz ha bi translated">A.高级材料情报(Advanced Material Information)</p><p id="7714" class="pw-post-body-paragraph jc jd hh je b jf kp jh ji jj kq jl jm jn kr jp jq jr ks jt ju jv kt jx jy jz ha bi translated">B.体积交换</p><p id="2fa2" class="pw-post-body-paragraph jc jd hh je b jf kp jh ji jj kq jl jm jn kr jp jq jr ks jt ju jv kt jx jy jz ha bi translated">C.SSM代理商</p><p id="44b2" class="pw-post-body-paragraph jc jd hh je b jf kp jh ji jj kq jl jm jn kr jp jq jr ks jt ju jv kt jx jy jz ha bi translated">D.用户数据</p><p id="6516" class="pw-post-body-paragraph jc jd hh je b jf kp jh ji jj kq jl jm jn kr jp jq jr ks jt ju jv kt jx jy jz ha bi translated">E.EC2 connect(兼容亚马逊Linux 2.2及以上或ubuntu 16.04及以上)</p><h1 id="9d2a" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak"> 3-A. AMI: </strong></h1><ul class=""><li id="c4a7" class="ka kb hh je b jf jg jj jk jn kc jr kd jv ke jz ko kg kh ki bi translated">代表亚马逊机器图像。通过AMI，创建一个新的AWS实例并启动它。</li><li id="79e4" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">选择您当前的实例。</li><li id="f971" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">右键单击它并选择选项创建AMI。</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/ec5ac21cc9c96ef809d20bc29699d7a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7c5Vv2UBxRhD2t8o"/></div></div></figure><ul class=""><li id="220e" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">给AMI一个名称，它将创建您的服务器的一个副本。</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/4256a360cb93a01d53527d4483aa0a3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vz6GKyDXUDAxJMIx"/></div></div></figure><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/52c8e6f6257a0eb1ead780c7deb65b36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mvdu9UmkGbtbUbM1"/></div></div></figure><ul class=""><li id="b1df" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">创建AMI后，选择AMI并右键单击它以选择启动选项。</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/81eea0436630bce5b77664458f2b799d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ec0cY_ds0KTMaNMb"/></div></div></figure><ul class=""><li id="a90f" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">启动过程将开始。</li><li id="706e" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">现在我们必须为启动AMI选择适当的细节，因为它将为我们创建一个新的服务器。</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/8732968f91365dce8ef87ed2f903b2d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*V5eG4BDS_LeRBdGj"/></div></div></figure><ul class=""><li id="9e60" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">VPC、子网等详细信息需要从配置实例选项中正确选择(参见下面的屏幕截图以供参考)，然后添加存储。</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/2c817ec3d51dc6dac210e816b46809c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nzUaXzKqoPpwlRHf"/></div></div></figure><ul class=""><li id="67de" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">选择创建新的密钥对，提供密钥对的名称并启动实例”。</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lj"><img src="../Images/301556df86cca37721e263411598d77f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9dzTy9iJrVcijawG"/></div></div></figure><ul class=""><li id="3be7" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">在我们尝试使用ssh连接之前，下载密钥对。</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/ee073f3c80501debd328d3d8c81fcfe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JwFcbySSnmrub5gv"/></div></div></figure><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/c7536ed00dc232623ed5a5db7dbee128.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9TH6gU4YOxH4Dwik"/></div></div></figure><h1 id="8131" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak"> 3-B .体积交换</strong></h1><ul class=""><li id="8649" class="ka kb hh je b jf jg jj jk jn kc jr kd jv ke jz ko kg kh ki bi translated">假设您有一台称为主服务器(假设是生产服务器)的服务器要通过卷交换进行恢复。</li><li id="6112" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">创建恢复服务器。</li><li id="b2e6" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">停止生产服务器，并删除/分离生产服务器的根卷。(记下根设备连接，例如这里是dev/xvda)</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/93c93a5ebae44438bbc354b7adeb4548.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LlXbR1dJY1InFD10"/></div></div></figure><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lk"><img src="../Images/3e78c81f9b10ebd871ac6a7c4d2a1ac9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qQTA2AA7ou9Zak8x"/></div></div></figure><ul class=""><li id="2ecf" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">将主服务器卷(根卷)作为辅助卷连接到恢复服务器</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/5b4571cbd1aa6948d56f8271a124022b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rGIJUQ3Lrp2wao4-"/></div></div></figure><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/5f724aab9899f0432488544a88151b5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*13KpSFno6zLT85_s"/></div></div></figure><ul class=""><li id="858a" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">登录到恢复服务器，转到此处作为辅助服务器连接的生产服务器的卷，使用以下命令找出可用卷。</li></ul><blockquote class="ll lm ln"><p id="55d1" class="jc jd lo je b jf kp jh ji jj kq jl jm lp kr jp jq lq ks jt ju lr kt jx jy jz ha bi translated">lsblk -f</p></blockquote><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/dbc6bb1209ca5aea7aefd1e0422cb6dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4HM19-7CxFEVtKUh"/></div></div></figure><p id="e0f9" class="pw-post-body-paragraph jc jd hh je b jf kp jh ji jj kq jl jm jn kr jp jq jr ks jt ju jv kt jx jy jz ha bi translated">为装载目的创建新目录</p><blockquote class="ll lm ln"><p id="6c1a" class="jc jd lo je b jf kp jh ji jj kq jl jm lp kr jp jq lq ks jt ju lr kt jx jy jz ha bi translated">sudo mkdir/tmp/tmp卷</p></blockquote><p id="4edd" class="pw-post-body-paragraph jc jd hh je b jf kp jh ji jj kq jl jm jn kr jp jq jr ks jt ju jv kt jx jy jz ha bi translated">要在旧的Amazon Linux上挂载:</p><blockquote class="ll lm ln"><p id="11b2" class="jc jd lo je b jf kp jh ji jj kq jl jm lp kr jp jq lq ks jt ju lr kt jx jy jz ha bi translated">sudo mount/dev/xvd f1/tmp/tmp volume</p></blockquote><p id="9f28" class="pw-post-body-paragraph jc jd hh je b jf kp jh ji jj kq jl jm jn kr jp jq jr ks jt ju jv kt jx jy jz ha bi translated">要在新的Amazon Linux上挂载:</p><blockquote class="ll lm ln"><p id="504b" class="jc jd lo je b jf kp jh ji jj kq jl jm lp kr jp jq lq ks jt ju lr kt jx jy jz ha bi translated">sudo mount-o nouid/dev/xvd f1/tmp/tmp volume</p></blockquote><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/6593a13e4d0fe305d9bf3ce9f06feb84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GAClyII3zfWhAyoA"/></div></div></figure><ul class=""><li id="ca10" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">将恢复实例的私钥复制到主实例authorized_keys的装载卷，您可以通过cat命令看到相同的内容</li></ul><blockquote class="ll lm ln"><p id="e69e" class="jc jd lo je b jf kp jh ji jj kq jl jm lp kr jp jq lq ks jt ju lr kt jx jy jz ha bi translated">比较ssh/authorized _ keys/tmp/tmp volume/home/ec2-user/。ssh/授权密钥</p></blockquote><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/a793bc56353743830b8b4c68f9be08fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ubY3E5hCdhTcz75T"/></div></div></figure><ul class=""><li id="df0b" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">从恢复服务器中卸载并分离我们作为辅助卷装载的卷。</li><li id="e0cb" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">卸载命令:</li></ul><blockquote class="ll lm ln"><p id="551b" class="jc jd lo je b jf kp jh ji jj kq jl jm lp kr jp jq lq ks jt ju lr kt jx jy jz ha bi translated">sudo卸载/tmp/tmp卷</p></blockquote><p id="85ae" class="pw-post-body-paragraph jc jd hh je b jf kp jh ji jj kq jl jm jn kr jp jq jr ks jt ju jv kt jx jy jz ha bi translated">要分离卷，请执行以下操作:</p><ul class=""><li id="f328" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">选择卷，右键单击并选择分离卷。</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ls"><img src="../Images/909b9abeff3a25b52024803e71b88d10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QS72Mbs7MRmKGL84"/></div></div></figure><ul class=""><li id="0616" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">单击是，分离按钮。</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/7b595ed0c55e8a36a85890cf6c450853.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IqCriu_Ya86_tlGP"/></div></div></figure><ul class=""><li id="33f0" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">将该卷作为根卷连接回生产服务器。(例如dev/xvda)</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/f09ac5ead88aa3d14af8f6de6573afda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SKtt04tYiXtGxShI"/></div></div></figure><ul class=""><li id="5522" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">再次启动生产服务器。</li><li id="18bf" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">尝试通过新复制的私钥进行ssh，在这种情况下，使用恢复服务器的pem文件登录到主服务器。</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/ddd6991171201dc1b8905d86d97e8932.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wl8EOHVyCn3ONK7w"/></div></div></figure><h1 id="dc23" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">3-C. SSM </h1><ul class=""><li id="6478" class="ka kb hh je b jf jg jj jk jn kc jr kd jv ke jz ko kg kh ki bi translated">为EC2实例创建IAM角色</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/a0663df7e3b2f02e0b634cd7ca024cfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ztjhm1-WINddgsOq"/></div></div></figure><ul class=""><li id="40e9" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">将AmazonSSMFullAccess策略附加到IAM角色</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/6a6b72f34655c5691a41306b9e511444.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*k6fwigHzOaLtt9RI"/></div></div></figure><ul class=""><li id="740d" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">将角色附加到EC2实例</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/1297f903e47f89a930b423b4f44ed6c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*C295su6lBuz3I1-v"/></div></div></figure><ul class=""><li id="c416" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">在实例上的SSM代理尝试重新连接或<strong class="je hi"> </strong>重启它以触发重试之前，最多等待30分钟。</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/1b4c6e7d9cc6b252cf280d35ee3d4fd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oN-EqMidOCiBbjB4"/></div></div></figure><h1 id="44bc" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak">三维用户数据</strong></h1><ul class=""><li id="e54d" class="ka kb hh je b jf jg jj jk jn kc jr kd jv ke jz ko kg kh ki bi translated">使用AWS CLI创建新的密钥对。</li></ul><blockquote class="ll lm ln"><p id="ebff" class="jc jd lo je b jf kp jh ji jj kq jl jm lp kr jp jq lq ks jt ju lr kt jx jy jz ha bi translated">AWS ec2 create-key-pair-key-name my-key-pair-query“key material”-output text &gt; my-key-pair . PEM</p></blockquote><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/bea76e95c8f40fead2fd355b8a91e551.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jO8OF4Md9fdlwExn"/></div></div></figure><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/9cd3722c1a83bece413dd953023183c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yadfzrSGP4q6hknC"/></div></div></figure><ul class=""><li id="058f" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">如果您在Amazon EC2控制台中创建了私钥，那么检索密钥对的公钥。</li></ul><blockquote class="ll lm ln"><p id="16cf" class="jc jd lo je b jf kp jh ji jj kq jl jm lp kr jp jq lq ks jt ju lr kt jx jy jz ha bi translated">ssh-keygen-y-f/pathofpemfile/PEM file</p></blockquote><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/42687eadfda54f4cfba0a353047cee4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TN-1pK9rKI1qExFm"/></div></div></figure><ul class=""><li id="caa6" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">打开Amazon EC2控制台。</li><li id="b981" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">停止您的实例。</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/84fde5c0dac0ac774828082d04ed4dd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YNXvPTYS6dZMMz0q"/></div></div></figure><ul class=""><li id="2cf1" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">选择操作、实例设置、编辑用户数据。</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/55927b4c29dfdba9e147eefc90d52777.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HlRma3cTbCI4EdPh"/></div></div></figure><ul class=""><li id="e7f3" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">将以下脚本复制到“编辑用户数据”对话框中:</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/210066e255001e477693f3764a1096fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UTRGKYk4zSbdV6Ze"/></div></div></figure><p id="726a" class="pw-post-body-paragraph jc jd hh je b jf kp jh ji jj kq jl jm jn kr jp jq jr ks jt ju jv kt jx jy jz ha bi translated">下面是用户数据文件</p><blockquote class="ll lm ln"><p id="7a04" class="jc jd lo je b jf kp jh ji jj kq jl jm lp kr jp jq lq ks jt ju lr kt jx jy jz ha bi translated">内容类型:多部分/混合；boundary = "//"<br/>MIME-Version:1.0<br/>—//<br/>Content-Type:text/cloud-config；charset = " us-ascii "<br/>MIME-Version:1.0<br/>Content-Transfer-Encoding:7 bit<br/>Content-Disposition:附件；filename = " cloud-config . txt "<br/><em class="hh"># cloud-config</em><br/>cloud _ final _ modules:<br/>-【users-groups，once】<br/>users:<br/>-name:username<br/>ssh-authorized _ keys:<br/>-您的公钥对</p></blockquote><ul class=""><li id="4639" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">用您的用户名替换username，例如ec2-user。您可以输入默认用户名，也可以输入自定义用户名。</li><li id="84b3" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">用从上述步骤中检索到的公钥替换PublicKeypair。确保输入完整的公钥，从ssh-rsa开始。</li><li id="53c3" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">选择保存。</li><li id="2f0f" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">启动您的实例。</li><li id="9c33" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">从用户数据字段中删除脚本很重要，因为它包含一个密钥对。</li><li id="276f" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">停止您的实例。</li><li id="f0d8" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">选择操作、实例设置、编辑用户数据。</li><li id="072b" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">删除“编辑用户数据”对话框中的所有文本，然后选择“保存”。</li><li id="d297" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">启动您的实例。</li></ul><h1 id="f3cc" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak"> 3-E. Ec2-连接</strong></h1><p id="e7bc" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated"><strong class="je hi">限制</strong></p><ul class=""><li id="a564" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">支持的Linux发行版支持:</li><li id="9825" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">亚马逊Linux 2(任何版本)</li><li id="b8c6" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">Ubuntu 16.04或更高版本</li><li id="fa09" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">您需要检查登录到系统(AWS控制台)的用户的权限—您的用户应该具有EC2连接权限。否则，在通过ec2 connect连接到Ec2时，您会收到一条错误消息</li><li id="ac31" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">您可以向您的用户添加权限</li><li id="bce3" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">转到IAM</li><li id="b3cc" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">选择您的用户</li><li id="c329" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">点击添加权限</li><li id="573d" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">选择适当的权限，如here-ec2 instacnecconnect</li><li id="2487" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">点击添加权限。</li></ul><p id="e77a" class="pw-post-body-paragraph jc jd hh je b jf kp jh ji jj kq jl jm jn kr jp jq jr ks jt ju jv kt jx jy jz ha bi translated">一旦添加，它将如下所示..</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/afeda0dd705a9d0e5c0d9c487f6aa800.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VyNZ1tZwJpIvHWQc"/></div></div></figure><ul class=""><li id="f252" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">要使用Amazon EC2控制台(基于浏览器的客户端)进行连接，实例必须有一个公共IPv4地址。</li><li id="eebf" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">如果实例没有公共IP地址，您可以使用SSH客户端或EC2 Instance Connect CLI通过专用网络连接到实例，例如从同一个VPC内的计算机或从通过VPN或AWS Direct Connect连接到VPC的计算机。</li><li id="9c83" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">EC2实例连接不支持使用IPv6地址的连接。</li><li id="a084" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">在https://console.aws.amazon.com/ec2/.<a class="ae lt" href="https://console.aws.amazon.com/ec2/." rel="noopener ugc nofollow" target="_blank">打开亚马逊EC2控制台</a></li><li id="3fd6" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">在导航窗格中，选择实例。</li><li id="8bcd" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">选择实例，然后选择“连接”。</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/1b3fc45de7aa2a74088c31b4b6b4f5f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*osGq9E6UvDppACOp"/></div></div></figure><ul class=""><li id="b9ef" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">选择EC2实例连接。</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lu"><img src="../Images/199bc95ad51cd1b2edf0c1696217450b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pi4D9MDCd-wtDsAy"/></div></div></figure><ul class=""><li id="b812" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">验证用户名，然后选取“连接”以打开终端窗口。</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lu"><img src="../Images/ecd928b65e56b8aadb9641195b1846cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3YhA-nczFUefItZo"/></div></div></figure><ul class=""><li id="7748" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">现在，一旦通过浏览器连接到实例，就可以复制系统的pub密钥或通过ssh-keygen创建一个新密钥，并将其保存到authorized_keys下。ssh文件夹。</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/ce32e2f61550cd1bf82a1964f858db2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yAdnbNSDzdpXD4qs"/></div></div></figure><ul class=""><li id="c659" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">现在，您可以通过ssh连接实例</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/773b9e330c5c5d22dc2642be7a25421f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jNV2_9Xdf-tYf0ia"/></div></div></figure><p id="8581" class="pw-post-body-paragraph jc jd hh je b jf kp jh ji jj kq jl jm jn kr jp jq jr ks jt ju jv kt jx jy jz ha bi translated">这样，您就可以连接到您的实例，而无需重新启动它。</p><h1 id="3ab7" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak"> 4)结论</strong></h1><p id="b47b" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">根据这篇文章，以下是解决方案选择的优先顺序。</p><ul class=""><li id="c22b" class="ka kb hh je b jf kp jj kq jn lg jr lh jv li jz ko kg kh ki bi translated">Ec2-Connect:将是最高优先级，因为这样我们可以避免停机。</li><li id="85d6" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">SSM:可以选择作为下一个重点，因为我们需要安装一个SSM代理。这种方法也可以避免停机。</li><li id="8498" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">User-Data:在这种情况下，需要重新启动以应用对用户数据的更改。</li><li id="f429" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">卷交换:这种方法需要时间来完成，也需要一些停机时间。</li><li id="96db" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz ko kg kh ki bi translated">AMI:将是最后一种方法，因为它将改变IP地址和实例ID。</li></ul><h1 id="ed03" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak"> 5)参考文献</strong></h1><ol class=""><li id="b785" class="ka kb hh je b jf jg jj jk jn kc jr kd jv ke jz kf kg kh ki bi translated"><a class="ae lt" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/session-manager.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/AWS C2/latest/user guide/session-manager . html</a></li><li id="8171" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki bi translated"><a class="ae lt" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/Connect-using-EC2-Instance-Connect.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/AWS C2/latest/user guide/Connect-using-EC2-Instance-Connect . html</a></li><li id="ac65" class="ka kb hh je b jf kj jj kk jn kl jr km jv kn jz kf kg kh ki bi translated"><a class="ae lt" href="https://aws.amazon.com/premiumsupport/knowledge-center/ec2-windows-replace-lost-key-pair/" rel="noopener ugc nofollow" target="_blank">https://AWS . Amazon . com/premium support/knowledge-center/ec2-windows-replace-lost-key-pair/</a></li></ol></div></div>    
</body>
</html>