<html>
<head>
<title>Gradle and AGP build APIs: Configure your build</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">格雷德和AGP构建API:配置您的构建</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/gradle-and-agp-build-apis-configure-your-build-9a10db5b2262?source=collection_archive---------1-----------------------#2021-11-18">https://medium.com/androiddevelopers/gradle-and-agp-build-apis-configure-your-build-9a10db5b2262?source=collection_archive---------1-----------------------#2021-11-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/23c70bdc81b12d7b6cb24dad0ddb0123.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WkRft2aAKv19MoIm.jpeg"/></div></div></figure><div class=""/><p id="9d54" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在关于<a class="ae jn" href="https://gradle.org/" rel="noopener ugc nofollow" target="_blank"> Gradle </a>和全新<a class="ae jn" href="https://developer.android.com/reference/tools/gradle-api" rel="noopener ugc nofollow" target="_blank"> Android Gradle插件API</a>的新MAD技能系列的第一篇文章中，我们将看看Android构建系统是如何工作的，并学习Gradle的基础知识。</p><p id="620a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们将从Gradle的构建阶段开始，讨论AGP的配置选项如何帮助定制您的构建，以及如何保持您的构建高效。如果你更喜欢视频形式的内容，可以看看下面的内容:</p><figure class="jo jp jq jr fd hj"><div class="bz dy l di"><div class="js jt l"/></div></figure><p id="0b3b" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">了解构建阶段如何工作以及如何配置Android Gradle插件可以帮助您根据项目需求定制构建。让我们切换到Android Studio，看看构建系统是如何工作的！</p><h2 id="1d02" class="ju jv hs bd jw jx jy jz ka kb kc kd ke ja kf kg kh je ki kj kk ji kl km kn ko bi translated">格拉德勒简介</h2><p id="a58f" class="pw-post-body-paragraph ip iq hs ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">Gradle是一个通用的构建自动化工具。虽然您可以使用Gradle来构建Android项目，但实际上您可以使用Gradle来构建任何类型的软件。</p><p id="5f8c" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Gradle支持单个或多个项目构建。要配置一个项目来使用gradle，您需要在项目文件夹中添加一个<code class="du ku kv kw kx b">build.gradle</code>文件。</p><p id="880a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在多项目层次结构中，根项目由一个<code class="du ku kv kw kx b">settings.gradle</code>文件组成，该文件列出了构建中包含的其他项目。Android使用多项目构建来帮助你模块化你的应用。</p><figure class="jo jp jq jr fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ky"><img src="../Images/42429e11bfe1fe8fdf1a516f4594d1e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*hizs4xOhmEspGORtYI5wWA.png"/></div></div><figcaption class="kz la et er es lb lc bd b be z dx">Android project structure with build.gradle and settings.gradle files.</figcaption></figure><p id="1a40" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">由于插件，Gradle能够处理不同类型的项目，如Android或Java。这些插件带有预定义的功能来配置和构建特定类型的项目。</p><p id="b814" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">例如，要构建一个Android项目，您需要用Android Gradle插件配置您的Gradle构建文件。Android Gradle插件知道如何构建和打包一个Android项目，无论是app还是库。</p><h2 id="7c48" class="ju jv hs bd jw jx jy jz ka kb kc kd ke ja kf kg kh je ki kj kk ji kl km kn ko bi translated">任务</h2><p id="be39" class="pw-post-body-paragraph ip iq hs ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">Gradle的构建过程围绕着称为任务的工作单元。您可以通过使用终端或在android studio的gradle窗格中启用任务列表来查看任务列表。</p><figure class="jo jp jq jr fd hj er es paragraph-image"><div class="er es ld"><img src="../Images/d503166abbd0ab2bddcceae4a99be6ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*imF89axuUdQc1in2n49yBg.png"/></div><figcaption class="kz la et er es lb lc bd b be z dx">List of Gradle Tasks</figcaption></figure><p id="82a4" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这些任务接收输入，采取行动执行某些工作，并作为它们执行的行动的结果产生输出。</p><p id="90f2" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Android Gradle插件定义了自己的任务，并且知道这些任务需要以什么顺序运行来构建一个Android项目。</p><p id="d4e4" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Gradle构建文件由不同的部分组成。配置语法被称为<a class="ae jn" href="https://docs.gradle.org/current/dsl/index.html" rel="noopener ugc nofollow" target="_blank"> Gradle DSL </a>，为开发者定义了一种配置插件的方式。Gradle解析<code class="du ku kv kw kx b">build.gradle</code>文件中的android DSL块，创建<code class="du ku kv kw kx b">ApplicationExtension</code>、<code class="du ku kv kw kx b">BuildType</code>等AGP DSL对象。</p><p id="39a9" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">一个典型的Android项目有一个顶级的Gradle构建文件。android项目中的每个模块都有一个单独的Gradle构建文件。在这个项目中，我有一个单独的应用程序模块。</p><p id="ae16" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在模块级<code class="du ku kv kw kx b">build.gradle</code>文件中，我需要声明并应用构建项目所需的插件。为了告诉Gradle我正在构建一个Android项目，我需要应用<code class="du ku kv kw kx b">com.android.application</code>或<code class="du ku kv kw kx b">com.android.library</code>插件。这些插件分别定义了如何配置和构建android应用程序或库。在这种情况下，我正在构建一个Android应用程序项目，所以我需要应用<code class="du ku kv kw kx b">com.android.application</code>插件。在这个示例中，还应用了<code class="du ku kv kw kx b">kotlin.android</code>插件，因为我将使用Kotlin。</p><pre class="jo jp jq jr fd le kx lf lg aw lh bi"><span id="e58c" class="ju jv hs kx b fi li lj l lk ll">plugins <strong class="kx ht">{<br/>    </strong>id 'com.android.application'<br/>    id 'org.jetbrains.kotlin.android'<br/><strong class="kx ht">}</strong></span></pre><p id="d4f2" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Android Gradle Plugin提供了自己的DSL，您可以使用它来配置它，并在构建期间将此配置提供给任务。</p><p id="0067" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要配置Android Gradle插件，需要使用<code class="du ku kv kw kx b">android</code>块。在这个模块中，您可以为不同的构建类型(如<code class="du ku kv kw kx b">debug</code>或<code class="du ku kv kw kx b">release</code>)定义sdk和工具版本、应用程序细节和其他配置。如果您想了解更多关于gradle如何使用这些信息来创建变体，以及您可以使用哪些其他选项，请查看<a class="ae jn" href="https://developer.android.com/studio/build" rel="noopener ugc nofollow" target="_blank">构建文档</a>。</p><pre class="jo jp jq jr fd le kx lf lg aw lh bi"><span id="8443" class="ju jv hs kx b fi li lj l lk ll">android <strong class="kx ht">{<br/>    </strong>compileSdk 31<br/><br/>    defaultConfig <strong class="kx ht">{<br/>        </strong>applicationId "com.example.myapp"<br/>        minSdk 21<br/>        targetSdk 31<br/>        versionCode 1<br/>        versionName "1.0"<br/><br/>        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"<strong class="kx ht"><br/>    }<br/><br/>    </strong>buildTypes <strong class="kx ht">{<br/>        </strong>release <strong class="kx ht">{<br/>            </strong>minifyEnabled false<br/>            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'<br/>        <strong class="kx ht">}<br/>    }<br/>    </strong>compileOptions <strong class="kx ht">{<br/>        </strong>sourceCompatibility JavaVersion.<em class="lm">VERSION_1_8<br/>        </em>targetCompatibility JavaVersion.<em class="lm">VERSION_1_8<br/>    </em><strong class="kx ht">}<br/>    </strong>kotlinOptions <strong class="kx ht">{<br/>        </strong>jvmTarget = '1.8'<br/>    <strong class="kx ht">}<br/>}</strong></span></pre><p id="6159" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在下一节中，您可以定义依赖关系。Gradle的依赖管理支持与Maven和Ivy兼容的库，以及来自文件系统的本地二进制文件。</p><pre class="jo jp jq jr fd le kx lf lg aw lh bi"><span id="a9d5" class="ju jv hs kx b fi li lj l lk ll">dependencies <strong class="kx ht">{<br/><br/>    </strong>implementation 'androidx.core:core-ktx:1.7.0'<br/>    implementation 'com.google.android.material:material:1.4.0'<br/>    implementation 'androidx.lifecycle:lifecycle-runtime-ktx:2.4.0'<br/>    testImplementation 'junit:junit:4.13.2'<br/>    androidTestImplementation 'androidx.test.ext:junit:1.1.3'<br/>    androidTestImplementation 'androidx.test.espresso:espresso-core:3.4.0'<br/>   <br/><strong class="kx ht">}</strong></span></pre><h2 id="22da" class="ju jv hs bd jw jx jy jz ka kb kc kd ke ja kf kg kh je ki kj kk ji kl km kn ko bi translated">构建阶段</h2><p id="968e" class="pw-post-body-paragraph ip iq hs ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">Gradle分三个阶段评估和运行构建。<a class="ae jn" href="https://docs.gradle.org/current/userguide/build_lifecycle.html" rel="noopener ugc nofollow" target="_blank">初始化、配置和执行</a>。</p><p id="d262" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在初始化阶段，Gradle决定构建中包含哪些项目，并为每个项目创建一个<code class="du ku kv kw kx b">Project</code>实例。为了决定构建中包含哪些项目，Gradle首先查找<code class="du ku kv kw kx b">settings.gradle</code>文件，以决定是单项目构建还是多项目构建。</p><p id="804d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在配置阶段，Gradle评估构建中包含的项目的所有构建脚本，应用插件，使用DSL对象配置构建，最后惰性地注册任务及其输入。</p><p id="c770" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">请注意，无论请求运行哪个任务，配置阶段都会运行。为了保持您的构建简短高效，请避免在配置阶段执行任何耗时的操作。</p><p id="87f1" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最后，在执行阶段，Gradle执行构建所需的任务集。</p><p id="40ca" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在下一篇文章中，我们将在编写我们自己的插件时更仔细地研究这些阶段。</p><p id="de99" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Gradle DSL支持Groovy和Kotlin脚本构建文件。到目前为止，我使用Groovy DSL脚本来配置这个项目的构建。您可以在下面的Kotlin和Groovy脚本中看到相同的构建文件。注意kotlin脚本的文件名。kts后缀。</p><figure class="jo jp jq jr fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ln"><img src="../Images/201b15269468650f6ef6694d6b308f0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NWHd6-YEXq-4n5hkD7m5XA.png"/></div></div><figcaption class="kz la et er es lb lc bd b be z dx">Kotlin and Groovy script side by side.</figcaption></figure><p id="cfb3" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">从groovy迁移到Kotlin或者相反，都不会改变执行任务的方式。</p><h2 id="3c59" class="ju jv hs bd jw jx jy jz ka kb kc kd ke ja kf kg kh je ki kj kk ji kl km kn ko bi translated">摘要</h2><p id="5eb6" class="pw-post-body-paragraph ip iq hs ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">就这样，至少对于这篇文章来说是这样。Gradle和Android Gradle插件有许多功能，允许你定制你的构建。在本文中，您了解了Gradle任务的基础知识、构建阶段、如何配置AGP以及如何使用DSL定制您的构建。</p><p id="4c0e" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">接下来，你将看到如何使用AGP的变体API通过编写你自己的插件来扩展你的构建。</p></div></div>    
</body>
</html>