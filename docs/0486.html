<html>
<head>
<title>Code expressivity++ with operator overloading</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有运算符重载的代码expressivity++</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/code-expressivity-with-operator-overloading-ada22a0ca633?source=collection_archive---------0-----------------------#2020-04-13">https://medium.com/androiddevelopers/code-expressivity-with-operator-overloading-ada22a0ca633?source=collection_archive---------0-----------------------#2020-04-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/3ddd9c1cac2eafce652dab2f498316af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kwuuccCqAXi3wgua"/></div></div></figure><div class=""/><div class=""><h2 id="129b" class="pw-subtitle-paragraph ip hr hs bd b iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg dx translated">科特林词汇</h2></div><p id="64ae" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">当我们处理可以添加、删除、比较或连接的类型时，我们最终会得到需要反复编写的冗长代码。在Kotlin中，借助于<a class="ae kd" href="https://kotlinlang.org/docs/reference/operator-overloading.html" rel="noopener ugc nofollow" target="_blank">操作符重载</a>，我们可以为这些类型编写更具表现力和简洁的代码。</p><p id="0fe9" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">我像热爱Android一样热爱的一件事是在唱诗班唱歌，所以让我们用一个歌手唱诗班的例子来说明运营商重载的好处。假设我们有一个歌手合唱团，我们想在我们的合唱团中增加一名歌手。我们将编写如下所示的代码:</p><figure class="ke kf kg kh fd hj"><div class="bz dy l di"><div class="ki kj l"/></div></figure><p id="64c7" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">我们会增加一个新的歌手，像这样:</p><pre class="ke kf kg kh fd kk kl km kn aw ko bi"><span id="b46e" class="kp kq hs kl b fi kr ks l kt ku">choir.addSinger(singer)</span></pre><p id="dfa4" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">但是这种操作更适合于<code class="du kv kw kx kl b">+=</code>操作符，所以调用它会感觉更自然:</p><pre class="ke kf kg kh fd kk kl km kn aw ko bi"><span id="cbb6" class="kp kq hs kl b fi kr ks l kt ku">choir += singer</span></pre><p id="40a1" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">请继续阅读，寻找答案:</p><ul class=""><li id="2fa9" class="ky kz hs jj b jk jl jn jo jq la ju lb jy lc kc ld le lf lg bi translated">如何用<a class="ae kd" href="https://kotlinlang.org/docs/reference/operator-overloading.html" rel="noopener ugc nofollow" target="_blank">操作符重载</a>在Kotlin中实现这个？</li><li id="1ae4" class="ky kz hs jj b jk lh jn li jq lj ju lk jy ll kc ld le lf lg bi translated">什么样的操作符可以实现，你可以在Android的什么地方利用它们。</li><li id="1f71" class="ky kz hs jj b jk lh jn li jq lj ju lk jy ll kc ld le lf lg bi translated">编写自己的运算符时需要注意的最佳实践。</li><li id="5f5b" class="ky kz hs jj b jk lh jn li jq lj ju lk jy ll kc ld le lf lg bi translated">Kotlin编译器在幕后做什么。</li></ul><h1 id="c309" class="lm kq hs bd ln lo lp lq lr ls lt lu lv iy lw iz lx jb ly jc lz je ma jf mb mc bi translated">运算符重载基础</h1><p id="572d" class="pw-post-body-paragraph jh ji hs jj b jk md it jm jn me iw jp jq mf js jt ju mg jw jx jy mh ka kb kc ha bi translated">通过运算符重载，您可以为任何类型的预定义运算符集提供实现。运算符要么通过成员函数重载，要么通过使用相应成员函数的扩展函数重载。例如，<code class="du kv kw kx kl b">+</code>操作符可以通过<code class="du kv kw kx kl b">plus()</code>函数重载，<code class="du kv kw kx kl b">+=</code>操作符可以通过<code class="du kv kw kx kl b">plusAssign()</code>函数重载。注意操作者不连锁:如果你过载<code class="du kv kw kx kl b">+</code>，<code class="du kv kw kx kl b">++</code>也不会被照顾。</p><p id="7a69" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">要重载一个操作符，你需要在fun之前使用operator关键字，然后指定你想要重载哪个操作符。如果不使用operator关键字，编译器会将其视为普通的Kotlin函数，甚至不会编译！</p><p id="f42f" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">以下是可以在Kotlin中重载的操作符:</p><figure class="ke kf kg kh fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mi"><img src="../Images/30b52c3260326aee5c209dc4bf171a75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*p6d2NC92Bjd45dXo"/></div></div><figcaption class="mj mk et er es ml mm bd b be z dx">For a full list of operators that can be overloaded and their corresponding functions, see <a class="ae kd" href="https://kotlinlang.org/docs/reference/operator-overloading.html" rel="noopener ugc nofollow" target="_blank">here</a>.</figcaption></figure><h1 id="9e1c" class="lm kq hs bd ln lo lp lq lr ls lt lu lv iy lw iz lx jb ly jc lz je ma jf mb mc bi translated">怎么做</h1><p id="82d0" class="pw-post-body-paragraph jh ji hs jj b jk md it jm jn me iw jp jq mf js jt ju mg jw jx jy mh ka kb kc ha bi translated">好吧，我们开始吧。我们如何让Kotlin中的操作符过载？</p><p id="3754" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">让我们使用最初例子中的choir类；我们需要重载<code class="du kv kw kx kl b">+=</code>操作符来添加歌手。</p><figure class="ke kf kg kh fd hj"><div class="bz dy l di"><div class="ki kj l"/></div></figure><p id="0e5f" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">您可以像这样使用运算符:</p><figure class="ke kf kg kh fd hj"><div class="bz dy l di"><div class="ki kj l"/></div></figure><p id="39d0" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">瞧啊。重载的操作符使得代码更加易读和简洁。</p><h1 id="0eff" class="lm kq hs bd ln lo lp lq lr ls lt lu lv iy lw iz lx jb ly jc lz je ma jf mb mc bi translated">您希望重载哪些其他运算符？</h1><p id="223e" class="pw-post-body-paragraph jh ji hs jj b jk md it jm jn me iw jp jq mf js jt ju mg jw jx jy mh ka kb kc ha bi translated">为一个自定义类型重载所有的操作符可能没有意义，但是通常你需要不止一个。过度使用会损害可读性，所以花些时间考虑一下你的类型以及什么重载会提高你的代码。</p><p id="891f" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">我们重载了<code class="du kv kw kx kl b">+=</code>操作符来添加某人到合唱团，但是我们也可能想要查看某个人是否已经是合唱团的成员。为此，让我们重载contains操作符，这样我们就可以使用in关键字。</p><figure class="ke kf kg kh fd hj"><div class="bz dy l di"><div class="ki kj l"/></div></figure><figure class="ke kf kg kh fd hj"><div class="bz dy l di"><div class="ki kj l"/></div></figure><h1 id="5bfa" class="lm kq hs bd ln lo lp lq lr ls lt lu lv iy lw iz lx jb ly jc lz je ma jf mb mc bi translated">扩展中的运算符重载</h1><p id="a07d" class="pw-post-body-paragraph jh ji hs jj b jk md it jm jn me iw jp jq mf js jt ju mg jw jx jy mh ka kb kc ha bi translated">您也可以在扩展函数中使用运算符重载。在这个例子中，我们为ViewGroup重载了<code class="du kv kw kx kl b">+=</code>操作符:</p><pre class="ke kf kg kh fd kk kl km kn aw ko bi"><span id="69d2" class="kp kq hs kl b fi kr ks l kt ku">operator fun ViewGroup.plusAssign(other: View) = addView(other)</span></pre><p id="c0f8" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">现在向视图组添加视图非常简单！！</p><pre class="ke kf kg kh fd kk kl km kn aw ko bi"><span id="79df" class="kp kq hs kl b fi kr ks l kt ku">viewGroup += view</span></pre><h1 id="b51a" class="lm kq hs bd ln lo lp lq lr ls lt lu lv iy lw iz lx jb ly jc lz je ma jf mb mc bi translated">其他语言的最佳实践</h1><p id="cdfe" class="pw-post-body-paragraph jh ji hs jj b jk md it jm jn me iw jp jq mf js jt ju mg jw jx jy mh ka kb kc ha bi translated">运算符重载也在许多其他语言中使用，包括C++、Python、Swift和PHP。虽然我们现在还没有Kotlin的明确的最佳实践，但是我们可以从其他语言中学习一些:</p><ul class=""><li id="a38e" class="ky kz hs jj b jk jl jn jo jq la ju lb jy lc kc ld le lf lg bi translated">简洁并不总是等于更易读的代码。考虑一下，如果添加了运算符重载，您的代码是否真的更易读。</li><li id="604e" class="ky kz hs jj b jk lh jn li jq lj ju lk jy ll kc ld le lf lg bi translated">如果你重载的结果在语言的上下文中没有意义或者不清楚，你应该使用一个函数来代替。例如，如果你添加了两本书，最终产品会是什么并不明显。会是一本新书吗？它们将如何组合？如果你一定要问，那么你应该用一个函数来代替。</li><li id="4222" class="ky kz hs jj b jk lh jn li jq lj ju lk jy ll kc ld le lf lg bi translated">如果一个操作符过载，<strong class="jj ht">仔细想想其他操作符，人们可能也会过载</strong>。例如，如果你让<code class="du kv kw kx kl b">-</code>过载，你也会想让<code class="du kv kw kx kl b">-=</code>过载。在我们的唱诗班示例中，因为我们能够使用<code class="du kv kw kx kl b">+=</code>添加歌手，所以我们也应该能够使用<code class="du kv kw kx kl b">-=</code>删除歌手。</li></ul><h1 id="f808" class="lm kq hs bd ln lo lp lq lr ls lt lu lv iy lw iz lx jb ly jc lz je ma jf mb mc bi translated">引擎盖下是什么？</h1><p id="796b" class="pw-post-body-paragraph jh ji hs jj b jk md it jm jn me iw jp jq mf js jt ju mg jw jx jy mh ka kb kc ha bi translated">运算符重载是通过用标准函数调用重写运算符来实现的。例如，添加合唱团成员的代码是:</p><figure class="ke kf kg kh fd hj"><div class="bz dy l di"><div class="ki kj l"/></div></figure><p id="7542" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">如果我们看看反编译的Java代码，我们可以看到这是如何工作的:</p><figure class="ke kf kg kh fd hj"><div class="bz dy l di"><div class="ki kj l"/></div></figure><p id="9c77" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">编译器简单地用一个普通的成员函数调用替换了<code class="du kv kw kx kl b">+=</code>。</p><h1 id="3cff" class="lm kq hs bd ln lo lp lq lr ls lt lu lv iy lw iz lx jb ly jc lz je ma jf mb mc bi translated">结论</h1><p id="58f6" class="pw-post-body-paragraph jh ji hs jj b jk md it jm jn me iw jp jq mf js jt ju mg jw jx jy mh ka kb kc ha bi translated">必须小心使用运算符重载；但是当你这样做的时候，它是一个强大的工具，可以让你的代码更有表现力，更简洁。</p><ul class=""><li id="8a60" class="ky kz hs jj b jk jl jn jo jq la ju lb jy lc kc ld le lf lg bi translated">确保使用operator关键字，否则Kotlin会将您的函数视为普通函数，您的代码将无法编译。</li><li id="0d2a" class="ky kz hs jj b jk lh jn li jq lj ju lk jy ll kc ld le lf lg bi translated">检查重载操作符是否真的会使你的代码可读性更好。</li><li id="c4ce" class="ky kz hs jj b jk lh jn li jq lj ju lk jy ll kc ld le lf lg bi translated">仔细考虑哪些运算符对重载您的类型有意义。</li></ul><p id="ceac" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">加入我赞美运营商超载的合唱团吧！</p><p id="4052" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">我在唱诗班演唱的额外照片！</p><figure class="ke kf kg kh fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mn"><img src="../Images/24ffef83a842e3d2440b8a6448f51c2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*46Mo0KbQnvsrr8O6"/></div></div></figure></div></div>    
</body>
</html>