<html>
<head>
<title>Building a Label-Based Enforcement Pipeline for Trust &amp; Safety</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建基于标签的信任和安全执行渠道</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/building-a-label-based-enforcement-pipeline-for-trust-safety-4b05a409cb5d?source=collection_archive---------3-----------------------#2021-05-21">https://medium.com/pinterest-engineering/building-a-label-based-enforcement-pipeline-for-trust-safety-4b05a409cb5d?source=collection_archive---------3-----------------------#2021-05-21</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="2559" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Sharon Xie|软件工程师，信任与安全</p><p id="f47e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">随着Pinterest随着用户和企业数量的增加而增长，提供安全可信的体验是我们的首要任务之一。每天，这个平台都会提供数十亿个图钉和图板来激励玩家。由于有如此多的pin和活动，在解锁高质量内容分发的同时，为内容安全提供及时和一致的决策可能是一项挑战。在这篇博文中，我们将从技术上深入探讨我们所面临的问题，并展示我们如何构建基于标签的执行管道来解决这些问题并大规模打击滥用行为。</p><h1 id="3410" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">背景</h1><h2 id="800a" class="ka jd hh bd je kb kc kd ji ke kf kg jm ip kh ki jq it kj kk ju ix kl km jy kn bi translated">信号产品的基础设施成本增长</h2><p id="0d6d" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">在Pinterest的早期阶段，阻止列表是内容过滤器最广泛采用的信号存储(包含要从产品表面阻止的内容的id)。它被部署在每一个提供服务的主机上，Apache Zookeeper作为它的同步服务。阻止列表中的所有项目都将被加载到内存中。每当有更新时，整个阻止列表将被推送到每台主机，从而消耗带宽。随着内容数量的增长，阻止列表的大小已经增加到相当大的规模。规模的显著增长不仅给产品主机带来了越来越大的内存压力，而且每年都会产生不断增长的基础设施成本。随着这些问题越来越多，我们意识到黑名单已经不足以支撑Pinterest的增长。</p><h2 id="3ab5" class="ka jd hh bd je kb kc kd ji ke kf kg jm ip kh ki jq it kj kk ju ix kl km jy kn bi translated">跨系统的执行差异</h2><p id="88ae" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">随着Pinterest工程团队的成长，团队通常会孤立地构建系统，彼此之间不会进行通信。由此引发的一个棘手问题是，如果Pin被不同的自动化系统删除，我们的审查代理无法获得执行的完整视图来正确处理用户上诉请求。</p><h2 id="ff0e" class="ka jd hh bd je kb kc kd ji ke kf kg jm ip kh ki jq it kj kk ju ix kl km jy kn bi translated">信号实施可能很复杂</h2><p id="45ee" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">确定如何将多个信号合成到一个策略实施中可能很复杂，并且来自不同类型系统的信号质量可能会有所不同。我们还必须找出如何最大限度地减少自动化系统的误报，以便Pinterest上的企业和创作者不会受到负面影响。此外，不同的表面对信号质量有不同的要求。例如，推荐表面通常需要具有较低假阳性的信号，而通知表面需要具有较低假阴性的信号。我们必须弄清楚如何在每个表面上收集最相关的信号，以便Pinterest用户能够获得最佳的产品体验。</p><h1 id="07c8" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">基于标签的执行管道</h1><p id="a187" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">为了及时、一致和灵活地实施信任和安全策略，我们构建了一个基于标签的实施管道。该管道使用来自各种产品和政策利益相关方的标签，并呈现最相关的标签以用于对内容进行操作，例如根据产品表面进行过滤(例如主页订阅或搜索)。在本节中，我们将介绍端到端实施管道的构建模块。</p><h2 id="3bde" class="ka jd hh bd je kb kc kd ji ke kf kg jm ip kh ki jq it kj kk ju ix kl km jy kn bi translated">标签</h2><p id="0542" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">标签是一个节约结构，它捕获源、时间、建议的实施和原因:</p><ul class=""><li id="f32b" class="kt ku hh ig b ih ii il im ip kv it kw ix kx jb ky kz la lb bi translated">来源表示“谁”创建了标签。它包括关于源系统、源类型(自动、人工)和名称的信息。</li><li id="8f58" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated">建议的实施指示“什么”是被标记的实体的可见性状态。有些内容，比如色情，在Pinterest上是不允许的，我们会删除。其他类型的内容，如自拍，可能不违反政策，但如果它对Pinners没有启发性，我们可能会希望限制它的分发。</li><li id="6d94" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated">时间表示由给定源产生强制的“时间”。这也是标签新鲜度的关键信号。</li><li id="5da6" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated">原因表示“为什么”根据违反了哪个策略来执行，例如垃圾邮件、色情或错误信息。</li></ul><p id="c3e7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">标签可以与任何实体相关联，例如引脚、电路板、用户等。图1显示了一个带有Pin实体的标签示例。在示例中，有两个标签与ID为1233211212的Pin相关联。一个标签来自人类审查系统，该系统建议阻止平台上的Pin分发，因为它违反了我们社区指南的色情部分。另一个标签来自一个自动化系统，该系统建议限制平台的Pin分发，因为它违反了我们社区指南的垃圾邮件部分。</p><figure class="li lj lk ll fd lm er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es lh"><img src="../Images/2bc756f061fea30803571805c0b1659b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qtPC71zf87foBbv9FSAZoQ.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx">Figure 1. Labels with Pin</figcaption></figure><h2 id="fef6" class="ka jd hh bd je kb kc kd ji ke kf kg jm ip kh ki jq it kj kk ju ix kl km jy kn bi translated">将商店贴上真理之源的标签</h2><figure class="li lj lk ll fd lm er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es lx"><img src="../Images/5ff9f5c70a655d163a57a41966022fb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J0JzthYkqiFiSbziYAMgrg.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx">Figure 2. Label-Based Enforcement Pipeline</figcaption></figure><p id="3d56" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">基于标签的执行管道涉及从标签创建到标签服务的整个过程。在Pinterest，信任与安全执行的标签可以来自定期更新的批次，也可以来自流媒体源，如图2所示。批量标签集包括Pinterest大数据平台中运行的批量作业生成的所有标签，如ML模型推理、关键业务数据连接等。这些标签通常每天出现一次，其服务SLA为24小时。另一方面，流标签捕获由integrity系统或流作业生成的标签，如审查工具、管理应用程序、实时滥用检测系统和实时ML模型推断。这些标签通常可以在创建后五分钟内送达。为了克服我们前面讨论的与来自不同系统的分布式标签相关的挑战，我们构建了一个统一的标签存储来托管所有标签，而不管它们的来源。构建集中式标签存储有两个主要优势:</p><ul class=""><li id="bcac" class="kt ku hh ig b ih ii il im ip kv it kw ix kx jb ky kz la lb bi translated">它克服了块列表的存储限制，并且可以在数据量或服务请求增加时水平扩展。</li><li id="9afa" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated">它允许我们集中管理标签生命周期，为标签提供单一的真实来源。这使得支持对操作更新的可靠审计和一致的标签服务变得更加容易。</li></ul><p id="f8fc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们采用了Pinterest的内部键值数据解决方案，该方案使用<a class="ae ly" rel="noopener" href="/pinterest-engineering/open-sourcing-rocksplicator-a-real-time-rocksdb-data-replicator-558cd3847a9d"> Rocksplicator </a>构建，用于数据存储。图3显示了我们的数据模型。实体，如引脚、电路板或用户，被建模为主键。给定实体的所有标签被聚集在一起用于快速查询。标签源被建模为特征键，其中支持诸如添加、删除和更新之类的原子操作。</p><figure class="li lj lk ll fd lm er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es lz"><img src="../Images/50df089f7283a784eab7c8bf9558d069.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YbDBdv21ICI66S3dffWOSQ.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx">Figure 3. Label Store Data Model</figcaption></figure><p id="81de" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所有标注操作都在一个标注操作任务中运行。这个任务由一个作业服务ak <a class="ae ly" rel="noopener" href="/@Pinterest_Engineering/pinlater-an-asynchronous-job-execution-system-b8664cb8aa7d"> PinLater </a>管理，它负责注入速率、任务并发和客户端重试。它确保标签可以正确地添加到标签存储中或从标签存储中删除。该任务还与标签检查器一起执行标签清理和初步检查。标签检查器在两个方面在执行管道中充当关键角色:它确保在数据库中不会创建格式错误的标签或重复的标签，并且它使用试探法来防止重要的业务合作伙伴受到误报的影响。例如，如果一个自动化系统将一个负面标签放在一个可信的创建者身上，标签检查器将检测到这种情况，并触发一个代理对来自这个伙伴的内容进行检查。在检讨完成前，不会采取任何执法行动。</p><p id="0fb6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">标签存储还提供了一个API来返回给定实体的所有标签。这个API与标签选择器一起为不同的应用程序分组标签。标签选择器可以很容易地配置为过滤出匹配源查询的标签。图4显示了一个配置示例，该配置从系统2为实体返回所有人工标签和所有自动化标签。</p><figure class="li lj lk ll fd lm er es paragraph-image"><div class="er es ma"><img src="../Images/9a985635088f78b8ec9bedb1eec4e3ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*NfCVU46CyFt-I2q9P5vYmg.png"/></div><figcaption class="lt lu et er es lv lw bd b be z dx">Figure 4. Example of Source Config</figcaption></figure><p id="3f33" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">标签冲突解决程序是为所选标签提供排名功能的组件。我们应用排名函数来呈现最终的标签以用于生产。下面的等式说明了这一点。标签源信誉和标签新鲜度都被加权以构建解析器函数。</p><figure class="li lj lk ll fd lm er es paragraph-image"><div class="er es mb"><img src="../Images/f278b6faf160b02ed8c0c1c221f3c430.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/1*XEF2w1tZ6wKGrEPP_L2FnA.png"/></div><figcaption class="lt lu et er es lv lw bd b be z dx">Figure 5. Example Ranking Equation</figcaption></figure><p id="6ae3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在实践中，标签冲突解决器和标签选择器使信任和安全团队能够在不同的Pinterest产品表面上以最相关的方式操作。这是因为源选择器允许我们收集符合特定表面过滤SLA的标签，并且标签解析器确保将最合适的试探法应用于实体实施。实体的最终实施是通过API来完成的。所有Pinterest公共表面都可以与API集成，以阻止不良内容，而我们的内部工具可以利用API来了解内容服务状态，并对有害内容采取进一步行动。</p><h1 id="8db0" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">生产结果</h1><p id="fec2" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">在推出标签执行管道并将其与我们最关键的产品表面(如home feed和search)整合后，我们能够利用来自我们的代理审查工具和ML平台的数千个高质量标签。我们设法获得了可伸缩性的改进。即使我们将检查从内存中转移到了服务调用中，我们也可以更有效地针对不良内容执行检查。性能没有明显下降，例如延迟和成功率。由于设计周到，我们还能够最大限度地减少假阳性的影响，使它们不会对Pinners或合作伙伴产生不利影响。当在实验后测试标签商店时，我们已经看到了用户参与度的重要积极指标，随着越来越多的表面与标签商店集成，这种影响将继续增长。</p><p id="9f4c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过集中执行标签，我们设法为所有客户提供执行一致性和透明度。以前，找出一个Pin被删除的原因意味着搜索多个系统和表来找到结果。现在，有一个单一的搜索中心来概述标签强制变更事件的历史。最终，对于我们的用户和广告商来说，标签商店已经成为保持Pinterest安全的最重要工具之一。</p><h1 id="4b42" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">承认</h1><p id="70e5" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">非常感谢Revant Kapoor、Nilesh Gohel、陈新元、王加斌、Abhishek Jathan、Vladimir Mikhaylovskiy、Jared Wong、Farran Wang、Alok Singhal、蔡美诗·萨缪尔森以及Trust &amp; Safety团队的其他成员帮助设计和建造执行管道和工具！感谢哈里·沙曼斯基对这篇博文的帮助！</p></div></div>    
</body>
</html>