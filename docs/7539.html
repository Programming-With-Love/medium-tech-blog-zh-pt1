<html>
<head>
<title>Automatically Manage and Maintain Oracle Transparent Database Encryption Secrets Using Oracle Clusterware Resource and Hashicorp Vault</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Oracle集群件资源和Hashicorp Vault自动管理和维护Oracle透明数据库加密机密</h1>
<blockquote>原文：<a href="https://medium.com/version-1/automatically-manage-and-maintain-oracle-transparent-database-encryption-secrets-using-oracle-6f4bfdaa1956?source=collection_archive---------2-----------------------#2022-04-21">https://medium.com/version-1/automatically-manage-and-maintain-oracle-transparent-database-encryption-secrets-using-oracle-6f4bfdaa1956?source=collection_archive---------2-----------------------#2022-04-21</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/6b063cefbdd63ca46692b450f2df4fe5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iymswMkks3KxhQMZgzBWDg.png"/></div></div></figure><h1 id="59a5" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated"><strong class="ak">背景</strong></h1><p id="54aa" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">几年前，第1版的一个客户做出了一个战略决策，让所有Oracle数据库使用数据库加密技术作为加密标准的一部分，独立于磁盘/存储的静态/传输中加密标准。为了实现这一目标，我们采用了Oracle的TDE解决方案，目前正在所有Oracle数据库上使用，包括内部部署和云平台。</p><h1 id="7899" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated"><strong class="ak">问题陈述</strong></h1><p id="20e5" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">TDE使用数据库启动期间需要在钱包中可用的加密密钥，如果密钥缺失或丢失，Oracle的数据库将无法恢复。</p><p id="38f5" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">在整个客户状态中，Oracle wallets是在本地数据库服务器上创建和存储的，并使用标准密钥，因此如果有人进入主机并获得一个密钥，他们就可以访问所有数据库中的数据。因此，作为加强数据安全措施的战略性解决方案，客户决定从本地钱包中取出TDE密钥，并将其保存在保险库中。要求是将TDE与Hashicorp vault集成为一个钱包安全解决方案。为此使用Hashicorp vault的原因是为了保持该解决方案与云无关。</p><p id="235a" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><strong class="jp hi"> <em class="kq">下面是关键技术要求:</em> </strong></p><ol class=""><li id="9125" class="kr ks hh jp b jq kl ju km jy kt kc ku kg kv kk kw kx ky kz bi translated">将TDE加密密钥从本地钱包上传到保管库。</li><li id="a448" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">将TDE加密密钥从保险箱下载到本地钱包并成功启动数据库。</li><li id="a40f" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">打开数据库和加密钱包后删除密钥。</li><li id="f4ed" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">在数据库启动并运行后，持续扫描wallet，并确保本地wallet中没有密钥。</li></ol><h1 id="e4fe" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated"><strong class="ak">解决方案</strong></h1><p id="d1d9" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">TDE保险库集成解决方案对于客户的安全性和加密密钥管理非常重要，因为它将在所有其他项目中使用。</p><p id="25d8" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">解决方案是使用b64加密将二进制文件上传到vault或从vault下载二进制文件。</p><h2 id="2c30" class="lf iq hh bd ir lg lh li iv lj lk ll iz jy lm ln jd kc lo lp jh kg lq lr jl ls bi translated"><strong class="ak">上传Hashicorp金库的本地钱包</strong></h2><p id="99ba" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">wallet_upload.sh</p><p id="1abc" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><em class="kq">cat&lt;path _ to _ wallet _ location&gt;/cwallet . SSO | base64 | vault kv put&lt;path _ to _ secret&gt;cwallet . SSO =-</em></p><p id="0135" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><em class="kq">cat&lt;path _ to _ wallet _ location&gt;/e wallet . p12 | base64 | vault kv patch&lt;path _ to _ secret&gt;e wallet . p12 =-</em></p><h2 id="83e3" class="lf iq hh bd ir lg lh li iv lj lk ll iz jy lm ln jd kc lo lp jh kg lq lr jl ls bi translated"><strong class="ak">从Hashicorp金库下载密钥到本地钱包</strong></h2><p id="e4ed" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">钱包_下载. sh</p><p id="c98e" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><em class="kq">vault kv get-field = cwallet . SSO kv/&lt;path _ to _ secret&gt;| base64—decode&gt;&lt;path _ to _ wallet _ location&gt;/cwallet . SSO</em></p><p id="4a97" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><em class="kq">vault kv get-field = e wallet . p12 kv/&lt;path _ to _ secret&gt;| base64—decode&gt;&lt;path _ to _ wallet _ location&gt;/e wallet . p12</em></p><p id="96c9" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">之后，有了这个解决方案，我们通过创建一个完全集成的Oracle集群件资源来自动化上传和下载密钥的过程。</p><p id="a4a7" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><strong class="jp hi"> <em class="kq">该自动化以给定的顺序无缝执行以下任务:</em> </strong></p><ol class=""><li id="8dc7" class="kr ks hh jp b jq kl ju km jy kt kc ku kg kv kk kw kx ky kz bi translated">在资源调配期间将TDE钱包上传到Vault。</li><li id="2201" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">移除本地TDE钱包</li><li id="d9f2" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">在数据库启动期间从保管库下载钱包。</li><li id="68b4" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">数据库启动后删除本地TDE钱包。</li><li id="f4c7" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">连续扫描本地钱包并删除密钥(如果可用)。</li></ol><h2 id="6e55" class="lf iq hh bd ir lg lh li iv lj lk ll iz jy lm ln jd kc lo lp jh kg lq lr jl ls bi translated"><strong class="ak">安装步骤</strong></h2><ol class=""><li id="052a" class="kr ks hh jp b jq jr ju jv jy lt kc lu kg lv kk kw kx ky kz bi translated">为TDE钥匙设置保险库</li><li id="5f09" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">将iam_role授予“网格”用户以允许vault访问</li><li id="f642" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">添加新的群集复制密钥资源。</li></ol><p id="23ec" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><strong class="jp hi"> crsctl </strong>添加资源CopyKey-type local _ resource-attr " ACTION _ SCRIPT =&lt;SCRIPT _ location&gt;/&lt;manage _ key _ SCRIPT&gt;。sh "</p><figure class="lx ly lz ma fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lw"><img src="../Images/88e904870e039e45a402e455f29eb345.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T-IRZFMwuaMXvrIQmZcfJA.png"/></div></div></figure><p id="4fb8" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">4.修改数据库群集资源以更改START_DEPENDENCIES包括CopyKey资源。</p><p id="b278" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><em class="kq"> crsctl修饰资源ora。&lt; db_resource &gt;。db-attr " START _ DELENDERS = ' hard(ora)。DATA_DG.dg，ora。REDO_DG.dg，ora。FRA_DG.dg，CopyKey)上拉(ora。DATA_DG.dg，ora。REDO_DG.dg，ora。FRA_DG.dg，CopyKey)弱(类型:ora.listener.type，uniform:ora.ons)'" </em></p><p id="6429" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">5.修改CopyKey群集资源以更改数据库资源上的STOP_DEPENDENCIES</p><p id="7f10" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><em class="kq"> crsctl修改资源CopyKey-attr " STOP _ DEPENDENCIES = ' hard(关机:ora。&lt; db_resource &gt;。db，中间值:ora。&lt; db_resource &gt;。db，关机:ora。&lt; db_resource &gt;。db，关机:ora。&lt; db_resource &gt;。db)'" </em></p><h1 id="3812" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated"><strong class="ak">保险金</strong></h1><ul class=""><li id="c74f" class="kr ks hh jp b jq jr ju jv jy lt kc lu kg lv kk mb kx ky kz bi translated">成本效益</li><li id="9e43" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk mb kx ky kz bi translated">云不可知</li><li id="8f43" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk mb kx ky kz bi translated">全自动解决方案</li><li id="119a" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk mb kx ky kz bi translated">最佳支持标准</li><li id="8c50" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk mb kx ky kz bi translated">简化的钱包操作</li></ul><figure class="lx ly lz ma fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mc"><img src="../Images/c0b9ee9d585d574f339b8244237f5184.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mpJwiEeGdAgn31x9jBa3vQ.jpeg"/></div></div></figure><p id="4ba9" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><strong class="jp hi">关于作者:<br/> </strong> Fawad Haider是第1版的神谕师。</p></div></div>    
</body>
</html>