<html>
<head>
<title>Microsoft Teams integration with Node.js using MS Graph API and Microsoft Identity Platform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">微软团队使用MS Graph API和微软身份平台与Node.js集成</h1>
<blockquote>原文：<a href="https://medium.com/globant/microsoft-teams-integration-with-node-js-using-ms-graph-api-and-microsoft-identity-platform-d7c53f1541ad?source=collection_archive---------0-----------------------#2021-09-06">https://medium.com/globant/microsoft-teams-integration-with-node-js-using-ms-graph-api-and-microsoft-identity-platform-d7c53f1541ad?source=collection_archive---------0-----------------------#2021-09-06</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="edd0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">本文的目标是使用Microsoft graph APIs和Microsoft Identity Platform，通过Node.js为MS团队集成构建现成的解决方案。我们将介绍组、团队的创建以及向团队添加成员(所有者和团队成员)。</p><p id="8e6f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">本文将有助于自动化MS Teams集成过程，包括创建组、创建团队、使用graph APIs和Node.js添加成员</p><p id="ec93" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">示例:</strong>团队正在开发流程管理应用程序，需要执行以下任务</p><ol class=""><li id="2168" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">在应用程序中创建项目</li><li id="6d50" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">添加项目成员</li><li id="9bd7" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">创建团队并在MS团队中添加成员，以发送更新/警报/项目相关信息</li></ol><p id="63dd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要执行上述操作，创建项目的用户需要执行团队创建，手动添加成员。但是，如果我们能够在项目创建过程中实现自动化，那会怎么样呢！</p><p id="64a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">先决条件</strong></p><ol class=""><li id="89ac" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">来自平台团队的<a class="ae jq" href="https://docs.microsoft.com/en-us/samples/officedev/microsoft-teams-sample-auth-node/microsoft-teams-auth/" rel="noopener ugc nofollow" target="_blank">客户Id、机密</a>和租赁Id</li><li id="923f" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">拥有以下权限的用户授权令牌:团队。创建，分组。ReadWrite.All，目录。读写。全部</li></ol><h2 id="5836" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated"><strong class="ak">步骤</strong></h2><p id="0cde" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated"><strong class="ig hi">获取访问令牌</strong> <br/>使用来自以下url的租赁id为teams应用程序请求访问令牌<a class="ae jq" href="https://login.microsoftonline.com/${tenancyId}/oauth2/v2.0/token" rel="noopener ugc nofollow" target="_blank">https://log in . Microsoft online . com/$ { tenancyId }/oauth 2/v 2.0/token</a>。请参见下面的代码片段。(<a class="ae jq" href="https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-on-behalf-of-flow#middle-tier-access-token-request" rel="noopener ugc nofollow" target="_blank">更多详情</a>)</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div class="er es kr"><img src="../Images/1b6c1cb0ce193bd901f1375898b7c797.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*8xx_vRD-1tXHRRvcaaEK5g.png"/></div></figure><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es kz"><img src="../Images/38ebfbc8c3d1f956bdc084ba96678930.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g39PL2kNOifwf122wICF8w.png"/></div></div><figcaption class="le lf et er es lg lh bd b be z dx">Get access token</figcaption></figure><p id="2f2c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">获取团队配置文件</strong> <br/>这是需要进行的API调用，以获取要添加到组和团队中的用户配置文件(<a class="ae jq" href="https://docs.microsoft.com/en-us/graph/api/user-get?view=graph-rest-1.0&amp;tabs=http#http-request" rel="noopener ugc nofollow" target="_blank">更多详细信息</a>)。<br/><strong class="ig hi">API</strong>:<a class="ae jq" href="https://graph.microsoft.com/v1.0/users/${userId" rel="noopener ugc nofollow" target="_blank">https://graph.microsoft.com/v1.0/users/${userId</a>}<br/><strong class="ig hi">方法</strong>:获取<br/> <strong class="ig hi">响应</strong>:成功后，该方法返回<code class="du li lj lk ll b">200 OK</code>响应代码和<a class="ae jq" href="https://docs.microsoft.com/en-us/graph/api/resources/user?view=graph-rest-1.0" rel="noopener ugc nofollow" target="_blank">用户</a>对象，除非<code class="du li lj lk ll b">$select</code>被显式用于选择属性。</p><p id="ac53" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">用户对象代表AD用户对象。返回的用户的默认属性如下</p><pre class="ks kt ku kv fd lm ll ln lo aw lp bi"><span id="7268" class="jr js hh ll b fi lq lr l ls lt">{<br/>  "<strong class="ll hi">id</strong>": "The unique identifier for the user",<br/>  "<strong class="ll hi">displayName</strong>": "The name displayed in the address book for the user",<br/>  "<strong class="ll hi">givenName</strong>": "The first name of user",<br/>  "<strong class="ll hi">surname</strong>": "The user's surname (family name or last name)",<br/>  "<strong class="ll hi">mail</strong>": "The SMTP address of user",<br/>  "<strong class="ll hi">preferredLanguage</strong>": "The preferred language for the user",<br/>  "<strong class="ll hi">businessPhones</strong>": "The telephone numbers for the user",<br/>  "<strong class="ll hi">mobilePhone</strong>": "The primary cellular telephone number for the user",<br/>  "<strong class="ll hi">jobTitle</strong>": "The user's job title",<br/>  "<strong class="ll hi">officeLocation</strong>": "The office location in the user's place of business",<br/>  "<strong class="ll hi">userPrincipalName</strong>": "The User Principal Name is an Internet-style login name for the user based on the Internet standard RFC 822. he general format is alias@domain"<br/>}</span></pre><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lu"><img src="../Images/a4de752dd13a12b641bcb429068e3527.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J6aQLp4G27tX5UsHEtWcrw.png"/></div></div></figure><p id="960e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">创建团队<br/> </strong>团队创建是团队创建不可或缺的一部分。<br/>API:<a class="ae jq" href="https://graph.microsoft.com/v1.0/groups" rel="noopener ugc nofollow" target="_blank">https://graph.microsoft.com/v1.0/groups</a><br/>方法:POST <br/>响应:如果成功，该方法在响应体中返回一个<code class="du li lj lk ll b">201 Created</code>响应代码和一个<a class="ae jq" href="https://docs.microsoft.com/en-us/graph/api/resources/group?view=graph-rest-1.0" rel="noopener ugc nofollow" target="_blank">组</a>对象，只有组的默认属性。group对象代表active directory组，可以是O365或安全组。返回的默认属性在这里标注为<a class="ae jq" href="https://docs.microsoft.com/en-us/graph/api/resources/group?view=graph-rest-1.0#properties" rel="noopener ugc nofollow" target="_blank"/>。<br/> <a class="ae jq" href="https://docs.microsoft.com/en-us/graph/api/group-post-groups?view=graph-rest-1.0&amp;tabs=http#example-2-create-a-group-with-owners-and-members" rel="noopener ugc nofollow" target="_blank">更多详情</a></p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lv"><img src="../Images/e719970bffdbc0c651a87f652917fc6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k7TAlWO-eFVV0T6PqEmkuQ.png"/></div></div><figcaption class="le lf et er es lg lh bd b be z dx">Create group</figcaption></figure><p id="9b3b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">创建团队<br/> </strong>获取上面创建的组id以在该组中创建团队<br/>API:<a class="ae jq" href="https://graph.microsoft.com/v1.0/groups/${groupId}/team" rel="noopener ugc nofollow" target="_blank">https://graph.microsoft.com/v1.0/groups/${groupId}/team</a><br/>方法:PUT <br/>响应:如果成功，该API返回一个<code class="du li lj lk ll b">202 Accepted</code>响应。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lw"><img src="../Images/e9d86f9ef902f3afcb5726c73eb961e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0aS3XFgJ3gSQ9DW7zowG5Q.png"/></div></div><figcaption class="le lf et er es lg lh bd b be z dx">Create Team</figcaption></figure><p id="1b80" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">添加成员<br/></strong>API:<a class="ae jq" href="https://graph.microsoft.com/v1.0/groups/${groupId}/members/$ref" rel="noopener ugc nofollow" target="_blank">https://graph . Microsoft . com/v 1.0/groups/$ { groupId }/members/$ ref</a><br/>方法:POST <br/>响应:该API成功返回一个<code class="du li lj lk ll b">204 No Content</code>响应代码，在响应体中不返回任何内容。</p><blockquote class="lx ly lz"><p id="8522" class="ie if ma ig b ih ii ij ik il im in io mb iq ir is mc iu iv iw md iy iz ja jb ha bi translated"><strong class="ig hi">错误代码</strong> <br/> 404未找到-当添加的对象不存在时<br/> 400错误请求当添加的对象已经是组的成员时</p></blockquote><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es me"><img src="../Images/f85ef5c7345aa26d9b9f24b61b21866f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UEWwb8R7W3j99pk-3_q8XA.png"/></div></div><figcaption class="le lf et er es lg lh bd b be z dx">Add members</figcaption></figure><p id="fb56" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">总结</strong></p><p id="487c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">MS Teams automation可以减少大量的手动工作，例如创建团队、添加成员、定义角色，并且在我们有许多项目成员的情况下，引入的错误会减少。此外，我们还可以自动化其他流程，如在频道上发送通知、添加/列出/更新托管内容等。</p><p id="3b10" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">与node.js项目的完整集成可以在这里找到。</p><ul class=""><li id="c3d9" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb mf ji jj jk bi translated"><a class="ae jq" href="https://codesandbox.io/s/us2u9" rel="noopener ugc nofollow" target="_blank">代码沙箱</a></li><li id="41f3" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb mf ji jj jk bi translated"><a class="ae jq" href="https://bitbucket.org/vikaskeskar11/ms-teams-integration" rel="noopener ugc nofollow" target="_blank">位桶</a></li></ul><blockquote class="lx ly lz"><p id="c1b6" class="ie if ma ig b ih ii ij ik il im in io mb iq ir is mc iu iv iw md iy iz ja jb ha bi translated"><strong class="ig hi">注意:示例项目设置将作为docker容器运行，作为独立的应用程序运行，相应地更新配置。</strong></p></blockquote></div></div>    
</body>
</html>