<html>
<head>
<title>Drain Dead Connections with Oracle .NET Fast Connection Failover</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">排出与Oracle的死连接。网络快速连接故障转移</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/drain-dead-connections-with-oracle-net-fast-connection-failover-9de5c11ec484?source=collection_archive---------0-----------------------#2020-08-19">https://medium.com/oracledevs/drain-dead-connections-with-oracle-net-fast-connection-failover-9de5c11ec484?source=collection_archive---------0-----------------------#2020-08-19</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/cb5e9b8e1000bb9de062a11897f4ea25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*ucy6RJa9_50_AALQqe3XGA.jpeg"/></div></figure><p id="e15e" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">一个常见的高可用性(HA)应用程序难题发生在数据库离线进行修补或维护时。最终用户可能会遇到ORA-03113(通信通道上的文件结束)或类似错误，即使在数据库重新联机后也是如此。发生此错误的原因是，当数据库脱机时，它的连接变成孤立的，并保留在池中。由于应用程序无法区分无效连接和有效连接，这些“死”连接可能会被无意中分配给最终用户。</p><p id="6899" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">典型的方式。NET管理员解决这个问题的方法是通过ODP.NET clear pool()或ClearAllPools()方法重置池，或者在数据库脱机时重新启动应用程序。另一种方法是for。NET开发人员启用ODP.NET验证连接池设置。所有这些解决方案都有明显的缺点。清除池或重新启动应用程序会删除有效和无效的连接，并影响服务级别，直到池重置。对于每次连接尝试，连接验证都需要额外的数据库往返。这些高可用性解决方案牺牲了性能并增加了管理员开销，以解决最终用户接收到死连接的问题。首选的解决方案是让数据提供者自动检测数据库何时脱机，然后主动删除无效的连接。这将确保最终用户不再被分配死连接，同时应用程序保持其服务水平。</p><p id="3f4c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">当ODP.NET使用Oracle快速连接故障切换(FCF)时，这是可能的。当数据库资源(如Oracle Real Application Clusters服务、服务成员、节点或Data Guard数据库)出现故障时，FCF会通过快速应用程序通知(FAN)通知ODP.NET连接池，以便主动快速地仅删除被切断的连接。不需要等待TCP超时，因为对于许多应用程序来说，这需要太长时间。有效的连接不会受到影响，继续为最终用户提供服务。随着被切断的连接从池中排出，没有机会分配无效的连接。最终用户继续他们的工作，并不知道发生了任何数据库故障或维护。具体来说，ODP.NET·FCF做了以下工作:</p><ul class=""><li id="0b49" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">主动从池中排出无效连接</li><li id="9d21" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">强制等待关闭的数据库响应的线程退出现有调用，以避免挂起。当该连接返回到池中时，与该连接相关联的任何资源都将被释放，因为它不再有效。</li><li id="bd7e" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">如果断开的连接删除导致连接计数低于最小池大小，则在下一次连接请求时，建立到剩余Oracle数据库实例的新连接。</li></ul><p id="a899" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">除了只移除被切断的连接，ODP.NET·FCF还在几个方面有所创新。</p><ol class=""><li id="53db" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jx jp jq jr bi translated">它提供了端到端的高可用性解决方案。它不仅是单纯的数据库高可用性，也不是单纯的应用程序高可用性。</li><li id="a0c4" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jx jp jq jr bi translated">运行时不需要管理员手动干预。NET代码更改在设计时是必需的。管理员只需在数据库服务器上为他们现有的应用程序启用该功能。就是这样！</li></ol><p id="1421" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">默认情况下，ODP.NET会自动启用FCF。如果在ODP.NET连接字符串中关闭了连接池或FCF (HA事件属性),应用程序可以禁用FCF。以下是启用FCF的默认值:</p><ul class=""><li id="f81b" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated"><code class="du jy jz ka kb b">Pooling=true</code></li><li id="af37" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated"><code class="du jy jz ka kb b">HA Events=true</code></li></ul><p id="cbea" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这就是现有的ODP.NET应用程序如何在不修改代码或做很小改动的情况下采用FCF。</p><p id="cf37" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">ODP.NET核心、管理型ODP.NET和非管理型ODP.NET均提供FCF。它可以与当前支持FAN的任何数据库服务器版本以及专用的Oracle自治数据库一起使用。要了解关于和范的更多信息，请阅读关于这些主题的文档。</p><p id="9598" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">ODP。NET FCF为计划内停机和计划外停机场景提供了真正的全包式端到端高可用性解决方案，使其易于集成到现有应用中。</p></div></div>    
</body>
</html>