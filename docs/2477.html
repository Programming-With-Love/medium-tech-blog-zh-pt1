<html>
<head>
<title>Deploying Go App with HAProxy + Docker to Google Compute Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将带有HAProxy + Docker的Go应用程序部署到Google计算引擎</h1>
<blockquote>原文：<a href="https://medium.easyread.co/deploying-go-app-with-haproxy-docker-to-google-compute-engine-f7e01693b645?source=collection_archive---------0-----------------------#2020-04-29">https://medium.easyread.co/deploying-go-app-with-haproxy-docker-to-google-compute-engine-f7e01693b645?source=collection_archive---------0-----------------------#2020-04-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="9fb0" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">如何将带有HAProxy和Docker的Go App部署到Google计算引擎</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/8530c2bd2806551b356e87b6c4636354.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ar5k6DrWO5P57vfw0NC4WA.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://pixabay.com/illustrations/upload-online-internet-files-cloud-3406226/" rel="noopener ugc nofollow" target="_blank">pixabay.com</a></figcaption></figure><p id="b8fd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">大家好！和我一起，一次又一次地，分享一些关于软件工程领域技术相关的经验、想法或观点。今天，我将再次分享关于DevOps的事情，即如何将您的应用程序部署到谷歌计算引擎。而这个例子我们会用Docker + HAProxy + Go编程语言。</p><p id="737e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我在这篇文章里写过一个关于将应用部署到亚马逊EC2的故事，<a class="ae ks" href="https://medium.com/easyread/deploying-go-app-with-nginx-docker-to-aws-ec2-b33d458918fd" rel="noopener"> <strong class="kv io">《用NGINX + Docker将Go App部署到亚马逊EC2》</strong></a>。</p><p id="87ac" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">现在，我们将尝试部署到谷歌计算引擎。为什么是谷歌？我们知道谷歌是一家大型科技公司，也有很多公司或用户使用的云计算服务。详细信息的官方页面可以在这里找到【https://cloud.google.com/ T4】</p><p id="9a60" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">他们还提供免费等级和免费信用，这很好，因为我们可以免费学习使用GCP。访问此链接了解更多关于https://cloud.google.com/free<a class="ae ks" href="https://cloud.google.com/free" rel="noopener ugc nofollow" target="_blank">的免费项目</a></p><p id="9c6b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果你已经有了有效的帐号，让我们启动它并进入https://console.cloud.google.com/的GCP控制台<a class="ae ks" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank"/></p><h1 id="80ea" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">1.安装计算引擎服务</h1><p id="0e59" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">选择<strong class="kv io">转到计算引擎</strong>按钮。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mm"><img src="../Images/e21b22c44f0501285622c8d8f0802626.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1SsY9OCpigmKzhX4gqCDaw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Picture 1 Choose Compute Engine Service</figcaption></figure><p id="b13d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">选择项目(如果有)或创建项目并给出名称。例如，我们将使用<strong class="kv io"> go-app </strong>作为项目名称。点击<strong class="kv io">创建</strong>按钮继续。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mn"><img src="../Images/4ce5d759444358c761adf8596c92741c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cU3NsNez0Qrv0WN6Kq3uuQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Picture 2 Creating Project</figcaption></figure><p id="867a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">创建项目后，点击<strong class="kv io">创建</strong>按钮继续该过程。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mo"><img src="../Images/20fd572a2de198afad9af2828beb0735.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xzZxQsnlbkeE6dAAwPLM8w.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Picture 3 Creating Instance</figcaption></figure><p id="bfe2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们将被重定向到设置实例的页面。在这种情况下，我们将更改几个规格，如<strong class="kv io">机器类型</strong>、<strong class="kv io">启动盘、</strong>和<strong class="kv io">防火墙</strong>，其余的保持默认。我们使用<strong class="kv io"> f1-micro </strong>因为它最便宜，我们使用最新的<strong class="kv io"> Ubuntu LTS </strong>和<strong class="kv io">允许HTTP流量</strong>因为我们将使用HAProxy作为负载平衡器。</p><p id="fc33" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">接下来，点击<strong class="kv io">创建</strong>按钮，完成实例的设置。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mp"><img src="../Images/4210277142bbf35121e3b497f3259c97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lj0kq46Wf_I1t8HQGLbwdQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Picture 4 Choose Machine Type</figcaption></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mm"><img src="../Images/ade4ddda56129d949247d6dfa9fd3620.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-1vi1zHRR3A2-vAbdiCQwQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Picture 5 Choose Boot Disk and Firewall Type</figcaption></figure><p id="6d15" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">稍等片刻，直到您的实例准备就绪，我们将被重定向到<strong class="kv io">实例列表</strong>页面。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mq"><img src="../Images/4a436eb935d284ebf971eaa00c6c333d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3SmW8WaAEhs8Se9K0689tg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Picture 6 Instances List Page</figcaption></figure><h1 id="26a5" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">2.连接到实例</h1><p id="0a8d" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">有几种方法可以从浏览器模式下的SSH开始连接到实例，直到使用gcloud命令或使用另一个SSH客户端。通过单击Connect列上SSH文本旁边的箭头按钮来查看列表。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mr"><img src="../Images/af7db470a05d3aeeef14f84e830eea0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K_sFOpkL8Zz6M5ApSGMmaQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Picture 7 Connect to Instance Options</figcaption></figure><p id="ceb6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们将使用gcloud命令轻松连接到Google云服务。关于如何安装gcloud command的详细信息，请参见本文<a class="ae ks" href="https://cloud.google.com/sdk/install" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io">【安装Google Cloud SDK】</strong></a>因为它依赖于我们的OS。</p><p id="f72d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在本例中，我使用的是macOS，步骤如下所示</p><p id="91d0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">下载gcloud SDK:</p><pre class="kd ke kf kg gt ms mt mu mv aw mw bi"><span id="8ec3" class="mx lq in mt b gy my mz l na nb"><strong class="mt io">curl https://sdk.cloud.google.com | bash</strong></span></pre><p id="66b6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">重新启动外壳:</p><pre class="kd ke kf kg gt ms mt mu mv aw mw bi"><span id="b721" class="mx lq in mt b gy my mz l na nb"><strong class="mt io">exec -l $SHELL</strong></span></pre><p id="03e5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">运行gcloud init并遵循安装步骤(会询问您几个关于google帐户、云项目、计算引擎区域的问题) :</p><pre class="kd ke kf kg gt ms mt mu mv aw mw bi"><span id="34f9" class="mx lq in mt b gy my mz l na nb"><strong class="mt io">gcloud init</strong></span></pre><p id="5e97" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">安装完成后，尝试连接到实例:</p><pre class="kd ke kf kg gt ms mt mu mv aw mw bi"><span id="f82f" class="mx lq in mt b gy my mz l na nb"><strong class="mt io">gcloud beta compute ssh --zone "us-central1-a" "instance-1" --project "go-app-275713"</strong></span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nc"><img src="../Images/b3299e2dec8bfe3cd71c5d4f9dd75f5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0nrmzkoo9Wv5v0qsHgJqfw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Picture 8 Connected to Instance</figcaption></figure><h1 id="4a44" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">3.设置Docker</h1><p id="67d5" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">在这个例子中，我们将使用Docker。为什么是Docker？Docker是什么？你可以看看这篇文章里的解释。</p><ul class=""><li id="c67b" class="nd ne in kv b kw kx kz la lc nf lg ng lk nh lo ni nj nk nl bi translated"><a class="ae ks" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io">为开发者赋能App开发</strong> </a>，以及</li><li id="9565" class="nd ne in kv b kw nm kz nn lc no lg np lk nq lo ni nj nk nl bi translated"><a class="ae ks" href="https://www.docker.com/why-docker" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io">开发者用Docker </strong> </a>把他们的想法变成现实</li></ul><p id="f957" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">TL</strong>；<strong class="kv io"> DR </strong> Docker是一套平台即服务产品，使用操作系统级虚拟化来交付称为容器的软件包中的软件。有了这些容器，您可以轻松地将您的应用程序设置到服务器，或者从一个服务器迁移到另一个服务器。</p><p id="102d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">首先，使用apt作为软件包管理来更新软件包，使用以下命令(-y表示如果出现提示，假设是) :</p><pre class="kd ke kf kg gt ms mt mu mv aw mw bi"><span id="d249" class="mx lq in mt b gy my mz l na nb"><strong class="mt io">sudo apt-get update -y</strong></span></pre><p id="7562" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">安装软件包以允许<code class="fe nr ns nt mt b"><strong class="kv io">apt</strong></code>通过HTTPS使用存储库:</p><pre class="kd ke kf kg gt ms mt mu mv aw mw bi"><span id="4a76" class="mx lq in mt b gy my mz l na nb"><strong class="mt io">sudo apt-get install</strong> \<br/>    apt-transport-https \<br/>    ca-certificates \<br/>    curl \<br/>    gnupg-agent \<br/>    software-properties-common</span></pre><p id="b3af" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">添加Docker官方GPG键:</p><pre class="kd ke kf kg gt ms mt mu mv aw mw bi"><span id="0387" class="mx lq in mt b gy my mz l na nb"><strong class="mt io">curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -</strong></span></pre><p id="5c06" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">使用以下命令来设置<strong class="kv io">稳定的</strong>库:</p><pre class="kd ke kf kg gt ms mt mu mv aw mw bi"><span id="53d2" class="mx lq in mt b gy my mz l na nb"><strong class="mt io">sudo add-apt-repository</strong> \<br/>   "deb [arch=amd64] https://download.docker.com/linux/ubuntu \<br/>   $(lsb_release -cs) \<br/>   <strong class="mt io">stable</strong>"</span></pre><p id="da54" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">完成后，继续安装Docker:</p><pre class="kd ke kf kg gt ms mt mu mv aw mw bi"><span id="43a7" class="mx lq in mt b gy my mz l na nb"><strong class="mt io">sudo apt install docker.io</strong></span></pre><p id="3899" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">启动docker并使其在系统重启后启动:</p><pre class="kd ke kf kg gt ms mt mu mv aw mw bi"><span id="63a6" class="mx lq in mt b gy my mz l na nb"><strong class="mt io">sudo systemctl enable --now docker</strong></span></pre><p id="72c2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">将您的用户添加到docker组，以便在没有sudo的情况下运行该命令(用您的用户更改SOMEUSER):</p><pre class="kd ke kf kg gt ms mt mu mv aw mw bi"><span id="d9c0" class="mx lq in mt b gy my mz l na nb"><strong class="mt io">sudo usermod -aG docker SOMEUSER</strong></span></pre><p id="bf92" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您需要注销并重新登录，以便重新评估您的组成员资格。</p><p id="5679" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">确保所有步骤正常工作，我们可以运行以下命令:</p><pre class="kd ke kf kg gt ms mt mu mv aw mw bi"><span id="17d8" class="mx lq in mt b gy my mz l na nb"><strong class="mt io">docker --version<br/>docker info</strong></span></pre><h1 id="8925" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">4.设置图像</h1><p id="530c" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">我们将使用我之前的<a class="ae ks" href="https://medium.com/@bismobaruno/b33d458918fd" rel="noopener">故事</a>中的图片。如果你没有，请参考如何在此基础上构建图像。</p><h1 id="4c8d" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">5.运行Go应用程序</h1><p id="51de" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">因为我们已经有了Go应用程序Docker映像，所以我们将尝试使用以下命令在我们的实例中获取并运行它:</p><pre class="kd ke kf kg gt ms mt mu mv aw mw bi"><span id="d5ed" class="mx lq in mt b gy my mz l na nb"><strong class="mt io">docker run -p 3000:3000 -d momo89/go-hello-world</strong></span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nu"><img src="../Images/1c83d2a5db868d7fa9718eeb4ec05081.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uS8basU0_v1j7EdYLYS5PQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Picture 9 Pull Docker Image</figcaption></figure><p id="f015" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">检查已经运行的容器服务:</p><pre class="kd ke kf kg gt ms mt mu mv aw mw bi"><span id="7780" class="mx lq in mt b gy my mz l na nb"><strong class="mt io">docker ps</strong></span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nv"><img src="../Images/3e9e13932fd67dfed1962ad9d4180519.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HDftCS_3Udgtzz2EzeQq7w.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Picture 10 Check Go App Container Service</figcaption></figure><p id="44c4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">尝试使用curl命令ping应用程序:</p><pre class="kd ke kf kg gt ms mt mu mv aw mw bi"><span id="c05b" class="mx lq in mt b gy my mz l na nb"><strong class="mt io">curl -s localhost:3000</strong></span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nw"><img src="../Images/9a0b04d4261c4e75615a5a5ec432b434.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BDiLygzTZrwmjTq3sac9WQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Picture 11 Ping Go App</figcaption></figure><p id="97d9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">耶！！如果您成功地从服务器获得响应，我们就完成了Go应用程序。</p><h1 id="8d30" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">6.运行HAProxy</h1><p id="8df1" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">我们将使用HAProxy作为负载平衡器。什么是HAProxy？</p><blockquote class="nx ny nz"><p id="b087" class="kt ku oa kv b kw kx jo ky kz la jr lb ob ld le lf oc lh li lj od ll lm ln lo ig bi translated">HAProxy是免费的开源软件，为基于TCP和HTTP的应用程序提供高可用性负载平衡器和代理服务器，这些应用程序将请求分布在多个服务器上。</p></blockquote><p id="63ff" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">要了解更多关于HAProxy的信息，请访问他们的官方页面。</p><p id="efca" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">由于HAProxy映像已经存在于Docker Hub中，我们不需要创建映像。只需提取图像并加载一些配置。</p><p id="06d3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">为HAProxy配置创建一个目录和一些文件。</p><pre class="kd ke kf kg gt ms mt mu mv aw mw bi"><span id="cbc1" class="mx lq in mt b gy my mz l na nb">cd $HOME<br/>mkdir haproxy<br/>cd haproxy<br/>touch Dockerfile<br/>touch haproxy.cfg</span></pre><p id="bfea" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">HAProxy的Dockerfile应该是这样的:</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="3abf" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">而<code class="fe nr ns nt mt b"><strong class="kv io">haproxy.cfg</strong></code>会是这样的(我们用172.17.0.1，因为是默认的Docker IP地址):</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oe of l"/></div></figure><p id="a07a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">构建HAProxy映像:</p><pre class="kd ke kf kg gt ms mt mu mv aw mw bi"><span id="f563" class="mx lq in mt b gy my mz l na nb"><strong class="mt io">docker build -t momo89/haproxy .</strong></span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nc"><img src="../Images/1610d85edfaf49b1b3877d54160a0658.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zPySp7m1Jbd1SXzRfsvPkA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Picture 12 Build HAProxy Docker Image</figcaption></figure><p id="6169" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">使用以下命令运行HAProxy docker:</p><pre class="kd ke kf kg gt ms mt mu mv aw mw bi"><span id="ec5b" class="mx lq in mt b gy my mz l na nb"><strong class="mt io">docker run -p 80:80 -d momo89/haproxy</strong></span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nw"><img src="../Images/7fc2e866463df52e18606d4d4bcbef8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GiD3HV1Dnqla5CfA4PiQJQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Picture 13 Run HAProxy Docker Image</figcaption></figure><p id="4b8a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">使用以下命令检查HAProxy服务是否已经运行:</p><pre class="kd ke kf kg gt ms mt mu mv aw mw bi"><span id="d3ab" class="mx lq in mt b gy my mz l na nb"><strong class="mt io">docker ps</strong></span></pre><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi og"><img src="../Images/eb072b9db725718a97c7ff53f44d4f3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kJGjNWv8gANYLP_87GuDyg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Picture 14 Check HAProxy Conteiner Service</figcaption></figure><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oh"><img src="../Images/3b0c90619bff43cf867ed62d0225ca7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YQ211l7Ozffgra9rMIVFUg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Picture 15 Accessing Go App through HTTP</figcaption></figure><p id="23b7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">瞧，成功了！现在可以访问HAProxy后面的Go App了！</p><p id="2533" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">希望你喜欢它，我很高兴如果这篇文章对你有用！部署愉快！</p><p id="3889" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">谢谢大家！</p></div><div class="ab cl oi oj hr ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="ig ih ii ij ik"><h1 id="0be8" class="lp lq in bd lr ls op lu lv lw oq ly lz jt or ju mb jw os jx md jz ot ka mf mg bi translated"><strong class="ak">其他仍在讲述的故事</strong></h1><ul class=""><li id="9b5c" class="nd ne in kv b kw mh kz mi lc ou lg ov lk ow lo ni nj nk nl bi translated">配置域名:<a class="ae ks" href="https://medium.com/@bismobaruno/2fb0a26832af" rel="noopener">https://medium.com/@bismobaruno/2fb0a26832af</a></li><li id="3425" class="nd ne in kv b kw nm kz nn lc no lg np lk nq lo ni nj nk nl bi translated">配置子域:<a class="ae ks" href="https://medium.com/@bismobaruno/configure-subdomain-to-google-compute-engine-with-google-cloud-dns-haproxy-docker-4294db1970b8" rel="noopener">https://medium.com/@bismobaruno/4294db1970b8</a></li><li id="202b" class="nd ne in kv b kw nm kz nn lc no lg np lk nq lo ni nj nk nl bi translated">配置通配符SSL:<a class="ae ks" href="https://medium.com/@bismobaruno/configure-wildcard-ssl-to-google-compute-engine-with-google-cloud-dns-haproxy-docker-ea92e896dfc" rel="noopener">https://medium.com/@bismobaruno/ea92e896dfc</a></li></ul></div><div class="ab cl oi oj hr ok" role="separator"><span class="ol bw bk om on oo"/><span class="ol bw bk om on oo"/><span class="ol bw bk om on"/></div><div class="ig ih ii ij ik"><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ox of l"/></div></figure></div></div>    
</body>
</html>