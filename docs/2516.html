<html>
<head>
<title>Unit Test (Redis) in Golang</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Golangçš„å•å…ƒæµ‹è¯•(Redis)</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.easyread.co/unit-test-redis-in-golang-c22b5589ea37?source=collection_archive---------0-----------------------#2020-06-16">https://medium.easyread.co/unit-test-redis-in-golang-c22b5589ea37?source=collection_archive---------0-----------------------#2020-06-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="892d" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">å¦‚ä½•ç”¨Golangæ¨¡æ‹Ÿæˆ‘ä»¬çš„Redisä»£ç è¿›è¡Œå•å…ƒæµ‹è¯•</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/67e5fa73da905bb35f6ee42f9e721ab3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MYWxpVvsE8TKLSnyVRhCQA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk"><a class="ae ks" href="https://www.vecteezy.com/free-vector/research" rel="noopener ugc nofollow" target="_blank">Research Vectors by Vecteezy</a></figcaption></figure><p id="9459" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">å¤§å®¶å¥½ï¼å’Œæˆ‘ä¸€èµ·ï¼Œä¸€æ¬¡åˆä¸€æ¬¡åœ°ï¼Œåˆ†äº«ä¸€äº›å…³äºè½¯ä»¶å·¥ç¨‹é¢†åŸŸæŠ€æœ¯ç›¸å…³çš„ç»éªŒã€æƒ³æ³•æˆ–è§‚ç‚¹ã€‚åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘æƒ³åˆ†äº«å¦‚ä½•åœ¨Golangä¸­æ¨¡æ‹Ÿæˆ‘ä»¬çš„Redisä»£ç ä»¥è¿›è¡Œå•å…ƒæµ‹è¯•ã€‚</p><p id="b37a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">è€å®è¯´ï¼Œæˆ‘å¯¹å¦‚ä½•ä¸ºRedisåˆ¶ä½œæœ‰ç‚¹å›°æƒ‘ã€‚å› ä¸ºæ²¡æœ‰åƒDATA-DOGçš„go-sqlmockè¿™æ ·å—æ¬¢è¿çš„åº“ã€‚ç›´åˆ°æˆ‘å‘ç°äº†è¿™ç¯‡å¾ˆæ£’çš„æ–‡ç« ï¼Œã€ŠGo   ä¸­çš„<a class="ae ks" href="https://medium.com/@elliotchance/mocking-redis-in-unit-tests-in-go-28aff285b98" rel="noopener"><em class="lp">å˜²è®½å•å…ƒæµ‹è¯•ä¸­çš„é›·è¿ªæ–¯ã€‹ã€‚</em></a></p><p id="a0cf" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">ä¸é”™ï¼Œå¾ˆæœ‰å¸®åŠ©ï¼ä½†æ˜¯ï¼Œæˆ‘åº”è¯¥ä¿®æ”¹æˆ‘ç°æœ‰çš„ä»£ç ï¼Œä»¥ä¾¿åœ¨æµ‹è¯•å’Œå®é™…å®ç°ä¸­éƒ½èƒ½å¾ˆå¥½åœ°å·¥ä½œã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¼€å§‹åšä¸€ä¸ªç®€å•çš„ä¾‹å­æµ‹è¯•å§ï¼æˆ‘ä»¬å°†éœ€è¦3ä¸ªåº“æ¥è¿è¡Œæµ‹è¯•ã€‚</p><ul class=""><li id="e999" class="lq lr in kv b kw kx kz la lc ls lg lt lk lu lo lv lw lx ly bi translated"><strong class="kv io">å¯¹äºå‡å†’çš„RedisæœåŠ¡å™¨:</strong><a class="ae ks" href="https://github.com/alicebob/miniredis" rel="noopener ugc nofollow" target="_blank">https://github.com/alicebob/miniredis</a></li><li id="0d9c" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated"><strong class="kv io">ä¸Redisäº’åŠ¨:</strong>s<a class="ae ks" href="https://github.com/elliotchance/redismock" rel="noopener ugc nofollow" target="_blank">https://github.com/elliotchance/redismock</a></li><li id="2553" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated"><strong class="kv io">å¯¹äºRediså®¢æˆ·ç«¯:</strong><a class="ae ks" href="https://github.com/go-redis/redis" rel="noopener ugc nofollow" target="_blank">https://github.com/go-redis/redis</a></li></ul><p id="3ac3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">é¦–å…ˆï¼Œåƒè¿™æ ·åˆ›å»ºé¡¹ç›®ç»“æ„:</p><pre class="kd ke kf kg gt me mf mg mh aw mi bi"><span id="729b" class="mj mk in mf b gy ml mm l mn mo"><em class="lp">+ your_gopath/<br/>|<br/>+--+ src/github.com/moemoe89<br/>|  |<br/>|  +--+ go-unit-test-redis/<br/>|     |<br/>|     +--+ main.go<br/>|        + repository/<br/>|        |<br/>|        +--+ repository.go<br/>|           + repository_test.go<br/>|<br/>+--+ bin/<br/>|  |<br/>|  +-- ... executable file<br/>|<br/>+--+ pkg/<br/>   |<br/>   +-- ... all dependency_library required</em></span></pre><p id="f41e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">ä¹‹åï¼Œæˆ‘ä»¬éœ€è¦åœ¨<code class="fe mp mq mr mf b"><strong class="kv io">repository</strong></code>ç›®å½•ä¸‹åˆ›å»ºä¸¤ä¸ªæ–‡ä»¶:<code class="fe mp mq mr mf b"><strong class="kv io">repository.go</strong></code>å’Œ<code class="fe mp mq mr mf b"><strong class="kv io">repository_test.go</strong></code>ã€‚</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="ade9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">é¦–å…ˆï¼Œ<code class="fe mp mq mr mf b"><strong class="kv io">repository.go</strong></code>æ–‡ä»¶å°†æœ‰<code class="fe mp mq mr mf b"><strong class="kv io">Repository</strong></code>æ¥å£çš„å®ç°ï¼Œè¯¥æ¥å£æœ‰ä¸¤ä¸ªç®€å•çš„å‡½æ•°ç”¨äºè®¾ç½®å’Œè·å–æ•°æ®ã€‚å¦‚æœæ‚¨å·²ç»ç†Ÿæ‚‰äº†å¹²å‡€æ¶æ„çš„æ¦‚å¿µå’Œä¾èµ–æ³¨å…¥ï¼Œé‚£ä¹ˆä»£ç å¯¹æ‚¨æ¥è¯´å°±å¾ˆå®¹æ˜“äº†ã€‚å¦‚æœä½ ä¸ç†Ÿæ‚‰çš„è¯ï¼Œæˆ‘ç»™ä½ æ¨èè¿™ç¯‡<a class="ae ks" href="https://hackernoon.com/golang-clean-archithecture-efd6d7c43047" rel="noopener ugc nofollow" target="_blank"> <strong class="kv io"> <em class="lp">åœ¨Golang </em> </strong> </a> <strong class="kv io"> </strong>ä¸Šå°è¯•å¹²å‡€çš„æ¶æ„ç”±<a class="mu mv ep" href="https://medium.com/u/ef42567fbbae?source=post_page-----c22b5589ea37--------------------------------" rel="noopener" target="_blank"> Iman Tumorang </a>ã€‚è¿™æ˜¯ä¸€ç¯‡ä¼Ÿå¤§çš„æ–‡ç« ï¼Œä¹Ÿå­˜åœ¨äºå°åº¦å°¼è¥¿äºšè¯­ä¸­ï¼Œ<a class="ae ks" href="https://medium.com/golangid/mencoba-golang-clean-architecture-c2462f355f41" rel="noopener"> <strong class="kv io"> Mencobaå¹²å‡€çš„å»ºç­‘pada Golang </strong> </a>ã€‚æ„Ÿè°¢ä¼Šæ›¼çš„åˆ†äº«ã€‚</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="104a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">æœ€åï¼Œæµ‹è¯•æ–‡ä»¶<code class="fe mp mq mr mf b"><strong class="kv io">repository_test.go</strong></code>å°†ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®æµ‹è¯•å­˜å‚¨åº“ä»£ç ã€‚ä¸ºäº†æ›´å¥½åœ°ç†è§£ï¼Œæˆ‘å°†å¯¹è¿™ä¸€éƒ¨åˆ†è¿›è¡Œæ›´å¤šçš„è§£é‡Šã€‚</p><p id="ff0b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">è¿™ä¸ªæµ‹è¯•çš„ä¸»è¦ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦ä»miniredisä½¿ç”¨runå‡½æ•°è¿è¡Œå‡RedisæœåŠ¡å™¨ã€‚</p><pre class="kd ke kf kg gt me mf mg mh aw mi bi"><span id="890c" class="mj mk in mf b gy ml mm l mn mo">mr, err := miniredis.Run()<br/><strong class="mf io">if </strong>err != nil {<br/>   log.Fatalf(<strong class="mf io">"an error '%s' was not expected when opening a stub database connection"</strong>, err)<br/>}</span></pre><p id="de85" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">ç„¶åï¼Œä½¿ç”¨æ¥è‡ªminiredis addressçš„åœ°å€ä»go-redisåº“ä¸­åˆ›å»ºå®¢æˆ·æœºè¿æ¥ã€‚</p><pre class="kd ke kf kg gt me mf mg mh aw mi bi"><span id="4304" class="mj mk in mf b gy ml mm l mn mo">client = redis.NewClient(&amp;redis.Options{<br/>   Addr: mr.Addr(),<br/>})</span></pre><p id="a1a1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¥è‡ª<strong class="kv io"> elliotchance </strong>çš„<strong class="kv io"> redismockåº“</strong>åˆ›å»ºæ¨¡æ‹Ÿå‡½æ•°ã€‚åœ¨ä¸‹é¢çš„ä»£ç ä¸­ï¼Œå®ƒæ˜¯æ¥è‡ªæˆ‘ä»¬çš„Setå’ŒGetå‡½æ•°çš„æ¨¡æ‹Ÿæ•°æ®çš„ä¾‹å­ã€‚</p><pre class="kd ke kf kg gt me mf mg mh aw mi bi"><span id="bb07" class="mj mk in mf b gy ml mm l mn mo">mock := redismock.NewNiceMock(client)<br/>mock.On(<strong class="mf io">"Set"</strong>, key, val, exp).Return(redis.NewStatusResult(<strong class="mf io">""</strong>, nil))</span><span id="0ed0" class="mj mk in mf b gy mw mm l mn mo">mock := redismock.NewNiceMock(client)<br/>mock.On(<strong class="mf io">"Get"</strong>, key).Return(redis.NewStringResult(val, nil))</span></pre><p id="b501" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">å¦‚æœä½ å·²ç»åœ¨ä½¿ç”¨DATA-DOGçš„go-sqlmockï¼Œæ˜¯ä¸æ˜¯ä¹Ÿå·®ä¸å¤šï¼Ÿ</p><p id="79ca" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">å¥½å§ï¼æ˜¯æ—¶å€™è¿›è¡Œæµ‹è¯•äº†ã€‚ä½¿ç”¨<code class="fe mp mq mr mf b"><strong class="kv io">go test ./...</strong></code>æ‰§è¡Œæµ‹è¯•ç”¨ä¾‹ã€‚</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mx"><img src="../Images/6ee8107ea89dc4cde24a53a7d97fc643.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qUBjCCHVCbkaLh-bJSQYuw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Unit Test Result</figcaption></figure><p id="10ac" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">è¿˜æœ‰â€¦é…·ï¼Œæˆ‘ä»¬é€šè¿‡æµ‹è¯•äº†ï¼ï¼èµ·ä½œç”¨äº†ï¼ï¼</p><p id="31e5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">å¦‚æœæ‚¨æƒ³æŸ¥çœ‹è¿™ä¸ªæµ‹è¯•çš„å®Œæ•´ç¤ºä¾‹é¡¹ç›®ï¼Œæ‚¨å¯ä»¥è®¿é—®æˆ‘åœ¨GitHubä¸Šçš„è¿™ä¸ªé¡¹ç›®çš„å­˜å‚¨åº“ï¼Œ<a class="ae ks" href="https://github.com/moemoe89/go-unit-test-redis" rel="noopener ugc nofollow" target="_blank"><strong class="kv io">moe moe 89/go-unit-test-redis</strong></a>ã€‚</p><div class="my mz gp gr na nb"><a href="https://github.com/moemoe89/go-unit-test-redis" rel="noopener  ugc nofollow" target="_blank"><div class="nc ab fo"><div class="nd ab ne cl cj nf"><h2 class="bd io gy z fp ng fr fs nh fu fw im bi translated">moemoe89/go-unit-test-redis</h2><div class="ni l"><h3 class="bd b gy z fp ng fr fs nh fu fw dk translated">ğŸ“ˆGolangä¸­Redisçš„æ¨¡æ‹Ÿå•å…ƒæµ‹è¯•ï¼Œç”¨äºæˆ‘çš„ä¸­ç­‰æ•…äº‹ææ–™- moemoe89/go-unit-test-redis</h3></div><div class="nj l"><p class="bd b dl z fp ng fr fs nh fu fw dk translated">github.com</p></div></div><div class="nk l"><div class="nl l nm nn no nk np km nb"/></div></div></a></div><p id="f621" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">å¸Œæœ›ä½ å–œæ¬¢å®ƒï¼Œæˆ‘å¾ˆé«˜å…´å¦‚æœè¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰ç”¨ï¼æµ‹è¯•æ„‰å¿«ï¼</p><p id="3f45" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">è°¢è°¢å¤§å®¶ï¼</p></div><div class="ab cl nq nr hr ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ig ih ii ij ik"><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nx mt l"/></div></figure></div></div>    
</body>
</html>