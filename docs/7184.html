<html>
<head>
<title>Web Sockets now shipping in OkHttp 3.5!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OkHttp 3.5中的Web Sockets现已发布！</h1>
<blockquote>原文：<a href="https://medium.com/square-corner-blog/web-sockets-now-shipping-in-okhttp-3-5-463a9eec82d1?source=collection_archive---------0-----------------------#2016-12-02">https://medium.com/square-corner-blog/web-sockets-now-shipping-in-okhttp-3-5-463a9eec82d1?source=collection_archive---------0-----------------------#2016-12-02</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><blockquote class="ie"><p id="8182" class="if ig hh bd ih ii ij ik il im in io dx translated">注意，我们已经行动了！如果您想继续了解Square的最新技术内容，请访问我们的新家<a class="ae ip" href="https://developer.squareup.com/blog" rel="noopener ugc nofollow" target="_blank">https://developer.squareup.com/blog</a></p></blockquote><p id="45c4" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm io ha bi translated">与传统的HTTP请求/响应模型不同，web套接字提供完全双向的消息流。这意味着客户机和服务器都可以在任何时候向对方发送任意数量的消息。在今天的3.5版本中，OkHttp现在提供了对web sockets的本地支持！</p><p id="aa20" class="pw-post-body-paragraph iq ir hh is b it jn iv iw ix jo iz ja jb jp jd je jf jq jh ji jj jr jl jm io ha bi translated">通过向<code class="du js jt ju jv b">newWebSocket()</code>方法传递请求以及服务器发送消息的监听器来连接web套接字。</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="5057" class="ke kf hh jv b fi kg kh l ki kj">OkHttpClient client = new OkHttpClient();</span><span id="1dd1" class="ke kf hh jv b fi kk kh l ki kj">Request request = //...<br/>WebSocketListener listener = //...</span><span id="fb27" class="ke kf hh jv b fi kk kh l ki kj">WebSocket ws = client.newWebSocket(request, listener);</span></pre><p id="5e97" class="pw-post-body-paragraph iq ir hh is b it jn iv iw ix jo iz ja jb jp jd je jf jq jh ji jj jr jl jm io ha bi translated">分别通过调用<code class="du js jt ju jv b">send(String)</code>或<code class="du js jt ju jv b">send(ByteString)</code>将文本或二进制消息排队。因为OkHttp使用自己的线程来发送消息，所以你可以从任何线程(甚至是Android的主线程)调用<code class="du js jt ju jv b">send</code>。</p><p id="b3da" class="pw-post-body-paragraph iq ir hh is b it jn iv iw ix jo iz ja jb jp jd je jf jq jh ji jj jr jl jm io ha bi translated">从服务器接收到的消息将作为<code class="du js jt ju jv b">String</code>或<code class="du js jt ju jv b">ByteString</code>传递给监听器的<code class="du js jt ju jv b">onMessage</code>回调。监听器也有回调，通知您连接的生命周期。</p><p id="1b04" class="pw-post-body-paragraph iq ir hh is b it jn iv iw ix jo iz ja jb jp jd je jf jq jh ji jj jr jl jm io ha bi translated">我们很高兴终于能够在OkHttp中共享一个稳定的web socket API。通过将以下内容添加到您的<code class="du js jt ju jv b">build.gradle</code>，在您的应用中使用3.5版:</p><pre class="jw jx jy jz fd ka jv kb kc aw kd bi"><span id="18a9" class="ke kf hh jv b fi kg kh l ki kj">compile 'com.squareup.okhttp3:okhttp:3.5.0</span></pre><p id="425d" class="pw-post-body-paragraph iq ir hh is b it jn iv iw ix jo iz ja jb jp jd je jf jq jh ji jj jr jl jm io ha bi translated">此版本的完整变更日志可在<a class="ae ip" href="https://github.com/square/okhttp/blob/master/CHANGELOG.md#version-350" rel="noopener ugc nofollow" target="_blank">此处</a>获得。</p></div><div class="ab cl kl km go kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ha hb hc hd he"><p id="1dfe" class="pw-post-body-paragraph iq ir hh is b it jn iv iw ix jo iz ja jb jp jd je jf jq jh ji jj jr jl jm io ha bi translated">精明的OkHttp用户在阅读这篇文章时可能会有点困惑，因为web sockets已经被稍微支持了一段时间。一个名为<code class="du js jt ju jv b">okhttp-ws</code>的独立产品已经问世近两年，但它的API被认为不稳定。甚至在此之前，一些实现web socket协议的类已经存在于“内部”包中。</p><p id="3379" class="pw-post-body-paragraph iq ir hh is b it jn iv iw ix jo iz ja jb jp jd je jf jq jh ji jj jr jl jm io ha bi translated">web sockets和OkHttp的历史可以追溯到三年前尚未发布的Android版本<a class="ae ip" href="https://github.com/square/PonyDebugger" rel="noopener ugc nofollow" target="_blank"> PonyDebugger </a>，这是Chrome DevTools协议的一个实现，用于检查和更改设备上运行的应用程序的调试版本。遗憾的是，有人抢先我们为Android开源了这个工具，所以我们的工具可能永远不会问世。</p><p id="1639" class="pw-post-body-paragraph iq ir hh is b it jn iv iw ix jo iz ja jb jp jd je jf jq jh ji jj jr jl jm io ha bi translated">所有这些内部工作以及一些使用早期实现的公司的支持最终导致了一个发布版本。感谢这些年来贡献或归档bug的所有人。</p></div></div>    
</body>
</html>