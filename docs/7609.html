<html>
<head>
<title>Spock for BDD unit testing in Java</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Java进行BDD单元测试的Spock</h1>
<blockquote>原文：<a href="https://medium.com/version-1/spock-for-bdd-unit-testing-in-java-d67c2ddf25ad?source=collection_archive---------5-----------------------#2022-10-17">https://medium.com/version-1/spock-for-bdd-unit-testing-in-java-d67c2ddf25ad?source=collection_archive---------5-----------------------#2022-10-17</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/5701f1ea0668b5f641f23f2bddb60aa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/1*ZppzgVObzIdxSutfDhsQbA.jpeg"/></div></figure><p id="7400" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">好吧，好吧，我要说的不是史波克先生。但我不得不承认我两样都喜欢。用于单元测试的Spock测试框架非常符合<strong class="in hi"> Given-When-Then </strong>单元测试模式。但似乎并没有很多人知道这个框架，它也不能像JUnit一样拥有巨大的人气。</p><p id="05d6" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这个小博客简要描述了Spock框架，并将其与流行的工具JUnit进行了比较，以展示Spock的能力。这不是一个如何使用Spock的教程。这只是给你一个框架是什么的概念，以及你是否想在你的应用程序中使用Spock。</p><h1 id="fbff" class="jj jk hh bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated"><strong class="ak">谁，我是说，斯波克是什么？</strong></h1><p id="0524" class="pw-post-body-paragraph il im hh in b io kh iq ir is ki iu iv iw kj iy iz ja kk jc jd je kl jg jh ji ha bi translated">从介绍中可以看出，Spock是一个测试框架，而不是星舰USS Enterprise的科学官。这个框架可以用于Java或Groovy应用程序的单元、组件和集成测试。对于参考和文档，你可以使用斯波克的官方网站【https://spockframework.org/ T4】。</p><p id="3c64" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">斯波克是用Groovy写的。Groovy是Java的超集，所以用Java应用程序运行我们的测试不成问题。如果您有一个同时用Java和Groovy编写的应用程序，这个框架特别有用，因为它允许您用一种语言一致地、结构化地为整个应用程序编写测试，而不是让测试部分用Java编写，部分用Groovy编写。</p><p id="8db0" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">除了与著名的《星际迷航》角色明显相似之外，这个框架的突出之处在于它强制执行了行为驱动开发(BDD)和测试驱动开发(TDD)的约定。并且它使得<strong class="in hi">给定时间然后</strong>单元测试模式易于实现。如果斯波克先生对单元测试感兴趣的话，他可能真的会这么做。如果你不知道，<strong class="in hi"> Given-When-Then </strong>是由Chris Matts和Daniel Terhorst-North作为BDD的一部分引入的一种方法。这种方法更常用于集成测试。但也用于单元测试中，以促进TDD，确保单元测试的结构化方法、可读性和可维护性，以及如何编写单元测试的一致性。在我们开始开发一个类之前，Spock允许你以一种易读易懂的方式来识别这个类的行为。</p><p id="af13" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">Spock框架受到InteliJ和Eclipse等不同ide的支持，可以很容易地集成到Spring或SpringBoot应用程序中。例如，下面是maven pom.xml的样子:</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div class="er es kn"><img src="../Images/3cc5934c5afc5d7ec9461875799bb23c.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*q6x9BCHFAD6vB6Y_Dq9fvw.png"/></div></figure><p id="be28" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这里有一个Gradle的例子:</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div class="er es ks"><img src="../Images/858efc189c870d2745d1e4b89b7bb485.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/format:webp/1*T2aM2jr416cN_0RYUtjl7g.png"/></div></figure><p id="aa89" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如果你不熟悉Spock，有很多教程可以帮助你入门。但是支持社区不像JUnit那样广泛。</p><h1 id="929f" class="jj jk hh bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated"><strong class="ak">斯波克vs朱尼特</strong></h1><figure class="ko kp kq kr fd ii er es paragraph-image"><div class="er es kt"><img src="../Images/31a177b1c6da4907f441d5472fa29876.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/format:webp/1*qHJvu3_NXeymFoZyAmODcw.png"/></div></figure><p id="24db" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">对斯波克来说，这是一场艰难的战斗。而且我觉得不会有赢家。这实际上取决于应用程序和编写该应用程序的团队的偏好。</p><h2 id="c91b" class="ku jk hh bd jl kv kw kx jp ky kz la jt iw lb lc jx ja ld le kb je lf lg kf lh bi translated">先给后给单元测试模式</h2><p id="6184" class="pw-post-body-paragraph il im hh in b io kh iq ir is ki iu iv iw kj iy iz ja kk jc jd je kl jg jh ji ha bi translated">想象一下，我们正在为一家乏味的、可能有点不靠谱的汽车租赁公司编写API。API检索所有可供租用的汽车，并根据汽车类型和租用期限给出客户想要租用的汽车的估计费用。我们决定用一个计算器来计算招聘成本。当没有选择汽车时，我们希望计算器返回0。因此，单元测试场景将是:</p><blockquote class="li lj lk"><p id="2ea2" class="il im ll in b io ip iq ir is it iu iv lm ix iy iz ln jb jc jd lo jf jg jh ji ha bi translated"><strong class="in hi"> <em class="hh">给出:</em> </strong> <em class="hh"> </em>空车清单</p><p id="beb1" class="il im ll in b io ip iq ir is it iu iv lm ix iy iz ln jb jc jd lo jf jg jh ji ha bi translated"><strong class="in hi"> <em class="hh">和</em> </strong>:有效租用期</p><p id="0299" class="il im ll in b io ip iq ir is it iu iv lm ix iy iz ln jb jc jd lo jf jg jh ji ha bi translated"><strong class="in hi"> <em class="hh">何时:</em> </strong>计算租用成本</p><p id="0c3d" class="il im ll in b io ip iq ir is it iu iv lm ix iy iz ln jb jc jd lo jf jg jh ji ha bi translated"><strong class="in hi"> <em class="hh">然后:</em> </strong>返回0</p></blockquote><p id="44d4" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">下面是一个用JUnit5编写的测试这个场景的单元测试:</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lp"><img src="../Images/4a2ea38920111ea46071ae53f8d1289b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Up3zd69kSeiEm1H0T07DUw.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx">Unit test in JUnit5</figcaption></figure><p id="abce" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这是一个用Spock编写的单元测试:</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lp"><img src="../Images/bc96aedbc80895ff7c511c41b1b5c670.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dh6uY0oMaJmEtwkj2EoPlg.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx">Unit test in Spock</figcaption></figure><p id="1033" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如你所见，对于Spock，我们有一个给出的<strong class="in hi">When Then</strong>块和一个场景描述。我们不需要像在JUnit中那样在注释中定义这些块。当我们在开发计算方法之前编写这些规范和测试时，我们是用更“人性化”的语言来做的。这使得我们想要实现什么行为以及我们正在测试什么变得更加清楚。</p><p id="d86a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如果你不喜欢为单元测试写文章，Spock还允许定义没有描述的时给出的<strong class="in hi">。</strong></p><h2 id="05b7" class="ku jk hh bd jl kv kw kx jp ky kz la jt iw lb lc jx ja ld le kb je lf lg kf lh bi translated">嘲笑和打击</h2><p id="e665" class="pw-post-body-paragraph il im hh in b io kh iq ir is ki iu iv iw kj iy iz ja kk jc jd je kl jg jh ji ha bi translated">我们可以在JUnit中使用很多模仿框架。为了便于比较，我们将使用Mockito作为JUnit的助手(或minion)。</p><p id="bd79" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">另一方面，斯波克有自己内置的嘲讽、存根和间谍。因此它不需要添加额外的库。斯波克假装对区分stubbing和嘲讽非常严格。事实上，在测试中，当我们说“模拟”时，我们的意思是我们模拟整个类，当我们说“存根”时，我们存根该类的某个行为。所以如果我们在斯波克身上留下了什么东西，它不会被嘲笑。然而，就像在《摩奇托》和《斯波克》中一样，在一个被模仿的类中发现一个行为，并验证我们和那个类有多少互动是可能的。唯一的区别是我们在哪里验证交互。</p><p id="70d3" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">想象一下，我们那家有点不靠谱的汽车租赁公司想在结账时，在租赁费用的基础上额外收取一些管理费，让他们的客户大吃一惊。我们的服务将根据用户选择检索雇佣成本，检索管理费用，并返回综合结果。瞧，顾客将被收取更多的费用！</p><p id="4753" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这是我们的JUnit测试对这种偷偷摸摸的行为可能看起来像:</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es ly"><img src="../Images/aef5815731f8360cf6c6b6cb08e000e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zNu6siq2OTfywgM3AqDwVg.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx">Unit test in JUnit5</figcaption></figure><p id="9818" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这是单元测试在斯波克身上的样子:</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lz"><img src="../Images/4d3ef258ded4cd15cf572ae913907ec9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9RfGvPmWDQdxzPDD4534Xg.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx">Unit test in Spock</figcaption></figure><p id="20a0" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在Spock中，我们定义了在stub行为中(在<strong class="in hi">给定的</strong>块中)我们期望与被模仿的类进行多少次交互。在Mockito中，我们验证了在<strong class="in hi">然后</strong>块中有多少交互。在这两种情况下，结果是一样的，意义也是一样的——我们只期望与<em class="ll"> AdminFees </em>进行一次交互。如果有一个以上的交互或没有交互，两个测试都将失败。</p><h2 id="3c0d" class="ku jk hh bd jl kv kw kx jp ky kz la jt iw lb lc jx ja ld le kb je lf lg kf lh bi translated">异常测试</h2><p id="8230" class="pw-post-body-paragraph il im hh in b io kh iq ir is ki iu iv iw kj iy iz ja kk jc jd je kl jg jh ji ha bi translated">Spock和JUnit都使我们能够测试某个行为是否抛出异常。Spock使用<em class="ll"> thrown() </em>来验证是否抛出了异常，并使用<em class="ll"> notThrown() </em>来验证没有抛出异常。</p><p id="1f4d" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">回到我们的汽车租赁公司的API，我们决定，如果提供了不正确的租赁期，我们的租赁成本计算器将会抱怨。例如，提供的时间段可能是过去的，或者结束日期和开始日期颠倒了，或者更糟的是，根本没有提供时间段。在这种情况下，我们希望我们的服务变得非常愤怒，并向违规者抛出一个异常。</p><p id="6aa6" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我们在JUnit中的单元测试如下所示:</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es ma"><img src="../Images/2341058301360af9b4cbd79871932021.png" data-original-src="https://miro.medium.com/v2/resize:fit:1328/format:webp/1*sGZv37gzJiZA4QVlWhq28Q.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx">Unit test in JUnit5</figcaption></figure><p id="e245" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在斯波克身上:</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mb"><img src="../Images/c8e36fcaa38b2ea2d7712be2e315133b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J7hqnyZoCsf03_SjKUlmNQ.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx">Unit test in Spock</figcaption></figure><h2 id="29b7" class="ku jk hh bd jl kv kw kx jp ky kz la jt iw lb lc jx ja ld le kb je lf lg kf lh bi translated">文档和可读性</h2><p id="ca04" class="pw-post-body-paragraph il im hh in b io kh iq ir is ki iu iv iw kj iy iz ja kk jc jd je kl jg jh ji ha bi translated">正如您在前面的例子中看到的，Spock使我们能够记录我们期望我们的测试类如何以更人性化的语言表现。可读性允许更好地理解我们期望什么样的行为以及我们正在测试什么。这反过来提供了更好的可维护性和对系统行为、代码和测试的更好理解。</p><p id="81b9" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">当我们运行测试时，我们希望看到测试了什么样的行为，以及在该行为中预期了什么。在JUnit中，清晰度取决于我们命名测试方法的方式。我们的例子中的行为不是很容易被人理解，但是我们仍然可以理解它(假设它是一个开发人员在查看测试执行):</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div class="er es mc"><img src="../Images/7bdc5f290398986d825e44e7319f4294.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*fSLTXHUsS3BMQaUMXtxtGg.png"/></div><figcaption class="lu lv et er es lw lx bd b be z dx">JUnit test execution in InteliJ</figcaption></figure><p id="d291" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这就是我们将在Spock测试中看到的:</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div class="er es md"><img src="../Images/13320f993abf2efe2ae5ab74cf0eb799.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*aEZ2KRtiJ1BEAT1p37ypzw.png"/></div><figcaption class="lu lv et er es lw lx bd b be z dx">Spock unit test execution in InteliJ</figcaption></figure><p id="8175" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">再一次，斯波克先生，我是说斯波克框架，使得执行文档更具可读性。几乎像一首诗。即使是一个没有多少IT知识或编程技能的人也能理解<em class="ll"> VehicleCostCalculator </em>应该做什么。</p><h1 id="ff94" class="jj jk hh bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated">摘要</h1><p id="9b8b" class="pw-post-body-paragraph il im hh in b io kh iq ir is ki iu iv iw kj iy iz ja kk jc jd je kl jg jh ji ha bi translated">在这篇博客中，我们只看了单元测试中的Spock。Spock使我们能够像测试JUnit一样测试Java/Groovy应用程序，包括模仿依赖关系。</p><p id="c453" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">与JUnit不同，Spock不需要任何其他框架来嘲笑、监视和阻止。所以我们不需要添加额外的库。斯波克更喜欢单干。尽管Spock对模仿和反对非常严格，但我们可以模仿和测试与模仿者的交互，就像Mockito/JUnit team一样。</p><p id="b1c3" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">Spock的一个主要优点是它允许我们以一致的、结构化的、可读性更强的方式编写单元测试。可读性使我们能够理解我们期望从被测试的类的行为中得到什么，以及我们正在测试什么。此外，它增强了我们的测试、代码和应用程序的可维护性。</p><p id="e402" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">Spock得到了许多ide的支持，但是没有那么大的支持社区。</p><p id="3886" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">最后，由开发团队来考虑是使用Spock还是使用其他东西，比如JUnit。</p><p id="4470" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如果你想看看一个为一个虚构的有点狡猾和无聊的汽车租赁公司制作的API，这里作为一个例子来演示单元测试中的Spock，你可以从<a class="ae km" href="https://github.com/TMaslova-Howl/DodgyVehicleHireExample/tree/master" rel="noopener ugc nofollow" target="_blank"> git hub repository </a>获得它。</p><p id="5e26" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi">关于作者:<br/> </strong>坦尼娅·玛丝洛娃是第一版的Java开发人员。</p></div></div>    
</body>
</html>