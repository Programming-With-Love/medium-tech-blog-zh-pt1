<html>
<head>
<title>Membuat Mock Server dengan OpenAPI 3 di Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Membuat Mock Server dengan OpenAPI 3 di Kubernetes</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.easyread.co/membuat-mock-server-dengan-openapi-3-di-kubernetes-b9963ed2ac40?source=collection_archive---------7-----------------------#2018-12-24">https://medium.easyread.co/membuat-mock-server-dengan-openapi-3-di-kubernetes-b9963ed2ac40?source=collection_archive---------7-----------------------#2018-12-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="c7e2" class="pw-subtitle-paragraph jl im in bd b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc dk translated">Part 4 dari Project <a class="ae kd" href="https://medium.com/easyread/christmas-tale-of-sofware-engineer-project-kube-xmas-9167ebca70d2" rel="noopener"> Kube-Xmas Series </a></h2></div><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="gh gi ke"><img src="../Images/d8722a62cdeda91b2abbab1de75af0db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Hng5XOYQEDo-8VT-"/></div></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk">Photo by <a class="ae kd" href="https://unsplash.com/@zhenhu2424?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Zhen Hu</a> on <a class="ae kd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="7913" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Halooo... Kembali lagi dengan <a class="ae kd" href="https://medium.com/@imantumorang" rel="noopener"> saya </a> , semoga tidak bosan dengan series ini ğŸ˜ƒ <em class="lq"> Nah, </em> di seri kali ini, saya akan membahas tentang pembuatan Mock API server menggunakan OpenAPI 3 :D</p><p id="68be" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Terimakasih kepada <a class="ae kd" href="https://github.com/danielgtaylor" rel="noopener ugc nofollow" target="_blank"> danielgtaylor </a> / <a class="ae kd" href="https://github.com/danielgtaylor/apisprout" rel="noopener ugc nofollow" target="_blank"> apisprout </a> ğŸ˜ƒ. Saya menggunakan <em class="lq"> docker image </em> yang dia buat untuk membantu saya membuat <em class="lq"> mock server </em> . Hanya dengan menyediakan <code class="fe lr ls lt lu b"> openapi.yaml</code> mock saya langsung dirender olehnya menjadi container. Sesimple itu ğŸ˜</p><p id="2342" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated"><em class="lq"> Nah </em> , untuk melakukannya, saya membuat satu <code class="fe lr ls lt lu b">Dockerfile</code> yang akan membuat image <em class="lq"> docker container </em> baru dengan base dari image <code class="fe lr ls lt lu b">apisprout</code></p><pre class="kf kg kh ki gt lv lu lw lx aw ly bi"><span id="4903" class="lz ma in lu b gy mb mc l md me">FROM danielgtaylor/apisprout</span><span id="8ad5" class="lz ma in lu b gy mf mc l md me">ADD docs/openapi.yaml /data/openapi.yaml</span></pre><p id="8349" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Dan selanjutnya mem-build <em class="lq"> docker image </em> dari situ dan <em class="lq"> push </em> ke docker container registry.</p><pre class="kf kg kh ki gt lv lu lw lx aw ly bi"><span id="133b" class="lz ma in lu b gy mb mc l md me">$ docker build . -t bxcodec/mock-tweet -f DockerfileMockTweet</span><span id="ccdd" class="lz ma in lu b gy mf mc l md me">$ docker push bxcodec/mock-tweet:latest</span></pre><p id="5d0a" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated"><em class="lq"> *Saya menggunakan docker-hub public repository sebagai container-registry saya, namun untuk kebutuhan pribadi, saya biasanya menggunakan google GCR sebagai container registry private saya :D </em></p><p id="2d7b" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Selanjutnya tambahkan <em class="lq"> deployment </em> ke dalam <em class="lq"> kubernetes </em> kita, agar <em class="lq"> mock server </em> kita aktif dan dapat diakses oleh <em class="lq"> frontend engineer </em> :D</p><h2 id="c9d0" class="lz ma in bd mg mh mi dn mj mk ml dp mm ld mn mo mp lh mq mr ms ll mt mu mv mw bi translated"><strong class="ak"> Apply Deployment </strong></h2><p id="f936" class="pw-post-body-paragraph ku kv in kw b kx mx jp kz la my js lc ld mz lf lg lh na lj lk ll nb ln lo lp ig bi translated">Untuk men- <em class="lq"> deploy container mock </em> API kita, pertama kita akan <em class="lq"> setup </em> konfigurasi dari <em class="lq"> kubernetes deployment </em> kita.</p><p id="efc7" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Saya sudah membuatnya disini, untuk jelasnya tentang syntax ini, akan saya jelaskan nanti kalau sempat :D, atau mungkin di lain artikel yang bukan bagian dari part seri Project Kube-Xmas ini.</p><p id="7c65" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Simplenya, jika ingin membuat mock-server jika belum tahu apa-apa, tinggal rename kata-kata yang ada di konfig dibawah sesuai kebutuhan :D.</p><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="a9ab" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Selanjutnya, kita hanya tinggal meng- <em class="lq"> apply deployment script </em> tersebut ke <em class="lq"> Kubernetes cluster </em> kita dengan <em class="lq"> command </em> :</p><pre class="kf kg kh ki gt lv lu lw lx aw ly bi"><span id="e987" class="lz ma in lu b gy mb mc l md me">$ kubectl apply -f mock-tweet-deployment.yaml</span></pre><p id="3dcb" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Dengan begini, aplikasi mock yang saya buat akan berhasil di deploy ke kubernetes cluster yang telah saya buat dari awal, Kube-Xmas.</p><pre class="kf kg kh ki gt lv lu lw lx aw ly bi"><span id="a878" class="lz ma in lu b gy mb mc l md me">$ kubectl get pods -n staging</span></pre><p id="fb27" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Akan menampilkan hasil berikut:</p><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/a502abb6522f07aa19849026d85cb367.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*TXF7qkTtZO_3e_zcC38fIQ.png"/></div></figure><p id="cda9" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Akan muncul pod dengan nama: <code class="fe lr ls lt lu b">mock-tweet-random-key</code> dan statusnya. <br/> <strong class="kw io"> Ready 1/1: </strong> Artinya terdapat 1 pod yang aktif dari 1 pod yang tersedia. Enaknya di <em class="lq"> kubernetes </em> , kita bisa <em class="lq"> running </em> banyak pods dengan satu aplikasi yang sejenis dengan <em class="lq"> service horizontal autoscaling. </em></p><p id="b9e8" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Jika pada pods terjadi masalah, maka pods akan te- <em class="lq"> restart </em> terus menerus sampai kita menyelesaikan masalah tersebut.</p><p id="1c64" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Dan untuk mengecek <em class="lq"> deployment </em> dapat dilakukan dengan:</p><pre class="kf kg kh ki gt lv lu lw lx aw ly bi"><span id="caac" class="lz ma in lu b gy mb mc l md me">$ kubectl get deployments -n staging</span></pre><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/db9fa15f6dcb5bb2b70b9f4328971364.png" data-original-src="https://miro.medium.com/v2/resize:fit:1098/format:webp/1*qeMRxVDQ7Io2wgYO4F8UtA.png"/></div></figure><p id="6186" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated"><em class="lq"> Nah, deployment </em> ini bertugas akan memastikan pod yang ditanggung jawabi agar selalu <em class="lq"> available </em> . Sehingga jika suatu pods mati, <em class="lq"> deployment </em> ini akan membuat pods baru di cluster tersebut.</p><h2 id="7e64" class="lz ma in bd mg mh mi dn mj mk ml dp mm ld mn mo mp lh mq mr ms ll mt mu mv mw bi translated"><strong class="ak"> Apply Ingress </strong></h2><p id="91c1" class="pw-post-body-paragraph ku kv in kw b kx mx jp kz la my js lc ld mz lf lg lh na lj lk ll nb ln lo lp ig bi translated">Selanjutnya kita tambahkan <em class="lq"> Ingress Configuration </em> kita agar <em class="lq"> mock server </em> kita dapat diakses dari luar.</p><p id="858c" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Konfigurasinya bisa dilihat seperti dibawah. Karena sebelumnya saya menggunakan NGINX sebagai <em class="lq"> Ingress Controller </em> saya, maka dapat dilihat saya menggunakan ingress NGINX di konfigurasi di bawah ini.</p><p id="e1df" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Sekaligus saya membuat host-name yang nantinya jadi host mock-server ini, yakni: <code class="fe lr ls lt lu b">mock.tweet.tweetor.xyz</code></p><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="nc nd l"/></div></figure><p id="fe5f" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Dan selanjutnya <em class="lq"> apply </em> ingress tersebut:</p><pre class="kf kg kh ki gt lv lu lw lx aw ly bi"><span id="701c" class="lz ma in lu b gy mb mc l md me">$ kubectl apply -f mock-tweet-ingress.yaml</span></pre><p id="64bd" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Setelah di <em class="lq"> apply </em> lakukan <em class="lq"> command </em> ini,</p><pre class="kf kg kh ki gt lv lu lw lx aw ly bi"><span id="5e8e" class="lz ma in lu b gy mb mc l md me">$ kubectl get ingress -n staging</span></pre><div class="kf kg kh ki gt ab cb"><figure class="ng kj nh ni nj nk nl paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><img src="../Images/90ed050a8ab75b827225469c718b347b.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*6kwjDQSiNA6Km_BXH0H0Gg.png"/></div></figure><figure class="ng kj nm ni nj nk nl paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><img src="../Images/18fc5a76e5eabc38fe5442a4383895a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*gs-KgAzG3fef7cqUSyF_8Q.png"/></div></figure></div><p id="6690" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Lakukan secara berulang sampai IP <em class="lq"> address </em> -nya terdaftar. Setelah IP <em class="lq"> address </em> terdaftar di <em class="lq"> Ingress Controller </em> , maka saatnya kita mendaftarkannya ke domain <em class="lq"> management </em> kita.</p><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/ff423bd79bca2702f978b5b66c9836cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/1*V2idTCJBr-J62li4dI58Uw.png"/></div></figure><p id="cc55" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Selanjutnya tambahkan bind IP <em class="lq"> address </em> tersebut ke domain kita di domain <em class="lq"> manager </em> kita dengan menambahkannya ke DNS management kita.</p><p id="e8c9" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Tambahkan DNS <em class="lq"> address record </em> resource (A) pada DNS kita dengan value IP <em class="lq"> address </em> yang tersebut diatas: <code class="fe lr ls lt lu b">35.247.134.168</code></p><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div class="gh gi no"><img src="../Images/e6ffdf029461ef5cac50d76a314cda72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*A2YVjrq2T-0EXxvWBFZ48Q.png"/></div></figure><p id="1978" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Tunggu sampai beberapa menit sampai domainnya terdaftar, untuk memastikan domainnya terdaftar kamu dapat menggunakan command <code class="fe lr ls lt lu b">dig</code> pada unix, atau dapat juga menggunakan google dig disini: <a class="ae kd" href="https://toolbox.googleapps.com/apps/dig" rel="noopener ugc nofollow" target="_blank"> https://toolbox.googleapps.com/apps/dig </a></p><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="gh gi np"><img src="../Images/d74cd66340d476211e6f0287856d5d75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qyDaVFo-VKipqKYhlxhrDw.png"/></div></div></figure><p id="4716" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Setelah domain tersebut terdaftar, kita sekarang sudah bisa mengakses mock-api server kita tersebut lewat postman, atau curl</p><pre class="kf kg kh ki gt lv lu lw lx aw ly bi"><span id="8cd8" class="lz ma in lu b gy mb mc l md me">$ curl mock.tweet.tweetor.xyz/tweets<br/>[<br/>  {<br/>    "createdTime": "2018-12-24T09:21:41.827Z",<br/>    "id": "abc-f45def-5sdaf-5636f",<br/>    "text": "Merry Christmast Everyone!!!"<br/>  },<br/>  {<br/>    "createdTime": "2018-12-23T09:21:41.827Z",<br/>    "id": "abc-f45def-5sdaf-5636f",<br/>    "text": "I believe santa will give me a great present"<br/>  },<br/>  {<br/>    "createdTime": "2018-12-22T09:21:41.827Z",<br/>    "id": "abc-f45def-5sdaf-5636f",<br/>    "text": "Hello my secret santa. Thank you!!!"<br/>  }<br/>]</span></pre><p id="dc57" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Yaaayy!!! Another post selesai :D. Sampai disini saya sudah menulis bagaimana membuat mock-server pada kubernetes cluster yang telah saya buat untuk project Kube-Xmas ini.</p><p id="06c7" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Nah selanjutnya akan membahas tentang implementasi dari aplikasi yang saya buat. Saya sudah membuat aplikasinya sampai begadang cuy ğŸ˜¢. Demi mengejar publish on Christmas .</p><p id="4a54" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Thanks to:</p><ul class=""><li id="e9b2" class="nq nr in kw b kx ky la lb ld ns lh nt ll nu lp nv nw nx ny bi translated"><a class="ae kd" href="https://github.com/danielgtaylor/apisprout" rel="noopener ugc nofollow" target="_blank">https://github.com/danielgtaylor/apisprout </a></li></ul><h2 id="3a36" class="lz ma in bd mg mh mi dn mj mk ml dp mm ld mn mo mp lh mq mr ms ll mt mu mv mw bi translated">ä¸‹ä¸€ä¸ª</h2><ul class=""><li id="9003" class="nq nr in kw b kx mx la my ld nz lh oa ll ob lp nv nw nx ny bi translated"><a class="ae kd" href="https://medium.com/easyread/men-dockerize-aplikasi-golang-9c32959c657e" rel="noopener"><strong class="kw io">Men-dockerize Voli Golang </strong></a></li></ul><h2 id="b6d3" class="lz ma in bd mg mh mi dn mj mk ml dp mm ld mn mo mp lh mq mr ms ll mt mu mv mw bi translated">æ™®é›·å¤«</h2><ul class=""><li id="bb4a" class="nq nr in kw b kx mx la my ld nz lh oa ll ob lp nv nw nx ny bi translated"><a class="ae kd" href="https://medium.com/easyread/setting-nginx-ingress-controller-di-kubernetes-google-cloud-10f2c9c0be16" rel="noopener"><strong class="kw io">Setting NGINX Ingress Controller di Kubernetes Google Cloud </strong></a></li></ul></div><div class="ab cl oc od hr oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="ig ih ii ij ik"><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="oj nd l"/></div></figure></div></div>    
</body>
</html>