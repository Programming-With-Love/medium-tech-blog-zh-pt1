# ç”¨äºå¿«é€ŸæœåŠ¡å™¨åŸå‹åˆ¶ä½œçš„ Ktor

> åŸæ–‡ï¼š<https://blog.kotlin-academy.com/ktor-for-fast-server-prototyping-6e7c6d2ec296?source=collection_archive---------5----------------------->

![](img/31e41750a9cd4ebce70255ae9348faa9.png)

Photo by [Mark Seletcky](https://unsplash.com/@seletcky?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral)

Ktor æ˜¯ä¸€ä¸ªç”¨ Kotlin åˆ›å»ºæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯åº”ç”¨ç¨‹åºçš„æ¡†æ¶ã€‚æ­£å¦‚åˆ›é€ è€…æ‰€è¯´â€”â€”å®ƒçš„æœ€ç»ˆç›®æ ‡æ˜¯ä¸ºäº’è”çš„å¤šå¹³å°åº”ç”¨æä¾›ç«¯åˆ°ç«¯çš„è§£å†³æ–¹æ¡ˆã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæ‚¨å°†æ‰¾åˆ°ç®€å•æœåŠ¡å™¨åº”ç”¨ç¨‹åºçš„ Ktor è®¾ç½®å’Œå®ç°çš„åŸºç¡€ã€‚

# è£…ç½®

å¯¹äºå¿«é€ŸåŸå‹ï¼Œä½ é€šå¸¸ä¸éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›®â€”â€”ä½ ç”šè‡³å¯ä»¥åœ¨ä¸€ä¸ª Android é¡¹ç›®ä¸­æ·»åŠ  Ktor æ¨¡å—ä½œä¸ºä¸€ä¸ª Gradle å­é¡¹ç›®ã€‚å…·æœ‰ Ktor ä¾èµ–å…³ç³»çš„æœ€åŸºæœ¬çš„ build.gradle å¦‚ä¸‹æ‰€ç¤º:

ä½ è¿˜åº”è¯¥åœ¨`src/resources`ä¸­å®šä¹‰`application.conf`æ–‡ä»¶ï¼Œè¿™æ ·`application`æ’ä»¶å°±ä¼šçŸ¥é“å¦‚ä½•å¯åŠ¨ä½ çš„åº”ç”¨ç¨‹åº:

# å±¥è¡Œ

## è¿è¡Œæ­£å¸¸çš„

è®©æˆ‘ä»¬ä»ä¸€ä¸ªç®€å•çš„ç«¯ç‚¹å¼€å§‹ï¼Œå®ƒå°†è¿”å›é¢„å®šä¹‰çš„å€¼å’Œ Http çŠ¶æ€ä»£ç :

è®©æˆ‘ä»¬åœ¨æœ¬åœ°æµ‹è¯•è¿™ä¸ªç«¯ç‚¹ã€‚æ‰§è¡Œ`./gradlew run`å¹¶ç­‰å¾…åº”ç”¨ç¨‹åºå¯åŠ¨ã€‚ç„¶åä½¿ç”¨ curl æˆ–æ‚¨æœ€å–œæ¬¢çš„ rest å®¢æˆ·ç«¯ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆ:

```
$ curl -i localhost:8080/
HTTP/1.1 200 OK
Content-Length: 13
Content-Type: text/plain; charset=UTF-8Test message
```

æˆ‘ä»¬æ”¶åˆ°äº†ä¸€æ¡åŸå§‹å›å¤ã€‚åœ¨åº”ç”¨å®¢æˆ·ç«¯ï¼Œæˆ‘ä»¬ä¸å–œæ¬¢æ–‡æœ¬å“åº”ï¼Œæˆ‘ä»¬åœ¨ä»»ä½•åœ°æ–¹éƒ½ä½¿ç”¨ JSONã€‚å¦‚ä½•ä»ä½ çš„ API è¿”å› JSONï¼Ÿæ²¡æœ‰æ›´ç®€å•çš„äº†ã€‚æˆ‘ä»¬å°†åˆ©ç”¨ Ktor JSON çš„ä¸€ä¸ªç‰¹æ€§ã€‚

> KTOR çš„ç‰¹æ€§æ˜¯å¯æ’æ‹”ä¾èµ–â€”â€”åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œå®ƒæ‹¦æˆªè¯·æ±‚å’Œå“åº”ï¼Œå¹¶èƒ½å¤Ÿå¯¹å®ƒä»¬åšä¸€äº›äº‹æƒ…ã€‚åœ¨åº”ç”¨ DSL ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å®‰è£…åŠŸèƒ½æ·»åŠ è¯¥ç‰¹æ€§ã€‚

æ·»åŠ ä¾èµ–é¡¹:

```
implementation "io.ktor:ktor-gson:$ktor_version"
```

å¹¶åœ¨åº”ç”¨ç¨‹åºä¸­å®‰è£…è¯¥åŠŸèƒ½:

å¦‚æ‚¨æ‰€è§ï¼Œæ·»åŠ äº†`mapOf("status" to "Test message")`â€”â€”Gson ä¼šå°†è¯¥ç»“æ„è§£æä¸ºå¯è¯»çš„ Jsonã€‚

é‡æ–°æ„å»ºé¡¹ç›®å¹¶å†æ¬¡æµ‹è¯•æ‚¨çš„ç«¯ç‚¹:

```
$ curl -i localhost:8080/
HTTP/1.1 200 OK
Content-Length: 25
Content-Type: application/json; charset=UTF-8{"status":"Test message"}
```

## åˆ›å»ºã€è¯»å–ã€æ›´æ–°ã€åˆ é™¤

ä¸ºäº†ä½¿ç”¨ CRUD åŠŸèƒ½ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹å¸¦æœ‰å†…å­˜æ•°æ®æºå®ç°çš„å­˜å‚¨åº“:

## åˆ›å»ºå’Œæ›´æ–°-æ¥æ”¶åŠŸèƒ½

æˆ‘ä»¬å°†åˆ›å»º`post`è·¯çº¿ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°†**æ¥æ”¶**ä¸€ä¸ªåˆé€‚çš„é¡¹ç›®ï¼Œå°†è¯¥é¡¹ç›®æ·»åŠ åˆ°å­˜å‚¨åº“ä¸­ï¼Œå¹¶ä¸”**ç”¨ä¸€äº›**ç»“æœ**æ¥å“åº”**:

æˆ‘ä»¬åœ¨è°ƒç”¨ä¸­ä½¿ç”¨äº†`io.ktor.reqeust.receive<*>`å‡½æ•°â€”â€”å› ä¸ºæˆ‘ä»¬åœ¨å‰é¢çš„æ­¥éª¤ä¸­æ·»åŠ äº†`gson()`, JSON é¡¹å°†è¢«è½¬æ¢ä¸º`Item`æ•°æ®ç±»ã€‚

```
$ curl -i -XPOST -H "Content-type: application/json" 
-d '{
      "id":"3",
      "message":"First message"
    }'
'localhost:8080/items'
```

åº”è¯¥è¿”å›ä»€ä¹ˆ:

```
HTTP/1.1 201 Created
Content-Length: 36
Content-Type: application/json; charset=UTF-8{"id":"3","message":"First message"}
```

## åˆ é™¤â€”è°ƒç”¨å‚æ•°

ä¸ºäº†åˆ›å»º`delete`ç«¯ç‚¹ï¼Œæˆ‘ä»¬å°†åˆ©ç”¨**è°ƒç”¨å‚æ•°**å±æ€§ã€‚

å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬åœ¨è·¯å¾„å®šä¹‰ä¸­å®šä¹‰äº†`{id}`ã€‚Ktor èƒ½å¤Ÿ**è¯†åˆ«å’Œæ£€ç´¢è·¯å¾„å‚æ•°**ï¼Œæ‰€ä»¥æˆ‘ä»¬ä»¥åå¯ä»¥ä½¿ç”¨å®ƒã€‚

## é˜…è¯»â€”è·å–

æœ€åï¼Œè®©æˆ‘ä»¬å®ç°`get`ç«¯ç‚¹ï¼Œå®ƒå°†æ£€ç´¢é¡¹ç›®çš„å®Œæ•´åˆ—è¡¨:

åœ¨æ‰§è¡Œ GET on `/items`ä¹‹åï¼Œæ‚¨åº”è¯¥ä¼šæ”¶åˆ°æ‚¨æ”¾å…¥å­˜å‚¨åº“çš„æ‰€æœ‰é¡¹ç›®:

```
$ curl -i localhost:8080/items
HTTP/1.1 200 OK
Content-Length: 77
Content-Type: application/json; charset=UTF-8[{"id":"3","message":"First message"},{"id":"23","message":"Second message"}]
```

# æ‘˜è¦

*   âœ”Â·ç§‘ç‰¹æ—é¦–å…ˆâ€”â€”ä¸éœ€è¦å¤„ç†å¤æ‚çš„åŸºäº Java çš„ API
*   ï¸âœ”æ˜“äºå…¥æ‰‹â€”åªéœ€ä¸€ä¸ªä¾èµ–é¡¹å³å¯å®ç°
*   âœ”å¯è¯»æ€§â€”æ‰€è§å³æ‰€å¾—ã€‚è·¯ç”± DSL æ˜¯å®šä¹‰ç«¯ç‚¹çš„ä¸€ç§éå¸¸ä¼˜é›…çš„æ–¹å¼
*   âŒæ²¡æœ‰æ˜¥å¤©é‚£ä¹ˆå¤šçš„æ•´åˆ
*   âŒè¿˜æ²¡æœ‰é»„é‡‘æ ‡å‡†

ä»¥å‰æˆ‘é¦–é€‰çš„ API åŸå‹å·¥å…·æ˜¯ express . jsâ€”â€”ç°åœ¨ Ktor å–ä»£äº†å®ƒçš„ä½ç½®ã€‚æˆ‘å‘ç°å®ƒéå¸¸å®¹æ˜“ä½¿ç”¨â€”â€”å‡ ä¹æ¯ä¸€ä¸ªåŠŸèƒ½éƒ½åƒæˆ‘æœŸæœ›çš„é‚£æ ·å·¥ä½œã€‚å¯¹äºæ›´å¤§çš„é¡¹ç›®ï¼Œæˆ‘ä»ç„¶ä¼šä½¿ç”¨ Springâ€”â€”å®ƒæ›´æˆç†Ÿï¼Œæœ‰å¾ˆå¤šé›†æˆã€‚

é‚£äº›åˆ©å¼Šåªæ˜¯æˆ‘çš„æ‹™è§ã€‚ä½ åº”è¯¥äº²è‡ªçœ‹çœ‹ Ktor å¦‚ä½•åœ¨åç«¯å’Œå‰ç«¯ä¸ºä½ æœåŠ¡ã€‚

# é“¾æ¥å’Œèµ„æº

[](https://ktor.io) [## ktor-kot Lin çš„å¼‚æ­¥ Web æ¡†æ¶

### Ktor æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼Œç”¨äºåœ¨è¿æ¥çš„ç³»ç»Ÿä¸­ä½¿ç”¨å¼ºå¤§çš„ Kotlin æ„å»ºå¼‚æ­¥æœåŠ¡å™¨å’Œå®¢æˆ·æœºã€‚

ktor.io](https://ktor.io) [](https://github.com/rozkminiacz/ktor-playground) [## rozkminiacz/ktor-æ¸¸ä¹åœº

### æ­¤æ—¶æ‚¨ä¸èƒ½æ‰§è¡Œè¯¥æ“ä½œã€‚æ‚¨å·²ä½¿ç”¨å¦ä¸€ä¸ªæ ‡ç­¾é¡µæˆ–çª—å£ç™»å½•ã€‚æ‚¨å·²åœ¨å¦ä¸€ä¸ªé€‰é¡¹å¡ä¸­æ³¨é”€ï¼Œæˆ–è€…â€¦

github.com](https://github.com/rozkminiacz/ktor-playground) [](/how-to-create-a-rest-api-client-and-its-integration-tests-in-kotlin-multiplatform-d76c9a1be348) [## å¦‚ä½•åœ¨ Kotlin å¤šå¹³å°ä¸­åˆ›å»º REST API å®¢æˆ·ç«¯åŠå…¶é›†æˆæµ‹è¯•

### è¿™ç¯‡æ–‡ç« æ˜¯æˆ‘åœ¨åšå®¢ xurxodev.com ä¸Šçš„åŸæ–‡çš„è‹±æ–‡ç¿»è¯‘ã€‚

blog.kotlin-academy.com](/how-to-create-a-rest-api-client-and-its-integration-tests-in-kotlin-multiplatform-d76c9a1be348) 

# å•å‡»ğŸ‘è¯´â€œè°¢è°¢ï¼â€å¹¶å¸®åŠ©ä»–äººæ‰¾åˆ°è¿™ç¯‡æ–‡ç« ã€‚

äº†è§£å¡å¸•å¤´æœ€æ–°çš„é‡å¤§æ–°é—»ã€‚å­¦é™¢ï¼Œ[è®¢é˜…æ—¶äº‹é€šè®¯](https://kotlin-academy.us17.list-manage.com/subscribe?u=5d3a48e1893758cb5be5c2919&id=d2ba84960a)ï¼Œ[è§‚å¯Ÿæ¨ç‰¹](https://twitter.com/ktdotacademy)å¹¶åœ¨åª’ä½“ä¸Šå…³æ³¨æˆ‘ä»¬ã€‚

å¦‚æœæ‚¨éœ€è¦ Kotlin å·¥ä½œå®¤ï¼Œè¯·æŸ¥çœ‹æˆ‘ä»¬å¦‚ä½•å¸®åŠ©æ‚¨: [kt.academy](https://www.kt.academy/) ã€‚

[![](img/3146970f03e44cb07afe660b0d43e045.png)](https://kotlin-academy.us17.list-manage.com/subscribe?u=5d3a48e1893758cb5be5c2919&id=d2ba84960a)