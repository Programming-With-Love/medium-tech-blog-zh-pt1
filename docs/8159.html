<html>
<head>
<title>How to create BigQuery table with external data source(orc) ?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用外部数据源(orc)创建BigQuery表？</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/how-to-create-bigquery-table-with-external-data-source-orc-218bb9e92388?source=collection_archive---------0-----------------------#2022-12-01">https://medium.com/walmartglobaltech/how-to-create-bigquery-table-with-external-data-source-orc-218bb9e92388?source=collection_archive---------0-----------------------#2022-12-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/e9005044d3348f615f72f34ea8cb42d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uYe4YVsYCK-AFA3Uk6CXXA.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Image Source : Image taken by <a class="it iu ge" href="https://medium.com/u/dcb4a49113ef?source=post_page-----218bb9e92388--------------------------------" rel="noopener" target="_blank">Avinash Prakash</a></figcaption></figure><p id="6128" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated"><strong class="ix hi">简介:<br/> </strong>大查询外部表利用存储在各种google存储(GCP存储桶、数据存储、Firestore)上的数据来节省与将数据从其他google存储转移到大查询内部存储(巨像)相关的存储和转移成本。</p><p id="f7e3" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated"><strong class="ix hi"> BigQuery支持查询以下格式的云存储数据:</strong> <br/>逗号分隔值(CSV) <br/> JSON(换行符分隔)<br/>Avro<br/>ORC<br/>Parquet<br/>Datastore exports<br/>Firestore exports<br/><strong class="ix hi">big query支持查询这些存储类的云存储数据:</strong> <br/>。标准<br/>。近线<br/>。Coldline <br/>。存档<br/> <strong class="ix hi">外部vs本地表:</strong> <br/> 1。外部表从作为数据源的云存储中扫描数据——这具有总是查询最新数据的优势。然而，虽然可以限制扫描的数据量，但是外部表没有利用缓存，查询可能会更慢。<br/> 2。原生表将数据导入BigQuery，并允许您从那里进行查询。云存储不收取数据传输费用，但会收取每份扫描数据的正常费用。对于原生表，您只能看到创建表时导入的数据，这是一个手动过程。查询可能比外部表更快。<br/> <strong class="ix hi">如何在外部分区的ORC数据上创建表:<br/> </strong>使用BQ控制台创建表:</p><figure class="ju jv jw jx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es jt"><img src="../Images/2dbcc7bb516b039532c7b7cb3963655d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WPXXjJQU275viCbRq0Folw.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Create table google console part 1</figcaption></figure><figure class="ju jv jw jx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es jt"><img src="../Images/1e31da5474fe2c8f39060b358ae137c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VoYdYRZt0QGLqw8xklbfIQ.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Create table google console part 2</figcaption></figure><p id="d051" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated"><strong class="ix hi">一些重点要突出:</strong> <br/> 1。选择“Google Cloud Storage”作为“Create Table from”下的选项。在“从GCS存储桶中选择文件”中，只需提供带有日期=*(根据您的表的第一个分区)和后缀的存储桶名称。在我们的示例中，它将是“GS://ad hoc _ bucket/external _ table _ orc/date = *”。在“文件格式”下，选择为“ORC”<br/>2。选择“源数据分区”复选框。提供“选择源URI前缀”作为“GS://ad hoc _ bucket/external _ table _ orc/”，这是表在bucket中的位置，并选择“分区推断模式”作为“自动推断类型”。<br/> 3。选择“表类型”为“外部表”<br/> 4。选择“自动检测模式”复选框。这将允许自动检测列名和数据类型。如果您不想从数据源推断模式，可以选择手动提供模式。只需取消选择“自动检测”并添加模式细节。<br/> 5。最后，单击create table按钮创建外部表。</p><p id="7292" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">自动分区表的外部表信息:</p><figure class="ju jv jw jx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es jt"><img src="../Images/b1854b8e22203d8f0a2271d88efdbfe0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AOUqLm7cxtaEO-bPQcKgpg.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">External Table Info</figcaption></figure><p id="5bcb" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated"><strong class="ix hi">重点突出:</strong> <br/> 1 .桌子大小:0 B <br/> 2。表没有在BigQuery存储中存储任何数据。<br/> 3。来源URI:GS://ad hoc _ bucket/external _ table _ orc/date = *<br/>4。表格数据位于GCS桶位置上方。<br/> 5。源格式为ORC，配置单元分区模式为auto <br/>使用自定义分区创建表BQ DDL:</p><p id="2794" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">以下查询从GCS存储桶创建表，分区列为work_date，company_code，region_code，其他列从配置单元表元数据中自动推断。</p><p id="9891" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">创建或替换外部表Project_Name。带有分区列的ad hoc _ dateset . external _ orc _ table _ DDL<br/>(<br/>DATE DATE，<br/> company_name STRING，<br/>region STRING<br/>)OPTIONS(uri =[' GS://ad hoc _ bucket/external _ table _ orc/DATE = *]，<br/> format=orc，<br/>hive _ PARTITION _ uri _ prefix = ' GS://ad hoc _ bucket/external _ table _ orc/')；</p><figure class="ju jv jw jx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es jt"><img src="../Images/7ade127a18789d48953ad97d7402f9df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qgsZx4Wm5yARA6VUjW0jvQ.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">External Table DDL Properties</figcaption></figure><p id="e9f0" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">如果你仔细看上面的截图，你会注意到所有的细节都是一样的，除了配置单元分区模式(自定义)。</p><p id="25e5" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">结论:</p><ol class=""><li id="00d1" class="jy jz hh ix b iy iz jc jd jg ka jk kb jo kc js kd ke kf kg bi translated">如果我们想对google buckets中的数据进行快速分析，而不需要将大量数据复制到BQ内部存储，那么可以使用BQ外部表。</li><li id="b06c" class="jy jz hh ix b iy kh jc ki jg kj jk kk jo kl js kd ke kf kg bi translated">BQ外部表可用于快速更改google bucket或任何其他BQ外部表支持数据存储的参考数据。</li><li id="d1fd" class="jy jz hh ix b iy kh jc ki jg kj jk kk jo kl js kd ke kf kg bi translated">如果我们想从存储在google bucket上的原始文件中提取数据，然后将其加载到BQ内部表中，也可以使用它。</li></ol><p id="3626" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated"><em class="km">参考文献:</em></p><div class="kn ko ez fb kp kq"><a href="https://cloud.google.com/bigquery/docs/external-tables" rel="noopener  ugc nofollow" target="_blank"><div class="kr ab dw"><div class="ks ab kt cl cj ku"><h2 class="bd hi fi z dy kv ea eb kw ed ef hg bi translated">外部表| BigQuery | Google云</h2><div class="kx l"><h3 class="bd b fi z dy kv ea eb kw ed ef dx translated">本页概述了如何使用外部表来查询存储在BigQuery之外的数据。大湖表和…</h3></div><div class="ky l"><p class="bd b fp z dy kv ea eb kw ed ef dx translated">cloud.google.com</p></div></div><div class="kz l"><div class="la l lb lc ld kz le in kq"/></div></div></a></div><p id="53cd" class="pw-post-body-paragraph iv iw hh ix b iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">图片来源:所有图片都是在沃尔玛内部沙盒环境实验中拍摄的。</p></div></div>    
</body>
</html>