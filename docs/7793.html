<html>
<head>
<title>Self Service: DB2 database restores automation using Concord</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自助服务:DB2数据库使用Concord自动恢复</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/self-service-db2-database-restores-automated-using-concord-cea1bc0930d6?source=collection_archive---------5-----------------------#2019-06-27">https://medium.com/walmartglobaltech/self-service-db2-database-restores-automated-using-concord-cea1bc0930d6?source=collection_archive---------5-----------------------#2019-06-27</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="5a38" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated"><span class="l iw ix iy bm iz ja jb jc jd di">在</span>沃尔玛实验室，我们学习最新的技术，比如沃尔玛自己的Concord，并尝试将我们的知识应用于自动化频繁耗时的活动，从而在许多方面节省时间和人力。</h2></div><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/1c34bc89031551436b6ef8a76fdb46e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JpmVKuCJ6C0W-7PeEGFLNQ.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">Database Restore — Just a hit away (Image Credit <a class="ae ju" href="https://www.google.com/search?biw=1268&amp;bih=686&amp;tbm=isch&amp;sa=1&amp;ei=GTZaXePQJY3I5gLp_acg&amp;q=restore&amp;oq=restore&amp;gs_l=img.3...766.766..1068...0.0..0.0.0.......0....1..gws-wiz-img.MDxSoHs3guo&amp;ved=0ahUKEwijwYGgnI7kAhUNpFkKHen-CQQQ4dUDCAY&amp;uact=5#imgrc=-LQ4Dj1ew0M_pM:" rel="noopener ugc nofollow" target="_blank">restore image</a>)</figcaption></figure><p id="3f67" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">用例:容量和性能测试(VPT)是一个普遍的问题。对于我们环境中的TRIRIGA应用程序，应用程序团队执行VPT测试来测试不同的模块，其中软件受到大量数据的影响。需要有一个强大的VPT实践，以确保生产系统设置为在峰值水平执行。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="ab fe cl kr"><img src="../Images/f6fb1ae4d12b8aac114454fe83f48544.png" data-original-src="https://miro.medium.com/v2/0*kUXcBmdcAgecWyIh.gif"/></div><figcaption class="jq jr et er es js jt bd b be z dx">Source: <a class="ae ju" href="https://giphy.com/gifs/awesomenesstv-lol-comedy-xUA7aRBOcImI6JNyF2?utm_source=iframe&amp;utm_medium=embed&amp;utm_campaign=Embeds&amp;utm_term=https%3A%2F%2Fcdn.embedly.com%2Fwidgets%2Fmedia.html%3Fsrc%3Dhttps%3A%2F%2Fgiphy.com%2Fembed%2FxUA7aRBOcImI6JNyF2%2Ftwitter%2Fiframe&amp;%3Burl=https%3A%2F%2Fmedia.giphy.com%2Fmedia%2FxUA7aRBOcImI6JNyF2%2Fgiphy.gif&amp;%3Bimage=https%3A%2F%2Fi.giphy.com%2Fmedia%2FxUA7aRBOcImI6JNyF2%2Fgiphy.gif&amp;%3Bkey=a19fcc184b9711e1b4764040d3dc5c07&amp;%3Btype=text%2Fhtml&amp;%3Bschema=giphy" rel="noopener ugc nofollow" target="_blank">giphy</a></figcaption></figure><p id="52fe" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">如果测试不成功或不符合预期怎么办？然后，应用程序团队需要系统恢复到测试前的状态，并在DBA的帮助下从以前备份的映像执行数据库恢复。</p><p id="4f04" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">如果该活动需要一天执行两次，对于DBA来说，意味着一天内完成了所有工作。下一步做什么？我们分析了DBA支持任务的月度报告，每月有20多个恢复请求，每个400–500 GB的恢复需要大约2–2.5小时才能完成，同样，这可能会因您的数据库大小和网络备份服务器的网络吞吐量而异。所以，每个月我们都要花40多个小时在这个活动上。</p><p id="4e8b" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated"><em class="ks">提示:报告是识别支持工作的自动化活动或任务的最佳方式。就我而言，我现在正在使用吉拉和服务。我们可以每周或每月获取报告，并找出频繁且可以自动化的活动。</em></p><p id="01bc" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">解决方案:为了消除重复的数据库恢复，DBA提出了基于表单的<a class="ae ju" href="https://concord.walmartlabs.com/overview/index.html" rel="noopener ugc nofollow" target="_blank"> Concord </a>自动化。此外，它与#Slack和吉拉集成，用于通知和报告目的，甚至可以用于但不限于部署、安装和访问请求。</p><p id="166e" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">此外，您可以将使用限制到特定的用户组或LDAP组，这些用户或LDAP组只能运行流，并且可以通过设置服务器限制为特定的服务器运行流。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kt"><img src="../Images/bfa0902d03463829706a6a4782b2f2cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sc7c8HCQI3lSX7ik11kQsg.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">Workflow</figcaption></figure><p id="09a3" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">开始您的第一个项目:<strong class="jx hi"/>DB2数据库恢复的手动工作包括备份配置文件、强制应用程序连接、停用数据库以及从磁带或磁盘恢复它。这些步骤需要由DBA执行，所以我们的想法是使用Github repository创建concord项目，将这些手动步骤自动化为自助形式，这样任何人都可以运行<a class="ae ju" href="/api/v1/org/{orgName}/project/{projectName}/repo/{repoName}/start/{entryPoint}" rel="noopener ugc nofollow" target="_blank"> URL </a>(显然我们需要对最终用户和服务器进行一些限制)并一次性执行恢复。</p><p id="8539" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated"><em class="ks">经验:在你开始第一个项目之前，建议为你手动执行的每一步创建操作手册，以节省时间，提高编码效率和可重用性。</em></p><p id="8ca1" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">以下是创建基于表单的流程的步骤:</p><ol class=""><li id="542d" class="ku kv hh jx b jy jz kb kc ke kw ki kx km ky kq kz la lb lc bi translated">为你的项目创建一个Git库:你需要在repo中创建concord.yml的第一个文件，它将包含Slack、吉拉等插件的依赖和配置代码。</li></ol><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ld le l"/></div><figcaption class="jq jr et er es js jt bd b be z dx">Concord File</figcaption></figure><p id="bf48" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">2.下一个文件将是流，例如流目录下的restore.yml，我们需要在这里定义表单和流(EntryPoint: db_restore ),它们将通过URL调用。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ld le l"/></div><figcaption class="jq jr et er es js jt bd b be z dx">Form definition and entry point</figcaption></figure><p id="7665" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">3.现在，我们需要写剧本和角色，我们需要调用它。而且，行动手册将使用这些角色来执行所需的任务，以执行数据库刷新活动。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ld le l"/></div><figcaption class="jq jr et er es js jt bd b be z dx">Ansible Playbook</figcaption></figure><p id="f007" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">角色就像我们编程中的函数，可以在剧本中调用来执行某些任务。角色的概念很简单；它是一组存储在标准文件结构中的变量、任务、文件和处理程序。<strong class="jx hi"> restore_database </strong>角色的示例代码。</p><figure class="jf jg jh ji fd jj"><div class="bz dy l di"><div class="ld le l"/></div><figcaption class="jq jr et er es js jt bd b be z dx">Ansible Role Explamle</figcaption></figure><p id="0d84" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">Git repo目录结构如下所示:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es lf"><img src="../Images/3582f31ddfc700f3d2819b2a7c020557.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ukBneK9Nv6MZa3HYAte1Tw.jpeg"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">Git Repo Structure</figcaption></figure><p id="3e6f" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">4.在concord服务器上创建Key，并在concord和我们在上述步骤中创建的Github repo之间建立SSH连接。导航到<em class="ks">组织</em> → <em class="ks">默认</em>组织→ <em class="ks">机密</em>；并在concord中创建了新的secret，用户界面显示了生成的公钥(以ssh-rsa开头),需要添加到git存储库的<em class="ks">设置——部署密钥</em>部分。</p><p id="c791" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">5.<a class="ae ju" href="https://concord.walmartlabs.com/docs/getting-started/projects.html" rel="noopener ugc nofollow" target="_blank">创建项目</a>:导航至组织→默认组织→项目。提供项目的名称，在Repositories选项卡下，添加一个存储库，并为您的存储库命名。在custom authentication按钮下，添加在上述步骤中创建的密码。</p><ul class=""><li id="a6aa" class="ku kv hh jx b jy jz kb kc ke kw ki kx km ky kq lg la lb lc bi translated">在<em class="ks"> URL </em>字段中存储库的SSH URL，例如<code class="du lh li lj lk b">git@github.com:me/myrepo.git</code>；</li></ul><p id="aacf" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">6.最终用户流:用户可以在浏览器中点击URL，concord将启动后台进程，该进程将启动一个表单，其中包含用户需要输入的必填字段，以便开始活动。这里是URL格式:API/v1/org/{ orgName }/project/{ project name }/repo/{ repo name }/start/{ entry point }。例如/API/v1/org/ <strong class="jx hi">默认</strong>/project/<strong class="jx hi">UDB</strong>/回购/ <strong class="jx hi">协和_回购</strong> /start/ <strong class="jx hi"> db_restore </strong></p><p id="a1ca" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">{orgName} —默认或另一个组织名称(如果已创建)。</p><p id="5d00" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">{项目名称} —在步骤5中创建的项目名称。</p><p id="6c02" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">{repoName} —我们在concord中给出的Repo名称，不要记住我们在Github中创建的名称。</p><p id="260e" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">{entryPoint} —我们在表单中创建的流。例如，我们的案例是db_restore(参考步骤2)。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ll"><img src="../Images/82cdf641e845b8d116d4e57852401014.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DUTxl80dNXIo0o_U7JFuHw.png"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">Concord Form: End-user will select a server from the drop-down and put required details.</figcaption></figure></div><div class="ab cl lm ln go lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ha hb hc hd he"><p id="6c0a" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated"><strong class="jx hi">结论</strong>:试试沃尔玛的concord，为各种用例构建惊人的自动化和部署。我们已经在各种用例中使用它，如数据库恢复、二进制文件安装、访问请求、数据库活动，以提高性能，但它不仅限于这些活动。Concord是一个编排工具，可用于部署和持续部署平台支持工具，如Ansible、托管容器、Looper、Slack、吉拉等。</p><p id="363b" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated"><strong class="jx hi">参考文献:</strong></p><div class="lt lu ez fb lv lw"><a href="https://github.com/walmartlabs/" rel="noopener  ugc nofollow" target="_blank"><div class="lx ab dw"><div class="ly ab lz cl cj ma"><h2 class="bd hi fi z dy mb ea eb mc ed ef hg bi translated">沃尔玛实验室</h2><div class="md l"><h3 class="bd b fi z dy mb ea eb mc ed ef dx translated">沃尔玛实验室有30个可用的仓库。在GitHub上关注他们的代码。</h3></div><div class="me l"><p class="bd b fp z dy mb ea eb mc ed ef dx translated">github.com</p></div></div><div class="mf l"><div class="mg l mh mi mj mf mk jo lw"/></div></div></a></div><div class="lt lu ez fb lv lw"><a href="https://concord.walmartlabs.com/" rel="noopener  ugc nofollow" target="_blank"><div class="lx ab dw"><div class="ly ab lz cl cj ma"><h2 class="bd hi fi z dy mb ea eb mc ed ef hg bi translated">协和|协和</h2><div class="md l"><h3 class="bd b fi z dy mb ea eb mc ed ef dx translated">Concord是一个工作流服务器。</h3></div><div class="me l"><p class="bd b fp z dy mb ea eb mc ed ef dx translated">concord.walmartlabs.com</p></div></div></div></a></div><div class="lt lu ez fb lv lw"><a href="https://docs.ansible.com/ansible/latest/user_guide/intro_getting_started.html" rel="noopener  ugc nofollow" target="_blank"><div class="lx ab dw"><div class="ly ab lz cl cj ma"><h2 class="bd hi fi z dy mb ea eb mc ed ef hg bi translated">入门— Ansible文档</h2><div class="md l"><h3 class="bd b fi z dy mb ea eb mc ed ef dx translated">作为一个高级主题，Ansible不仅仅需要通过SSH远程连接。传输是可插拔的，而且…</h3></div><div class="me l"><p class="bd b fp z dy mb ea eb mc ed ef dx translated">docs.ansible.com</p></div></div><div class="mf l"><div class="ml l mh mi mj mf mk jo lw"/></div></div></a></div><div class="lt lu ez fb lv lw"><a href="https://guides.github.com/activities/hello-world/" rel="noopener  ugc nofollow" target="_blank"><div class="lx ab dw"><div class="ly ab lz cl cj ma"><h2 class="bd hi fi z dy mb ea eb mc ed ef hg bi translated">你好世界</h2><div class="md l"><h3 class="bd b fi z dy mb ea eb mc ed ef dx translated">Hello World项目是计算机编程中历史悠久的传统。这是一个简单的练习，让你…</h3></div><div class="me l"><p class="bd b fp z dy mb ea eb mc ed ef dx translated">guides.github.com</p></div></div><div class="mf l"><div class="mm l mh mi mj mf mk jo lw"/></div></div></a></div></div></div>    
</body>
</html>