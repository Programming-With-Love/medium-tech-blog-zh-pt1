<html>
<head>
<title>Sizing Cluster Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">确定集群Kubernetes的规模</h1>
<blockquote>原文：<a href="https://medium.easyread.co/sizing-cluster-kubernetes-b667d84a2598?source=collection_archive---------0-----------------------#2021-07-04">https://medium.easyread.co/sizing-cluster-kubernetes-b667d84a2598?source=collection_archive---------0-----------------------#2021-07-04</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/484c78dd9ec173f1f7517d147fb46c52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AjgZxaOsN4C9wpJw"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@ventiviews?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Cameron Venti</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="383e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">创建<em class="ky"> Kubernetes </em>集群，有几件事情需要考虑，比如确定集群环境(<em class="ky">内部</em>或者<em class="ky">云</em>)、每个节点的硬件规格，如果需要的话还要计算存储。</p><p id="b572" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">集群规模调整的目的是每月成本规划和性能。</p><p id="34da" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然而，实际上，集群是根据集群中的服务数量或每个服务的资源规模而增长的。</p><p id="92dd" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在这篇文章中，我将解释如何根据我们的需要计算集群的大小。我将尝试使用下面的研究案例来确定规模。</p><h1 id="f8f7" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">研究案例</h1><p id="7669" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">一家公司计划迁移到运行在云中的Kubernetes，该公司有一个微服务架构，总共有100个服务。所有这些服务都使用了<em class="ky">掌舵图</em>。</p><figure class="mc md me mf gt jo"><div class="bz fp l di"><div class="mg mh l"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Type.Csv</figcaption></figure><p id="1bee" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">从这100个服务中，我根据平均所需资源分成4种类型，然后确定最小最大复制。在本例中，我为所有服务类型设置了最小复制为2，最大复制为4。我去拿下面的桌子</p><figure class="mc md me mf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mi"><img src="../Images/92a138620a57c07e6ac1906dc0eedaf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w70F8qJvfhiWJ0bBFB5DKg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Workload Calculation</figcaption></figure><ul class=""><li id="9281" class="mj mk in kc b kd ke kh ki kl ml kp mm kt mn kx mo mp mq mr bi translated">初始资源是每种服务类型的CPU和内存的极限</li><li id="c60f" class="mj mk in kc b kd ms kh mt kl mu kp mv kt mw kx mo mp mq mr bi translated">最小/最大是所有<em class="ky">箱</em>的复制</li><li id="0f34" class="mj mk in kc b kd ms kh mt kl mu kp mv kt mw kx mo mp mq mr bi translated">总(最大)CPU/内存是以下因素的结果</li></ul><blockquote class="mx my mz"><p id="42d9" class="ka kb ky kc b kd ke kf kg kh ki kj kk na km kn ko nb kq kr ks nc ku kv kw kx ig bi translated">(最大复制*初始资源请求)*总服务</p></blockquote><p id="458d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我总共有70个内核和235 GB的内存来运行所有的<em class="ky">pod</em>。</p><p id="2605" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来，使用<em class="ky"> Google云平台</em>提供的参考类型机器计算集群规模，您<em class="ky"> </em>可以在这里看到<a class="ae jz" href="https://cloud.google.com/compute/docs/general-purpose-machines" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="4163" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">结果</h1><figure class="mc md me mf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nd"><img src="../Images/67246e53e6a730f0c5136d0ed20a16f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NlBxr05IGv_7GF_UAY8gtA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Node Calculation</figcaption></figure><p id="45ef" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在该表中，有3个节点。要计算CPU核心和内存的总数:</p><ul class=""><li id="483f" class="mj mk in kc b kd ke kh ki kl ml kp mm kt mn kx mo mp mq mr bi translated">32 * 3 = 96个CPU内核</li><li id="e24b" class="mj mk in kc b kd ms kh mt kl mu kp mv kt mw kx mo mp mq mr bi translated">120 * 3 = 360 GB内存</li></ul><p id="fc52" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">资源的最大使用率为75%，以防止性能下降。为了计算最大使用量，我定义了下面的公式:</p><blockquote class="mx my mz"><p id="fc72" class="ka kb ky kc b kd ke kf kg kh ki kj kk na km kn ko nb kq kr ks nc ku kv kw kx ig bi translated">汇总((请求资源/(规格*总节点))* 100)</p></blockquote><p id="7910" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">因此，我选择型号为<em class="ky"> n1-standard-32 </em>的机器，因为它在资源使用和运营成本方面更高效。</p></div><div class="ab cl ne nf hr ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ig ih ii ij ik"><h1 id="7581" class="kz la in bd lb lc nl le lf lg nm li lj lk nn lm ln lo no lq lr ls np lu lv lw bi translated">结论</h1><p id="8238" class="pw-post-body-paragraph ka kb in kc b kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt mb kv kw kx ig bi translated">可以用几种方法计算资源。那些只是基于经验的简单公式，而不是精确公式。</p><p id="745a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">谢谢，祝你愉快。</p><h1 id="0c17" class="kz la in bd lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw bi translated">参考</h1><ul class=""><li id="5729" class="mj mk in kc b kd lx kh ly kl nq kp nr kt ns kx mo mp mq mr bi translated"><a class="ae jz" href="https://kubernetes.io/id/docs/concepts/workloads/controllers/deployment/" rel="noopener ugc nofollow" target="_blank">https://kubernetes . io/id/docs/concepts/workloads/controllers/deployment/</a></li><li id="3ffb" class="mj mk in kc b kd ms kh mt kl mu kp mv kt mw kx mo mp mq mr bi translated"><a class="ae jz" href="https://cloud.google.com/compute/docs/general-purpose-machines" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/compute/docs/general-purpose-machines</a></li></ul></div></div>    
</body>
</html>