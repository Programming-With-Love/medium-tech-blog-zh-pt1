<html>
<head>
<title>Flutter Web problem deliberation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">颤振腹板问题的研究</h1>
<blockquote>原文：<a href="https://medium.com/globant/flutter-web-problem-deliberation-2f7cb05565f9?source=collection_archive---------0-----------------------#2020-07-03">https://medium.com/globant/flutter-web-problem-deliberation-2f7cb05565f9?source=collection_archive---------0-----------------------#2020-07-03</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="de12" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我喜欢作为移动应用程序开发者的flutter，因为android很好，但Flutter帮助我在任何时候都可以创建漂亮的应用程序。它帮助我轻松获得多平台支持，如iOS、桌面和Web。大约2-3个月前，在观看了许多动画和社区的支持后，我开始使用Flutter Web。我也喜欢Flutter web，尽管Flutter Web仍处于早期阶段，这篇文章不是关于唱衰这项技术，而是关于我所面临的问题和我所使用的解决方案。如果你也面临这样的问题，请在评论中发表。</p><p id="11b8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对我来说，flutter web更像是移动领域的一种反应。是的，在发布时，dart UI代码或多或少地被转换成javascript，但它不是纯HTML CSS，所以UI的每个部分都被javascript DOM操纵所操纵。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/953b82114f072e465c043f548a464c8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*f9uPpMV1MDUSisbS.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx"><a class="ae js" href="https://flutter.dev/web" rel="noopener ugc nofollow" target="_blank">Flutter Web Architecture</a></figcaption></figure></div><div class="ab cl jt ju go jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="ha hb hc hd he"><p id="1821" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从设计问题这个主要问题开始。与bootstrap不同，flutter没有预列和行特性，但您需要使用<strong class="ig hi"> MediaQuery </strong>来划分列，这在您扩展应用程序时并不方便。没有并排渲染的视图很难改变UI，你可能会说flutter有热重载，但相信我，flutter web不支持热重载，你可能会发现自己会多次停止并启动flutter web应用程序。此外，在开发时，web浏览器的后退和前进按钮不能正常工作，因此我们不能正确地调试内容。现在进入正题</p><p id="8def" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">几个问题:<br/> 1。偏好部件与使用网络cookies。—得到解决方案<br/> 2。Dart对JS和JS对Dart怎么沟通？—得到了解决方案<br/> 3。由于与渲染层相关的问题，堆栈小部件无法正常工作。—还是要想办法解决。<br/> 4。web的颤振SVG替代品。—得到解决方案<br/> 5。将GridView的表格替换为多屏幕大小支持。<br/> 6。网络文件选择器<br/> 7。Web URL #暂时不会被删除。<br/> 8。在macOS或移动端运行Flutter web app。<br/> 9。等待非未来函数返回—得到解决方案。</p><h1 id="1dfa" class="ka kb hh bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">1.偏好控件与使用网络cookie<strong class="ak">？</strong></h1><p id="622c" class="pw-post-body-paragraph ie if hh ig b ih ky ij ik il kz in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">偏好库在这里也可以在网络上工作，但是它不在cookies中存储数据，因为它表明它有点像存储少量数据的本地存储。但是对于认证令牌和其他一些东西，我们将需要网络cookies。这就是JS出现的原因。我们也许能找到cookies库，但我们最好不要，原因是过程。我们将无法理解如何与Dart to JS和JS to Dart进行通信。</p><p id="383b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是使用JS存储cookies的小代码</p><pre class="jd je jf jg fd ld le lf lg aw lh bi"><span id="6ff7" class="li kb hh le b fi lj lk l ll lm">function setCookies(cookieKeyName, value, utcExpireTime, isSecureOnly){<br/>    var expires = "";<br/>    if (utcExpireTime!=null) {<br/>        expires = "; expires=" + utcExpireTime;<br/>    }<br/>    var extraDetails = "";<br/>    if(isSecureOnly){<br/>        extraDetails = "Secure; HttpOnly; "<br/>    }<br/>    document.cookie = cookieKeyName + "=" + (value || "")  + expires + "; path=/; "+ extraDetails;<br/>}</span><span id="2e82" class="li kb hh le b fi ln lk l ll lm">function getCookies(cookieKeyName){<br/>    var nameEQ = cookieKeyName + "=";<br/>    var ca = document.cookie.split(';');<br/>    for(var i=0;i &lt; ca.length;i++) {<br/>        var c = ca[i];<br/>        while (c.charAt(0)==' ') c = c.substring(1,c.length);<br/>        if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);<br/>    }<br/>    return null;<br/>}</span><span id="c008" class="li kb hh le b fi ln lk l ll lm">function removeCookies(cookieKeyName){<br/>    document.cookie = cookieKeyName+'=; Max-Age=-99999999;';<br/>}</span></pre><p id="44f5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果我们有了这段代码，我们就可以从javascript调用JS函数来获取或保存flutter web的cookies。原因是，你可能有一个首选项或本地存储类，它包装了库类，如果你不想承担更改库和类的巨大负担，你只需要更改用于web的数据适配器，它的cookies或本地存储。但是你不能把所有东西都存储在cookies中，这就是为什么我提到JS函数来存储我们当时想要的东西。</p><h1 id="7d00" class="ka kb hh bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">2.Dart对JS和JS对Dart怎么沟通？</h1><p id="7575" class="pw-post-body-paragraph ie if hh ig b ih ky ij ik il kz in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">步骤:<br/> 1。在项目/web中创建一个Javascript文件，并在index.html中添加这个Javascript文件。<br/> 2。创建dart Util文件导入dart: js包。<br/> 3。从js包调用方法。<br/> 4。使用interop向javascript传递回调。</p><blockquote class="lo lp lq"><p id="76ff" class="ie if lr ig b ih ii ij ik il im in io ls iq ir is lt iu iv iw lu iy iz ja jb ha bi translated">注意:dart不能直接将函数传递给javascript，因为它是一个不同的领域，但是我们可以传递javascript interop，它有点像dart函数的包装器，这样javascript可以调用这个interop，最终它会调用Dart函数。<br/>我们可以直接使用文档中提到的<a class="ae js" href="https://dart.dev/web/js-interop" rel="noopener ugc nofollow" target="_blank"> js-interop </a>库，但对我们来说也很容易，这样我们可以理解新术语和幕后流程。</p></blockquote><p id="6668" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">互操作就像是为网络隔离功能。</p><p id="907e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你不知道什么是分离菌，为什么会有分离菌，请阅读这篇文章:</p><div class="lv lw ez fb lx ly"><a href="https://link.medium.com/HA5UXLs3L7" rel="noopener follow" target="_blank"><div class="lz ab dw"><div class="ma ab mb cl cj mc"><h2 class="bd hi fi z dy md ea eb me ed ef hg bi translated">单线镖，什么？</h2><div class="mf l"><h3 class="bd b fi z dy md ea eb me ed ef dx translated">我知道你们中的一些人可能会对我说有Async Await和RxDart，所以不要担心兄弟。我当时……</h3></div><div class="mg l"><p class="bd b fp z dy md ea eb me ed ef dx translated">link.medium.com</p></div></div><div class="mh l"><div class="mi l mj mk ml mh mm jm ly"/></div></div></a></div><p id="f2e2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">加入可理解的要点来理解。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="mn mo l"/></div></figure><h1 id="c009" class="ka kb hh bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">3.由于与渲染层相关的问题，堆栈小部件无法正常工作。</h1><p id="d368" class="pw-post-body-paragraph ie if hh ig b ih ky ij ik il kz in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">我仍然没有找到这个问题的解决方案，但它值得一提，因为这个问题已经在flutter库中报告了。但是我们可能要花很多时间来调试这个问题。它更多地与小部件重画和焦点问题有关。我正在使用iframe，我已经在后面添加了pdf，并希望在前面添加单独的下载按钮(不希望pdf嵌入视图的默认工具栏在iframe上弹出)，所以我试图在堆栈布局中添加按钮，但不幸的是，即使按钮在iframe的顶部，单击也不起作用，我仍在试图找到解决方案。在我找到一些之后，我将发布决议。<a class="ae js" href="https://github.com/DavBfr/dart_pdf/issues/361" rel="noopener ugc nofollow" target="_blank">这是lib报告的一个问题，我已经试过了</a>，但至今没有成功。</p><h1 id="5ce0" class="ka kb hh bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">4.web的颤振SVG替代</h1><p id="9536" class="pw-post-body-paragraph ie if hh ig b ih ky ij ik il kz in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">因为flutter_svg库目前不支持web，所以我们需要这个平台小部件。而我们只要提一下kIsWeb condition，检查一下这是不是Web平台app，就很容易做到。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="mn mo l"/></div></figure><p id="3fb7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这里，我们只是检查它是否是web，然后通过网络加载图像，因为它将被转换为带有SVG路径的HTML图像标签，并且HTML默认情况下通过浏览器支持SVG。我们也可以检查一下<a class="ae js" href="https://pub.dev/packages/websafe_svg" rel="noopener ugc nofollow" target="_blank"> flutter safe web库。</a></p><h1 id="a432" class="ka kb hh bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">5.将GridView的表格替换为多屏幕大小支持。</h1><p id="f3b9" class="pw-post-body-paragraph ie if hh ig b ih ky ij ik il kz in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">GridView无疑是好的，但是当我们有web时，它是麻烦的，你可能会问为什么，因为我们需要给出一个比例，这是用宽度和高度值进行的计算。在某些情况下，我发现它很有用，但在这里，对于web，我需要更多的控制，而不仅仅是一个方面，我需要的是为一行包装内容的功能。<br/>如果我们使用Table Widget，只需计算表格中的列，就可以很容易地在手机屏幕和网络屏幕之间切换，我们可以像这样添加孩子。相信我，当我们需要更多的宽度和高度时，最好使用桌子，而不是专注于儿童用品，因为有时你会发现自己在溢出的红线中。</p><h1 id="8ff5" class="ka kb hh bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">6.文件选择器</h1><p id="3d1a" class="pw-post-body-paragraph ie if hh ig b ih ky ij ik il kz in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">文件拾取在手机和网络上的工作方式不同。</p><p id="dc59" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">发布<br/> 1。对于web，我们将会有相对路径，或者类似于内存中的文件。由于这个原因，我们将没有一个路径，也不能立即使用多部分请求。<br/> 2。dart:io包暂时不支持Flutter Web，我们挑选的文件会给我们dart:html包文件类。<br/> 3。所以问题是我们使用这个文件类有什么区别？不，我们不能使用它，因为多部分文件使用路径，而且因为没有路径方法，你不能使用它。另一个原因是多部分路径不适用于HTML包，它只是用于IO包。这就是我们在上传时要处理的动态对象类型解决方案。</p><p id="14cd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们已经理解了一半，所以我们需要的是<br/> 1。导入dart:html包<br/> 2。获取文件<br/> 3。有一个简便的方法，如果我们有文件字节，我们可以使用HTTP包通过多部分请求上传文件。MultipartFile.fromBytes</p><p id="59cc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在gist示例中，我们有一个PlatformDependentFilePicker类，它将检查web或系统，如果是web，那么它将创建一个输入元素，这对于从系统中选择一个文件很重要，我们将单击它。这将为我们带来选择文件的向导，选择完成后，我们将收到一个带有文件对象的事件，该对象将是dart:html包对象。我已经创建了自定义FlutterWebFile类来存储html文件对象以及我们读取的字节。一旦我们都有了，我们将简单地把这些东西添加到HTTP包中，并创建上传请求。我还将尝试将此代码放入改型发电机中，并为此创建一个拉取请求。但是现在正在讨论为dart:io package for the web添加支持或模拟支持，我正在等待。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="mn mo l"/></div></figure><h1 id="1139" class="ka kb hh bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">7.Web URL #暂时不会被删除。</h1><p id="bab7" class="pw-post-body-paragraph ie if hh ig b ih ky ij ik il kz in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">这里有一个已知的问题<a class="ae js" href="https://github.com/flutter/flutter/issues/33245#issuecomment-502800039" rel="noopener ugc nofollow" target="_blank"/>，这是由于main.dart.js造成的，即使你从其中删除#它仍然不能工作，因为flutter在那之后读取#/ content。但是，我们仍然需要给URL一些杠杆，所以请仔细阅读下一个内容。</p><p id="baf1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">web应用程序的一个常见特性是能够根据URL改变屏幕。比如去<code class="du mp mq mr le b">https://app/login</code>应该会给你和<code class="du mp mq mr le b">https://app/anotherpage</code>不一样的东西。事实上，Flutter支持<strong class="ig hi">命名的路由</strong>，这有两个目的:</p><ol class=""><li id="3722" class="ms mt hh ig b ih ii il im ip mu it mv ix mw jb mx my mz na bi translated">遍历到一个特定的页面，而不考虑像网飞的电影页面流，而不是进入列表，然后搜索电影。</li><li id="2149" class="ms mt hh ig b ih nb il nc ip nd it ne ix nf jb mx my mz na bi translated">在任何应用程序中，它们都允许您为应用程序预定义路线，并给它们命名，然后只需指定它们的名称就可以导航到它们。</li></ol><p id="934f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有很多关于flutter web的例子，所以我不会为它创建要点，但我们需要使用路径匹配，而不是我们在移动设备中使用的传统风格来打开下一个屏幕，因为在web中，用户可以直接来自特定的链接，如果我们这样做，我们可能无法提供支持。因此，对于每个屏幕，您需要使用web API获取数据。</p><p id="617e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae js" href="https://github.com/flutter/gallery/blob/master/lib/routes.dart" rel="noopener ugc nofollow" target="_blank">下面是了解这种方法的链接。</a>如果我们这样做了，那么我们就不需要回头支持网络链接和移动应用程序。很少东西，我们准备好了。</p><h1 id="84b7" class="ka kb hh bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">8.在macOS或移动端运行Flutter web app。</h1><p id="ddb9" class="pw-post-body-paragraph ie if hh ig b ih ky ij ik il kz in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">我将为此写第二篇文章，因为理解这个过程需要很长时间。而且文章已经太长，无法添加更多的代码。所以请继续关注下一篇文章。</p><h1 id="64c8" class="ka kb hh bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated"><strong class="ak"> 9。等待非未来函数返回—得到解决方案。</strong></h1><p id="b791" class="pw-post-body-paragraph ie if hh ig b ih ky ij ik il kz in io ip la ir is it lb iv iw ix lc iz ja jb ha bi translated">一个非常快速的解决方案，可能会在将来困扰你。如果你有一个非未来函数，还想等结果呢？</p><pre class="jd je jf jg fd ld le lf lg aw lh bi"><span id="915d" class="li kb hh le b fi lj lk l ll lm">void clickButton(Function callback){<br/>  //... do something<br/>  int value = 0;<br/>  //post some value after the data fetching or computing<br/>  callback(value);<br/>}</span></pre><p id="a613" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果是这种情况。我们想等待结果，然后我们可以使用完成函数。像这样</p><pre class="jd je jf jg fd ld le lf lg aw lh bi"><span id="bd78" class="li kb hh le b fi lj lk l ll lm">import 'dart:async';</span><span id="b532" class="li kb hh le b fi ln lk l ll lm">void main() async{<br/>  Completer completer = new Completer();<br/>  clickButton((value){<br/>    print("return value from callback $value");<br/>    completer.complete(value);<br/>  });<br/>  await completer.future;<br/>  print("after completing future");<br/>}</span><span id="baec" class="li kb hh le b fi ln lk l ll lm">void clickButton(Function callback){<br/>  //... do something<br/>  int value = 0;<br/>  //post some value after the data fetching or computing<br/>  callback(value);<br/>}</span></pre><p id="38af" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里我们调用click button函数，并希望在回调中等待结果。Completer函数给了我们未来，这个未来将在我们调用completer.complete函数时完成。这样我们可以等待回调函数的结果。<br/>控制台输出:</p><pre class="jd je jf jg fd ld le lf lg aw lh bi"><span id="abd3" class="li kb hh le b fi lj lk l ll lm">return value from callback 0 <br/>after completing future</span></pre></div><div class="ab cl jt ju go jv" role="separator"><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy jz"/><span class="jw bw bk jx jy"/></div><div class="ha hb hc hd he"><p id="51eb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">没有十全十美的技术，但是flutter web是有前途的。我确实喜欢解决这些问题，尽管这可能要花去我几天的时间。还会有很多这样的问题，所以请随意在评论中提出问题和你的解决方案。另外，不要忘了评论你在这篇文章中的收获，我很想听到你的意见。</p><p id="da81" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">希望你喜欢。</p><p id="8c0e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你知道你可以按拍手吗👏按钮50次？你走得越高，就越能激励我写更多的东西！</p><p id="f6ad" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你好，我是帕斯·戴夫。noob开发者和noob摄影师。你可以在<a class="ae js" href="https://in.linkedin.com/in/parth-dave-907b8177" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>上找到我，或者在<a class="ae js" href="https://github.com/parthdave93" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上跟踪我，或者在<a class="ae js" href="https://twitter.com/the_parth_dave" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上关注我？</p><p id="0c47" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">祝你有一个愉快的飞行日！</p></div></div>    
</body>
</html>