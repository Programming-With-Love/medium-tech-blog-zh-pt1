<html>
<head>
<title>Android Data Binding: Express Yourself</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android数据绑定:表达自己</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/android-data-binding-express-yourself-c931d1f90dfe?source=collection_archive---------1-----------------------#2016-07-14">https://medium.com/androiddevelopers/android-data-binding-express-yourself-c931d1f90dfe?source=collection_archive---------1-----------------------#2016-07-14</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="8515" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">不仅仅是现场访问</h2></div><p id="4aae" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">正如在<a class="ae js" rel="noopener" href="/google-developers/android-data-binding-adding-some-variability-1fe001b3abcc#.o3qd00bpq">上一篇文章</a>中所讨论的，你可以在Android Studio的布局文件中分配变量值。在该示例中，用户名字的文本是用表达式设置的:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="a851" class="kc kd hh jy b fi ke kf l kg kh"><strong class="jy hi">android:text="@{user.firstName}"</strong></span></pre><p id="abf4" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">用户类被声明为一个简单的普通旧Java对象(POJO):</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="6617" class="kc kd hh jy b fi ke kf l kg kh"><strong class="jy hi">public class </strong>User {<br/>    <strong class="jy hi">public </strong>String <strong class="jy hi">firstName</strong>;<br/>    <strong class="jy hi">public </strong>String <strong class="jy hi">lastName</strong>;<br/>    <strong class="jy hi">public </strong>Bitmap <strong class="jy hi">image</strong>;<br/>}</span></pre><p id="69ea" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">你的大部分类不使用公共字段(我希望如此)，并且你会为它们提供访问器。布局中的表达式应该简短易读，我们不希望开发人员必须在表达式中添加所有这些getFirstName()和getLastName()，这会降低表达式的可读性。表达式解析器自动尝试为您的属性查找Java Bean访问器名称(getXxx()或isXxx())。当您的类有访问器方法时，同样的表达式也能很好地工作:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="1270" class="kc kd hh jy b fi ke kf l kg kh"><strong class="jy hi">public class </strong>User {<br/>    <strong class="jy hi">private </strong>String <strong class="jy hi">firstName</strong>;<br/>    <strong class="jy hi">private </strong>String <strong class="jy hi">lastName</strong>;<br/>    <strong class="jy hi">private </strong>Bitmap <strong class="jy hi">image</strong>;<br/><br/>    <strong class="jy hi">public </strong>String getFirstName() { <strong class="jy hi">return firstName</strong>; }<br/>    <strong class="jy hi">public </strong>String getLastName() { <strong class="jy hi">return lastName</strong>; }<br/>    <strong class="jy hi">public </strong>Bitmap getImage() { <strong class="jy hi">return image</strong>; }<br/>}</span></pre><p id="6f0d" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果它找不到像getXxx()这样名为的方法，它也会寻找名为Xxx()的方法，所以你可以用user.hasFriend来访问方法hasFriend()。</p><p id="c3ed" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Android数据绑定表达式语法也支持使用括号的数组访问，就像Java一样:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="7e8d" class="kc kd hh jy b fi ke kf l kg kh">android:text="@{user.friends[0].firstName}"</span></pre><p id="970f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">您还可以使用列表和地图的括号作为“get”方法的快捷方式。</p><p id="f7c3" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">它还允许几乎所有的java语言表达式，包括方法调用、三元运算符和数学运算。但是不要发疯:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="acdf" class="kc kd hh jy b fi ke kf l kg kh">android:text='@{user.adult ? ((user.male ? "Mr. " : "Ms. ") + user.lastName) : (user.firstName instanceof String ? user.firstName : "kid") }'</span></pre><p id="06c5" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">没人看得懂。除了硬编码的字符串之外，维护起来将会非常困难。帮你自己一个忙，把你的复杂表达式放回你的模型中，这样你就不必试图解开正在发生的事情。</p><p id="346e" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">此外，还有一个零合并运算符？？要缩短简单的三元表达式:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="2d01" class="kc kd hh jy b fi ke kf l kg kh">android:text=”@{user.firstName ?? user.userName}”</span></pre><p id="fc62" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">本质上与以下内容相同:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="31d5" class="kc kd hh jy b fi ke kf l kg kh">android:text=”@{user.firstName != null ? user.firstName : user.userName}”</span></pre><p id="ed61" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">使用绑定表达式可以做的一件很酷的事情是使用资源:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="07f3" class="kc kd hh jy b fi ke kf l kg kh">android:padding=”@{@dim/textPadding + @dim/headerPadding}</span></pre><p id="7bb9" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这样可以省去一堆单独的值声明。有多少次你只是想增加或减少尺寸？唯一的问题是它(还)不支持样式。</p><p id="ba0a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">您还可以按照资源方法<a class="ae js" href="https://developer.android.com/reference/android/content/res/Resources.html#getString(int, java.lang.Object...)" rel="noopener ugc nofollow" target="_blank"> getString </a>、<a class="ae js" href="https://developer.android.com/reference/android/content/res/Resources.html#getQuantityString(int, int, java.lang.Object...)" rel="noopener ugc nofollow" target="_blank"> getQuantityString </a>和<a class="ae js" href="https://developer.android.com/reference/android/content/res/Resources.html#getFraction(int, int, int)" rel="noopener ugc nofollow" target="_blank"> getFraction </a>中的语法使用字符串、数量和分数格式。您只需将参数作为参数传递给资源:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="8a4d" class="kc kd hh jy b fi ke kf l kg kh">android:text=”@{@string/nameFormat(user.firstName, user.lastName)}”</span></pre><h2 id="77bf" class="kc kd hh bd ki kj kk kl km kn ko kp kq jf kr ks kt jj ku kv kw jn kx ky kz la bi translated">NullPointerException</h2><p id="8677" class="pw-post-body-paragraph iw ix hh iy b iz lb ii jb jc lc il je jf ld jh ji jj le jl jm jn lf jp jq jr ha bi translated">一个非常方便的事情是，数据绑定表达式在求值期间总是检查空值。这意味着如果你有这样一个表达式:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="e2c4" class="kc kd hh jy b fi ke kf l kg kh">android:text=”@{user.firstName ?? user.userName}”</span></pre><p id="edb3" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果user为null，user.firstName和user.userName的计算结果将为null，文本将设置为null。无NullPointerException。</p><p id="db1c" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这并不意味着不可能获得NullPointerException。例如，如果你有一个表达式:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="3656" class="kc kd hh jy b fi ke kf l kg kh">android:text=”@{com.example.StringUtils.capitalize(user.firstName)}”</span></pre><p id="876e" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">你的StringUtils有:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="0fca" class="kc kd hh jy b fi ke kf l kg kh"><strong class="jy hi">public static </strong>String capitalize(String str) {<br/>    <strong class="jy hi">return </strong>Character.<em class="lg">toUpperCase</em>(str.charAt(0)) + str.substring(1);<br/>}</span></pre><p id="f749" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">当空值被传递给大写时，您肯定会看到一个NullPointerException。</p><h2 id="7e95" class="kc kd hh bd ki kj kk kl km kn ko kp kq jf kr ks kt jj ku kv kw jn kx ky kz la bi translated">进口</h2><p id="3206" class="pw-post-body-paragraph iw ix hh iy b iz lb ii jb jc lc il je jf ld jh ji jj le jl jm jn lf jp jq jr ha bi translated">在上面的例子中，大写名称的表达式非常长。我们真正想要的是能够导入类型，这样它们就可以被用作一个简化的表达式。您可以通过在数据部分导入它们来实现:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="39e8" class="kc kd hh jy b fi ke kf l kg kh">&lt;<strong class="jy hi">data</strong>&gt;<br/>    &lt;<strong class="jy hi">variable<br/>        name="user"<br/>        type="com.example.myapp.model.User"</strong>/&gt;<br/><em class="lg">    &lt;</em><strong class="jy hi"><em class="lg">import<br/>        type="com.example.StringUtils"</em></strong><em class="lg">/&gt;<br/></em>&lt;/<strong class="jy hi">data</strong>&gt;</span></pre><p id="f473" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在我们的表达式可以简化为:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="2acb" class="kc kd hh jy b fi ke kf l kg kh">android:text=”@{StringUtils.capitalize(user.firstName)}”</span></pre><h2 id="921f" class="kc kd hh bd ki kj kk kl km kn ko kp kq jf kr ks kt jj ku kv kw jn kx ky kz la bi translated">还有什么？</h2><p id="fd04" class="pw-post-body-paragraph iw ix hh iy b iz lb ii jb jc lc il je jf ld jh ji jj le jl jm jn lf jp jq jr ha bi translated">除了上面提到的一些例外，表达式基本上是Java语法。如果你认为它会起作用，它很可能会起作用，所以试一试吧。</p><p id="4d74" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果您有任何详细的问题，请查看数据绑定指南的绑定语法部分:</p><div class="lh li ez fb lj lk"><a href="https://developer.android.com/topic/libraries/data-binding/index.html#expression_language" rel="noopener  ugc nofollow" target="_blank"><div class="ll ab dw"><div class="lm ab ln cl cj lo"><h2 class="bd hi fi z dy lp ea eb lq ed ef hg bi translated">数据绑定库</h2><div class="lr l"><h3 class="bd b fi z dy lp ea eb lq ed ef dx translated">这篇文档解释了如何使用数据绑定库来编写声明性的布局并最小化粘合代码…</h3></div><div class="ls l"><p class="bd b fp z dy lp ea eb lq ed ef dx translated">developer.android.com</p></div></div></div></a></div></div></div>    
</body>
</html>