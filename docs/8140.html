<html>
<head>
<title>Scaling Product Recommendations using Basket Analysis- Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用购物篮分析衡量产品推荐-第1部分</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/scaling-product-recommendations-using-basket-analysis-part-1-8434d4f8756f?source=collection_archive---------4-----------------------#2022-08-24">https://medium.com/walmartglobaltech/scaling-product-recommendations-using-basket-analysis-part-1-8434d4f8756f?source=collection_archive---------4-----------------------#2022-08-24</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/16b482c1707c940f4f681fb1e2766859.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NOaOpY3NfF4ij1Mpv94o7g.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Image source : <a class="ae it" href="https://unsplash.com/photos/sq5P00L7lXc" rel="noopener ugc nofollow" target="_blank">https://unsplash.com/photos/sq5P00L7lXc</a> by Hanson Lu</figcaption></figure><p id="1582" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">包含数百万笔交易的大型产品目录使得了解向客户提供什么样的最佳产品组合变得非常复杂。为了了解顾客的购物行为，并基于购物篮历史提供有针对性的产品，产品推荐起着重要的作用。基于倾向的模型提供了对Omni交易(电子商务:E-comm &amp; store)中共同购买产品的见解。基于先前购买历史的产品购买倾向和购物篮分析有多种现有应用，例如:</p><ul class=""><li id="7d0a" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">电子商务:在品牌网站中产生推荐和搜索功能</li><li id="dc3b" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">CRM:个性化电子邮件/直邮营销</li><li id="356e" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">供应链:需求预测，分类计划</li><li id="ebb7" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">促销/销售:捆绑产品、包装、促销优惠</li></ul><h1 id="d509" class="kg kh hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated"><strong class="ak">问题陈述</strong></h1><p id="c57c" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">你如何发现适合沃尔玛顾客群的精选产品？精心策划的产品推荐增加了购物篮的容量，增加了收入。但是，我们能为所有部门扩展精选产品推荐模型，并找到交叉购买的机会吗？就复杂性、不断变化的真实世界数据集和内存消耗而言，构建可扩展的解决方案可能具有挑战性。可扩展产品推荐引擎是一种需要在产品组合和解决方案的复杂性之间进行权衡的解决方案。在这篇博客中，我们将描述一个基于交易的产品推荐引擎，我们使用PySpark来克服复杂性的挑战。</p><h1 id="736c" class="kg kh hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated"><strong class="ak">建模方法</strong></h1><p id="0f14" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">为了找到合适的产品推荐集，我们将问题分为5个步骤:</p><ol class=""><li id="e930" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr lj jy jz ka bi translated">取数据</li><li id="bc29" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr lj jy jz ka bi translated">预处理和过滤事务</li><li id="d948" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr lj jy jz ka bi translated">建立产品关联模型发现关联规则</li><li id="b00c" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr lj jy jz ka bi translated">输出验证</li><li id="68d3" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr lj jy jz ka bi translated">面向所有部门的扩展解决方案</li></ol><figure class="ll lm ln lo fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lk"><img src="../Images/1ca53dca4d3f8eaad1621331281137df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EIXsHyp7sQrq5TaXVMAjiw.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Modeling Framework( click to enlarge )</figcaption></figure><ol class=""><li id="9bb2" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr lj jy jz ka bi translated"><strong class="iw hi">数据获取</strong></li></ol><p id="28a8" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Ecomm有多个部门，如电子玩具&amp;季节性，服装，食品等。每个部门都有其部门，该部门有与其相关类别和子类别。我们在固定的时间范围内提取每个部门的所有交易数据。</p><figure class="ll lm ln lo fd ii er es paragraph-image"><div class="er es lp"><img src="../Images/bf390e469a6bd228b7e5519e8149df90.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/1*yldJBtG5bnMYjkgs25yd8g.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Reporting Hierarchy for Products in E-commerce</figcaption></figure><p id="5343" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> 2。预处理- </strong></p><p id="848a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">交易包含不同子类别的产品，每种产品都有不同的价格范围和特定的购物客户群。为了在选择产品建议时最大限度地减少偏差，我们应用过滤器来选择要包含在分析中的产品。</p><p id="f88a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">过滤器基于3个关键参数</p><ol class=""><li id="3075" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr lj jy jz ka bi translated">支持</li><li id="d4c2" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr lj jy jz ka bi translated">价格</li><li id="b948" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr lj jy jz ka bi translated">GMV(商品总值)贡献</li></ol><p id="4482" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">什么是产品关联挖掘中的支持度、置信度和升力？</p><p id="e0fd" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">支持</strong>:定义<em class="lq">项目集</em>在所有事务中出现的频率</p><figure class="ll lm ln lo fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lr"><img src="../Images/1136799f76b3a01115715af9bce494c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JqaVxPFGdBSeNWOxjBotAA.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Support</figcaption></figure><p id="316f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">置信度</strong>:定义购物车中已经有先行词的情况下，后续词出现的可能性</p><figure class="ll lm ln lo fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ls"><img src="../Images/f9a04f983a61e0e483be942165e6ffbc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qgnpOlzMeO-x8cCGmgwoVw.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Confidence</figcaption></figure><p id="ec4e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> Lift </strong>:与随机选择相比，衡量关联规则在预测特定结果时的性能。</p><p id="75b4" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">提升值越大，关联越强。</p><figure class="ll lm ln lo fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lt"><img src="../Images/09b0378cda3be78ebebe744fa9ac0fff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V4VPG_dCJWf_onVE1VgiRA.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Lift</figcaption></figure><p id="07d8" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="lq">我们首先过滤掉</em> <strong class="iw hi"> <em class="lq">有单品的不相关交易</em> </strong> <em class="lq">。</em></p><p id="40a3" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="lq">然后m </em> <strong class="iw hi"> <em class="lq">最小和最大支持</em> </strong> <em class="lq">根据分位数范围分布来计算子集交易和产品。</em></p><blockquote class="lu lv lw"><p id="adca" class="iu iv lq iw b ix iy iz ja jb jc jd je lx jg jh ji ly jk jl jm lz jo jp jq jr ha bi translated">MinSupport <em class="hh">帮助移除很少购买的产品。例如:高尔夫配件、电刀。</em></p><p id="360d" class="iu iv lq iw b ix iy iz ja jb jc jd je lx jg jh ji ly jk jl jm lz jo jp jq jr ha bi translated">MaxSupport <em class="hh">删除日常常用的商品。例如:香菜，西红柿。</em></p><p id="ea8b" class="iu iv lq iw b ix iy iz ja jb jc jd je lx jg jh ji ly jk jl jm lz jo jp jq jr ha bi translated">阈值<em class="hh">由产品的</em> <strong class="iw hi"> <em class="hh">最低价格</em> </strong> <em class="hh">和该产品贡献的GMV决定。</em></p></blockquote><p id="592d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">最初的关联规则发现只考虑了出现的频率。然而，我们购物篮分析的目标不仅是找到频繁项目，而且是增加收入/利润。因此，我们包括价格和GMV过滤器，以包括像跑步机和电视这样的项目。基于这些过滤器，产品和交易的最终子集被选择用于建模。</p><p id="e4d4" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> 3。建模</strong></p><p id="2322" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">有两种方法用于解决购物篮分析:</p><p id="8157" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> <em class="lq"> A) FP增长</em> : </strong></p><p id="5ebc" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">FP增长从事务数据中生成频繁模式，而没有候选生成。<strong class="iw hi"> PySpark ML分布式FP growth </strong>算法用于预处理数据之上，以发现由M <em class="lq"> inSupport </em>和M <em class="lq"> inConfidence </em>参数调整的频繁项目配对和产品关联规则。</p><p id="cb58" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">计算每个规则的支持度，并基于支持度、置信度和提升度的组合进行分析。使用3个指标执行的评估有助于决定哪些规则对于不同子类别的一组产品组合是重要的。</p><p id="5a60" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> B) <em class="lq">基于概率的方法</em> </strong></p><p id="fed2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们没有使用任何产品关联模型，而是开发了我们自己的基于分布概率的项目配对方法。在这种方法中，我们查看篮子并计算同现的概率。从每个子类别级别中选择规则，以从不同的产品类别中提供不同的推荐。</p><p id="4217" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">推荐示例</strong>:属于类别:护发素的产品A将与属于类别:护发素的产品B一起推荐。</p><p id="2d86" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">总体而言，基于这两种方法，基于概率的方法被选为所有部门最有效的解决方案，基于两个因素:<br/> 1。它只考虑两个单独项目之间的关系，而关联规则挖掘(FPGrowth)考虑多项目关系。<br/> 2。由于我们排除了多商品关系，计算费用从O(n^n)减少到O(n)，其中n是给定购物篮的平均商品数量。</p><p id="9cf3" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> 4。输出验证</strong></p><p id="c267" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在固定时间段内从所选模型生成的规则用于对一起提供的产品组合做出决策。在每个部门级别生成成千上万的规则，这些规则最终被排序以提供最佳产品推荐。</p><figure class="ll lm ln lo fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ma"><img src="../Images/519ba20f9af5a3a2170faaf50bb68fe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xLQBj9FY9jJdUzE7cQMDzQ.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Sample Product association rules</figcaption></figure><p id="f7fe" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">一个月与三个月的关联规则验证结果相比，我们观察到三个月比一个月更独特的查询/前提和规则:</p><figure class="ll lm ln lo fd ii er es paragraph-image"><div class="er es mb"><img src="../Images/edffe383498dd95f9462d782defb3720.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*yU4I9p1N_cu_4T2wISppig.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Rules stats</figcaption></figure></div><div class="ab cl mc md go me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ha hb hc hd he"><p id="ae08" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> 5。缩放</strong></p><figure class="ll lm ln lo fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mj"><img src="../Images/d380e5c31a770513ef3a632ffb542c10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HFSMLoylRf-vUEvK1VA_6w.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Overview of Spark framework. The master node contains driver program, which drives the application by creating Spark context object. Spark context object works with cluster manager to manage different jobs. Worker nodes job is to execute the tasks and return the results to Master node. Picture from <a class="ae it" href="https://www.mdpi.com/2076-3417/10/10/3382/htm" rel="noopener ugc nofollow" target="_blank">https://www.mdpi.com/2076-3417/10/10/3382/htm</a></figcaption></figure><p id="7dca" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">交易数据可能有数十亿笔交易，包含不同子类别的产品。从这些交易中理解购物行为是复杂的，最重要的是，这是一种代价高昂的内存计算。为了能够大规模地分析数据，我们使用PySpark来支持分布式处理，同时为多个部门一起运行作业。与在部门级别运行相比，这使得处理速度更快。</p><figure class="ll lm ln lo fd ii er es paragraph-image"><div class="er es mk"><img src="../Images/5d609f2a7e13b619a3e8f79f199107bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:490/format:webp/1*OxSQOKljo9_C4hjtHwK6tQ.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Airflow workflow setup</figcaption></figure><p id="7fe0" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">超级部门是根据交易量和目录多样性划分的。根据子部门为所有部门设置气流工作流，以处理固定时间范围内的购物篮分析。结果被成批计算，并被合并到由超级部门聚集的主表中。整个工作流的执行大约需要6个小时来涵盖建模的所有4个步骤。</p><h1 id="c0b0" class="kg kh hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">结论</h1><p id="eda4" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">基于交易的产品推荐产生了许多有用的产品集，这些产品集是互补的，有助于增加购物篮的大小。然而，这种方法存在冷启动问题。为了处理新产品的冷启动问题，我们使用基于产品属性的方法扩展了基于交易的产品推荐。请继续关注产品推荐的第2部分。我真诚地希望这篇文章能够帮助那些寻求构建可扩展的推荐解决方案的人。如果你有任何建议，请发表评论。</p><h1 id="7f19" class="kg kh hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated"><strong class="ak">确认</strong></h1><p id="fa34" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">沃尔玛全球技术部正在使用购物篮分析进行产品推荐。这个推荐引擎是和<a class="ml mm ge" href="https://medium.com/u/708bbde59bf3?source=post_page-----8434d4f8756f--------------------------------" rel="noopener" target="_blank">jun wan Choi</a>共同开发的。特别感谢<a class="ml mm ge" href="https://medium.com/u/787269b21342?source=post_page-----8434d4f8756f--------------------------------" rel="noopener" target="_blank">Srujana Kaddevarmuth</a>&amp;<a class="ml mm ge" href="https://medium.com/u/624981fd8f60?source=post_page-----8434d4f8756f--------------------------------" rel="noopener" target="_blank">Jonathan Sidhu</a>的倡议和支持，<a class="ml mm ge" href="https://medium.com/u/e9b6ea0ee89?source=post_page-----8434d4f8756f--------------------------------" rel="noopener" target="_blank"> Abin Abraham </a>的贡献&amp;支持，Data Venture团队在整个工作中给予的帮助。</p><h1 id="637f" class="kg kh hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated"><strong class="ak">资源</strong></h1><p id="10d7" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated"><a class="ae it" href="https://spark.apache.org/docs/latest/api/python/reference/api/pyspark.ml.fpm.FPGrowth.html" rel="noopener ugc nofollow" target="_blank">https://spark . Apache . org/docs/latest/API/python/reference/API/py spark . ml . fpm . FP growth . html</a></p></div></div>    
</body>
</html>