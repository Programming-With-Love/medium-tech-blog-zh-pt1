<html>
<head>
<title>Nested Ternaries are Great</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">嵌套三角形很棒</h1>
<blockquote>原文：<a href="https://medium.com/javascript-scene/nested-ternaries-are-great-361bddd0f340?source=collection_archive---------0-----------------------#2018-01-25">https://medium.com/javascript-scene/nested-ternaries-are-great-361bddd0f340?source=collection_archive---------0-----------------------#2018-01-25</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/b5319c93f5a4237f1472d1686f5b1e6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uVpU7iruzXafhU2VLeH4lw.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Smoke Art Cubes to Smoke — MattysFlicks — (CC BY 2.0)</figcaption></figure><blockquote class="it iu iv"><p id="62a6" class="iw ix iy iz b ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju ha bi translated">注意:这是关于从头开始学习JavaScript ES6+中的函数式编程和组合软件技术的“组合软件”系列的一部分。敬请关注。还会有更多这样的事情发生！<br/> <a class="ae jv" rel="noopener" href="/javascript-scene/the-hidden-treasures-of-object-composition-60cd89480381"> &lt;上一部</a> | <a class="ae jv" rel="noopener" href="/javascript-scene/composing-software-an-introduction-27b72500d6ea"> &lt; &lt;在第一部</a> | <a class="ae jv" rel="noopener" href="/javascript-scene/abstraction-composition-cb2849d5bdd6">下一部&gt; </a>重新开始</p></blockquote><p id="bdc5" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">传统智慧会让你相信嵌套ternaries是不可读的，应该避免。</p><blockquote class="jz"><p id="26c0" class="ka kb hh bd kc kd ke kf kg kh ki ju dx translated">传统智慧有时是不明智的。</p></blockquote><p id="34ba" class="pw-post-body-paragraph iw ix hh iz b ja kj jc jd je kk jg jh jw kl jk jl jx km jo jp jy kn js jt ju ha bi translated">事实是，名词通常比if语句简单得多。人们相信相反的情况有两个原因:</p><ol class=""><li id="7105" class="ko kp hh iz b ja jb je jf jw kq jx kr jy ks ju kt ku kv kw bi translated">他们更熟悉if语句。熟悉偏见会让我们相信不真实的事情，即使我们有相反的证据。</li><li id="c574" class="ko kp hh iz b ja kx je ky jw kz jx la jy lb ju kt ku kv kw bi translated">人们试图使用三元语句，就好像它们是if语句一样。那不行，因为三元表达式是<em class="iy">表达式，不是语句。</em></li></ol><p id="6f7d" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">在我们进入细节之前，让我们定义一个三元表达式:</p><p id="e575" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">三元表达式是计算结果为值的条件表达式。它由一个条件、一个truthy子句(如果条件的计算结果为truthy值，则生成的值)和一个falsy子句(如果条件的计算结果为falsy值，则生成的值)组成。</p><p id="e827" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">它们看起来像这样:</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="4620" class="ll lm hh lh b fi ln lo l lp lq">(conditional)<br/>  ? truthyClause<br/>  : falsyClause</span></pre><h1 id="8f94" class="lr lm hh bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">表达式与语句</h1><p id="9c2c" class="pw-post-body-paragraph iw ix hh iz b ja mo jc jd je mp jg jh jw mq jk jl jx mr jo jp jy ms js jt ju ha bi translated">一些编程语言(包括Smalltalk、Haskell和大多数函数式编程语言)根本没有if语句。他们用<code class="du mt mu mv lh b">if</code> <em class="iy">表情</em>代替。</p><p id="06ac" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">if表达式是计算结果为值的条件表达式。它由一个条件、一个truthy子句(如果条件的计算结果为truthy值，则生成的值)和一个falsy子句(如果条件的计算结果为falsy值，则生成的值)组成。</p><p id="9846" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">这看起来眼熟吗？大多数函数式编程语言使用<em class="iy">三元表达式</em>作为它们的<code class="du mt mu mv lh b">if</code>关键字。为什么？</p><p id="229f" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">表达式是一段计算结果为单个值的代码。</p><p id="0e1a" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">语句是一段代码，可能根本不计算任何值。在JavaScript中，if语句<em class="iy">不计算值</em>。为了让JavaScript中的if语句做任何有用的事情，它<em class="iy">必须</em>产生副作用或者从包含函数返回值。</p><p id="5528" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">在函数式编程中，我们倾向于<em class="iy">避免</em>突变和其他副作用。由于JavaScript中的<code class="du mt mu mv lh b">if</code>自然地<em class="iy">提供了</em>变异和副作用，许多函数式程序员转而使用ternaries嵌套的或不嵌套的。包括我。</p><p id="da28" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">从三元表达式的角度思考与从if语句的角度思考有些不同，但是如果你练习了几个星期，你会很自然地开始被三元表达式吸引，如果仅仅是因为输入更少的话，你很快就会看到。</p><h1 id="2773" class="lr lm hh bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">熟悉性偏差</h1><p id="0508" class="pw-post-body-paragraph iw ix hh iz b ja mo jc jd je mp jg jh jw mq jk jl jx mr jo jp jy ms js jt ju ha bi translated">我听到的普遍说法是嵌套的三元表达式“难以阅读”。让我们用一些代码示例来打破这个神话:</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="5e2c" class="ll lm hh lh b fi ln lo l lp lq">const withIf = ({<br/>  conditionA, conditionB<br/>}) =&gt; {<br/>  if (conditionA) {<br/>    if (conditionB) {<br/>      return valueA;<br/>    }<br/>    return valueB;<br/>  }<br/>  return valueC;<br/>};</span></pre><p id="0629" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">请注意，在这个版本中，有嵌套条件和大括号在视觉上将truthy子句与falsy子句分开，使它们感觉非常不连贯。这是相当简单的逻辑，但是解析起来有点费力。</p><p id="9044" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">下面是以三元表达式形式编写的相同逻辑:</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="16a0" class="ll lm hh lh b fi ln lo l lp lq">const withTernary = ({<br/>  conditionA, conditionB<br/>}) =&gt; (<br/>  (!conditionA)<br/>    ? valueC<br/>    : (conditionB)<br/>    ? valueA<br/>    : valueB<br/>);</span></pre><p id="9574" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">这里有几个有趣的观点:</p><h1 id="c69a" class="lr lm hh bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">菊花链与嵌套</h1><p id="b49d" class="pw-post-body-paragraph iw ix hh iz b ja mo jc jd je mp jg jh jw mq jk jl jx mr jo jp jy ms js jt ju ha bi translated">首先，我们把巢弄平了。“嵌套”ternaries有点用词不当，因为ternaries很容易写成一条直线，你根本不需要用缩进层次来嵌套它们。它们只是以一条直线从上到下读取，一旦遇到真值条件或回退就返回值。</p><p id="0e1c" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">如果你写的ternaries正确，没有嵌套需要解析。沿着直线走很难迷路。</p><p id="965a" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">我们或许应该称它们为“连锁的ternaries”。</p><p id="8bd8" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">我想指出的第二件事是，为了简化这种直线链接，我稍微改变了一下顺序:如果您到达一个三元表达式的末尾，发现您需要编写两个冒号子句(<code class="du mt mu mv lh b">:</code>)，抓取最后一个子句，将其移动到顶部，并反转第一个条件的逻辑以简化三元表达式的解析。不再困惑！</p><p id="466b" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">值得注意的是，我们可以使用相同的技巧来简化if语句的形式:</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="109b" class="ll lm hh lh b fi ln lo l lp lq">const withIf = ({<br/>  conditionA, conditionB<br/>}) =&gt; {<br/>  if (!conditionA) return valueC;<br/>  if (conditionB) {<br/>    return valueA;<br/>  }<br/>  return valueB;<br/>};</span></pre><p id="62e8" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">这样更好，但还是在视觉上把<code class="du mt mu mv lh b">conditionB</code>的相关子句打散了，会造成混乱。我看到过这个问题导致代码维护过程中的逻辑错误。即使逻辑扁平化，这个版本仍然比三进制版本更杂乱。</p><h1 id="bb32" class="lr lm hh bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">语法混乱</h1><p id="0a06" class="pw-post-body-paragraph iw ix hh iz b ja mo jc jd je mp jg jh jw mq jk jl jx mr jo jp jy ms js jt ju ha bi translated"><code class="du mt mu mv lh b">if</code>版本包含了更多的噪声:<code class="du mt mu mv lh b">if</code>关键字vs <code class="du mt mu mv lh b">?</code>，<code class="du mt mu mv lh b">return</code>强制语句返回值，额外的分号，额外的括号，等等...与这个例子不同，大多数if语句也会改变一些外部状态，这进一步增加了额外的代码和复杂性。</p><p id="f45d" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">额外的代码是不好的，有几个重要原因。这些我以前都说过，但是值得重复，直到每个开发人员都牢记在心:</p><h2 id="a6c1" class="ll lm hh bd ls mw mx my lw mz na nb ma jw nc nd me jx ne nf mi jy ng nh mm ni bi translated">内存储器</h2><p id="1b62" class="pw-post-body-paragraph iw ix hh iz b ja mo jc jd je mp jg jh jw mq jk jl jx mr jo jp jy ms js jt ju ha bi translated">普通人的大脑在工作记忆中只有少量用于离散<a class="ae jv" href="https://www.nature.com/articles/nn.3655" rel="noopener ugc nofollow" target="_blank">量子的共享资源，每个变量都可能消耗其中一个量子。当你增加更多的变量时，你准确回忆每个变量含义的能力就会减弱。工作记忆模型通常包含4-7个离散量子。在这些数字之上，错误率急剧增加。</a></p><p id="9d2b" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">当我们用if语句而不是ternaries来强制突变或副作用时，这通常需要在组合中添加不需要的变量。</p><h2 id="a208" class="ll lm hh bd ls mw mx my lw mz na nb ma jw nc nd me jx ne nf mi jy ng nh mm ni bi translated">信噪比</h2><p id="9511" class="pw-post-body-paragraph iw ix hh iz b ja mo jc jd je mp jg jh jw mq jk jl jx mr jo jp jy ms js jt ju ha bi translated">简洁的代码还可以提高代码的信噪比。这就像听收音机——当收音机没有调到合适的电台时，你会听到很多干扰噪音，更难听到音乐。当你调到正确的电台时，噪音就消失了，你会得到更强的音乐信号。</p><p id="a0e4" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">代码也是一样。更简洁的代码表达有助于理解。有些代码给了我们有用的信息，有些代码只是占用了空间。如果你能减少你使用的代码量而不减少要传递的意思，你将使代码更容易被其他需要阅读它的人解析和理解。</p><h2 id="accf" class="ll lm hh bd ls mw mx my lw mz na nb ma jw nc nd me jx ne nf mi jy ng nh mm ni bi translated">虫子的表面区域</h2><p id="1e2b" class="pw-post-body-paragraph iw ix hh iz b ja mo jc jd je mp jg jh jw mq jk jl jx mr jo jp jy ms js jt ju ha bi translated">看看之前和之后的函数。看起来这个功能好像节食减肥了。这很重要，因为额外的代码意味着有额外的表面区域让虫子藏在里面，这意味着会有更多的虫子藏在里面。</p><blockquote class="jz"><p id="4547" class="ka kb hh bd kc kd ke kf kg kh ki ju dx translated"><em class="nj">代码越少= bug越少= bug越少。</em></p></blockquote><h1 id="c171" class="lr lm hh bd ls lt lu lv lw lx ly lz ma mb nk md me mf nl mh mi mj nm ml mm mn bi translated">副作用和共享可变状态</h1><p id="531f" class="pw-post-body-paragraph iw ix hh iz b ja mo jc jd je mp jg jh jw mq jk jl jx mr jo jp jy ms js jt ju ha bi translated">许多if语句不仅仅是计算一个值。它们还会产生副作用，或者使变量变异，所以如果不知道这些副作用的影响以及涉及其共享可变状态的所有其他事物的完整历史，就无法看到if语句的完整效果。</p><p id="40a0" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">限制自己返回一个值会迫使你遵守纪律:切断依赖关系，使你的程序更容易理解、调试、重构和维护。</p><p id="d30f" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">这实际上是我最喜欢的三元表达式的好处:</p><blockquote class="jz"><p id="7198" class="ka kb hh bd kc kd ke kf kg kh ki ju dx translated"><em class="nj">使用ternaries会让你成为更好的开发者。</em></p></blockquote><h1 id="3071" class="lr lm hh bd ls lt lu lv lw lx ly lz ma mb nk md me mf nl mh mi mj nm ml mm mn bi translated">结论</h1><p id="15ef" class="pw-post-body-paragraph iw ix hh iz b ja mo jc jd je mp jg jh jw mq jk jl jx mr jo jp jy ms js jt ju ha bi translated">由于所有的三元组都很容易从上到下排成一条直线，称它们为“嵌套三元组”有点用词不当。让我们称他们为“连锁ternaries”，而不是。</p><p id="6d91" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">与if语句相比，链式术语有几个优点:</p><ul class=""><li id="c6f7" class="ko kp hh iz b ja jb je jf jw kq jx kr jy ks ju nn ku kv kw bi translated">把它们从上到下写成一条直线总是很容易的。如果你能沿着一条直线，你就能读出一个链式三元组。</li><li id="59be" class="ko kp hh iz b ja kx je ky jw kz jx la jy lb ju nn ku kv kw bi translated">词条减少了语法混乱。更少的代码=更少的bug表面积=更少的bug。</li><li id="4dad" class="ko kp hh iz b ja kx je ky jw kz jx la jy lb ju nn ku kv kw bi translated">Ternaries不需要临时变量，减少了工作记忆的负荷。</li><li id="8b0e" class="ko kp hh iz b ja kx je ky jw kz jx la jy lb ju nn ku kv kw bi translated">Ternaries有更好的信噪比。</li><li id="f5ce" class="ko kp hh iz b ja kx je ky jw kz jx la jy lb ju nn ku kv kw bi translated">如果声明鼓励副作用和突变。术语鼓励纯代码。</li><li id="7c1c" class="ko kp hh iz b ja kx je ky jw kz jx la jy lb ju nn ku kv kw bi translated">纯代码将我们的表达式和函数彼此解耦，所以术语训练我们成为更好的开发人员。</li></ul><h1 id="7cf5" class="lr lm hh bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">在EricElliottJS.com了解更多信息</h1><p id="d76c" class="pw-post-body-paragraph iw ix hh iz b ja mo jc jd je mp jg jh jw mq jk jl jx mr jo jp jy ms js jt ju ha bi translated">EricElliottJS.com的会员可以上函数式编程的视频课。如果您还不是会员，<a class="ae jv" href="https://ericelliottjs.com/" rel="noopener ugc nofollow" target="_blank">今天就注册吧</a>。</p><figure class="lc ld le lf fd ii er es paragraph-image"><a href="https://ericelliottjs.com/product/lifetime-access-pass/"><div class="er es no"><img src="../Images/ebd7dfc9ae8d8938e30bdbdbe428fd4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3njisYUeHOdyLCGZ8czt_w.jpeg"/></div></a></figure></div><div class="ab cl np nq go nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ha hb hc hd he"><p id="5e7e" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated"><strong class="iz hi"> <em class="iy">埃里克艾略特</em> </strong> <em class="iy">著有</em> <a class="ae jv" href="http://pjabook.com" rel="noopener ugc nofollow" target="_blank"> <em class="iy">【编程JavaScript应用】</em> </a> <em class="iy">(奥赖利)，以及</em> <a class="ae jv" href="http://ericelliottjs.com/product/lifetime-access-pass/" rel="noopener ugc nofollow" target="_blank"> <em class="iy">【跟埃里克艾略特学JavaScript】</em></a><em class="iy">。他曾为</em><strong class="iz hi"><em class="iy">Adobe Systems</em></strong><em class="iy"/><strong class="iz hi"><em class="iy">尊巴健身</em></strong><em class="iy"/><strong class="iz hi"><em class="iy">华尔街日报</em></strong><em class="iy"/><strong class="iz hi"><em class="iy">ESPN</em></strong><em class="iy"/><strong class="iz hi"><em class="iy">BBC</em></strong><em class="iy">等顶级录音师贡献过软件经验</em></p><p id="98ef" class="pw-post-body-paragraph iw ix hh iz b ja jb jc jd je jf jg jh jw jj jk jl jx jn jo jp jy jr js jt ju ha bi translated">他在远离任何地方的地方和世界上最美丽的女人一起工作。</p></div></div>    
</body>
</html>