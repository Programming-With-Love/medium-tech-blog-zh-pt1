<html>
<head>
<title>Setting up a Highly responsive site with HTTP/2 and NGINX on a CentOS 7.6 VPS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在CentOS 7.6 VPS上使用HTTP/2和NGINX设置高响应性站点</h1>
<blockquote>原文：<a href="https://medium.com/quick-code/setting-up-a-highly-responsive-site-with-http-2-and-nginx-on-a-centos-7-6-vps-d9aa444820f7?source=collection_archive---------2-----------------------#2019-02-20">https://medium.com/quick-code/setting-up-a-highly-responsive-site-with-http-2-and-nginx-on-a-centos-7-6-vps-d9aa444820f7?source=collection_archive---------2-----------------------#2019-02-20</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="d514" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jc">本教程首次发布</em> <a class="ae jd" href="https://andreborud.com/setting-up-a-highly-responsive-ghost-blog-with/#top" rel="noopener ugc nofollow" target="_blank"> <em class="jc">这里</em> </a> <em class="jc">。</em></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/9b5c53d1e10aef666608300942660626.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9gZRBbj__ZR0cy9J"/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">Photo by <a class="ae jd" href="https://unsplash.com/@aligns?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Jordan Harrison</a> on <a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3a97" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是我的前两个教程的更新教程，讲述了如何在digital ocean CentOS 7.6 VPS Droplet上设置Ghost博客，并使用HTTP/2.0使服务器尽可能安全和响应迅速。</p><p id="c407" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jd" rel="noopener" href="/@andreborud/how-to-setup-http2-on-centos-7-3-with-nginx-13db65c3eaf">如何用NGINX在CentOs 7.3上设置http 2</a></p><p id="9f60" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jd" rel="noopener" href="/@andreborud/how-to-setup-ghost-on-with-https-on-a-fresh-digitalocean-centos-7-2-droplet-bd3baa1ca055">如何在新的DigitalOcean CentOS 7.2 droplet上使用HTTPS设置Ghost on</a></p><p id="5856" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本教程中，我将介绍我采取的一些安全措施，以及如何设置一个响应迅速的web应用程序/站点，该应用程序/站点通过自动包含HTTPS的HTTP2提供服务。我将使用NGINX作为服务器，所有这些都将在数字海洋上托管的CentOS 7.6 VPS上完成。例如，我将安装一个ghost博客，但是如果你主要是在寻找如何在CentOS 7.6服务器上运行HTTP/2，那么请跳到下面的<em class="jc"> Certbot </em>和<em class="jc"> Nginx </em>部分。</p><p id="8cd5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，我假设您有一个安装了CentOS 7.5的新Droplet。在撰写本文时，CentOS 7.5是DigitalOcean上可用的最高版本，尽管CentOS 7.6已经存在了一段时间。</p><p id="bd94" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，在您选择的终端中使用ssh登录到您的VPS。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="61e9" class="jz ka hh jv b fi kb kc l kd ke"># ssh root@host to login and change your password</span></pre><p id="1cb2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，首先，我们将使用以下命令更新CentOS。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="09e0" class="jz ka hh jv b fi kb kc l kd ke"># yum update</span></pre><p id="f99f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，要检查我们使用的是CentOS的最新版本，请键入以下内容。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="5af5" class="jz ka hh jv b fi kb kc l kd ke"># cat /etc/centos-release</span></pre><p id="aa39" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">其在写入时输出:</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="9c27" class="jz ka hh jv b fi kb kc l kd ke">CentOS Linux release 7.6.1810 (Core)</span></pre><h1 id="f23e" class="kf ka hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">防火墙</h1><p id="f5eb" class="pw-post-body-paragraph ie if hh ig b ih lc ij ik il ld in io ip le ir is it lf iv iw ix lg iz ja jb ha bi translated">接下来，我们将安装一个防火墙，以便对我们希望向公众开放的内容进行一些额外的控制。Yum是CentOS的“应用商店”,在这里您可以下载应用程序并将其安装到您的操作系统中。而systemctl可以启动和停止已安装的应用程序或服务。如果服务器重新启动，systemctl enable可确保您的应用程序启动，并且status会检查应用程序的当前状态。以下命令将安装、启动、启用和检查我们将要安装的应用程序firewalld的状态。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="457f" class="jz ka hh jv b fi kb kc l kd ke"># yum install firewalld<br/># systemctl start firewalld<br/># systemctl enable firewalld<br/># systemctl status firewalld</span></pre><p id="4d1d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Status应该输出类似下面的内容。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="b484" class="jz ka hh jv b fi kb kc l kd ke">firewalld.service — firewalld — dynamic firewall daemon<br/> Loaded: loaded (/usr/lib/systemd/system/firewalld.service; enabled; vendor preset: enabled)<br/> Active: active (running) since Fri 2018–12–28 15:01:12 UTC; 11s ago<br/> Docs: man:firewalld(1)<br/> Main PID: 8509 (firewalld)<br/> CGroup: /system.slice/firewalld.service<br/> └─8509 /usr/bin/python -Es /usr/sbin/firewalld — nofork — nopid</span><span id="11ed" class="jz ka hh jv b fi lh kc l kd ke">Dec 28 15:01:12 temp-test systemd[1]: Starting firewalld — dynamic firewall daemon…<br/>Dec 28 15:01:12 temp-test systemd[1]: Started firewalld — dynamic firewall daemon.</span></pre><h1 id="7019" class="kf ka hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">更改ssh端口</h1><p id="843c" class="pw-post-body-paragraph ie if hh ig b ih lc ij ik il ld in io ip le ir is it lf iv iw ix lg iz ja jb ha bi translated">作为额外的安全措施，我喜欢改变用于ssh连接的标准端口。我这样做是因为如果我保持端口22和远程root访问启用，我会有数百次不成功的尝试登录到我的服务器上的root帐户。从统计上看，如果你有一个安全的密码，任何人都不可能登录，但是让我们更安全一点。</p><p id="5900" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们编辑ssh配置文件。我喜欢的文本编辑器是“vi ”,但是你可以使用你喜欢的任何一个。如果你是“vi”的新手，你只需要知道几个命令就可以使用它。</p><p id="6006" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">文件打开后，按下<strong class="ig hi"> i </strong>开始编辑文件。你可以用箭头键移动。一旦你完成编辑，按下<strong class="ig hi"> ESC </strong>键并键入:和<strong class="ig hi"> wq </strong>键并按下<strong class="ig hi">回车键/回车键</strong>。<strong class="ig hi"> w </strong>代表<em class="jc">写</em>和<strong class="ig hi"> q </strong>代表<em class="jc">退出</em>。有些时候，如果你已经做了更改，不想保存它们，但只是退出，添加一个<strong class="ig hi">！</strong>后<strong class="ig hi"> q </strong>强制退出不做修改(如是<strong class="ig hi"> :q！</strong>)。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="6afc" class="jz ka hh jv b fi kb kc l kd ke"># vi /etc/ssh/sshd_config</span></pre><p id="777b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">找到并取消注释<strong class="ig hi"> #Port 22 </strong>(删除该行开头的#)并将端口号更改为您想要的任何值，在本例中我将使用端口2244。</p><p id="0978" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">CentOS附带SELinux(安全增强的Linux ),这是一个内核模块，用于管理Linux中的安全策略。我们需要做的是允许sshd使用端口2244。我们可以这样做。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="8a39" class="jz ka hh jv b fi kb kc l kd ke"># semanage port -a -t ssh_port_t -p tcp 2244</span></pre><p id="fd45" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们还需要在防火墙中打开这个端口，然后重新加载防火墙以应用更改。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="38f1" class="jz ka hh jv b fi kb kc l kd ke"># firewall-cmd --permanent --zone=public --add-port=2244/tcp<br/># firewall-cmd --reload</span></pre><p id="85a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，我们将重新启动ssh服务，应用使用端口2244而不是端口22的更改。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="092d" class="jz ka hh jv b fi kb kc l kd ke"># systemctl restart sshd</span></pre><p id="d6a4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，您可以从您的服务器注销，并尝试像第一次一样重新连接到您的服务器，看看它是否被阻止，然后尝试使用新端口登录。<br/>要使用不同端口的ssh，请在登录时添加“-p ####”以结束。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="aaa8" class="jz ka hh jv b fi kb kc l kd ke"># ssh root@host -p 2244</span></pre><h1 id="d33b" class="kf ka hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">新用户</h1><p id="7559" class="pw-post-body-paragraph ie if hh ig b ih lc ij ik il ld in io ip le ir is it lf iv iw ix lg iz ja jb ha bi translated">接下来，我们将添加另一个用户，因为使用root用户远程登录到您的服务器不是一个好的做法。让我们称这个用户为toor。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="0fd5" class="jz ka hh jv b fi kb kc l kd ke"># useradd toor<br/># passwd toor<br/># usermod -aG wheel toor</span></pre><p id="5ee7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">useradd创建用户。passwd允许您向用户添加密码。并且usermod -aG wheel授予您的新用户sudo权限。现在试着注销，然后用你的新用户登录，看看它能不能工作。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="6243" class="jz ka hh jv b fi kb kc l kd ke"># ssh toor@host -p 2244</span></pre><p id="0b6c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在我们将允许ssh中的证书登录。为此，我们需要再次修改sshd_config文件。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="4d82" class="jz ka hh jv b fi kb kc l kd ke"># sudo vi /etc/ssh/sshd_config</span></pre><p id="74d3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因为我们不再是根用户，你需要在你的用户目录之外所做的改变之前添加sudo。系统将提示您输入密码。</p><p id="4ca9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">找到带有‘pubkeyauthentication’的行，删除开头的#以取消注释，并确保它后面显示yes</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="ac36" class="jz ka hh jv b fi kb kc l kd ke">PubkeyAuthentication yes</span></pre><p id="1b51" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">保存并退出vi。并重新启动sshd服务。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="a9db" class="jz ka hh jv b fi kb kc l kd ke"># sudo systemctl restart sshd</span></pre><p id="8aeb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果这工作正常，然后再次注销，我们将创建一个证书，允许无密码登录到您的服务器，使生活稍微好一点。<br/>要创建新的证书，请键入以下内容。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="8054" class="jz ka hh jv b fi kb kc l kd ke"># ssh-keygen -t rsa</span></pre><p id="beac" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当它要求输入密码时，只需按enter键即可创建一个无密码证书。这个命令在Mac和Linux上都有效。然而，Windows的命令略有不同，但有一种方法可以在Windows 10中原生获得Ubuntu Bash终端。如果你还没有，我建议你尝试一下。如何启用可以按照这个教程:<a class="ae jd" href="https://www.laptopmag.com/articles/use-bash-shell-windows-10" rel="noopener ugc nofollow" target="_blank">https://www . laptopmag . com/articles/use-bash-shell-windows-10</a></p><p id="968b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，我们要将证书复制到服务器。对此有一个非常简单的命令。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="1fb3" class="jz ka hh jv b fi kb kc l kd ke"># ssh-copy-id -i ~/.ssh/id_rsa toor@host -p 2244</span></pre><p id="f457" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果成功，将再次尝试登录。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="dec3" class="jz ka hh jv b fi kb kc l kd ke"># ssh toor@host -p 2244</span></pre><p id="0ae9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这应该会让你直接进入你的服务器，而不需要密码。<br/>下一步我们将确保不再允许根用户登录。如果你愿意，你也可以禁用密码登录到您的服务器。这意味着登录的唯一方式是使用您的证书。如果你丢失了它，或者你试图从另一台计算机访问你的服务器，你就完了。不过DigitalOcean确实有一个备份计划，如果你被锁定，你可以登录到他们的控制面板，通过这种方式获得根ssh访问。我把自己锁在了制作本教程的门外，按错误的顺序完成了一些步骤，但是通过在线终端再次获得了访问权限。</p><p id="c82d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在让我们禁用远程根登录</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="7f84" class="jz ka hh jv b fi kb kc l kd ke"># sudo vi /etc/ssh/sshd_config</span></pre><p id="d4cf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">找到带有PermitRootLogin的行，取消对它的注释，并确保它在后面说no。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="fcc7" class="jz ka hh jv b fi kb kc l kd ke">#PermitRootLogin yes -&gt; PermitRootLogin no</span></pre><p id="20b0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，如果您愿意，您可以找到写有PasswordAuthentication yes的行，并将其更改为</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="5710" class="jz ka hh jv b fi kb kc l kd ke">PasswordAuthentication </span></pre><p id="e0a3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这将禁止任何使用密码通过ssh登录到您的服务器的尝试。<br/>保存并退出。并重新启动sshd服务。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="3f6c" class="jz ka hh jv b fi kb kc l kd ke"># sudo systemctl restart sshd</span></pre><p id="6faa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您需要访问您的root帐户，请使用您的普通帐户登录，然后只需键入<strong class="ig hi"> su </strong>和您的root密码。</p><h1 id="c31c" class="kf ka hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">节点. js</h1><p id="5a24" class="pw-post-body-paragraph ie if hh ig b ih lc ij ik il ld in io ip le ir is it lf iv iw ix lg iz ja jb ha bi translated">接下来，我们将安装node.js。有多种方法可以通过yum、nvm等完成。就我个人而言，我更喜欢nvm(节点版本管理器),因为以后如果需要的话，更改节点版本会更容易。nvm只为当前登录的用户安装节点，这意味着您可以让多个用户使用不同的节点版本，如果您了解这一点，这将非常方便。</p><p id="11cf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先前往<a class="ae jd" href="https://github.com/creationix/nvm" rel="noopener ugc nofollow" target="_blank">https://github.com/creationix/nvm</a>查看最新版本是什么。写这篇文章的时候是v0.34.0。通过编写安装它</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="6f25" class="jz ka hh jv b fi kb kc l kd ke"># curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.34.0/install.sh | bash</span></pre><p id="d0cc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后选择您的节点版本。我通常会选择最新的LTS版本。在<a class="ae jd" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">https://nodejs.org/en/</a>检查在编写本文件时哪个版本是v10.15.1</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="ea29" class="jz ka hh jv b fi kb kc l kd ke"># nvm install 10.15.1<br/># node -v</span></pre><p id="4da8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">node -v应该输出版本。</p><h1 id="390a" class="kf ka hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">关系型数据库</h1><p id="a17f" class="pw-post-body-paragraph ie if hh ig b ih lc ij ik il ld in io ip le ir is it lf iv iw ix lg iz ja jb ha bi translated">Ghost需要一个MySQL数据库来运行，所以接下来我们将安装它。你知道MySQL中的My实际上是造物主的女儿的名字，而不是像英语中的My(我的)那样发音吗？这个人有两个女儿，你可能听说过一个MySQL的替代品叫做MariaDB，以他的第二个女儿命名。</p><p id="1fd3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从前往<a class="ae jd" href="https://dev.mysql.com/downloads/repo/yum/" rel="noopener ugc nofollow" target="_blank">https://dev.mysql.com/downloads/repo/yum/</a>开始，滚动到底部，找到最新版本。它用一个很小的文字在括号里写着，Linux发行版在哪里，在Red Hat enterprice下的CentOS check。在写的时候版本是<strong class="ig hi">MySQL 80-community-release-el7–2 . no arch . rpm</strong>。</p><p id="3904" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下载安装包类型。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="bee5" class="jz ka hh jv b fi kb kc l kd ke"># wget https://dev.mysql.com/get/mysql80-community-release-el7-2.noarch.rpm</span></pre><p id="f06b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果没有安装wget，你可以用它来下载，然后用上面的命令下载MySQL。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="e265" class="jz ka hh jv b fi kb kc l kd ke"># sudo yum install wget</span></pre><p id="d10a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">作为额外的安全措施，您可以使用以下命令检查下载包的MD5校验和</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="7eda" class="jz ka hh jv b fi kb kc l kd ke"># md5sum mysql80-community-release-el7–2.noarch.rpm</span></pre><p id="294e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后将结果与我们检查最新MySQL版本的网站上同一行的校验和进行比较。如果还是一样，继续安装mysql，用systemctl启动并启用数据库。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="2d1b" class="jz ka hh jv b fi kb kc l kd ke"># sudo rpm -ivh mysql80-community-release-el7–2.noarch.rpm<br/># sudo yum install mysql-server<br/># sudo systemctl start mysqld<br/># sudo systemctl status mysqld<br/># sudo systemctl enable mysqld</span></pre><p id="f2ff" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在安装过程中，MySQL为我们需要找到的root用户生成了一个临时密码。我们可以这样得到它</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="961a" class="jz ka hh jv b fi kb kc l kd ke"># sudo grep ‘temporary password’ /var/log/mysqld.log</span></pre><p id="3e61" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">复制密码并继续安装。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="2e4b" class="jz ka hh jv b fi kb kc l kd ke"># sudo mysql_secure_installation</span></pre><p id="9e90" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先输入临时密码。然后创建一个新的密码，写下来并存储在某个安全的地方，如果你失去了它只是一个痛苦的创建一个新的没有丢失数据库中的数据。<br/>出于某种原因，我被要求输入两次新的root密码。一旦你完成了密码部分，只要对所有问题回答是。</p><p id="460e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，我们将为ghost创建一个新的用户和数据库。首先以root用户身份登录MySQL shell。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="9fa0" class="jz ka hh jv b fi kb kc l kd ke"># mysql -u root -p</span></pre><p id="2aad" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后我们将创建一个名为ghost的用户，密码为<a class="ae jd" href="http://twitter.com/ghost3spookY" rel="noopener ugc nofollow" target="_blank">@ ghost 3 ghost</a>。选择你想要的密码。我们将授予该用户所有权限。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="2a79" class="jz ka hh jv b fi kb kc l kd ke"># mysql&gt; CREATE USER ‘ghost’@’localhost’ IDENTIFIED BY ‘<a class="ae jd" href="http://twitter.com/ghost3spookY" rel="noopener ugc nofollow" target="_blank">@ghost3spookY</a>’;<br/># mysql&gt; GRANT ALL PRIVILEGES ON *.* TO ‘ghost’@’localhost’ WITH GRANT OPTION;</span></pre><p id="6eac" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，ghost是为稍微旧一点的MySQL版本创建的，但他们已经改变了一些访问MySQL的方式，但我们可以通过以下方式再次启用旧方式。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="d3f0" class="jz ka hh jv b fi kb kc l kd ke"># mysql&gt; ALTER USER ‘root’@’localhost’ IDENTIFIED WITH mysql_native_password BY ‘<a class="ae jd" href="http://twitter.com/SecretPassword2" rel="noopener ugc nofollow" target="_blank">@SecretPassword2</a>’;<br/># mysql&gt; ALTER USER ‘ghost’@’localhost’ IDENTIFIED WITH mysql_native_password BY ‘<a class="ae jd" href="http://twitter.com/ghost3spookY" rel="noopener ugc nofollow" target="_blank">@ghost3spookY</a>’;</span></pre><p id="01bd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">之后，我们将从MySQL shell中注销。使用新用户登录，并为ghost创建一个新数据库。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="3b06" class="jz ka hh jv b fi kb kc l kd ke"># mysql&gt; \q<br/># mysql -u ghost -p<br/># mysql&gt; CREATE DATABASE ghost_blog;<br/># mysql&gt; \q</span></pre><h1 id="7bba" class="kf ka hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">《人鬼情未了》</h1><p id="3455" class="pw-post-body-paragraph ie if hh ig b ih lc ij ik il ld in io ip le ir is it lf iv iw ix lg iz ja jb ha bi translated">是时候安装Ghost了，为此我们需要ghost-cli，我们可以这样安装</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="2216" class="jz ka hh jv b fi kb kc l kd ke"># npm install -g ghost-cli</span></pre><p id="eb31" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">由于ghost-cli不支持CentOS官方，我通常做一点黑客，使其与CentOS的工作。为了让它正常工作，我们将编辑一个ghost-cli文件。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="ed46" class="jz ka hh jv b fi kb kc l kd ke"># vi .nvm/versions/node/v10.15.1/lib/node_modules/ghost-cli/extensions/systemd/systemd.js</span></pre><p id="fa5b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">找到下面几行</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="0167" class="jz ka hh jv b fi kb kc l kd ke">isRunning() {<br/> return this.ui.sudo(`systemctl is-active ${this.systemdName}`)<br/> .then(() =&gt; true)<br/> .catch((error) =&gt; {<br/> // Systemd prints out “inactive” if service isn’t running<br/> // or “activating” if service hasn’t completely started yet<br/> if (error.stdout &amp;&amp; error.stdout.match(/inactive|activating/)) {</span></pre><p id="e387" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在上面的最后一行，您可以看到inactive|activating，我们将在这里添加<strong class="ig hi"> `|unknown` </strong>,所以看起来像这样</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="6210" class="jz ka hh jv b fi kb kc l kd ke">if (error.stdout &amp;&amp; error.stdout.match(/inactive|activating|unknown/))</span></pre><p id="12af" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">保存并退出。不幸的是，每次更新ghost-cli时，您都需要重复这一操作。</p><p id="7328" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Ghost cli创建了一个新用户，我们需要让这个新用户访问您希望安装Ghost的文件夹。因此，我们将更改该文件夹的权限。在我的例子中，我将ghost安装在当前用户的主文件夹中的一个新文件夹中。因此，我们将更改主文件夹的权限，以便ghost用户可以访问它。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="6715" class="jz ka hh jv b fi kb kc l kd ke"># sudo chmod 755 /home/toor</span></pre><p id="ee0d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来创建一个安装ghost的文件夹。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="3154" class="jz ka hh jv b fi kb kc l kd ke"># mkdir ghost &amp;&amp; cd ghost<br/># ghost install</span></pre><p id="9edf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Ghost-cli会抱怨你不在Ubuntu上，只要说是，然后继续，回答下面的所有问题，并匹配MySQL安装中使用的密码、用户和数据库，以及你网站的任何url。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="5a26" class="jz ka hh jv b fi kb kc l kd ke">? Enter your blog URL: <a class="ae jd" href="https://myghostblog.com" rel="noopener ugc nofollow" target="_blank">https://myghostblog.com</a><br/>? Enter your MySQL hostname: localhost<br/>? Enter your MySQL username: ghost<br/>? Enter your MySQL password: [hidden]<br/>? Enter your Ghost database name: ghost_blog<br/>? Sudo Password [hidden]<br/>? Do you wish to set up “ghost” mysql user? No<br/>? Do you wish to set up Nginx? No<br/>? Do you wish to set up Systemd? Yes<br/>? Do you want to start Ghost? No</span></pre><p id="3afd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">搞定了。安装了Ghost。但是在我们开始之前，我们需要设置防火墙，SELinux和NGINX。我们还将获得一个证书，这样我们就可以使用HTTPS和HTTP/2.0来访问博客。<br/>在防火墙中，我们希望打开http的默认端口80和HTTPS的默认端口443，我们还希望将HTTP和https协议添加到防火墙中。执行以下命令，检查结果是否类似于下面的结果。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="7aca" class="jz ka hh jv b fi kb kc l kd ke"># sudo firewall-cmd --state<br/>running</span><span id="1073" class="jz ka hh jv b fi lh kc l kd ke"># sudo firewall-cmd --get-default-zone<br/>public</span><span id="caac" class="jz ka hh jv b fi lh kc l kd ke"># sudo firewall-cmd --get-active-zones<br/>public<br/> interfaces: eth0</span><span id="476c" class="jz ka hh jv b fi lh kc l kd ke"># sudo firewall-cmd --list-all<br/>public (active)<br/> target: default<br/> icmp-block-inversion: no<br/> interfaces: eth0<br/> sources: <br/> services: ssh dhcpv6-client<br/> ports: 2244/tcp<br/> protocols: <br/> masquerade: no<br/> forward-ports: <br/> source-ports: <br/> icmp-blocks: <br/> rich rules:</span><span id="0194" class="jz ka hh jv b fi lh kc l kd ke"># sudo firewall-cmd --zone=public --permanent --add-service=http<br/>success</span><span id="25fd" class="jz ka hh jv b fi lh kc l kd ke"># sudo firewall-cmd --zone=public --permanent --add-service=https<br/>success</span><span id="35c4" class="jz ka hh jv b fi lh kc l kd ke"># sudo firewall-cmd --zone=public --permanent --add-port=80/tcp<br/>success</span><span id="5dd1" class="jz ka hh jv b fi lh kc l kd ke"># sudo firewall-cmd --zone=public --permanent --add-port=443/tcp<br/>success</span><span id="8712" class="jz ka hh jv b fi lh kc l kd ke"># sudo firewall-cmd --reload<br/>success</span><span id="6b6c" class="jz ka hh jv b fi lh kc l kd ke"># sudo firewall-cmd --list-all<br/>public (active)<br/> target: default<br/> icmp-block-inversion: no<br/> interfaces: eth0<br/> sources:<br/> services: ssh dhcpv6-client http https<br/> ports: 2244/tcp 80/tcp 443/tcp<br/> protocols:<br/> masquerade: no<br/> forward-ports:<br/> source-ports:<br/> icmp-blocks:<br/> rich rules:<br/>```</span></pre><p id="01a9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">就这样，防火墙准备好了。</p><h1 id="9e7f" class="kf ka hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">让我们加密&amp; Certbot</h1><p id="ad59" class="pw-post-body-paragraph ie if hh ig b ih lc ij ik il ld in io ip le ir is it lf iv iw ix lg iz ja jb ha bi translated">在本教程中，我将使用“让我们加密”来获得网站的免费证书，以便与HTTPS一起使用，但显然你可以使用任何你想要的提供商。以下两个命令将在您的服务器上安装certbot。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="a2c4" class="jz ka hh jv b fi kb kc l kd ke"># sudo yum install epel-release<br/># sudo yum install certbot-nginx</span></pre><p id="c17c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，我们将为该服务器所连接的域以及您希望您的博客所在的位置申请一个证书。在这一步中，我希望你已经有了一个域，并且它连接到你当前连接的droplet。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="a92c" class="jz ka hh jv b fi kb kc l kd ke"># sudo certbot certonly</span></pre><p id="9c96" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里你有三个选择，我通常选择:启动临时网络服务器。填写您和您的域名的所有信息。如果一切顺利，您将会收到一条很长的成功消息以及证书的安装位置。</p><h1 id="765a" class="kf ka hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">NGINX</h1><p id="2984" class="pw-post-body-paragraph ie if hh ig b ih lc ij ik il ld in io ip le ir is it lf iv iw ix lg iz ja jb ha bi translated">现在是时候安装NGINX了，设置它通过HTTP/2.0为你的ghost博客服务，默认情况下包括HTTPS，我们会将所有正常的HTTP流量重定向到HTTPS。<br/> Yum中没有NGINX repo，所以我们将从添加一个新的repofile开始，就像这样</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="9418" class="jz ka hh jv b fi kb kc l kd ke"># sudo vi /etc/yum.repos.d/nginx.repo</span></pre><p id="2a86" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">并将以下文本粘贴到文件中。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="ce96" class="jz ka hh jv b fi kb kc l kd ke">[nginx]<br/>name=nginx repo<br/>baseurl=<a class="ae jd" href="http://nginx.org/packages/centos/$releasever/$basearch/" rel="noopener ugc nofollow" target="_blank">http://nginx.org/packages/centos/$releasever/$basearch/</a><br/>gpgcheck=0<br/>enabled=1</span></pre><p id="cdc3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">保存并退出，然后安装nginx。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="effa" class="jz ka hh jv b fi kb kc l kd ke"># sudo yum install nginx<br/># sudo systemctl status nginx</span></pre><p id="c9e7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们还没有启动NGINX，所以状态应该是不活动的。然后我们将编辑nginx配置文件。我们想做的是将允许的文件上传大小的最小值更改为50mb，默认值为2mb，这样你就可以上传大于2mb的照片或文件到你的博客。然后，我们将为https添加一些设置，以使用哪些协议和密码。最后三行是为了激活一些缓存，这样你的博客可以得到更快的服务。注意任何重复的行。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="d2fa" class="jz ka hh jv b fi kb kc l kd ke"># sudo vi /etc/nginx/nginx.conf</span></pre><p id="6e95" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在带有`<strong class="ig hi"> #gzip on的行后添加以下内容；</strong>`</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="6b2e" class="jz ka hh jv b fi kb kc l kd ke">client_max_body_size 50M;</span><span id="86e7" class="jz ka hh jv b fi lh kc l kd ke"> ssl_session_cache shared:SSL:10m;<br/> ssl_session_timeout 10m;<br/> # Forward secrecy settings<br/> ssl_protocols TLSv1.2 TLSv1.3;<br/> ssl_prefer_server_ciphers on;<br/> ssl_ciphers “EECDH+ECDSA+AESGCM EECDH+aRSA+AESGCM EECDH+ECDSA+SHA384 EECDH+ECDSA+SHA256 EECDH+aRSA+SHA384 EECDH+aRSA<br/>+SHA256 EECDH+aRSA+RC4 EECDH EDH+aRSA RC4 !aNULL !eNULL !LOW !3DES !MD5 !EXP !PSK !SRP !DSS !RC4”;</span><span id="7de0" class="jz ka hh jv b fi lh kc l kd ke">ssl_stapling on;<br/>ssl_stapling_verify on;</span><span id="45fe" class="jz ka hh jv b fi lh kc l kd ke">include /etc/nginx/conf.d/*.conf;</span><span id="0982" class="jz ka hh jv b fi lh kc l kd ke">server {<br/> listen 127.0.0.1;<br/> server_name localhost;<br/>}</span><span id="76c7" class="jz ka hh jv b fi lh kc l kd ke">proxy_cache_path /home/toor/ghostcache levels=1:2 keys_zone=ghostcache:60m max_size=300m inactive=24h;<br/> proxy_cache_key “$scheme$request_method$host$request_uri”;<br/> proxy_cache_methods GET HEAD;</span></pre><p id="94c0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">保存退出</p><p id="dc1d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，我们将添加一个专门针对您要使用的域的配置文件，我在这里将其命名为“myghostblog.com”。想叫什么名字就叫什么名字。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="1448" class="jz ka hh jv b fi kb kc l kd ke"># sudo vi /etc/nginx/conf.d/myghostblog.com.conf</span></pre><p id="73d8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你在下面看到的是我在我的域名上使用的设置。我主要是定义应该在端口443 (https)上发生的一切，最后，我将端口80 (http)上的任何请求重定向到端口443。Ghost通常运行在端口2368上，因为它运行在这个服务器上，所以我们会告诉NGINX将任何请求指向<a class="ae jd" href="http://127.0.0.1:2368" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:2368 </a>，如果您使用不同的端口，只需在下面两个地方更改到该端口。</p><p id="70f2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后您可以看到ssl_certificate和…_key，它们是在certbot步骤中创建的密钥。将正确的文件位置放在下面。我们将再次为https指定一些密码和协议。</p><p id="aeb4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，在从位置开始的4个部分中，我们设置了一些缓存、一些响应头和物理文件位置，用于在服务器上提供一些博客内容。</p><p id="4a8d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，复制并粘贴以下部分与你的变化。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="3f83" class="jz ka hh jv b fi kb kc l kd ke">limit_req_zone $binary_remote_addr zone=one:10m rate=1r/s;<br/>server {<br/> listen 443 ssl http2;<br/> listen [::]:443 ipv6only=on ssl http2;</span><span id="bd7f" class="jz ka hh jv b fi lh kc l kd ke"> gzip off;</span><span id="61a7" class="jz ka hh jv b fi lh kc l kd ke"> server_name myghostblog.com;</span><span id="e58e" class="jz ka hh jv b fi lh kc l kd ke"> ssl_certificate /etc/letsencrypt/live/myghostblog.com/fullchain.pem;<br/> ssl_certificate_key /etc/letsencrypt/live/myghostblog.com/privkey.pem;<br/> ssl_dhparam /etc/nginx/ssl/dhparam.pem;<br/> ssl_ciphers “EECDH+ECDSA+AESGCM EECDH+aRSA+AESGCM EECDH+ECDSA+SHA384 EECDH+ECDSA+SHA256 EECDH+aRSA+SHA384 EECDH+aRSA+SHA256 EECDH+aRSA+RC4 EECDH EDH+aRSA RC4 !aNULL !eNULL !LOW !3DES !MD5 !EXP !PSK !SRP !DSS !RC4”;<br/> ssl_protocols TLSv1.2 TLSv1.3;</span><span id="64a9" class="jz ka hh jv b fi lh kc l kd ke"> add_header Strict-Transport-Security max-age=31536000;<br/> add_header X-Frame-Options SAMEORIGIN;</span><span id="00ae" class="jz ka hh jv b fi lh kc l kd ke">location / {<br/> proxy_cache ghostcache;<br/> proxy_cache_valid 60m;<br/> proxy_cache_valid 404 1m;<br/> proxy_cache_bypass $http_cache_control;<br/> proxy_ignore_headers Set-Cookie;<br/> proxy_hide_header Set-Cookie;<br/> proxy_cache_use_stale error timeout invalid_header updating http_500 http_502 http_503 http_504;<br/> proxy_ignore_headers Cache-Control;<br/> add_header X-Cache-Status $upstream_cache_status;</span><span id="9746" class="jz ka hh jv b fi lh kc l kd ke">limit_req zone=one burst=20 nodelay;<br/> proxy_pass <a class="ae jd" href="http://127.0.0.1:2368" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:2368</a>;<br/> proxy_set_header Host $http_host;<br/> proxy_set_header X-Real-IP $remote_addr;<br/> proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br/> proxy_set_header X-Forwarded-Proto $scheme;<br/> proxy_buffering off;<br/>}</span><span id="abba" class="jz ka hh jv b fi lh kc l kd ke">location ^~ /assets/ {<br/> root /home/toor/ghost/content/themes/casper;<br/>}</span><span id="f581" class="jz ka hh jv b fi lh kc l kd ke">location ^~ /content/images/ {<br/> root /home/toor/ghost;<br/>}</span><span id="bf4b" class="jz ka hh jv b fi lh kc l kd ke">location ^~ /ghost/ {<br/> proxy_set_header Host $http_host;<br/> proxy_set_header X-Real-IP $remote_addr;<br/> proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;<br/> proxy_set_header X-Forwarded-Proto $scheme;<br/> proxy_pass <a class="ae jd" href="http://127.0.0.1:2368" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:2368</a>;<br/> }<br/>}</span><span id="6c08" class="jz ka hh jv b fi lh kc l kd ke">server {<br/> listen 80;<br/> listen [::]:80 ipv6only=on;<br/> server_name myghostblog.com;<br/> return 301 <a class="ae jd" href="https://$server_name$request_uri" rel="noopener ugc nofollow" target="_blank">https://$server_name$request_uri</a>;<br/>}</span></pre><p id="ba2b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后保存退出。</p><p id="3f9d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在上面的文件中，您可能已经看到了一个名为dhparam.pem的文件的链接。这是一个额外的证书，用于增加https上的安全性，我们需要创建它，可以通过以下两个步骤来完成。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="d745" class="jz ka hh jv b fi kb kc l kd ke"># sudo mkdir /etc/nginx/ssl<br/># sudo openssl dhparam -out /etc/nginx/ssl/dhparam.pem 4096</span></pre><p id="8ebe" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这可能需要一段时间，所以去拿点喝的。<br/>完成后，我们还需要创建我们上面指定的缓存文件夹。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="bcd4" class="jz ka hh jv b fi kb kc l kd ke"># sudo mkdir /home/toor/ghostcache</span></pre><p id="c751" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">搞定了。现在我们要检查所有接下来的NGINX配置是否正确。只需键入nginx -t，-t用于测试。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="8fd7" class="jz ka hh jv b fi kb kc l kd ke"># sudo nginx -t</span></pre><p id="b378" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">希望能够输出</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="f190" class="jz ka hh jv b fi kb kc l kd ke">nginx: the configuration file /etc/nginx/nginx.conf syntax is ok<br/>nginx: configuration file /etc/nginx/nginx.conf test is successful</span></pre><p id="b607" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这时你可以尝试启动NGINX，但是很可能会失败。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="40d6" class="jz ka hh jv b fi kb kc l kd ke"># sudo systemctl start nginx</span><span id="cd12" class="jz ka hh jv b fi lh kc l kd ke">Job for nginx.service failed because a configured resource limit was exceeded. See “systemctl status nginx.service” and “journalctl -xe” for details.</span></pre><p id="74d4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">检查NGINX状态以找到问题。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="519c" class="jz ka hh jv b fi kb kc l kd ke"># sudo systemctl status nginx.service</span><span id="ee32" class="jz ka hh jv b fi lh kc l kd ke">● nginx.service — nginx — high performance web server<br/> Loaded: loaded (/usr/lib/systemd/system/nginx.service; disabled; vendor preset: disabled)<br/> Active: failed (Result: resources) since Wed 2019–02–13 11:59:42 UTC; 19s ago<br/> Docs: <a class="ae jd" href="http://nginx.org/en/docs/" rel="noopener ugc nofollow" target="_blank">http://nginx.org/en/docs/</a><br/> Process: 28161 ExecStart=/usr/sbin/nginx -c /etc/nginx/nginx.conf (code=exited, status=0/SUCCESS)</span><span id="cfdf" class="jz ka hh jv b fi lh kc l kd ke">Feb 13 11:59:41 temp-test systemd[1]: Starting nginx — high performance web server…<br/>Feb 13 11:59:42 temp-test nginx[28161]: nginx: [emerg] open() “/var/run/nginx.pid” failed (13: Permission denied)<br/>Feb 13 11:59:42 temp-test systemd[1]: Failed to read PID from file /var/run/nginx.pid: Invalid argument<br/>Feb 13 11:59:42 temp-test systemd[1]: Failed to start nginx — high performance web server.<br/>Feb 13 11:59:42 temp-test systemd[1]: Unit nginx.service entered failed state.<br/>Feb 13 11:59:42 temp-test systemd[1]: nginx.service failed.</span><span id="4b3e" class="jz ka hh jv b fi lh kc l kd ke">selinux and nginx problem: nginx: [emerg] open() “/var/run/nginx.pid” failed (13: Permission denied)</span></pre><p id="f8ab" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你可以看到SELinux正在阻止NGINX，所以我们需要让SELinux知道NGINX很酷。为此，我们需要安装policycoreutils-devel并允许NGINX运行。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="d5f5" class="jz ka hh jv b fi kb kc l kd ke"># sudo yum install -y policycoreutils-devel<br/># sudo grep nginx /var/log/audit/audit.log | audit2allow -M nginx<br/># sudo semodule -i nginx.pp</span></pre><p id="d375" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">再次尝试启动NGINX。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="474c" class="jz ka hh jv b fi kb kc l kd ke"># sudo systemctl start nginx<br/># sudo systemctl status nginx.service</span><span id="1f2b" class="jz ka hh jv b fi lh kc l kd ke">● nginx.service — nginx — high performance web server<br/> Loaded: loaded (/usr/lib/systemd/system/nginx.service; disabled; vendor preset: disabled)<br/> Active: active (running) since Wed 2019–02–13 12:05:49 UTC; 5s ago<br/> Docs: <a class="ae jd" href="http://nginx.org/en/docs/" rel="noopener ugc nofollow" target="_blank">http://nginx.org/en/docs/</a><br/> Process: 28917 ExecStart=/usr/sbin/nginx -c /etc/nginx/nginx.conf (code=exited, status=0/SUCCESS)<br/> Main PID: 28918 (nginx)<br/> CGroup: /system.slice/nginx.service<br/> ├─28918 nginx: master process /usr/sbin/nginx -c /etc/nginx/nginx.conf<br/> ├─28919 nginx: worker process<br/> ├─28920 nginx: cache manager process<br/> └─28921 nginx: cache loader process</span><span id="446b" class="jz ka hh jv b fi lh kc l kd ke">Feb 13 12:05:49 temp-test systemd[1]: Starting nginx — high performance web server…<br/>Feb 13 12:05:49 temp-test systemd[1]: PID file /var/run/nginx.pid not readable (yet?) after start.<br/>Feb 13 12:05:49 temp-test systemd[1]: Started nginx — high performance web server.</span></pre><p id="6f4c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在nginx正在运行。尝试访问您的域名！</p><p id="b835" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">它应该向您显示502错误网关错误，因为我们还没有启动ghost。但在此之前，我们需要允许http使用ghost在SELinux中使用的端口。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="3896" class="jz ka hh jv b fi kb kc l kd ke"># sudo semanage port --add --type http_port_t --proto tcp 2368</span></pre><p id="b248" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们还需要允许nginx直接服务文件，并允许它缓存文件，这也是我们需要告诉SELinux的。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="f9de" class="jz ka hh jv b fi kb kc l kd ke"># sudo chcon -R -t httpd_sys_content_t /home/toor/ghost</span></pre><p id="6dcb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，让我们开始鬼。</p><pre class="jf jg jh ji fd ju jv jw jx aw jy bi"><span id="786b" class="jz ka hh jv b fi kb kc l kd ke"># cd ghost<br/># ghost start</span></pre><p id="39b2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">再次访问您的域名！</p><p id="ae7f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我知道你是否喜欢这个教程。</p></div></div>    
</body>
</html>