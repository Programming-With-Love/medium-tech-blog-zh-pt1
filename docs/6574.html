<html>
<head>
<title>How to Build a simple REST API: Introduction to NodeJS and Express.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何构建一个简单的REST API:NodeJS和Express简介？</h1>
<blockquote>原文：<a href="https://medium.com/quick-code/building-a-simple-rest-api-introduction-to-nodejs-and-express-fc25daf57baf?source=collection_archive---------2-----------------------#2019-02-18">https://medium.com/quick-code/building-a-simple-rest-api-introduction-to-nodejs-and-express-fc25daf57baf?source=collection_archive---------2-----------------------#2019-02-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/7ac00ae084e41c6b7febc6566bd2bf5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jw9V__6jYhm2amP74D_0lw.png"/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx">The image is taken from Wikipedia.</figcaption></figure><div class=""/><p id="855c" class="pw-post-body-paragraph it iu hw iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">你曾经想了解更多关于后端开发过程的知识吗？如果你有构建前端应用的经验，这里是一个很好的起点。您将发现如何使用相同的技术堆栈来构建服务器。如果您已经有了使用其他框架开发API的经验，您将在这里了解到使用NodeJS和Express开发<strong class="iv hx">和部署<strong class="iv hx"/>有多快多容易。</strong></p><p id="be4f" class="pw-post-body-paragraph it iu hw iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">本质上，Node是一个Javascript运行时环境，与Chrome engine(迄今最快的JS引擎)构建在同一引擎上。Node的非阻塞或异步特性使其成为构建I/O密集型应用程序的理想选择。</p><h1 id="2a35" class="jr js hw bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">入门指南</h1><p id="da69" class="pw-post-body-paragraph it iu hw iv b iw kp iy iz ja kq jc jd je kr jg jh ji ks jk jl jm kt jo jp jq ha bi translated">首先，前往https://nodejs.org/en/<a class="ae ku" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">下载NodeJS的最新稳定版本。在计算机上安装了应用程序后，请检查安装的版本:</a></p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="2b44" class="le js hw la b fi lf lg l lh li">node -v</span><span id="6dff" class="le js hw la b fi lj lg l lh li">npm -v</span></pre><h1 id="ffdc" class="jr js hw bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">初始化应用程序</h1><p id="5b2e" class="pw-post-body-paragraph it iu hw iv b iw kp iy iz ja kq jc jd je kr jg jh ji ks jk jl jm kt jo jp jq ha bi translated">有多种方法来初始化一个应用程序，但是在本教程中，我将使用最简单的方法。<br/>我们先新建一个文件夹myapp，新建一个文件index.js:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="519e" class="le js hw la b fi lf lg l lh li">$ mkdir myapp<br/>$ cd myapp<br/>$ touch index.js</span></pre><p id="ee67" class="pw-post-body-paragraph it iu hw iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">要进行初始化，请运行以下命令:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="5442" class="le js hw la b fi lf lg l lh li">$ npm init --yes</span></pre><p id="cabe" class="pw-post-body-paragraph it iu hw iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><code class="du lk ll lm la b">yes</code>标志用于输入所有问题的默认值。命令输出将如下所示:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="160c" class="le js hw la b fi lf lg l lh li">{</span><span id="8a21" class="le js hw la b fi lj lg l lh li">"name": "myapp",</span><span id="3e1e" class="le js hw la b fi lj lg l lh li">"version": "1.0.0",</span><span id="5b3f" class="le js hw la b fi lj lg l lh li">"description": "",</span><span id="ee49" class="le js hw la b fi lj lg l lh li">"main": "index.js",</span><span id="1a02" class="le js hw la b fi lj lg l lh li">"scripts": {</span><span id="e5aa" class="le js hw la b fi lj lg l lh li">"test": "echo \"Error: no test specified\" &amp;&amp; exit 1"</span><span id="886f" class="le js hw la b fi lj lg l lh li">},</span><span id="aede" class="le js hw la b fi lj lg l lh li">"keywords": [],</span><span id="a49a" class="le js hw la b fi lj lg l lh li">"author": "",</span><span id="fb22" class="le js hw la b fi lj lg l lh li">"license": "ISC"</span><span id="a5fd" class="le js hw la b fi lj lg l lh li">}</span></pre><p id="f5d0" class="pw-post-body-paragraph it iu hw iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">从输出中可以看到，主要的入口点是<code class="du lk ll lm la b">index.js</code>。这些只是名字，你不应该太在意。</p><h1 id="dd4f" class="jr js hw bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">安装依赖项</h1><p id="49e8" class="pw-post-body-paragraph it iu hw iv b iw kp iy iz ja kq jc jd je kr jg jh ji ks jk jl jm kt jo jp jq ha bi translated">让我们安装express和一些我通常使用的有用模块。</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="240e" class="le js hw la b fi lf lg l lh li">npm i express morgan debug multer serve-index</span></pre><p id="1510" class="pw-post-body-paragraph it iu hw iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><em class="ln">还有其他有用的模块在本教程中不会用到，但我会在下面列出来供您参考。一些安装的模块在本教程中没有用到，但是GitHub gist提供了参考。包括它们以避免编译错误。</em></p><p id="073f" class="pw-post-body-paragraph it iu hw iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">让我们打开我们创建的<code class="du lk ll lm la b">index.js</code>文件，并添加以下代码:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="b18a" class="le js hw la b fi lf lg l lh li"><em class="ln">const</em> express = require('express');<br/><em class="ln">const</em> app = express();<br/><em class="ln">const</em> port = process.env.PORT || 3000;</span><span id="fc7c" class="le js hw la b fi lj lg l lh li">app.listen(port, () <em class="ln">=&gt;</em> {<br/> <em class="ln">console</em>.log('Server is up and running on port ', port);<br/>})</span></pre><h1 id="1d82" class="jr js hw bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">运行和配置应用程序</h1><p id="3d55" class="pw-post-body-paragraph it iu hw iv b iw kp iy iz ja kq jc jd je kr jg jh ji ks jk jl jm kt jo jp jq ha bi translated">恭喜你。您已经创建了您的第一个express服务器！它将从环境变量(如果可用)或3000监听端口。让我们像这样运行应用程序:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="7490" class="le js hw la b fi lf lg l lh li">$ node index.js<br/>Server is up and running on port 3000</span></pre></div><div class="ab cl lo lp go lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ha hb hc hd he"><h2 id="ba0e" class="le js hw bd jt lv lw lx jx ly lz ma kb je mb mc kf ji md me kj jm mf mg kn mh bi translated">调试模块</h2><p id="e3ea" class="pw-post-body-paragraph it iu hw iv b iw kp iy iz ja kq jc jd je kr jg jh ji ks jk jl jm kt jo jp jq ha bi translated">现在，让我们介绍一个<code class="du lk ll lm la b">debug</code>模块。正如你所看到的，当前的<code class="du lk ll lm la b">console.log</code>只是打印了一个简单的行。对于简单的应用程序来说，这可能是可以接受的，但是当您的应用程序扩展时，在各种日志之间进行一些区分是有好处的。<br/>编辑<code class="du lk ll lm la b">index.js</code>:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="7328" class="le js hw la b fi lf lg l lh li"><em class="ln">const</em> express = require('express');<br/><em class="ln">const</em> app = express();<br/><em class="ln">const</em> debug = require('debug')('myapp:server');</span><span id="b9c0" class="le js hw la b fi lj lg l lh li"><em class="ln">const</em> port = process.env.PORT || 3000;</span><span id="05ee" class="le js hw la b fi lj lg l lh li">app.listen(port, () <em class="ln">=&gt;</em> {<br/> debug('Server is up and running on port ', port);<br/>})</span></pre><p id="b89f" class="pw-post-body-paragraph it iu hw iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">它的作用是我们获得调试函数并传入模块名<code class="du lk ll lm la b">myapp:server</code>。<code class="du lk ll lm la b">DEBUG</code>然后使用环境变量来切换不同的名称空间。让我们试一试:</p><figure class="kv kw kx ky fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mi"><img src="../Images/60151f0fb15e3230c873bc2b5b9bc698.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DympJNElcGxFDX9TLVI-xA.png"/></div></div></figure><figure class="kv kw kx ky fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mj"><img src="../Images/608145db62ab4a6d4bc81ee540eeeeed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1KB5FwqAVydIoyjA-uF4kQ.png"/></div></div></figure><p id="f6f1" class="pw-post-body-paragraph it iu hw iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">你可以在这里看到，你得到了更多的视觉输出。这在查看日志时非常有用。您可以设置显示所有日志或仅显示某些命名空间。</p></div><div class="ab cl lo lp go lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ha hb hc hd he"><p id="ec91" class="pw-post-body-paragraph it iu hw iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">该应用程序现在可以在<a class="ae ku" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>访问，但当你试图访问它时，你会得到<code class="du lk ll lm la b">Cannot GET /</code>。这是因为我们没有在服务器上设置任何事件监听器。因此，让我们创建一些事件侦听器。</p><p id="1a94" class="pw-post-body-paragraph it iu hw iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">服务器将接收请求，处理请求并返回响应。请求有4种主要类型:GET用于检索数据，POST通常用于创建实体，PUT通常用于更新实体，DELETE通常用于删除实体。让我们创建一个简单的get请求:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="f111" class="le js hw la b fi lf lg l lh li">app.get('/', <em class="ln">function</em>(<em class="ln">req</em>,<em class="ln">res</em>) {<br/> return res.send("hello from my app express server!")<br/>})</span></pre><p id="a064" class="pw-post-body-paragraph it iu hw iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">如果你访问<a class="ae ku" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>，你现在会得到一个响应！</p><p id="c8cf" class="pw-post-body-paragraph it iu hw iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">现在让我们实现一些额外的功能，以便我们可以测试它。</p><figure class="kv kw kx ky fd hj"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="e06c" class="pw-post-body-paragraph it iu hw iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">因此，我们已经实现了所有4个主要方法。我已经在注释中给出了每种方法的作用。现在我们可以使用Postman来检查所有这些方法的工作情况。</p><figure class="kv kw kx ky fd hj"><div class="bz dy l di"><div class="mm ml l"/></div></figure><h1 id="56c7" class="jr js hw bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated"><strong class="ak">代码重构</strong></h1><p id="1f4f" class="pw-post-body-paragraph it iu hw iv b iw kp iy iz ja kq jc jd je kr jg jh ji ks jk jl jm kt jo jp jq ha bi translated">这就完成了工作，我们现在可以获得用户，更新他们的数据或删除他们。然而，这是完全不可伸缩的。在实际应用中，有多条路线，将所有这些放在单个<code class="du lk ll lm la b">index.js</code>文件中并不理想。让我们做一些重构，让我们所有人的生活更轻松。</p><p id="7a96" class="pw-post-body-paragraph it iu hw iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">返回主文件夹，执行以下操作:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="9c6c" class="le js hw la b fi lf lg l lh li">$ mkdir routes<br/>$ cd routes<br/>$ touch user.route.js</span></pre><figure class="kv kw kx ky fd hj"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="c86c" class="pw-post-body-paragraph it iu hw iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">将以下代码复制到新创建的文件中。在这里，我们创建一个路由器(迷你应用程序)，定义事件并将其导出以供其他地方使用。</p><figure class="kv kw kx ky fd hj"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="c098" class="pw-post-body-paragraph it iu hw iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">然后<code class="du lk ll lm la b">index.js</code>简化成上面的代码。这使得组织和维护代码库变得更加简单。虽然看起来不重要，但从长远来看，考虑可伸缩性或可维护性总是好的。</p></div><div class="ab cl lo lp go lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ha hb hc hd he"><h2 id="772b" class="le js hw bd jt lv lw lx jx ly lz ma kb je mb mc kf ji md me kj jm mf mg kn mh bi translated">HTTP日志模块</h2><p id="dd31" class="pw-post-body-paragraph it iu hw iv b iw kp iy iz ja kq jc jd je kr jg jh ji ks jk jl jm kt jo jp jq ha bi translated">在我们结束本教程之前，还记得我们安装了<code class="du lk ll lm la b">morgan</code>？这是一个用于NodeJS的HTTP日志中间件。本质上，它帮助我们记录所有的请求。我已经在上面的代码预览中包含了它。让我们运行应用程序并发出一些请求，您应该会看到类似这样的内容:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="1246" class="le js hw la b fi lf lg l lh li">node index.js<br/>GET /users/ 200 57 - 16.789 ms<br/>POST /users/ 200 85 - 0.739 ms<br/>PUT /users/1 200 85 - 0.590 ms<br/>DELETE /users/last 200 27 - 0.412 ms</span></pre><p id="d083" class="pw-post-body-paragraph it iu hw iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">关于您希望如何完成日志记录，有更多的选项。请随意查看完整的文档。</p></div><div class="ab cl lo lp go lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ha hb hc hd he"><p id="df7c" class="pw-post-body-paragraph it iu hw iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">我写下这个简单的教程是为了巩固我自己的学习，也是为了在这个过程中帮助别人。如果有人觉得这些有用，请随意分享或者让我知道是否有错误/不好的实践/实现。</p><p id="7129" class="pw-post-body-paragraph it iu hw iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">我将在NodeJS上创建另一个教程，包括认证、授权、将我们的服务器连接到MySQL / MongoDB、单元/集成测试以及最终部署。</p><p id="e11f" class="pw-post-body-paragraph it iu hw iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">祝编码愉快！</p></div></div>    
</body>
</html>