<html>
<head>
<title>How we brought Windows, IIS &amp; .NET Apps to Cloud at Walmart</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我们如何带来了Windows、IIS和。沃尔玛的云计算网络应用</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/how-we-brought-windows-iis-net-apps-to-cloud-at-walmart-54da624f2e8a?source=collection_archive---------3-----------------------#2018-09-13">https://medium.com/walmartglobaltech/how-we-brought-windows-iis-net-apps-to-cloud-at-walmart-54da624f2e8a?source=collection_archive---------3-----------------------#2018-09-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="b277" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">构建云原生应用有其独特的挑战，当您构建一个应该满足传统Windows &amp;需求的云平台时，这些挑战会变得更大。NET应用程序，它满足了全球最大组织之一的各种业务需求。</p><p id="9673" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi jc translated"><span class="l jd je jf bm jg jh ji jj jk di"> O </span> <em class="jl">目标:该团队的目标是帮助沃尔玛Windows/。NET应用程序，使他们的业务能够迁移到云。句号。</em></p><p id="6871" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi jc translated"><span class="l jd je jf bm jg jh ji jj jk di"> C </span>这些应用主要是。基于. NET/C#的Web应用程序，或者说Windows服务，具有消息传递和数据库层。它们部署并运行在不同的Windows场集群上，并且是手动管理的。有很多团队也在管理他们自己的基础设施。</p><p id="f1a7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">应用程序的任何部署和更新都是手动的，需要多步操作，应用程序所有者的访问权限有限，通常是通过许多服务请求单。</p><p id="8b85" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jl">现有的沃尔玛云基础设施无法供应基于Windows操作系统的虚拟机，因此IIS web服务器&amp;无法运行。基于. NET或Windows的云应用程序。</em></p><p id="f4af" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">好消息是，云和平台基础设施已经拥有了大部分平台服务，解决了云上基于Java/Linux的应用程序的云原生和交叉问题，只是它们不能被Windows和。NET应用程序。</p><p id="396b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jl">我们的解决方案构建方法。NET/Windows功能有两个主要的关注点:</em></p><p id="2db6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jl">首先:作为一个. NET云平台，首先让Windows OS ready computes&amp;IIS web服务器在沃尔玛云基础设施上可用。</em></p><p id="3768" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jl">第二:提供。NET中间件API供应用程序使用&amp;通过解决云上的应用程序交叉问题，帮助他们构建云原生应用程序。</em></p><p id="8b1a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jl">首先:</em> <strong class="ig hi"> <em class="jl"> </em> Windows OS，IIS Web服务器&amp;。NET运行时:</strong></p><p id="93c6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们通过构建OneOps(支持沃尔玛云的基础设施)包，使Windows server OS和IIS成为沃尔玛云中可用的web服务器映像，这些包能够选择、配置和部署不同的虚拟机大小和。NET框架和运行时。我们还让用户选择添加额外的应用程序特定的运行时间和依赖，使用通过Nexus服务器分发的Chocolatey包的驱动程序。</p><p id="6ed1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jl">第二:</em> <strong class="ig hi"> <em class="jl"> </em>解决云原生应用横切关注点:</strong></p><p id="bdca" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jl">我们的第二个目标是通过向应用所有者提供适当的云原生中间件API和服务来抽象云开发中面临的挑战&amp;顾虑，以便构建采用云的云原生应用&amp;变得更加容易。</em></p><p id="a8f1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在此过程中，我们研究了许多内部可用的云服务，并研究了它们的模式和实践。沃尔玛已经有了云文化和对云的关注，专家们正在为云构建平台和服务，主要是基于java和开源的技术。我们从他们那里采纳了一些实践(没有必要重新发明轮子)。我们进一步增强了它们，以提供独特的解决方案。NET和Windows环境。来自非Windows背景的专家经常对这些选择提出质疑。在这个过程中，帮助我们的是对我们的Windows客户、应用程序及其使用案例的理解。</p><p id="4c2d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">远程应用配置:</strong></p><p id="819b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jl">将配置与应用程序组件一起存储会产生更多开销，以防配置发生变化&amp;尤其是在环境动态变化的云中进行管理。配置更改需要传播到应用程序组件。</em></p><p id="2a2d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">传统上。NET应用程序将其配置设置存储在app.config或web.config的本地文件中，在云场景中，这需要远程管理或存储。我们支持现有的远程云配置管理服务。NET应用程序。NET中间件API。我们还将它与本地配置文件集成在一起，当应用程序所有者希望这样做或远程配置服务不再可用时，应用程序可以覆盖它。远程服务器的任何配置更改都将通过。NET事件供应用程序更新它。将配置从本地服务器转移到远程服务器是一种范式转变，当我们将这种能力带给应用程序所有者时，他们看不到其中的价值。然而，当我们用用例向他们展示示例时，他们采用了它。</p><p id="31cf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">应用日志管理:</strong></p><p id="55a5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jl">应用程序日志是从所有正在运行的进程的输出流中收集的聚合的、按时间顺序排列的事件流。每个正在运行的进程都写入其事件流，该事件流将事件路由到stdout。</em></p><p id="b237" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">基于本地文件的日志记录在云中不起作用&amp;日志需要远程管理。在沃尔玛，我们已经有了基于Kafka的记录和监控平台。通过为. NET开发Kafka传输层，我们编写了一个具有标准调试、信息、错误消息的新日志客户端。我们意识到许多团队已经在使用流行的Log4Net API，我们告诉他们转移到新的日志API和库是徒劳的。我们通过编写Log4Net appender使这个过程无缝。我们还通过使用Gray log cluster pack提供了对日志管理的完全控制，应用程序可以根据需要进行部署和配置。我们通过编写新的C# Graylog传输来增强我们的日志API。这使得应用程序能够使用远程配置动态地在它们的日志记录选项之间切换。</p><p id="ace8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们还利用Windows事件跟踪为大量日志事件提供了更强大的进程外日志记录解决方案。</p><p id="0298" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">云消息基础设施:</strong></p><p id="769f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jl">分布式应用程序的应用程序组件托管在多个站点上，必须相互交换信息，消息传递基础设施支持异步操作，使您能够将使用服务的流程与实现服务的流程分离开来。</em></p><p id="1ee6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在沃尔玛，应用程序根据其需求和专业知识使用各种消息平台，如IBM MQ、Active MQ、TIBCO等。在中提供一个云就绪的统一API并不是一件容易的事情。在java中，你有标准的JMS规范，但是在。NET提供了一个跨多个消息传递提供者的公共API。我们研究了像AMQP这样的标准，但是它没有提供流行消息供应商的全部功能。我们为。NET，它是根据我们的需求定制的，适合云场景，比如跨代理集群发送消息、负载平衡、远程配置等。</p><p id="dd18" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">身份和访问管理:</strong></p><p id="5240" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jl"> IAM旨在通过将认证委托给外部身份提供者来改善应用程序的用户体验。它还最大限度地减少了对用户管理的需求。</em></p><p id="9062" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在Walmart应用程序中，使用各种解决方案来满足他们的认证/授权需求。传统上，身份存储在各种active directory部署中，我们也有自己的SSO和身份服务。沃尔玛的客户可以从内部和外部访问许多应用程序。这是应用程序向云迁移的瓶颈之一，因为用于AuthN/AuthZ的现有解决方案是传统解决方案，不支持云。</p><p id="5f8d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们开发了可插入ASP.NET管道的OWIN中间件，以及抽象SSO(单点登录)和身份服务的ASP.NET身份提供商，为所有AuthZ需求提供异步API。我们确保身份服务路由并与Active directory对话，以获取存储在那里的身份。</p><p id="f0ba" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">应用缓存需求:</strong></p><p id="795e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jl">缓存旨在通过将频繁访问的数据临时复制到靠近应用程序的快速存储位置来提高系统的性能和可扩展性。</em></p><p id="4310" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们已经在沃尔玛数据中心部署了分布式缓存服务，这是基于McRouter的MemCache解决方案。我们启用了分布式缓存来。NET应用程序。NET API，因此我们避免给应用程序所有者提供新的缓存API。我们希望从内存缓存到分布式云专用缓存的过渡对于应用所有者来说是无缝的。</p><p id="a87e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">应用审计&amp;性能监控:</strong></p><p id="311b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jl">遥测解决方案收集并突出显示操作事件，降低应用管理成本，同时实时提供对应用行为的有用见解。</em></p><p id="e1a8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在沃尔玛，我们已经有了遥测平台来监控应用性能指标。然而，它只被Java应用程序使用。我们编写了集成Windows &amp;的C#中间件API。Net/ASP。NET特定性能计数器&amp;允许应用程序在基于Grafana的仪表板上实时可视化和监控它们的应用程序性能。它还允许应用程序根据预定义的性能阈值发送通知。</p><p id="22b2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">云采用&amp;利用率跟踪:</strong>跟踪云平台以及我们的API中间件的利用率对于了解云平台的采用情况非常重要。Utilization Platform和中间件能够收集运行时或云环境信息，并向我们使用ELK和Kibana dashboard构建的利用率服务发送pings。</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="er es jm"><img src="../Images/3b26df39806fb63da13aff079d5acf87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*osy44ZN1T5X7Nn5mO7iURA.png"/></div></div><figcaption class="jy jz et er es ka kb bd b be z dx">.NET Cloud Platform</figcaption></figure><p id="039a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">设计、质量&amp;持续集成:</strong>在我们开发任何中间件或服务之前。NET我们已经有了CI/CD渠道。我们确保为我们提供给客户的每个API编写足够的单元测试、系统测试和示例应用程序，此外，在每个sprint中还要进行多轮代码审查。在将中间件发布到nexus server之前，我们确保我们的CI管道有这些步骤，并且每个代码更改都运行所有这些测试案例。我们特别关注为每个中间件API生成的性能测试案例和报告。我们花了额外的精力来详细分析它们&amp;确保API不会对系统资源(内存、线程、IO等)产生任何不必要的影响。)以及消费应用程序的性能。我们充分利用API，或者调用任何由适当的云本地模式支持的异步远程服务，例如断路器、远程配置、服务注册等。</p><p id="d385" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们与客户(应用程序所有者、主管、架构师等)进行了交流。)尽可能经常。我们了解他们的使用案例、痛点和对我们的期望。</p><p id="ebff" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们为应用程序团队提供了足够的API文档、样本代码和演示，帮助他们重新设计应用程序，使其为云做好准备。</p></div></div>    
</body>
</html>