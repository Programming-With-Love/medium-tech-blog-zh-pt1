<html>
<head>
<title>Azure Messaging Services -How to Choose the Right Messaging Technology in Azure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Azure消息服务——如何在Azure中选择正确的消息技术</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/azure-messaging-services-how-to-choose-the-right-messaging-technology-in-azure-eab610b5e986?source=collection_archive---------0-----------------------#2020-10-16">https://medium.com/walmartglobaltech/azure-messaging-services-how-to-choose-the-right-messaging-technology-in-azure-eab610b5e986?source=collection_archive---------0-----------------------#2020-10-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="23dc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Microsoft Azure提供的消息服务的快速概述，以及选择最适合应用程序的指南</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/90a176cc755ba572606e1379bea1ca81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9PEz0_OwR0zWh-Qps74R1Q.jpeg"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Image by<a class="ae js" href="https://pixabay.com/users/geralt-9301/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=4610699" rel="noopener ugc nofollow" target="_blank"> Gerd Altman</a>n from <a class="ae js" href="https://pixabay.com/photos/away-feet-shoes-road-surface-4610699/" rel="noopener ugc nofollow" target="_blank">Pixabay</a></figcaption></figure><h1 id="e8ea" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak">为什么是信息传递？</strong></h1><p id="eb0e" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">高度可靠的消息传递系统使分布式微服务能够跨网络安全、异步地通信。消息传递系统允许松散耦合，这意味着发送方和接收方不需要同时在线。此外，发送方和接收方都可以按照自己的速度生产和消费，并随着工作负载的增加而横向扩展。</p><h1 id="a9b8" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak"> Azure短信服务</strong></h1><p id="317e" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">Azur提供各种消息服务。<strong class="ig hi">这些服务中的每一项都旨在服务于不同的用例，并且不会相互竞争</strong>。让我们了解一下这些服务:</p><h1 id="7122" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak"> 1。Azure存储队列</strong></h1><p id="5865" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">Azure存储队列是Azure存储帐户的一部分。它是一个简单、可靠、可伸缩和持久的消息队列服务。它遵循基于<em class="kw"> REST </em>的<em class="kw"> HTTP </em>动词，如<em class="kw"> GET </em>和<em class="kw"> PUT </em>来读取消息并将其插入队列。应用程序也可以使用<em class="kw"> PEEK </em>命令查看队列头的消息。</p><p id="ddc4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一个队列可以存储数百万条消息，最多可达一个存储帐户的总容量，其中每条消息最大为64 KB，最大TTL为7天。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kx"><img src="../Images/339797c5e091d539d918d54070e0c091.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CUJdr-oEdJHOJ4TI8jS5xg.png"/></div></div></figure><h2 id="498e" class="ky ju hh bd jv kz la lb jz lc ld le kd ip lf lg kh it lh li kl ix lj lk kp ll bi translated">1.1 Azure存储队列用例</h2><p id="c334" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">Azure Storage queue是一个简单的队列服务，可用于存储大量小型消息。它提供了一种从世界任何地方访问消息的安全方式。它可以用来创建异步处理的工作负载或任务，并且消息顺序保证不是必须的。</p><h1 id="f601" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak"> 2。Azure服务总线</strong></h1><p id="d5d5" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">Azure Service Bus是一个安全、高度可用和可靠的<a class="ae js" href="https://azure.microsoft.com/en-in/overview/what-is-paas/" rel="noopener ugc nofollow" target="_blank"> <em class="kw">平台即服务</em> </a> <em class="kw"> (PaaS) </em>企业集成消息代理，用于应用程序之间的异步数据传输。它支持<a class="ae js" href="https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol" rel="noopener ugc nofollow" target="_blank"> <em class="kw">高级消息队列协议</em> </a> <em class="kw"> (AMQP) </em>，这是一种基于TCP的高效、可靠的开放协议，使解决方案与供应商无关。开发人员可以使用不同的客户端库来连接到消息代理。</p><p id="2a0d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">发送方将消息发送到队列。成功复制消息后，队列发回ack回执。另一方面，接收方连接到队列以检索消息，并在完成处理后，发送回删除消息的ack。一条消息可以被移动到一个<a class="ae js" href="https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-dead-letter-queues" rel="noopener ugc nofollow" target="_blank"><em class="kw">【DLQ】</em></a>的死信队列中以丢弃或以后消费，以防出错。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lm"><img src="../Images/d51df477b51c9c647962b79184c5d719.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A-uoc3x5-_F6RUy7CyqOJA.png"/></div></div></figure><p id="994d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Azure服务总线支持各种<strong class="ig hi"> <em class="kw">高级排队操作</em> </strong>，一些关键的差异化功能包括:</p><ul class=""><li id="04a4" class="ln lo hh ig b ih ii il im ip lp it lq ix lr jb ls lt lu lv bi translated"><a class="ae js" href="https://docs.microsoft.com/en-us/azure/service-bus-messaging/message-sessions" rel="noopener ugc nofollow" target="_blank">消息会话</a></li><li id="6baf" class="ln lo hh ig b ih lw il lx ip ly it lz ix ma jb ls lt lu lv bi translated"><a class="ae js" href="https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-auto-forwarding" rel="noopener ugc nofollow" target="_blank">自动转发</a></li><li id="5325" class="ln lo hh ig b ih lw il lx ip ly it lz ix ma jb ls lt lu lv bi translated"><a class="ae js" href="https://docs.microsoft.com/en-us/azure/service-bus-messaging/message-sequencing#scheduled-messages" rel="noopener ugc nofollow" target="_blank">预定交货</a></li><li id="bda6" class="ln lo hh ig b ih lw il lx ip ly it lz ix ma jb ls lt lu lv bi translated"><a class="ae js" href="https://docs.microsoft.com/en-us/azure/service-bus-messaging/message-deferral" rel="noopener ugc nofollow" target="_blank">消息延期</a></li><li id="ee42" class="ln lo hh ig b ih lw il lx ip ly it lz ix ma jb ls lt lu lv bi translated"><a class="ae js" href="https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-performance-improvements#client-side-batching" rel="noopener ugc nofollow" target="_blank">配料</a></li><li id="c768" class="ln lo hh ig b ih lw il lx ip ly it lz ix ma jb ls lt lu lv bi translated"><a class="ae js" href="https://docs.microsoft.com/en-us/azure/service-bus-messaging/service-bus-transactions" rel="noopener ugc nofollow" target="_blank">交易</a></li><li id="b05e" class="ln lo hh ig b ih lw il lx ip ly it lz ix ma jb ls lt lu lv bi translated"><a class="ae js" href="https://docs.microsoft.com/en-us/azure/service-bus-messaging/topic-filters" rel="noopener ugc nofollow" target="_blank">过滤和操作</a></li><li id="7f7c" class="ln lo hh ig b ih lw il lx ip ly it lz ix ma jb ls lt lu lv bi translated"><a class="ae js" href="https://docs.microsoft.com/en-us/dotnet/api/microsoft.servicebus.messaging.queuedescription.autodeleteonidle" rel="noopener ugc nofollow" target="_blank">空闲时自动删除</a></li><li id="2a48" class="ln lo hh ig b ih lw il lx ip ly it lz ix ma jb ls lt lu lv bi translated"><a class="ae js" href="https://docs.microsoft.com/en-us/azure/service-bus-messaging/duplicate-detection" rel="noopener ugc nofollow" target="_blank">重复检测</a></li></ul><h2 id="277c" class="ky ju hh bd jv kz la lb jz lc ld le kd ip lf lg kh it lh li kl ix lj lk kp ll bi translated">2.1 Azure服务总线队列</h2><p id="804b" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">Azure服务总线队列是有序的、带时间戳的消息存储。它可以用于<em class="kw">点对点</em>通信，这意味着单个消息生产者与单个从队列中读取的接收者一起工作。消息以<em class="kw">拉模式(又名</em> <a class="ae js" href="https://docs.microsoft.com/en-us/azure/architecture/patterns/competing-consumers" rel="noopener ugc nofollow" target="_blank"> <em class="kw">竞争消费者模式</em> </a> <em class="kw"> ) </em>传递，消费者负责在消息被处理后<em class="kw">出列</em>以释放存储空间。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mb"><img src="../Images/64b928dc99176d9a1fa7bfb4df14ddcf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f9Ypo8XOHRHQZD2xKbpzlg.png"/></div></div></figure><h2 id="7cf2" class="ky ju hh bd jv kz la lb jz lc ld le kd ip lf lg kh it lh li kl ix lj lk kp ll bi translated">2.2 Azure服务总线主题</h2><p id="4c63" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">Azure服务总线主题在内部也是一个队列，但是它是为<em class="kw">点到多点</em>通信而设计的。这意味着我们有一个向主题写入消息的消息发布者，每个主题订阅都会收到一份消息副本。从订阅接收消息的方式与从队列接收消息的方式相同。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mc"><img src="../Images/c67337a270080fd2a640f5bc21431788.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vMNZYCLwtlC-vBu88YGgjA.png"/></div></div></figure><h2 id="c92f" class="ky ju hh bd jv kz la lb jz lc ld le kd ip lf lg kh it lh li kl ix lj lk kp ll bi translated">2.3 Azure服务总线用例</h2><p id="cab0" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">服务总线高级排队操作使其能够用于企业消息传递。当一个应用程序想要向其他应用程序发送定向消息(命令)并期望它们执行特定的动作时，这是很有用的。</p><p id="faf4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">例如，电子商务应用程序在收到订单后向采购服务发送定向消息以采购产品，向仓库系统发送消息以包装产品，向CRM系统发送消息以通知客户。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es md"><img src="../Images/eb290ff12ff3da975935f1fe00acfd11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5Y6iL2_msrLHhXZbI49ENQ.png"/></div></div></figure><h1 id="e62d" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">3.Azure活动中心</h1><p id="0da5" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">Azure Event Hub是一个完全托管的<em class="kw"> PaaS </em>大数据事件流平台&amp;事件接收服务，能够以低延迟每秒接收和处理数百万条消息。它被设计来处理大量的、多种多样的事件。它还支持<a class="ae js" href="https://en.wikipedia.org/wiki/Advanced_Message_Queuing_Protocol" rel="noopener ugc nofollow" target="_blank"> <em class="kw">高级消息队列协议</em> </a> <em class="kw"> (AMQP)。</em>每个消费应用程序都有自己的事件流。</p><p id="e43e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">事件中心在内部将消息分成称为分区的缓冲区，以维护有序的事件序列。此外，事件中心可以<em class="kw">捕获事件</em>并将它们存储到Azure Blob存储中。所有事件发布者都会获得一个令牌，以安全地允许外部设备和移动应用程序插入事件。</p><p id="9fcb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Azure Event hub可以公开Apache Kafka endpoint，以允许早期使用Kafka作为消息代理的应用程序迁移到事件中心，而无需进行任何代码更改。</p><h2 id="85d1" class="ky ju hh bd jv kz la lb jz lc ld le kd ip lf lg kh it lh li kl ix lj lk kp ll bi translated">3.1 Azure事件中心用例</h2><p id="4870" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">事件中心最适合高速数据接收场景，如遥测和分布式数据流，我们需要聚合或分析事件流。</p><p id="ce7b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当应用程序希望发布诸如状态变化之类的事实，并且不期望消费者采取任何特定的行动时，这是非常有用的。对于从网站发布时间序列点击流以跟踪用户旅程、传感器设备发送温度和压力数据以跟踪这些属性的主要变化等用例。通过活动中心可以轻松实现。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es me"><img src="../Images/e94ad67a4d4ed31b2d3ce04793162371.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oWdJN7yLeP3IIjPDAdDS4Q.jpeg"/></div></div></figure><h1 id="8b7f" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">4.Azure事件网格</h1><p id="6ff5" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">Azure Event Grid是一个完全托管的事件路由服务。事件网格将来自不同来源的事件分发到不同的处理程序，如Azure函数或逻辑应用程序。<strong class="ig hi">消息被推送到事件处理程序</strong>，这意味着处理程序应该能够处理负载或实现节流机制。</p><p id="706e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">发布者在不知道消费者的情况下向主题发出事件，另一方面，事件订阅者可以在该主题上创建订阅。消费者可以配置某些过滤标准，如事件类型、事件主题或基于有效负载中的数据。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mf"><img src="../Images/3c5e43734a06a62a8b52335931da9943.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*MM0_LpPHlrTyfGMgoMsdsQ.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx">Image By <a class="ae js" href="https://docs.microsoft.com/en-us/learn/modules/choose-a-messaging-model-in-azure-to-connect-your-services/media/4-event-grid.png" rel="noopener ugc nofollow" target="_blank">Microsoft Azure</a></figcaption></figure><p id="7a75" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">事件源将事件发送到事件网格，事件网格将相关事件转发给订阅者。</p><h2 id="ac62" class="ky ju hh bd jv kz la lb jz lc ld le kd ip lf lg kh it lh li kl ix lj lk kp ll bi translated">4.1 Azure事件网格用例</h2><p id="3bd4" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">Azure event grid在应用程序需要对另一个服务中发生的变化做出反应的场景中非常有用。例如，在blob存储中上传新文件时处理文件，在虚拟机启动时标记虚拟机，在资源组中添加新用户时运行工作流等。这避免了对<em class="kw">长轮询</em>或<em class="kw">锤轮询</em>的需要，并节省了网络资源。</p><p id="fd2a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">过滤事件并将其分散到多个目的地也很有用。它通过使用指数补偿在24小时内重试事件来确保可靠地传送到目的地。</p><h1 id="c781" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">5.比较和决策树</h1><p id="8303" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">下面是基于最常见特征的每种消息传递技术的快速比较:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mg"><img src="../Images/36441916e3ba37aeb4c51a404faf0626.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QViH7XLkWVeRLHSm8UwLVw.png"/></div></div></figure><p id="19ef" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以使用以下决策树作为起点，根据用例快速确定消息服务:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mh"><img src="../Images/c1f056a17622fa91815342c5596f4f49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7sLgKdFrnXjbRzxq0ocp4w.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx"><strong class="bd jv">Azure Messaging Services — Decision Tree</strong></figcaption></figure><p id="9d91" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这些服务中的大多数都在不同的层级中提供。服务功能和<a class="ae js" href="https://azure.microsoft.com/en-in/pricing/" rel="noopener ugc nofollow" target="_blank">成本</a>因层级而异。因此，在选择消息服务时应该考虑等级。</p><h1 id="40a5" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">6.摘要</h1><p id="eb03" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">在本文中，我们探索了四种不同的Azure消息服务，它们使我们能够开发可靠且有弹性的分布式应用程序。在它们之间进行选择就是决定需要在组件之间传递的数据类型(命令或事实)，然后决定需要什么特性来传递和处理数据。</p></div><div class="ab cl mi mj go mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ha hb hc hd he"><h1 id="ff40" class="jt ju hh bd jv jw mp jy jz ka mq kc kd ke mr kg kh ki ms kk kl km mt ko kp kq bi translated">参考</h1><ol class=""><li id="fb2e" class="ln lo hh ig b ih kr il ks ip mu it mv ix mw jb mx lt lu lv bi translated">蔚蓝服务巴士:<a class="ae js" href="https://azure.microsoft.com/en-in/services/service-bus/" rel="noopener ugc nofollow" target="_blank">https://azure.microsoft.com/en-in/services/service-bus/</a></li><li id="9758" class="ln lo hh ig b ih lw il lx ip ly it lz ix ma jb mx lt lu lv bi translated">azure Event Hub:<a class="ae js" href="https://docs.microsoft.com/en-us/azure/event-hubs/event-hubs-about" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/azure/Event-hubs/Event-hubs-about</a></li><li id="0728" class="ln lo hh ig b ih lw il lx ip ly it lz ix ma jb mx lt lu lv bi translated">Azure存储队列:<a class="ae js" href="https://docs.microsoft.com/en-us/azure/storage/queues/storage-queues-introduction" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/azure/Storage/queues/Storage-queues-简介</a></li><li id="b06b" class="ln lo hh ig b ih lw il lx ip ly it lz ix ma jb mx lt lu lv bi translated">蔚蓝事件网格:【https://docs.microsoft.com/en-us/azure/event-grid/overview T4】</li></ol></div></div>    
</body>
</html>