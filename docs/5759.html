<html>
<head>
<title>Case Study: Manage User Privileges Using a Graph</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">案例研究:使用图表管理用户权限</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/case-study-manage-user-privileges-using-a-graph-672d0d9dfe5c?source=collection_archive---------2-----------------------#2021-03-16">https://medium.com/oracledevs/case-study-manage-user-privileges-using-a-graph-672d0d9dfe5c?source=collection_archive---------2-----------------------#2021-03-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/6792ae897bb830c4b0ce7eda237c456c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hhuKbr6AOz9YLDuDmmVJUw.jpeg"/></div></div></figure><p id="f216" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><a class="ae jn" href="https://www.oracle.com/big-data/what-is-graph-database/" rel="noopener ugc nofollow" target="_blank"> <strong class="ir hi">图形数据库</strong> </a>作为一种在应用程序中提供灵活的访问控制和安全性的方式，正引起人们的关注。即使在多级定义和嵌套授权用户组时，也可以使用图表轻松跟踪和检查上述层次结构中的所有授权用户组，并找到某个用户的权限。</p><p id="f0cf" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">例如，AMENIDY的<a class="ae jn" href="https://cybele.cloud/" rel="noopener ugc nofollow" target="_blank"> <strong class="ir hi"> Cybele安全邮件</strong> </a>服务是一种解决方案，它使用先进的加密技术和管理数据传输信息的数据库自动加密电子邮件附件。Oracle数据库的<a class="ae jn" href="https://www.oracle.com/database/graph/" rel="noopener ugc nofollow" target="_blank"> <strong class="ir hi">属性图</strong> </a>特性被引入到该系统中，这是因为对基于图形的声明性查询、十亿边规模图的稳定性和可伸缩性等图形数据库能力的需求，以及已建立的数据库安全性。</p><p id="c963" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这篇博文中，我将解释使用图形数据库管理电子邮件发件人和收件人之间关系的基本方法。请注意:此内容基于我对客户的采访；因此，<strong class="ir hi">实际的系统行为、数据模型和查询可能与这里显示的不同</strong>。直观数据模型和查询的优势在现实系统中可能更为显著，因为需要考虑更多的关系和条件。</p><p id="0770" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">图形构成</strong></p><p id="d0ac" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在此处的示例图中，用户、用户所属的组、用户发送的电子邮件以及电子邮件所附的文件分别被视为节点。</p><figure class="jp jq jr js fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es jo"><img src="../Images/b1c0868db5602ef89a5e376633c28423.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g-8ImZ1rWQUC2nZ_PYqEwA.jpeg"/></div></div></figure><p id="a425" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">此外，一封电子邮件有一个发件人和多个收件人(=用户或组)的边来表示电子邮件传输的信息。</p><figure class="jp jq jr js fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es jt"><img src="../Images/8827d43da313ec427b6ff453fccbb678.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*23P44Exwwg2qV0serhOFvA.jpeg"/></div></div></figure><p id="b360" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">给图添加节点和边</strong></p><p id="db23" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">首先，让我们考虑当一封电子邮件被发送时会发生什么。可以假设，当用户发送一封带有三个附件的电子邮件时，将发出以下两个PGQL查询。PGQL查询语法见<a class="ae jn" href="https://pgql-lang.org/" rel="noopener ugc nofollow" target="_blank">https://pgql-lang.org/</a>。</p><p id="ada7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">第一个PGQL查询添加了一个邮件节点和一条将它连接到用户<code class="du ju jv jw jx b">user_01</code>的边。这个节点被标记为<code class="du ju jv jw jx b">mail</code>,表示它是一个邮件节点，并且具有name属性，该属性的值为<code class="du ju jv jw jx b">mail_01</code>。边缘标记为<code class="du ju jv jw jx b">sent_by</code>。</p><pre class="jp jq jr js fd jy jx jz ka aw kb bi"><span id="f660" class="kc kd hh jx b fi ke kf l kg kh">INSERT VERTEX v LABELS (mail) PROPERTIES (v.name = 'mail_01'),<br/>       EDGE e BETWEEN v AND u LABELS (sent_by)<br/>FROM MATCH (u:user)<br/>WHERE u.email = 'user_01@example.com'</span></pre><p id="6163" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">下面的PGQL查询向上面刚刚创建的邮件节点添加了三个附件节点。</p><pre class="jp jq jr js fd jy jx jz ka aw kb bi"><span id="f7d0" class="kc kd hh jx b fi ke kf l kg kh">INSERT VERTEX v1 LABELS (attachment)<br/>         PROPERTIES (v1.name = 'attachment_01'),<br/>       VERTEX v2 LABELS (attachment)<br/>         PROPERTIES (v2.name = 'attachment_02'),<br/>       VERTEX v3 LABELS (attachment)<br/>         PROPERTIES (v3.name = 'attachment_03'),<br/>       EDGE e1 BETWEEN v1 AND m LABELS (attached_on),<br/>       EDGE e2 BETWEEN v2 AND m LABELS (attached_on),<br/>       EDGE e3 BETWEEN v3 AND m LABELS (attached_on)<br/>FROM MATCH (m:mail)<br/>WHERE m.name = 'mail_01';</span></pre><p id="cd53" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">此时创建的图形可以如下所示。</p><figure class="jp jq jr js fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ki"><img src="../Images/b02457ae88814fe7bf94288271e1217a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6i0PjF2Nev2dK239pRsB1w.jpeg"/></div></div></figure><p id="8e4a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">此外，它还存储该电子邮件发送给了哪些用户。如果目标用户尚未在此数据库中创建，您需要首先添加它。以下两个PGQL查询在现有组下添加一个目标用户节点，并为该用户添加一个边。</p><p id="513c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">创建一个目的用户节点，并用一条<code class="du ju jv jw jx b">belongs_to</code>边将其连接到组节点。</p><pre class="jp jq jr js fd jy jx jz ka aw kb bi"><span id="e77f" class="kc kd hh jx b fi ke kf l kg kh">INSERT VERTEX v LABELS (user)<br/>         PROPERTIES (v.name = 'user_02@example.com'),<br/>       EDGE e BETWEEN v AND g LABELS (belongs_to)<br/>FROM MATCH (g:group)<br/>WHERE g.email = 'group_01@example.com'</span></pre><p id="22a0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">添加一条从email节点到新创建的用户节点的<code class="du ju jv jw jx b">sent_to</code>边。</p><pre class="jp jq jr js fd jy jx jz ka aw kb bi"><span id="86a6" class="kc kd hh jx b fi ke kf l kg kh">INSERT EDGE e BETWEEN m AND u LABELS (sent_to)<br/>FROM MATCH (m:mail), MATCH (u:user)<br/>WHERE m.name = 'mail_01' AND u.email = 'user_02@example.com'</span></pre><figure class="jp jq jr js fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/8410d24db4083e03b1dab3d516cd6bb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jKS1n4jpUIqBiUoBZ3cU9w.jpeg"/></div></div></figure><p id="4669" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">检查图中的可达性</strong></p><p id="06ec" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">电子邮件的收件人需要在打开附件时从服务器获取密钥。通过这样做，该系统的用户可以通过不同的途径安全地获得加密的数据及其密钥。</p><p id="4a07" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">此时，服务器运行以下查询来检查此电子邮件是否已发送给该特定用户。</p><pre class="jp jq jr js fd jy jx jz ka aw kb bi"><span id="8faf" class="kc kd hh jx b fi ke kf l kg kh">SELECT m.name<br/>FROM MATCH (a)-[:attached_on]-&gt;(m)-[:sent_to]-&gt;(u) <br/>WHERE a.name = 'attachment_01'<br/>  AND u.email = 'user_02@example.com'</span></pre><p id="e510" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">JShell中的输出如下。返回一条记录，这意味着路径存在。</p><pre class="jp jq jr js fd jy jx jz ka aw kb bi"><span id="5eaa" class="kc kd hh jx b fi ke kf l kg kh">+ --------- +<br/>| NAME      |<br/>+ --------- +<br/>| mail_01   |<br/>+ --------- +</span></pre><figure class="jp jq jr js fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/6be7a981ffeb2c3ec47ddadb706ada1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vGY-9u5G-mv3rs136y75mg.jpeg"/></div></div></figure><p id="04b4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果电子邮件被发送到组而不是用户，那么通过跟踪组节点，他们应该仍然是可到达的。让我们改变这封邮件的目的地。</p><p id="b9b7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">首先，删除<code class="du ju jv jw jx b">sent_to</code>边缘。</p><pre class="jp jq jr js fd jy jx jz ka aw kb bi"><span id="5c77" class="kc kd hh jx b fi ke kf l kg kh">DELETE e<br/>FROM MATCH (m:mail)-[e:sent_to]-&gt;(u:user)<br/>WHERE m.name = 'mail_01' AND u.email = 'user_02@example.com'</span></pre><p id="e7bc" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为组节点创建新的sent_to边。</p><pre class="jp jq jr js fd jy jx jz ka aw kb bi"><span id="6ad9" class="kc kd hh jx b fi ke kf l kg kh">INSERT EDGE e BETWEEN m AND g LABELS (sent_to)<br/>FROM MATCH (m:mail), MATCH (g:group)<br/>WHERE m.name = 'mail_01' AND g.email = 'group_02@example.com'</span></pre><p id="4420" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">将组节点添加到<code class="du ju jv jw jx b">MATCH</code>子句并搜索路径。</p><pre class="jp jq jr js fd jy jx jz ka aw kb bi"><span id="a8e7" class="kc kd hh jx b fi ke kf l kg kh">SELECT m.name<br/>FROM MATCH<br/>  (a)-[:attached_on]-&gt;(m)-[:sent_to]-&gt;(g)&lt;-[:belongs_to]-(u)<br/>WHERE a.name = 'attachment_01'<br/>  AND u.email = 'user_02@example.com'</span></pre><p id="3ad2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">记录被返回，因此路径存在。</p><pre class="jp jq jr js fd jy jx jz ka aw kb bi"><span id="e7fc" class="kc kd hh jx b fi ke kf l kg kh">+ --------- +<br/>| NAME      |<br/>+ --------- +<br/>| mail_01   |<br/>+ --------- +</span></pre><figure class="jp jq jr js fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/6792ae897bb830c4b0ce7eda237c456c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hhuKbr6AOz9YLDuDmmVJUw.jpeg"/></div></div></figure><p id="29e9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">即使组节点包括未指定数量的层次结构，您也可以找到可达性。例如，下面的查询上升到5个级别，并检查这些组节点是否连接到邮件节点。</p><pre class="jp jq jr js fd jy jx jz ka aw kb bi"><span id="3d3f" class="kc kd hh jx b fi ke kf l kg kh">SELECT m.name<br/>FROM MATCH<br/>  (a)-[:attached_on]-&gt;(m)-[:sent_to]-&gt;(g)&lt;-/:belongs_to{1,5}/-(u)<br/>WHERE a.name = 'attachment_01'<br/>  AND u.email = 'user_02@example.com'</span></pre><p id="2424" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">总结</strong></p><p id="586c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这篇博客文章提供了一个使用Oracle数据库的属性图特性来管理发送和接收电子邮件的用户活动的例子。通过向图中添加更多的关系和条件，可以管理除电子邮件之外的用户之间的各种活动，并扩展系统的功能。例如，附件的截止日期可以存储在节点或边的属性中。这种数据库功能使我们能够快速有效地向各种服务引入灵活的细粒度访问控制。</p><p id="8c40" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">链接</strong></p><ul class=""><li id="2aed" class="kj kk hh ir b is it iw ix ja kl je km ji kn jm ko kp kq kr bi translated">AMENIDY Cybele安全邮件:<a class="ae jn" href="https://cybele.cloud/" rel="noopener ugc nofollow" target="_blank">https://cybele.cloud/</a><br/>ame nidy是一家安全解决方案提供商，总部位于日本，是Oracle云用户。</li><li id="8081" class="kj kk hh ir b is ks iw kt ja ku je kv ji kw jm ko kp kq kr bi translated">Oracle数据库的属性图特性:<a class="ae jn" href="https://www.oracle.com/database/graph/" rel="noopener ugc nofollow" target="_blank">https://www.oracle.com/database/graph/</a></li><li id="bedb" class="kj kk hh ir b is ks iw kt ja ku je kv ji kw jm ko kp kq kr bi translated">图形数据库和图形分析的17个用例:<br/><a class="ae jn" href="https://www.oracle.com/cloud/solutions/use-cases-for-graph-databases-and-graph-analytics-ebook/" rel="noopener ugc nofollow" target="_blank">https://www . Oracle . com/cloud/solutions/Use-Cases-for-Graph-Databases-and-Graph-Analytics-ebook/</a></li></ul></div><div class="ab cl kx ky go kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ha hb hc hd he"><p id="19d7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您想分享您的反馈或向社区提问，请点击<a class="ae jn" href="https://join.slack.com/t/andouc/shared_invite/zt-mfbk0un9-E7mgQweUfBnJ6BfRgcTeMQ" rel="noopener ugc nofollow" target="_blank">此处</a>加入AnDOUC(分析和数据Oracle用户社区)Slack workspace，并在<a class="ae jn" href="https://andouc.slack.com/archives/C01BMHU02JX" rel="noopener ugc nofollow" target="_blank"> #graph </a>频道发表您的评论。</p></div></div>    
</body>
</html>