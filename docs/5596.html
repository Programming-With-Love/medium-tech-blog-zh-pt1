<html>
<head>
<title>LoadBalancer service, Oracle Container Engine (OKE) and OCI DNS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">负载平衡器服务、Oracle容器引擎(OKE)和OCI DNS</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/loadbalancer-service-oracle-container-engine-oke-and-oci-dns-d7b1f7b4f9bd?source=collection_archive---------0-----------------------#2019-04-08">https://medium.com/oracledevs/loadbalancer-service-oracle-container-engine-oke-and-oci-dns-d7b1f7b4f9bd?source=collection_archive---------0-----------------------#2019-04-08</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="5fa8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在Kubernetes中，有几种类型服务(ClusterIP、NodePort、LoadBalancer)。此外，还有入口和入口控制器。如果你仍然觉得这些令人困惑，我推荐<a class="jc jd ge" href="https://medium.com/u/bba63600816e?source=post_page-----d7b1f7b4f9bd--------------------------------" rel="noopener" target="_blank"> Sandeep Dinesh </a>的优秀<a class="ae je" rel="noopener" href="/google-cloud/kubernetes-nodeport-vs-loadbalancer-vs-ingress-when-should-i-use-what-922f010849e0">文章</a>。</p><p id="7d72" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们探索一下如何在OKE上部署一个公共可用服务，并确保它可以被DNS解析。</p><p id="a243" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我假设您已经运行了一个OKE集群。如果没有，你可以跟随我之前的<a class="ae je" rel="noopener" href="/oracledevs/provisioning-oracle-container-engine-oke-using-terraform-41542fd15d1c">帖子</a>来创建一个。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es jf"><img src="../Images/5a342c2e74c4d48e233b1df7ffbc62fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AgdFbBGbqfCMLBydHkJn3w.png"/></div></div></figure><h2 id="663a" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated">创建应用程序服务</h2><pre class="jg jh ji jj fd km kn ko kp aw kq bi"><span id="769a" class="jr js hh kn b fi kr ks l kt ku">kubectl apply -f <a class="ae je" href="https://raw.githubusercontent.com/hyder/okesamples/master/loadbalancer/hello-clusteripsvc.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/hyder/okesamples/master/loadbalancer/hello-clusteripsvc.yaml</a></span><span id="5c49" class="jr js hh kn b fi kv ks l kt ku">deployment.apps/hello-cluster created                                                                                                                                       <br/>service/hello-cluster-service created</span></pre><p id="2418" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">验证它是否正常工作:</p><pre class="jg jh ji jj fd km kn ko kp aw kq bi"><span id="f1f6" class="jr js hh kn b fi kr ks l kt ku">kubectl proxy — port=8080</span></pre><p id="d80f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用浏览器访问以下URL:<a class="ae je" href="http://localhost:8080/api/v1/namespaces/default/services/hello-cluster-service:80/proxy/" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/API/v1/namespaces/default/services/hello-cluster-service:80/proxy/</a></p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es kw"><img src="../Images/debc1a622b691930771ad8a7bd300ee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L0M453SeeYXMvcZOGOdLGQ.png"/></div></div></figure><h2 id="0133" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated">创建默认后端、负载平衡器服务和IngressController</h2><pre class="jg jh ji jj fd km kn ko kp aw kq bi"><span id="5276" class="jr js hh kn b fi kr ks l kt ku">kubectl apply -f <a class="ae je" href="https://raw.githubusercontent.com/hyder/okesamples/master/loadbalancer/default-backend.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/hyder/okesamples/master/loadbalancer/default-backend.yaml</a></span><span id="7b7b" class="jr js hh kn b fi kv ks l kt ku">kubectl apply -f <a class="ae je" href="https://raw.githubusercontent.com/hyder/okesamples/master/loadbalancer/hello-ingress.rbac.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/hyder/okesamples/master/loadbalancer/hello-ingress.rbac.yaml</a></span><span id="6ab3" class="jr js hh kn b fi kv ks l kt ku">kubectl apply -f <a class="ae je" href="https://raw.githubusercontent.com/hyder/okesamples/master/loadbalancer/hello-ingresscontroller.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/hyder/okesamples/master/loadbalancer/hello-ingresscontroller.yaml</a></span></pre><h2 id="1bd2" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated">创建入口</h2><p id="d4e0" class="pw-post-body-paragraph ie if hh ig b ih kx ij ik il ky in io ip kz ir is it la iv iw ix lb iz ja jb ha bi translated">下载hello-ingress.yaml:</p><pre class="jg jh ji jj fd km kn ko kp aw kq bi"><span id="390d" class="jr js hh kn b fi kr ks l kt ku">curl -o hello-ingress.yaml <a class="ae je" href="https://raw.githubusercontent.com/hyder/okesamples/master/loadbalancer/hello-ingress.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/hyder/okesamples/master/loadbalancer/hello-ingress.yaml</a></span></pre><p id="ce57" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">编辑hello-ingress.yaml:</p><pre class="jg jh ji jj fd km kn ko kp aw kq bi"><span id="6307" class="jr js hh kn b fi kr ks l kt ku">spec:<br/>  rules:<br/>  # replace <a class="ae je" href="http://www.example.org" rel="noopener ugc nofollow" target="_blank">www.</a>example.org with your FQDN<br/>  - host: <a class="ae je" href="http://www.example.org" rel="noopener ugc nofollow" target="_blank">www.</a>example.org</span></pre><p id="e0b8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，您可以创建入口:</p><pre class="jg jh ji jj fd km kn ko kp aw kq bi"><span id="c769" class="jr js hh kn b fi kr ks l kt ku">kubectl apply -f hello-ingress.yaml</span></pre><h2 id="64a4" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated">测试入口</h2><p id="a601" class="pw-post-body-paragraph ie if hh ig b ih kx ij ik il ky in io ip kz ir is it la iv iw ix lb iz ja jb ha bi translated">获取负载平衡器的公共IP地址，并尝试直接访问它:</p><figure class="jg jh ji jj fd jk"><div class="bz dy l di"><div class="lc ld l"/></div></figure><p id="dacf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">公共IP地址将位于外部IP列下。在上面的例子中，负载平衡器的公共IP地址是129.146.154.77</p><p id="2626" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您尝试使用浏览器中的IP地址访问hello服务，将会返回“默认后端-404”。这是因为在我们创建的入口中，我们将规则指定为基于主机而不是基于IP:</p><pre class="jg jh ji jj fd km kn ko kp aw kq bi"><span id="b8a5" class="jr js hh kn b fi kr ks l kt ku">spec:<br/>  rules:<br/>  - host: <a class="ae je" href="http://www.example.org" rel="noopener ugc nofollow" target="_blank"><strong class="kn hi">www.example.org</strong></a></span></pre><p id="706d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">浏览器中HTTP请求头中的主机值是没有规则的IP地址。由于没有匹配的规则，请求由默认的后端服务。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div class="er es le"><img src="../Images/c010837b38dc8d8cc44d5283ff668796.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*-lijCe8IOBmOGs5rwsyxfg.png"/></div></figure><p id="9cea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">编辑本地主机文件并添加一个条目，确保主机与您在入口中输入的内容相匹配:</p><pre class="jg jh ji jj fd km kn ko kp aw kq bi"><span id="79cb" class="jr js hh kn b fi kr ks l kt ku">129.146.154.77 <a class="ae je" href="http://www.example" rel="noopener ugc nofollow" target="_blank">www.example</a>.org</span></pre><p id="deef" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在使用您的浏览器访问主机，您应该能够看到Helloworld页面。</p><p id="a216" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="lf">警告:如果您在代理后面的网络中进行测试，这将不起作用。</em></p><h2 id="dfe9" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated">在OCI配置DNS</h2><ol class=""><li id="e62f" class="lg lh hh ig b ih kx il ky ip li it lj ix lk jb ll lm ln lo bi translated">登录OCI控制台，导航至边缘服务&gt; DNS区域管理</li><li id="9dbf" class="lg lh hh ig b ih lp il lq ip lr it ls ix lt jb ll lm ln lo bi translated">创建一个区域，并确保区域名称与您的域名相匹配，例如example.com。</li><li id="3bfa" class="lg lh hh ig b ih lp il lq ip lr it ls ix lt jb ll lm ln lo bi translated">创建完成后，单击该区域并记下该区域的名称服务器。</li><li id="d3d5" class="lg lh hh ig b ih lp il lq ip lr it ls ix lt jb ll lm ln lo bi translated">登录您的DNS注册商，例如Dyn、GoDaddy，并在步骤3中更改您的名称服务器以指向您的区域中的区域。这可能需要一段时间才能生效。</li><li id="cf0f" class="lg lh hh ig b ih lp il lq ip lr it ls ix lt jb ll lm ln lo bi translated">返回OCI控制台，点击“添加记录”</li><li id="5579" class="lg lh hh ig b ih lp il lq ip lr it ls ix lt jb ll lm ln lo bi translated">选择“A-IP v4地址”</li><li id="73bc" class="lg lh hh ig b ih lp il lq ip lr it ls ix lt jb ll lm ln lo bi translated">添加FQDN，例如:<a class="ae je" href="http://www.example.org" rel="noopener ugc nofollow" target="_blank"/><br/>(<strong class="ig hi"><em class="lf">注意:</em> </strong>您只需要在名称字段中添加主机名)</li><li id="1eea" class="lg lh hh ig b ih lp il lq ip lr it ls ix lt jb ll lm ln lo bi translated">在地址字段中，添加负载平衡器的公共IP地址。</li><li id="4d2c" class="lg lh hh ig b ih lp il lq ip lr it ls ix lt jb ll lm ln lo bi translated">添加TTL值，例如3600</li><li id="2b1b" class="lg lh hh ig b ih lp il lq ip lr it ls ix lt jb ll lm ln lo bi translated">点击“提交”,然后点击“发布更改”</li><li id="78ef" class="lg lh hh ig b ih lp il lq ip lr it ls ix lt jb ll lm ln lo bi translated">从您在上一步中添加的hosts文件中远程添加条目。</li><li id="7255" class="lg lh hh ig b ih lp il lq ip lr it ls ix lt jb ll lm ln lo bi translated">一旦您的DNS提供商和其他网络所做的更改生效，您应该能够在浏览器中使用您的FQDN访问Helloworld页面。</li></ol><p id="e4ab" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于DNS的快速介绍，你可以查看这些<a class="ae je" href="https://www.slideshare.net/dyninc/intro-to-dns-101-dyn-chief-scientist-tom-daly" rel="noopener ugc nofollow" target="_blank">幻灯片</a>。</p><p id="a33d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="lf">注意——免费层用户可能会体验到其帐户所含服务的变化。</em></p></div></div>    
</body>
</html>