<html>
<head>
<title>Template Literal Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">模板文字引擎</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/template-literal-engine-87e98f3c1f49?source=collection_archive---------0-----------------------#2020-12-18">https://medium.com/walmartglobaltech/template-literal-engine-87e98f3c1f49?source=collection_archive---------0-----------------------#2020-12-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="7462" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这篇博客是在吉恩·潘的帮助下共同撰写的</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/e22babcccc8e81ca93a475936d673c87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*e4lAoOZtelImD0ADSYDH6g.png"/></div></figure><p id="24c9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi jl translated">随着ES6中模板文字的引入，在JavaScript中构建字符串模板得到了极大的改进。但是以正确的方式构建模板可能需要一些思考，甚至会带来挑战。</p><p id="1ada" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当在<strong class="ig hi">沃尔玛全球技术</strong>建立我们的A/B实验平台时，其中一个关键特性是识别用户<em class="ju">何时有资格</em>进行实验。一个<em class="ju">合格的</em>用户被定义为一个被分配到实验中的人，他看到了(据我们所知)正在进行实验的那部分场地。为了确定用户是否合格，我们需要通过一组预先确定的标准从我们的网站(Walmart.com)或我们的本地应用程序查询数据。这个预先确定的标准是在实验设置阶段建立的，并且是查询表达式的形式(类似于SQL)。这些表达式可能会变得非常复杂，任何熟悉构建SQL查询或标量函数的人都可以证明这一点。此外，表达式中的属性由外部系统定义，即。网站/本机应用程序，因此可能会在我们的应用程序控制之外发生变化。</p><p id="b50b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这给我们提出了两个需要解决的挑战。首先，我们需要<em class="ju">将</em>查询表达式模板化，使值可以被替换。其次，我们需要将这些模板存储在配置文件中的代码库之外。</p><h2 id="3dd1" class="jv jw hh bd jx jy jz ka kb kc kd ke kf ip kg kh ki it kj kk kl ix km kn ko kp bi translated">Con+cat+enation</h2><p id="8609" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">JavaScript中的字符串串联从来都不怎么好。当试图使用字符串连接来构建模板时尤其如此。</p><blockquote class="kv kw kx"><p id="be0d" class="ie if ju ig b ih ii ij ik il im in io ky iq ir is kz iu iv iw la iy iz ja jb ha bi translated">const形容词= "棒极了"；</p><p id="6f91" class="ie if ju ig b ih ii ij ik il im in io ky iq ir is kz iu iv iw la iy iz ja jb ha bi translated">"字符串串联不是一种“+形容词+”的方式来构建模板."</p></blockquote><p id="f6b7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你曾经试图构建一个字符串模板，并且你做了其中的一个，<em class="ju">" SELECT "+fields+" FROM "+table</em>，你很快就会意识到这个设计的伸缩性有多差。原来JavaScript有一个很棒的语法，可以帮助我们解决使用模板文字的第一个问题。</p><h2 id="dee0" class="jv jw hh bd jx jy jz ka kb kc kd ke kf ip kg kh ki it kj kk kl ix km kn ko kp bi translated">模板文字</h2><p id="1a03" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">模板文字在JavaScript中是一个很棒的构造，尤其是在构建复杂的字符串时，比如查询字符串或多行字符串。JavaScript中的模板文字是插值字符串，这意味着它们允许字符串中有变量，JavaScript引擎将用值替换这些变量。插值的最终结果是一个字符串。</p><blockquote class="kv kw kx"><p id="8809" class="ie if ju ig b ih ii ij ik il im in io ky iq ir is kz iu iv iw la iy iz ja jb ha bi translated">` Template literal是构建模板的一种$ {形容词}方式。'</p></blockquote><p id="c7f3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">模板文字本身不是字符串类型，因此在JavaScript环境之外不受支持，例如在JSON文件中。为什么最后一部分很重要？</p><h2 id="83ee" class="jv jw hh bd jx jy jz ka kb kc kd ke kf ip kg kh ki it kj kk kl ix km kn ko kp bi translated">配置</h2><p id="22c2" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">几乎所有的应用程序都使用配置文件来存储运行时代码之外的数据。无论是初始化应用程序、保护API令牌还是存储运行时标志。如果我们的应用程序使用JavaScript配置文件”。js“那么我们的故事就到此为止了，因为我们可以将可配置的模板文本直接放入文件中。然而，许多应用程序利用JSON文件来存储配置，就像我们的A/B实验工具一样。</p><blockquote class="kv kw kx"><p id="2edd" class="ie if ju ig b ih ii ij ik il im in io ky iq ir is kz iu iv iw la iy iz ja jb ha bi translated">提示:不要让JSON中的<strong class="ig hi"> JS </strong>迷惑了你，它是独立于语言的。</p></blockquote><p id="7150" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">JSON是许多编程语言和架构中广泛使用的数据结构。因为它是语言不可知的，所以它只支持数据类型text。</p><h2 id="1d6d" class="jv jw hh bd jx jy jz ka kb kc kd ke kf ip kg kh ki it kj kk kl ix km kn ko kp bi translated">TempLitSON？</h2><p id="439a" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">这就引出了我们的第二个问题。如果模板文字是JavaScript的构造，而JSON只支持文本，那么我们如何在JSON中存储模板文字配置呢？</p><blockquote class="kv kw kx"><p id="a48f" class="ie if ju ig b ih ii ij ik il im in io ky iq ir is kz iu iv iw la iy iz ja jb ha bi translated">显而易见的答案是:将其存储为一个字符串</p></blockquote><p id="4b43" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">JavaScript又有了两个方法来计算对象或函数的字符串，甚至…模板文字！那么这些神奇的选项是什么，我们如何选择最好的一个呢？</p><ul class=""><li id="a897" class="lb lc hh ig b ih ii il im ip ld it le ix lf jb lg lh li lj bi translated">eval危险，因为它打开了安全漏洞，性能不佳，并且<em class="ju">非常不鼓励</em></li><li id="bccd" class="lb lc hh ig b ih lk il ll ip lm it ln ix lo jb lg lh li lj bi translated">函数构造器——小的安全问题取决于它的使用方式，比<em class="ju"> eval </em>的性能好一点，全局范围，即。不是构造它的函数的词法</li></ul><p id="3b82" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">JavaScript中的函数构造函数让我们创建一个新的函数对象，传递一个字符串作为函数体。稍后将详细介绍。</p><blockquote class="kv kw kx"><p id="6a95" class="ie if ju ig b ih ii ij ik il im in io ky iq ir is kz iu iv iw la iy iz ja jb ha bi translated"><strong class="ig hi">新函数(' a '，' b '，' return a+b；));</strong></p></blockquote><h2 id="14b3" class="jv jw hh bd jx jy jz ka kb kc kd ke kf ip kg kh ki it kj kk kl ix km kn ko kp bi translated">发动机</h2><p id="be7e" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">因为函数体是求值的，所以它可以是字符串、对象或模板文本。通过利用函数构造器的这一特性，我们创建了模板文字引擎。我们通过让我们使用模板文字<em class="ju">和</em>构建复杂的查询，让我们将模板作为字符串存储在我们的配置JSON中，从而解决了上述两个挑战。</p><blockquote class="kv kw kx"><p id="0e1a" class="ie if ju ig b ih ii ij ik il im in io ky iq ir is kz iu iv iw la iy iz ja jb ha bi translated">我们利用模板文字的力量，同时将外部逻辑抽象成一个配置。</p></blockquote><h2 id="0f54" class="jv jw hh bd jx jy jz ka kb kc kd ke kf ip kg kh ki it kj kk kl ix km kn ko kp bi translated">让我们看看它的实际效果</h2><p id="2449" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated"><em class="ju">以下演练和代码示例由</em> <a class="ae jc" href="https://www.linkedin.com/in/jeanpan/" rel="noopener ugc nofollow" target="_blank"> <em class="ju"> Jean Pan </em> </a>提供</p><h2 id="d2d2" class="jv jw hh bd jx jy jz ka kb kc kd ke kf ip kg kh ki it kj kk kl ix km kn ko kp bi translated"><strong class="ak">第一次尝试:字符串连接</strong></h2><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lp lq l"/></div><figcaption class="lr ls et er es lt lu bd b be z dx">string concatenation example</figcaption></figure><p id="8d87" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上面的代码显然是有效的，但是如果字符串很长，用单引号和双引号将字符串括起来会变得很笨拙，你需要对引号进行转义。这很容易出错，尤其是当有更复杂和更长的字符串时。</p><blockquote class="kv kw kx"><p id="b708" class="ie if ju ig b ih ii ij ik il im in io ky iq ir is kz iu iv iw la iy iz ja jb ha bi translated">我们能做得更好吗？</p></blockquote><h2 id="3ed9" class="jv jw hh bd jx jy jz ka kb kc kd ke kf ip kg kh ki it kj kk kl ix km kn ko kp bi translated"><strong class="ak">第二次尝试:字符串插值</strong></h2><p id="db9b" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">模板文字提供了一种简洁的方式，允许我们操作字符串文字，并且易于阅读。要使用模板文字，只需将字符串文字用反斜杠括起来。有了它，我们可以像这样重构我们的函数:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lp lq l"/></div><figcaption class="lr ls et er es lt lu bd b be z dx">string interpolation example</figcaption></figure><p id="71e2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当使用url = "www.walmart.com "调用该函数时，它会将<em class="ju"> ${url} </em>替换为参数URL“www . Walmart . com”，并返回结果如下:</p><blockquote class="kv kw kx"><p id="2da2" class="ie if ju ig b ih ii ij ik il im in io ky iq ir is kz iu iv iw la iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="hh">页面属性“网址”应与“www . Walmart . com”</em></strong>相匹配</p></blockquote><p id="e96d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将字符串中的占位符<em class="ju"> ${url} </em>替换为值“www.walmart.com”的过程称为字符串插值。</p><p id="84f8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因为它是用反斜线包装的，所以可以在模板文字中使用单引号或双引号，不再需要难看的转义反斜线了！</p><h2 id="a506" class="jv jw hh bd jx jy jz ka kb kc kd ke kf ip kg kh ki it kj kk kl ix km kn ko kp bi translated"><strong class="ak">第三次尝试:带动态函数的模板文字</strong></h2><p id="e2b8" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">上面的代码可以工作，但是缺乏灵活性。如果查询依赖于外部变量，就像我们上面的问题陈述一样，该怎么办？</p><p id="0a8d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们想要的解决方案是在JSON配置文件中定义查询，并在运行时加载查询。现在的问题是当查询被加载时，它是一个字符串。我们如何将一个字符串转换成一个模板文字，并进行字符串插值？</p><p id="fd02" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">解决方案是使用函数构造器动态生成函数。</p><blockquote class="kv kw kx"><p id="2e70" class="ie if ju ig b ih ii ij ik il im in io ky iq ir is kz iu iv iw la iy iz ja jb ha bi translated"><a class="ae jc" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Function" rel="noopener ugc nofollow" target="_blank">T12】https://developer . Mozilla . org/en-US/docs/Web/JavaScript/Reference/Global _ Objects/FunctionT14】</a></p></blockquote><p id="f32f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上述示例可以重构为:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="e662" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们仔细看看它是如何工作的</p><p id="9750" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">语法:</p><blockquote class="kv kw kx"><p id="65d9" class="ie if ju ig b ih ii ij ik il im in io ky iq ir is kz iu iv iw la iy iz ja jb ha bi translated"><strong class="ig hi">新函数([args]，Function definition)；</strong></p></blockquote><p id="59cb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">调用这个新生成的函数:</p><blockquote class="kv kw kx"><p id="d6c6" class="ie if ju ig b ih ii ij ik il im in io ky iq ir is kz iu iv iw la iy iz ja jb ha bi translated"><strong class="ig hi">新函数([args]，Function definition)(…value)；</strong></p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es lv"><img src="../Images/d01142cb382fb6e85a9f975cc2e73278.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i97mu9dDGJn6dc6h9oFctw.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">Dev Tools console showing evaluated function</figcaption></figure><p id="39db" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如您所见，生成的新函数接受两个名为<em class="ju"> url </em>和<em class="ju"> loggedIn </em>的参数，并返回一个模板文本。</p><p id="cedd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意我们如何用(…value)调用新生成的函数。这种语法被称为“rest parameters ”,它允许向函数传递可变数量的参数。函数的最后一个参数可以以<code class="du ma mb mc md b">...</code>为前缀，这将导致所有剩余的(用户提供的)参数被放置在一个“标准”JavaScript数组中。</p><p id="e694" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有关详细信息，请参见文档。</p><blockquote class="kv kw kx"><p id="caa9" class="ie if ju ig b ih ii ij ik il im in io ky iq ir is kz iu iv iw la iy iz ja jb ha bi translated"><a class="ae jc" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/rest_parameters" rel="noopener ugc nofollow" target="_blank">https://developer . Mozilla . org/en-US/docs/Web/JavaScript/Reference/Functions/rest _ parameters</a></p></blockquote><h2 id="0beb" class="jv jw hh bd jx jy jz ka kb kc kd ke kf ip kg kh ki it kj kk kl ix km kn ko kp bi translated">结论</h2><p id="d1b2" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">在沃尔玛全球技术公司，我们每天都在努力寻找优雅的解决方案，让复杂的问题变得简单。通过我们新的模板文字引擎，我们使用了JavaScript功能的组合(字符串插值、函数构造器、rest参数)来解决我们的问题。在JSON配置中，我们使用动态函数生成，从存储为字符串的模板文字中构建复杂的查询。或者用更简单的话来说，我们已经使我们的模板可配置。</p></div></div>    
</body>
</html>