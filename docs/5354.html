<html>
<head>
<title>Oracle Managed Kubernetes Cloud– First Steps with Automated Deployment using Wercker Pipelines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Oracle托管的Kubernetes云—使用Wercker管道实现自动化部署的第一步</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/oracle-managed-kubernetes-cloud-first-steps-with-automated-deployment-using-wercker-pipelines-3cad7ff70142?source=collection_archive---------0-----------------------#2017-12-02">https://medium.com/oracledevs/oracle-managed-kubernetes-cloud-first-steps-with-automated-deployment-using-wercker-pipelines-3cad7ff70142?source=collection_archive---------0-----------------------#2017-12-02</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/aa92b58f1606e8724e7bafed6823e380.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vMgz02ladP3RYtXC."/></div></div></figure><p id="785a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">甲骨文在甲骨文全球大会2017期间宣布托管Kubernetes云服务。12月初，我有机会使用这个新的容器原生云产品。这很简单:</p><p id="5987" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">通过Wercker控制台</p><figure class="jn jo jp jq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/4572eb0ffe5aaaa311e3eeea9603bf91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LDRig1kmD4w4PxL3."/></div></div></figure><p id="d6c7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">可以在Oracle裸机云(也称为Oracle云基础架构)环境中创建新的集群。提供了云凭据</p><figure class="jn jo jp jq fd ii er es paragraph-image"><div class="er es jr"><img src="../Images/69661e629c266f1a5f95576c07892b6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/0*oAw7uqTPw7bamyfE."/></div></figure><p id="9f1a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">指定名称和K8S版本:</p><figure class="jn jo jp jq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/da335c9aa65ab7cc463b7f78dd0fbe02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ytjjNVwPMKz3BMON."/></div></div></figure><p id="a083" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">群集大小配置如下:</p><figure class="jn jo jp jq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/3c25df0df05c3062ac7374f31278c086.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qhs1mFIiL_9c-Dic."/></div></div></figure><p id="e242" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">并且节点配置被指示为:</p><figure class="jn jo jp jq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/25c12b720463a56d752a35425608a3c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*67T9FVohDHYN2I4I."/></div></div></figure><p id="344b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">随后，Oracle将根据这些规范向指定的云基础架构部署Kubernetes集群。</p><figure class="jn jo jp jq fd ii er es paragraph-image"><div class="er es js"><img src="../Images/089f43860c3e097ff4d55bc543f8f842.png" data-original-src="https://miro.medium.com/v2/resize:fit:1244/0*vjxcGExdHih256ow."/></div></figure><p id="228c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">该群集的地址在此屏幕截图中突出显示。稍后将需要此端点来配置自动化部署管道。</p><p id="b943" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这个集群可以通过Kubernetes仪表板进行管理。部署到集群可以使用普通的方法来完成——比如kubectl命令行工具。Oracle建议使用Wercker管道实现所有部署的自动化。我将在本文中说明这是如何做到的。</p><p id="81b0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">源代码可以在GitHub上找到:<a class="ae jt" href="https://github.com/lucasjellema/the-simple-app" rel="noopener ugc nofollow" target="_blank">https://github.com/lucasjellema/the-simple-app</a>。请注意，代码非常简单。</p><p id="a571" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">步骤是:(假设一个人已经有了一个GitHub帐户、一个Wercker帐户和一个本地kubectl安装)</p><ol class=""><li id="8b2d" class="ju jv hh ir b is it iw ix ja jw je jx ji jy jm jz ka kb kc bi translated">在Wercker帐户中生成一个个人令牌(用于Wercker与Kubernetes集群的直接交互)</li><li id="6d1e" class="ju jv hh ir b is kd iw ke ja kf je kg ji kh jm jz ka kb kc bi translated">准备(本地)Kubernetes配置文件—以便使用本地kubectl命令行处理集群</li><li id="a5a3" class="ju jv hh ir b is kd iw ke ja kf je kg ji kh jm jz ka kb kc bi translated">实现将要部署到Kubernetes集群上的应用程序——例如一个简单的节点应用程序</li><li id="3db6" class="ju jv hh ir b is kd iw ke ja kf je kg ji kh jm jz ka kb kc bi translated">创建wercker.yml文件(以及Kubernetes部署文件的模板),该文件描述了应用程序的构建步骤及其在Kubernetes上的部署</li><li id="77ba" class="ju jv hh ir b is kd iw ke ja kf je kg ji kh jm jz ka kb kc bi translated">将应用程序推送到GitHub存储库</li><li id="2718" class="ju jv hh ir b is kd iw ke ja kf je kg ji kh jm jz ka kb kc bi translated">在Wercker控制台中创建一个与GitHub存储库相关联的<em class="ki">版本</em></li><li id="27dd" class="ju jv hh ir b is kd iw ke ja kf je kg ji kh jm jz ka kb kc bi translated">使用wercker.yml文件中的管道为应用程序定义Wercker管道</li><li id="fddb" class="ju jv hh ir b is kd iw ke ja kf je kg ji kh jm jz ka kb kc bi translated">定义自动化管道——上一步中定义的管道链，由GitHub repo中的提交等事件触发</li><li id="e8a1" class="ju jv hh ir b is kd iw ke ja kf je kg ji kh jm jz ka kb kc bi translated">定义环境变量——特别是用于从自动化管道连接到Kubernetes集群的Kubernetes端点和用户令牌</li><li id="ce15" class="ju jv hh ir b is kd iw ke ja kf je kg ji kh jm jz ka kb kc bi translated">触发自动化管道——例如通过提交给GitHub</li><li id="765e" class="ju jv hh ir b is kd iw ke ja kf je kg ji kh jm jz ka kb kc bi translated">在Kubernetes中——仪表板或命令行——验证应用程序是否已部署，并确定公共端点</li><li id="0aaf" class="ju jv hh ir b is kd iw ke ja kf je kg ji kh jm jz ka kb kc bi translated">访问应用程序</li><li id="24e2" class="ju jv hh ir b is kd iw ke ja kf je kg ji kh jm jz ka kb kc bi translated">重复步骤10..12在发展应用程序时</li></ol><h1 id="9d70" class="kj kk hh bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">生成Wercker令牌</h1><figure class="jn jo jp jq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/2f2f712ddfdc9ccc8750819de934dbd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*drV71cVHHQkuJBGh."/></div></div></figure><h1 id="6b2c" class="kj kk hh bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">准备本地Kubernetes配置文件</h1><p id="2874" class="pw-post-body-paragraph ip iq hh ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated">在用户/ <current user=""> /中创建配置文件。kube目录，包含Kubernetes集群的服务器地址和在Wercker用户设置中生成的令牌。该文件类似于此屏幕截图:</current></p><figure class="jn jo jp jq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/4e45500649fcb693737c1ea40bb28ff7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Q-tQGQoDKJNoXarq."/></div></div></figure><p id="704b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">通过运行以下示例来验证配置文件的正确性:</p><blockquote class="lm ln lo"><p id="ca68" class="ip iq ki ir b is it iu iv iw ix iy iz lp jb jc jd lq jf jg jh lr jj jk jl jm ha bi translated"><em class="hh">库比特版本</em></p></blockquote><figure class="jn jo jp jq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/bbe881e820eab47c7593f8d0b3a8a807.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RvLNHe4KMwMhTALy."/></div></div></figure><p id="444f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">或者任何其他的库比特命令。</p><h1 id="a792" class="kj kk hh bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">实现要部署到Kubernetes集群上的应用程序</h1><p id="a7a9" class="pw-post-body-paragraph ip iq hh ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated">在本例中，该应用程序是一个非常简单的Node/Express应用程序，它处理两种类型的HTTP请求:对url路径/about的GET请求和对/simple-app的POST请求。这种应用没有什么特别之处——事实上，它完全没有吸引力。该功能包括返回一个结果，证明应用程序已被成功调用，仅此而已。</p><p id="6637" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">应用程序来源于<a class="ae jt" href="https://github.com/lucasjellema/the-simple-app" rel="noopener ugc nofollow" target="_blank">https://github.com/lucasjellema/the-simple-app</a>——主要是文件app.js。</p><p id="e7c9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在实现app.js之后，我可以在本地运行和调用应用程序:</p><figure class="jn jo jp jq fd ii er es paragraph-image"><div class="er es ls"><img src="../Images/a4cfdf56adaf3bc47d2ba0cd537ead95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1338/0*uD2TlPycsR28f4q-."/></div></figure><h1 id="63d4" class="kj kk hh bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">为应用程序创建wercker.yml文件</h1><p id="7140" class="pw-post-body-paragraph ip iq hh ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated">wercker.yml文件为wercker引擎提供了如何执行构建和部署步骤的说明。这一步利用了Wercker构建引擎在运行时提供的参数值，部分来自于在组织、应用程序或管道级别为环境变量定义的值。</p><p id="35a9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这里显示了三条管道:</p><figure class="jn jo jp jq fd ii er es paragraph-image"><div class="er es lt"><img src="../Images/62ef7f681700b0d3cc16fc65c54bb29d.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/0*RS9dCmSBiSS9qgLu."/></div></figure><p id="1109" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="ki">构建</em>管道以节点:6.10 base Docker容器图像为起点。它添加源代码，执行npm安装并生成TLS密钥和证书。<em class="ki">推式发布</em>管道将构建结果(容器图像)存储在配置的容器注册表中。<em class="ki">部署到oke</em>(oke = = Oracle Kubernetes Engine)管道获取容器映像，并使用Kubernetes模板文件将其部署到Kubernetes集群，如该屏幕截图所示。</p><figure class="jn jo jp jq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/58ade321e494acb4451713a46903143c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0SMqdl-quYHeGvLu."/></div></div></figure><p id="9c52" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">除了wercker.yml文件，我们还获得了Kubernetes部署文件的模板，这些模板描述了对Kubernetes的部署。</p></div><div class="ab cl lu lv go lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ha hb hc hd he"><p id="53dc" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="ki">原载于2017年12月2日</em><a class="ae jt" href="https://technology.amis.nl/2017/12/02/oracle-managed-kubernetes-cloud-first-steps-with-automated-deployment-using-wercker-pipelines/" rel="noopener ugc nofollow" target="_blank"><em class="ki">technology . amis . nl</em></a><em class="ki">。</em></p></div></div>    
</body>
</html>