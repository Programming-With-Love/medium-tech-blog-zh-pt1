<html>
<head>
<title>Using Oracle Database with ASP.NET Core Identity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Oracle数据库和ASP.NET核心标识</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/using-oracle-database-with-asp-net-core-identity-3216fab69eb?source=collection_archive---------0-----------------------#2022-02-16">https://medium.com/oracledevs/using-oracle-database-with-asp-net-core-identity-3216fab69eb?source=collection_archive---------0-----------------------#2022-02-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/73edf010838ec97b48d2889a31d0ff06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*VJK9AVxP27s9bi1aftYZlQ.png"/></div></figure><p id="e34d" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><a class="ae jj" href="https://docs.microsoft.com/en-us/aspnet/core/security/authentication/identity" rel="noopener ugc nofollow" target="_blank">ASP.NET核心身份</a>是一个支持用户和角色认证和授权的. NET接口。它管理用户、密码、配置文件、角色和其他属性，并将它们全部存储在一个数据存储中。只需几个简单的步骤，就可以将ASP.NET核心身份配置为使用任何Oracle数据库作为其数据存储，包括Oracle自治数据库。在这篇博文中，我将展示如何配置一个. NET应用程序来集成ASP.NET核心身份和Oracle自治数据库。</p><p id="1a74" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">Oracle数据库和ASP.NET核心身份数据访问通过Oracle Data Provider for进行。NET(ODP.NET)和实体框架核心(EF核心)。我在演示中使用了EF Core 6、Visual Studio 2022和Oracle自治数据库(ADB)。尽管如此，内部部署的Oracle数据库，加上早期的EF Core和Visual Studio版本也支持ASP.NET核心标识，步骤基本相似。</p><p id="c8f0" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">让我们开始吧。</p><h1 id="dd0d" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">创建Oracle ASP.NET核心身份应用程序</h1><ol class=""><li id="93c1" class="ki kj hh in b io kk is kl iw km ja kn je ko ji kp kq kr ks bi translated">在Visual Studio中，创建新的。NET项目。从项目类型列表中选择【ASP.NET T2核心Web App(模型-视图-控制器)】。点击<strong class="in hi">下一个</strong>按钮。</li></ol><figure class="ku kv kw kx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es kt"><img src="../Images/a8b31cb26c550e9f3ef49574fab1c8d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ojHyAwNj-7LituCbU32rdw.png"/></div></div></figure><p id="66b8" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">2.为项目命名，例如“Oracle ASP.NET核心标识示例”。点击<strong class="in hi">下一个</strong>按钮。</p><p id="0525" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">3.选择了。您要使用的. NET运行时版本。我已经选择了。NET 6.0。在<strong class="in hi">认证类型</strong>下，选择“个人账户”然后点击<strong class="in hi">创建</strong>按钮。</p><figure class="ku kv kw kx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es lc"><img src="../Images/cc80971730950b1c2a01ead5f12eef56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6TV6FjiJYsF1-kxoejo4ow.png"/></div></div></figure><p id="7276" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">4.接下来，我们将安装Oracle EF Core来支持对Oracle ADB的数据访问。打开<strong class="in hi">解决方案浏览器</strong>并右键单击“依赖”节点。选择“管理NuGet包…”。在NuGet包管理器中，在NuGet库中搜索<strong class="in hi"> Oracle。EntityFrameworkCore </strong>包。</p><figure class="ku kv kw kx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es ld"><img src="../Images/5f5f14fcdc501f52eef9bb014a5f5b1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EwcCDz1LKGTnb1tum2Llow.png"/></div></div></figure><p id="af6c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">5.选择Oracle EF核心包。如果您使用的是EF Core 6，请选择以主版本6.x开头的Oracle EF Core包。</p><p id="99d3" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">点击右侧的<strong class="in hi">安装</strong>按钮。点击<strong class="in hi"> OK </strong>按钮，完成NuGet包的安装和设置。</p><p id="26e5" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">6.在您项目的<strong class="in hi"> appsettings.json </strong>文件中，用您的ODP.NET连接字符串替换“DefaultConnection”字符串。</p><pre class="ku kv kw kx fd le lf lg lh aw li bi"><span id="cf34" class="lj jl hh lf b fi lk ll l lm ln">"ConnectionStrings": {<br/>    "DefaultConnection": "<strong class="lf hi">User Id=&lt;USER ID&gt;;Password=&lt;PASSWORD&gt;;Data Source=&lt;Data Source&gt;</strong>;"<br/>},</span></pre><p id="5c0c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">对于<strong class="in hi">数据源</strong>，您可以使用完整的Oracle连接描述符、网络服务名或Easy Connect (Plus)。使用网络服务名时，可以将<strong class="in hi"> TNS_ADMIN </strong>操作系统环境变量或者<strong class="in hi"> Tns_Admin </strong>连接字符串属性设置为<strong class="in hi"> tnsnames.ora </strong>和<strong class="in hi"> sqlnet.ora </strong>文件所在的目录。</p><p id="98ca" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">保存文件。</p><p id="d292" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">7.打开项目的<strong class="in hi"> Program.cs </strong>文件，编辑以下代码行:</p><pre class="ku kv kw kx fd le lf lg lh aw li bi"><span id="a009" class="lj jl hh lf b fi lk ll l lm ln">options.<strong class="lf hi">UseSqlServer</strong>(Configuration.GetConnectionString("DefaultConnection")));</span></pre><p id="1506" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">将文本<strong class="in hi"> UseSqlServer </strong>替换为<strong class="in hi"> UseOracle </strong>并保存文件:</p><pre class="ku kv kw kx fd le lf lg lh aw li bi"><span id="28dc" class="lj jl hh lf b fi lk ll l lm ln">options.<strong class="lf hi">UseOracle</strong>(Configuration.GetConnectionString("DefaultConnection")));</span></pre><p id="7b54" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">通过共享Oracle ADB，您可以连接mTLS(需要钱包)或TLS(不需要钱包)。在本教程中，我使用TLS。但是，mTLS是默认值。在之前的博客文章中，我展示了如何配置<a class="ae jj" rel="noopener" href="/oracledevs/securely-connect-net-to-oracle-autonomous-database-without-a-wallet-nor-client-configuration-files-a1438893240a"> Oracle自治数据库，以便在没有钱包</a>的情况下使用TLS。</p><p id="399c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">8.在解决方案资源管理器中，右键单击<strong class="in hi">数据→迁移</strong>文件夹并删除其所有内容。我们将指导EF核心为Oracle数据库创建新的迁移和ASP.NET核心身份模式对象。</p><figure class="ku kv kw kx fd ii er es paragraph-image"><div class="er es lo"><img src="../Images/f36858815d1f39b72892fe328c49fb84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*06yfIx1UvvSpL6GENhKadA.png"/></div></figure><p id="7f10" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">9.在Visual Studio中打开<strong class="in hi">包管理器控制台</strong>。在提示符下执行以下EF核心迁移命令:</p><pre class="ku kv kw kx fd le lf lg lh aw li bi"><span id="2a0d" class="lj jl hh lf b fi lk ll l lm ln">add-migration CreateASPNETCoreIdentitySchema -OutputDir Data\Migrations</span></pre><p id="80fa" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">成功执行后，输出将类似于以下内容。</p><figure class="ku kv kw kx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es lp"><img src="../Images/1e965daebf33c755ad3794c41f87a484.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ruW7f1-ca8R-Fz5olMYHXg.png"/></div></div></figure><p id="29b2" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">10.在<strong class="in hi">程序包管理器控制台</strong>中执行以下命令，将迁移应用到Oracle数据库，这将创建ASP.NET核心身份模式对象:</p><pre class="ku kv kw kx fd le lf lg lh aw li bi"><span id="5a06" class="lj jl hh lf b fi lk ll l lm ln">update-database</span></pre><p id="7214" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">您的设置现在已经完成。</p><h1 id="4a57" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">运行Oracle ASP.NET核心身份应用程序</h1><p id="a65f" class="pw-post-body-paragraph il im hh in b io kk iq ir is kl iu iv iw lq iy iz ja lr jc jd je ls jg jh ji ha bi translated">让我们尝试使用web应用程序来验证它是否按照预期在Oracle数据库中存储了身份数据。我们将创建一个新的应用程序用户，然后以该用户身份登录。</p><ol class=""><li id="68b5" class="ki kj hh in b io ip is it iw lt ja lu je lv ji kp kq kr ks bi translated">在Visual Studio中，通过单击浅绿色箭头“启动而不调试”或按Ctrl-F5来运行应用程序。</li><li id="7a34" class="ki kj hh in b io lw is lx iw ly ja lz je ma ji kp kq kr ks bi translated">应用程序的欢迎页面将会出现。点击右上角的“注册”链接，开始创建新的应用程序用户。</li></ol><figure class="ku kv kw kx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es mb"><img src="../Images/ac5e7e02453d866e616a7fd60cfe84b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ocGo6vl-ryT9m8k7iKfhEQ.png"/></div></div></figure><p id="e723" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">3.使用电子邮件和密码创建一个用户帐户。完成后点击<strong class="in hi">注册</strong>按钮。</p><figure class="ku kv kw kx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es mc"><img src="../Images/732e585db1b11cda065ac786b7d02bc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V-J2z0Xnppme60eUeFHGaQ.png"/></div></div></figure><p id="7e29" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">4.现在将出现注册确认页面。</p><figure class="ku kv kw kx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es md"><img src="../Images/d5e74ab8ae43a9bfb749f2c77e6645f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L9oqWOkWJGZ7a-VjQuwLEw.png"/></div></div></figure><p id="a0ca" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">单击“单击此处确认您的帐户”链接完成注册。</p><p id="0fc3" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">5.账户确认后，点击右上角的“登录”链接。</p><figure class="ku kv kw kx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es me"><img src="../Images/a7e9d77c2e9b99b8f9ee2e22bdf6880f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*25YiJqPYnKqEFm6pVJTa-Q.png"/></div></div></figure><p id="b040" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">6.填写新用户的电子邮件和密码信息。接下来，单击“登录”按钮。</p><figure class="ku kv kw kx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es mf"><img src="../Images/c73636b9d5ab062fcd51412c5355788b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dx-SJI3UrcdnvdGheFSxhA.png"/></div></div></figure><p id="cb17" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">7.您现在将作为新用户登录。</p><figure class="ku kv kw kx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es mg"><img src="../Images/e8cc696df5e52bb9db667aaa08c63600.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1IXHLdDDzo-9plPyNis_ag.png"/></div></div></figure><p id="58aa" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">8.要浏览新创建的Oracle模式对象，请使用Oracle Developer Tools for Visual Studio或类似的数据库工具集。</p><figure class="ku kv kw kx fd ii er es paragraph-image"><div class="er es mh"><img src="../Images/ca1ae84d11c16cc1cdabf0b89a46df4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*M4ZB2qNWlPu70B4sMPXfXA.png"/></div></figure><p id="610a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">恭喜你！现在，您可以将ASP.NET核心身份功能用于Oracle数据库。</p><h1 id="4575" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">立即开始使用Oracle云免费层</h1><p id="71f1" class="pw-post-body-paragraph il im hh in b io kk iq ir is kl iu iv iw lq iy iz ja lr jc jd je ls jg jh ji ha bi translated">您可以通过注册<a class="ae jj" href="https://www.oracle.com/cloud/free/?source=:ex:tb:::::RC_WWMK220210P00062:Medium_aspodbk&amp;SC=:ex:tb:::::RC_WWMK220210P00062:Medium_aspodbk&amp;pcode=WWMK220210P00062" rel="noopener ugc nofollow" target="_blank"> Oracle云免费层</a>在Oracle ADB免费试用本教程。</p><p id="3831" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如果你对甲骨文开发人员在他们的自然栖息地发生的事情感到好奇，请加入我们的<a class="ae jj" href="https://join.slack.com/t/oracledevrel/shared_invite/zt-uffjmwh3-ksmv2ii9YxSkc6IpbokL1g?customTrackingParam=:ex:tb:::::Medium_aspodbk" rel="noopener ugc nofollow" target="_blank">公共休闲频道</a>！</p></div></div>    
</body>
</html>