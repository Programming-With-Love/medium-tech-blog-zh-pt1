<html>
<head>
<title>Mocking Server API On Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Mocking Server API On Kubernetes</h1>
<blockquote>原文：<a href="https://medium.easyread.co/mocking-server-api-on-kubernetes-963bdeb40297?source=collection_archive---------1-----------------------#2022-11-30">https://medium.easyread.co/mocking-server-api-on-kubernetes-963bdeb40297?source=collection_archive---------1-----------------------#2022-11-30</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="d223" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">Mocking API guna memudahkan proses software development secara simultan</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/e71e90dc2f3dd2a99a59255103be264a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zMxlndxZV0Tcng2v"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@flowforfrank?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ferenc Almasi</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="86e5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Hai Semua, Saya ini berbagi sebuah tools untuk memudahkan proses <em class="lp"> software development </em> antara tim backend dan tim frontend agar bisa mengerjakan secara simultan</p><p id="8aef" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Dalam dunia software engineer kita mengenal mock-api dan juga api-contract keduanya adalah metode dalam merancang sebuah api agar bisa dikerjakan secara simultan, ada beberapa tools yang bisa digunakan untuk kedua metode tersebut dan pada artikel ini menggunakan tools <em class="lp"> prism </em> sebagai mock-api server serta <em class="lp"> swagger-ui </em> untuk api list nya.</p><p id="6317" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Pada artikel ini saya ingin berbagi Install Mock-API server pada artikel ini menggunakan (Prism)[ <a class="ae ks" href="https://github.com/stoplightio/prism" rel="noopener ugc nofollow" target="_blank"> https://github.com/stoplightio/prism </a> ] serta Swagger-UI untuk melihat list API kedua tools ini dijalankan diatas kubernetes</p><h1 id="a5c8" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">Prerequisite</h1><ul class=""><li id="52d4" class="mi mj in kv b kw mk kz ml lc mm lg mn lk mo lo mp mq mr ms bi translated">Kubernetes Cluster Version 1.23.x Or Newer</li><li id="12c9" class="mi mj in kv b kw mt kz mu lc mv lg mw lk mx lo mp mq mr ms bi translated">Kubectl Version 1.18.x Or Newer</li></ul><h1 id="64f5" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">Mock-API</h1><ul class=""><li id="2582" class="mi mj in kv b kw mk kz ml lc mm lg mn lk mo lo mp mq mr ms bi translated">Siapkan API Document dengan format OpenAPI Document dengan nama api.yaml</li></ul><pre class="kd ke kf kg gt my mz na bn nb nc bi"><span id="3fdf" class="nd lr in mz b be ne nf l ng nh">   openapi: 3.0.0<br/>      info:<br/>        description: 'This is a sample server Petstore server.  You can find out more about     Swagger<br/>          at [http://swagger.io](http://swagger.io) or on [irc.freenode.net, #swagger](http://swagger.io/irc/).      For<br/>          this sample, you can use the api key `special-key` to test the authorization     filters.'<br/>        version: 1.0.0<br/>        title: Swagger Petstore<br/>        termsOfService: http://swagger.io/terms/<br/>        contact:<br/>          email: apiteam@swagger.io<br/>        license:<br/>          name: Apache 2.0<br/>          url: http://www.apache.org/licenses/LICENSE-2.0.html<br/>      paths:<br/>        "/no_auth/pets":<br/>          get:<br/>            tags:<br/>            - pet<br/>            summary: Get all pets<br/>            description: ''<br/>            operationId: getPets<br/>            parameters:<br/>            - in: query<br/>              name: name<br/>              schema:<br/>                type: string<br/>              description: ''<br/>              required: true<br/>            security: []<br/>            responses:<br/>              '200':<br/>                description: ''<br/>                content:<br/>                  application/json:<br/>                    schema:<br/>                      type: array<br/>                      items:<br/>                        "$ref": "#/components/schemas/Pet"<br/>                      example:<br/>                      - name: a_name<br/>                        photoUrls: []<br/>              '401':<br/>                description: Authorization information is missing or invalid.<br/>          post:<br/>            tags:<br/>            - pet<br/>            summary: Add a new pet to the store<br/>            description: ''<br/>            operationId: addPet<br/>            requestBody:<br/>              "$ref": "#/components/requestBodies/Pet"<br/>            responses:<br/>              '405':<br/>                description: Invalid input<br/>            security: []<br/>        <br/>          get:<br/>            tags:<br/>            - user<br/>            summary: Get user by user name<br/>            description: ''<br/>            operationId: getUserByName<br/>            parameters:<br/>            - name: username<br/>              in: path<br/>              description: 'The name that needs to be fetched. Use user1 for testing. '<br/>              required: true<br/>              schema:<br/>                type: string<br/>            responses:<br/>              '200':<br/>                description: successful operation<br/>                content:<br/>                  application/json; charset=utf-8:<br/>                    schema:<br/>                      "$ref": "#/components/schemas/User"<br/>              '400':<br/>                description: Invalid username supplied<br/>              '404':<br/>                description: User not found<br/>          put:<br/>            tags:<br/>            - user<br/>            summary: Updated user<br/>            description: This can only be done by the logged in user.<br/>            operationId: updateUser<br/>            parameters:<br/>            - name: username<br/>              in: path<br/>              description: name that need to be updated<br/>              required: true<br/>              schema:<br/>                type: string<br/>            requestBody:<br/>              content:<br/>                application/json:<br/>                  schema:<br/>                    "$ref": "#/components/schemas/User"<br/>              description: Updated user object<br/>              required: true<br/>            responses:<br/>              '400':<br/>                description: Invalid user supplied<br/>              '404':<br/>                description: User not found<br/>          delete:<br/>            tags:<br/>            - user<br/>            summary: Delete user<br/>            description: This can only be done by the logged in user.<br/>            operationId: deleteUser<br/>            parameters:<br/>            - name: username<br/>              in: path<br/>              description: The name that needs to be deleted<br/>              required: true<br/>              schema:<br/>                type: string<br/>            responses:<br/>              '400':<br/>                description: Invalid username supplied<br/>              '404':<br/>                description: User not found<br/>      components:<br/>        requestBodies:<br/>          UserArray:<br/>            content:<br/>              application/json:<br/>                schema:<br/>                  type: array<br/>                  items:<br/>                    "$ref": "#/components/schemas/User"<br/>            description: List of user object<br/>            required: true<br/>          Pet:<br/>            content:<br/>              application/json:<br/>                schema:<br/>                  "$ref": "#/components/schemas/Pet"<br/>            description: Pet object that needs to be added to the store<br/>            required: true<br/>        securitySchemes:<br/>          petstore_auth:<br/>            type: oauth2<br/>            flows:<br/>              implicit:<br/>                authorizationUrl: http://petstore.swagger.io/oauth/dialog<br/>                scopes:<br/>                  write:pets: modify pets in your account<br/>                  read:pets: read your pets<br/>          api_key:<br/>            type: apiKey<br/>            name: api_key<br/>            in: header<br/>        schemas:<br/>            type: object<br/>            properties:<br/>              id:<br/>                type: integer<br/>                format: int64<br/>              name:<br/>                type: string<br/>            xml:<br/>              name: Tag<br/>          Pet:<br/>            type: object<br/>            required:<br/>            - name<br/>            - photoUrls<br/>            properties:<br/>              id:<br/>                type: integer<br/>                format: int64<br/>              category:<br/>                "$ref": "#/components/schemas/Category"<br/>              name:<br/>                type: string<br/>                example: doggie<br/>              photoUrls:<br/>                type: array<br/>                xml:<br/>                  name: photoUrl<br/>                  wrapped: true<br/>                items:<br/>                  type: string<br/>              tags:<br/>                type: array<br/>                xml:<br/>                  name: tag<br/>                  wrapped: true<br/>                items:<br/>                  "$ref": "#/components/schemas/Tag"<br/>              status:<br/>                type: string<br/>                description: pet status in the store<br/>                enum:<br/>                - available<br/>                - pending<br/>                - sold<br/>            xml:<br/>              name: Pet<br/>          ApiResponse:<br/>            type: object<br/>            properties:<br/>              code:<br/>                type: integer<br/>                format: int32<br/>              type:<br/>                type: string<br/>              message:<br/>                type: string</span></pre><ul class=""><li id="82ec" class="mi mj in kv b kw kx kz la lc ni lg nj lk nk lo mp mq mr ms bi translated">Create Namespace mock-api dan deploy configmaps-nya</li></ul><pre class="kd ke kf kg gt my mz na bn nb nc bi"><span id="2c3d" class="nd lr in mz b be ne nf l ng nh">kubectl create ns mock-api </span></pre><pre class="nl my mz na bn nb nc bi"><span id="dfcc" class="nd lr in mz b be ne nf l ng nh">kubectl create configmap open-api --from-file=api.yaml</span></pre><ul class=""><li id="7de9" class="mi mj in kv b kw kx kz la lc ni lg nj lk nk lo mp mq mr ms bi translated">Deploy Mock-api dengan menggunakan configuration berikut dan apply</li></ul><pre class="kd ke kf kg gt my mz na bn nb nc bi"><span id="1ca5" class="nd lr in mz b be ne nf l ng nh">---<br/> apiVersion: apps/v1<br/> kind: Deployment<br/> metadata:<br/>   name: prism<br/>   namespace: mock-api<br/> spec:<br/>   selector:<br/>     matchLabels:<br/>       app.kubernetes.io/name: prism<br/>       app.kubernetes.io/part-of: openapi-mocks<br/>   template:<br/>     metadata:<br/>       labels:<br/>         app.kubernetes.io/name: prism<br/>         app.kubernetes.io/part-of: openapi-mocks<br/>     spec:<br/>       volumes:<br/>         - name: openapi<br/>           configMap:<br/>             name: openapi<br/>             items:<br/>             - key: api.yaml<br/>               path: api.yaml<br/>       containers:<br/>       - name: prism<br/>         image: stoplight/prism:4<br/>         volumeMounts:<br/>           - name: openapi<br/>             mountPath: /api-doc<br/>         args:<br/>           - mock<br/>           - -h <br/>           - "0.0.0.0"<br/>           - -d<br/>           - "/api-doc/api.yaml"<br/>---<br/> apiVersion: v1<br/> kind: Service<br/> metadata:<br/>   name: prism<br/>   namespace: mock-api<br/> spec:<br/>   type: ClusterIP<br/>   ports:<br/>     - name: http<br/>       protocol: TCP<br/>       port: 80<br/>       targetPort: 4010<br/>   selector:<br/>     app.kubernetes.io/name: prism<br/>     app.kubernetes.io/part-of: openapi-mocks</span></pre><pre class="nl my mz na bn nb nc bi"><span id="6fc3" class="nd lr in mz b be ne nf l ng nh">kubectl apply -f deployment.yaml -n mock-api</span></pre><h1 id="e3a7" class="lq lr in bd ls lt lu lv lw lx ly lz ma jt mb ju mc jw md jx me jz mf ka mg mh bi translated">Swagger-UI</h1><p id="b526" class="pw-post-body-paragraph kt ku in kv b kw mk jo ky kz ml jr lb lc nm le lf lg nn li lj lk no lm ln lo ig bi translated">Untuk melihat seluruh list yang ada pada dokument api kita butuh dashboard/UI untuk menampilkannya pada artikel ini kita menggunakan swagger sebagai UI untuk melihat list api yang ada pada dokumen.</p><ul class=""><li id="01b2" class="mi mj in kv b kw kx kz la lc ni lg nj lk nk lo mp mq mr ms bi translated">Swagger-UI menggunaka configmaps untuk api document yang sama dengan mock-apinya, selain itu juga swagger-ui membutuhkan configmaps juga untuk config url pada swagger-ui berikut adalah configmap-nya</li></ul><pre class="kd ke kf kg gt my mz na bn nb nc bi"><span id="985d" class="nd lr in mz b be ne nf l ng nh">apiVersion: v1<br/>kind: ConfigMap<br/>metadata:<br/>  name: swagger<br/>  namespace: mock-api<br/>data:<br/>  swagger.json: |-<br/>    [<br/>        {"name": "Contoh API Document", <br/>        "url": "documentation/api.yaml"}<br/>    ]</span></pre><ul class=""><li id="7dc1" class="mi mj in kv b kw kx kz la lc ni lg nj lk nk lo mp mq mr ms bi translated">Deploy swagger-ui dengan configuration berikut</li></ul><pre class="kd ke kf kg gt my mz na bn nb nc bi"><span id="086e" class="nd lr in mz b be ne nf l ng nh">---<br/> apiVersion: apps/v1<br/> kind: Deployment<br/> metadata:<br/>   name: swegger-ui<br/>   namespace: mock-api<br/> spec:<br/>   selector:<br/>     matchLabels:<br/>       app.kubernetes.io/name: swegger-ui<br/>       app.kubernetes.io/part-of: openapi-mocks<br/>   template:<br/>     metadata:<br/>       labels:<br/>         app.kubernetes.io/name: swegger-ui<br/>         app.kubernetes.io/part-of: openapi-mocks<br/>     spec:<br/>       volumes:<br/>         - name: openapi<br/>           configMap:<br/>             name: openapi<br/>             items:<br/>             - key: api.yaml<br/>               path: api.yaml<br/>       containers:<br/>       - name: swegger-ui<br/>         image: swaggerapi/swagger-ui<br/>         volumeMounts:<br/>           - name: openapi<br/>             mountPath: /usr/share/nginx/html/docs<br/>         env: <br/>            - name: URLS<br/>              valueFrom:<br/>                configMapKeyRef:<br/>                  name: swagger<br/>                  key: swagger.json<br/>---<br/> apiVersion: v1<br/> kind: Service<br/> metadata:<br/>   name: swegger-ui<br/>   namespace: mock-api<br/> spec:<br/>   type: ClusterIP<br/>   ports:<br/>     - name: http<br/>       protocol: TCP<br/>       port: 80<br/>       targetPort: 8080<br/>   selector:<br/>     app.kubernetes.io/name: swegger-ui</span></pre><p id="8a42" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Sekian Tutorial dari saya, jika banyak kurangnya saya mohon maaf</p><p id="0cd2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Terima kasih</p></div></div>    
</body>
</html>