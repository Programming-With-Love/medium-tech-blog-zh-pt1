<html>
<head>
<title>Fusing 8th Wall and react-three-fiber</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">融合第八壁和反应三纤维</h1>
<blockquote>原文：<a href="https://medium.com/globant/fusing-8th-wall-and-react-three-fiber-ac617186c9cd?source=collection_archive---------1-----------------------#2020-07-31">https://medium.com/globant/fusing-8th-wall-and-react-three-fiber-ac617186c9cd?source=collection_archive---------1-----------------------#2020-07-31</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="616f" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">构建AR Web应用程序的强大组合。</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/3757fd2bb8c15d8916a7e13fb81aaffd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nYKwpSKssaZYKVj6c7nfLA.jpeg"/></div></div></figure><p id="be25" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">构建Web增强现实体验的一个强大组合是在8号墙平台上使用ThreeJS框架。</p><p id="98d5" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><a class="ae ke" href="https://www.8thwall.com/docs/web/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hi">第八壁</strong> </a>是一个非常强大的平台，帮助你快速编写AR应用。它的AR引擎在网络浏览器中为你提供图像检测、表面检测、人脸检测等<strong class="jk hi">功能。</strong></p><p id="5d3f" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><a class="ae ke" href="https://github.com/mrdoob/three.js/" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hi"> ThreeJS </strong> </a>另一方面是流行的Javascript 3D库<strong class="jk hi">。</strong>它使您能够在web应用程序中创建3D对象。</p><p id="783b" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">需要注意的是，ThreeJS是一个<strong class="jk hi">命令式javascript API </strong>。我更像是ReactJS的粉丝，喜欢用声明式语法进行开发。</p><p id="6141" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这就是<strong class="jk hi"> </strong> <a class="ae ke" href="https://github.com/react-spring/react-three-fiber" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hi">做出反应的地方——三纤【R3F】</strong></a><strong class="jk hi"/>前来救援。这是一个针对三个j<strong class="jk hi">的React协调器。它使你能够构建三个JS对象作为声明性的可重用组件。所有酷且强大的React生态系统都会为您解锁，并且它还支持开箱即用的交互性。</strong></p><p id="6f66" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">要继续这篇文章，你需要对第八墙平台、ThreeJS和R3F有一个基本的了解</p><p id="8b09" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">当我开始用ThreeJS探索第八堵墙时，所有的例子或讨论都是命令式的。他们工作得非常出色，令人惊叹。但是我很想用声明的方式重写它们。</p><p id="8436" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">我试图查找是否有任何现有的实现可以一起使用第八墙和R3F，但找不到一个。</p><p id="af45" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">嗯，然后我决定自己来做🚀</p><p id="b1db" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">下面是一个基本的实现，在这个实现中，我试图呈现一张卡片的相关细节。起初，它是以命令的方式实现的，然后我能够以声明性的方式重写它<strong class="jk hi">，而不会失去任何能力</strong>。事实上，它使我能够用更好的控制和更干净的方式来写它。</p><p id="787e" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这里第八面墙帮助我检测卡片和它的位置。基于这些信息，我正在渲染围绕它的三个JS对象，它们是用R3F实现的。</p><ul class=""><li id="7aca" class="kf kg hh jk b jl jm jo jp jr kh jv ki jz kj kd kk kl km kn bi translated">这是一个网络应用程序。</li><li id="89d4" class="kf kg hh jk b jl ko jo kp jr kq jv kr jz ks kd kk kl km kn bi translated">每个元素都是一个反应成分。</li></ul><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es kt"><img src="../Images/43b16e33398a4df6f71d1b815bc36e20.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/1*I_XOcWkG1lilqOAFeFKf0Q.gif"/></div></figure></div><div class="ab cl ku kv go kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ha hb hc hd he"><h1 id="bf11" class="lb lc hh bd ld le lf lg lh li lj lk ll in lm io ln iq lo ir lp it lq iu lr ls bi translated">我的项目需要两个主要的改变。</h1><h2 id="acd8" class="lt lc hh bd ld lu lv lw lh lx ly lz ll jr ma mb ln jv mc md lp jz me mf lr mg bi translated">1.画布组件的使用。</h2><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/c0eff78a91b2dc48d0d8dcceb9c39355.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kChNJ_vHPDkoDPD6kqjIzA.jpeg"/></div></div></figure><p id="9e58" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">所有的Web AR应用都在<em class="mh"> &lt; canvas / &gt; </em>标签上工作。</p><p id="1092" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">第八面墙也需要一个。</p><p id="01a2" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">所有第8个Wall示例都有一个<em class="mh"> &lt; canvas / &gt; </em>标签，当应用程序初始化时，它会获取这个canvas的一个引用，以开始绘制相机馈送。</p><p id="25c4" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><strong class="jk hi">但是当你想使用R3F的时候，你不需要自己写<em class="mh"> &lt;【画布】/ &gt; </em>标签。</strong></p><p id="d374" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">它附带了一个画布组件，这是我们进入ThreeJS的门户。</p><p id="3efc" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这个组件负责呈现我们所有的声明性ThreeJS组件。</p><p id="8501" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">您的组件将如下所示:</p><pre class="ix iy iz ja fd mi mj mk ml aw mm bi"><span id="567a" class="lt lc hh mj b fi mn mo l mp mq"><strong class="mj hi">import { Canvas } from 'react-three-fiber'</strong></span><span id="efe4" class="lt lc hh mj b fi mr mo l mp mq">return (</span><span id="8a06" class="lt lc hh mj b fi mr mo l mp mq">    <strong class="mj hi">&lt;Canvas&gt;<br/>        <br/>    &lt;/Canvas&gt;</strong></span><span id="2ecb" class="lt lc hh mj b fi mr mo l mp mq">)</span></pre><p id="9df4" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><strong class="jk hi">这个Canvas组件在内部呈现一个<em class="mh"> &lt; canvas / &gt; </em>标签。</strong></p><p id="f804" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">因此，作为我们集成的一部分，我们需要将这个<em class="mh"> &lt; canvas / &gt; </em>标签的引用附加到第8个Wall实现。</p><p id="43ca" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">最简单的方法是抓取<em class="mh"> &lt;画布/ &gt; </em>元素的引用如下:</p><pre class="ix iy iz ja fd mi mj mk ml aw mm bi"><span id="3e46" class="lt lc hh mj b fi mn mo l mp mq">// grabbing reference of canvas<br/>let canvasEl = document.getElementsByTagName(‘canvas’)[0]</span><span id="3405" class="lt lc hh mj b fi mr mo l mp mq">//attaching canvas reference to 8th Wall<br/>XR8.run({ canvas: canvasEl})</span></pre><p id="1393" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">为了使这一步正常工作，您可能需要使用<em class="mh"> XRExtras来<strong class="jk hi">避免</strong> <strong class="jk hi">。在你的第八层墙设置中使用fullwindowcanvas . pipeline module()</strong></em>，并<strong class="jk hi">设置canvasEl </strong>的样式，使其全屏显示。</p><h2 id="71c4" class="lt lc hh bd ld lu lv lw lh lx ly lz ll jr ma mb ln jv mc md lp jz me mf lr mg bi translated">2.在第八墙和R3F之间共享三个JS资源。</h2><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/2636a3975895212dde3a2dc1f493f261.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OPN9fEn2K6FT5MuX2HVF8Q.jpeg"/></div></div></figure><p id="8678" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这是集成的主要部分。</p><p id="0415" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">一个ThreeJS应用程序处理关键对象，如场景、相机和渲染器。</p><p id="bb74" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">8号墙初始化了自己的一组资源来和ThreeJS一起工作，R3F也创建了自己的资源。因此，在这一步中，我们希望能够让它们在同一组资源上工作。我们在步骤1中让它们在同一个<em class="mh"> &lt;画布/ &gt; </em>标签上工作的方式。</p><p id="646b" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">我观察到第八道墙没有自己的资源无法工作，因此我们将要求R3F使用第八道墙的资源。</p><p id="7310" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">第八堵墙的ThreeJS资源集可通过以下方式生成:</p><pre class="ix iy iz ja fd mi mj mk ml aw mm bi"><span id="fa02" class="lt lc hh mj b fi mn mo l mp mq"><em class="mh">const { camera, scene } = XR8.Threejs.xrScene()</em></span></pre><p id="093c" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">现在，我们将把这些资源传递给画布中的应用程序组件:</p><pre class="ix iy iz ja fd mi mj mk ml aw mm bi"><span id="206b" class="lt lc hh mj b fi mn mo l mp mq">import { Canvas } from 'react-three-fiber'</span><span id="4536" class="lt lc hh mj b fi mr mo l mp mq">return (</span><span id="afff" class="lt lc hh mj b fi mr mo l mp mq">    &lt;Canvas&gt;<br/>        &lt;App<br/>            <strong class="mj hi">scene={scene}<br/>            camera={camera}</strong><br/>        /&gt;<br/>    &lt;/Canvas&gt;</span><span id="6bef" class="lt lc hh mj b fi mr mo l mp mq">)</span></pre><p id="9f93" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><strong class="jk hi"> App.js </strong>是我们进行整合的地方<strong class="jk hi"> : </strong></p><pre class="ix iy iz ja fd mi mj mk ml aw mm bi"><span id="0fa3" class="lt lc hh mj b fi mn mo l mp mq">import React, { useRef, useEffect } from ‘react’<br/>import { useThree } from ‘react-three-fiber’</span><span id="af0f" class="lt lc hh mj b fi mr mo l mp mq">const App = (props) =&gt; {<br/>    const { scene, camera } = props<br/>    const { setDefaultCamera } = useThree()</span><span id="7d2d" class="lt lc hh mj b fi mr mo l mp mq"><br/>    // ref to root of our ThreeJS app<br/>    const appRef = useRef()<br/></span><span id="f189" class="lt lc hh mj b fi mr mo l mp mq"><br/>    // add our app to 8thWall's ThreeJS scene<br/>    useEffect(() =&gt; {<br/>        if(scene) {<br/>            <strong class="mj hi">scene.add(appRef.current)</strong><br/>        }<br/>    }, [scene])</span><span id="6c74" class="lt lc hh mj b fi mr mo l mp mq"><br/>    // set 8thWall's ThreeJS camera as default camera of <br/>    // react-three-fiber<br/>    useEffect(() =&gt; {<br/>        if(camera) {<br/>            <strong class="mj hi">setDefaultCamera(camera)</strong><br/>        }<br/>    }, [camera, setDefaultCamera])</span><span id="8786" class="lt lc hh mj b fi mr mo l mp mq">    return (<br/>        &lt;group <strong class="mj hi">ref={appRef}</strong> visible={true}&gt;<br/>            {... your R3F components}<br/>        &lt;/group&gt;<br/>    )<br/>}</span></pre><p id="1465" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">现在我们的R3F应用程序将开始出现在第八墙的三个j世界中。</p><h1 id="0ee7" class="lb lc hh bd ld le ms lg lh li mt lk ll in mu io ln iq mv ir lp it mw iu lr ls bi translated">好处？</h1><p id="3ea1" class="pw-post-body-paragraph ji jj hh jk b jl mx ii jn jo my il jq jr mz jt ju jv na jx jy jz nb kb kc kd ha bi translated">一旦这种集成成功了，我就能够以声明的方式用更少的代码很快地重写我的第8墙项目。</p><p id="78ef" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">现在，我可以更专注于在第八墙世界中编写快速而又酷的ThreeJS对象，而不是对命令式代码的复杂性感到沮丧。</p><p id="4b0b" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">希望这篇文章对你有帮助。编码快乐！</p></div></div>    
</body>
</html>