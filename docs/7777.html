<html>
<head>
<title>VBA Project Locked; Project is Unviewable</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">VBA项目已锁定；项目不可见</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/vba-project-locked-project-is-unviewable-4d6a0b2e7cac?source=collection_archive---------1-----------------------#2019-04-24">https://medium.com/walmartglobaltech/vba-project-locked-project-is-unviewable-4d6a0b2e7cac?source=collection_archive---------1-----------------------#2019-04-24</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="8feb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">作者:凯莉·罗伯茨(<a class="ae jc" href="https://twitter.com/OrOneEqualsOne" rel="noopener ugc nofollow" target="_blank"> @OrOneEqualsOne </a>)</p><p id="24ff" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以保护MS Office文档中的宏(VBA代码)在VBA编辑器中不被看到。大多数人都知道密码保护你的代码的选项，但是这个可以被绕过，就像这篇博客中显示的那样。还有一个无密码保护选项，简单地告诉用户项目被锁定，并且“不可查看”，如下图所示。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/e6b4ffc0c9c023a5ebffb08e81524380.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qusQTQYYgdblT1X-va5Enw.png"/></div></div></figure><p id="1ab4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">不可查看选项不能通过MS office应用程序本身设置，而是需要在保存文件后对其进行修改。这个特性在这里的Office文件<a class="ae jc" href="https://docs.microsoft.com/en-us/openspecs/office_file_formats/ms-ovba/dfd72140-85a6-4f25-8a17-70a89c00db8c" rel="noopener ugc nofollow" target="_blank">中被记录为项目流的<em class="jp">项目保护状态</em>和<em class="jp">项目可视状态</em>属性。</a></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jq"><img src="../Images/4d42b5e15e05a9d078545edbfae04547.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GJFUw1f-lWp9a5Y-3vi_Ww.png"/></div></div></figure><p id="2449" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jp"> ProjectProtectionState </em>和<em class="jp"> ProjectVisibilityState </em>属性是加密的数据结构，但事实证明，如果您将它们设置为任意值，它将保护文档并使其锁定/不可见。如果您只更改了<em class="jp">项目可见性状态</em>，它仍然会显示项目结构，但是不允许查看单独的代码模块。如果您同时更改了这两个选项，在尝试展开项目的根目录时，您将立即得到锁定/不可查看的消息，并且将无法看到项目结构。</p><p id="7888" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里有一个关于如何将office文档更改为锁定/不可见的<a class="ae jc" href="https://ratexcel.wordpress.com/2017/03/22/how-to-really-protect-your-code-making-vba-project-unviewable/" rel="noopener ugc nofollow" target="_blank">演示，但是我想提供一个自动化的解决方案。自动化解决方案的一个主要优点是，它不仅可以设置这种保护，还可以从任何文档中删除这种保护。我在Stan Hegt的(</a><a class="ae jc" href="https://twitter.com/StanHacked" rel="noopener ugc nofollow" target="_blank">@ Stan hacked</a>)<a class="ae jc" href="https://github.com/outflanknl/EvilClippy" rel="noopener ugc nofollow" target="_blank">evil clippy</a>工具中加入了这个功能，可以如下使用。</p><p id="9be9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要设置锁定/不可见属性，请使用“-u”选项:</p><p id="3c92" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">EvilClippy.exe-u macro file . doc</strong></p><p id="66b9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要删除锁定/不可见的属性，请使用'-uu '选项:</p><p id="b589" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">EvilClippy.exe-uu宏文件. doc </strong></p><p id="7df5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您也可以移除未使用EvilClippy锁定的文件的锁定/不可见属性。</p><p id="c12d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这项研究之前，使VBA项目锁定/不可见的更改据说是不可逆的，但我发现，如果您通过将<a class="ae jc" href="https://docs.microsoft.com/en-us/openspecs/office_file_formats/ms-ovba/20f4aad3-b646-4311-8301-5948fb1c2ded" rel="noopener ugc nofollow" target="_blank"><em class="jp">Project clsid</em></a><em class="jp"/>设置为全零并使用<em class="jp">ProjectProtectionState</em>(CMG)、<em class="jp">ProjectVisibilityState</em>(GC)和<em class="jp"> ProjectPassword </em> (DPB)的有效值来模拟受密码保护的文档，您可以撤销这种保护。</p><p id="8c40" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">ID = { 000000000–0000–0000–0000–000000000 }</strong></p><p id="eb56" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">CMG = CAC 866 be 34 c 234 c 230 c 630 c 6<br/>DPB = 94963888 c 84 Fe 54 Fe 5b 01 b 50 e 59251526 Fe 67 a1 cc 76 c 84 ed 0 dad 653 FD 058 f 324 bfd 9d 38 de 37<br/>GC = 5 e 5 cf 2c 27646414741474</strong></p><p id="d33d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以上是将撤销保护的值，但是因为MS Office复合文件二进制格式(CFBF)对数据长度变化很敏感，所以您最好的选择是让<a class="ae jc" href="https://github.com/outflanknl/EvilClippy" rel="noopener ugc nofollow" target="_blank">evilippy</a>为您进行这些更改。</p><p id="9867" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">额外的好处:evicippy '-uu '选项还取消了VBA项目的任何密码保护。</p></div></div>    
</body>
</html>