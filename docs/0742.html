<html>
<head>
<title>Inspecting Performance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">检查性能</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/inspecting-performance-95b76477a3d7?source=collection_archive---------0-----------------------#2022-08-15">https://medium.com/androiddevelopers/inspecting-performance-95b76477a3d7?source=collection_archive---------0-----------------------#2022-08-15</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/7af113142bcf8c676608f31f4ba68afe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pYhUVEoLr0N1nr7x"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Illustration by Claudia Sanchez</figcaption></figure><p id="1494" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">这篇关于<strong class="iv hi">检查性能</strong>的MAD技巧文章向您介绍了有助于提高代码性能的工具和方法。当您检查性能时，请确保您的应用程序中发生的事情与您预期的一致。</p><p id="d07d" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">你也可以把这篇文章当做一个疯狂的技能视频来看。</p><figure class="jr js jt ju fd ii"><div class="bz dy l di"><div class="jv jw l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">MAD Skills — Inspecting Performance</figcaption></figure><p id="83d1" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">检查性能是为了确保应用程序中发生的事情符合您的预期。</p><p id="f0b2" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">我们将绩效检查分为三个阶段:被动、手动和自动。每一个都有自己的发光的地方和被利用的理由。</p><h1 id="2db4" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">被动性能检查</h1><p id="c053" class="pw-post-body-paragraph it iu hh iv b iw kv iy iz ja kw jc jd je kx jg jh ji ky jk jl jm kz jo jp jq ha bi translated">当我们谈到被动性能检查时，我们的意思是除了运行它并查看现有的输出之外，没有发现性能问题所必需的额外工作。在直接与应用程序交互时，可以看到一些问题，如冻结帧和缓慢的行为。这可以帮助您找到应用程序需要改进的地方，尤其是在CPU能力或RAM等规格较低的设备上运行应用程序时。</p><p id="1008" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">接下来运行应用程序并直接在屏幕上评估jank，您可以使用<strong class="iv hi"> logcat </strong>检查速度慢和掉帧的情况，这些情况会自动记录下来。</p><h2 id="00a4" class="la jy hh bd jz lb lc ld kd le lf lg kh je lh li kl ji lj lk kp jm ll lm kt ln bi translated">慢速帧</h2><p id="bce2" class="pw-post-body-paragraph it iu hh iv b iw kv iy iz ja kw jc jd je kx jg jh ji ky jk jl jm kz jo jp jq ha bi translated">使用Android Studio中新的<strong class="iv hi"> Logcat </strong>来过滤<code class="du lo lp lq lr b">Choreographer</code>标签，你可以在运行应用程序时看到丢帧。一旦跳过超过30帧，就会被记录下来。</p><figure class="jr js jt ju fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ls"><img src="../Images/ca1d7457f2c7fe857f88b043fb2cd761.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1092nOLmIIBZ9C8p"/></div></div></figure><h2 id="c1b3" class="la jy hh bd jz lb lc ld kd le lf lg kh je lh li kl ji lj lk kp jm ll lm kt ln bi translated">冻结帧</h2><p id="a998" class="pw-post-body-paragraph it iu hh iv b iw kv iy iz ja kw jc jd je kx jg jh ji ky jk jl jm kz jo jp jq ha bi translated">渲染时间超过700毫秒的帧将用<code class="du lo lp lq lr b">OpenGLRenderer</code>标签和一些更详细的信息记录下来。</p><figure class="jr js jt ju fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lt"><img src="../Images/a76ac9938722166c67385d8bb819c0ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*s7Ln3TzGMdY2EBMi"/></div></div></figure><h2 id="63af" class="la jy hh bd jz lb lc ld kd le lf lg kh je lh li kl ji lj lk kp jm ll lm kt ln bi translated">非响应活动</h2><p id="92d2" class="pw-post-body-paragraph it iu hh iv b iw kv iy iz ja kw jc jd je kx jg jh ji ky jk jl jm kz jo jp jq ha bi translated">如果你的应用程序超过5秒钟没有响应，你会看到活动无响应(ANR)对话框。</p><figure class="jr js jt ju fd ii er es paragraph-image"><div class="er es lu"><img src="../Images/d781a62a48e925da9c10667716cd5c48.png" data-original-src="https://miro.medium.com/v2/resize:fit:964/0*QNVXxTLD044nvTcT"/></div></figure><h2 id="d443" class="la jy hh bd jz lb lc ld kd le lf lg kh je lh li kl ji lj lk kp jm ll lm kt ln bi translated">应用发布</h2><p id="09c9" class="pw-post-body-paragraph it iu hh iv b iw kv iy iz ja kw jc jd je kx jg jh ji ky jk jl jm kz jo jp jq ha bi translated">通过过滤<code class="du lo lp lq lr b">ActivityTaskManager</code>标签，你还可以在logcat中看到应用程序的启动持续时间。</p><p id="aa9f" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">初始显示时间(TTID)将用<code class="du lo lp lq lr b">Displayed</code>记录。</p><p id="544c" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">用<code class="du lo lp lq lr b">Fully Drawn</code>记录完全显示时间(TTFD)。</p><blockquote class="lv lw lx"><p id="0c1a" class="it iu ly iv b iw ix iy iz ja jb jc jd lz jf jg jh ma jj jk jl mb jn jo jp jq ha bi translated">少于500毫秒(0.5秒)的应用程序启动时间是可取的，因为用户会对较长的启动时间产生负面影响。</p></blockquote><p id="7a45" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">您可以在之前关于<a class="ae mc" rel="noopener" href="/androiddevelopers/important-performance-metrics-c7dacf018eb3?source=rss-------1"> MAD技能绩效指标</a>的文章中了解更多关于这些指标的信息。</p><div class="md me ez fb mf mg"><a rel="noopener follow" target="_blank" href="/androiddevelopers/important-performance-metrics-c7dacf018eb3"><div class="mh ab dw"><div class="mi ab mj cl cj mk"><h2 class="bd hi fi z dy ml ea eb mm ed ef hg bi translated">重要的绩效指标</h2><div class="mn l"><h3 class="bd b fi z dy ml ea eb mm ed ef dx translated">在您开始有效地处理绩效之前，我们建议您熟悉关键绩效…</h3></div><div class="mo l"><p class="bd b fp z dy ml ea eb mm ed ef dx translated">medium.com</p></div></div><div class="mp l"><div class="mq l mr ms mt mp mu in mg"/></div></div></a></div><p id="9db5" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">被动检查是查看是否存在问题的一个很好的起点，可以帮助您大致指出问题的正确方向。要真正确定是应用程序的哪个部分导致了问题，被动检查很少是足够的。你需要主动检查你的应用程序代码。</p><h1 id="caeb" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">人工性能检查</h1><p id="a407" class="pw-post-body-paragraph it iu hh iv b iw kv iy iz ja kw jc jd je kx jg jh ji ky jk jl jm kz jo jp jq ha bi translated">当你大致了解了应用程序的哪些部分没有按照你的预期执行时，是时候手动深入检查发生了什么。Android Studio附带了一套分析器，可以帮助您检查应用程序中正在发生的事情。</p><p id="117f" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">Android Studio的分析器与调试器有相似之处。调试器用于单步调试代码，查看参数和属性值，分析器用于检查CPU、内存、网络使用情况以及邱建的可能来源。</p><blockquote class="mv"><p id="f84b" class="mw mx hh bd my mz na nb nc nd ne jq dx translated">分析器帮助您详细了解问题发生的位置。</p></blockquote><p id="4a90" class="pw-post-body-paragraph it iu hh iv b iw nf iy iz ja ng jc jd je nh jg jh ji ni jk jl jm nj jo jp jq ha bi translated">当您开发应用程序时，调试器允许您在开发过程中附加到应用程序并深入检查问题，使用可调试的构建很可能会给出错误的性能数据。</p><h1 id="bd84" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">总是在真实设备上检查发布版本</h1><p id="d850" class="pw-post-body-paragraph it iu hh iv b iw kv iy iz ja kw jc jd je kx jg jh ji ky jk jl jm kz jo jp jq ha bi translated">可调试版本提供了许多对开发有用的功能，如实时编辑，无需重新安装应用程序即可应用更改，或者检查属性值，更改数据以及使用Android Studio的调试功能。</p><p id="120b" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">标记为可调试的版本也会增加应用程序的性能开销。这使得性能指标不可靠。一些在可调试版本上看起来表现不佳的东西，实际上可以在发布版本上很好地工作。</p><p id="03c8" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">要验证性能问题是存在于生产环境中还是仅存在于开发过程中，请确保在应用程序的发布构建发布版本中进行验证。</p><p id="f9b3" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">通过将构建变体切换到最像生产的构建，将您的构建变体设置为release。Android中的Now示例为此使用了“prodRelease”。</p><figure class="jr js jt ju fd ii er es paragraph-image"><div class="er es nk"><img src="../Images/f926f8883f258ee28a18ce6a2293cd1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/0*i5DNewcSBcKK9EkF"/></div></figure><p id="f2b8" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">同样，在您的<code class="du lo lp lq lr b">AndroidManifest.xml</code>中，将应用程序标记为<code class="du lo lp lq lr b">profileable</code>。这允许分析器检查生产构建中发生了什么。</p><pre class="jr js jt ju fd nl lr nm nn aw no bi"><span id="4314" class="la jy hh lr b fi np nq l nr ns">&lt;!--AndroidManifest.xml--&gt;</span><span id="72ba" class="la jy hh lr b fi nt nq l nr ns">&lt;manifest...<br/>  &lt;application...<br/>    &lt;profileable android:shell=”true” tools:targetApi=”q” /<br/>  &lt;/application&gt;<br/>&lt;/manifest&gt;</span></pre><figure class="jr js jt ju fd ii er es paragraph-image"><div class="er es nu"><img src="../Images/b8c0b9ed7548088b52e090d8c7862ba9.png" data-original-src="https://miro.medium.com/v2/resize:fit:602/0*Of4FQdg4sMVZwZBR"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Always inspect release builds on a physical device</figcaption></figure><blockquote class="mv"><p id="0bcd" class="mw mx hh bd my mz nv nw nx ny nz jq dx translated">您需要在物理设备上检查发布版本。</p></blockquote><p id="148f" class="pw-post-body-paragraph it iu hh iv b iw nf iy iz ja ng jc jd je nh jg jh ji ni jk jl jm nj jo jp jq ha bi translated">Android模拟器已经走过了漫长的道路。它启动迅速，运行流畅，并在应用程序开发过程中提供无缝体验。但是当谈到测量性能时，Android模拟器并不是合适的工具。</p><p id="a69e" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">当您在模拟器上检查性能时，您不是在用有物理限制的Android设备进行测量，而是在用主机的能力进行测量。如果主机系统负载过重，被检查的应用程序的性能会降低。</p><blockquote class="lv lw lx"><p id="7f49" class="it iu ly iv b iw ix iy iz ja jb jc jd lz jf jg jh ma jj jk jl mb jn jo jp jq ha bi translated">检查物理设备的性能将为您提供持续有用的数据。</p></blockquote><h1 id="3c3e" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">手动性能检查的更多MAD技巧</h1><p id="4b2b" class="pw-post-body-paragraph it iu hh iv b iw kv iy iz ja kw jc jd je kx jg jh ji ky jk jl jm kz jo jp jq ha bi translated">因为手动性能检查本身就是一个完整的主题，所以我们制作了一个完整的系列，旨在帮助您深入理解手动性能调试。你可以在这里查看。</p><figure class="jr js jt ju fd ii"><div class="bz dy l di"><div class="oa jw l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">MAD Skills Performance Debugging playlist</figcaption></figure><h1 id="c63c" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">自动化性能检查</h1><p id="804d" class="pw-post-body-paragraph it iu hh iv b iw kv iy iz ja kw jc jd je kx jg jh ji ky jk jl jm kz jo jp jq ha bi translated">在检查性能时，被动和手动检查是重要的步骤。检查性能的第三种方法，也可能是最可靠的方法，是自动性能检查。通过自动化的性能检查，您可以一次又一次地在流程中可靠地运行相同的步骤。</p><blockquote class="mv"><p id="dd0a" class="mw mx hh bd my mz na nb nc nd ne jq dx translated">自动化检查有助于在交付给用户之前防止性能问题。</p></blockquote><p id="d527" class="pw-post-body-paragraph it iu hh iv b iw nf iy iz ja ng jc jd je nh jg jh ji ni jk jl jm nj jo jp jq ha bi translated">虽然自动化过程需要一些设置，但在确保应用性能一致时，您可以高枕无忧。我们提供Jetpack Macrobenchmark库来帮助您自动执行性能检查。这个库允许您自动检查整个用户流的性能。当使用Jetpack Macrobenchmark库时，您可以测量关键指标，如应用程序启动、帧计时和其他性能指标。</p><h2 id="daf4" class="la jy hh bd jz lb lc ld kd le lf lg kh je lh li kl ji lj lk kp jm ll lm kt ln bi translated">Jetpack Macrobenchmark入门</h2><p id="c374" class="pw-post-body-paragraph it iu hh iv b iw kv iy iz ja kw jc jd je kx jg jh ji ky jk jl jm kz jo jp jq ha bi translated">开始使用Jetpack Macrobenchmark所需要的只是Android Studio的最新版本。我们最近发布了一个<a class="ae mc" href="https://goo.gle/baseline-profiles-codelab" rel="noopener ugc nofollow" target="_blank"> codelab，引导你完成创建和运行你的第一个宏基准的过程</a>。</p><p id="6714" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">此外，关于如何创建宏基准的总体<a class="ae mc" href="https://developer.android.com/topic/performance/benchmarking/macrobenchmark-overview" rel="noopener ugc nofollow" target="_blank">指南</a>给了你最新的入门指导。</p><h1 id="5a9b" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">在您等待下一篇文章的时候</h1><p id="ecec" class="pw-post-body-paragraph it iu hh iv b iw kv iy iz ja kw jc jd je kx jg jh ji ky jk jl jm kz jo jp jq ha bi translated">在下一篇文章中，我们将向您介绍一种使用<a class="ae mc" href="https://developer.android.com/topic/performance/baselineprofiles" rel="noopener ugc nofollow" target="_blank">基线配置文件</a>提高应用程序性能的快速方法。</p><p id="ea58" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">去看看我们改进的开发者文档，我们已经用MAD指南更新了它。</p><p id="70e4" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">要获得更多的实践经验，请查看GitHub上的<a class="ae mc" href="http://github.com/android/performance-samples" rel="noopener ugc nofollow" target="_blank">示例</a>。</p><p id="2acd" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">或者参加<a class="ae mc" href="https://goo.gle/baseline-profiles-codelab" rel="noopener ugc nofollow" target="_blank">宏观基准测试代码实验室</a>或<a class="ae mc" href="https://goo.gle/baseline-profiles-codelab" rel="noopener ugc nofollow" target="_blank">基准配置文件代码实验室</a>以获得主题的实际指导。</p><p id="f587" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">此外，确保在视频评论或Twitter上提出你的问题，使用<a class="ae mc" href="https://twitter.com/search?q=%23MADPerfQA" rel="noopener ugc nofollow" target="_blank"> #MADPerfQA </a>直接从致力于Android性能的工程师那里获得答案。</p></div></div>    
</body>
</html>