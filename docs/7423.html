<html>
<head>
<title>My Experience Extracting Invoice Data Using invoice2data in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我在Python中使用invoice2data提取发票数据的经验</h1>
<blockquote>原文：<a href="https://medium.com/version-1/my-experience-extracting-invoice-data-using-invoice2data-in-python-1c6450fa001f?source=collection_archive---------0-----------------------#2020-07-07">https://medium.com/version-1/my-experience-extracting-invoice-data-using-invoice2data-in-python-1c6450fa001f?source=collection_archive---------0-----------------------#2020-07-07</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/037d94c1662786b1ed8c80b404fb1c9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PxDR_Ky1JqQEnfXp"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo by <a class="ae it" href="https://unsplash.com/@goumbik?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Lukas Blazek</a> on <a class="ae it" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="99fc" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我是一名技术顾问，自2019年8月以来一直作为Version的<a class="ae it" href="https://www.version1.com/innovation/" rel="noopener ugc nofollow" target="_blank"> 1创新实验室</a>的一部分工作。创新实验室通过创建<strong class="iw hi"> POC(概念证明)</strong>和<strong class="iw hi"> POV(价值证明)</strong>为客户开发创新解决方案，以证明客户问题的解决方案，并扩展到真实客户问题的解决方案。</p><p id="bbb7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我有机会在创新实验室提取发票数据，在那里我遇到了从模板发票的定义字段中提取数据的<strong class="iw hi"/><a class="ae it" href="https://pypi.org/project/invoice2data/" rel="noopener ugc nofollow" target="_blank"><strong class="iw hi">invoice 2 data</strong></a><strong class="iw hi">python包</strong>。</p><h1 id="a99b" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">什么是invoice2data？</h1><p id="770c" class="pw-post-body-paragraph iu iv hh iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr ha bi translated">invoice2data由Invoice-X创建，能够使用模板系统从pdf中提取结构化数据。invoice2data最适合文本PDF，但也可以使用不同的OCR库作为PDF发票的数据提取器。</p><h1 id="c75d" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">我的经历</h1><p id="8565" class="pw-post-body-paragraph iu iv hh iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr ha bi translated">如其网站所述，invoice2data的主要步骤如下:</p><blockquote class="kv kw kx"><p id="3dfb" class="iu iv ky iw b ix iy iz ja jb jc jd je kz jg jh ji la jk jl jm lb jo jp jq jr ha bi translated">支持您的会计流程的模块化Python库。在Python 2.7和3.4+上测试。主要步骤:</p><p id="be38" class="iu iv ky iw b ix iy iz ja jb jc jd je kz jg jh ji la jk jl jm lb jo jp jq jr ha bi translated">使用不同的技术从PDF文件中提取文本，如<code class="du lc ld le lf b">pdftotext</code>、<code class="du lc ld le lf b">pdfminer</code>或OCR—<code class="du lc ld le lf b">tesseract</code>、<code class="du lc ld le lf b">tesseract4</code>或<code class="du lc ld le lf b">gvision</code>(谷歌云视觉)。</p><p id="9b16" class="iu iv ky iw b ix iy iz ja jb jc jd je kz jg jh ji la jk jl jm lb jo jp jq jr ha bi translated">使用基于YAML的模板系统在结果中搜索正则表达式</p><p id="153c" class="iu iv ky iw b ix iy iz ja jb jc jd je kz jg jh ji la jk jl jm lb jo jp jq jr ha bi translated">将结果保存为CSV、JSON或XML，或者重命名PDF文件以匹配内容</p></blockquote><p id="528a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">当使用invoice2data时，我遇到了一个问题，我无法从自定义regex提取多行文本数据，也无法将多行文本数据提取到自定义regex来读取复杂的表。为了解决这个问题，我想到了一个定制invoice2data的想法，用坐标来定义区域裁剪。我还扩展了当前模板以适应定制配置。定义的自定义字段在下面的YAML模板中。这是用于提取数据的示例发票和使用的模板。</p><h2 id="d33f" class="lg jt hh bd ju lh li lj jy lk ll lm kc jf ln lo kg jj lp lq kk jn lr ls ko lt bi translated">样品发票</h2><figure class="lv lw lx ly fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lu"><img src="../Images/e170d4e1cd0f94b5d2e32d936a419b96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xxqI8ve_i9YY0sUeHoe66A.png"/></div></div></figure><h2 id="7034" class="lg jt hh bd ju lh li lj jy lk ll lm kc jf ln lo kg jj lp lq kk jn lr ls ko lt bi translated">Yaml模板</h2><pre class="lv lw lx ly fd lz lf ma mb aw mc bi"><span id="97c4" class="lg jt hh lf b fi md me l mf mg"><em class="ky"># -*- coding: utf-8 -*-<br/></em>issuer: ABC<br/>file: ''<br/>fields:<br/>  tel: 'Tel (\+\w+(?:[ -)(]\w\w+)*)'<br/>  email: 'Email:[ ]+(\w+@\w+.\w+)'<br/>  website: 'Website:[ ]+(\w+.\w+.\w+)'<br/>  vat_no: 'Vat no:[ ]+(\w+)'<br/>  date: 'Date:[ ]+(\d{2}[/-]\d{2}[/-]\d{4})'<br/>  invoice_number: 'Invoice Number[ ]+(\w+)'<br/>  contact: 'Contact[ ]+(\w+)'<br/>  bank: 'Bank\s+(\w+(?:[ ]\w\w+)*)'<br/>  address: 'Address\s+(\w+(?:[ ,]\w\w+)*)'<br/>  iban: 'IBAN\s+(\w+(?:[ ]\w\w+)*)'<br/>  bic: 'BIC\s+(\w+)'<br/>  due_d: 'Due Date\s+(\w+)'<br/>  sub_total: 'Subtotal\s+(\d+.\d+)'<br/>  vat: 'Vat\s+(\d+)%\s+(\d+.\d+)'<br/>keywords:<br/>- ABC<br/>- 3 Middle Street<br/>- London, UK<br/>custom:<br/>  items:<br/>  - name: 'to'<br/>    area: (135, 878, 686, 349)<br/>  - name: 'from'<br/>    area: (1398, 325, 489, 197)<br/>  regex:<br/>    line: \s+(?P&lt;desc&gt;(\w+(?:[ ]\w\w+)*))\s+(?P&lt;date&gt;(\d{2}[-]\d{2}[-]\d{4}))\s+(?P&lt;item&gt;(\w+))\s+(?P&lt;qty&gt;(\d+))\s+(?P&lt;unit_price&gt;[€ ](\d+.\d+))\s+(?P&lt;total&gt;[€ ](\d+.\d+))\n<br/>required_fields:<br/>  - tel<br/>options:<br/>  currency: €<br/>  date_formats:<br/>    - '%d-%m-%Y'<br/>  remove_whitespace: False<br/>  languages:<br/>    - en<br/>  replace:<br/>    - ['‘', '']<br/>    - ['[', '']<br/>    - ['€', '']<em class="ky"><br/>  </em>decimal_separator: '.'</span></pre><h2 id="8160" class="lg jt hh bd ju lh li lj jy lk ll lm kc jf ln lo kg jj lp lq kk jn lr ls ko lt bi translated">输出</h2><figure class="lv lw lx ly fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mh"><img src="../Images/67be68effb68f51ae52f444831cffb39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9eIcdoR-s7bq8BCX_Kh7Vg.png"/></div></div></figure><p id="0d77" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">当输入图像的分辨率改变时，模板中定义的坐标将会不同。invoice2data数据定制已考虑到这一点。</p><p id="7903" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> <em class="ky">为了进一步增强功能，</em> </strong> <a class="ae it" href="https://www.version1.com/it-service/innovation-labs/artificial-intelligence/" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hi"> <em class="ky">机器学习</em> </strong> </a> <strong class="iw hi"> <em class="ky">都可以用来移除模板。</em> </strong></p><h2 id="8d59" class="lg jt hh bd ju lh li lj jy lk ll lm kc jf ln lo kg jj lp lq kk jn lr ls ko lt bi translated">结论</h2><p id="bf19" class="pw-post-body-paragraph iu iv hh iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr ha bi translated">我强烈建议使用Invoice2data进行发票处理，只要您没有对发票模板进行太多更改。Invoice2data提供了添加自定义插件的能力，这非常适合我们自己的特定需求。然而，为了创建发票模板，invoice2data需要良好的正则表达式技能。</p><h1 id="a528" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">了解更多信息</h1><p id="9827" class="pw-post-body-paragraph iu iv hh iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr ha bi translated"><em class="ky">创新实验室自2018年以来一直在行动，并以成功协作的形式拥有许多成功案例</em> <strong class="iw hi"> <em class="ky">【价值证明(POV)</em></strong><em class="ky">。我们热衷于在没有现有客户和新客户的情况下吸引更多客户，以展示最新技术如何为他们的业务增加价值。要了解第1版</em>  <em class="ky">中</em> <strong class="iw hi"> <em class="ky">创新的更多信息，请访问我们的</em> <a class="ae it" href="http://www.version1.com/innovation" rel="noopener ugc nofollow" target="_blank"> <em class="ky">这里</em> </a> <em class="ky">。</em></strong></p></div></div>    
</body>
</html>