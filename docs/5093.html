<html>
<head>
<title>Comparing data across entity boundaries — Mendix and Me</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">跨越实体边界比较数据——Mendix和我</h1>
<blockquote>原文：<a href="https://medium.com/mendix/compare-data-across-entity-boundaries-mendix-and-me-bc7d54d522c5?source=collection_archive---------4-----------------------#2021-02-23">https://medium.com/mendix/compare-data-across-entity-boundaries-mendix-and-me-bc7d54d522c5?source=collection_archive---------4-----------------------#2021-02-23</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/5302ef856721723918500f27a708c287.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tFzb7RT5_A3lS2Un8HPJow.png"/></div></div></figure><div class=""/><figure class="fi fk jd je jf hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff jc"><img src="../Images/664a6d88dfa1dbe645e0cdb1d02878a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fsmA-5USP4FjtpkUgdoQaQ.png"/></div></div></figure><p id="7198" class="pw-post-body-paragraph jg jh if bd b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">在我工作过的几乎每个应用程序中，我迟早都要做的一件事就是比较数据是否发生了变化。这里的典型案例是接口。如果我的应用程序中的某个记录发生了更改，我想通过一个接口发送这些更改，或者创建一个事件，以便其他应用程序可以得到这些更改的通知。</p><p id="b248" class="pw-post-body-paragraph jg jh if bd b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">一个简单的方法是每当我的记录被保存时触发这个事件。在较小的环境中，这无疑是一个实用的解决方案。实现起来简单快捷。然而，它也带来了风险，即生成了许多可能不需要生成的事件。所以我们想决定是否真的必须生成事件。第一个简单易用的解决方案可以在Mendix Marketplace的社区共享模块中找到。</p><p id="2bb3" class="pw-post-body-paragraph jg jh if bd b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">下面的例子都基于这个域模型，其中有一个Employee实体，它与一个位置、部门以及地址相关联。</p><figure class="ke kf kg kh fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff kd"><img src="../Images/01a62acf10f10341c8c7c1d1efc1c25e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RBp4QsWYGCmICFsQ.png"/></div></div><figcaption class="ki kj fg fe ff kk kl bd b be z ek">The domain model used in the examples</figcaption></figure><h1 id="461c" class="km kn if bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">对象已更改操作</h1><p id="3cf6" class="pw-post-body-paragraph jg jh if bd b ji lk jk jl jm ll jo jp jq lm js jt ju ln jw jx jy lo ka kb kc hn dt translated">在Mendix Marketplace的<a class="ae lp" href="https://marketplace.mendix.com/link/component/170" rel="noopener ugc nofollow" target="_blank"> Community Commons模块</a>中有一个名为objectHasChanged的Java动作。这个动作是我们上述问题的简单解决方案。您从缓存中传递一个对象给它，Java操作返回一个布尔值，告诉我们对象是否已经更改。在微流中，整个事情看起来像这样。</p><figure class="ke kf kg kh fq hw fe ff paragraph-image"><div class="fe ff lq"><img src="../Images/c627866ca291423e3302304aeb2bd0c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/0*rFhCn5SufIrF3DYm.png"/></div><figcaption class="ki kj fg fe ff kk kl bd b be z ek">Using the objectHasChanged Action on the Employee Object</figcaption></figure><p id="d4d3" class="pw-post-body-paragraph jg jh if bd b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">这种解决方案非常适合简单的情况，使用这种方法没什么不好。这个Java动作不仅检测更改的属性，还检测更改的关联。</p><p id="0ced" class="pw-post-body-paragraph jg jh if bd b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">然而，有两个明显的缺点。</p><ol class=""><li id="9981" class="lr ls if bd b ji jj jm jn jq lt ju lu jy lv kc lw lx ly lz dt translated">无法识别关联是否保持不变，但关联对象上的某些内容发生了变化。这方面的一个例子是员工地址的变更。</li><li id="e938" class="lr ls if bd b ji ma jm mb jq mc ju md jy me kc lw lx ly lz dt translated">Java动作比较一切。您不能从比较中排除单个属性。例如，如果您想从比较中排除<em class="mf"> LastCheckInTimestamp </em>，因为这个属性与事件无关，那么这个Java操作无法实现。</li></ol><p id="3915" class="pw-post-body-paragraph jg jh if bd b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">因此，我们正在寻找一种解决方案，可以忽略属性，并能够比较整个数据结构。</p><h1 id="3ed0" class="km kn if bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj dt translated">使用映射进行比较</h1><p id="0418" class="pw-post-body-paragraph jg jh if bd b ji lk jk jl jm ll jo jp jq lm js jt ju ln jw jx jy lo ka kb kc hn dt translated">一个可能的解决方案是使用映射进行这种比较。您可以在几个关联上使用一个映射，并且可以准确地定义应该包括哪些属性。因为您通常在使用接口时使用映射，所以使用它们进行数据比较是显而易见的。另一个很大的优势是映射可以轻松地扩展或修改。</p><p id="af52" class="pw-post-body-paragraph jg jh if bd b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">具体来说，现在的解决方案是这样的。首先，我们为整个数据结构创建一个映射。</p><figure class="ke kf kg kh fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff mg"><img src="../Images/09d1cbc368cef645d3e3d0955af3866d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Zi1LXlVA1pUoD1-M.png"/></div></div><figcaption class="ki kj fg fe ff kk kl bd b be z ek">The Employee Export Mapping with the relevant attributes</figcaption></figure><p id="c8af" class="pw-post-body-paragraph jg jh if bd b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">该映射仅包含与比较相关的属性。如果由于变更而需要更多或更少的属性，则只需调整映射。</p><p id="af36" class="pw-post-body-paragraph jg jh if bd b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">实际的比较发生在微流中。</p><figure class="ke kf kg kh fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff mg"><img src="../Images/891f58675613d247d0dabe492b417e42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cN-bIOe5BfPI6xO3.png"/></div></div><figcaption class="ki kj fg fe ff kk kl bd b be z ek">Microflow for comparison between cache and database</figcaption></figure><p id="f1c6" class="pw-post-body-paragraph jg jh if bd b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">这个微流从数据库中提取Employee对象，以便来自缓存的版本和来自数据库的版本在微流中并行存在。现在，它将贴图应用于两个对象。在端点中，只有两个JSON字符串相互比较。如果它们不相等，则相关属性或对象发生了变化。但是如果这些字符串相等，那么相关数据没有任何变化。</p><p id="cb25" class="pw-post-body-paragraph jg jh if bd b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">这个微流可以在<em class="mf"> Employee_NewEdit </em>页面的保存过程中使用，但是也可以在Employee对象的<em class="mf"> BeforeCommit </em>事件中使用。</p><p id="1280" class="pw-post-body-paragraph jg jh if bd b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated">尽情体验吧！</p></div><div class="ab cl mh mi hb mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="hn ho hp hq hr"><p id="dd82" class="pw-post-body-paragraph jg jh if bd b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated"><em class="mf">于2021年2月23日</em><a class="ae lp" href="https://mendixandme.de/index.php/2021/02/23/daten-vergleichen-ueber-die-entitaetsgrenzen-hinaus/" rel="noopener ugc nofollow" target="_blank"><em class="mf">https://mendixamme . de</em></a><em class="mf">以德语原文发表。</em></p></div><div class="ab cl mh mi hb mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="hn ho hp hq hr"><p id="a31f" class="pw-post-body-paragraph jg jh if bd b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated"><em class="mf">来自发布者- </em></p><p id="d80a" class="pw-post-body-paragraph jg jh if bd b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated"><em class="mf">如果你喜欢这篇文章，你可以在我们的</em> <a class="ae lp" href="https://medium.com/mendix" rel="noopener"> <em class="mf">媒体页面</em> </a> <em class="mf">或者我们自己的</em> <a class="ae lp" href="https://developers.mendix.com/community-blog/" rel="noopener ugc nofollow" target="_blank"> <em class="mf">社区博客网站</em> </a> <em class="mf">找到更多喜欢的。</em></p><p id="569e" class="pw-post-body-paragraph jg jh if bd b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated"><em class="mf">希望入门的创客，可以注册一个</em> <a class="ae lp" href="https://signup.mendix.com/link/signup/?source=direct" rel="noopener ugc nofollow" target="_blank"> <em class="mf">免费账号</em> </a> <em class="mf">，通过我们的</em> <a class="ae lp" href="https://academy.mendix.com/link/home" rel="noopener ugc nofollow" target="_blank"> <em class="mf">学苑</em> </a> <em class="mf">获得即时学习。</em></p><p id="9528" class="pw-post-body-paragraph jg jh if bd b ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc hn dt translated"><em class="mf">有兴趣更多地参与我们的社区吗？你可以加入我们的</em> <a class="ae lp" href="https://join.slack.com/t/mendixcommunity/shared_invite/zt-hwhwkcxu-~59ywyjqHlUHXmrw5heqpQ" rel="noopener ugc nofollow" target="_blank"> <em class="mf"> Slack社区频道</em> </a> <em class="mf">或者想更多参与的人，看看加入我们的</em> <a class="ae lp" href="https://developers.mendix.com/meetups/#meetupsNearYou" rel="noopener ugc nofollow" target="_blank"> <em class="mf">遇见ups </em> </a> <em class="mf">。</em></p></div></div>    
</body>
</html>