<html>
<head>
<title>Tabletop mode on foldable devices</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">可折叠设备上的桌面模式</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/tabletop-mode-on-foldable-devices-d091b3c500b1?source=collection_archive---------4-----------------------#2021-07-02">https://medium.com/androiddevelopers/tabletop-mode-on-foldable-devices-d091b3c500b1?source=collection_archive---------4-----------------------#2021-07-02</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/b74fc7473ceb5ec939baea7ac2bc07aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4bfMdWeHGUkAhNlKuoucGw.png"/></div></div></figure><div class=""/><p id="d8d4" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated"><em class="jo">展现您的视频播放器体验</em></p><p id="19de" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">可折叠设备为用户提供了用手机做更多事情的可能性，包括像<em class="jo">桌面模式、</em>这样的创新，手机放在一个表面上，铰链处于水平位置，折叠屏幕处于部分打开状态。</p><p id="8670" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">当你想不用手拿着手机使用时，桌面模式很方便。它非常适合观看媒体、进行视频通话、拍照甚至玩游戏。</p><p id="0001" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">一个很好的例子是<a class="ae jp" href="https://developer.android.com/stories/apps/google-duo" rel="noopener ugc nofollow" target="_blank">谷歌双人组</a>对他们的应用程序进行了优化，使其在平板电脑和可折叠设备上运行良好。</p><figure class="jr js jt ju fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es jq"><img src="../Images/a5c4499bf74197f160581394352ef4d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xoLo9WRPIs7U7cur"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx"><em class="ip">Duo app before and after optimization</em></figcaption></figure><p id="6b04" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">在这篇博文中，你将学到一种简单而有效的方法来调整你的应用在可折叠设备上运行时的布局。</p><p id="f5b3" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">该示例是一个简单的媒体播放器，它自动调整其大小以避免在图像中间出现折叠，并在屏幕完全平坦时将其传输控制的位置从嵌入视频切换到设备折叠时的单独面板，如下面的视频所示:</p><figure class="jr js jt ju fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es jz"><img src="../Images/59c1bf9e433f08fd550222f5b43111a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*u-VA2MuzyfPZ7lhCkHe2pg.gif"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx">Tabletop mode example on Samsung Galaxy Z Fold2 5G</figcaption></figure><h1 id="eec3" class="ka kb hs bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">佐料</h1><p id="db12" class="pw-post-body-paragraph iq ir hs is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn ha bi translated">示例应用程序使用了<a class="ae jp" href="https://github.com/google/ExoPlayer" rel="noopener ugc nofollow" target="_blank"> Exoplayer </a>，一个流行的Android开源媒体播放库，以及这些Jetpack组件:</p><ul class=""><li id="13f6" class="ld le hs is b it iu ix iy jb lf jf lg jj lh jn li lj lk ll bi translated"><a class="ae jp" href="https://developer.android.com/reference/androidx/constraintlayout/motion/widget/MotionLayout" rel="noopener ugc nofollow" target="_blank"> MotionLayout </a>，是<a class="ae jp" href="https://developer.android.com/training/constraint-layout" rel="noopener ugc nofollow" target="_blank"> ConstraintLayout </a>的子类。它将父类的灵活性与视图在从一种姿态转换到另一种姿态时的平滑动画相结合。</li><li id="9c10" class="ld le hs is b it lm ix ln jb lo jf lp jj lq jn li lj lk ll bi translated"><a class="ae jp" href="https://developer.android.com/reference/androidx/constraintlayout/widget/ReactiveGuide" rel="noopener ugc nofollow" target="_blank"> ReactiveGuide </a>，一个不可见的组件，当SharedValue改变时，它会自动定位自己。它与一个<a class="ae jp" href="https://developer.android.com/reference/androidx/constraintlayout/widget/Guideline" rel="noopener ugc nofollow" target="_blank">指南</a>助手一起工作。</li><li id="bc3d" class="ld le hs is b it lm ix ln jb lo jf lp jj lq jn li lj lk ll bi translated"><a class="ae jp" href="https://developer.android.com/jetpack/androidx/releases/window" rel="noopener ugc nofollow" target="_blank"> WindowManager </a>，一个帮助应用开发者支持新设备外形的库，为不同的窗口特性提供了一个通用的API表面。</li></ul><p id="0fda" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">要使用这些库，您必须将<a class="ae jp" href="https://android.devsite.corp.google.com/studio/build/dependencies?skip_cache=true#google-maven" rel="noopener ugc nofollow" target="_blank"> Google Maven资源库</a>添加到您的项目中，并声明这些依赖关系:</p><figure class="jr js jt ju fd hj"><div class="bz dy l di"><div class="lr ls l"/></div></figure><h1 id="031b" class="ka kb hs bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">布局</h1><p id="28be" class="pw-post-body-paragraph iq ir hs is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn ha bi translated">考虑视频播放器活动的布局，根元素是一个包含三个子视图的<a class="ae jp" href="https://developer.android.com/reference/androidx/constraintlayout/motion/widget/MotionLayout" rel="noopener ugc nofollow" target="_blank"> MotionLayout </a>。</p><figure class="jr js jt ju fd hj"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="ecff" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">Exoplayer套件中有两个视图，允许您为<a class="ae jp" href="https://exoplayer.dev/doc/reference/com/google/android/exoplayer2/ui/PlayerView.html" rel="noopener ugc nofollow" target="_blank">播放器视图</a>(显示媒体的表面)和<a class="ae jp" href="https://exoplayer.dev/doc/reference/com/google/android/exoplayer2/ui/PlayerControlView.html" rel="noopener ugc nofollow" target="_blank">播放器控制视图</a>(播放控件的容器)指定不同的布局。</p><p id="6967" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">第三个视图是一个<a class="ae jp" href="https://android.devsite.corp.google.com/reference/androidx/constraintlayout/widget/ReactiveGuide" rel="noopener ugc nofollow" target="_blank">反应向导</a>。它被放置在另外两个视图之间，作为<a class="ae jp" href="https://android.devsite.corp.google.com/reference/androidx/constraintlayout/widget/Guideline" rel="noopener ugc nofollow" target="_blank">指引线</a>，视图之间的分隔符。</p><p id="ecaa" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">主<a class="ae jp" href="https://exoplayer.dev/doc/reference/com/google/android/exoplayer2/ui/PlayerView.html" rel="noopener ugc nofollow" target="_blank">播放器视图</a>被约束为始终位于反应向导的顶部。这样，当您将参考线从屏幕底部移动到折叠位置时，就会发生布局转换。</p><p id="08a6" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">您可能还希望将控件视图约束为总是位于ReactiveGuide底部的<strong class="is ht"> </strong>。这样，当屏幕平坦时，控制视图是隐藏的，但是当屏幕部分打开时，它出现在电话的底部。</p><p id="bc3f" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">注意第28行的属性<a class="ae jp" href="https://developer.android.com/reference/androidx/constraintlayout/widget/ConstraintLayout.LayoutParams#guideEnd" rel="noopener ugc nofollow" target="_blank"><strong class="is ht"><em class="jo">layout _ constraint guide _ end</em></strong></a>。这是移动基准线时需要更改的值。由于ReactiveGuide是水平的，因此该属性表示从基准线到父项底部的距离。</p></div><div class="ab cl lt lu go lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ha hb hc hd he"><h1 id="6806" class="ka kb hs bd kc kd ma kf kg kh mb kj kk kl mc kn ko kp md kr ks kt me kv kw kx bi translated">让你的应用程序能够识别文件夹</h1><p id="5da7" class="pw-post-body-paragraph iq ir hs is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn ha bi translated">现在最重要的部分:如何知道手机何时处于桌面模式，如何获取折叠的位置？</p><p id="24bc" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">初始化后，WindowManager库允许您通过收集由函数<a class="ae jp" href="https://developer.android.com/reference/androidx/window/layout/WindowInfoRepository#windowLayoutInfo()" rel="noopener ugc nofollow" target="_blank">windowinforpository . WindowLayoutInfo()</a>公开的流&lt;<a class="ae jp" href="https://developer.android.com/reference/androidx/window/layout/WindowLayoutInfo" rel="noopener ugc nofollow" target="_blank"> WindowLayoutInfo </a> &gt;来监听布局变化:</p><figure class="jr js jt ju fd hj"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="1b35" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">如果你想知道更多关于如何初始化和发布一个Exoplayer实例的信息，请看<a class="ae jp" href="https://developer.android.com/codelabs/exoplayer-intro" rel="noopener ugc nofollow" target="_blank"> Exoplayer codelab </a>。</p><p id="9aac" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">每当你获得一个新的布局信息时，你可以查询显示特性并检查设备在当前显示中是否有折叠或铰链:</p><figure class="jr js jt ju fd hj"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="d0d9" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">请注意，如果您不想使用Kotlin流，从<a class="ae jp" href="https://developer.android.com/jetpack/androidx/releases/window#1.0.0-alpha07" rel="noopener ugc nofollow" target="_blank"> 1.0.0-alpha07版本</a>开始，您可以使用<strong class="is ht"> <em class="jo"> window-java </em> </strong>工件，它公开java友好的API来注册和取消注册回调，或者使用<strong class="is ht"><em class="jo">window-rxjava 2</em></strong>和<strong class="is ht"><em class="jo">window-rx Java 3</em></strong>工件来注册rx Java适配的API。</p><p id="6fd1" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">如果方向是水平的并且<a class="ae jp" href="https://developer.android.com/reference/androidx/window/layout/FoldingFeature#isSeparating()" rel="noopener ugc nofollow" target="_blank">folding feature . is separating()</a>返回true，则设备可以在桌面模式下使用。</p><p id="00ba" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">在这种情况下，您可以计算折叠的相对位置，并将ReactiveGuide移动到该位置，否则将其移动到0(屏幕底部)。</p><figure class="jr js jt ju fd hj"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="5cd5" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">当你以这种方式调用函数fire new value<strong class="is ht"><em class="jo"/></strong>时，库改变了<a class="ae jp" href="https://developer.android.com/reference/androidx/constraintlayout/widget/ConstraintLayout.LayoutParams#guideEnd" rel="noopener ugc nofollow" target="_blank"><strong class="is ht"><em class="jo">layout _ constraint guide _ end</em></strong></a><strong class="is ht"><em class="jo"/></strong>属性。当设备是平的时，整个屏幕应该保留给主播放器观看。</p><p id="f0ff" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">最后一个问题是:当设备折叠时，您应该将ReactiveGuide移动到哪里？</p><p id="8a70" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated"><a class="ae jp" href="https://developer.android.com/reference/androidx/window/layout/FoldingFeature" rel="noopener ugc nofollow" target="_blank"><strong class="is ht"><em class="jo">folding feature</em></strong></a>对象公开字段<a class="ae jp" href="https://developer.android.com/reference/androidx/window/layout/FoldingFeature#bounds()" rel="noopener ugc nofollow" target="_blank"><strong class="is ht"><em class="jo">bounds()</em></strong></a>以在窗口坐标空间内检索特征的外接矩形。</p><p id="0293" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">如果您正在处理水平特征，大多数情况下，边界将由位于屏幕垂直中心的矩形表示，与屏幕一样宽，高度等于铰链的大小(在可折叠屏幕的情况下，该值可以是0，或者可以等于双屏设备中屏幕之间的距离)。</p><p id="7172" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">如果您的应用程序处于全屏模式，您可以将PlayerView约束在<strong class="is ht"><em class="jo">folding features . bounds . top</em></strong>的顶部，将ControlView约束在<strong class="is ht"><em class="jo">folding features . bounds . bottom</em></strong>的底部。</p><p id="d239" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">在其他情况下(非全屏)，你需要考虑导航栏和其他UI组件在屏幕上占据的空间。<br/>为了移动引导线，你必须指定它离父对象底部的距离。计算反应导向正确位置的函数的一个可能实现如下:</p><figure class="jr js jt ju fd hj"><div class="bz dy l di"><div class="lr ls l"/></div></figure></div><div class="ab cl lt lu go lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ha hb hc hd he"><h1 id="dd65" class="ka kb hs bd kc kd ma kf kg kh mb kj kk kl mc kn ko kp md kr ks kt me kv kw kx bi translated">摘要</h1><p id="8b42" class="pw-post-body-paragraph iq ir hs is b it ky iv iw ix kz iz ja jb la jd je jf lb jh ji jj lc jl jm jn ha bi translated">在本文中，您了解了如何通过实现支持桌面模式的灵活布局来改善可折叠设备上的媒体应用程序的用户体验。</p><p id="2814" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">请继续关注关于不同外形规格的开发指南的下一篇文章！</p></div><div class="ab cl lt lu go lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ha hb hc hd he"><h1 id="b853" class="ka kb hs bd kc kd ma kf kg kh mb kj kk kl mc kn ko kp md kr ks kt me kv kw kx bi translated">额外资源</h1><ul class=""><li id="ecc5" class="ld le hs is b it ky ix kz jb mf jf mg jj mh jn li lj lk ll bi translated"><a class="ae jp" href="https://developer.android.com/codelabs/exoplayer-intro" rel="noopener ugc nofollow" target="_blank"> Exoplayer codelab </a></li><li id="968b" class="ld le hs is b it lm ix ln jb lo jf lp jj lq jn li lj lk ll bi translated"><a class="ae jp" href="https://www.youtube.com/watch?v=jIBNhxyciLQ" rel="noopener ugc nofollow" target="_blank">桌面演示</a></li><li id="279d" class="ld le hs is b it lm ix ln jb lo jf lp jj lq jn li lj lk ll bi translated"><a class="ae jp" href="https://developer.android.com/training/constraint-layout/foldables" rel="noopener ugc nofollow" target="_blank">可折叠设计</a></li><li id="2a61" class="ld le hs is b it lm ix ln jb lo jf lp jj lq jn li lj lk ll bi translated"><a class="ae jp" href="https://developer.android.com/guide/topics/ui/foldables" rel="noopener ugc nofollow" target="_blank">为可折叠文件夹构建应用</a></li><li id="da1c" class="ld le hs is b it lm ix ln jb lo jf lp jj lq jn li lj lk ll bi translated"><a class="ae jp" href="https://github.com/androidx/androidx/tree/androidx-main/window" rel="noopener ugc nofollow" target="_blank"> Jetpack窗口管理器</a></li><li id="ee7a" class="ld le hs is b it lm ix ln jb lo jf lp jj lq jn li lj lk ll bi translated"><a class="ae jp" href="https://developer.android.com/training/constraint-layout/motionlayout" rel="noopener ugc nofollow" target="_blank">运动布局</a></li></ul></div><div class="ab cl lt lu go lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ha hb hc hd he"><p id="221a" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">[1]桌面模式在三星Galaxy Z系列可折叠智能手机上也称为Flex模式。</p></div></div>    
</body>
</html>