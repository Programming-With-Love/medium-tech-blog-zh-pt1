<html>
<head>
<title>WebLogic Autoscaling on OCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OCI上的WebLogic自动缩放</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/weblogic-autoscaling-on-oci-a27a0c6608ad?source=collection_archive---------0-----------------------#2021-05-31">https://medium.com/oracledevs/weblogic-autoscaling-on-oci-a27a0c6608ad?source=collection_archive---------0-----------------------#2021-05-31</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="912d" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak">简介</strong></h1><p id="614c" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">客户迁移到云以利用云基础架构的优势。例如，如果您在WebLogic域中运行java应用程序，并且希望将WebLogic域迁移到其中一个云提供商(例如OCI ),您可以在OCI上创建一个计算实例并安装WebLogic二进制文件，创建您的域，部署您的应用程序，最后在WebLogic集群前面提供一个应用程序负载平衡器，以在节点之间对流量进行负载平衡。</p><p id="9a92" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">现在，您的应用程序迁移到了云中。但是你得到了什么好处呢？如果您的应用程序上的工作负载增加或减少会怎样。您能否自动扩展/纳入您的基础架构？</p><p id="3ec9" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">在本文中，我将解释如何在OCI计算自动伸缩的基础上提供WebLogic域(如果用户需要更改，可以自动扩展/扩展WebLogic域)。</p><h1 id="65cc" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak">建筑</strong></h1><p id="a631" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">您可以创建OCI自动缩放来根据需求水平缩放您的应用程序。在我们的场景中，我们将配置OCI自动缩放，以便在流量增加时自动创建更多受管服务器并将其添加到WebLogic群集中，并在流量减少时停止受管服务器并将其从WebLogic群集中删除。</p><p id="0b91" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">此图显示了OCI自动缩放如何与Oracle WebLogic配合使用。在此架构中，我们使用OCI文件存储作为共享存储来存储WebLogic二进制文件和WebLogic域配置。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kf"><img src="../Images/66b645d3139594ff65f7d0a4610aa9be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hrcwmqpxo6TFK7SDRX3D3A.png"/></div></div></figure><p id="4277" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">这是该体系结构中的数据流:</p><ol class=""><li id="adcb" class="kr ks hh je b jf ka jj kb jn kt jr ku jv kv jz kw kx ky kz bi translated">OCI监视从自动扩展实例池中的实例收集利用率度量(CPU或内存使用度量)。</li><li id="146f" class="kr ks hh je b jf la jj lb jn lc jr ld jv le jz kw kx ky kz bi translated">如果用户流量增加(例如平均CPU利用率超过%80)，OCI监控会引发扩展事件。</li><li id="5a98" class="kr ks hh je b jf la jj lb jn lc jr ld jv le jz kw kx ky kz bi translated">OCI自动扩展将在实例池中存放新的计算实例。</li><li id="bbef" class="kr ks hh je b jf la jj lb jn lc jr ld jv le jz kw kx ky kz bi translated">OCI自动扩展将向OCI负载平衡器注册新的计算实例。</li><li id="424e" class="kr ks hh je b jf la jj lb jn lc jr ld jv le jz kw kx ky kz bi translated">新的计算实例装载文件存储。</li><li id="7c46" class="kr ks hh je b jf la jj lb jn lc jr ld jv le jz kw kx ky kz bi translated">Linux systemd服务将执行自定义WLST脚本(在实例成功启动后),以创建新的受管服务器并将其添加到WebLogic集群，然后启动受管服务器。</li><li id="7c2b" class="kr ks hh je b jf la jj lb jn lc jr ld jv le jz kw kx ky kz bi translated">如果用户流量减少(例如，平均CPU利用率低于%40)，OCI监控会引发扩大事件。</li><li id="4ab1" class="kr ks hh je b jf la jj lb jn lc jr ld jv le jz kw kx ky kz bi translated">OCI自动缩放将终止实例池中的一个实例(取决于实例池的最小大小)。</li><li id="891e" class="kr ks hh je b jf la jj lb jn lc jr ld jv le jz kw kx ky kz bi translated">实例终止事件将引发并执行OCI函数。</li><li id="7f1f" class="kr ks hh je b jf la jj lb jn lc jr ld jv le jz kw kx ky kz bi translated">OCI函数将在WebLogic管理服务器实例中执行自定义脚本(使用compute run命令功能)以停止并从WebLogic集群中删除受管服务器。</li></ol><blockquote class="lf lg lh"><p id="2aab" class="jc jd li je b jf ka jh ji jj kb jl jm lj kc jp jq lk kd jt ju ll ke jx jy jz ha bi translated">在终止计算实例后(直接从OCI控制台启动终止或自动缩放启动终止)，我们不能在计算实例内执行任何自定义脚本(在我们的场景中，自定义脚本用于从WebLogic集群中删除受管服务器)。此功能(在实例终止前在计算实例内执行自定义脚本)将在未来的OCI版本中提供，但在我们的架构中，要从WebLogic集群中删除受管服务器，我必须使用OCI事件、OCI函数和计算“运行命令”功能的组合来实现一个变通解决方案(我将详细解释该解决方案)。后来)。</p></blockquote><h1 id="66b2" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak">实施步骤</strong></h1><p id="5fbe" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">您可以使用以下步骤在OCI租赁中实现此架构(我假设您已经创建了所有网络先决条件，包括创建VCN、子网、安全列表和路由表。我们需要非常简单的网络设计，包括一个VCN，一个托管WebLogic域的专用子网，一个托管公共负载平衡器的公共子网和一个托管堡垒服务器的公共子网。请参考上面的架构图)。</p><blockquote class="lf lg lh"><p id="073b" class="jc jd li je b jf ka jh ji jj kb jl jm lj kc jp jq lk kd jt ju ll ke jx jy jz ha bi translated">您可以在这个<a class="ae lm" href="https://github.com/omidizadkhasti/oci-weblogic-autoscaling" rel="noopener ugc nofollow" target="_blank"> git资源库</a>中找到本文使用的所有脚本(您需要根据您的环境更新managedServer.properties文件中的WebLogic参数)。</p></blockquote><p id="5f9c" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">WebLogic自定义脚本:</p><ul class=""><li id="39f2" class="kr ks hh je b jf ka jj kb jn kt jr ku jv kv jz ln kx ky kz bi translated"><strong class="je hi"><em class="li">start services . sh</em></strong><em class="li">:</em>该脚本由wl_server.service systemd服务执行，并将执行startWLServer.sh脚本。</li><li id="6bb8" class="kr ks hh je b jf la jj lb jn lc jr ld jv le jz ln kx ky kz bi translated"><strong class="je hi"><em class="li">startwlserver . sh</em></strong>:该脚本执行startNM.sh和createWLManagedServer.py python脚本，启动节点管理器，创建并启动WebLogic托管服务器。</li><li id="c65c" class="kr ks hh je b jf la jj lb jn lc jr ld jv le jz ln kx ky kz bi translated"><strong class="je hi"><em class="li">createwlmanagedserver . py</em></strong>:该脚本在实例预配并成功启动后执行，将创建新的WebLogic计算机和WebLogic托管服务器。创建受管服务器后，将启动受管服务器(此脚本使用计算OCID的最后5个字符来生成受管服务器名称)。</li><li id="7d18" class="kr ks hh je b jf la jj lb jn lc jr ld jv le jz ln kx ky kz bi translated"><strong class="je hi"><em class="li">sttopwlserver . sh</em></strong>:此脚本在实例关闭前执行，将在您关闭(不是终止)计算实例时执行stopNM.sh和stopWLManagedServer.py python脚本来停止节点管理器和WebLogic托管服务器。</li><li id="76c9" class="kr ks hh je b jf la jj lb jn lc jr ld jv le jz ln kx ky kz bi translated"><strong class="je hi"><em class="li">stopwlmanagedserver . py</em></strong>:该脚本将关闭在计算实例内部运行的WebLogic托管服务器。</li><li id="4096" class="kr ks hh je b jf la jj lb jn lc jr ld jv le jz ln kx ky kz bi translated"><strong class="je hi"><em class="li">startnm . sh</em></strong><em class="li">:</em>该脚本将节点管理器监听地址更改为nodemanager.properties文件中的计算机主机名，并将启动节点管理器(节点管理器home已设置为/opt/WLS-auto scaling/node manager文件夹)。</li><li id="10f1" class="kr ks hh je b jf la jj lb jn lc jr ld jv le jz ln kx ky kz bi translated"><strong class="je hi"><em class="li">stopnm . sh</em></strong><em class="li">:</em>这个脚本停止节点管理器。</li><li id="52f0" class="kr ks hh je b jf la jj lb jn lc jr ld jv le jz ln kx ky kz bi translated"><strong class="je hi"><em class="li">destroywlsmanagedserver . py</em></strong>:该脚本在管理服务器计算实例中执行，将在实例池中的计算实例终止后停止并删除受管服务器。该脚本还删除WebLogic计算机。</li></ul><ol class=""><li id="d886" class="kr ks hh je b jf ka jj kb jn kt jr ku jv kv jz kw kx ky kz bi translated"><strong class="je hi">为WebLogic管理服务器预配计算实例。</strong></li></ol><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es lo"><img src="../Images/9a483c6a7ba3a2ba8950c75066ec7b1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9PYI2-QWiqoFeKJcLIg7zA.png"/></div></div></figure><p id="0d28" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi"> 2。提供文件存储(包括文件系统和安装WebLogic二进制文件和域的目标点)。</strong></p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es lp"><img src="../Images/0471ad46694f22ee8cb02e9e55c822ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JwbNPfhbFK1GuQxtcET1FQ.png"/></div></div></figure><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es lq"><img src="../Images/ace9c1c2e7bff253b9debbea2bc23fbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hp8jiB5tM6p8nSYhOpQRoQ.png"/></div></div></figure><p id="435d" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi"> 3。在管理服务器计算中挂载共享文件系统</strong></p><p id="c30f" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">您需要执行以下命令:</p><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="9262" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">WebLogic文件夹结构(根据Oracle企业部署指南):</p><pre class="kg kh ki kj fd lt lu lv lw aw lx bi"><span id="5b6b" class="ly if hh lu b fi lz ma l mb mc">/u01/oracle/product contains binary files</span><span id="cb82" class="ly if hh lu b fi md ma l mb mc">/u01/oracle/config contains domain files</span></pre><figure class="kg kh ki kj fd kk er es paragraph-image"><div class="er es me"><img src="../Images/ebda929de8b8c38308bd4deb23e49244.png" data-original-src="https://miro.medium.com/v2/resize:fit:728/format:webp/1*kleGKUUyxk1orfIQFR2TEg.png"/></div></figure><p id="7145" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi"> 4。在/u01/oracle/product/fmw文件夹(或您选择的文件夹)下安装WebLogic 12.2.1.4二进制文件</strong></p><p id="d988" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi"> 5。在/u01/oracle/product/jdk文件夹(或您选择的文件夹)下安装JDK 1.8。</strong></p><p id="be2b" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">6。提供稍后将在“实例池”创建中使用的公共负载平衡器。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es mf"><img src="../Images/312128f36d0084e1aa021e9105224194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BzJOPE6SXrjCujmS1nZS2g.png"/></div></div></figure><p id="e21f" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">7。创建自定义图像</p><p id="7fd9" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">在OCI配置自动伸缩资源之前，我们需要创建自定义Linux映像，我们将使用它来配置实例池中的实例。</p><p id="5ac8" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">要创建此自定义映像，请使用Oracle Linux映像预配新的计算实例(最好使用与管理服务器计算实例相同的映像)。</p><p id="9fa9" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">在提供新的计算实例后，安装所有必需的包(如有必要，与Python 3、OCI CLI等相同)。)，创建oracle用户和组，并创建与管理服务器计算相同的文件夹(例如/u01/..)并将此文件夹挂载到在步骤2中调配的OCI文件存储(与管理服务器计算相同)。</p><p id="49f2" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">您应该执行与WebLogic管理服务器计算相同的命令。</p><p id="633d" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">另外，在下面的路径中创建一个新文件夹，并将git存储库中的所有脚本复制到这个文件夹中。</p><pre class="kg kh ki kj fd lt lu lv lw aw lx bi"><span id="3a36" class="ly if hh lu b fi lz ma l mb mc">/opt/wls-autoscaling</span></pre><figure class="kg kh ki kj fd kk er es paragraph-image"><div class="er es mg"><img src="../Images/3ab7be0083b3f9271e2c039ea166d209.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*gci5geMxKojSTcJ4kf97EA.png"/></div></figure><p id="7f03" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">将<em class="li">/opt/WLS-auto scaling/scripts</em>文件夹中的wls_server.service复制到<em class="li"> /etc/systemd/system </em>文件夹，以root用户身份执行以下命令，将该脚本安装为systemd脚本(该脚本将在计算启动后执行)。</p><pre class="kg kh ki kj fd lt lu lv lw aw lx bi"><span id="b802" class="ly if hh lu b fi lz ma l mb mc"><em class="li">sudo systemctl enable wls-server</em></span><span id="ed67" class="ly if hh lu b fi md ma l mb mc"><em class="li"># You can use following command to start or stop the service</em></span><span id="9e62" class="ly if hh lu b fi md ma l mb mc"><em class="li">sudo systemctl [start/stop/restart/status] wls-server</em></span></pre><p id="df6f" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">此外，使用root用户创建以下防火墙规则(用于托管服务器和节点管理器端口)。</p><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="d5f4" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">完成上述所有步骤后，您应该通过选择计算实例详细信息页面中的“创建自定义映像”选项来创建自定义映像。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es mh"><img src="../Images/7c76b6730db02dcb4f055fa2778f28fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YnsvvY7aJqLEjMw4I6-U_w.png"/></div></div></figure><p id="3099" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">8。使用自定义图像创建模板计算实例</p><p id="1b8c" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">在此步骤中，我们将使用在步骤7中创建的自定义映像来调配新的计算实例。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es mi"><img src="../Images/ebf9be0dfe24b29a84931bacc5d7e4fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*66qL4NOAsH0SxH0Om4Az9w.png"/></div></div></figure><p id="0e64" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi"> 9。从模板计算实例创建实例配置</strong></p><p id="cacf" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">在此步骤中，我们将使用在步骤8中提供的模板实例来创建实例配置。为此，导航到实例详细信息页面，并从更多操作菜单中选择“创建实例配置”。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es mj"><img src="../Images/a31e2a91610c54deb1bb0b75f7e8edb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9DVfF3GMOg60EqguuzHVFQ.png"/></div></div></figure><p id="0f39" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">选择隔离专区，然后选择实例配置名称。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es mk"><img src="../Images/690ab6c2f0bcc07205b58789b3290631.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZW0X43umWCJBNo3BZDgToQ.png"/></div></div></figure><blockquote class="lf lg lh"><p id="d2bb" class="jc jd li je b jf ka jh ji jj kb jl jm lj kc jp jq lk kd jt ju ll ke jx jy jz ha bi translated">实例配置允许您定义创建计算实例时要使用的设置，您将在自动缩放实例池中使用这些计算实例。</p></blockquote><p id="f0c5" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">10。创建实例池</p><p id="747a" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">创建实例配置后，我们可以通过导航到“实例配置详细信息”页面并选择“创建实例池”来创建实例池(或者您可以导航到OCI控制台中的“计算”-&gt;“实例池”并创建新的实例池，然后选择我们在步骤9中创建的实例配置)。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es ml"><img src="../Images/861894c91f7173b0f5279afa8d122edc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0kKIJZ0LkEGNiyNnMl-uaA.png"/></div></div></figure><p id="9dfa" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">在下一个屏幕中，填充隔离专区、实例池名称，选择实例配置并设置池中实例的目标数量。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es mm"><img src="../Images/e613d4632009f400d09129382f9d6688.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UpvzmQOY3kZbaGqklMouog.png"/></div></div></figure><p id="32e3" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">在下一个屏幕中，填充可用性域、容错域、VCN和子网，以在实例池中配置实例(如果您所在的区域有多个AD，您可以选择另一个AD来配置实例)。</p><p id="d5a5" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">最后，连接您在步骤6中设置的负载平衡器，并选择后端集和托管服务器监听端口。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es mn"><img src="../Images/0632807a3dfb5b027967bd19b7cb66a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BXZoI4EnXU1ABwKVDAKc9Q.png"/></div></div></figure><p id="b61f" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">创建实例池后，将提供新的计算实例(取决于实例数量的值)，并且WebLogic脚本将自动创建。并在计算实例启动后向WebLogic集群启动新的受管服务器(自定义脚本将使用WLS- <last five="" character="" of="" compute="" ocid="">作为受管服务器名称)。</last></p><p id="7a8f" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">您可以连接到WebLogic管理服务器来验证受管服务器的创建。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es mo"><img src="../Images/c05614c753ce62c1ddb753c466c08c68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lf3AC1hDCUqAmkJuPsfv5Q.png"/></div></div></figure><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es mp"><img src="../Images/d8eec2319d2e95d4333d7e0a219596dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cfCfKvZu7cPWsigz3WPE6Q.png"/></div></div></figure><p id="22a1" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">此外，您可以使用负载平衡器公共IP地址来验证配置。</p><pre class="kg kh ki kj fd lt lu lv lw aw lx bi"><span id="b265" class="ly if hh lu b fi lz ma l mb mc"><a class="ae lm" href="http://168.138.7.87/sample/" rel="noopener ugc nofollow" target="_blank"><em class="li">http://&lt;&lt;Load Balancer Public IP&gt;&gt;/sample/</em></a></span></pre><p id="ae20" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi"> 11。创建自动缩放配置</strong></p><p id="e2be" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">最后，我们将创建自动扩展配置，允许您自动调整实例池中计算实例的数量或生命周期状态。</p><p id="f596" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">导航到OCI控制台中的计算-&gt;自动扩展配置，然后选择创建新的自动扩展配置。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es mq"><img src="../Images/15bda104a9d906e4f859d42e8bf71366.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jafP7qmX7mQxWUG8RTiGYQ.png"/></div></div></figure><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es mr"><img src="../Images/1735c5cb9b4a829dec08273904463d25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gUPP0uLQ2bpHL6X1Y2opHA.png"/></div></div></figure><p id="6afe" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">在下一个屏幕中，我们将使用性能指标创建自动扩展策略来添加/删除实例。在我们的场景中，我创建了一个策略，如果平均CPU利用率超过80%,就向实例池添加新实例，如果平均CPU利用率低于50%,就终止一个实例。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es ms"><img src="../Images/8a34e8d06f9435c92393631bca8eff43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R5W-5IElYrwyo0kMkxvxZg.png"/></div></div></figure><p id="e540" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi"> 12。创建OCI事件规则</strong></p><p id="8b67" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">在接下来的几个步骤中，我将配置OCI事件规则、OCI函数和计算机运行命令，以便在实例终止时从WebLogic集群中删除受管服务器和计算机。</p><p id="7815" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">导航到OCI控制台中的事件并创建新的事件规则。为事件类型“实例—终止开始”创建新规则，将compartmentid属性设置为包含计算实例的隔离专区OCID。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es mt"><img src="../Images/f30b32c5a0b9486c08d1adc431ffb35a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eyxYIAfE1OSb0jTLXj_Nlg.png"/></div></div></figure><p id="53ef" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">为事件添加新操作，以便在事件引发时执行OCI函数(您可以添加另一个操作，以便在实例终止事件引发时发送通知电子邮件)。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es mu"><img src="../Images/3eb5b5eb67df5cb74d37042eda2090db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gccho9-nXraN2H_9zhAD9Q.png"/></div></div></figure><p id="f9e8" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">13。创建OCI函数以在WebLogic管理服务器上执行命令</p><p id="6f46" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">最后，我们需要创建新的OCI函数，以便在自动缩放策略引发实例池中的实例终止事件时执行。此函数从事件有效负载中获取实例OCID，该事件有效负载将其传递给在WebLogic管理服务器实例中执行命令(destroyWLManagedServer.py脚本)的函数(将实例OCID作为参数传递给自定义脚本)，以便在实例终止后从WebLogic域中删除受管服务器和计算机。</p><p id="92de" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">以下是实例终止事件引发时的OCI事件负载示例:</p><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="9fc9" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">您可以在git资源库中找到OCI函数的源代码。</p><p id="2f46" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">以下是创建和部署新OCI函数的步骤:</p><p id="f776" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">首先，您需要导航到OCI控制台中的开发人员服务-&gt;应用程序，并创建新的应用程序。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es mv"><img src="../Images/f1f76e87250425ac288c1a132b4a6efd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t9FcACk2_tpIy4ibntRutA.png"/></div></div></figure><p id="5adb" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">然后，您需要在应用程序中创建函数(首先，您需要创建函数docker映像，并将映像导入OCI注册表)。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es mw"><img src="../Images/101b7d919c32eb4b40872e245497e649.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PUMDVD_7EOlxkL_D3D3ohA.png"/></div></div></figure><p id="bfc2" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">此外，您需要创建以下功能配置:</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es mx"><img src="../Images/fe4d9393e0398a925263604ad109b402.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PpB3G0_WMJR6seRhM8oyRA.png"/></div></div></figure><p id="219d" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi"> <em class="li"> command_text </em> </strong>:您要在目标实例中执行的命令。</p><p id="c942" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi"> <em class="li">目标实例OCID </em> </strong>:要执行命令的目标实例的OIC(在我们的场景中是WebLogic管理服务器计算OICD)。</p><blockquote class="lf lg lh"><p id="e573" class="jc jd li je b jf ka jh ji jj kb jl jm lj kc jp jq lk kd jt ju ll ke jx jy jz ha bi translated">您可以按照本文档<a class="ae lm" href="https://docs.oracle.com/en-us/iaas/Content/Functions/Tasks/functionsuploading.htm" rel="noopener ugc nofollow" target="_blank">从您的本地机器将该功能部署到OCI租赁。</a></p></blockquote><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="lr ls l"/></div></figure><figure class="kg kh ki kj fd kk"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="930a" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">最后，您需要更新事件动作中的函数信息，以便在事件引发时执行该函数。</p><p id="208c" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi"> 13。创建OCI动态组和策略</strong></p><p id="31c1" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">OCI函数需要在计算实例中创建命令的权限。</p><p id="3933" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">要创建这个权限，我们首先需要创建一个包含我们函数的动态组。导航到身份与安全-&gt;动态组，并创建新的动态组。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es my"><img src="../Images/cd47e2bbf9779bb22a12bda2b5079f81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0isOKzz4mQiNF_azVhykoQ.png"/></div></div></figure><p id="07bc" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">该动态组包括特定车厢内的所有功能(匹配车厢OCID)。</p><p id="02d9" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">然后，我们需要创建新策略，以允许我们创建的动态组在包含计算实例的隔离专区中管理实例-代理-命令-系列。</p><pre class="kg kh ki kj fd lt lu lv lw aw lx bi"><span id="328b" class="ly if hh lu b fi lz ma l mb mc"><strong class="lu hi"><em class="li">Allow dynamic-group omid-fn-dg to manage instance-agent-command-family in compartment &lt;&lt;compartment that include compute instance&gt;&gt;</em></strong></span></pre><p id="c5de" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><em class="li">我关于OCI WebLogic自动缩放的文章到此结束。我只想强调这是在OCI或任何其他云提供商上实现WebLogic自动伸缩的解决方案之一(我们可以使用WebLogic动态集群，使用WebLogic operator在Kubernetes上配置WebLogic，等等。).我还想鼓励在将工作负载迁移到云时使用云原生解决方案(而不是简单地将工作负载转移到云)。</em></p><h1 id="8c2d" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">参考</h1><ul class=""><li id="ef8e" class="kr ks hh je b jf jg jj jk jn mz jr na jv nb jz ln kx ky kz bi translated"><a class="ae lm" href="https://docs.oracle.com/en-us/iaas/Content/Compute/Tasks/autoscalinginstancepools.htm" rel="noopener ugc nofollow" target="_blank">https://docs . Oracle . com/en-us/iaas/Content/Compute/Tasks/autoscalinginstancepools . htm</a></li><li id="65ad" class="kr ks hh je b jf la jj lb jn lc jr ld jv le jz ln kx ky kz bi translated"><a class="ae lm" href="https://docs.oracle.com/en-us/iaas/Content/Events/Concepts/eventsoverview.htm" rel="noopener ugc nofollow" target="_blank">https://docs . Oracle . com/en-us/iaas/Content/Events/Concepts/Events overview . htm</a></li><li id="1de8" class="kr ks hh je b jf la jj lb jn lc jr ld jv le jz ln kx ky kz bi translated"><a class="ae lm" href="https://docs.oracle.com/en-us/iaas/Content/Functions/Concepts/functionsoverview.htm" rel="noopener ugc nofollow" target="_blank">https://docs . Oracle . com/en-us/iaas/Content/Functions/Concepts/Functions overview . htm</a></li><li id="dd98" class="kr ks hh je b jf la jj lb jn lc jr ld jv le jz ln kx ky kz bi translated"><a class="ae lm" href="https://docs.oracle.com/en-us/iaas/Content/Compute/Tasks/runningcommands.htm" rel="noopener ugc nofollow" target="_blank">https://docs . Oracle . com/en-us/iaas/Content/Compute/Tasks/running commands . htm</a></li></ul></div></div>    
</body>
</html>