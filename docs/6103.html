<html>
<head>
<title>Migrating Pinterest profiles to React</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">迁移Pinterest档案以作出反应</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/migrating-pinterest-profiles-to-react-479f4f7306aa?source=collection_archive---------2-----------------------#2016-09-23">https://medium.com/pinterest-engineering/migrating-pinterest-profiles-to-react-479f4f7306aa?source=collection_archive---------2-----------------------#2016-09-23</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="17d8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Imad Elyafi | Pinterest工程师，核心体验</p><p id="adf2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">自2012年以来，我们在<a class="ae jc" href="http://http://backbonejs.org/" rel="noopener ugc nofollow" target="_blank">主干</a>之上扩展了我们的网络框架丹泽尔(以有史以来最伟大的演员命名)。但如今，<a class="ae jc" href="https://facebook.github.io/react/" rel="noopener ugc nofollow" target="_blank">的反应</a>是金标准。它拥有一个庞大的开发人员社区，能够实现卓越的工程速度和性能。在这里，我们将看看我们尝试的技术和我们在迁移到React时面临的挑战，从Pinner配置文件开始。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/9e1d786017b8d2b32991db60a525d230.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/0*j39pfUs_DN6JoeO4.png"/></div></figure><h2 id="7508" class="jl jm hh bd jn jo jp jq jr js jt ju jv ip jw jx jy it jz ka kb ix kc kd ke kf bi translated">准备基础设施(服务器端Nunjucks)</h2><p id="ba43" class="pw-post-body-paragraph ie if hh ig b ih kg ij ik il kh in io ip ki ir is it kj iv iw ix kk iz ja jb ha bi translated">我们经常发布新功能，每天进行数百次实验，所以我们不能为了在React中重建整个网站而停止产品开发。虽然在React中构建一个新的web应用程序相对容易，但迁移一个不断变化并被数百万人使用的服务却是一个复杂得多的挑战。这就像在飞行中更换飞机引擎一样。</p><p id="7afc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">之前，我们在Python中使用了<a class="ae jc" href="http://jinja.pocoo.org/" rel="noopener ugc nofollow" target="_blank"> Jinja </a>模板引擎进行服务器端渲染，并使用了名为<a class="ae jc" href="https://mozilla.github.io/nunjucks/" rel="noopener ugc nofollow" target="_blank"> Nunjucks </a>的JavaScript等价物进行客户端浏览器渲染。这些模板引擎非常相似，允许我们进行通用渲染(在客户端和服务器端使用相同的模板)。因为React不能在Python中呈现，所以作为第一步，我们在独立的NodeJS服务器上启用了Nunjucks呈现。现在，我们有了纯粹的同构渲染，JavaScript在服务器端和客户端。</p><h2 id="f386" class="jl jm hh bd jn jo jp jq jr js jt ju jv ip jw jx jy it jz ka kb ix kc kd ke kf bi translated">丹泽尔反应桥</h2><p id="6969" class="pw-post-body-paragraph ie if hh ig b ih kg ij ik il kh in io ip ki ir is it kj iv iw ix kk iz ja jb ha bi translated">为了让工程师能够逐步将UI的核心部分转换为React，我们在Denzel内部启用了React渲染。在大多数情况下，可以使用React.render()，所以我们用一个新的关键字component向Nunjucks的模板语言添加了React特定的绑定，以表示Denzel和React之间的“桥梁”。结合我们的<a class="ae jc" href="https://engineering.pinterest.com/blog/building-pinterest%E2%80%99s-ab-testing-platform" rel="noopener ugc nofollow" target="_blank"> A/B测试框架</a>，我们可以根据传统Denzel组件轻松测量React组件，并控制某些指标，如Pinner等待时间、首字节时间和错误率。</p><p id="441d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是一个在Nunjucks模板中呈现MyReactComponent.js的示例:</p><pre class="je jf jg jh fd kl km kn ko aw kp bi"><span id="4f77" class="jl jm hh km b fi kq kr l ks kt">{% if in_react %}<br/>  {{ component('MyReactComponent', {pinId: '123'}) }}<br/>{% else %}<br/>  {{ module('MyDenzelComponent', pinId='123') }}<br/>{% endif %}</span></pre><h2 id="7b71" class="jl jm hh bd jn jo jp jq jr js jt ju jv ip jw jx jy it jz ka kb ix kc kd ke kf bi translated">适配器的高阶组件</h2><p id="066b" class="pw-post-body-paragraph ie if hh ig b ih kg ij ik il kh in io ip ki ir is it kj iv iw ix kk iz ja jb ha bi translated">最后一步是向新创建的React组件提供数据。我们创建了一个名为withResource的高阶组件(HOC ),以便轻松地从我们的API获取数据，同时保持与其他HOC的可组合性。withResource的简化版本为包装的组件提供了一个数据属性:</p><pre class="je jf jg jh fd kl km kn ko aw kp bi"><span id="df81" class="jl jm hh km b fi kq kr l ks kt">import ResourceFactory from 'ResourceFactory';<br/><br/>export default withResource = ({ name, options }) =&gt; (Subject) =&gt; {<br/>  return class extends Component {<br/><br/>    state = {<br/>      data: null<br/>    };<br/><br/>    componentDidMount() {<br/>      const resourceOptions = getOptions(options, this.props);<br/>      const resource = ResourceFactory.create(name, resourceOptions);<br/><br/>      resource.callGet().then((resourceResponse) =&gt; {<br/>        this.setState({ data: resourceResponse.data });<br/>      });<br/>    }<br/><br/>    render() {<br/>      return (<br/>        &lt;Subject<br/>          data={this.state.data}<br/>          {...this.props}<br/>        /&gt;<br/>      );<br/>    }<br/>  };<br/>};</span></pre><h2 id="979f" class="jl jm hh bd jn jo jp jq jr js jt ju jv ip jw jx jy it jz ka kb ix kc kd ke kf bi translated">例子</h2><pre class="je jf jg jh fd kl km kn ko aw kp bi"><span id="ddce" class="jl jm hh km b fi kq kr l ks kt">import withResource from 'withResource';<br/><br/>class MyComponent extends Component {<br/>  render() {<br/>    return (<br/>      &lt;div&gt;{'Username:' + this.props.data.name}&lt;/div&gt;<br/>    );<br/>  }<br/>};<br/><br/>export default withResource({<br/>  name: 'MyResource',<br/>  options: props =&gt; {<br/>    return { pin_id: props.pinId };<br/>  },<br/>})(MyComponent);</span></pre><h2 id="12a8" class="jl jm hh bd jn jo jp jq jr js jt ju jv ip jw jx jy it jz ka kb ix kc kd ke kf bi translated">结果</h2><p id="3136" class="pw-post-body-paragraph ie if hh ig b ih kg ij ik il kh in io ip ki ir is it kj iv iw ix kk iz ja jb ha bi translated">在转换Pinners的档案以作出反应的过程中，我们看到了持续的绩效和参与度提高。绩效和参与度指标各增长了20%。当我们转换配置文件时，web产品工程师继续对旧的Denzel组件进行更改，同时创建新的React组件。</p><p id="ee56" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">鸣谢:该项目的核心贡献者包括Imad Elyafi、Braden Anderson、Chris Lloyd、Kevin Grandon、Jessica Chan以及WebCore Experience团队的其他成员。公司的许多工程师也提供了有益的反馈。</p></div></div>    
</body>
</html>