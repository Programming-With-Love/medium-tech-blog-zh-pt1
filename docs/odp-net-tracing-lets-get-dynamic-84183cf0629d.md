# ODP.NET 追踪——让我们动起来

> 原文：<https://medium.com/oracledevs/odp-net-tracing-lets-get-dynamic-84183cf0629d?source=collection_archive---------7----------------------->

![](img/d9f9a3c735e45fd488a05ef78cf1b54b.png)

ODP。NET 调试跟踪不是您计划使用的功能。启用它意味着您遇到了问题，需要收集诊断信息来确定根本原因。可以指示 ODP.NET 将其部分或全部活动记录到一个或多个跟踪文件中。

使用跟踪的一个挑战可能是文件非常大。如果在应用程序使用的早期出现问题，就会生成一个小的跟踪文件。一个小文件很容易上传和评估。没问题。现在，如果问题仅在运行数小时后才重现，跟踪文件将会非常大。当文件是几百兆或几千兆字节大时，它们更难上传和调试。

另一个跟踪问题出现在生产应用程序中。理想情况下，您不希望在生产环境中进行调试。但是，如果问题只发生在生产中，您没有其他选择。由于频繁的磁盘写入，跟踪会增加性能开销。应用所有者不喜欢降低终端用户生产服务水平的副作用。

在 ODAC 19c 第 1 版中，ODP.NET 增加了两个新的跟踪功能来应对这些挑战:

*   动态跟踪
*   跟踪文件大小限制

动态跟踪允许在运行时启用和禁用跟踪输出。开发人员可以只在问题发生时才打开跟踪，这样可以节省磁盘空间，并且更容易共享最终的跟踪文件。此外，当启用跟踪时，额外的性能开销只需要在很短的时间内发生。

为了防止任何文件变得太大，可以设置跟踪文件大小限制。当 ODP.NET 达到大小限制时，它会创建一个新的跟踪文件来继续写入跟踪输出。

这些特性在所有三种 ODP.NET 驱动程序类型中都可用:核心、托管和非托管。

# 动态跟踪

ODP。网络跟踪使用三种传统设置:

*   `TraceFileLocation` —跟踪文件目录位置
*   `TraceLevel` —跟踪级别
*   `TraceOption` —为每个线程生成一个跟踪文件或一个文件

这些设置可以在中修改。NET 配置文件和通过`OracleConfiguration`类的代码。

没有为动态跟踪引入新的 API。相反，为了在运行时启用或禁用跟踪，开发人员需要修改`OracleConfiguration.TraceLevel`的值。默认情况下，跟踪被禁用(`TraceLevel=0`)。当应用程序更改`TraceLevel`的值时，例如设置`TraceLevel=7`，ODP.NET 将开始写入指定的跟踪文件目录。要再次禁用跟踪，只需将属性值设置回零。

动态跟踪仅适用于`OracleConfiguration.TraceLevel`属性。它不能用启用。NET 配置文件或 Windows 注册表，因为在大多数情况下，它们的值只在应用程序启动时读取。当然，动态跟踪要求能够在应用程序运行时启用和禁用跟踪。

# 限制跟踪文件大小

动态跟踪消除了单个跟踪文件变大的大多数原因，但不是全部原因。可能会出现一些间歇性的 ODP.NET 问题，使得知道何时打开跟踪变得困难。在某些情况下，开发人员不希望修改代码、重新构建和重新部署来启用跟踪。

为了解决这些情况，可以通过使用`TraceFileMaxSize`设置将跟踪限制到最大文件大小。默认情况下，其值为 100，这表示最大文件大小为 100 兆字节。当 ODP.NET 达到最大文件大小限制时，它会在跟踪文件目录中创建新的跟踪文件，并开始写入该新文件。

在`OracleConfiguration`类(所有 ODP.NET 提供者)上，`TraceFileMaxSize`设置是可用的属性。NET 配置文件(托管和非托管 ODP。NET)、Windows 注册表(非托管 ODP。网)。

对于托管和非托管 ODP.NET，`TraceFileMaxSize`可以在不修改代码的情况下进行修改，这意味着不需要重新编译。就做这个。NET 配置文件或 Windows 注册表更改，然后(重新)启动应用程序。如果您同时启用跟踪，请确保也设置了`TraceLevel`值。将来，ODP.NET 核心还将允许在配置文件中启用这些跟踪选项。

# 结论

使用较小的 ODP.NET 跟踪文件，可以更容易地管理、分析和找到问题的根本原因。希望你永远不会使用 ODP.NET 跟踪。如果您这样做了，这些新特性应该会使您更容易配置和使用调试跟踪。