<html>
<head>
<title>Mark Old PL/SQL Code as "Not For Use":12 Things Developers Will Love About Oracle Database 12c Release 2 Part 11</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将旧的PL/SQL代码标记为“不可使用”:开发人员会喜欢的关于Oracle Database 12c第2版第11部分的12件事</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/mark-old-code-as-not-for-use-12-things-developers-will-love-about-oracle-database-12c-release-2-d09eb1233f7a?source=collection_archive---------0-----------------------#2017-10-18">https://medium.com/oracledevs/mark-old-code-as-not-for-use-12-things-developers-will-love-about-oracle-database-12c-release-2-d09eb1233f7a?source=collection_archive---------0-----------------------#2017-10-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="94c3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">时代变了。新代码很快变成遗留代码。遗留代码经常被更好、更快的代码所取代。所以你反对旧的代码。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jc"><img src="../Images/0c3ce7da71a09c3f9f29d31c1b35adf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*Ogb4u9xoB0mzqSR1.png"/></div></figure><p id="962f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但这带来了一个问题:</p><p id="2b70" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你如何阻止人们使用遗留模块？</p><p id="3563" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">人们倾向于坚持他们所知道的。即使在你反复告诉每个人转移到新模块之后，总有(至少)一个开发人员坚持使用废弃的过程，而不是更新、更好的选项。</p><p id="2dfc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在复杂的应用程序中，很难跟踪什么是过时的。</p><p id="50d9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这很难解决。</p><p id="3e69" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，为了帮助您完成弃用过程，我们为此引入了一个新的pragma。</p><p id="5800" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要使用它，请放置</p><pre class="jd je jf jg fd jk jl jm jn aw jo bi"><span id="4072" class="jp jq hh jl b fi jr js l jt ju">pragma deprecate ( <br/>  deprecated_thing, <br/>  'Message to other developers' <br/>);</span></pre><p id="9758" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">退役部分下面。</p><p id="f935" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">太好了。但是这有什么用呢？</p><p id="3387" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们添加了一些新的PL/SQL警告:PLW-6019到PLW-6022。启用这些选项，Oracle会告诉您是否正在使用不推荐使用的代码:</p><pre class="jd je jf jg fd jk jl jm jn aw jo bi"><span id="e3b7" class="jp jq hh jl b fi jr js l jt ju">alter session set plsql_warnings = 'enable:(6019,6020,6021,6022)';</span><span id="bf9d" class="jp jq hh jl b fi jv js l jt ju">create or replace procedure your_old_code is <br/>  pragma deprecate ( <br/>    your_old_code, <br/>    'This is deprecated. Use new_code instead!' <br/>  ); <br/>  begin <br/>    null; <br/>  end your_old_code; <br/>/ </span><span id="5c0d" class="jp jq hh jl b fi jv js l jt ju">show err <br/>Warning(2,3): PLW-06019: entity YOUR_OLD_CODE is deprecated</span></pre><p id="c405" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这太棒了。但是我们一直都忽略了“AUTHID DEFINER”的警告！如果代码真的过时了，如果你能阻止人们一起使用它就好了。</p><p id="3b4a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">幸运的是你可以！</p><p id="ae59" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">警告的好处就在于此。你可以把它们升级成错误！当您编写调用不赞成使用的项的代码时，会引发PLW-6020。将此设置为error，违规代码将无法编译:</p><pre class="jd je jf jg fd jk jl jm jn aw jo bi"><span id="90d8" class="jp jq hh jl b fi jr js l jt ju">alter session set plsql_warnings = 'error:6020'; </span><span id="c15a" class="jp jq hh jl b fi jv js l jt ju">create or replace procedure calling_old_code is <br/>begin <br/>  your_old_code(); <br/>end calling_old_code; <br/>/ <br/>show err <br/>3/3 PLS-06020: reference to a deprecated entity: <br/>  This is deprecated. Use new_code instead!</span></pre><p id="0971" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当然，如果你把PLW-6020变成一个错误系统，很多东西可能会坏掉！因此您可以在给定的对象上有选择地升级它:</p><pre class="jd je jf jg fd jk jl jm jn aw jo bi"><span id="54b6" class="jp jq hh jl b fi jr js l jt ju">alter procedure calling_old_code compile <br/>  plsql_warnings = 'error:6020' reuse settings;</span></pre><p id="b1ae" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以现在你有权力强迫别人停止使用史前代码。</p></div><div class="ab cl jw jx go jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="ha hb hc hd he"><p id="f59b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="kd">全文原载于2016年11月10日</em><a class="ae ke" href="https://blogs.oracle.com/sql/12-things-developers-will-love-about-oracle-database-12c-release-2" rel="noopener ugc nofollow" target="_blank"><em class="kd">【blogs.oracle.com】</em></a><em class="kd">。</em></p></div></div>    
</body>
</html>