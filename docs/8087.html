<html>
<head>
<title>DMaaS — Database Migrations as a Service</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">DMaaS —数据库迁移即服务</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/dmaas-database-migrations-as-a-service-f2bbb0974f94?source=collection_archive---------1-----------------------#2021-12-09">https://medium.com/walmartglobaltech/dmaas-database-migrations-as-a-service-f2bbb0974f94?source=collection_archive---------1-----------------------#2021-12-09</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="6da5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">数据库迁移的整体方法，不仅仅是数据传输。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/c70df9a2670d94359e61b67c3b17524d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Uy9_pFLKUCEMvOCK"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Photo by <a class="ae js" href="https://unsplash.com/@jcraice?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Julia Craice</a> on <a class="ae js" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="6c99" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，在消费网络内容十多年后，我很高兴成为一名贡献者:)！</p><h1 id="995e" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">前言</h1><p id="889f" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">与像沃尔玛这样的企业合作的一个最好的方面是总是考虑大规模。就像数据库迁移一样！</p><p id="5e06" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在过去几年中，我们看到数据库迁移呈指数级增长，这主要是由于采用了云技术。随着不断发展的技术堆栈和多云的采用，这种上升趋势将会继续。</p><blockquote class="kw kx ky"><p id="a068" class="ie if kz ig b ih ii ij ik il im in io la iq ir is lb iu iv iw lc iy iz ja jb ha bi translated">开发人员社区变得越来越聪明，在开发阶段就考虑数据库迁移，而不是事后才想到。这使得开发人员能够更加灵活地改变技术栈，或者非常方便地适应尖端的数据库解决方案。然而，<strong class="ig hi">数据库迁移活动仍然是一个挑战</strong>。</p></blockquote><p id="ac36" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们有几十种可用的数据传输工具(<a class="ae js" href="https://www.softwaretestinghelp.com/data-migration-tools" rel="noopener ugc nofollow" target="_blank">迁移工具</a>)，可以执行同构(例如，MSSQL到MS SQL)或异构(例如，MS SQL到Oracle)数据库迁移。</p><p id="19e0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这些迁移工具可以很好地处理使用变更数据捕获的一次性甚至连续迁移。这确保了数据不会丢失，并极大地减少了迁移期间的停机时间/业务影响。</p><p id="7c10" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">问题是<strong class="ig hi">目前大多数可用的数据库迁移工具只涵盖数据传输活动</strong>。但是，实际的数据库迁移活动要复杂得多，需要在迁移后的&amp;之前执行多个活动。这些前期&amp;后期活动以及与现有迁移工具的交互需要一定水平的DBA专业知识。</p><p id="3e64" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这使得整个数据库迁移过程相当麻烦和耗时。</p><p id="eaf7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是使用<strong class="ig hi">at unity replicate服务器的手动迁移流程图。</strong></p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es ld"><img src="../Images/b143c7b005977039127a8a27a647682f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*hEA4DDW3pAZOCL9naJeAOA.png"/></div><figcaption class="jo jp et er es jq jr bd b be z dx">Database Migration — Manual Execution Flow</figcaption></figure><p id="9fa6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们进一步放大问题陈述。</p><h1 id="1030" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">问题陈述</h1><p id="bf3c" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">按照上面的流程，当前的流程包括应用程序团队与数据库迁移顾问(异构迁移)或DBA团队(同构迁移)一起迁移他们的数据库。</p><p id="b62e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，迁移顾问或数据库管理员使用Attunity replicate工具手动执行迁移。</p><p id="02f4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">预迁移活动包括但不限于</strong></p><ol class=""><li id="67f0" class="le lf hh ig b ih ii il im ip lg it lh ix li jb lj lk ll lm bi translated">连通性测试。</li><li id="348b" class="le lf hh ig b ih ln il lo ip lp it lq ix lr jb lj lk ll lm bi translated">查询源数据库表元数据(行数、表大小)以决定在一个迁移任务的范围内包括哪些表。(并行以减少迁移持续时间/排除不再需要的表)</li><li id="765e" class="le lf hh ig b ih ln il lo ip lp it lq ix lr jb lj lk ll lm bi translated">检查目标数据库表是否有记录(以避免意外覆盖)。</li><li id="b16d" class="le lf hh ig b ih ln il lo ip lp it lq ix lr jb lj lk ll lm bi translated">禁用目标数据库中的约束(如果有),以避免在迁移过程中出现与约束相关的错误。</li></ol><p id="35cb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">启动实际的数据库迁移。</strong></p><p id="157b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">迁移后活动包括但不限于</strong></p><ol class=""><li id="8ec0" class="le lf hh ig b ih ii il im ip lg it lh ix li jb lj lk ll lm bi translated">检查迁移的状态</li><li id="1913" class="le lf hh ig b ih ln il lo ip lp it lq ix lr jb lj lk ll lm bi translated">生成迁移的状态报告，以查看是否所有表都已成功迁移。</li><li id="186f" class="le lf hh ig b ih ln il lo ip lp it lq ix lr jb lj lk ll lm bi translated">如果出现故障，请查看迁移工具的错误日志，找出故障的确切原因。</li><li id="6d45" class="le lf hh ig b ih ln il lo ip lp it lq ix lr jb lj lk ll lm bi translated">如果失败，请重试迁移任务。</li><li id="19a3" class="le lf hh ig b ih ln il lo ip lp it lq ix lr jb lj lk ll lm bi translated">在重试之前截断目标数据库表并禁用约束(如果有)。</li><li id="c8b7" class="le lf hh ig b ih ln il lo ip lp it lq ix lr jb lj lk ll lm bi translated">如果迁移成功，则启用约束。</li></ol><p id="1544" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上述任务列表使得整个迁移过程非常复杂，并导致大量手动工作。这给迁移项目造成了瓶颈，因为管道中的数据库迁移请求与迁移顾问/DBA团队资源的比率永远不会匹配。</p><p id="5f5b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最终，这会通过剥夺最终用户的一些新的酷功能或通过更长时间地支持遗留系统来消耗收入，从而产生间接的业务影响。</p><p id="ff3c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">进入“<strong class="ig hi"> DMaaS —数据库迁移即服务”！</strong></p><h1 id="d716" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated"><strong class="ak">“DMaaS”来救援了！</strong></h1><p id="9848" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">我们查看了上面的问题陈述，以了解我们如何帮助简化这种与数据库相关的高接触性操作活动，并开发一个自动化框架来减少手动工作。</p><p id="88cf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">“DMaaS—数据库迁移即服务”</strong>工具帮助我们解决了这个问题。</p><p id="9ecd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一个全面查看数据库迁移的<strong class="ig hi"> </strong>工具会自动执行迁移前&amp;和迁移后活动以及实际的数据迁移。这使得整个数据库迁移过程只需点击几下鼠标即可完成，无需任何DBA的参与/知识。</p><p id="6045" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们与数据库迁移团队合作，了解典型数据库迁移请求的端到端<a class="ae js" href="https://en.wikipedia.org/wiki/Runbook" rel="noopener ugc nofollow" target="_blank">“操作手册”</a>。这本操作手册帮助我们理解了迁移操作的整个生命周期，从而定义了自动化的范围。</p><p id="2b4f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最初的想法是看看哪些活动可以自动化，以减少琐碎迁移(开发/试运行、小批量生产等)期间对迁移顾问/数据库管理员的依赖。).然而，在决定MVP时，我们确定了一个简单的模式，如“前活动”、“主任务”和“后活动”</p><p id="2d96" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这使我们能够开发<strong class="ig hi">“DMaaS—数据库迁移自动化”</strong>工具，以完全消除对迁移顾问/数据库管理员的依赖，至少对于琐碎的迁移*(开发/试运行、低容量生产等)。)</p><p id="2ca7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这允许应用程序团队独立地执行他们琐碎的迁移！</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ls"><img src="../Images/9963d958ae2ac51481d0b9bf0c3b0e8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M_JHJueiNYLur-fPtLduAg.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">DMaaS — Migration Automation Flow</figcaption></figure><p id="d472" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">(*剖析重要的迁移可以是一个独立的博客本身！)</p><h1 id="5e68" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">工具和技术</h1><ul class=""><li id="5e2f" class="le lf hh ig b ih kr il ks ip lt it lu ix lv jb lw lk ll lm bi translated"><a class="ae js" href="https://help.qlik.com/en-US/enterprise-manager/November2020/Content/EnterpriseManager/Main/Introduction/Home.htm" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi"> Attunity企业管理器</strong> </a>，<strong class="ig hi"> </strong>，其公开<a class="ae js" href="https://help.qlik.com/en-US/enterprise-manager/November2020/Content/EnterpriseManager/EnterpriseManager_APIGuide/CurlAPI/aem_rest_api_prereqs.htm" rel="noopener ugc nofollow" target="_blank">REST API</a>以编程方式与Attunity Replicate服务器进行交互。</li><li id="0732" class="le lf hh ig b ih ln il lo ip lp it lq ix lr jb lw lk ll lm bi translated"><a class="ae js" href="https://concord.walmartlabs.com/docs/index.html" rel="noopener ugc nofollow" target="_blank"><strong class="ig hi">Concord server</strong></a><strong class="ig hi"/>用于托管UI和编排工作流(也可以是单独的应用服务器)。</li><li id="34be" class="le lf hh ig b ih ln il lo ip lp it lq ix lr jb lw lk ll lm bi translated">用于用户界面的HTML、Javascript。</li><li id="9096" class="le lf hh ig b ih ln il lo ip lp it lq ix lr jb lw lk ll lm bi translated"><strong class="ig hi">负责</strong>模板功能&amp;访问Attunity服务器。这有助于我们创建一个JSON对象，该对象捕获Attunity Replicate处理数据迁移所需的所有信息。</li><li id="5b6b" class="le lf hh ig b ih ln il lo ip lp it lq ix lr jb lw lk ll lm bi translated"><strong class="ig hi"> PL/SQL </strong> —用于获取表和存储过程列表的SQL查询(动态获取约束列表并启用/禁用它们)。</li><li id="5da0" class="le lf hh ig b ih ln il lo ip lp it lq ix lr jb lw lk ll lm bi translated"><strong class="ig hi"> Python </strong>脚本处理字符串操作(上帝保佑Python！:) ).</li><li id="8b67" class="le lf hh ig b ih ln il lo ip lp it lq ix lr jb lw lk ll lm bi translated"><strong class="ig hi">电子邮件，服务-现在&amp;吉拉集成</strong>用于管理活动，如通知、变更流程验证以及在出现故障时创建自动票证。</li></ul><h1 id="9535" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">“DMaaS”的显著特征</h1><ul class=""><li id="6ef5" class="le lf hh ig b ih kr il ks ip lt it lu ix lv jb lw lk ll lm bi translated">通过单一链接一站式处理所有与迁移相关的活动。</li><li id="0ef5" class="le lf hh ig b ih ln il lo ip lp it lq ix lr jb lw lk ll lm bi translated">迁移前检查源和目标数据库连接。</li><li id="eb9c" class="le lf hh ig b ih ln il lo ip lp it lq ix lr jb lw lk ll lm bi translated">至少在简单的迁移中，不需要DBA专业知识。</li><li id="31b0" class="le lf hh ig b ih ln il lo ip lp it lq ix lr jb lw lk ll lm bi translated">ServiceNow更改验证(验证已批准的生产数据库迁移CRQ)。</li><li id="aac4" class="le lf hh ig b ih ln il lo ip lp it lq ix lr jb lw lk ll lm bi translated">具有排序(基于行数和大小)和搜索功能(允许部分迁移)的表选择</li><li id="f0d6" class="le lf hh ig b ih ln il lo ip lp it lq ix lr jb lw lk ll lm bi translated"><strong class="ig hi">目标数据库的预迁移验证任务</strong>，如禁用约束&amp;行计数检查，被嵌入到流程中。</li><li id="fc4a" class="le lf hh ig b ih ln il lo ip lp it lq ix lr jb lw lk ll lm bi translated"><strong class="ig hi">启动实际迁移</strong>并发送迁移状态的定期更新。</li><li id="e509" class="le lf hh ig b ih ln il lo ip lp it lq ix lr jb lw lk ll lm bi translated"><strong class="ig hi">迁移后任务，如</strong>启用来自目标数据库的约束。</li><li id="f46f" class="le lf hh ig b ih ln il lo ip lp it lq ix lr jb lw lk ll lm bi translated">通过废弃Attunity日志来发布准确的错误，以便在出现错误时进行平稳的补救。(适用于windows或Linux平台)*</li></ul><p id="50b3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">(*这是一个关键特性，因为多个流程正在协调整个迁移过程，即。查询源数据库，与Attunity replicate交互，等等。如果错误没有得到很好的处理，那么可能会给迁移顾问/DBA理解故障的确切点和原因造成混乱)</p><p id="67ee" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">除了上述所有特性，这种自动化的<strong class="ig hi">模块化设计允许该框架扩展到不同类型的数据库，数据库迁移工具&amp;可以添加/删除各种前/后活动</strong>。模块化设计还确保了各个流程可以独立执行。例如，在启动迁移之前检查目标数据库行数。(这也包含在端到端流程中)</p><p id="980c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是对一些用户界面的窥探，</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lx"><img src="../Images/c0a868f331162136c8959cfb74faaccc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gukUjZdM-lCkLhzLVSz7mQ.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">DMaaS — Main UI</figcaption></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ly"><img src="../Images/bd2f9347dee461c621d36d579199ab58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oUlbhM8Qs6Ejd1EPI37mwQ.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">DMaaS — Intuitive Table Selection UI</figcaption></figure><h1 id="ff98" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">结论</h1><p id="2e98" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated"><strong class="ig hi">“DMaaS—数据库迁移即服务”</strong>是一个协调所有迁移前&amp;后活动的框架，包括数据传输本身。这个框架不受活动数量、数据库技术甚至底层使用的数据传输工具的限制。有了这个工具，应用程序团队可以在很大程度上独立运行他们的数据库迁移展示，只有在处理复杂的请求时，才需要熟练的迁移顾问/数据库管理员的参与。</p><p id="5c2b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">非常感谢您通读<strong class="ig hi">“DMaaS之旅”我希望这有所帮助。</strong></p><p id="e086" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">祝大家“数据库迁移愉快”:)！</p><p id="c811" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请随时分享您的观点或任何其他建议。</p><p id="0ecb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">演职员表:</strong> <a class="ae js" rel="noopener" href="/@rajeshpilwari">拉杰什·皮尔瓦里</a>，<a class="ae js" rel="noopener" href="/@jaydeepgodhani">杰迪普·戈德哈尼</a>，毗湿奴拉姆·莫汉，&amp; <a class="ae js" rel="noopener" href="/@rvsenthil">森蒂尔·RV</a></p></div></div>    
</body>
</html>