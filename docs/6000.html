<html>
<head>
<title>Detect Conflicts of Interest using Graphs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用图表检测利益冲突</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/303fdc8ccb5a?source=collection_archive---------0-----------------------#2022-11-16">https://medium.com/oracledevs/303fdc8ccb5a?source=collection_archive---------0-----------------------#2022-11-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/c8e4497ae26c26d2b8124226eb6db196.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*41yCiANivqb8cgkcH51MBw.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo by <a class="ae it" href="https://unsplash.com/@sasun1990?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Sasun Bughdaryan</a> on <a class="ae it" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="de01" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">利益冲突交易有多种模式。让我们考虑一个案例，一个组织的雇员批准了与他们相关的公司的交易。例如，如果一家公司的员工以更高的价格从他们家庭拥有的商店购买办公设备，这将是公司的损失。如果这种情况发生在政府或公共服务部门，则需要作为潜在腐败进行调查。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es js"><img src="../Images/c85708be1b0a959991e919c88e4b3068.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OdzZJ-lkbjGdtMkH"/></div></div></figure><p id="5b64" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这种“联系”并不总是简单的，但它们可能涉及多种关系。它们可能是有意隐藏的，也可能是偶然发生的。因此，如果系统能够检测到可能存在利益冲突的交易，就可以保护组织及其员工免受欺诈和不利影响。</p><p id="3066" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在本文中，我们将向您展示如何使用图形来检测这种“连接”。我们将展示一个使用Graph Studio for Oracle Autonomous Database(ADB)的示例，同时可以使用所有Oracle数据库尝试相同的场景。有关如何设置的更多信息，请参见:</p><ul class=""><li id="2fa6" class="jx jy hh iw b ix iy jb jc jf jz jj ka jn kb jr kc kd ke kf bi translated"><a class="ae it" rel="noopener" href="/oracledevs/setup-oracle-graph-on-cloud-adb-9f92aa5b8846">在云上设置Oracle Graph(ADB)</a></li><li id="9c54" class="jx jy hh iw b ix kg jb kh jf ki jj kj jn kk jr kc kd ke kf bi translated"><a class="ae it" rel="noopener" href="/oracledevs/setup-oracle-graph-on-cloud-dbcs-84bc198d54a0">在云上设置Oracle Graph(DBCS)</a></li></ul><p id="63ce" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">源数据集</strong></p><p id="8945" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们假设下列数据以表格的形式存在。为了方便起见，我在所有文件中添加了COI (=利益冲突)前缀。请右键单击链接以保存文件。</p><ul class=""><li id="003e" class="jx jy hh iw b ix iy jb jc jf jz jj ka jn kb jr kc kd ke kf bi translated"><a class="ae it" href="https://raw.githubusercontent.com/ryotayamanaka/oracle-graph/main/conflict-of-interest/coi_employee.csv" rel="noopener ugc nofollow" target="_blank"> COI_EMPLOYEE </a>(姓名、电话号码、地址等。)</li><li id="5e9d" class="jx jy hh iw b ix kg jb kh jf ki jj kj jn kk jr kc kd ke kf bi translated"><a class="ae it" href="https://raw.githubusercontent.com/ryotayamanaka/oracle-graph/main/conflict-of-interest/coi_supplier.csv" rel="noopener ugc nofollow" target="_blank"> COI_SUPPLIER </a>(姓名、电话号码、地址等。)</li><li id="9433" class="jx jy hh iw b ix kg jb kh jf ki jj kj jn kk jr kc kd ke kf bi translated"><a class="ae it" href="https://raw.githubusercontent.com/ryotayamanaka/oracle-graph/main/conflict-of-interest/coi_purchase.csv" rel="noopener ugc nofollow" target="_blank"> COI_PURCHASE </a>(发票号、供应商、审批人等。)</li><li id="69e8" class="jx jy hh iw b ix kg jb kh jf ki jj kj jn kk jr kc kd ke kf bi translated"><a class="ae it" href="https://raw.githubusercontent.com/ryotayamanaka/oracle-graph/main/conflict-of-interest/coi_form_master.csv" rel="noopener ugc nofollow" target="_blank"> COI_FORM_MASTER </a>(表单ID和员工ID)</li><li id="62e1" class="jx jy hh iw b ix kg jb kh jf ki jj kj jn kk jr kc kd ke kf bi translated"><a class="ae it" href="https://raw.githubusercontent.com/ryotayamanaka/oracle-graph/main/conflict-of-interest/coi_form_interest.csv" rel="noopener ugc nofollow" target="_blank"> COI_FORM_INTEREST </a>(表格ID，兴趣类型，供应商等。)</li></ul><p id="3152" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果您使用自治数据库(ADB ),您可以通过数据库操作加载上述文件。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kl"><img src="../Images/1213d18d0bee8a369abeb78fe37cf1ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*H_dIvI_xOtptvwlE"/></div></div></figure><p id="45b0" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">要复制以下演示，请参见此处的<a class="ae it" href="https://github.com/ryotayamanaka/oracle-graph/tree/main/conflict-of-interest" rel="noopener ugc nofollow" target="_blank">了解更多详情</a>。</p><p id="436b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">创建图表</strong></p><p id="3247" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Oracle Graph提供了CREATE PROPERTY GRAPH语法来从表数据集创建图形。</p><pre class="jt ju jv jw fd km kn ko bn kp kq bi"><span id="9bb0" class="kr ks hh kn b be kt ku l kv kw">CREATE PROPERTY GRAPH graph1<br/>  VERTEX TABLES (<br/>    coi_employee AS employee<br/>      KEY (employee_id)<br/>      PROPERTIES ARE ALL COLUMNS EXCEPT (postal)<br/>  , coi_form_master AS form_master<br/>      KEY (form_id)<br/>  , coi_supplier AS supplier<br/>      KEY (company_id)<br/>  , coi_purchase AS purchase<br/>      KEY (invoice_no)<br/>  )<br/>  EDGE TABLES (<br/>    coi_form_interest_with_key<br/>      KEY (id)<br/>      SOURCE KEY(form_id) REFERENCES form_master<br/>      DESTINATION KEY(company_id) REFERENCES supplier<br/>      LABEL has_interest<br/>  , coi_purchase AS approved_by<br/>      KEY (invoice_no)<br/>      SOURCE KEY (invoice_no) REFERENCES purchase<br/>      DESTINATION KEY (approver_employee_id) REFERENCES employee<br/>  , coi_purchase AS supplied_by<br/>      KEY (invoice_no)<br/>      SOURCE KEY (invoice_no) REFERENCES purchase<br/>      DESTINATION KEY (company_id) REFERENCES supplier<br/>  , coi_form_master AS declared_by<br/>      KEY (form_id)<br/>      SOURCE KEY (form_id) REFERENCES form_master<br/>      DESTINATION KEY (employee_id) REFERENCES employee<br/>  )</span></pre><p id="6e76" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在Graph Studio笔记本上运行该语句将从数据库表中提取数据，并在内存中创建一个图形。</p><pre class="jt ju jv jw fd km kn ko bn kp kq bi"><span id="aad1" class="kr ks hh kn b be kt ku l kv kw">%python-pgx<br/><br/>statement = """<br/>CREATE PROPERTY GRAPH coi_graph1<br/>  VERTEX TABLES (<br/>    ...<br/>  )<br/>  EDGE TABLES (<br/>    ...<br/>  )<br/>"""<br/>session.prepare_pgql(statement).execute()</span></pre><p id="335c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">创建了由3800个顶点和4759条边组成的图。</p><pre class="jt ju jv jw fd km kn ko bn kp kq bi"><span id="0b81" class="kr ks hh kn b be kt ku l kv kw">%python-pgx<br/><br/>graph1 = session.get_graph("COI_GRAPH1")<br/>graph1<br/><br/>PgxGraph(name: COI_GRAPH, v: 3800, e: 4759, directed: True, memory(Mb): 3)</span></pre><p id="81be" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">模式匹配</strong></p><p id="646d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">一旦有了图，就可以尝试使用PGQL查询进行模式匹配。</p><pre class="jt ju jv jw fd km kn ko bn kp kq bi"><span id="d3e6" class="kr ks hh kn b be kt ku l kv kw">SELECT *<br/>FROM MATCH (s1)&lt;-[r1:has_interest]-(d)-[r2:declared_by]-&gt;(e)&lt;-[r3:approved_by]-(p)-[r4:supplied_by]-&gt;(s2) ON coi_graph1<br/>LIMIT 1</span></pre><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kx"><img src="../Images/a41aa44c07bba0a6ce1bf158d6d41979.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*O3DdmV9WZ2wL4EqQ"/></div></div></figure><p id="9801" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果一个模式在一行中太长，你可以把它分成两行。这里，变量<strong class="iw hi"> s1 </strong>和<strong class="iw hi"> s2 </strong>可能是也可能不是同一个供应商，但是在模式中出现两次的变量<strong class="iw hi"> e </strong>表示同一个雇员。</p><pre class="jt ju jv jw fd km kn ko bn kp kq bi"><span id="f4c4" class="kr ks hh kn b be kt ku l kv kw">SELECT *<br/>FROM MATCH (<br/>  (s1)&lt;-[r1:has_interest]-(d)-[r2:declared_by]-&gt;(e),<br/>  (e)&lt;-[r3:approved_by]-(p)-[r4:supplied_by]-&gt;(s2)<br/>) ON coi_graph1<br/>LIMIT 1s</span></pre><p id="e9e6" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在Graph Studio笔记本中，我们可以接受用户输入来指定查询中的值。在这里，检索给定的雇员“Cory Sims”和周围的信息。</p><pre class="jt ju jv jw fd km kn ko bn kp kq bi"><span id="5235" class="kr ks hh kn b be kt ku l kv kw">SELECT *<br/>FROM MATCH (<br/>  (s1)&lt;-[r1:has_interest]-(d)-[r2:declared_by]-&gt;(e),<br/>  (e)&lt;-[r3:approved_by]-(p)-[r4:supplied_by]-&gt;(s2)<br/>) ON coi_graph1<br/>WHERE e.first_name = '${First name}' AND e.last_name = '${Last name}'</span></pre><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ky"><img src="../Images/7b75c4551847485b3286b4415d5585bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*n7Vk0RWJzvfYbGxH"/></div></div></figure><p id="eaa8" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这种情况下，Cory Sims已经声明个人利益反对Zachary Digital，因此系统可能需要对Zachary Digital的购买发出警报。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es js"><img src="../Images/b200c4187f343438ebfd709f1aa1e2d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*htB_vKYeqTqIHw35"/></div></div></figure><p id="58ff" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">还可以检测包含特定模式的所有病例。为了表示这个4跳循环，我们可以使用顶点<strong class="iw hi"> (s) </strong>来表示模式的开始和结束。</p><pre class="jt ju jv jw fd km kn ko bn kp kq bi"><span id="64ee" class="kr ks hh kn b be kt ku l kv kw">SELECT *<br/>FROM MATCH (<br/>  (s1)&lt;-[r1:has_interest]-(d)-[r2:declared_by]-&gt;(e),<br/>  (e)&lt;-[r3:approved_by]-(p)-[r4:supplied_by]-&gt;(s2)<br/>) ON coi_graph1<br/>LIMIT 3</span></pre><p id="2eb3" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">该查询返回3个案例。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kz"><img src="../Images/7e94138acf818e9ced68d76ab688872e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*E5j2r2SRxcI23ddi"/></div></div></figure><p id="e339" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">添加新关系</strong></p><p id="6c74" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">接下来，让我们考虑当我们发现员工或供应商之间的隐藏关系时，如何向图中添加新的边。我们通常可以根据员工和供应商的属性信息来检测关系。例如，如果员工和供应商共用同一个电话号码(或紧急联系电话号码)，我们可以假设他们之间有任何联系。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div class="er es la"><img src="../Images/6acf2b800dcec450daccdb5564c7b28b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/0*8DVYTMDWWEe8mT8V"/></div></figure><p id="e8d4" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在让我们想一个有效的方法来创建这样的关系作为新的边。因为电话号码信息是作为雇员顶点(或供应商顶点)的属性保存的，所以我们可以运行一个PGQL查询(INSERT EDGE语法)来根据属性添加这样的边。</p><p id="3155" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">同时，查找所有匹配值(在本例中是电话号码)的最有效方法是使用表扫描和连接操作。如果图的源数据存储在表中，那么关系可以定义为RDBMS中表的新视图。记住为表连接在列上创建索引。</p><pre class="jt ju jv jw fd km kn ko bn kp kq bi"><span id="57a5" class="kr ks hh kn b be kt ku l kv kw">CREATE VIEW coi_same_number_1 AS<br/>SELECT ROWNUM AS id, e1.employee_id AS e1_id, e2.employee_id AS e2_id<br/>FROM coi_employee e1, coi_employee e2<br/>WHERE e1.EMERGENCY_CONTACT_PHONE = e2.phone;</span></pre><pre class="lb km kn ko bn kp kq bi"><span id="064a" class="kr ks hh kn b be kt ku l kv kw">CREATE VIEW coi_same_number_2 AS<br/>SELECT ROWNUM AS id, e.employee_id, s.company_no<br/>FROM coi_employee e, coi_supplier s<br/>WHERE e.EMERGENCY_CONTACT_PHONE = s.phone;</span></pre><p id="c612" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">准备好视图后，修改CREATE PROPERTY GRAPH语句，这样<strong class="iw hi"> graph2 </strong>将包含新的关系。</p><pre class="jt ju jv jw fd km kn ko bn kp kq bi"><span id="b033" class="kr ks hh kn b be kt ku l kv kw">CREATE PROPERTY GRAPH graph2<br/>  VERTEX TABLES (<br/>    ...<br/>  )<br/>  EDGE TABLES (<br/>    ...<br/>  , coi_emergency_contact_1<br/>      KEY (id)<br/>      SOURCE KEY(employee_id_1) REFERENCES employee<br/>      DESTINATION KEY(employee_id_2) REFERENCES employee<br/>      LABEL emergency_contact<br/>      NO PROPERTIES<br/>  , coi_emergency_contact_2<br/>      KEY (id)<br/>      SOURCE KEY(employee_id) REFERENCES employee<br/>      DESTINATION KEY(company_id) REFERENCES supplier<br/>      LABEL emergency_contact<br/>      NO PROPERTIES<br/>  )</span></pre><p id="85b3" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，您可以看到添加了新关系<strong class="iw hi"> emergency_contact </strong>。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lc"><img src="../Images/b2f8b5981a99cb0382c5903abe2c8c16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2IVV9Qf8hyQJws8Q"/></div></div></figure><p id="81fd" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">基于地理空间距离的关系</strong></p><p id="cd1f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">使用上一节描述的方法，我们可以基于现有信息创建各种类型的边。</p><p id="b2a1" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在让我们考虑雇员和供应商地址之间的地理空间距离。如果他们的地址非常接近，他们可能是亲戚或邻里朋友等私人关系。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div class="er es ld"><img src="../Images/fdaf5ddec0a2ba27f8aa3edbcea29df3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*NB0L80lWpaT5zoX8"/></div></figure><p id="b58a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了有效地计算距离，根据员工和供应商的纬度和经度信息添加了几何列(=包含针对几何信息优化的特殊对象的表列)，并且还为这些列创建了空间索引。</p><pre class="jt ju jv jw fd km kn ko bn kp kq bi"><span id="0168" class="kr ks hh kn b be kt ku l kv kw">CREATE TABLE coi_employee_geom AS<br/>SELECT<br/>  t.*,<br/>  SDO_GEOMETRY(<br/>    2001,       -- Geometry type (two-dementional point)<br/>    4326,       -- Coordinate system ID (SRID) <br/>    SDO_POINT_TYPE(t.address_lon, t.address_lat, NULL), NULL, NULL<br/>  ) AS address_geom<br/>FROM coi_employee t;<br/><br/>INSERT INTO user_sdo_geom_metadata VALUES (<br/>  'coi_employee_geom',<br/>  'address_geom',<br/>  SDO_DIM_ARRAY(<br/>    SDO_DIM_ELEMENT('LONGITUDE', -180.0, 180.0, 0.05),<br/>    SDO_DIM_ELEMENT('LATITUDE', -90.0, 90.0, 0.05)<br/>  ),<br/>  4326<br/>);<br/>COMMIT;<br/><br/>CREATE INDEX idx_coi_employee_geom<br/>  ON coi_employee_geom (address_geom)<br/>  INDEXTYPE IS mdsys.spatial_index_v2;</span></pre><p id="4179" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">使用这些索引，我们可以定义一个视图，列出“500米内”的员工-供应商对。</p><pre class="jt ju jv jw fd km kn ko bn kp kq bi"><span id="8d00" class="kr ks hh kn b be kt ku l kv kw">CREATE VIEW coi_within_500m AS<br/>SELECT<br/>  ROWNUM AS id,<br/>  e.employee_id,<br/>  s.company_id,<br/>  SDO_GEOM.SDO_DISTANCE(e.address_geom, s.address_geom, 0.005, 'unit=M') AS dist<br/>FROM<br/>  coi_employee_geom e,<br/>  coi_supplier_geom s<br/>WHERE<br/>  SDO_GEOM.SDO_DISTANCE(e.address_geom, s.address_geom, 0.005, 'unit=M') &lt; 500;</span></pre><pre class="lb km kn ko bn kp kq bi"><span id="baaf" class="kr ks hh kn b be kt ku l kv kw">CREATE PROPERTY GRAPH graph2<br/>  VERTEX TABLES (<br/>    ...<br/>  )<br/>  EDGE TABLES (<br/>    ...<br/>  , coi_within_500m<br/>      KEY (id)<br/>      SOURCE KEY(employee_id) REFERENCES employee<br/>      DESTINATION KEY(company_id) REFERENCES supplier<br/>      LABEL within_500m<br/>  )</span></pre><p id="46f7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">可以看到_500m 内新增了一个边缘类型<strong class="iw hi">。在这种情况下，Derek两次批准从Kimberly Apparel购买商品，Kimberly Apparel的地址很近。</strong></p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es le"><img src="../Images/7cd6d440a917204ed896fc99a8285204.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GoKbQMkBKgg-Om3r"/></div></div></figure><p id="edc8" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">也可以在地图上显示它们。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es le"><img src="../Images/8f76f784c921e3976e0bf30f47370693.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*y8VOd7xGfOrGHI0s"/></div></div></figure><p id="261c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">未知长度的循环路径</strong></p><p id="98b7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">PGQL有一个路径查找语法，允许Oracle Graph通过对内存中的图形应用算法(如Dijkstra算法)来高效地查找最短路径。</p><p id="5ab7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">例如，此查询返回两个雇员之间的最短路径。</p><pre class="jt ju jv jw fd km kn ko bn kp kq bi"><span id="ca2e" class="kr ks hh kn b be kt ku l kv kw">SELECT a1, b, a2<br/>FROM MATCH TOP 1 SHORTEST (e1) (-[r]-(v))+ (e2) ONE ROW PER STEP (a1, b, a2) ON graph2<br/>WHERE e1.employee_id = '${Employee 1}' AND e2.employee_id = '${Employee 2}'<br/>  AND COUNT(v) = COUNT(DISTINCT v)</span></pre><p id="43db" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">该结果显示Kelly和Jack批准的两次采购的供应商一起列在(某人的)申报单上。路径查找是成功的，但是在这种情况下结果不是很有用。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lc"><img src="../Images/fc9ea30b7378d43bdeb01459181fafca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Dy6oWmig7_Th3DA1"/></div></div></figure><p id="a135" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这里有一些注意事项:</p><ul class=""><li id="eb57" class="jx jy hh iw b ix iy jb jc jf jz jj ka jn kb jr kc kd ke kf bi translated">图案<code class="du lf lg lh kn b">(-[r]-(v))+</code>沿两个方向追踪一条或多条边。</li><li id="0a65" class="jx jy hh iw b ix kg jb kh jf ki jj kj jn kk jr kc kd ke kf bi translated"><code class="du lf lg lh kn b">ONE ROW PER STEP (a1, b, a2)</code>将检测到的路径分解成步骤，并将它们映射到变量<code class="du lf lg lh kn b">a1, b, a2</code>。</li><li id="6db9" class="jx jy hh iw b ix kg jb kh jf ki jj kj jn kk jr kc kd ke kf bi translated">添加条件<code class="du lf lg lh kn b">COUNT(v) = COUNT(DISTINCT v)</code>是为了消除多次穿过相同顶点的路径。</li></ul><p id="8307" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这里，我们可以想到下图的案例。该模式是包含新添加的边“same_number”的5跳循环。在前面的部分中，我们搜索了具有固定跳数的循环，但是在实际情况中，循环的长度可能是未知的。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es li"><img src="../Images/575cdb5b42158379c41da514c83fa3d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*u1fbos6yu_Nlj5iq"/></div></div></figure><p id="3162" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因此，让我们使用路径查找语法来检测未知长度的循环。我们应该为起点和终点都指定目标雇员，并搜索一条只穿过相同边一次的路径。</p><pre class="jt ju jv jw fd km kn ko bn kp kq bi"><span id="6448" class="kr ks hh kn b be kt ku l kv kw">SELECT a1, b, a2<br/>FROM MATCH TOP 50 SHORTEST (e1) (-[r]-(v))+ (e2) ONE ROW PER STEP (a1, b, a2) ON graph2<br/>WHERE e1.first_name = '${First name}' AND e1.last_name = '${Last name}'<br/>  AND e1 = e2<br/>  AND COUNT(v) = COUNT(DISTINCT v)<br/>  AND COUNT(r) = COUNT(DISTINCT r)</span></pre><p id="704d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如预期的那样，该查询返回5跳循环。同时还发现了另一个包含“在_ 500米以内”边的圈。通过使用路径查找技术，我们甚至可以检测未知长度的循环。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lj"><img src="../Images/c625d409eeca0e8504292fe43087c757.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ht4g5E2vLw7V-nZF"/></div></div></figure><p id="4b54" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">总结</strong></p><p id="8717" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们发现，图表可用于表示利益冲突分析的实体和活动，并检测暗示可疑交易的周期。此外，通过在数据库中定义新的关系，我们不仅可以考虑匹配值(比如电话号码)，还可以考虑地理空间距离。许多SQL函数提供了更多的技术，例如，模糊字符串匹配可以处理符号失真。最后，我们看到路径查找是一种强大的功能，可以检测长度未知的路径。</p><p id="290d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这种情况可以在任何Oracle数据库中重现(Oracle Graph包含在Oracle数据库12.2和更高版本中)。此外，自治数据库用户不需要任何设置，因为它包括开箱即用的Graph Studio笔记本。样本数据和笔记本可在<a class="ae it" href="https://github.com/ryotayamanaka/oracle-graph/tree/main/conflict-of-interest" rel="noopener ugc nofollow" target="_blank">这里</a>获得。请用甲骨文云<a class="ae it" href="https://www.oracle.com/cloud/free/" rel="noopener ugc nofollow" target="_blank">永远免费服务</a>免费试用自治数据库。</p></div><div class="ab cl lk ll go lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ha hb hc hd he"><p id="5cfd" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">请从以下网址了解更多关于<strong class="iw hi">甲骨文图</strong>的信息:</p><ul class=""><li id="ef80" class="jx jy hh iw b ix iy jb jc jf jz jj ka jn kb jr kc kd ke kf bi translated"><a class="ae it" rel="noopener" href="/tag/oracle-graph">中</a> (=所有带有Oracle Graph标签的文章)</li><li id="ece2" class="jx jy hh iw b ix kg jb kh jf ki jj kj jn kk jr kc kd ke kf bi translated"><a class="ae it" href="https://stackoverflow.com/questions/tagged/oracle-graph" rel="noopener ugc nofollow" target="_blank">堆栈溢出</a> (=带有oracle-graph标记的问题)</li><li id="d886" class="jx jy hh iw b ix kg jb kh jf ki jj kj jn kk jr kc kd ke kf bi translated"><a class="ae it" href="https://join.slack.com/t/andouc/shared_invite/zt-1a2hmiz6f-vLlblcQyv0t9FMraMMP5uQ" rel="noopener ugc nofollow" target="_blank"> Slack AnDOUC </a> (=邀请链接，请访问#graph)</li><li id="fd37" class="jx jy hh iw b ix kg jb kh jf ki jj kj jn kk jr kc kd ke kf bi translated"><a class="ae it" href="https://join.slack.com/t/oracledevrel/shared_invite/zt-uffjmwh3-ksmv2ii9YxSkc6IpbokL1g" rel="noopener ugc nofollow" target="_blank"> Slack OracleDevRel </a> (=邀请链接，请访问#oracle-db-graph)</li></ul><p id="f3ea" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">想谈谈吗？<a class="ae it" href="https://bit.ly/odevrel_slack" rel="noopener ugc nofollow" target="_blank">加入我们的public Slack </a>与真正的Oracle开发人员交流！</p></div></div>    
</body>
</html>