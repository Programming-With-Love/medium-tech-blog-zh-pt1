<html>
<head>
<title>COVID 19 Interactive Maps Visualization Menggunakan Python Bokeh</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">COVID 19 Interactive Maps Visualization Menggunakan Python Bokeh</h1>
<blockquote>原文：<a href="https://medium.easyread.co/covid-19-interactive-maps-visualization-menggunakan-python-bokeh-97e80b5701dc?source=collection_archive---------4-----------------------#2021-09-10">https://medium.easyread.co/covid-19-interactive-maps-visualization-menggunakan-python-bokeh-97e80b5701dc?source=collection_archive---------4-----------------------#2021-09-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/b882557b6068c1af452f1894260ed3ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*rz318t4j2oV6Ul4mBaSS2g.gif"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">source : author</figcaption></figure><p id="9a13" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">Hello Guys, disini gue mau sharing project yang baru gue buat tentang pembuatan maps visualization untuk kasus Covid19 menggunakan library bokeh. Disini gue ga jelasin tentang code nya doang, tapi juga tips — tips berdasarkan problem yang gue alamin selama buat nih project.</p><p id="b823" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">Sebelumnya gue akan jelasin apa itu bokeh. Jadi bokeh merupakan library python yang digunakan untuk membuat interactive data visualization seperti update plot berdasarkan value dari slider atau dropdown maupun dari multiple slider dan dropdown. Intinya untuk membuat dashboard seperti tableau atau power BI gitu. Keren ga? keren ga? keren dong masa nggak. Tapi, di project kali ini gue cuma buat satu slider yang bisa update maps dan data tabel berdasarkan data harian kasus. Oke, selanjutnya akan memuat langkah — langkah pembuatan project dan yang terpenting adalah mempersiapkan niat dan mental agar tidak goyah ketika menemukan error.</p><h1 id="3a29" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak"> <em class="lv"> Install library geopandas dan bokeh </em> </strong></h1><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="64f2" class="mf ky in mb b gy mg mh l mi mj">#install library bokeh<br/>pip install bokeh</span><span id="186c" class="mf ky in mb b gy mk mh l mi mj">#install library geopandas menggunakan conda<br/>conda install geopandas</span></pre><p id="c717" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">Untuk menginstall library geopandas cukup rumit dan sulit karena gue sering mengalami kegagalan ketika menggunakan cara diatas. Gue ga pakai pip untuk install geopandas karena lebih rumit, perlu install beberapa library pendukungnya. Nah, kalau lu udah nyoba berbagai cara tapi belum berhasil juga, lu bisa install gepandas di env baru dan pakai env tersebut tiap kali mau menggunakan geopandas. caranya bisa lihat di <a class="ae ml" href="https://medium.com/analytics-vidhya/fastest-way-to-install-geopandas-in-jupyter-notebook-on-windows-8f734e11fa2b" rel="noopener"> tautan </a> berikut.</p><h1 id="a39f" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak"> <em class="lv"> Mempersiapkan data </em> </strong></h1><p id="baa3" class="pw-post-body-paragraph jz ka in kb b kc mm ke kf kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw ig bi translated">Data Covid19 gue dapet dari <a class="ae ml" href="https://www.kaggle.com/gauravduttakiit/covid-19" rel="noopener ugc nofollow" target="_blank"> kaggle </a> yang isinya data kasus harian dunia dari 22 Januari 2020 sampai 30 Agustus 2021.</p><figure class="lw lx ly lz gt jo gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/72766dd9096a1d99ab1756f73d0d3c83.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*DuxreYCSmkvIUWjE-N4fNg.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Dataframe covid19</figcaption></figure><p id="f76a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">Dataframe diatas akan gue tambahin dua kolom baru yaitu kolom category dan kolom day. Kolom category berfungsi sebagai color mapper pada maps berdasarkan jumlah kasus yang terkonfirmasi, sementara kolom day berfungsi sebagai value slider. Nilai pada kolom day diperoleh dari kolom Date seperti 2020–01–22 merupakan day 1, 2020–01–23 merupakan day 2 dan seterusnya (iterate unique value dari Date).</p><figure class="lw lx ly lz gt jo gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/21ef61a7195116e848c6bd1ce834ac6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/1*n3NI7k43TUnHbtZm94o-GA.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Dataframe covid19 manipulation</figcaption></figure><p id="e71d" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">Untuk membuat sebuah maps, maka diperlukan koordinat geometri negara negara didunia yang membentuk kewilayahannya, biasanya berbentuk polygon dan multipolygon.</p><figure class="lw lx ly lz gt jo gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/ec0b0bd0f755bb3a04fe25250f254498.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*DceuGuSJ-sMZ0HoZpAh2_w.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Geodataframe sf</figcaption></figure><p id="3bd2" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">Geodataframe diatas akan gue tambah kolom <strong class="kb io"> x </strong> dan <strong class="kb io"> y </strong> yang merupakan titik koordinat tengah yang akan digunakan sebagai peletakan label nama — nama tiap negara. Untuk mendapatkan koordinat titik tengah, gunakan fungsi centroid milik geopandas dan simpan kedalam kolom baru. Oleh karena nilai hasil tersebut berbentuk POINT(x,y), maka pisahkan titik x dan y dari point tersebut, kemudian hapus kolom point, kemudian simpan titik x dan titik y ke kolom baru dengan nama x dan y.</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="974c" class="mf ky in mb b gy mg mh l mi mj">#mengambil koordinat titik tengah<br/>sf['point']=sf['geometry'].centroid</span><span id="88da" class="mf ky in mb b gy mk mh l mi mj">#memisahkan point dan menyimpan titik x dan y<br/>sf['x']=sf['point'].x<br/>sf['y']=sf['point'].y</span><span id="ceaf" class="mf ky in mb b gy mk mh l mi mj">#menghapus kolom point<br/>sf.drop(columns='point', inplace=True)</span></pre><figure class="lw lx ly lz gt jo gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/41368f76520871d63910219b6d65a5d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*Da3EyEeZ67GIg5kUNgz3xA.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Geodataframe sf manipulation</figcaption></figure><p id="04f5" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">Geodataframe diatas kemudian diset menjadi CRS epsg:4326 yang berfungsi untuk memberi tahu Python bagaimana koordinat tersebut berhubungan dengan tempat-tempat di Bumi.</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="2b6f" class="mf ky in mb b gy mg mh l mi mj">#setting crs<br/>sf.crs = {'init': 'epsg:4326'}</span></pre><h1 id="2f9e" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated"><strong class="ak"> <em class="lv"> Membuat fungsi </em> </strong></h1><p id="9a80" class="pw-post-body-paragraph jz ka in kb b kc mm ke kf kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw ig bi translated"><strong class="kb io"> <em class="mv"> Pertama </em> </strong> , fungsi yang digunakan untuk mengubah dataframe dan geodataframe menjadi GeoJSON agar bokeh dapat merepresentasikan feature geografinya. Fungsi ini dipanggil per kasus harian, karena jika data nya terlalu banyak untuk diconvert dapat menyebabkan error ( <em class="mv"> Maximum Recursion Limit </em> ). Nah, fungsi ini diperlukan sebagai source untuk membuat maps beserta atribut atributnya.</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="d787" class="mf ky in mb b gy mg mh l mi mj">def json_data(selectedDay):<br/>    <br/>    sd = selectedDay<br/>    # Pull selected year<br/>    df_dt = covid19[covid19['day'] == sd]<br/>    <br/>    # Merge the GeoDataframe object (sf) with the covid19 data<br/>    merge = sf.merge(df_dt,how='left', left_on=['ADMIN'], right_on=['Country'])</span><span id="b6cb" class="mf ky in mb b gy mk mh l mi mj">    #remove columns<br/>    merge.dropna(inplace=True)<br/>    merge.drop(columns=['ADMIN'], inplace=True)<br/>    <br/>    <br/>    # Bokeh uses geojson formatting, representing geographical   features, with json<br/>    # Convert to json<br/>    merge_json = json.loads(merge.to_json())<br/>    <br/>    # Convert to json preferred string-like object <br/>    json_data = json.dumps(merge_json)<br/>    return json_data</span></pre><p id="5a87" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><em class="mv"> Kedua </em> , fungsi yang digunakan untuk mengubah dataframe menjadi ColumnDataSource sebagai source membuat tabel kasus yang terkonfirmasi untuk 20 negara tertinggi.</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="1bff" class="mf ky in mb b gy mg mh l mi mj">def columndata(selectedDay):<br/>    cd = selectedDay<br/>    # Pull selected day<br/>    column = covid19[covid19['day'] == cd]<br/>    column=column.sort_values(by='Confirmed', ascending=False)<br/>    rank=[]<br/>    for i in range(column.index.shape[0]):<br/>        rank.append(i+1)<br/>    column['rank']=rank<br/>    most_country=column.head(20)<br/>    source = dict(<br/>        rank=[rank for rank in most_country['rank']],<br/>        country=[country for country in most_country['Country']],<br/>        confirmed=[confirmed for confirmed in most_country['Confirmed']]<br/>    )<br/>    return source</span></pre><p id="5b44" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io"> <em class="mv"> Ketiga </em> </strong> , fungsi yang digunakan untuk update maps dan tabel berdasarkan value slider yang diinput. Jadi fungsi ini akan memanggil 2 fungsi sebelumnya karena maps dan tabel memiliki source yang berbeda.</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="b0d0" class="mf ky in mb b gy mg mh l mi mj">def update_plot(attr, old, new):<br/>    day = slider.value<br/>    new_data = json_data(day)<br/>    geosource.geojson = new_data<br/>    source.data = columndata(day)</span></pre><p id="4fe9" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated"><strong class="kb io"> <em class="mv"> Keempat </em> </strong> , fungsi yang digunakan untuk membuat animasi yang bisa membuat slidernya jalan sediri dari awal sampai akhir.</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="59dc" class="mf ky in mb b gy mg mh l mi mj">def animate_update():<br/>    val = slider.value + 1<br/>    if val &gt; 588:<br/>        val = 0<br/>    slider.value = val<br/>    <br/>def animate():<br/>    global callback_id<br/>    if button.label == '► Play':<br/>        button.label = '❚❚ Pause'<br/>        callback_id = curdoc().add_periodic_callback(animate_update, 200)<br/>    else:<br/>        button.label = '► Play'<br/>        curdoc().remove_periodic_callback(callback_id)</span></pre><h1 id="3628" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">Membuat list kategori color mapper</h1><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="b5fe" class="mf ky in mb b gy mg mh l mi mj">list_category=['0', '1 - 19', '20 - 99', '100 - 999', '1000 - 2999','3000 - 9999','10000 - 29999','30000 - 99999', '100000 - 299999','300000 - 999999','1000000 - 2999999', '3000000 - 9999999', '10000000 - 29999999','30000000 - 99999999','&gt; 100M']</span></pre><p id="a028" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">List category diatas diperlukan untuk membuat kategori mapper sehingga warna mapsnya akan berubah sesuai jumlah kasus yang terkonfirmasi. Sebenernya ga perlu tulis ulang listnya bisa, pakai fungsi unique lalu simpan ke dalam list. Tapii, nanti ga bisa urut sesuai keinginan. Kalau mau pakai cara diatas, pastikan isi list dengan isi kolom categorynya persis sama tulisannya.</p><h1 id="8c6e" class="kx ky in bd kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu bi translated">Membuat maps dan tabel</h1><p id="2b9d" class="pw-post-body-paragraph jz ka in kb b kc mm ke kf kg mn ki kj kk mo km kn ko mp kq kr ks mq ku kv kw ig bi translated">Setelah semua dipersiapkan, langkah terakhir adalah membuat plotnya yaitu maps dan tabelnya yang bisa diupdate berdasarkan slider dan dianimasikan dari awal hingga akhir. Disini kita tinggal manggil fungsi yang telah dibuat dan mendekorasi tampilannya dengan memberi warna, judul, annotation dan sebagainya yang memuat informasi yang diperlukan.</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="c003" class="mf ky in mb b gy mg mh l mi mj">#source informasi untuk maps<br/>geosource = GeoJSONDataSource(geojson = json_data(1))</span><span id="3a9e" class="mf ky in mb b gy mk mh l mi mj">#source informasi untuk tabel<br/>source = ColumnDataSource(columndata(1))</span><span id="f6e5" class="mf ky in mb b gy mk mh l mi mj">#membuat list yang berisi warna <br/>palet=['#242424', '#5e5b5b', '#d9d9d9', '#6c3778', '#9e5aad', '#cf87e0', '#f3c2ff', <br/>       '#67000d', '#cb181d', '#ef3b2c', '#fc9272', '#fcbba1', '#f7dada', '#fcf2f2', '#ffffff'] <br/>palet = palet[::-1]</span><span id="d8e8" class="mf ky in mb b gy mk mh l mi mj">#menggunakan kategorikal color mapper<br/>color_mapper = CategoricalColorMapper(factors=list_category,  palette=palet)</span><span id="891c" class="mf ky in mb b gy mk mh l mi mj">#menampilkan legend categorical mapper<br/>color_bar = ColorBar(color_mapper=color_mapper, title='Confirmed Case',<br/>                            #title=color.value.title(),<br/>                            title_text_font_style='bold',<br/>                            title_text_font_size='20px',<br/>                            title_text_align='center',<br/>                            orientation='vertical',<br/>                            major_label_text_font_size='16px',<br/>                            major_label_text_font_style='bold',<br/>                            label_standoff=8,<br/>                            major_tick_line_color='black',<br/>                            major_tick_line_width=3,<br/>                            major_tick_in=12,<br/>                            location=(0,0))</span><span id="12cc" class="mf ky in mb b gy mk mh l mi mj"><br/># Create figure object.<br/>r = figure(title ='',<br/>           plot_height = 600 , plot_width = 1000,<br/>           toolbar_location = 'below',<br/>           tools = ['pan, wheel_zoom, box_zoom, reset'])</span><span id="31f7" class="mf ky in mb b gy mk mh l mi mj">r.title.align = 'center'<br/>r.xaxis.visible = False<br/>r.yaxis.visible = False<br/>r.xgrid.grid_line_color = None<br/>r.ygrid.grid_line_color = None</span><span id="210e" class="mf ky in mb b gy mk mh l mi mj"># Add patch renderer to figure.<br/>states=r.patches('xs','ys', source = geosource,<br/>                 fill_color = {'field' :'category', 'transform' : color_mapper},<br/>                 line_color ='gray', <br/>                 line_width = 0.25,<br/>                 fill_alpha = 1)</span><span id="7046" class="mf ky in mb b gy mk mh l mi mj">#menambahkan label nama negara ditiap geografinya<br/>labels = LabelSet(x='x', y='y',text='ISO_A3',text_font_size='3pt',text_font_style='bold', text_align='center',<br/>              x_offset=0, y_offset=0, source=geosource, render_mode='canvas')</span><span id="cc99" class="mf ky in mb b gy mk mh l mi mj">#membuat hover<br/>r.add_tools(HoverTool(renderers = [states],<br/>                      tooltips = [ ('Country','<a class="ae ml" href="http://twitter.com/Country" rel="noopener ugc nofollow" target="_blank">@Country</a>'),<br/>                                  ('Confirmed', '<a class="ae ml" href="http://twitter.com/Confirmed" rel="noopener ugc nofollow" target="_blank">@Confirmed</a>{,}'),<br/>                               ('Recovered', '<a class="ae ml" href="http://twitter.com/Recovered" rel="noopener ugc nofollow" target="_blank">@Recovered</a>{,}'),<br/>                               ('Deaths', '<a class="ae ml" href="http://twitter.com/Deaths" rel="noopener ugc nofollow" target="_blank">@Deaths</a>{,}')]))</span><span id="36c9" class="mf ky in mb b gy mk mh l mi mj"># Make a slider object: slider <br/>slider = Slider(title = 'Days',start = 1, end = 588, step = 1, value = 1)<br/>slider.on_change('value', update_plot)</span><span id="cffb" class="mf ky in mb b gy mk mh l mi mj">#membuat tombol animasi<br/>callback_id = None<br/>button = Button(label='► Play', width=60)<br/>button.on_click(animate)</span><span id="21b3" class="mf ky in mb b gy mk mh l mi mj">#membuat tabel<br/>columns = [<br/>        TableColumn(field='rank', title='Rank'),<br/>        TableColumn(field='country', title='Country'),<br/>        TableColumn(field='confirmed', title='Confirmed'),<br/>    ]<br/>tabel = DataTable(source=source, columns=columns,  width=300, height=600, index_position=None)</span><span id="0ec7" class="mf ky in mb b gy mk mh l mi mj">judul = Label(x=400, y=500, x_units='screen', y_units='screen',<br/>                 text='World Covid19 History', render_mode='css', <br/>                 text_font_size='15pt',text_color = "black", text_font_style="bold",text_font = "times")</span><span id="d02e" class="mf ky in mb b gy mk mh l mi mj"># Make a column layout of widgetbox(slider) and plot, and add it to the current document<br/>r.add_layout(color_bar)<br/>r.add_layout(labels)<br/>r.add_layout(judul)</span><span id="0869" class="mf ky in mb b gy mk mh l mi mj">layout = layout([<br/>    [r],<br/>    [slider, button],<br/>])<br/>curdoc().add_root(row(layout, tabel))</span><span id="d324" class="mf ky in mb b gy mk mh l mi mj">#Display plot inline in Jupyter notebook<br/>output_notebook()</span><span id="fc62" class="mf ky in mb b gy mk mh l mi mj">output_file("js_on_change.html")<br/>show(layout)</span></pre><p id="48c5" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">Untuk menampilkannya, maka gunakan server bokeh karena plot tersebut menggunakan widget sehingga tidak bisa ditampilkan secara inline di jupyter notebook. Untuk menampilkannya ke server bokeh, berikut langkah — langkahnya :</p><ol class=""><li id="89ab" class="mw mx in kb b kc kd kg kh kk my ko mz ks na kw nb nc nd ne bi translated">Simpan file ke folder yang diinginkan</li><li id="05e9" class="mw mx in kb b kc nf kg ng kk nh ko ni ks nj kw nb nc nd ne bi translated">Buka terminal, lalu arahkan ke folder yang berisi kodingan bokeh yang telah dibuat. Jika kamu menginstal geopandas menggunakan env baru, maka gunakan terminal pada env tersebut karena geopandas terinstal pada env tersebut. Jika kamu menggunakan CMD bawaan dan belum menginstall geopandas maka akan menimbulkan error dan plot tidak akan terdisplay</li></ol><figure class="lw lx ly lz gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nk"><img src="../Images/6a63639df5bb92f100e647bae246ea47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DoCmxU4BHyoGW1BynKu6uA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">source : author</figcaption></figure><p id="27b7" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">3. Lalu tulis script berikut dan tunggu hingga bokeh menampilkan plot pada browser kalian.</p><pre class="lw lx ly lz gt ma mb mc md aw me bi"><span id="35ba" class="mf ky in mb b gy mg mh l mi mj">bokeh serve --show namafile.ipynb</span></pre><p id="864b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">Note : Ketika kalian ingin menggunakan server bokeh, jangan menginstall library di jupyter notebook seperti <strong class="kb io"> !pip install pandas </strong> dan jika mengharuskan menginstall library tersebut maka <strong class="kb io"> comment </strong> agar plot dapat terdisplay di browser.</p><figure class="lw lx ly lz gt jo"><div class="bz fp l di"><div class="nl nm l"/></div></figure></div></div>    
</body>
</html>