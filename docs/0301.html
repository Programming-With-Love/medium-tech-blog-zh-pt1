<html>
<head>
<title>What’s new in Leanback: Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Leanback的新特性:第1部分</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/whats-new-in-leanback-part-1-a895683c1567?source=collection_archive---------5-----------------------#2017-08-22">https://medium.com/androiddevelopers/whats-new-in-leanback-part-1-a895683c1567?source=collection_archive---------5-----------------------#2017-08-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="ea34" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">Android TV player adapter简介</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/eec3666b87a21c58c3cd917853f0e0d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KZI9s9uWmLce4WXzV3ULtg.png"/></div></div></figure><p id="4c81" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">安卓电视新手？好奇26.0.0支持库的新变化？在这一系列文章中，我们将研究几个组件。在这第一篇文章中，我们从探索新组件如何帮助管理搜索栏/时间线开始。</p></div><div class="ab cl ke kf go kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="ha hb hc hd he"><p id="3b13" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">从版本<a class="ae kl" href="https://developer.android.com/topic/libraries/support-library/revisions.html#26-0-0-beta1" rel="noopener ugc nofollow" target="_blank"> 26.0.0-beta1 </a>开始，向后倾斜库有了一个名为<a class="ae kl" href="https://developer.android.com/reference/android/support/v17/leanback/media/PlaybackTransportControlGlue.html" rel="noopener ugc nofollow" target="_blank">PlaybackTransportControlGlue</a>的新组件。这是一个助手类，它管理主要和次要的操作，例如，倒回和跳到下一个，并为寻道控制提供挂钩。</p><p id="4f99" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">请注意，没有seek支持的旧播放方式可以通过使用<a class="ae kl" href="https://developer.android.com/reference/android/support/v17/leanback/media/PlaybackBannerControlGlue.html" rel="noopener ugc nofollow" target="_blank">playback banner control glue</a>获得。UI看起来与使用<a class="ae kl" href="https://developer.android.com/reference/android/support/v17/leanback/media/PlaybackControlGlue.html" rel="noopener ugc nofollow" target="_blank"> PlaybackControlGlue </a>时相同，但是，PlaybackBannerControlGlue在内部使用了一个<a class="ae kl" href="https://developer.android.com/reference/android/support/v17/leanback/media/PlayerAdapter.html" rel="noopener ugc nofollow" target="_blank"> PlayerAdapter </a>。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es km"><img src="../Images/58f5725201d9c1978799ab73802ee1ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EdN-twJCF4O-kSqF."/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx"><em class="kr">Components managed by PlaybackTrasportControlGlue</em></figcaption></figure><p id="275a" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">PlaybackTrasportControlGlue，或者您创建的子类，需要一个<a class="ae kl" href="https://developer.android.com/reference/android/support/v17/leanback/media/PlayerAdapter.html" rel="noopener ugc nofollow" target="_blank"> PlayerAdapter </a>的实例。后倾库提供了<a class="ae kl" href="https://developer.android.com/reference/android/support/v17/leanback/media/MediaPlayerAdapter.html" rel="noopener ugc nofollow" target="_blank">media player适配器</a>，以便与<a class="ae kl" href="https://developer.android.com/reference/android/media/MediaPlayer.html" rel="noopener ugc nofollow" target="_blank"> MediaPlayer </a>一起使用。</p><p id="58d3" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">如果你更愿意使用<a class="ae kl" href="https://google.github.io/ExoPlayer/guide.html" rel="noopener ugc nofollow" target="_blank"> ExoPlayer </a>你可以扩展PlayerAdapter并提供你自己的播放器实现。</p><p id="7176" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">为了正确地激活搜索栏，您必须覆盖PlayerAdapter中的一些方法。</p><h1 id="396f" class="ks kt hh bd ku kv kw kx ky kz la lb lc in ld io le iq lf ir lg it lh iu li lj bi translated">重要的事情先来</h1><p id="07a6" class="pw-post-body-paragraph ji jj hh jk b jl lk ii jn jo ll il jq jr lm jt ju jv ln jx jy jz lo kb kc kd ha bi translated">当您创建PlayerAdapter的一个新子类时，Android Studio会帮助您实现两个抽象方法，如下所示。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lp"><img src="../Images/b66aeac55079d3778a27f01806fd020d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mizDHKrxyA3EN8Bv."/></div></div></figure><p id="eb61" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">让Android Studio为我编码，我得到了以下结果:</p><pre class="ix iy iz ja fd lq lr ls lt aw lu bi"><span id="4d78" class="lv kt hh lr b fi lw lx l ly lz"><strong class="lr hi">public</strong> class ExoPlayer2PlayerAdapter extends PlayerAdapter {<br/>    @Override<br/>    <strong class="lr hi">public</strong> void play() {<br/>        <br/>    }<br/><br/>    @Override<br/>    <strong class="lr hi">public</strong> void pause() {<br/><br/>    }<br/>}</span></pre><p id="dce7" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">此时，实现PlayerAdapter似乎很容易，但还有更多的事情要做。</p><h1 id="88e9" class="ks kt hh bd ku kv kw kx ky kz la lb lc in ld io le iq lf ir lg it lh iu li lj bi translated">寻求帮助</h1><p id="a378" class="pw-post-body-paragraph ji jj hh jk b jl lk ii jn jo ll il jq jr lm jt ju jv ln jx jy jz lo kb kc kd ha bi translated">为了控制seekbar，应该覆盖以下抽象方法(即使它们是可选的)。</p><ul class=""><li id="73ef" class="ma mb hh jk b jl jm jo jp jr mc jv md jz me kd mf mg mh mi bi translated">getCurrentPosition()</li><li id="0671" class="ma mb hh jk b jl mj jo mk jr ml jv mm jz mn kd mf mg mh mi bi translated">getDuration()</li><li id="89e0" class="ma mb hh jk b jl mj jo mk jr ml jv mm jz mn kd mf mg mh mi bi translated">getBufferedPosition()</li></ul><p id="ac29" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">当您实现这些方法时，PlaybackTrasportControlGlue可以自动更新seekbar。</p><p id="93fe" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">下面的快照显示了seekbar如何使用这些回调:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mo"><img src="../Images/7284cb94b2418b7c5aa4651fb9f08c6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Ls_7ntcXuYgp1IP85HjSw.png"/></div></div></figure><h1 id="c828" class="ks kt hh bd ku kv kw kx ky kz la lb lc in ld io le iq lf ir lg it lh iu li lj bi translated">当前位置</h1><p id="479d" class="pw-post-body-paragraph ji jj hh jk b jl lk ii jn jo ll il jq jr lm jt ju jv ln jx jy jz lo kb kc kd ha bi translated">要更新当前位置，需要覆盖<em class="mp"> getCurrentPositon() </em>。实现很简单，只需委托给你的播放器并返回它的当前位置:</p><pre class="ix iy iz ja fd lq lr ls lt aw lu bi"><span id="a3cd" class="lv kt hh lr b fi lw lx l ly lz">@Override<br/><strong class="lr hi">public long </strong>getCurrentPosition() {<br/>    <strong class="lr hi">return </strong>isInitialized()<strong class="lr hi"> </strong>? <strong class="lr hi">mPlayer</strong>.getCurrentPosition() : -1L;<br/>}</span></pre><h1 id="630c" class="ks kt hh bd ku kv kw kx ky kz la lb lc in ld io le iq lf ir lg it lh iu li lj bi translated">持续时间</h1><p id="13b8" class="pw-post-body-paragraph ji jj hh jk b jl lk ii jn jo ll il jq jr lm jt ju jv ln jx jy jz lo kb kc kd ha bi translated">getDuraion()的实现类似:</p><pre class="ix iy iz ja fd lq lr ls lt aw lu bi"><span id="d476" class="lv kt hh lr b fi lw lx l ly lz">@Override<br/><strong class="lr hi">public long </strong>getDuration() {<br/>    <strong class="lr hi">return </strong>isInitialized()<strong class="lr hi"> </strong>? <strong class="lr hi">mPlayer</strong>.getDuration() : -1L;<br/>}</span></pre><p id="f5ab" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">当你定义<em class="mp"> getCurrentPosition() </em>和<em class="mp"> getDuration() </em>时，PlaybackTransportControlGlue可以更新seekbar。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mq"><img src="../Images/e5db00553a2051f5721d9e6ef3cff202.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MZLCTY_lL11LG0OW."/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx"><em class="kr">With the current position and duration available, the seekbar can update.</em></figcaption></figure><h1 id="821a" class="ks kt hh bd ku kv kw kx ky kz la lb lc in ld io le iq lf ir lg it lh iu li lj bi translated">缓冲位置</h1><p id="6f98" class="pw-post-body-paragraph ji jj hh jk b jl lk ii jn jo ll il jq jr lm jt ju jv ln jx jy jz lo kb kc kd ha bi translated">PlaybackTranslportControlGlue在视频缓冲时更新视频的进度。你需要做的就是从播放器返回缓冲的位置:</p><pre class="ix iy iz ja fd lq lr ls lt aw lu bi"><span id="0db4" class="lv kt hh lr b fi lw lx l ly lz">@Override<br/><strong class="lr hi">public long </strong>getBufferedPosition() {<br/>    <strong class="lr hi">return mPlayer</strong>.getBufferedPosition();<br/>}</span></pre><p id="93d3" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">当播放器缓冲时，您可以使用播放器适配器的回调用缓冲位置更新UI:</p><pre class="ix iy iz ja fd lq lr ls lt aw lu bi"><span id="f3a7" class="lv kt hh lr b fi lw lx l ly lz">getCallback().onBufferedPositionChanged(<strong class="lr hi">this</strong>);</span></pre><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es mr"><img src="../Images/555a97686bd574cb3b2addea910e275f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/0*I2Ym7OaHlDIs2dnA."/></div><figcaption class="kn ko et er es kp kq bd b be z dx"><em class="kr">The UI when only implementing </em>getBufferedPostion()</figcaption></figure><h1 id="7080" class="ks kt hh bd ku kv kw kx ky kz la lb lc in ld io le iq lf ir lg it lh iu li lj bi translated">继续学习</h1><p id="fe19" class="pw-post-body-paragraph ji jj hh jk b jl lk ii jn jo ll il jq jr lm jt ju jv ln jx jy jz lo kb kc kd ha bi translated">我推荐阅读MediaPlayerAdapter的源代码。这是一个很好的例子。还可以读取实现PlayerAdapter的<a class="ae kl" href="https://github.com/googlesamples/leanback-showcase/blob/master/app/src/main/java/android/support/v17/leanback/supportleanbackshowcase/app/media/ExoPlayerAdapter.java" rel="noopener ugc nofollow" target="_blank"> ExoPlayerAdapter </a>。</p><p id="d3b7" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在本系列的下一部分，我们将看看如何<a class="ae kl" rel="noopener" href="/@benbaxter/whats-new-in-leanback-part-2-bcb0dece359b">添加缩略图到搜索栏</a>。</p><div class="ms mt ez fb mu mv"><a rel="noopener follow" target="_blank" href="/@benbaxter/whats-new-in-leanback-part-2-bcb0dece359b"><div class="mw ab dw"><div class="mx ab my cl cj mz"><h2 class="bd hi fi z dy na ea eb nb ed ef hg bi translated">Leanback的新特性:第2部分</h2><div class="nc l"><h3 class="bd b fi z dy na ea eb nb ed ef dx translated">自定义搜索栏缩略图</h3></div><div class="nd l"><p class="bd b fp z dy na ea eb nb ed ef dx translated">medium.com</p></div></div><div class="ne l"><div class="nf l ng nh ni ne nj jg mv"/></div></div></a></div><p id="a3b2" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">如果你想加入讨论，请在<a class="ae kl" href="https://twitter.com/benjamintravels" rel="noopener ugc nofollow" target="_blank"> twitter </a>上留下回复或与我交谈。</p></div></div>    
</body>
</html>