<html>
<head>
<title>Kubernetes — Deep dive</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes —深潜</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/kubernetes-deep-dive-aeebfa1516c3?source=collection_archive---------2-----------------------#2019-10-16">https://medium.com/walmartglobaltech/kubernetes-deep-dive-aeebfa1516c3?source=collection_archive---------2-----------------------#2019-10-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/c8b9724a9da6105d088f8017021761ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*842-xJFYbbaeRpbXGeQ1iQ.jpeg"/></div></div></figure><h2 id="2a50" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated"><strong class="ak">Kubernetes简介</strong></h2><p id="9eb6" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh ha bi translated">Kubernetes (K8s)是一个用于自动化部署、扩展和管理容器化应用程序的开源系统。这是在https://www.cncf.io/的<a class="ae ki" href="https://www.cncf.io/" rel="noopener ugc nofollow" target="_blank">毕业的第一个项目。它最初是由谷歌开发的。</a></p><h2 id="0f63" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated"><strong class="ak">集装箱化简史</strong></h2><figure class="kk kl km kn fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kj"><img src="../Images/0f381630b624432434037925df5cb606.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nPXs5H2AOK6S5b8IaEVxYQ.png"/></div></div></figure><blockquote class="ko kp kq"><p id="d7b7" class="jn jo kr jp b jq ks js jt ju kt jw jx ku kv jz ka kw kx kc kd ky kz kf kg kh ha bi translated">传统部署</p></blockquote><p id="a002" class="pw-post-body-paragraph jn jo hh jp b jq ks js jt ju kt jw jx ja kv jz ka je kx kc kd ji kz kf kg kh ha bi translated">早期，组织在物理服务器上运行应用程序。没有办法为物理服务器中的应用程序定义资源边界，这导致了资源分配问题</p><blockquote class="ko kp kq"><p id="1eb7" class="jn jo kr jp b jq ks js jt ju kt jw jx ku kv jz ka kw kx kc kd ky kz kf kg kh ha bi translated">虚拟化部署</p></blockquote><p id="bbe4" class="pw-post-body-paragraph jn jo hh jp b jq ks js jt ju kt jw jx ja kv jz ka je kx kc kd ji kz kf kg kh ha bi translated">它允许您在一台物理服务器的CPU上运行多个虚拟机(VM)。虚拟化允许应用程序在虚拟机之间隔离，并提供一定程度的安全性，因为一个应用程序的信息不能被另一个应用程序自由访问。</p><p id="dddc" class="pw-post-body-paragraph jn jo hh jp b jq ks js jt ju kt jw jx ja kv jz ka je kx kc kd ji kz kf kg kh ha bi translated">虚拟化允许更好地利用物理服务器中的资源，并允许更好的可扩展性，因为可以轻松地添加或更新应用程序，降低硬件成本，等等。借助虚拟化，您可以将一组物理资源呈现为一个可任意使用的虚拟机集群。</p><p id="600b" class="pw-post-body-paragraph jn jo hh jp b jq ks js jt ju kt jw jx ja kv jz ka je kx kc kd ji kz kf kg kh ha bi translated">每个虚拟机都是在虚拟化硬件之上运行所有组件的完整机器，包括其自己的操作系统。</p><blockquote class="ko kp kq"><p id="90c8" class="jn jo kr jp b jq ks js jt ju kt jw jx ku kv jz ka kw kx kc kd ky kz kf kg kh ha bi translated">集装箱部署</p></blockquote><p id="6574" class="pw-post-body-paragraph jn jo hh jp b jq ks js jt ju kt jw jx ja kv jz ka je kx kc kd ji kz kf kg kh ha bi translated">容器类似于虚拟机，但是它们具有宽松的隔离属性，以便在应用程序之间共享操作系统(OS)。因此，容器被认为是轻量级的。与VM类似，容器有自己的文件系统、CPU、内存、进程空间等等。因为它们与底层基础设施相分离，所以它们可以跨云和操作系统发行版进行移植。</p><h2 id="50cc" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated"><strong class="ak">Docker是什么？</strong></h2><p id="38cc" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh ha bi translated">Docker是一个平台，它以容器的形式将应用程序及其所有依赖项打包在一起。Docker的容器化特性确保了应用程序可以在任何环境下工作。Docker引擎在操作系统级别进行虚拟化。Kubernetes使用Docker作为底层容器平台。</p><figure class="kk kl km kn fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es la"><img src="../Images/9329fa2f745d71b1f4e9a3e62a142f10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T8sBM46izzGNeGw8ikoMuw.png"/></div></div></figure><h2 id="8e23" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated"><strong class="ak">容器编排引擎</strong></h2><p id="5c5f" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh ha bi translated">容器编排引擎自动在一组服务器上部署、扩展和管理容器化的应用程序。它们提供以下功能:</p><blockquote class="ko kp kq"><p id="bd05" class="jn jo kr jp b jq ks js jt ju kt jw jx ku kv jz ka kw kx kc kd ky kz kf kg kh ha bi translated">群集—群集由一组主节点和一组运行应用程序的工作节点组成</p><p id="7f8a" class="jn jo kr jp b jq ks js jt ju kt jw jx ku kv jz ka kw kx kc kd ky kz kf kg kh ha bi translated">调度— COE负责将容器调度到适当的工作节点</p><p id="210e" class="jn jo kr jp b jq ks js jt ju kt jw jx ku kv jz ka kw kx kc kd ky kz kf kg kh ha bi translated">可伸缩性—它们支持容器级和节点级的可伸缩性</p><p id="5ac1" class="jn jo kr jp b jq ks js jt ju kt jw jx ku kv jz ka kw kx kc kd ky kz kf kg kh ha bi translated">负载平衡—应用程序的多个实例作为容器运行。负载均衡器负责在多个工作节点上跨这些容器路由流量</p><p id="bf11" class="jn jo kr jp b jq ks js jt ju kt jw jx ku kv jz ka kw kx kc kd ky kz kf kg kh ha bi translated">容错—监控工作节点和容器的健康状况，并确保定义数量的容器始终正常运行</p><p id="dba7" class="jn jo kr jp b jq ks js jt ju kt jw jx ku kv jz ka kw kx kc kd ky kz kf kg kh ha bi translated">部署—支持多种部署策略，如滚动更新、蓝绿色、金丝雀等</p></blockquote><p id="fea6" class="pw-post-body-paragraph jn jo hh jp b jq ks js jt ju kt jw jx ja kv jz ka je kx kc kd ji kz kf kg kh ha bi translated">以下是流行的容器编排引擎:</p><ul class=""><li id="569d" class="lb lc hh jp b jq ks ju kt ja ld je le ji lf kh lg lh li lj bi translated">库伯内特斯</li><li id="7f75" class="lb lc hh jp b jq lk ju ll ja lm je ln ji lo kh lg lh li lj bi translated">码头工人群</li><li id="bdd4" class="lb lc hh jp b jq lk ju ll ja lm je ln ji lo kh lg lh li lj bi translated">阿帕奇Mesos</li></ul><h2 id="406c" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated"><strong class="ak">为什么选择Kubernetes？</strong></h2><ul class=""><li id="ef9c" class="lb lc hh jp b jq jr ju jv ja lp je lq ji lr kh lg lh li lj bi translated">最初是由谷歌设计的。已经在谷歌工作多年了。经过Gmail、youtube等应用程序的实战测试</li><li id="b178" class="lb lc hh jp b jq lk ju ll ja lm je ln ji lo kh lg lh li lj bi translated">cncf毕业的第一个项目。非常活跃的开发生态系统。由行业领导者如谷歌、微软、亚马逊、IBM、甲骨文等支持</li><li id="b78b" class="lb lc hh jp b jq lk ju ll ja lm je ln ji lo kh lg lh li lj bi translated">成熟稳定。当今大多数大公司都在使用它</li></ul><h2 id="f022" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated"><strong class="ak">库伯内特建筑</strong></h2><figure class="kk kl km kn fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ls"><img src="../Images/0b0f872b762600190a14e54e4bfa741e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BjxeVj__89ONpHWRNAxu5w.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx">Kubernetes Architecture</figcaption></figure><p id="238c" class="pw-post-body-paragraph jn jo hh jp b jq ks js jt ju kt jw jx ja kv jz ka je kx kc kd ji kz kf kg kh ha bi translated">一个集群包含一个或多个主节点和许多工作节点。工作节点是运行应用程序的工作主机。</p><blockquote class="ko kp kq"><p id="410e" class="jn jo kr jp b jq ks js jt ju kt jw jx ku kv jz ka kw kx kc kd ky kz kf kg kh ha bi translated"><strong class="jp hi"> Kubernetes大师</strong></p></blockquote><p id="ed32" class="pw-post-body-paragraph jn jo hh jp b jq ks js jt ju kt jw jx ja kv jz ka je kx kc kd ji kz kf kg kh ha bi translated">负责管理集群。它协调集群内部的所有活动，并与工作人员进行交互。以下是主控器的主要组件:</p><blockquote class="ko kp kq"><p id="d0c3" class="jn jo kr jp b jq ks js jt ju kt jw jx ku kv jz ka kw kx kc kd ky kz kf kg kh ha bi translated">API服务器—公开用于处理集群的各种API</p><p id="8239" class="jn jo kr jp b jq ks js jt ju kt jw jx ku kv jz ka kw kx kc kd ky kz kf kg kh ha bi translated">调度程序—负责跨工作节点调度pod</p><p id="9d49" class="jn jo kr jp b jq ks js jt ju kt jw jx ku kv jz ka kw kx kc kd ky kz kf kg kh ha bi translated">控制管理器—在内部与各种控制器(如节点控制器、复制控制器)配合工作，以管理群集的整体运行状况</p><p id="4790" class="jn jo kr jp b jq ks js jt ju kt jw jx ku kv jz ka kw kx kc kd ky kz kf kg kh ha bi translated">etcd —存储集群状态信息的分布式键值数据存储</p></blockquote><h2 id="b953" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated"><strong class="ak"> Kubernetes工人</strong></h2><p id="de59" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh ha bi translated">每个工作节点都有一个容器运行时。Docker和rocket都支持。除此之外，每个工作节点上还运行以下组件</p><blockquote class="ko kp kq"><p id="776f" class="jn jo kr jp b jq ks js jt ju kt jw jx ku kv jz ka kw kx kc kd ky kz kf kg kh ha bi translated">Kubelet —在集群中的每个节点上运行的代理。它确保容器在pod中运行</p><p id="aad3" class="jn jo kr jp b jq ks js jt ju kt jw jx ku kv jz ka kw kx kc kd ky kz kf kg kh ha bi translated">kube proxy——在集群中的每个节点上运行的网络代理，实现了Kubernetes <a class="ae ki" href="https://kubernetes.io/docs/concepts/services-networking/service/" rel="noopener ugc nofollow" target="_blank">服务</a>概念的一部分。它维护节点上的网络规则。这些网络规则允许从集群内部或外部的网络会话与您的pod进行网络通信。</p><p id="0b22" class="jn jo kr jp b jq ks js jt ju kt jw jx ku kv jz ka kw kx kc kd ky kz kf kg kh ha bi translated">容器——它们是应用程序运行时。旨在运行微服务。docker和基于rocket的容器都受支持</p><p id="f0e0" class="jn jo kr jp b jq ks js jt ju kt jw jx ku kv jz ka kw kx kc kd ky kz kf kg kh ha bi translated">pods——它们是Kubernetes中调度的原子单位。每个pod包含一个或多个容器。</p></blockquote><figure class="kk kl km kn fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lx"><img src="../Images/842e4abb4b555d8606b9b2f21615fbf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BCX-4nfgLL7dsq-LgmAcjQ.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx">Pod networking</figcaption></figure><p id="6ca6" class="pw-post-body-paragraph jn jo hh jp b jq ks js jt ju kt jw jx ja kv jz ka je kx kc kd ji kz kf kg kh ha bi translated">Pod网络</p><ul class=""><li id="636d" class="lb lc hh jp b jq ks ju kt ja ld je le ji lf kh lg lh li lj bi translated">每个pod都有一个IP地址</li><li id="0555" class="lb lc hh jp b jq lk ju ll ja lm je ln ji lo kh lg lh li lj bi translated">pod中的每个容器都继承了ip并有一个端口</li><li id="559b" class="lb lc hh jp b jq lk ju ll ja lm je ln ji lo kh lg lh li lj bi translated">pod内容器使用本地主机在pod内相互通信(pod内通信)</li><li id="e6b2" class="lb lc hh jp b jq lk ju ll ja lm je ln ji lo kh lg lh li lj bi translated">跨pod的容器使用它们的IP地址相互通信(pod间通信)</li></ul><p id="e8c9" class="pw-post-body-paragraph jn jo hh jp b jq ks js jt ju kt jw jx ja kv jz ka je kx kc kd ji kz kf kg kh ha bi translated"><strong class="jp hi">复制集</strong></p><p id="4439" class="pw-post-body-paragraph jn jo hh jp b jq ks js jt ju kt jw jx ja kv jz ka je kx kc kd ji kz kf kg kh ha bi translated">确保指定数量的pod随时运行a .如果有多余的pod，它们会被终止，反之亦然b .当它们出现故障、被删除或终止时，会启动新的pod</p><p id="c190" class="pw-post-body-paragraph jn jo hh jp b jq ks js jt ju kt jw jx ja kv jz ka je kx kc kd ji kz kf kg kh ha bi translated"><strong class="jp hi">部署</strong></p><p id="6b61" class="pw-post-body-paragraph jn jo hh jp b jq ks js jt ju kt jw jx ja kv jz ka je kx kc kd ji kz kf kg kh ha bi translated">一个<em class="kr">部署</em>为<a class="ae ki" href="https://kubernetes.io/docs/concepts/workloads/pods/pod/" rel="noopener ugc nofollow" target="_blank">吊舱</a>和<a class="ae ki" href="https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/" rel="noopener ugc nofollow" target="_blank">复制集</a>提供声明性更新。你描述一个部署中的<em class="kr">期望状态</em>，部署<a class="ae ki" href="https://kubernetes.io/docs/concepts/architecture/controller/" rel="noopener ugc nofollow" target="_blank">控制器</a>以受控的速率将实际状态改变为期望状态。您可以定义部署来创建新的副本集，或者删除现有部署，并在新部署中采用它们的所有资源。</p><p id="1e0c" class="pw-post-body-paragraph jn jo hh jp b jq ks js jt ju kt jw jx ja kv jz ka je kx kc kd ji kz kf kg kh ha bi translated">让我们来看一个名为nginx-deployment.yaml的示例部署:</p><pre class="kk kl km kn fd ly lz ma mb aw mc bi"><span id="f61f" class="ip iq hh lz b fi md me l mf mg">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: nginx-deployment<br/>  labels:<br/>    app: nginx<br/>spec:<br/>  replicas: 3<br/>  selector:<br/>    matchLabels:<br/>      app: nginx<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: nginx<br/>    spec:<br/>      containers:<br/>      - name: nginx<br/>        image: nginx:1.7.9<br/>        ports:<br/>        - containerPort: 80</span></pre><p id="6fd4" class="pw-post-body-paragraph jn jo hh jp b jq ks js jt ju kt jw jx ja kv jz ka je kx kc kd ji kz kf kg kh ha bi translated"><strong class="jp hi"><em class="kr">ku bectl apply-f ~/Documents/nginx-deployment . YAML</em></strong></p><p id="b742" class="pw-post-body-paragraph jn jo hh jp b jq ks js jt ju kt jw jx ja kv jz ka je kx kc kd ji kz kf kg kh ha bi translated"><strong class="jp hi"><em class="kr">ku bectl get pods-o wide</em></strong></p><pre class="kk kl km kn fd ly lz ma mb aw mc bi"><span id="5120" class="ip iq hh lz b fi md me l mf mg">NAME                                READY     STATUS    RESTARTS   AGE       IP            NODE</span><span id="4bfc" class="ip iq hh lz b fi mh me l mf mg">nginx-deployment-76bf4969df-6hpqr   1/1       Running   0          1m        10.244.5.14   aks-agentpool-22051123-1</span><span id="33dd" class="ip iq hh lz b fi mh me l mf mg">nginx-deployment-76bf4969df-8qv2z   1/1       Running   0          1m        10.244.4.11   aks-agentpool-22051123-0</span><span id="0b68" class="ip iq hh lz b fi mh me l mf mg">nginx-deployment-76bf4969df-sg787   1/1       Running   0          1m        10.244.3.12   aks-agentpool-22051123-3</span></pre><h2 id="bd94" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">达蒙塞特</h2><p id="6f5e" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh ha bi translated">DaemonSet确保所有节点运行一个pod实例。这对于以下情况很有用</p><ul class=""><li id="cb3d" class="lb lc hh jp b jq ks ju kt ja ld je le ji lf kh lg lh li lj bi translated">节点监控守护进程，如collectD</li><li id="8afd" class="lb lc hh jp b jq lk ju ll ja lm je ln ji lo kh lg lh li lj bi translated">日志收集守护程序:例如:fluentd</li></ul><p id="79f9" class="pw-post-body-paragraph jn jo hh jp b jq ks js jt ju kt jw jx ja kv jz ka je kx kc kd ji kz kf kg kh ha bi translated">当新节点加入群集时，DaemonSet会创建pod，当任何节点离开群集时，它会销毁pod。</p><pre class="kk kl km kn fd ly lz ma mb aw mc bi"><span id="5e05" class="ip iq hh lz b fi md me l mf mg">apiVersion: apps/v1<br/>kind: DaemonSet<br/>metadata:<br/>  name: fluentd-ds<br/>spec:<br/>template:<br/>metadata:<br/>      labels:<br/>        name: fluentd<br/>spec:<br/>      containers:<br/>      - name: fluentd<br/>image: gcr.io/google-containers/fluentd-elasticsearch:1.20<br/>selector:<br/>    matchLabels:<br/>      name: fluentd</span></pre><h2 id="b977" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">乔布斯</h2><p id="8d1a" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh ha bi translated">作业可用于以下类型的工作负载</p><ul class=""><li id="0684" class="lb lc hh jp b jq ks ju kt ja ld je le ji lf kh lg lh li lj bi translated">pod应该启动、完成工作并终止</li><li id="7044" class="lb lc hh jp b jq lk ju ll ja lm je ln ji lo kh lg lh li lj bi translated">应该按照定义的计划运行的pod</li></ul><pre class="kk kl km kn fd ly lz ma mb aw mc bi"><span id="1708" class="ip iq hh lz b fi md me l mf mg">apiVersion: batch/v1<br/>kind: Job<br/>metadata:<br/>name: countdown<br/>spec:<br/>template:<br/>metadata:<br/>name: countdown<br/>spec:<br/>containers:<br/>- name: counter<br/>image: centos:7<br/>command:<br/>- "bin/bash"<br/>- "-c"<br/>- "for i in 9 8 7 6 5 4 3 2 1 ; do echo $i ; done"<br/>restartPolicy: Never</span></pre><h2 id="3b10" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">负载平衡器</h2><figure class="kk kl km kn fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mi"><img src="../Images/7d6253c3e78b1141b6baa0d16a64b361.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*77_2msjk63-YZDXN-1E65Q.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx">Load balancer</figcaption></figure><p id="f276" class="pw-post-body-paragraph jn jo hh jp b jq ks js jt ju kt jw jx ja kv jz ka je kx kc kd ji kz kf kg kh ha bi translated">负载平衡器服务是向互联网公开服务的标准方式。基于云提供商，它将生成各自的负载平衡器，并为您提供一个单一的IP地址，将所有流量转发到您的服务。</p><pre class="kk kl km kn fd ly lz ma mb aw mc bi"><span id="f6ac" class="ip iq hh lz b fi md me l mf mg">apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: helloindia<br/>spec:<br/>  type: LoadBalancer<br/>  ports:<br/>  - name: http<br/>    port: 80<br/>    targetPort: 8080<br/>    protocol: TCP<br/>  selector:<br/>    app: helloindia</span></pre><p id="e875" class="pw-post-body-paragraph jn jo hh jp b jq ks js jt ju kt jw jx ja kv jz ka je kx kc kd ji kz kf kg kh ha bi translated">部署后，获取服务详细信息</p><pre class="kk kl km kn fd ly lz ma mb aw mc bi"><span id="0a14" class="ip iq hh lz b fi md me l mf mg">kubectl get svc</span><span id="d350" class="ip iq hh lz b fi mh me l mf mg">NAME         TYPE           CLUSTER-IP    EXTERNAL-IP     PORT(S)        AGE</span><span id="5060" class="ip iq hh lz b fi mh me l mf mg">helloindia   LoadBalancer   10.0.26.251   40.78.145.151   80:32076/TCP   15m</span><span id="bdf3" class="ip iq hh lz b fi mh me l mf mg">kubernetes   ClusterIP      10.0.0.1      &lt;none&gt;          443/TCP        24m</span></pre><h2 id="9bb7" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">入口控制器</h2><figure class="kk kl km kn fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mj"><img src="../Images/a8a2b80ca2cc7afb621130420aa2c56c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zKtig3ZNvb7F2Z1E8yckcg.png"/></div></div></figure><p id="89c4" class="pw-post-body-paragraph jn jo hh jp b jq ks js jt ju kt jw jx ja kv jz ka je kx kc kd ji kz kf kg kh ha bi translated">当您在一个集群上部署了多个服务，并且想要公开一个入口点时，您可以使用Ingress。稍后，您可以基于URL路径定义规则，将流量路由到适当的服务</p><pre class="kk kl km kn fd ly lz ma mb aw mc bi"><span id="40d8" class="ip iq hh lz b fi md me l mf mg">apiVersion: extensions/v1beta1<br/>kind: Ingress<br/>metadata:<br/>  name: ingress<br/>  annotations:<br/>    nginx.ingress.kubernetes.io/rewrite-target: /<br/>spec:<br/>  rules:<br/>  - http:<br/>      paths:<br/>      - path: /service1<br/>        backend:<br/>          serviceName: service1<br/>          servicePort: 80<br/>      - path: /service2<br/>        backend:<br/>          serviceName: service2<br/>          servicePort: 80<br/>      - path: /service3<br/>        backend:<br/>          serviceName: service3<br/>          servicePort: 80</span></pre></div></div>    
</body>
</html>