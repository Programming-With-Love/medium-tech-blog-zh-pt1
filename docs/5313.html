<html>
<head>
<title>Part II: Develop stream processing apps using Kafka Streams on Oracle Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">第二部分:在Oracle Cloud上使用Kafka Streams开发流处理应用</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/part-ii-develop-stream-processing-apps-using-kafka-streams-on-oracle-cloud-8ff06f47c853?source=collection_archive---------0-----------------------#2017-09-30">https://medium.com/oracledevs/part-ii-develop-stream-processing-apps-using-kafka-streams-on-oracle-cloud-8ff06f47c853?source=collection_archive---------0-----------------------#2017-09-30</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="85fd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是关于Oracle云上的流处理微服务开发的两部分博客系列的最后一部分。在第一部分中，我们讨论了核心概念、架构和一些代码。</p><p id="305f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这一部分将涉及</p><ul class=""><li id="bb85" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated">不同Oracle云服务的设置和配置</li><li id="50d0" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">部署和CI/CD</li><li id="2855" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">运行应用程序并进行测试</li></ul></div><div class="ab cl jr js go jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="ha hb hc hd he"><h1 id="ed2b" class="jy jz hh bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">设置和部署</h1><h2 id="7944" class="kw jz hh bd ka kx ky kz ke la lb lc ki ip ld le km it lf lg kq ix lh li ku lj bi translated">Oracle活动中心云</h2><p id="2ef3" class="pw-post-body-paragraph ie if hh ig b ih lk ij ik il ll in io ip lm ir is it ln iv iw ix lo iz ja jb ha bi translated">我们不会讨论全部细节，因为这是简单明了且有据可查的。以下是高级步骤</p><ul class=""><li id="bad2" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated">创建一个Kafka代理(单节点，与Zookeeper放在一起)——<a class="ae jc" href="http://docs.oracle.com/en/cloud/paas/event-hub-cloud/ehcug/creating-cluster.html" rel="noopener ugc nofollow" target="_blank">文档</a></li><li id="43af" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">创建主题(存储推文)——<a class="ae jc" href="http://docs.oracle.com/en/cloud/paas/event-hub-cloud/ehcug/creating-topic.html" rel="noopener ugc nofollow" target="_blank">文档</a></li></ul><p id="c602" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你最终会得到这样的东西</p><figure class="lq lr ls lt fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es lp"><img src="../Images/11824f83904bb4cc22f20ecda334ac38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ExPhqb51fMgKRLG7uZcSCw.png"/></div></div><figcaption class="mb mc et er es md me bd b be z dx">Managed Kakfa broker</figcaption></figure><figure class="lq lr ls lt fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mf"><img src="../Images/eb5ea6540d23feea17195e72e6b9d808.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DOws6thfsJQkBpWztmXuYA.png"/></div></div><figcaption class="mb mc et er es md me bd b be z dx">Kafka topic</figcaption></figure><p id="ab4d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">创建自定义访问规则</strong></p><p id="ad77" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您需要在Oracle Event Hub Cloud上的Kafka服务器虚拟机上创建一个自定义的<strong class="ig hi">访问规则</strong>来打开端口<strong class="ig hi"> 6667 </strong>。这是为了让Kafka Connect Twitter (source)连接器能够工作(细节如下)</p><blockquote class="mg mh mi"><p id="3b4c" class="ie if mj ig b ih ii ij ik il im in io mk iq ir is ml iu iv iw mm iy iz ja jb ha bi translated">我们在Oracle Application Container上的流处理应用在内部处理连接，并且<strong class="ig hi">和</strong>不需要打开任何端口</p></blockquote><figure class="lq lr ls lt fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mn"><img src="../Images/29c884c5f2576baea32b9513abff34f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*78eeFhzU5_LOhpLzFjT8MQ.png"/></div></div><figcaption class="mb mc et er es md me bd b be z dx">Navigate to Access Rules section</figcaption></figure><figure class="lq lr ls lt fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mo"><img src="../Images/8059840df550267c18b1d71558c707de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VOokH8ecSmjB-TjFnyFqxQ.png"/></div></div><figcaption class="mb mc et er es md me bd b be z dx">Create the new rule</figcaption></figure><figure class="lq lr ls lt fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mn"><img src="../Images/30d2a672db238a20d2becca0ca95bfff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K4v8JOiG3hxjcwyqsu51ww.png"/></div></div><figcaption class="mb mc et er es md me bd b be z dx">New Access Rule created successfully</figcaption></figure><h2 id="9110" class="kw jz hh bd ka kx ky kz ke la lb lc ki ip ld le km it lf lg kq ix lh li ku lj bi translated">Oracle应用容器云</h2><p id="8a8d" class="pw-post-body-paragraph ie if hh ig b ih lk ij ik il ll in io ip lm ir is it ln iv iw ix lo iz ja jb ha bi translated">在这种情况下，您唯一需要做的就是提供Oracle应用容器云缓存服务— <a class="ae jc" href="http://docs.oracle.com/en/cloud/paas/app-container-cloud/cache/creating-cache-service.html" rel="noopener ugc nofollow" target="_blank">这是文档</a></p><figure class="lq lr ls lt fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mp"><img src="../Images/366dc327ca3f865225a523c402f7ec1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PHG3K6qOi3ac4Nqj9_LciQ.png"/></div></div><figcaption class="mb mc et er es md me bd b be z dx">Oracle ACCS Cache (serves as stream processing state store)</figcaption></figure><h2 id="8284" class="kw jz hh bd ka kx ky kz ke la lb lc ki ip ld le km it lf lg kq ix lh li ku lj bi translated">Oracle开发人员云</h2><p id="5ba6" class="pw-post-body-paragraph ie if hh ig b ih lk ij ik il ll in io ip lm ir is it ln iv iw ix lo iz ja jb ha bi translated">您可以参考以前的博客(这里将重点介绍这个例子的一些细节)</p><p id="0884" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">参考文献</strong></p><ul class=""><li id="ae8d" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated">在Oracle开发人员云中引导应用程序— <a class="ae jc" href="https://community.oracle.com/community/cloud_computing/oracle-cloud-developer-solutions/blog/2017/05/25/getting-started-with-kafka-based-microservices-using-oracle-event-hub-cloud-application-container-cloud-developer-cloud#jive_content_id_Project__code_repository_creation" rel="noopener ugc nofollow" target="_blank">项目&amp;代码库创建</a></li><li id="7aad" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">持续集成设置— <a class="ae jc" href="https://community.oracle.com/community/cloud_computing/oracle-cloud-developer-solutions/blog/2017/05/25/getting-started-with-kafka-based-microservices-using-oracle-event-hub-cloud-application-container-cloud-developer-cloud#jive_content_id_Configure_build_job" rel="noopener ugc nofollow" target="_blank">配置构建作业</a></li><li id="b22e" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">部署设置— <a class="ae jc" href="https://community.oracle.com/community/cloud_computing/oracle-cloud-developer-solutions/blog/2017/05/25/getting-started-with-kafka-based-microservices-using-oracle-event-hub-cloud-application-container-cloud-developer-cloud#jive_content_id_Continuous_Deployment_CD_to_Application_Container_Cloud" rel="noopener ugc nofollow" target="_blank">持续部署(CD)到应用容器云</a></li></ul><p id="1df0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">部署配置</strong></p><figure class="lq lr ls lt fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mq"><img src="../Images/a56feb643c739e14c024be61cf319eda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Sr63c_6AViMLZdb3sRogZg.png"/></div></div><figcaption class="mb mc et er es md me bd b be z dx">Deployment config part 1</figcaption></figure><figure class="lq lr ls lt fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mr"><img src="../Images/da379303008f5666181b004081d1cbfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yQq4jHSAr4KRXCk3ScUiFw.png"/></div></div><figcaption class="mb mc et er es md me bd b be z dx">Deployment config part 2</figcaption></figure><p id="3b20" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">Oracle开发人员云中的部署确认</strong></p><figure class="lq lr ls lt fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es ms"><img src="../Images/37e2eccccdaa598623221916f6b239df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h78Fh3mQSkc1ACSXyDwa7w.png"/></div></div><figcaption class="mb mc et er es md me bd b be z dx">Deployments in Oracle Developer Cloud</figcaption></figure><p id="b69c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">Oracle应用容器云中的后期部署状态</strong></p><figure class="lq lr ls lt fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mt"><img src="../Images/5f4e256e1754498570c6b958637d522a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U0IvHayGaQD9on1pwHHnNA.png"/></div></div><figcaption class="mb mc et er es md me bd b be z dx">Oracle Application Container Cloud (applications list)</figcaption></figure><figure class="lq lr ls lt fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mu"><img src="../Images/62359c471e48dbf43b3dc37ac9a47d85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yq4IGD5fM1Eer9RvRtbW9g.jpeg"/></div></div><figcaption class="mb mc et er es md me bd b be z dx">Environment variables for our application</figcaption></figure><h2 id="4604" class="kw jz hh bd ka kx ky kz ke la lb lc ki ip ld le km it lf lg kq ix lh li ku lj bi translated">Kafka Connect Twitter连接器</h2><p id="0682" class="pw-post-body-paragraph ie if hh ig b ih lk ij ik il ll in io ip lm ir is it ln iv iw ix lo iz ja jb ha bi translated">你可以阅读关于Github项目的详细信息——这里有一个关于如何设置连接器来使用来自Twitter的tweets并把它们转发到我们选择的Kafka主题的快速总结</p><ul class=""><li id="1045" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated"><a class="ae jc" href="https://github.com/Eneco/kafka-connect-twitter#creating-a-twitter-application" rel="noopener ugc nofollow" target="_blank">创建一个Twitter应用程序</a></li><li id="3742" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">在您的本地机器上安装Kafka(这是必需的，因为Kafka Connect是与Kafka发行版捆绑在一起的)——只需<a class="ae jc" href="https://kafka.apache.org/downloads" rel="noopener ugc nofollow" target="_blank">下载</a>并解压即可！</li><li id="2620" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">克隆项目— <code class="du mv mw mx my b"> git clone <a class="ae jc" href="https://github.com/Eneco/kafka-connect-twitter.git" rel="noopener ugc nofollow" target="_blank">https://github.com/Eneco/kafka-connect-twitter.git</a></code></li><li id="6979" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">建造它— <code class="du mv mw mx my b">mvn clean package</code></li><li id="ce48" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">配置<code class="du mv mw mx my b">connect-simple-source-standalone.properties</code> —除了Oracle Event Hub Kafka集群信息(突出显示)之外，您可以保留默认设置</li></ul><pre class="lq lr ls lt fd mz my na nb aw nc bi"><span id="ce8b" class="kw jz hh my b fi nd ne l nf ng"><strong class="my hi">bootstrap.servers=&lt;oracle_ehcs_IP&gt;:6667<br/></strong>key.converter=org.apache.kafka.connect.storage.StringConverter<br/>value.converter=org.apache.kafka.connect.storage.StringConverter<br/>key.converter.schemas.enable=true<br/>value.converter.schemas.enable=true<br/>internal.key.converter=org.apache.kafka.connect.json.JsonConverter<br/>internal.value.converter=org.apache.kafka.connect.json.JsonConverter<br/>internal.key.converter.schemas.enable=false<br/>internal.value.converter.schemas.enable=false<br/>offset.storage.file.filename=/tmp/connect.offsets<br/>offset.flush.interval.ms=10000</span></pre><ul class=""><li id="8b13" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated">配置<code class="du mv mw mx my b">twitter-source.properties</code> —突出显示的属性是需要根据您的环境进行填充的属性</li></ul><pre class="lq lr ls lt fd mz my na nb aw nc bi"><span id="17d0" class="kw jz hh my b fi nd ne l nf ng">name=twitter-source<br/>connector.class=com.eneco.trading.kafka.connect.twitter.TwitterSourceConnector<br/>tasks.max=1<br/><strong class="my hi">topic=&lt;name_of_oracle_ehcs_topic&gt;<br/>twitter.consumerkey=&lt;as_per_your_twitter_app&gt;<br/>twitter.consumersecret=&lt;as_per_your_twitter_app&gt;<br/>twitter.token=&lt;as_per_your_twitter_app&gt;<br/>twitter.secret=&lt;as_per_your_twitter_app&gt;</strong><br/>output.format=string<br/>language=en<br/>stream.type=filter<br/><strong class="my hi">track.terms=&lt;keywords_of_your_choice&gt;</strong></span></pre></div><div class="ab cl jr js go jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="ha hb hc hd he"><h1 id="0f65" class="jy jz hh bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">试验</h1><h2 id="94e6" class="kw jz hh bd ka kx ky kz ke la lb lc ki ip ld le km it lf lg kq ix lh li ku lj bi translated">触发Kafka Connect Twitter源作业</h2><ul class=""><li id="ffc1" class="jd je hh ig b ih lk il ll ip nh it ni ix nj jb ji jj jk jl bi translated">在类路径上设置JAR—<code class="du mv mw mx my b">export CLASSPATH=`pwd`/target/kafka-connect-twitter-0.1-jar-with-dependencies.jar</code></li><li id="1860" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">运行连接器— <code class="du mv mw mx my b">KAFKA_HOME/bin/connect-standalone.sh connect-simple-source-standalone.properties twitter-source.properties</code></li></ul><figure class="lq lr ls lt fd lu er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es nk"><img src="../Images/589a22a918388adf1ada423ef7dd4e3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MjEzg7-iQSplxkUDErmrHw.jpeg"/></div></div><figcaption class="mb mc et er es md me bd b be z dx">Kafka Connect Twitter connector in action</figcaption></figure><p id="99eb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这将开始向Kafka主题推送tweets，进而触发我们的流处理应用程序来搅动计数——您可以通过REST端点访问它</p><h2 id="dd46" class="kw jz hh bd ka kx ky kz ke la lb lc ki ip ld le km it lf lg kq ix lh li ku lj bi translated">访问REST端点</h2><ul class=""><li id="c200" class="jd je hh ig b ih lk il ll ip nh it ni ix nj jb ji jj jk jl bi translated">查看您跟踪的特定关键字/标签(例如云)的数量— <code class="du mv mw mx my b">curl <a class="ae jc" href="https://streamingtweetanalysis-ocloud109.apaas.us2.oraclecloud.com/stat/cloud" rel="noopener ugc nofollow" target="_blank">https://&lt;accs_app_url&gt;/stats/cloud</a></code>。您将得到一个JSON结果</li></ul><pre class="lq lr ls lt fd mz my na nb aw nc bi"><span id="958f" class="kw jz hh my b fi nd ne l nf ng">{<br/> “term”: “cloud”,<br/> “count”: 424<br/>}</span></pre><ul class=""><li id="29f4" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated">检查<strong class="ig hi">所有</strong>项的计数— <code class="du mv mw mx my b">curl <a class="ae jc" href="https://streamingtweetanalysis-ocloud109.apaas.us2.oraclecloud.com/stat/cloud" rel="noopener ugc nofollow" target="_blank">https://&lt;accs_app_url&gt;/stat</a>s</code></li></ul><pre class="lq lr ls lt fd mz my na nb aw nc bi"><span id="6fc3" class="kw jz hh my b fi nd ne l nf ng">[<br/> {<br/> “term”: “java”,<br/> “count”: 49<br/> },<br/> {<br/> “term”: “kafka”,<br/> “count”: 8<br/> },<br/> {<br/> “term”: “cloud”,<br/> “count”: 424<br/> },<br/> {<br/> “term”: “oracle”,<br/> “count”: 38<br/> },<br/> {<br/> “term”: “paas”,<br/> “count”: 7<br/> }<br/>]</span></pre><h1 id="b5fc" class="jy jz hh bd ka kb nl kd ke kf nm kh ki kj nn kl km kn no kp kq kr np kt ku kv bi translated">测试CI/CD流</h1><p id="0828" class="pw-post-body-paragraph ie if hh ig b ih lk ij ik il ll in io ip lm ir is it ln iv iw ix lo iz ja jb ha bi translated">做一些代码修改，推送到Oracle开发者云服务Git库。这应该</p><ul class=""><li id="dcbe" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated">自动触发构建，一旦成功将</li><li id="8822" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">自动触发部署流程，以及</li><li id="0779" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">将新的应用程序版本重新部署到应用程序容器云</li></ul><p id="8104" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这篇博文(及系列)到此为止！</p><h1 id="361f" class="jy jz hh bd ka kb nl kd ke kf nm kh ki kj nn kl km kn no kp kq kr np kt ku kv bi translated">不要忘记…</h1><ul class=""><li id="61c5" class="jd je hh ig b ih lk il ll ip nh it ni ix nj jb ji jj jk jl bi translated">查看Oracle应用容器云的<a class="ae jc" href="https://docs.oracle.com/en/cloud/paas/app-container-cloud/create-first-applications.html" rel="noopener ugc nofollow" target="_blank">教程</a>——每个运行时都有适合的东西！</li><li id="e9c3" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated"><a class="ae jc" href="http://bit.ly/2gR3nrV" rel="noopener ugc nofollow" target="_blank">应用容器云上的其他博客</a></li></ul><blockquote class="mg mh mi"><p id="4b26" class="ie if mj ig b ih ii ij ik il im in io mk iq ir is ml iu iv iw mm iy iz ja jb ha bi translated"><em class="hh">本文表达的观点仅代表我个人，不一定代表甲骨文的观点。</em></p></blockquote></div></div>    
</body>
</html>