<html>
<head>
<title>Working with GraphQL using Vanilla JS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Vanilla JS使用GraphQL</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/writing-a-graphql-client-in-vanilla-js-d2a09aee7c6c?source=collection_archive---------0-----------------------#2019-01-22">https://medium.com/walmartglobaltech/writing-a-graphql-client-in-vanilla-js-d2a09aee7c6c?source=collection_archive---------0-----------------------#2019-01-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="15b2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">GraphQL是近年来出现的最令人兴奋的新技术之一。对于开发人员来说，它是一个很好的工具，可以控制他们从API中需要的数据。GraphQL背后的基本思想是</p><blockquote class="jc"><p id="b5bc" class="jd je hh bd jf jg jh ji jj jk jl jb dx translated">`得到你所需要的，不多不少'</p></blockquote><p id="9fb7" class="pw-post-body-paragraph ie if hh ig b ih jm ij ik il jn in io ip jo ir is it jp iv iw ix jq iz ja jb ha bi translated">这个概念有助于使您的API负载最小化，并帮助开发人员请求他们在应用程序中需要的数据，而不是由服务器驱动。</p><p id="7751" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，假设我们正在编写一个web应用程序，它从GraphQL端点获取数据，并使用它来呈现网页。你想到的第一个解决方案是什么？</p><p id="d466" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du jr js jt ju b">npm i &lt;popular-graphql-client-library&gt;</code>？</p><p id="5ade" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，在你膨胀你的<code class="du jr js jt ju b">node_modules</code>文件夹之前，想想你的用例。你真的想交图书馆税吗？尤其是如果你能在没有任何外部依赖的情况下解决你的问题？</p><p id="3ad8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">尽管存在使用像Apollo或Relay这样的库的有效案例，但它们不一定是与GraphQL API通信的首选解决方案。使用普通的JavaScript特性，如fetch、promises和string模板，可以简化轻量级GraphQL客户端的编写。一些示例场景可能是构建一个具有最小依赖性的瘦客户机，或者构建一个原型解决方案。</p><p id="8bd1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们构建一个可以与GraphQL API通信并搜索书名的简单表单。我们将只使用HTML5、CSS3和ES6 JavaScript。</p><p id="2e25" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，我有一个运行在<code class="du jr js jt ju b">localhost:3000</code>上的GraphQL服务器，它返回五本书的列表。</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es jv"><img src="../Images/dd320bbcec9a3e660a3b3732568c5513.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZEqm5z4_UNJ55BpeFg8egQ.png"/></div></div></figure><p id="6805" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我有一个简单的HTML页面，有一些样式</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es kh"><img src="../Images/a2d6196c63c3efcc6d1be85b48046f79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DIHnHHBdUiLS9xzF-PzDCg.png"/></div></div></figure><figure class="jw jx jy jz fd ka"><div class="bz dy l di"><div class="ki kj l"/></div></figure><p id="a897" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，在我们的<code class="du jr js jt ju b">script.js</code>文件中，我们将选择表单并添加一个事件监听器。</p><pre class="jw jx jy jz fd kk ju kl km aw kn bi"><span id="71aa" class="ko kp hh ju b fi kq kr l ks kt">const bookContainer = document.querySelector("#book-container");<br/>const form = document.querySelector("#book-search");</span><span id="bc7e" class="ko kp hh ju b fi ku kr l ks kt">const loadBooks = (ev) =&gt; {<br/>  ev.preventDefault();<br/>}</span><span id="a856" class="ko kp hh ju b fi ku kr l ks kt">form.addEventListener("submit", loadBooks)</span></pre><p id="7c17" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du jr js jt ju b">loadBooks</code>函数将使用本地获取调用GraphQL API。但在此之前，让我们添加一个函数来构造查询。</p><pre class="jw jx jy jz fd kk ju kl km aw kn bi"><span id="7b7d" class="ko kp hh ju b fi kq kr l ks kt">const getBooksQuery = keyword =&gt; `{ allBooks(filter: { q:"${keyword}"}) { author title url } }`;</span></pre><p id="5716" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们的查询构建器函数返回一个字符串，该字符串将按关键字搜索书名并返回一个匹配列表。我们通过在查询中使用过滤器来实现这一点。因为我们只对作者信息、书名和呈现图书列表的URL感兴趣，所以我们只从GraphQL服务器请求这些字段。这就是GraphQL如何帮助我们只获取我们需要的数据。</p><p id="3463" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们将在提交处理程序中充实对服务器的调用。</p><figure class="jw jx jy jz fd ka"><div class="bz dy l di"><div class="ki kj l"/></div></figure><p id="5f52" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，我们从输入表单中获取搜索关键字值，并创建一个<code class="du jr js jt ju b">options</code>对象来发送POST请求。我们将关键字传递给查询构建器函数，并获取需要传递回GraphQL API的查询字符串。我们添加了一个<code class="du jr js jt ju b">renderBooks</code>方法，它将在一个简单的卡片视图中显示图书列表。</p><p id="f409" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是它完整的样子。</p><figure class="jw jx jy jz fd ka"><div class="bz dy l di"><div class="ki kj l"/></div></figure><p id="f22e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最终结果:</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div class="er es kv"><img src="../Images/ea729307ea022f3d99aca09f292fdb14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*Ima5xNhBIvu6qVw5-XOPiw.gif"/></div></figure><p id="cf41" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">其他一些可以处理的用例有:</p><ul class=""><li id="aa90" class="kw kx hh ig b ih ii il im ip ky it kz ix la jb lb lc ld le bi translated">使用片段——我们可以让函数以片段的形式返回字符串，并根据需要简单地将其添加到主查询中。</li><li id="89fa" class="kw kx hh ig b ih lf il lg ip lh it li ix lj jb lb lc ld le bi translated">多个查询—每个查询都可以写成自己的函数。</li></ul><p id="99bd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">仅此而已。现在，您可以与GraphQL服务器通信，并尽可能减少客户端代码，实现零依赖性。前进，建造令人敬畏的东西！</p></div></div>    
</body>
</html>