# è®©æ‚¨çš„æµ‹è¯•æ›´æœ‰å¼¹æ€§

> åŸæ–‡ï¼š<https://medium.com/walmartglobaltech/making-your-testing-more-resilient-57be6fb11f91?source=collection_archive---------6----------------------->

è‡ªåŠ¨åŒ–æµ‹è¯•å¯¹äºæˆ‘ä»¬ä½œä¸ºä¸€ä¸ªè½¯ä»¶ç»„ç»‡å¦‚ä½•å¿«é€Ÿè‡ªä¿¡åœ°è¿ä½œè‡³å…³é‡è¦ã€‚åœ¨è¿™ä¸ªæ•æ·å¼€å‘å’ŒæŒç»­éƒ¨ç½²çš„æ—¶ä»£ï¼Œæ‹¥æœ‰æ¥è¿‘ 100%çš„ç«¯åˆ°ç«¯åŠŸèƒ½æµ‹è¯•å¯ä»¥å†³å®šè½¯ä»¶äº§å“çš„æˆè´¥ã€‚

![](img/1911d4da12863e20484cec7fbbe0f541.png)

Credit: [pixabay.com](https://pixabay.com/photos/horse-racing-gallop-jockey-horses-4018609/)

æµè§ˆå™¨æµ‹è¯•æ˜¯ä¸€ä¸ªç›¸å½“æ–°çš„é¢†åŸŸï¼Œä¸»è¦ç”±åŸºäº Selenium çš„ web é©±åŠ¨ç¨‹åºæ¥é©±åŠ¨ç‰¹å®šäºæµè§ˆå™¨çš„ APIã€‚ç›´åˆ°èµ›æ™®æ‹‰æ–¯æœ€è¿‘æ‰å‡ºç°ã€‚å…³é”®çš„åŒºåˆ«åœ¨äºï¼ŒCypress æµ‹è¯•ç›´æ¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œè€Œä¸æ˜¯åœ¨ web é©±åŠ¨ä¸­è¿è¡Œï¼Œè¿™ä½¿å¾—å®ƒæ›´å¿«æ›´å¯é ã€‚åœ¨å¾ˆçŸ­çš„æ—¶é—´å†…ï¼Œå®ƒå°±åœ¨è´¨é‡å·¥ç¨‹å¸ˆå’Œå¼€å‘äººå‘˜ç¤¾åŒºä¸­æµè¡Œèµ·æ¥ã€‚

æˆ‘èŒä¸šç”Ÿæ¶¯çš„å¤§éƒ¨åˆ†æ—¶é—´éƒ½æ˜¯ä¸€åå¼€å‘äººå‘˜ï¼Œä»äº‹å…¨æ ˆå·¥ä½œï¼Œä¹ æƒ¯äºå•å…ƒæµ‹è¯•ã€‚ç¼–å†™åŠŸèƒ½æµ‹è¯•å¯¹æˆ‘æ¥è¯´æ˜¯æ–°çš„ï¼Œå› ä¸ºå®ƒä¸»è¦æ˜¯è´¨é‡å·¥ç¨‹å¸ˆçš„èŒè´£ã€‚ä½†æ˜¯è‡ªå·±ç¼–å†™ä¸€ä¸ªåŠŸèƒ½æ€§çš„ç«¯åˆ°ç«¯æµ‹è¯•è®©æˆ‘æ™šä¸Šç¡å¾—æ›´å¥½ğŸ˜´ã€‚å½“æˆ‘çŸ¥é“æˆ‘æœ‰ä¸€å †åŠŸèƒ½æµ‹è¯•æ¥*è¯æ˜*æˆ‘çš„å·¥ä½œæ—¶ï¼Œæˆ‘æ›´æœ‰ä¿¡å¿ƒç‚¹å‡»*åˆå¹¶*æŒ‰é’®ã€‚

ç”¨ cypress ç¼–å†™åŠŸèƒ½æµ‹è¯•æ—¢å¿«é€Ÿåˆç®€å•ã€‚å®ƒçš„æ–‡æ¡£å’Œç›´è§‚çš„ API ä½¿å¾—æ–°æ‰‹å‡çº§æ²¡æœ‰éº»çƒ¦ã€‚åœ¨æˆ‘è¿‡å»å…­ä¸ªæœˆçš„ it ä¹‹æ—…ä¸­ï¼Œæˆ‘é‡åˆ°äº†è®¸å¤šé¡¿æ‚Ÿçš„æ—¶åˆ»ï¼Œæˆ‘æ„¿æ„ä¸å·¥ç¨‹å¸ˆåŒäº‹ä»¬åˆ†äº«ã€‚

1.**åœ¨æŸä½¿ç”¨** [***æŸ-æ’ä»¶-é‡è¯•***](https://github.com/Bkucera/cypress-plugin-retries)

ä½¿ç”¨è‡ªåŠ¨åŒ–è½¯ä»¶è¿è¡ŒåŠŸèƒ½æµ‹è¯•ä¸åŒäºç”¨æˆ·ä¸å®ƒäº¤äº’çš„æ–¹å¼ã€‚ä¸€ä¸ªçœŸæ­£çš„ç”¨æˆ·*çŸ¥é“*å±å¹•ä¸Šæ­£åœ¨å‘ç”Ÿä»€ä¹ˆï¼Œå¹¶ä¸”èƒ½å¤Ÿé€‚åº”å®ƒï¼›ä¸åœ¨æµè§ˆå™¨ä¸Šè¿è¡Œä¸€ç»„æŒ‡ä»¤çš„è„šæœ¬ä¸åŒã€‚åº”ç”¨ç¨‹åº UI çš„å¯å˜æ€§å¯èƒ½æ˜¯ç”±äºä¸åŒçš„ API å“åº”æ—¶é—´ã€ç½‘ç»œé€Ÿåº¦ã€æµè§ˆå™¨å’ŒæœåŠ¡å™¨ç¯å¢ƒç­‰é€ æˆçš„ã€‚é‡è¯•å¤±è´¥çš„æµ‹è¯•éå¸¸æœ‰åŠ©äºæŠµæ¶ˆè¿™ç§ä¸å¯é¢„æµ‹æ€§ğŸ˜…

2.**æœåŠ¡å™¨ç«¯ä½¿ç”¨*cy . request*è¿›è¡Œæ¸²æŸ“å†…å®¹éªŒè¯**

æµ‹è¯•æœåŠ¡å™¨ç«¯å‘ˆç°çš„ä»£ç å¹¶ä¸ç®€å•ã€‚å½“ä¸€ä¸ªæµ‹è¯•åœ¨æµè§ˆå™¨ä¸­è¯·æ±‚ä¸€ä¸ªç‰¹å®šçš„ URL æ—¶ï¼Œè„šæœ¬ä¼šç«‹å³æ‰§è¡Œå¹¶ä¿®æ”¹æœåŠ¡å™¨å‘ˆç°çš„ä»£ç ã€‚ä½¿ç”¨ cy.request æˆ‘ä»¬å¯ä»¥é€šè¿‡å‘å‡º HTTP è¯·æ±‚æ¥è¯·æ±‚ HTML æ–‡æ¡£ã€‚ä¸€æ—¦è¿”å› HTMLï¼Œæˆ‘ä»¬å°±å¯ä»¥åˆ›å»ºä¸€ä¸ª HTML æ–‡æ¡£ï¼Œåƒæˆ‘ä»¬æœŸæœ›çš„å¯¹è±¡å’ŒæŸ¥è¯¢å…ƒç´ ã€‚

3.**è¿è¡Œæµ‹è¯•æ—¶è‡ªåŠ¨ç”Ÿæˆæ¨¡æ‹Ÿ**

ä¸ºæ‚¨çš„æ•°æ®æä¾›æ¨¡æ‹Ÿå¯¹äºä½¿æµ‹è¯•å¯é¢„æµ‹å’Œæ›´å¿«æ˜¯è‡³å…³é‡è¦çš„ã€‚æˆ‘ä»¬çœ‹åˆ°ï¼Œåœ¨æ·»åŠ æ¨¡æ‹Ÿåï¼ŒCI ä¸­çš„ç‰‡çŠ¶åŒ–å’Œæµ‹è¯•å‘¨æœŸæ˜¾è‘—å‡å°‘ã€‚ç„¶è€Œï¼Œæˆ‘è®¨åŒæ·»åŠ æ¨¡æ‹Ÿçš„éƒ¨åˆ†æ˜¯ä¸ºæ— æ•°ç”¨ä¾‹æ‰‹åŠ¨æ·»åŠ æ¨¡æ‹Ÿæ–‡ä»¶ã€‚ä½¿ç”¨è¿™ä¸ªç®€å•çš„å®ç”¨ç¨‹åºæœ‰åŠ©äºç”Ÿæˆ mock(å¦‚æœä¸å­˜åœ¨çš„è¯),æˆ–è€…ç”¨ä»¥å‰ç”Ÿæˆçš„ mock è¿›è¡Œå“åº”ã€‚ğŸ™Œ

4.ä½¿ç”¨å®æ—¶æœåŠ¡/æ¨¡æ‹ŸæœåŠ¡æœ‰é€‰æ‹©åœ°è¿è¡Œæµ‹è¯•ã€‚

ä½¿ç”¨ mock è¿è¡Œæµ‹è¯•æœ‰å…¶ä¼˜åŠ¿ï¼Œä½†æœ‰æ—¶ä¸ live API åŒæ­¥å¹¶ç¡®ä¿åº”ç”¨ç¨‹åºæŒ‰é¢„æœŸè¿è¡ŒåŒæ ·é‡è¦ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„åŒ…æ¥æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æµ‹è¯•åç§°ï¼Œå¹¶è¿è¡Œæ²¡æœ‰æ¨¡æ‹Ÿçš„æµ‹è¯•ã€‚

5.**æŸæ ‘å¸ä»¤éƒ¨çš„æ— åè‹±é›„â€”â€”cy . wrapï¼Œã€‚å¦‚(' @â€¦')**

*cy.wrap* æœ‰æ—¶å¾ˆæ–¹ä¾¿ï¼Œå®ƒå¸®åŠ©åŒ…è£…ä»»ä½•ä¸æ˜¯ cypress å‘½ä»¤ç›´æ¥ç»“æœçš„å¯¹è±¡ï¼Œå¹¶ç»§ç»­åœ¨å…¶ä¸Šæ‰§è¡Œå‘½ä»¤ã€‚

ã€‚*as(â€¦)*DOM å…ƒç´ çš„åˆ«åæœ‰ç‚¹ç‹¬ç‰¹ã€‚å½“æ‚¨ä¸ºåœ¨ä½¿ç”¨åˆ«åè°ƒç”¨æ—¶å·²ç»ä» DOM ä¸­åˆ é™¤çš„ DOM å…ƒç´ å‘½åæ—¶ï¼ŒCypress ä¼šè‡ªåŠ¨é‡æ–°æŸ¥è¯¢ DOM ä»¥å†æ¬¡æ‰¾åˆ°è¿™äº›å…ƒç´ ã€‚

> åŠŸèƒ½æµ‹è¯•æ˜¯ä¼Ÿå¤§çš„ï¼Œä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ¯”å¦‚æœåŠ¡äººå‘˜ï¼Œè®©å®ƒå·¥ä½œèµ·æ¥æ˜¯å¾ˆé‡è¦çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ€»æ˜¯å¯ä»¥ä¾é å•å…ƒæµ‹è¯•åŠŸèƒ½ã€‚æœåŠ¡å·¥ä½œè€…ç¯å¢ƒä¸åŒäºæµè§ˆå™¨æˆ– Node.js ç¯å¢ƒã€‚æœåŠ¡-å·¥äºº-æ¨¡æ‹Ÿ npm åŒ…äº§ç”Ÿäº†æ¨¡æ‹ŸæœåŠ¡å·¥äººç¯å¢ƒã€‚é€šè¿‡æ·»åŠ æ­£ç¡®çš„äº‹ä»¶ä¾¦å¬å™¨å’Œé€‚å½“çš„ç¼“å­˜æ£€æŸ¥ï¼Œå¾ˆå®¹æ˜“è¿›è¡Œæµ‹è¯•ã€‚

# å‚è€ƒ

[https://github.com/Bkucera/cypress-plugin-retries](https://github.com/Bkucera/cypress-plugin-retries)

[https://github . com/zackargyle/service-workers/tree/master/packages/service-worker-mock](https://github.com/zackargyle/service-workers/tree/master/packages/service-worker-mock)