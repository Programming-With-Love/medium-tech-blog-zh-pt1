<html>
<head>
<title>Finding optimal data centers (Part-1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">寻找最佳数据中心(第1部分)</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/finding-optimal-data-centers-part-1-64f872d57374?source=collection_archive---------0-----------------------#2020-01-09">https://medium.com/walmartglobaltech/finding-optimal-data-centers-part-1-64f872d57374?source=collection_archive---------0-----------------------#2020-01-09</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/f8e77207023cd59fa17f1c31248a6961.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LcIg-QsdLh56-7ezfqXgSA.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Store attached Data Center in Walmart Intelligent Retail Lab (IRL), Levittown, New York. Source:<a class="ae it" href="https://corporate.walmart.com/photos/walmart-irl-store" rel="noopener ugc nofollow" target="_blank">https://corporate.walmart.com/photos/walmart-irl-store</a></figcaption></figure><h1 id="6b76" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated"><strong class="ak">简介</strong></h1><p id="3e6e" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">数据是新的石油，这是老生常谈。而且，随着如此多的数据生成，有效的数据管理对于公司来说已经变得至关重要，以便利用它来推进其业务。我们需要储备石油。与石油储备和钻井平台类似，存在具有适当基础设施的数据中心，其中可以存储和处理大量数据。</p><p id="dbc3" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">由于几个流程的数字化，沃尔玛在美国的数千家商店每天都在产生海量数据。我们如何存储数据非常重要，以促进我们商店的快速、高效运作，并为停机和灾难恢复情况提供保障。</p><p id="12b4" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">有趣的是，这个问题是由于一个工程需求引起的，在这个工程需求中，架构师正在研究分片策略。<strong class="ju hi">高可用性</strong>和<strong class="ju hi">高性能</strong>是主要关注点。高性能是一个标准，因为随着数据库大小和事务数量的线性增加，查询数据库的响应时间也会增加。高可用性是一个标准，因为我们希望利用我们在多个地区的存在作为灾难恢复战略的一部分。</p><p id="b57f" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">这个问题有两个部分…首先，我们需要决定需要多少个数据中心以及其中需要多少个碎片。其次，我们需要弄清楚哪个商店应该连接到哪个数据中心。在这个博客系列中，我们只关注基于数据中心的方面，而不是每个数据中心有多少碎片。</p><figure class="kw kx ky kz fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kv"><img src="../Images/11c71ae6797f22da75e0a912be4a0b35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0udrNYRTKKz7Wr2k74YUlA.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Heatmap of number of stores in each state</figcaption></figure><p id="2cc5" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">如上图所示，商店分布不均匀。像德克萨斯这样的州拥有大量的商店，而阿拉斯加的商店却很少。当我们打算使用分布在全国各地的几个数据中心来支持这些商店的运营时，商店在巨大地理范围内的不均匀分布给我们带来了有趣的问题。</p><p id="78ba" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">本博客的内容如下:</p><ol class=""><li id="6a48" class="la lb hh ju b jv kq jz kr kd lc kh ld kl le kp lf lg lh li bi translated">导言(上文)</li><li id="25b7" class="la lb hh ju b jv lj jz lk kd ll kh lm kl ln kp lf lg lh li bi translated">问题理解</li><li id="acdf" class="la lb hh ju b jv lj jz lk kd ll kh lm kl ln kp lf lg lh li bi translated">将业务需求映射到文献中的标准问题</li><li id="7ee7" class="la lb hh ju b jv lj jz lk kd ll kh lm kl ln kp lf lg lh li bi translated">解决方法</li><li id="6680" class="la lb hh ju b jv lj jz lk kd ll kh lm kl ln kp lf lg lh li bi translated">问题的变体</li><li id="8222" class="la lb hh ju b jv lj jz lk kd ll kh lm kl ln kp lf lg lh li bi translated">结论</li></ol><h1 id="2221" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated"><strong class="ak">问题理解:</strong></h1><p id="7dba" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">如果我们说数据中心由云平台合作伙伴(即:关于数据中心的所有详细信息，如位置、延迟等。是由该合作伙伴提供的)，那么问题可以总结为:给定数据中心的数量<em class="lo"> m </em>和商店的数量<em class="lo"> n </em>，我们必须找到</p><p id="3063" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated"><strong class="ju hi">I .</strong><em class="lo">k</em>m中数据中心的最佳数量</p><p id="27bf" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated"><strong class="ju hi">二。</strong>将商店分配到数据中心</p><p id="64bc" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">这里的关键词是<strong class="ju hi">优</strong>。你如何定义最优？这是这项任务中最重要的部分，对于我们的情况，将在本博客后面的解决方案部分进行解释。</p><h1 id="045b" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated"><strong class="ak">映射问题到标准问题:</strong></h1><p id="6e00" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">眼前的问题非常接近文献中的<a class="ae it" href="https://en.wikipedia.org/wiki/Generalized_assignment_problem" rel="noopener ugc nofollow" target="_blank">广义指派问题(GAP) </a>。这是一个经典的组合优化问题，是NP难的。让我们把它数学化，</p><figure class="kw kx ky kz fd ii er es paragraph-image"><div class="er es lp"><img src="../Images/68576a202db70a461a906d9364889c85.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*D6NeDG1UEh0gnivj4gprEA.png"/></div></figure><p id="da65" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">现在让我们把我们的具体问题与GAP相比较。目标函数中的<em class="lo"> p_ij </em>是将<em class="lo"> store_j </em>分配给<em class="lo"> data-center_i </em>所获得的利润。如上所述，如何找到<em class="lo"> p_ij </em>是最关键的部分，在求解方法中讨论。每个商店只能分配给一个数据中心，这是上述等式中提到的第二个约束。每个数据中心/碎片都有自己的限制，因此，<em class="lo"> w_ij </em>定义了<em class="lo"> store_j </em>消耗<em class="lo"> data-center_i </em>多少资源。</p><h1 id="e969" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated"><strong class="ak">解决方法:</strong></h1><p id="dffc" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">这个指派问题的解决方案是一个组合爆炸。给定，<em class="lo"> m个</em>数据中心和<em class="lo"> n个</em>门店的可能组合数分别是<em class="lo"> m^n </em>。因此，如果你不使用任何试探法，你就要自担风险。</p><p id="d0e6" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">解决这个问题时需要考虑的一些重要事项是:</p><p id="74a0" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">为一个数据中心分配太多商店会影响其性能</p><p id="d996" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">分配太少会导致数据中心利用率不足</p><p id="ad20" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">单位时间内事务数量的增加，数据量将呈指数级增长，因此查询数据的响应时间也随之增加</p><p id="cacf" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">将分配给一个数据中心的商店转移到另一个数据中心的成本非常高。</p><blockquote class="lq lr ls"><p id="9b1a" class="js jt lo ju b jv kq jx jy jz kr kb kc lt ks kf kg lu kt kj kk lv ku kn ko kp ha bi translated">因此，将最理想的数据中心分配给具有强大底层逻辑并辅以数据驱动方法的商店至关重要，否则将会给组织造成巨大损失。</p></blockquote><p id="ad3d" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">解决这个问题所需的一些输入是:</p><ol class=""><li id="5353" class="la lb hh ju b jv kq jz kr kd lc kh ld kl le kp lf lg lh li bi translated">商店的位置(纬度、经度)</li><li id="f137" class="la lb hh ju b jv lj jz lk kd ll kh lm kl ln kp lf lg lh li bi translated">数据中心的位置(纬度、经度)</li><li id="b5c4" class="la lb hh ju b jv lj jz lk kd ll kh lm kl ln kp lf lg lh li bi translated">数据中心的数据库容量</li><li id="2223" class="la lb hh ju b jv lj jz lk kd ll kh lm kl ln kp lf lg lh li bi translated">将商店连接到数据中心的网络带宽和峰值带宽</li><li id="7d47" class="la lb hh ju b jv lj jz lk kd ll kh lm kl ln kp lf lg lh li bi translated">获得数据中心的成本</li><li id="be8d" class="la lb hh ju b jv lj jz lk kd ll kh lm kl ln kp lf lg lh li bi translated">存储的传入和传出数据量</li></ol><p id="5a31" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">对于最坏情况的分析，我们外推生成的数据，同时降低数据库容量。</p><p id="397c" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">如前所述，目标函数是最关键的部分。我们将此视为多目标优化问题。需要优化的各种目标有:</p><ol class=""><li id="d454" class="la lb hh ju b jv kq jz kr kd lc kh ld kl le kp lf lg lh li bi translated">使用方差/标准差最大化数据中心的平衡。使用容量利用率和带宽利用率的偏差</li><li id="d85b" class="la lb hh ju b jv lj jz lk kd ll kh lm kl ln kp lf lg lh li bi translated">将距离作为代理，最大限度地减少网络延迟(在这里，这意味着距离越大，网络延迟越大</li><li id="87f1" class="la lb hh ju b jv lj jz lk kd ll kh lm kl ln kp lf lg lh li bi translated">最大限度地降低成本(基础设施和年度成本)</li></ol><p id="93e2" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">经典多目标优化问题的解决方案可以使用不同的技术来获得，主要是使用线性/非线性规划或使用生物启发的多目标优化方法，如遗传规划和粒子群优化。一方面，线性/非线性规划设置中的加权目标将给出单一解，而另一方面，适当的多目标方法将给出帕累托前沿。然后我们可以在帕累托前沿选择一个最优解。基础设施成本在优化过程中的作用较小，但却是企业必须决定数据中心数量的最重要因素之一。</p><p id="daaa" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">此外，初始解是优化问题最关键的事情之一。它减少了许多倍的计算，因此，是这个解决方案的核心。Rest all只是运行带有一些参数调整的求解器。例如，在遗传编程中，需要调整的一些参数是突变率、突变方向、交叉概率、惩罚、容差、帕累托分数等。这方面的更多内容将在第2部分中讨论。在生物优化中，一次又一次的事实证明，初始解是最关键的。这里，我们使用基于业务启发的两遍算法来提供接近最优的初始解决方案，并且可以作为起始点。最后，为决策者提供了一些评价和比较解决方案的指标，它们是</p><ol class=""><li id="ae8a" class="la lb hh ju b jv kq jz kr kd lc kh ld kl le kp lf lg lh li bi translated">每个分片/数据中心的净负载</li><li id="57be" class="la lb hh ju b jv lj jz lk kd ll kh lm kl ln kp lf lg lh li bi translated">每个碎片/数据中心的净距离</li><li id="cdb8" class="la lb hh ju b jv lj jz lk kd ll kh lm kl ln kp lf lg lh li bi translated">每个分片/数据中心的商店净数量</li><li id="db3b" class="la lb hh ju b jv lj jz lk kd ll kh lm kl ln kp lf lg lh li bi translated">平衡参数</li><li id="c281" class="la lb hh ju b jv lj jz lk kd ll kh lm kl ln kp lf lg lh li bi translated">生产能力的利用</li><li id="6868" class="la lb hh ju b jv lj jz lk kd ll kh lm kl ln kp lf lg lh li bi translated">基础设施成本和年度成本</li><li id="0e64" class="la lb hh ju b jv lj jz lk kd ll kh lm kl ln kp lf lg lh li bi translated">更多</li></ol><h2 id="5d29" class="lw iv hh bd iw lx ly lz ja ma mb mc je kd md me ji kh mf mg jm kl mh mi jq mj bi translated">初始解决方法</h2><p id="33d5" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">让我们考虑一个3个数据中心的例子。在第一轮中，商店被分配到最近的数据中心。负载分布不均匀(东:南:西::<strong class="ju hi"> 4.3:2.1:1 </strong>)，并且严重偏向美国东部数据中心，因为商店数量更多，商店密度更大。</p><p id="dcad" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">因此，在第二遍中，确定每个商店的第二最近的数据中心，并且将两个最近的数据中心之间的距离在容限内的商店重新分配到最佳数据中心，以改善负载平衡(东:南:西::<strong class="ju hi"> 2.4:2.4:1 </strong>)。</p><p id="b9fc" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">例如，两次通过后的分配比较如下图所示:</p><figure class="kw kx ky kz fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mk"><img src="../Images/456c56357e8294e7be215afcac617d52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3H_g7l-zRkNVYL1RkIRTAw.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Comparison of store to data center allocation at different stages</figcaption></figure><p id="52da" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">这里可以看到，许多绿色商店已经变成红色，表示它们现在被分配到中南部数据中心，一些红色商店已经变成黑色。</p><p id="1833" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">对于上面的解决方案实例，</p><ul class=""><li id="f69e" class="la lb hh ju b jv kq jz kr kd lc kh ld kl le kp ml lg lh li bi translated">负荷分配比(美国东部:美国南部:美国西部)——<strong class="ju hi">2.4:2.4:1</strong></li><li id="2333" class="la lb hh ju b jv lj jz lk kd ll kh lm kl ln kp ml lg lh li bi translated">商店和数据中心之间的平均距离— <strong class="ju hi"> 519英里</strong></li><li id="f63d" class="la lb hh ju b jv lj jz lk kd ll kh lm kl ln kp ml lg lh li bi translated">最少保留天数— <strong class="ju hi"> 454 </strong></li><li id="f2c5" class="la lb hh ju b jv lj jz lk kd ll kh lm kl ln kp ml lg lh li bi translated">最大容量利用率— <strong class="ju hi"> 8% </strong></li><li id="b87f" class="la lb hh ju b jv lj jz lk kd ll kh lm kl ln kp ml lg lh li bi">…</li></ul><p id="01fc" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">在下面的gif图像中可以看到这些分配如何根据数据中心的数量而变化的预览:</p><figure class="kw kx ky kz fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mm"><img src="../Images/202d6dce949f2acd10cd1284b6fa653f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*XpTvx-ByhzekSuQ-z56Ydg.gif"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Change in allocations with change in number of data centers and algorithm pass</figcaption></figure><h1 id="643c" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated"><strong class="ak">问题的变体:</strong></h1><p id="ac74" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">在美国寻找最佳的数据中心位置，而不是像上面那样有预定义的位置，可能有很大的搜索空间，并且需要以完全不同的方式来处理，包括对自然灾害的适应性、安全性、合规性等。也是。这将帮助我们决定在哪里建立数据中心和可接受的商店故障转移机制。虽然，一个有趣的问题，它有更大的计算爆炸。我相信一些CDN提供公司已经在这么做了。</p><p id="c3c1" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">另一个有趣的变体是一个商店连接到一个以上的数据中心，有一个最大值，以实现更高的可用性。除了修改一个约束条件外，问题的表述保持不变。</p><h1 id="0220" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated"><strong class="ak">结论:</strong></h1><p id="74c1" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">在第1部分中，我们研究了问题的背景和表述，问题的大小和解决方法。在这里，我们还定义了对决策至关重要的指标，并达成了初步的解决方案。</p><p id="f244" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">在博客的第2部分，我们将利用初始解决方案和已定义的指标来研究使用多目标优化获得的解决方案。敬请期待！</p><h1 id="2b32" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">致谢:</h1><p id="bf5a" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">整个工作是和Praneeth Doguparthy一起进行的。</p></div></div>    
</body>
</html>