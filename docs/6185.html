<html>
<head>
<title>A one year PWA retrospective</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为期一年的PWA回顾展</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/a-one-year-pwa-retrospective-f4a2f4129e05?source=collection_archive---------0-----------------------#2018-07-20">https://medium.com/pinterest-engineering/a-one-year-pwa-retrospective-f4a2f4129e05?source=collection_archive---------0-----------------------#2018-07-20</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="c515" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jc" href="https://www.pinterest.com/zackargyle/" rel="noopener ugc nofollow" target="_blank"> Zack Argyle </a> |工程经理，核心经验</p><p id="474a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">构建“渐进式Web应用程序”(PWA)的想法并不新鲜，但随着服务工作者等关键技术的出现，它的定义已经发生了变化。现在终于有可能在手机浏览器中构建出色的体验了。作为早期采用者可能会令人害怕，所以我们想分享一下我们构建世界上最大的渐进式网络应用之一的经历。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/efa86be52cd9a1d5b7beb7e64a1b8e53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iLr2M7YkD_C05hWY"/></div></div></figure><p id="781e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">三年前，我们在移动浏览器上查看我们网站的状态，并抱怨明显的不足。指标显示，我们的原生应用的参与率提高了80%，因此我们决定全力以赴开发iOS和Android应用。尽管我们的应用下载量大幅增加，但也有一些明显的负面影响。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jp"><img src="../Images/a086422c9ab5ccee1166a86c53d31403.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6zVRthZO-ShBvcwS"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jq"><img src="../Images/a18180aff83a6f295540d626fcdcb456.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aZnfgWcUlf7vuExT"/></div></div></figure><p id="3800" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">艾米莉。欧文。我们想借此机会向您道歉。你是对的。太可怕了。</p><p id="66b6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一年前(2017年7月)，我们召集了一个团队，将我们的移动网站从零开始重写为PWA。这是几年的对话、几个月的指标调查和一个大假设的高潮:移动网络可以像本地应用一样好。结果相当…有趣。</p><h1 id="3133" class="jr js hh bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated"><strong class="ak">我们为什么要这么做？</strong></h1><p id="4801" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">我们如此大力投资移动网络有两个主要原因。首先是我们的用户。我们在低带宽环境和有限数据计划中的移动网络体验并不好。由于超过一半的Pinners位于美国以外，建立一流的移动网站是一个机会，可以让Pinterest在全球范围内更容易访问，并最终改善每个人的体验。</p><p id="b00f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第二个原因是数据驱动的。因为体验不太好，登陆我们移动网站的未认证用户中只有很小一部分安装了应用程序，注册或登录了。这不是一个好的漏斗。即使我们更看重本地应用用户的参与度，而不是移动网络用户，这也不是任何人都努力追求的转化率。我们认为我们可以做得更好。</p><h1 id="2378" class="jr js hh bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated"><strong class="ak">我们是怎么做到的？</strong></h1><p id="0e60" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">2017年7月，我们组建了一个团队，将我们网络平台和增长团队的工程师结合在一起。在内部，我们称之为“Project Duplo”，灵感来自简单性和可访问性。当时，移动网站占我们总注册量的不到10%(举例来说，桌面网站占了5倍)。</p><h2 id="2af2" class="ku js hh bd jt kv kw kx jx ky kz la kb ip lb lc kf it ld le kj ix lf lg kn lh bi translated"><strong class="ak">时间线</strong></h2><p id="34d7" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">2017年7月:开始“Project Duplo”<br/>2017年8月:针对登录用户百分比推出新的移动网站<br/>2017年9月:针对登录用户发布新的移动网站<br/>2018年1月:针对注销用户百分比推出新的移动网站<br/>2018年2月:针对注销用户发布新的移动网站</p><p id="e99b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们能够在三个月内创建并发布全功能重写的部分原因是由于我们的开源UI库，<a class="ae jc" href="https://github.com/pinterest/gestalt" rel="noopener ugc nofollow" target="_blank"> Gestalt </a>。在Pinterest，我们使用React 16进行所有的web开发。格式塔的组件套件是为了包含我们的设计语言而构建的，这使得创建一致的漂亮页面变得非常容易，而不用担心CSS。我们创建了一套特定于移动网站的布局组件，用于在整个网站中创建间距一致的页面。FullWidth脱离PageContainer的默认边界，page container脱离FixedHeader的边界。这种组合布局导致了快速、无bug的UI开发。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es li"><img src="../Images/57ddf32424b047f9395b3e172de613dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7kDw8gfZmqhM3MUYgEMUlw.png"/></div></div></figure><p id="3b77" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">除了格式塔，我们还使用了<a class="ae jc" href="https://github.com/facebook/react" rel="noopener ugc nofollow" target="_blank"> react </a>、<a class="ae jc" href="https://github.com/ReactTraining/react-router" rel="noopener ugc nofollow" target="_blank"> react-router v4 </a>、<a class="ae jc" href="https://github.com/reactjs/redux" rel="noopener ugc nofollow" target="_blank"> redux </a>、<a class="ae jc" href="https://github.com/gaearon/redux-thunk" rel="noopener ugc nofollow" target="_blank"> redux-thunk </a>、<a class="ae jc" href="https://github.com/reactjs/react-redux" rel="noopener ugc nofollow" target="_blank"> react-redux </a>、<a class="ae jc" href="https://github.com/paularmstrong/normalizr" rel="noopener ugc nofollow" target="_blank"> normalizr </a>、<a class="ae jc" href="https://github.com/reactjs/reselect" rel="noopener ugc nofollow" target="_blank"> reselect </a>、<a class="ae jc" href="https://github.com/facebook/flow" rel="noopener ugc nofollow" target="_blank"> flow </a>和<a class="ae jc" href="https://github.com/prettier/prettier" rel="noopener ugc nofollow" target="_blank">beauty</a>。</p><h1 id="d6bc" class="jr js hh bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">我们是如何快速完成的！</h1><p id="9e4c" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">绩效被融入到目标和过程中，因为它与参与度紧密相关，并且在移动连接中非常敏感。事实上，我们的主页Javascript负载从大约490kb增加到大约190kb。默认情况下，这是通过路由级别的代码分割实现的，鼓励使用<loader>组件进行组件级别的代码分割。我们的客户端路由器内置了一个易于使用的路由预加载系统，这为初始页面加载和客户端路由更改提供了快速体验。关于我们如何快速实现的更多细节，请查看我们与Addy Osmani进行的案例研究。</loader></p><p id="a939" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一年后，我们的移动web代码库中有大约600个Javascript文件，而这一切只需要一个错误选择的导入就可以让你的包膨胀起来。保持性能真的很难！我们在*.pinterest.com的子网站之间广泛共享代码，因此我们制定了一些措施来确保移动网络的依赖关系保持干净。首先是一组报告构建规模的图表，当捆绑包超过允许的增长率时会发出警报。第二个是一个定制的eslint规则，它不允许从我们知道的依赖度很高的文件和目录中导入，这会使包膨胀。例如，移动web不能从桌面web代码库导入，但是我们有一个可以在两者之间共享的“安全”包目录。仍然有工作要做，但是我们为我们的现状感到骄傲。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lj"><img src="../Images/9ceaee2dcffa60e205cb577ce57d6001.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9nNRrP4QT4EMg_Qp"/></div></div></figure><p id="0d2c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">虽然案例研究主要涉及页面加载，但我们也非常关心快速、类似本机的浏览体验。客户端性能的最大驱动力是我们的标准化redux存储，它允许近乎即时的路线更改。由于模型只有一个真实的来源，比如一个Pin或一个用户，所以在等待加载更多信息的时候显示您所拥有的信息变得很简单。例如，如果您浏览Pin的提要，我们会有关于每个Pin的信息。当你点击一个，它会带你到一个详细的视图。因为Pin数据是规范化的，所以我们可以很容易地从提要视图中显示有限的细节，直到从服务器中获取完整的细节。当您点击用户头像时，我们会显示该用户的个人资料以及我们所拥有的信息，同时我们会获取完整的用户详细信息。如果您对我们的状态结构或我们的动作流感兴趣，redux devtools扩展在我们的移动网站的生产中启用。</p><p id="8cab" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">新网站的核心是我们试图建立一个真正进步的网络应用(PWA)。我们支持应用外壳，添加到主屏幕，推送通知和资产缓存。服务人员缓存一个服务器渲染的、特定于用户的应用程序外壳，用于后续页面加载和创建近乎即时的页面刷新。我们很高兴苹果正在Safari中建立对服务人员的支持，这样所有用户都可以拥有最好的“类似本地”的体验。</p><p id="76a2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">而没有“夜间模式”会是怎样的“原生”体验？前往您的用户设置并尝试一下吧！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lk"><img src="../Images/5f46f7d4a8753c1b92a8a0f5e40cd3ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:862/0*OQU70fZ9HlfuJYSE"/></div></figure><h1 id="eed1" class="jr js hh bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated"><strong class="ak">判决结果</strong></h1><p id="9f35" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">现在是你们期待已久的部分:数字。总体而言，移动网络的每周活跃用户同比增长了103%，其中巴西增长了156%，印度增长了312%。在参与方面，会话长度增加了296 %,看到的图钉数量增加了401 %,人们将图钉保存到板上的可能性增加了295%。这些本身就很了不起，但增长前沿才是真正的亮点。与去年同期相比，登录人数增加了370%，新注册人数增加了843%。自从我们发布了新的体验，移动网络已经成为新注册的顶级平台。有趣的是，在完全发布后不到6个月的时间里，我们已经有80万每周用户像使用本地应用程序一样使用我们的PWA(从他们的主屏幕)。</p><p id="5ea8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">回顾我们开始重建移动网络以来的整整一年，我们为我们为用户创造的体验感到无比自豪。它不仅速度明显更快，而且还是我们第一个支持从右到左语言和“夜间模式”的平台投资全功能PWA已经超出了我们的预期。我们才刚刚开始。</p><p id="9523" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">非常感谢参与重写的工程师和产品经理:贝基·斯通曼、本·芬克、延、郎天朗、维多利亚·邝、卢娜·阮、艾里斯·王和伊马德·埃利亚菲。</p></div></div>    
</body>
</html>