<html>
<head>
<title>Install Docker and Kubernetes on Oracle Linux behind a proxy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Docker和Kubernetes安装在Oracle Linux上的代理后面</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/install-docker-and-kubernetes-on-oracle-linux-behind-a-proxy-aa73a8977b6f?source=collection_archive---------0-----------------------#2018-11-14">https://medium.com/oracledevs/install-docker-and-kubernetes-on-oracle-linux-behind-a-proxy-aa73a8977b6f?source=collection_archive---------0-----------------------#2018-11-14</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/7333aa8ceb4eaae12050c6ef50ab9c6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_v2NIwyYVCzC7xF4"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo by <a class="ae it" href="https://unsplash.com/@chuttersnap?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">chuttersnap</a> on <a class="ae it" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="5796" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">本文将带您了解在运行Oracle Linux (OL) 7.x的裸机或虚拟机上安装和配置Docker和Kubernetes所需的步骤，该虚拟机位于企业<em class="js">代理</em>之后。</p><h1 id="5f0c" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">先决条件</h1><p id="d19c" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">确保您满足以下先决条件:</p><ul class=""><li id="924e" class="kw kx hh iw b ix iy jb jc jf ky jj kz jn la jr lb lc ld le bi translated">OL 7.x使用Unbreakable Enterprise Kernel Release 4(UEK R4)或更高版本</li><li id="23d8" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">yum被配置为与您的公司代理对话。为了快速参考，您可以编辑“/etc/yum.conf”并添加或更新代理条目:</li></ul><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="f391" class="lt ju hh lp b fi lu lv l lw lx">proxy=http://&lt;proxy-host&gt;:&lt;proxy-port&gt;</span></pre><h1 id="9154" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">安装Docker引擎</h1><p id="6473" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">编辑“/etc/yum . repos . d/public-yum-ol7 . repo”并启用“ol7_addons”频道。这是将“ol7_addons”部分下的“enabled”选项设置为“1”的问题。接下来，运行yum来安装最新的docker引擎，该引擎在这个通道上可用:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="faf4" class="lt ju hh lp b fi lu lv l lw lx">yum install docker-engine</span></pre><h1 id="beef" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">配置代理</h1><p id="6e3b" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">创建文件“/etc/systemd/system/docker . service . d/http-proxy . conf”并添加以下内容:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="e5cd" class="lt ju hh lp b fi lu lv l lw lx">[Service]<br/>Environment="HTTP_PROXY=&lt;proxy-host&gt;:&lt;proxy-port&gt;"<br/>Environment="HTTPS_PROXY=&lt;proxy-host&gt;:&lt;proxy-port&gt;"<br/>Environment="NO_PROXY=localhost,127.0.0.1,&lt;your-no-proxy-entries&gt;"</span></pre><p id="d01a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">确保用适合您环境的值替换“<proxy-host>”、“<proxy-port>”和“<your-no-proxy-entries>”。</your-no-proxy-entries></proxy-port></proxy-host></p><p id="a985" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在运行以下命令来启动docker引擎，并确保它在重新启动时重新启动:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="1453" class="lt ju hh lp b fi lu lv l lw lx">systemctl daemon-reload<br/>systemctl enable docker<br/>systemctl start docker</span></pre><p id="f072" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">您可以通过运行以下命令来检查docker的状态和版本:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="ee6c" class="lt ju hh lp b fi lu lv l lw lx">systemctl status docker<br/>docker version</span></pre><p id="f65c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">使用web浏览器，登录位于https://container-registry.oracle.com<a class="ae it" href="https://container-registry.oracle.com" rel="noopener ugc nofollow" target="_blank">的Oracle Container Registry网站</a>。导航到容器服务类别并接受许可协议。</p><h1 id="8fc7" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">安装Kubernetes主节点</h1><p id="7a86" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">确保“ol7_addons”通道已启用(请参考上面的安装docker引擎部分)。运行yum安装“kubeadm”:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="7bbe" class="lt ju hh lp b fi lu lv l lw lx">yum install kubeadm</span></pre><p id="8ac1" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在使用Docker CLI登录到Oracle容器注册中心:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="7cf1" class="lt ju hh lp b fi lu lv l lw lx">docker login container-registry.oracle.com/kubernetes</span></pre><p id="cbe9" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">以root用户身份运行以下命令，将sbin添加到PATH变量中:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="7c8a" class="lt ju hh lp b fi lu lv l lw lx">export PATH=$PATH:/sbin</span></pre><p id="df96" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">以root用户身份运行以下命令来添加端口转发规则:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="775b" class="lt ju hh lp b fi lu lv l lw lx">iptables -P FORWARD ACCEPT</span></pre><p id="6557" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果您正在运行“防火墙”服务，请以root用户身份运行以下命令:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="1a76" class="lt ju hh lp b fi lu lv l lw lx">firewall-cmd --add-masquerade --permanent<br/>firewall-cmd --add-port=10250/tcp --permanent<br/>firewall-cmd --add-port=8472/udp --permanent<br/>firewall-cmd --add-port=6443/tcp --permanent</span></pre><p id="9e0a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">最后，以root用户身份运行以下命令，将主机配置为主节点:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="0888" class="lt ju hh lp b fi lu lv l lw lx">kubeadm-setup.sh up</span></pre><p id="5ba7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果有任何问题，上面的命令将通知您可能的补救措施。在成功运行之后，该命令将打印下一步，即让普通用户准备运行“kubectl”命令，以及在kubernetes集群中充当工作节点的其他主机上运行的命令。记下稍后将用于将工作节点加入集群的令牌和哈希。</p><h1 id="a11a" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">安装Kubernetes工作节点</h1><p id="7462" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">在每台应该设置为工作节点的额外OL计算机上，重复设置主节点时执行的所有步骤，最后一步除外。</p><p id="7534" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">以root用户身份运行kubeadm-setup join命令，而不是从上面运行最后一步:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="0f2f" class="lt ju hh lp b fi lu lv l lw lx">kubeadm-setup.sh join --token &lt;token&gt; &lt;master-host&gt;:6443 \<br/>    --discovery-token-ca-cert-hash &lt;hash&gt;</span></pre><p id="0174" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">配置工作节点后，您可以返回到主节点并运行以下命令来查看所有节点:</p><pre class="lk ll lm ln fd lo lp lq lr aw ls bi"><span id="f483" class="lt ju hh lp b fi lu lv l lw lx">kubectl get nodes</span></pre><p id="9cdd" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">您已经准备好开始部署服务并使用Kubernetes。</p><p id="0e1a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">有关更多信息和深入文档，请参考以下链接:</p><ul class=""><li id="7de4" class="kw kx hh iw b ix iy jb jc jf ky jj kz jn la jr lb lc ld le bi translated"><a class="ae it" href="https://docs.oracle.com/cd/E52668_01/E87205/html/index.html" rel="noopener ugc nofollow" target="_blank"> Docker </a>的Oracle容器运行时</li><li id="65ec" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">面向<a class="ae it" href="https://docs.oracle.com/cd/E52668_01/E88884/html/" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>的Oracle容器服务</li></ul></div></div>    
</body>
</html>