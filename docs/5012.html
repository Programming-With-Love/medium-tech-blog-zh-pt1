<html>
<head>
<title>Common Mendix bugs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">常见的Mendix错误</h1>
<blockquote>原文：<a href="https://medium.com/mendix/common-mendix-bugs-64bfe356c76c?source=collection_archive---------3-----------------------#2020-02-09">https://medium.com/mendix/common-mendix-bugs-64bfe356c76c?source=collection_archive---------3-----------------------#2020-02-09</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/784d998fed505a06c609a4540b6d67cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZkagDiUtqq-fOH9hNcSU4A.png"/></div></div></figure><p id="0fb8" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">作为一名开发人员，我很高兴地说，开发人员非常重视他们(我们)自己。我们为自己的工作感到自豪，并认为自己非常擅长。因此，我们有这样的想法，如果奇迹般地出现了一个bug，它一定是在一段非常复杂的代码中。然而，研究表明，大多数bug的起源要卑微得多。</p><p id="889c" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">错误的主要来源之一是…等等… <strong class="bd jz">复制粘贴</strong>代码。例如，当复制一段代码并打算在另一个地方稍微修改它时，这就引入了错误。由于分心或其他原因，修改(或其一部分)没有完成。更多的例子，我推荐这个关于<a class="ae ka" href="https://www.viva64.com/en/b/0260/" rel="noopener ugc nofollow" target="_blank">最后一行效果</a>的精彩帖子。</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div class="fe ff kb"><img src="../Images/074ab6fd8f71fb8f398752f7c2fa6bca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/0*t1HeaQcCByFh-1ds"/></div></figure><p id="e3b4" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">错误的另一个主要来源是<strong class="bd jz">过度自信</strong>以及相应的缺乏关注。在这个场景中，开发人员正在实现一些琐碎的算法，给人一种“这太简单了，我以前已经做过很多次了”的感觉，这导致了愚蠢的错误。点击查看一些真实的例子<a class="ae ka" href="http://findbugs.blogspot.com/2007/05/round-and-round-we-go-netbeans-wtf.html" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="8b37" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">在这篇博文的下一部分，我将分享一些包含错误的Mendix微流和表达式的例子。这些错误的例子来自我参与过的真实的Mendix项目(为了使它们更具说明性，做了一些小的简化)。为了使它更有趣，我鼓励你在检查答案之前自己找出错误(答案在底部)。</p><p id="d732" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated"><strong class="bd jz">附件A:获得或创造</strong></p><p id="0c3a" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">啊，我的最爱。每当需要延迟加载时，这是首选的方法。检查数据库中是否存在某个对象，如果不存在，则创建它。因为在Mendix中不可能重新分配对象变量，所以我经常为此使用一个单独的微流。如此简单，如此琐碎。只有三个动作，还会有什么问题呢？你能发现这个错误吗？</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kg"><img src="../Images/767fcad02b66a52fb8c5cdd63cbbb1d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qCiK5yD0xxoEQrws"/></div></div></figure><p id="82b5" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated"><strong class="bd jz">附件B:丢失开关案例</strong></p><p id="b175" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">由于Mendix表达式中缺少switch case，我经常编写if-else if语句链。看看你能否找出下面表达式中的错误。</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kh"><img src="../Images/db2c63a576dc2d1e72de03f4662a4e3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CYRy1lADyeVkTUwbpyXLAg.png"/></div></div></figure><p id="b8b2" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated"><strong class="bd jz">展示C:让空字符串比较再次变得伟大</strong></p><p id="04e6" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">每个Mendix开发人员<a class="ae ka" href="https://forum.mendixcloud.com/link/questions/1057" rel="noopener ugc nofollow" target="_blank">都知道检查空字符串</a>需要检查空字符串值即<code class="eh ki kj kk kl b">''</code>和<code class="eh ki kj kk kl b">empty</code>即<code class="eh ki kj kk kl b">null</code>变量/成员。这通常与<code class="eh ki kj kk kl b">trim</code>相结合，要求有意义的用户输入。这是每个开发人员每天都要做的事情。所以下面的表达式<strong class="bd jz"> (1) </strong> : <code class="eh ki kj kk kl b">trim($Str) != ''and $Str != empty</code>应该没有错误</p><p id="6b47" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">或者这个<strong class="bd jz"> (2) </strong> : <code class="eh ki kj kk kl b">$SignupHelper/AddressCityCode != empty and trim($SignupHelper/AddressCountryCode) != ''</code></p><p id="a75d" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">如果这太容易了，试试下面这个<strong class="bd jz"> (3) </strong> : <code class="eh ki kj kk kl b">$Str = empty and trim($Str) = ''</code></p><p id="6bc5" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated"><strong class="bd jz">展示D:可怕的空指针异常</strong></p><p id="0c2b" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">根据java文档，当应用程序试图在需要值的情况下使用空值时，会引发空指针异常。有了这个提示，您能发现下面微流中的错误吗？</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff km"><img src="../Images/89d9688e6ff338c73f99d266c46839e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sSK9hqy1EVtTMDr6"/></div></div></figure><p id="ee98" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">示例到此结束(答案如下)</p><p id="5926" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated"><em class="kn">简单总结一下</em>每个开发者在开发的时候都会犯错误。这一点很清楚。通过这篇文章，我希望让你相信，这些错误中的许多确实可以被一台机器检测出来，而无需了解正在被审查的应用程序的商业案例。</p><h2 id="6aeb" class="ko kp hu bd kq kr ks kt ku kv kw kx ky jm kz la lb jq lc ld le ju lf lg lh li dt translated">Mendix的自动代码审查程序</h2><p id="c6bb" class="pw-post-body-paragraph jc jd hu bd b je lj jg jh ji lk jk jl jm ll jo jp jq lm js jt ju ln jw jx jy hn dt translated">Mendix的自动代码审查程序检查100多条不同类别的规则，如<em class="kn">安全性</em>、<em class="kn">性能</em>和<em class="kn">可维护性</em>。还有<a class="ae ka" href="https://sdf-docs.mansystems.com/docs/acr-rules/reliability/" rel="noopener ugc nofollow" target="_blank"> 30 <em class="kn">可靠性</em>规则</a>它们的目标是发现你的应用程序中的bug。例如，这些规则检查:</p><ul class=""><li id="3d21" class="lo lp hu bd b je jf ji jj jm lq jq lr ju ls jy lt lu lv lw dt translated"><a class="ae ka" href="https://sdf-docs.mansystems.com/docs/acr-rules/reliability/identicalreturnvalue/" rel="noopener ugc nofollow" target="_blank">流程的返回表达式应该不同</a>(展示A)</li><li id="fa56" class="lo lp hu bd b je lx ji ly jm lz jq ma ju mb jy lt lu lv lw dt translated"><a class="ae ka" href="https://sdf-docs.mansystems.com/docs/acr-rules/reliability/identicalifelseifcondition/" rel="noopener ugc nofollow" target="_blank">“if/else if”语句链应该有不同的条件</a>(附件B)</li><li id="1b15" class="lo lp hu bd b je lx ji ly jm lz jq ma ju mb jy lt lu lv lw dt translated"><a class="ae ka" href="https://sdf-docs.mansystems.com/docs/acr-rules/reliability/emptystringcheck/" rel="noopener ugc nofollow" target="_blank">应正确检查空钻柱</a>(附件C)</li><li id="39e3" class="lo lp hu bd b je lx ji ly jm lz jq ma ju mb jy lt lu lv lw dt translated"><a class="ae ka" href="https://sdf-docs.mansystems.com/docs/acr-rules/reliability/emptyvariableaction/" rel="noopener ugc nofollow" target="_blank">空变量不应该用在抛出空指针异常的动作中</a>(展示D)</li></ul><p id="8412" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated"><em class="kn">不相信，</em>然后注册一个免费试用版，亲自体验自动化代码审查的威力:<a class="ae ka" href="https://content.mansystems.com/acr-trial-request" rel="noopener ugc nofollow" target="_blank">https://content.mansystems.com/acr-trial-request</a></p></div><div class="ab cl mc md hb me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="hn ho hp hq hr"><p id="4809" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated"><a class="ae ka" href="https://www.notion.so/gajduk/How-can-automated-code-reviews-find-bugs-in-your-Mendix-app-b330e72e19cf45a0a334ada93075bc63" rel="noopener ugc nofollow" target="_blank">最初发表于此。</a></p><h2 id="5c52" class="ko kp hu bd kq kr ks kt ku kv kw kx ky jm kz la lb jq lc ld le ju lf lg lh li dt translated">答案</h2><p id="551d" class="pw-post-body-paragraph jc jd hu bd b je lj jg jh ji lk jk jl jm ll jo jp jq lm js jt ju ln jw jx jy hn dt translated"><strong class="bd jz">附件A:获取或创建</strong></p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div class="fe ff mj"><img src="../Images/f4e8d840c052a5febf0fca90a9dee8af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/0*hPmmw11XzXgHu4LQ"/></div></figure><p id="bc34" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">原来新创建的实体没有返回。</p><p id="0846" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated"><strong class="bd jz">证物B: </strong> <strong class="bd jz">丢失开关案例</strong></p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mk"><img src="../Images/da5818e5665805aba284c9f0c7ddaaaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mdt_RUJiGjy8-mAv"/></div></div></figure><p id="9f21" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">这是复制粘贴错误的一个很好的例子。没有人愿意键入的长变量名加上重复的模式。</p><p id="ec71" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated"><strong class="bd jz">展示C:让空字符串比较再次变得伟大</strong></p><p id="3af7" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated"><strong class="bd jz">(1)</strong><code class="eh ki kj kk kl b">trim</code>在检查变量是否为<code class="eh ki kj kk kl b">empty</code>之前完成。如果变量确实是<code class="eh ki kj kk kl b">empty</code>，对<code class="eh ki kj kk kl b">empty</code>的检查甚至不会被触发，因为<code class="eh ki kj kk kl b">trim</code>将失败，并出现空指针异常😱。</p><p id="24c3" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated"><strong class="bd jz"> (2) </strong>一个不同的变量被比较为空，而不是被修剪的变量。虽然这在技术上是正确的代码，不会导致任何错误，但这很可能不是开发人员想要的。</p><p id="a40d" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated"><strong class="bd jz"> (3) </strong>当比较为空时有三个运算符要写，每个有两个选项:</p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div class="fe ff ml"><img src="../Images/92faa7ebdc1907f90f51626098328cf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:594/0*hTLH3NHq4ODIjDd3"/></div></figure><p id="8fc1" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">这导致了8种可能的组合，其中只有两种是正确的:<code class="eh ki kj kk kl b"><strong class="bd jz">if $A != empty and trim($A) != '' then $A else 'empty'</strong></code> <strong class="bd jz">、</strong>和<code class="eh ki kj kk kl b"><strong class="bd jz">if $A = empty or trim($A) = '' then 'empty' else $A</strong></code> <strong class="bd jz">。</strong></p><p id="59d2" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated"><strong class="bd jz">展示D:可怕的空指针异常</strong></p><figure class="kc kd ke kf fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff mk"><img src="../Images/b01e66353ae5bed540f671002e928327.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PfaZ7-rCwEgckhqz"/></div></div></figure><p id="26c7" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">这是一个严重的错误，因为这个流甚至没有机会做预期的事情。在第一次出现空对象时，错误流将直接导致空指针异常和用户的严重错误，并且可能导致数据库中的<em class="kn">数据损坏。</em></p></div></div>    
</body>
</html>