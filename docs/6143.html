<html>
<head>
<title>Kotlin for grumpy Java developers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">面向脾气暴躁的Java开发人员的Kotlin</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/kotlin-for-grumpy-java-developers-8e90875cb6ab?source=collection_archive---------1-----------------------#2017-07-21">https://medium.com/pinterest-engineering/kotlin-for-grumpy-java-developers-8e90875cb6ab?source=collection_archive---------1-----------------------#2017-07-21</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="d278" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Sha Sha Chu | Android平台技术领先，核心体验</p><p id="7f5a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以你是一个Android开发者。你已经编写Java代码很多年了，你的代码是干净的、可测试的、架构良好的。然后Google在Google I/O上宣布了对Kotlin的官方支持，震惊了开发者世界。突然间，你的团队都在谈论Kotlin，你的午餐谈话充满了诸如“带有接收器的lambdas”、“可空性”和“扩展函数”之类的词汇。你继续埋头写你伟大的Java代码。毕竟没有什么是Kotlin能做而Java做不到的，对吗？但是日复一日，越来越多。kt文件出现在你的代码库中，直到你明白你不能永远呆在你的Java泡泡里——你必须学习Kotlin。不要害怕！因为我曾经像你一样。我可以指导你，坏脾气的Java开发者，通过你的第一行Kotlin。</p><h2 id="340d" class="jc jd hh bd je jf jg jh ji jj jk jl jm ip jn jo jp it jq jr js ix jt ju jv jw bi translated">学习基础知识</h2><p id="ebff" class="pw-post-body-paragraph ie if hh ig b ih jx ij ik il jy in io ip jz ir is it ka iv iw ix kb iz ja jb ha bi translated">好消息是，在进入Kotlin之前，您只需要了解一些基础知识。坏消息是，在你开始之前，你需要学习一些基础知识。幸运的是，因为Kotlin一直在稳步普及，所以有大量的<a class="ae kc" href="https://fabiomsr.github.io/from-java-to-kotlin/index.html" rel="noopener ugc nofollow" target="_blank">资源</a>和<a class="ae kc" href="https://www.youtube.com/watch?v=X1RVYt2QKQE" rel="noopener ugc nofollow" target="_blank">资源</a>用于学习Kotlin的基本语法。当你第一次开始时，试着把注意力集中在非常基本的概念上，比如<code class="du kd ke kf kg b">val</code>和<code class="du kd ke kf kg b">var</code>、<code class="du kd ke kf kg b">Type</code>和<code class="du kd ke kf kg b">Type?</code>之间的区别，以及Java和Kotlin之间的句法差异；包括变量和函数声明之后的类型。</p><h2 id="c0a3" class="jc jd hh bd je jf jg jh ji jj jk jl jm ip jn jo jp it jq jr js ix jt ju jv jw bi translated">Kotlin代码看起来很像Java……这没关系</h2><p id="4088" class="pw-post-body-paragraph ie if hh ig b ih jx ij ik il jy in io ip jz ir is it ka iv iw ix kb iz ja jb ha bi translated">新Kotlin开发人员陷入的一个常见陷阱是直接进入完全惯用的代码，然后不知所措。虽然它的好处之一是简洁，但没有必要将Kotlin文件精简到最少的行数，尤其是如果您是这门语言的新手。</p><p id="922f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">考虑这个完全有效的Kotlin块:</p><pre class="kh ki kj kk fd kl kg km kn aw ko bi"><span id="49d9" class="jc jd hh kg b fi kp kq l kr ks">fun logVideoQuartile(player: VideoPlayer?) {<br/>    if (player == null) {<br/>        return<br/>    }</span><span id="6f75" class="jc jd hh kg b fi kt kq l kr ks">    // playPercentage is a property on VideoPlayer<br/>    val percentComplete: Int = player.playPercentage<br/>    val quartile: Int<br/>    val percentQuartile: Float</span><span id="a578" class="jc jd hh kg b fi kt kq l kr ks">    if (percentComplete &gt;= 0 &amp;&amp; percentComplete &lt; 25) {<br/>        quartile = 0<br/>        percentQuartile = 0f<br/>    } else if (percentComplete &gt;= 25 &amp;&amp; percentComplete &lt; 50) {<br/>        quartile = 1<br/>        percentQuartile = .25f<br/>    } else if (percentComplete &gt;= 50 &amp;&amp; percentComplete &lt; 75) {<br/>        quartile = 2<br/>        percentQuartile = .50f<br/>    } else if (percentComplete &gt;= 75 &amp;&amp; percentComplete &lt; 95) {<br/>        quartile = 3<br/>        percentQuartile = .75f<br/>    } else if (percentComplete &gt;= 95 &amp;&amp; percentComplete &lt; 97) {<br/>        quartile = 3<br/>        percentQuartile = .95f<br/>    } else if (percentComplete &gt;= 97 &amp;&amp; percentComplete &lt; 100) {<br/>        quartile = 3<br/>        percentQuartile =.97f<br/>    } else if (percentComplete == 100) {<br/>        quartile = 4<br/>        percentQuartile = 1f<br/>    } else {<br/>        quartile = -1<br/>        percentQuartile = -1f<br/>    }</span><span id="19d2" class="jc jd hh kg b fi kt kq l kr ks">    println(“Quartile is $quartile and percent quartile is $percentQuartile”)<br/>}</span></pre><p id="bbd8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你会注意到它看起来很像Java代码——没关系！即使您让这段代码保持原样，Kotlin已经在两个方面帮助了您。首先，因为<code class="du kd ke kf kg b">player</code>是一个可空类型，所以您被迫添加一个空检查。第二，由于<code class="du kd ke kf kg b">quartile</code>和<code class="du kd ke kf kg b">percentQuartile</code>被声明为val，您被迫添加<code class="du kd ke kf kg b">else</code> case，它将捕获错误的输入值。</p><h2 id="85d3" class="jc jd hh bd je jf jg jh ji jj jk jl jm ip jn jo jp it jq jr js ix jt ju jv jw bi translated">依靠你的IDE</h2><p id="3574" class="pw-post-body-paragraph ie if hh ig b ih jx ij ik il jy in io ip jz ir is it ka iv iw ix kb iz ja jb ha bi translated">一旦熟悉了Kotlin的基础知识，就可以开始钻研更有趣的语言特性了。因为Kotlin是由IntelliJ(Android Studio基于IntelliJ)的作者编写的，所以它有很好的IDE支持。再次考虑视频四分位数代码，您会注意到IDE在每个if语句下添加了弯弯曲曲的线条:</p><figure class="kh ki kj kk fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es ku"><img src="../Images/5ec45d798791af255241870a839bd7ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aTRv4bYtU1abnnoc."/></div></div></figure><p id="6e43" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您将鼠标悬停在该语句上，将会看到IDE建议您将这些检查转换为范围检查。</p><figure class="kh ki kj kk fd kv er es paragraph-image"><div role="button" tabindex="0" class="kw kx di ky bf kz"><div class="er es lc"><img src="../Images/a58539f94a83191c2904cfceb51ce5aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PXrWriMqm37cVZLf."/></div></div></figure><p id="9118" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您不知道什么是范围检查，但可以使用option+Enter尝试以下建议:</p><figure class="kh ki kj kk fd kv er es paragraph-image"><div class="er es ld"><img src="../Images/fa72fea1be68224af723da50e3396537.png" data-original-src="https://miro.medium.com/v2/resize:fit:896/0*moSVhSQIBDknCJXe."/></div></figure><p id="7500" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">就这样，你学会了一种新的语言特征。您的支票现在应该是这样的:</p><pre class="kh ki kj kk fd kl kg km kn aw ko bi"><span id="4608" class="jc jd hh kg b fi kp kq l kr ks">if (percentComplete in 0..24) {<br/>    quartile = 0<br/>    percentQuartile = 0f<br/>} else if (percentComplete in 25..49) {<br/>    quartile = 1<br/>    percentQuartile = .25f<br/>} else if (percentComplete in 50..74) {<br/>    quartile = 2<br/>    percentQuartile = .50f<br/>} else if (percentComplete in 75..95) {<br/>    quartile = 3<br/>    percentQuartile = .75f<br/>} else if (percentComplete in 95..96) {<br/>    quartile = 3<br/>    percentQuartile = .95f<br/>} else if (percentComplete in 97..99) {<br/>    quartile = 3<br/>    percentQuartile = .97f<br/>} else if (percentComplete == 100) {<br/>    quartile = 4<br/>    percentQuartile = 1f<br/>} else {<br/>    quartile = -1<br/>    percentQuartile = -1f<br/>}</span></pre><p id="77ea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意:功能是完全相同的，但是范围符号更容易阅读，也更接近于开发人员对代码的理解。</p><p id="9fd6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">更进一步，虽然IDE没有明确地调用它，但是您可能会注意到，如果您在<code class="du kd ke kf kg b">if</code>语句上按下option-Enter，您会看到另一个将<code class="du kd ke kf kg b">if</code>语句转换为<code class="du kd ke kf kg b">when</code>的建议。通过接受这个建议，代码现在变成了:</p><pre class="kh ki kj kk fd kl kg km kn aw ko bi"><span id="f70c" class="jc jd hh kg b fi kp kq l kr ks">when (percentComplete) {<br/>    in 0..24 -&gt; {<br/>        quartile = 0<br/>        percentQuartile = 0f<br/>    }<br/>    in 25..49 -&gt; {<br/>        quartile = 1<br/>        percentQuartile = .25f<br/>    }<br/>    in 50..74 -&gt; {<br/>        quartile = 2<br/>        percentQuartile = .50f<br/>    }<br/>    in 75..94 -&gt; {<br/>        quartile = 3<br/>        percentQuartile = .75f<br/>    }<br/>    in 95..96 -&gt; {<br/>        quartile = 3<br/>        percentQuartile = .95f<br/>    }<br/>    in 97..99 -&gt; {<br/>        quartile = 3<br/>        percentQuartile = .97f<br/>    }<br/>    100 -&gt; {<br/>        quartile = 4<br/>        percentQuartile = 1f<br/>    }<br/>    else -&gt; {<br/>        quartile = -1<br/>        percentQuartile = -1f<br/>    }<br/>}</span></pre><p id="4f34" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">同样，我们没有改变功能，但块变得更容易阅读。</p><p id="96d6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">尝试IDE建议是探索不同Kotlin语言特性的好方法，所有这些都在您已经知道的代码的上下文中进行。此外，使用‘导航到声明’(默认情况下是command-B)会提示您各种语言特性是如何实现的。例如，跳转到<code class="du kd ke kf kg b">in</code>的定义显示它实际上调用了<code class="du kd ke kf kg b">IntRange.contains</code>。</p><p id="7ecf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，IntelliJ/Android Studio支持自动将Java代码转换为Kotlin，既可以使用整个文件，也可以通过将Java代码片段复制粘贴到Kotlin文件中。当您不能完全理解Kotlin语法时，这可能会有所帮助。当我第一次开始时，我不知道向Android动画添加监听器(作为匿名类)的语法，所以我用Java编写代码并复制粘贴进去。(对于那些想知道的人，我漏掉了关键字<code class="du kd ke kf kg b">object</code>。)</p><h2 id="6445" class="jc jd hh bd je jf jg jh ji jj jk jl jm ip jn jo jp it jq jr js ix jt ju jv jw bi translated">扩大你的科特林词汇</h2><p id="c654" class="pw-post-body-paragraph ie if hh ig b ih jx ij ik il jy in io ip jz ir is it ka iv iw ix kb iz ja jb ha bi translated">一旦你花了一周左右的时间编写Kotlin代码，就该开始探索一些更有趣的语言特性了。让我们重温一下quartile日志记录代码，看看我们是否可以应用一些新的技巧。</p><p id="1a73" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我不太喜欢函数中的早期返回，因为当你移动代码时，它会导致错误。对于<code class="du kd ke kf kg b">player</code>上的初始空值检查，我们可以使用一个Kotlin函数来代替早期返回:</p><pre class="kh ki kj kk fd kl kg km kn aw ko bi"><span id="6958" class="jc jd hh kg b fi kp kq l kr ks">fun logVideoQuartile(player: VideoPlayer?) {<br/>    player?.apply {<br/>        val quartile: Int<br/>        val percentQuartile: Float<br/>        when (playPercentage) {<br/>            in 0..24 -&gt; {<br/>                quartile = 0<br/>                percentQuartile = 0f<br/>            }<br/>            ...<br/>        }<br/>    }<br/>}</span></pre><p id="1f48" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">apply块中的代码只有在player不为null时才会运行(注意<code class="du kd ke kf kg b">?.</code>操作符)。用Java中的<code class="du kd ke kf kg b">if (player != null)</code>块可以达到同样的效果，但是apply操作符也将块的<code class="du kd ke kf kg b">this</code>上下文设置为<code class="du kd ke kf kg b">player</code>实例，所以我们可以直接引用<code class="du kd ke kf kg b">playPercentage</code>，而不必引用<code class="du kd ke kf kg b">player</code>。</p><p id="0da2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，IDE提出的另一个建议是“将赋值从when中取出”如果您应用它，它会做一些有趣但不太理想的事情:</p><pre class="kh ki kj kk fd kl kg km kn aw ko bi"><span id="3c83" class="jc jd hh kg b fi kp kq l kr ks">val quartile: Int<br/>val percentQuartile: Float<br/>percentQuartile = when (playPercentage) {<br/>    in 0..24 -&gt; {<br/>        quartile = 0<br/>        0f<br/>    }<br/>    in 25..49 -&gt; {<br/>        quartile = 1<br/>        .25f<br/>    }<br/>    ...<br/>}</span></pre><p id="4736" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你会注意到，它不是在每个<code class="du kd ke kf kg b">in</code>块中重复<code class="du kd ke kf kg b">percentQuartile</code>赋值，而是在<code class="du kd ke kf kg b">when</code>块之外做一个单独的赋值。然而，我们会有重复的<code class="du kd ke kf kg b">quartile</code>任务。如果能把这些变量一起赋值不是很好吗？在Java中，你必须创建一个新的类，但是在Kotlin中，我们可以使用一个名为<code class="du kd ke kf kg b">Pair</code>的标准库类:</p><pre class="kh ki kj kk fd kl kg km kn aw ko bi"><span id="2b6e" class="jc jd hh kg b fi kp kq l kr ks">player?.apply {<br/>    val(quartile, percentQuartile) = when (playPercentage) {<br/>        in 0..24 -&gt; {<br/>            Pair(0, 0f)<br/>        }<br/>        in 25..49 -&gt; {<br/>            Pair(1, .25f)<br/>        }<br/>        in 50..74 -&gt; {<br/>            Pair(2, .50f)<br/>        }<br/>        in 75..94 -&gt; {<br/>            Pair(3, .75f)<br/>        }<br/>        in 95..96 -&gt; {<br/>            Pair(3, .95f)<br/>        }<br/>        in 97..99 -&gt; {<br/>            Pair(3, .97f)<br/>        }<br/>        100 -&gt; {<br/>            Pair(4, 1f)<br/>        }<br/>        else -&gt; {<br/>            Pair(-1, -1f)<br/>        }<br/>    }<br/>    println(“Quartile is $quartile and percent quartile is $percentQuartile”)<br/>}</span></pre><p id="ad1a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">(对于Java开发人员来说，这个赋值可能看起来很奇怪，因为每个<code class="du kd ke kf kg b">in</code>块都返回一个<code class="du kd ke kf kg b">Pair</code>实例，但是赋值的左边是两个独立的变量，<code class="du kd ke kf kg b">quartile</code>和<code class="du kd ke kf kg b">percentQuartile</code>。这被称为<a class="ae kc" href="https://kotlinlang.org/docs/reference/multi-declarations.html" rel="noopener ugc nofollow" target="_blank">析构声明</a>，是在一条语句中声明和赋值多个变量的一种简单方便的语法。)</p><p id="7e62" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们越来越近了！针对每个<code class="du kd ke kf kg b">in</code>块的另一个IDE建议是从<code class="du kd ke kf kg b">when</code>条目中移除括号。我们的代码现在变成了:</p><pre class="kh ki kj kk fd kl kg km kn aw ko bi"><span id="4dab" class="jc jd hh kg b fi kp kq l kr ks">fun logVideoQuartile(player: VideoPlayer?) {<br/>    player?.apply {<br/>        val(quartile, percentQuartile) = when (playPercentage) {<br/>            in 0..24 -&gt; Pair(0, 0f)<br/>            in 25..49 -&gt; Pair(1, .25f)<br/>            in 50..74 -&gt; Pair(2, .50f)<br/>            in 75..94 -&gt; Pair(3, .75f)<br/>            in 95..96 -&gt; Pair(3, .95f)<br/>            in 97..99 -&gt; Pair(3, .97f)<br/>            100 -&gt; Pair(4, 1f)<br/>            else -&gt; Pair(-1, -1f)<br/>        }<br/>        println(“Quartile is $quartile and percent quartile is $percentQuartile”)<br/>    }<br/>}</span></pre><p id="98e5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该函数现在很紧凑，但仍然可读。这种结构的一个微妙的好处是，如果我们的逻辑在将来发生变化，块的更新变得更加容易和直观。(注意:有些人可能会指出，我们可以通过将Pair语句转换为使用<code class="du kd ke kf kg b">to</code>函数来进一步缩短代码:<code class="du kd ke kf kg b">in 0..24 -&gt; 0 to 0</code>。保持代码原样只是我个人的偏好，因为对我来说，<code class="du kd ke kf kg b">to</code>函数读起来更像是一个范围，而不是映射/元组。此外，对范围使用<code class="du kd ke kf kg b">until</code>函数可能更清楚，它类似于<code class="du kd ke kf kg b">..</code>范围操作符，但它不包括结束值。这只是用Kotlin编写同一行代码的多种方法中的一个例子。)</p><h2 id="0d8b" class="jc jd hh bd je jf jg jh ji jj jk jl jm ip jn jo jp it jq jr js ix jt ju jv jw bi translated">科特林不会让糟糕的代码变好</h2><p id="af3f" class="pw-post-body-paragraph ie if hh ig b ih jx ij ik il jy in io ip jz ir is it ka iv iw ix kb iz ja jb ha bi translated">归根结底，Kotlin只是另一个工具。它不会神奇地让你的应用程序崩溃率为零，尽管你可能听说过，但在Kotlin代码中仍有可能出现NullPointerExceptions，尤其是在Java和Kotlin的边界处。当Kotlin第一次被引入我们的代码库时，我拒绝学习它好几个月。我认为它不能做Java做不到的事情。然而，当我开始开发一个专门用Kotlin编写的功能时，这个问题就出现了。我采用了这里概述的方法，令我惊讶的是，我在大约一周内就感觉到了Kotlin的“对话性”,并且只花了我另外两周的时间就感觉到我已经学会了许多中级到高级的语言特性。</p><p id="d5df" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Kotlin不是银弹，但它确实有许多强大的特性，可以直接解决Java的一些缺点。这有助于将您的一些认知负荷转移到编译器上，因此您可以专注于简单地制作好的产品。也许，只是也许，那会让你少一点坏脾气。</p><p id="122b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="le">鸣谢:Pinterest的所有Android开发人员，感谢他们让每天的工作变得有趣。特别要感谢Matt Beattie、Dom Bhuphaibool、Ryan Cooke、Vy Phan和Zach Westlake，感谢他们帮助撰写和编辑这篇博文，感谢Christina Lee在Pinterest支持Kotlin，并最终让这位脾气暴躁的开发人员学会了这门语言。</em></p></div></div>    
</body>
</html>