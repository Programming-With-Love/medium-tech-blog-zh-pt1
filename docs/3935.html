<html>
<head>
<title>SwiftUI | Data flow | Tic-Tac-Toe Game</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SwiftUI |数据流|井字游戏</h1>
<blockquote>原文：<a href="https://medium.com/globant/swiftui-data-flow-tic-tac-toe-game-bace4fbeb3ac?source=collection_archive---------1-----------------------#2022-08-01">https://medium.com/globant/swiftui-data-flow-tic-tac-toe-game-bace4fbeb3ac?source=collection_archive---------1-----------------------#2022-08-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="c01d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是井字游戏<a class="ae jc" rel="noopener" href="/globant/swiftui-complete-guide-with-tic-tac-toe-game-ae2fea4f980e">系列</a>的第6部分。在本文中，我们将学习SwiftUI中的数据流动，并为我们的游戏“井字游戏”添加一些规则。SwiftUI用法<a class="ae jc" rel="noopener" href="/globant/swiftui-property-wrappers-explained-in-simplest-way-28cb580c6408">属性包装器</a>用于在整个应用程序中传递数据和管理它们的状态。</p><p id="25c7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第一个规则检查游戏是否已经结束。如果所有的格子都被选中或者宣布了获胜者，游戏就结束了。我们将首先关注网格选择，因为我们有一个标志<em class="jd"> noOfStrikes </em>在<em class="jd"> GameSettings </em>中，它跟踪双方玩家点击的次数。</p><blockquote class="je jf jg"><p id="87a5" class="ie if jd ig b ih ii ij ik il im in io jh iq ir is ji iu iv iw jj iy iz ja jb ha bi translated">请参考SwiftUI <a class="ae jc" rel="noopener" href="/@roy11manisha/swiftui-drawing-tic-tac-toe-game-71fae0d46381">图纸</a>文章获取最新代码。</p></blockquote><p id="da75" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">跳回MatrixBlock视图内矩形的<em class="jd">on tagesture</em>。这里，我们将在更新gridDetail后增加<em class="jd"> noOfStrikes </em>:</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="0c63" class="jt ju hh jp b fi jv jw l jx jy">...<br/>self.gridDetail.player = self.settings.currentPlayer</span><span id="da22" class="jt ju hh jp b fi jz jw l jx jy">settings.noOfStrikes += 1<br/>...</span></pre><p id="fdce" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们在GameSettings中增加了一个标志is gamed，它发布了对观察视图的更新。在GameSettings中添加一个函数setGameEnded，它将更新这个标志。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="96e3" class="jt ju hh jp b fi jv jw l jx jy">func setGameEnded() {<br/>   if noOfStrikes == 9 {<br/>      isGameEnded = true<br/>   }<br/>}</span></pre><p id="f982" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们的棋盘上有9个格子，这就是为什么9个好球会结束游戏。我们将使用isGameEnded publisher的状态在棋盘下方显示EndGameView。</p><p id="939d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建一个新的SwiftUI文件，命名为EndGameView，在这里用<strong class="ig hi">游戏结束替换文本视图的内容。</strong>代码将如下所示:</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="40bc" class="jt ju hh jp b fi jv jw l jx jy">struct EndGameView: View {<br/>   var body: some View {<br/>      Text(“Game ended”)<br/>         .multilineTextAlignment(.center)<br/>         .font(.largeTitle)<br/>   }<br/>}</span></pre><figure class="jk jl jm jn fd kb er es paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="er es ka"><img src="../Images/0864fb5395fa6500aacbae0060ab5103.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zrd0OEVuZ1wzq9Zwbzs2UA.png"/></div></div></figure><p id="6e89" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">比赛已经结束，但还没有决定谁是赢家。井字游戏有以下决定赢家的规则:</p><ul class=""><li id="a32c" class="ki kj hh ig b ih ii il im ip kk it kl ix km jb kn ko kp kq bi translated">同一个玩家在一条线上玩。</li><li id="c252" class="ki kj hh ig b ih kr il ks ip kt it ku ix kv jb kn ko kp kq bi translated">同一个运动员在一个纵队里比赛。</li><li id="af76" class="ki kj hh ig b ih kr il ks ip kt it ku ix kv jb kn ko kp kq bi translated">同一个玩家打对角。</li></ul><p id="6519" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在上面的截图中，我们可以看到玩家2是一个赢家，因为他/她在对角线上标记了X。</p><p id="2b86" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了决定赢家，我们需要跟踪玩家玩过的每个格子。MatrixBlock有GridDetail，它存储了足够多的网格细节来决定获胜者。但问题是，由于MatrixGrids正在使用<em class="jd"> ForEach绘制直接的3*3矩阵块，因此无法跟踪这个单独的GridDetail来实现上述规则。</em>让我们首先把GridDetail实例放在一个地方，这样它们的数据就可以很容易地被访问，并且总是同步的。</p><p id="ef6a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建一个新的结构RowGridDetails，它将为单个行存储GridDetail的集合。我们将在GameSettings中保存这个RowGridDetails实例，因为这个3*3的棋盘属于游戏设置。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="1028" class="jt ju hh jp b fi jv jw l jx jy">struct RowGridDetails {<br/>   var grids: [GridDetail]<br/>}</span><span id="9a54" class="jt ju hh jp b fi jz jw l jx jy">class GameSettings: ObservableObject {<br/>   var gridDetails: [RowGridDetails] = [<br/>      RowGridDetails(grids: [GridDetail(), GridDetail(), GridDetail()]),</span><span id="7562" class="jt ju hh jp b fi jz jw l jx jy">      RowGridDetails(grids: [GridDetail(), GridDetail(), GridDetail()]),</span><span id="33c3" class="jt ju hh jp b fi jz jw l jx jy">      RowGridDetails(grids: [GridDetail(), GridDetail(), GridDetail()])]<br/>...</span></pre><blockquote class="je jf jg"><p id="324c" class="ie if jd ig b ih ii ij ik il im in io jh iq ir is ji iu iv iw jj iy iz ja jb ha bi translated">这将允许我们有一个n*n或n*m大小的棋盘。</p></blockquote><p id="ec3c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在遍历这个网格细节来创建MatrixGrids。</p><figure class="jk jl jm jn fd kb er es paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="er es kw"><img src="../Images/e4190d5a6269f5cc5dbd8a147f1cc96c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zv2AvKCZFDCQNOAWwo-zEA.png"/></div></div></figure><p id="e9cb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">更新代码后，您将看到以下错误:</p><p id="2cce" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jd">在“ForEach”上引用初始值设定项“init(_:content:)”要求“RowGridDetails”符合“identified”</em></p><p id="6e7f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要修复此错误，我们需要确认RowGridDetails结构的可识别协议。确认后，您将被建议实施</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="3fe1" class="jt ju hh jp b fi jv jw l jx jy">var id: ObjectIdentifier</span></pre><p id="7f14" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jd"> id </em>创建唯一标识给定类实例的实例。SwiftUI将使用它来确定要更新/删除哪个视图等。<em class="jd"> id </em>也可以是Int。如果在没有初始化的情况下声明了<em class="jd"> id </em>,那么这将导致在初始化RowGridDetails实例时传递一个额外的参数。有两种方法可以避免这种额外的争论。首先，在声明的时候用某个随机的整数值初始化它，这将导致所有的RowGridDetails都有相同的值，因此唯一性受到了损害。另一种方法建议用UUID初始化它，这样可以修复第一个错误，同时保持唯一性。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="38dc" class="jt ju hh jp b fi jv jw l jx jy">var id = UUID()</span></pre><p id="204a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了修复第二个错误，我们需要修改GridDetail，但是在那里我们不会被要求添加<em class="jd"> id </em>，因为它的类类型和类都有唯一的id。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="8981" class="jt ju hh jp b fi jv jw l jx jy"><br/>class GridDetail: Identifiable {<br/>   var isSelected = false<br/>   var player = 0<br/>}</span></pre><p id="60fc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">运行代码后，我们将看到与显示“游戏结束”时相同的结果。现在，让我们开始添加寻找获胜者的规则。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="a6a2" class="jt ju hh jp b fi jv jw l jx jy">private func isWinner(player: Int) -&gt; Bool {<br/>   for row in gridDetails {<br/>      if row.grids.filter({$0.player == player}).count == 3 {<br/>         return true<br/>      }<br/>   }...</span></pre><p id="e461" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一个玩家编号作为参数被传递，我们希望知道它的获胜状态。首先，我们遍历棋盘的行，并为每个网格过滤玩家的详细信息。因为我们有一个3*3的网格，如果所有三个网格都是由同一个玩家选择的，则返回true。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="f3cf" class="jt ju hh jp b fi jv jw l jx jy">...<br/>for index in 0..&lt;gridDetails.count {<br/>   if gridDetails.filter({$0.grids[index].player == player}).count == 3 {<br/>      return true<br/>   }<br/>}</span></pre><p id="de93" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是遍历棋盘的列，如果计数为3，再次返回true。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="1fba" class="jt ju hh jp b fi jv jw l jx jy">if gridDetails[0].grids[0].player == player,<br/>gridDetails[1].grids[1].player == player,<br/>gridDetails[2].grids[2].player == player {<br/>   return true<br/>}</span><span id="6794" class="jt ju hh jp b fi jz jw l jx jy">if gridDetails[0].grids[2].player == player,<br/>gridDetails[1].grids[1].player == player,<br/>gridDetails[2].grids[0].player == player {<br/>   return true<br/>}</span><span id="8ebf" class="jt ju hh jp b fi jz jw l jx jy">return false</span></pre><p id="edec" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">它将从左上角到右下角对角检查，如果没有找到获胜者，则从右上角到左下角对角检查。最后，如果4个条件都不满足，它将返回false。这是针对一个玩家的，所以我们需要像这样对两个玩家调用两次来决定谁是赢家:</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="fbd9" class="jt ju hh jp b fi jv jw l jx jy">func setWinner() {<br/>   if isWinner(player: PlayerInfo.player1.rawValue) {<br/>      winner = PlayerInfo.player1.rawValue<br/>   }</span><span id="7257" class="jt ju hh jp b fi jz jw l jx jy">   if isWinner(player: PlayerInfo.player2.rawValue) {<br/>      winner = PlayerInfo.player2.rawValue<br/>   }<br/>}</span></pre><p id="15ed" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们将在MatrixBlock的<em class="jd">on tagesture</em>中调用这个方法:</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="6ea5" class="jt ju hh jp b fi jv jw l jx jy">settings.noOfStrikes += 1<br/>settings.setWinner()<br/>settings.setGameEnded()</span></pre><p id="0fe6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们的赢家已经确定，但游戏还没有结束。要在决定赢家后结束游戏，只需在setGameEnded函数中添加对赢家状态的检查:</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="251a" class="jt ju hh jp b fi jv jw l jx jy">if winner != 0 || noOfStrikes == 9 {</span></pre><p id="c4ca" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">显示谁赢了比赛不是个好主意？我们通过修改EndGameView来实现吧。</p><pre class="jk jl jm jn fd jo jp jq jr aw js bi"><span id="1736" class="jt ju hh jp b fi jv jw l jx jy">struct EndGameView: View {<br/>   var winner: Int<br/>   var body: some View {<br/>      VStack {<br/>         Text(“Game ended”)<br/>         let message = winner == 0 ? “It’s a tie!!” : “Player \(winner) isa  winner”<br/>         Text(“\(message)”)<br/>            .foregroundColor(PlayerInfo.init(rawValue:   winner)?.getPlayerColor())<br/>            .bold()<br/>      }.multilineTextAlignment(.center)<br/>       .font(.largeTitle)<br/>   }<br/>}</span></pre><p id="0633" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">只是运行它，玩游戏。您将能够看到赢家的详细信息或比赛平局信息。一旦决定了获胜者，限制玩家继续玩，因为在执行任何操作之前添加is gamed标志。</p><figure class="jk jl jm jn fd kb er es paragraph-image"><div class="er es kx"><img src="../Images/82948d63c04c4e6646e4795c59da36ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*--1CsDe2uMzPfxB6oNoRCw.gif"/></div></figure><p id="239c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为我们干杯！！！我们有自己的井字游戏，功能太全了。</p><p id="17f1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">一定要看看我在这个系列中的其他文章:</strong></p><p id="13c5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jc" rel="noopener" href="/@roy11manisha/swiftui-text-view-styling-lets-play-tic-tac-toe-game-7987909584fb">文本视图样式</a></p><p id="6bfc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jc" rel="noopener" href="/@roy11manisha/swiftui-tic-tac-toe-game-button-154a35997bc">按钮</a></p><p id="184b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jc" rel="noopener" href="/@roy11manisha/swiftui-navigation-tic-tac-toe-game-d05d52cf4636">导航</a></p><p id="e58f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jc" rel="noopener" href="/@roy11manisha/swiftui-shapes-tic-tac-toe-game-376073b11102">形状</a></p><p id="0789" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jc" rel="noopener" href="/@roy11manisha/swiftui-drawing-tic-tac-toe-game-71fae0d46381">绘画</a></p><p id="5b27" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jc" rel="noopener" href="/@roy11manisha/swiftui-list-tic-tac-toe-game-8ad7aaa4050">列表</a></p><p id="c92a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jc" rel="noopener" href="/@roy11manisha/swiftui-animation-tic-tac-toe-game-4ffe37aba0b8">动画</a></p><blockquote class="je jf jg"><p id="4e02" class="ie if jd ig b ih ii ij ik il im in io jh iq ir is ji iu iv iw jj iy iz ja jb ha bi translated">如果你喜欢这篇文章，请用掌声和评论来欣赏它。这会鼓励我多写！！！！</p></blockquote></div></div>    
</body>
</html>