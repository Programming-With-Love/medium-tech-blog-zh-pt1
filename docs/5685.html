<html>
<head>
<title>Make clone 9 less cloudy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让克隆9不那么浑浊</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/make-cloud-9-less-cloudy-9af798779cbb?source=collection_archive---------7-----------------------#2020-01-08">https://medium.com/oracledevs/make-cloud-9-less-cloudy-9af798779cbb?source=collection_archive---------7-----------------------#2020-01-08</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/4ef3059252e3a7b2688c3d4f760dfa78.png" data-original-src="https://miro.medium.com/v2/resize:fit:610/format:webp/1*vLIHdAZUB2ivZovqs11wlw.jpeg"/></div></figure><p id="63ce" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我不时会遇到没有正确克隆的Oracle数据库。这意味着我看到了以下内容:</p><ul class=""><li id="919f" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">多个主机中具有相同名称的数据库。</li><li id="d831" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">具有相同DBID的不同数据库。</li></ul><p id="c5f3" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">当您发现登录了错误的数据库时，这一点变得很明显。此外，RMAN使用DBID来跟踪备份，因此在整个生态系统中拥有唯一的dbid非常重要。</p><p id="679f" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">您可以从v$database动态视图中确定当前的名称和DBID:</p><pre class="jx jy jz ka fd kb kc kd ke aw kf bi"><span id="c585" class="kg kh hh kc b fi ki kj l kk kl">SQL&gt; select name, dbid from v$database;</span><span id="2383" class="kg kh hh kc b fi km kj l kk kl">NAME DBID<br/>---- ---------- <br/>ORCL 1556913366</span><span id="76f8" class="kg kh hh kc b fi km kj l kk kl">SQL&gt;</span></pre><p id="d631" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">当您将混合本地云添加到组合中时，降低紧迫性变得更高。持家的机会应该被看作是一个好得不能错过的机会。</p><p id="ffac" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">分配新的数据库名称和DBID的最初想法可能围绕导出和导入，或者重新创建控制文件。事实上，新的名字和DBID并不涉及这些。</p><p id="851a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">相反，关键工具是经常被忽略的Oracle DBNEWID实用程序。</p><p id="34cb" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">然而，DBNEWID不改变密码文件、spfile和DB_NAME等参数，所以这些需要单独处理。要为新数据库准备spfile，可以创建一个新的pfile，如下所示:</p><pre class="jx jy jz ka fd kb kc kd ke aw kf bi"><span id="474e" class="kg kh hh kc b fi ki kj l kk kl">SQL&gt; create pfile from spfile;</span><span id="5153" class="kg kh hh kc b fi km kj l kk kl">File created.</span><span id="0fca" class="kg kh hh kc b fi km kj l kk kl">SQL&gt;</span></pre><p id="3f12" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">第一步是将数据库置于装载模式:</p><pre class="jx jy jz ka fd kb kc kd ke aw kf bi"><span id="c4dd" class="kg kh hh kc b fi ki kj l kk kl">SQL&gt; shutdown immediate<br/>Database closed.<br/>Database dismounted.<br/>ORACLE instance shut down.<br/>SQL&gt; startup mount</span><span id="ee30" class="kg kh hh kc b fi km kj l kk kl">ORACLE instance started.</span><span id="9160" class="kg kh hh kc b fi km kj l kk kl">Total System Global Area 2248146000 bytes<br/>Fixed Size 9030736 bytes<br/>Variable Size 587202560 bytes<br/>Database Buffers 1644167168 bytes<br/>Redo Buffers 7745536 bytes</span><span id="5385" class="kg kh hh kc b fi km kj l kk kl">Database mounted.</span><span id="ce3b" class="kg kh hh kc b fi km kj l kk kl">SQL&gt; exit</span></pre><p id="29bc" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">现在，我们从命令提示符启动DBNEWID实用程序。在本例中，ORCL数据库将被重命名为CLOUD9，这也将更改默认的DBID:</p><pre class="jx jy jz ka fd kb kc kd ke aw kf bi"><span id="a615" class="kg kh hh kc b fi ki kj l kk kl">&gt; set ORACLE_SID=orcl<br/>&gt; nid TARGET=/ DBNAME=cloud9</span></pre><p id="9a31" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">执行日志如下所示:</p><pre class="jx jy jz ka fd kb kc kd ke aw kf bi"><span id="2e7f" class="kg kh hh kc b fi ki kj l kk kl">DBNEWID: Release 19.0.0.0.0 - Production on Wed Jan 8 17:37:10 2020</span><span id="d0e5" class="kg kh hh kc b fi km kj l kk kl">Copyright (c) 1982, 2019, Oracle and/or its affiliates.  All rights reserved.</span><span id="f647" class="kg kh hh kc b fi km kj l kk kl">Connected to database ORCL (DBID=1556913366)</span><span id="cb90" class="kg kh hh kc b fi km kj l kk kl">Connected to server version 19.3.0</span><span id="97d5" class="kg kh hh kc b fi km kj l kk kl">Control Files in database:<br/>    C:\APP\ORACLE\ORADATA\ORCL\CONTROLFILE\O1_MF_H10NPZ84_.CTL<br/>    C:\APP\ORACLE\FAST_RECOVERY_AREA\ORCL\CONTROLFILE\O1_MF_H10NPZD4_.CTL</span><span id="55e1" class="kg kh hh kc b fi km kj l kk kl">Change database ID and database name ORCL to CLOUD9? (Y/[N]) =&gt; y</span><span id="0424" class="kg kh hh kc b fi km kj l kk kl">Proceeding with operation<br/>Changing database ID from 1556913366 to 2967585568<br/>Changing database name from ORCL to CLOUD9<br/>    Control File C:\APP\ORACLE\ORADATA\ORCL\CONTROLFILE\O1_MF_H10NPZ84_.CTL - modified<br/>    Control File C:\APP\ORACLE\FAST_RECOVERY_AREA\ORCL\CONTROLFILE\O1_MF_H10NPZD4_.CTL - modified<br/>    Datafile C:\APP\ORACLE\ORADATA\ORCL\DATAFILE\O1_MF_SYSTEM_H10NFX76_.DB - dbid changed, wrote new name<br/>    Datafile C:\APP\ORACLE\ORADATA\ORCL\DATAFILE\O1_MF_SYSAUX_H10NJFJC_.DB - dbid changed, wrote new name<br/>    Datafile C:\APP\ORACLE\ORADATA\ORCL\DATAFILE\O1_MF_UNDOTBS1_H10NKXJ2_.DB - dbid changed, wrote new name<br/>    Datafile C:\APP\ORACLE\ORADATA\ORCL\DATAFILE\O1_MF_USERS_H10NL15O_.DB - dbid changed, wrote new name<br/>    Datafile C:\APP\ORACLE\ORADATA\ORCL\DATAFILE\O1_MF_TEMP_H10NT8N6_.TM - dbid changed, wrote new name<br/>    Control File C:\APP\ORACLE\ORADATA\ORCL\CONTROLFILE\O1_MF_H10NPZ84_.CTL - dbid changed, wrote new name<br/>    Control File C:\APP\ORACLE\FAST_RECOVERY_AREA\ORCL\CONTROLFILE\O1_MF_H10NPZD4_.CTL - dbid changed, wrote new name<br/>    Instance shut down</span><span id="af6e" class="kg kh hh kc b fi km kj l kk kl">Database name changed to CLOUD9.<br/>Modify parameter file and generate a new password file before restarting.<br/>Database ID for database CLOUD9 changed to 2967585568.<br/>All previous backups and archived redo logs for this database are unusable.<br/>Database is not aware of previous backups and archived logs in Recovery Area.<br/>Database has been shutdown, open database with RESETLOGS option.<br/>Succesfully changed database name and ID.<br/>DBNEWID - Completed succesfully.</span></pre><p id="8cc3" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">对于本例，数据库驻留在Windows 10上，因此需要使用oradim命令为实例创建一个新服务。否则，对于GNU/Linux没有额外的步骤。</p><p id="6426" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">然后登录:</p><pre class="jx jy jz ka fd kb kc kd ke aw kf bi"><span id="4985" class="kg kh hh kc b fi ki kj l kk kl">&gt; set ORACLE_SID=cloud9<br/>&gt; sqlplus / as sysdba</span></pre><p id="2808" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">编辑在调用DBNEWID之前创建的pfile，并确保DB_NAME已经更改为CLOUD9，以及对原始名称的任何其他引用。</p><p id="8fdb" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">为CLOUD9创建一个新的spfile，用resetlogs打开数据库:</p><pre class="jx jy jz ka fd kb kc kd ke aw kf bi"><span id="c51a" class="kg kh hh kc b fi ki kj l kk kl">SQL&gt; create spfile from pfile;<br/>SQL&gt; startup mount<br/>SQL&gt; alter database open resetlogs;</span></pre><p id="c669" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">现在验证数据库的新名称和新DBID:</p><pre class="jx jy jz ka fd kb kc kd ke aw kf bi"><span id="794e" class="kg kh hh kc b fi ki kj l kk kl">SQL&gt; select name, dbid from v$database;</span><span id="5a16" class="kg kh hh kc b fi km kj l kk kl">NAME   DBID<br/>------ ----------<br/>CLOUD9 2967585568</span><span id="122a" class="kg kh hh kc b fi km kj l kk kl">SQL&gt;</span></pre><p id="3cf2" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">最后，更改全局数据库名称:</p><pre class="jx jy jz ka fd kb kc kd ke aw kf bi"><span id="32e5" class="kg kh hh kc b fi ki kj l kk kl">SQL&gt; ALTER DATABASE RENAME GLOBAL_NAME TO cloud9.skies.com;<br/>SQL&gt; SELECT * FROM GLOBAL_NAME;</span><span id="cde6" class="kg kh hh kc b fi km kj l kk kl">GLOBAL_NAME<br/>----------------------------------------<br/>CLOUD9.SKIES.COM</span><span id="d568" class="kg kh hh kc b fi km kj l kk kl">SQL&gt;</span></pre><p id="8fbd" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这就是DBNEWID实用程序的作用。</p><p id="4a94" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">DBNEWID是您的工具箱的一部分，供您下次提起和移动时使用。</p><p id="9e69" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">Paul Guerin是一名专注于Oracle数据库的国际顾问。Paul在东南亚的全球交付中心工作，但他的客户来自澳大利亚、欧洲、亚洲和北美。此外，他还出席了一些世界领先的甲骨文会议，包括甲骨文2013年世界开放大会。自2015年以来，他的工作一直是IOUG最佳实践技巧小册子以及AUSOUG、Oracle Technology Network和Oracle Developers (Medium)出版物的主题。2019年，他被授予My Oracle支持社区最有价值贡献者。他是一名DBA OCP，并将继续参与Oracle ACE计划。</p></div></div>    
</body>
</html>