<html>
<head>
<title>Angular — Animating Router transitions (v4+)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">角度—制作路由器过渡的动画(v4+)</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/angular-2-animate-router-transitions-6de179e00204?source=collection_archive---------1-----------------------#2016-11-28">https://medium.com/google-developer-experts/angular-2-animate-router-transitions-6de179e00204?source=collection_archive---------1-----------------------#2016-11-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="9dd4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如何在角度上制作路由器转换动画</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/040c372c1e9920931e394f2050643d33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aXYCPdEZc35lsx_1vUtdtw.jpeg"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx"><a class="ae js" href="https://twitter.com/DavidMrugala" rel="noopener ugc nofollow" target="_blank">thedotisblack</a></figcaption></figure><p id="43a5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">更新:</strong>在<strong class="ig hi"> Angular v4.3 </strong>之后，我用一些以前没有的新功能写了一篇新博文。看看这里</p><div class="jt ju ez fb jv jw"><a rel="noopener follow" target="_blank" href="/@gerard.sans/angular-supercharge-your-router-transitions-using-new-animation-features-v4-3-3eb341ede6c8"><div class="jx ab dw"><div class="jy ab jz cl cj ka"><h2 class="bd hi fi z dy kb ea eb kc ed ef hg bi translated">角度-使用新的动画功能(4.3版以上)增强路由器过渡</h2><div class="kd l"><h3 class="bd b fi z dy kb ea eb kc ed ef dx translated">如何使用Angular中的新动画功能制作应用路由器过渡动画</h3></div><div class="ke l"><p class="bd b fp z dy kb ea eb kc ed ef dx translated">medium.com</p></div></div><div class="kf l"><div class="kg l kh ki kj kf kk jm jw"/></div></div></a></div><p id="7e12" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这篇文章中，我想分享一个很酷的技巧，你可以使用<strong class="ig hi">角度</strong>来制作路由器过渡动画。目前这是由<a class="ae js" href="https://github.com/matsko" rel="noopener ugc nofollow" target="_blank"><strong class="ig hi">Matias niemel</strong></a><strong class="ig hi">，</strong>角度动画的主要贡献者提出的官方解决方案。</p><p id="5c29" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用下面的链接查看它的应用:</p><p id="13bf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae js" href="https://embed.plnkr.co/PcRpcGK2duGw0HdaGaF5/?show=preview" rel="noopener ugc nofollow" target="_blank">演示</a> | <a class="ae js" href="https://plnkr.co/edit/PcRpcGK2duGw0HdaGaF5?p=preview" rel="noopener ugc nofollow" target="_blank">来源</a> | <a class="ae js" href="https://plnkr.co/edit/j7risCyKU26GCanDZIm4?p=preview" rel="noopener ugc nofollow" target="_blank">变化</a></p><blockquote class="kl"><p id="f7b1" class="km kn hh bd ko kp kq kr ks kt ku jb dx translated">💣注意，t 他的解决方案是实验性的，仅用于学习目的。</p></blockquote><p id="b795" class="pw-post-body-paragraph ie if hh ig b ih kw ij ik il kx in io ip ky ir is it kz iv iw ix la iz ja jb ha bi translated">在<a class="ae js" href="https://twitter.com/intent/user?screen_name=gerardsans" rel="noopener ugc nofollow" target="_blank"> @gerardsans </a>找到我的最新观点。</p><h1 id="bdc6" class="lb lc hh bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">演示应用程序</h1><p id="7039" class="pw-post-body-paragraph ie if hh ig b ih lz ij ik il ma in io ip mb ir is it mc iv iw ix md iz ja jb ha bi translated">我们将创建一个包含两个部分的简单应用程序:<strong class="ig hi"> Home </strong>和<strong class="ig hi"> About </strong>。所以我们可以制作它们之间的过渡动画。请看下面的最终结果。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es me"><img src="../Images/5a29808a256e4d9873e58be2b4041efe.png" data-original-src="https://miro.medium.com/v2/resize:fit:702/1*k-mR3lliK_8qTDwvIu2Hig.gif"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">See the Router transitions sliding to the left.</figcaption></figure><p id="4415" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该应用程序将由顶部导航和主要内容组成。顶部导航将在所有部分之间共享(第4-7行)。参见下面的<strong class="ig hi">根组件</strong>的布局。我们使用了<strong class="ig hi"> router-outlet </strong>元素作为占位符，告诉路由器当与路由匹配时，我们希望在哪里呈现组件(第9行)。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="2d6f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于顶部导航，我们使用了传递静态路由的<strong class="ig hi"> routerLink </strong>指令来创建不同的导航URL(第5–6行)。</p><p id="18c5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于动态路由，您可以使用以下替代语法:</p><pre class="jd je jf jg fd mh mi mj mk aw ml bi"><span id="876e" class="mm lc hh mi b fi mn mo l mp mq">&lt;a [<strong class="mi hi">routerLink]="['users', 42]"</strong>&gt;John&lt;/a&gt;   // in the template</span><span id="d0fb" class="mm lc hh mi b fi mr mo l mp mq">&lt;a <strong class="mi hi">href="#/users/42"</strong>&gt;John&lt;/a&gt;              // rendered</span></pre><p id="6b9c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们使用了<strong class="ig hi"> routerLinkActive </strong>指令来设置<strong class="ig hi"> active </strong>类来样式化当前部分。所以当我们导航到<strong class="ig hi">主页</strong>时，它会呈现:</p><pre class="jd je jf jg fd mh mi mj mk aw ml bi"><span id="b439" class="mm lc hh mi b fi mn mo l mp mq">&lt;a href="#/home" <strong class="mi hi">class="active"</strong>&gt;Home&lt;/a&gt;</span></pre><h1 id="422a" class="lb lc hh bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">设置路线</h1><p id="7ce1" class="pw-post-body-paragraph ie if hh ig b ih lz ij ik il ma in io ip mb ir is it mc iv iw ix md iz ja jb ha bi translated">在Angular中，路由器尝试按照设置期间使用的相同顺序将路由定义与当前url匹配。</p><p id="11e9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当导航匹配它们各自的路径时，主要的两条路由告诉路由器实例化关于组件的<strong class="ig hi">家</strong>和<strong class="ig hi">(第3-4行)。</strong></p><p id="6614" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于常见行为，我们还使用了两条特殊路线。具有<strong class="ig hi">空路径</strong>的路线(第2行)覆盖了<strong class="ig hi">默认路线</strong>，该路线将为空，除非我们导航到特定的url。在这种情况下，我们指示使用归途进行重定向。<strong class="ig hi">否则路由</strong>(第5行)将捕捉任何打字错误或未定义的路由，显示用户友好的404页面。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="ee72" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于这个演示，由于Plunker，我们使用了<strong class="ig hi">散列位置策略</strong>(第9行)。如果我们可以访问后端，我们也可以使用<strong class="ig hi">路径定位策略</strong>。这需要将未定义的路由重定向到<strong class="ig hi">index.html</strong>以避免来自服务器的404错误。</p><h1 id="0d78" class="lb lc hh bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">路由组件</h1><p id="59cc" class="pw-post-body-paragraph ie if hh ig b ih lz ij ik il ma in io ip mb ir is it mc iv iw ix md iz ja jb ha bi translated">让我们看看下面的<strong class="ig hi">主页</strong> <strong class="ig hi">组件</strong>所需的更改。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="ebbe" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先我们导入了<strong class="ig hi"> routerTransition </strong>工厂函数(第2行)。我们在<strong class="ig hi">动画</strong>属性中使用它。这将创建一个具有相同名称的<strong class="ig hi">动画触发器</strong>，并将相应的样式应用于组件。最后，我们使用<strong class="ig hi">空字符串</strong>将<strong class="ig hi"> routerTransition </strong>动画触发器绑定到<strong class="ig hi">主机元素</strong>。这将允许我们在导航到另一个组件时保留动画上下文。</p><pre class="jd je jf jg fd mh mi mj mk aw ml bi"><span id="416b" class="mm lc hh mi b fi mn mo l mp mq">&lt;router-outlet&gt; <br/>  &lt;home <strong class="mi hi">[@routerTransition]=""</strong>&gt;&lt;/home&gt; // &lt;-- host binding<br/>&lt;/router-outlet&gt;</span></pre><p id="9cc3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该解决方案的主要思想是链接导航，添加新组件并移除先前组件，以触发<strong class="ig hi">:进入</strong>和<strong class="ig hi">:离开</strong>转换。让我们看看实现细节，看看它是如何做到的。</p><h1 id="3512" class="lb lc hh bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">角度动画</h1><p id="cbea" class="pw-post-body-paragraph ie if hh ig b ih lz ij ik il ma in io ip mb ir is it mc iv iw ix md iz ja jb ha bi translated">Angular基于<a class="ae js" href="https://w3c.github.io/web-animations/" rel="noopener ugc nofollow" target="_blank"> Web Animations API </a>，我们使用<strong class="ig hi">动画触发器</strong>来定义一系列<strong class="ig hi">状态</strong>和状态之间的<strong class="ig hi">转换</strong>。我们也使用<strong class="ig hi">样式</strong>来帮助我们使用<strong class="ig hi"> CSS属性</strong>合成想要的效果。</p><blockquote class="ms mt mu"><p id="9752" class="ie if mv ig b ih ii ij ik il im in io mw iq ir is mx iu iv iw my iy iz ja jb ha bi translated">对于<a class="ae js" href="http://caniuse.com/#feat=web-animation" rel="noopener ugc nofollow" target="_blank">原生不支持网页动画API </a>的浏览器:IE/Edge、Safari等；你必须包括一个<a class="ae js" href="https://github.com/web-animations/web-animations-js" rel="noopener ugc nofollow" target="_blank">多孔填充物</a>。</p></blockquote><p id="2bfc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将触发动画的事件:</p><ul class=""><li id="a83c" class="mz na hh ig b ih ii il im ip nb it nc ix nd jb ne nf ng nh bi translated">将一个元素附加到视图或从视图中分离(对应于<strong class="ig hi">星号</strong>和<strong class="ig hi">无效</strong>状态)</li><li id="ae84" class="mz na hh ig b ih ni il nj ip nk it nl ix nm jb ne nf ng nh bi translated">为触发器设置<strong class="ig hi">状态</strong>。例如:[@ router transition]= "<strong class="ig hi">void</strong>"。</li></ul><p id="9364" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们的实现使用了两者的组合。</p><h1 id="ba5b" class="lb lc hh bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">动画实现</h1><p id="5733" class="pw-post-body-paragraph ie if hh ig b ih lz ij ik il ma in io ip mb ir is it mc iv iw ix md iz ja jb ha bi translated">让我们看看如何使用<strong class="ig hi">角度动画</strong>来达到想要的效果。首先，我们使用了<strong class="ig hi"> routerTransition </strong>工厂函数来调用<strong class="ig hi"> slideToLeft </strong>(第3–5行)。在这个函数<strong class="ig hi"> </strong>中，我们创建了由两个状态和两个转换组成的<strong class="ig hi">动画触发器</strong>(第8-19行)。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="4827" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们定义了两种状态:<strong class="ig hi"> void </strong>和<strong class="ig hi">星号</strong>；并设置<strong class="ig hi"> </strong>它们的样式来达到想要的滑动效果(第9–10行)。通过使用<strong class="ig hi"> {position: fixed} </strong>，组件将根据视窗放置并在页面中滑动。</p><p id="9e34" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于<strong class="ig hi">:输入</strong>转换，我们设置一个初始样式，将组件定位在最右边。然后我们设置一个动画到最后的位置，设置一个缓动函数和持续时间。对于<strong class="ig hi">:离开</strong>转换，我们使用类似的方法将组件移动到最左边。</p><blockquote class="ms mt mu"><p id="951b" class="ie if mv ig b ih ii ij ik il im in io mw iq ir is mx iu iv iw my iy iz ja jb ha bi translated">我们使用<strong class="ig hi">变换</strong>而不是<strong class="ig hi">上</strong>、<strong class="ig hi">下</strong>、<strong class="ig hi">左</strong>、<strong class="ig hi">右</strong>以获得更好的性能。</p></blockquote><h1 id="7692" class="lb lc hh bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">导航示例</h1><p id="3538" class="pw-post-body-paragraph ie if hh ig b ih lz ij ik il ma in io ip mb ir is it mc iv iw ix md iz ja jb ha bi translated">让我们看看当我们从<strong class="ig hi">家</strong>导航到关于的<strong class="ig hi">时会发生什么。这两个序列将同时发生:</strong></p><ul class=""><li id="b559" class="mz na hh ig b ih ii il im ip nb it nc ix nd jb ne nf ng nh bi translated">路由器会将<strong class="ig hi"> Home </strong> <strong class="ig hi">组件</strong>从视图中分离。应用与<strong class="ig hi">无效</strong>状态相关的样式。这将触发<strong class="ig hi">:离开</strong>转换。与<strong class="ig hi">:离开</strong>过渡相关的样式将逐渐应用。家庭部分将被摧毁。</li><li id="d987" class="mz na hh ig b ih ni il nj ip nk it nl ix nm jb ne nf ng nh bi translated">关于组件的<strong class="ig hi">将被路由器附加到视图上。About组件将被实例化。应用与<strong class="ig hi">无效</strong>状态相关的样式。' @ <strong class="ig hi"> routerTransition' </strong>主机绑定将触发<strong class="ig hi"> :enter </strong>转换。与<strong class="ig hi">:输入</strong>过渡相关的样式将逐渐应用。最后，将应用与<strong class="ig hi">星号</strong>相关的样式。</strong></li></ul><blockquote class="ms mt mu"><p id="a77d" class="ie if mv ig b ih ii ij ik il im in io mw iq ir is mx iu iv iw my iy iz ja jb ha bi translated">请注意，来自已定义状态或转换的所有样式都是同时聚合的。</p></blockquote><h1 id="7961" class="lb lc hh bd ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly bi translated">特别提及</h1><p id="0518" class="pw-post-body-paragraph ie if hh ig b ih lz ij ik il ma in io ip mb ir is it mc iv iw ix md iz ja jb ha bi translated">本文展示的实现主要是使用了<a class="ae js" href="https://github.com/matsko" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi">马蒂亚斯·涅梅尔</strong> </a>为<strong class="ig hi"> ngEurope </strong>制作的演示中<a class="ae js" href="https://github.com/matsko/ng2eu-2016-code/blob/master/route_animations.ts" rel="noopener ugc nofollow" target="_blank">这段代码</a>的一个略微修改的版本。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="nn mg l"/></div></figure><p id="36a2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">仅此而已！觉得我错过了什么吗？通过<a class="ae js" href="https://twitter.com/intent/user?screen_name=gerardsans" rel="noopener ugc nofollow" target="_blank"> @gerardsans </a>或gerard.sans_at_gmail.com联系我，感谢阅读！</p><div class="jt ju ez fb jv jw"><a href="http://www.meetup.com/AngularZone/" rel="noopener  ugc nofollow" target="_blank"><div class="jx ab dw"><div class="jy ab jz cl cj ka"><h2 class="bd hi fi z dy kb ea eb kc ed ef hg bi translated">安古拉宗社区</h2><div class="kd l"><h3 class="bd b fi z dy kb ea eb kc ed ef dx translated">欢迎来到我们的社区。我们的激情是有棱角的。加入我们吧！🚀</h3></div></div><div class="kf l"><div class="no l kh ki kj kf kk jm jw"/></div></div></a></div><figure class="jd je jf jg fd jh er es paragraph-image"><a href="https://twitter.com/intent/user?screen_name=gerardsans"><div class="er es np"><img src="../Images/abefda0aa7864742686ec7f7fdffe2b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K1tQhWBuVOdzR7OAGvyd8Q.png"/></div></a></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es nq"><img src="../Images/a2b8f2d785706b3a1887e09b8dec4ed4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z0WE8Uhk03nHd0_MT5kyDg.png"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es nr"><img src="../Images/67b37e5d672384f0953563450fca0029.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*uNeEFxYiwJq8RfiDCsI-Xg.gif"/></div></div></figure></div></div>    
</body>
</html>