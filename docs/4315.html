<html>
<head>
<title>Enforcing Team Rules with Lint 👩‍🔧</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Lint执行团队规则👩‍🔧</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/enforcing-team-rules-with-lint-159b3ba74678?source=collection_archive---------3-----------------------#2020-11-18">https://medium.com/google-developer-experts/enforcing-team-rules-with-lint-159b3ba74678?source=collection_archive---------3-----------------------#2020-11-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/5c4d399e3857b388ffc63a3a41caa408.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7WpNhANWKEWPSGeW"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo by <a class="ae it" href="https://unsplash.com/@rodeutsch?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Robin Jonathan Deutsch</a> on <a class="ae it" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="6dc3" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">几个月前，我的团队达成了一项协议，当在代码中的任何地方留下一个TODO时，我们需要始终提供几样东西:</p><ul class=""><li id="c009" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">应该处理待办事项的人</li><li id="2ffe" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">离开待办事项的日期</li><li id="9535" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">关于需要做什么的评论或解释</li></ul><p id="a75b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">但是记忆会褪色，有时人们会忘记。所以我做了一个活模板，让大家更容易坚持规则。一个简单的ALT+ENTER和tada，有TODO模板供您填写:</p><figure class="kh ki kj kk fd ii er es paragraph-image"><div class="er es kg"><img src="../Images/95196c60c5a63ba8a339e0f0a8ee3475.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*1cY4DH2p9-P4dJCg.gif"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Custom template in action</figcaption></figure><p id="6281" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你想知道更多这是如何做到的，我<a class="ae it" href="https://zarah.dev/2020/03/06/live-templates.html" rel="noopener ugc nofollow" target="_blank">在这里</a>写了关于实现一个实时模板的文章。</p><p id="5455" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">一切似乎都很好，但几个月后我注意到，即使我们有模板，人们偶尔会忘记✨✨填写它。</p><p id="759e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们可以不断提醒人们使用模板，但我不想成为那个一遍又一遍说事情的讨厌的人。如果我们把这个团队规则融入到开发人员的工作流程中不是更好吗？因此，我开始思考，为什么不编写一个自定义的Lint规则来消除人工干预，让工具完成它的工作呢？</p><h1 id="4b9a" class="kl km hh bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">一个好主意</h1><p id="917f" class="pw-post-body-paragraph iu iv hh iw b ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn ln jp jq jr ha bi translated">Lint是一个静态分析器，内置的规则非常棒！它们有助于识别我们代码中的常见问题(忘记<a class="ae it" href="https://android.googlesource.com/platform/tools/base/+/studio-master-dev/lint/libs/lint-checks/src/main/java/com/android/tools/lint/checks/CallSuperDetector.kt" rel="noopener ugc nofollow" target="_blank">调用</a> <code class="du lo lp lq lr b"><a class="ae it" href="https://android.googlesource.com/platform/tools/base/+/studio-master-dev/lint/libs/lint-checks/src/main/java/com/android/tools/lint/checks/CallSuperDetector.kt" rel="noopener ugc nofollow" target="_blank">super()</a></code>)、可能的错误(忘记<a class="ae it" href="https://android.googlesource.com/platform/tools/base/+/studio-master-dev/lint/libs/lint-checks/src/main/java/com/android/tools/lint/checks/ConstraintLayoutDetector.kt" rel="noopener ugc nofollow" target="_blank">约束视图</a>)或潜在的优化(检测<a class="ae it" href="https://android.googlesource.com/platform/tools/base/+/studio-master-dev/lint/libs/lint-checks/src/main/java/com/android/tools/lint/checks/OverdrawDetector.java" rel="noopener ugc nofollow" target="_blank">透支</a>)，并给我们机会立即纠正它们。</p><p id="3e97" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这些规则是灵活的。我们可以挑选哪些我们想<a class="ae it" href="https://developer.android.com/studio/write/lint#config" rel="noopener ugc nofollow" target="_blank">排除在运行</a>之外，我们可以选择<a class="ae it" href="https://developer.android.com/studio/write/lint#gradle" rel="noopener ugc nofollow" target="_blank">如果出错就让构建失败</a>，我们甚至可以<a class="ae it" href="https://developer.android.com/studio/write/lint#snapshot" rel="noopener ugc nofollow" target="_blank">确定一个要忽略的特定问题</a>。</p><p id="1a7d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">有很多精彩的演讲概述了Lint的历史、理念和特性，特别是来自KotlinConf 2017 的Tor Norbye的<a class="ae it" href="https://youtu.be/p8yX5-lPS6o" rel="noopener ugc nofollow" target="_blank">演讲。</a></p><p id="1c40" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Lint已经存在了一段时间，对编写我们自己的Lint检查的支持<em class="ls">也已经存在了一段时间</em>，所以肯定有一些参考资料，对吗？来自Droidcon NYC 2017 的John Rodriguez <a class="ae it" href="https://www.droidcon.com/media-detail?video=329360652" rel="noopener ugc nofollow" target="_blank">做了一个很好的概述，来自Android Dev Summit 2019 </a>的Alan Viverette和Rahul Ravikumar <a class="ae it" href="https://www.youtube.com/watch?v=jCmJWOkjbM0&amp;vl=en" rel="noopener ugc nofollow" target="_blank">做了一个很有启发性的演讲。</a></p><p id="5519" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">他们让这看起来很容易。<strong class="iw hi">肯定</strong> <em class="ls">我</em>能做这个。💃</p><h1 id="aaec" class="kl km hh bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">最糟糕的主意</h1><p id="a6cd" class="pw-post-body-paragraph iu iv hh iw b ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn ln jp jq jr ha bi translated">事实证明这很容易……如果你知道自己在做什么的话。哦，妈妈，我不知道我在做什么。</p><p id="99fb" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">安卓工具网站看起来被遗弃了🙈。示例规则是基本的，但是除了帮助我弄清楚如何设置之外，它并没有告诉我任何事情。</p><p id="d324" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">但是Zarah，你说，为什么不直接复制平台上的呢？我做了，而且有几百个。要弄清楚先看哪一个是势不可挡的。</p><p id="96ee" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我向你保证，如果有人在大约三个月后再让我这样做，我会完全忘记我做了什么或者我是如何做到的(老实说，我仍然不明白它实际上是如何工作的)🤷‍♀).公平的警告:我会不断地喊出我不理解或只是猜测的事情。</p><p id="39dd" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们开始吧。🙇‍♀</p><h1 id="2e0c" class="kl km hh bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">变得舒适</h1><p id="b923" class="pw-post-body-paragraph iu iv hh iw b ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn ln jp jq jr ha bi translated">在深入研究代码之前，我们需要理解一些关键概念。Lint由<strong class="iw hi">问题</strong>和<strong class="iw hi">检测器</strong>提供燃料。</p><p id="ca0d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">问题</strong>识别我们想要强调为错误或潜在错误来源的实现。从一份报告中摘录，让我们从这个角度来分析这个问题:</p><figure class="kh ki kj kk fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lt"><img src="../Images/96aeabe8f8357c2a0f06078f3e504173.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2p5c3dNnQ2KSZQd0.png"/></div></div></figure><p id="4bfc" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">一个问题具有:</p><ul class=""><li id="3920" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">1 -简要描述:出错原因的总结</li><li id="497c" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">2 -解释:提供为什么认为这是一个问题的详细信息。您还可以建议可能的修复方法，或者提供相关文档的链接。</li><li id="1211" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">3 - ID:问题的唯一标识符。这是开发人员用来禁止报告此问题的，即进入<code class="du lo lp lq lr b">@Supress</code>的内容</li><li id="99a5" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">4 -类别:标识可以存储该问题的区域。有各种各样的<a class="ae it" href="https://cs.android.com/android-studio/platform/tools/base/+/mirror-goog-studio-master-dev:lint/libs/lint-api/src/main/java/com/android/tools/lint/detector/api/Category.kt;l=90;drc=e48839385a9fd74f17265029dbdac3ef05c0cec6" rel="noopener ugc nofollow" target="_blank">可用类别</a>，涵盖了从<code class="du lo lp lq lr b">A11Y</code>(可访问性)到<code class="du lo lp lq lr b">INTEROPERABILITY_JAVA</code>(从Java调用Kotlin时的问题)到<code class="du lo lp lq lr b">TYPOGRAPHY</code>的领域。</li><li id="1560" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">5 -严重性:这影响如何处理这个问题，可以是几个选项中的一个<a class="ae it" href="https://cs.android.com/android-studio/platform/tools/base/+/mirror-goog-studio-master-dev:lint/libs/lint-api/src/main/java/com/android/tools/lint/detector/api/Severity.kt" rel="noopener ugc nofollow" target="_blank">，其中<code class="du lo lp lq lr b">FATAL</code>是最严重的(构建被中止，nopes退出)。如果在他们的<code class="du lo lp lq lr b">build.gradle</code>文件中遇到带有<code class="du lo lp lq lr b">lintOptions.isAbortOnError = true</code>的<code class="du lo lp lq lr b">ERROR</code>，用户可以强制构建失败。</a></li><li id="7284" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">6 -优先级1到10之间的数字，10表示最高优先级</li></ul><p id="cef9" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">检测器</strong>完成繁重的工作并找出问题所在。他们可以查看几乎任何类型的文件——清单？✔️，资源文件？️✔️·格雷档案？✔️</p><p id="8859" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">单个检测器可以识别任意数量的相关问题，并且可以单独报告每个问题。</p><p id="05cb" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">注意Lint以一个<a class="ae it" href="https://cs.android.com/android-studio/platform/tools/base/+/mirror-goog-studio-master-dev:lint/libs/lint-api/src/main/java/com/android/tools/lint/detector/api/Detector.kt;l=52;drc=7465b820deacf7e7acc4e93d5f73a73633b7bfcb" rel="noopener ugc nofollow" target="_blank">预定义的顺序</a>调用所有现有的检测器。这意味着，如果Lint规则需要检查Kotlin和XML文件中的某些内容(比如资源使用)，检查的执行顺序很重要。</p><h1 id="5dec" class="kl km hh bd kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li bi translated">安装</h1><p id="f110" class="pw-post-body-paragraph iu iv hh iw b ix lj iz ja jb lk jd je jf ll jh ji jj lm jl jm jn ln jp jq jr ha bi translated">我们的习惯规则需要一个家；他们的家是一个新的模块。右击你的项目，选择<code class="du lo lp lq lr b">New &gt; Module</code>，然后选择<code class="du lo lp lq lr b">Java or Kotlin Library</code></p><figure class="kh ki kj kk fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lu"><img src="../Images/9cc1dc8a6b943c4382148994ab74ebf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sveJfIvtVK5YWvzj.png"/></div></div></figure><p id="ee7c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在新创建的<code class="du lo lp lq lr b">build.gradle</code>文件中，添加Lint的依赖项。(注:我用的是<a class="ae it" href="https://docs.gradle.org/nightly/userguide/kotlin_dsl.html" rel="noopener ugc nofollow" target="_blank">科特林DSL </a>)</p><p id="8610" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们Lint旅程的下一段将会是漫长而危险的。因此，让我们在这里快速休息一下，确保观看上面链接的谈话，⏸继续关注本系列的下一篇文章，在那里我们终于可以编写我们自己的探测器了！</p></div><div class="ab cl lv lw go lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ha hb hc hd he"><p id="badc" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="ls">原载于2020年11月18日</em><a class="ae it" href="https://zarah.dev/2020/11/18/todo-lint.html" rel="noopener ugc nofollow" target="_blank"><em class="ls">https://zarah . dev</em></a><em class="ls">。</em></p></div></div>    
</body>
</html>