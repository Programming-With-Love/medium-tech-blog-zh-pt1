<html>
<head>
<title>Using WorkManager in multi-process apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在多进程应用中使用工作管理器</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/workmanager-2-5-0-stable-released-701b668cd064?source=collection_archive---------3-----------------------#2021-01-27">https://medium.com/androiddevelopers/workmanager-2-5-0-stable-released-701b668cd064?source=collection_archive---------3-----------------------#2021-01-27</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/04f37d6cf32867fc471946c8f217ac5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tytX6WPDFQAXOwzOj6qEAw.png"/></div></div></figure><div class=""/><p id="05e4" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">📝最近发布的WorkManager 2.5.0支持在多进程环境中更轻松地使用，并提供了多项稳定性改进。</strong></p><p id="51f0" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">因此，如果你有一个管理多个进程的应用程序，并且你需要一种健壮的方式来管理后台工作(<em class="jn">不再有初始化错误</em> ️️⚠)，那么这就是为你发布的版本。</p><p id="596d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您需要对代码进行一些更改，所以请继续阅读以了解更多信息。</p><blockquote class="jo jp jq"><p id="1433" class="ip iq jn ir b is it iu iv iw ix iy iz jr jb jc jd js jf jg jh jt jj jk jl jm ha bi translated">在本文的最后，我还将列出这个版本的WorkManager库中的一些其他行为变化和最新添加的内容。</p></blockquote><h1 id="8906" class="ju jv hs bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">简介:工作-多重处理</h1><p id="e136" class="pw-post-body-paragraph ip iq hs ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">新的多进程工件通过将作业调度统一到单个进程中来提高性能。若要开始，请将其添加到您的应用中。</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="9c29" class="lg jv hs lc b fi lh li l lj lk">Implementation "androidx.work:work-multiprocess:2.5.0"</span></pre><p id="b4d8" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在您可以<a class="ae ll" href="https://developer.android.com/topic/libraries/architecture/workmanager/advanced/custom-configuration" rel="noopener ugc nofollow" target="_blank">选择</a>工作管理器用来将工作请求排队的指定进程，并运行其进程内调度程序。</p><p id="789a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">使用<code class="du lm ln lo lc b">Configuration.Provider</code>的配置可以是这样的。</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="0b86" class="lg jv hs lc b fi lh li l lj lk">class MyApplication() : Application(), Configuration.Provider {  override fun getWorkManagerConfiguration() =<br/>    Configuration.Builder()<br/>      .setDefaultProcessName("<strong class="lc ht"><em class="jn">com.example:remote</em></strong>")<br/>      .build()<br/>}</span></pre><blockquote class="jo jp jq"><p id="c52e" class="ip iq jn ir b is it iu iv iw ix iy iz jr jb jc jd js jf jg jh jt jj jk jl jm ha bi translated"><strong class="ir ht">注意</strong>:<code class="du lm ln lo lc b">setProcessName</code>上的参数要求您传递完全限定的进程名，包括您的应用程序的包名，后跟一个冒号，然后是主机的进程名，例如<code class="du lm ln lo lc b">com.example:remote</code>。</p></blockquote><p id="167d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">当使用工作多进程时，你也想使用<code class="du lm ln lo lc b">RemoteWorkManager</code>而不是<code class="du lm ln lo lc b">WorkManager</code>来管理你的工作请求。<a class="ae ll" href="https://developer.android.com/reference/androidx/work/multiprocess/RemoteWorkManager" rel="noopener ugc nofollow" target="_blank"> RemoteWorkManager </a>将总是联系指定的进程来为您排队工作。这可以确保您不会在调用过程中意外初始化新的工作管理器。进程内调度程序也在同一个指定的进程中运行。</p><h2 id="933a" class="lg jv hs bd jw lp lq lr ka ls lt lu ke ja lv lw ki je lx ly km ji lz ma kq mb bi translated"><strong class="ak">好处</strong></h2><p id="74af" class="pw-post-body-paragraph ip iq hs ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">通过像这样配置WorkManager并使用RemoteWorkManager来调度您的作业，您可以在您的多进程应用程序中更快、更可靠地管理您的工作。这是因为SQLite <a class="ae ll" href="https://en.wikipedia.org/wiki/Resource_contention" rel="noopener ugc nofollow" target="_blank">争用</a>可以大大减少(因为我们不再依赖基于文件的锁),并且跨进程的作业协调不再是必要的，因为您的应用程序将只有一个工作管理器实例在您可以指定的进程中运行。</p><h1 id="67a1" class="ju jv hs bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">行为改变🔀</h1><h2 id="3dd2" class="lg jv hs bd jw lp lq lr ka ls lt lu ke ja lv lw ki je lx ly km ji lz ma kq mb bi translated"><strong class="ak">工作对帐</strong></h2><p id="3b1b" class="pw-post-body-paragraph ip iq hs ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">以前，当<code class="du lm ln lo lc b">ActivityManager</code>无法实例化<code class="du lm ln lo lc b">JobService</code>来启动一个作业时，该作业会因为平台中的一个底层错误而被悄悄丢弃。WorkManager现在可以确保当通过协调<code class="du lm ln lo lc b">WorkRequest</code>对象和作业来创建<code class="du lm ln lo lc b">Application</code>实例时，每个<code class="du lm ln lo lc b">WorkRequest</code>都有一个后备调度程序作业。</p><h2 id="a3e6" class="lg jv hs bd jw lp lq lr ka ls lt lu ke ja lv lw ki je lx ly km ji lz ma kq mb bi translated"><strong class="ak">限制内部数据库增长</strong></h2><p id="af60" class="pw-post-body-paragraph ip iq hs ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">我们看到应用崩溃的原因之一是设备存储不足。这主要发生在存储容量低的设备上。然而，当应用程序为<strong class="ir ht">安排了大量</strong>工作时，WorkManager对设备的低存储运行负有部分责任。</p><blockquote class="jo jp jq"><p id="fd0a" class="ip iq jn ir b is it iu iv iw ix iy iz jr jb jc jd js jf jg jh jt jj jk jl jm ha bi translated">默认情况下，已完成的作业会在内部WorkManager数据库中记录7天。这个时间已经减少到1天，这大大减小了数据库的大小。</p></blockquote><p id="9de9" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">虽然我们缩短了缓冲持续时间，但是您可以通过使用<code class="du lm ln lo lc b">keepResultsForAtLeast()</code> API来控制您的作业应该被记住多长时间。</p><h1 id="30bf" class="ju jv hs bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">✨新测试API</h1><p id="e5b0" class="pw-post-body-paragraph ip iq hs ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">如果您将<code class="du lm ln lo lc b">ListenableFuture</code>与WorkManager一起使用，那么测试会变得更容易——<code class="du lm ln lo lc b">TestListenableWorkerBuilder</code>kot Lin扩展现在接受任何扩展<code class="du lm ln lo lc b">ListenableWorker</code>的类，在测试过程中为您提供更多的灵活性。</p><h1 id="3381" class="ju jv hs bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">错误修复🐛</h1><p id="a2af" class="pw-post-body-paragraph ip iq hs ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">除了新功能之外，此版本还包含几个错误修复，可提高WorkManager的稳定性、可靠性和性能。您可以在<a class="ae ll" href="https://developer.android.com/jetpack/androidx/releases/work#2.5.0" rel="noopener ugc nofollow" target="_blank">发行说明</a>中阅读所有变更以及已修复的错误。</p><h1 id="3a11" class="ju jv hs bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">您可以做些什么来改进工作管理器</h1><h2 id="3f24" class="lg jv hs bd jw lp lq lr ka ls lt lu ke ja lv lw ki je lx ly km ji lz ma kq mb bi translated"><strong class="ak">通过GitHub贡献给工作管理器👩‍💻</strong></h2><p id="fd73" class="pw-post-body-paragraph ip iq hs ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">WorkManager以及其他几个Jetpack库可以通过GitHub接受投稿。</p><p id="8494" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><a class="mc md ge" href="https://medium.com/u/d42e45d76c8a?source=post_page-----701b668cd064--------------------------------" rel="noopener" target="_blank"> Alan Viverette </a>写了一篇<a class="ae ll" rel="noopener" href="/androiddevelopers/introducing-jetpack-on-github-c2c9f12e62a9">全面的博文</a>讲述了整个过程。</p><h2 id="7705" class="lg jv hs bd jw lp lq lr ka ls lt lu ke ja lv lw ki je lx ly km ji lz ma kq mb bi translated"><strong class="ak">出问题时请告诉我们📝</strong></h2><p id="8139" class="pw-post-body-paragraph ip iq hs ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">2.5.0版本中修复的大多数错误都是通过<a class="ae ll" href="https://issuetracker.google.com/issues?q=componentid:409906" rel="noopener ugc nofollow" target="_blank">公共问题追踪器</a>输入的。</p><p id="4e47" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">创造一个我们可以解决的问题的最好方法是通过<a class="ae ll" href="https://issuetracker.google.com/issues/new?component=409906" rel="noopener ugc nofollow" target="_blank">创造一个我们可以重现的问题</a>。为了帮助我们重现问题，我们建议您使用<a class="ae ll" href="https://github.com/android/architecture-components-samples/tree/main/WorkManagerSample" rel="noopener ugc nofollow" target="_blank">工作管理器示例</a>或者在问题描述中提供您自己的带有说明的示例代码。</p><p id="e5b8" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在是开始工作并管理更新应用程序中的库版本的最佳时机。</p></div></div>    
</body>
</html>