<html>
<head>
<title>Android’s CameraX Jetpack Library is now in Beta!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android的CameraX Jetpack库现在处于测试阶段！</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/androids-camerax-jetpack-library-is-now-in-beta-bf4cf0cc3ea6?source=collection_archive---------0-----------------------#2020-03-16">https://medium.com/androiddevelopers/androids-camerax-jetpack-library-is-now-in-beta-bf4cf0cc3ea6?source=collection_archive---------0-----------------------#2020-03-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/49b58502ca76b981f9f359307204e020.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gg3V-9xr_E6ycG3P9fFGLw.jpeg"/></div></div></figure><div class=""/><p id="bef2" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们非常兴奋地与大家分享，CameraX现已推出测试版！我们要感谢让这一切成为可能的整个开发者社区。在这个版本中，你会发现一个相机API基础，它将保持不变，并通过bug和设备兼容性修复随着时间的推移而变得更好。</p><p id="bb8e" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">除了扩展测试之外，我们有许多在生产中使用CameraX的应用程序，这让我们有信心推荐开发人员开始试验，并(如果合适的话)在Play Store上推出CameraX。我们预计会有一些错误，并致力于确保您的应用程序拥有最佳的相机体验。如果您需要帮助，请通过<a class="ae jn" href="http://g.co/camerax/developers" rel="noopener ugc nofollow" target="_blank">讨论邮件列表</a>或<a class="ae jn" href="http://issuetracker.google.com" rel="noopener ugc nofollow" target="_blank">打开问题</a>联系我们寻求支持。</p><p id="3ee0" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这篇博客文章中，我们将简要介绍CameraX Jetpack库，并分享Beta版中的新功能。达到beta状态意味着Jetpack库被认为可以投入生产使用，但可能仍然包含一些非关键的错误。</p><p id="b479" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要获得最新资源，请查看<a class="ae jn" href="http://developer.android.com/camerax" rel="noopener ugc nofollow" target="_blank">文档</a>，查看<a class="ae jn" href="http://g.co/camerax/sample" rel="noopener ugc nofollow" target="_blank">官方样本</a>，并加入我们的<a class="ae jn" href="http://g.co/camerax/developers" rel="noopener ugc nofollow" target="_blank">在线开发者社区</a>。</p><figure class="jp jq jr js fd hj er es paragraph-image"><div class="er es jo"><img src="../Images/8ef25fbad5aa78241d183712d8cbcfb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:536/0*CWg6QMLdCo8zh1ae"/></div><figcaption class="jt ju et er es jv jw bd b be z dx">CameraX logo</figcaption></figure><h1 id="9de4" class="jx jy hs bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">CameraX摘要</h1><p id="e60d" class="pw-post-body-paragraph ip iq hs ir b is kv iu iv iw kw iy iz ja kx jc jd je ky jg jh ji kz jk jl jm ha bi translated">首先，让我们快速回顾一下CameraX是什么。如果你已经熟悉CameraX，你可以跳过这一节。你也可以看看其他资源比如<a class="ae jn" href="https://www.youtube.com/watch?v=49lU1NtYE5g" rel="noopener ugc nofollow" target="_blank">本次Android开发者峰会</a>或者其<a class="ae jn" rel="noopener" href="/androiddevelopers/whats-new-in-camerax-fb8568d6ddc">相应的博文</a>。</p><h2 id="9a83" class="la jy hs bd jz lb lc ld kd le lf lg kh ja lh li kl je lj lk kp ji ll lm kt ln bi translated">设备兼容性</h2><p id="d405" class="pw-post-body-paragraph ip iq hs ir b is kv iu iv iw kw iy iz ja kx jc jd je ky jg jh ji kz jk jl jm ha bi translated">作为一个Jetpack库，CameraX不仅兼容运行API level 21及以上的Android设备，还兼容各种硬件设备，无论是外形、相机配置还是设备实现细节。</p><h2 id="d6ee" class="la jy hs bd jz lb lc ld kd le lf lg kh ja lh li kl je lj lk kp ji ll lm kt ln bi translated">生命周期意识</h2><p id="c152" class="pw-post-body-paragraph ip iq hs ir b is kv iu iv iw kw iy iz ja kx jc jd je ky jg jh ji kz jk jl jm ha bi translated">CameraX的一个核心特性是<a class="ae jn" href="https://developer.android.com/topic/libraries/architecture/lifecycle" rel="noopener ugc nofollow" target="_blank">生命周期感知</a>。我们只需将相机用例绑定到生命周期所有者，而不必手动打开和关闭相机。当相关的生命周期所有者(活动、片段等。)启动或停止，相机也是如此。</p><h2 id="c8d8" class="la jy hs bd jz lb lc ld kd le lf lg kh ja lh li kl je lj lk kp ji ll lm kt ln bi translated">CameraX用例</h2><p id="6eb3" class="pw-post-body-paragraph ip iq hs ir b is kv iu iv iw kw iy iz ja kx jc jd je ky jg jh ji kz jk jl jm ha bi translated">作为测试版的一部分，CameraX提供的主要用例有:</p><ul class=""><li id="f0e3" class="lo lp hs ir b is it iw ix ja lq je lr ji ls jm lt lu lv lw bi translated"><a class="ae jn" href="https://developer.android.com/training/camerax/preview" rel="noopener ugc nofollow" target="_blank"> <strong class="ir ht">预览</strong> </a>:用于显示相机指向的取景器。</li><li id="5a2e" class="lo lp hs ir b is lx iw ly ja lz je ma ji mb jm lt lu lv lw bi translated"><a class="ae jn" href="https://developer.android.com/training/camerax/analyze" rel="noopener ugc nofollow" target="_blank"> <strong class="ir ht"> ImageAnalysis </strong> </a>:用于解析来自摄像机流的信息。</li><li id="cbdc" class="lo lp hs ir b is lx iw ly ja lz je ma ji mb jm lt lu lv lw bi translated"><a class="ae jn" href="https://developer.android.com/training/camerax/take-photo" rel="noopener ugc nofollow" target="_blank"><strong class="ir ht"/></a>:用于拍摄高质量照片。</li></ul><figure class="jp jq jr js fd hj er es paragraph-image"><div class="er es mc"><img src="../Images/c8b41f07c474b1884714aa44f008b987.png" data-original-src="https://miro.medium.com/v2/resize:fit:1014/format:webp/1*R2DhPCGO9vsqEpQYN8pIlQ.png"/></div><figcaption class="jt ju et er es jv jw bd b be z dx">Portrait mode</figcaption></figure><h1 id="850b" class="jx jy hs bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">Beta版有什么变化？</h1><p id="110c" class="pw-post-body-paragraph ip iq hs ir b is kv iu iv iw kw iy iz ja kx jc jd je ky jg jh ji kz jk jl jm ha bi translated">自从我们上次讨论CameraX以来，一些事情已经发生了变化，这些变化可以在<a class="ae jn" href="http://developer.android.com/camerax" rel="noopener ugc nofollow" target="_blank">文档</a>、<a class="ae jn" href="http://g.co/camerax/sample" rel="noopener ugc nofollow" target="_blank">官方样本</a>或我们的<a class="ae jn" href="http://g.co/camerax/developers" rel="noopener ugc nofollow" target="_blank">在线开发者社区</a>中找到。</p><h2 id="8b59" class="la jy hs bd jz lb lc ld kd le lf lg kh ja lh li kl je lj lk kp ji ll lm kt ln bi translated">初始化</h2><p id="7556" class="pw-post-body-paragraph ip iq hs ir b is kv iu iv iw kw iy iz ja kx jc jd je ky jg jh ji kz jk jl jm ha bi translated">CameraX必须由开发人员通过<a class="ae jn" href="https://developer.android.com/reference/androidx/camera/lifecycle/ProcessCameraProvider" rel="noopener ugc nofollow" target="_blank"> ProcessCameraProvider </a>显式初始化，看起来像这样:</p><pre class="jp jq jr js fd md me mf mg aw mh bi"><span id="20d1" class="la jy hs me b fi mi mj l mk ml">val cameraProviderFuture: ListenableFuture&lt;ProcessCameraProvider&gt; =<br/>    ProcessCameraProvider.getInstance(context)</span><span id="8b22" class="la jy hs me b fi mm mj l mk ml">// The listener will be triggered once the future’s value is ready<br/>cameraProviderFuture.addListener(Runnable {</span><span id="52e7" class="la jy hs me b fi mm mj l mk ml">    // Camera provider is now guaranteed to be available<br/>    val cameraProvider = cameraProviderFuture.get()<br/>    …<br/>}, executor)</span></pre><h2 id="2ed3" class="la jy hs bd jz lb lc ld kd le lf lg kh ja lh li kl je lj lk kp ji ll lm kt ln bi translated">挑选相机</h2><p id="7ad4" class="pw-post-body-paragraph ip iq hs ir b is kv iu iv iw kw iy iz ja kx jc jd je ky jg jh ji kz jk jl jm ha bi translated">通过<a class="ae jn" href="https://developer.android.com/reference/androidx/camera/core/CameraSelector" rel="noopener ugc nofollow" target="_blank">相机选择器</a>来选择哪台相机将用于我们的用例。这是通过创建一个带有一组可选约束的<code class="du mn mo mp me b">CameraSelector</code>对象来实现的，然后CameraX将挑选最适合这些要求的可用摄像机:</p><pre class="jp jq jr js fd md me mf mg aw mh bi"><span id="3e0f" class="la jy hs me b fi mi mj l mk ml">val cameraSelector = CameraSelector.Builder()<br/>    .requireLensFacing(CameraSelector.LENS_FACING_BACK)<br/>    .build()</span></pre><p id="0394" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你想要一个简单的选择器来选择正面或背面，你可以使用静态字段<a class="ae jn" href="https://developer.android.com/reference/androidx/camera/core/CameraSelector#DEFAULT_BACK_CAMERA" rel="noopener ugc nofollow" target="_blank"> CameraSelector。DEFAULT_BACK_CAMERA </a>或<a class="ae jn" href="https://developer.android.com/reference/androidx/camera/core/CameraSelector#DEFAULT_FRONT_CAMERA" rel="noopener ugc nofollow" target="_blank">CAMERA select。默认_前置_摄像头</a>。</p><h2 id="b08c" class="la jy hs bd jz lb lc ld kd le lf lg kh ja lh li kl je lj lk kp ji ll lm kt ln bi translated">相机预览</h2><p id="0451" class="pw-post-body-paragraph ip iq hs ir b is kv iu iv iw kw iy iz ja kx jc jd je ky jg jh ji kz jk jl jm ha bi translated">尽管它在技术上不是测试版的一部分，但视图模块现在在alpha08中，并且<a class="ae jn" href="https://developer.android.com/reference/androidx/camera/view/PreviewView" rel="noopener ugc nofollow" target="_blank">预览视图</a>是实现相机预览的推荐方式。首先，将它添加到XML布局中:</p><pre class="jp jq jr js fd md me mf mg aw mh bi"><span id="1038" class="la jy hs me b fi mi mj l mk ml">&lt;androidx.camera.view.PreviewView<br/>    android:layout_width=”match_parent”<br/>    android:layout_height=”match_parent”/&gt;</span></pre><p id="c387" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然后，确保您的预览用例使用来自预览视图的表面:</p><pre class="jp jq jr js fd md me mf mg aw mh bi"><span id="98af" class="la jy hs me b fi mi mj l mk ml">val preview: Preview = …<br/>val viewFinder: PreviewView = … // for example findViewById()<br/>preview.setSurfaceProvider(viewFinder.previewSurfaceProvider)</span></pre><p id="9ce3" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你想使用你自己的表面(例如，从<code class="du mn mo mp me b">TextureView</code>开始)，那么你必须<a class="ae jn" href="https://developer.android.com/training/camerax/preview#manual" rel="noopener ugc nofollow" target="_blank">实现你自己的表面提供者</a>，同时确保你适当地处理尺寸和方向，这可能很棘手。</p><h2 id="44c1" class="la jy hs bd jz lb lc ld kd le lf lg kh ja lh li kl je lj lk kp ji ll lm kt ln bi translated">相机控制</h2><p id="d280" class="pw-post-body-paragraph ip iq hs ir b is kv iu iv iw kw iy iz ja kx jc jd je ky jg jh ji kz jk jl jm ha bi translated">您可以使用由<a class="ae jn" href="https://developer.android.com/reference/androidx/camera/lifecycle/ProcessCameraProvider#bindToLifecycle(androidx.lifecycle.LifecycleOwner,%20androidx.camera.core.CameraSelector,%20androidx.camera.core.UseCase...)" rel="noopener ugc nofollow" target="_blank">camera process provider . bindtolifecycle()</a>返回的camera对象来查询和修改相机的某些方面，如聚焦、变焦和闪光灯。例如，你可以通过<code class="du mn mo mp me b">CameraInfo</code>对象得到一个带有最新摄像机状态的<code class="du mn mo mp me b">LiveData</code>对象，如下所示:</p><pre class="jp jq jr js fd md me mf mg aw mh bi"><span id="f969" class="la jy hs me b fi mi mj l mk ml">val camera = cameraProvider.bindToLifecycle(…)<br/>val zoomState: LiveData&lt;ZoomState&gt; = camera.cameraInfo.zoomState<br/>val torchState: LiveData&lt;Int&gt; = camera.cameraInfo.torchState</span></pre><p id="a13d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">相反，您可以使用相应的<code class="du mn mo mp me b">CameraControl</code>对象来控制这些值:</p><pre class="jp jq jr js fd md me mf mg aw mh bi"><span id="ece3" class="la jy hs me b fi mi mj l mk ml">val camera = cameraProvider.bindToLifecycle(…)<br/>camera.cameraControl.enableTorch(true)<br/>camera.cameraControl.setLinearZoom(0.5f)<br/>camera.cameraControl.startFocusAndMetering(…)</span></pre><h1 id="ace3" class="jx jy hs bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">下一步是什么？</h1><p id="1eb3" class="pw-post-body-paragraph ip iq hs ir b is kv iu iv iw kw iy iz ja kx jc jd je ky jg jh ji kz jk jl jm ha bi translated">我们承认相机开发是困难的，并致力于通过以下方式使CameraX更容易使用:( a)继续投资CameraX测试套件;( b)向我们的自动化测试场添加新设备;( c)处理内部和外部的错误报告。我们鼓励您开始使用CameraX测试版，并加入我们，为我们所有的用户改进Android上的相机。</p><p id="1f3f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要了解更多关于CameraX的信息，请查看<a class="ae jn" href="http://developer.android.com/camerax" rel="noopener ugc nofollow" target="_blank">文档</a>和<a class="ae jn" href="http://g.co/camerax/sample" rel="noopener ugc nofollow" target="_blank">官方样本</a>，或者加入我们的<a class="ae jn" href="http://g.co/camerax/developers" rel="noopener ugc nofollow" target="_blank">在线开发者社区</a>。敬请关注未来的博客帖子和更新！</p></div></div>    
</body>
</html>