<html>
<head>
<title>Kotlin Multiplatform at HMRC</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">HMRC的科特林多平台</h1>
<blockquote>原文：<a href="https://blog.kotlin-academy.com/kotlin-multiplatform-at-hmrc-3e5e895c2fcc?source=collection_archive---------1-----------------------#2021-05-13">https://blog.kotlin-academy.com/kotlin-multiplatform-at-hmrc-3e5e895c2fcc?source=collection_archive---------1-----------------------#2021-05-13</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/e931e452a2aad36b189026017546f752.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Go2Aq6OWVDLvaJlnMqgQyw.jpeg"/></div></div></figure><p id="10d9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">大家好，我叫George Herbert，是HMRC移动应用团队的首席开发人员。HMRC是英国的税收、支付和海关当局。该应用程序帮助用户访问他们的帮助，以保存帐户，管理他们的税收抵免，以及审查他们的个人纳税情况等功能。该团队由iOS、Android和后端开发人员组成。我们鼓励所有开发人员尝试团队中的其他学科，这给了我们合理的交叉技能水平。我在团队中的角色是后端微服务的首席开发人员。</p><h2 id="de49" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">关于HMRC应用程序</h2><p id="3a55" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">HMRC的应用程序自2012年就已经存在，最初是一个简单的税收计算器。在2016年期间，该团队通过完善现有功能进行了重建，并为用户添加了登录和管理个人税务事务的能力，例如帮助他们保存账户或税收抵免。这意味着他们不必打电话给HMRC或填写任何表格。目前，我们每月有50万用户，用户平均每月回访7次。该应用面向个人税务用户，与同等的网络服务相比，它占个人税务领域总流量的50%。该应用程序最受欢迎和历史最悠久的功能之一是税收计算器。这方面的计算逻辑与web共享。网络和移动计算器加起来每年有570万次访问，其中移动设备占200万次。</p><p id="2c90" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">从科特林的角度来看，Android团队一直在逐步迁移应用程序。在撰写本文时，86%的应用程序是用科特林语编写的</p><h2 id="66a5" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">Kotlin多平台的使用</h2><p id="ce5a" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">大约18个月前，我的技术主管召开了一次会议，讨论使用Kotlin多平台(KMP)和其他技术来帮助简化和整合应用程序和服务中的业务逻辑。双方商定，HMRC移动应用团队将与凯捷合作，从simple开始，研究这款开源产品在应用中的应用可能性，并以此为起点。</p><p id="633e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们希望用户界面(UI)是本地的，因为这已经建成。我们还认为，构建一个可以共享的业务逻辑核心，不管选择什么样的UI，都可以让我们更容易地与web共享。</p><p id="d19e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如上所述，该应用程序的主要功能之一是能够根据你的工资、支付频率和税收代码计算出你的税收和税后工资的估计值。每年更新计算器需要数天的手动测试，以确保一切按预期工作，并且必须为每个平台完成！我们认为这是一个真正需要彻底改革的领域，以帮助维护，在每个新的纳税年度增加新的税级，并减少测试工作。挑战在于支持iOS、Android和web的任何新东西。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi lr"><img src="../Images/867ff7a346bd6fa33dae52e0f3e40003.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PwvqB3sAvquEZ2BZmKp2bg.jpeg"/></div></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk">Results screen of the tax calculator within the HMRC App for iOS and Android</figcaption></figure><p id="d65c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我不是Android开发者，甚至不是Kotlin开发者，我的背景是Scala开发者。我渴望学习科特林语，这似乎是一个好机会。几周之内，tax-kalculator(看看我们在那里做了什么)诞生了:一个Kotlin多平台库，覆盖率达98%，可以在Android和iOS上使用，甚至可以在web版本的tax calculator上使用。现在，添加新的纳税年度只需不到一个小时的时间，而且只需很少的人工测试，因此节省了我们数天的精力和时间。</p><p id="14bc" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">随着时间的推移，我们已经开始向该应用程序添加其他多平台方面，例如帮助节省计算器，它将帮助预测您作为该计划的一部分可以节省的金额。展望未来，我们正在研究KMP更复杂的用途，这将有助于减少重复，改善跨平台的用户体验。</p><h2 id="6458" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">了解KMP</h2><p id="dd15" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">当我们开始使用KMP时，我们作为一个团队经历了一些挑战。第一个是关于设置Gradle来支持平台，因为我们看到的每个例子都略有不同，我们使用的是Gradle.kts，在查看一个例子时它甚至更稀疏。随着KMP越来越受欢迎，围绕有限文档或过时示例的问题变得不那么困难了。此外，作为1.4.0的一部分，Gradle配置已经通过分层项目结构进行了简化，这使得它变得更加简单和直接。</p><figure class="ls lt lu lv gt jo gh gi paragraph-image"><div class="gh gi ma"><img src="../Images/9010e38d65a804d3db0dfe47a00a2534.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/1*RVOmcL6NdIyAGlQGs6_-Sg.gif"/></div><figcaption class="lw lx gj gh gi ly lz bd b be z dk">The struggle when looking for KMP examples, especially for gradle.kts</figcaption></figure><p id="12c5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们面临的一个挑战是，如何让iOS框架处于可以在我们的应用程序中使用的状态，而无需在Xcode构建中直接链接它们。该团队的一名iOS开发人员发现了一个shell脚本，我们将其添加到了CI中，它创建了这个脚本并将其导出到我们的GitHub。这个shell的一个例子在名为package-ios.sh的项目的存储库中。</p><p id="8911" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最后，iOS团队面临着在同一个iOS应用程序中使用多个KMP项目的挑战。这个问题已经在KMP的新版本中解决了。至于后者，我们暂时(直到1.3.70中添加了修复程序)将所有的KMP项目放在一个“超级”库中，这个库包含了iOS的所有KMP功能。</p><h2 id="3130" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">摘要</h2><p id="bbee" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">我的建议是，如果你想尝试KMP，从小事做起。例如，只需编写一些纯Kotlin的业务逻辑，不需要特定于平台的实现，所有代码都应该在commonMain中。这使得最初掌握KMP很简单，因为你不需要使用实际的和期望的关键字。一旦你对项目和它们的结构等感到满意，并且它们在你各自的应用程序中工作，期待展开你的翅膀进入更具挑战性的KMP(比如巩固你的网络逻辑和错误处理)。</p><p id="ad63" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我希望这很有趣。如果您对使用KMP或我们下面链接的项目有任何疑问，请随时在Twitter ( <a class="ae mb" href="https://twitter.com/georgeherby" rel="noopener ugc nofollow" target="_blank"> @georgeherby </a>)上给我发消息。</p></div><div class="ab cl mc md hr me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ig ih ii ij ik"><h1 id="4b1e" class="mj ku in bd kv mk ml mm ky mn mo mp lb mq mr ms le mt mu mv lh mw mx my lk mz bi translated">有用的链接</h1><h2 id="702b" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">HMRC KMP图书馆</h2><p id="c477" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">税务顾问</p><div class="na nb gp gr nc nd"><a href="https://github.com/hmrc/tax-kalculator/" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd io gy z fp ni fr fs nj fu fw im bi translated">hmrc/税务-审计员</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">首先创建一个Calculator实例，按照下面的例子传入值:默认值是…</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">github.com</p></div></div><div class="nm l"><div class="nn l no np nq nm nr jt nd"/></div></div></a></div><p id="7dbe" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">帮助拯救卡勒波特</p><div class="na nb gp gr nc nd"><a href="https://github.com/hmrc/help-to-save-kalculator" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd io gy z fp ni fr fs nj fu fw im bi translated">hmrc/救助-kalculator</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">这将返回CalculatorResponse类型的对象。这提供了最终结果的标题数字…</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">github.com</p></div></div><div class="nm l"><div class="ns l no np nq nm nr jt nd"/></div></div></a></div></div><div class="ab cl mc md hr me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ig ih ii ij ik"><h2 id="23cf" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">HMRC应用程序</h2><p id="2e04" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">游戏商店</p><div class="na nb gp gr nc nd"><a href="https://play.google.com/store/apps/details?id=uk.gov.hmrc.ptcalc&amp;hl=en_GB" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd io gy z fp ni fr fs nj fu fw im bi translated">HMRC-Google Play上的应用</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">这是唯一一款能让你获得HMRC个人税务信息的应用。感觉控制着你的…</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">play.google.com</p></div></div><div class="nm l"><div class="nt l no np nq nm nr jt nd"/></div></div></a></div><p id="b86f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">应用商店</p><div class="na nb gp gr nc nd"><a href="https://apps.apple.com/us/app/hmrc/id514561561" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd io gy z fp ni fr fs nj fu fw im bi translated">HMRC</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">这是唯一一款让您访问HMRC个人税务信息的应用程序。感觉控制着你的…</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">apps.apple.com</p></div></div><div class="nm l"><div class="nu l no np nq nm nr jt nd"/></div></div></a></div></div><div class="ab cl mc md hr me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ig ih ii ij ik"><h2 id="f093" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated"><strong class="ak">当你在这里的时候，一些额外的东西… </strong></h2><p id="fa7c" class="pw-post-body-paragraph jv jw in jx b jy lm ka kb kc ln ke kf kg lo ki kj kk lp km kn ko lq kq kr ks ig bi translated">最近，HMRC应用团队开源了其Android和iOS的UI组件，允许任何人构建具有与<a class="ae mb" href="https://design-system.service.gov.uk/" rel="noopener ugc nofollow" target="_blank"> GOV.UK设计系统</a>相同外观和感觉的无障碍应用。</p><p id="2d5e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Android组件</p><div class="na nb gp gr nc nd"><a href="https://github.com/hmrc/android-components" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd io gy z fp ni fr fs nj fu fw im bi translated">hmrc/Android-组件</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">使用具有HMRC外观的组件构建应用程序。将Github包存储库添加到您的顶层…</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">github.com</p></div></div><div class="nm l"><div class="nv l no np nq nm nr jt nd"/></div></div></a></div><p id="7da9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">iOS组件</p><div class="na nb gp gr nc nd"><a href="https://github.com/hmrc/ios-components" rel="noopener  ugc nofollow" target="_blank"><div class="ne ab fo"><div class="nf ab ng cl cj nh"><h2 class="bd io gy z fp ni fr fs nj fu fw im bi translated">hmrc/IOs-组件</h2><div class="nk l"><h3 class="bd b gy z fp ni fr fs nj fu fw dk translated">使用具有HMRC外观的组件构建应用程序。该库被设置为通过Swift包使用…</h3></div><div class="nl l"><p class="bd b dl z fp ni fr fs nj fu fw dk translated">github.com</p></div></div><div class="nm l"><div class="nw l no np nq nm nr jt nd"/></div></div></a></div></div></div>    
</body>
</html>