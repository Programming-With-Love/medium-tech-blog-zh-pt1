<html>
<head>
<title>Understanding migrations with Room</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">äº†è§£è¿ç§»ä¸ç©ºé—´</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/androiddevelopers/understanding-migrations-with-room-f01e04b07929?source=collection_archive---------0-----------------------#2017-07-18">https://medium.com/androiddevelopers/understanding-migrations-with-room-f01e04b07929?source=collection_archive---------0-----------------------#2017-07-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/f235272d6d97d2ed5437e42ae37934a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_6oobbwzRm7OFhv2UVlu4Q.png"/></div></div></figure><figure class="hq hr hs ht fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/f235272d6d97d2ed5437e42ae37934a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_6oobbwzRm7OFhv2UVlu4Q.png"/></div></div><figcaption class="hu hv et er es hw hx bd b be z dx">Flip the switch and migrate (<a class="ae hy" href="https://unsplash.com/photos/qAShc5SV83M" rel="noopener ugc nofollow" target="_blank">Source</a>)</figcaption></figure><div class=""/><p id="59cd" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">ç”¨SQLite APIæ‰§è¡Œæ•°æ®åº“è¿ç§»æ€»æ˜¯è®©æˆ‘è§‰å¾—æˆ‘åœ¨æ‹†é™¤ä¸€ä¸ªç‚¸å¼¹â€”â€”å¥½åƒæˆ‘å·®ä¸€æ­¥å°±è®©åº”ç”¨ç¨‹åºåœ¨æˆ‘çš„ç”¨æˆ·æ‰‹ä¸­çˆ†ç‚¸äº†ã€‚å¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨<a class="ae hy" href="https://developer.android.com/topic/libraries/architecture/room.html" rel="noopener ugc nofollow" target="_blank">æˆ¿é—´</a>æ¥å¤„ç†æ‚¨çš„æ•°æ®åº“æ“ä½œï¼Œè¿ç§»å°±åƒæ‰³åŠ¨å¼€å…³ä¸€æ ·ç®€å•ã€‚</p><p id="c046" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">æœ‰äº†Roomï¼Œå¦‚æœä½ æ›´æ”¹äº†æ•°æ®åº“æ¨¡å¼ä½†æ²¡æœ‰å‡çº§ç‰ˆæœ¬ï¼Œä½ çš„åº”ç”¨å°±ä¼šå´©æºƒã€‚å¦‚æœæ‚¨å‡çº§ç‰ˆæœ¬ä½†ä¸æä¾›ä»»ä½•è¿ç§»ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºå°†ä¼šå´©æºƒï¼Œæˆ–è€…æ•°æ®åº“è¡¨è¢«ä¸¢å¼ƒï¼Œæ‚¨çš„ç”¨æˆ·å°†ä¼šä¸¢å¤±æ•°æ®ã€‚ä¸è¦æ‹¿ä½ (åº”ç”¨ç¨‹åº)çš„ç”Ÿå‘½å†’é™©å»çŒœæµ‹wÌ¶hÌ¶iÌ¶cÌ¶hÌ¶Ì¶sÌ¶wÌ¶iÌ¶tÌ¶cÌ¶hÌ¶Ì¶tÌ¶oÌ¶Ì¶fÌ¶lÌ¶iÌ¶pÌ¶å¦‚ä½•å®ç°è¿ç§»ã€‚ç›¸åï¼Œè¦ç†è§£Roomçš„å†…éƒ¨å·¥ä½œæ–¹å¼ï¼Œä»¥ä¾¿æ”¾å¿ƒåœ°è¿ç§»æ‚¨çš„æ•°æ®åº“ã€‚</p><h1 id="97ce" class="jw jx ib bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">å¹•åæ•°æ®åº“è¿ç§»</h1><h2 id="f55e" class="ku jx ib bd jy kv kw kx kc ky kz la kg jj lb lc kk jn ld le ko jr lf lg ks lh bi translated">SQLite APIåšä»€ä¹ˆ</h2><p id="a069" class="pw-post-body-paragraph iy iz ib ja b jb li jd je jf lj jh ji jj lk jl jm jn ll jp jq jr lm jt ju jv ha bi translated">SQLiteæ•°æ®åº“åœ¨æ•°æ®åº“ç‰ˆæœ¬æ§åˆ¶çš„å¸®åŠ©ä¸‹å¤„ç†æ¨¡å¼å˜åŒ–ã€‚æ›´å‡†ç¡®åœ°è¯´ï¼Œæ¯æ¬¡é€šè¿‡æ·»åŠ ã€åˆ é™¤æˆ–ä¿®æ”¹è¡¨æ¥æ”¹å˜æ¨¡å¼æ—¶ï¼Œéƒ½å¿…é¡»å¢åŠ æ•°æ®åº“ç‰ˆæœ¬å·å¹¶æ›´æ–°<code class="du ln lo lp lq b">SQLiteOpenHelper.onUpgrade</code>æ–¹æ³•çš„å®ç°ã€‚è¿™å°±æ˜¯ä½ å¦‚ä½•å‘Šè¯‰SQLiteä»æ—§ç‰ˆæœ¬åˆ°æ–°ç‰ˆæœ¬éœ€è¦åšä»€ä¹ˆã€‚</p><p id="bf10" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">è¿™ä¹Ÿæ˜¯å½“æ‚¨çš„åº”ç”¨ç¨‹åºå¼€å§‹ä½¿ç”¨æ•°æ®åº“æ—¶è§¦å‘çš„ç¬¬ä¸€ä¸ªè°ƒç”¨ã€‚SQLiteå°†é¦–å…ˆå°è¯•å¤„ç†ç‰ˆæœ¬å‡çº§ï¼Œç„¶åæ‰æ‰“å¼€æ•°æ®åº“ã€‚</p><h2 id="ce5c" class="ku jx ib bd jy kv kw kx kc ky kz la kg jj lb lc kk jn ld le ko jr lf lg ks lh bi translated">å“ªä¸ªæˆ¿é—´æœ‰</h2><p id="65e7" class="pw-post-body-paragraph iy iz ib ja b jb li jd je jf lj jh ji jj lk jl jm jn ll jp jq jr lm jt ju jv ha bi translated">Roomä»¥<code class="du ln lo lp lq b"><a class="ae hy" href="https://developer.android.com/reference/android/arch/persistence/room/migration/Migration.html" rel="noopener ugc nofollow" target="_blank">Migration</a></code>ç±»çš„å½¢å¼æä¾›äº†ä¸€ä¸ªæŠ½è±¡å±‚æ¥ç®€åŒ–SQLiteè¿ç§»ã€‚ä¸€ä¸ª<code class="du ln lo lp lq b">Migration</code>ç±»å®šä¹‰äº†ä»ä¸€ä¸ªç‰¹å®šç‰ˆæœ¬è¿ç§»åˆ°å¦ä¸€ä¸ªç‰ˆæœ¬æ—¶åº”è¯¥æ‰§è¡Œçš„åŠ¨ä½œã€‚Roomä½¿ç”¨è‡ªå·±çš„<code class="du ln lo lp lq b">SQLiteOpenHelper</code>å®ç°ï¼Œå¹¶ä¸”åœ¨<code class="du ln lo lp lq b">onUpgrade</code>æ–¹æ³•ä¸­ï¼Œå°†è§¦å‘æ‚¨å®šä¹‰çš„è¿ç§»ã€‚</p><p id="9ff4" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">ä»¥ä¸‹æ˜¯æ‚¨ç¬¬ä¸€æ¬¡è®¿é—®æ•°æ®åº“æ—¶å‘ç”Ÿçš„æƒ…å†µ:</p><ol class=""><li id="1940" class="lr ls ib ja b jb jc jf jg jj lt jn lu jr lv jv lw lx ly lz bi translated">å»ºç«‹æˆ¿é—´æ•°æ®åº“</li><li id="c986" class="lr ls ib ja b jb ma jf mb jj mc jn md jr me jv lw lx ly lz bi translated"><code class="du ln lo lp lq b">SQLiteOpenHelper.onUpgrade</code>æ–¹æ³•è¢«è°ƒç”¨ï¼Œæˆ¿é—´è§¦å‘è¿ç§»</li><li id="9ab6" class="lr ls ib ja b jb ma jf mb jj mc jn md jr me jv lw lx ly lz bi translated">æ•°æ®åº“è¢«æ‰“å¼€</li></ol><p id="8a99" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">å¦‚æœæ‚¨ä¸æä¾›è¿ç§»ï¼Œä½†å¢åŠ äº†æ•°æ®åº“ç‰ˆæœ¬ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºå¯èƒ½ä¼šå´©æºƒï¼Œæˆ–è€…æ‚¨çš„æ•°æ®å¯èƒ½ä¼šä¸¢å¤±ï¼Œè¿™å–å†³äºæˆ‘ä»¬å°†åœ¨ä¸‹é¢è€ƒè™‘çš„ä¸€äº›æƒ…å†µã€‚</p><p id="d7dd" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">è¿ç§»å†…éƒ¨çš„ä¸€ä¸ªé‡è¦éƒ¨åˆ†æ˜¯ç”±ä¸€ä¸ª<code class="du ln lo lp lq b">identity hash String</code>æ‰®æ¼”çš„ï¼Œå®ƒè¢«Roomç”¨æ¥å”¯ä¸€åœ°æ ‡è¯†æ¯ä¸ªæ•°æ®åº“ç‰ˆæœ¬ã€‚å½“å‰ç‰ˆæœ¬çš„èº«ä»½å“ˆå¸Œä¿å­˜åœ¨æ•°æ®åº“ä¸­ç”±Roomç®¡ç†çš„é…ç½®è¡¨ä¸­ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨çœ‹åˆ°æ•°æ®åº“ä¸­çš„<code class="du ln lo lp lq b">room_master_table</code>è¡¨ï¼Œä¸è¦æ„Ÿåˆ°æƒŠè®¶ã€‚</p></div><div class="ab cl mf mg go mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ha hb hc hd he"><p id="0a36" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">è®©æˆ‘ä»¬ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ª<code class="du ln lo lp lq b">users</code>è¡¨ï¼Œæœ‰ä¸¤åˆ—:</p><ul class=""><li id="b923" class="lr ls ib ja b jb jc jf jg jj lt jn lu jr lv jv mm lx ly lz bi translated">ä¸€ä¸ªIDï¼Œ<code class="du ln lo lp lq b">int</code>ï¼Œä¹Ÿæ˜¯ä¸»é”®</li><li id="cb29" class="lr ls ib ja b jb ma jf mb jj mc jn md jr me jv mm lx ly lz bi translated">ä¸€ä¸ªç”¨æˆ·åï¼Œ<code class="du ln lo lp lq b">String</code></li></ul><p id="26b3" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated"><code class="du ln lo lp lq b">users</code>è¡¨æ˜¯ç‰ˆæœ¬ä¸º1çš„æ•°æ®åº“çš„ä¸€éƒ¨åˆ†ï¼Œä½¿ç”¨<code class="du ln lo lp lq b">SQLiteDatabase</code> APIå®ç°ã€‚</p><p id="5c46" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">è®©æˆ‘ä»¬å‡è®¾æ‚¨çš„ç”¨æˆ·å·²ç»åœ¨ä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬ï¼Œå¹¶ä¸”æ‚¨æƒ³å¼€å§‹ä½¿ç”¨Roomã€‚è®©æˆ‘ä»¬çœ‹çœ‹Roomå¦‚ä½•å¤„ç†ä¸€äº›åœºæ™¯ã€‚</p><h1 id="6865" class="jw jx ib bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">å°†SQLite APIä»£ç è¿ç§»åˆ°æˆ¿é—´</h1><p id="ebc9" class="pw-post-body-paragraph iy iz ib ja b jb li jd je jf lj jh ji jj lk jl jm jn ll jp jq jr lm jt ju jv ha bi translated">åœ¨<a class="ae hy" rel="noopener" href="/google-developers/7-steps-to-room-27a5fe5f99b2">å¦ä¸€ç¯‡æ–‡ç« </a>ä¸­ï¼Œæˆ‘ä»¬è®¨è®ºäº†å¦‚ä½•å°†æ‚¨çš„åº”ç”¨è¿ç§»åˆ°æˆ¿é—´ï¼Œè®©æˆ‘ä»¬åœ¨æ­¤åŸºç¡€ä¸Šæ›´æ·±å…¥åœ°äº†è§£æ•°æ®è¿ç§»çš„ç»†èŠ‚ã€‚è®©æˆ‘ä»¬å‡è®¾<code class="du ln lo lp lq b">User</code> <a class="ae hy" href="https://developer.android.com/topic/libraries/architecture/room.html#entities" rel="noopener ugc nofollow" target="_blank">å®ä½“ç±»</a>å’Œ<code class="du ln lo lp lq b">UserDao</code><a class="ae hy" href="https://developer.android.com/topic/libraries/architecture/room.html#daos" rel="noopener ugc nofollow" target="_blank">æ•°æ®è®¿é—®å¯¹è±¡ç±»</a>è¢«åˆ›å»ºï¼Œå¹¶ä¸”åªå…³æ³¨æ‰©å±•<code class="du ln lo lp lq b"><a class="ae hy" href="https://developer.android.com/reference/android/arch/persistence/room/RoomDatabase.html" rel="noopener ugc nofollow" target="_blank">RoomDatabase</a></code>çš„<code class="du ln lo lp lq b">UsersDatabase</code>ç±»ã€‚</p><pre class="hq hr hs ht fd mn lq mo mp aw mq bi"><span id="fb48" class="ku jx ib lq b fi mr ms l mt mu">@Database(entities = {User.class}, version = 1)<br/>public abstract class UsersDatabase extends RoomDatabase</span></pre></div><div class="ab cl mf mg go mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ha hb hc hd he"><h2 id="a553" class="ku jx ib bd jy kv kw kx kc ky kz la kg jj lb lc kk jn ld le ko jr lf lg ks lh bi translated">åœºæ™¯1:ä¿æŒæ•°æ®åº“ç‰ˆæœ¬ä¸å˜â€”â€”åº”ç”¨å´©æºƒ</h2><p id="28aa" class="pw-post-body-paragraph iy iz ib ja b jb li jd je jf lj jh ji jj lk jl jm jn ll jp jq jr lm jt ju jv ha bi translated">å¦‚æœæˆ‘ä»¬ä¿æŒæ•°æ®åº“ç‰ˆæœ¬ä¸å˜å¹¶è¿è¡Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œè¿™å°±æ˜¯Roomåœ¨å¹•ååšçš„äº‹æƒ…ã€‚</p><p id="a1e5" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">æ­¥éª¤1:å°è¯•æ‰“å¼€æ•°æ®åº“</p><ul class=""><li id="66e1" class="lr ls ib ja b jb jc jf jg jj lt jn lu jr lv jv mm lx ly lz bi translated">é€šè¿‡å°†å½“å‰ç‰ˆæœ¬çš„æ ‡è¯†å“ˆå¸Œä¸ä¿å­˜åœ¨room_master_tableä¸­çš„æ ‡è¯†å“ˆå¸Œè¿›è¡Œæ¯”è¾ƒï¼Œæ£€æŸ¥æ•°æ®åº“çš„æ ‡è¯†ã€‚ä½†æ˜¯ï¼Œç”±äºæ²¡æœ‰ä¿å­˜èº«ä»½å“ˆå¸Œï¼Œ<strong class="ja ic">åº”ç”¨ç¨‹åºä¼šå› <code class="du ln lo lp lq b">IllegalStateException</code> âŒè€Œå¯¼è‡´</strong>å´©æºƒ</li></ul><pre class="hq hr hs ht fd mn lq mo mp aw mq bi"><span id="e68c" class="ku jx ib lq b fi mr ms l mt mu">java.lang.IllegalStateException: Room cannot verify the data integrity. Looks like youâ€™ve changed schema but forgot to update the version number. You can simply fix this by increasing the version number.</span></pre><blockquote class="mv mw mx"><p id="da8a" class="iy iz my ja b jb jc jd je jf jg jh ji mz jk jl jm na jo jp jq nb js jt ju jv ha bi translated">å¦‚æœæ‚¨ä¿®æ”¹äº†æ•°æ®åº“æ¨¡å¼ä½†æ²¡æœ‰æ›´æ–°ç‰ˆæœ¬å·ï¼ŒRoomå°†æ€»æ˜¯æŠ›å‡º<code class="du ln lo lp lq b"><strong class="ja ic"><em class="ib">IllegalStateException</em></strong></code>ã€‚</p></blockquote><p id="268c" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">è®©æˆ‘ä»¬å¬ä¸€å¬é”™è¯¯å¹¶å¢åŠ æ•°æ®åº“ç‰ˆæœ¬ã€‚</p><pre class="hq hr hs ht fd mn lq mo mp aw mq bi"><span id="aaf3" class="ku jx ib lq b fi mr ms l mt mu">@Database(entities = {User.class}, <strong class="lq ic">version = 2</strong>)<br/>public abstract class UsersDatabase extends RoomDatabase</span></pre></div><div class="ab cl mf mg go mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ha hb hc hd he"><h2 id="fc54" class="ku jx ib bd jy kv kw kx kc ky kz la kg jj lb lc kk jn ld le ko jr lf lg ks lh bi translated">åœºæ™¯2:ç‰ˆæœ¬å¢åŠ ï¼Œä½†ä¸æä¾›è¿ç§»â€”åº”ç”¨å´©æºƒ</h2><p id="f81a" class="pw-post-body-paragraph iy iz ib ja b jb li jd je jf lj jh ji jj lk jl jm jn ll jp jq jr lm jt ju jv ha bi translated">ç°åœ¨ï¼Œå½“å†æ¬¡è¿è¡Œåº”ç”¨ç¨‹åºæ—¶ï¼ŒRoomæ­£åœ¨åšä»¥ä¸‹äº‹æƒ…:</p><p id="4eff" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">æ­¥éª¤1:å°è¯•ä»ç‰ˆæœ¬1(å®‰è£…åœ¨è®¾å¤‡ä¸Š)å‡çº§åˆ°ç‰ˆæœ¬2</p><ul class=""><li id="a634" class="lr ls ib ja b jb jc jf jg jj lt jn lu jr lv jv mm lx ly lz bi translated">ç”±äºæ²¡æœ‰è¿ç§»ï¼Œåº”ç”¨ç¨‹åºå› <code class="du ln lo lp lq b">IllegalStateException</code>è€Œå´©æºƒã€‚âŒ</li></ul><pre class="hq hr hs ht fd mn lq mo mp aw mq bi"><span id="760f" class="ku jx ib lq b fi mr ms l mt mu">java.lang.IllegalStateException: A migration from 1 to 2 is necessary. Please provide a Migration in the builder or call fallbackToDestructiveMigration in the builder in which case Room will re-create all of the tables.</span></pre><blockquote class="mv mw mx"><p id="c555" class="iy iz my ja b jb jc jd je jf jg jh ji mz jk jl jm na jo jp jq nb js jt ju jv ha bi translated">å¦‚æœä¸æä¾›è¿ç§»ï¼ŒRoomå°†æŠ›å‡ºä¸€ä¸ª<code class="du ln lo lp lq b"><em class="ib">IllegalStateException</em></code>ã€‚</p></blockquote></div><div class="ab cl mf mg go mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ha hb hc hd he"><h2 id="c071" class="ku jx ib bd jy kv kw kx kc ky kz la kg jj lb lc kk jn ld le ko jr lf lg ks lh bi translated">åœºæ™¯3:ç‰ˆæœ¬å¢åŠ ï¼Œæ”¯æŒå›é€€åˆ°ç ´åæ€§è¿ç§»â€”æ•°æ®åº“è¢«æ¸…é™¤</h2><p id="5e62" class="pw-post-body-paragraph iy iz ib ja b jb li jd je jf lj jh ji jj lk jl jm jn ll jp jq jr lm jt ju jv ha bi translated">å¦‚æœæ‚¨ä¸æƒ³æä¾›è¿ç§»ï¼Œå¹¶ä¸”æ‚¨æ˜ç¡®åœ°<strong class="ja ic">å¸Œæœ›åœ¨å‡çº§ç‰ˆæœ¬æ—¶</strong>æ¸…é™¤æ‚¨çš„æ•°æ®åº“ï¼Œè¯·åœ¨æ•°æ®åº“æ„å»ºå™¨ä¸­è°ƒç”¨<code class="du ln lo lp lq b">fallbackToDestructiveMigration</code>:</p><pre class="hq hr hs ht fd mn lq mo mp aw mq bi"><span id="a678" class="ku jx ib lq b fi mr ms l mt mu"><em class="my">database </em>= Room.<em class="my">databaseBuilder</em>(context.getApplicationContext(),<br/>                        UsersDatabase.class, "Sample.db")<br/>                .<strong class="lq ic">fallbackToDestructiveMigration()</strong><br/>                .build();</span></pre><p id="ef1f" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">ç°åœ¨ï¼Œå½“å†æ¬¡è¿è¡Œåº”ç”¨ç¨‹åºæ—¶ï¼ŒRoomæ­£åœ¨åšä»¥ä¸‹äº‹æƒ…:</p><p id="87f9" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">æ­¥éª¤1:å°è¯•ä»ç‰ˆæœ¬1(å®‰è£…åœ¨è®¾å¤‡ä¸Š)å‡çº§åˆ°ç‰ˆæœ¬2</p><ul class=""><li id="0d5f" class="lr ls ib ja b jb jc jf jg jj lt jn lu jr lv jv mm lx ly lz bi translated">å› ä¸ºæ²¡æœ‰è¿ç§»ï¼Œæˆ‘ä»¬é€€å›åˆ°ç ´åæ€§è¿ç§»ï¼Œæ‰€ä»¥<strong class="ja ic">è¡¨è¢«åˆ é™¤</strong>å¹¶ä¸”<code class="du ln lo lp lq b">identity_hash</code>è¢«æ’å…¥ã€‚ğŸ¤·</li></ul><p id="f9ec" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">æ­¥éª¤2:å°è¯•æ‰“å¼€æ•°æ®åº“</p><ul class=""><li id="5c5f" class="lr ls ib ja b jb jc jf jg jj lt jn lu jr lv jv mm lx ly lz bi translated">å½“å‰ç‰ˆæœ¬çš„èº«ä»½å“ˆå¸Œä¸ä¿å­˜åœ¨<code class="du ln lo lp lq b">room_master_table</code>ä¸­çš„èº«ä»½å“ˆå¸Œç›¸åŒã€‚âœ…</li></ul><p id="68e9" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">æ‰€ä»¥ç°åœ¨ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸ä¼šå´©æºƒï¼Œä½†æˆ‘ä»¬ä¼šä¸¢å¤±æ‰€æœ‰æ•°æ®ã€‚å› æ­¤ï¼Œè¯·ç¡®ä¿è¿™æ˜¯æ‚¨ç‰¹åˆ«å¸Œæœ›å¤„ç†è¿ç§»çš„æ–¹å¼ã€‚</p></div><div class="ab cl mf mg go mh" role="separator"><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk ml"/><span class="mi bw bk mj mk"/></div><div class="ha hb hc hd he"><h2 id="a5c0" class="ku jx ib bd jy kv kw kx kc ky kz la kg jj lb lc kk jn ld le ko jr lf lg ks lh bi translated">åœºæ™¯4:ç‰ˆæœ¬å¢åŠ ï¼Œæä¾›è¿ç§»â€”ä¿ç•™æ•°æ®</h2><p id="fb92" class="pw-post-body-paragraph iy iz ib ja b jb li jd je jf lj jh ji jj lk jl jm jn ll jp jq jr lm jt ju jv ha bi translated">ä¸ºäº†ä¿ç•™ç”¨æˆ·çš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦å®ç°è¿ç§»ã€‚ç”±äºæ¨¡å¼æ²¡æœ‰æ”¹å˜ï¼Œæˆ‘ä»¬åªéœ€è¦æä¾›ä¸€ä¸ª<strong class="ja ic">ç©ºè¿ç§»å®ç°</strong>å¹¶å‘Šè¯‰Roomä½¿ç”¨å®ƒã€‚</p><pre class="hq hr hs ht fd mn lq mo mp aw mq bi"><span id="27a3" class="ku jx ib lq b fi mr ms l mt mu">@Database(entities = {User.class},<strong class="lq ic"> </strong>version = 2)<br/>public abstract class UsersDatabase extends RoomDatabase {</span><span id="2319" class="ku jx ib lq b fi nc ms l mt mu">â€¦</span><span id="d891" class="ku jx ib lq b fi nc ms l mt mu">static final Migration <em class="my">MIGRATION_1_2 </em>= new Migration(1, 2) {<br/>    @Override<br/>    public void migrate(SupportSQLiteDatabase database) {<br/>        // Since we didn't alter the table, there's nothing else to do here.<br/>    }<br/>};</span><span id="1f95" class="ku jx ib lq b fi nc ms l mt mu">â€¦</span><span id="d719" class="ku jx ib lq b fi nc ms l mt mu">database =  Room.<em class="my">databaseBuilder</em>(context.getApplicationContext(),<br/>        UsersDatabase.class, "Sample.db")<br/>        <strong class="lq ic">.addMigrations(<em class="my">MIGRATION_1_2</em>)</strong><br/>        .build();</span></pre><p id="a886" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">è¿è¡Œåº”ç”¨ç¨‹åºæ—¶ï¼ŒRoomä¼šæ‰§è¡Œä»¥ä¸‹æ“ä½œ:</p><p id="9c6d" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">æ­¥éª¤1:å°è¯•ä»ç‰ˆæœ¬1(å®‰è£…åœ¨è®¾å¤‡ä¸Š)å‡çº§åˆ°ç‰ˆæœ¬2</p><ul class=""><li id="a35c" class="lr ls ib ja b jb jc jf jg jj lt jn lu jr lv jv mm lx ly lz bi translated">è§¦å‘äº†âœ…çš„ç©ºè¿ç§»</li><li id="9c6c" class="lr ls ib ja b jb ma jf mb jj mc jn md jr me jv mm lx ly lz bi translated">åœ¨<code class="du ln lo lp lq b">room_master_table</code> âœ…ä¸­æ›´æ–°èº«ä»½å“ˆå¸Œ</li></ul><p id="5adb" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">æ­¥éª¤2:å°è¯•æ‰“å¼€æ•°æ®åº“</p><ul class=""><li id="b094" class="lr ls ib ja b jb jc jf jg jj lt jn lu jr lv jv mm lx ly lz bi translated">å½“å‰ç‰ˆæœ¬çš„èº«ä»½å“ˆå¸Œä¸ä¿å­˜åœ¨<code class="du ln lo lp lq b">room_master_table</code>ä¸­çš„èº«ä»½å“ˆå¸Œç›¸åŒã€‚âœ…</li></ul><p id="7cab" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">æ‰€ä»¥ç°åœ¨ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ‰“å¼€ï¼Œç”¨æˆ·çš„æ•°æ®è¢«è¿ç§»ï¼ğŸ‰</p><h1 id="6964" class="jw jx ib bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">é€šè¿‡ç®€å•çš„æ¨¡å¼æ›´æ”¹è¿›è¡Œè¿ç§»</h1><p id="9a90" class="pw-post-body-paragraph iy iz ib ja b jb li jd je jf lj jh ji jj lk jl jm jn ll jp jq jr lm jt ju jv ha bi translated">è®©æˆ‘ä»¬é€šè¿‡ä¿®æ”¹<code class="du ln lo lp lq b">User</code>ç±»ï¼Œå°†å¦ä¸€åˆ—<code class="du ln lo lp lq b">last_update</code>æ·»åŠ åˆ°æˆ‘ä»¬çš„<code class="du ln lo lp lq b">users</code>è¡¨ä¸­ã€‚åœ¨<code class="du ln lo lp lq b">UsersDatabase</code>ç±»ä¸­æˆ‘ä»¬éœ€è¦åšå¦‚ä¸‹çš„ä¿®æ”¹:</p><p id="9415" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">1.å°†ç‰ˆæœ¬å¢åŠ åˆ°3</p><pre class="hq hr hs ht fd mn lq mo mp aw mq bi"><span id="c925" class="ku jx ib lq b fi mr ms l mt mu">@Database(entities = {User.class}, <strong class="lq ic">version = 3</strong>)<br/>public abstract class UsersDatabase extends RoomDatabase</span></pre><p id="1c05" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">2.æ·»åŠ ä»ç‰ˆæœ¬2åˆ°ç‰ˆæœ¬3çš„è¿ç§»</p><pre class="hq hr hs ht fd mn lq mo mp aw mq bi"><span id="9658" class="ku jx ib lq b fi mr ms l mt mu">static final Migration <em class="my">MIGRATION_2_3 </em>= new Migration(2, 3) {<br/>    @Override<br/>    public void migrate(SupportSQLiteDatabase database) {<br/>        database.execSQL("ALTER TABLE users "<br/>                + " ADD COLUMN last_update INTEGER");<br/>    }<br/>};</span></pre><p id="9c64" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">3.å°†è¿ç§»æ·»åŠ åˆ°æˆ¿é—´æ•°æ®åº“ç”Ÿæˆå™¨:</p><pre class="hq hr hs ht fd mn lq mo mp aw mq bi"><span id="d0d2" class="ku jx ib lq b fi mr ms l mt mu">database = Room.<em class="my">databaseBuilder</em>(context.getApplicationContext(),<br/>        UsersDatabase.class, "Sample.db")<br/><strong class="lq ic">        .addMigrations(<em class="my">MIGRATION_1_2</em>, <em class="my">MIGRATION_2_3</em>)<br/></strong>        .build();</span></pre><p id="d853" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">è¿è¡Œåº”ç”¨ç¨‹åºæ—¶ï¼Œéœ€è¦å®Œæˆä»¥ä¸‹æ­¥éª¤:</p><p id="b1cb" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">æ­¥éª¤1:å°è¯•ä»ç‰ˆæœ¬2(å®‰è£…åœ¨è®¾å¤‡ä¸Š)å‡çº§åˆ°ç‰ˆæœ¬3</p><ul class=""><li id="0e5d" class="lr ls ib ja b jb jc jf jg jj lt jn lu jr lv jv mm lx ly lz bi translated">è§¦å‘è¿ç§»å¹¶æ›´æ”¹è¡¨ï¼Œä¿æŒç”¨æˆ·æ•°æ®âœ…</li><li id="152c" class="lr ls ib ja b jb ma jf mb jj mc jn md jr me jv mm lx ly lz bi translated">æ›´æ–°<code class="du ln lo lp lq b">room_master_table</code> âœ…ä¸­çš„èº«ä»½å“ˆå¸Œ</li></ul><p id="8cbb" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">æ­¥éª¤2:å°è¯•æ‰“å¼€æ•°æ®åº“</p><ul class=""><li id="837b" class="lr ls ib ja b jb jc jf jg jj lt jn lu jr lv jv mm lx ly lz bi translated">å½“å‰ç‰ˆæœ¬çš„èº«ä»½å“ˆå¸Œä¸ä¿å­˜åœ¨<code class="du ln lo lp lq b">room_master_table</code>ä¸­çš„èº«ä»½å“ˆå¸Œç›¸åŒã€‚âœ…</li></ul><h1 id="cf47" class="jw jx ib bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">å…·æœ‰å¤æ‚æ¨¡å¼æ›´æ”¹çš„è¿ç§»</h1><p id="dd4f" class="pw-post-body-paragraph iy iz ib ja b jb li jd je jf lj jh ji jj lk jl jm jn ll jp jq jr lm jt ju jv ha bi translated">SQLiteçš„<code class="du ln lo lp lq b">ALTER TABLEâ€¦</code>å‘½ä»¤<a class="ae hy" href="https://sqlite.org/lang_altertable.html" rel="noopener ugc nofollow" target="_blank">ç›¸å½“æœ‰é™</a>ã€‚ä¾‹å¦‚ï¼Œå°†ç”¨æˆ·çš„idä»<code class="du ln lo lp lq b">int</code>æ›´æ”¹ä¸º<code class="du ln lo lp lq b">String</code>éœ€è¦å‡ ä¸ªæ­¥éª¤:</p><ul class=""><li id="1b07" class="lr ls ib ja b jb jc jf jg jj lt jn lu jr lv jv mm lx ly lz bi translated">ç”¨æ–°æ¨¡å¼åˆ›å»ºä¸€ä¸ªæ–°çš„ä¸´æ—¶è¡¨ï¼Œ</li><li id="d25f" class="lr ls ib ja b jb ma jf mb jj mc jn md jr me jv mm lx ly lz bi translated">å°†æ•°æ®ä»<code class="du ln lo lp lq b">users</code>è¡¨å¤åˆ¶åˆ°ä¸´æ—¶è¡¨ï¼Œ</li><li id="2867" class="lr ls ib ja b jb ma jf mb jj mc jn md jr me jv mm lx ly lz bi translated">æ”¾ä¸‹<code class="du ln lo lp lq b">users</code>æ¡Œå­</li><li id="4c3c" class="lr ls ib ja b jb ma jf mb jj mc jn md jr me jv mm lx ly lz bi translated">å°†ä¸´æ—¶è¡¨é‡å‘½åä¸º<code class="du ln lo lp lq b">users</code></li></ul><p id="b6af" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">ä½¿ç”¨Roomï¼Œè¿ç§»å®ç°å¦‚ä¸‹æ‰€ç¤º:</p><pre class="hq hr hs ht fd mn lq mo mp aw mq bi"><span id="1d35" class="ku jx ib lq b fi mr ms l mt mu">static final Migration <em class="my">MIGRATION_3_4 </em>= new Migration(3, 4) {<br/>    @Override<br/>    public void migrate(SupportSQLiteDatabase database) {<br/>        // Create the new table<br/>        database.execSQL(<br/>                "CREATE TABLE users_new (userid TEXT, username TEXT, last_update INTEGER, PRIMARY KEY(userid))");</span><span id="5b7f" class="ku jx ib lq b fi nc ms l mt mu">// Copy the data<br/>        database.execSQL(<br/>                "INSERT INTO users_new (userid, username, last_update) SELECT userid, username, last_update FROM users");</span><span id="ff51" class="ku jx ib lq b fi nc ms l mt mu">// Remove the old table<br/>        database.execSQL("DROP TABLE users");</span><span id="93c2" class="ku jx ib lq b fi nc ms l mt mu">// Change the table name to the correct one<br/>        database.execSQL("ALTER TABLE users_new RENAME TO users");<br/>    }<br/>};</span></pre><h1 id="1863" class="jw jx ib bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">å¤šä¸ªæ•°æ®åº“ç‰ˆæœ¬å¢é‡</h1><p id="e565" class="pw-post-body-paragraph iy iz ib ja b jb li jd je jf lj jh ji jj lk jl jm jn ll jp jq jr lm jt ju jv ha bi translated">å¦‚æœæ‚¨çš„ç”¨æˆ·æœ‰ä¸€ä¸ªæ—§ç‰ˆæœ¬çš„åº”ç”¨ç¨‹åºï¼Œè¿è¡Œæ•°æ®åº“ç‰ˆæœ¬1ï¼Œå¹¶å¸Œæœ›å‡çº§åˆ°ç‰ˆæœ¬4ï¼Œè¯¥æ€ä¹ˆåŠï¼Ÿåˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å®šä¹‰äº†ä»¥ä¸‹è¿ç§»:ç‰ˆæœ¬1åˆ°2ã€ç‰ˆæœ¬2åˆ°3ã€ç‰ˆæœ¬3åˆ°4ï¼Œæ‰€ä»¥Roomå°†ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°è§¦å‘æ‰€æœ‰è¿ç§»ã€‚</p><p id="de71" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">Roomå¯ä»¥å¤„ç†ä¸æ­¢ä¸€ä¸ªç‰ˆæœ¬å¢é‡:æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªä»ç‰ˆæœ¬1åˆ°ç‰ˆæœ¬4çš„å•æ­¥è¿ç§»ï¼Œä½¿å¾—è¿ç§»è¿‡ç¨‹æ›´å¿«ã€‚</p><pre class="hq hr hs ht fd mn lq mo mp aw mq bi"><span id="3bc3" class="ku jx ib lq b fi mr ms l mt mu">static final Migration <em class="my">MIGRATION_1_4 </em>= new Migration(1, 4) {<br/>    @Override<br/>    public void migrate(SupportSQLiteDatabase database) {<br/>        // Create the new table<br/>        database.execSQL(<br/>                "CREATE TABLE users_new (userid TEXT, username TEXT, last_update INTEGER, PRIMARY KEY(userid))");<br/>        <br/>        // Copy the data<br/>        database.execSQL(<br/>                "INSERT INTO users_new (userid, username, last_update) SELECT userid, username, last_update FROM users");</span><span id="7eed" class="ku jx ib lq b fi nc ms l mt mu">// Remove the old table<br/>        database.execSQL("DROP TABLE users");</span><span id="e301" class="ku jx ib lq b fi nc ms l mt mu">// Change the table name to the correct one<br/>        database.execSQL("ALTER TABLE users_new RENAME TO users");<br/>    }<br/>};</span></pre><p id="9947" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†å®ƒæ·»åŠ åˆ°è¿ç§»åˆ—è¡¨ä¸­:</p><pre class="hq hr hs ht fd mn lq mo mp aw mq bi"><span id="a34a" class="ku jx ib lq b fi mr ms l mt mu">database = Room.<em class="my">databaseBuilder</em>(context.getApplicationContext(),<br/>        UsersDatabase.class, "Sample.db")<br/>        .<strong class="lq ic">addMigrations</strong>(<em class="my">MIGRATION_1_2</em>, <em class="my">MIGRATION_2_3</em>, <em class="my">MIGRATION_3_4</em>, <strong class="lq ic"><em class="my">MIGRATION_1_4</em></strong>)<br/>        .build();</span></pre><blockquote class="mv mw mx"><p id="18bc" class="iy iz my ja b jb jc jd je jf jg jh ji mz jk jl jm na jo jp jq nb js jt ju jv ha bi translated">æ³¨æ„ï¼Œæ‚¨åœ¨<code class="du ln lo lp lq b"><em class="ib">Migration.migrate</em></code>å®ç°ä¸­ç¼–å†™çš„æŸ¥è¯¢åœ¨è¿è¡Œæ—¶ä¸ä¼šè¢«ç¼–è¯‘ï¼Œè¿™ä¸æ‚¨çš„Daoä¸­çš„æŸ¥è¯¢ä¸åŒã€‚ç¡®ä¿æ‚¨æ­£åœ¨<a class="ae hy" rel="noopener" href="/google-developers/testing-room-migrations-be93cdb0d975">ä¸ºæ‚¨çš„è¿ç§»</a>å®ç°æµ‹è¯•ã€‚</p></blockquote><h1 id="14ed" class="jw jx ib bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">ç»™æˆ‘çœ‹çœ‹ä»£ç </h1><p id="0255" class="pw-post-body-paragraph iy iz ib ja b jb li jd je jf lj jh ji jj lk jl jm jn ll jp jq jr lm jt ju jv ha bi translated">æ‚¨å¯ä»¥åœ¨è¿™ä¸ªç¤ºä¾‹åº”ç”¨ç¨‹åºä¸­æŸ¥çœ‹<a class="ae hy" href="https://github.com/googlesamples/android-architecture-components" rel="noopener ugc nofollow" target="_blank">çš„å®ç°ã€‚ä¸ºäº†ä¾¿äºæ¯”è¾ƒï¼Œæ¯ä¸ªæ•°æ®åº“ç‰ˆæœ¬éƒ½ä»¥è‡ªå·±çš„æ–¹å¼å®ç°:</a></p><ol class=""><li id="59ee" class="lr ls ib ja b jb jc jf jg jj lt jn lu jr lv jv lw lx ly lz bi translated"><a class="ae hy" href="https://github.com/googlesamples/android-architecture-components/tree/master/PersistenceMigrationsSample/app/src/sqlite/java/com/example/android/persistence/migrations" rel="noopener ugc nofollow" target="_blank"> <strong class="ja ic"> sqlite </strong> </a> â€”ä½¿ç”¨sqliteOpenHelperå’Œä¼ ç»Ÿçš„SQLiteæ¥å£ã€‚</li><li id="6ad9" class="lr ls ib ja b jb ma jf mb jj mc jn md jr me jv lw lx ly lz bi translated"><a class="ae hy" href="https://github.com/googlesamples/android-architecture-components/tree/master/PersistenceMigrationsSample/app/src/room/java/com/example/android/persistence/migrations" rel="noopener ugc nofollow" target="_blank"> <strong class="ja ic">æˆ¿é—´</strong> </a> â€”ç”¨æˆ¿é—´æ›¿æ¢å®ç°ï¼Œå¹¶æä¾›åˆ°ç‰ˆæœ¬2çš„è¿ç§»</li><li id="5eaf" class="lr ls ib ja b jb ma jf mb jj mc jn md jr me jv lw lx ly lz bi translated"><a class="ae hy" href="https://github.com/googlesamples/android-architecture-components/tree/master/PersistenceMigrationsSample/app/src/room2/java/com/example/android/persistence/migrations" rel="noopener ugc nofollow" target="_blank"> <strong class="ja ic"> room2 </strong> </a> â€”å°†æ•°æ®åº“æ›´æ–°åˆ°æ–°çš„æ¨¡å¼ï¼Œç‰ˆæœ¬3</li><li id="40e2" class="lr ls ib ja b jb ma jf mb jj mc jn md jr me jv lw lx ly lz bi translated"><a class="ae hy" href="https://github.com/googlesamples/android-architecture-components/tree/master/PersistenceMigrationsSample/app/src/room3/java/com/example/android/persistence/migrations" rel="noopener ugc nofollow" target="_blank"> <strong class="ja ic"> room3 </strong> </a> â€”å°†DBæ›´æ–°åˆ°æ–°çš„ç‰ˆæœ¬4ã€‚æä¾›ä»ç‰ˆæœ¬2åˆ°ç‰ˆæœ¬3ã€ç‰ˆæœ¬3åˆ°ç‰ˆæœ¬4ä»¥åŠç‰ˆæœ¬1åˆ°ç‰ˆæœ¬4çš„è¿ç§»è·¯å¾„ã€‚</li></ol><h1 id="fa86" class="jw jx ib bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">ç»“è®º</h1><p id="2be4" class="pw-post-body-paragraph iy iz ib ja b jb li jd je jf lj jh ji jj lk jl jm jn ll jp jq jr lm jt ju jv ha bi translated">ä½ çš„æ¨¡å¼æ”¹å˜äº†å—ï¼Ÿåªéœ€å¢åŠ æ•°æ®åº“ç‰ˆæœ¬å¹¶ç¼–å†™æ–°çš„<code class="du ln lo lp lq b"><a class="ae hy" href="https://developer.android.com/reference/android/arch/persistence/room/migration/Migration.html" rel="noopener ugc nofollow" target="_blank">Migration</a></code>å®ç°ã€‚ä½ å°†ç¡®ä¿ä½ çš„åº”ç”¨ä¸ä¼šå´©æºƒï¼Œä½ çš„ç”¨æˆ·æ•°æ®ä¸ä¼šä¸¢å¤±ã€‚å°±åƒæ‰³åŠ¨å¼€å…³ä¸€æ ·ç®€å•ï¼</p><p id="60b1" class="pw-post-body-paragraph iy iz ib ja b jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv ha bi translated">ä½†æ˜¯ï¼Œä½ æ€ä¹ˆçŸ¥é“ä½ æ˜¯å¦æŒ‰å¯¹äº†å¼€å…³å‘¢ï¼Ÿæ‚¨å¦‚ä½•æµ‹è¯•æ‚¨æ˜¯å¦æ­£ç¡®åœ°ä»æ‚¨çš„<code class="du ln lo lp lq b">SQLiteDatabase</code>å®ç°è¿ç§»åˆ°äº†Roomï¼Œæ‚¨æ˜¯å¦åœ¨ä¸åŒçš„æ•°æ®åº“ç‰ˆæœ¬ä¹‹é—´å®ç°äº†æ­£ç¡®çš„è¿ç§»ï¼Œæˆ–è€…æ‚¨çš„æ•°æ®åº“æ˜¯å¦ç¡®å®åœ¨ç‰¹å®šç‰ˆæœ¬ä¸­æ­£å¸¸å¯åŠ¨ï¼Ÿæˆ‘ä»¬è¯¦ç»†è®¨è®ºäº†<a class="ae hy" href="https://developer.android.com/topic/libraries/architecture/room.html#db-migration-testing" rel="noopener ugc nofollow" target="_blank">æµ‹è¯•è¿ç§»</a>ï¼Œè¿™é‡Œæ¶µç›–äº†å‡ ç§ä¸åŒçš„åœºæ™¯:</p><div class="hg hh ez fb hi nd"><a rel="noopener follow" target="_blank" href="/google-developers/testing-room-migrations-be93cdb0d975"><div class="ne ab dw"><div class="nf ab ng cl cj nh"><h2 class="bd ic fi z dy ni ea eb nj ed ef ia bi translated">æµ‹è¯•å®¤è¿ç§»</h2><div class="nk l"><h3 class="bd b fi z dy ni ea eb nj ed ef dx translated">åœ¨ä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘è§£é‡Šäº†å¸¦æˆ¿é—´çš„æ•°æ®åº“è¿ç§»æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚æˆ‘ä»¬çœ‹åˆ°ä¸€ä¸ªä¸æ­£ç¡®çš„â€¦</h3></div><div class="nl l"><p class="bd b fp z dy ni ea eb nj ed ef dx translated">medium.com</p></div></div><div class="nm l"><div class="nn l no np nq nm nr ho nd"/></div></div></a></div></div></div>    
</body>
</html>