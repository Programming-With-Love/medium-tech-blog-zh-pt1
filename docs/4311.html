<html>
<head>
<title>How to handle Navigation in Jetpack Compose</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Jetpack Compose中处理导航</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/how-to-handle-navigation-in-jetpack-compose-a9ac47f7f975?source=collection_archive---------1-----------------------#2020-09-22">https://medium.com/google-developer-experts/how-to-handle-navigation-in-jetpack-compose-a9ac47f7f975?source=collection_archive---------1-----------------------#2020-09-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex ie if ig ih er es paragraph-image"><div role="button" tabindex="0" class="ii ij di ik bf il"><div class="er es et"><img src="../Images/1efcbc5de148f49a8385c6d54d36ea06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IjXRLGfAQlpDdAt3fUT9DQ.jpeg"/></div></div></figure><p id="f5e5" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">自从我开始使用Jetpack Compose以来，我就爱上了它，有这么多新的方法来创建交互式UI，只需几行代码，不需要样板文件，绑定视图时不需要NullPointers，以及任何像我们以前使用的东西。</p><p id="a037" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">在花了一些时间理解compose的整个概念来创建声明性UI之后，我开始问自己如何使用它来处理导航，然后我开始阅读示例应用程序并理解它是如何完成的，在这篇文章中，我将向您展示如何在正式方法出现之前使用导航。</p><p id="2c8a" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">我们将使用的所有代码都是从官方的jetpack compose示例中提取的，更多关于<strong class="iq hi"> jetSnack </strong>和<strong class="iq hi"> Owl </strong>应用程序，因为它们提供的导航器处理多个backstacks。</p><h1 id="9003" class="jm jn hh bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">我们过去如何处理导航</h1><p id="a233" class="pw-post-body-paragraph io ip hh iq b ir kk it iu iv kl ix iy iz km jb jc jd kn jf jg jh ko jj jk jl ha bi translated">在Jetpack Compose之前，我们使用导航组件库、简单堆栈库、intents或FragmentManager本身来处理导航。</p><p id="ba74" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">使用jetpack导航的导航看起来像这样</p><figure class="kq kr ks kt fd ih er es paragraph-image"><div role="button" tabindex="0" class="ii ij di ik bf il"><div class="er es kp"><img src="../Images/b78a03bb5fe40d956412dc2441dc43fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9bZuBb2U2F2ZsgjrKfNfiQ.png"/></div></div></figure><p id="56ef" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">这就是我们实际上如何使用多个目的地进行导航，概念是一个活动和多个片段，导航组件库处理弹出片段并将它们推入堆栈的所有backstack逻辑，这是当今处理导航的一个非常有用和简单的API，但随着Jetpack Compose的出现，事情变得有些不同。</p><h1 id="3602" class="jm jn hh bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">碎片呢？</h1><p id="1b4b" class="pw-post-body-paragraph io ip hh iq b ir kk it iu iv kl ix iy iz km jb jc jd kn jf jg jh ko jj jk jl ha bi translated">这里描述了Jetpack Compose中片段的概念<a class="ae ku" href="https://developer.android.com/jetpack/compose/interop" rel="noopener ugc nofollow" target="_blank"/>，基本上，在片段中我们没有扩展<strong class="iq hi"> setContent { } </strong>，当我们创建一个新的Jetpack Compose示例时，我们通常在活动组件中有这个扩展，相反，我们需要向我们的片段添加一个<strong class="iq hi"> ComposeView </strong>，它用于将<strong class="iq hi"> setContent { } </strong>捆绑到片段中，并开始处理它。</p><p id="78e6" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">在此之后，我们可以开始在我们的片段中编写我们的<strong class="iq hi"> @Composable </strong>函数，但是请记住，如果我们在片段中编写可组合函数，我们还需要用我们的可组合函数来处理片段生命周期，这将使我们很难不容易出现问题。</p><h1 id="d3e7" class="jm jn hh bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">Jetpack Compose怎么样？</h1><p id="b4f4" class="pw-post-body-paragraph io ip hh iq b ir kk it iu iv kl ix iy iz km jb jc jd kn jf jg jh ko jj jk jl ha bi translated">在Jetpack Compose中，composable不依赖于生命周期(它们只存在到合成结束，因此，任何连接到这些composable的观察者也会死亡)，这很好，因为我们只在MainActivity中托管composable，并且我们只关心编写我们的视图。</p><h2 id="137f" class="kv jn hh bd jo kw kx ky js kz la lb jw iz lc ld ka jd le lf ke jh lg lh ki li bi translated">快速笔记</h2><p id="3d21" class="pw-post-body-paragraph io ip hh iq b ir kk it iu iv kl ix iy iz km jb jc jd kn jf jg jh ko jj jk jl ha bi translated">以一种干净的方式编写可组合体的重要性是非常重要的，因为我们想要用可组合体函数实现的是移除我们可以移除的许多可组合体的状态(状态提升)，这样做我们可以在可组合体树中只拥有一些或一个依赖于状态的可组合体，使其余的可组合体无状态，这对于避免可组合体需要重新组合时出现任何问题非常重要。</p><p id="df6d" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">当我们讨论Jetpack Compose中的导航时，我们不会讨论片段或活动，我们会讨论将视图弹出并推送到当前屏幕，这是我们接下来要做的。</p><p id="78a4" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">没有任何片段，只有1个活动，我们将建立一个2屏幕的应用程序，处理导航，backstack和没有片段。</p><h2 id="1c87" class="kv jn hh bd jo kw kx ky js kz la lb jw iz lc ld ka jd le lf ke jh lg lh ki li bi translated">重要的</h2><p id="f157" class="pw-post-body-paragraph io ip hh iq b ir kk it iu iv kl ix iy iz km jb jc jd kn jf jg jh ko jj jk jl ha bi translated">由于现在提供的所有这些示例都运行在1.0.0-alpha03版本的Jetpack Compose上，这可能会有利于新的Compose版本，同时请记住，Jetpack导航团队将在未来开发一个易于使用的API来将其与Jetpack Compose集成，使所有导航比我们现在看到的更简单。</p><blockquote class="lj lk ll"><p id="5c82" class="io ip lm iq b ir is it iu iv iw ix iy ln ja jb jc lo je jf jg lp ji jj jk jl ha bi translated">下面提供的示例从官方的jetpack compose示例报告中提取了导航代码。</p></blockquote><h1 id="999f" class="jm jn hh bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">如何处理导航</h1><p id="b817" class="pw-post-body-paragraph io ip hh iq b ir kk it iu iv kl ix iy iz km jb jc jd kn jf jg jh ko jj jk jl ha bi translated">让我们开始编写我们的应用程序，这个应用程序是一个民意调查应用程序，我目前正在我的公共回购中工作，你可以在这里查看</p><div class="lq lr ez fb ls lt"><a href="https://github.com/gastsail/JetExample" rel="noopener  ugc nofollow" target="_blank"><div class="lu ab dw"><div class="lv ab lw cl cj lx"><h2 class="bd hi fi z dy ly ea eb lz ed ef hg bi translated">gast sail/jet示例</h2><div class="ma l"><h3 class="bd b fi z dy ly ea eb lz ed ef dx translated">这是一个存储库，展示了如何通过例子创建UI的不同部分。了解如何创建不同的…</h3></div><div class="mb l"><p class="bd b fp z dy ly ea eb lz ed ef dx translated">github.com</p></div></div><div class="mc l"><div class="md l me mf mg mc mh im lt"/></div></div></a></div><p id="b04b" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">该应用程序被称为JetPoll，是一个交互式投票应用程序，用户可以创建投票，其他人可以投票，它使用Firebase来存储投票并注册所有的互动，目前，这个应用程序是<strong class="iq hi"> WIP </strong>，所以应用程序的任何变化都将在回购上更新。</p><figure class="kq kr ks kt fd ih er es paragraph-image"><div class="er es mi"><img src="../Images/59c3430f065fdb19b804531b74b905ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/1*RDTMMGrrpuIzL_w2COpJPA.jpeg"/></div></figure><p id="cd0c" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">我们要做的是添加导航到<strong class="iq hi">创建</strong>投票按钮，导航到另一个屏幕，让用户创建一个投票</p><p id="ae5d" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">由于本文不会讨论如何创建组件，而是讨论如何处理导航，所以我将讨论导航本身，而不是如何创建这个UI。</p><h1 id="1930" class="jm jn hh bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">定义导航器</h1><p id="e223" class="pw-post-body-paragraph io ip hh iq b ir kk it iu iv kl ix iy iz km jb jc jd kn jf jg jh ko jj jk jl ha bi translated">首先，我们需要做的是定义我们的Navigator类，这个类将处理我们当前导航的backstack，并将</p><p id="8984" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">我们将要使用的导航器可以在官方Jetpack Compose示例repo的OWL示例中找到。</p><div class="lq lr ez fb ls lt"><a href="https://github.com/android/compose-samples/blob/master/Owl/app/src/main/java/com/example/owl/ui/utils/Navigation.kt" rel="noopener  ugc nofollow" target="_blank"><div class="lu ab dw"><div class="lv ab lw cl cj lx"><h2 class="bd hi fi z dy ly ea eb lz ed ef hg bi translated">Android/compose-示例</h2><div class="ma l"><h3 class="bd b fi z dy ly ea eb lz ed ef dx translated">官方喷气背包组成样本。在GitHub上创建一个帐户，为android/compose-samples开发做贡献。</h3></div><div class="mb l"><p class="bd b fp z dy ly ea eb lz ed ef dx translated">github.com</p></div></div><div class="mc l"><div class="mj l me mf mg mc mh im lt"/></div></div></a></div><figure class="kq kr ks kt fd ih"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="548b" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">首先，这个导航器有两个参数，第一个是初始目的地，我们将这个目的地称为Home目的地，这是我们应用程序的第一个屏幕，然后它有一个backDispatcher，这个负责处理back按钮按下和处理backstack视图的弹出。</p><p id="989c" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">说了这么多，关于这个类就没有更多的了，它所做的是用<strong class="iq hi"> navigate() </strong>方法获取导航并将其添加到backstack，然后在backButton按下或调用<strong class="iq hi"> back() </strong>方法时弹出backstack。</p><p id="dd8e" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">在我们定义了这个之后，我们需要做的是创建一个NavGraph，类似于我们使用Jetpack导航所做的事情，但是没有XML。</p><h1 id="3919" class="jm jn hh bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">导航图</h1><figure class="kq kr ks kt fd ih"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="c663" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated"><strong class="iq hi">导航图</strong>负责知道我们想去哪里，在这个例子中，我们只定义了一个名为Destination的密封类，这个类将包含我们当前的目的地，在这个例子中，我有2个，Home目的地和CreatePoll目的地(在主屏幕上按下<strong class="iq hi"> Create </strong> poll按钮后我需要去的那个)</p><p id="5051" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">在那之后，有一个<strong class="iq hi"> Actions </strong>类，它使用我们之前编写的<strong class="iq hi"> Navigator </strong>和<strong class="iq hi"> Destinations </strong>初始化，这个Actions类将负责定义我们在应用程序中导航到某个屏幕的操作。</p><p id="5a01" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">这实际上已经完成了80%的工作，接下来我们需要添加的是另一个东西，它将帮助我们测量屏幕的插入内容，以填充将被称为另一个屏幕的新的可组合内容。</p><h1 id="20db" class="jm jn hh bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">显示插图</h1><figure class="kq kr ks kt fd ih"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="f4d3" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">作为它提供的文档</p><blockquote class="mm"><p id="94c8" class="mn mo hh bd mp mq mr ms mt mu mv jl dx translated">将任何[WindowInsetsCompat]值应用于[InsetsAmbient]，然后这些值在[content]中*可用。*@param consumeWindowInsets设置是否使用分派给*主机视图的任何[windowinsets compat]。默认为“真”。</p></blockquote><p id="613a" class="pw-post-body-paragraph io ip hh iq b ir mw it iu iv mx ix iy iz my jb jc jd mz jf jg jh na jj jk jl ha bi translated">关于这个类没有太多要说的，它将只测量我们正在导航的当前组件，并且只接受<strong class="iq hi">ProvideDisplayInsets</strong>Composable中的组件</p><h1 id="0a36" class="jm jn hh bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">让我们创建导航</h1><p id="c6bf" class="pw-post-body-paragraph io ip hh iq b ir kk it iu iv kl ix iy iz km jb jc jd kn jf jg jh ko jj jk jl ha bi translated">现在我们已经在<strong class="iq hi"> NavGraph </strong>文件中拥有了导航和定义目的地所需的所有类，我们准备开始在当前代码中实现它</p><p id="00ca" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">首先，在我们的MainActivity中，我们需要使用on<em class="lm">onBackPressedDispatcher</em>来启动我们的Composable，它会知道我们何时进行backPress，传递这个Dispatcher可以让我们处理backPress按钮并在其中应用逻辑。</p><h2 id="fef8" class="kv jn hh bd jo kw kx ky js kz la lb jw iz lc ld ka jd le lf ke jh lg lh ki li bi translated">主要活动</h2><figure class="kq kr ks kt fd ih"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="fd64" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">既然我们已经通过了<em class="lm">onBackPressedDispatcher</em>，现在我们需要创建到PollMain可组合件中的导航。</p><h2 id="fa24" class="kv jn hh bd jo kw kx ky js kz la lb jw iz lc ld ka jd le lf ke jh lg lh ki li bi translated">波尔曼</h2><figure class="kq kr ks kt fd ih"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="fcca" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">这是最重要的一步，这里我们将定义我们的<strong class="iq hi">导航器</strong>，正如你可以看到的，第一行代码用我们在<strong class="iq hi">导航图</strong>上提供的<strong class="iq hi">目的地</strong>定义了<strong class="iq hi">导航器</strong>，然后我们使用<strong class="iq hi">rememberSavedInstanceState</strong>，这真的很棒，因为它在进程死亡后仍然存在！！</p><p id="4167" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">然后导航器定义保护程序，这就是我之前说过的，我们传递<em class="lm"> onBackPressedDispatcher </em>，它将被配置为处理backstack的弹出。</p><p id="0f71" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">现在，我们需要初始化我们的<strong class="iq hi">导航器</strong>，我们将用Home目的地初始化它，所以弹出的第一个屏幕是Home屏幕</p><p id="2878" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">然后，我们创建一个动作变量，它将记住我们的动作(当前导航屏幕),并负责将我们的新目的地推入我们的屏幕。</p><p id="7709" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">最后，我们提供了<strong class="iq hi">BackStackDispatcherAmbient</strong>来处理backstack，然后是我们之前讨论过的ProvideDisplayInsets，这个函数只是将Composables作为它的子对象。</p><p id="c19e" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">这里，<strong class="iq hi"> CrossFade </strong>将在<strong class="iq hi"> navigator.current </strong>上播放一个更好的CrossFade动画，它代表了我们将要进行的新导航</p><p id="01aa" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">最后，我们已经有了目的地！！我们使用when()表达式来膨胀一个或另一个，这种膨胀将由我们之前创建的操作引起，现在，例如，我的主屏幕有Create按钮，我只需要当我按下该按钮来执行我们在<strong class="iq hi">导航图</strong>中定义的<strong class="iq hi">操作. createPoll </strong>即可。</p><h2 id="8dff" class="kv jn hh bd jo kw kx ky js kz la lb jw iz lc ld ka jd le lf ke jh lg lh ki li bi translated">波尔霍姆</h2><figure class="kq kr ks kt fd ih"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="94de" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">最后，我们只是将点击传播到持有创建按钮的<strong class="iq hi"> CreatePollComponent </strong>,我们需要处理与它的交互</p><h2 id="7dae" class="kv jn hh bd jo kw kx ky js kz la lb jw iz lc ld ka jd le lf ke jh lg lh ki li bi translated">CreatePollComponent</h2><figure class="kq kr ks kt fd ih"><div class="bz dy l di"><div class="mk ml l"/></div></figure><p id="9a75" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">仅此而已！，当我们按下Create时，我们将导航到我们的<strong class="iq hi"> CreatePollScreen() </strong>，它现在只显示一个文本</p><h2 id="3d62" class="kv jn hh bd jo kw kx ky js kz la lb jw iz lc ld ka jd le lf ke jh lg lh ki li bi translated">创建PollScreen</h2><figure class="kq kr ks kt fd ih"><div class="bz dy l di"><div class="mk ml l"/></div></figure><h1 id="5ae9" class="jm jn hh bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">输出</h1><figure class="kq kr ks kt fd ih er es paragraph-image"><div role="button" tabindex="0" class="ii ij di ik bf il"><div class="er es nb"><img src="../Images/6c3993cb41a315357a2edfd2031aa4e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/1*2kKCpJcrEJSS11s734ENJQ.gif"/></div></div></figure><p id="82be" class="pw-post-body-paragraph io ip hh iq b ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl ha bi translated">所有这些代码都可以在我的资源库中找到，我会保持它的最新状态，你也可以在那里找到许多Jetpack Compose示例组件，repo在这里</p><div class="lq lr ez fb ls lt"><a href="https://github.com/gastsail/JetExample" rel="noopener  ugc nofollow" target="_blank"><div class="lu ab dw"><div class="lv ab lw cl cj lx"><h2 class="bd hi fi z dy ly ea eb lz ed ef hg bi translated">gast sail/jet示例</h2><div class="ma l"><h3 class="bd b fi z dy ly ea eb lz ed ef dx translated">这是一个存储库，展示了如何通过例子创建UI的不同部分。了解如何创建不同的…</h3></div><div class="mb l"><p class="bd b fp z dy ly ea eb lz ed ef dx translated">github.com</p></div></div><div class="mc l"><div class="md l me mf mg mc mh im lt"/></div></div></a></div></div></div>    
</body>
</html>