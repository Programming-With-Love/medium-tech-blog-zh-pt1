<html>
<head>
<title>Using Ceph Distributed Storage Cluster on Oracle Cloud Infrastructure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Oracle云基础设施上使用Ceph分布式存储集群</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/using-ceph-distributed-storage-cluster-on-bare-metal-cloud-services-8738b9070410?source=collection_archive---------1-----------------------#2017-07-18">https://medium.com/oracledevs/using-ceph-distributed-storage-cluster-on-bare-metal-cloud-services-8738b9070410?source=collection_archive---------1-----------------------#2017-07-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="62e0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">本教程描述了使用Oracle Linux操作系统在Oracle云基础架构(OCI)上部署Ceph分布式存储集群环境的步骤。</p><p id="4868" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如<a class="ae jc" href="https://docs.oracle.com/cd/E52668_01/E66514/E66514.pdf" rel="noopener ugc nofollow" target="_blank">公共文档</a>中所述，Ceph在Oracle Linux上完全受支持。</p><p id="dd7a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">作为OCI上的一个附加配置选项，您可以将所有Ceph资源保存在单个可用性域(AD)中，或者使用所有AD。根据网络流量利用率，在单个AD中获取所有资源或使用跨不同可用性域的分布式选项来实现容错可能更好。</p><p id="557d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是一个可以在OCI上使用的Ceph分布式存储集群架构的示例</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/c22cdb55daf6352706cdd7fece70432a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IZhqnAy4yeLxlRVK.png"/></div></div></figure><h1 id="ce35" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">什么是Ceph分布式存储集群？</h1><p id="7f3c" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated"><a class="ae jc" href="https://ceph.com/" rel="noopener ugc nofollow" target="_blank"> Ceph </a>是一个广泛使用的开源存储平台，它提供了高性能、可靠性和可伸缩性。Ceph free分布式存储系统为对象、块和文件级存储提供了一个接口。</p><p id="125a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本教程中，您将在Oracle Linux 7上安装和构建一个Ceph集群。x具有以下组件:</p><ul class=""><li id="5454" class="ks kt hh ig b ih ii il im ip ku it kv ix kw jb kx ky kz la bi translated">Ceph OSD(Ceph-OSD)—处理数据存储、数据复制和恢复，Ceph集群需要至少两台基于Oracle Linux的Ceph OSD服务器</li><li id="bd4a" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">Ceph Monitor (ceph-mon) —监控集群状态、OSD图和CRUSH图。</li><li id="8241" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">ceph元数据服务器(ceph-mds) —这是将Ceph用作文件系统所必需的。</li></ul><p id="6af1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">更多细节可以在Ceph <a class="ae jc" href="http://docs.ceph.com/docs/master/" rel="noopener ugc nofollow" target="_blank">公共文档</a>中找到，在进行初始配置之前，首先理解它们是很重要的。</p><h1 id="2be1" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">环境</h1><ul class=""><li id="d167" class="ks kt hh ig b ih kn il ko ip lg it lh ix li jb kx ky kz la bi translated">5个服务器节点，全部采用Oracle Linux 7。x已安装。</li><li id="6d6a" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">所有节点上的Root权限。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lj"><img src="../Images/515953b52126d7aacb5bc4ffa54729bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y85GMNSGH6hJbVL68NsmEQ.png"/></div></div></figure><h1 id="b23f" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">入门指南</h1><p id="1ec9" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">首先，本教程基于“如何在CentOS 7上构建Ceph分布式存储集群”<a class="ae jc" href="https://www.howtoforge.com/tutorial/how-to-build-a-ceph-cluster-on-centos-7/" rel="noopener ugc nofollow" target="_blank">文章</a>。其次，对于此设置，您需要按照上面的环境表中的说明配置至少五个Oracle裸机实例，以及两个额外的块存储卷，稍后将用作Ceph数据存储。确保在每个新实例上连接了所有数据块存储卷，运行iscsi命令。查看我们的<a class="ae jc" href="https://docs.us-phoenix-1.oraclecloud.com/Content/GSG/Tasks/addingstorage.htm?Highlight=_netdev" rel="noopener ugc nofollow" target="_blank">裸机公共文档添加块卷会话</a>以了解更多详细信息，并特别注意“_netdev和no fail”fstab选项，以防您需要使用它们。</p><h1 id="7a23" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">Ceph配置</h1><p id="2e01" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">在这一步中，您将配置所有五个节点，为安装Ceph集群做好准备。您必须在所有节点上遵循并运行以下所有命令。</p><h1 id="aa8a" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">创建一个Ceph用户</h1><p id="698c" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">在所有节点上创建一个名为“cephuser”的新用户。</p><blockquote class="lk"><p id="8b5d" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ sudo useradd-d/home/CEP huser-m CEP huser<br/>$ sudo passwd CEP huser</p></blockquote><p id="9f73" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">创建新用户后，您需要为“cephuser”配置sudo。他必须能够以root用户身份运行命令，并且无需密码即可获得root用户权限。</p><p id="1576" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">运行下面的命令为用户创建一个sudoers文件，并用sed编辑/etc/sudoers文件。</p><blockquote class="lk"><p id="edc1" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ sudo visudo</p></blockquote><p id="a633" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">在文件的底部添加以下内容</p><blockquote class="lk"><p id="7917" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">##cephuser sudo权限<br/>cephuser ALL =(root)no passwd:ALL</p></blockquote><p id="6109" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">保存并退出vim。</p><h1 id="92ef" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">安装和配置NTP</h1><p id="344b" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">安装NTP以同步所有节点上的日期和时间。运行ntpdate命令以通过NTP协议设置日期和时间，我们将使用美国池NTP服务器。然后启动并使NTP服务器在引导时运行。</p><blockquote class="lk"><p id="43df" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ sudo yum install-y NTP NTP date NTP-doc<br/>$ sudo NTP date 0.us.pool.ntp.org<br/>$ sudo HW clock—systohc<br/>$ sudo system CTL enable ntpd . service<br/>$ sudo system CTL start ntpd . service</p></blockquote><h1 id="76fc" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka lz kc kd ke ma kg kh ki mb kk kl km bi translated">禁用SELinux</h1><p id="16ce" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">通过使用sed流编辑器编辑SELinux配置文件，在所有节点上禁用SELinux。</p><blockquote class="lk"><p id="d088" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ sudo sed-I ' s/SELINUX = enforcing/SELINUX = disabled/g '/etc/SELINUX/config</p></blockquote><h1 id="6d80" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka lz kc kd ke ma kg kh ki mb kk kl km bi translated">DNS配置</h1><p id="b617" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">在OCI上，内部DNS无需任何额外配置即可工作。测试网络连接，确保您的Ceph主机可以相互ping通，如下所示。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mc"><img src="../Images/c16aa38368ba2046973fc3c7e56d8344.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OeLayU_EXH86ps60.png"/></div></div></figure><p id="3c1b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果失败，请修改您的裸机安全列表以允许内部通信。编辑VCN安全列表，或者打开裸机内部网络(非公共网络)的所有端口，如下所示，用于网络172.0.0.0/16</p><p id="db73" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">资料来源:172.0.0.0/16</p><p id="2789" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">IP协议:所有协议</p><p id="9306" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">允许:所有端口的所有流量</p><p id="a97f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">或者仅在需要时指定特定端口。</p><h1 id="958b" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">配置SSH服务器</h1><p id="5189" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">在此步骤中，您将配置ceph-admin节点。登录到ceph-admin节点，成为“cephuser”。</p><blockquote class="lk"><p id="87bf" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ ssh-I public _ ssh _ key OPC @ ceph-admin-bmcs-public _ IP<br/>$ sudo su-cephuser</p></blockquote><p id="3f75" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">admin节点用于安装和配置所有集群节点，因此ceph-admin节点上的用户必须拥有无需密码即可连接到所有节点的权限。</p><p id="b2d5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您必须在“ceph-admin”节点上为“cephuser”配置无密码SSH访问。默认情况下，在OCI只有opc用户包含在所有机器上验证的密钥，所以你需要为cephuser帐户生成一个例外。为此，将以下内容添加到/etc/ssh/sshd_config文件的底部。</p><blockquote class="lk"><p id="ea3b" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">##将ssh密码验证权限添加到cephuser <br/>匹配用户cephuser <br/>密码验证是</p></blockquote><p id="53a1" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">保存并退出vim。重启ssh以验证更改。</p><blockquote class="lk"><p id="913e" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ sudo服务sshd重新启动</p></blockquote><p id="b52f" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">现在您已经准备好进行下一步了。为“cephuser”生成ssh密钥。</p><p id="73f5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将密码留空。</p><p id="dd79" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，为ssh配置创建配置文件。</p><p id="9e7a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">粘贴下面的配置:</p><blockquote class="lk"><p id="0410" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">主机ceph-admin <br/>主机名ceph-admin <br/>用户cephuser <br/> <br/>主机mon1 <br/>主机名mon1 <br/>用户cephuser <br/> <br/>主机osd1 <br/>主机名osd1 <br/>用户cephuser <br/> <br/>主机osd2 <br/>主机名osd2 <br/>用户cephuser <br/> <br/>主机客户端<br/>主机名客户端<br/>用户cephuser</p></blockquote><p id="39ac" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">在OCI上使用Ceph分布式存储集群</p><p id="e91b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">保存文件并更改配置文件的权限。</p><blockquote class="lk"><p id="451e" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ chmod 644 ~/。ssh/config</p></blockquote><p id="94de" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">现在，使用ssh-copy-id命令向所有节点添加SSH密钥。</p><blockquote class="lk"><p id="642e" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ ssh-keyscan OS D1 OS D2 mon 1 client &gt; &gt;~/。ssh/known _ hosts<br/>$ ssh-copy-id OS D1<br/>$ ssh-copy-id OS D2<br/>$ ssh-copy-id mon 1<br/>$ ssh-copy-id客户端</p></blockquote><p id="6f8c" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">完成后，尝试从ceph-admin节点访问osd1服务器。</p><h1 id="1a5d" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">配置防火墙d</h1><p id="25a2" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">您将使用防火墙来保护系统。在这一步中，您将打开ceph-admon、ceph-mon和ceph-osd所需的端口。</p><p id="4873" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">连接到ceph-admin并打开端口80、2003和4505–4506，然后重新加载防火墙，如下所示</p><blockquote class="lk"><p id="f7c5" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ sudo firewall-cmd-zone = public-add-port = 80/TCP-permanent<br/>$ sudo firewall-cmd-zone = public-add-port = 2003/TCP-permanent<br/>$ sudo firewall-cmd-zone = public-add-port = 4505–4506/TCP-permanent<br/>$ sudo firewall-cmd-reload</p></blockquote><p id="4e08" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">从ceph-admin节点，登录到监控节点“mon1 ”,打开ceph监控节点上的新端口，然后重新加载防火墙..</p><blockquote class="lk"><p id="f853" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ sudo firewall-cmd-zone = public-add-port = 6789/TCP-permanent<br/>$ sudo firewall-cmd-reload</p></blockquote><p id="fc3d" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">最后，在每个osd节点(osd1和osd2)上打开端口6800–7300。您可以从ceph-admin节点登录到每个osd节点，或者如果您使用公共IP网络，也可以通过裸机实例公共IP登录到每个OSD节点。</p><blockquote class="lk"><p id="d905" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ sudo firewall-cmd-zone = public-add-port = 6800–7300/TCP-permanent<br/>$ sudo firewall-cmd-reload</p></blockquote><h1 id="ef46" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka lz kc kd ke ma kg kh ki mb kk kl km bi translated">配置Ceph OSD节点</h1><p id="9406" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">在本教程中，我们有两个OSD节点，每个节点有两个分区。</p><ul class=""><li id="77db" class="ks kt hh ig b ih ii il im ip ku it kv ix kw jb kx ky kz la bi translated">根分区的/dev/sda。</li><li id="2d89" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">/dev/sdb是一个空分区— 50GB(附加iSCSI块存储卷)。</li></ul><p id="c167" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您将对Ceph磁盘使用/dev/sdb。从ceph-admin节点，登录到所有OSD节点，用XFS格式化/dev/sdb分区。</p><blockquote class="lk"><p id="bff5" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ sudo parted-s/dev/sdb mklabel GPT mkpart primary xfs 0% 100%<br/>$ sudo mkfs . xfs/dev/sdb-f</p></blockquote><p id="7674" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">现在检查分区，您将得到xfs /dev/sdb分区。</p><blockquote class="lk"><p id="9c83" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ sudo bl kid-o value-s TYPE/dev/sdb</p></blockquote><h1 id="8234" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka lz kc kd ke ma kg kh ki mb kk kl km bi translated">构建Ceph集群</h1><p id="a536" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">在这一步中，您将从ceph-admin节点在所有节点上安装Ceph。</p><h1 id="c5f1" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">在ceph-admin节点上安装ceph-deploy</h1><p id="0250" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">登录ceph-admin节点。</p><p id="7c6b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，您需要在Oracle Linux上启用Ceph YUM Repo，这是禁用的。</p><blockquote class="lk"><p id="1763" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ sudo VI/etc/yum . repos . d/public-yum-ol7 . repo</p></blockquote><p id="14c5" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">搜索“ol7_ceph”并启用它(“enabled=1”)</p><p id="8046" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">保存并退出vim。</p><p id="1161" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，用yum命令安装ceph-deply，并确保所有节点都已更新。</p><blockquote class="lk"><p id="ee61" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ sudo yum更新-y &amp;&amp; sudo yum安装ceph-deploy -y</p></blockquote><p id="ab70" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">安装完ceph-deploy工具后，为ceph集群配置创建一个新目录。</p><blockquote class="lk"><p id="befd" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ sudo mkdir/cluster<br/>$ CD/cluster/</p></blockquote><p id="7145" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">接下来，使用“ceph-deploy”命令创建一个新的集群配置，并将监视节点定义为“mon1”。</p><p id="2790" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">用vim编辑ceph.conf文件，并在[global]块下粘贴下面的配置。</p><blockquote class="lk"><p id="bd94" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">#您的网络地址<br/>公共网络= 172.0.0.0/16 <br/> osd池默认大小= 2</p></blockquote><p id="c574" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">保存文件并退出vim。</p><h1 id="cbe5" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">在所有节点上安装Ceph</h1><p id="8931" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">现在，使用下面的单个命令，从ceph-admin节点在所有其他节点上安装Ceph。</p><blockquote class="lk"><p id="bf26" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ ceph-deploy install ceph-admin mon 1 OS D1 OS D2</p></blockquote><p id="efaa" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">该命令将自动在所有节点上安装Ceph:mon 1、OS D1–3和ceph-admin，这需要一些时间。</p><p id="c349" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在在mon1节点上部署ceph-mon。</p><blockquote class="lk"><p id="2a4f" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ ceph-部署mon创建-初始</p></blockquote><p id="92b2" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">该命令将创建监视器密钥，使用“ceph”命令检查并获取密钥。</p><blockquote class="lk"><p id="9e54" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ ceph-部署gatherkeys mon1</p></blockquote><h1 id="2a00" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka lz kc kd ke ma kg kh ki mb kk kl km bi translated">将OSDS添加到集群</h1><p id="8892" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">当所有节点上都安装了Ceph后，就可以将OSD守护进程添加到集群中。OSD守护进程将在磁盘/dev/sdb上创建它们的数据和日志分区</p><blockquote class="lk"><p id="b4bc" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ ceph-部署磁盘列表osd1 osd2</p></blockquote><figure class="me mf mg mh mi ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es md"><img src="../Images/5e944e0be9c56accbf68fe6684629147.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*X4A_zZGixX9ubRjr.png"/></div></div></figure><p id="c277" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你会看到如上所示的XFS格式的/dev/sdb磁盘。</p><p id="eb07" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，用zap选项删除所有节点上的/dev/sdb分区表。该命令将删除Ceph OSD节点上/dev/sdb中的所有数据。</p><blockquote class="lk"><p id="28aa" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ ceph-deploy disk zap OS D1:/dev/sdb OS D2:/dev/sdb</p></blockquote><p id="c2dd" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">现在准备所有OSDS节点，并确保结果中没有错误。</p><blockquote class="lk"><p id="6d76" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ ceph-部署osd准备osd1:/dev/sdb osd2:/dev/sdb</p></blockquote><p id="5473" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">如果您看到osd 1–2已准备好使用OSD的结果，则部署成功。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mj"><img src="../Images/bf878c271e1e0db06a1c357c26370fe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EiScy8GVYY2VxwQX.png"/></div></div></figure><p id="6b39" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用以下命令激活OSDs:</p><blockquote class="lk"><p id="72a1" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ ceph-deploy OSD activate OS D1:/dev/SD B1 OS D2:/dev/SD B1</p></blockquote><p id="4b97" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">在继续之前，请检查输出是否有错误。现在，您可以使用list命令检查OSD节点上的sdb磁盘。</p><blockquote class="lk"><p id="2300" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ ceph-部署磁盘列表osd1 osd2</p></blockquote><figure class="me mf mg mh mi ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es mk"><img src="../Images/3f693fa7e292415072014e2b7564afe0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KrRmuSBovbc5T9jZ.png"/></div></div></figure><p id="9d79" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">结果是/dev/sdb现在有两个分区:</p><ul class=""><li id="69fb" class="ks kt hh ig b ih ii il im ip ku it kv ix kw jb kx ky kz la bi translated">/dev/sdb1 — Ceph数据</li><li id="9e2e" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">/dev/sdb2 — Ceph日志</li></ul><p id="28ec" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">或者您可以使用fdisk在OSD节点上直接检查。</p><blockquote class="lk"><p id="e6df" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ ssh OS D1<br/>$ sudo fdisk-l/dev/sdb</p></blockquote><p id="f280" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">接下来，将管理密钥部署到所有关联的节点。</p><blockquote class="lk"><p id="c2c0" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ ceph-部署管理ceph-管理mon1 osd1 osd2</p></blockquote><p id="6f9f" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">通过在所有节点上运行以下命令来更改密钥文件的权限。</p><blockquote class="lk"><p id="002a" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ sudo chmod 644/etc/ceph/ceph . client . admin . key ring</p></blockquote><h1 id="91a9" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka lz kc kd ke ma kg kh ki mb kk kl km bi translated">测试您的Ceph设置</h1><p id="b3a4" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">您已经安装并创建了新的Ceph集群，然后向集群添加了OSDS节点。现在，您可以测试集群并确保集群设置中没有错误。</p><p id="aa3b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从ceph-admin节点，登录到ceph监控服务器“mon1”。</p><p id="346d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">检查集群运行状况。</p><blockquote class="lk"><p id="3c3a" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ sudo ceph健康</p></blockquote><p id="8bcd" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">健康状况良好</p><p id="72ac" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">检查集群状态</p><blockquote class="lk"><p id="034e" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ sudo ceph-s<br/>cluster 66 ADB 950–1 fc 4–447 b-9898–6b 6 CD 7 c 45 a 40<br/>HEALTH HEALTH _ OK<br/>monmap E1:1 mons at { mon 1 = 172 . 0 . 0 . 28:6789/0 }<br/>选举时期3，quorum 0 mon 1<br/>OSD map E10:2 osds:2 up，2 in <br/>标志按位排序<br/> pgmap v21: 64</p></blockquote><p id="3b54" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">确保Ceph运行状况良好，如上所示，并且有一个IP地址为“172.0.0.28”的监控节点“mon1”。应该有2个OSD服务器，并且都应该启动并运行，应该有一个大约100GB — 2x50GB Ceph数据分区的可用磁盘。</p><p id="de61" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您的新Ceph集群设置已经完成。现在，你准备好使用你的新Ceph块设备。</p><h1 id="e318" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">配置Ceph客户端节点</h1><p id="8e88" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">在本节中，您将把我们的Oracle Linux 7.x服务器配置为Ceph客户机，并将Ceph客户机配置为其他Ceph节点(mon-osd)。</p><p id="babd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过Ceph管理节点或使用裸机实例公共IP登录到Ceph客户端节点。然后添加一个新的“cephuser”帐户，并为该用户设置一个新密码。</p><blockquote class="lk"><p id="0fe4" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ sudo useradd-d/home/CEP huser-m CEP huser<br/>$ sudo passwd CEP huser</p></blockquote><p id="5144" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">重复visudo过程，禁用selinux并配置NTP，如上所述。</p><p id="f14c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">确保可以像前面对其他节点所做的那样，从ceph-admin ssh到客户机实例。</p><blockquote class="lk"><p id="b859" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ ssh客户端<br/> $ [cephuser@client ~]$</p></blockquote><h1 id="2b8e" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka lz kc kd ke ma kg kh ki mb kk kl km bi translated">在客户端节点上安装Ceph</h1><p id="b761" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">在这一步中，您将从ceph-admin节点在客户机节点(充当客户机节点的节点)上安装Ceph。</p><p id="53a8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过ssh以root用户身份登录到ceph-admin节点，并成为su的“cephuser”。转到Ceph集群目录，你使用了'<strong class="ig hi">集群的</strong>目录。</p><blockquote class="lk"><p id="d66f" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ su — cephuser <br/>最后登录:GMT 2017年7月18日星期二21:25:25 pts/0<br/>$ CD/cluster/</p></blockquote><p id="da05" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">使用ceph-deploy在客户机节点上安装Ceph，然后将配置和管理密钥推送到客户机节点。</p><blockquote class="lk"><p id="014f" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ ceph-部署安装客户端<br/>$ ceph-部署管理客户端</p></blockquote><p id="2ca1" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">Ceph安装需要一些时间(取决于服务器和网络速度)。任务完成后，连接到客户端节点，并更改管理密钥的权限。</p><blockquote class="lk"><p id="2b79" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ ssh客户端<br/>$ sudo chmod 644/etc/ceph/ceph . client . admin . key ring</p></blockquote><p id="85b0" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">客户端节点上已经安装了Ceph。</p><h1 id="578d" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">将Ceph配置和安装为块设备</h1><p id="6b8e" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">Ceph允许用户将Ceph集群用作精简配置的块设备。您可以像在系统上安装普通硬盘一样安装Ceph存储器。Ceph块存储或Ceph RADOS块存储(RBD)将块设备映像存储为一个对象，它自动在整个Ceph集群中条带化和复制我们的数据。Ceph RBD已经与KVM集成，因此您也可以在各种虚拟化平台上将它用作块存储。</p><p id="ba12" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在客户端节点上创建新的数据块设备之前，您必须按上述方式检查群集状态。登录到Ceph monitor节点并检查集群状态。</p><p id="c4fb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请确保集群运行状况为“运行状况良好”，并且pgmap为“活动且干净”。</p><p id="b542" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">确认您准备好继续进行客户端配置后。在本教程中，您将使用Ceph作为客户机服务器上的块设备或块存储，并使用Oracle Linux 7作为客户机节点操作系统。从ceph-admin节点，使用ssh连接到客户机节点。因为您为该节点配置了无密码登录，所以不需要密码。</p><p id="5c85" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Ceph提供了用于管理rados块设备映像的rbd命令。您可以使用rbd命令创建新的映像、调整大小、创建快照以及导出我们的块设备。</p><p id="b77a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本教程中，您将创建一个大小为40GB的新rbd映像，然后检查“disk01”在rbd列表中是否可用。</p><blockquote class="lk"><p id="2a03" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ rbd创建磁盘01 —大小40960 <br/> $ rbd ls -l <br/>名称大小父FMT PROT锁<br/>磁盘01 40960 m2<br/>[ceph user @ client ~]$</p></blockquote><p id="ee13" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">接下来，激活rbd内核模块。</p><blockquote class="lk"><p id="7d60" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ sudo modprobe rbd <br/> $ sudo rbd特性禁用disk01独占锁定对象映射快速差分深度展平</p></blockquote><p id="841f" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">现在，通过rbd内核模块将disk01映像映射到一个块设备，然后确保disk01在映射设备列表中。</p><blockquote class="lk"><p id="d103" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ sudo rbd map disk 01<br/>/dev/rbd 0<br/>$ rbd show mapped<br/>id池映像快照设备<br/> 0 rbd disk01 — /dev/rbd0</p></blockquote><p id="e9e4" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">您可以看到，disk01映像已被映射为“/dev/rbd0”设备。在使用它存储数据之前，您必须使用mkfs命令格式化disk01映像。在本教程中，您将使用XFS文件系统</p><blockquote class="lk"><p id="5827" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ sudo mkfs.xfs /dev/rbd0</p></blockquote><p id="1c47" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">现在，将“/dev/rbd0”挂载到mnt目录。</p><blockquote class="lk"><p id="1513" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ sudo mount /dev/rbd0 /mnt</p></blockquote><p id="5b82" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">Ceph RBD或RADOS Block设备已配置并安装在系统上。使用df命令检查设备是否已正确装载。</p><blockquote class="lk"><p id="dd7e" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ df-hT | grep rd0<br/>/dev/rbd 0 xfs 40G 33M 40G 1%/mnt</p></blockquote><h1 id="9102" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka lz kc kd ke ma kg kh ki mb kk kl km bi translated">启动时设置RBD</h1><p id="39d9" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">完成Ceph客户端配置后，您将配置它在引导时将Ceph块设备自动挂载到系统。一种方法是在/usr/local/bin目录下创建一个新文件，用于安装和卸载RBD磁盘01。</p><blockquote class="lk"><p id="b665" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ CD/usr/local/bin/<br/>$ sudo vim rbd-mount</p></blockquote><p id="3043" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">粘贴下面的脚本，并根据您的需求随意修改。</p><blockquote class="lk"><p id="fe92" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">#!/bin/bash <br/> #脚本作者:<a class="ae jc" href="http://bryanapperson.com/" rel="noopener ugc nofollow" target="_blank">http://bryanapperson.com/</a><br/>#更改您的池名称<br/>导出池名称=rbd <br/> <br/> #更改您的磁盘映像名称<br/>导出rbdimage=disk01 <br/> <br/> #挂载目录<br/>导出挂载点=/mnt/mydisk <br/> <br/> #映像挂载/卸载和池作为参数从系统服务传递<br/> #确定我们是在挂载还是卸载<br/>然后<br/> modprobe rbd <br/> rbd特性禁用$ rbd image exclusive-lock object-map fast-diff deep-flatten<br/>rbd map $ rbd image—id admin—key ring/etc/ceph/ceph . client . admin . key ring<br/>mkdir-p $ mount point<br/>mount/dev/rbd/$ poolname/$ rbd image $ mount point<br/>fi<br/>if[" $ 1 " = " u "]；然后<br/>umount $ mount point<br/>rbd unmap/dev/rbd/$ poolname/$ rbd image<br/>fi</p></blockquote><p id="9cb6" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">保存文件并退出vim，然后用chmod使其可执行。</p><blockquote class="lk"><p id="b1f4" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ sudo chmod +x rbd-mount</p></blockquote><p id="dbae" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">接下来，转到systemd目录并创建服务文件。</p><blockquote class="lk"><p id="0d2a" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ CD/etc/systemd/system/<br/>$ sudo vim rbd-mount . service</p></blockquote><p id="382c" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">在下面粘贴服务配置:</p><blockquote class="lk"><p id="2a34" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">[Unit]<br/>Description =池$poolname" <br/>中$rbdimage的RADOS块设备映射冲突= shut down . target<br/>Wants = network-online . target<br/>After = network manager-wait-online . Service<br/>【Service】<br/>Type = one shot<br/>RemainAfterExit = yes<br/>ExecStart =/usr/local/bin/rbd-mount m<br/>ExecStop =/usr/local/bin/rbd-mount u<br/>【Install】【T10</p></blockquote><p id="eb92" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">保存文件并退出vim。</p><p id="1170" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">重新加载systemd文件，并在引导时启动rbd-mount服务。</p><blockquote class="lk"><p id="1072" class="ll lm hh bd ln lo lp lq lr ls lt jb dx translated">$ sudo systemctl守护进程-重新加载<br/> $ sudo systemctl启用rbd-mount.service</p></blockquote><p id="1e25" class="pw-post-body-paragraph ie if hh ig b ih lu ij ik il lv in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">如果您现在重新启动客户端节点，rbd“disk 01”将自动挂载到“/mnt/mydisk”目录。</p><p id="03c8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您的Ceph分布式存储集群和客户机配置已经完成！</p><h1 id="83c3" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">参考</h1><ul class=""><li id="97b6" class="ks kt hh ig b ih kn il ko ip lg it lh ix li jb kx ky kz la bi translated"><a class="ae jc" href="http://ceph.com/ceph-storage/" rel="noopener ugc nofollow" target="_blank"> Ceph Ceph存储— Ceph </a></li><li id="f5d1" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated"><a class="ae jc" href="http://docs.ceph.com/docs/jewel/rbd/rbd/" rel="noopener ugc nofollow" target="_blank"> Ceph Block装置</a></li><li id="edde" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated"><a class="ae jc" href="https://www.howtoforge.com/tutorial/how-to-build-a-ceph-cluster-on-centos-7/" rel="noopener ugc nofollow" target="_blank">如何在CentOS 7上构建Ceph分布式存储集群</a></li><li id="23b5" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated"><a class="ae jc" href="http://blog.programster.org/ceph-deploy-and-mount-a-block-device/" rel="noopener ugc nofollow" target="_blank"> Ceph —部署并安装块设备</a></li><li id="f34b" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated"><a class="ae jc" href="http://bryanapperson.com/blog/mounting-rbd-at-boot-under-centos-7/" rel="noopener ugc nofollow" target="_blank">在CentOS 7 </a>下的靴子上安装RBD</li><li id="9ced" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated"><a class="ae jc" href="https://docs.oracle.com/cd/E52668_01/E66514/E66514.pdf" rel="noopener ugc nofollow" target="_blank">适用于Oracle Linux版的Ceph存储</a></li></ul></div><div class="ab cl ml mm go mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ha hb hc hd he"><p id="0e52" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="ms">原载于2017年7月18日</em><a class="ae jc" href="https://community.oracle.com/people/Gilson%20Melo-Oracle/blog/2017/07/18/using-ceph-distributed-storage-cluster-on-bare-metal-cloud-services" rel="noopener ugc nofollow" target="_blank"><em class="ms">community.oracle.com</em></a><em class="ms">。</em></p></div></div>    
</body>
</html>