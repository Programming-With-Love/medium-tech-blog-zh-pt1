<html>
<head>
<title>Automating the release process of Terraform modules with semantic versioning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用语义版本控制自动化Terraform模块的发布过程</h1>
<blockquote>原文：<a href="https://medium.com/globant/automating-the-release-process-of-terraform-modules-with-semantic-versioning-104bab1793b7?source=collection_archive---------0-----------------------#2022-07-05">https://medium.com/globant/automating-the-release-process-of-terraform-modules-with-semantic-versioning-104bab1793b7?source=collection_archive---------0-----------------------#2022-07-05</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/97307ec20a0845b3a9b295fd942d944d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DhtwcDoY272Nn0vfYz7ZEQ.png"/></div></div></figure><div class=""/><p id="482a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为你的Terraform模块发布新的变更意味着维护遵循<a class="ae jn" href="https://semver.org/" rel="noopener ugc nofollow" target="_blank">语义版本</a>规范的版本号。当你的项目很小的时候，这样的任务看起来没什么大不了的，考虑到你所要做的就是把一个标签以<code class="du jo jp jq jr b">x.y.z</code>的形式推送到你的git库。但是，在某些时候，您会问自己是否有任何方法可以让这个过程自动发生，这样您就可以在代码上花更多的时间，而不用担心版本和推送标签中数字的正确顺序。</p><p id="1ecf" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">有几个选项<a class="ae jn" href="https://www.conventionalcommits.org/en/about/#tooling-for-conventional-commits" rel="noopener ugc nofollow" target="_blank"/>可以帮助你在项目中自动化<a class="ae jn" href="https://semver.org/" rel="noopener ugc nofollow" target="_blank">语义版本化</a>。他们中的绝大多数都是以<a class="ae jn" href="https://www.conventionalcommits.org/" rel="noopener ugc nofollow" target="_blank">常规提交</a>规范为参考，来分析你的存储库的特定分支中的提交消息的格式，并在此分析的基础上，确定正确的版本号。</p><p id="5e6c" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">本文探索了在<a class="ae jn" href="https://github.com/areguera/terraform-aws-ssm" rel="noopener ugc nofollow" target="_blank"> terraform-aws-ssm </a>项目中<a class="ae jn" href="https://github.com/semantic-release" rel="noopener ugc nofollow" target="_blank">语义发布</a>、<a class="ae jn" href="https://github.com/commitizen-tools/commitizen" rel="noopener ugc nofollow" target="_blank">提交</a>和<a class="ae jn" href="https://github.com/semantic-release/semantic-release/blob/master/docs/recipes/ci-configurations/github-actions.md" rel="noopener ugc nofollow" target="_blank"> GitHub动作</a>的组合，以自动化发布过程，terraform模块用于<a class="ae jn" rel="noopener" href="/globant/composing-aws-systems-manager-configurations-with-terraform-part-1-939585ee9b7d">编写aws系统管理器(ssm)配置</a>。章节是逐步组织的，因此您可以在自己的项目中重现它们。主要部分包括:</p><ol class=""><li id="0d02" class="js jt hs ir b is it iw ix ja ju je jv ji jw jm jx jy jz ka bi translated">第一步。安装NPM软件包管理器。</li><li id="51d3" class="js jt hs ir b is kb iw kc ja kd je ke ji kf jm jx jy jz ka bi translated">第二步。安装和配置NPM软件包</li><li id="3769" class="js jt hs ir b is kb iw kc ja kd je ke ji kf jm jx jy jz ka bi translated">第三步。理解常规提交</li><li id="9dc6" class="js jt hs ir b is kb iw kc ja kd je ke ji kf jm jx jy jz ka bi translated">第四步。检查发布过程自动化</li><li id="87da" class="js jt hs ir b is kb iw kc ja kd je ke ji kf jm jx jy jz ka bi translated">结论</li></ol></div><div class="ab cl kg kh go ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="ha hb hc hd he"><h1 id="f4b8" class="kn ko hs bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">第一步。安装NPM软件包管理器</h1><p id="6fca" class="pw-post-body-paragraph ip iq hs ir b is ll iu iv iw lm iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated">本文中使用的<code class="du jo jp jq jr b">semantic-release</code>和传统工具是用JavaScript编写的，并作为一个包发布在<a class="ae jn" href="https://www.npmjs.com/" rel="noopener ugc nofollow" target="_blank">npmjs.org</a>注册表中。要安装这些包，您在GitHub actions上用作工作站或容器映像的操作系统中必须有NPM包管理器。</p><p id="652d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您使用的是<a class="ae jn" href="https://getfedora.org/" rel="noopener ugc nofollow" target="_blank"> Fedora Linux </a>或类似软件，请执行以下操作:</p><ol class=""><li id="4fc1" class="js jt hs ir b is it iw ix ja ju je jv ji jw jm jx jy jz ka bi translated">安装NPM安装<code class="du jo jp jq jr b">nodejs</code>包。</li></ol><pre class="lq lr ls lt fd lu jr lv lw aw lx bi"><span id="6605" class="ly ko hs jr b fi lz ma l mb mc">$ sudo dnf install nodejs</span></pre><p id="bbda" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">2.创建<code class="du jo jp jq jr b">~/.npm/packages</code>目录来存储全球NPM软件包(即使用<code class="du jo jp jq jr b">-g</code>选项安装的软件包)。</p><pre class="lq lr ls lt fd lu jr lv lw aw lx bi"><span id="401a" class="ly ko hs jr b fi lz ma l mb mc">$ mkdir ~/.npm/packages/</span></pre><p id="3e56" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">3.更新您的<code class="du jo jp jq jr b">~/.bashrc</code>文件，以配置环境变量。</p><pre class="lq lr ls lt fd lu jr lv lw aw lx bi"><span id="c84e" class="ly ko hs jr b fi lz ma l mb mc">NPM_PACKAGES="${HOME}/.npm/packages"<br/>export PATH="${PATH}:${NPM_PACKAGES}/bin"<br/>export MANPATH="${MANPATH-$(manpath)}:${NPM_PACKAGES}/share/man"</span></pre><p id="c6ae" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">4.检查NPM是否安装成功:</p><pre class="lq lr ls lt fd lu jr lv lw aw lx bi"><span id="6676" class="ly ko hs jr b fi lz ma l mb mc">$ npm --version<br/>8.3.1</span></pre></div><div class="ab cl kg kh go ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="ha hb hc hd he"><h1 id="e9d3" class="kn ko hs bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">第二步。安装和配置NPM软件包</h1><h2 id="3e55" class="ly ko hs bd kp md me mf kt mg mh mi kx ja mj mk lb je ml mm lf ji mn mo lj mp bi translated">package.json文件</h2><p id="019b" class="pw-post-body-paragraph ip iq hs ir b is ll iu iv iw lm iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated"><code class="du jo jp jq jr b">package.json</code>文件描述了您将在项目中安装的NPM包。通常，这个文件不存在，您需要创建它。要在存储库中安装和配置语义发布，请执行以下操作:</p><ol class=""><li id="0691" class="js jt hs ir b is it iw ix ja ju je jv ji jw jm jx jy jz ka bi translated">创建运行<a class="ae jn" href="https://docs.npmjs.com/cli/v8/commands/npm-init" rel="noopener ugc nofollow" target="_blank"> npm init </a>命令的<code class="du jo jp jq jr b">package.json</code>文件:</li></ol><pre class="lq lr ls lt fd lu jr lv lw aw lx bi"><span id="e64a" class="ly ko hs jr b fi lz ma l mb mc">$ npm init</span></pre><p id="c58f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">当你执行<a class="ae jn" href="https://docs.npmjs.com/cli/v6/commands/npm-init" rel="noopener ugc nofollow" target="_blank"> npm init </a>命令时，它会问你一些问题，你可以回答或者跳过。并非所有在<code class="du jo jp jq jr b">package.json</code>文件中默认创建的属性都是自动化发布所必需的。这里最相关的属性是用于跟踪软件版本的<code class="du jo jp jq jr b">devDependency</code>，以及用于配置软件使用的<code class="du jo jp jq jr b">config</code>。</p><p id="7eb2" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">2.运行以下命令为GitHub安装semantic-release及其插件:</p><pre class="lq lr ls lt fd lu jr lv lw aw lx bi"><span id="9d0f" class="ly ko hs jr b fi lz ma l mb mc">$ npm install -g commitizen<br/>$ npm install --save-dev git-cz<br/>$ npm install --save-dev semantic-release <a class="ae jn" href="http://twitter.com/semantic" rel="noopener ugc nofollow" target="_blank">@semantic</a>-release/github</span></pre><p id="7740" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">3.编辑<code class="du jo jp jq jr b">package.json</code>文件，用<code class="du jo jp jq jr b">git-cz</code>配置<code class="du jo jp jq jr b">commitizen</code>。</p><pre class="lq lr ls lt fd lu jr lv lw aw lx bi"><span id="bcce" class="ly ko hs jr b fi lz ma l mb mc">{<br/>    "config": {<br/>        "commitizen": {<br/>            "path": "git-cz"<br/>        }<br/>    }<br/>}</span></pre><p id="2bcc" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">4.编辑<code class="du jo jp jq jr b">package.json</code>文件以配置插件。</p><pre class="lq lr ls lt fd lu jr lv lw aw lx bi"><span id="cfa7" class="ly ko hs jr b fi lz ma l mb mc">{<br/>    "plugins": [<br/>        "<a class="ae jn" href="http://twitter.com/semantic" rel="noopener ugc nofollow" target="_blank">@semantic</a>-release/commit-analyzer",<br/>        "<a class="ae jn" href="http://twitter.com/semantic" rel="noopener ugc nofollow" target="_blank">@semantic</a>-release/release-notes-generator",<br/>        "<a class="ae jn" href="http://twitter.com/semantic" rel="noopener ugc nofollow" target="_blank">@semantic</a>-release/github",<br/>        "<a class="ae jn" href="http://twitter.com/semantic" rel="noopener ugc nofollow" target="_blank">@semantic</a>-release/npm", {<br/>            "npmPublish": false<br/>        }<br/>    ]<br/>}</span></pre><p id="9d8c" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">注意在<code class="du jo jp jq jr b"><a class="ae jn" href="http://twitter.com/semantic" rel="noopener ugc nofollow" target="_blank">@semantic</a>-release/npm</code>插件中<code class="du jo jp jq jr b">npmPublish</code>是如何被设置为<code class="du jo jp jq jr b">false</code>的，以防止semantic-release试图向nodejs.org注册表推送任何东西。这稍微加快了像<a class="ae jn" href="https://github.com/areguera/terraform-aws-ssm" rel="noopener ugc nofollow" target="_blank"> terraform-aws-ssm </a>这样不需要在npmjs.org注册表中发布包的项目的发布过程。您可以更改更多配置选项来满足您的需求。要了解这些插件的更多信息，请访问以下链接:</p><ul class=""><li id="9acd" class="js jt hs ir b is it iw ix ja ju je jv ji jw jm mq jy jz ka bi translated">h<a class="ae jn" href="https://github.com/semantic-release/commit-analyzer/" rel="noopener ugc nofollow" target="_blank">ttps://github . com/semantic-release/commit-analyzer/</a></li><li id="f574" class="js jt hs ir b is kb iw kc ja kd je ke ji kf jm mq jy jz ka bi translated"><a class="ae jn" href="https://github.com/semantic-release/release-notes-generator" rel="noopener ugc nofollow" target="_blank">https://github.com/semantic-release/release-notes-generator</a></li><li id="417c" class="js jt hs ir b is kb iw kc ja kd je ke ji kf jm mq jy jz ka bi translated"><a class="ae jn" href="https://github.com/semantic-release/github" rel="noopener ugc nofollow" target="_blank">https://github.com/semantic-release/github</a></li><li id="d460" class="js jt hs ir b is kb iw kc ja kd je ke ji kf jm mq jy jz ka bi translated"><a class="ae jn" href="https://github.com/semantic-release/npm" rel="noopener ugc nofollow" target="_blank">https://github.com/semantic-release/npm</a></li></ul><p id="464a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">5.编辑<code class="du jo jp jq jr b">package.json</code>文件以配置分支名称，语义发布程序将分析提交消息，并基于它们创建版本号。</p><pre class="lq lr ls lt fd lu jr lv lw aw lx bi"><span id="3762" class="ly ko hs jr b fi lz ma l mb mc">{<br/>    "release": {<br/>        "branches": ["main"]<br/>    }<br/>}</span></pre><p id="b13e" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">安装semantic-release、常规提交工具、删除一些未使用的属性，并编辑添加其他属性后，terraform-aws-ssm中使用的<code class="du jo jp jq jr b">package.json</code>如下所示:</p><figure class="lq lr ls lt fd hj"><div class="bz dy l di"><div class="mr ms l"/></div><figcaption class="mt mu et er es mv mw bd b be z dx">The package.json file of terraform-aws-ssm project</figcaption></figure><h2 id="e145" class="ly ko hs bd kp md me mf kt mg mh mi kx ja mj mk lb je ml mm lf ji mn mo lj mp bi translated">package-lock.json文件</h2><p id="8659" class="pw-post-body-paragraph ip iq hs ir b is ll iu iv iw lm iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated"><code class="du jo jp jq jr b">package-lock.json</code>是从<code class="du jo jp jq jr b">package.json</code>中产生的，它必须在版本控制下，因此您可以稍后在CI/CD配置期间使用<a class="ae jn" href="https://docs.npmjs.com/cli/v6/commands/npm-ci" rel="noopener ugc nofollow" target="_blank"> npm ci </a>命令。</p><h2 id="9059" class="ly ko hs bd kp md me mf kt mg mh mi kx ja mj mk lb je ml mm lf ji mn mo lj mp bi translated">的。github/workflow/release.yml文件</h2><p id="9e4c" class="pw-post-body-paragraph ip iq hs ir b is ll iu iv iw lm iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated"><code class="du jo jp jq jr b">.github/workflow/release.yml</code>文件指定了GitHub动作将执行的工作流。这是控制自动化本身的配置，在这里执行语义发布并创建发布版本。</p><pre class="lq lr ls lt fd lu jr lv lw aw lx bi"><span id="b3cd" class="ly ko hs jr b fi lz ma l mb mc">---<br/>name: Release<br/>on:<br/>  push:<br/>    branches:<br/>      - main</span><span id="7090" class="ly ko hs jr b fi mx ma l mb mc">jobs:<br/>  release:<br/>    name: Release<br/>    runs-on: ubuntu-latest<br/>    steps:<br/>      - name: Checkout<br/>        uses: actions/checkout@v2<br/>        with:<br/>          fetch-depth: 0<br/>      - name: Setup Node.js<br/>        uses: actions/setup-node@v2<br/>        with:<br/>          node-version: 'lts/*'<br/>      - name: Install dependencies<br/>        run: npm ci<br/>      - name: Release<br/>        env:<br/>          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}<br/>          NPM_TOKEN: ${{ secrets.NPM_TOKEN }}<br/>        run: npx semantic-release</span></pre><p id="f145" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这种配置可以通过多种方式进行改进(例如，在执行发布作业之前添加测试)。当有人使用传统的提交规范将变更推入<code class="du jo jp jq jr b">main</code>分支时，这是创建一个发布的起点，并激励您继续挖掘这个主题。要了解更多关于如何用GitHub动作配置语义发布的信息，请参见<a class="ae jn" href="https://github.com/semantic-release/semantic-release/blob/master/docs/recipes/ci-configurations/github-actions.md" rel="noopener ugc nofollow" target="_blank">用GitHub动作使用语义发布</a>。</p><h2 id="1407" class="ly ko hs bd kp md me mf kt mg mh mi kx ja mj mk lb je ml mm lf ji mn mo lj mp bi translated">节点模块目录</h2><p id="08cf" class="pw-post-body-paragraph ip iq hs ir b is ll iu iv iw lm iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated">当您运行像<code class="du jo jp jq jr b">npm install</code>或<code class="du jo jp jq jr b">npm update</code>这样的命令时，<code class="du jo jp jq jr b">node_modules</code>目录存储了在<code class="du jo jp jq jr b">package.json</code>文件中指定的软件包。考虑到上面显示的<code class="du jo jp jq jr b">package.json</code>的内容，该目录的大小可以达到接近150MB，并且必须在<code class="du jo jp jq jr b">.gitignore</code>文件中为其添加一行，将其排除在版本控制之外。</p><h2 id="356f" class="ly ko hs bd kp md me mf kt mg mh mi kx ja mj mk lb je ml mm lf ji mn mo lj mp bi translated">1.0.0版标签</h2><p id="241d" class="pw-post-body-paragraph ip iq hs ir b is ll iu iv iw lm iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated">语义发布实现希望您的存储库中至少有一个名为<code class="du jo jp jq jr b">v1.0.0</code>的标签。通常，这个标签是不存在的，你需要手动创建它。这是所有语义版本分析的起点。因此，检查您的存储库中是否有一个<code class="du jo jp jq jr b">v1.0.0</code>标签，如果没有就创建它。</p><blockquote class="my mz na"><p id="7ef8" class="ip iq nb ir b is it iu iv iw ix iy iz nc jb jc jd nd jf jg jh ne jj jk jl jm ha bi translated">观看Stephan bnne Mann关于语义版本化的视频。</p></blockquote></div><div class="ab cl kg kh go ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="ha hb hc hd he"><h1 id="f28f" class="kn ko hs bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">第三步。理解常规提交</h1><p id="ad68" class="pw-post-body-paragraph ip iq hs ir b is ll iu iv iw lm iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated">此时，您的工作站已经准备好记录常规提交。为此，在发出<code class="du jo jp jq jr b">git add</code>命令后，使用<code class="du jo jp jq jr b">cz</code>命令而不是<code class="du jo jp jq jr b">git commit</code>命令。</p><h2 id="1af3" class="ly ko hs bd kp md me mf kt mg mh mi kx ja mj mk lb je ml mm lf ji mn mo lj mp bi translated">传统提交的用户界面</h2><p id="9964" class="pw-post-body-paragraph ip iq hs ir b is ll iu iv iw lm iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated">在您的工作站终端中，<code class="du jo jp jq jr b">cz</code>命令提供了一个交互式界面，引导您完成常规提交过程。它看起来像下面这样:</p><figure class="lq lr ls lt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es nf"><img src="../Images/4ca0c2e35fae86ec0dce2fafa8367d84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HG6skjeffXmmFme1uZjxQA.png"/></div></div><figcaption class="mt mu et er es mv mw bd b be z dx">Conventional commits user interface in the terminal.</figcaption></figure><p id="5063" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在GitHub web界面上，常规提交如下所示:</p><figure class="lq lr ls lt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ng"><img src="../Images/75ab19a7a23e225b76dcdd5add6ac985.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gh8ZSK0z8LMzHX2P80UXYA.png"/></div></div><figcaption class="mt mu et er es mv mw bd b be z dx">Conventional commit format in the GitHub commits interface.</figcaption></figure><h2 id="824a" class="ly ko hs bd kp md me mf kt mg mh mi kx ja mj mk lb je ml mm lf ji mn mo lj mp bi translated">定制传统的提交用户界面</h2><p id="8e8d" class="pw-post-body-paragraph ip iq hs ir b is ll iu iv iw lm iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated">如果您想要不同的消息，您可以<a class="ae jn" href="https://github.com/streamich/git-cz#custom-config" rel="noopener ugc nofollow" target="_blank">定制该界面</a>以满足您的需求。但是，请记住，语义发布完全是关于常规提交消息的，无论您在这里执行什么更改，也必须在语义发布的配置中进行更改。</p><h2 id="8c16" class="ly ko hs bd kp md me mf kt mg mh mi kx ja mj mk lb je ml mm lf ji mn mo lj mp bi translated">了解提交消息和版本号之间的关系</h2><p id="466d" class="pw-post-body-paragraph ip iq hs ir b is ll iu iv iw lm iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated">发布版本由三个不同的提交消息控制。从<a class="ae jn" href="https://www.conventionalcommits.org/en/v1.0.0/" rel="noopener ugc nofollow" target="_blank">常规提交1.0.0 </a>规范:</p><blockquote class="my mz na"><p id="2fcf" class="ip iq nb ir b is it iu iv iw ix iy iz nc jb jc jd nd jf jg jh ne jj jk jl jm ha bi translated">提交包含以下结构元素，用于向库的使用者传达意图:</p><p id="af16" class="ip iq nb ir b is it iu iv iw ix iy iz nc jb jc jd nd jf jg jh ne jj jk jl jm ha bi translated">1.fix类型的提交修补了代码库中的一个错误(这与语义版本化中的修补相关)。</p><p id="73b7" class="ip iq nb ir b is it iu iv iw ix iy iz nc jb jc jd nd jf jg jh ne jj jk jl jm ha bi translated">2.feat类型的提交为代码库引入了一个新的特性(这与语义版本化中的MINOR相关)。</p><p id="1470" class="ip iq nb ir b is it iu iv iw ix iy iz nc jb jc jd nd jf jg jh ne jj jk jl jm ha bi translated">3.<code class="du jo jp jq jr b"><strong class="ir ht">BREAKING CHANGE:</strong></code>一个有页脚<code class="du jo jp jq jr b">BREAKING CHANGE:</code>的提交，或者在类型/范围后面附加一个<code class="du jo jp jq jr b">!</code>，引入了一个突破性的API变化(与语义版本控制的主要部分相关)。一个<code class="du jo jp jq jr b">BREAKING CHANGE</code>可以是任何类型的提交的一部分。</p></blockquote></div><div class="ab cl kg kh go ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="ha hb hc hd he"><h1 id="e1c9" class="kn ko hs bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">第四步。是时候检查自动化了</h1><h2 id="a76f" class="ly ko hs bd kp md me mf kt mg mh mi kx ja mj mk lb je ml mm lf ji mn mo lj mp bi translated">GitHub操作</h2><p id="4dd1" class="pw-post-body-paragraph ip iq hs ir b is ll iu iv iw lm iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated">查看terraform-aws-ssm项目GitHub操作，可以观察到一些失败的作业，成功的作业不是创建<code class="du jo jp jq jr b">v1.0.1</code>版本的作业。这里发生了什么？</p><figure class="lq lr ls lt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es nh"><img src="../Images/b113baedd8f5c2baf9b191036ce0dc9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*620vo_7Dyq_iYKW8JgVUSg.png"/></div></div></figure><p id="1d03" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">让我们仔细看看从<code class="du jo jp jq jr b">v1.0.0</code>标记开始推送到存储库的<code class="du jo jp jq jr b">main</code>分支的提交:</p><figure class="lq lr ls lt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es nh"><img src="../Images/382ff159097ffaa9c89d5a4558354671.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_YvrYQfue387zVSu9DvV-A.png"/></div></div></figure><p id="78d1" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这里所有的提交都以<code class="du jo jp jq jr b">chore:</code>开始，除了其中的三个。有趣的是，在其中一个提交的主体中有一个<code class="du jo jp jq jr b">ci:</code>字符串，它是按照传统的提交规范由三个提交合并而成的。语义发布程序解析了从<code class="du jo jp jq jr b">v1.0.0</code>标签到存储库中最后一次提交之间的所有提交，结果发现了一个<code class="du jo jp jq jr b">ci:</code>字符串，并因此触发了一个新的补丁版本。</p><p id="6976" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><a class="ae jn" href="https://github.com/areguera/terraform-aws-ssm/runs/7185753978?check_suite_focus=true#step:5:59" rel="noopener ugc nofollow" target="_blank">查看那个特定的作业</a>，可以观察到它是负责创建<code class="du jo jp jq jr b">v1.0.1</code>版本的，在它尝试向npmjs.org注册中心发布内容失败之前。</p><figure class="lq lr ls lt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ni"><img src="../Images/c4102f941ecec7ca61820779c7211ed3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fa3yrZIqYXnZ3J5e.png"/></div></div><figcaption class="mt mu et er es mv mw bd b be z dx">Semantic-release runs in GitHub Actions creating a new version.</figcaption></figure><p id="1dc3" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">后来，当<code class="du jo jp jq jr b">package.json</code>文件再次被更改时，添加其他<code class="du jo jp jq jr b">chore:</code>提交，以避免将内容发布到npmjs.org注册中心，语义发布再次运行，但它没有创建任何版本，因为传统提交规范中的<code class="du jo jp jq jr b">chore:</code>提交不影响语义版本化。他们只是路过。</p><figure class="lq lr ls lt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es nj"><img src="../Images/1227a288247829e18ceb56cb3a776372.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6-AbnCdDmW2mmMRuxGBH-Q.png"/></div></div><figcaption class="mt mu et er es mv mw bd b be z dx">Semantic-release runs on GitHub Actions without creating a new version.</figcaption></figure><h2 id="83d5" class="ly ko hs bd kp md me mf kt mg mh mi kx ja mj mk lb je ml mm lf ji mn mo lj mp bi translated">GitHub标签</h2><p id="39ec" class="pw-post-body-paragraph ip iq hs ir b is ll iu iv iw lm iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated">查看terraform-aws-ssm项目GitHub标签，可以看到一个自动创建的新标签。厉害！</p><figure class="lq lr ls lt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es nj"><img src="../Images/440fdd48fdc30658db884afd3c7dffff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oIbkxAaPpsBcG5VgLmLdYA.png"/></div></div><figcaption class="mt mu et er es mv mw bd b be z dx">New version available in GitHub tags</figcaption></figure><h2 id="cfde" class="ly ko hs bd kp md me mf kt mg mh mi kx ja mj mk lb je ml mm lf ji mn mo lj mp bi translated">地形注册表</h2><p id="f1f1" class="pw-post-body-paragraph ip iq hs ir b is ll iu iv iw lm iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated">查看terraform-aws-ssm项目的Terraform注册表，还可以看到当您访问该模块的页面时，自动选择了一个新版本。厉害！</p><figure class="lq lr ls lt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es nk"><img src="../Images/960f24c178472a9055376a4dc20b7259.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g7BA3lMG8gwc-wcPCHmUvQ.png"/></div></div><figcaption class="mt mu et er es mv mw bd b be z dx">New module version available on Terraform registry</figcaption></figure><h1 id="0437" class="kn ko hs bd kp kq nl ks kt ku nm kw kx ky nn la lb lc no le lf lg np li lj lk bi translated">结论</h1><p id="acbc" class="pw-post-body-paragraph ip iq hs ir b is ll iu iv iw lm iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated">本文一步一步地探索了如何使用语义发布、常规提交和GitHub动作来自动化Terraform模块的发布过程。本文中实现的自动化允许开发人员将更多的时间用于编码，而将更少的时间用于规划版本号和将相关标签推送到存储库。该配置非常灵活，可以适用于其他项目。</p><p id="2e1f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">谢谢！</p></div></div>    
</body>
</html>