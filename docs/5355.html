<html>
<head>
<title>Using Oracle’s Chef Plugin To Provision Resource In Oracle Cloud Infrastructure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Oracle Chef插件在Oracle云基础架构中调配资源</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/using-oracles-chef-plugin-to-provision-resource-in-oracle-cloud-infrastructure-5891100e20ab?source=collection_archive---------0-----------------------#2017-12-03">https://medium.com/oracledevs/using-oracles-chef-plugin-to-provision-resource-in-oracle-cloud-infrastructure-5891100e20ab?source=collection_archive---------0-----------------------#2017-12-03</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="a0d5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">本文介绍了如何使用Chef和Oracle提供的Chef插件在<a class="ae jc" href="https://cloud.oracle.com/iaas" rel="noopener ugc nofollow" target="_blank"><strong class="ig hi">【Oracle云基础设施(OCI) </strong> </a>中处理和调配资源。本文通过使用<a class="ae jc" href="https://manage.chef.io/login" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi">托管的chef </strong> </a>来演示这一点，然而，大多数步骤可以类似地用于您使用专用chef服务器安装的场景中。</p><h1 id="ae3b" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">厨师是什么</h1><p id="ac51" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">Chef是一个强大的自动化平台，可以将基础设施转化为代码。无论您是在云中、内部还是在混合环境中运行，Chef都会自动配置、部署和管理整个网络中的基础架构，无论其规模如何。</p><p id="170a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这个图表显示了如何开发、测试和部署您的Chef代码</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/6df6ba8e1235d5abbc0b15eade80e505.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZHIqx8N5d9BD5Khig95YSg.png"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx">Image Courtesy <a class="ae jc" href="https://docs.chef.io/platform_overview.html" rel="noopener ugc nofollow" target="_blank">https://docs.chef.io/platform_overview.html</a></figcaption></figure><h1 id="3621" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">OCI厨师插件</h1><p id="eafa" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated"><strong class="ig hi"> knife-oci </strong>插件允许用户通过<a class="ae jc" href="https://docs.chef.io/knife.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi"> chef knife与Oracle云基础设施进行交互。</strong> </a>项目是开源的，由Oracle公司维护，项目的主页是<a class="ae jc" href="https://docs.us-phoenix-1.oraclecloud.com/Content/API/SDKDocs/knifeplugin.htm" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi">这里是</strong> </a>。插件可以从<a class="ae jc" href="https://github.com/oracle/knife-oci/releases" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi">这个</strong> </a>位置下载。以下是可用的刀-oci插件命令。</p><ul class=""><li id="33f5" class="kw kx hh ig b ih ii il im ip ky it kz ix la jb lb lc ld le bi translated">启动一个oci实例，并将其引导为一个Chef节点:<em class="lf">刀OCI服务器创建</em></li><li id="60af" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated">请列出OCI的车厢。<em class="lf">刀oci隔间列表</em></li><li id="5546" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated">删除一个oci实例:<em class="lf">刀OCI服务器删除</em></li><li id="02bd" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated">列出给定隔离专区中的OCI实例。注意:返回隔离舱中的所有实例，而不仅仅是那些Chef节点:<em class="lf">刀oci服务器列表</em></li><li id="0cd5" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated">在一个区间中列出图像:<em class="lf">刀oci图像列表</em></li><li id="4918" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated">列出一个区间中的vcn:<em class="lf">刀oci vcn列表</em></li><li id="a8b3" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated">列出VCN中的子网:<em class="lf">刀oci子网列表</em></li><li id="4dc0" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated">列出可用于特定图像类型的形状:<em class="lf">刀oci形状列表</em></li><li id="a481" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated">列出您的租赁的可用性域:<em class="lf"> knife oci ad list </em></li></ul><h1 id="ec5e" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">在OCI中设置和设置的步骤</h1><h1 id="e222" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">1.创建您的托管厨师帐户</h1><p id="db89" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">在托管chef模式中，用户的食谱、角色和节点定义存储在由Chef，Inc .提供的基于云的Chef服务器中。用户只需上传食谱，Chef就会完成剩下的工作。尽管人们可以在一定限制下免费试用，但是完整的企业级使用需要许可证。</p><ul class=""><li id="63b9" class="kw kx hh ig b ih ii il im ip ky it kz ix la jb lb lc ld le bi translated">在<a class="ae jc" href="https://manage.chef.io/login" rel="noopener ugc nofollow" target="_blank"><strong class="ig hi">【https://manage.chef.io/login</strong></a>注册并创建您的账户</li><li id="b6ed" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated">然后登录到您的帐户，创建一个组织。组织是Chef服务器中基于角色的访问控制的顶级实体。</li><li id="9cf8" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated">最后，它会提示您下载初学者工具包(厨师报告)。将此文件下载到您的Chef工作站(即ChefDK安装的工作站),并在指定位置解压缩。Chef存储库是您的工作区，用于组织所有工件，如食谱和角色等。knife用于将数据从Chef-Repo目录上传到Chef服务器。</li><li id="5bf4" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated">解压缩后的目录之一是<strong class="ig hi">。厨师</strong>。在这个目录中有一个文件<strong class="ig hi"> knife.rb </strong>。这是一个配置文件，稍后您需要在其中配置您的OCI云帐户。</li><li id="f590" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated"><strong class="ig hi">对于后续步骤，将解压后的Chef-Repo目录作为您的工作目录</strong>。</li></ul><h1 id="98e8" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">2.安装ChefDK</h1><p id="680f" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">从<a class="ae jc" href="https://downloads.chef.io/chefdk" rel="noopener ugc nofollow" target="_blank"><strong class="ig hi">https://downloads.chef.io/chefdk</strong></a>下载并安装适用于您平台的ChefDK二进制文件。如果还没有，请确保您的路径设置正确，以执行chef可执行文件。</p><h1 id="72c3" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">3.安装Oracle提供的插件以与OCI一起使用</h1><p id="1be9" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">确保正在安装的工作站或服务器具有互联网连接。您可能需要适当地设置http和https代理变量(参见<a class="ae jc" href="https://docs.chef.io/proxies.html" rel="noopener ugc nofollow" target="_blank"><strong class="ig hi">https://docs.chef.io/proxies.html</strong></a>)。然后运行以下命令来安装Oracle为OCI提供的名为knife-oci的chef插件</p><pre class="kh ki kj kk fd ll lm ln lo aw lp bi"><span id="2bcf" class="lq je hh lm b fi lr ls l lt lu"><strong class="lm hi">chef gem install knife-oci</strong></span></pre><h1 id="efb9" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">4.识别并收集您的OCI帐户详细信息</h1><ul class=""><li id="69e7" class="kw kx hh ig b ih kb il kc ip lv it lw ix lx jb lb lc ld le bi translated">确定一个您要在其中调配虚拟机的OCI云帐户。</li><li id="dd34" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated">收集以下ocid(Pl。详见本<a class="ae jc" href="https://docs.us-phoenix-1.oraclecloud.com/Content/API/Concepts/apisigningkey.htm" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi">网址</strong> </a> <strong class="ig hi"> </strong>。)</li><li id="3233" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated"><strong class="ig hi"> 1) </strong>用户OCID。此处见<a class="ae jc" href="https://docs.us-phoenix-1.oraclecloud.com/Content/API/Concepts/apisigningkey.htm#Other" rel="noopener ugc nofollow" target="_blank"><strong class="ig hi"/></a><strong class="ig hi"/>知焉。</li><li id="ed5d" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated"><strong class="ig hi"> 2) </strong>租佃OCID。看到<a class="ae jc" href="https://docs.us-phoenix-1.oraclecloud.com/Content/API/Concepts/apisigningkey.htm#Other" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi">这里</strong> </a>就知道了。</li><li id="0906" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated"><strong class="ig hi"> 3) </strong>你的车厢OCID。在您的云控制台中，单击顶部菜单中的身份，然后单击左侧菜单中的隔离专区，将显示隔离专区。识别您的隔离舱，然后单击“显示”查看该隔离舱的完整OCID值。</li><li id="5ea3" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated">以<strong class="ig hi"> <em class="lf"> PEM格式(非SSH-RSA格式)</em> </strong>创建SSH密钥对，用于验证您的云帐户。见<a class="ae jc" href="https://docs.us-phoenix-1.oraclecloud.com/Content/API/Concepts/apisigningkey.htm#How" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi">此处</strong> </a> <strong class="ig hi"> </strong>知焉。这不是您将调配的虚拟机的密钥对。您稍后将创建的。</li><li id="63c3" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated"><strong class="ig hi"> 1) </strong>在您指定的位置创建并提供两把钥匙</li><li id="a8f8" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated"><strong class="ig hi"> 2) </strong>上传公钥到你的OCI账户，生成指纹。见<a class="ae jc" href="https://docs.us-phoenix-1.oraclecloud.com/Content/API/Concepts/apisigningkey.htm#How2" rel="noopener ugc nofollow" target="_blank">此处<strong class="ig hi">见</strong>知焉</a></li><li id="2cb9" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated">确定您要设置的区域</li><li id="da1f" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated">确定您要预配的可用性域</li></ul><h1 id="315d" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">5.配置刀-oci插件配置文件</h1><p id="16e4" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">准备一个文本文件，比如说。并在其中配置以下参数。这是示例值，请使用您在环境中找到的值。key_file的值是用于验证您的云帐户的私钥文件的完整路径。用户和租赁是您之前找到的用户帐户和您的租赁的OCID值。</p><pre class="kh ki kj kk fd ll lm ln lo aw lp bi"><span id="5aef" class="lq je hh lm b fi lr ls l lt lu">[DEFAULT]</span><span id="0ad8" class="lq je hh lm b fi ly ls l lt lu">user=ocid1.user.oc1..aaaaaaaafnfudi6p2twvkqbonbuvuuzzzvnyly74rhodbln6ax5k5bvccikq</span><span id="19d8" class="lq je hh lm b fi ly ls l lt lu">fingerprint=98:93:64:2d:b7:47:df:87:c9:57:83:04:83:a4:05:ac</span><span id="d76b" class="lq je hh lm b fi ly ls l lt lu">key_file=C:\Users\utanna\.oci\oci_api_key.pem</span><span id="bed2" class="lq je hh lm b fi ly ls l lt lu">tenancy=ocid1.tenancy.oc1..aaaaaaaawz52pbyqeud4ryne7ojegn2bzavhie4bgki3j6k7fwp5asbs5dqa</span><span id="98ce" class="lq je hh lm b fi ly ls l lt lu">region=us-phoenix-1</span></pre><p id="55e6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，在配置文件<strong class="ig hi"> knife.rb </strong>中，我们在<strong class="ig hi">中找到的。chef </strong>之前Chef Repo的目录，配置以下参数。请给出刚在以下knife.rb文件中准备的oci.txt的完整路径。如果您在knife.rb中配置了compartment_id，当您发出knife oci命令时，此隔离专区将成为默认隔离专区。您可以通过在刀oci命令中给出不同的隔离舱id来覆盖它。</p><pre class="kh ki kj kk fd ll lm ln lo aw lp bi"><span id="22ea" class="lq je hh lm b fi lr ls l lt lu">knife[:oci_config_file] = 'D:\oci.txt'</span><span id="fa13" class="lq je hh lm b fi ly ls l lt lu">knife[:compartment_id] = 'ocid1.compartment.oc1..aaaaaaaaldctk5h5nnvemgl6vudavygi276bq55wh6zbzldaewxqdcfw45fq'user=ocid1.user.oc1..aaaaaaaafnfudi6p2twvkqbonbuvuuzzzvnyly73rhodbln8ax6k5bvccikq</span></pre><h1 id="0198" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">6.在OCI提供资源</h1><ul class=""><li id="7674" class="kw kx hh ig b ih kb il kc ip lv it lw ix lx jb lb lc ld le bi translated">创建SSH公钥/私钥对，用于登录到所调配的实例/虚拟机。</li><li id="3608" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated">还要确保您也创建了<strong class="ig hi"> openssh </strong>格式的私钥。在下面的命令中，这是您提供的内容</li><li id="3f83" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated">确定子网的OCID值(从控制台或在运行服务器创建命令之前运行knife oci子网列表命令)</li><li id="17a2" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated"><strong class="ig hi"> 1) </strong>同样，为您要预配的隔离专区确定OCID。</li><li id="0926" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated"><strong class="ig hi"> 2) </strong>如果不知道，通过运行<em class="lf">刀oci图像列表</em>命令识别图像id的值。</li><li id="0a91" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated"><strong class="ig hi"> 3) </strong>如果未知，通过运行<em class="lf">刀oci形状列表</em>命令来识别形状值。</li><li id="cec6" class="kw kx hh ig b ih lg il lh ip li it lj ix lk jb lb lc ld le bi translated">构建与下面类似的命令，并运行它以在OCI配置虚拟机。命令是没有换行符的单行。</li></ul><pre class="kh ki kj kk fd ll lm ln lo aw lp bi"><span id="22f5" class="lq je hh lm b fi lr ls l lt lu">knife oci server create    --availability-domain 'pmne:PHX-AD-3'   --compartment-id 'ocid1.compartment.oc1..aaaaaaaaldctk5h5nnvemgl6vudavygi276bq55wh8zbzldaewxqdcfw15fq'   --image-id 'ocid1.image.oc1.phx.aaaaaaaa4g2xpzlbrrdknqcjtzv2tvxcofjc55vdcmpxdlbohmtt7encpana'   --shape 'VM.Standard1.2'   --subnet-id 'ocid1.subnet.oc1.phx.aaaaaaaaf5nxlolz7k7v2on3rl94ythda4c7e5yhzgtyoamvrx5ret3v6d2q'   --ssh-authorized-keys-file D:\sample-public_key.pub   --display-name OCIinstance   --identity-file D:\sample-private-openssh-key.ppk   --region 'us-phoenix-1'</span></pre><p id="b43f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这将启动VM，并引导新实例作为Chef服务器的客户机。然后，用户可以在他们的chef存储库中编写/使用cookbook，并使用knife命令将其运行到新启动的实例。</p></div></div>    
</body>
</html>