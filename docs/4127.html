<html>
<head>
<title>The web share API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">web共享API</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/the-web-share-api-2af3deef3925?source=collection_archive---------3-----------------------#2017-03-14">https://medium.com/google-developer-experts/the-web-share-api-2af3deef3925?source=collection_archive---------3-----------------------#2017-03-14</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/a64a60bd525394832e2a49a7dc8d46bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oowpf3Oqsx8amY4uNU0SeA.png"/></div></div></figure><p id="5350" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最近，我为我的网站实现了<a class="ae jn" href="https://developers.google.com/web/updates/2016/10/navigator-share" rel="noopener ugc nofollow" target="_blank"> web share API </a>，作为测试的一种手段。如果你在Android上使用的是Chrome 55或更高版本，那么你可以通过点击这篇文章底部的“分享”来观看它的运行。</p><p id="a86b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你没有一个支持API的浏览器，那么这就是你点击分享链接时的样子。</p><p id="f6fa" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="jo">Web Share API origin试用已经结束，所以你目前还看不到它在Chrome中的工作。要跟上讨论，关注一下</em> <a class="ae jn" href="https://discourse.wicg.io/t/web-share-api-for-sharing-content-to-arbitrary-destination/1561" rel="noopener ugc nofollow" target="_blank"> <em class="jo"> WICG论坛</em> </a> <em class="jo">和</em> <a class="ae jn" href="https://github.com/WICG/web-share" rel="noopener ugc nofollow" target="_blank"> <em class="jo"> GitHub回购</em> </a> <em class="jo">。</em></p><figure class="jq jr js jt fd ii er es paragraph-image"><div class="er es jp"><img src="../Images/02bc0977ec6a6a40fe7d659bce1ace83.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*_arnsrCvoDPSHz91.png"/></div></figure><p id="7251" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我想分享一下API是如何工作的，以及到目前为止我对它的想法。</p><h1 id="32a7" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">它是如何工作的</h1><p id="a43d" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">web共享API实际上是一个非常简单的API。它在<code class="du kx ky kz la b">navigator</code>对象上可用，由一个方法组成；<code class="du kx ky kz la b">share</code>。该方法接受一个可以具有<code class="du kx ky kz la b">title</code>、<code class="du kx ky kz la b">text</code>或<code class="du kx ky kz la b">url</code>属性的对象。必须拥有<code class="du kx ky kz la b">text</code>或<code class="du kx ky kz la b">url</code>房产，尽管你可以两者都拥有。</p><p id="23ac" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">你只能作为用户手势的结果调用<code class="du kx ky kz la b">navigator.share</code>，这样网站就不会让用户惊讶地分享页面。此外，像其他强大的新网络平台功能一样，它只能在HTTPS托管的网站上运行。</p><p id="a11f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">该API是基于承诺的，当一个页面被成功共享时，承诺将被解决。如果用户不能分享或者选择不分享，承诺就会拒绝。</p><p id="c092" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您可以检测API的存在，这样您就可以使用web share API逐步增强网站。这是一个好消息，因为API现在只作为<a class="ae jn" href="https://github.com/jpchase/OriginTrials/blob/gh-pages/developer-guide.md" rel="noopener ugc nofollow" target="_blank">原始试用版</a>提供。这意味着它不是广泛可用的，你需要选择在你的网站上测试这个特性。如果你在一个尚不支持API的浏览器上，点击这篇文章底部的“分享”，你会被导向到<a class="ae jn" href="https://dev.twitter.com/web/tweet-button/web-intent" rel="noopener ugc nofollow" target="_blank"> Twitter web intent </a>。</p><p id="2c94" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这就是你调用web共享API的方式。</p><pre class="jq jr js jt fd lb la lc ld aw le bi"><span id="afe0" class="lf jv hh la b fi lg lh l li lj">navigator.share({ title: title, url: url }) .then(function() { console.log("Share success!"); }) .catch(function() { console.log("Share failure!"); });</span></pre><p id="d510" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这是我为这个网站实现的第一个网络共享API。</p><pre class="jq jr js jt fd lb la lc ld aw le bi"><span id="3bc8" class="lf jv hh la b fi lg lh l li lj">var shareLinks = [].slice.call(document.querySelectorAll('.share'));<br/>shareLinks.forEach(function(link) {<br/>  link.addEventListener('click', function (event) {<br/>    if (typeof navigator.share !== 'undefined') {<br/>      event.preventDefault();<br/>      var canonicalElement = document.querySelector('link[rel=canonical]');<br/>      if(canonicalElement !== undefined) {<br/>        var url = canonicalElement.href;<br/>      } else {<br/>        var url = window.location.href;<br/>      }<br/>      var pageTitle = document.querySelector('.post-title').textContent;<br/>      navigator.share({ title: pageTitle, url: url })<br/>        .then(function() { console.log("Share success!"); })<br/>        .catch(function() { console.log("Share failure!"); });<br/>    } else {<br/>      // No web share API...<br/>    }<br/>  });<br/>});</span></pre><p id="cc11" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如您所见，这里的大部分代码都是设置监听器、特性检查和获取实际数据来共享。分解一下，情况是这样的:</p><ol class=""><li id="d21a" class="lk ll hh ir b is it iw ix ja lm je ln ji lo jm lp lq lr ls bi translated">选择类别为“共享”的所有链接</li><li id="da48" class="lk ll hh ir b is lt iw lu ja lv je lw ji lx jm lp lq lr ls bi translated">为每个链接添加一个“点击”监听器</li><li id="c779" class="lk ll hh ir b is lt iw lu ja lv je lw ji lx jm lp lq lr ls bi translated">点击共享链接时，检查是否存在<code class="du kx ky kz la b">navigator.share</code></li><li id="4a32" class="lk ll hh ir b is lt iw lu ja lv je lw ji lx jm lp lq lr ls bi translated">如果它确实存在，停止链接做任何事情</li><li id="a7df" class="lk ll hh ir b is lt iw lu ja lv je lw ji lx jm lp lq lr ls bi translated">尝试获取页面的规范URL，如果存在，首先从link元素获取，否则从<code class="du kx ky kz la b">window.location.href</code>获取</li><li id="10fd" class="lk ll hh ir b is lt iw lu ja lv je lw ji lx jm lp lq lr ls bi translated">从页面的h1元素获取页面标题</li><li id="4f6e" class="lk ll hh ir b is lt iw lu ja lv je lw ji lx jm lp lq lr ls bi translated">分享标题和网址</li></ol><p id="c659" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">你可以在GitHub 中看到<a class="ae jn" href="https://github.com/philnash/philna.sh/blob/3075d51dcf723b26eaae0fa1149dd5fa3a14b03e/_assets/js/main.js#L6-L49" rel="noopener ugc nofollow" target="_blank">的完整代码(在撰写本文时)。</a></p><h1 id="26a7" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">关于API的思考</h1><p id="f251" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">我喜欢这个API，我喜欢它给开发者和用户带来的好处。</p><p id="a649" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">首先，它很容易实现。一种方法，三种可能的论点，成功和失败的保证。您可以更深入地研究它，但是从表面上看，开发人员可以在几分钟内实现它。如果API成为一个标准，希望这种简单性将导致迅速的采用。</p><p id="fc8f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我是你的粉丝还有更多原因。</p><h1 id="6f26" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">用户选择</h1><p id="f133" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">它会阻止主机网站选择用户可以共享内容的位置。当然，脸书和Twitter是受欢迎的分享目的地，但还有很多应用程序可供你分享内容。这种长尾效应意味着，只提供一两个分享按钮是不令人满意的，让随处分享成为可能也是不明智的。<a class="ae jn" href="http://platform.sharethis.com/get-inline-share-buttons" rel="noopener ugc nofollow" target="_blank"> ShareThis可能有一堆可用的分享按钮</a>，但是这个选择仍然没有触及网络的表面可能性。</p><p id="d904" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最终，像这样的共享API将控制权放回用户手中，允许他们共享他们选择安装在设备上的应用程序。</p><h1 id="fc84" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">最小化JavaScript</h1><p id="1553" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">您已经看到了上面我用来实现web share API的代码。没多少了。</p><p id="e08b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">与流行网站提供的支持共享功能的脚本相比，它显得特别小。Twitter的脚本大约是32kB，脸书的脚本<a class="ae jn" href="https://developers.facebook.com/docs/plugins/share-button" rel="noopener ugc nofollow" target="_blank">大约是60kB。最佳实践是异步加载这些脚本，因此它们不会影响页面加载时间。但是，仅仅为了一个共享按钮，就需要加载和解析大量的JavaScript代码。</a></p><p id="4f2e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这些脚本不只是作为开发人员实现的共享按钮。他们允许脸书、推特之类的网站在网上追踪他们的用户。web share API不仅为网站所有者提供了一种更有效的用户共享方式，而且还给出了一些用户隐私。</p><h1 id="ef8f" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">更好的反馈</h1><p id="b628" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">虽然大型社交网络可能更难追踪用户，但web share API实际上让网站更容易了解用户的行为。由于share API与Promises一起工作，您可以发现何时单击了share链接，以及何时单击导致了与另一个应用程序的共享。</p><h1 id="34c0" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">少了什么？</h1><p id="1546" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">目前，web共享API的实现中缺少的是它的另一面。<a class="ae jn" href="https://github.com/WICG/web-share-target" rel="noopener ugc nofollow" target="_blank">web共享目标API </a>是一个API，当调用web共享API时，它将允许web应用程序注册以出现在共享抽屉中。如果没有目标API，web共享API只能直接共享到用户设备上可用的本地应用程序。虽然对于那些已经在用户设备上安装了应用程序的大型社交网络来说，这可能还可以，但这无助于潜在共享目标的长尾。</p><p id="bcd4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我明白成为分享目标是一个比分享复杂得多的过程。对share API和share target API的研究已经被分开，这是一件好事，这样我们可以更快地试验web share API。我希望很快能看到web share target API的试用想法。</p><p id="7590" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">web share API目前是一个实验(<a class="ae jn" href="https://docs.google.com/forms/d/e/1FAIpQLSfO0_ptFl8r8G0UFhT0xhV17eabG-erUWBDiKSRDTqEZ_9ULQ/viewform?entry.1999497328=Web+Share+(Experimenting+until+April+2017)" rel="noopener ugc nofollow" target="_blank">，你可以注册自己试用</a>)，但我认为这是一个有趣且有意义的实验。最终让用户选择他们可以分享什么对用户更好，对应用程序的长尾更好。</p><p id="5bd6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如何看待web share API？请在推特上通过<a class="ae jn" href="https://twitter.com/philnash" rel="noopener ugc nofollow" target="_blank"> @philnash </a>告诉我。如果你觉得自己很慷慨，<a class="ae jn" href="https://philna.sh/blog/2017/03/14/the-web-share-api/" rel="noopener ugc nofollow" target="_blank">为什么不分享这篇文章呢</a>！</p></div><div class="ab cl ly lz go ma" role="separator"><span class="mb bw bk mc md me"/><span class="mb bw bk mc md me"/><span class="mb bw bk mc md"/></div><div class="ha hb hc hd he"><p id="d1d1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><a class="ae jn" href="https://philna.sh/blog/2017/03/14/the-web-share-api/" rel="noopener ugc nofollow" target="_blank"><em class="jo">web share API</em></a><em class="jo">最初发布于2017年3月14日</em><a class="ae jn" href="https://philna.sh/blog/2017/03/14/the-web-share-api/" rel="noopener ugc nofollow" target="_blank"><em class="jo">philna . sh</em></a><em class="jo">。</em></p></div></div>    
</body>
</html>