<html>
<head>
<title>Even Better Protocol Buffers With Wire 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用Wire 2实现更好的协议缓冲器</h1>
<blockquote>原文：<a href="https://medium.com/square-corner-blog/even-better-protocol-buffers-with-wire-2-1812fad303f2?source=collection_archive---------1-----------------------#2015-10-28">https://medium.com/square-corner-blog/even-better-protocol-buffers-with-wire-2-1812fad303f2?source=collection_archive---------1-----------------------#2015-10-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="2b99" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">新的Wire版本可以缩小您的模式。</h2></div><p id="b843" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="js">由</em> <a class="jt ju ge" href="https://medium.com/u/dee2b4f5bec4?source=post_page-----1812fad303f2--------------------------------" rel="noopener" target="_blank">撰写<em class="js">杰西·威尔逊</em>T5<em class="js">。</em></a></p><blockquote class="jv"><p id="3b05" class="jw jx hh bd jy jz ka kb kc kd ke jr dx translated">注意，我们已经行动了！如果您想继续了解Square的最新技术内容，请访问我们的新家<a class="ae kf" href="https://developer.squareup.com/blog" rel="noopener ugc nofollow" target="_blank">https://developer.squareup.com/blog</a></p></blockquote><p id="6504" class="pw-post-body-paragraph iw ix hh iy b iz kg ii jb jc kh il je jf ki jh ji jj kj jl jm jn kk jp jq jr ha bi translated">我们已经在<a class="ae kf" href="https://github.com/square/wire/" rel="noopener ugc nofollow" target="_blank"> Wire </a>上取得了稳定的进展，这是我们为Android和Java实现的紧凑、不可变的协议缓冲区。今天，我很高兴地宣布Wire 2.0，它进一步完善了我们对协议缓冲区的理解。</p><p id="0e27" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Wire 2中我最喜欢的特性之一是我们复杂的模式修剪。假设您有一个由event.proto定义的分析API:</p><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="f0e3" class="ku kv hh kq b fi kw kx l ky kz">message Event {<br/>  optional int64 created_at = 1;<br/>  optional string message = 2;<br/>  optional string url = 3;<br/>  optional Browser browser = 4;<br/>}</span><span id="1d53" class="ku kv hh kq b fi la kx l ky kz">message Browser {<br/>  optional string user_agent = 1;<br/>  repeated Feature features = 2;</span><span id="c009" class="ku kv hh kq b fi la kx l ky kz">  enum Feature {<br/>    WEBGL = 1;<br/>    LOCAL_STORAGE = 2;<br/>    WEB_SQL = 3;<br/>  }<br/>}</span></pre><p id="c3fa" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">事件上的浏览器字段对Android应用程序来说既没用也没必要。但是因为事件类型依赖于它，所以浏览器类和特性枚举都被拖到生成的代码中。未使用的代码会减慢构建速度，扩大APK，并分散周围有用代码的注意力。</p><p id="1d47" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Wire 2可以使用includes和excludes编译器选项删除不需要的垃圾。我们可以删除出现在任何地方的浏览器类型:</p><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="5786" class="ku kv hh kq b fi kw kx l ky kz">&lt;plugin&gt;<br/>  &lt;groupId&gt;com.squareup.wire&lt;/groupId&gt;<br/>  &lt;artifactId&gt;wire-maven-plugin&lt;/artifactId&gt;</span><span id="66c3" class="ku kv hh kq b fi la kx l ky kz">  ...</span><span id="f6d2" class="ku kv hh kq b fi la kx l ky kz">    &lt;excludes&gt;<br/>      &lt;exclude&gt;squareup.events.Browser&lt;/exclude&gt;<br/>    &lt;/excludes&gt;</span><span id="8170" class="ku kv hh kq b fi la kx l ky kz">  ...</span><span id="86c5" class="ku kv hh kq b fi la kx l ky kz">&lt;/plugin&gt;</span></pre><p id="0298" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">或者仅出现这种情况:</p><pre class="kl km kn ko fd kp kq kr ks aw kt bi"><span id="e362" class="ku kv hh kq b fi kw kx l ky kz">&lt;plugin&gt;<br/>  &lt;groupId&gt;com.squareup.wire&lt;/groupId&gt;<br/>  &lt;artifactId&gt;wire-maven-plugin&lt;/artifactId&gt;</span><span id="9345" class="ku kv hh kq b fi la kx l ky kz">  ...</span><span id="9f63" class="ku kv hh kq b fi la kx l ky kz">    &lt;excludes&gt;<br/>      &lt;exclude&gt;squareup.events.Event#browser&lt;/exclude&gt;<br/>    &lt;/excludes&gt;</span><span id="495f" class="ku kv hh kq b fi la kx l ky kz">  ...</span><span id="3a77" class="ku kv hh kq b fi la kx l ky kz">&lt;/plugin&gt;</span></pre><p id="1bd3" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">无论哪种情况，我们都会得到一个更适合使用它的客户机的事件消息。提供白名单和黑名单标识符，Wire 2将保留匹配的项目及其可传递的依赖关系。</p><p id="7519" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">使用修剪来隐藏较新客户端的旧的、不推荐使用的内容，而服务保留所有内容以实现向后兼容性。或者对快速移动的客户团队隐藏新的、不稳定的字段！</p><p id="ce61" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Wire 2的<a class="ae kf" href="https://github.com/square/wire/blob/master/CHANGELOG.md" rel="noopener ugc nofollow" target="_blank"> changelog </a>列出了所有的新内容(这是实质性的)！将<a class="ae kf" href="https://github.com/square/wire/" rel="noopener ugc nofollow" target="_blank">线2.0.0接到GitHub </a>上。</p></div><div class="ab cl lb lc go ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ha hb hc hd he"><div class="kl km kn ko fd li"><a rel="noopener follow" target="_blank" href="/@swankjesse"><div class="lj ab dw"><div class="lk ab ll cl cj lm"><h2 class="bd hi fi z dy ln ea eb lo ed ef hg bi translated">杰西·威尔逊</h2><div class="lp l"><h3 class="bd b fi z dy ln ea eb lo ed ef dx translated">安卓和笑话。</h3></div><div class="lq l"><p class="bd b fp z dy ln ea eb lo ed ef dx translated">medium.com</p></div></div><div class="lr l"><div class="ls l lt lu lv lr lw lx li"/></div></div></a></div></div></div>    
</body>
</html>