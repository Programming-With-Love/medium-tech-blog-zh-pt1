<html>
<head>
<title>Getting Started with Oracle Graph Server and Client</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Oracle图形服务器和客户机入门</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/getting-started-with-oracle-graph-server-and-client-43e458253fec?source=collection_archive---------5-----------------------#2022-07-15">https://medium.com/oracledevs/getting-started-with-oracle-graph-server-and-client-43e458253fec?source=collection_archive---------5-----------------------#2022-07-15</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="aa25" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本文中，我们将探索一个简单的用例来开始使用Oracle Graph Server和Client。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/348ab9d68f59308ba23b5ee2817713fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bmUyLsx-cmR7RSx6vhiQhw.png"/></div></div></figure><h1 id="a885" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">先决条件</h1><p id="ce20" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">本文假设您已经有了一个<strong class="ig hi"> Oracle数据库，并为该数据库</strong>配置了Graph Server。如果您还没有这样做，您可以按照<a class="ae kr" rel="noopener" href="/@rahultasker/deploy-oracle-graph-on-oci-with-autonomous-database-without-a-database-wallet-15708145c8a4">的这些步骤</a>在Oracle Cloud上部署带有自治数据库的图形服务器/客户端市场映像，或者按照我们的<a class="ae kr" href="https://docs.oracle.com/en/database/oracle/property-graph/21.2/spgdg/oracle-graph-server-and-client-installation.html" rel="noopener ugc nofollow" target="_blank">官方文档</a>部署图形服务器/客户端。</p><p id="6c98" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们还假设您已经<strong class="ig hi">创建了一个数据库用户，该用户拥有图形</strong>的必要权限。如果没有，如果您使用自治数据库，您可以遵循这些步骤<a class="ae kr" rel="noopener" href="/@rahultasker/deploy-oracle-graph-on-oci-with-autonomous-database-without-a-database-wallet-15708145c8a4">;如果您使用自我管理的Oracle数据库，您可以遵循这些步骤</a><a class="ae kr" href="https://docs.oracle.com/en/database/oracle/property-graph/22.2/spgdg/basic-steps-using-oracle-database-authentication.html" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="aab3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您已经在Graph Server VM上安装了<strong class="ig hi">SQL和必要的包</strong>。默认情况下，Oracle Marketplace映像已经安装了此功能。如果你有一个自我管理的数据库，你可以安装<a class="ae kr" href="https://docs.oracle.com/en/database/oracle/property-graph/22.2/spgdg/installing-pl-sql-packages-oracle-database.html" rel="noopener ugc nofollow" target="_blank">这个PL/SQL包</a>到你的数据库；点击<a class="ae kr" href="https://www.oracle.com/tools/downloads/sqlcl-downloads.html" rel="noopener ugc nofollow" target="_blank">此处</a>下载SQL，点击<a class="ae kr" href="https://docs.oracle.com/en/database/oracle/sql-developer-command-line/20.2/sqcug/using-pgql-plug-sqlcl.html#GUID-E0EFA43F-003F-4C8C-8056-54E9A428B8B7" rel="noopener ugc nofollow" target="_blank">此处</a>下载SQL的PGQL插件。</p><h1 id="86c3" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">创建数据库表</h1><ol class=""><li id="4145" class="ks kt hh ig b ih km il kn ip ku it kv ix kw jb kx ky kz la bi translated">使用支持图形的用户连接到Oracle数据库。有关连接到Oracle数据库的说明，请参见此<a class="ae kr" href="https://docs.oracle.com/en/database/oracle/oracle-database/tutorial-create-conn/index.html?opt-release-19c" rel="noopener ugc nofollow" target="_blank">文档</a>。要连接到自治数据库，请参见本<a class="ae kr" href="https://docs.oracle.com/en/cloud/paas/atp-cloud/atpgs/autonomous-connect-sql-developer.html#GUID-14217939-3E8F-4782-BFF2-021199A908FD" rel="noopener ugc nofollow" target="_blank">文档</a>。</li><li id="0749" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">创建以下表格:</li></ol><pre class="jd je jf jg fd lg lh li lj aw lk bi"><span id="ea6e" class="ll jp hh lh b fi lm ln l lo lp">create table users_table(<br/>   user_id         NUMBER(4),<br/>   first_name      VARCHAR2(50),<br/>   last_name       VARCHAR2(50),<br/>   gender          VARCHAR2(50),<br/>   date_of_birth   TIMESTAMP(3),<br/>   phone_number    VARCHAR2(50),<br/>   infected        VARCHAR2(50),<br/>   date_diagnosis  TIMESTAMP(3),<br/>   constraint pk_uid primary key (user_id)<br/>);</span><span id="9562" class="ll jp hh lh b fi lq ln l lo lp">create table contacts(<br/>   contact_id      NUMBER(4),<br/>   reporting_user  NUMBER(4),<br/>   contact_user    NUMBER(4),<br/>   contact_start   TIMESTAMP(3),<br/>   contact_end     TIMESTAMP(3),<br/>   infectious_start TIMESTAMP(3),<br/>   infectious_end  TIMESTAMP(3),<br/>   constraint pk_cid primary key (contact_id),<br/>   constraint FK_rep_user<br/>      FOREIGN key (reporting_user) references users_table(user_id),<br/>   constraint FK_con_user<br/>      FOREIGN key (contact_user) references users_table(user_id)</span><span id="0da2" class="ll jp hh lh b fi lq ln l lo lp">);</span></pre><p id="a0f8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lh b">users_table</code>将代表该图中的所有顶点。<code class="du lr ls lt lh b">contacts</code>表将代表该图中的所有边。</p><h1 id="c35d" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">加载数据</h1><ol class=""><li id="d6cc" class="ks kt hh ig b ih km il kn ip ku it kv ix kw jb kx ky kz la bi translated">下载<a class="ae kr" href="https://objectstorage.us-ashburn-1.oraclecloud.com/p/p3AFrSMppUbwMnKlfO1258cI2n4w-vWfW0cp1gRbP8B-nv2Fb_ZvC-zGVUS30bfQ/n/oradbclouducm/b/contact-tracing-blog/o/oracle_graph_server_contact_tracing.zip" rel="noopener ugc nofollow" target="_blank">这个zip文件</a>，其中包含每个表的csv文件。</li><li id="1bdd" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">将<code class="du lr ls lt lh b">users.csv</code>载入<code class="du lr ls lt lh b">users_table</code>，将<code class="du lr ls lt lh b">contacts.csv</code>载入<code class="du lr ls lt lh b">contacts</code>。这可以通过SQL Developer来完成，这里的<a class="ae kr" href="https://docs.oracle.com/database/121/ADMQS/GUID-7068681A-DC4C-4E09-AC95-6A5590203818.htm#ADMQS0826" rel="noopener ugc nofollow" target="_blank">给出了一个例子</a>。</li></ol><h1 id="b4b9" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">创建图表</h1><ol class=""><li id="7abd" class="ks kt hh ig b ih km il kn ip ku it kv ix kw jb kx ky kz la bi translated">SSH到您的图形服务器实例。</li><li id="c8a8" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">使用您的图形用户登录到SQLcl。如果您将marketplace图像与Autonomous一起使用，将如下所示:</li></ol><pre class="jd je jf jg fd lg lh li lj aw lk bi"><span id="e9dd" class="ll jp hh lh b fi lm ln l lo lp">$ sql -oci<br/>$ Username? (''?) <strong class="lh hi">graph_user@&lt;ADB_connection_string&gt;</strong><br/>$ Password? <strong class="lh hi">&lt;graph_user_password&gt;</strong></span></pre><p id="acbe" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3.使能PGQL模式。</p><pre class="jd je jf jg fd lg lh li lj aw lk bi"><span id="1d61" class="ll jp hh lh b fi lm ln l lo lp">pgql auto on;</span></pre><p id="d980" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">4.创建属性图。</p><pre class="jd je jf jg fd lg lh li lj aw lk bi"><span id="6699" class="ll jp hh lh b fi lm ln l lo lp">PGQL&gt; CREATE PROPERTY GRAPH Contact_Graph<br/>   VERTEX TABLES ( <br/>      graph_user.users_table KEY ( user_id ) <br/>      PROPERTIES ( <br/>         date_diagnosis, <br/>         date_of_birth, <br/>         first_name,<br/>         gender,<br/>         infected,<br/>         last_name,<br/>         phone_number,<br/>         user_id <br/>      )) <br/>   EDGE TABLES ( <br/>      graph_user.contacts SOURCE KEY ( reporting_user ) <br/>      REFERENCES users_table DESTINATION KEY ( contact_user ) <br/>      REFERENCES users_table PROPERTIES ( <br/>         contact_end,<br/>         contact_id,<br/>         contact_start,<br/>         contact_user,<br/>         infectious_end,<br/>         infectious_start,<br/>         reporting_user<br/> ));</span></pre><p id="45de" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">4.从SQL断开连接。</p><h1 id="a74d" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">使用图形可视化工具登录</h1><p id="491b" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">此时，我们应该能够看到图表已经在数据库中创建了。我们将能够使用SQL或图形可视化工具运行PGQL查询。请注意，当我们将图表加载到内存中时，我们可以额外运行图表分析算法，并获得对数据的更多了解。</p><ol class=""><li id="b4c4" class="ks kt hh ig b ih ii il im ip lu it lv ix lw jb kx ky kz la bi translated">在浏览器中，导航到Oracle图形可视化工具。这应该看起来像:</li></ol><pre class="jd je jf jg fd lg lh li lj aw lk bi"><span id="aa8b" class="ll jp hh lh b fi lm ln l lo lp"><a class="ae kr" href="https://129.213.36.55:7007/ui/login" rel="noopener ugc nofollow" target="_blank">https://&lt;IP of graph viz&gt;:7007/ui/</a></span></pre><p id="0f07" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.选择<strong class="ig hi">高级选项</strong>下拉菜单，并选择<strong class="ig hi">数据库</strong>选项卡。</p><p id="dd58" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3.在<strong class="ig hi">数据库URL </strong>框中，输入您的数据库JDBC url。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lx"><img src="../Images/07cf9288176ebaee5f64d8f5c6d9a53b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zI4FY6L2tUmOACKEErqI6g.png"/></div></div></figure><p id="c93a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">4.点击<strong class="ig hi">提交。</strong></p><h1 id="575e" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">查询您的图表</h1><ol class=""><li id="79d2" class="ks kt hh ig b ih km il kn ip ku it kv ix kw jb kx ky kz la bi translated">在图形可视化中，选择左下方的下拉框，然后选择我们刚刚制作的图形。</li></ol><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ly"><img src="../Images/ff03f62e89feaa4ca3237d32e408e31b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eiUGypFhRYfLCAe_JeSAeA.png"/></div></div></figure><p id="ca65" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.查询并可视化CONTACT_GRAPH的100个元素(节点和边)。该查询显示了100个元素的结果，其中源顶点与目的顶点有一个事务。换句话说，这显示了人们相互接触的100次。</p><pre class="jd je jf jg fd lg lh li lj aw lk bi"><span id="b5be" class="ll jp hh lh b fi lm ln l lo lp">select * <br/>from match (s)-[t]-&gt;(d) on contact_graph <br/>limit 100</span></pre><p id="edba" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3.基于联系人是否被感染进行查询和可视化。</p><pre class="jd je jf jg fd lg lh li lj aw lk bi"><span id="edcf" class="ll jp hh lh b fi lm ln l lo lp">select * from<br/>match (s) - [t] -&gt; (d) on contact_graph <br/>where s.infected='yes'</span></pre><p id="5cd8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">4.假设一个人在诊断前或诊断后两周可能具有传染性，进行询问和想象。</p><pre class="jd je jf jg fd lg lh li lj aw lk bi"><span id="fced" class="ll jp hh lh b fi lm ln l lo lp">select * from <br/>match (s) - [t] -&gt; (d) on contact_graph <br/>where s.infected = 'yes' and (s.date_diagnosis &gt;=  t.infectious_start and s.date_diagnosis &lt;=  t.infectious_end)</span></pre><p id="9fd8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">5.我们可以钻得更深，看看是否有任何人在一个群体中被感染，然后谁暴露了更多的人。</p><pre class="jd je jf jg fd lg lh li lj aw lk bi"><span id="e0ee" class="ll jp hh lh b fi lm ln l lo lp">select * from<br/>match (s) - [t] -&gt; (d) - [f] -&gt; (v) on contact_graph <br/>where s.infected = 'yes' and (s.date_diagnosis &gt;=  t.infectious_start and s.date_diagnosis &lt;=  t.infectious_end)</span></pre><p id="ddb4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">6.但是，我们也想看看接触的人是否暴露在传染范围内。</p><pre class="jd je jf jg fd lg lh li lj aw lk bi"><span id="b297" class="ll jp hh lh b fi lm ln l lo lp">select * from<br/>match (s) - [t] -&gt; (d) - [f] -&gt; (v) on contact_graph<br/>where s.infected = 'yes' and (s.date_diagnosis &gt;=  t.infectious_start and s.date_diagnosis &lt;=  t.infectious_end)<br/>and d.infected = 'yes' and (d.date_diagnosis &gt;=  f.infectious_start and d.date_diagnosis &lt;=  f.infectious_end)</span></pre><h1 id="80bf" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">示例使用案例</h1><p id="215e" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">假设Judy(用户ID 1)听说Janet(用户ID 73)被感染，并将病毒传播给了其他几个人。这个人关心他们的健康，并问<em class="lz">“在任何时候，我是否离珍妮特只有两个或更少的接触点？”</em>我们可以通过用Janet和Judy的用户ID运行<em class="lz">匹配所有</em>查询来帮助她。</p><ol class=""><li id="39fb" class="ks kt hh ig b ih ii il im ip lu it lv ix lw jb kx ky kz la bi translated">运行以下查询。这里，我们查询Judy和Janet之间的所有具有两条或更少边的路径。</li></ol><pre class="jd je jf jg fd lg lh li lj aw lk bi"><span id="ec06" class="ll jp hh lh b fi lm ln l lo lp">SELECT p1.user_id AS start, p2.user_id as end_<br/>   FROM MATCH All (p1) -[e]-&gt;{,2} (p2)<br/>   WHERE p1.user_id =1 AND p2.user_id =73</span></pre><p id="71b1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.单击图形可视化工具中的表格模式选项，可以看到Judy和Janet之间有32条路径，两条或更少的边。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ma"><img src="../Images/95cf298612454b266a4896d217fdebbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6udqnwlqEE3zOXmCIHVBtw.png"/></div></div></figure><p id="ecd5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3.我们可以确认Judy和Janet从未直接接触过下面的查询，该查询应该返回一个空结果。</p><pre class="jd je jf jg fd lg lh li lj aw lk bi"><span id="72bf" class="ll jp hh lh b fi lm ln l lo lp">SELECT *<br/>   FROM MATCH (p1) -[e]-&gt; (p2)<br/>   WHERE p1.user_id =73 AND p2.user_id =1</span></pre><p id="398a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">4.然后，我们可以查询Janet在被感染时接触了哪些人，以及这些人在与Judy接触时是否被感染并具有传染性。</p><pre class="jd je jf jg fd lg lh li lj aw lk bi"><span id="8c88" class="ll jp hh lh b fi lm ln l lo lp">SELECT *<br/>   FROM MATCH (p1) -[e]-&gt; (i) -[f]-&gt; (p2)<br/>   WHERE p1.user_id =73 AND p2.user_id =1<br/>and<br/>   i.infected='yes'<br/>and<br/>   ((e.infectious_start &lt;= e.contact_start and e.contact_start &lt;= e.infectious_end)<br/>   or (e.contact_start &lt;= e.infectious_start and e.contact_end &lt;= e.infectious_end)<br/>   or (e.contact_start &lt;= e.infectious_start and e.infectious_end &lt;= e.contact_end))<br/>and<br/>   ((f.infectious_start &lt;= f.contact_start and f.contact_start &lt;= f.infectious_end)<br/>   or (f.contact_start &lt;= f.infectious_start and f.contact_end &lt;= f.infectious_end)<br/>   or (f.contact_start &lt;= f.infectious_start and f.infectious_end &lt;= f.contact_end))</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mb"><img src="../Images/f277984986d72d36ab9687147b7d7ce0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gImEf-iUfOuZDojQVwryWA.png"/></div></div></figure><p id="97e6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有了这些信息，我们可以回答Judy的问题，告诉她32次她离Janet有两个接触点。然而，他们两人从未有过直接接触，其中只有四个接触点处于Janet的传染范围内，是中间接触点。</p><p id="7238" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，您可以继续使用类似的语法进行查询，并探索图形！你可以在这里找到PGQL <a class="ae kr" href="https://pgql-lang.org/" rel="noopener ugc nofollow" target="_blank">的官方文档</a>。</p></div><div class="ab cl mc md go me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ha hb hc hd he"><p id="e4a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请从以下网址了解有关<strong class="ig hi"> Oracle Graph </strong>的更多信息:</p><ul class=""><li id="7e52" class="ks kt hh ig b ih ii il im ip lu it lv ix lw jb mj ky kz la bi translated"><a class="ae kr" rel="noopener" href="/tag/oracle-graph">中</a> (=所有带有Oracle Graph标签的文章)</li><li id="770a" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb mj ky kz la bi translated"><a class="ae kr" href="https://stackoverflow.com/questions/tagged/oracle-graph" rel="noopener ugc nofollow" target="_blank">堆栈溢出</a> (=带有oracle-graph标记的问题)</li><li id="72de" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb mj ky kz la bi translated"><a class="ae kr" href="https://join.slack.com/t/andouc/shared_invite/zt-1a2hmiz6f-vLlblcQyv0t9FMraMMP5uQ" rel="noopener ugc nofollow" target="_blank"> Slack AnDOUC </a> (=邀请链接，请访问#graph)</li><li id="136e" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb mj ky kz la bi translated"><a class="ae kr" href="https://join.slack.com/t/oracledevrel/shared_invite/zt-uffjmwh3-ksmv2ii9YxSkc6IpbokL1g" rel="noopener ugc nofollow" target="_blank"> Slack OracleDevRel </a> (=邀请链接，请访问#oracle-db-graph)</li></ul></div></div>    
</body>
</html>