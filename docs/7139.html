<html>
<head>
<title>Welcome to the (Color) Matrix</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">欢迎来到(彩色)矩阵</h1>
<blockquote>原文：<a href="https://medium.com/square-corner-blog/welcome-to-the-color-matrix-64d112e3f43d?source=collection_archive---------2-----------------------#2015-12-09">https://medium.com/square-corner-blog/welcome-to-the-color-matrix-64d112e3f43d?source=collection_archive---------2-----------------------#2015-12-09</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="2935" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">结合毕加索和色彩矩阵来转换图像。</h2></div><p id="0237" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="js">作者写的</em><a class="ae jt" href="https://twitter.com/Piwai" rel="noopener ugc nofollow" target="_blank"><em class="js"/></a><em class="js">。</em></p><blockquote class="ju"><p id="4cf2" class="jv jw hh bd jx jy jz ka kb kc kd jr dx translated">注意，我们已经行动了！如果您想继续了解Square的最新技术内容，请访问我们的新家<a class="ae jt" href="https://developer.squareup.com/blog" rel="noopener ugc nofollow" target="_blank">https://developer.squareup.com/blog</a></p></blockquote><p id="a850" class="pw-post-body-paragraph iw ix hh iy b iz ke ii jb jc kf il je jf kg jh ji jj kh jl jm jn ki jp jq jr ha bi translated"><em class="js">这篇文章以分享一个很酷的技巧的内部邮件帖子开始。我对下面描述的问题没有什么正式的了解，并且采取了一种经验主义的方法。欢迎在评论中反馈！</em></p><h1 id="38bc" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">规范</h1><p id="a913" class="pw-post-body-paragraph iw ix hh iy b iz lb ii jb jc lc il je jf ld jh ji jj le jl jm jn lf jp jq jr ha bi translated">我正在开发一个新的屏幕，上面显示一个下载的图片，上面有一个标题和以下限制:</p><ul class=""><li id="5a23" class="lg lh hh iy b iz ja jc jd jf li jj lj jn lk jr ll lm ln lo bi translated">屏幕应该用运行时确定的颜色为主题；</li><li id="6f91" class="lg lh hh iy b iz lp jc lq jf lr jj ls jn lt jr ll lm ln lo bi translated"><strong class="iy hi">图像应着色为该颜色</strong>；</li><li id="9674" class="lg lh hh iy b iz lp jc lq jf lr jj ls jn lt jr ll lm ln lo bi translated">顶部的文本应该<strong class="iy hi">可读</strong>并且图像不应该窃取用户的注意力；和</li><li id="ffe8" class="lg lh hh iy b iz lp jc lq jf lr jj ls jn lt jr ll lm ln lo bi translated">图像的细节应该仍然可见。</li></ul><p id="b747" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">一位设计师给我发了一些样品:</p><h2 id="200c" class="lu kk hh bd kl lv lw lx kp ly lz ma kt jf mb mc kv jj md me kx jn mf mg kz mh bi translated">示例背景图像</h2><figure class="mj mk ml mm fd mn er es paragraph-image"><div class="er es mi"><img src="../Images/fd4cee4178094539bad6cc411eb740c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/0*STWHtM6yiyPXas_z.jpg"/></div></figure><h2 id="4175" class="lu kk hh bd kl lv lw lx kp ly lz ma kt jf mb mc kv jj md me kx jn mf mg kz mh bi translated">主题颜色#beef00的预期结果</h2><figure class="mj mk ml mm fd mn er es paragraph-image"><div class="er es mi"><img src="../Images/3dbc0d66397cb7b11160a94ee74e8bdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/0*D2noqUoEmueaf29d.png"/></div></figure><h2 id="7503" class="lu kk hh bd kl lv lw lx kp ly lz ma kt jf mb mc kv jj md me kx jn mf mg kz mh bi translated">示例背景图像</h2><figure class="mj mk ml mm fd mn er es paragraph-image"><div class="er es mi"><img src="../Images/4613f3f9e60c8db8a0ca465ab33709b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/0*gWfPvRkZqLC9wfdA.jpg"/></div></figure><p id="5e8f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">来源:<a class="ae jt" href="https://commons.wikimedia.org/wiki/File:Marmota_monax_UL_04.jpg" rel="noopener ugc nofollow" target="_blank">维基百科</a>，许可:<a class="ae jt" href="https://creativecommons.org/licenses/by-sa/3.0/deed.en" rel="noopener ugc nofollow" target="_blank">Attribution-Share like 3.0未发布</a></p><h2 id="cf2d" class="lu kk hh bd kl lv lw lx kp ly lz ma kt jf mb mc kv jj md me kx jn mf mg kz mh bi translated">主题颜色#ff93b9的预期结果</h2><figure class="mj mk ml mm fd mn er es paragraph-image"><div class="er es mi"><img src="../Images/5733952cd45909bd36e647d6ba6cd38f.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/0*Qt__SSyw-r9HqcmT.png"/></div></figure><p id="1e12" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们如何动态地给这些图像着色？</p><h1 id="392d" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">覆盖物</h1><p id="f23c" class="pw-post-body-paragraph iw ix hh iy b iz lb ii jb jc lc il je jf ld jh ji jj le jl jm jn lf jp jq jr ha bi translated">我的第一个直觉是<strong class="iy hi">添加一层目标颜色</strong>在图像上面，透明度为<strong class="iy hi">alpha</strong>。</p><p id="36db" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">用<a class="ae jt" href="http://github.com/square/picasso/" rel="noopener ugc nofollow" target="_blank"> Picasso: </a>加载和转换图像很容易</p><pre class="mj mk ml mm fd mq mr ms mt aw mu bi"><span id="b069" class="lu kk hh mr b fi mv mw l mx my">Picasso<strong class="mr hi">.</strong>with<strong class="mr hi">(this)</strong><br/>    <strong class="mr hi">.</strong>load<strong class="mr hi">(</strong>imageUrl<strong class="mr hi">)</strong><br/>    <strong class="mr hi">.</strong>fit<strong class="mr hi">()</strong><br/>    <strong class="mr hi">.</strong>centerCrop<strong class="mr hi">()</strong><br/>    <strong class="mr hi">.</strong>transform<strong class="mr hi">(new</strong> <strong class="mr hi">ColorLayer(</strong>0xffbeef00<strong class="mr hi">))</strong><br/>    <strong class="mr hi">.</strong>into<strong class="mr hi">(</strong>imageView<strong class="mr hi">);</strong></span></pre><p id="6a95" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下面是如何在位图上绘制颜色:</p><pre class="mj mk ml mm fd mq mr ms mt aw mu bi"><span id="c7ac" class="lu kk hh mr b fi mv mw l mx my"><strong class="mr hi">public</strong> <strong class="mr hi">class</strong> <strong class="mr hi">ColorLayer</strong> <strong class="mr hi">implements</strong> Transformation <strong class="mr hi">{</strong><br/>  <strong class="mr hi">private</strong> <strong class="mr hi">final</strong> <strong class="mr hi">int</strong> destinationColor<strong class="mr hi">;</strong></span><span id="c338" class="lu kk hh mr b fi mz mw l mx my">  <strong class="mr hi">public</strong> <strong class="mr hi">ColorLayer(int</strong> destinationColor<strong class="mr hi">)</strong> <strong class="mr hi">{</strong><br/>    <strong class="mr hi">this.</strong>destinationColor <strong class="mr hi">=</strong> destinationColor<strong class="mr hi">;</strong><br/>  <strong class="mr hi">}</strong></span><span id="3be5" class="lu kk hh mr b fi mz mw l mx my">  @Override <strong class="mr hi">public</strong> Bitmap <strong class="mr hi">transform(</strong>Bitmap source<strong class="mr hi">)</strong> <strong class="mr hi">{</strong><br/>    Canvas canvas <strong class="mr hi">=</strong> <strong class="mr hi">new</strong> <strong class="mr hi">Canvas(</strong>source<strong class="mr hi">);</strong><br/>    <strong class="mr hi">int</strong> dr <strong class="mr hi">=</strong> Color<strong class="mr hi">.</strong>red<strong class="mr hi">(</strong>destinationColor<strong class="mr hi">);</strong><br/>    <strong class="mr hi">int</strong> dg <strong class="mr hi">=</strong> Color<strong class="mr hi">.</strong>green<strong class="mr hi">(</strong>destinationColor<strong class="mr hi">);</strong><br/>    <strong class="mr hi">int</strong> db <strong class="mr hi">=</strong> Color<strong class="mr hi">.</strong>blue<strong class="mr hi">(</strong>destinationColor<strong class="mr hi">);</strong><br/>    canvas<strong class="mr hi">.</strong>drawColor<strong class="mr hi">(</strong>Color<strong class="mr hi">.</strong>argb<strong class="mr hi">(</strong>220<strong class="mr hi">,</strong> dr<strong class="mr hi">,</strong> dg<strong class="mr hi">,</strong> db<strong class="mr hi">));</strong><br/>    <strong class="mr hi">return</strong> source<strong class="mr hi">;</strong><br/>  <strong class="mr hi">}</strong></span><span id="5ef9" class="lu kk hh mr b fi mz mw l mx my">  @Override <strong class="mr hi">public</strong> String <strong class="mr hi">key()</strong> <strong class="mr hi">{</strong><br/>    String hexColor <strong class="mr hi">=</strong> String<strong class="mr hi">.</strong>format<strong class="mr hi">(</strong>"#%08x"<strong class="mr hi">,</strong> destinationColor<strong class="mr hi">);</strong><br/>    <strong class="mr hi">return</strong> "color-layer(destinationColor=" <strong class="mr hi">+</strong> hexColor <strong class="mr hi">+</strong> ")"<strong class="mr hi">;</strong><br/>  <strong class="mr hi">}</strong><br/><strong class="mr hi">}</strong></span></pre><figure class="mj mk ml mm fd mn er es paragraph-image"><div class="er es mi"><img src="../Images/87f388f0d0c66549dd4000e528b6f4c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/0*hUWrtTo7RLHs2mrA.png"/></div></figure><p id="d84f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">还可以，但不是很棒。原始图像中的<strong class="iy hi">颜色</strong>是中的<strong class="iy hi">出血，例如，你可以看到女人脸上红色的暗示。</strong></p><p id="63c1" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我和设计师坐下来了解模型是如何组装的。他使用混合模式将图像与一个彩色层合并——带有一定程度的不透明度。他调整了每个例子，以找到完美的模式和值，使结果看起来很好。</p><p id="d448" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">虽然这是一个很好的经验方法，但是很难转化为代码。我们尝试了更多的例子，但始终无法找到适合所有情况的通用模式和值。</p><p id="d50a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们后退一步:我们想给一幅图像着色。我们可以先建立一个图像的灰度版本，然后给它上色(感谢罗曼·盖伊的主意!)).</p><h1 id="e81c" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">灰度等级</h1><p id="dc83" class="pw-post-body-paragraph iw ix hh iy b iz lb ii jb jc lc il je jf ld jh ji jj le jl jm jn lf jp jq jr ha bi translated">在灰度中，像素的RGB通道共享相同的值。一种常见的方法是将亮度计算为偏向绿色的加权平均值，因为人眼对绿色更敏感。</p><pre class="mj mk ml mm fd mq mr ms mt aw mu bi"><span id="e3eb" class="lu kk hh mr b fi mv mw l mx my"><strong class="mr hi">int</strong> color <strong class="mr hi">=</strong> Color<strong class="mr hi">.</strong>CYAN<strong class="mr hi">;</strong><br/><strong class="mr hi">int</strong> grayChannel <strong class="mr hi">=</strong> <strong class="mr hi">(int)</strong> <strong class="mr hi">(</strong>0.2126f <strong class="mr hi">*</strong> Color<strong class="mr hi">.</strong>red<strong class="mr hi">(</strong>color<strong class="mr hi">)</strong> <em class="js">// </em><br/>    <strong class="mr hi">+</strong> 0.7152f <strong class="mr hi">+</strong> Color<strong class="mr hi">.</strong>green<strong class="mr hi">(</strong>color<strong class="mr hi">)</strong> <em class="js">//</em><br/>    <strong class="mr hi">+</strong> 0.0722f <strong class="mr hi">*</strong> Color<strong class="mr hi">.</strong>blue<strong class="mr hi">(</strong>color<strong class="mr hi">));</strong><br/><strong class="mr hi">int</strong> colorInGrayscale <strong class="mr hi">=</strong> Color<strong class="mr hi">.</strong>rgb<strong class="mr hi">(</strong>grayChannel<strong class="mr hi">,</strong> grayChannel<strong class="mr hi">,</strong> grayChannel<strong class="mr hi">);</strong></span></pre><p id="143f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们可以在每个像素上循环，如<a class="ae jt" href="http://corner.squareup.com/2013/01/transparent-jpegs.html" rel="noopener ugc nofollow" target="_blank">之前的帖子</a>所示，但那不会很有效率。相反，我们将使用一个<a class="ae jt" href="http://developer.android.com/reference/android/graphics/ColorMatrix.html" rel="noopener ugc nofollow" target="_blank">颜色矩阵</a>用颜色过滤器在画布上绘制。</p><h2 id="b9b5" class="lu kk hh bd kl lv lw lx kp ly lz ma kt jf mb mc kv jj md me kx jn mf mg kz mh bi translated">ColorMatrix Javadoc</h2><p id="aad9" class="pw-post-body-paragraph iw ix hh iy b iz lb ii jb jc lc il je jf ld jh ji jj le jl jm jn lf jp jq jr ha bi translated">用于转换位图的颜色和alpha分量的4x5矩阵。矩阵可以作为单个数组传递，处理方式如下:</p><pre class="mj mk ml mm fd mq mr ms mt aw mu bi"><span id="f3c5" class="lu kk hh mr b fi mv mw l mx my">[ a, b, c, d, e,<br/>    f, g, h, i, j,<br/>    k, l, m, n, o,<br/>    p, q, r, s, t ]</span></pre><p id="aec6" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">当应用于颜色[R，G，B，A]时，结果颜色计算如下:</p><pre class="mj mk ml mm fd mq mr ms mt aw mu bi"><span id="3390" class="lu kk hh mr b fi mv mw l mx my">R’ = a*R + b*G + c*B + d*A + e<br/>   G’ = f*R + g*G + h*B + i*A + j<br/>   B’ = k*R + l*G + m*B + n*A + o<br/>   A’ = p*R + q*G + r*B + s*A + t</span></pre><p id="31ec" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们应用我们的灰度公式。这是我们想要的:</p><pre class="mj mk ml mm fd mq mr ms mt aw mu bi"><span id="cb4a" class="lu kk hh mr b fi mv mw l mx my">R’ = 0.2126*R + 0.7152*G + 0.0722*B<br/>   G’ = 0.2126*R + 0.7152*G + 0.0722*B<br/>   B’ = 0.2126*R + 0.7152*G + 0.0722*B<br/>   A’ = 1</span></pre><p id="68cb" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">所以我们的颜色矩阵应该是:</p><pre class="mj mk ml mm fd mq mr ms mt aw mu bi"><span id="8efe" class="lu kk hh mr b fi mv mw l mx my">[ 0.2126, 0.7152, 0.0722, 0, 0,<br/>    0.2126, 0.7152, 0.0722, 0, 0,<br/>    0.2126, 0.7152, 0.0722, 0, 0,<br/>    0, 0, 0, 0, 1 ]</span></pre><p id="94f8" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们可以通过使用带有颜色矩阵颜色过滤器的画图将位图绘制到画布上来应用颜色矩阵:</p><pre class="mj mk ml mm fd mq mr ms mt aw mu bi"><span id="7bbf" class="lu kk hh mr b fi mv mw l mx my"><strong class="mr hi">public</strong> <strong class="mr hi">class</strong> <strong class="mr hi">Grayscale</strong> <strong class="mr hi">implements</strong> Transformation <strong class="mr hi">{</strong><br/>  @Override <strong class="mr hi">public</strong> Bitmap <strong class="mr hi">transform(</strong>Bitmap source<strong class="mr hi">)</strong> <strong class="mr hi">{</strong><br/>    <strong class="mr hi">float</strong> lr <strong class="mr hi">=</strong> 0.2126f<strong class="mr hi">;</strong><br/>    <strong class="mr hi">float</strong> lg <strong class="mr hi">=</strong> 0.7152f<strong class="mr hi">;</strong><br/>    <strong class="mr hi">float</strong> lb <strong class="mr hi">=</strong> 0.0722f<strong class="mr hi">;</strong></span><span id="fc2a" class="lu kk hh mr b fi mz mw l mx my">    ColorMatrix matrix <strong class="mr hi">=</strong> <strong class="mr hi">new</strong> <strong class="mr hi">ColorMatrix(new</strong> <strong class="mr hi">float[]</strong> <strong class="mr hi">{</strong><br/>        lr<strong class="mr hi">,</strong> lg<strong class="mr hi">,</strong> lb<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>        lr<strong class="mr hi">,</strong> lg<strong class="mr hi">,</strong> lb<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>        lr<strong class="mr hi">,</strong> lg<strong class="mr hi">,</strong> lb<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>        0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 255<strong class="mr hi">,</strong> <em class="js">//</em><br/>    <strong class="mr hi">});</strong></span><span id="b951" class="lu kk hh mr b fi mz mw l mx my">    ColorMatrixColorFilter filter <strong class="mr hi">=</strong> <strong class="mr hi">new</strong> <strong class="mr hi">ColorMatrixColorFilter(</strong>matrix<strong class="mr hi">);</strong><br/>    Paint paint <strong class="mr hi">=</strong> <strong class="mr hi">new</strong> <strong class="mr hi">Paint();</strong><br/>    paint<strong class="mr hi">.</strong>setColorFilter<strong class="mr hi">(</strong>filter<strong class="mr hi">);</strong><br/>    <br/>    <strong class="mr hi">int</strong> width <strong class="mr hi">=</strong> source<strong class="mr hi">.</strong>getWidth<strong class="mr hi">();</strong><br/>    <strong class="mr hi">int</strong> height <strong class="mr hi">=</strong> source<strong class="mr hi">.</strong>getHeight<strong class="mr hi">();</strong><br/>    Bitmap destination <strong class="mr hi">=</strong> createBitmap<strong class="mr hi">(</strong>width<strong class="mr hi">,</strong> height<strong class="mr hi">,</strong> ARGB_8888<strong class="mr hi">);</strong></span><span id="b573" class="lu kk hh mr b fi mz mw l mx my">    Canvas canvas <strong class="mr hi">=</strong> <strong class="mr hi">new</strong> <strong class="mr hi">Canvas(</strong>destination<strong class="mr hi">);</strong><br/>    canvas<strong class="mr hi">.</strong>drawBitmap<strong class="mr hi">(</strong>source<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> paint<strong class="mr hi">);</strong><br/>    source<strong class="mr hi">.</strong>recycle<strong class="mr hi">();</strong><br/>    <strong class="mr hi">return</strong> destination<strong class="mr hi">;</strong><br/>  <strong class="mr hi">}</strong></span><span id="45fc" class="lu kk hh mr b fi mz mw l mx my">  @Override <strong class="mr hi">public</strong> String <strong class="mr hi">key()</strong> <strong class="mr hi">{</strong><br/>    <strong class="mr hi">return</strong> "grayscale()"<strong class="mr hi">;</strong><br/>  <strong class="mr hi">}</strong><br/><strong class="mr hi">}</strong></span></pre><figure class="mj mk ml mm fd mn er es paragraph-image"><div class="er es mi"><img src="../Images/3ba9437b20af2aafd6782895a27c696f.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/0*DzUzMhTR_R9AbbMZ.png"/></div></figure><h1 id="8e52" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">色彩</h1><p id="192e" class="pw-post-body-paragraph iw ix hh iy b iz lb ii jb jc lc il je jf ld jh ji jj le jl jm jn lf jp jq jr ha bi translated">要应用色调，我们只需将每个通道乘以色调中相应的通道。</p><pre class="mj mk ml mm fd mq mr ms mt aw mu bi"><span id="ab6f" class="lu kk hh mr b fi mv mw l mx my">Rtint = red(tint) / 255<br/>   Gtint = green(tint) / 255<br/>   Btint = blue(tint) / 255</span><span id="9fca" class="lu kk hh mr b fi mz mw l mx my">   R’ = Rtint * (0.2126*R + 0.7152*G + 0.0722*B)<br/>   G’ = Gtint * (0.2126*R + 0.7152*G + 0.0722*B)<br/>   B’ = Btint * (0.2126*R + 0.7152*G + 0.0722*B)<br/>   A’ = 1</span></pre><p id="dea3" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">换句话说，我们需要将灰度矩阵与下面的色调矩阵连接起来:</p><pre class="mj mk ml mm fd mq mr ms mt aw mu bi"><span id="a41e" class="lu kk hh mr b fi mv mw l mx my">[ Rtint, 0, 0, 0, 0,<br/>    0, Gtint, 0, 0, 0,<br/>    0, 0, Btint, 0, 0,<br/>    0, 0, 0, 0, 1 ]</span></pre><p id="a1f6" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下面是它如何翻译成代码:</p><pre class="mj mk ml mm fd mq mr ms mt aw mu bi"><span id="c677" class="lu kk hh mr b fi mv mw l mx my"><strong class="mr hi">public</strong> <strong class="mr hi">class</strong> <strong class="mr hi">Tint</strong> <strong class="mr hi">implements</strong> Transformation <strong class="mr hi">{</strong><br/>  <strong class="mr hi">private</strong> <strong class="mr hi">final</strong> <strong class="mr hi">int</strong> destinationColor<strong class="mr hi">;</strong></span><span id="65fe" class="lu kk hh mr b fi mz mw l mx my">  <strong class="mr hi">public</strong> <strong class="mr hi">Tint(int</strong> destinationColor<strong class="mr hi">)</strong> <strong class="mr hi">{</strong><br/>    <strong class="mr hi">this.</strong>destinationColor <strong class="mr hi">=</strong> destinationColor<strong class="mr hi">;</strong><br/>  <strong class="mr hi">}</strong></span><span id="e669" class="lu kk hh mr b fi mz mw l mx my">  @Override <strong class="mr hi">public</strong> Bitmap <strong class="mr hi">transform(</strong>Bitmap source<strong class="mr hi">)</strong> <strong class="mr hi">{</strong><br/>    <strong class="mr hi">float</strong> lr <strong class="mr hi">=</strong> 0.2126f<strong class="mr hi">;</strong><br/>    <strong class="mr hi">float</strong> lg <strong class="mr hi">=</strong> 0.7152f<strong class="mr hi">;</strong><br/>    <strong class="mr hi">float</strong> lb <strong class="mr hi">=</strong> 0.0722f<strong class="mr hi">;</strong></span><span id="fea6" class="lu kk hh mr b fi mz mw l mx my">    ColorMatrix grayscaleMatrix <strong class="mr hi">=</strong> <strong class="mr hi">new</strong> <strong class="mr hi">ColorMatrix(new</strong> <strong class="mr hi">float[]</strong> <strong class="mr hi">{</strong><br/>        lr<strong class="mr hi">,</strong> lg<strong class="mr hi">,</strong> lb<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>        lr<strong class="mr hi">,</strong> lg<strong class="mr hi">,</strong> lb<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>        lr<strong class="mr hi">,</strong> lg<strong class="mr hi">,</strong> lb<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>        0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 255<strong class="mr hi">,</strong> <em class="js">//</em><br/>    <strong class="mr hi">});</strong><br/>    <br/>    <strong class="mr hi">int</strong> dr <strong class="mr hi">=</strong> Color<strong class="mr hi">.</strong>red<strong class="mr hi">(</strong>destinationColor<strong class="mr hi">);</strong><br/>    <strong class="mr hi">int</strong> dg <strong class="mr hi">=</strong> Color<strong class="mr hi">.</strong>green<strong class="mr hi">(</strong>destinationColor<strong class="mr hi">);</strong><br/>    <strong class="mr hi">int</strong> db <strong class="mr hi">=</strong> Color<strong class="mr hi">.</strong>blue<strong class="mr hi">(</strong>destinationColor<strong class="mr hi">);</strong><br/>    <strong class="mr hi">float</strong> drf <strong class="mr hi">=</strong> dr <strong class="mr hi">/</strong> 255f<strong class="mr hi">;</strong><br/>    <strong class="mr hi">float</strong> dgf <strong class="mr hi">=</strong> dg <strong class="mr hi">/</strong> 255f<strong class="mr hi">;</strong><br/>    <strong class="mr hi">float</strong> dbf <strong class="mr hi">=</strong> db <strong class="mr hi">/</strong> 255f<strong class="mr hi">;</strong></span><span id="736c" class="lu kk hh mr b fi mz mw l mx my">    ColorMatrix tintMatrix <strong class="mr hi">=</strong> <strong class="mr hi">new</strong> <strong class="mr hi">ColorMatrix(new</strong> <strong class="mr hi">float[]</strong> <strong class="mr hi">{</strong><br/>        drf<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>        0<strong class="mr hi">,</strong> dgf<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>        0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> dbf<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>        0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 1<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>    <strong class="mr hi">});</strong></span><span id="af25" class="lu kk hh mr b fi mz mw l mx my">    tintMatrix<strong class="mr hi">.</strong>preConcat<strong class="mr hi">(</strong>grayscaleMatrix<strong class="mr hi">);</strong></span><span id="a45d" class="lu kk hh mr b fi mz mw l mx my">    ColorMatrixColorFilter filter <strong class="mr hi">=</strong> <strong class="mr hi">new</strong> <strong class="mr hi">ColorMatrixColorFilter(</strong>tintMatrix<strong class="mr hi">);</strong><br/>    Paint paint <strong class="mr hi">=</strong> <strong class="mr hi">new</strong> <strong class="mr hi">Paint();</strong><br/>    paint<strong class="mr hi">.</strong>setColorFilter<strong class="mr hi">(</strong>filter<strong class="mr hi">);</strong></span><span id="8723" class="lu kk hh mr b fi mz mw l mx my">    <strong class="mr hi">int</strong> width <strong class="mr hi">=</strong> source<strong class="mr hi">.</strong>getWidth<strong class="mr hi">();</strong><br/>    <strong class="mr hi">int</strong> height <strong class="mr hi">=</strong> source<strong class="mr hi">.</strong>getHeight<strong class="mr hi">();</strong><br/>    Bitmap destination <strong class="mr hi">=</strong> createBitmap<strong class="mr hi">(</strong>width<strong class="mr hi">,</strong> height<strong class="mr hi">,</strong> ARGB_8888<strong class="mr hi">);</strong></span><span id="b235" class="lu kk hh mr b fi mz mw l mx my">    Canvas canvas <strong class="mr hi">=</strong> <strong class="mr hi">new</strong> <strong class="mr hi">Canvas(</strong>destination<strong class="mr hi">);</strong><br/>    canvas<strong class="mr hi">.</strong>drawBitmap<strong class="mr hi">(</strong>source<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> paint<strong class="mr hi">);</strong><br/>    source<strong class="mr hi">.</strong>recycle<strong class="mr hi">();</strong></span><span id="1784" class="lu kk hh mr b fi mz mw l mx my">    <strong class="mr hi">return</strong> destination<strong class="mr hi">;</strong><br/>  <strong class="mr hi">}</strong></span><span id="cd7a" class="lu kk hh mr b fi mz mw l mx my">  @Override <strong class="mr hi">public</strong> String <strong class="mr hi">key()</strong> <strong class="mr hi">{</strong><br/>    String hexColor <strong class="mr hi">=</strong> String<strong class="mr hi">.</strong>format<strong class="mr hi">(</strong>"#%08x"<strong class="mr hi">,</strong> destinationColor<strong class="mr hi">);</strong><br/>    <strong class="mr hi">return</strong> "tint(destinationColor=" <strong class="mr hi">+</strong> hexColor <strong class="mr hi">+</strong> ")"<strong class="mr hi">;</strong><br/>  <strong class="mr hi">}</strong><br/><strong class="mr hi">}</strong></span></pre><figure class="mj mk ml mm fd mn er es paragraph-image"><div class="er es mi"><img src="../Images/58decbc16f5b1a8f7fcc74027cada649.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/0*SW3cCeb93BYNGpeK.png"/></div></figure><p id="82f8" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">图像按照预期着色，但是结果仍然不太好。我们希望顶部的文本是可读的，并且不希望它下面的图像偷走用户的注意力。</p><p id="58dd" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Roman Nurik写了一篇很棒的文章，讲述了他是如何为Muzei设计出模糊壁纸图像的，我想我们可以试试模糊技术。然而，我们的设计团队希望图像细节是可见的。</p><h1 id="8bc2" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">对比</h1><p id="3ce9" class="pw-post-body-paragraph iw ix hh iy b iz lb ii jb jc lc il je jf ld jh ji jj le jl jm jn lf jp jq jr ha bi translated">这是怎么回事？有太多的黑色和太多的对比。</p><p id="219a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">每个像素的亮度在0(黑色)和255(白色)之间，我们将它乘以通道颜色(比如红色)。因此，我们有效地将其缩放到[0，通道值]，这意味着黑人将保持黑色，而白人将变成我们的目标颜色。</p><p id="1106" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">仔细想想，我们实际上想要的是每个像素都是自定义的颜色，加上/减去一些变化，让图像细节通过对比在背景中显现出来。</p><p id="f137" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">换句话说，我们希望重新调整灰度图像，使其具有较低的对比度，并将其色调转移到目标颜色的中心。</p><p id="8b87" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">例如，如果我的自定义颜色为红色= 100，而我希望对比度幅度仅为20%，我们希望将[0，255]红色通道转换为仅0.2 * 255 = 51个以100为中心的值(即，我们应该将红色通道从[0，255]转换为[75，126])。</p><p id="5a02" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们应用这个比例，并转化为我们的颜色矩阵:</p><pre class="mj mk ml mm fd mq mr ms mt aw mu bi"><span id="f405" class="lu kk hh mr b fi mv mw l mx my"><strong class="mr hi">public</strong> <strong class="mr hi">class</strong> <strong class="mr hi">Scaled</strong> <strong class="mr hi">implements</strong> Transformation <strong class="mr hi">{</strong><br/>  <strong class="mr hi">private</strong> <strong class="mr hi">final</strong> <strong class="mr hi">int</strong> destinationColor<strong class="mr hi">;</strong></span><span id="d3b8" class="lu kk hh mr b fi mz mw l mx my">  <strong class="mr hi">public</strong> <strong class="mr hi">Scaled(int</strong> destinationColor<strong class="mr hi">)</strong> <strong class="mr hi">{</strong><br/>    <strong class="mr hi">this.</strong>destinationColor <strong class="mr hi">=</strong> destinationColor<strong class="mr hi">;</strong><br/>  <strong class="mr hi">}</strong></span><span id="5774" class="lu kk hh mr b fi mz mw l mx my">  @Override <strong class="mr hi">public</strong> Bitmap <strong class="mr hi">transform(</strong>Bitmap source<strong class="mr hi">)</strong> <strong class="mr hi">{</strong><br/>    <strong class="mr hi">float</strong> lr <strong class="mr hi">=</strong> 0.2126f<strong class="mr hi">;</strong><br/>    <strong class="mr hi">float</strong> lg <strong class="mr hi">=</strong> 0.7152f<strong class="mr hi">;</strong><br/>    <strong class="mr hi">float</strong> lb <strong class="mr hi">=</strong> 0.0722f<strong class="mr hi">;</strong></span><span id="2d00" class="lu kk hh mr b fi mz mw l mx my">    ColorMatrix grayscaleMatrix <strong class="mr hi">=</strong> <strong class="mr hi">new</strong> <strong class="mr hi">ColorMatrix(new</strong> <strong class="mr hi">float[]</strong> <strong class="mr hi">{</strong><br/>        lr<strong class="mr hi">,</strong> lg<strong class="mr hi">,</strong> lb<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>        lr<strong class="mr hi">,</strong> lg<strong class="mr hi">,</strong> lb<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>        lr<strong class="mr hi">,</strong> lg<strong class="mr hi">,</strong> lb<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>        0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 255<strong class="mr hi">,</strong> <em class="js">//</em><br/>    <strong class="mr hi">});</strong></span><span id="e39a" class="lu kk hh mr b fi mz mw l mx my">    <strong class="mr hi">int</strong> dr <strong class="mr hi">=</strong> Color<strong class="mr hi">.</strong>red<strong class="mr hi">(</strong>destinationColor<strong class="mr hi">);</strong><br/>    <strong class="mr hi">int</strong> dg <strong class="mr hi">=</strong> Color<strong class="mr hi">.</strong>green<strong class="mr hi">(</strong>destinationColor<strong class="mr hi">);</strong><br/>    <strong class="mr hi">int</strong> db <strong class="mr hi">=</strong> Color<strong class="mr hi">.</strong>blue<strong class="mr hi">(</strong>destinationColor<strong class="mr hi">);</strong><br/>    <strong class="mr hi">float</strong> drf <strong class="mr hi">=</strong> dr <strong class="mr hi">/</strong> 255f<strong class="mr hi">;</strong><br/>    <strong class="mr hi">float</strong> dgf <strong class="mr hi">=</strong> dg <strong class="mr hi">/</strong> 255f<strong class="mr hi">;</strong><br/>    <strong class="mr hi">float</strong> dbf <strong class="mr hi">=</strong> db <strong class="mr hi">/</strong> 255f<strong class="mr hi">;</strong></span><span id="c41c" class="lu kk hh mr b fi mz mw l mx my">    ColorMatrix tintMatrix <strong class="mr hi">=</strong> <strong class="mr hi">new</strong> <strong class="mr hi">ColorMatrix(new</strong> <strong class="mr hi">float[]</strong> <strong class="mr hi">{</strong><br/>        drf<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>        0<strong class="mr hi">,</strong> dgf<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>        0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> dbf<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>        0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 1<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>    <strong class="mr hi">});</strong></span><span id="d67e" class="lu kk hh mr b fi mz mw l mx my">    tintMatrix<strong class="mr hi">.</strong>preConcat<strong class="mr hi">(</strong>grayscaleMatrix<strong class="mr hi">);</strong></span><span id="97e7" class="lu kk hh mr b fi mz mw l mx my">    <em class="js">// Contrast amplitude of 20%</em><br/>    <strong class="mr hi">float</strong> scale <strong class="mr hi">=</strong> 0.2f<strong class="mr hi">;</strong><br/>    <strong class="mr hi">float</strong> translate <strong class="mr hi">=</strong> 1 <strong class="mr hi">-</strong> scale <strong class="mr hi">*</strong> 0.5f<strong class="mr hi">;</strong></span><span id="8677" class="lu kk hh mr b fi mz mw l mx my">    ColorMatrix scaleMatrix <strong class="mr hi">=</strong> <strong class="mr hi">new</strong> <strong class="mr hi">ColorMatrix(new</strong> <strong class="mr hi">float[]</strong> <strong class="mr hi">{</strong><br/>        scale<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> dr <strong class="mr hi">*</strong> translate<strong class="mr hi">,</strong> <em class="js">//</em><br/>        0<strong class="mr hi">,</strong> scale<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> dg <strong class="mr hi">*</strong> translate<strong class="mr hi">,</strong> <em class="js">//</em><br/>        0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> scale<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> db <strong class="mr hi">*</strong> translate<strong class="mr hi">,</strong> <em class="js">//</em><br/>        0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 1<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>    <strong class="mr hi">});</strong></span><span id="3ec7" class="lu kk hh mr b fi mz mw l mx my">    scaleMatrix<strong class="mr hi">.</strong>preConcat<strong class="mr hi">(</strong>tintMatrix<strong class="mr hi">);</strong></span><span id="87d2" class="lu kk hh mr b fi mz mw l mx my">    ColorMatrixColorFilter filter <strong class="mr hi">=</strong> <strong class="mr hi">new</strong> <strong class="mr hi">ColorMatrixColorFilter(</strong>scaleMatrix<strong class="mr hi">);</strong><br/>    Paint paint <strong class="mr hi">=</strong> <strong class="mr hi">new</strong> <strong class="mr hi">Paint();</strong><br/>    paint<strong class="mr hi">.</strong>setColorFilter<strong class="mr hi">(</strong>filter<strong class="mr hi">);</strong></span><span id="4a03" class="lu kk hh mr b fi mz mw l mx my">    <strong class="mr hi">int</strong> width <strong class="mr hi">=</strong> source<strong class="mr hi">.</strong>getWidth<strong class="mr hi">();</strong><br/>    <strong class="mr hi">int</strong> height <strong class="mr hi">=</strong> source<strong class="mr hi">.</strong>getHeight<strong class="mr hi">();</strong><br/>    Bitmap destination <strong class="mr hi">=</strong> createBitmap<strong class="mr hi">(</strong>width<strong class="mr hi">,</strong> height<strong class="mr hi">,</strong> ARGB_8888<strong class="mr hi">);</strong></span><span id="b6dc" class="lu kk hh mr b fi mz mw l mx my">    Canvas canvas <strong class="mr hi">=</strong> <strong class="mr hi">new</strong> <strong class="mr hi">Canvas(</strong>destination<strong class="mr hi">);</strong></span><span id="6b3e" class="lu kk hh mr b fi mz mw l mx my">    canvas<strong class="mr hi">.</strong>drawBitmap<strong class="mr hi">(</strong>source<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> paint<strong class="mr hi">);</strong><br/>    source<strong class="mr hi">.</strong>recycle<strong class="mr hi">();</strong><br/>    <strong class="mr hi">return</strong> destination<strong class="mr hi">;</strong><br/>  <strong class="mr hi">}</strong></span><span id="5ad9" class="lu kk hh mr b fi mz mw l mx my">  @Override <strong class="mr hi">public</strong> String <strong class="mr hi">key()</strong> <strong class="mr hi">{</strong><br/>    String hexColor <strong class="mr hi">=</strong> String<strong class="mr hi">.</strong>format<strong class="mr hi">(</strong>"#%08x"<strong class="mr hi">,</strong> destinationColor<strong class="mr hi">);</strong><br/>    <strong class="mr hi">return</strong> "scaled(destinationColor=" <strong class="mr hi">+</strong> hexColor <strong class="mr hi">+</strong> ")"<strong class="mr hi">;</strong><br/>  <strong class="mr hi">}</strong><br/><strong class="mr hi">}</strong></span></pre><p id="4ebb" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><a class="ae jt" href="http://jedparsons.com/" rel="noopener ugc nofollow" target="_blank"> Jed Parson </a>指出，对于暗的目标颜色，对比度感觉更柔和，他建议对比度幅度应该根据目标颜色的相对亮度而变化。</p><p id="b166" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我将比例因子改为1减去目标颜色的亮度:</p><pre class="mj mk ml mm fd mq mr ms mt aw mu bi"><span id="9ce8" class="lu kk hh mr b fi mv mw l mx my"><strong class="mr hi">public</strong> <strong class="mr hi">class</strong> <strong class="mr hi">ScaledConstrast</strong> <strong class="mr hi">implements</strong> Transformation <strong class="mr hi">{</strong><br/>  <strong class="mr hi">private</strong> <strong class="mr hi">final</strong> <strong class="mr hi">int</strong> destinationColor<strong class="mr hi">;</strong></span><span id="8a07" class="lu kk hh mr b fi mz mw l mx my">  <strong class="mr hi">public</strong> <strong class="mr hi">ScaledConstrast(int</strong> destinationColor<strong class="mr hi">)</strong> <strong class="mr hi">{</strong><br/>    <strong class="mr hi">this.</strong>destinationColor <strong class="mr hi">=</strong> destinationColor<strong class="mr hi">;</strong><br/>  <strong class="mr hi">}</strong></span><span id="8de8" class="lu kk hh mr b fi mz mw l mx my">  @Override <strong class="mr hi">public</strong> Bitmap <strong class="mr hi">transform(</strong>Bitmap source<strong class="mr hi">)</strong> <strong class="mr hi">{</strong><br/>    <strong class="mr hi">float</strong> lr <strong class="mr hi">=</strong> 0.2126f<strong class="mr hi">;</strong><br/>    <strong class="mr hi">float</strong> lg <strong class="mr hi">=</strong> 0.7152f<strong class="mr hi">;</strong><br/>    <strong class="mr hi">float</strong> lb <strong class="mr hi">=</strong> 0.0722f<strong class="mr hi">;</strong></span><span id="db8e" class="lu kk hh mr b fi mz mw l mx my">    ColorMatrix grayscaleMatrix <strong class="mr hi">=</strong> <strong class="mr hi">new</strong> <strong class="mr hi">ColorMatrix(new</strong> <strong class="mr hi">float[]</strong> <strong class="mr hi">{</strong><br/>        lr<strong class="mr hi">,</strong> lg<strong class="mr hi">,</strong> lb<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>        lr<strong class="mr hi">,</strong> lg<strong class="mr hi">,</strong> lb<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>        lr<strong class="mr hi">,</strong> lg<strong class="mr hi">,</strong> lb<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>        0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 255<strong class="mr hi">,</strong> <em class="js">//</em><br/>    <strong class="mr hi">});</strong><br/></span><span id="997d" class="lu kk hh mr b fi mz mw l mx my">    <strong class="mr hi">int</strong> dr <strong class="mr hi">=</strong> Color<strong class="mr hi">.</strong>red<strong class="mr hi">(</strong>destinationColor<strong class="mr hi">);</strong><br/>    <strong class="mr hi">int</strong> dg <strong class="mr hi">=</strong> Color<strong class="mr hi">.</strong>green<strong class="mr hi">(</strong>destinationColor<strong class="mr hi">);</strong><br/>    <strong class="mr hi">int</strong> db <strong class="mr hi">=</strong> Color<strong class="mr hi">.</strong>blue<strong class="mr hi">(</strong>destinationColor<strong class="mr hi">);</strong><br/>    <strong class="mr hi">float</strong> drf <strong class="mr hi">=</strong> dr <strong class="mr hi">/</strong> 255f<strong class="mr hi">;</strong><br/>    <strong class="mr hi">float</strong> dgf <strong class="mr hi">=</strong> dg <strong class="mr hi">/</strong> 255f<strong class="mr hi">;</strong><br/>    <strong class="mr hi">float</strong> dbf <strong class="mr hi">=</strong> db <strong class="mr hi">/</strong> 255f<strong class="mr hi">;</strong></span><span id="180f" class="lu kk hh mr b fi mz mw l mx my">    ColorMatrix tintMatrix <strong class="mr hi">=</strong> <strong class="mr hi">new</strong> <strong class="mr hi">ColorMatrix(new</strong> <strong class="mr hi">float[]</strong> <strong class="mr hi">{</strong><br/>        drf<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>        0<strong class="mr hi">,</strong> dgf<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>        0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> dbf<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>        0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 1<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>    <strong class="mr hi">});</strong></span><span id="1c41" class="lu kk hh mr b fi mz mw l mx my">    tintMatrix<strong class="mr hi">.</strong>preConcat<strong class="mr hi">(</strong>grayscaleMatrix<strong class="mr hi">);</strong></span><span id="f647" class="lu kk hh mr b fi mz mw l mx my">    <strong class="mr hi">float</strong> lDestination <strong class="mr hi">=</strong> drf <strong class="mr hi">*</strong> lr <strong class="mr hi">+</strong> dgf <strong class="mr hi">*</strong> lg <strong class="mr hi">+</strong> dbf <strong class="mr hi">*</strong> lb<strong class="mr hi">;</strong><br/>    <strong class="mr hi">float</strong> scale <strong class="mr hi">=</strong> 1f <strong class="mr hi">-</strong> lDestination<strong class="mr hi">;</strong><br/>    <strong class="mr hi">float</strong> translate <strong class="mr hi">=</strong> 1 <strong class="mr hi">-</strong> scale <strong class="mr hi">*</strong> 0.5f<strong class="mr hi">;</strong></span><span id="7a95" class="lu kk hh mr b fi mz mw l mx my">    ColorMatrix scaleMatrix <strong class="mr hi">=</strong> <strong class="mr hi">new</strong> <strong class="mr hi">ColorMatrix(new</strong> <strong class="mr hi">float[]</strong> <strong class="mr hi">{</strong><br/>        scale<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> dr <strong class="mr hi">*</strong> translate<strong class="mr hi">,</strong> <em class="js">//</em><br/>        0<strong class="mr hi">,</strong> scale<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> dg <strong class="mr hi">*</strong> translate<strong class="mr hi">,</strong> <em class="js">//</em><br/>        0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> scale<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> db <strong class="mr hi">*</strong> translate<strong class="mr hi">,</strong> <em class="js">//</em><br/>        0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 1<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> <em class="js">//</em><br/>    <strong class="mr hi">});</strong></span><span id="7f0f" class="lu kk hh mr b fi mz mw l mx my">    scaleMatrix<strong class="mr hi">.</strong>preConcat<strong class="mr hi">(</strong>tintMatrix<strong class="mr hi">);</strong></span><span id="b0fd" class="lu kk hh mr b fi mz mw l mx my">    ColorMatrixColorFilter filter <strong class="mr hi">=</strong> <strong class="mr hi">new</strong> <strong class="mr hi">ColorMatrixColorFilter(</strong>scaleMatrix<strong class="mr hi">);</strong><br/>    Paint paint <strong class="mr hi">=</strong> <strong class="mr hi">new</strong> <strong class="mr hi">Paint();</strong><br/>    paint<strong class="mr hi">.</strong>setColorFilter<strong class="mr hi">(</strong>filter<strong class="mr hi">);</strong></span><span id="eb1b" class="lu kk hh mr b fi mz mw l mx my">    <strong class="mr hi">int</strong> width <strong class="mr hi">=</strong> source<strong class="mr hi">.</strong>getWidth<strong class="mr hi">();</strong><br/>    <strong class="mr hi">int</strong> height <strong class="mr hi">=</strong> source<strong class="mr hi">.</strong>getHeight<strong class="mr hi">();</strong><br/>    Bitmap destination <strong class="mr hi">=</strong> createBitmap<strong class="mr hi">(</strong>width<strong class="mr hi">,</strong> height<strong class="mr hi">,</strong> ARGB_8888<strong class="mr hi">);</strong></span><span id="6788" class="lu kk hh mr b fi mz mw l mx my">    Canvas canvas <strong class="mr hi">=</strong> <strong class="mr hi">new</strong> <strong class="mr hi">Canvas(</strong>destination<strong class="mr hi">);</strong></span><span id="4b7d" class="lu kk hh mr b fi mz mw l mx my">    canvas<strong class="mr hi">.</strong>drawBitmap<strong class="mr hi">(</strong>source<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> 0<strong class="mr hi">,</strong> paint<strong class="mr hi">);</strong><br/>    source<strong class="mr hi">.</strong>recycle<strong class="mr hi">();</strong><br/>    <strong class="mr hi">return</strong> destination<strong class="mr hi">;</strong><br/>  <strong class="mr hi">}</strong></span><span id="d224" class="lu kk hh mr b fi mz mw l mx my">  @Override <strong class="mr hi">public</strong> String <strong class="mr hi">key()</strong> <strong class="mr hi">{</strong><br/>    String hexColor <strong class="mr hi">=</strong> String<strong class="mr hi">.</strong>format<strong class="mr hi">(</strong>"#%08x"<strong class="mr hi">,</strong> destinationColor<strong class="mr hi">);</strong><br/>    <strong class="mr hi">return</strong> "scaled-contrast(destinationColor=" <strong class="mr hi">+</strong> hexColor <strong class="mr hi">+</strong> ")"<strong class="mr hi">;</strong><br/>  <strong class="mr hi">}</strong><br/><strong class="mr hi">}</strong></span></pre><figure class="mj mk ml mm fd mn er es paragraph-image"><div class="er es mi"><img src="../Images/c6a11e2194aa3cfdfb77c8aa1f67b6b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/0*5aXwp64x0hInvmBE.png"/></div></figure><h1 id="9e5f" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">文本</h1><p id="30d7" class="pw-post-body-paragraph iw ix hh iy b iz lb ii jb jc lc il je jf ld jh ji jj le jl jm jn lf jp jq jr ha bi translated">我们现在需要做的就是在我们的图像上添加一个带有正确文本颜色的TextView。幸运的是，支持库提供了ColorUtils来做到这一点。</p><p id="a1ef" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这是一个受Palette启发的简单实现。swatch . ensuretextcolorsgenerated():</p><pre class="mj mk ml mm fd mq mr ms mt aw mu bi"><span id="9356" class="lu kk hh mr b fi mv mw l mx my"><strong class="mr hi">private</strong> <strong class="mr hi">int</strong> <strong class="mr hi">computeTitleColor(int</strong> destinationColor<strong class="mr hi">)</strong> <strong class="mr hi">{</strong><br/>  <strong class="mr hi">int</strong> titleAlpha <strong class="mr hi">=</strong> ColorUtils<strong class="mr hi">.</strong>calculateMinimumAlpha<strong class="mr hi">(</strong>Color<strong class="mr hi">.</strong>WHITE<strong class="mr hi">,</strong> destinationColor<strong class="mr hi">,</strong> 3.0f<strong class="mr hi">);</strong><br/>  <strong class="mr hi">int</strong> titleColor<strong class="mr hi">;</strong><br/>  <strong class="mr hi">if</strong> <strong class="mr hi">(</strong>titleAlpha <strong class="mr hi">!=</strong> <strong class="mr hi">-</strong>1<strong class="mr hi">)</strong> <strong class="mr hi">{</strong><br/>    titleColor <strong class="mr hi">=</strong> ColorUtils<strong class="mr hi">.</strong>setAlphaComponent<strong class="mr hi">(</strong>Color<strong class="mr hi">.</strong>WHITE<strong class="mr hi">,</strong> titleAlpha<strong class="mr hi">);</strong><br/>  <strong class="mr hi">}</strong> <strong class="mr hi">else</strong> <strong class="mr hi">{</strong><br/>    titleAlpha <strong class="mr hi">=</strong> ColorUtils<strong class="mr hi">.</strong>calculateMinimumAlpha<strong class="mr hi">(</strong>Color<strong class="mr hi">.</strong>BLACK<strong class="mr hi">,</strong> destinationColor<strong class="mr hi">,</strong> 3.0f<strong class="mr hi">);</strong><br/>    titleColor <strong class="mr hi">=</strong> ColorUtils<strong class="mr hi">.</strong>setAlphaComponent<strong class="mr hi">(</strong>Color<strong class="mr hi">.</strong>BLACK<strong class="mr hi">,</strong> titleAlpha<strong class="mr hi">);</strong><br/>  <strong class="mr hi">}</strong><br/>  <strong class="mr hi">return</strong> titleColor<strong class="mr hi">;</strong><br/><strong class="mr hi">}</strong></span></pre><figure class="mj mk ml mm fd mn er es paragraph-image"><div class="er es mi"><img src="../Images/72360e4a3f9d1354ada67b95132f2d62.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/0*NHpRb1gFJ6sg-uSn.png"/></div></figure><h1 id="a32b" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">结论</h1><figure class="mj mk ml mm fd mn er es paragraph-image"><div class="er es na"><img src="../Images/1bc8b1508140e3736ee5df8da47f914c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*5lpsJPk3DTVR2ZRf.jpg"/></div></figure><p id="4c3b" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">通过将Picasso与颜色矩阵相结合，我们能够快速迭代我们的图像转换，以获得符合我们需求的输出。</p><p id="4606" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">欢迎在评论中提供反馈和更多见解！</p></div><div class="ab cl nb nc go nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="ha hb hc hd he"><div class="mj mk ml mm fd ni"><a href="https://twitter.com/Piwai" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab dw"><div class="nk ab nl cl cj nm"><h2 class="bd hi fi z dy nn ea eb no ed ef hg bi translated">皮埃尔-伊夫·里考(@皮瓦伊)|推特</h2><div class="np l"><h3 class="bd b fi z dy nn ea eb no ed ef dx translated">Pierre-Yves Ricau (@Piwai)的最新推文。安卓贝克@广场。巴黎/旧金山</h3></div><div class="nq l"><p class="bd b fp z dy nn ea eb no ed ef dx translated">twitter.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw mo ni"/></div></div></a></div></div></div>    
</body>
</html>