<html>
<head>
<title>Utilizing Machine Learning in the Palm of Your Hand With iOS’s ML Frameworks</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在iOS的ML框架中利用机器学习</h1>
<blockquote>原文：<a href="https://medium.com/capital-one-tech/utilizing-machine-learning-in-the-palm-of-your-hand-with-ioss-ml-frameworks-60d97f96e8fd?source=collection_archive---------1-----------------------#2017-12-04">https://medium.com/capital-one-tech/utilizing-machine-learning-in-the-palm-of-your-hand-with-ioss-ml-frameworks-60d97f96e8fd?source=collection_archive---------1-----------------------#2017-12-04</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/e38f1f1a8aa7b2ab3fc4444ba911e24b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wo6HYwrJYzYBpjDP0-YPGA.jpeg"/></div></div></figure><div class=""/><p id="c7a1" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">第一资本公司首席软件工程师凯文·费雷尔</p><p id="53ec" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">今年早些时候，苹果在iOS 11中推出了新的机器学习(ML)框架——Core ML和Vision——使开发人员能够轻松直观地将ML模型融入他们的应用程序，提高用户的速度、能力和整体体验。作为Capital One内部移动应用团队的开发人员，我想尝试一个用例来实现这些新框架，这将与我对改善员工工作场所体验的关注相结合。</p><h2 id="8423" class="jp jq hs bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">使用案例</h2><p id="9a6f" class="pw-post-body-paragraph iq ir hs is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn ha bi translated">像许多拥有开放工作空间的大公司一样，Capital One的员工预留了大量会议室；临时会议往往会导致最后一分钟的争夺，以确保一个空间。如今，这要求员工要么使用桌面应用程序来找到可用的房间，要么“蹲”在看起来空无一人的房间里，希望其他团队没有预订它。</p><p id="1d2d" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">为了解决这个问题，我们的团队正在开发一个新的移动应用程序，以使预订会议室的过程更加简单和简化。计划中的功能之一是通过照片预订房间，这将使员工能够拍摄会议室标志的照片，以确定它是否立即可用，然后直接通过他们的手机预订房间(再也不会被赶出会议室了！).</p><p id="9a10" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">为了启用这个新特性，我们需要创建两个使用传统编程方法难以实现的函数:</p><ol class=""><li id="705c" class="kp kq hs is b it iu ix iy jb kr jf ks jj kt jn ku kv kw kx bi translated">识别用户拍摄的会议室标牌图片中的文字区域；和</li><li id="dcc5" class="kp kq hs is b it ky ix kz jb la jf lb jj lc jn ku kv kw kx bi translated">将这些文本区域转换为文本字符串，以便它们可以用于预定会议室。</li></ol><p id="e01d" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">这就是苹果新的ML框架的用武之地。</p><h2 id="3ec1" class="jp jq hs bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">行动中的ML框架</h2><p id="3c65" class="pw-post-body-paragraph iq ir hs is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn ha bi translated">核心的ML和Vision软件框架使得合并ML iOS应用程序变得很容易。</p><p id="0ac9" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">Core ML使开发人员能够通过原生对象接口直接在应用程序中使用预训练的ML模型，而Vision则基于Core ML执行ML驱动的操作，这些操作集成了设备的摄像头，如人脸检测、对象跟踪和文本识别。</p><p id="15e4" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">Vision支持以下现成的操作:</p><ul class=""><li id="40a9" class="kp kq hs is b it iu ix iy jb kr jf ks jj kt jn ld kv kw kx bi translated">脸和面部特征(嘴、鼻子、眼睛等)。)检测</li><li id="567d" class="kp kq hs is b it ky ix kz jb la jf lb jj lc jn ld kv kw kx bi translated">条形码检测和处理</li><li id="61ad" class="kp kq hs is b it ky ix kz jb la jf lb jj lc jn ld kv kw kx bi translated">图像对齐</li><li id="8e24" class="kp kq hs is b it ky ix kz jb la jf lb jj lc jn ld kv kw kx bi translated">地平线检测</li><li id="ab9e" class="kp kq hs is b it ky ix kz jb la jf lb jj lc jn ld kv kw kx bi translated">目标跟踪</li><li id="3fca" class="kp kq hs is b it ky ix kz jb la jf lb jj lc jn ld kv kw kx bi translated"><strong class="is ht">文字检测</strong></li><li id="de9a" class="kp kq hs is b it ky ix kz jb la jf lb jj lc jn ld kv kw kx bi translated">定制核心ML型号</li></ul><p id="e0cc" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">我在这里加粗了“文本检测”,因为我们将在代码示例中使用它。这里的另一个要点是，Vision将检测图像中的文本，但不会提供将该文本转换为可以处理的文本字符串的功能。要将图像转换成字符串，我们需要使用另一个ML模型来识别文本字符。</p><p id="5d58" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">下面的图表更广泛地概述了我们通过照片预订房间功能的工作流程:</p><figure class="lf lg lh li fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es le"><img src="../Images/b2dec62428d90ceb5ea7997fff5809f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J7tT4kSjHheFknP6V3EuuQ.png"/></div></div></figure><ol class=""><li id="a991" class="kp kq hs is b it iu ix iy jb kr jf ks jj kt jn ku kv kw kx bi translated">用户在会议室外面拍摄标牌的照片。</li><li id="bd97" class="kp kq hs is b it ky ix kz jb la jf lb jj lc jn ku kv kw kx bi translated">照片通过<em class="jo">VNImageDetectTextRectanglesRequest</em>请求运行，以识别照片中的文本区域。</li><li id="664b" class="kp kq hs is b it ky ix kz jb la jf lb jj lc jn ku kv kw kx bi translated">文本区域被提取成单独的图像用于转换。</li><li id="83ad" class="kp kq hs is b it ky ix kz jb la jf lb jj lc jn ku kv kw kx bi translated">这些单独的文本图像使用<em class="jo"> SwiftOCR </em>库转换成<em class="jo">字符串</em>对象。</li><li id="ccca" class="kp kq hs is b it ky ix kz jb la jf lb jj lc jn ku kv kw kx bi translated">转换后的字符串被处理以识别被预订的房间号。</li><li id="f500" class="kp kq hs is b it ky ix kz jb la jf lb jj lc jn ku kv kw kx bi translated">房间已在我们的资源系统中预订，随时可以使用！</li></ol><h2 id="850e" class="jp jq hs bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">逐步代码</h2><p id="6491" class="pw-post-body-paragraph iq ir hs is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn ha bi translated"><strong class="is ht"> 1。用户拍摄照片<br/> </strong>第一步很简单，使用一个简单的<em class="jo"> UIImagePickerController </em>让用户拍摄房间标志的照片。该照片然后被传递到利用视觉框架的<em class="jo">roomtophotoviewcontroller，</em>。</p><figure class="lf lg lh li fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lj"><img src="../Images/9dd4cf1fc2abd0297afcb32155b919af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YgVRi-PC1V5ilKeRgG1g7w.png"/></div></div></figure><p id="c111" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated"><strong class="is ht"> 2。检测图像中的文本区域<br/> </strong>接下来，我们将使用视觉来识别照片中的文本区域。我们首先创建一个<em class="jo"> VNImageRequestHandler </em>并传入照片；请求处理器用于处理视觉请求，并在用例需要时对视频流而不是静态图像进行操作。</p><p id="216a" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">然后我们创建一个<em class="jo">VNDetectTextRectanglesRequest，</em>它接受一个完成处理程序来处理结果。完成处理程序包含一个输入，该输入包含<em class="jo"> VNTextObservation </em>结果集，从而识别图像中的所有文本区域。</p><figure class="lf lg lh li fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lk"><img src="../Images/e3b73f62a756a10ea92f5b3ee77fd64f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M0g3bYOMlCs6ANGcnHer5w.png"/></div></div></figure><p id="29b5" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated"><strong class="is ht"> 3。勾勒并提取文本图像<br/> </strong>现在我们已经有了一个<em class="jo"> VNTextObservation </em>结果的数组，我们可以处理它们以准备转换为文本(<em class="jo"> VNTextObservation </em>结果实质上是一个矩形数组，它标识了Vision认为包含文本的照片部分)。</p><p id="4827" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">我们的第一个处理步骤是在照片上用一个绿框勾勒出这些图像区域，这样可以更容易地确定正确的文本区域。</p><p id="08c5" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">接下来，我们将提取包含每个<em class="jo"> VNTextObservation </em>项目的文本的图像。</p><figure class="lf lg lh li fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ll"><img src="../Images/75fc9f328fceacab8f288af7ebbb3561.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_VE9xEqqb2zrRpYTBdqUtA.png"/></div></div></figure><p id="d5b2" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">请注意，这里我们提取的是照片中每个相邻的文本区域(即整行文本)。<em class="jo"> VNTextObservation </em>数组也包含单独的字符框，但这对于这个用例来说并不需要。</p><p id="6679" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated"><strong class="is ht"> 4。将图像转换成字符串现在我们有了一个图像数组，我们将遍历每个图像并将其转换成一个字符串。这里我们使用<em class="jo">swift OCR</em>——一个开源库，它使用神经网络ML模型来对图像进行字符识别——来执行字符串转换(注意，也可以使用其他库，包括Google开发的Tesseract OCR模型)。</strong></p><figure class="lf lg lh li fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lm"><img src="../Images/d0132eb78d3eae3e4eb863ac50434e1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OIW_pdyIC9OzfO8iCRN5sQ.png"/></div></div></figure><p id="0323" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated"><strong class="is ht"> 5。识别房间号并预订房间<br/> </strong>此时，我们有了一个从用户照片中提取的文本字符串列表。现在我们将使用这些信息来识别房间号并预订房间。下面的代码使用了一种简单的方法，根据每个字符串中数字与字母字符的百分比来识别房间号。本质上，该函数根据哪个文本区域包含的数字最多来选择房间号。</p><p id="8f8a" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">虽然这是一种过于简单的识别房间号的方法，但我们在这里使用它是为了清楚地展示这个过程的ML方面。</p><figure class="lf lg lh li fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ln"><img src="../Images/1122e89f100e6f1224732bee7c33ac08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CPkeTXIFhV2IXr1fHBPprQ.png"/></div></div></figure><h2 id="79cd" class="jp jq hs bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">把这一切联系在一起</h2><p id="c15b" class="pw-post-body-paragraph iq ir hs is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn ha bi translated">下面的演示展示了从端到端的整个过程。正如你所看到的，Vision正确地识别了绿色方框中的文本区域，这给人留下了深刻的印象，因为照片是从奇怪的角度拍摄的。接下来，SwiftOCR框架正确地将图像转换为字符串，我们从文本区域组中选择房间号。</p><figure class="lf lg lh li fd hj er es paragraph-image"><div class="er es lo"><img src="../Images/f0e0157d0b89c2d8add5133113094882.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/1*xiM6soiL9YbWukOJ7zoyOA.gif"/></div></figure><h2 id="a5fb" class="jp jq hs bd jr js jt ju jv jw jx jy jz jb ka kb kc jf kd ke kf jj kg kh ki kj bi translated">关键要点</h2><p id="d9b3" class="pw-post-body-paragraph iq ir hs is b it kk iv iw ix kl iz ja jb km jd je jf kn jh ji jj ko jl jm jn ha bi translated">开发我们新的应用程序功能原型让我对核心ML、视觉以及更广泛地将机器学习融入应用程序有了一些了解:</p><ul class=""><li id="df1f" class="kp kq hs is b it iu ix iy jb kr jf ks jj kt jn ld kv kw kx bi translated"><em class="jo">不要指望把一个ML模型放到你的应用程序中，就能看到它活过来</em>。将核心ML结果视为应用决策分析中的单个数据点。</li><li id="bef8" class="kp kq hs is b it ky ix kz jb la jf lb jj lc jn ld kv kw kx bi translated"><em class="jo">训练ML模特很难</em>。我可以为这个原型使用现有的ML模型，但是训练新的模型是复杂的。核心ML使合并ML模型的过程变得简单，但是对训练新模型没有帮助。</li><li id="c783" class="kp kq hs is b it ky ix kz jb la jf lb jj lc jn ld kv kw kx bi translated"><em class="jo">机器学习经常会得到错误的答案</em>。确保用户有办法覆盖ML输入并收集结果，以便可以将反馈重新合并到模型中。</li><li id="19f1" class="kp kq hs is b it ky ix kz jb la jf lb jj lc jn ld kv kw kx bi translated"><em class="jo">确保你的测试集覆盖了合适的测试用例</em>。您可以使用自动化测试来评估对ML模型的更改，并在继续优化模型训练集时减少回归。</li></ul><p id="431c" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">重要的是要认识到，虽然苹果已经推出了强大的新ML工具，但替代工具确实存在，可以帮助填补空白。</p><p id="8556" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">通用数据源和示例应用程序的所有代码都可以在GitHub 上的MIT license <a class="ae lp" href="https://github.com/kferrell/RoomFinderPro" rel="noopener ugc nofollow" target="_blank">下获得，并且可以自由地重用和修改。</a></p><p id="8884" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">我们期待着这些新的应用程序功能在Capital One上启动和运行，并欢迎您的想法、反馈和贡献！</p></div><div class="ab cl lq lr go ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ha hb hc hd he"><p id="cf65" class="pw-post-body-paragraph iq ir hs is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated"><em class="jo">以上观点为作者个人观点。除非本帖中另有说明，否则Capital One不属于所提及的任何公司，也不被其认可。使用或展示的所有商标和其他知识产权都是其各自所有者的所有权。本文为2017首都一。</em></p></div></div>    
</body>
</html>