<html>
<head>
<title>React Native at WalmartLabs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">沃尔玛实验室的本土反应</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/react-native-at-walmartlabs-cdd140589560?source=collection_archive---------0-----------------------#2016-12-19">https://medium.com/walmartglobaltech/react-native-at-walmartlabs-cdd140589560?source=collection_archive---------0-----------------------#2016-12-19</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/06583292782cd4cf58c42e039be6dfff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FgddJm_KiUTCA5mh_fM7_Q.jpeg"/></div></div></figure><p id="44db" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在<a class="ae jn" href="http://careers.walmart.com/" rel="noopener ugc nofollow" target="_blank">沃尔玛</a>，顾客永远是第一位的，所以我们一直在寻找改善顾客购物体验的方法。目前，沃尔玛应用程序有许多嵌入式web视图，我们发现这些实现低于我们和我们的客户对应用程序的要求。混合web视图实现的性能不是很好，即使在高端设备上也是如此，并且没有任何本地的感觉。不仅如此，由于web视图严重依赖于网络请求(我们在web实现中使用服务器端呈现)，连接速度较慢的用户会有不愉快的体验。因此，我们想知道:“有没有一种方法可以改进或替换当前的实现，为我们的客户提供更好、更流畅的体验？”于是，我们开始寻找答案。</p><h1 id="a7a2" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">潜在的解决方案</h1><p id="8c92" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">经过一番头脑风暴，我们提出了以下解决方案:</p><ol class=""><li id="f3d1" class="kr ks hh ir b is it iw ix ja kt je ku ji kv jm kw kx ky kz bi translated">纯本机实现(不再有web视图)</li><li id="5170" class="kr ks hh ir b is la iw lb ja lc je ld ji le jm kw kx ky kz bi translated">反应自然</li></ol><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/189724b0109e278850ef36d7e643b507.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iUQwmDC3ym3JJe_iSLZQ7A.png"/></div></div></figure><p id="7cc9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">本机实现在理论上很棒，但实际上，我们需要考虑生产率/代码共享/上市时间，这就是像React Native这样的跨平台框架的用武之地。React Native之外还有其他跨平台移动开发框架，如PhoneGap、Xamarin和Meteor，但鉴于我们当前的web代码库使用React和Redux，在任何其他跨平台框架之前考虑React Native是最有意义的——更不用说，它是一个相当稳定的框架，可能会流行一段时间。</p><p id="e93d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">以下是我们观察到的React Native的优势:</p><p id="fe68" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">生产力</strong></p><ul class=""><li id="2b84" class="kr ks hh ir b is it iw ix ja kt je ku ji kv jm lj kx ky kz bi translated">95%的代码库在iOS和Android之间共享</li><li id="a951" class="kr ks hh ir b is la iw lb ja lc je ld ji le jm lj kx ky kz bi translated">不需要知识共享，因为每个功能都是由单个团队实现的</li><li id="7ceb" class="kr ks hh ir b is la iw lb ja lc je ld ji le jm lj kx ky kz bi translated"><em class="lk">开发者体验超赞</em>。无需重启打包程序即可查看简单的更改</li><li id="c268" class="kr ks hh ir b is la iw lb ja lc je ld ji le jm lj kx ky kz bi translated">React Native是用JavaScript写的。我们可以利用整个组织的编程技能/资源</li></ul><p id="6268" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">代码共享</strong></p><ul class=""><li id="b29e" class="kr ks hh ir b is it iw ix ja kt je ku ji kv jm lj kx ky kz bi translated">前端/演示代码可以在iOS和Android之间共享</li><li id="6f2f" class="kr ks hh ir b is la iw lb ja lc je ld ji le jm lj kx ky kz bi translated">业务逻辑(redux store)也可以与Web应用程序共享</li><li id="2104" class="kr ks hh ir b is la iw lb ja lc je ld ji le jm lj kx ky kz bi translated">平台间大量代码的可重用性</li></ul><p id="ab02" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">应用商店批准</strong></p><ul class=""><li id="77ab" class="kr ks hh ir b is it iw ix ja kt je ku ji kv jm lj kx ky kz bi translated">无需经过app store审批流程。我们可以在自己的服务器上托管这个包，并进行空中更新</li></ul><p id="527d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">上市时间</strong></p><ul class=""><li id="6fed" class="kr ks hh ir b is it iw ix ja kt je ku ji kv jm lj kx ky kz bi translated">非常快</li><li id="8504" class="kr ks hh ir b is la iw lb ja lc je ld ji le jm lj kx ky kz bi translated">我们可以控制发布日期</li><li id="d32c" class="kr ks hh ir b is la iw lb ja lc je ld ji le jm lj kx ky kz bi translated">两个平台可以在同一天同一个时间发布</li></ul><p id="a40c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">性能</strong></p><ul class=""><li id="4798" class="kr ks hh ir b is it iw ix ja kt je ku ji kv jm lj kx ky kz bi translated">React Native提供了与Native几乎相同的性能</li></ul><p id="5ec9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">动画</strong></p><ul class=""><li id="387a" class="kr ks hh ir b is it iw ix ja kt je ku ji kv jm lj kx ky kz bi translated">React Native提供了非常流畅的动画，因为代码在渲染之前被转换为本机视图</li></ul><p id="cb97" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> UX </strong></p><ul class=""><li id="ef88" class="kr ks hh ir b is it iw ix ja kt je ku ji kv jm lj kx ky kz bi translated">我们可以进行特定于平台的用户界面设计</li></ul><p id="d453" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">自动化</strong></p><ul class=""><li id="1220" class="kr ks hh ir b is it iw ix ja kt je ku ji kv jm lj kx ky kz bi translated">相同的自动化套件可以在iOS和Android上运行</li></ul><h1 id="bad2" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">表演</strong></h1><p id="7b04" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">当我们在<a class="ae jn" href="http://www.walmartlabs.com/team/" rel="noopener ugc nofollow" target="_blank">沃尔玛实验室</a>进行性能测试时，我们心中有几个目标。我们想知道React Native在RAM使用、FPS、CPU利用率等指标上与其竞争对手相比如何。但我们也想调查React Native的扩展能力，因为React Native有可能成为整个企业的标准移动技术。由于该项目是WalmartLabs的一项实验，我们的短期目标是证明该技术的性能与当前解决方案相当或更好。我们长期追求的是将性能测试与我们的CI整合在一起，就像<a class="ae jn" href="https://code.facebook.com/posts/924676474230092/mobile-performance-tooling-infrastructure-at-facebook/" rel="noopener ugc nofollow" target="_blank">脸书</a>所做的那样，这样我们就可以测试我们的每个变化对整体应用性能的影响。</p><p id="5600" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> <em class="lk">特里布尔斯的麻烦</em> </strong></p><p id="3723" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">就目前而言，性能测试React Native是一种痛苦。马上，由于两个不同的平台，有两套收集数据的工具。苹果公司提供了测试仪器，为我们提供了我们所追求的大部分测量结果。Android需要使用多种实用程序来收集我们想要的所有数据。此外，对于许多测量来说，没有简单的方法来获得数据流，所以一些测量必须被估计。</p><p id="fc60" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">脸书试图通过提供内置于React原生开发者菜单中的性能监视器来弥合Android和iOS性能测试之间的差距。不幸的是，这个解决方案远非完美。在iOS上，它提供RAM使用、FPS数据以及一系列与React原生相关的测量，但是对于Android，perf monitor仅提供FPS数据。将来，如果可能的话，我希望看到所提供的度量在两个平台上实现标准化。</p><p id="7ddd" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">闭嘴，告诉我土人是怎么反应的！</strong></p><p id="f87f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">好吧，但是请注意，我们报告的性能是基于我们的应用程序，并不代表您的应用程序。然而，我将试图提供从我们的测试中可以得出的一般性结论。</p><p id="3105" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们收集的数据很有希望。事实证明，React Native确实是大大小小的移动应用程序的可行解决方案。在图形性能、RAM使用和CPU方面，我们采取的每一项措施都相当于或优于我们当前的混合解决方案，这适用于两个平台。该应用程序的整体感觉得到了显著改善，并提供了远优于hybrid的用户体验。</p><p id="ef4d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">原生反应很快，真的很快。虽然我们没有测试纯本机版本，但可以肯定地说，就外观和感觉而言，用纯本机编写这个应用程序不会比React Native提供任何显著的优势。总的来说，我们对React Native到目前为止的表现非常满意，我们希望我们收集的结果能够得到业务部门以及最终我们的用户的认可。</p><h1 id="b0b1" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">测试</h1><p id="cc8a" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">为了确保React本机代码的质量，我们的目标是单元测试和集成测试的100%测试覆盖率。</p><h2 id="6421" class="ll jp hh bd jq lm ln lo ju lp lq lr jy ja ls lt kc je lu lv kg ji lw lx kk ly bi translated">集成测试</h2><p id="754c" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">沃尔玛的iOS和Android应用程序是由数百名工程师合作开发的。我们使用我们的集成测试来确保我们的React本机代码在代码库继续发展时仍然有效。</p><p id="da32" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在沃尔玛，我们需要支持各种设备和操作系统。<a class="ae jn" href="https://saucelabs.com/" rel="noopener ugc nofollow" target="_blank"> Sauce Labs </a>允许我们在iOS和Android硬件和操作系统版本的几种组合上运行我们的集成测试。在多个设备上运行集成测试需要很长时间，所以我们每天晚上只做一次。</p><p id="cd6b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们还使用我们的集成测试来防止回归。我们已经将我们的<a class="ae jn" href="https://www.jetbrains.com/teamcity/" rel="noopener ugc nofollow" target="_blank">团队城市CI </a>与GitHub Enterprise连接起来，对每个拉请求进行测试。与夜间作业不同，对于拉取请求，我们只在一台设备上运行测试。但是即使这样也可能会比实际可行的时间更长，所以我们使用一些工具来减少这个时间。<a class="ae jn" href="https://github.com/TestArmada/magellan" rel="noopener ugc nofollow" target="_blank">麦哲伦</a>，这是我们的开源项目之一，允许我们并行运行测试，以显著减少测试时间。</p><p id="e87b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">测试本身用JavaScript编写，由Mocha运行，并使用<a class="ae jn" href="http://appium.io/" rel="noopener ugc nofollow" target="_blank"> Appium </a>命令来控制移动模拟器。React Native允许我们在每个组件上设置一个“testID”属性。这些“testID”充当CSS类名。我们使用XPaths精确而方便地指定一个组件，并为了测试的目的与它进行交互。</p><h2 id="7411" class="ll jp hh bd jq lm ln lo ju lp lq lr jy ja ls lt kc je lu lv kg ji lw lx kk ly bi translated">单元测试</h2><p id="a24e" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">我们使用单元测试来孤立地测试我们的React本地组件，并防止无意的更改。</p><p id="89e2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们使用常见的React单元测试工具，如Mocha、Chai、Sinon和Enzyme。但是React Native有一些独特的挑战，因为它的组件有环境依赖性，这使得它不能在节点上运行。<a class="ae jn" href="https://github.com/lelandrichardson/react-native-mock" rel="noopener ugc nofollow" target="_blank"> react-native-mock </a>为我们解决了这个问题，因为它提供了在iOS或Android之外运行时不会崩溃的模拟react原生组件。当我们发现自己需要模仿额外的依赖时，我们使用<a class="ae jn" href="https://github.com/jhnns/rewire" rel="noopener ugc nofollow" target="_blank"> rewire </a>节点模块。</p><h2 id="a3a2" class="ll jp hh bd jq lm ln lo ju lp lq lr jy ja ls lt kc je lu lv kg ji lw lx kk ly bi translated">复用性</h2><p id="2120" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">我们利用相同的自动化测试套件在iOS和Android上运行。</p><h1 id="2f57" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">部署</h1><p id="00dc" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">React Native的主要优势之一是能够绕过应用商店，通过无线方式推送快速错误修复，这意味着React Native JavaScript捆绑包将托管在服务器上，并由客户端直接检索，类似于web的工作方式。</p><p id="a2ac" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然而，React Native面临的一个挑战是，要使JS包工作，必须在本机端有一个兼容的React Native副本。如果你将原生端升级到最新的React Native，用户更新了他们的应用程序，但他们下载了一个旧的捆绑包，应用程序将会崩溃。如果你更新捆绑包以匹配最新的本机端，并将其提供给仍未更新其应用程序的用户，它也会中断。</p><p id="4cd8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">像微软<a class="ae jn" href="https://github.com/Microsoft/react-native-code-push" rel="noopener ugc nofollow" target="_blank"> CodePush </a>这样的工具可以用来将捆绑包映射到正确的应用版本。但是同时支持多个版本的应用程序是决定使用React Native时应该考虑的开销。</p><h1 id="2210" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">挑战</h1><h2 id="4155" class="ll jp hh bd jq lm ln lo ju lp lq lr jy ja ls lt kc je lu lv kg ji lw lx kk ly bi translated">iOS和Android的区别</h2><p id="1e26" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">在iOS和Android上React Native的功能之间有足够多的不一致，使得支持这两个平台变得很棘手。几个React本机行为和样式实现在平台之间有所不同。例如，样式属性“溢出”在iOS上受支持，但在Android上不受支持。组件属性也可以是特定于平台的。在React原生文档中，您可以看到许多标记为“仅限Android”或“仅限iOS”的属性和功能。测试自动化代码也需要针对每个平台进行调整。</p><p id="e5d0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们发现iOS比Android拥有更多的功能，所以对于一个同时面向两个平台的产品来说，采用Android优先的方法进行开发可能是有意义的。</p><h2 id="4e4a" class="ll jp hh bd jq lm ln lo ju lp lq lr jy ja ls lt kc je lu lv kg ji lw lx kk ly bi translated">开发和调试</h2><p id="a83b" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">我们经验中的一个难点是，React Native代码在调试模式和常规模式下的行为有何不同，因为React Native为这两种模式中的每一种模式使用了<a class="ae jn" href="https://facebook.github.io/react-native/docs/javascript-environment.html#javascript-runtime" rel="noopener ugc nofollow" target="_blank">不同的JavaScript引擎。当一个bug是常规模式特有的时候，它自然会很难调试，因为它在调试模式下是不可再现的。</a></p><h1 id="4f26" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">结论</h1><p id="431d" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">React Native有一些很好的优势。React Native的定义性特征，也可以说是它的最佳卖点，是它的跨平台性——允许同一团队在iOS和Android上同时开发，这可以将劳动力成本削减大约一半。说到团队，JavaScript开发人员非常多，而且所需的特定于移动设备的技能非常少，这意味着有适当技能的劳动力很容易获得。初始开发以及增量功能的开发非常快，因此您可以比竞争对手更快地满足客户的需求。作为锦上添花，一般来说，用React Native编写的应用程序具有与那些作为本机应用程序编写的应用程序相当甚至可能更好的性能。</p><p id="bb97" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">虽然React Native确实有一些很棒的卖点，但在开始使用React Native进行项目之前，您也需要记住一些事情。首先，尽管React Native很好地弥合了iOS和Android之间的差距，但你不会在两个操作系统之间实现完全平等。有些事情一个平台可以做，而另一个平台不能处理，这些事情大多与样式视图有关，但也有更重要的考虑因素，如性能测试。虽然开源社区在开发和发布新功能和性能调整方面非常出色，但实际上升级React原生版本往往是一件非常痛苦的事情，尤其是如果你有一个像沃尔玛一样围绕React原生构建的平台。</p><p id="6000" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们坚信React Native是一个非常棒的框架。它做了我们想要它做的一切，而且做得如此令人钦佩。虽然它确实有一些问题，但这些问题都被使用它所带来的巨大好处掩盖了。从创业公司到财富500强公司，如果你正在考虑接受一个新的移动项目，考虑使用React Native——我们知道你不会后悔的。</p><p id="a5f0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">演职员表</strong></p><p id="1f16" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这篇文章是由沃尔玛实验室React Native团队的工程师们共同完成的，他们分别是<a class="lz ma ge" href="https://medium.com/u/bbf6a1d22e3?source=post_page-----cdd140589560--------------------------------" rel="noopener" target="_blank">马特·布雷斯南</a>、<a class="lz ma ge" href="https://medium.com/u/a4da983a03a0?source=post_page-----cdd140589560--------------------------------" rel="noopener" target="_blank"> M.K .萨菲</a>、<a class="lz ma ge" href="https://medium.com/u/3736ca4de438?source=post_page-----cdd140589560--------------------------------" rel="noopener" target="_blank">桑凯特·帕特尔</a>和<a class="lz ma ge" href="https://medium.com/u/5d46542ee15f?source=post_page-----cdd140589560--------------------------------" rel="noopener" target="_blank">科尔蒂</a>。</p></div></div>    
</body>
</html>