<html>
<head>
<title>Kube Eagle on ORACLE Kubernetes Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ORACLE Kubernetes引擎上的Kube Eagle</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/kube-eagle-on-oracle-kubernetes-engine-f2c8a3730565?source=collection_archive---------0-----------------------#2019-03-08">https://medium.com/oracledevs/kube-eagle-on-oracle-kubernetes-engine-f2c8a3730565?source=collection_archive---------0-----------------------#2019-03-08</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="f158" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">每个人都知道或至少听说过Prometheus和Grafana，这是用于监控kubernetes集群的最广泛使用的工具，最常见的指标收集是通过节点导出器或Kube状态指标进行的。但是这些指标的问题是理解和分析起来有点复杂。他们没有足够的元数据，两种指标收集工具的聚合变得很困难。最近我偶然发现了一个叫做Kube Eagle的项目。这是一个用于监控kubernetes集群的开源项目，但正如我在上面提到的，它对当前的监控指标有一些额外的优势。因此，在这篇文章中，我将向您展示如何为Oracle Kubernetes引擎配置K <strong class="ig hi"> ube Eagle，该引擎也可以扩展到任何其他Kubernetes集群。</strong></p><p id="f399" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，在直接进入Kube Eagle的安装步骤之前，让我们了解一下它在其他现有指标之上的具体用途。Kube Eagle用于kubernetes集群监控，每个集群甚至可以监控多达50个或更多的节点，并且可以跟踪关于节点的非常精确的信息，这有助于节省资金。<br/>使用kubernetes集群固然很好，但如今重要的是资源化地使用它，也就是说要知道为资源分配多少内存，以便控制成本，最终在云中重要的是节约成本。</p><p id="f008" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">库伯鹰的<strong class="ig hi">仓库:<a class="ae jc" href="https://github.com/google-cloud-tools/kube-eagle" rel="noopener ugc nofollow" target="_blank">https://github.com/google-cloud-tools/kube-eagle</a></strong></p><p id="2422" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们看看如何在Oracle Kubernetes集群上安装它。在继续之前，您需要启动并运行一个<strong class="ig hi">集群</strong>，安装<strong class="ig hi"> kubectl </strong>(如果没有，请从<a class="ae jc" href="https://storage.googleapis.com/kubernetes-release/release/v1.13.0/bin/windows/amd64/kubectl.exe" rel="noopener ugc nofollow" target="_blank">https://storage . Google APIs . com/kubernetes-release/release/v 1 . 13 . 0/bin/windows/amd64/kube CTL . exe</a>下载)并为Oracle kubernetes集群正确配置<strong class="ig hi"> kube-config </strong>文件。<br/>当您执行"<strong class="ig hi"> kubetclt get nodes" </strong>时，它应该会为您提供已配置集群中的节点。</p><p id="929b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您已经设置了一个Oracle kubernetes集群，那么您需要完成以下步骤(我将提到的所有步骤都是针对Windows系统的):<br/>安装Metrics server: <br/> -在您的本地系统中使用git bash克隆存储库:<a class="ae jc" href="https://github.com/kubernetes-incubator/metrics-server" rel="noopener ugc nofollow" target="_blank">https://github.com/kubernetes-incubator/metrics-server</a><br/>-为了在您的集群中部署metrics-server，从该存储库的顶层目录运行以下命令:<br/> kubectl create -f deploy/1.7/(对于kubernetes 1.7) <br/> kubectl create -f deploy/1.8/(对于kubernetes 1.8) <br/>现在，如果您这样做了"<strong class="ig hi">kubectl get pods-n kube-system "</strong>您将看到metrics server正在运行</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/aba90e38797eb18d156b0216aab2693e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BPOn7IN-KwSq3fY6mvMwHQ.png"/></div></div></figure><p id="ec61" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">确保度量服务器正在运行。</p><p id="7ce8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">为windows 10安装Chocolatey</strong>:<br/>你只需以管理员身份打开powershell，运行文档中提到的命令:<a class="ae jc" href="https://chocolatey.org/docs/installation" rel="noopener ugc nofollow" target="_blank">https://chocolatey.org/docs/installation</a>。</p><p id="7b35" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在巧克力已经安装好了，我们将使用它来安装头盔。<br/> choco安装kubernetes-helm <br/>或者你可以下载想要的版本:<a class="ae jc" href="https://github.com/helm/helm/releases" rel="noopener ugc nofollow" target="_blank">https://github.com/helm/helm/releases</a>然后解压zip文件并添加到环境变量中的path。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jp"><img src="../Images/4a36dcb1ca302833200f0bc8ad9db099.png" data-original-src="https://miro.medium.com/v2/resize:fit:1170/format:webp/1*ii-H7tiO2GbkfnFuqT8hhw.png"/></div></figure><p id="e5ae" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在你已经在本地系统中安装了helm，你需要为Tiller 配置一个<strong class="ig hi">服务账户:</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jq"><img src="../Images/7720720918b177234db2da649167b126.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/1*h4zXeFO9X3qeJ-IiQBMLAw.png"/></div><figcaption class="jr js et er es jt ju bd b be z dx">Service account creation</figcaption></figure><p id="fdfb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建上述文件后，运行:<br/>$ ku bectl create-f RBAC-config . YAML<br/>service account " tiller " created<br/>clusterrolebinding " tiller " created<br/>$<strong class="ig hi">helm init—service-account tiller</strong><br/>您可以检查helm版本:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jv"><img src="../Images/f16307e9abbca1c3f471bfce70a770f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UgDokXqIpTVogXHFnyFS3Q.png"/></div></div></figure><p id="7780" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您还将看到在kube-system名称空间中运行的<strong class="ig hi"> tiller pod </strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jw"><img src="../Images/e36d6b962ac25ed9e7ca27b79e9bb236.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I-hWPhee2cfAfJL3dYCUeA.png"/></div></div></figure><p id="e1ee" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦圣盔初始化，你就可以使用圣盔在圣盔图上安装普罗米修斯，格拉夫纳和库伯鹰。</p><p id="d464" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因为这个帖子是关于Kube-Eagle的，所以我不会解释普罗米修斯和grafana的来龙去脉，因为我已经写了单独的<a class="ae jc" rel="noopener" href="/linuxacademy/100daysoflearning-d1e39bea635a">帖子</a>。但是我们将在本地安装prometheus和grafana，并使用helm从windows系统本地访问仪表板。</p><p id="ab1d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">安装Prometheus和Grafana:<br/>Prometheus</strong>:<br/>helm install—NAME Prometheus stable/Prometheus<strong class="ig hi"><br/></strong>为了在本地运行Prometheus并查看UI运行以下命令:<strong class="ig hi"><br/></strong>$ export POD _ NAME = $(ku bectl get pods-namespace default-l " app = Prometheus，component=server" -o jsonpath="{。items[0]. metadata . NAME } "<br/>$ ku bectl-名称空间默认端口-转发$POD_NAME 9090</p><p id="1780" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以上将安装prometheus的稳定版本并在<a class="ae jc" href="http://localhost:9090" rel="noopener ugc nofollow" target="_blank"> http://localhost:9090 </a>上运行</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jx"><img src="../Images/c05b0a5f84006af7b4461e4d3a1df1aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pmuEZml_DrGnNrJF9M6byg.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx">Prometheus UI</figcaption></figure><p id="835e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">格拉法纳</strong>:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jy"><img src="../Images/7176340ce394114f0b5f590464f7a891.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e7dWDzIk6vfRFzF-cA-a-g.png"/></div></div></figure><p id="8e15" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">helm install—NAME grafana stable/graf ana<br/></strong>为了在本地运行graf ana并查看仪表盘，运行以下命令:<br/>$ export POD _ NAME = $(ku bectl get pods-namespace default-l " app = graf ana "-o JSON path = " {。items[0]. metadata . NAME } "<br/>$ ku bectl-名称空间默认端口-转发$POD_NAME 3000</p><p id="218c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以上将安装grafana的稳定版本，并在<a class="ae jc" href="http://localhost:9090" rel="noopener ugc nofollow" target="_blank"> http://localhost: </a> 3000上运行</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jz"><img src="../Images/21d43cb4b9894a239643f82b2e6ec749.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yIf2eXMGVm6FYMrBD5bOeg.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx">Grafana Dashboard</figcaption></figure><p id="da41" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在我们已经为运行Kube-Eagle做好了一切准备，让我们继续使用helm安装Kube-Eagle:<br/>repo:<a class="ae jc" href="https://github.com/google-cloud-tools/kube-eagle-helm-chart" rel="noopener ugc nofollow" target="_blank">https://github.com/google-cloud-tools/kube-eagle-helm-chart</a><br/>步骤:<br/> -helm repo添加Kube-Eagle<a class="ae jc" href="https://raw.githubusercontent.com/google-cloud-tools/kube-eagle-helm-chart/master" rel="noopener ugc nofollow" target="_blank">https://raw . githubusercontent . com/Google-cloud-tools/Kube-Eagle-helm-chart/master</a><br/>-helm repo update<br/>-helm install-name = Kube-Eagle Kube-Eagle/Kube-Eagle</p><p id="5aba" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上面将安装Kube-Eagle，您可以看到它在默认的名称空间中运行:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ka"><img src="../Images/6d36688352d907b8a8f6af3ca4edd52c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oRDWFOP6WNky0XX71Tyjcg.png"/></div></div></figure><p id="0f26" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意:因为您已经安装了Prometheus和Grafana，所以您也将在默认名称空间中看到它们的pod:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kb"><img src="../Images/3c91c5cd12c925f2d85330b94110ec72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JGB9M7U5eb2bHGZnf7mhBg.png"/></div></div><figcaption class="jr js et er es jt ju bd b be z dx">Prometheus and Grafana PODS</figcaption></figure><p id="6d04" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">既然我们已经设置好了一切，让我们将prometheus添加为grafana中的数据源:从仪表板转到Configuration，然后单击add data source。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kc"><img src="../Images/a3b1736ca80ed6ec5fa059e6d26223ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X0UfFLtAzM0SPAyzvhR5ow.png"/></div></div></figure><p id="44c8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">并从中选出普罗米修斯:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kd"><img src="../Images/4217fcf8cbaa7d3bf5e100b6d1640ebf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*soOGTung8HJj_6TiCmvOIQ.png"/></div></div></figure><p id="48d0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">给出网址并点击保存:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ke"><img src="../Images/9575e6cbc00602d09bcc4075560278a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1288/format:webp/1*GiFb-xJNHWPE9cd5xDtpWQ.png"/></div></figure><p id="f416" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您将看到添加的数据源:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kf"><img src="../Images/75b71f37be8e064e385bfc44bb84e420.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ytKdzMilyspHlMfNUOTTJg.png"/></div></div></figure><p id="7be3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，我们将为Kube Eagle创建一个仪表板:<br/>导入仪表板:<a class="ae jc" href="https://grafana.com/dashboards/9871" rel="noopener ugc nofollow" target="_blank">https://grafana.com/dashboards/9871</a>(仪表板ID 9871)。选择import dashboard并键入9871，您应该会看到以下内容:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kg"><img src="../Images/ecae07b3d4d5ab1eeb8b246b6e13ca65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3pNnS4URXqPiGRDidm2dvw.png"/></div></div></figure><p id="bcf7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因为我已经有了Kube Eagle，所以它显示一个警告。<br/>如果到目前为止一切都很成功，并且您能够看到各自的pod已创建并正在运行，请转到Kube Eagle仪表板，您应该可以看到来自节点的所有数据，这些数据具有精确的细节和适当的聚合。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kh"><img src="../Images/4b8b26b8da84100ff640c771fabf4cb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xbVMl1nRwwexQHbB15xG3Q.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ki"><img src="../Images/d62ac5f12afac955b7ce76ede9b4875e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8ybmDLq3bznX9KN9Vr-piw.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kj"><img src="../Images/15d4c4ed4dcb0c60ea1b7fdb75509d44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MS5nxRz5kS8f_jqS54mryg.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kk"><img src="../Images/3bdc3a2f70bea18343fe780d10dc0e99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h2-sLq3QAHuRCtAaAmdoiw.png"/></div></div></figure><p id="44f9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如您所见，Kube-Eagle设置成功，并提供了许多有用的指标，可用于定义和限制每个pod的核心数。这实际上有助于节省大量硬件资源。就像一些pod会在集群仍有内存时耗尽内存。使用Kube-Eagle可以很容易地看到这类问题。</p><p id="c086" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Kube Eagle的创建者Martin Schneppenheim 也面临着类似的问题，他创建了Kube Eagle，帮助他和他的团队削减了成本和许多其他好处，包括:<br/> -为微服务分配适当的资源请求&amp;限制<br/> -减少RAM过度分配的问题<br/> -跨所有节点平衡硬件利用率。</p><p id="4012" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">快乐学习。<br/>赛亚姆·帕塔克<br/><a class="ae jc" href="https://www.linkedin.com/in/saiyam-pathak-97685a64/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/saiyam-pathak-97685a64/</a><br/><a class="ae jc" href="https://twitter.com/SaiyamPathak" rel="noopener ugc nofollow" target="_blank">https://twitter.com/SaiyamPathak</a></p></div></div>    
</body>
</html>