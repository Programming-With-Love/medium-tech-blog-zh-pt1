<html>
<head>
<title>Rock-Solid K3s on OCI — part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">坚如磐石的Solid K3s第1部分</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/rock-solid-k3s-on-oci-part-1-dbfeaa69d670?source=collection_archive---------0-----------------------#2022-10-26">https://medium.com/oracledevs/rock-solid-k3s-on-oci-part-1-dbfeaa69d670?source=collection_archive---------0-----------------------#2022-10-26</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/1f6e556f001ac716126f961fbadbfdc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:724/format:webp/1*MOnRCw7YAniziVSZw-X4ig.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo by Leon Macapagal: <a class="ae it" href="https://www.pexels.com/photo/aerial-view-of-city-buildings-beside-water-6622898/" rel="noopener ugc nofollow" target="_blank">https://www.pexels.com/photo/aerial-view-of-city-buildings-beside-water-6622898/</a></figcaption></figure><p id="4b44" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Kubernetes (K8s)是一个非常棒的编排引擎。它可以用于大型企业环境，甚至嵌入式/边缘物联网用例(有时称为“雾计算”)。成熟的K8s对大多数用户来说是一个很好的选择，因为它以稳定和可扩展的格式提供了丰富而健壮的功能集。对于可用资源较少的环境，轻量级K8s实现是理想的。</p><p id="5b81" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果您需要托管K8s服务，我强烈推荐您使用<a class="ae it" href="https://docs.oracle.com/en-us/iaas/Content/ContEng/home.htm" rel="noopener ugc nofollow" target="_blank"> OCI容器引擎</a>(通常缩写为OKE)。它提供了一个完全托管的企业级K8s环境，全部由OCI提供支持并与之集成。像<a class="ae it" href="https://docs.oracle.com/en-us/iaas/Content/ContEng/Tasks/contengcreatingloadbalancer.htm" rel="noopener ugc nofollow" target="_blank"> OCI负载平衡器</a>、<a class="ae it" href="https://docs.oracle.com/en-us/iaas/Content/ContEng/Tasks/contengcreatingpersistentvolumeclaim.htm" rel="noopener ugc nofollow" target="_blank">块存储卷</a>等东西可以在OCI容器引擎中为您管理。节点池(支持x86_64和aarch64架构)、K8s版本升级等等都可以通过<a class="ae it" href="https://docs.oracle.com/en-us/iaas/Content/ContEng/home.htm" rel="noopener ugc nofollow" target="_blank"> OCI容器引擎</a>轻松完成。</p><p id="aeaf" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你使用OCI永远免费帐户，你需要找到另一个选项，因为OKE在免费层帐户中不可用。也就是说，在一个自由层帐户中，你确实得到了相当多的处理“哼”!如果浪费了那就太可惜了。这可能是轻量级K8s部署的理想选择…</p><p id="572b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><a class="ae it" href="https://k3s.io/" rel="noopener ugc nofollow" target="_blank"> K3s </a>是一个轻量级Kubernetes (K8s)实现，专为嵌入式和轻量级环境而设计。它非常小，对资源的要求非常低。这大部分是通过合并流程和消除不必要的组件来实现的。它使用K3s服务器和K3s代理的概念，K3s服务器运行控制平面，K3s代理主要用于运行容器(工作节点)。除了<a class="ae it" href="https://k3s.io/" rel="noopener ugc nofollow" target="_blank"> K3s </a>之外还有其他的轻量级K8s实现，比如<a class="ae it" href="https://shipit.dev/posts/minikube-vs-kind-vs-k3s.html" rel="noopener ugc nofollow" target="_blank"> Minikube </a>和<a class="ae it" href="https://microk8s.io/compare" rel="noopener ugc nofollow" target="_blank"> MicroK8s </a>。</p><p id="fed1" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">有几个步骤涉及到这个站起来。为了使这个更容易管理，我把它组织成一个多部分的系列。以下是我们将在本系列中看到的内容的快速概述:</p><ul class=""><li id="6552" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">简介(第1部分—本文)</li><li id="6701" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">OCI基础设施(第1部分—本文)</li><li id="7caa" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">K3s安装(第二部分)</li><li id="d3b2" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">OCI云控制器管理器安装(第3部分)</li><li id="48b6" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">OCI云控制器存储安装(第三部分)</li><li id="be9b" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">入口控制器(第三部分)</li><li id="2073" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">示例应用程序部署(Jupyter和Node-RED)(第4部分)</li></ul><p id="cae3" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在该系列的最后，我们将部署可能用于机器学习和物联网实验的应用程序。当然，您也可以将它用于其他应用程序！选择权在你。您将拥有一个出色的轻量级K8s平台，能够运行不同的应用程序。</p><h1 id="0a08" class="kg kh hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">入门指南</h1><p id="b2d2" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">首先，你需要注册一个OCI账户。请前往<a class="ae it" href="https://cloud.oracle.com/" rel="noopener ugc nofollow" target="_blank">https://cloud.oracle.com/</a>并点击“注册”按钮。确保您可以登录到OCI控制台，并准备好部署K3s。</p><p id="39f1" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">本文的剩余部分将集中在创建所需的OCI基础设施，并为我们安装K3s做好准备。我们走吧！</p><h1 id="98d1" class="kg kh hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">OCI基础设施</h1><p id="9387" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">我建议您为所有OCI资源选择一个单独的隔间。由于一张图胜过千言万语，以下是所需OCI资源的结构视图:</p><figure class="lk ll lm ln fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lj"><img src="../Images/4cf3ecb044081736308c9886b2385911.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2r1WkoNYv9DtDhxpMyhlfw.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Structural view of OCI resources</figcaption></figure><p id="add0" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">首先创建一个VCN，具有以下属性:</p><ul class=""><li id="1bcb" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">名称:k3s</li><li id="d0cb" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IPv4 CIDR: 192.168.0.0/16</li></ul><p id="ab5b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这是资源的逻辑图，显示了我们将要配置的路由策略:</p><figure class="lk ll lm ln fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lj"><img src="../Images/9a082bcfbbc42d93bd232d3e61e6ce58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BMLu5M-UOOgr5yt7Gd-dng.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Logical diagram of OCI infrastructure</figcaption></figure><p id="a399" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在VCN创建一个NAT网关和一个Internet网关，以及两张路由表:</p><p id="5017" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">名称:私人</p><ul class=""><li id="19ac" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">路由规则:0.0.0.0/0 &gt; NAT网关</li></ul><p id="3df5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">名称:公共</p><ul class=""><li id="7a22" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">路由规则:0.0.0.0/0 &gt;互联网网关</li></ul><p id="89d3" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">继续在新创建的VCN中创建三个子网:</p><p id="a39f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">子网1 </strong></p><ul class=""><li id="c938" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">名称:k3s</li><li id="84b2" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IPv4 CIDR地址块:192.168.0.0/24</li><li id="e109" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">子网访问:专用子网</li><li id="fe4d" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">路由表:私有</li><li id="db4a" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">DNS标签:k3s</li></ul><p id="c001" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">子网2 </strong></p><ul class=""><li id="4de0" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">名称:堡垒</li><li id="62ae" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IPv4 CIDR地址块:192.168.255.0/24</li><li id="6288" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">子网访问:公共子网</li><li id="a496" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">路由表:公共</li><li id="7a87" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">DNS标签:堡垒</li></ul><p id="94e4" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">子网3 </strong></p><ul class=""><li id="7853" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">名称:lb</li><li id="5ecb" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IPv4 CIDR地址块:192.168.1.0/24</li><li id="0c06" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">子网访问:公共子网</li><li id="351d" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">路由表:公共</li><li id="0962" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">DNS标签:lb</li></ul><p id="b64e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们创建将要使用的网络安全策略。为此，我们将设置几个<a class="ae it" href="https://docs.oracle.com/en-us/iaas/Content/Network/Concepts/networksecuritygroups.htm" rel="noopener ugc nofollow" target="_blank">网络安全组</a>(NSG)，如下图所示:</p><figure class="lk ll lm ln fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lj"><img src="../Images/998f5711225289101c357d1b75909453.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rvAkGa5n4o_hDfIXZkchOA.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">OCI Network Security Groups</figcaption></figure><p id="1c58" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在同一个VCN中创建以下NSG和NSG规则。请注意，您需要先浏览并创建空的NSG，然后返回并向它们添加规则。这是因为许多规则与NSG(而不是CIDR数据块)之间有往来，这意味着NSG需要存在，相关规则才能引用它们。</p><p id="be93" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">名称:服务器</strong></p><p id="ccf5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">规则1:</p><ul class=""><li id="ceae" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">方向:出口</li><li id="36eb" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IP协议:所有协议</li><li id="185b" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目的地类型:网络安全组(NSG)</li><li id="9309" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目的地NSG:服务器</li><li id="57c2" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">描述:允许子网内流量(出站)。</li></ul><p id="edc5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">规则二:</p><ul class=""><li id="68be" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">方向:入口</li><li id="928c" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IP协议:所有协议</li><li id="ffed" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">来源类型:网络安全小组(NSG)</li><li id="7739" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">来源NSG:服务器</li><li id="ad81" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">描述:允许子网内流量(入站)。</li></ul><p id="0438" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">规则三:</p><ul class=""><li id="c03f" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">方向:入口</li><li id="4c7e" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IP协议:所有协议</li><li id="cd59" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">来源类型:网络安全小组(NSG)</li><li id="fbcf" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">资料来源:NSG特工</li><li id="c99d" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">描述:允许来自代理的流量(入站)。</li></ul><p id="5091" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">规则4:</p><ul class=""><li id="ec16" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">方向:出口</li><li id="0487" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IP协议:所有协议</li><li id="3476" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目的地类型:网络安全组(NSG)</li><li id="9863" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目的地NSG:代理商</li><li id="e8f2" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">描述:允许代理的流量(出站)。</li></ul><p id="61c6" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">规则五:</p><ul class=""><li id="0a0f" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">方向:入口</li><li id="d15d" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IP协议:TCP</li><li id="51f2" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">来源类型:CIDR</li><li id="0417" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">资料来源:192.168.255.0/24</li><li id="51a2" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目标端口范围:22</li><li id="2750" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">描述:允许来自bastion子网的SSH (tcp/22)</li></ul><p id="a752" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">名称:代理商</strong></p><p id="42d1" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">规则1:</p><ul class=""><li id="fb95" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">方向:出口</li><li id="73e7" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IP协议:所有协议</li><li id="bbf7" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目的地类型:网络安全组(NSG)</li><li id="1a2a" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目的地NSG:代理商</li><li id="39a2" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">描述:允许子网内流量(出站)。</li></ul><p id="aa76" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">规则二:</p><ul class=""><li id="775a" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">方向:入口</li><li id="e10d" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IP协议:所有协议</li><li id="29b8" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">来源类型:网络安全小组(NSG)</li><li id="47bc" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">来源NSG:服务器</li><li id="4005" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">描述:允许来自服务器的流量(入站)。</li></ul><p id="61de" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">规则三:</p><ul class=""><li id="e322" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">方向:出口</li><li id="d788" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IP协议:所有协议</li><li id="c99e" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目的地类型:网络安全组(NSG)</li><li id="fa43" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目的地NSG:服务器</li><li id="a1dd" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">描述:允许到服务器的流量(出站)。</li></ul><p id="5995" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">规则4:</p><ul class=""><li id="b572" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">方向:入口</li><li id="a0b0" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IP协议:所有协议</li><li id="29a8" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">来源类型:网络安全小组(NSG)</li><li id="864d" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">资料来源:NSG特工</li><li id="bbd9" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">描述:允许子网内流量(入站)。</li></ul><p id="ad57" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">规则五:</p><ul class=""><li id="202b" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">方向:入口</li><li id="cd61" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IP协议:所有协议</li><li id="d7e1" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">来源类型:网络安全小组(NSG)</li><li id="a80e" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">资料来源:NSG:堡垒</li></ul><p id="a533" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">规则6:</p><ul class=""><li id="bb98" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">方向:入口</li><li id="2f64" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IP协议:TCP</li><li id="c2b1" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">来源类型:CIDR</li><li id="6061" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">资料来源:192.168.1.0/24</li><li id="59bd" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">描述:允许LB子网的所有TCP端口</li></ul><p id="4f3c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">规则7:</p><ul class=""><li id="f98e" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">方向:入口</li><li id="8888" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IP协议:TCP</li><li id="2b9b" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">来源类型:CIDR</li><li id="add9" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">资料来源:192.168.255.0/24</li><li id="d829" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目标端口范围:22</li><li id="6e5b" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">描述:允许来自bastion子网的SSH (tcp/22)</li></ul><p id="6ea0" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">名称:inet_out </strong></p><p id="8fe5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">规则1:</p><ul class=""><li id="a6ac" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">方向:出口</li><li id="ffdd" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IP协议:TCP</li><li id="eb6c" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目的地类型:CIDR</li><li id="2798" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目的地:0.0.0.0/0</li><li id="4b55" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目标端口范围:443</li><li id="23e2" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">描述:允许HTTPS (tcp/443)访问web</li></ul><p id="2f43" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">规则二:</p><ul class=""><li id="2900" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">方向:出口</li><li id="e1c6" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IP协议:TCP</li><li id="0ff2" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目的地类型:CIDR</li><li id="614d" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目的地:0.0.0.0/0</li><li id="a987" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目标端口范围:80</li><li id="410a" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">描述:允许HTTP (tcp/80)访问web</li></ul><p id="f1a4" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">规则三:</p><ul class=""><li id="3cd7" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">方向:出口</li><li id="7a25" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IP协议:UDP</li><li id="07c3" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目的地类型:CIDR</li><li id="aa26" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目的地:0.0.0.0/0</li><li id="3940" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目标端口范围:53</li><li id="a31d" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">描述:允许DNS (udp/53)访问web</li></ul><p id="a030" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">名称:堡垒</strong></p><p id="0e05" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">规则1:</p><ul class=""><li id="2ea7" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">方向:出口</li><li id="a032" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IP协议:所有协议</li><li id="9ff7" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目的地类型:网络安全组(NSG)</li><li id="91ca" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目标:服务器</li><li id="2402" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">描述:允许对服务器的出站访问</li></ul><p id="2385" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">规则二:</p><ul class=""><li id="4068" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">方向:出口</li><li id="b92b" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IP协议:所有协议</li><li id="c273" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目的地类型:网络安全组(NSG)</li><li id="a876" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目的地:代理商</li><li id="d8f9" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">描述:允许代理出站访问</li></ul><p id="495e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">规则三:</p><ul class=""><li id="3877" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">方向:出口</li><li id="be6f" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IP协议:所有协议</li><li id="8cf7" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目的地类型:网络安全组(NSG)</li><li id="35b2" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目的地:lb</li><li id="16ce" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">描述:允许对LB的出站访问</li></ul><p id="e56d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">规则4:</p><ul class=""><li id="9f0b" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">方向:入口</li><li id="27be" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IP协议:TCP</li><li id="cf5e" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">来源类型:CIDR</li><li id="e1ac" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">来源:<your public="" ip="" here=""/></li><li id="ff20" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目标端口范围:22</li><li id="ec53" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">描述:允许来自允许的IP的SSH (tcp/22)</li></ul><p id="7d7d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">名称:lb </strong></p><p id="761e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">规则1:</p><ul class=""><li id="0095" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">方向:入口</li><li id="4f35" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IP协议:所有协议</li><li id="dcee" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">来源类型:网络安全小组(NSG)</li><li id="9e74" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">资料来源:bastions</li><li id="b584" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">描述:允许来自堡垒的所有流量</li></ul><p id="d74d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">规则二:</p><ul class=""><li id="c3cc" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">方向:出口</li><li id="ba84" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IP协议:所有协议</li><li id="53ed" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目的地类型:网络安全组(NSG)</li><li id="7025" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">目的地:代理商</li><li id="320a" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">描述:允许从LB到K3s代理的所有流量</li></ul><p id="c88b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">规则三:</p><ul class=""><li id="5153" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">方向:入口</li><li id="661e" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">IP协议:所有协议</li><li id="84a6" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">来源类型:CIDR</li><li id="ec82" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">来源:<your public="" ip="" here=""/></li><li id="673b" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">描述:允许来自允许访问CIDR的所有流量</li></ul><h1 id="045d" class="kg kh hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">计算实例</h1><p id="4cf5" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">我们现在可以创建OCI计算实例了，我们将用它来运行K3s！我们已经设置了很多资源，现在是高潮，为安装K3s做准备。</p><p id="e4ee" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我假设您没有在OCI永久免费租赁中使用任何计算资源，允许我们将它们用于K3s解决方案。</p><p id="cc7d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">继续创建以下计算实例。对于所有实例，我都使用Oracle Linux 8和相同的SSH密钥。注意，OCI可以为您生成SSH密钥，或者您可以使用自己的SSH密钥。不管怎样，记住它们，因为你以后会用到它们。</p><p id="856d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">名称:堡垒</strong></p><ul class=""><li id="ad66" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">摆放位置:<pick an="" ad=""/></li><li id="eb87" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">外形:VM。Standard.E2.1.Micro(假设您使用的是OCI免费帐户，否则选择合适的形状)</li><li id="7b33" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">VCN: k3s</li><li id="7ca2" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">子网:堡垒</li><li id="ec4d" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">公共IP地址:<em class="lo">分配一个公共IP地址</em></li><li id="3df4" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">(在<em class="lo">联网</em>框中点击<em class="lo">显示高级选项</em>)</li><li id="d159" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">选中<em class="lo">使用网络安全组控制流量</em>复选框，添加以下NSG:inet _ out、bastions</li></ul><p id="e46f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">名称:服务器1 </strong></p><ul class=""><li id="0323" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">位置:<pick an="" ad=""/></li><li id="90b6" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">外形:VM。Standard.E2.1.Micro(假设您使用的是OCI免费帐户，否则选择合适的形状)</li><li id="90b3" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">VCN: k3s</li><li id="c2c5" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">子网:k3s</li><li id="7987" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">公共IP地址:<em class="lo">不分配公共IP地址</em></li><li id="edc1" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">(在<em class="lo">联网</em>框中点击<em class="lo">显示高级选项</em>)</li><li id="d9f4" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">选中<em class="lo">使用网络安全组控制流量</em>复选框，添加以下NSG:inet _ out，servers</li></ul><p id="101f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">名称:代理1 </strong></p><ul class=""><li id="4a5d" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">摆放位置:<pick an="" ad=""/></li><li id="8756" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">外形:VM。标准. A1.Flex</li><li id="21c1" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">VCN: k3s</li><li id="552f" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">子网:k3s</li><li id="ae35" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">公共IP地址:<em class="lo">不分配公共IP地址</em></li><li id="66db" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">(点击<em class="lo">联网</em>框中的<em class="lo">显示高级选项</em></li><li id="ae72" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">选中<em class="lo">使用网络安全组控制流量</em>复选框，添加以下NSG:inet _ out、代理</li></ul><p id="8498" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">名称:代理2 </strong></p><ul class=""><li id="263f" class="js jt hh iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">摆放位置:<pick an="" ad=""/></li><li id="17a1" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">外形:VM。标准. A1.Flex</li><li id="7e82" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">VCN: k3s</li><li id="9559" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">子网:k3s</li><li id="c301" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">公共IP地址:<em class="lo">不分配公共IP地址</em></li><li id="1400" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">(在<em class="lo">联网</em>框中点击<em class="lo">显示高级选项</em>)</li><li id="1e06" class="js jt hh iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">选中<em class="lo">使用网络安全组控制流量</em>复选框，添加以下NSG:inet _ out、代理</li></ul><h1 id="e503" class="kg kh hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">IAM策略</h1><p id="9547" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">我们将使用<a class="ae it" href="https://docs.oracle.com/en-us/iaas/Content/Identity/dynamicgroups/managingdynamicgroups.htm" rel="noopener ugc nofollow" target="_blank">实例主体</a>对OCI进行认证。这意味着一个或多个OCI实例将被赋予一个身份，允许它调用OCI API并被视为该身份。</p><p id="0c09" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">创建一个动态组，名称为<em class="lo"> k3s_master </em>，描述为<em class="lo"> K3s master dyn group </em>，有一个匹配规则:</p><pre class="lk ll lm ln fd lp lq lr ls aw lt bi"><span id="24dd" class="lu kh hh lq b fi lv lw l lx ly">All { <a class="ae it" href="http://instance.compartment.id/" rel="noopener ugc nofollow" target="_blank">instance.compartment.id</a> = ‘&lt;COMPARTMENT_OCID&gt;’, <a class="ae it" href="http://instance.id/" rel="noopener ugc nofollow" target="_blank">instance.id</a> = ‘&lt;SERVER1_OCID&gt;’ }</span></pre><p id="c137" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">接下来，在您正在使用的区间中创建一个IAM策略，它引用了<em class="lo"> k3s_master </em>动态组(名称:<em class="lo"> k3s </em>，描述:<em class="lo"> K3s实例主体语句</em>)。将以下语句添加到<em class="lo"> k3s </em> IAM策略中:</p><pre class="lk ll lm ln fd lp lq lr ls aw lt bi"><span id="9f79" class="lu kh hh lq b fi lv lw l lx ly">allow dynamic-group k3s_master to use instance-family in compartment id &lt;COMPARTMENT_OCID&gt;,</span><span id="a541" class="lu kh hh lq b fi lz lw l lx ly">allow dynamic-group k3s_master to manage virtual-network-family in compartment id &lt;COMPARTMENT_OCID&gt;,</span><span id="863f" class="lu kh hh lq b fi lz lw l lx ly">allow dynamic-group k3s_master to manage load-balancers in compartment id &lt;COMPARTMENT_OCID&gt;,</span><span id="fbf1" class="lu kh hh lq b fi lz lw l lx ly">allow dynamic-group k3s_master to manage volume-family in compartment id &lt;COMPARTMENT_OCID&gt;</span></pre><h1 id="ef96" class="kg kh hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">访问实例</h1><p id="312d" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">创建了所有OCI计算实例后，您将希望通过SSH连接到堡垒，理想情况下使用<em class="lo">-一个</em> SSH命令行参数启用代理转发(假设您使用的是MacOS或Linux)。使用<a class="ae it" href="https://the.earth.li/~sgtatham/putty/0.77/htmldoc/Chapter9.html#pageant-forward" rel="noopener ugc nofollow" target="_blank"> Putty </a>、<a class="ae it" href="https://www.vandyke.com/support/tips/agent_forwarding.html" rel="noopener ugc nofollow" target="_blank"> SecureCRT </a>或许多其他终端模拟器，可以实现类似的代理转发配置。</p><p id="492f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这里有一个例子，说明如何到达不同的实例:</p><pre class="lk ll lm ln fd lp lq lr ls aw lt bi"><span id="ad62" class="lu kh hh lq b fi lv lw l lx ly">Your computer<br/>      |<br/>      |<br/>  (SSH session with Agent Forwarding enabled)<br/>      |<br/>      V<br/>bastion (OCI instance)<br/>    |<br/>    |<br/> (SSH session)<br/>    |<br/>    V<br/>server1, agent1 or agent2</span></pre><p id="f9e7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">以下是命令示例:</p><pre class="lk ll lm ln fd lp lq lr ls aw lt bi"><span id="62e6" class="lu kh hh lq b fi lv lw l lx ly">ssh -A -i &lt;your SSH priv key&gt; opc@&lt;bastion_pub_ip&gt;</span></pre><p id="2f92" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在此会话中:</p><pre class="lk ll lm ln fd lp lq lr ls aw lt bi"><span id="e604" class="lu kh hh lq b fi lv lw l lx ly">ssh &lt;priv_ip&gt;</span></pre><p id="e927" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">其中<priv_ip>是服务器1、代理1或代理2的私有IP(或FQDN——见下一段)。当我们安装K3s和其他组件时，这些命令(和流)将在本系列的后续部分中大量使用。</priv_ip></p><p id="a03b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">作为一种捷径，理想的做法是使用OCI实例的完全限定域名(FQDN )(而不是实例的私有IP ),这意味着您不必知道(或查找)不同OCI实例的私有IP。例如:</p><pre class="lk ll lm ln fd lp lq lr ls aw lt bi"><span id="157a" class="lu kh hh lq b fi lv lw l lx ly">ssh server1.k3s.k3s.oraclevcn.com<br/>ssh agent1.k3s.k3s.oraclevcn.com<br/>ssh agent2.k3s.k3s.oraclevcn.com</span></pre><p id="ea0c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">上述命令是从堡垒到不同内部OCI计算实例的快速友好的SSH'ng方式。</p><h1 id="7bd3" class="kg kh hh bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">包装它</h1><p id="adcd" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">只需点击几下键盘，我们就可以在我们的OCI永远免费租赁中设置运行K3s所需的OCI资源！在本系列的下一部分，我们将设置K3s。下一篇文章再见。</p><p id="fafc" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你对甲骨文开发人员在他们的自然栖息地发生的事情感到好奇，来<a class="ae it" href="https://bit.ly/odevrel_slack" rel="noopener ugc nofollow" target="_blank">加入我们的公共休闲频道</a>！我们不介意成为你的鱼缸🐠</p></div></div>    
</body>
</html>