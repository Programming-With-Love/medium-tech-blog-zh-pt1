<html>
<head>
<title>Forwarding the Vintage Port with Oracle VirtualBox</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Oracle VirtualBox转发Vintage端口</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/vintage-port-for-oracle-virtualbox-aff0341acb52?source=collection_archive---------0-----------------------#2021-06-27">https://medium.com/oracledevs/vintage-port-for-oracle-virtualbox-aff0341acb52?source=collection_archive---------0-----------------------#2021-06-27</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/1d6d08f448d4efc450af2a979325ecbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y_WcmQNeLn8G1y8FVve2xw.png"/></div></div></figure><h2 id="f37c" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">样机研究</h2><p id="312c" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh ha bi translated">在Oracle VirtualBox中构建应用程序原型时，可以使用同一个虚拟机中的GUI客户端(如浏览器)。但是，虚拟机需要安装一个桌面环境，X11或Wayland。</p><p id="bd1b" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">如果不希望或不方便在虚拟机上安装桌面环境，您可以像这样将应用程序和客户端分开:</p><p id="ea20" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">—应用程序在虚拟机中执行。</p><p id="07bb" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">—来自主机的客户端连接到在虚拟机中执行的应用程序。</p><p id="8b5f" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">更简单地说，服务可以在虚拟机之外呈现给主机。这种配置具有以下优点:</p><ul class=""><li id="a375" class="kn ko hh jp b jq ki ju kj ja kp je kq ji kr kh ks kt ku kv bi translated">客户端性能更快，因为它将在裸机主机上运行。</li><li id="358e" class="kn ko hh jp b jq kw ju kx ja ky je kz ji la kh ks kt ku kv bi translated">更快的应用程序性能，因为虚拟机没有桌面环境的开销。</li><li id="092f" class="kn ko hh jp b jq kw ju kx ja ky je kz ji la kh ks kt ku kv bi translated">虚拟机所需的内存更少，因为它不支持桌面环境。</li></ul><p id="c43d" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">另一个好处是，如果主机没有连接到互联网，那么主机上的客户端仍然可以连接到虚拟机。</p><p id="08f6" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">让我们开始设置…</p></div><div class="ab cl lb lc go ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ha hb hc hd he"><h2 id="9762" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">从防火墙开始</h2><p id="f3fb" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh ha bi translated">虚拟机的防火墙需要重新配置，以打开所需的端口。</p><p id="bdaa" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">我使用Fedora Linux发行版作为虚拟机镜像，FirewallD的完整说明在这里:</p><p id="6eb0" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated"><a class="ae li" href="https://docs.fedoraproject.org/en-US/quick-docs/firewalld/" rel="noopener ugc nofollow" target="_blank">https://docs.fedoraproject.org/en-US/quick-docs/firewalld/</a></p><p id="5b44" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">现在从虚拟机的命令行打开FirewallD应用程序:</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="e5de" class="ip iq hh lo b fi ls lt l lu lv"># firewall-config&amp;</span></pre><p id="ea53" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">我们需要选择需要对虚拟机外部世界可用的连接。</p><p id="d07a" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">特别是，我们对开放HTTP连接感兴趣，但我们也可以添加其他协议来满足未来的需求。</p><figure class="lj lk ll lm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lw"><img src="../Images/b0d87e6d66781f30f7de2430d608381f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-5aRJX5xRydn2noAut9Hbg.png"/></div></div></figure><p id="69c4" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">让我们打开到端口5000和8080的连接，因为虚拟机上将会有应用程序侦听这些端口。</p><figure class="lj lk ll lm fd ii er es paragraph-image"><div class="er es lx"><img src="../Images/95d9f8878bdbc63be266c369c4f0ed76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*Bji5wpY1q-kD6fmzPuhhWg.png"/></div></figure><p id="f3c1" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">因为对防火墙的所有更改都是实时的，所以我也可以从命令行确认打开的端口:</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="5fcf" class="ip iq hh lo b fi ls lt l lu lv"># firewall-cmd --list-all</span></pre><figure class="lj lk ll lm fd ii er es paragraph-image"><div class="er es ly"><img src="../Images/5f308ca04696c6b9cee58c57f33391b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:958/format:webp/1*Eklj0Ve9vfI9Yz1RL5dUiQ.png"/></div></figure><p id="f3fd" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">因此端口5000和8080被设置用于连接。</p><p id="b989" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">如果您希望永久保留这些规则，请使用以下命令:</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="3b23" class="ip iq hh lo b fi ls lt l lu lv"># firewall-cmd --runtime-to-permanent</span></pre><p id="c8df" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">接下来是配置Oracle VirtualBox。</p></div><div class="ab cl lb lc go ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ha hb hc hd he"><h2 id="65d8" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">网络地址转换(NAT)</h2><p id="5a9c" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh ha bi translated">从技术上讲，在Oracle VirtualBox中，有不止一种方法可以在虚拟机之外呈现服务。</p><p id="d931" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">Oracle VM VirtualBox用户手册解释了:</p><blockquote class="lz ma mb"><p id="b137" class="jn jo mc jp b jq ki js jt ju kj jw jx md kk jz ka me kl kc kd mf km kf kg kh ha bi translated">但是，与物理路由器一样，Oracle VM VirtualBox可以通过端口转发将选定的服务提供给客户机之外的世界。</p></blockquote><p id="5e8c" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">事实上，网络地址转换(NAT)连接的端口转发是最简单的设置方式，因为网络适配器已经由Oracle VirtualBox默认设置。</p><p id="3957" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">Oracle VM VirtualBox管理器显示了每个虚拟机的网络配置，您应该会看到NAT设置。</p><figure class="lj lk ll lm fd ii er es paragraph-image"><div class="er es lx"><img src="../Images/022810dd3c49a823d5b72a82e05129b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/format:webp/1*VMspnUYeok8n8ufuzImdFw.png"/></div></figure><p id="8999" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">默认设置NAT后，接下来是本地端口转发的设置。</p></div><div class="ab cl lb lc go ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ha hb hc hd he"><h2 id="d384" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">NAT的本地端口转发</h2><p id="8617" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh ha bi translated">从' C:\ Program Files \ Oracle \ VirtualBox '目录中，我们可以使用vboxmanage获取端口转发规则的列表:</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="0da5" class="ip iq hh lo b fi ls lt l lu lv">vboxmanage showvminfo "&lt;VM_name&gt;"| find "Rule"</span></pre><p id="225e" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">默认情况下，不会定义任何端口转发规则。</p><p id="7b10" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">所以让我们创建一些规则。</p><p id="2ce4" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">“VBoxManage controlvm”命令将允许对端口转发规则进行运行时更改。</p><p id="01ec" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">我们需要添加为防火墙配置的端口。例如端口5000和8080。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="04f5" class="ip iq hh lo b fi ls lt l lu lv">&gt; VBoxManage controlvm "&lt;VM_name&gt;" natpf1 "http,tcp,,5000,,5000"<br/>&gt; VBoxManage controlvm "&lt;VM_name&gt;" natpf1 "http8080,tcp,,8080,,8080"</span></pre><p id="12a2" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">现在，要获得此特定虚拟机的所有端口转发规则的列表，请运行以下命令:</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="22af" class="ip iq hh lo b fi ls lt l lu lv">vboxmanage showvminfo "&lt;VM_name&gt;"| find "Rule"</span></pre><p id="3f46" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">清单应如下所示:</p><figure class="lj lk ll lm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mg"><img src="../Images/841e6ba8919a6319544d3c7a525c42ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TEjEnpaE1_RqILxa0TiGFQ.png"/></div></div></figure><p id="4de4" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">可以在Oracle VM VirtualBox管理器中查看相同的列表，因此选择“高级”下拉菜单。</p><figure class="lj lk ll lm fd ii er es paragraph-image"><div class="er es mh"><img src="../Images/ec49301e531f1c8752a426d052481d49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*nnQScINSsXsVYeUinCm7KA.png"/></div></figure><p id="937b" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">然后点击“端口转发”。</p><figure class="lj lk ll lm fd ii er es paragraph-image"><div class="er es mi"><img src="../Images/7ed1b8230743582718e3a34936e0518c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1336/format:webp/1*Nrs0VtIub7X7GXaSpYvlXA.png"/></div></figure><p id="bf4d" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">这些是被创造出来的规则。</p></div><div class="ab cl lb lc go ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ha hb hc hd he"><h2 id="4a45" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">测试连通性</h2><p id="f962" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh ha bi translated">我们将使用用Python Flask编码的应用程序。</p><p id="2ee6" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated"><strong class="jp hi">安装烧瓶</strong></p><p id="97f9" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">假设之前安装了Python，并创建了虚拟环境，然后按如下方式安装Flask:</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="0e92" class="ip iq hh lo b fi ls lt l lu lv">$ pip install Flask</span></pre><p id="bec7" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">安装的详细说明如下:</p><p id="719e" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">https://flask.palletsprojects.com/en/2.0.x/installation/<a class="ae li" href="https://flask.palletsprojects.com/en/2.0.x/installation/" rel="noopener ugc nofollow" target="_blank"/></p><p id="8009" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated"><strong class="jp hi">带烧瓶的快速入门</strong></p><p id="72b6" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated"><a class="ae li" href="https://flask.palletsprojects.com/en/2.0.x/quickstart/" rel="noopener ugc nofollow" target="_blank">https://flask.palletsprojects.com/en/2.0.x/quickstart/</a></p><p id="58e1" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">Flask提供了如下的最小应用:</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="7aa2" class="ip iq hh lo b fi ls lt l lu lv"><strong class="lo hi">from</strong> flask <strong class="lo hi">import</strong> Flask<br/><br/>app = Flask<strong class="lo hi">(</strong>__name__<strong class="lo hi">)</strong><br/><br/>@app.route<strong class="lo hi">(</strong>"/"<strong class="lo hi">)</strong><br/><strong class="lo hi">def</strong> hello_world<strong class="lo hi">():</strong><br/>    <strong class="lo hi">return</strong> "&lt;p&gt;Hello, World!&lt;/p&gt;"</span></pre><p id="8124" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">将应用程序保存为“test.py ”,然后正常运行Flask应用程序:</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="0cc0" class="ip iq hh lo b fi ls lt l lu lv">$ export FLASK_APP=test<br/>$ flask run</span></pre><figure class="lj lk ll lm fd ii er es paragraph-image"><div class="er es mj"><img src="../Images/f1c9f7df76204bd8cf9dfe8ede5ef35a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*u2GpC85i7ig5FLdMLiMsmQ.png"/></div></figure><p id="818e" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">现在，在虚拟机内部运行一个浏览器，以确认应用程序正在运行。</p><figure class="lj lk ll lm fd ii er es paragraph-image"><div class="er es mk"><img src="../Images/6d81c0842d295da1598c908dd6b4edb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*zxurqcTRVvMTDdfZs2ML2w.png"/></div></figure><p id="0cdd" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">现在，在主机内部运行浏览器，测试127.0.0.1:5000的连通性。</p><figure class="lj lk ll lm fd ii er es paragraph-image"><div class="ab fe cl ml"><img src="../Images/f4d852bfabcb6ef4a650f4316b622943.png" data-original-src="https://miro.medium.com/v2/format:webp/1*uVT3h60PM1F83BitGwqpuQ.png"/></div></figure><p id="2182" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">所以我们仍然没有从主机到虚拟机的连接。</p><p id="9edc" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">解决方案是将Flask应用程序作为外部可见的服务器运行:</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="51f1" class="ip iq hh lo b fi ls lt l lu lv">$ flask run --host=0.0.0.0</span></pre><p id="d3ab" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">这告诉你的操作系统监听所有公共IP。</p><figure class="lj lk ll lm fd ii er es paragraph-image"><div class="er es mm"><img src="../Images/3e99541ed21627c2d1580854c2a8b8f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*AW1_V2mrTzprAqDivvIKeA.png"/></div></figure><p id="a2b4" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">现在在主机内部再次运行浏览器127.0.0.1:5000。</p><figure class="lj lk ll lm fd ii er es paragraph-image"><div class="er es mn"><img src="../Images/3bd1ff5079b31533e4d136cb070706db.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*-f06ddXKTl1yyW2iXZOuhw.png"/></div></figure><p id="b954" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated">这是现在所期望的，证明我们已经通过本地端口转发连接到主机。</p></div><div class="ab cl lb lc go ld" role="separator"><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg lh"/><span class="le bw bk lf lg"/></div><div class="ha hb hc hd he"><p id="acb4" class="pw-post-body-paragraph jn jo hh jp b jq ki js jt ju kj jw jx ja kk jz ka je kl kc kd ji km kf kg kh ha bi translated"><em class="mc"> Paul Guerin是一名专注于Oracle数据库的国际顾问。此外，他还出席了一些世界领先的甲骨文会议，包括甲骨文2013年世界开放大会。自2015年以来，他的工作一直是IOUG最佳实践技巧小册子以及AUSOUG、Oracle Technology Network、Quest和Oracle Developers (Medium)出版物的主题。2019年，他被授予My Oracle支持社区最有价值贡献者。他是一名DBA OCP，并将继续参与Oracle ACE计划。</em></p></div></div>    
</body>
</html>