<html>
<head>
<title>Filtering Items in Oracle Commerce Cloud based on Inventory</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于库存筛选Oracle Commerce Cloud中的项目</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/filtering-items-in-oracle-commerce-cloud-based-on-inventory-c82c3c49d818?source=collection_archive---------5-----------------------#2019-05-31">https://medium.com/oracledevs/filtering-items-in-oracle-commerce-cloud-based-on-inventory-c82c3c49d818?source=collection_archive---------5-----------------------#2019-05-31</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="9a23" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">默认情况下，在Oracle Commerce Cloud中，所有具有SKU和价格的活动产品都被索引并由搜索返回。</p><p id="b9e2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然而，很多时候，一个站点希望只显示有库存的商品(或者没有缺货)。这是一个可以在搜索中配置的静态记录过滤器的例子。这种类型的过滤将在幕后进行，并保持在URL之外(这样客户就不能篡改URL来显示这些产品)。</p><p id="304b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">每个SKU都标有一个名为“sku.availabilityStatus”的字段。该字段的唯一值集(截至19B)仅为:</p><ul class=""><li id="8e02" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">库存内的</li><li id="8797" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">缺货</li></ul><h1 id="e272" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">总体步骤</h1><p id="fd62" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">在我们的示例中，我们将配置一个过滤器，只显示sku.availabilityStatus = INSTOCK的产品。为此，我们将:</p><ul class=""><li id="c4dd" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">GET/GS admin/v1/cloud/pages/Default/services/guided search</li><li id="23d3" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">修改@appFilterState部分中“recordFilters”的JSON</li><li id="39b4" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">PUT/GS admin/v1/cloud/pages/Default/services/guides search</li><li id="38d0" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">启动发布</li></ul><p id="5d39" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对/GS admin/v1/cloud/pages/Default/services/type ahead重复这些步骤</p><h1 id="92b5" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">修改appFilterState</h1><p id="cdf2" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">在我们对/GS admin/v1/cloud/pages/Default/services/guided search执行GET之后，我们可以看到一系列记录过滤器已经就绪。这是现成的过滤方式:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="b8d9" class="lc jr hh ky b fi ld le l lf lg">...<br/>"@appFilterState": {<br/>            "hiddenNavigationFilter": "${catalogDimensionValueId}",<br/>            "@type": "FilterState",<br/>            "recordFilters": [<br/>                "product.active:1",<br/>                "sku.active:1",<br/>                "product.catalogId:${catalogId}"<br/>            ],<br/>            "rollupKey": "sku.listingId"<br/>        },<br/>...</span></pre><p id="9b8f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">可以修改上述过滤器，但我们强烈建议您不要这样做，因为不支持对上述过滤器的更改。</p><p id="cc55" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于我们的库存过滤器，我们将更新如下:</p><pre class="kt ku kv kw fd kx ky kz la aw lb bi"><span id="5030" class="lc jr hh ky b fi ld le l lf lg">"@appFilterState": {<br/>            "hiddenNavigationFilter": "${catalogDimensionValueId}",<br/>            "@type": "FilterState",<br/>            "recordFilters": [<br/>                "product.active:1",<br/>                "sku.active:1",<br/>                "product.catalogId:${catalogId}",<br/>                <strong class="ky hi">"sku.availabilityStatus:INSTOCK"</strong></span><span id="5ae3" class="lc jr hh ky b fi lh le l lf lg">            ],<br/>            "rollupKey": "sku.listingId"<br/>        },</span></pre><h1 id="c765" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">发布更改</h1><p id="1dfd" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">对于修改后的JSON，使用PUT将其放回/GS admin/v1/cloud/pages/Default/services/guided search。更新/typeahead也是有意义的，这样你的完整搜索结果和typeahead结果就不会不匹配。</p><p id="c326" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">内容放入后，我们首先要验证它们是否正常工作。登录OCC管理，并查看您的预览店面。当您执行关键字搜索和在搜索驱动的页面上导航时，过滤应该已经就绪。</p><p id="bfec" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当您对更改的效果感到满意时，最容易做的事情就是对产品做一个小的更改(比如在一个长描述中添加一个空格)并调用发布。在发布结束时，内容更改(例如对搜索配置(如/pages)的更改)将被提升到实时店面。</p><h1 id="b8e1" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">一些注释和警告</h1><ul class=""><li id="d7de" class="jc jd hh ig b ih ko il kp ip li it lj ix lk jb jh ji jj jk bi translated">为什么这个滤镜不是开箱就开的？并非所有客户都使用Oracle商务云进行库存管理</li><li id="ecd8" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">如果您使用外部库存调用，则不能使用它进行过滤(因为外部值不会被搜索索引)</li><li id="8fce" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">收藏页面不是纯粹由搜索驱动的，这种过滤不会影响它们。</li></ul><p id="bdc4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您想添加其他静态过滤器，上面的模式会很有帮助。不过有几个关键点:</p><ul class=""><li id="54b4" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">sku.availabilityStatus字段已经存在。如果您对/GS admin/v1/cloud/attributes . merge . JSON执行GET，您会看到这个字段也为“isRecordFilterable = true”启用。</li><li id="2a6b" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">如果您定义了自定义属性并希望将它们用于过滤器，您还需要设置“isRecordFilterable”= true</li></ul><h1 id="9607" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">过滤器和URL</h1><p id="1132" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">只要您有一个静态过滤器，如sku.availabilityStatus，最好按照本指南中的描述进行配置。这个过滤器不会出现在URL中，因此购物者无法随意更改。</p><p id="ac9e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">可以向URL添加相同类型的过滤器。例如，可以通过在URL后面追加&amp; Nr = AND(SKU . availability status:in stock)来添加上述过滤器。缺点是它将是可见的，可以被篡改。</p></div></div>    
</body>
</html>