<html>
<head>
<title>Learning To Love Automated Testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">学会爱上自动化测试</h1>
<blockquote>原文：<a href="https://medium.com/capital-one-tech/automated-tests-that-saved-me-2d38b7cb265b?source=collection_archive---------6-----------------------#2019-02-13">https://medium.com/capital-one-tech/automated-tests-that-saved-me-2d38b7cb265b?source=collection_archive---------6-----------------------#2019-02-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="621b" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">我通往自动化测试启蒙之旅的3站</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/3f514dd683db9e003003081efabac122.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W9BMOwTNgP56pM5pFh79Jg.png"/></div></div></figure><p id="546b" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">网上有很多观点解释了自动化测试的好处:更好的质量，更快的发布，以及最终更快的开发。</p><p id="ab96" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">不幸的是，像任何技术一样，自动化测试有一个上升的成本——你需要学习工具和技能。在我职业生涯的早期，我被这些成本吓退了，我花了太长时间才真正感受到T2带来的好处。</p><p id="7e62" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">随着我对自动化测试了解的越来越多，我发现具体的例子比更一般、更抽象的好处更有帮助和启发性。所以，我将分享一些自动化测试的真实例子，这些例子为我节省了大量的时间和尴尬。:-)</p><h2 id="00ef" class="kf kg hh bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">1)发现基本设计问题</h2><p id="8df7" class="pw-post-body-paragraph ji jj hh jk b jl la ii jn jo lb il jq jr lc jt ju jv ld jx jy jz le kb kc kd ha bi translated">几年前，我实现了一些代码来解密来自服务器的一些数据。服务器端团队给了我一些示例加密数据，我开始编写基本单元测试来检查我的<code class="du lf lg lh li b">decrypt</code>实用程序是否工作正常。</p><pre class="ix iy iz ja fd lj li lk ll aw lm bi"><span id="3b65" class="kf kg hh li b fi ln lo l lp lq">@Test <br/>public void testDecrypt() {      <br/>  String decryptedData = decrypt(EXAMPLE_ENCRYPTED_DATA);     <br/>  assertThat("...43XabcGYvTwII=").isEqualTo(decryptedText); <br/>}</span></pre><p id="c9cd" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">几乎立刻我就遇到了一个奇怪的问题，测试失败了，尽管预期和实际的结果看起来是一样的。</p><pre class="ix iy iz ja fd lj li lk ll aw lm bi"><span id="2a42" class="kf kg hh li b fi ln lo l lp lq">Expected: ...43XabcGYvTwII=<br/>Actual:   ...43XabcGYvTwII=</span></pre><p id="6b6b" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">从Android Studio复制输出并粘贴到纯文本编辑器中，我能够看到一些意想不到的字符。</p><pre class="ix iy iz ja fd lj li lk ll aw lm bi"><span id="85ae" class="kf kg hh li b fi ln lo l lp lq">Expected: ...43XabcGYvTwII=<br/>Actual:   ...43XabcGYvTwII=����</span></pre><p id="aba0" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">我去和服务器端团队坐在一起，和他们一起看他们的代码。我们发现他们正在使用<a class="ae lr" href="https://en.wikipedia.org/wiki/Padding_%28cryptography%29#Zero_padding" rel="noopener ugc nofollow" target="_blank">零填充</a>来填充块。这是设计中的一个大错误，因为我们的有效载荷被允许包含零值。这意味着，如果我们的有效载荷以零结尾，那么这个零将被去掉，这将破坏我们的数据。</p><p id="92df" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">为了解决这个问题，我们更改为Java支持的标准填充方案之一(您可以在Java加密体系结构的<a class="ae lr" href="https://docs.oracle.com/javase/7/docs/technotes/guides/security/StandardNames.html#impl" rel="noopener ugc nofollow" target="_blank">密码</a>部分看到它们的列表)。</p><p id="3baa" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这个问题的根本原因是在一些代码是否是一个示例原型，或者它是否是一个应该交付给产品的准确规范上的误解。</p><p id="711d" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">iOS与这个服务器端组件的集成似乎工作得很好，因为Objective C实用程序(这是在2015年)会自动删除补零中的零。</p><p id="2254" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">我写的自动化测试帮助我们在这个特性投入生产之前找到了这个bug。这个问题每256次才会发生一次(任何时候有效载荷的最后一个字节都是零)，所以我怀疑我们可能没有注意到它…</p><p id="f91e" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><strong class="jk hi">要点</strong>:确保你为系统中的所有组件建立了基本的单元测试。如果你看到一些奇怪的东西，不要忽视它——背后可能隐藏着一个很大的设计问题！</p><h2 id="e4cc" class="kf kg hh bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">2)依赖性被破坏</h2><p id="c26a" class="pw-post-body-paragraph ji jj hh jk b jl la ii jn jo lb il jq jr lc jt ju jv ld jx jy jz le kb kc kd ha bi translated">在构建特性时，我们通常从针对我们所依赖的HTTP APIs编写集成测试开始。好处是:</p><ul class=""><li id="629f" class="ls lt hh jk b jl jm jo jp jr lu jv lv jz lw kd lx ly lz ma bi translated">在开发过程中尽可能早地排除任何主要问题。如果需要与其他团队一起安排变更，这一点尤其重要。</li><li id="6b90" class="ls lt hh jk b jl mb jo mc jr md jv me jz mf kd lx ly lz ma bi translated">为我们提供了一种快速检查服务是否启动并运行的方法。</li><li id="1102" class="ls lt hh jk b jl mb jo mc jr md jv me jz mf kd lx ly lz ma bi translated">提供了一个回归测试套件，我们可以用它来验证API更改是否有效。</li></ul><p id="f097" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">早在2015年，我就试图从<a class="ae lr" href="https://github.com/square/retrofit/releases/tag/parent-1.6.0" rel="noopener ugc nofollow" target="_blank">改进版1.6.0 </a>跳到1.9.0。我删除了版本号，然后运行了我的测试。令我惊讶的是，我失败了三次——这是我请求帮助的原始Slack消息:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mg"><img src="../Images/1444eab9bd4621fcc8be9aa18711e4d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LHlzJYWH9d5Lj5FLkJYOzg.png"/></div></div></figure><p id="3cfc" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">作者很快证实这是一个意外(<a class="ae lr" href="https://github.com/square/retrofit/issues/854" rel="noopener ugc nofollow" target="_blank">https://github.com/square/retrofit/issues/854</a>)，修复将在2.0.0版本中进行。他们随后从GitHub中移除了1.9.0版本，1.6.0仍然被标记为“最新版本”。retrieval是一个很棒的库，维护人员处理得很好。:-)</p><p id="fcbe" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">对我来说，关键的收获是<strong class="jk hi">我能够避免打开包含错误代码</strong>的拉请求。我避免了让糟糕的代码被审查、被合并到母版、被测试，甚至被交付到产品中。我不敢去想，要花多少时间才能诊断出一些由于第三方依赖行为而导致的边缘情况崩溃。</p><p id="eb2a" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">最近，类似的API集成测试拯救了我们两次:一个新版本的HTTP API发布了，我们的自动化测试立即揭示了新API已经破坏的多个边缘案例！🎉</p><p id="55e9" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><strong class="jk hi">要点</strong>:编写HTTP API集成测试——它们将帮助您尽早发现API问题，并在API关闭或出现问题时加快调试速度。</p><h2 id="9de1" class="kf kg hh bd kh ki kj kk kl km kn ko kp jr kq kr ks jv kt ku kv jz kw kx ky kz bi translated">3)防止功能问题</h2><p id="4b03" class="pw-post-body-paragraph ji jj hh jk b jl la ii jn jo lb il jq jr lc jt ju jv ld jx jy jz le kb kc kd ha bi translated">很多年前，我在做一个交互式语音应答系统(IVR)。如果你打电话给客户支持热线，得到一份又长又复杂的菜单，那么你就知道IVR是什么了。:-)</p><p id="19a6" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">主要的工程师有一个巨大的自动化测试套件，包括一些检查不同的时间表在正确的时间启动的测试。在本例中，我们预计当办公室在上午9点开门时，IVR消息会发生变化。</p><pre class="ix iy iz ja fd lj li lk ll aw lm bi"><span id="6a8a" class="kf kg hh li b fi ln lo l lp lq">testClosedOneMinuteBefore() {<br/>  assertEqual(convertTime("8:59am"), "sorry, we are closed")<br/>}</span><span id="ba1a" class="kf kg hh li b fi mh lo l lp lq">testOpenExactStartTime() {<br/>  assertEqual(convertTime("9:00am"), "welcome to ABC corp...")<br/>}</span><span id="5a83" class="kf kg hh li b fi mh lo l lp lq">testOpenOneMinuteAfter() {<br/>  assertEqual(convertTime("9:01am"), "welcome to ABC corp...")<br/>}</span></pre><p id="7f32" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">我做了一个巨大的重构，在这个过程中，我采用了一些类似这样的代码</p><pre class="ix iy iz ja fd lj li lk ll aw lm bi"><span id="5382" class="kf kg hh li b fi ln lo l lp lq">if (startTime &gt;= currentTime) {<br/>  // Offices are open<br/>} else {<br/>  // Offices are closed<br/>}</span></pre><p id="5d9a" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">我把<code class="du lf lg lh li b">if</code>测试颠倒过来</p><pre class="ix iy iz ja fd lj li lk ll aw lm bi"><span id="6725" class="kf kg hh li b fi ln lo l lp lq">if (startTime &lt;= currentTime) {<br/>  // Offices are closed<br/>} else {<br/>  // Offices are open<br/>}</span></pre><p id="2d7b" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">你能看出我做错了什么吗？</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/4c671738740728ae0e183205527f300d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*YZ8pAKaNTLmQ70qCakYsEg.gif"/></div></div></figure><p id="54e4" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这个问题是因为我忘记了我的基本计算机科学规则，即如何反转一个布尔条件。倒相<code class="du lf lg lh li b">&lt;=</code>应该给<code class="du lf lg lh li b">&gt;</code>，而不是<code class="du lf lg lh li b">&gt;=</code>。</p><p id="2c37" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">幸运的是，我一修改<code class="du lf lg lh li b">testOpenExactStartTime()</code>测试就失败了，诊断和修复超级简单。我不敢想我是否会在我的手动测试中发现时间表晚了1分钟…</p><p id="5bf7" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><strong class="jk hi">秘诀</strong>:使用自动化测试来帮助确保没有人会破坏你的代码！确保您的边缘案例得到了很好的测试，以及任何手动测试会很慢的东西。:-)</p><h1 id="2bdf" class="mi kg hh bd kh mj mk ml kl mm mn mo kp in mp io ks iq mq ir kv it mr iu ky ms bi translated">♥自动化测试</h1><p id="e285" class="pw-post-body-paragraph ji jj hh jk b jl la ii jn jo lb il jq jr lc jt ju jv ld jx jy jz le kb kc kd ha bi translated">希望这些例子有助于展示自动化测试的真实好处。一旦你学会了在你的平台上进行自动化测试的工具，你的开发速度和质量都会提高。依靠你的测试来保持你的代码库的稳定，这是令人难以置信的解放。</p><p id="8814" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">当我第一次开始开发移动应用程序时，我会有一个长达数周的代码冻结，直到一个主要版本发布，疯狂地修复在手动回归测试中发现的错误，然后在每个产品发布后的两天里紧张地观察崩溃率和分析。现在我不需要了。:-)</p><p id="95a6" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">我的团队正在招聘安卓开发者。如果你知道谁可能感兴趣，请给他们发送链接，并向他们介绍<a class="ae lr" href="https://www.linkedin.com/in/danielalanjarvis/" rel="noopener ugc nofollow" target="_blank"> me </a>！</p></div><div class="ab cl mt mu go mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ha hb hc hd he"><p id="77f8" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><em class="ke">披露声明:2019资本一。观点是作者个人的观点。除非本帖中另有说明，否则Capital One不隶属于所提及的任何公司，也不被这些公司认可。使用或展示的所有商标和其他知识产权是其各自所有者的财产。</em></p></div></div>    
</body>
</html>