<html>
<head>
<title>Migrating MediaStyle notifications to support Android O</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">迁移MediaStyle通知以支持Android O</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/migrating-mediastyle-notifications-to-support-android-o-29c7edeca9b7?source=collection_archive---------1-----------------------#2017-08-11">https://medium.com/androiddevelopers/migrating-mediastyle-notifications-to-support-android-o-29c7edeca9b7?source=collection_archive---------1-----------------------#2017-08-11</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="7336" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">让媒体风格通知为您服务</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/13363ac891ee9b854db08fc179d96583.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tnLgad0_ePYanfSAQ3F7pA.png"/></div></div></figure><h1 id="9171" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">介绍</h1><p id="7c12" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">如果您在API级别25或更低的平台上使用<code class="du kw kx ky kz b">MediaStyle</code>通知，本文将作为将这些通知迁移到Android O的迁移指南。<code class="du kw kx ky kz b">MediaStyle</code>通知通常由绑定和启动的服务使用，这些服务允许在后台播放音频。</p><p id="02b8" class="pw-post-body-paragraph ka kb hh kc b kd la ii kf kg lb il ki kj lc kl km kn ld kp kq kr le kt ku kv ha bi translated">Android O中有几个必须考虑的主要差异。</p><ol class=""><li id="2b35" class="lf lg hh kc b kd la kg lb kj lh kn li kr lj kv lk ll lm ln bi translated">后台服务现在必须用<code class="du kw kx ky kz b"><a class="ae lo" href="https://developer.android.com/preview/features/background.html#services" rel="noopener ugc nofollow" target="_blank">startForegroundService(Intent)</a></code>启动，然后必须在5秒内显示一个持续的通知。</li><li id="02d3" class="lf lg hh kc b kd lp kg lq kj lr kn ls kr lt kv lk ll lm ln bi translated">必须使用通知渠道来显示通知。</li></ol><p id="d8bf" class="pw-post-body-paragraph ka kb hh kc b kd la ii kf kg lb il ki kj lc kl km kn ld kp kq kr le kt ku kv ha bi translated">迁移到O需要几个简短的步骤，如下所示。</p><h1 id="ae48" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">步骤1-更改您的导入语句</h1><p id="7272" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">确保将下列行添加到您的导入语句中:</p><pre class="ix iy iz ja fd lu kz lv lw aw lx bi"><span id="5f05" class="ly jj hh kz b fi lz ma l mb mc">import android.support.v4.app.NotificationCompat;<br/>import android.support.v4.content.ContextCompat;<br/>import android.support.v4.media.app.NotificationCompat.MediaStyle;</span></pre><p id="2eca" class="pw-post-body-paragraph ka kb hh kc b kd la ii kf kg lb il ki kj lc kl km kn ld kp kq kr le kt ku kv ha bi translated">您可能有一个来自v7的import语句，但您不再需要:</p><pre class="ix iy iz ja fd lu kz lv lw aw lx bi"><span id="c6a9" class="ly jj hh kz b fi lz ma l mb mc">import android.support.v7.app.NotificationCompat;</span></pre><p id="a68d" class="pw-post-body-paragraph ka kb hh kc b kd la ii kf kg lb il ki kj lc kl km kn ld kp kq kr le kt ku kv ha bi translated">在你的<code class="du kw kx ky kz b">build.gradle</code>中，你现在只需要导入<code class="du kw kx ky kz b">media-compat</code>支持库。<code class="du kw kx ky kz b">media-compat</code>库是<code class="du kw kx ky kz b">MediaStyle</code>类所在的地方。<code class="du kw kx ky kz b">media-compat</code>库是<code class="du kw kx ky kz b">MediaStyle</code>类所在的地方。</p><pre class="ix iy iz ja fd lu kz lv lw aw lx bi"><span id="e228" class="ly jj hh kz b fi lz ma l mb mc">implementation ‘com.android.support:support-media-compat:26.+’</span></pre><p id="a05e" class="pw-post-body-paragraph ka kb hh kc b kd la ii kf kg lb il ki kj lc kl km kn ld kp kq kr le kt ku kv ha bi translated"><code class="du kw kx ky kz b">MediaStyle</code>在<code class="du kw kx ky kz b">android.support.v4.<strong class="kc hi">media</strong></code>包中，因为它现在是<code class="du kw kx ky kz b"><a class="ae lo" href="https://developer.android.com/topic/libraries/support-library/packages.html#v4-media-compat" rel="noopener ugc nofollow" target="_blank">media-compat</a></code>依赖的一部分。由于支持库模块中关注点的分离，它们不在<code class="du kw kx ky kz b">support-compat</code>库中。</p><h1 id="5a86" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">步骤2-对通道使用NotificationCompat</h1><p id="f3b3" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">为了在O中使用通知，您必须使用通知通道。v4支持库现在有一个用于创建通知构建器的新构造函数:</p><pre class="ix iy iz ja fd lu kz lv lw aw lx bi"><span id="dc76" class="ly jj hh kz b fi lz ma l mb mc">NotificationCompat.Builder notificationBuilder =<br/>        new NotificationCompat.Builder(mContext, CHANNEL_ID);</span></pre><p id="a012" class="pw-post-body-paragraph ka kb hh kc b kd la ii kf kg lb il ki kj lc kl km kn ld kp kq kr le kt ku kv ha bi translated">从支持库的26.0.0版起，旧的构造函数已被弃用，它将导致您的通知在定位到API 26时无法显示(因为当定位到API 26或更高版本时，所有通知都需要一个通道):</p><pre class="ix iy iz ja fd lu kz lv lw aw lx bi"><span id="9fde" class="ly jj hh kz b fi lz ma l mb mc">NotificationCompat.Builder notificationBuilder =<br/>        new NotificationCompat.Builder(mContext);</span></pre><p id="47d0" class="pw-post-body-paragraph ka kb hh kc b kd la ii kf kg lb il ki kj lc kl km kn ld kp kq kr le kt ku kv ha bi translated">为了更好地理解Android O中的频道，请在<a class="ae lo" href="https://developer.android.com/preview/features/notification-channels.html" rel="noopener ugc nofollow" target="_blank">developer.android.com</a>上阅读所有相关内容。Google Play Music对您希望收到的通知进行了精细控制。例如，如果您只关心与“回放”相关的通知，您可以启用这些通知并禁用其余的通知。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es md"><img src="../Images/8e909061af9bc524e735be1a6549d577.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*I8gqatqtqnPtzCZP."/></div></div></figure><p id="2e3c" class="pw-post-body-paragraph ka kb hh kc b kd la ii kf kg lb il ki kj lc kl km kn ld kp kq kr le kt ku kv ha bi translated"><code class="du kw kx ky kz b">NotificationCompat</code>类不会为你创建频道。您仍然需要自己创建一个<a class="ae lo" href="https://developer.android.com/preview/features/notification-channels.html#CreatingChannels" rel="noopener ugc nofollow" target="_blank">通道</a>。这里有一个Android O的例子。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="7fa9" class="pw-post-body-paragraph ka kb hh kc b kd la ii kf kg lb il ki kj lc kl km kn ld kp kq kr le kt ku kv ha bi translated">下面是用<code class="du kw kx ky kz b">NotificationCompat</code>创建一个<code class="du kw kx ky kz b">MediaStyle</code>通知的代码。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="me mf l"/></div></figure><h1 id="7e9b" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">步骤3-使用ContextCompat来启动ForegroundService()</h1><p id="9061" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">在Android O中，需要在后台运行的服务，如音乐播放服务，需要使用<code class="du kw kx ky kz b">Context.startForegroundService()</code>而不是<code class="du kw kx ky kz b">Context.startService()</code>来启动。为了做到这一点，如果你在O上，你可以使用自动为你做这件事的<code class="du kw kx ky kz b">ContextCompat</code>类，并且仍然在N和先前版本的Android上使用<code class="du kw kx ky kz b">startService(Intent)</code>。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="me mf l"/></div></figure><p id="6914" class="pw-post-body-paragraph ka kb hh kc b kd la ii kf kg lb il ki kj lc kl km kn ld kp kq kr le kt ku kv ha bi translated">就是这样！这是三个简单的步骤，让你迁移你的Android O <code class="du kw kx ky kz b">MediaStyle</code>之前的通知，这些通知与后台服务相关联。</p><p id="9d50" class="pw-post-body-paragraph ka kb hh kc b kd la ii kf kg lb il ki kj lc kl km kn ld kp kq kr le kt ku kv ha bi translated">有关<code class="du kw kx ky kz b">MediaStyle</code>变更的更多信息，请阅读支持库的<a class="ae lo" href="https://developer.android.com/topic/libraries/support-library/revisions.html#26-0-0" rel="noopener ugc nofollow" target="_blank">变更日志</a>。</p><h1 id="a6e8" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">Android媒体资源</h1><ul class=""><li id="b6fe" class="lf lg hh kc b kd ke kg kh kj mg kn mh kr mi kv mj ll lm ln bi translated"><a class="ae lo" rel="noopener" href="/google-developers/understanding-mediasession-part-1-3-e4d2725f18e4">了解媒体会话</a></li><li id="32ea" class="lf lg hh kc b kd lp kg lq kj lr kn ls kr lt kv mj ll lm ln bi translated"><a class="ae lo" rel="noopener" href="/google-developers/building-a-simple-audio-app-in-android-part-1-3-c14d1a66e0f1">使用MediaPlayer构建简单的音频播放应用</a></li><li id="cc0e" class="lf lg hh kc b kd lp kg lq kj lr kn ls kr lt kv mj ll lm ln bi translated"><a class="ae lo" href="https://developer.android.com/guide/topics/media-apps/media-apps-overview.html" rel="noopener ugc nofollow" target="_blank"> Android媒体API指南—媒体应用概述</a></li><li id="3fea" class="lf lg hh kc b kd lp kg lq kj lr kn ls kr lt kv mj ll lm ln bi translated"><a class="ae lo" href="https://developer.android.com/guide/topics/media-apps/working-with-a-media-session.html" rel="noopener ugc nofollow" target="_blank"> Android媒体应用编程接口指南—使用媒体会话</a></li></ul></div></div>    
</body>
</html>