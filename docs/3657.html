<html>
<head>
<title>Declarative Services — From Felix SCR to OSGi</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">声明式服务——从菲利克斯SCR到OSGi</h1>
<blockquote>原文：<a href="https://medium.com/globant/declarative-services-from-felix-scr-to-osgi-4770509f1965?source=collection_archive---------0-----------------------#2021-04-20">https://medium.com/globant/declarative-services-from-felix-scr-to-osgi-4770509f1965?source=collection_archive---------0-----------------------#2021-04-20</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/f167db042e0b235cbbdb4008f7f1161d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*x1ioJc8WR8WHkNUHt_ED1g.jpeg"/></div></div></figure><h1 id="a381" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated"><strong class="ak">案情</strong></h1><p id="28ce" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">到目前为止，任何从头开始的AEM项目都使用Apache Felix的<em class="kl">服务组件运行时</em> (SCR)注释在后端捆绑包上实现OSGi声明式服务。然而，在AEM 6.5中，情况不再是这样了，因为最新的Maven原型生成的项目在它们的包中使用了标准的OSGi v6声明性服务注释。</p><p id="bd13" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">那么，如果一个客户要求迁移到AEM 6.5，一个预先存在的为AEM 6.3甚至6.2编写的项目的Java代码库呢？本文将尝试描述这样做的一系列必要步骤。</p><h1 id="9487" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated"><strong class="ak">流程</strong></h1><h2 id="ef6e" class="kr iq hh bd ir ks kt ku iv kv kw kx iz jy ky kz jd kc la lb jh kg lc ld jl le bi translated"><strong class="ak">改变POMs </strong></h2><p id="2247" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">我们要做的第一件事是在父模块和核心模块的POM中做一些改变。让我们从删除Maven SCR插件开始，因为这个插件不会处理OSGi版本6的注释:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="4a58" class="kr iq hh lk b fi lo lp l lq lr">&lt;plugin&gt;<br/>  &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;<br/>  &lt;artifactId&gt;maven-bundle-plugin&lt;/artifactId&gt;<br/>  &lt;version&gt;4.2.1&lt;/version&gt;<br/>  &lt;extensions&gt;true&lt;/extensions&gt;</span><span id="8183" class="kr iq hh lk b fi ls lp l lq lr">  &lt;configuration&gt;<br/>    &lt;instructions&gt;<br/>      &lt;Embed-Dependency&gt;*;scope=compile|runtime&lt;/Embed-Dependency&gt;<br/>      &lt;Embed-Directory&gt;OSGI-INF/lib&lt;/Embed-Directory&gt;<br/>      &lt;Embed-Transitive&gt;true&lt;/Embed-Transitive&gt;<br/>    &lt;/instructions&gt;<br/>  &lt;/configuration&gt;</span><span id="021a" class="kr iq hh lk b fi ls lp l lq lr">&lt;/plugin&gt;</span></pre><p id="d166" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">然后我们将把Maven Bundle插件版本升级到4.2.0，它能够处理OSGi注释。在核心捆绑包模块POM中有一个额外的更改，即在捆绑包插件中添加以下配置:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="12cc" class="kr iq hh lk b fi lo lp l lq lr">&lt;plugin&gt;</span><span id="93f6" class="kr iq hh lk b fi ls lp l lq lr">  &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;<br/>  &lt;artifactId&gt;maven-bundle-plugin&lt;/artifactId&gt;<br/>  &lt;extensions&gt;true&lt;/extensions&gt;<br/>  &lt;executions&gt;<br/>    &lt;execution&gt;<br/>      &lt;id&gt;generate-scr-metadata-for-unittests&lt;/id&gt;<br/>      &lt;goals&gt;<br/>        &lt;goal&gt;manifest&lt;/goal&gt;<br/>      &lt;/goals&gt;<br/>      &lt;phase&gt;process-classes&lt;/phase&gt;<br/>      &lt;configuration&gt;<br/>        &lt;exportScr&gt;true&lt;/exportScr&gt;<br/>        &lt;instructions&gt;<br/>          &lt;_dsannotations&gt;*&lt;/_dsannotations&gt;<br/>          &lt;_metatypeannotations&gt;*&lt;/_metatypeannotations&gt;<br/>        &lt;/instructions&gt;<br/>      &lt;/configuration&gt;<br/>    &lt;/execution&gt;<br/>  &lt;/executions&gt;<br/>  &lt;configuration&gt;<br/>    &lt;supportIncrementalBuild&gt;true&lt;/supportIncrementalBuild&gt;<br/>    &lt;exportScr&gt;true&lt;/exportScr&gt;<br/>    &lt;instructions&gt;<br/>      &lt;Embed-Dependency&gt;*;scope=compile &lt;/Embed-Dependency&gt;<br/>      &lt;Embed-Transitive&gt;true&lt;/Embed-Transitive&gt;<br/>      &lt;Import-Package&gt;<br/>        !com.sun.jdi,<br/>        !com.sun.jdi.connect,<br/>        !com.sun.jdi.event,<br/>        !com.sun.jdi.request,<br/>        !sun.misc,<br/>        !sun.rmi.rmic,<br/>        !sun.tools.javac,<br/>        !com.ibm.security.krb5.internal,<br/>        !sun.security.krb5,<br/>        org.apache.sling.jcr.resource.api;version=”1.0.0",<br/>        *<br/>      &lt;/Import-Package&gt;<br/>      &lt;Export-Package&gt;<br/>        my.app.exported.package,<br/>        my.app.other.exported.package<br/>      &lt;/Export-Package&gt;<br/>      &lt;Sling-Model-Packages&gt;<br/>        my.app.model<br/>      &lt;/Sling-Model-Packages&gt;<br/>      &lt;Bundle-SymbolicName&gt;<br/>        ${project.artifactId}<br/>      &lt;/Bundle-SymbolicName&gt;<br/>    &lt;/instructions&gt;<br/>  &lt;/configuration&gt;<br/>&lt;/plugin&gt;</span></pre><p id="aed1" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">改变POM的最后一步是用OSGi v6替代旧的Felix SCR依赖关系:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="0779" class="kr iq hh lk b fi lo lp l lq lr"> &lt;dependency&gt;<br/>   &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;<br/>   &lt;artifactId&gt;org.apache.felix.scr&lt;/artifactId&gt;<br/>   &lt;version&gt;1.6.0&lt;/version&gt;<br/>   &lt;scope&gt;provided&lt;/scope&gt;<br/> &lt;/dependency&gt;<br/> &lt;dependency&gt;<br/>   &lt;groupId&gt;org.apache.felix&lt;/groupId&gt;<br/>   &lt;artifactId&gt;org.apache.felix.scr.annotations&lt;/artifactId&gt;<br/>   &lt;version&gt;1.9.6&lt;/version&gt;<br/>   &lt;scope&gt;provided&lt;/scope&gt;<br/> &lt;/dependency&gt;<br/> &lt;dependency&gt;<br/>   &lt;groupId&gt;org.osgi&lt;/groupId&gt;<br/>   &lt;artifactId&gt;org.osgi.service.component.annotations&lt;/artifactId&gt;<br/>   &lt;version&gt;1.4.0&lt;/version&gt;<br/>   &lt;scope&gt;provided&lt;/scope&gt;<br/> &lt;/dependency&gt;<br/> &lt;dependency&gt;<br/>   &lt;groupId&gt;org.osgi&lt;/groupId&gt;<br/>   &lt;artifactId&gt;org.osgi.annotation.versioning&lt;/artifactId&gt;<br/>   &lt;version&gt;1.1.0&lt;/version&gt;<br/>   &lt;scope&gt;provided&lt;/scope&gt;<br/> &lt;/dependency&gt;<br/> &lt;dependency&gt;<br/>   &lt;groupId&gt;org.osgi&lt;/groupId&gt;<br/>   &lt;artifactId&gt;org.osgi.annotation.bundle&lt;/artifactId&gt;<br/>   &lt;version&gt;1.0.0&lt;/version&gt;<br/>   &lt;scope&gt;provided&lt;/scope&gt;<br/> &lt;/dependency&gt;<br/> &lt;dependency&gt;<br/>   &lt;groupId&gt;org.osgi&lt;/groupId&gt;<br/>   &lt;artifactId&gt;org.osgi.core&lt;/artifactId&gt;<br/>   &lt;version&gt;6.0.0&lt;/version&gt;<br/>   &lt;scope&gt;provided&lt;/scope&gt;<br/> &lt;/dependency&gt;<br/> &lt;! — New OSG dependencies for SCR --&gt; <br/> &lt;dependency&gt;<br/>   &lt;groupId&gt;org.osgi&lt;/groupId&gt;<br/>   &lt;artifactId&gt;org.osgi.service.metatype.annotations&lt;/artifactId&gt;<br/>   &lt;version&gt;1.4.0&lt;/version&gt;<br/>   &lt;scope&gt;provided&lt;/scope&gt;<br/> &lt;/dependency&gt;<br/> &lt;dependency&gt;<br/>   &lt;groupId&gt;org.osgi&lt;/groupId&gt;<br/>   &lt;artifactId&gt;org.osgi.service.component&lt;/artifactId&gt;<br/>   &lt;version&gt;1.4.0&lt;/version&gt;<br/>   &lt;scope&gt;provided&lt;/scope&gt;<br/> &lt;/dependency&gt;<br/> &lt;dependency&gt;<br/>   &lt;groupId&gt;org.osgi&lt;/groupId&gt;<br/>   &lt;artifactId&gt;org.osgi.service.cm&lt;/artifactId&gt;<br/>   &lt;version&gt;1.6.0&lt;/version&gt;<br/>   &lt;scope&gt;provided&lt;/scope&gt;<br/> &lt;/dependency&gt;<br/> &lt;dependency&gt;<br/>   &lt;groupId&gt;org.osgi&lt;/groupId&gt;<br/>   &lt;artifactId&gt;org.osgi.service.event&lt;/artifactId&gt;<br/>   &lt;version&gt;1.3.1&lt;/version&gt;<br/>   &lt;scope&gt;provided&lt;/scope&gt;<br/> &lt;/dependency&gt;<br/> &lt;dependency&gt;<br/>   &lt;groupId&gt;org.osgi&lt;/groupId&gt;<br/>   &lt;artifactId&gt;org.osgi.service.log&lt;/artifactId&gt;<br/>   &lt;version&gt;1.4.0&lt;/version&gt;<br/>   &lt;scope&gt;provided&lt;/scope&gt;<br/> &lt;/dependency&gt;<br/> &lt;dependency&gt;<br/>   &lt;groupId&gt;org.osgi&lt;/groupId&gt;<br/>   &lt;artifactId&gt;org.osgi.resource&lt;/artifactId&gt;<br/>   &lt;version&gt;1.0.0&lt;/version&gt;<br/>   &lt;scope&gt;provided&lt;/scope&gt;<br/> &lt;/dependency&gt;<br/> &lt;dependency&gt;<br/>   &lt;groupId&gt;org.osgi&lt;/groupId&gt;<br/>   &lt;artifactId&gt;org.osgi.framework&lt;/artifactId&gt;<br/>   &lt;version&gt;1.9.0&lt;/version&gt;<br/>   &lt;scope&gt;provided&lt;/scope&gt;<br/> &lt;/dependency&gt;</span></pre><p id="17cd" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated"><strong class="jp hi">注意:</strong>Felix SCR依赖项的删除应该在本文描述的整个过程的最后<em class="kl">有效地完成。</em></p><h2 id="ea5e" class="kr iq hh bd ir ks kt ku iv kv kw kx iz jy ky kz jd kc la lb jh kg lc ld jl le bi translated"><strong class="ak">改变注释</strong></h2><p id="1479" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">我们的下一步是用新的OSGi v6标准注释替换旧的Apache Felix SCR注释。在部署我们的后端之前，这种改变必须在整个代码上一次完成，因此建议在您的代码存储库上切出一个单独的分支，并从这个分支切出“阶段”分支，以便您可以在许多开发人员之间并行工作，或者简单地改变您的源代码的减少的子集，以减轻代码审查。</p><p id="8ef0" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">下面是注释替换的一系列不同情况。这些案例将使用代码片段以“前后”的方式进行描述。</p><p id="d7ea" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated"><strong class="jp hi">组件定义</strong></p><p id="4cd8" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated"><strong class="jp hi">菲利克斯SCR: </strong></p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="656c" class="kr iq hh lk b fi lo lp l lq lr">… <br/> import org.apache.felix.scr.annotations.Component;<br/> import org.apache.felix.scr.annotations.Service;<br/>…<br/>…<br/>@Component(metatype = true,immediate = true,<br/>           label = “MyServiceImpl”, description = “My Service”) @Service(MyService.class)<br/>public class MyServiceImpl implements MyService {<br/> …<br/> …<br/>}</span></pre><p id="e3eb" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated"><strong class="jp hi"> OSGi v6: </strong></p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="2875" class="kr iq hh lk b fi lo lp l lq lr">…<br/>import org.osgi.service.component.annotations.Component; <br/>import org.osgi.service.component.propertytypes.ServiceDescription;<br/>…<br/> <br/>…<br/>@Component(service = MyService.class, immediate = true) @ServiceDescription(“My Service”)<br/>public class MyServiceImpl implements MyService {<br/> …<br/> …<br/>}</span></pre><p id="7d23" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">请注意:</p><ol class=""><li id="3956" class="lt lu hh jp b jq km ju kn jy lv kc lw kg lx kk ly lz ma mb bi translated">在<strong class="jp hi">@组件</strong>注释中，<strong class="jp hi">@服务</strong>注释被替换为服务属性。</li><li id="52f7" class="lt lu hh jp b jq mc ju md jy me kc mf kg mg kk ly lz ma mb bi translated">属性<strong class="jp hi"> <em class="kl">元类型</em> </strong>和<strong class="jp hi"> <em class="kl">标签</em> </strong>不见了，而属性<strong class="jp hi"> <em class="kl">描述</em> </strong> <em class="kl"> </em>被一个<strong class="jp hi"> @ServiceDescription </strong>注释代替</li></ol><p id="9215" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated"><strong class="jp hi">参考文献</strong></p><p id="662c" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">用于将其他组件注入我们的组件的<strong class="jp hi"> @Reference </strong>注释是一个简单的替换，您只需替换imports:</p><p id="d45d" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated"><strong class="jp hi">菲利克斯SCR: </strong></p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="df15" class="kr iq hh lk b fi lo lp l lq lr">import org.apache.felix.scr.annotations.Reference;</span></pre><p id="2312" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated"><strong class="jp hi"> OSGi v6: </strong></p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="1f1c" class="kr iq hh lk b fi lo lp l lq lr">import org.osgi.service.component.annotations.Reference;</span></pre><p id="ce8c" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated"><strong class="jp hi">激活/去激活/属性</strong></p><p id="2c7b" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">这里我们既有容易的部分也有困难的部分。最简单的部分是替换<strong class="jp hi">@激活</strong>/<strong class="jp hi">@去激活</strong>注释，这和使用<strong class="jp hi">@引用</strong>注释一样简单(<em class="kl">见上面的</em>)。</p><p id="d424" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated"><strong class="jp hi">菲利克斯SCR: </strong></p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="5be6" class="kr iq hh lk b fi lo lp l lq lr">import org.apache.felix.scr.annotations.Activate;<br/>import org.apache.felix.scr.annotations.Deactivate;</span></pre><p id="c1e1" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated"><strong class="jp hi"> OSGi v6: </strong></p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="e6de" class="kr iq hh lk b fi lo lp l lq lr">import org.osgi.service.component.annotations.Activate;<br/>import org.osgi.service.component.annotations.Deactivate;</span></pre><p id="3369" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">现在到了困难的部分:如果我们的组件具有可以使用AEM的Web控制台编辑的配置属性，它们通常会驻留在一个XML文件中，如下所示:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="65b0" class="kr iq hh lk b fi lo lp l lq lr">&lt;?xml version=”1.0" encoding=”UTF-8"?&gt;<br/>&lt;jcr:root xmlns:sling=”http://sling.apache.org/jcr/sling/1.0"<br/>          xmlns:jcr=”http://www.jcp.org/jcr/1.0"<br/>          jcr:primaryType=”sling:OsgiConfig”<br/>  batch.size=”{Integer}0"<br/>/&gt;</span></pre><p id="999f" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">通常，我们的组件使用<strong class="jp hi"> @Property </strong>注释定义属性数据，然后在激活方法中读取它们。使用新的OSGi注释将需要更多的编码，如我们之前/之后的代码片段所示:</p><p id="6c1b" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated"><strong class="jp hi">菲利克斯SCR: </strong></p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="69a4" class="kr iq hh lk b fi lo lp l lq lr">…<br/>…<br/>@Property(<br/>  label = “Batch size”, intValue = 30,<br/>  description = “Size of the batch to process each time”<br/>)<br/>public static final String BATCH_SIZE = “batch.size”; …</span><span id="4434" class="kr iq hh lk b fi ls lp l lq lr">private int batchSize<br/>…<br/>…</span><span id="10c1" class="kr iq hh lk b fi ls lp l lq lr">@Activate<br/>public void onActivate(ComponentContext context) {<br/> …<br/> this.batchSize =<br/>   PropertiesUtil.toInteger(props.get(BATCH_SIZE), 30));<br/> …<br/>}<br/></span></pre><p id="799a" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated"><strong class="jp hi"> OSGi v6: </strong></p><p id="acb0" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">1)配置类别:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="0b53" class="kr iq hh lk b fi lo lp l lq lr">… <br/>import org.osgi.service.metatype.annotations.AttributeDefinition;<br/>import org.osgi.service.metatype.annotations.AttributeType;<br/>import org.osgi.service.metatype.annotations.ObjectClassDefinition;<br/>…<br/>… <br/>@ObjectClassDefinition(name = “My Service configuration”) <br/>public @interface MyServiceConfigProperties {<br/> …</span><span id="6ced" class="kr iq hh lk b fi ls lp l lq lr"> @AttributeDefinition(<br/>   name = “Batch Size”,<br/>   description = “Batch size to process at a time”,<br/>   type = AttributeType.INTEGER<br/> )<br/> int batch_size() default 30;<br/> …<br/>}</span></pre><p id="3b6f" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">2)组件的类别:</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="505e" class="kr iq hh lk b fi lo lp l lq lr">…<br/>import org.osgi.service.metatype.annotations.Designate;<br/>…</span><span id="cd6e" class="kr iq hh lk b fi ls lp l lq lr">@Component(service = MyService.class, immediate = true) @ServiceDescription(“My Service”)<br/>@Designate(ocd = MyServiceConfigProperties.class)<br/>public class MyServiceImpl implements MyService {<br/>  …<br/>  private int batchSize<br/>  …</span><span id="7641" class="kr iq hh lk b fi ls lp l lq lr">  @Activate<br/>  public void onActivate(MyServiceConfigProperties config) {<br/>    this.batchSize = config.batch_size();<br/>  }<br/>  …<br/>}</span></pre><p id="858b" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">记下属性的特定名称(带“_”分隔符)；该分隔符被解释为点(“.”)在XML文件中。</p><p id="b9e9" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated"><strong class="jp hi">小服务程序</strong></p><p id="5f85" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">列表中的最后一项:更改Servlets(如果有的话)。</p><p id="349a" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated"><strong class="jp hi">菲利克斯SCR: </strong></p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="6727" class="kr iq hh lk b fi lo lp l lq lr">… <br/>import org.apache.felix.scr.annotations.Service;<br/>import org.apache.felix.scr.annotations.sling.SlingServlet;<br/>…<br/>…<br/>@Service(value = Servlet.class)<br/>@SlingServlet(<br/>  description = “My ACME Servlet — ACME-related endpoint”,<br/>  paths = { “/bin/acme/my-servlet” },<br/>  methods = “POST”,<br/>  metatype = true<br/>)<br/>public class MyServlet extends SlingAllMethodsServlet {<br/> …<br/> …<br/>}</span></pre><p id="7a9d" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated"><strong class="jp hi"> OSGi v6: </strong></p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="7848" class="kr iq hh lk b fi lo lp l lq lr">… <br/>import org.osgi.service.component.annotations.Component;<br/>…<br/>…<br/>@Component(<br/>  service = Servlet.class,<br/>  property = {<br/>    SLING_SERVLET_PATHS + “=/bin/acme/my-servlet”,<br/>    SLING_SERVLET_METHODS + “=” + METHOD_POST<br/>  }<br/>)<br/>@ServiceDescription(“My ACME Servlet — ACME-related endpoint”) public class MyServlet extends SlingAllMethodsServlet {<br/> …<br/> …<br/>}</span></pre><p id="974e" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">这里主要要注意的是，<strong class="jp hi"> @SlingServlet </strong>注释没了；<strong class="jp hi"> @Component </strong>批注通过指定<strong class="jp hi"> <em class="kl">路径</em> </strong>、<strong class="jp hi"> <em class="kl">方法</em> </strong>、<strong class="jp hi"> <em class="kl">资源类型</em> </strong>等暴露的接口和数据来替代其功能。在它的属性数组上。</p><h1 id="b019" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated"><strong class="ak">结论</strong></h1><p id="24ba" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">在本文中，我们尽可能简洁地介绍了迁移AEM应用程序包中Java代码上使用的注释的过程。</p><p id="2534" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">请记住，根据您的应用程序的BE逻辑的大小，这可能是一个漫长的过程，并且必须在部署之前立即完成，因为两个注释处理插件(Felix SCR插件和Maven Bundle插件4.2.0+)不能共存。</p></div></div>    
</body>
</html>