<html>
<head>
<title>Android Data Binding Library — from Observable Fields to LiveData in two steps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android数据绑定库——两步从可观察字段到LiveData</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/android-data-binding-library-from-observable-fields-to-livedata-in-two-steps-690a384218f2?source=collection_archive---------1-----------------------#2019-03-25">https://medium.com/androiddevelopers/android-data-binding-library-from-observable-fields-to-livedata-in-two-steps-690a384218f2?source=collection_archive---------1-----------------------#2019-03-25</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/e1b4e2069f5d4909e74f2789a36b54c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QhbnhjTMT9gTIP36Lo7-mQ.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Illustration by <a class="ae it" href="https://twitter.com/vpoltrack" rel="noopener ugc nofollow" target="_blank">Virginia Poltrack</a></figcaption></figure><p id="e27c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">数据绑定最重要的特性之一就是<a class="ae it" href="https://developer.android.com/topic/libraries/data-binding/observability" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hi">可观察性</strong> </a>。它允许您绑定数据和UI元素，这样当数据改变时，相关的元素就会在屏幕上更新。</p><p id="2b6f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">默认情况下，普通原语和字符串是<strong class="iw hi">不<em class="js">可观察的</em>，因此，如果您在数据绑定布局中使用它们，它们的值将在创建绑定时使用，但对它们的后续更改将被忽略。</strong></p><p id="be2a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了使对象可观察，我们在<a class="ae it" href="https://developer.android.com/topic/libraries/data-binding/" rel="noopener ugc nofollow" target="_blank">数据绑定库</a>中包含了一系列可观察的类:<code class="du jt ju jv jw b">ObservableBoolean</code>、<code class="du jt ju jv jw b">ObservableInt</code>、<code class="du jt ju jv jw b">ObservableDouble</code> …以及泛型<code class="du jt ju jv jw b">ObservableField&lt;T&gt;</code>。从现在起，我们将这些<em class="js">可观测场称为</em>。</p><p id="61e2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">若干年后，作为第一波<a class="ae it" href="https://developer.android.com/topic/libraries/architecture" rel="noopener ugc nofollow" target="_blank">架构组件</a>的一部分，我们发布了<a class="ae it" href="https://developer.android.com/topic/libraries/architecture/livedata" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hi"> LiveData </strong> </a>，这是<em class="js">另一个</em>可观察的。它显然是与数据绑定兼容的候选者，所以我们添加了这个功能。</p><p id="c4d0" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">LiveData是生命周期感知的，但这对于可观察字段来说并不是一个巨大的优势，因为数据绑定已经检查了视图何时是活动的。但是，<strong class="iw hi"> LiveData支持</strong> <a class="ae it" href="https://developer.android.com/reference/android/arch/lifecycle/Transformations" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hi">变换</strong> </a> <strong class="iw hi">，很多架构组件，像</strong> <a class="ae it" href="https://developer.android.com/topic/libraries/architecture/room" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hi">房间</strong> </a> <strong class="iw hi">和</strong> <a class="ae it" href="https://developer.android.com/reference/androidx/work/WorkManager" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hi">工作管理器</strong> </a> <strong class="iw hi">，支持LiveData </strong>。</p><p id="5107" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">由于这些原因，建议迁移到LiveData。你只需要两个简单的步骤就可以做到。</strong></p><h1 id="d2dc" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">步骤1:用LiveData替换可观察字段</h1><p id="783f" class="pw-post-body-paragraph iu iv hh iw b ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn kz jp jq jr ha bi translated">如果您在数据绑定布局中直接使用可观察字段，只需用<code class="du jt ju jv jw b">LiveData&lt;<em class="js">Something&gt;</em></code>替换<code class="du jt ju jv jw b">Observable<em class="js">Something</em></code>(或<code class="du jt ju jv jw b">ObservableField&lt;<em class="js">Something&gt;</em></code>)。</p><p id="5fa7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">之前:</p><figure class="la lb lc ld fd ii"><div class="bz dy l di"><div class="le lf l"/></div></figure><blockquote class="lg lh li"><p id="dfce" class="iu iv js iw b ix iy iz ja jb jc jd je lj jg jh ji lk jk jl jm ll jo jp jq jr ha bi translated"><strong class="iw hi">记住</strong> <code class="du jt ju jv jw b"><strong class="iw hi"><em class="hh">%lt;</em></strong></code> <strong class="iw hi">不是错别字。您必须对XML布局中的</strong> <code class="du jt ju jv jw b"><strong class="iw hi"><em class="hh">&lt;</em></strong></code> <strong class="iw hi">字符进行转义。</strong></p></blockquote><p id="4766" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">之后:</p><figure class="la lb lc ld fd ii"><div class="bz dy l di"><div class="le lf l"/></div></figure><p id="3b72" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">或者，如果你从一个<a class="ae it" href="https://developer.android.com/topic/libraries/architecture/viewmodel" rel="noopener ugc nofollow" target="_blank">视图模型</a>(首选方法)或者一个演示者或者控制器中展示可观察的事物，你不需要改变你的布局。只需在ViewModel中将那些<code class="du jt ju jv jw b">ObservableField</code>替换为<code class="du jt ju jv jw b">LiveData</code>。</p><p id="86a6" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">之前:</p><figure class="la lb lc ld fd ii"><div class="bz dy l di"><div class="le lf l"/></div></figure><p id="db30" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">之后:</p><figure class="la lb lc ld fd ii"><div class="bz dy l di"><div class="le lf l"/></div></figure><h1 id="6707" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">步骤2 —设置LiveData的生命周期所有者</h1><p id="75ad" class="pw-post-body-paragraph iu iv hh iw b ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn kz jp jq jr ha bi translated">绑定类有一个名为<code class="du jt ju jv jw b">setLifecycleOwner</code>的方法，当从数据绑定布局中观察LiveData时，必须调用这个方法。</p><p id="e033" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">之前:</p><figure class="la lb lc ld fd ii"><div class="bz dy l di"><div class="le lf l"/></div></figure><p id="365e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">之后:</p><figure class="la lb lc ld fd ii"><div class="bz dy l di"><div class="le lf l"/></div></figure><blockquote class="lg lh li"><p id="be85" class="iu iv js iw b ix iy iz ja jb jc jd je lj jg jh ji lk jk jl jm ll jo jp jq jr ha bi translated"><strong class="iw hi">注意:如果你正在为一个片段设置内容，建议使用</strong> <code class="du jt ju jv jw b"><strong class="iw hi">fragment.viewLifecycleOwner</strong></code> <strong class="iw hi">(而不是片段的生命周期)来处理潜在的分离片段。</strong></p></blockquote></div><div class="ab cl lm ln go lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ha hb hc hd he"><p id="caa0" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，您可以通过<a class="ae it" href="https://developer.android.com/reference/android/arch/lifecycle/Transformations" rel="noopener ugc nofollow" target="_blank">转换</a>和<a class="ae it" href="https://developer.android.com/reference/android/arch/lifecycle/MediatorLiveData" rel="noopener ugc nofollow" target="_blank"> MediatorLiveData </a>来使用您的<a class="ae it" href="https://developer.android.com/topic/libraries/architecture/livedata" rel="noopener ugc nofollow" target="_blank"> LiveData </a>对象。如果你不熟悉这些功能，请查看来自Android Dev Summit 2018 的这个<a class="ae it" href="https://www.youtube.com/watch?v=2rO4r-JOQtA" rel="noopener ugc nofollow" target="_blank">记录的“用LiveData找乐子”。</a></p><figure class="la lb lc ld fd ii"><div class="bz dy l di"><div class="lt lf l"/></div></figure></div></div>    
</body>
</html>