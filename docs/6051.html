<html>
<head>
<title>Under the hood: Teletraan deploy system</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">引擎盖下:Teletraan部署系统</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/under-the-hood-teletraan-deploy-system-1e5caa774a63?source=collection_archive---------0-----------------------#2015-05-15">https://medium.com/pinterest-engineering/under-the-hood-teletraan-deploy-system-1e5caa774a63?source=collection_archive---------0-----------------------#2015-05-15</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="3036" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">基础设施Pinterest工程主管宋宝刚</p><p id="22b6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在开发人员最担心的事情中，部署是最重要的。部署通常是新的代码变更第一次在生产环境中运行。一个可靠和简单的部署工具是任何开发人员的武器库的重要组成部分。</p><p id="d2ac" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">部署系统应该支持以下功能:</p><ul class=""><li id="9774" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">回滚。这是任何部署工具最重要的特性。拥有一台时间机器回到某个以前的状态是无价的。</li><li id="05cd" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">修补程序。有时回滚要么不切实际，要么很难，因此修补程序比常规修补程序更容易执行，部署更快，优先级更高。</li><li id="b5c1" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">滚动部署。部署不应该中断服务，但如果绝对必要，影响必须最小。如果一定数量的服务器升级失败或者违反了服务SLA，那么停止部署是非常重要的。</li><li id="e085" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">准备和测试。直接部署到生产环境比部署到试运行环境或canary来验证工作是否正常有更高的风险。由于创建一个登台环境并将其与他们的测试相集成的开销，工程师经常不遵循这个最佳实践。一个好部署系统可以最小化这种开销。</li><li id="4f94" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">能见度。确保很容易找到可以部署的代码更改，以及运行新版本和旧版本的主机数量。同样重要的是，要容易地跟踪何时由谁引入了哪个代码变更，以及部署期间的关键指标和警报状态。</li><li id="e75d" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">可用性。简单的用户界面是上述功能的关键。</li></ul><h2 id="edd9" class="jq jr hh bd js jt ju jv jw jx jy jz ka ip kb kc kd it ke kf kg ix kh ki kj kk bi translated">介绍Teletraan</h2><p id="0f53" class="pw-post-body-paragraph ie if hh ig b ih kl ij ik il km in io ip kn ir is it ko iv iw ix kp iz ja jb ha bi translated">Teletraan是我们的内部部署系统，用于支持上述所有功能(以著名的《变形金刚》电视剧中的一个角色命名)。它是由云工程团队的一小组开发工具工程师构建的，旨在提高网站和基础设施的可靠性、速度、效率和安全性。</p><figure class="kr ks kt ku fd kv er es paragraph-image"><div class="er es kq"><img src="../Images/483b9859f873b4d03b94819f7da04b0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/0*Awch5QfIFNsgvAJF.png"/></div></figure><h2 id="b21f" class="jq jr hh bd js jt ju jv jw jx jy jz ka ip kb kc kd it ke kf kg ix kh ki kj kk bi translated">设计概述</h2><figure class="kr ks kt ku fd kv er es paragraph-image"><div class="er es kq"><img src="../Images/2453007ba47853794c8d615161df2512.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/0*YQtLgCfDyiWGXlIi.png"/></div></figure><p id="b59f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Teletraan遵循传统的客户端-服务器模型，使用MySQL作为后端数据存储。</p><p id="8a47" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">部署代理是在所有主机上运行的守护程序，定期与代理服务交互以获取最新的指令。在部署期间，代理下载并提取服务构建tar以及特定的部署脚本，并执行它们。这些部署脚本包括下载前/后脚本、重启前/后脚本和重启脚本本身，负责停止和启动服务。</p><p id="067a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Teletraan工作人员在后台执行作业，例如根据部署进度转换部署状态，以及根据时间表执行自动部署。</p><p id="040a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Teletraan服务为部署板和任何RESTful调用提供API支持。它负责大多数与部署相关的操作，包括部署和回滚。它还创建和维护服务部署配置、回答部署和代理状态查询、实施权限控制等。</p><figure class="kr ks kt ku fd kv er es paragraph-image"><div class="er es kq"><img src="../Images/e87e7008ababa5c4a844b373b64fe13b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/0*8FN2FbDQY8ULPw9a.png"/></div></figure><h2 id="9670" class="jq jr hh bd js jt ju jv jw jx jy jz ka ip kb kc kd it ke kf kg ix kh ki kj kk bi translated">高级功能</h2><p id="5255" class="pw-post-body-paragraph ie if hh ig b ih kl ij ik il km in io ip kn ir is it ko iv iw ix kp iz ja jb ha bi translated">除了上面列出的核心功能，Teletraan还支持几个高级功能:</p><ul class=""><li id="c7e9" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">暂停并继续。当开发人员希望在将代码完全部署到集群之前仔细检查某些东西时，这很方便。</li><li id="b2c4" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">资格。配置完成后，成功的部署将触发验收测试来验证它。接受的部署可用于将来的升级或自动部署到下一阶段</li><li id="9f37" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">自动部署。每当有新的构建可用时，或者基于类似cron作业的计划设置，自动将构建从一个阶段提升到另一个阶段。出现故障时，系统可以自动暂停、回滚或覆盖自动部署。</li></ul><p id="a4d0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Teletraan帮助我们更快地行动，更轻松地发布代码。我们希望与世界分享这些部署工具，并计划在今年晚些时候开源Teletraan。关注博客的更新。</p><p id="dd2d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">宋宝刚是内部开发工具团队的工程主管，该团队隶属于Pinterest的云工程团队。</p><p id="84ad" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="ky">鸣谢:Teletraan是由内部开发工具团队的Jinru He、Nick DeChant和Baogang Song构建的。</em></p><p id="8d2f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="ky">获取Pinterest工程新闻和更新，关注我们的工程</em><a class="ae kz" href="https://www.pinterest.com/malorie/pinterest-engineering-news/" rel="noopener ugc nofollow" target="_blank"><em class="ky">Pinterest</em></a><em class="ky">，</em> <a class="ae kz" href="https://www.facebook.com/pinterestengineering" rel="noopener ugc nofollow" target="_blank"> <em class="ky">脸书</em> </a> <em class="ky">和</em> <a class="ae kz" href="https://twitter.com/PinterestEng" rel="noopener ugc nofollow" target="_blank"> <em class="ky">推特</em> </a> <em class="ky">。有兴趣加入团队吗？查看我们的</em> <a class="ae kz" href="https://about.pinterest.com/en/careers/engineering-product" rel="noopener ugc nofollow" target="_blank"> <em class="ky">招聘网站</em> </a> <em class="ky">。</em></p></div></div>    
</body>
</html>