<html>
<head>
<title>SourceSet SharedTest Not Working in Android Studio Chipmunk? Use TestFixtures as Solution</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SourceSet SharedTest在Android Studio花栗鼠中不起作用？使用测试夹具作为解决方案</h1>
<blockquote>原文：<a href="https://medium.easyread.co/sourceset-sharedtest-not-working-in-android-studio-chipmunk-use-testfixtures-as-solution-b3d150b41f08?source=collection_archive---------0-----------------------#2022-05-25">https://medium.easyread.co/sourceset-sharedtest-not-working-in-android-studio-chipmunk-use-testfixtures-as-solution-b3d150b41f08?source=collection_archive---------0-----------------------#2022-05-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/fa015127ba7cfc9e478aab1752857f59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*g57ihRAx7edlrDhu"/></div></div></figure><p id="a9cd" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当我们创建一个测试代码时，我们经常会发现本地测试(test)和仪器测试(androidTest)的重复代码。或者，我们可以创建一个公共的测试文件夹，我们可以在其中存储文件、类和函数，这些文件、类和函数将可用于本地和检测测试。通常，我们称之为<a class="ae kw" href="http://robolectric.org/blog/2021/10/06/sharedTest/" rel="noopener ugc nofollow" target="_blank"><strong class="ka ir">shared test</strong></a><strong class="ka ir"/>模式。</p><p id="b973" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">为了实现该模式，我们需要在build.gradle中添加sourceSet</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="d4a2" class="lg lh iq lc b gy li lj l lk ll">sourceSets <strong class="lc ir">{<br/>    </strong>androidTest.java.srcDirs += <strong class="lc ir">"src/sharedTest/java"<br/>    </strong>test.java.srcDirs += <strong class="lc ir">"src/sharedTest/java"<br/>}</strong></span></pre><p id="dcc8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后我们可以通过在src文件夹中创建一个名为<strong class="ka ir"> sharedTest\java </strong>的新目录来添加一个新的sourceset</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi lm"><img src="../Images/2af942249909b0de77fa8961d570aca2.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/0*zZgQb2wRqnfOUA06.jpeg"/></div></figure><p id="1ac8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">这是实施进展顺利，直到新的Android工作室发布。那是<strong class="ka ir">花栗鼠</strong>版本。</p><p id="d668" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">当我们现在执行这个实现时，它将显示一个警告弹出消息<strong class="ka ir">“检测到重复的内容根”。模块[unitTest]的路径[sharedTest]已从模块[androidTest] </strong>中移除。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi ln"><img src="../Images/8da42702d54e8a8fec58535e5c6b2745.png" data-original-src="https://miro.medium.com/v2/resize:fit:868/format:webp/1*C8HSAYj5geu6OJwhUtrVtQ.png"/></div></figure><p id="0d56" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">不仅仅是警告，主要问题是<strong class="ka ir"> androidTest无法访问sharedTest </strong>中的代码，但是测试文件夹仍然可以。那么，如何解决这些问题呢？</p><p id="cee3" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">检查出…</p><p id="a8c7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我搜索了两天之后，我只在StackOverflow和YouTrack中找到了一些没有答案的问题。所以我认为有很多人有同样的问题。</p><p id="6e1e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">似乎在新的IDE中，我们不能在同一个模块中有同一个文件夹。</p><p id="8987" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后我试着在这个youtrack问题中询问是否有这个问题的解决方案，</p><div class="lo lp gp gr lq lr"><a href="https://issuetracker.google.com/issues/232007221" rel="noopener  ugc nofollow" target="_blank"><div class="ls ab fo"><div class="lt ab lu cl cj lv"><h2 class="bd ir gy z fp lw fr fs lx fu fw ip bi translated">谷歌问题跟踪</h2><div class="ly l"><h3 class="bd b gy z fp lw fr fs lx fu fw dk translated">编辑描述</h3></div><div class="lz l"><p class="bd b dl z fp lw fr fs lx fu fw dk translated">issuetracker.google.com</p></div></div></div></a></div><p id="4bda" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">而且我得到了回复！他们说:</p><blockquote class="ma mb mc"><p id="e77b" class="jy jz md ka b kb kc kd ke kf kg kh ki me kk kl km mf ko kp kq mg ks kt ku kv ij bi translated">源集不能再包含共享根，因为这不可能在IDE中表示。为了在test和androidTest之间共享源代码，你应该能够使用<a class="ae kw" href="https://developer.android.com/reference/tools/gradle-api/7.1/com/android/build/api/dsl/TestFixtures" rel="noopener ugc nofollow" target="_blank">测试夹具</a>。</p></blockquote><p id="5ee6" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">很好。这意味着我们仍然有一个使用<strong class="ka ir">测试夹具</strong>的解决方案。但是文档还是不太清楚，所以我在这里解释一下。</p><p id="354d" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">首先，我们需要在build.gradle (module: app)中启用测试夹具</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="31f4" class="lg lh iq lc b gy li lj l lk ll">android {<strong class="lc ir"><br/>    ...<br/>    testFixtures{<br/>        enable true<br/>        androidResources true<br/>    }<br/></strong>}</span></pre><p id="fd35" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意:</p><p id="b0d0" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">在我写这篇博客之前，自动完成功能没有在Android Studio中显示。所以直接写或者复制粘贴上面的代码就可以了。</p><p id="f6ea" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后作为前一步。我们可以在src文件夹中创建一个新目录。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi mh"><img src="../Images/054f59a793be288ceaae19d4b2649f84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZEfmQnuJcm33Dnte.jpeg"/></div></div></figure><p id="41ae" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意:将视图结构从Android更改为Project，以便于使用。</p><p id="d92e" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后给一个名字<strong class="ka ir"> testFixtures\java </strong>。</p><figure class="kx ky kz la gt jr gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/8601aa5897bc8e3f0a8875ae60858743.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*KR4cGaHVk-sBv3FoOxZtLA.png"/></div></figure><p id="50b8" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">注意:不要忘记创建一个与主源集同名的包。</p><p id="5375" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">现在，我们可以将代码从sharedFolder移动到testFixture。之后，我们可以使用来自本地测试和插装测试的代码。霍拉艾..</p><p id="acd1" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">然后，如果您需要testFixture中的特殊依赖，您可以使用这个sintax在build.gradle中添加。</p><pre class="kx ky kz la gt lb lc ld le aw lf bi"><span id="cf4d" class="lg lh iq lc b gy li lj l lk ll">testFixturesImplementation <strong class="lc ir">"androidx.lifecycle:lifecycle-livedata-ktx:2.4.1"</strong></span></pre><p id="d9d7" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated">祝你尝试愉快！</p><p id="3767" class="pw-post-body-paragraph jy jz iq ka b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv ij bi translated"><strong class="ka ir">更新25月22日:<br/></strong>test fixtures的代码可以被正确调用，但是运行测试时失败，错误为“<a class="ae kw" href="https://issuetracker.google.com/issues/219687418" rel="noopener ugc nofollow" target="_blank">未解析的引用</a>”。任何人知道如何解决请填写评论。</p></div><div class="ab cl mj mk hu ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ij ik il im in"><blockquote class="mq"><p id="55cd" class="mr ms iq bd mt mu mv mw mx my mz kv dk translated">开始的最佳时间是昨天，其次是现在。—未知</p></blockquote></div></div>    
</body>
</html>