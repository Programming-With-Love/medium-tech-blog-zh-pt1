<html>
<head>
<title>MQTT - The ultimate ingredient of IoT</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MQTT——物联网的终极元素</h1>
<blockquote>原文：<a href="https://medium.com/globant/mqtt-the-ultimate-ingredient-of-iot-e507ed77c35?source=collection_archive---------1-----------------------#2021-08-25">https://medium.com/globant/mqtt-the-ultimate-ingredient-of-iot-e507ed77c35?source=collection_archive---------1-----------------------#2021-08-25</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="b3a6" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">让物联网味道更好的协议酱</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/6a7e71286c7f296153e1110cae121771.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VE9bceZt8TnMgPQNiHA0vA.jpeg"/></div></div></figure><p id="f5bf" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">如今，物联网已经成为我们生活中不可或缺的一部分，它正在彻底改变我们周围的一切，如购物、制造、旅行、健康监测、家庭自动化等。物联网的概念是将任何设备连接到互联网和其他连接的设备，如智能手表、微波炉、健身追踪器、电视、火灾探测器、灯泡等。物联网设备具有非常有限的带宽和较小的代码占用空间，因此它们需要轻量级和灵活的网络协议来进行通信，MQTT是这方面的完美解决方案。</p><p id="9a6b" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><strong class="jk hi">消息队列遥测传输</strong> (MQTT)是一种轻量级且灵活的网络协议，主要用于在设备之间传输消息。它构建在TCP/IP栈之上，但是，任何提供有序、无损和双向连接的网络协议都可以支持MQTT。它被设计为使用小代码量和有限的带宽，这就是为什么它成为物联网的最终成分。</p></div><div class="ab cl ke kf go kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="ha hb hc hd he"><h1 id="2427" class="kl km hh bd kn ko kp kq kr ks kt ku kv in kw io kx iq ky ir kz it la iu lb lc bi translated"><strong class="ak"> MQTT组件</strong></h1><p id="4680" class="pw-post-body-paragraph ji jj hh jk b jl ld ii jn jo le il jq jr lf jt ju jv lg jx jy jz lh kb kc kd ha bi translated">MQTT协议基于发布-订阅(发布者和订阅者)模型。这种模式<strong class="jk hi">将发布者和订阅者彼此分离，他们从不直接联系。它们之间的连接和通信由称为<strong class="jk hi">代理</strong>的第三个组件处理。</strong></p><p id="d3a0" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">基于角色，MQTT有3种类型的组件，</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/93627f5b88c3f340a2bd6e1dcf8fd607.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z9cudrSspJcDpAmju_JnUw.jpeg"/></div></div><figcaption class="li lj et er es lk ll bd b be z dx">MQTT Protocol: Publish-Subscribe Modal</figcaption></figure><ul class=""><li id="cf9b" class="lm ln hh jk b jl jm jo jp jr lo jv lp jz lq kd lr ls lt lu bi translated"><strong class="jk hi">发布者:</strong>发布者或发送者是向MQTT代理组件发布消息的组件。每条消息都包含有效负载和主题。MQTT是数据不可知的，所以发布者决定如何构造有效负载，它可以是二进制数据、文本数据，甚至是成熟的XML或JSON。</li><li id="4d96" class="lm ln hh jk b jl lv jo lw jr lx jv ly jz lz kd lr ls lt lu bi translated"><strong class="jk hi">订阅者:</strong>订阅者或接收者是连接到MQTT代理组件的组件。它从代理接收订阅主题的消息。订户向MQTT代理发送subscribe消息，该消息包含一个订阅列表和一个唯一的包。</li><li id="b972" class="lm ln hh jk b jl lv jo lw jr lx jv ly jz lz kd lr ls lt lu bi translated"><strong class="jk hi">代理:</strong>代理是发布者和订阅者之间的中间组件。代理的职责是接收来自发布者的信息，而不考虑主题，并将其广播给订阅了所接收主题的订阅者。</li></ul></div><div class="ab cl ke kf go kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="ha hb hc hd he"><h1 id="6ca2" class="kl km hh bd kn ko kp kq kr ks kt ku kv in kw io kx iq ky ir kz it la iu lb lc bi translated"><strong class="ak"> MQTT话题</strong></h1><p id="fc10" class="pw-post-body-paragraph ji jj hh jk b jl ld ii jn jo le il jq jr lf jt ju jv lg jx jy jz lh kb kc kd ha bi translated">MQTT主题是一个轻量级的区分大小写的UTF-8字符串，其作用类似于路由。主题可以由多个主题级别组成，每个主题级别由一个正斜杠分隔(例如，家/大厅/温度)。代理使用该主题为每个连接的组件过滤消息。没有任何预先的初始化，代理可以接受任何有效的主题。发布者或订阅者在发布或订阅信息之前不需要创建主题。</p><p id="21cd" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">订阅者可以订阅确切的主题，也可以使用通配符同时订阅多个主题。通配符有以下两种类型:</p><p id="4ed8" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><strong class="jk hi">单级+: </strong>单级通配符只替换一个由加号表示的主题级。</p><p id="8d9c" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">《出埃及记》话题home/ <strong class="jk hi"> + </strong> /temp的订阅者会收到话题为home/ <strong class="jk hi">厅</strong> /temp和home/ <strong class="jk hi">厨房</strong> /temp的消息</p><p id="fc02" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><strong class="jk hi">多级#: </strong>多级通配符用于覆盖由散列符号表示的多个主题级别。要确定匹配的主题，多级通配符必须放在主题的末尾，并以正斜杠开头。</p><p id="0ff1" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">《出埃及记》主题home/hall/ <strong class="jk hi"> # </strong>的订阅者将收到主题为home/hall/ <strong class="jk hi"> temp </strong>和home/hall/ <strong class="jk hi"> light </strong>的消息</p></div><div class="ab cl ke kf go kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="ha hb hc hd he"><h1 id="d165" class="kl km hh bd kn ko kp kq kr ks kt ku kv in kw io kx iq ky ir kz it la iu lb lc bi translated"><strong class="ak">现实世界的例子</strong></h1><p id="1d3e" class="pw-post-body-paragraph ji jj hh jk b jl ld ii jn jo le il jq jr lf jt ju jv lg jx jy jz lh kb kc kd ha bi translated">现在我们对MQTT组件和主题有了更好的了解。让我们举一个真实世界的例子，</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/7f2ada08a101d7dfeda1cf08a37d96da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MjJrd1iKUQV49t2MzjIriQ.jpeg"/></div></div><figcaption class="li lj et er es lk ll bd b be z dx">MQTT: Wildcard</figcaption></figure><p id="e671" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在上图中，我们有一个带有MQTT的家庭自动化设置。我们有两个房间，即大厅和厨房。每个房间包含一个温度和一个光(环境)传感器，它们是<strong class="jk hi">发布者</strong>并连接到MQTT代理。每个传感器都向MQTT代理发布消息(包含主题和负载)。</p><p id="2bc6" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">另一方面，我们有两个<strong class="jk hi">订户</strong>连接到MQTT代理。订户A通过使用多级主题通配符订阅主题home/hall/ <strong class="jk hi"> # </strong>。用户A将接收到所有以home/hall为主题前缀的消息，如home/hall/ <strong class="jk hi"> temp </strong>和home/hall/ <strong class="jk hi"> light </strong>。</p><p id="ef0b" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">另一方面，订户B通过使用单级主题通配符订阅主题home/ <strong class="jk hi"> + </strong> /temp。因此，订户B将接收包含诸如家/ <strong class="jk hi">大厅</strong>/临时和家/ <strong class="jk hi">厨房</strong>/临时的主题的消息。</p><p id="26a9" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">到目前为止，我们已经讨论了MQTT协议、MQTT组件和主题。</p></div><div class="ab cl ke kf go kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="ha hb hc hd he"><h1 id="25a5" class="kl km hh bd kn ko kp kq kr ks kt ku kv in kw io kx iq ky ir kz it la iu lb lc bi translated">演示</h1><p id="04da" class="pw-post-body-paragraph ji jj hh jk b jl ld ii jn jo le il jq jr lf jt ju jv lg jx jy jz lh kb kc kd ha bi translated">让我们使用<a class="ae ma" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank"> NodeJs </a>、<a class="ae ma" href="https://www.npmjs.com/package/mosca" rel="noopener ugc nofollow" target="_blank"> Mosca </a>和<a class="ae ma" href="https://www.npmjs.com/package/mqtt" rel="noopener ugc nofollow" target="_blank"> MQTT </a>来构建这个家庭自动化示例。</p><p id="3734" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><a class="ae ma" href="https://www.npmjs.com/package/mosca" rel="noopener ugc nofollow" target="_blank"> Mosca </a>是node.js mqtt代理，<a class="ae ma" href="https://www.npmjs.com/package/mqtt" rel="noopener ugc nofollow" target="_blank"> MQTT </a>是<a class="ae ma" href="https://mqtt.org/" rel="noopener ugc nofollow" target="_blank"> MQTT </a>协议的客户端库，用JavaScript为node.js和浏览器编写。</p><p id="e7e9" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">我们需要做的第一件事是在您的机器上安装<a class="ae ma" href="https://nodejs.org/en/download/" rel="noopener ugc nofollow" target="_blank"> NodeJS </a>，</p><p id="6cb4" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">下一步是创建一个名为<strong class="jk hi"> MQTT </strong>的项目文件夹，</p><p id="0ea4" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">打开MQTT文件夹，使用<strong class="jk hi"> npm init </strong>命令在文件夹中创建一个package.json文件(使用大多数默认设置)。</p><p id="6ea5" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">现在使用命令<strong class="jk hi"> npm I mosca mqtt </strong>安装两个包，即<strong class="jk hi"> Mosca </strong>和<strong class="jk hi"> MQTT </strong>。</p><p id="951b" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">现在我们完成了所有的安装部分，您的<strong class="jk hi"> package.json </strong>文件如下所示:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mb mc l"/></div><figcaption class="li lj et er es lk ll bd b be z dx">package.json</figcaption></figure><p id="a901" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">现在创建一个名为<strong class="jk hi"> broker.js </strong>的新文件，这将是我们的broker，</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mb mc l"/></div><figcaption class="li lj et er es lk ll bd b be z dx">broker.js</figcaption></figure><p id="fbdb" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在第8行，我们创建了一个带有设置的Mosca代理。</p><p id="cb24" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在第11行和第16行，我们分别添加了代理事件<strong class="jk hi"> ready </strong>和<strong class="jk hi"> published </strong>。</p><p id="eeb2" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">再创建一个名为<strong class="jk hi"> hall.js </strong>的文件，这将是我们的第一个<strong class="jk hi">发布者</strong>。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mb mc l"/></div><figcaption class="li lj et er es lk ll bd b be z dx">hall.js</figcaption></figure><p id="0f81" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在第5行和第6行，我们创建了主题变量。</p><p id="9b96" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在第9行，我们创建了最后的遗嘱。</p><p id="766f" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在第15行，我们创建了一个MQTT组件，并将其连接到一个代理，该代理位于“mqtt://localhost:1200”上，最后一个“will”是。</p><p id="eb22" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在第18行，我们添加了一个<strong class="jk hi"> connect </strong>事件，一旦它连接到代理，我们就开始向代理发布消息。</p><p id="882e" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在第30行和第39行，我们分别发布主题为<strong class="jk hi"> home/hall/temp </strong>和<strong class="jk hi"> home/hall/light </strong>的消息。</p><p id="92dc" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">我们已经完成了第一个publisher，让我们创建另一个。创建一个名为<strong class="jk hi"> kitchen.js </strong>的新文件。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mb mc l"/></div><figcaption class="li lj et er es lk ll bd b be z dx">kitchen.js</figcaption></figure><p id="f8d9" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这个publisher文件和hall.js几乎一样，只是主题不同。</p><p id="5ed9" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在第5行和第6行，定义的主题是<strong class="jk hi">家庭/厨房/温度</strong>和<strong class="jk hi">家庭/厨房/灯光</strong>。</p><p id="3819" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">除了这一点不同，厨房出版商和大厅出版商是一样的。</p><p id="4a68" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">现在我们已经和出版商谈完了。</p><p id="bc31" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">让我们创建订阅者，创建一个名为<strong class="jk hi"> subscriberA.js </strong>的新文件。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mb mc l"/></div><figcaption class="li lj et er es lk ll bd b be z dx">subscriberA.js</figcaption></figure><p id="5cef" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在第5行，我们创建了一个MQTT组件，并将其连接到一个代理，这个代理可以在“mqtt://localhost:1200”上找到。</p><p id="8ab6" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在第8行，我们创建了一个多级通配符主题，即<strong class="jk hi"> home/hall/# </strong>。</p><p id="7b45" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在15号线上，我们已经订阅了话题<strong class="jk hi">家/厅/#。</strong>现在，用户A将接收到具有主题前缀home/hall/like<strong class="jk hi">home/hall/temp</strong>和<strong class="jk hi"> home/hall/light </strong>的所有消息。</p><p id="0e69" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在第19行，我们添加了一个<strong class="jk hi">消息</strong>事件监听器。</p><p id="3e47" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">我们已经完成了订户A，让我们再创建一个订户。</p><p id="a883" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">创建一个名为<strong class="jk hi"> subscriberB.js </strong>的新文件。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mb mc l"/></div><figcaption class="li lj et er es lk ll bd b be z dx">subscriberB.js</figcaption></figure><p id="01af" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">订户B与订户A几乎相同，只有一处不同。</p><p id="37cd" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在第8行，我们创建了一个单级通配符主题，即<strong class="jk hi"> home/+/temp </strong>。现在，订户B将接收到关于诸如<strong class="jk hi">家庭/大厅/临时</strong>和<strong class="jk hi">家庭/厨房/临时</strong>等主题的所有消息。</p><p id="39ca" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">酷，我们完成了所有的编码部分，现在让我们检查所有的代码，</p><p id="300d" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">要启动MQTT代理，在命令提示符下运行命令<strong class="jk hi">节点代理</strong>。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es md"><img src="../Images/e13f16c077e204d5c5c2adf76d41cd2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rAs7lLokHENZAkZ8"/></div></div><figcaption class="li lj et er es lk ll bd b be z dx">Broker is Ready</figcaption></figure><p id="8e82" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">太棒了，我们的MQTT代理开始运行了。</p><p id="1c33" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">让我们运行所有发布者和订阅者，我们已经打开了4个命令提示符，并使用命令node hall、node kitchen、node subscriberA和node subscriberB逐一启动MQTT组件。</p><p id="a605" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在左侧，我们同时运营两家发行商，即hall和kitchen。在右侧，我们运行两个订户，即subscriberA和subscriberB。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es me"><img src="../Images/2272bb1e478d8d4459e38ce1abb98439.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CzfwcrrpcUmj3vPx"/></div></div><figcaption class="li lj et er es lk ll bd b be z dx">Pub-Sub in Practical</figcaption></figure><p id="5d56" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">我们可以看到订阅者只接收他们订阅的主题的消息。</p><p id="f59f" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">SubscriberA是多级主题的订户，因此它接收主题为<strong class="jk hi"> home/hall/temp </strong>和<strong class="jk hi"> home/hall/light的消息。</strong></p><p id="8396" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">另一方面，SubscriberB是单级主题的订户，因此它接收主题为<strong class="jk hi"> home/hall/temp </strong>和<strong class="jk hi"> home/kitchen/temp </strong>的消息。</p><p id="afcd" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">最后但也是最重要的一点，如果任何一家出版商被不体面地断开连接，会发生什么？在我们的例子中，如果大厅被不恰当地断开连接，所有的用户会得到一个陈旧的温度值吗？别担心MQTT对此也有解决方案，叫做<strong class="jk hi">遗嘱</strong>。Last Will是发布者发送给MQTT代理的一个特殊设置，它告诉代理在发布者意外断开连接时为所有订阅者发布一条特殊消息。</p><p id="6208" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在我们的例子中，您可以在hall.js文件的第9行看到“最后的遗嘱”。我们已经定义了主题和最后一条消息，即有效载荷。因此，当我们断开与hall发布者的连接时，subscriberA将从代理那里获得一个特殊的证明，即“Hall出错了”。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es me"><img src="../Images/f6bb2d38f1f560b75df6a5a10f77455f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SDiETuxIJPriv2dV"/></div></div><figcaption class="li lj et er es lk ll bd b be z dx">Last Will and Testament</figcaption></figure><p id="bad0" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">到目前为止，您应该对MQTT协议、MQTT组件以及带有实际例子的主题有了更好的理解。我们还了解MQTT如何通过使用其可靠的发布-订阅模型来提高能效并在有限的带宽下工作。发布-订阅模式允许物联网设备仅接收来自订阅主题的消息。由于这些特性，MQTT成为物联网社区的首选。</p><p id="69f4" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">非常感谢，继续学习。:)</p></div></div>    
</body>
</html>