<html>
<head>
<title>Optimizing your App Engine instances for maximum throughput</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">优化您的应用引擎实例以实现最大吞吐量</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/supercharging-your-app-engine-instances-a8b2ea97e04e?source=collection_archive---------2-----------------------#2019-09-10">https://medium.com/google-developer-experts/supercharging-your-app-engine-instances-a8b2ea97e04e?source=collection_archive---------2-----------------------#2019-09-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/af87c659bace17eef9e34b5cfd7fb0f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*afZUCqsL-nk4Nshxdbps4w.png"/></div></div></figure><p id="9dfe" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在构建一个能够扩展以处理大规模数据事件的后端时，<a class="ae jn" href="https://en.wikipedia.org/wiki/Load_balancing_(computing)" rel="noopener ugc nofollow" target="_blank">负载平衡</a>是开发人员经常想到的第一件事。<br/>虽然它允许你将进入的流量分流到你的服务器的不同实例；实现负载平衡器通常很耗时，并且可能需要严格的测试来确保它按预期工作。</p><p id="87f1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">令人欣慰的是，谷歌云允许开发者使用<a class="ae jn" href="https://cloud.google.com/appengine/" rel="noopener ugc nofollow" target="_blank">应用引擎</a>，这是同一基础设施的托管版本，消除了与内部设置相关的所有麻烦和麻烦。</p><p id="ca69" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">凭借每月99.00% - 99.95%的正常运行时间保证和按需付费的定价模式，这意味着您只需为您的应用程序使用的CPU和RAM付费，这使得App Engine成为云开发人员的诱人选择。</p><p id="7c62" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">App Engine的一个关键特性是其独特的自动缩放算法，该算法根据CPU负载、网络流量和某些其他因素来增加或减少活动实例的数量。</p><p id="2045" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然而，一旦您开始使用默认设置的App Engine，您可能会注意到它所提供的吞吐量充其量是中等水平。<br/>我们在<a class="ae jn" href="https://roobits.com/" rel="noopener ugc nofollow" target="_blank"><strong class="ir hi">roobits.com</strong></a>为我们的产品部署的单个App Engine实例在升级到更多实例之前，每秒只能<strong class="ir hi">处理300个请求</strong>。</p><p id="2006" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">相比之下，在具有相同配置的单个本地机器上测试相同的设置能够为我们提供每秒900多个请求。</p><p id="a29b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在深入研究这个问题的原因时，我们偶然发现了罪魁祸首，它是在<strong class="ir hi"> </strong> <code class="du jo jp jq jr b"><strong class="ir hi">app.yaml</strong></code>文件中指定的默认配置；其中包含CPU内核、RAM、磁盘大小等规格。为您的应用引擎实例。</p><p id="d4b7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">默认情况下，您在谷歌快速入门上找到的<code class="du jo jp jq jr b"><strong class="ir hi">app.yaml</strong></code>只指导几个参数，如下图所示:</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es js"><img src="../Images/8876a7719d5cdcf9114a2004f0351cc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h-Lq74QwRQxl2hY5-0DBmg.png"/></div></div></figure><p id="3a12" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">虽然这是测试MVP想法的好方法，但是当你构建这个东西来衡量每一美元花费的重要性时，这个解决方案可能不是很有效。<br/>我们遇到了这种情况，在这篇博客中，我将分享一些技巧，这些技巧可能会帮助您提高App Engine提供的吞吐量，从而同时节省一些费用。</p><blockquote class="jx"><p id="cac1" class="jy jz hh bd ka kb kc kd ke kf kg jm dx translated"><em class="kh">感谢阅读本博客，如果你正在一家高成长公司工作，并且正在寻找一个</em> <strong class="ak"> <em class="kh">大规模实时数据采集平台</em></strong><em class="kh">；看一看</em><a class="ae jn" href="https://roobits.com/" rel="noopener ugc nofollow" target="_blank"><em class="kh">https://roobits.com/</em></a><em class="kh">。<br/>我们可能就是你要找的人！</em></p></blockquote><h1 id="49ad" class="ki kj hh bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">调整自动缩放参数:</h1><p id="689a" class="pw-post-body-paragraph ip iq hh ir b is lg iu iv iw lh iy iz ja li jc jd je lj jg jh ji lk jk jl jm ha bi translated">App Engine自带选项来修改其<code class="du jo jp jq jr b"><strong class="ir hi">app.yaml</strong></code>文件中的自动缩放算法。</p><p id="539a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">默认情况下，yaml只指定应用程序引擎应该扩展到的最小和最大实例数。<br/>虽然这是一件好事，但还有一个名为<code class="du jo jp jq jr b"><strong class="ir hi">target_utilization</strong></code>的参数，默认情况下不包含该参数，默认值为0.5 <br/>，这意味着一旦您的应用引擎实例用完了50%的CPU，一个新的实例将会启动。</p><p id="2a0d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在我们的用例中，这是非常激进的，所以我们将默认值增加到0.9，并最终将衍生实例的数量从14个减少到9个，这实质上是总成本减少了<strong class="ir hi">40%</strong>！</p><p id="6060" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">你可以查看<code class="du jo jp jq jr b"><a class="ae jn" href="https://cloud.google.com/appengine/docs/flexible/python/reference/app-yaml#automatic_scaling" rel="noopener ugc nofollow" target="_blank"><strong class="ir hi">app.yaml</strong></a></code> <a class="ae jn" href="https://cloud.google.com/appengine/docs/flexible/python/reference/app-yaml#automatic_scaling" rel="noopener ugc nofollow" target="_blank">参考文献</a>了解更多关于这个调整的细节。</p><h1 id="c8eb" class="ki kj hh bd kk kl km kn ko kp kq kr ks kt ll kv kw kx lm kz la lb ln ld le lf bi translated">从小实例开始:</h1><p id="1d34" class="pw-post-body-paragraph ip iq hh ir b is lg iu iv iw lh iy iz ja li jc jd je lj jg jh ji lk jk jl jm ha bi translated">app.yaml文件中的<code class="du jo jp jq jr b"><strong class="ir hi">resources</strong></code> <strong class="ir hi"> </strong>块允许您指定机器中内核和RAM的数量。</p><p id="4ed7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">虽然您可能倾向于从4核和4GB ram的机器开始，但是不要这样做！相反，从较低的机器(1个核心CPU和1 GB RAM)开始，增加应用程序引擎应该产生的最小实例。</p><p id="6eca" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这将确保您的实例不会产生比所需更多的CPU和RAM。</p><p id="ed86" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">例如，假设具有1个内核和1 GB ram的单个实例可以处理300 RPS的网络负载。所以一台4核4 GB内存的机器理论上可以处理1200 RPS。</p><p id="3736" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果我的应用程序收到1500 RPS的负载，<strong class="ir hi">前一个设置将使用5个内核和5GB内存</strong>，而<strong class="ir hi">后一个设置将使用8个内核和8 GB内存。</strong></p><p id="cfe8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">由于App Engine会根据每小时使用的内核和RAM数量向您收费，因此您可以<strong class="ir hi">通过在较低的机器上使用前一种设置来节省高达40%的成本</strong>！</p><h1 id="e7d1" class="ki kj hh bd kk kl km kn ko kp kq kr ks kt ll kv kw kx lm kz la lb ln ld le lf bi translated">降低健康检查的频率:</h1><p id="d222" class="pw-post-body-paragraph ip iq hh ir b is lg iu iv iw lh iy iz ja li jc jd je lj jg jh ji lk jk jl jm ha bi translated">默认情况下，App Engine通过pinging您的实例来执行健康检查，以确保它们正常工作。<br/>如果一个实例没有对这些健康检查返回200响应，则该实例被视为不健康并重新启动。</p><p id="241b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">虽然这些对于确保您的实例正常运行是必要的，但默认情况下，AppEngine每秒钟执行多次这些健康检查(在我们的用例中，App Engine实例每秒钟接收多达20次检查)！</p><p id="dcbc" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这可能会影响应用程序引擎实例每秒可以处理的请求，从而导致产生更多的实例。</p><p id="d4f5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">虽然强烈建议不要禁用运行状况检查，但您可以降低其频率，以确保它们每10-15秒检查一次您的实例。</p><p id="ab13" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您可以查看<code class="du jo jp jq jr b"><strong class="ir hi">app.yaml</strong></code> <a class="ae jn" href="https://cloud.google.com/appengine/docs/flexible/python/reference/app-yaml#updated_health_checks" rel="noopener ugc nofollow" target="_blank">参考指南</a>了解如何操作。</p><p id="93bd" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">通过降低运行状况检查的频率，我们能够将产生的实例数量减少1个，从而每月节省1个实例的成本！</p><p id="d96a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">就是这样！</p><p id="52b0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">仅仅通过调整这三个关键参数，我们就成功削减了超过30–50%的成本</strong>。<br/>虽然这里提到的技巧是针对我们在<a class="ae jn" href="https://roobits.com/" rel="noopener ugc nofollow" target="_blank"><strong class="ir hi">【https://roobits.com/</strong></a>的用例的，但我相信你也能找到一些对你自己的用例有用的技巧！</p><p id="bdec" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="lo">感谢阅读！如果你喜欢这个故事，请点击</em><strong class="ir hi"><em class="lo"/></strong>👏<strong class="ir hi"> <em class="lo">按钮</em> </strong> <em class="lo"> </em> <strong class="ir hi"> <em class="lo">并分享</em> </strong> <em class="lo">帮助别人找到它！欢迎随时发表评论</em>💬<em class="lo">下图。</em></p><p id="1b22" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="lo">有反馈吗？下面我们来连线推特上的</em><a class="ae jn" href="https://twitter.com/harshithdwivedi" rel="noopener ugc nofollow" target="_blank"><em class="lo"/></a><em class="lo">。</em></p></div></div>    
</body>
</html>