<html>
<head>
<title>A Deep Dive Into Seamless Blue/Green Deployment Using AWS CodeDeploy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS CodeDeploy深入了解无缝蓝/绿部署</h1>
<blockquote>原文：<a href="https://medium.com/capital-one-tech/seamless-blue-green-deployment-using-aws-codedeploy-4c36c0bbeef4?source=collection_archive---------0-----------------------#2019-05-18">https://medium.com/capital-one-tech/seamless-blue-green-deployment-using-aws-codedeploy-4c36c0bbeef4?source=collection_archive---------0-----------------------#2019-05-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/52d3cd706323897cc0f0ce7cf8d8fb91.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zoY9bQBqD35IBwU_fM7JIA.png"/></div></div></figure><p id="ac66" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在我们深入了解如何使用蓝/绿部署之前，让我们试着了解一下它是什么。</p><p id="4d3c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="jn">蓝/绿部署是一种部署模式，旨在部署新版本的应用程序/软件，而不会出现任何停机或风险极小。蓝/绿部署是通过建立一个类似的堆栈，然后在这个新的堆栈上部署新版本的应用程序来实现的。流量从当前堆栈(称为蓝色堆栈)转移到新堆栈(称为绿色堆栈)。</em></p><p id="a5fb" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">既然我们已经讨论了它是什么，那么为什么应该选择蓝/绿部署呢？</p><ul class=""><li id="7d6f" class="jo jp hh ir b is it iw ix ja jq je jr ji js jm jt ju jv jw bi translated"><strong class="ir hi">无停机:</strong>您将流量从蓝色堆栈转移到绿色堆栈。</li><li id="ea04" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">简单回滚:</strong>如果绿色堆栈不健康，您可以遵循相反的过程，将流量移回蓝色堆栈。</li><li id="3dd3" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">降低风险:</strong>在迁移生产实时流量之前，您可以通过运行功能测试来验证绿色堆栈。</li></ul></div><div class="ab cl kc kd go ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="ha hb hc hd he"><p id="610d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这篇博客中，我们将深入探讨如何使用<a class="ae kj" href="https://aws.amazon.com/codedeploy/" rel="noopener ugc nofollow" target="_blank"> <strong class="ir hi"> AWS CodeDeploy </strong> </a>服务为ECS容器任务进行蓝/绿部署。</p><p id="bd6c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">当AWS在2015年4月推出ECS时，没有对蓝/绿部署的现成支持。工程师们尝试了各种方法来解决这个问题，包括:</p><ul class=""><li id="00c9" class="jo jp hh ir b is it iw ix ja jq je jr ji js jm jt ju jv jw bi translated">交换ELB后面的自动缩放组。</li><li id="5874" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">更新自动扩展组启动配置。</li><li id="16c5" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">使用Route53的DNS路由更新。</li></ul><p id="6c6f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">2016年8月，AWS推出了<a class="ae kj" href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/introduction.html" rel="noopener ugc nofollow" target="_blank">应用负载均衡器</a> (ALB)，但仍不支持ECS蓝/绿部署。为了解决这个问题，我在Capital One的团队实施了我们自己开发的蓝/绿部署解决方案，使用测试ALB测试流量，然后交换ALB侦听器规则以实现蓝/绿任务之间的流量切换。</p><p id="5863" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">快进到2018年11月，亚马逊ECS使用<a class="ae kj" href="https://aws.amazon.com/codedeploy/" rel="noopener ugc nofollow" target="_blank"> CodeDeploy </a>添加了对蓝/绿部署的官方支持。</p><h1 id="6ccb" class="kk kl hh bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">ECS蓝/绿部署的先决条件</h1><ul class=""><li id="c46c" class="jo jp hh ir b is li iw lj ja lk je ll ji lm jm jt ju jv jw bi translated">ECS部署类型应为“蓝绿色”。</li><li id="e9bc" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">ECS服务必须使用应用程序负载平衡器或网络负载平衡器。<em class="jn">我们将在本博客中使用ALBr。</em></li><li id="f131" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">ALB应该有一个接受prod流量的侦听器。</li><li id="8da9" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">可以向负载平衡器添加一个可选的测试监听器，用于路由测试流量。如果您指定了测试侦听器，CodeDeploy会在部署期间将您的测试流量路由到替换/绿色任务集。</li><li id="3416" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">应该创建两个ALB目标组，一个用于蓝色任务，另一个用于绿色任务。</li></ul><h1 id="7566" class="kk kl hh bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">CodeDeploy蓝/绿部署流程</h1><p id="5b2d" class="pw-post-body-paragraph ip iq hh ir b is li iu iv iw lj iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated">这里的假设是，开发团队已经在使用部署自动化以编程方式创建带有ALB和目标组的ECS服务，或者他们应该使用AWS控制台进行设置。</p><p id="1c76" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">下图显示了初始部署，其中只有蓝色任务正在运行，并占用100%的生产流量。</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lq"><img src="../Images/31901c96ea57c9b400b86b6d5b0f5bd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4buzj3MyLlDUABkZ-ZBajg.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">Initial Blue Stack</figcaption></figure><p id="bd01" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，让我们看看基于CodeDeploy的蓝/绿部署。从下图中，您会注意到绿色任务开始了(它们是新版本的代码),并被附加到目标组2。ALB测试流量监听程序现在已准备好接收端口8443上的测试流量，测试流量将被发送到使用目标组2的绿色任务。一旦测试流量通过测试监听器准备好，我们就可以添加一个钩子(lambda函数)。lambda函数可以在ALB/test侦听器端口8443上执行一些功能测试，并将返回“成功”或“失败”。</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lz"><img src="../Images/f3768c626d7ca5a1fd7286b4d40998db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tZqTknAZITwLUgTWjXq8Vw.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx"><em class="ma">Green traffic flowing through Test listener</em></figcaption></figure><p id="9cfe" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">假设测试流量lambda hook返回“成功”，生产流量被路由到目标组2，该组又由绿色任务(新代码版本)提供服务。ALB prod监听器端口443和test监听器端口8443现在都指向目标组2。CodeDeploy将蓝色任务保留一段预先配置的时间，以便可以从CodeDeploy控制台或通过CLI/API调用进行回滚。</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mb"><img src="../Images/832955ef620507368d42fe34b5f2b73e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LmMcSeZAzwgdBAKOWfXz2A.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx"><em class="ma">Prod traffic flowing through Green tasks</em></figcaption></figure><p id="23f9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">一旦经过了预先配置的时间段，CodeDeploy将终止蓝色任务，在这一点之后，回滚将是不可能的。</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mc"><img src="../Images/a07cd80df816f12a703e84e0c6f6a61c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oj0BldYnX6GMQ0csykBXvQ.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx"><em class="ma">Blue tasks terminated</em></figcaption></figure><h1 id="465c" class="kk kl hh bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated"><strong class="ak">各种代码部署资源</strong></h1><p id="62a1" class="pw-post-body-paragraph ip iq hh ir b is li iu iv iw lj iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated">现在让我们深入研究一下实现细节。支持ECS蓝/绿部署需要以下AWS CodeDeploy工件:</p><ul class=""><li id="0c5d" class="jo jp hh ir b is it iw ix ja jq je jr ji js jm jt ju jv jw bi translated">代码部署应用程序</li><li id="5143" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">CodeDeploy部署组</li><li id="b2f3" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">代码部署部署</li></ul><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es md"><img src="../Images/2d8b636d2305c8e86846eca2baadd2c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dgNom3dGTEdDH20-K02VMw.png"/></div></div></figure><p id="0e6d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">因此，您可以从AWS CodeDeploy控制台创建上述CodeDeploy资源，也可以使用CLI或特定于语言的API(如<a class="ae kj" href="https://boto3.amazonaws.com/v1/documentation/api/latest/index.html" rel="noopener ugc nofollow" target="_blank"> Python/Boto3 </a>)以编程方式创建它们。让我们看一看它是什么样子的:</p><h2 id="df73" class="me kl hh bd km mf mg mh kq mi mj mk ku ja ml mm ky je mn mo lc ji mp mq lg mr bi translated"><strong class="ak">使用Python/Boto3创建一个CodeDeploy应用程序:</strong></h2><pre class="lr ls lt lu fd ms mt mu mv aw mw bi"><span id="efbb" class="me kl hh mt b fi mx my l mz na">cd_client = boto3.client('codedeploy')<br/>response = cd_client.create_application(</span><span id="3deb" class="me kl hh mt b fi nb my l mz na">    applicationName=application_name,<br/>    computePlatform='ECS'</span><span id="07b5" class="me kl hh mt b fi nb my l mz na">)</span></pre><h2 id="5284" class="me kl hh bd km mf mg mh kq mi mj mk ku ja ml mm ky je mn mo lc ji mp mq lg mr bi translated"><strong class="ak">使用Python/Boto3创建一个CodeDeploy部署组:</strong></h2><pre class="lr ls lt lu fd ms mt mu mv aw mw bi"><span id="d4ee" class="me kl hh mt b fi mx my l mz na">response = cd_client.create_deployment_group(<br/>    applicationName='AppECS-sample-springboot-app-qa-bg',<br/>    deploymentGroupName='DgpECS-sample-springboot-app-qa-bg',<br/>    deploymentConfigName='CodeDeployDefault.ECSAllAtOnce',</span><span id="2f02" class="me kl hh mt b fi nb my l mz na">serviceRoleArn='arn:aws:iam::123456789123:role/ecs_service_role',<br/>    triggerConfigurations=[<br/>    {<br/>      'triggerName': 'sample-springboot-app-qa-code-deploy-bg-<br/>      trigger',<br/>      'triggerTargetArn': 'arn:aws:sns:us-east-<br/>      1:123456789123:my_sns_topic',<br/>      'triggerEvents': [<br/>        "DeploymentStart",<br/>        "DeploymentSuccess",<br/>        "DeploymentFailure",<br/>        "DeploymentStop",<br/>        "DeploymentRollback",<br/>        "DeploymentReady"<br/>      ]<br/>    },<br/>],</span><span id="2c04" class="me kl hh mt b fi nb my l mz na">autoRollbackConfiguration={<br/>    'enabled': True,<br/>    'events': [<br/>      'DEPLOYMENT_FAILURE', 'DEPLOYMENT_STOP_ON_ALARM', <br/>      'DEPLOYMENT_STOP_ON_REQUEST',<br/>    ]<br/>},</span><span id="438c" class="me kl hh mt b fi nb my l mz na">deploymentStyle={<br/>    'deploymentType': 'BLUE_GREEN',<br/>    'deploymentOption': 'WITH_TRAFFIC_CONTROL'<br/>},</span><span id="725d" class="me kl hh mt b fi nb my l mz na">blueGreenDeploymentConfiguration={<br/>    'terminateBlueInstancesOnDeploymentSuccess': {<br/>      'action': 'TERMINATE',<br/>      'terminationWaitTimeInMinutes': 15<br/>    },<br/>    <br/>    'deploymentReadyOption': {<br/>       'actionOnTimeout': 'CONTINUE_DEPLOYMENT'<br/>    }<br/>},</span><span id="d6b8" class="me kl hh mt b fi nb my l mz na">loadBalancerInfo={<br/>    'targetGroupPairInfoList': [<br/>      {<br/>        'targetGroups': [<br/>          {<br/>            'name': 'sample-springboot-app-qa-tg1'<br/>          },<br/>          {<br/>            'name': 'sample-springboot-app-qa-tg2'<br/>          }<br/>        ],<br/>        'prodTrafficRoute': {<br/>          'listenerArns': 'arn:aws:elasticloadbalancing:us-east-    <br/>          1:123456789123:listener/app/sample-springboot-app-qa-<br/>          alb/2b8b8ab60f9c7e43/97b643f12d4fa8a4'<br/>        },<br/>        'testTrafficRoute': {<br/>          'listenerArns': 'arn:aws:elasticloadbalancing:us-east-<br/>          1:123456789123:listener/app/sample-springboot-app-qa-<br/>          alb/2b8b8ed64f9c7e43/09261df9b5476d39'<br/>        }<br/>      },<br/>    ]<br/>},</span><span id="06ca" class="me kl hh mt b fi nb my l mz na">ecsServices=[<br/>    {<br/>      'serviceName': 'sample-springboot-app-qa',<br/>      'clusterName': 'my-test-cluster'<br/>    }<br/>]<br/>)</span></pre><h2 id="755b" class="me kl hh bd km mf mg mh kq mi mj mk ku ja ml mm ky je mn mo lc ji mp mq lg mr bi translated"><strong class="ak">创建一个CodeDeploy部署:</strong></h2><pre class="lr ls lt lu fd ms mt mu mv aw mw bi"><span id="0c55" class="me kl hh mt b fi mx my l mz na">response = cd_client.create_deployment(<br/>    applicationName='AppECS-sample-springboot-app-qa-bg',<br/>    deploymentGroupName='DgpECS-sample-springboot-app-qa-bg',<br/>    revision={<br/>      'revisionType': 'AppSpecContent',<br/>      'appSpecContent': {<br/>        'content': "APPSPEC FILE CONTENT",<br/>        'sha256': "xxxxxx"<br/>      }<br/>    },</span><span id="9570" class="me kl hh mt b fi nb my l mz na">    ignoreApplicationStopFailures=False,<br/>    autoRollbackConfiguration={<br/>      'enabled': True,<br/>      'events': [<br/>        'DEPLOYMENT_FAILURE',<br/>        'DEPLOYMENT_STOP_ON_ALARM',<br/>        'DEPLOYMENT_STOP_ON_REQUEST'<br/>      ]<br/>    }<br/>)</span></pre><p id="7567" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">CodeDeploy“部署”使用一个AppSpec文件，这是一个YAML文件，提供资源信息和执行挂钩信息。如下所示，资源部分包含任务定义和容器信息。Hooks部分允许您添加lambda函数，以便在CodeDeploy蓝/绿部署的生命周期中的不同时间点触发(更多详细信息请参见下一部分)。</p><pre class="lr ls lt lu fd ms mt mu mv aw mw bi"><span id="c4a6" class="me kl hh mt b fi mx my l mz na">{<br/>    "version": 0.0,<br/>    "Resources": [<br/>        {<br/>            "TargetService": {<br/>                "Type": "AWS::ECS::Service",<br/>                "Properties": {<br/>                    "TaskDefinition": "ECS-TASK-DEFINITION-ARN",<br/>                    "LoadBalancerInfo": {<br/>                        "ContainerName": "my-container",<br/>                        "ContainerPort": 8080<br/>                    }<br/>                }<br/>            }<br/>        }<br/>    ],<br/>    "Hooks": [<br/>  {<br/>   "AfterAllowTestTraffic": "arn:aws:lambda:us-east-1:1234567890:function:my-green-ready-hook"<br/>  }<br/> ]<br/>}</span></pre><h1 id="4e7d" class="kk kl hh bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">蓝/绿部署在行动:快乐之路</h1><h2 id="1941" class="me kl hh bd km mf mg mh kq mi mj mk ku ja ml mm ky je mn mo lc ji mp mq lg mr bi translated"><strong class="ak">初始设置:</strong></h2><p id="34fe" class="pw-post-body-paragraph ip iq hh ir b is li iu iv iw lj iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated">这里我们有一个使用蓝/绿部署的ECS服务(由CodeDeploy提供支持),运行一个Fargate任务。</p><p id="2186" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">请注意，ECS服务是基于ECS任务定义版本132运行的，并且正在运行一个Fargate任务:</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nc"><img src="../Images/5ec08deeb1776f7884505829075ce50e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-MBNlLSy2Jbgc8vELUuaGQ.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">ECS- Before Blue/Green deployment</figcaption></figure><p id="72c1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">附加到此ECS服务的ALB和目标组:</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nd"><img src="../Images/156e2a66ae6887eefdb07329726d2f27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gpt7v52qFr59KxgxNqUX2g.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">ALB — Before Blue/Green deployment</figcaption></figure><p id="9a5b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">端口443的监听器是生产流量监听器，端口8443是测试流量监听器。此时，两个监听器都连接到以“-tg2”结尾的同一个目标组。</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nd"><img src="../Images/cef49ce96a100063dd93e6c72f16a071.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8G3xqcfrn8NgcWFRyMujDQ.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">Target Groups — Before Blue/Green deployment</figcaption></figure><p id="dce8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为此ECS服务创建的两个目标组使用Code Deploy支持蓝/绿部署。此时，只有目标组“-tg2”正在运行一个目标/任务，并连接到上面的ALB监听器。</p><h2 id="cdd1" class="me kl hh bd km mf mg mh kq mi mj mk ku ja ml mm ky je mn mo lc ji mp mq lg mr bi translated">让我们启动蓝绿部署</h2><p id="47c1" class="pw-post-body-paragraph ip iq hh ir b is li iu iv iw lj iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated">首先，我们开始ECS服务的蓝/绿部署。可以使用ECS API或使用AWS ECS控制台-更新ECS服务功能以编程方式启动ECS部署，然后从CodeDeploy控制台或CodeDeploy API创建新的部署。更新的代码版本将在新的ECS任务定义文件中提及，该文件将用于更新ECS服务。</p><p id="296d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">由于ECS服务的部署控制器是CodeDeploy，CodeDeploy中的部署将被触发，一个新的ECS任务将在这里启动。</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ne"><img src="../Images/be5ca0ae6a7ad3329339468ca61a5d50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wHPztWBjPDjoa2oN3PgKuA.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">CodeDeploy — Initiate Deployment</figcaption></figure><p id="3bc1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您可以在下面看到一个新的ECS任务已经开始，运行计数现在是2。在Deployments选项卡下，主要条目用于当前的蓝色任务，活动条目用于新的即将到来的绿色任务。</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nd"><img src="../Images/1550dbb856b06f136bd5ff78327173df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mi2NerKFlOtiDAyv3Hgp0Q.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">ECS — Blue/Green deployment in progress in CodeDeploy</figcaption></figure><p id="3bf0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">绿色任务现在已经启动并运行。PROD流量仍然由原始堆栈中的蓝色任务提供服务。在这个阶段，回滚仍然是可能的，但是请记住，回滚只会终止绿色任务。</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nf"><img src="../Images/3edd3f2fe670be1f439bc6719c1f11b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rSN_KhRJEAUQE2frJ_iiPQ.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">Code Deploy — Post creation of Green task</figcaption></figure><p id="e8d2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在ALB监听器已经更新了。PROD侦听器(端口443)仍然与目标组“-tg2”连接，并为实时流量提供服务。测试侦听器(端口8443)与目标组“-tg1”相关联，该目标组以前根本没有与ALB相关联。因此，您可以点击ALB DNS:8443并测试绿色堆栈，该堆栈没有接收任何生产流量。</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nd"><img src="../Images/9707067aa568c3a5d5f42318888be935.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vW47JsMOpVu1S8gphiZNxA.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">ALB — Now listeners are connected to PROD and TEST target groups</figcaption></figure><p id="9c8d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，“-tg1”(获取测试流量)和“-tg2”(获取生产流量)都连接到ALB服务测试和生产监听器。</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nd"><img src="../Images/91b27d8ba985b1f1b0fbb52dae3b4718.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3LHimGYMruYWzSegdahS1w.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">Target Groups — Both target groups now active and attached to ALB</figcaption></figure><h2 id="2ab3" class="me kl hh bd km mf mg mh kq mi mj mk ku ja ml mm ky je mn mo lc ji mp mq lg mr bi translated"><strong class="ak">生产流量从蓝色移动到绿色任务:</strong></h2><p id="f1b4" class="pw-post-body-paragraph ip iq hh ir b is li iu iv iw lj iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated">流量路由完成，新的绿色任务(或替换任务)现在服务于生产流量。<strong class="ir hi">但是流量路由是怎么发生的呢？我们能控制这一切吗？</strong> —好问题，我会在单独的部分回答:)</p><p id="da5f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这个阶段回滚仍然是可能的，因为蓝色任务仍然存在并处于空闲状态，它将在接下来的15分钟内可用(这个持续时间可以在DeploymentGroup属性“terminationWaitTimeInMinutes”中配置，如前一节所示),但是<strong class="ir hi">回滚是如何工作的？</strong> —这又是一个好问题，我将在另一部分解释。</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ng"><img src="../Images/b38a86a613138fc42faa054dc6341db3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_IFep7mAcFIFvAe2g87HKw.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">CodeDeploy — Traffic rerouting done</figcaption></figure><p id="536c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">ECS现在使用更新的任务定义版本133(以前是132)运行任务。原始任务和新任务仍然在运行，这就是为什么回滚仍然是可能的。“部署”选项卡现在显示100%的流量由替换任务提供服务，这是新的绿色任务。</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nd"><img src="../Images/d73cd9a923610698a2d088722715b19e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I8K8YRIjYSzlAt5xXS_NGw.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">ECS — Post traffic rerouting from blue to green</figcaption></figure><p id="83ec" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，ALB监听器PROD (Port-443)和TEST (Port-8443)都指向目标组“-tg1”，该组将绿色任务作为目标。</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nd"><img src="../Images/6391e5f658443851b244643161e0ab59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YG0JAJo7HZbV-0uvRY8Ivg.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">ALB — Post traffic rerouting</figcaption></figure><h2 id="947e" class="me kl hh bd km mf mg mh kq mi mj mk ku ja ml mm ky je mn mo lc ji mp mq lg mr bi translated">快进15分钟—蓝/绿部署已经完成</h2><p id="6cac" class="pw-post-body-paragraph ip iq hh ir b is li iu iv iw lj iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated">根据code deploy“deployment group”配置“terminationWaitTimeInMinutes”，15分钟后将终止蓝色任务。由于蓝色任务消失，回滚不再可能！</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nh"><img src="../Images/2454535619e9bfed4eeb35819b864b22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UY4Wgr5-IZe0uWok3PhmJA.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">CodeDeploy — Post termination of Blue/original task</figcaption></figure><p id="bb55" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">随着蓝色/原始任务的消失，ECS运行任务计数恢复为1。任务定义版本为“133”，这意味着新版本服务于生产流量。在“部署”选项卡下，活动条目现在已不存在。</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nd"><img src="../Images/a430bad155beff359fb522011f916929.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KRjumqaahbaB_xSW0BEu0Q.png"/></div></div></figure><h1 id="2996" class="kk kl hh bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">蓝/绿部署正在进行:回滚流程</h1><h2 id="8ce6" class="me kl hh bd km mf mg mh kq mi mj mk ku ja ml mm ky je mn mo lc ji mp mq lg mr bi translated">让我们回顾一下我们当前稳定的生产状态:</h2><ul class=""><li id="675a" class="jo jp hh ir b is li iw lj ja lk je ll ji lm jm jt ju jv jw bi translated">ECS服务正在使用任务定义版本133运行1个任务。</li><li id="eda6" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">ALB监听器生产(端口443)和测试(端口8443)都指向目标组“-tg1”。</li><li id="5d1d" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">目标组“-tg1”处于活动状态，为生产流量提供服务，而“-tg2”未连接到ALB。</li></ul><p id="79a2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们现在要部署一个新版本，并将在流量重新路由后进行回滚，以演示回滚流程:</p><h2 id="4087" class="me kl hh bd km mf mg mh kq mi mj mk ku ja ml mm ky je mn mo lc ji mp mq lg mr bi translated">同样，让我们启动蓝/绿部署:</h2><p id="1c95" class="pw-post-body-paragraph ip iq hh ir b is li iu iv iw lj iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated">让我们快进并查看新的蓝/绿部署将流量重新路由到绿堆栈并等待15分钟后终止原始/蓝任务的状态。</p><p id="1c28" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们有CodeDeploy蓝/绿部署等待终止蓝任务，并产生由新的绿/替换任务服务的流量。</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ng"><img src="../Images/6a82038d5f777320fe07ae173424c54e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sIXHbhNF5xkMClur0cCekA.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">CodeDeploy — Post rerouting traffic</figcaption></figure><p id="244b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">ECS服务现在使用新的ECS任务定义版本134(我们从133开始此部署)运行新任务，我们的ECS运行任务计数为2，一个使用ECS任务定义版本133，另一个使用新的ECS任务定义版本134。ECS部署应该显示新的主要任务为100%的流量提供服务。</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nd"><img src="../Images/1807b02efe4db2969e97f22d1b396226.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pBc_gecfEMWaEwOKnqVS-Q.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">ECS Service — Deployment View</figcaption></figure><p id="7ef2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">ALB侦听器PROD(端口443)和TEST(端口8443)都指向目标组“-tg2”。以前它们连接到“-tg1”。</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nd"><img src="../Images/c93bec7df4162baf88745059078b60f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EnId_eD5C0GR78onCIp-Rw.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">ALB — Listeners</figcaption></figure><h1 id="43c4" class="kk kl hh bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated"><strong class="ak">所以，让我们假设部署不顺利，我们现在必须回滚… </strong></h1><p id="5b28" class="pw-post-body-paragraph ip iq hh ir b is li iu iv iw lj iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated">让我们通过单击“停止并回滚部署”按钮从CodeDeploy控制台启动回滚:</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div class="er es ni"><img src="../Images/961c78b50d8d34c29089e611135a34da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*E-XNcqvh_F_yM8sWeSq_Cw.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx">Code Deploy — Stop and rollback message</figcaption></figure><p id="3df2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">部署的工作方式是CodeDeploy停止当前部署并跳过删除原始/蓝色任务的步骤。然后，它创建一个新的部署来回滚以前的部署，并将流量从替换/绿色任务重新路由回原始/蓝色任务。它还终止替换/绿色任务。</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nj"><img src="../Images/aad44628527e64142911b187a33cd18e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CekwuGXzcsS8uYAt3hCnLQ.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">Code Deploy — Rollback Deployment</figcaption></figure><h1 id="ce0f" class="kk kl hh bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">让我们回顾一下ECS和ALB设置看起来像回滚后的样子</h1><p id="740f" class="pw-post-body-paragraph ip iq hh ir b is li iu iv iw lj iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated">ECS服务现在正在使用原始任务定义版本133运行任务，并且正在运行的任务计数回到1。ECS部署显示主要任务的生产流量为100%。</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nd"><img src="../Images/06b0d9a92c5830dc8b8177e8ebbd04e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4D1exXnXNlUWQ4LVtj8rvA.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">ECS Service — Post Rollback</figcaption></figure><p id="9b45" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">ALB侦听器(生产和测试)都返回到目标组“-tg1”。</p><figure class="lr ls lt lu fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nd"><img src="../Images/d2407375b79e81a86b9cb482ab12823c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zt_wVY8kMynco38k8o_Epw.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">ALB — Listeners Post Rollback</figcaption></figure><p id="bf0a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> <em class="jn">这样就完成了成功的回滚！</em>T3】</strong></p><h1 id="9c54" class="kk kl hh bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">如何控制蓝/绿任务之间的流量路由？</h1><p id="e780" class="pw-post-body-paragraph ip iq hh ir b is li iu iv iw lj iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated">CodeDeploy允许您运行蓝色/绿色部署管道的附加挂钩。钩子只是你实现的lambda函数。</p><p id="9e16" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">一些示例场景如下:</p><ul class=""><li id="713a" class="jo jp hh ir b is it iw ix ja jq je jr ji js jm jt ju jv jw bi translated">在路由生产流量之前，在绿色堆栈上运行功能测试。</li><li id="8b92" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">一些环境设置，如在生产流量迁移之前将文件下载/上传到S3。</li></ul><h1 id="da09" class="kk kl hh bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">Amazon ECS部署的生命周期事件挂钩列表(参考:此处)</h1><ul class=""><li id="12fd" class="jo jp hh ir b is li iw lj ja lk je ll ji lm jm jt ju jv jw bi translated"><strong class="ir hi"> BeforeInstall </strong> —用于在创建替换任务集之前运行任务。</li><li id="123a" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi"> AfterInstall </strong> —用于在创建替换任务集并且其中一个目标组与其关联后运行任务。</li><li id="8f74" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi"> AfterAllowTestTraffic </strong> —用于在测试监听器向替换任务集提供流量后运行任务。此时钩子函数的结果可以触发回滚。</li><li id="9591" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi"> BeforeAllowTraffic </strong> —用于在第二个目标组与替换任务集关联之后，但在流量转移到替换任务集之前运行任务。这个生命周期事件中钩子函数的结果可以触发回滚。</li><li id="cd7a" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi"> AfterAllowTraffic </strong> —用于在第二个目标组向替换任务集提供流量后运行任务。这个生命周期事件中钩子函数的结果可以触发回滚。</li></ul><h2 id="02ff" class="me kl hh bd km mf mg mh kq mi mj mk ku ja ml mm ky je mn mo lc ji mp mq lg mr bi translated"><strong class="ak">如何添加生命周期挂钩？</strong></h2><p id="5fcd" class="pw-post-body-paragraph ip iq hh ir b is li iu iv iw lj iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated">生命周期挂钩lambda函数可以通过您创建的AppSpec文件添加，并附加到CodeDeploy部署对象，请参考上一节中的示例。</p><p id="6ceb" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我的自动回滚实现包括:</p><ul class=""><li id="ec62" class="jo jp hh ir b is it iw ix ja jq je jr ji js jm jt ju jv jw bi translated">为生命周期事件"<strong class="ir hi"> AfterAllowTestTraffic "添加一个挂钩。</strong></li><li id="2a73" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">lambda函数使用ALB DNS +测试侦听器端口(8443)对绿色任务运行功能测试。</li><li id="a506" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">如果功能测试通过(即向CodeDeploy控制台返回“Succeeded”)，蓝/绿部署将继续，流量将转移到绿色堆栈。</li><li id="1f50" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">如果测试失败(即向CodeDeploy控制台返回“失败”)，它将启动流量到蓝色堆栈的自动回滚。</li></ul><h1 id="0348" class="kk kl hh bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="ad94" class="pw-post-body-paragraph ip iq hh ir b is li iu iv iw lj iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated">使用AWS CodeDeploy的ECS服务部署是一个非常强大的组合，它提供了非常简单和健壮的蓝/绿部署支持。</p><p id="d734" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">额外的部署生命周期挂钩使您能够根据自己的需求灵活地控制流量路由策略。</p><p id="b4ee" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您已经在广泛使用AWS服务，并且ECS是您的容器部署平台，那么您绝对应该考虑将它作为一个首选架构，而不是自行开发的解决方案。</p><p id="26ce" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="jn">如果你想了解使用现有AWS服务的金丝雀部署模式，请点击这里</em><a class="ae kj" rel="noopener" href="/capital-one-tech/deploying-with-confidence-strategies-for-canary-deployments-on-aws-7cab3798823e"><em class="jn"/></a><em class="jn">，这是一篇关于这个主题的精彩文章！</em></p><h1 id="17ea" class="kk kl hh bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated"><strong class="ak">参考文献:</strong></h1><ul class=""><li id="1319" class="jo jp hh ir b is li iw lj ja lk je ll ji lm jm jt ju jv jw bi translated">AppSpec文件示例:<a class="ae kj" href="https://docs.aws.amazon.com/codedeploy/latest/userguide/reference-appspec-file-example.html#appspec-file-example-ecs" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/code deploy/latest/user guide/reference-app spec-File-Example . html # app spec-File-Example-ECS</a></li><li id="aad3" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">ECS部署钩子:<a class="ae kj" href="https://docs.aws.amazon.com/codedeploy/latest/userguide/reference-appspec-file-structure-hooks.html#appspec-hooks-ecs" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/code deploy/latest/user guide/reference-app spec-file-structure-Hooks . html # app spec-Hooks-ECS</a></li></ul></div><div class="ab cl kc kd go ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="ha hb hc hd he"><p id="24f6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="jn">披露声明:2020资本一。观点是作者个人的观点。除非本帖中另有说明，否则Capital One不隶属于所提及的任何公司，也不被这些公司认可。使用或展示的所有商标和其他知识产权是其各自所有者的财产。</em></p></div></div>    
</body>
</html>