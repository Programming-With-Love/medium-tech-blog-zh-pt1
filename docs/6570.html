<html>
<head>
<title>Building a Puzzle Game Using Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Flutter构建一个益智游戏</h1>
<blockquote>原文：<a href="https://medium.com/quick-code/building-a-puzzle-game-using-flutter-6f629873102d?source=collection_archive---------1-----------------------#2019-02-16">https://medium.com/quick-code/building-a-puzzle-game-using-flutter-6f629873102d?source=collection_archive---------1-----------------------#2019-02-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/fe8effff120b62cdae87f9412b7dd086.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jEalVQPxuMCjFasEqZb3dQ.png"/></div></div></figure><p id="b1dd" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">你好。今天我想向你展示如何使用Flutter构建一个益智游戏。这在iOS和Android设备上都可以使用。我们过去已经在Android中开发了一个益智游戏，你可以在这里查看。</p><p id="7322" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你还没有安装Flutter，请从这里开始。你可以从<a class="ae jn" href="https://flutter.io/docs/get-started/install" rel="noopener ugc nofollow" target="_blank"> Flutter网站</a>找到如何安装。</p><h1 id="8312" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">项目设置</h1><p id="7d10" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">一旦你做好了一切准备，开始在Android Studio中创建一个新的Flutter项目:</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kr"><img src="../Images/1ff08634d7504e266e090e1057a62913.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UhK4vJcC7DWMdhXk1Py5qA.png"/></div></div></figure><p id="62a1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在下一个屏幕中，选择创建一个<strong class="ir hi"> Flutter应用程序</strong>，然后将新项目命名为<code class="du kw kx ky kz b">flutter_puzzle</code>，并使用自己的公司或个人域名进行包名生成。我将使用<code class="du kw kx ky kz b">dragosholban.com</code>，所以包名将最终是<code class="du kw kx ky kz b">com.dragosholban.flutterpuzzle</code>。如果我们选择包含Kotlin或Swift支持，这并不重要，因为我们不需要为这个应用程序编写任何原生的Android或iOS代码。</p><p id="16f0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">新项目生成后，在模拟器或真实设备上运行它，以确保一切正常。</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es la"><img src="../Images/40390f31816db758ee7df8baecd19084.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S4lAjxQ3Rqkakp9HCp4SQw.jpeg"/></div></div></figure><p id="25db" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了完成我们的设置，打开<code class="du kw kx ky kz b">lib/main.dart</code>文件并用下面的内容替换它。我们将删除Flutter生成的示例功能，并将其替换为我们应用程序的起点:</p><pre class="ks kt ku kv fd lb kz lc ld aw le bi"><span id="3d40" class="lf jp hh kz b fi lg lh l li lj">import 'package:flutter/material.dart';<br/><br/>void main() =&gt; runApp(MyApp());<br/><br/>class MyApp extends StatelessWidget {<br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return MaterialApp(<br/>      title: 'Flutter Puzzle',<br/>      theme: ThemeData(<br/>        primarySwatch: Colors.<em class="lk">blue</em>,<br/>      ),<br/>      home: MyHomePage(title: 'Flutter Puzzle'),<br/>    );<br/>  }<br/>}<br/><br/>class MyHomePage extends StatefulWidget {<br/>  final String title;<br/><br/>  MyHomePage({Key key, this.title}) : super(key: key);<br/><br/>  @override<br/>  _MyHomePageState createState() =&gt; _MyHomePageState();<br/>}<br/><br/>class _MyHomePageState extends State&lt;MyHomePage&gt; {<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return Scaffold(<br/>      appBar: AppBar(<br/>        title: Text(widget.title),<br/>      ),<br/>      body: SafeArea(<br/>        child: new Center(<br/>          child: new Text('No image selected.'),<br/>        ),<br/>      ),<br/>      floatingActionButton: FloatingActionButton(<br/>        onPressed: () =&gt; null,<br/>        tooltip: 'New Image',<br/>        child: Icon(Icons.<em class="lk">add</em>),<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="f2f1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如您所见，这只是一个空屏幕，中间有一个“<em class="lk">未选择图像</em>”文本，以及一个我们稍后将使用的浮动按钮:</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ll"><img src="../Images/2f7af11388892cf560508a488ec8a099.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KaZzm09YnTLpiXx_gUgf6g.png"/></div></div></figure><h1 id="7327" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">从相机或图库获取图像</h1><p id="1bd3" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">现在我们已经准备好了一切，让我们开始让我们的应用程序能够从手机的内部存储中加载图像或直接使用相机捕捉图像。为此，我们将使用一个名为<a class="ae jn" href="https://pub.dartlang.org/packages/image_picker" rel="noopener ugc nofollow" target="_blank"> image_picker </a>的Flutter插件。</p><p id="474f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在Flutter中安装新插件非常简单，只需将它们添加到<code class="du kw kx ky kz b">pubspec.yaml</code>文件中，然后从控制台或直接从Android Studio运行<code class="du kw kx ky kz b">flutter get</code>。</p><pre class="ks kt ku kv fd lb kz lc ld aw le bi"><span id="e1eb" class="lf jp hh kz b fi lg lh l li lj">...<br/>dependencies:<br/>  flutter:<br/>    sdk: flutter<br/><br/>  # The following adds the Cupertino Icons font to your application.<br/>  # Use with the CupertinoIcons class for iOS style icons.<br/>  cupertino_icons: ^0.1.2<br/><br/>  <strong class="kz hi">image_picker: ^0.4.10</strong><br/>...</span></pre><p id="e2d4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">因为我们已经添加了一个浮动按钮，让用户选择一个新的图像，让我们只做必要的修改，所以它只是这样做。首先，我们将为用户提供选择图像源的选项:<em class="lk">相机</em>或<em class="lk">图库</em>。对<code class="du kw kx ky kz b">main.dart</code>文件进行如下更改:</p><pre class="ks kt ku kv fd lb kz lc ld aw le bi"><span id="08bd" class="lf jp hh kz b fi lg lh l li lj">// ...<br/><br/>class _MyHomePageState extends State&lt;MyHomePage&gt; {<br/> @override<br/>   Widget build(BuildContext context) {<br/>     return Scaffold(<br/>       appBar: AppBar(<br/>         title: Text(widget.title),<br/>       ),<br/>       body: SafeArea(<br/>         child: new Center(<br/>           child: new Text('No image selected.'),<br/>         ),<br/>       ),<br/>       floatingActionButton: FloatingActionButton(<br/>         onPressed: () <strong class="kz hi">{<br/>           showModalBottomSheet(context: context,<br/>               builder: (BuildContext context) {<br/>                 return SafeArea(<br/>                   child: new Column(<br/>                     mainAxisSize: MainAxisSize.min,<br/>                     children: [<br/>                       new ListTile(<br/>                         leading: new Icon(Icons.camera),<br/>                         title: new Text('Camera'),<br/>                         onTap: () =&gt; null,<br/>                       ),<br/>                       new ListTile(<br/>                         leading: new Icon(Icons.image),<br/>                         title: new Text('Gallery'),<br/>                         onTap: () =&gt; null,<br/>                       ),<br/>                     ],<br/>                   ),<br/>                 );<br/>               }<br/>           );<br/>         },</strong><br/>         tooltip: 'New Image',<br/>         child: Icon(Icons.add),<br/>       ),<br/>     );<br/>   }<br/> }</span></pre><p id="9745" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，当你点击浮动按钮时，底部的菜单会出现，询问你想要的图片来源。确保一切顺利进行:</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es la"><img src="../Images/b48fa8f4e7e5a2704bc64b714438d4af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*77IVka01hFJj5LsyXm3SLw.jpeg"/></div></div></figure><p id="98a8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了实际获取图像，我们将创建一个新方法，当用户从上面选择<em class="lk">相机</em>或<em class="lk">图库</em>时，将调用该方法。我们将通过改变应用程序的状态，在图像加载时向用户显示图像。另外，请注意我们必须导入一些dart库和我们之前安装的<code class="du kw kx ky kz b">image_picker</code> Flutter插件:</p><pre class="ks kt ku kv fd lb kz lc ld aw le bi"><span id="1430" class="lf jp hh kz b fi lg lh l li lj"><strong class="kz hi">import 'dart:async';<br/>import 'dart:io';</strong><br/><br/>import 'package:flutter/material.dart';<br/><strong class="kz hi">import 'package:image_picker/image_picker.dart';</strong><br/><br/>void main() =&gt; runApp(MyApp());<br/><br/>// ...<br/><br/>class _MyHomePageState extends State&lt;MyHomePage&gt; {<br/>  <strong class="kz hi">File _image;<br/><br/>  Future getImage(ImageSource source) async {<br/>    var image = await ImagePicker.<em class="lk">pickImage</em>(source: source);<br/><br/>    if (image != null) {<br/>      setState(() {<br/>        _image = image;<br/>      });<br/>    }<br/>  }<br/></strong><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return Scaffold(<br/>      appBar: AppBar(<br/>        title: Text(widget.title),<br/>      ),<br/>      body: SafeArea(<br/>        child: new Center(<br/>          child: <strong class="kz hi">_image == null<br/>            ? new Text('No image selected.')<br/>            : Image.file(_image)</strong><br/>        ),<br/>      ),<br/>      floatingActionButton: FloatingActionButton(<br/>        onPressed: () {<br/>          showModalBottomSheet&lt;void&gt;(context: context,<br/>              builder: (BuildContext context) {<br/>                return SafeArea(<br/>                  child: new Column(<br/>                    mainAxisSize: MainAxisSize.min,<br/>                    children: &lt;Widget&gt;[<br/>                      new ListTile(<br/>                        leading: new Icon(Icons.<em class="lk">camera</em>),<br/>                        title: new Text('Camera'),<br/>                        onTap: () {<br/>                          <strong class="kz hi">getImage(ImageSource.camera);<br/>                          // this is how you dismiss the modal bottom sheet after making a choice<br/>                          Navigator.<em class="lk">pop</em>(context);</strong><br/>                        },<br/>                      ),<br/>                      new ListTile(<br/>                        leading: new Icon(Icons.<em class="lk">image</em>),<br/>                        title: new Text('Gallery'),<br/>                        onTap: () {<br/>                          <strong class="kz hi">getImage(ImageSource.gallery);<br/>                          // dismiss the modal sheet<br/>                          Navigator.<em class="lk">pop</em>(context);</strong><br/>                        },<br/>                      ),<br/>                    ],<br/>                  ),<br/>                );<br/>              }<br/>          );<br/>        },<br/>        tooltip: 'New Image',<br/>        child: Icon(Icons.<em class="lk">add</em>),<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="8a7c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们需要做的最后一件事是添加一些iOS特定的权限细节。打开<code class="du kw kx ky kz b">ios/Runner/Info.plist</code>文件，在其中添加两行，如下所示:</p><pre class="ks kt ku kv fd lb kz lc ld aw le bi"><span id="f099" class="lf jp hh kz b fi lg lh l li lj">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd"&gt;<br/>&lt;plist version="1.0"&gt;<br/>&lt;dict&gt;<br/>    &lt;key&gt;CFBundleDevelopmentRegion&lt;/key&gt;<br/>    &lt;string&gt;en&lt;/string&gt;<br/>    ...<br/>    <strong class="kz hi">&lt;key&gt;NSPhotoLibraryUsageDescription&lt;/key&gt;<br/>    &lt;string&gt;The app needs to access the Photo Library in order to be able to load images from it.&lt;/string&gt;<br/>    &lt;key&gt;NSCameraUsageDescription&lt;/key&gt;<br/>    &lt;string&gt;The app needs to access the Camera in order to be able to get images from it.&lt;/string&gt;</strong><br/>&lt;/dict&gt;<br/>&lt;/plist&gt;</span></pre><p id="8e1b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">你现在可以测试应用程序，你应该能够在两个平台上加载图像或捕捉新的。完成检查后，转到下一部分。</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ll"><img src="../Images/87fa032850ca1c9b94788620357b915e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eqK9hdA-5K-btK5qQlli3g.png"/></div></div></figure><h1 id="c33c" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">将图像分割成拼图块</h1><p id="45d0" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">对于拼图的各个部分，我们将创建一个新的flutter小部件<code class="du kw kx ky kz b">PuzzlePiece</code>。在<code class="du kw kx ky kz b">lib</code>文件夹中创建一个新的<code class="du kw kx ky kz b">PuzzlePiece.dart</code>文件。</p><p id="7cf1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这个小部件将获取一个<code class="du kw kx ky kz b">image</code>并将其剪辑到一个<code class="du kw kx ky kz b">path</code>上，后者定义了我们的拼图块。它还需要知道它正在绘制的那块拼图的<code class="du kw kx ky kz b">row</code>和<code class="du kw kx ky kz b">column</code>以及整个拼图的最大行数/列数(<code class="du kw kx ky kz b">maxRow</code>和<code class="du kw kx ky kz b">maxCol</code>)。</p><pre class="ks kt ku kv fd lb kz lc ld aw le bi"><span id="e548" class="lf jp hh kz b fi lg lh l li lj">import 'dart:math';<br/><br/>import 'package:flutter/material.dart';<br/><br/>class PuzzlePiece extends StatefulWidget {<br/>  final Image image;<br/>  final Size imageSize;<br/>  final int row;<br/>  final int col;<br/>  final int maxRow;<br/>  final int maxCol;<br/><br/>  PuzzlePiece(<br/>      {Key key,<br/>        @required this.image,<br/>        @required this.imageSize,<br/>        @required this.row,<br/>        @required this.col,<br/>        @required this.maxRow,<br/>        @required this.maxCol})<br/>      : super(key: key);<br/><br/>  @override<br/>  PuzzlePieceState createState() {<br/>    return new PuzzlePieceState();<br/>  }<br/>}<br/><br/>class PuzzlePieceState extends State&lt;PuzzlePiece&gt; {<br/>  double top;<br/>  double left;<br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    final imageWidth = MediaQuery.<em class="lk">of</em>(context).size.width;<br/>    final imageHeight = MediaQuery.<em class="lk">of</em>(context).size.height * MediaQuery.<em class="lk">of</em>(context).size.width / widget.imageSize.width;<br/>    final pieceWidth = imageWidth / widget.maxCol;<br/>    final pieceHeight = imageHeight / widget.maxRow;<br/><br/>    if (top == null) {<br/>      top = Random().nextInt((imageHeight - pieceHeight).ceil()).toDouble();<br/>      top -= widget.row * pieceHeight;<br/>    }<br/>    if (left == null) {<br/>      left = Random().nextInt((imageWidth - pieceWidth).ceil()).toDouble();<br/>      left -= widget.col * pieceWidth;<br/>    }<br/><br/>    return Positioned(<br/>        top: top,<br/>        left: left,<br/>        width: imageWidth,<br/>        child: ClipPath(<br/>          child: CustomPaint(<br/>            foregroundPainter: PuzzlePiecePainter(widget.row, widget.col, widget.maxRow, widget.maxCol),<br/>            child: widget.image<br/>          ),<br/>        clipper: PuzzlePieceClipper(widget.row, widget.col, widget.maxRow, widget.maxCol),<br/>      ),<br/>    );<br/>  }<br/>}<br/><br/>// this class is used to clip the image to the puzzle piece path<br/>class PuzzlePieceClipper extends CustomClipper&lt;Path&gt; {<br/>  final int row;<br/>  final int col;<br/>  final int maxRow;<br/>  final int maxCol;<br/><br/>  PuzzlePieceClipper(this.row, this.col, this.maxRow, this.maxCol);<br/><br/>  @override<br/>  Path getClip(Size size) {<br/>    return getPiecePath(size, row, col, maxRow, maxCol);<br/>  }<br/><br/>  @override<br/>  bool shouldReclip(CustomClipper&lt;Path&gt; oldClipper) =&gt; false;<br/>}<br/><br/>// this class is used to draw a border around the clipped image<br/>class PuzzlePiecePainter extends CustomPainter {<br/>  final int row;<br/>  final int col;<br/>  final int maxRow;<br/>  final int maxCol;<br/><br/>  PuzzlePiecePainter(this.row, this.col, this.maxRow, this.maxCol);<br/><br/>  @override<br/>  void paint(Canvas canvas, Size size) {<br/>    final Paint paint = Paint()<br/>      ..color = Color(0x80FFFFFF)<br/>      ..style = PaintingStyle.stroke<br/>      ..strokeWidth = 1.0;<br/><br/>    canvas.drawPath(getPiecePath(size, row, col, maxRow, maxCol), paint);<br/>  }<br/><br/>  @override<br/>  bool shouldRepaint(CustomPainter oldDelegate) {<br/>    return false;<br/>  }<br/>}<br/><br/>// this is the path used to clip the image and, then, to draw a border around it; here we actually draw the puzzle piece<br/>Path getPiecePath(Size size, int row, int col, int maxRow, int maxCol) {<br/>  final width = size.width / maxCol;<br/>  final height = size.height / maxRow;<br/>  final offsetX = col * width;<br/>  final offsetY = row * height;<br/>  final bumpSize = height / 4;<br/><br/>  var path = Path();<br/>  path.moveTo(offsetX, offsetY);<br/><br/>  if (row == 0) {<br/>    // top side piece<br/>    path.lineTo(offsetX + width, offsetY);<br/>  } else {<br/>    // top bump<br/>    path.lineTo(offsetX + width / 3, offsetY);<br/>    path.cubicTo(offsetX + width / 6, offsetY - bumpSize, offsetX + width / 6 * 5, offsetY - bumpSize, offsetX + width / 3 * 2, offsetY);<br/>    path.lineTo(offsetX + width, offsetY);<br/>  }<br/><br/>  if (col == maxCol - 1) {<br/>    // right side piece<br/>    path.lineTo(offsetX + width, offsetY + height);<br/>  } else {<br/>    // right bump<br/>    path.lineTo(offsetX + width, offsetY + height / 3);<br/>    path.cubicTo(offsetX + width - bumpSize, offsetY + height / 6, offsetX + width - bumpSize, offsetY + height / 6 * 5, offsetX + width, offsetY + height / 3 * 2);<br/>    path.lineTo(offsetX + width, offsetY + height);<br/>  }<br/><br/>  if (row == maxRow - 1) {<br/>    // bottom side piece<br/>    path.lineTo(offsetX, offsetY + height);<br/>  } else {<br/>    // bottom bump<br/>    path.lineTo(offsetX + width / 3 * 2, offsetY + height);<br/>    path.cubicTo(offsetX + width / 6 * 5, offsetY + height - bumpSize, offsetX + width / 6, offsetY + height - bumpSize, offsetX + width / 3, offsetY + height);<br/>    path.lineTo(offsetX, offsetY + height);<br/>  }<br/><br/>  if (col == 0) {<br/>    // left side piece<br/>    path.close();<br/>  } else {<br/>    // left bump<br/>    path.lineTo(offsetX, offsetY + height / 3 * 2);<br/>    path.cubicTo(offsetX - bumpSize, offsetY + height / 6 * 5, offsetX - bumpSize, offsetY + height / 6, offsetX, offsetY + height / 3);<br/>    path.close();<br/>  }<br/><br/>  return path;<br/>}</span></pre><p id="8f08" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">回到<code class="du kw kx ky kz b">main.dart</code>文件，添加以下内容开始使用这个新的小部件:</p><pre class="ks kt ku kv fd lb kz lc ld aw le bi"><span id="7abe" class="lf jp hh kz b fi lg lh l li lj">import 'dart:async';<br/>import 'dart:io';<br/><br/>import 'package:flutter/material.dart';<br/>import 'package:image_picker/image_picker.dart';<br/><br/><strong class="kz hi">import 'package:flutter_puzzle/PuzzlePiece.dart';</strong><br/><br/>void main() =&gt; runApp(MyApp());<br/><br/>class MyApp extends StatelessWidget {<br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return MaterialApp(<br/>      title: 'Flutter Puzzle',<br/>      theme: ThemeData(<br/>        primarySwatch: Colors.<em class="lk">blue</em>,<br/>      ),<br/>      home: MyHomePage(title: 'Flutter Puzzle'),<br/>    );<br/>  }<br/>}<br/><br/>class MyHomePage extends StatefulWidget {<br/>  final String title;<br/>  <strong class="kz hi">final int rows = 3;<br/>  final int cols = 3;</strong><br/><br/>  MyHomePage({Key key, this.title}) : super(key: key);<br/><br/>  @override<br/>  _MyHomePageState createState() =&gt; _MyHomePageState();<br/>}<br/><br/>class _MyHomePageState extends State&lt;MyHomePage&gt; {<br/>  File _image;<br/>  <strong class="kz hi">List&lt;Widget&gt; pieces = [];</strong><br/><br/>  Future getImage(ImageSource source) async {<br/>    var image = await ImagePicker.<em class="lk">pickImage</em>(source: source);<br/><br/>    if (image != null) {<br/>      setState(() {<br/>        _image = image;<br/>        <strong class="kz hi">pieces.clear();</strong><br/>      });<br/><br/>      <strong class="kz hi">splitImage(Image.file(image));</strong><br/>    }<br/>  }<br/>  <br/>  <strong class="kz hi">// we need to find out the image size, to be used in the PuzzlePiece widget<br/>  Future&lt;Size&gt; getImageSize(Image image) async {<br/>    final Completer&lt;Size&gt; completer = Completer&lt;Size&gt;();<br/><br/>    image.image.resolve(const ImageConfiguration()).addListener(<br/>          (ImageInfo info, bool _) {<br/>        completer.complete(Size(<br/>          info.image.width.toDouble(),<br/>          info.image.height.toDouble(),<br/>        ));<br/>      },<br/>    );<br/><br/>    final Size imageSize = await completer.future;<br/><br/>    return imageSize;<br/>  }</strong><br/><br/>  <strong class="kz hi">// here we will split the image into small pieces using the rows and columns defined above; each piece will be added to a stack<br/>  void splitImage(Image image) async {<br/>    Size imageSize = await getImageSize(image);<br/><br/>    for (int x = 0; x &lt; widget.rows; x++) {<br/>      for (int y = 0; y &lt; widget.cols; y++) {<br/>        setState(() {<br/>          pieces.add(PuzzlePiece(key: GlobalKey(),<br/>              image: image,<br/>              imageSize: imageSize,<br/>              row: x,<br/>              col: y,<br/>              maxRow: widget.rows,<br/>              maxCol: widget.cols));<br/>        });<br/>      }<br/>    }<br/>  }</strong><br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    return Scaffold(<br/>      appBar: AppBar(<br/>        title: Text(widget.title),<br/>      ),<br/>      body: SafeArea(<br/>        child: new Center(<br/>          child: _image == null<br/>            ? new Text('No image selected.')<br/>            : <strong class="kz hi">Stack(children: pieces)</strong><br/>        ),<br/>      ),<br/>      floatingActionButton: FloatingActionButton(<br/>        onPressed: () {<br/>          showModalBottomSheet&lt;void&gt;(context: context,<br/>              builder: (BuildContext context) {<br/>                return SafeArea(<br/>                  child: new Column(<br/>                    mainAxisSize: MainAxisSize.min,<br/>                    children: &lt;Widget&gt;[<br/>                      new ListTile(<br/>                        leading: new Icon(Icons.<em class="lk">camera</em>),<br/>                        title: new Text('Camera'),<br/>                        onTap: () {<br/>                          getImage(ImageSource.camera);<br/>                          Navigator.<em class="lk">pop</em>(context);<br/>                        },<br/>                      ),<br/>                      new ListTile(<br/>                        leading: new Icon(Icons.<em class="lk">image</em>),<br/>                        title: new Text('Gallery'),<br/>                        onTap: () {<br/>                          getImage(ImageSource.gallery);<br/>                          Navigator.<em class="lk">pop</em>(context);<br/>                        },<br/>                      ),<br/>                    ],<br/>                  ),<br/>                );<br/>              }<br/>          );<br/>        },<br/>        tooltip: 'New Image',<br/>        child: Icon(Icons.<em class="lk">add</em>),<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><p id="f192" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你现在运行应用程序并加载一张图片，你会看到它被转换成多个拼图块，随机放置在屏幕上。</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lm"><img src="../Images/a2e62dcbffacdf3d35b010bc907762f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*URZGIsCZg2XbbVWj6Dn_sg.png"/></div></div></figure><h1 id="9810" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">四处移动拼图块，并咬合到位</h1><p id="b27b" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">接下来，我们将添加一个<a class="ae jn" href="https://docs.flutter.io/flutter/widgets/GestureDetector-class.html" rel="noopener ugc nofollow" target="_blank">颤动手势检测器</a>来允许用户在屏幕上移动(平移)棋子。当一个棋子接近它的最终位置时，我们将把它扣到位，并禁止移动。将突出显示的代码添加到<code class="du kw kx ky kz b">PuzzlePiece</code>小部件中，这样做:</p><pre class="ks kt ku kv fd lb kz lc ld aw le bi"><span id="aa24" class="lf jp hh kz b fi lg lh l li lj">class PuzzlePiece extends StatefulWidget {<br/>  final Image image;<br/>  final Size imageSize;<br/>  final int row;<br/>  final int col;<br/>  final int maxRow;<br/>  final int maxCol;<br/>  <strong class="kz hi">final Function bringToTop;<br/>  final Function sendToBack;</strong><br/><br/>  PuzzlePiece(<br/>      {Key key,<br/>        @required this.image,<br/>        @required this.imageSize,<br/>        @required this.row,<br/>        @required this.col,<br/>        @required this.maxRow,<br/>        @required this.maxCol,<br/>        <strong class="kz hi">@required this.bringToTop,<br/>        @required this.sendToBack</strong>})<br/>      : super(key: key);<br/><br/>  @override<br/>  PuzzlePieceState createState() {<br/>    return new PuzzlePieceState();<br/>  }<br/>}<br/><br/>class PuzzlePieceState extends State&lt;PuzzlePiece&gt; {<br/>  double top;<br/>  double left;<br/>  <strong class="kz hi">bool isMovable = true;</strong><br/><br/>  @override<br/>  Widget build(BuildContext context) {<br/>    final imageWidth = MediaQuery.<em class="lk">of</em>(context).size.width;<br/>    final imageHeight = MediaQuery.<em class="lk">of</em>(context).size.height * MediaQuery.<em class="lk">of</em>(context).size.width / widget.imageSize.width;<br/>    final pieceWidth = imageWidth / widget.maxCol;<br/>    final pieceHeight = imageHeight / widget.maxRow;<br/><br/>    if (top == null) {<br/>      top = Random().nextInt((imageHeight - pieceHeight).ceil()).toDouble();<br/>      top -= widget.row * pieceHeight;<br/>    }<br/>    if (left == null) {<br/>      left = Random().nextInt((imageWidth - pieceWidth).ceil()).toDouble();<br/>      left -= widget.col * pieceWidth;<br/>    }<br/><br/>    return Positioned(<br/>        top: top,<br/>        left: left,<br/>        width: imageWidth,<br/>        child: <strong class="kz hi">GestureDetector(<br/>          onTap: () {<br/>            if (isMovable) {<br/>              widget.bringToTop(widget);<br/>            }<br/>          },<br/>          onPanStart: (_) {<br/>            if (isMovable) {<br/>              widget.bringToTop(widget);<br/>            }<br/>          },<br/>          onPanUpdate: (dragUpdateDetails) {<br/>            if (isMovable) {<br/>              setState(() {<br/>                top += dragUpdateDetails.delta.dy;<br/>                left += dragUpdateDetails.delta.dx;<br/><br/>                if(-10 &lt; top &amp;&amp; top &lt; 10 &amp;&amp; -10 &lt; left &amp;&amp; left &lt; 10) {<br/>                  top = 0;<br/>                  left = 0;<br/>                  isMovable = false;<br/>                  widget.sendToBack(widget);<br/>                }<br/>              });<br/>            }<br/>          },<br/>          child:</strong> ClipPath(<br/>            child: widget.image,<br/>            clipper: PuzzlePieceClipper(widget.row, widget.col, widget.maxRow, widget.maxCol),<br/>          ),<br/>        <strong class="kz hi">),</strong><br/>    );<br/>  }<br/>}</span></pre><p id="9b05" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最后，将以下内容添加到<code class="du kw kx ky kz b">main.dart</code>文件中:</p><pre class="ks kt ku kv fd lb kz lc ld aw le bi"><span id="ea01" class="lf jp hh kz b fi lg lh l li lj">void splitImage(Image image) async {<br/>  Size imageSize = await getImageSize(image);<br/><br/>  for (int x = 0; x &lt; widget.rows; x++) {<br/>    for (int y = 0; y &lt; widget.cols; y++) {<br/>      setState(() {<br/>        pieces.add(PuzzlePiece(key: GlobalKey(),<br/>            image: image,<br/>            imageSize: imageSize,<br/>            row: x,<br/>            col: y,<br/>            maxRow: widget.rows,<br/>            maxCol: widget.cols,<br/>            <strong class="kz hi">bringToTop: this.bringToTop,<br/>            sendToBack: this.sendToBack</strong>));<br/>      });<br/>    }<br/>  }<br/>}<br/><br/><strong class="kz hi">// when the pan of a piece starts, we need to bring it to the front of the stack<br/>void bringToTop(Widget widget) {<br/>  setState(() {<br/>    pieces.remove(widget);<br/>    pieces.add(widget);<br/>  });<br/>}</strong><br/><br/><strong class="kz hi">// when a piece reaches its final position, it will be sent to the back of the stack to not get in the way of other, still movable, pieces<br/>void sendToBack(Widget widget) {<br/>  setState(() {<br/>    pieces.remove(widget);<br/>    pieces.insert(0, widget);<br/>  });<br/>}</strong></span></pre><p id="bd61" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">再次运行应用程序，选择一个图像，并尝试完成拼图！一切都应该运行良好，你可以祝贺自己制作了这么棒的应用程序…</p><p id="dc97" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">但是你可以自己做更多的事情来改进这个游戏！一件显而易见的事情，就是<strong class="ir hi">检查所有的部分是否到位，然后重启游戏</strong>。另一个是<strong class="ir hi">将app限制在纵向模式</strong>。但是我会让你自己发现如何做到这一点。(提示:对于后者，你必须分别配置iOS和Android的每个原生应用程序)。</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lm"><img src="../Images/37c1c761a0de4530422beb0cf12f9424.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fI693fjZTkgMB2QskH7ySQ.png"/></div></div></figure><p id="1952" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我希望你喜欢这个关于在Flutter中构建一个益智游戏的教程。请在评论中让我知道它是如何为你工作的，如果你有任何问题或建议，我可以用来改进它。你可以从<a class="ae jn" href="https://github.com/dragosholban/flutter_puzzle" rel="noopener ugc nofollow" target="_blank"> GitHub </a>获得最终代码，随心所欲地使用。谢谢！</p></div><div class="ab cl ln lo go lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ha hb hc hd he"><p id="ee20" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="lk">原载于2019年2月16日</em><a class="ae jn" href="https://dragosholban.com/2019/02/16/building-a-puzzle-game-using-flutter/" rel="noopener ugc nofollow" target="_blank"><em class="lk">【dragosholban.com</em></a><em class="lk">。</em></p></div></div>    
</body>
</html>