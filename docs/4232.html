<html>
<head>
<title>Notify RecyclerView On a Specific Item Update</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">åœ¨ç‰¹å®šé¡¹ç›®æ›´æ–°æ—¶é€šçŸ¥RecyclerView</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/google-developer-experts/notifying-recyclerview-on-a-specific-change-b36e6dc59e0f?source=collection_archive---------0-----------------------#2019-03-12">https://medium.com/google-developer-experts/notifying-recyclerview-on-a-specific-change-b36e6dc59e0f?source=collection_archive---------0-----------------------#2019-03-12</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="c8c1" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">å¶å°”å½“ä½¿ç”¨<a class="ae iw" href="https://developer.android.com/reference/android/support/v7/widget/RecyclerView" rel="noopener ugc nofollow" target="_blank"> <em class="ix"> RecyclerView </em> </a>æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›èƒ½å¤Ÿé€šçŸ¥ç‰¹å®šçš„æ›´æ–°ã€‚æˆ‘ä»¬æƒ³çŸ¥é“æ¡ç›®åœ¨åˆ—è¡¨ä¸­çš„ä½ç½®ï¼Œä»¥åŠå®ƒçš„æ›´æ–°(æ’å…¥ã€åˆ é™¤ã€æ›´æ”¹)ã€‚ä¹Ÿè®¸å…³äºè¿™æ¬¡æ›´æ–°æˆ‘ä»¬æƒ³ä¼ é€’æ›´å¤šçš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œæ›´æ”¹çš„åŸå› ã€åŸå§‹å±å¹•æˆ–å‘ç”Ÿæ—¥æœŸã€‚</h2></div><p id="0806" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated">çŸ¥é“äº†å…·ä½“çš„å˜åŒ–ï¼Œæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨<code class="du ju jv jw jx b">notifyItemAdded()</code>ï¼Œè€Œä¸æ˜¯<code class="du ju jv jw jx b">notifyItemSetChanged()</code>ï¼Œåè€…ä¼šéå†æ•´ä¸ªåˆ—è¡¨ã€‚</p><p id="d970" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated">è€å®è¯´ï¼Œä½¿ç”¨<a class="ae iw" href="https://proandroiddev.com/clean-easy-new-how-to-architect-your-app-part-5-list-update-afac69da0b5e" rel="noopener ugc nofollow" target="_blank"> <em class="jy">åˆ†é¡µåº“</em>æˆ–è€…ä»…ä»…æ˜¯<em class="jy"> DiffUtil </em> </a>ï¼Œé€šå¸¸éƒ½å¯ä»¥å®ç°è¿™ä¸ªåŠŸèƒ½ï¼Œè€Œä¸”æ€§èƒ½ä¹Ÿéå¸¸å¥½ã€‚ç„¶è€Œï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå®ƒä»ç„¶æ˜¯æˆ‘ä»¬æƒ³è¦ä¿å­˜çš„å¤šä½™å·¥ä½œã€‚</p><figure class="ka kb kc kd fd ke er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es jz"><img src="../Images/0dbf80467451796c40f203da61b1a7d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8s-VzNIcca2gZ3JNLseODw.jpeg"/></div></div></figure><h2 id="330e" class="kl km hh bd kn ko kp kq kr ks kt ku kv jh kw kx ky jl kz la lb jp lc ld le lf bi translated">å¦‚ä½•é€šçŸ¥åˆ—è¡¨ä¸­çš„æ›´æ”¹ï¼Ÿ</h2><p id="d395" class="pw-post-body-paragraph iy iz hh ja b jb lg ii jd je lh il jg jh li jj jk jl lj jn jo jp lk jr js jt ha bi translated"><a class="ae iw" href="https://developer.android.com/topic/libraries/architecture/livedata" rel="noopener ugc nofollow" target="_blank"> <em class="jy"> LiveData </em> </a>æ˜¯è§‚å¯Ÿå’Œé€šçŸ¥UIå˜åŒ–çš„ä¸€ä¸ªå¾ˆæ£’çš„å·¥å…·ã€‚å®ƒåŒ…è£…ä¸€ä¸ªå¯¹è±¡ï¼Œæ¯å½“è¿™ä¸ªå¯¹è±¡æ”¹å˜æ—¶ï¼Œ<em class="jy"> LiveData </em>é€šçŸ¥å®ƒæ‰€æœ‰çš„è§‚å¯Ÿè€…æ–°çš„å€¼ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬åœ¨LiveDataä¸­åŒ…è£…ä¸€ä¸ªé¡¹ç›®åˆ—è¡¨ï¼Œå¹¶ä¸”åˆ—è¡¨ä¸­çš„ä¸€ä¸ªé¡¹ç›®å‘ç”Ÿäº†å˜åŒ–ï¼Œé‚£ä¹ˆåˆ—è¡¨å¯¹è±¡æœ¬èº«ä¿æŒä¸å˜ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœæˆ‘ä»¬è¿˜æƒ³è®©è§‚å¯Ÿè€…å¾—åˆ°æ¡ç›®å˜åŒ–çš„é€šçŸ¥â€”â€”æˆ‘ä»¬éœ€è¦è¿™ä¹ˆå°çš„æŠ€å·§æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p id="3b16" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated">æ­¤å¤–ï¼Œå¦‚å‰æ‰€è¿°ï¼Œæˆ‘ä»¬å¸Œæœ›ä¿ç•™ä¸€äº›å…³äºå˜æ›´çš„ä¿¡æ¯ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™è§‚å¯Ÿè€…ã€‚æˆ‘ä»¬åº”è¯¥æ€æ ·åšå‘¢ï¼Ÿ</p><p id="0b21" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated">ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè¿™é‡Œæœ‰ä¸€ä¸ªæˆ‘ç”¨è¿‡å‡ æ¬¡çš„é£Ÿè°±:</p><p id="eda1" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated">è¿™ä¸ªå…·ä½“çš„ä¾‹å­æ˜¯å»ºç«‹åœ¨æˆ‘æ‰€åšçš„ä¸€ä¸ªä¾‹å­ä¹‹ä¸Šçš„ã€‚å®ƒå…è®¸ç”¨æˆ·é€‰æ‹©åœ¨é€šè¯è¿‡ç¨‹ä¸­è¦æ‰§è¡Œçš„æ“ä½œ(æ–‡æœ¬åˆ°è¯­éŸ³ã€å½•éŸ³ç­‰..)å¹¶ä½¿ç”¨Nexmo Voice APIæ¥æ‰§è¡Œå®ƒä»¬ã€‚æˆ‘åœ¨å¦ä¸€ç¯‡æ–‡ç« ä¸­å†™äº†æ›´å¤šå…³äºå®ƒçš„å†…å®¹<a class="ae iw" href="https://proandroiddev.com/moshi-polymorphic-adapter-is-d25deebbd7c5" rel="noopener ugc nofollow" target="_blank">ã€‚</a></p><p id="412c" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated">å¾ˆæ˜æ˜¾ï¼Œè¿™åªæ˜¯ä¸€ä¸ªæ¼”ç¤ºé¡¹ç›®ï¼Œä½†è¿™ä¸ªæƒ³æ³•åœ¨ä¸æ­¢ä¸€ä¸ªå¤æ‚çš„åº”ç”¨ç¨‹åºä¸­å¯¹æˆ‘å¾ˆæœ‰ç”¨ã€‚</p><h2 id="8f81" class="kl km hh bd kn ko kp kq kr ks kt ku kv jh kw kx ky jl kz la lb jp lc ld le lf bi translated">è®¾ç½®è¡¨ç¤ºå±‚</h2><p id="7fdd" class="pw-post-body-paragraph iy iz hh ja b jb lg ii jd je lh il jg jh li jj jk jl lj jn jo jp lk jr js jt ha bi translated"><a class="ae iw" href="https://proandroiddev.com/clean-easy-new-how-to-architect-your-app-part-1-e439668a523d" rel="noopener ugc nofollow" target="_blank">åœ¨ä¹‹å‰çš„å¸–å­ç³»åˆ—</a>ä¸­ï¼Œæˆ‘åˆ†äº«äº†æ„å»ºåº”ç”¨ç¨‹åºæ—¶æˆ‘å–œæ¬¢åº”ç”¨çš„æ¶æ„ï¼ŒåŒ…æ‹¬<em class="jy">è¡¨ç¤ºå±‚</em>ã€<em class="jy">åŸŸå±‚</em>å’Œ<em class="jy">æ•°æ®å±‚</em>ã€‚</p><p id="b84b" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated">æˆ‘çš„<em class="jy">å±•ç°</em>å±‚æŒæœ‰ä¸€ä¸ª<em class="jy"> UIModel </em>ï¼Œå®ƒæ‰©å±•äº†<a class="ae iw" href="https://developer.android.com/topic/libraries/architecture/viewmodel" rel="noopener ugc nofollow" target="_blank"> <em class="jy"> ViewModel </em> </a>ã€‚å®ƒçš„ä½œç”¨æ˜¯ä»¥æœ€ç®€å•çš„æ–¹å¼å‘<em class="jy">è¡¨ç¤º</em>æä¾›å®ƒéœ€è¦çš„æ•°æ®ï¼Œè¿™æ ·å°±æœ‰å°½å¯èƒ½å°‘çš„è®¡ç®—å’Œé€»è¾‘ã€‚</p><p id="ed5b" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<em class="jy"> UiModel </em>ä¿æŒ:</p><ul class=""><li id="e574" class="ll lm hh ja b jb jc je jf jh ln jl lo jp lp jt lq lr ls lt bi translated">è¦æ‹¨æ‰“çš„ç”µè¯å·ç </li><li id="078a" class="ll lm hh ja b jb lu je lv jh lw jl lx jp ly jt lq lr ls lt bi translated">æ‰“ç”µè¯çš„ç”µè¯å·ç </li><li id="e013" class="ll lm hh ja b jb lu je lv jh lw jl lx jp ly jt lq lr ls lt bi translated">è¦æ‰§è¡Œçš„æ“ä½œåˆ—è¡¨</li></ul><p id="0289" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated">æ¯å½“åŠ¨ä½œåˆ—è¡¨ä¸­æœ‰å˜åŒ–æ—¶ï¼Œæˆ‘ä»¬å¸Œæœ›é€šçŸ¥è§‚å¯Ÿè€…ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œé€šçŸ¥UIå’Œ<em class="jy"> RecyclerViewé€‚é…å™¨</em>ã€‚</p><p id="7035" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated">è¿™æ˜¯æˆ‘çš„ç”¨æˆ·ç•Œé¢æ¨¡å‹:</p><pre class="ka kb kc kd fd lz jx ma mb aw mc bi"><span id="73f1" class="kl km hh jx b fi md me l mf mg">class CallRequestUiModel : ViewModel() {<br/>    lateinit var toPhone: String<br/>    lateinit var fromPhone: String<br/><strong class="jx hi">    val actions = ListLiveData&lt;NccoAction&gt;()</strong><br/>}</span></pre><h2 id="491f" class="kl km hh bd kn ko kp kq kr ks kt ku kv jh kw kx ky jl kz la lb jp lc ld le lf bi translated">ä»€ä¹ˆæ˜¯<strong class="ak"> ListLiveData </strong>ï¼Ÿ</h2><p id="78f3" class="pw-post-body-paragraph iy iz hh ja b jb lg ii jd je lh il jg jh li jj jk jl lj jn jo jp lk jr js jt ha bi translated">å¦‚å‰æ‰€è¿°ï¼Œæˆ‘ä»¬éœ€è¦å‘<em class="jy"> LiveData </em>æ·»åŠ æ›´å¤šçš„ä¿¡æ¯å’Œé€»è¾‘ã€‚æ‰€ä»¥ï¼Œæˆ‘å»¶é•¿äº†ã€‚</p><p id="0f7d" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated">é¦–å…ˆï¼Œå®ƒåŒ…è£…äº†ä¸€ä¸ªç±»å‹ä¸º<strong class="ja hi"> <em class="jy"> ListHolder </em> </strong>çš„å€¼ï¼Œä»¥ä¿å­˜æˆ‘ä»¬éœ€è¦çš„æ‰€æœ‰ä¿¡æ¯ï¼Œè€Œä¸ä»…ä»…æ˜¯æ¡ç›®åˆ—è¡¨:</p><pre class="ka kb kc kd fd lz jx ma mb aw mc bi"><span id="fb96" class="kl km hh jx b fi md me l mf mg">class ListLiveData&lt;T&gt; : LiveData&lt;<strong class="jx hi">ListHolder</strong>&lt;T&gt;&gt;() {</span><span id="e46e" class="kl km hh jx b fi mh me l mf mg">}</span></pre><p id="342a" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<strong class="ja hi"> ListHolder </strong>ä¿å­˜é¡¹ç›®åˆ—è¡¨ã€å·²æ›´æ”¹é¡¹ç›®çš„ç´¢å¼•ä»¥åŠæ›´æ–°çš„ç±»å‹:</p><pre class="ka kb kc kd fd lz jx ma mb aw mc bi"><span id="9363" class="kl km hh jx b fi md me l mf mg">data class <strong class="jx hi">ListHolder</strong>&lt;T&gt;(val list: MutableList&lt;T&gt; = <em class="jy">mutableListOf</em>()) {<br/>    var indexChanged: Int = -1<br/>    var updateType: <strong class="jx hi">UpdateType</strong>? = null<br/>}</span></pre><p id="d819" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated"><strong class="ja hi"> <em class="jy"> UpdateType </em> </strong>æ˜¯æˆ‘åˆ›å»ºçš„ä¸€ä¸ªæšä¸¾ï¼Œå®ƒåŒ¹é…RecyclerViewå¯ä»¥åšçš„æ›´æ”¹ï¼Œå› æ­¤æˆ‘ä»¬èƒ½å¤Ÿé€šçŸ¥ç‰¹å®šçš„æ›´æ”¹:</p><pre class="ka kb kc kd fd lz jx ma mb aw mc bi"><span id="399b" class="kl km hh jx b fi md me l mf mg">private enum class UpdateType {<br/>    INSERT, REMOVE, CHANGE<br/>}</span></pre><p id="9bbf" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated">ç”±äº<strong class="ja hi"> UpdateType </strong>çš„å·¥ä½œå°†æ˜¯ç¡®å®šæˆ‘ä»¬è¦åœ¨é€‚é…å™¨ä¸Šè°ƒç”¨å“ªä¸ªæ–¹æ³•ï¼Œæˆ‘ä½¿ç”¨äº†å¾ˆé…·çš„Kotlinç‰¹æ€§ï¼Œå®ƒå…è®¸ä½ <a class="ae iw" href="https://kotlinlang.org/docs/reference/enum-classes.html#implementing-interfaces-in-enum-classes" rel="noopener ugc nofollow" target="_blank">ä½¿ç”¨æšä¸¾</a>å®ç°æ¥å£ã€‚</p><p id="cd58" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated"><strong class="ja hi">æ³¨</strong>:è¿™æ˜¯æˆ‘å–œæ¬¢Kotlinçš„ä¸€ä¸ªç‰¹æ€§ã€‚<strong class="ja hi">ä½†æ˜¯</strong>ï¼ç¡®ä¿ä¸è¦æ»¥ç”¨å®ƒã€‚å¯¹æˆ‘æ¥è¯´ï¼Œé‡è¦çš„æ˜¯ä¸è¦æ··æ·†æ¶æ„å±‚ã€‚å› ä¸ºåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒListHolder(å®ƒæ‹¥æœ‰UpdateType)å’Œå®ƒæ‰€åšçš„åŠ¨ä½œ(é€šçŸ¥é€‚é…å™¨)éƒ½å±äº<em class="jy">è¡¨ç¤ºå±‚</em>æˆ‘å¾ˆä¹æ„è¿™æ ·å®ç°å®ƒã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªå±äºUIçš„æšä¸¾å°†å®ç°ä½¿ç”¨æ•°æ®å±‚çš„æ–¹æ³•ï¼Œæˆ‘å°±ä¸å¤ªæ¨èå®ƒã€‚</p><pre class="ka kb kc kd fd lz jx ma mb aw mc bi"><span id="bcfc" class="kl km hh jx b fi md me l mf mg">private enum class <strong class="jx hi">UpdateType</strong> {</span><span id="c73c" class="kl km hh jx b fi mh me l mf mg">   abstract fun <strong class="jx hi">notifyChange</strong>(<br/>        adapter: RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt;,<br/>        indexChanged: Int<br/>    )</span><span id="10a3" class="kl km hh jx b fi mh me l mf mg">    <strong class="jx hi">INSERT</strong> {<br/>        override fun <strong class="jx hi">notifyChange</strong>(<br/>            adapter: RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt;,<br/>            indexChanged: Int) = adapter.notifyItemInserted(indexChanged)<br/>    },<br/>   <br/>  <strong class="jx hi">REMOVE</strong> {<br/>        override fun <strong class="jx hi">notifyChange</strong>(<br/>            adapter: RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt;,<br/>            indexChanged: Int) = adapter.notifyItemRemoved(indexChanged)<br/>    },</span><span id="2352" class="kl km hh jx b fi mh me l mf mg">    <strong class="jx hi">CHANGE</strong> {<br/>        override fun <strong class="jx hi">notifyChange</strong>(<br/>            adapter: RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt;,<br/>            indexChanged: Int) = adapter.notifyItemChanged(indexChanged)<br/>    };<br/><br/>}</span></pre><p id="e650" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated">è¿™ä¸ªæšä¸¾æ˜¯ç§æœ‰çš„ï¼Œæœ‰åŠ©äºæˆ‘ä¸Šé¢æåˆ°çš„å±‚çš„åˆ†ç¦»ã€‚è¿™æ ·ï¼Œåªæœ‰<strong class="ja hi">åˆ—è¡¨æŒæœ‰äºº</strong>(å³å·²æ›´æ”¹çš„é¡¹ç›®)èƒ½å¤Ÿåº”ç”¨å®ƒ:</p><pre class="ka kb kc kd fd lz jx ma mb aw mc bi"><span id="5913" class="kl km hh jx b fi md me l mf mg">data class <strong class="jx hi">ListHolder</strong>&lt;T&gt;(val list: MutableList&lt;T&gt; = <em class="jy">mutableListOf</em>()) {<br/>    var indexChanged: Int = -1<br/>    private var updateType: UpdateType? = null<br/><br/>//...<br/><br/>    fun <strong class="jx hi">applyChange</strong>(adapter: RecyclerView.Adapter&lt;RecyclerView.ViewHolder&gt;) {<br/><strong class="jx hi">        updateType?.notifyChange(adapter, indexChanged)<br/></strong>    }</span></pre><h2 id="36bb" class="kl km hh bd kn ko kp kq kr ks kt ku kv jh kw kx ky jl kz la lb jp lc ld le lf bi translated">é€šçŸ¥è§‚å¯Ÿè€…å˜åŒ–</h2><p id="4822" class="pw-post-body-paragraph iy iz hh ja b jb lg ii jd je lh il jg jh li jj jk jl lj jn jo jp lk jr js jt ha bi translated">åœ¨æˆ‘çš„MainActivity.onCreate()ä¸­(è¿™æ˜¯æˆ‘çš„<em class="jy">è¡¨ç¤º</em>å±‚ç»„ä»¶çš„èµ·ç‚¹)ï¼Œæˆ‘è¦æ±‚è§‚å¯ŸåŠ¨ä½œåˆ—è¡¨ä¸­çš„å˜åŒ–:</p><pre class="ka kb kc kd fd lz jx ma mb aw mc bi"><span id="ae56" class="kl km hh jx b fi md me l mf mg">uiModel.actions.observe(this, this)</span></pre><p id="eced" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated">ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œæˆ‘çš„<em class="jy"> MainActivity </em>ä¹Ÿå®ç°äº†<em class="jy"> Observer </em>ï¼Œå› æ­¤è¦†ç›–äº†<em class="jy"> onChanged() </em>ã€‚æ¯å½“<em class="jy"> actions </em>ä¸­çš„ä¸€ä¸ªé¡¹ç›®æ›´æ–°æ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦è¯·æ±‚<em class="jy">LiveData</em>(<em class="jy">list holder</em>)çš„æ–°å€¼æ¥åº”ç”¨é€‚é…å™¨ä¸Šçš„æ›´æ”¹ã€‚å€¼<em class="jy"> ListHolderï¼Œ</em>å·²ç»çŸ¥é“è¢«æ›´æ–°çš„ç¡®åˆ‡é¡¹ç›®ï¼Œä»¥åŠåœ¨é€‚é…å™¨ä¸Šåº”ç”¨ä»€ä¹ˆ:</p><pre class="ka kb kc kd fd lz jx ma mb aw mc bi"><span id="6413" class="kl km hh jx b fi md me l mf mg">override fun <strong class="jx hi">onChanged</strong>(value: ListHolder&lt;NccoAction&gt;?) {<br/>    list.<em class="jy">adapter</em>?.<em class="jy">let </em><strong class="jx hi">{<br/>        </strong>value?.applyChange(<strong class="jx hi">it</strong>)<br/>    <strong class="jx hi">}<br/></strong>}</span></pre><h2 id="e5ef" class="kl km hh bd kn ko kp kq kr ks kt ku kv jh kw kx ky jl kz la lb jp lc ld le lf bi translated">æ›´æ–°ä¸€ä¸ªé¡¹ç›®çœ‹èµ·æ¥åƒä»€ä¹ˆï¼Ÿ</h2><p id="695a" class="pw-post-body-paragraph iy iz hh ja b jb lg ii jd je lh il jg jh li jj jk jl lj jn jo jp lk jr js jt ha bi translated">UIå¯ä»¥è°ƒç”¨<em class="jy"> addItem()ã€removeItemAt()æˆ–setItem()ï¼Œ</em>å®é™…ä¸Šæ˜¯ä¼ é€’ç»™<em class="jy"> ListLiveData </em>å¤„ç†çš„:</p><p id="be82" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated">ä¾‹å¦‚ï¼Œç”¨æˆ·ç•Œé¢è°ƒç”¨:</p><pre class="ka kb kc kd fd lz jx ma mb aw mc bi"><span id="270a" class="kl km hh jx b fi md me l mf mg">fun <strong class="jx hi">addAction</strong>(action: NccoAction) {<br/>    uiModel.actions.addItem(action)<br/>}</span></pre><p id="3fa6" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated"><strong class="ja hi"> <em class="jy"> ListHolder </em> </strong>å°†æ‰§è¡Œæ›´æ–°çš„è¯·æ±‚ä¼ é€’ç»™<strong class="ja hi"> <em class="jy"> ListHolder </em> </strong>ï¼Œç„¶åé€šçŸ¥è§‚å¯Ÿè€…(æ­¤å¤„ä¸ºUI)æ›´æ–°ã€‚</p><pre class="ka kb kc kd fd lz jx ma mb aw mc bi"><span id="a595" class="kl km hh jx b fi md me l mf mg">class ListLiveData&lt;T&gt; : LiveData&lt;ListHolder&lt;T&gt;&gt;() {<br/><br/>    //...<br/><br/>    fun addItem(item: T, position: Int = <em class="jy">value</em>?.size() ?: 0) {<br/>        <em class="jy">value</em>?.addItem(position, item)<br/>        <em class="jy">value </em>= <em class="jy">value<br/><br/>    </em>}<br/><br/>    fun removeItemAt(position: Int) {<br/>        <em class="jy">value</em>?.removeItemAt(position)<br/>        <em class="jy">value </em>= <em class="jy">value<br/>    </em>}<br/><br/><br/>    fun setItem(position: Int, item: T) {<br/>        <em class="jy">value</em>?.setItem(position, item)<br/>        <em class="jy">value </em>= <em class="jy">value<br/>    </em>}<br/><br/><br/>}</span></pre><h2 id="a121" class="kl km hh bd kn ko kp kq kr ks kt ku kv jh kw kx ky jl kz la lb jp lc ld le lf bi translated">ä¸ºä»€ä¹ˆä»·å€¼=ä»·å€¼ï¼Ÿ</h2><p id="2936" class="pw-post-body-paragraph iy iz hh ja b jb lg ii jd je lh il jg jh li jj jk jl lj jn jo jp lk jr js jt ha bi translated">å¯èƒ½æœ‰ä¸€ç§æ›´ä¼˜é›…çš„æ–¹å¼æ¥åšåˆ°è¿™ä¸€ç‚¹ğŸ¤·â€â™€ ï¸å¦‚å‰æ‰€è¿°ï¼Œå› ä¸ºæˆ‘ä¸æ›´æ–°å€¼æœ¬èº«(ListHolderå¯¹è±¡)ï¼Œè€Œåªæ›´æ–°å®ƒçš„å†…å®¹ï¼Œæ‰€ä»¥æ›´æ–°ä¸ä¼šä½œä¸ºå€¼çš„å˜åŒ–å‘é€ç»™è§‚å¯Ÿè€…ã€‚<em class="jy"> LiveData </em>åªæœ‰åœ¨<em class="jy"> setValue() </em>è¢«è°ƒç”¨æ—¶æ‰ä¼šå°†å˜æ›´å‘é€ç»™è§‚å¯Ÿè€…ã€‚æ‰€ä»¥æˆ‘é€šè¿‡ä½¿ç”¨å…·æœ‰ç›¸åŒå€¼çš„setValue()æ¥æ¬ºéª—å®ƒğŸ˜¬</p><pre class="ka kb kc kd fd lz jx ma mb aw mc bi"><span id="50f3" class="kl km hh jx b fi md me l mf mg">From source code of LiveData.java</span><span id="19bc" class="kl km hh jx b fi mh me l mf mg">@MainThread<br/>protected void setValue(T value) {<br/>    <em class="jy">assertMainThread</em>("setValue");<br/>    mVersion++;<br/>    mData = value;<br/>    dispatchingValue(null);<br/>}</span></pre><p id="d0cd" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated">å…³äº<em class="jy"> ListLiveDataçš„å¦ä¸€ä¸ªè¯´æ˜:</em></p><p id="3f46" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated">ä¸ºäº†æ–¹ä¾¿èµ·è§ï¼Œä¸ºäº†ä½¿å®ƒè¡¨ç°å¾—æ›´listä¸€Listï¼Œæˆ‘å®ç°äº†2ä¸ªæ–¹æ³•:</p><pre class="ka kb kc kd fd lz jx ma mb aw mc bi"><span id="ab46" class="kl km hh jx b fi md me l mf mg">class ListLiveData&lt;T&gt; : LiveData&lt;ListHolder&lt;T&gt;&gt;() {<br/><br/>    val <strong class="jx hi">size</strong>: Int get() {<br/>            return <em class="jy">value</em>?.size() ?: -1<br/>    }</span><span id="8e5b" class="kl km hh jx b fi mh me l mf mg">    <strong class="jx hi">operator</strong> fun <strong class="jx hi">get(position: Int)</strong>: T? {<br/>        return <em class="jy">value</em>?.list?.get(position)<br/>    }<br/><br/>}</span></pre><p id="4162" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated">ä¾‹å¦‚ï¼Œ<code class="du ju jv jw jx b"><strong class="ja hi">size():</strong></code>ç”¨äº<em class="jy"> Adapter.getItemCount() </em></p><pre class="ka kb kc kd fd lz jx ma mb aw mc bi"><span id="3e3c" class="kl km hh jx b fi md me l mf mg">override fun getItemCount(): Int {<br/>    return actions.size<br/>}</span></pre><p id="633e" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated"><code class="du ju jv jw jx b"><strong class="ja hi">operator fun get()</strong></code>æ˜¯ä»åˆ—è¡¨ä¸­è·å–ä¸€ä¸ªç‰¹å®šçš„é¡¹ç›®ï¼Œä¾‹å¦‚åœ¨<em class="jy">adapter . onbindviewholder():</em>ä¸Š</p><pre class="ka kb kc kd fd lz jx ma mb aw mc bi"><span id="4e88" class="kl km hh jx b fi md me l mf mg">override fun onBindViewHolder(holder: NccoCompVH, index: Int) {<br/>    actions[index]?.<em class="jy">let </em><strong class="jx hi">{ </strong>holder.bind(<strong class="jx hi">it</strong>) <strong class="jx hi">}<br/></strong>}</span></pre><h1 id="6704" class="mi km hh bd kn mj mk ml kr mm mn mo kv in mp io ky iq mq ir lb it mr iu le ms bi translated">è®©æˆ‘ä»¬çœ‹çœ‹æ•´ä¸ªæµç¨‹</h1><figure class="ka kb kc kd fd ke er es paragraph-image"><div role="button" tabindex="0" class="kf kg di kh bf ki"><div class="er es mt"><img src="../Images/85f7dd50bf33dfc0664c5a246773c6b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*afd3onTvWuxsqrDT8sP5Pw.gif"/></div></div></figure><ol class=""><li id="a9ec" class="ll lm hh ja b jb jc je jf jh ln jl lo jp lp jt mu lr ls lt bi translated"><em class="jy"> UI </em>è¦æ±‚<em class="jy"> ListLiveData </em>æ›´æ–°åˆ—è¡¨é¡¹â†’</li><li id="c920" class="ll lm hh ja b jb lu je lv jh lw jl lx jp ly jt mu lr ls lt bi translated"><em class="jy">åˆ—è¡¨ç›´æ’­æ•°æ®</em>è¦æ±‚<em class="jy">åˆ—è¡¨æŒæœ‰è€…</em>ä¿å­˜æ›´æ–°ä¿¡æ¯â†’</li><li id="49e1" class="ll lm hh ja b jb lu je lv jh lw jl lx jp ly jt mu lr ls lt bi translated"><em class="jy"> ListLiveData </em>è®¾ç½®å…¶å€¼ï¼Œå¹¶å°†æ›´æ”¹å‘é€ç»™<em class="jy">è§‚å¯Ÿå™¨</em></li><li id="c23c" class="ll lm hh ja b jb lu je lv jh lw jl lx jp ly jt mu lr ls lt bi translated"><em class="jy">è§‚å¯Ÿè€…</em> (UI) <em class="jy"> onChange() </em>ç”¨æ–°å€¼è°ƒç”¨ï¼Œè¯¥å€¼åœ¨ç±»å‹<em class="jy">åˆ—è¡¨æ¡†</em>ä¸Š</li><li id="df21" class="ll lm hh ja b jb lu je lv jh lw jl lx jp ly jt mu lr ls lt bi translated"><em class="jy"> UI </em>è¦æ±‚æ–°å€¼<em class="jy">list holder</em>åº”ç”¨å…¶ä¿å­˜çš„æ•°æ®çš„æ›´æ–°</li><li id="9762" class="ll lm hh ja b jb lu je lv jh lw jl lx jp ly jt mu lr ls lt bi translated"><em class="jy"> UpdateTypeï¼Œ</em>åŒ…å«åœ¨<em class="jy"> ListHolder </em>ä¸­ï¼Œé€šçŸ¥é€‚é…å™¨æ›´æ–°</li><li id="7cb2" class="ll lm hh ja b jb lu je lv jh lw jl lx jp ly jt mu lr ls lt bi translated">é€‚é…å™¨åº”ç”¨ç‰¹å®šçš„é¡¹ç›®æ›´æ–°(ä½ ä¹Ÿå¯ä»¥ä¼ é€’æ›´å¤šçš„ä¿¡æ¯ï¼Œåšä»»ä½•ä½ æƒ³åšçš„äº‹æƒ…ï¼)</li><li id="7afd" class="ll lm hh ja b jb lu je lv jh lw jl lx jp ly jt mu lr ls lt bi translated">å¤§å®¶éƒ½å¾ˆå¼€å¿ƒï¼ï¼</li></ol><h1 id="2541" class="mi km hh bd kn mj mk ml kr mm mn mo kv in mp io ky iq mq ir lb it mr iu le ms bi translated">å°±æ˜¯è¿™æ ·ï¼</h1><p id="2655" class="pw-post-body-paragraph iy iz hh ja b jb lg ii jd je lh il jg jh li jj jk jl lj jn jo jp lk jr js jt ha bi translated">å°±è¿™äº›ï¼Œå¸Œæœ›æœ‰å¸®åŠ©:)</p><p id="5467" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated">è¿™é‡Œæ˜¯Githubä¸Šè¿™ä¸ªä¾‹å­çš„ä»£ç </p><p id="68c8" class="pw-post-body-paragraph iy iz hh ja b jb jc ii jd je jf il jg jh ji jj jk jl jm jn jo jp jq jr js jt ha bi translated">ç¼–ç å¿«ä¹ï¼æ„Ÿè°¢æ‚¨çš„é˜…è¯»ã€‚<a class="ae iw" href="https://twitter.com/BrittBarak" rel="noopener ugc nofollow" target="_blank">æ­¤å¤„(ä¸Š<em class="jy">æ¨ç‰¹</em>å…¶å®)</a>æé—®ğŸ™ŒğŸ™ğŸ˜âœŒ</p></div></div>    
</body>
</html>