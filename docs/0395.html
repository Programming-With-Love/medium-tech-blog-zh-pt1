<html>
<head>
<title>Subscriptions 101 for Android apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android应用的订阅101</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/subscriptions-101-for-android-apps-b7005a7e93a6?source=collection_archive---------3-----------------------#2019-04-03">https://medium.com/androiddevelopers/subscriptions-101-for-android-apps-b7005a7e93a6?source=collection_archive---------3-----------------------#2019-04-03</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="f11b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jc" href="https://developer.android.com/google/play/billing/billing_subscriptions" rel="noopener ugc nofollow" target="_blank">订阅Google Play账单</a>是拓展业务的绝佳方式。然而，在你的Android应用程序和后端服务器之间进行协调可能会令人生畏。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/82459db0fc8c4fe6c454de5767461c33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UvuzX1CDUzXPCOc60H9AVA.png"/></div></div></figure><p id="693b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jc" href="https://www.youtube.com/playlist?list=PLWz5rJ2EKKc9J8ylTbNo1mnwciEyMbxZG" rel="noopener ugc nofollow" target="_blank">订阅101视频系列</a>将帮助您了解订阅难题的所有部分是如何组合在一起的，包括基本的服务器设置、<a class="ae jc" href="https://developer.android.com/google/play/billing/realtime_developer_notifications" rel="noopener ugc nofollow" target="_blank">实时开发者通知</a>、<a class="ae jc" href="https://developer.android.com/google/play/billing/billing_subscriptions#Allow-upgrade" rel="noopener ugc nofollow" target="_blank">升级和降级</a>、<a class="ae jc" rel="noopener" href="/androiddevelopers/implementing-linkedpurchasetoken-correctly-to-prevent-duplicate-subscriptions-82dfbf7167da"> linkedPurchaseToken </a>、<a class="ae jc" href="https://developer.android.com/google/play/billing/billing_subscriptions#account-hold---subscription_on_hold" rel="noopener ugc nofollow" target="_blank">宽限期</a>等等。</p><h1 id="a630" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">了解订阅</h1><p id="44e3" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">第一个视频概述了将在整个视频系列中使用的术语，并描述了您将需要的各种组件，包括:您的Android应用程序、后端服务器、<a class="ae jc" href="https://developer.android.com/google/play/billing/billing_library_overview" rel="noopener ugc nofollow" target="_blank"> Google Play计费库</a>、<a class="ae jc" href="https://developers.google.com/android-publisher/" rel="noopener ugc nofollow" target="_blank"> Google Play开发者API </a>和<a class="ae jc" href="https://developer.android.com/google/play/billing/realtime_developer_notifications" rel="noopener ugc nofollow" target="_blank"> Google Cloud Pub/Sub </a>。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ks kt l"/></div></figure><h1 id="c5c0" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">订阅购买流程</h1><p id="031d" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">此视频描述了订阅的购买流程。使用<a class="ae jc" href="https://developer.android.com/google/play/billing/billing_library_overview" rel="noopener ugc nofollow" target="_blank"> Google Play计费库</a>，你可以<a class="ae jc" href="https://developer.android.com/reference/com/android/billingclient/api/BillingClient#queryPurchases(java.lang.String)" rel="noopener ugc nofollow" target="_blank">检查现有订阅</a>和<a class="ae jc" href="https://developer.android.com/reference/com/android/billingclient/api/BillingClient#launchBillingFlow(android.app.Activity,%20com.android.billingclient.api.BillingFlowParams)" rel="noopener ugc nofollow" target="_blank">启动新注册的计费流程</a>。购买成功后，您将获得一个<a class="ae jc" href="https://developer.android.com/google/play/billing/billing_overview#purchase-tokens-and-order-ids" rel="noopener ugc nofollow" target="_blank">购买令牌</a>和<a class="ae jc" href="https://developer.android.com/google/play/billing/billing_overview#purchase-tokens-and-order-ids" rel="noopener ugc nofollow" target="_blank">订单ID </a>，分别代表用户的权限和与Google的交易。在您的安全后端服务器上跟踪这些信息，以便正确授予对您的产品或服务的访问权限。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ks kt l"/></div></figure><h1 id="9323" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">实时开发者通知</h1><p id="a307" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated"><a class="ae jc" href="https://developer.android.com/google/play/billing/realtime_developer_notifications" rel="noopener ugc nofollow" target="_blank">实时开发者通知(RTDN) </a>允许您通过<a class="ae jc" href="https://cloud.google.com/pubsub/docs/" rel="noopener ugc nofollow" target="_blank"> Google Cloud Pub/Sub </a>向您的服务器发送通知，了解最新的订阅状态。</p><p id="b88f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当您收到RTDN通知时，验证该通知中包含的购买令牌，并使用<a class="ae jc" href="https://developers.google.com/android-publisher/" rel="noopener ugc nofollow" target="_blank"> Google Play开发者API </a>检索关于该订阅的<a class="ae jc" href="https://developers.google.com/android-publisher/api-ref/purchases/subscriptions" rel="noopener ugc nofollow" target="_blank">详细信息</a>。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ks kt l"/></div></figure><h1 id="c023" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">升级和降级</h1><p id="6ea1" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">你可以让用户<a class="ae jc" href="https://developer.android.com/google/play/billing/billing_subscriptions#Allow-upgrade" rel="noopener ugc nofollow" target="_blank">使用<a class="ae jc" href="https://developer.android.com/google/play/billing/billing_library_overview" rel="noopener ugc nofollow" target="_blank"> Google Play计费库</a>在你的应用中升级和降级</a>订阅。首先，验证用户是否拥有当前对<a class="ae jc" href="https://developer.android.com/reference/com/android/billingclient/api/BillingClient#queryPurchases(java.lang.String)" rel="noopener ugc nofollow" target="_blank"> queryPurchases() </a>的订阅。然后使用将被替换的订阅的Sku调用<a class="ae jc" href="https://developer.android.com/reference/com/android/billingclient/api/BillingFlowParams.Builder.html#setOldSku(java.lang.String)" rel="noopener ugc nofollow" target="_blank"> setOldSku() </a>。最后，使用新的Sku套餐调用<a class="ae jc" href="https://developer.android.com/reference/com/android/billingclient/api/BillingFlowParams.Builder.html#setOldSku(java.lang.String)" rel="noopener ugc nofollow" target="_blank"> setSku() </a>。这将返回代表升级或降级订阅的新购买令牌。确保<a class="ae jc" rel="noopener" href="/androiddevelopers/implementing-linkedpurchasetoken-correctly-to-prevent-duplicate-subscriptions-82dfbf7167da">正确处理linkedPurchaseToken </a>。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ks kt l"/></div></figure><h1 id="a1ab" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">宽限期</h1><p id="6f77" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">本视频介绍了如何为订阅设置一个<a class="ae jc" href="https://developer.android.com/google/play/billing/billing_subscriptions#user-is-in-a-grace-period---subscription_in_grace_period" rel="noopener ugc nofollow" target="_blank">宽限期</a>，在续订失败的情况下，允许用户在短时间内修改支付信息，从而帮助您留住用户。</p><p id="941d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在Google Play控制台中，启用宽限期，并在每个订阅的设置中选择其时间长度。当您收到通知您用户处于宽限期的RTDN时，请使用<a class="ae jc" href="https://developers.google.com/android-publisher/" rel="noopener ugc nofollow" target="_blank"> Google Play开发者API </a>验证订阅状态。然后，在你的应用程序中给用户提供一个通知，通知中有一个<a class="ae jc" href="https://developer.android.com/google/play/billing/billing_subscriptions#deep-links-manage-subs" rel="noopener ugc nofollow" target="_blank">到<a class="ae jc" href="https://play.google.com/store/account/subscriptions" rel="noopener ugc nofollow" target="_blank">订阅中心</a>的深度链接</a>，这样他们就可以轻松地修改他们的支付设置。请记住，在宽限期内，用户应该保留对订阅的访问权限。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ks kt l"/></div></figure><h1 id="ba6a" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">账户持有</h1><p id="7dd4" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">该视频介绍了<a class="ae jc" href="https://developer.android.com/google/play/billing/billing_subscriptions#account-hold---subscription_on_hold" rel="noopener ugc nofollow" target="_blank">账户持有</a>，这是一种用户支付方式有问题时无需重新订阅即可轻松恢复应用内容的方式。这样可以增加用户留存。</p><p id="6349" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过在Google Play控制台的应用内产品部分的订阅选项卡中展开订阅设置菜单，为所有应用的订阅启用帐户保留。在你的后端，当你收到一个RTDN通知你一个用户的帐户被保留，使用<a class="ae jc" href="https://developers.google.com/android-publisher/" rel="noopener ugc nofollow" target="_blank"> Google Play开发者API </a>验证订阅状态。然后你应该阻止对订阅的访问，让用户知道他们的支付方式有问题，提供一个<a class="ae jc" href="https://developer.android.com/google/play/billing/billing_subscriptions#deep-links-manage-subs" rel="noopener ugc nofollow" target="_blank">到<a class="ae jc" href="https://play.google.com/store/account/subscriptions" rel="noopener ugc nofollow" target="_blank">订阅中心</a>的深度链接</a>，这样他们就可以轻松地修改他们的支付设置。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ks kt l"/></div></figure><h1 id="e5d4" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">取消并恢复</h1><p id="5565" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">允许用户在取消订阅后轻松恢复订阅有助于重新获得和保留以前活跃的用户。用户取消订阅后，他们将保留对您的应用程序内容的访问权限，直到订阅期到期。在此期间，他们可以在<a class="ae jc" href="https://play.google.com/store/account/subscriptions" rel="noopener ugc nofollow" target="_blank"> Google Play订阅中心</a>轻松恢复订阅。</p><p id="b907" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在收到RTDN通知您用户已取消订阅后，您可能希望在您的应用程序中显示一个关于即将到期日期的礼貌提醒，并提供一个到订阅中心的<a class="ae jc" href="https://developer.android.com/google/play/billing/billing_subscriptions#deep-links-manage-subs" rel="noopener ugc nofollow" target="_blank">深层链接</a>，以便他们轻松恢复订阅。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ks kt l"/></div></figure><h1 id="176a" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">延期计费</h1><p id="baae" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated"><a class="ae jc" href="https://developer.android.com/google/play/billing/billing_subscriptions#Defer" rel="noopener ugc nofollow" target="_blank">推迟计费日期</a>是向用户免费提供临时接入的一种简单方法，作为一种促销活动，或者如果他们经历了服务中断。使用<a class="ae jc" href="https://developers.google.com/android-publisher/api-ref/purchases/subscriptions/defer" rel="noopener ugc nofollow" target="_blank"> Google Play开发者API </a>，你可以提前订阅用户的计费日期，让他们在指定的时间内免费使用你的服务。订阅更新日期将进行调整，以反映传递给API的新计费日期。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ks kt l"/></div></figure><h1 id="ce9e" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">准备好了吗？走吧。</h1><p id="40b2" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">希望这些视频能帮助你了解如何在你的app中实现订阅！准备好了吗？走吧。</p><h1 id="ef26" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">资源</h1><ul class=""><li id="66ba" class="ku kv hh ig b ih kn il ko ip kw it kx ix ky jb kz la lb lc bi translated"><a class="ae jc" href="https://www.youtube.com/playlist?list=PLWz5rJ2EKKc9J8ylTbNo1mnwciEyMbxZG" rel="noopener ugc nofollow" target="_blank">订阅101 YouTube播放列表</a></li><li id="3164" class="ku kv hh ig b ih ld il le ip lf it lg ix lh jb kz la lb lc bi translated"><a class="ae jc" href="https://developer.android.com/google/play/billing/billing_library_overview" rel="noopener ugc nofollow" target="_blank"> Google Play计费库</a></li><li id="d6c3" class="ku kv hh ig b ih ld il le ip lf it lg ix lh jb kz la lb lc bi translated"><a class="ae jc" href="https://developers.google.com/android-publisher/api-ref/purchases/subscriptions#resource" rel="noopener ugc nofollow" target="_blank">来自Google Play开发者API的Subscriptions.purchase资源</a></li><li id="0cba" class="ku kv hh ig b ih ld il le ip lf it lg ix lh jb kz la lb lc bi translated">实现<a class="ae jc" rel="noopener" href="/androiddevelopers/implementing-linkedpurchasetoken-correctly-to-prevent-duplicate-subscriptions-82dfbf7167da"> linkedPurchaseToken </a></li><li id="dc94" class="ku kv hh ig b ih ld il le ip lf it lg ix lh jb kz la lb lc bi translated"><a class="ae jc" href="https://github.com/android/play-billing-samples" rel="noopener ugc nofollow" target="_blank"> Classy Taxi </a>，一款端到端订阅样本app</li></ul></div></div>    
</body>
</html>