<html>
<head>
<title>Assembling React application with Web Assembly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Web程序集组装React应用程序</h1>
<blockquote>原文：<a href="https://medium.com/globant/assembling-react-application-with-web-assembly-d683274d0afe?source=collection_archive---------0-----------------------#2020-07-30">https://medium.com/globant/assembling-react-application-with-web-assembly-d683274d0afe?source=collection_archive---------0-----------------------#2020-07-30</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="289d" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">从我之前的<a class="ae iw" rel="noopener" href="/globant/step-up-your-game-with-web-assembly-3f787fe6e95?source=friends_link&amp;sk=254233ca0a7a3793f9b6386c71bd1ca7">文章</a>继续，我们现在知道了什么是web组装，也就是WASM，以及它是多么的简单和有益！现在，我们通过让WASM与ReactJS合作来加强我们的游戏。</h2></div><figure class="iy iz ja jb fd jc er es paragraph-image"><div role="button" tabindex="0" class="jd je di jf bf jg"><div class="er es ix"><img src="../Images/1283fec1d49288eab9a51dfff71864d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RPTIj4R16S4rdJ4YUBcNEA.png"/></div></div><figcaption class="jj jk et er es jl jm bd b be z dx">ReactJs+ WASM</figcaption></figure><p id="8fa0" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">最初，我能够用c++和rust创建和编译wasm文件，但是缺少了一块拼图，这不允许我完成它。</p><blockquote class="kj"><p id="9e3b" class="kk kl hh bd km kn ko kp kq kr ks ki dx translated">"当你尝试得筋疲力尽时，再试一次."#克里斯·费罗斯</p></blockquote><p id="248a" class="pw-post-body-paragraph jn jo hh jp b jq kt ii js jt ku il jv jw kv jy jz ka kw kc kd ke kx kg kh ki ha bi translated">我喝了口咖啡，开始重新思考这件事，</p><blockquote class="ky kz la"><p id="6d6a" class="jn jo lb jp b jq jr ii js jt ju il jv lc jx jy jz ld kb kc kd le kf kg kh ki ha bi translated">"我正试图让WASM内心有所反应，你也必须如此！"</p><p id="4c0a" class="jn jo lb jp b jq jr ii js jt ju il jv lc jx jy jz ld kb kc kd le kf kg kh ki ha bi translated">“这也意味着我擅长Javascript，你也是！”</p></blockquote><p id="21f0" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">那么，为什么不用React来尝试AssemblyScript(它是typescript的一种变体)呢</p><blockquote class="kj"><p id="0e88" class="kk kl hh bd km kn ko kp kq kr ks ki dx translated">“在那里我找到了我丢失的那块！我会告诉你怎么做”</p></blockquote><p id="eace" class="pw-post-body-paragraph jn jo hh jp b jq kt ii js jt ku il jv jw kv jy jz ka kw kc kd ke kx kg kh ki ha bi translated">我正在创建2个独立的项目</p><ol class=""><li id="3eaf" class="lf lg hh jp b jq jr jt ju jw lh ka li ke lj ki lk ll lm ln bi translated"><em class="lb"> assemblyscript-wasm:它将拥有与我们的wasm相关的文件</em></li><li id="69d0" class="lf lg hh jp b jq lo jt lp jw lq ka lr ke ls ki lk ll lm ln bi translated"><em class="lb"> react-wasm:它用wasm加载器加载了react文件。</em></li></ol><p id="a5c1" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">如果你想要一个项目，而不是我创建的两个独立的项目，请随意。</p><blockquote class="kj"><p id="3b98" class="kk kl hh bd km kn ko kp kq kr ks ki dx translated">“那么，我们开始组装吧！”</p></blockquote><p id="10e9" class="pw-post-body-paragraph jn jo hh jp b jq kt ii js jt ku il jv jw kv jy jz ka kw kc kd ke kx kg kh ki ha bi translated">在汇编脚本中建立一个项目是迅速的，</p><p id="f145" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">使用初始化新项目</p><pre class="iy iz ja jb fd lt lu lv lw aw lx bi"><span id="aecf" class="ly lz hh lu b fi ma mb l mc md">npm init</span></pre><p id="3a80" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">并安装下面提到的加载程序和编译器，</p><pre class="iy iz ja jb fd lt lu lv lw aw lx bi"><span id="3d12" class="ly lz hh lu b fi ma mb l mc md">npm install — save @assemblyscript/loader</span><span id="2d9f" class="ly lz hh lu b fi me mb l mc md">npm install — save-dev assemblyscript</span></pre><p id="edbc" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">现在使用以下命令快速设置一个新的AssemblyScript项目</p><pre class="iy iz ja jb fd lt lu lv lw aw lx bi"><span id="bb6b" class="ly lz hh lu b fi ma mb l mc md">npx asinit .</span></pre><blockquote class="kj"><p id="4b6f" class="kk kl hh bd km kn mf mg mh mi mj ki dx translated">“别忘了复印一下。(点)"</p></blockquote><p id="3467" class="pw-post-body-paragraph jn jo hh jp b jq kt ii js jt ku il jv jw kv jy jz ka kw kc kd ke kx kg kh ki ha bi translated">它将为您创建目录结构和配置文件。</p><p id="75c6" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">就这样，您现在已经准备好将您的函数编译到WASM了。</p><p id="8f1c" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">如果你想知道更多关于配置和目录结构的信息，或者你被困在某个地方，那么汇编脚本快速入门部分将会帮助你，<a class="ae iw" href="https://www.assemblyscript.org/quick-start.html" rel="noopener ugc nofollow" target="_blank">链接</a></p><p id="0b50" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">打开汇编目录内的index.ts文件，你会看到<strong class="jp hi">添加</strong>功能已经存在，</p><pre class="iy iz ja jb fd lt lu lv lw aw lx bi"><span id="88da" class="ly lz hh lu b fi ma mb l mc md">export function concat(a: i32, b: i32): i32 {</span><span id="eb1f" class="ly lz hh lu b fi me mb l mc md">    return a + b</span><span id="2bd7" class="ly lz hh lu b fi me mb l mc md">}</span></pre><p id="b326" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我们将在这个文件中添加新的函数<strong class="jp hi"> concat </strong></p><pre class="iy iz ja jb fd lt lu lv lw aw lx bi"><span id="3df2" class="ly lz hh lu b fi ma mb l mc md">export function concat(a: string, b: string): string {</span><span id="33c1" class="ly lz hh lu b fi me mb l mc md">    return a + b</span><span id="c5af" class="ly lz hh lu b fi me mb l mc md">}</span></pre><p id="e58a" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">如果移除类型，这两个函数是相同的。一个是添加数字，另一个是连接字符串。</p><p id="bb5b" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">这里你可以有其他功能。</p><blockquote class="kj"><p id="6135" class="kk kl hh bd km kn ko kp kq kr ks ki dx translated">“你该编译它了”</p></blockquote><p id="450c" class="pw-post-body-paragraph jn jo hh jp b jq kt ii js jt ku il jv jw kv jy jz ka kw kc kd ke kx kg kh ki ha bi translated">🚀发出命令！</p><pre class="iy iz ja jb fd lt lu lv lw aw lx bi"><span id="97a7" class="ly lz hh lu b fi ma mb l mc md">npm run asbuild</span></pre><p id="41c3" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">你的优化。wasm文件将在构建文件夹中为您准备好。</p></div><div class="ab cl mk ml go mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ha hb hc hd he"><blockquote class="kj"><p id="b0d1" class="kk kl hh bd km kn ko kp kq kr ks ki dx translated">现在让我们创建react项目，</p></blockquote><pre class="mr ms mt mu mv lt lu lv lw aw lx bi"><span id="9b6e" class="ly lz hh lu b fi ma mb l mc md">npx create-react-app react-wasm</span></pre><p id="7a2b" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我们必须在react应用程序中加载wasm文件。因此，我们需要一个加载程序，我们有一个来自AssemblyScript的加载程序。使用下面的命令在react项目中安装加载程序。</p><pre class="iy iz ja jb fd lt lu lv lw aw lx bi"><span id="2051" class="ly lz hh lu b fi ma mb l mc md">npm install — save @assemblyscript/loader</span></pre><p id="b79f" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">既然加载程序已经可以使用了，</p><p id="e0f5" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">创建一个文件<em class="lb"> wasmLoader.js </em>并添加以下代码</p><pre class="iy iz ja jb fd lt lu lv lw aw lx bi"><span id="a984" class="ly lz hh lu b fi ma mb l mc md">const loader = require(“@assemblyscript/loader”);</span></pre><p id="0327" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我们将创建一个函数，在首次安装应用程序时加载wasm文件。</p><pre class="iy iz ja jb fd lt lu lv lw aw lx bi"><span id="76e3" class="ly lz hh lu b fi ma mb l mc md">export const loadWASM = () =&gt; {</span><span id="b1b4" class="ly lz hh lu b fi me mb l mc md">    return loader.instantiate(fetch(“optimized.wasm”))</span><span id="e77b" class="ly lz hh lu b fi me mb l mc md">    .then(result =&gt; {</span><span id="6391" class="ly lz hh lu b fi me mb l mc md">    //storing the response inside a wasm variable for now</span><span id="5b3e" class="ly lz hh lu b fi me mb l mc md">         wasm = result;</span><span id="46b0" class="ly lz hh lu b fi me mb l mc md">         return true;</span><span id="edec" class="ly lz hh lu b fi me mb l mc md">    })<br/>    .catch(error =&gt; {</span><span id="da18" class="ly lz hh lu b fi me mb l mc md">          console.error(‘Error loading WASM file’);</span><span id="54f5" class="ly lz hh lu b fi me mb l mc md">          return false;</span><span id="da89" class="ly lz hh lu b fi me mb l mc md">     })</span><span id="2955" class="ly lz hh lu b fi me mb l mc md">}</span></pre><p id="b362" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">汇编脚本为我们提供了不同的实例化方法。</p><p id="0c14" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">在这里，我使用了异步实例化方法，你可以有</p><p id="4101" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><em class="lb">实例化Sync </em> —从WebAssembly同步实例化AssemblyScript模块。模块或二进制缓冲区。不推荐。</p><p id="50da" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><em class="lb">实例化流</em> —从响应中异步实例化一个AssemblyScript模块，即通过fetch获得。</p><p id="ba78" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi">加载器</strong>基本上使用WebAssembly APIs来实例化该模块，但是在评估导出名称并为它们创建一个良好的对象结构时，还向它添加了额外的实用程序。</p><p id="413c" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi">结果</strong>我们例子中的对象包含</p><ol class=""><li id="97eb" class="lf lg hh jp b jq jr jt ju jw lh ka li ke lj ki lk ll lm ln bi translated"><em class="lb">导出(使用我们的函数add和concat) </em></li><li id="7a9c" class="lf lg hh jp b jq lo jt lp jw lq ka lr ke ls ki lk ll lm ln bi translated"><em class="lb">实例</em></li><li id="5aa2" class="lf lg hh jp b jq lo jt lp jw lq ka lr ke ls ki lk ll lm ln bi translated"><em class="lb">模块</em></li></ol><p id="a564" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我们现在将结果存储在wasm变量中。</p><p id="4c21" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">您可以在此 找到更多关于装载机<a class="ae iw" href="https://www.assemblyscript.org/loader.html#installation" rel="noopener ugc nofollow" target="_blank"> <em class="lb">的信息</em></a></p><p id="49d9" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">下一步是在我们的应用程序组件中调用这个<em class="lb"> loadWASM() </em>方法。</p><p id="1a33" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">所以打开<em class="lb"> app.js </em>，插入下面的代码</p><pre class="iy iz ja jb fd lt lu lv lw aw lx bi"><span id="c51c" class="ly lz hh lu b fi ma mb l mc md">const [wasmLoaded, setWasmLoaded] = useState(false)</span><span id="b135" class="ly lz hh lu b fi me mb l mc md">useEffect(() =&gt; {</span><span id="833b" class="ly lz hh lu b fi me mb l mc md">    loadWASM().then(result =&gt; setWasmLoaded(result));</span><span id="987b" class="ly lz hh lu b fi me mb l mc md">}, []);</span></pre><p id="dc7d" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">这里，装载时我们获取文件，成功时我们设置标志wasmLoaded。</p><p id="c4d4" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">既然WASM文件已经加载，我们可以在app.js中调用我们的WASM函数<em class="lb"> concat </em>和<em class="lb"> add </em></p><pre class="iy iz ja jb fd lt lu lv lw aw lx bi"><span id="f1cc" class="ly lz hh lu b fi ma mb l mc md">useEffect(() =&gt; {</span><span id="fcef" class="ly lz hh lu b fi me mb l mc md">    if (wasmLoaded) {</span><span id="7d0f" class="ly lz hh lu b fi me mb l mc md">      setConcat(concatString(‘React’, ‘WASM’));</span><span id="7eb2" class="ly lz hh lu b fi me mb l mc md">      setSum(addNumbers(4, 4));</span><span id="12bb" class="ly lz hh lu b fi me mb l mc md">    }</span><span id="f200" class="ly lz hh lu b fi me mb l mc md">}, [wasmLoaded])</span></pre><p id="7eec" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">这里，我们调用两个函数，第一个是concatString，第二个是addNumbers</p><p id="634e" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">让我们来定义这个函数</p><blockquote class="ky kz la"><p id="99a6" class="jn jo lb jp b jq jr ii js jt ju il jv lc jx jy jz ld kb kc kd le kf kg kh ki ha bi translated">wasmLoader.js</p></blockquote><pre class="iy iz ja jb fd lt lu lv lw aw lx bi"><span id="5e26" class="ly lz hh lu b fi ma mb l mc md">export const addNumbers = (a, b) =&gt; wasm.exports.add(a, b);</span></pre><blockquote class="kj"><p id="ba38" class="kk kl hh bd km kn mf mg mh mi mj ki dx translated">“上面的函数没什么复杂的。对！”</p></blockquote><p id="e4b0" class="pw-post-body-paragraph jn jo hh jp b jq kt ii js jt ku il jv jw kv jy jz ka kw kc kd ke kx kg kh ki ha bi translated">让我们看看我们的串联函数，</p><pre class="iy iz ja jb fd lt lu lv lw aw lx bi"><span id="6da1" class="ly lz hh lu b fi ma mb l mc md">export const concatString = (aStr, bStr) =&gt; {</span><span id="f381" class="ly lz hh lu b fi me mb l mc md">    const { concat } = wasm.exports;</span><span id="1db8" class="ly lz hh lu b fi me mb l mc md">    const { __allocString, __getString, __retain, __release } = wasm.exports;</span><span id="ab52" class="ly lz hh lu b fi me mb l mc md">    let aPtr = __retain(__allocString(aStr))</span><span id="1b9b" class="ly lz hh lu b fi me mb l mc md">    let bPtr = __retain(__allocString(bStr))</span><span id="078b" class="ly lz hh lu b fi me mb l mc md">    let cPtr = concat(aPtr, bPtr)</span><span id="43c5" class="ly lz hh lu b fi me mb l mc md">    let cStr = __getString(cPtr)</span><span id="c2b6" class="ly lz hh lu b fi me mb l mc md">    __release(aPtr)</span><span id="f448" class="ly lz hh lu b fi me mb l mc md">    __release(bPtr)</span><span id="e9ad" class="ly lz hh lu b fi me mb l mc md">    __release(cPtr)</span><span id="abbc" class="ly lz hh lu b fi me mb l mc md">    return cStr</span><span id="198e" class="ly lz hh lu b fi me mb l mc md">}</span></pre><p id="d7be" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">乍一看似乎很复杂但其实很简单。</p><p id="7ca2" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我来试着解释一下，我们wasm(AssemblyScript)函数中的字符串参数不能只是Javascript字符串，它需要在内存模块中分配。</p><p id="97ca" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">加载器确实为我们提供了可以在这里使用的功能。</p><p id="fc65" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">所以我们有<strong class="jp hi">_ _ alloct string</strong>，如果你正在使用数组，那么你将有<strong class="jp hi">_ _ alloct Array</strong>。</p><p id="7e30" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi"> __retain </strong>:保留对一个托管对象的引用，这样做是为了在我们使用它的时候，这个对象不会被收集。我们不保留concat函数返回的值。</p><p id="74ea" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi"> __getString </strong>:将一个字符串的值从模块的内存中复制到一个JavaScript字符串。</p><p id="a8cf" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi">_ _释放</strong>:释放之前保留的值</p><p id="4cd1" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">你一定在想，为什么我们不在add函数中做这些呢？</p><p id="1b9e" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">Add函数取<strong class="jp hi"> i32 </strong>为基本值，不是对象。所以不要保留或释放它们。</p><p id="4c1a" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">我们差不多完成了，是时候让它运行了。</p><p id="7364" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">从app.js中删除不需要的代码，最终文件将如下所示</p><blockquote class="ky kz la"><p id="3f2d" class="jn jo lb jp b jq jr ii js jt ju il jv lc jx jy jz ld kb kc kd le kf kg kh ki ha bi translated">App.js</p></blockquote><pre class="iy iz ja jb fd lt lu lv lw aw lx bi"><span id="65d6" class="ly lz hh lu b fi ma mb l mc md">import React, { useState, useEffect } from ‘react’;</span><span id="7191" class="ly lz hh lu b fi me mb l mc md">import logo from ‘./logo.svg’;</span><span id="5898" class="ly lz hh lu b fi me mb l mc md">import ‘./App.css’;</span><span id="d2cf" class="ly lz hh lu b fi me mb l mc md">import { concatString, addNumbers, loadWASM } from ‘./util/AssemblyLoader’;</span><span id="cffe" class="ly lz hh lu b fi me mb l mc md">function App() {</span><span id="370f" class="ly lz hh lu b fi me mb l mc md">  const [concat, setConcat] = useState(‘’);</span><span id="6480" class="ly lz hh lu b fi me mb l mc md">  const [sum, setSum] = useState();</span><span id="1e1f" class="ly lz hh lu b fi me mb l mc md">  const [wasmLoaded, setWasmLoaded] = useState(false)</span><span id="d257" class="ly lz hh lu b fi me mb l mc md">  useEffect(() =&gt; {</span><span id="8fda" class="ly lz hh lu b fi me mb l mc md">    loadWASM().then(result =&gt; setWasmLoaded(result));</span><span id="a93f" class="ly lz hh lu b fi me mb l mc md">  }, []);</span><span id="9640" class="ly lz hh lu b fi me mb l mc md">  useEffect(() =&gt; {</span><span id="b0ea" class="ly lz hh lu b fi me mb l mc md">    if (wasmLoaded) {</span><span id="bbac" class="ly lz hh lu b fi me mb l mc md">      setConcat(concatString(‘React’, ‘WASM’));</span><span id="ab68" class="ly lz hh lu b fi me mb l mc md">      setSum(addNumbers(4, 4));</span><span id="6d56" class="ly lz hh lu b fi me mb l mc md">    }</span><span id="1af5" class="ly lz hh lu b fi me mb l mc md">  }, [wasmLoaded])</span><span id="53f5" class="ly lz hh lu b fi me mb l mc md">return (</span><span id="f03a" class="ly lz hh lu b fi me mb l mc md">  &lt;div className=”App”&gt;</span><span id="a970" class="ly lz hh lu b fi me mb l mc md">    &lt;header className=”App-header”&gt;</span><span id="6543" class="ly lz hh lu b fi me mb l mc md">      &lt;p&gt;{concat}&lt;/p&gt;</span><span id="cad1" class="ly lz hh lu b fi me mb l mc md">      Gr{sum}!</span><span id="e0c9" class="ly lz hh lu b fi me mb l mc md">    &lt;/header&gt;</span><span id="6c69" class="ly lz hh lu b fi me mb l mc md">  &lt;/div&gt;</span><span id="d2d2" class="ly lz hh lu b fi me mb l mc md">  );</span><span id="2768" class="ly lz hh lu b fi me mb l mc md">}</span><span id="17d3" class="ly lz hh lu b fi me mb l mc md">export default App;</span></pre><p id="6c5e" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">🚀发出命令！</p><pre class="iy iz ja jb fd lt lu lv lw aw lx bi"><span id="111f" class="ly lz hh lu b fi ma mb l mc md">npm start</span></pre><blockquote class="kj"><p id="c3d1" class="kk kl hh bd km kn mf mg mh mi mj ki dx translated">“哎呀！我忘了说你需要复制优化过的。wasm文件复制到react-wasm项目的公共文件夹中。</p></blockquote><p id="29b2" class="pw-post-body-paragraph jn jo hh jp b jq kt ii js jt ku il jv jw kv jy jz ka kw kc kd ke kx kg kh ki ha bi translated">复制它，WASM文件就会加载到你的react应用中。</p><figure class="iy iz ja jb fd jc er es paragraph-image"><div class="er es mw"><img src="../Images/f4fc1fca1cf1f1f411613350484d5023.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*jxGxoRZCPYOSqK6m"/></div></figure><h1 id="9957" class="mx lz hh bd my mz na nb nc nd ne nf ng in nh io ni iq nj ir nk it nl iu nm nn bi translated">我们学到了什么？</h1><p id="fa81" class="pw-post-body-paragraph jn jo hh jp b jq no ii js jt np il jv jw nq jy jz ka nr kc kd ke ns kg kh ki ha bi translated">您可以使用AssemblyScript轻松集成WASM和ReactJs。然而，它也有一些缺点。你可以在这里 阅读更多关于它的<a class="ae iw" href="https://www.assemblyscript.org/loader.html#convenience-vs-efficiency" rel="noopener ugc nofollow" target="_blank"> <em class="lb">，自己决定是否需要在你的项目中使用它。这篇文章讲述了如何轻松地从react应用程序中与WASM函数进行交互。这就像为我打开了潘多拉的盒子，希望现在不会是你！</em></a></p></div><div class="ab cl mk ml go mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ha hb hc hd he"><blockquote class="kj"><p id="8e82" class="kk kl hh bd km kn ko kp kq kr ks ki dx translated">“感谢阅读这篇文章！”</p></blockquote></div></div>    
</body>
</html>