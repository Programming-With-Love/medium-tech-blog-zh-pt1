<html>
<head>
<title>How to Upload File in AJAX? Step By Step Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在AJAX中上传文件？逐步指南</h1>
<blockquote>原文：<a href="https://medium.com/edureka/upload-file-in-ajax-684efdbe70d?source=collection_archive---------2-----------------------#2019-09-23">https://medium.com/edureka/upload-file-in-ajax-684efdbe70d?source=collection_archive---------2-----------------------#2019-09-23</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/3a4f86c2ee5c1cd19f3c516507fa920d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*bkd9ABiy22NOnRkh7ME0lA.png"/></div></figure><p id="e886" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">上传文件对开发者来说是一项具有挑战性的任务，但是用Ajax上传文件呢？这是难以置信的简单！Ajax和浏览器支持的进步进一步减轻了文件上传的负担。HTML5 uploader提供了快速解决方案，但它不安全，并且不能在所有浏览器中工作。在本文中，我们将了解如何在AJAX中上传文件:</p><ul class=""><li id="1a92" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">在AJAX中上传文件的重要步骤</li><li id="2771" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">文件上传中第三方的问题</li><li id="74a3" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">上传文件</li></ul><h1 id="c2e2" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">在AJAX中上传文件的重要步骤</h1><p id="9dfa" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">通过Ajax上传文件时，有几个关键步骤需要注意。这看起来有点累人，但是如果方法正确，这是非常容易的。您需要小心:</p><ol class=""><li id="1d9d" class="jj jk hh in b io ip is it iw jl ja jm je jn ji la jp jq jr bi translated">为XMLHttpRequest设置实例</li><li id="59a2" class="jj jk hh in b io js is jt iw ju ja jv je jw ji la jp jq jr bi translated">为各种XMLHttpRequest处理程序设置对象</li><li id="3bf0" class="jj jk hh in b io js is jt iw ju ja jv je jw ji la jp jq jr bi translated">设置Ajax请求向后端发送数据</li><li id="83c1" class="jj jk hh in b io js is jt iw ju ja jv je jw ji la jp jq jr bi translated">验证表单</li><li id="cf56" class="jj jk hh in b io js is jt iw ju ja jv je jw ji la jp jq jr bi translated">为观众设置反馈</li></ol><h1 id="2174" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">文件上传中第三方的问题</h1><p id="ab06" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">你是否考虑在你的Ajax文件上传中加入第三方？通过涉及第三方，您可能会遇到三个主要问题。首先，您将无法控制对存储背后的基础架构的访问。</p><figure class="lc ld le lf fd ii er es paragraph-image"><div class="er es lb"><img src="../Images/653486bb299414ed21d47fa76864a7d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/0*lQn9vWTCBTAwSFna.png"/></div></figure><p id="eff1" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">其次，当文件包含敏感数据时，你会遇到隐私问题，尤其是当你上传健康记录、财务记录或法律文件时。第三，当涉及第三方时，存在不可避免的遗留系统。</p><h1 id="7051" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">编码</h1><p id="aa61" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">我们将描述一种用Ajax上传文件的方法，只要formdata可用，它就能工作。在这种方法中，上传需要三个主要组件或重要文件:</p><ol class=""><li id="8cb6" class="jj jk hh in b io ip is it iw jl ja jm je jn ji la jp jq jr bi translated">HTML/CSS文件—文件输入元素及其多个属性</li><li id="60e0" class="jj jk hh in b io js is jt iw ju ja jv je jw ji la jp jq jr bi translated">PHP文件—新的API文件和FileReader对象</li><li id="b29e" class="jj jk hh in b io js is jt iw ju ja jv je jw ji la jp jq jr bi translated">JavaScript — XMLHttpRequest2和FormData对象</li></ol><p id="dc36" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi">HTML/CSS文件的标记和样式</strong></p><p id="6680" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这是一个非常简单的涉及代码的步骤。任何新手都可以这样做，下面是上传的代码:</p><p id="dac7" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> HTML代码</strong></p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="b098" class="ll jy hh lh b fi lm ln l lo lp">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>&lt;head&gt;<br/>&lt;meta charset="UTF-8" /&gt;<br/>&lt;title&gt;HTML5 File API&lt;/title&gt;<br/>&lt;link rel="stylesheet" href="style.css" /&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>&lt;div id="main"&gt;<br/>&lt;h1&gt;Upload Your Images&lt;/h1&gt;<br/>&lt;form method="post" enctype="multipart/form-data" action="upload.php"&gt;<br/>&lt;input type="file" name="images" id="images" multiple /&gt;<br/>&lt;button type="submit" id="btn"&gt;Upload Files!&lt;/button&gt;<br/>&lt;/form&gt;<br/>&lt;div id="response"&gt;&lt;/div&gt;<br/>&lt;ul id="image-list"&gt;<br/>&lt;/ul&gt;<br/>&lt;/div&gt;<br/>&lt;script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"&gt;&lt;/script&gt;<br/>&lt;script src="upload.js"&gt;&lt;/script&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="ddda" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> CSS代码</strong></p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="77ef" class="ll jy hh lh b fi lm ln l lo lp">body {<br/>font: 14px/1.5 helvetica-neue, helvetica, arial, san-serif;<br/>padding:10px;<br/>}</span><span id="676d" class="ll jy hh lh b fi lq ln l lo lp">h1 {<br/>margin-top:0;<br/>}</span><span id="a3d2" class="ll jy hh lh b fi lq ln l lo lp">#main {<br/>width: 300px;<br/>margin:auto;<br/>background: #ececec;<br/>padding: 20px;<br/>border: 1px solid #ccc;<br/>}<br/>#image-list {<br/>list-style:none;<br/>margin:0;<br/>padding:0;<br/>}<br/>#image-list li {<br/>background: #fff;<br/>border: 1px solid #ccc;<br/>text-align:center;<br/>padding:20px;<br/>margin-bottom:19px;<br/>}<br/>#image-list li img {<br/>width: 258px;<br/>vertical-align: middle;<br/>border:1px solid #474747;<br/>}</span></pre><p id="4ceb" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">看到这可以如此容易地实现，您是否感到震惊？现在，让我们继续创建PHP文件。</p><p id="c75f" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> PHP:后端开发</strong></p><p id="8e9d" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">让我们看看如何在后端处理文件上传。随着PHP的进步，为了安全起见，我们需要增加几行代码。下面的代码给你一个无错误的文件上传。创建它是为了上传一个文件，然后将它移动到uploads文件夹。你需要创建一个名为upload.php的文件</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="a27e" class="ll jy hh lh b fi lm ln l lo lp">&lt;?php</span><span id="33da" class="ll jy hh lh b fi lq ln l lo lp">foreach ($_FILES["images"]["error"] as $key =&gt; $error) {<br/>if ($error == UPLOAD_ERR_OK) {<br/>$name = $_FILES["images"]["name"][$key];<br/>move_uploaded_file( $_FILES["images"]["tmp_name"][$key], "uploads/" . $_FILES['images']['name'][$key]);<br/>}<br/>}<br/>echo "&lt;h2&gt;Successfully Uploaded Images&lt;/h2&gt;";</span></pre><p id="85eb" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">您需要链接一个jQuery和upload.js文件来弹出，如下图所示。</p><figure class="lc ld le lf fd ii er es paragraph-image"><div class="er es lr"><img src="../Images/b9858d45d71a46118468f2322b8d0de8.png" data-original-src="https://miro.medium.com/v2/resize:fit:742/format:webp/0*JJUKyc036Pr5aMUz.png"/></div></figure><p id="7852" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi">JavaScript</strong></p><p id="b18e" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">使用Ajax，我们可以隐藏上传图像猫按钮。下面是上传的代码。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="0576" class="ll jy hh lh b fi lm ln l lo lp">(function () {<br/>var input = document.getElementById("images"),<br/>formdata = false;</span><span id="d5d6" class="ll jy hh lh b fi lq ln l lo lp">if (window.FormData) {<br/>formdata = new FormData();<br/>document.getElementById("btn").style.display = "none";<br/>}<br/>}<br/>();</span></pre><p id="ac4c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">下面给出的是隐藏的帮助函数，有助于文件上传。</p><p id="7e4e" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">浏览器阅读图像后显示图像:</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="2957" class="ll jy hh lh b fi lm ln l lo lp">function showUploadedItem (source) {<br/>var list = document.getElementById("image-list"),<br/>li = document.createElement("li"),<br/>img = document.createElement("img");<br/>img.src = source;<br/>li.appendChild(img);<br/>list.appendChild(li);<br/>}</span></pre><p id="eddd" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">向用户显示图像后，您需要显示图像并上传文件。</p><p id="3639" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">onchange事件被激发。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="31af" class="ll jy hh lh b fi lm ln l lo lp">if (input.addEventListener) {<br/>input.addEventListener("change", function (evt) {<br/>var i = 0, len = this.files.length, img, reader, file;</span><span id="0efb" class="ll jy hh lh b fi lq ln l lo lp">document.getElementById("response").innerHTML = "Uploading . . ."</span><span id="6444" class="ll jy hh lh b fi lq ln l lo lp">for ( ; i &lt; len; i++ ) {<br/>file = this.files[i];</span><span id="0811" class="ll jy hh lh b fi lq ln l lo lp">if (!!file.type.match(/image.*/)) {</span><span id="9744" class="ll jy hh lh b fi lq ln l lo lp">}<br/>}</span><span id="167f" class="ll jy hh lh b fi lq ln l lo lp">}, false);<br/>}</span></pre><p id="3275" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">图像上传后，我们需要确认文件是否是图像，以及它是否在指定的长度和大小。</p><p id="6449" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">检查以下代码:</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="1622" class="ll jy hh lh b fi lm ln l lo lp">if ( window.FileReader ) {<br/>reader = new FileReader();<br/>reader.onloadend = function (e) {<br/>showUploadedItem(e.target.result);<br/>};<br/>reader.readAsDataURL(file);<br/>}<br/>if (formdata) {<br/>formdata.append("images[]", file);<br/>}</span></pre><p id="a80f" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我们需要将file对象传递给reader.readAsDataURL，该操作为上传的图像创建一个数据URL。这个数据URL不会从函数传递回来，而是作为even对象的一部分使用。我们需要检查浏览器是否支持formdata和FormData对象。</p><p id="6350" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">它保存我们使用表单提交的值。在images[]中添加方括号将追加另一个值，而不是覆盖。</p><p id="9a8c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">现在，上传图像的最后一步将通过下面这段代码来完成。</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="3d0c" class="ll jy hh lh b fi lm ln l lo lp">if (formdata) {<br/>$.ajax({<br/>url: "upload.php",<br/>type: "POST",<br/>data: formdata,<br/>processData: false,<br/>contentType: false,<br/>success: function (res) {<br/>document.getElementById("response").innerHTML = res;<br/>}<br/>});<br/>}</span></pre><p id="3e1e" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">一旦上传结束，我们需要看看它是否支持表单数据，因为我们是使用Ajax上传的，它应该可以避免所有的错误和特殊情况。<br/>当用户尝试上传图片时，会弹出如下图片:</p><figure class="lc ld le lf fd ii er es paragraph-image"><div class="er es ls"><img src="../Images/5a04f6487100f3b5c765db40d0105f96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*7eCgwqMim9DsRLyF.png"/></div></figure><p id="c945" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">选择图像后，屏幕上会显示:</p><p id="5420" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">一旦图像上传完成:</p><figure class="lc ld le lf fd ii er es paragraph-image"><div class="er es lt"><img src="../Images/b403047dbcb97e3ded4560e1b2f28ac3.png" data-original-src="https://miro.medium.com/v2/resize:fit:388/format:webp/0*m2SBx0IXO6F9CYRX.png"/></div></figure><p id="f4b7" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">使用Ajax上传文件就像在公园散步一样简单。随着新技术的进步，这些任务应该变得尽可能简单。</p><p id="d1f3" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">至此，我们结束了AJAX文章中的上传文件。</p><p id="fa81" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如果你想查看更多关于人工智能、Python、道德黑客等市场最热门技术的文章，那么你可以参考<a class="ae lu" href="https://www.edureka.co/blog/?utm_source=medium&amp;utm_medium=content-link&amp;utm_campaign=upload-file-in-ajax" rel="noopener ugc nofollow" target="_blank"> Edureka的官方网站。</a></p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="e182" class="ll jy hh lh b fi lm ln l lo lp">if (!!file.type.match(/image.*/)) {</span><span id="84b2" class="ll jy hh lh b fi lq ln l lo lp">}<br/>}</span><span id="4f6b" class="ll jy hh lh b fi lq ln l lo lp">}, false);<br/>}</span></pre></div><div class="ab cl lv lw go lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ha hb hc hd he"><p id="2e02" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><em class="mc">原载于2019年9月23日【https://www.edureka.co】<a class="ae lu" href="https://www.edureka.co/blog/upload-file-in-ajax" rel="noopener ugc nofollow" target="_blank"><em class="mc"/></a><em class="mc">。</em></em></p></div></div>    
</body>
</html>