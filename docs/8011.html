<html>
<head>
<title>Mobile AppSec: Understanding Improper Mobile Platform Usage and Client Code Quality</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">移动应用安全:理解不恰当的移动平台使用和客户端代码质量</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/mobile-appsec-understanding-improper-mobile-platform-usage-and-client-code-quality-589124ed39b0?source=collection_archive---------3-----------------------#2021-05-25">https://medium.com/walmartglobaltech/mobile-appsec-understanding-improper-mobile-platform-usage-and-client-code-quality-589124ed39b0?source=collection_archive---------3-----------------------#2021-05-25</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/70458eb67117e870c8bc73e2a64c45cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JXyUzf77TR1S8MnY"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo by <a class="ae it" href="https://unsplash.com/@moreno303?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Misael Moreno</a> on <a class="ae it" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="2545" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">介绍</h1><p id="12be" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">现代移动应用程序开发允许开发人员向用户提供丰富且响应迅速的体验。当使用像Android和iOS这样的操作系统时，对硬件和服务的访问是精简的，并且相当标准化。这使得快速开发可靠地使用诸如将任务/数据移交给其他应用程序和服务之类的功能的应用程序变得容易。</p><p id="fc24" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">虽然这些特性的平台SDK都有很好的文档记录，但是所有开发人员都必须了解某些安全权衡和要避免的某些模式。<strong class="ju hi">简单的东西</strong>(或在Google / StackOverflow上容易找到的)<strong class="ju hi">，并不总是健壮或安全的</strong>。同时，应用于web和其他框架的相同安全编码概念仍然适用于移动应用程序的客户端和服务器端部分。</p></div><div class="ab cl kv kw go kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ha hb hc hd he"><p id="c7d1" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">在开发移动应用程序时，您应该了解能够提供所需功能的内置库和特性，而不是依赖于自定义代码或不必要的第三方库。此外，应该避免一些<em class="lc">方便的</em>和<em class="lc">推荐的</em>实践，以确保您的代码是安全的，并维护您的隐私。并不是所有的默认和流行模式都是最好或最安全的选择。</p><h1 id="bd9b" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">了解风险</h1><p id="6296" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">移动应用程序经常与各种硬件、系统服务和其他应用程序进行交互。您应该小心地使用这些功能，并且只在绝对必要时使用，以减少误用的可能性。</p><p id="4cca" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">例如，如果攻击者发现您的应用程序中存在缺陷或漏洞，您为您的应用程序请求的任何权限都可能被攻击者使用。记住任何app二进制都是可以逆向工程的；攻击者总是有能力了解您的客户端应用程序的内部工作方式。</p><p id="2f29" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">你必须永远记住，与在更受限制的沙箱中运行的web应用程序不同，你的移动应用程序可能拥有<strong class="ju hi">完整的操作系统和文件系统访问权限</strong>。这在编码和设计应用程序时引入了一些额外的考虑。</p><h2 id="ccf0" class="ld iv hh bd iw le lf lg ja lh li lj je kd lk ll ji kh lm ln jm kl lo lp jq lq bi translated"><em class="lr">系统功能</em></h2><p id="cec9" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">让我们首先考虑一些与用户生成的图像相关的问题。例如，您正在开发一个移动应用程序，其屏幕提供了详细的个人和财务数据…</p><ul class=""><li id="405c" class="ls lt hh ju b jv kq jz kr kd lu kh lv kl lw kp lx ly lz ma bi translated">当你的应用程序转到后台时，通常会缓存一个屏幕截图，以备用户想要在应用程序之间切换时使用。</li><li id="ee0e" class="ls lt hh ju b jv mb jz mc kd md kh me kl mf kp lx ly lz ma bi translated">此外，用户可以随时拍摄屏幕截图，默认情况下，该截图存储在操作系统上的主映像存储位置，其他应用程序、同步服务等可以访问该位置。</li></ul><p id="0f7c" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">然而，有一些<a class="ae it" href="https://betterprogramming.pub/how-to-prevent-screen-capture-at-ios-14-1f01173c31c0" rel="noopener ugc nofollow" target="_blank">技术可以解决你的应用程序中的截屏</a>和<a class="ae it" href="https://stackoverflow.com/a/7520307/689554" rel="noopener ugc nofollow" target="_blank">整理背景/应用程序切换的截屏</a>(如果使用MDM ，则<a class="ae it" href="https://developer.apple.com/documentation/devicemanagement/restrictions" rel="noopener ugc nofollow" target="_blank">设置</a> <code class="du mg mh mi mj b"><a class="ae it" href="https://developer.apple.com/documentation/devicemanagement/restrictions" rel="noopener ugc nofollow" target="_blank">allowScreenShot = false</a></code> <a class="ae it" href="https://developer.apple.com/documentation/devicemanagement/restrictions" rel="noopener ugc nofollow" target="_blank">)。此外，当您的应用程序创建或存储图像时，您应该确定是否要限制对应用程序沙盒的访问或允许任何其他应用程序读取该应用程序。在</a><a class="ae it" href="https://developer.apple.com/library/archive/qa/qa1838/_index.html" rel="noopener ugc nofollow" target="_blank"> iOS开发者文档</a>中了解更多关于iOS上此类功能的信息。</p><h2 id="5ad5" class="ld iv hh bd iw le lf lg ja lh li lj je kd lk ll ji kh lm ln jm kl lo lp jq lq bi translated">应用程序间数据共享</h2><p id="8341" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">另一个可能引入风险的领域是应用程序间的数据共享。例如，Android中的<code class="du mg mh mi mj b">intents</code>功能允许你请求另一个应用程序处理一些活动或进程。<em class="lc">您的应用程序</em>可能处理意向，也可能发送意向。当处理意图时，数据<strong class="ju hi">不能被隐式信任</strong>，因为发送应用程序可能是恶意的或者容易被利用。当向<em class="lc">其他应用</em>发出请求时，你应该总是尝试使用明确的意图，而不是隐含的意图；否则，您无法确定哪个服务将处理意图，以及它们会对数据做什么。</p><h2 id="cc24" class="ld iv hh bd iw le lf lg ja lh li lj je kd lk ll ji kh lm ln jm kl lo lp jq lq bi translated">不知道？不需要？不要用！</h2><p id="c471" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">一般来说，误用一个平台特性，或者没有正确理解平台特性的风险和缺省值，会使您的应用程序面临误用和数据泄漏的风险。此外，您决不能信任来自用户、文件系统或其他应用程序的任何数据/输入。没有内置的保证，系统也不总是设计为安全第一的配置。就像在web应用程序上一样，您必须确保遵循主动和先发制人的安全编码实践。</p><h1 id="a397" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">国防概述</h1><p id="8292" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">保护您的移动应用需要持续的安全承诺。移动操作系统发展非常迅速。您必须确定您希望支持旧的和过时的硬件多长时间，这些硬件可能无法利用更现代和更安全的功能:在与尽可能多的用户兼容和要求使用旧的和不安全的API和进程之间有一个权衡。与此同时，随着新功能的出现和您对更安全模式的了解，您必须保持应用程序的更新和发展。在使用任何新功能之前，或者在重新访问旧代码时，请务必查看当前平台文档，了解您的应用中使用的功能。</p><p id="d1f6" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">以下是一些需要记住的一般原则:</p><ul class=""><li id="a264" class="ls lt hh ju b jv kq jz kr kd lu kh lv kl lw kp lx ly lz ma bi translated">不要使用某项功能，除非它确实是必要的，并且满足了必要的业务需求</li><li id="7f50" class="ls lt hh ju b jv mb jz mc kd md kh me kl mf kp lx ly lz ma bi translated">在处理输入时，尽量减少任何权限并遵循安全的编码实践</li><li id="8826" class="ls lt hh ju b jv mb jz mc kd md kh me kl mf kp lx ly lz ma bi translated">尽量减少敏感或有风险的客户端数据和处理；你总是在你自己的服务器上有更多的控制权</li><li id="2903" class="ls lt hh ju b jv mb jz mc kd md kh me kl mf kp lx ly lz ma bi translated">请注意您的应用程序将数据、日志和任何其他输出导出/保存到何处——考虑其他应用程序在同步、备份等情况下何时何地可以访问这些数据。</li><li id="e96c" class="ls lt hh ju b jv mb jz mc kd md kh me kl mf kp lx ly lz ma bi translated">使用非本机代码或<code class="du mg mh mi mj b">WebViews</code>需要了解移动安全问题、操作系统级安全以及网络应用安全问题</li></ul><h2 id="ce3a" class="ld iv hh bd iw le lf lg ja lh li lj je kd lk ll ji kh lm ln jm kl lo lp jq lq bi translated">关于客户端代码质量的一个注释</h2><p id="2bec" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">传统的应用程序安全概念和web安全概念在移动应用程序上仍然很重要。</p><p id="d288" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">请注意以下事项:</p><ul class=""><li id="b90a" class="ls lt hh ju b jv kq jz kr kd lu kh lv kl lw kp lx ly lz ma bi translated">如果你的应用依赖于本地或远程数据库，SQL注入仍然是可能的，而你的本地SQLite数据库很可能<strong class="ju hi">对于机密/敏感/高风险数据来说不够安全</strong></li><li id="58ad" class="ls lt hh ju b jv mb jz mc kd md kh me kl mf kp lx ly lz ma bi translated">如果你的应用不是本地的或者使用了<code class="du mg mh mi mj b">WebViews</code>，跨站点脚本(XSS)仍然是一个问题，可能会影响你应用的其他部分</li><li id="f9f7" class="ls lt hh ju b jv mb jz mc kd md kh me kl mf kp lx ly lz ma bi translated">如果您使用过时的第三方库或具有已知漏洞的第三方库，您的应用程序也将容易受到攻击</li></ul><p id="daf0" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">遵循良好的安全编码实践:</p><ul class=""><li id="868f" class="ls lt hh ju b jv kq jz kr kd lu kh lv kl lw kp lx ly lz ma bi translated">最小化对用户和可用客户端可用的数据和功能的访问</li><li id="f9fa" class="ls lt hh ju b jv mb jz mc kd md kh me kl mf kp lx ly lz ma bi translated"><a class="ae it" href="https://en.wikipedia.org/wiki/Fail-safe#Fail_safe_and_fail_secure" rel="noopener ugc nofollow" target="_blank">安全地失败</a>并预期你的应用程序将接收到错误的输入、意图、文件等。</li><li id="d8e3" class="ls lt hh ju b jv mb jz mc kd md kh me kl mf kp lx ly lz ma bi translated">实践良好的发布管理，并确保生产和非生产环境和配置之间的适当分离</li><li id="750d" class="ls lt hh ju b jv mb jz mc kd md kh me kl mf kp lx ly lz ma bi translated">保持所有的依赖关系是最新的，删除不必要的和无关的功能——有时你需要自己重写一个模块或者去掉一些功能</li></ul></div><div class="ab cl kv kw go kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ha hb hc hd he"><h1 id="fa7d" class="iu iv hh bd iw ix mk iz ja jb ml jd je jf mm jh ji jj mn jl jm jn mo jp jq jr bi translated">平台使用不当安全演示</h1><h2 id="4438" class="ld iv hh bd iw le lf lg ja lh li lj je kd lk ll ji kh lm ln jm kl lo lp jq lq bi translated">演示应用概述</h2><p id="c856" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">为了展示黑客如何滥用平台功能来利用应用程序中的缺陷所带来的影响，我们创建了一个名为<code class="du mg mh mi mj b">DeepLinkXSSDemo</code>的故意易受攻击的应用程序。这个应用程序非常简单:</p><ul class=""><li id="0d28" class="ls lt hh ju b jv kq jz kr kd lu kh lv kl lw kp lx ly lz ma bi translated">它为任何以“http://example.com/hello”开头的链接注册一个URL处理程序</li><li id="dbfb" class="ls lt hh ju b jv mb jz mc kd md kh me kl mf kp lx ly lz ma bi translated">它需要一个“http://example . com/hello/[Name]”格式的URL，其中[Name]应该是“John”、“Ratish”或“Jan”</li><li id="6357" class="ls lt hh ju b jv mb jz mc kd md kh me kl mf kp lx ly lz ma bi translated">然后解析该名称值并将其附加到一个URL，该URL用于在WebView中启动本地嵌入的HTML文件</li><li id="039c" class="ls lt hh ju b jv mb jz mc kd md kh me kl mf kp lx ly lz ma bi translated">然后，应用程序使用网络视图在屏幕上显示“你好，[姓名]”</li></ul><h2 id="2e4a" class="ld iv hh bd iw le lf lg ja lh li lj je kd lk ll ji kh lm ln jm kl lo lp jq lq bi translated">演示—代码演练</h2><p id="d0d8" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated"><strong class="ju hi">在</strong> <code class="du mg mh mi mj b"><strong class="ju hi">AndroidManifest.XML</strong></code> <strong class="ju hi"> : </strong>中注册意图为了允许应用程序拦截对URL的请求，我们必须在<em class="lc">清单文件中请求适当的权限，</em>然后为我们期望的<em class="lc">活动</em>注册意图，该活动将在遇到URL时启动。从第27行开始，我们在<code class="du mg mh mi mj b">AndroidManifest.xml</code>的第20行显示的<code class="du mg mh mi mj b">LoadDeepLink</code>活动中注册了“http://example.com/hello”。</p><figure class="mq mr ms mt fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mp"><img src="../Images/034ac547bab9651cc17767ae61acc152.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LczHXiMkIbAGK2sOo-XuGw.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Manifest Showing Deep Link Intent Handler (<code class="du mg mh mi mj b">AndroidManifest.xml</code>)</figcaption></figure><p id="2200" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated"><strong class="ju hi">在活动布局中创建WebView:</strong>我们的应用程序的接口包括简单地声明一个WebView，我们可以稍后在实际的活动代码中引用它。我们在<code class="du mg mh mi mj b">activity_deep_link.xml</code>的第10行指定ID</p><figure class="mq mr ms mt fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mu"><img src="../Images/897b33371db3a35971f218ffbb33ff47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pt63zNawW7X5i5R96wobDg.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Activity Layout Showing WebView (activity_deep_link.xml)</figcaption></figure><p id="5846" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated"><strong class="ju hi">连接WebView的活动代码:</strong>我们在下面的JAVA代码(<code class="du mg mh mi mj b">LoadDeepLink.java</code>)中通过引用第22行的<code class="du mg mh mi mj b">WebView</code>(在上面的布局中创建)来实例化<code class="du mg mh mi mj b">WebView</code>。然后我们配置一些设置，对我们来说最重要的是在<code class="du mg mh mi mj b">LoadDeepLink.java</code>的第26行，在这里我们<strong class="ju hi">启用JavaScript </strong>。这款应用的开发人员不愿意用JAVA/Kotlin进行处理，而是更喜欢使用他们的JavaScript技能，并尽量减少原生开发的工作量。</p><p id="77f1" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">从<code class="du mg mh mi mj b">LoadDeepLink.java</code>的第31行开始，我们处理我们在上面的清单文件中注册的意图。第34行允许我们提取触发意图的URL的最后一部分，在我们的例子中应该是[ <code class="du mg mh mi mj b">Name</code> ]值。</p><p id="b77f" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">最后，在第36行，我们获取[ <code class="du mg mh mi mj b">Name</code> ]值，并将其作为URL/GET参数附加到本地HTML文件，我们将使用该文件在WebView中呈现输出。</p><figure class="mq mr ms mt fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mv"><img src="../Images/f3a1e82e58b487053d2dfdfcb6f64ad1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kfk46zN7jy1FQV73zxbL_w.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Activity Java Code (LoadDeepLink.java)</figcaption></figure><p id="45e2" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated"><strong class="ju hi"> <em class="lc">注意</em> — Android Studio警告我们不良想法:</strong>你可能已经注意到在上面的截图中，<code class="du mg mh mi mj b">LoadDeepLink.java</code>的第26行被高亮显示，尽管它不是活动行。当你将鼠标放在这条线上时(见下面的截图)，Android Studio会警告你启用JavaScript是危险的…我们会证明他们是对的😊</p><figure class="mq mr ms mt fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mw"><img src="../Images/ebffeadd864eff3630bd34921c74e32f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lfwz-sIcb3hEdKv46PSBgQ.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Detail of security issue when you mouseover “setJavaScriptEnabled(true)” in LoadDeepLink.java</figcaption></figure><p id="38e0" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated"><strong class="ju hi">WebView中的HTML代码:</strong>现在，让我们看看提取[ <code class="du mg mh mi mj b">Name</code> ]值并将其显示为应用程序一部分的HTML和JavaScript。</p><p id="e9d1" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">在<code class="du mg mh mi mj b">hello.html</code>的第3行，我们声明了一个id为<code class="du mg mh mi mj b">showName</code>的span，初始值被设置为“朋友”。从第4行开始的脚本标记用于从我们在上面声明的“<code class="du mg mh mi mj b">LoadDeepLink.java</code>”中的意图(该文件中的第36行)获得传递给<code class="du mg mh mi mj b">WebView</code>的URL/GET参数。</p><p id="0b39" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated"><code class="du mg mh mi mj b">hello.html</code>的第10行用于提取"<code class="du mg mh mi mj b">name</code>"值，然后第12行用传递的任何输入覆盖" Friend "的现有值。</p><figure class="mq mr ms mt fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mx"><img src="../Images/92fb87f395a535be368b55f8ab3962a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*88etd97DIJQlazONMY0eTg.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">HTML file loaded into the WebView with JavaScript Processing (hello.html)</figcaption></figure><h2 id="bb2b" class="ld iv hh bd iw le lf lg ja lh li lj je kd lk ll ji kh lm ln jm kl lo lp jq lq bi translated">有什么问题？</h2><p id="9060" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">从安全角度来看，这个小程序实际上有许多问题和糟糕的设计选择。</p><p id="8f1a" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">最大的问题是，不可信的输入被接受，并且在被消费之前没有被验证/净化。<strong class="ju hi">意向处理中并不存在默认保护你的“魔法”。虽然应用程序是<em class="lc">期待</em>一个<code class="du mg mh mi mj b">name</code>，但是在应用程序的Java或JavaScript部分对输入值没有限制或控制。这意味着攻击者可以在类似“example . com/hello/[<code class="du mg mh mi mj b">Name</code>]”URL的链接的[<code class="du mg mh mi mj b">Name</code>]字段中手工创建恶意有效负载，然后将其注入WebView。在接下来的几节中，我们将演示一些利用。</strong></p><p id="b827" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">在继续进行漏洞利用演示之前，这里有一些其他问题/意见:</p><ul class=""><li id="1f5b" class="ls lt hh ju b jv kq jz kr kd lu kh lv kl lw kp lx ly lz ma bi translated">首先，没有必要依赖WebView，最好限制你在应用中使用的不同编程语言和库的数量，以降低复杂性</li><li id="1389" class="ls lt hh ju b jv mb jz mc kd md kh me kl mf kp lx ly lz ma bi translated"><code class="du mg mh mi mj b">WebView</code>实际上已经被否决了，从安全的角度来看还有更好的选择，但是这是人们在很多网络教程中看到的。如果它有效，许多开发人员不会进一步质疑它😦。</li></ul><figure class="mq mr ms mt fd ii er es paragraph-image"><div class="er es my"><img src="../Images/d0a6fc85189d97994188662f5c624f4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*ZKOyTHT3nxPaCmhL2oR2GA.jpeg"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Screenshot showing that Android Studio tells you WebView is deprecated</figcaption></figure><ul class=""><li id="0e5c" class="ls lt hh ju b jv kq jz kr kd lu kh lv kl lw kp lx ly lz ma bi translated">启用JavaScript是有风险的，有可能不需要首先使用JavaScript就可以实现这一特殊功能</li><li id="8881" class="ls lt hh ju b jv mb jz mc kd md kh me kl mf kp lx ly lz ma bi translated"><code class="du mg mh mi mj b">mWebView.setWebChromeClient()</code>函数支持<strong class="ju hi">甚至更多不必要的功能</strong>，比如允许JavaScript警告；您应该只启用您<strong class="ju hi">实际需要的功能，</strong>以便最小化攻击面(参见<code class="du mg mh mi mj b">LoadDeepLink.java</code>中的第29行)(从<a class="ae it" href="https://stackoverflow.com/a/2835694" rel="noopener ugc nofollow" target="_blank"> this StackOverflow帖子</a>中了解有关此设置的更多信息)</li><li id="89e3" class="ls lt hh ju b jv mb jz mc kd md kh me kl mf kp lx ly lz ma bi translated">在WebView中加载的实际HTML代码中(“<code class="du mg mh mi mj b">hello.html</code>”)，第12行的[ <code class="du mg mh mi mj b">Name</code> ]值是使用<code class="du mg mh mi mj b">nameSpan.innerHTML</code>设置的，因为预期值只是纯文本，而<strong class="ju hi">不是</strong> HTML，<code class="du mg mh mi mj b">*.textContent</code>或<code class="du mg mh mi mj b">*.innerText</code>函数可能更合适(<a class="ae it" href="https://developer.mozilla.org/en-US/docs/Web/API/Node/textContent#Differences_from_innerText" rel="noopener ugc nofollow" target="_blank">在MDN </a>上阅读关于这两种方法的更多信息)</li></ul><h1 id="8c6d" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">演示—开发演练</h1><h2 id="bcb3" class="ld iv hh bd iw le lf lg ja lh li lj je kd lk ll ji kh lm ln jm kl lo lp jq lq bi translated">按预期使用应用程序(无攻击)</h2><figure class="mq mr ms mt fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mz"><img src="../Images/4e7aa4b343237d834d48775751eaac34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*C6d1JWsmJygmoOD2diCCmA.gif"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Demo: App running normally with no attack</figcaption></figure><p id="052c" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">首先，让我们按照最初的意图运行应用程序:</p><p id="4052" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">当我们第一次安装和运行应用程序时，我们会看到“主”活动屏幕，它只显示“应用程序已启动”,这只是一个占位符，用于启动，没有URL处理程序触发的意图。</p><p id="a9da" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">我们退出应用程序。使用主屏幕上的谷歌栏，我们输入以下地址:</p><p id="a523" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">" example.com/hello/John "</p><p id="62fe" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">Android注意到我们的应用程序有一个注册的处理程序，它提示我们要么在我们的应用程序中打开，要么在另一个应用程序中打开。我们选择我们的应用程序来处理URL，我们看到“你好，约翰”正如预期的那样。</p><h2 id="a427" class="ld iv hh bd iw le lf lg ja lh li lj je kd lk ll ji kh lm ln jm kl lo lp jq lq bi translated">基本通知攻击</h2><p id="5b5e" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">第一次攻击将是一个非常简单的概念验证。我们将通过传递恶意HTML字符串来触发跨站脚本(XSS)攻击。</p><p id="28cc" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">在这种情况下，在<code class="du mg mh mi mj b">&lt;script /&gt;</code>标签中传递一些JavaScript将不起作用。但是，我们可以滥用HTML元素内置的<code class="du mg mh mi mj b">onError</code>属性。</p><p id="3b81" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">我们简单地注入一个带有无效<code class="du mg mh mi mj b">src</code>值的<code class="du mg mh mi mj b">&lt;img /&gt;</code>标签，这将触发我们定义JavaScript攻击的<code class="du mg mh mi mj b">onerror</code>条件。</p><p id="faa8" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">下面是原始html代码的样子，这是我们在初始攻击时设置的[<code class="du mg mh mi mj b">Name</code>]值:</p><figure class="mq mr ms mt fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es na"><img src="../Images/86b1b17d9634f02246cb5f405e36f5c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*53ZIIjlA9Hjs2h_Qj_CekQ.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Raw code for Basic Notification Attack</figcaption></figure><p id="3b03" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">为了将此漏洞利用代码附加到URL，我们必须首先对内容进行URL编码，结果如下:</p><figure class="mq mr ms mt fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nb"><img src="../Images/1dbb6f0a83ad8ad36ea71f101b971564.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WCsF9L52mb96OY9shVUGmA.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Attack code from above, in URL encoded format</figcaption></figure><p id="3354" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">最后，我们将上述URL编码的漏洞利用有效负载附加到“example.com/hello/”的基本URL，如下所示:</p><figure class="mq mr ms mt fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nc"><img src="../Images/7d6e28718c9fd85e8c1dae563f6e864c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H_3vsqPSNTmWwPRSHmAI0w.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">URL encoded exploit code appended to the URL</figcaption></figure><p id="abbd" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">让我们看看当我们运行这个攻击时会发生什么:</p><figure class="mq mr ms mt fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mz"><img src="../Images/19b1887e53fd97f15045d9a2c099f6a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ExjEbEJd13kqBtAIIjqQnQ.gif"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Demo: Basic Notification (JavaScript Alert) type attack from unvalidated JavaScript</figcaption></figure><h2 id="2ad2" class="ld iv hh bd iw le lf lg ja lh li lj je kd lk ll ji kh lm ln jm kl lo lp jq lq bi translated">诱骗用户访问我们选择攻击的链接</h2><p id="9b55" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">对于一个简单的PoC来说，显示和警告弹出窗口是很有趣的，但是我们想向您展示这个漏洞是如何被用在其他方面的。也许您修复这个应用程序的第一个想法是简单地禁用JavaScript，然而，“<code class="du mg mh mi mj b">hello.html</code>”文件仍然允许任意HTML被添加到WebView。</p><p id="1955" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">例如，我们可以简单地放下一个<code class="du mg mh mi mj b">&lt;a /&gt;</code>链接元素，并试图欺骗用户点击它。下面是我们可以使用的漏洞有效载荷:</p><figure class="mq mr ms mt fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es na"><img src="../Images/71976a9ed4a75aae7d280f3b2ff78616.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PKOr1ZdryEOYUesmby8aYg.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Exploit Code: A “name”=Victim, plus HTML code with a link</figcaption></figure><p id="8427" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">同样，我们需要首先对它进行URL编码，然后我们可以像上一个例子一样将它传递给我们的应用程序。请看下面的实际操作:</p><figure class="mq mr ms mt fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mz"><img src="../Images/7e28bef54261b144cf4124452fd48ee0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*86plDMYfAKKTspWBHcBNWQ.gif"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Video Demo showing how we can inject a link of our choosing onto a page. Would still require user to click the link.</figcaption></figure><h2 id="3f0f" class="ld iv hh bd iw le lf lg ja lh li lj je kd lk ll ji kh lm ln jm kl lo lp jq lq bi translated">自动重定向到我们选择的链接</h2><p id="1151" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">然而，由于JavaScript <strong class="ju hi"> <em class="lc">启用了</em> </strong>，我们可以简单地将用户重定向到我们控制下的恶意页面，而不是简单地希望他们点击我们的链接。从攻击者的角度来看，这意味着我们可以保持较小的有效负载，并且可以随时在我们自己的服务器上轻松更新我们的恶意代码。</p><p id="5132" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">这段代码使用了我们在警告弹出窗口中使用的相同的<code class="du mg mh mi mj b">onError</code>技巧，除了这次我们会自动将用户重定向到我们控制的另一个页面。</p><figure class="mq mr ms mt fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nd"><img src="../Images/e5162193c46b0d87507201ce0cf27a09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VqoDYP1XS0AfjnbyZWGVlg.png"/></div></div></figure><p id="fec8" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">同样，这段代码必须是URL编码的，然后可以放在我们意图处理的URL中的[<code class="du mg mh mi mj b">Name</code>]位置。请观看下面的视频，了解这种攻击的实际效果。</p><p id="ca8d" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated"><em class="lc">请注意，攻击者无法从我们的应用程序中复制HTML代码并伪造内部网页。由于顶部有</em> <strong class="ju hi"> <em class="lc">无地址栏</em> </strong> <em class="lc">，用户没有办法知道自己上的是真的还是假的网站。</em></p><figure class="mq mr ms mt fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mz"><img src="../Images/7fbce2c5e0a609973f1afc3c81bbdf67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*F6sShXX7cLsM9RzyiBoV2w.gif"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Demo showing automatic redirect to attacker chosen web page.</figcaption></figure><h1 id="4311" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">演示—总结</h1><p id="c298" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">本演示中有几个要点:</p><ul class=""><li id="ff96" class="ls lt hh ju b jv kq jz kr kd lu kh lv kl lw kp lx ly lz ma bi translated">始终了解您在移动客户端应用程序中使用的类和功能；了解所有选项和默认…<em class="lc">TL；博士</em> <strong class="ju hi">看文档！</strong></li><li id="0148" class="ls lt hh ju b jv mb jz mc kd md kh me kl mf kp lx ly lz ma bi translated">在使用您找到的第一个示例代码或最简单的方法之前，请从性能、可维护性和安全性的角度选择最合适的方法。向您的安全团队寻求帮助</li><li id="6847" class="ls lt hh ju b jv mb jz mc kd md kh me kl mf kp lx ly lz ma bi translated">总是验证和净化输入，无论是来自用户、数据库还是其他地方</li></ul></div><div class="ab cl kv kw go kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ha hb hc hd he"><h2 id="8ced" class="ld iv hh bd iw le lf lg ja lh li lj je kd lk ll ji kh lm ln jm kl lo lp jq lq bi translated">包裹</h2><p id="f63f" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">如您所见，即使是一个小应用程序，在保护您的移动应用程序时也需要考虑很多问题。在一个新的平台上编码之前，花时间阅读并理解所有的功能。许多人从web开发转向移动应用程序开发，可以轻松地开始制作简单的应用程序；然而，“让它工作”和编写干净的、可维护的、安全的代码有很大的区别。</p><p id="435d" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">投资于应用程序安全培训，并阅读您的平台的安全文档。每当你学习一种方法或技术时，花些时间研究安全性。您可以从搜索开始，比如“如何使用特性X来保护？”</p></div><div class="ab cl kv kw go kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ha hb hc hd he"><p id="9ed0" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">想了解更多关于AppSec的信息吗？查看我在Medium上的其他文章。如果你喜欢这篇文章，别忘了按50次拍手按钮👏和分享🎁在社交媒体上与朋友分享。欢迎在下面评论你的想法和问题。</p><p id="17fe" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated">阅读更多由<a class="ae it" rel="noopener" href="/@erichgoldman">埃里克·H·戈德曼</a>:</p><ul class=""><li id="bf66" class="ls lt hh ju b jv kq jz kr kd lu kh lv kl lw kp lx ly lz ma bi translated"><a class="ae it" rel="noopener" href="/walmartglobaltech/3-appsec-lessons-from-cloud-with-a-chance-of-meatballs-ad59aa69f99e"> 3 AppSec教训<em class="lc">多云有机会肉丸</em>T7】</a></li><li id="5145" class="ls lt hh ju b jv mb jz mc kd md kh me kl mf kp lx ly lz ma bi translated"><a class="ae it" rel="noopener" href="/@erichgoldman/developers-need-to-stop-fearing-the-infosec-mafia-f61f4b8b8ba5">开发者需要停止害怕信息安全黑手党</a></li><li id="bb45" class="ls lt hh ju b jv mb jz mc kd md kh me kl mf kp lx ly lz ma bi translated"><a class="ae it" rel="noopener" href="/walmartglobaltech/leveraging-your-role-as-technical-product-project-manager-to-improve-application-security-d554f25c2dba">利用您作为技术产品/项目经理的角色来提高应用程序安全性</a></li></ul></div><div class="ab cl kv kw go kx" role="separator"><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la lb"/><span class="ky bw bk kz la"/></div><div class="ha hb hc hd he"><p id="5956" class="pw-post-body-paragraph js jt hh ju b jv kq jx jy jz kr kb kc kd ks kf kg kh kt kj kk kl ku kn ko kp ha bi translated"><em class="lc"> OWASP Mobile Top 10 (2016)本文涵盖的主题:</em> <a class="ae it" href="https://owasp.org/www-project-mobile-top-10/2016-risks/m1-improper-platform-usage" rel="noopener ugc nofollow" target="_blank"> M1:平台使用不当</a>，<a class="ae it" href="https://owasp.org/www-project-mobile-top-10/2016-risks/m7-client-code-quality" rel="noopener ugc nofollow" target="_blank"> M7:客户端代码质量</a></p></div></div>    
</body>
</html>