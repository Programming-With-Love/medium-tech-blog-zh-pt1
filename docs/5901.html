<html>
<head>
<title>Project Kessel Run</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">凯塞尔计划运行</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/project-kessel-run-fc081eb0fd03?source=collection_archive---------0-----------------------#2022-05-04">https://medium.com/oracledevs/project-kessel-run-fc081eb0fd03?source=collection_archive---------0-----------------------#2022-05-04</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="90d8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">克里斯·本森</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/5c804f579d7b9a862a2b1d8da96ccb2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1V6wTrotKXafpnjkmeb4SQ.png"/></div></div></figure><p id="bbef" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你愿意，你可以在GitHub <a class="ae jc" href="https://github.com/chrisbensen/chris-blogs/blob/main/WeekendHacks/rocket/rocket.md" rel="noopener ugc nofollow" target="_blank">这里</a>阅读这篇博文。</p><p id="2e8d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">火箭很酷，那为什么不造一个云连接的火箭呢？我称之为凯塞尔之旅。祝你国庆节快乐！这是一枚物联网火箭。</p><p id="618e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">飞行计算机是一个Arduino + LoRa收发器+ GPS +加速度计，向运行Raspberry Pi + LoRa收发器的基站广播，该收发器连接到我手机的互联网热点，并将一切发送到Oracle Cloud。</p><h1 id="8404" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">先决条件</h1><p id="034e" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">要建造一个，你需要一些东西。</p><p id="7d74" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">1.您拥有一个OCI账户或一个<a class="ae jc" rel="noopener" href="/oracledevs/create-an-oracle-always-free-cloud-account-bc6aa82c1397">自由级账户</a>。</p><p id="ae3c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">1.从<a class="ae jc" href="https://demoparts.withoracle.cloud/sharedbom?ref=295451616379598227377985226295520958226" rel="noopener ugc nofollow" target="_blank">这里</a>拿零件。</p><p id="f99c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.从<a class="ae jc" href="https://www.thingiverse.com/thing:5377245" rel="noopener ugc nofollow" target="_blank"> Thingiverse </a>下载3D可打印文件。</p><h2 id="2864" class="ks jq hh bd jr kt ku kv jv kw kx ky jz ip kz la kd it lb lc kh ix ld le kl lf bi translated">建造火箭</h2><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lg lh l"/></div></figure><p id="7976" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">装配工作相当顺利。下载3D打印文件和鳍。如果你有激光切割机，这非常简单，否则打印出<a class="ae jc" href="https://github.com/chrisbensen/chris-blogs/blob/main/WeekendHacks/rocket/files/models/rocketfins.pdf" rel="noopener ugc nofollow" target="_blank">rocketfins.pdf</a>，把它放在一些轻木上，用工艺刀切出三个翅膀作为稳定器。</p><p id="8af6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">鼻锥由两部分组成。为了打印这些，我用了一个0.4毫米的喷嘴。如果您添加电子元件，您还可以打印出电池座，或者如果您使用不同的电池，您会想要定制它。一个简单的方法是用绝缘胶带将电线连接到电池的两端。</p><h2 id="d079" class="ks jq hh bd jr kt ku kv jv kw kx ky jz ip kz la kd it lb lc kh ix ld le kl lf bi translated">飞行计算机</h2><p id="764c" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">对于这一步，您需要上述先决条件中的以下项目:</p><ul class=""><li id="524d" class="li lj hh ig b ih ii il im ip lk it ll ix lm jb ln lo lp lq bi translated"><a class="ae jc" href="https://learn.adafruit.com/adafruit-rfm69hcw-and-rfm96-rfm95-rfm98-lora-packet-padio-breakouts" rel="noopener ugc nofollow" target="_blank">洛拉转运站</a></li><li id="ec2c" class="li lj hh ig b ih lr il ls ip lt it lu ix lv jb ln lo lp lq bi translated"><a class="ae jc" href="https://www.etechnophiles.com/arduino-micro-pinout-schematic-and-specifications/" rel="noopener ugc nofollow" target="_blank"> Arduino Micro </a></li><li id="f2e5" class="li lj hh ig b ih lr il ls ip lt it lu ix lv jb ln lo lp lq bi translated"><a class="ae jc" href="https://www.adafruit.com/product/746" rel="noopener ugc nofollow" target="_blank"> GPS </a></li><li id="b3d7" class="li lj hh ig b ih lr il ls ip lt it lu ix lv jb ln lo lp lq bi translated"><a class="ae jc" href="https://www.sparkfun.com/products/17241" rel="noopener ugc nofollow" target="_blank">加速度计</a></li></ul><h2 id="4cd9" class="ks jq hh bd jr kt ku kv jv kw kx ky jz ip kz la kd it lb lc kh ix ld le kl lf bi translated">飞行计算机的布线</h2><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es lw"><img src="../Images/7d68db04e39c27024f235e46925b0ed9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IX3nXJehZrxiLrddDef-5w.jpeg"/></div></div></figure><p id="8cdb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">arduino Micro-&gt; LoRa<br/>MISO-Pin 50-&gt;LoRa MISO<br/>MOSI-Pin 51-&gt;LoRa MOSI<br/>SCK-Pin 52-&gt;LoRa SCK<br/>Pin 9-&gt;LoRa CS<br/>Pin 8-&gt;LoRa RST<br/>Pin 7-&gt;LoRa G0<br/>3.3v-&gt;LoRa 3.3v<br/>GND-<br/></p><p id="093c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Arduino Micro -&gt; GPS <br/>引脚3 - &gt; ADXL313 SCL <br/>引脚2-&gt;adxl 313 SDA<br/>3.3v-&gt;adxl 313 3.3v<br/>GND-&gt;adxl 313 GND</p><p id="bf45" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Arduino Micro -&gt; GPS <br/>引脚6 - &gt; GPS TX <br/>引脚5-&gt;GPS RX<br/>3.3v-&gt;GPS 3.3v<br/>GND-&gt;GPS GND</p><p id="8e22" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我用的是433 MHz的LoRa transeiver，它需要一个天线。对于433 MHz波段，波长为299 . 792 . 458/433 . 000 . 000 = 69.24厘米。四分之一是17.31厘米，这是一个很好的长度，所以我剪了一根这样长度的电线，并将其焊接到发射器和接收器的天线上。</p><h2 id="99cc" class="ks jq hh bd jr kt ku kv jv kw kx ky jz ip kz la kd it lb lc kh ix ld le kl lf bi translated">飞行计算机原型试验板</h2><p id="4eda" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">飞行计算机需要缩小，所以我焊接了一些接头，并连接了一个原型试验板。</p><div class="je jf jg jh fd ab cb"><figure class="lx ji ly lz ma mb mc paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><img src="../Images/3f14eef38a3bae9bc4b9c532cba8c835.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*fZKH0s-FGBIPVSpe7JALrQ.jpeg"/></div></figure><figure class="lx ji ly lz ma mb mc paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><img src="../Images/3f1fb9b15f1f7857caa45ecbb6dcc9db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*j7UzM6FqtRE76jzX93R2Cg.jpeg"/></div></figure></div><h2 id="7f04" class="ks jq hh bd jr kt ku kv jv kw kx ky jz ip kz la kd it lb lc kh ix ld le kl lf bi translated">基站</h2><p id="ce5f" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">基站是一个连接到LoRa传输接收器的Raspbery Pi，该传输接收器通过电话的移动热点连接到电话。无线电收发机必须与安装在飞行计算机上的相同。</p><p id="d071" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jc" href="https://learn.adafruit.com/adafruit-rfm69hcw-and-rfm96-rfm95-rfm98-lora-packet-padio-breakouts" rel="noopener ugc nofollow" target="_blank"> Lora收发器</a> <br/>任何Pi 3或Pi 4都可以。</p><p id="af49" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Pi -&gt; LoRa <br/> Pi引脚MOSI - &gt; LoRa MOSI <br/> Pi引脚MISO - &gt; LoRa MISO <br/> Pi引脚SCK - &gt; LoRa SCK <br/> Pi引脚25 - &gt; LoRa CS <br/> Pi引脚5 - &gt; LoRa RST <br/> Pi引脚CE1 - &gt; LoRa G0 <br/> Pi引脚3.3v - &gt; LoRa VIN <br/> Pi引脚GND - &gt;</p><h1 id="eded" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">愿源头与你同在</h1><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es md"><img src="../Images/3708b2ca09f1980c1a04dad71ffe43bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*qMCyTaBAAK-GOwWyyshQ3g.png"/></div></figure><p id="f12b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将以下草图上传到Arduino。注意，你还需要文件<a class="ae jc" href="https://github.com/chrisbensen/chris-blogs/blob/main/WeekendHacks/rocket/files/cloudrocket/LoRa.h" rel="noopener ugc nofollow" target="_blank"> lora.h </a>和<a class="ae jc" href="https://github.com/chrisbensen/chris-blogs/blob/main/WeekendHacks/rocket/files/cloudrocket/LoRa.cpp" rel="noopener ugc nofollow" target="_blank"> lora.cpp </a>。</p><pre class="je jf jg jh fd me mf mg mh aw mi bi"><span id="b92f" class="ks jq hh mf b fi mj mk l ml mm"><a class="ae jc" href="https://github.com/chrisbensen/chris-blogs/blob/main/WeekendHacks/rocket/files/cloudrocket/cloudrocket.ino" rel="noopener ugc nofollow" target="_blank">cloudrocket.ino</a><br/><br/>//Board: Arduino Mega 2560<br/>//Processor: ATMega 2560</span><span id="d2c7" class="ks jq hh mf b fi mn mk l ml mm">// LoRa<br/>// <a class="ae jc" href="https://www.adafruit.com/product/3073" rel="noopener ugc nofollow" target="_blank">https://www.adafruit.com/product/3073</a><br/>// ATMega2650 -&gt;LoRa<br/>// MISO-pin 50 -&gt;LoRa MISO<br/>// MOSI-pin 51 -&gt;LoRa MOSI<br/>// SCK- Pin 52 -&gt;LoRa SCK<br/>// Pin 7 -&gt;LoRa CS<br/>// Pin 6 -&gt;LoRa RST<br/>// Pin 2 -&gt;LoRa G0<br/>// SS- pin 53 //N/A<br/>//<br/>// Arduino Micro -&gt;LoRa<br/>// MISO-pin 50 -&gt;LoRa MISO<br/>// MOSI-pin 51 -&gt;LoRa MOSI<br/>// SCK- Pin 52 -&gt;LoRa SCK<br/>// Pin 9 -&gt;LoRa CS<br/>// Pin 8 -&gt;LoRa RST<br/>// Pin 7 -&gt;LoRa G0<br/>// 3.3v -&gt;LoRa 3.3v<br/>// GND -&gt;Lora GND<br/>#include &lt;SPI.h&gt;<br/>#include “LoRa.h”</span><span id="b4a1" class="ks jq hh mf b fi mn mk l ml mm">const int csPin = 9; // LoRa radio chip select<br/>const int resetPin = 8; // LoRa radio reset<br/>const int irqPin = 7; // interrupt request pin</span><span id="02d9" class="ks jq hh mf b fi mn mk l ml mm">const byte localAddress = 0xBB;<br/>const byte destinationAddress = 0xFF;<br/>const byte syncWord = 0xB4; // Sync word (network ID)<br/>const byte spreadingFactor = 7; //spreading factor (6–12)</span><span id="f06b" class="ks jq hh mf b fi mn mk l ml mm">// Accelerometer<br/>// <a class="ae jc" href="https://learn.sparkfun.com/tutorials/sparkfun-qwiic-3-axis-accelerometer-adxl313-hookup-guide?_ga=2.60797357.1096858093.1651183108-2026033215.1651006494" rel="noopener ugc nofollow" target="_blank">https://learn.sparkfun.com/tutorials/sparkfun-qwiic-3-axis-accelerometer-adxl313-hookup-guide?_ga=2.60797357.1096858093.1651183108-2026033215.1651006494</a><br/>// Arduino Micro -&gt; Accelerometer<br/>// Pin 3 -&gt; ADXL313 SCL<br/>// Pin 2 -&gt; ADXL313 SDA<br/>// 3.3v -&gt;ADXL313 3.3v<br/>// GND -&gt;ADXL313 GND<br/>#include &lt;Wire.h&gt;<br/>#include &lt;SparkFunADXL313.h&gt;<br/>ADXL313 myAdxl;<br/>const int accelerometerIC2Address = 0x1D;</span><span id="afd8" class="ks jq hh mf b fi mn mk l ml mm">// GPS<br/>// <a class="ae jc" href="https://www.adafruit.com/product/746" rel="noopener ugc nofollow" target="_blank">https://www.adafruit.com/product/746</a><br/>// Arduino Micro -&gt; GPS<br/>// Pin 6 -&gt; GPS TX<br/>// Pin 5 -&gt; GPS RX<br/>// 3.3v -&gt;GPS 3.3v<br/>// GND -&gt;GPS GND<br/>#include &lt;Adafruit_GPS.h&gt;<br/>#include &lt;SoftwareSerial.h&gt;</span><span id="f6a2" class="ks jq hh mf b fi mn mk l ml mm">SoftwareSerial GPSSerial(6, 5);<br/>Adafruit_GPS GPS(&amp;GPSSerial);<br/>uint32_t timer = millis();</span><span id="6569" class="ks jq hh mf b fi mn mk l ml mm">void setup() {<br/> Serial.begin(115200); // initialize serial</span><span id="fcb1" class="ks jq hh mf b fi mn mk l ml mm">// — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — <br/> // Initialize LoRa<br/> Serial.println(“LoRa Duplex Init”);<br/> LoRa.setPins(csPin, resetPin, irqPin); // set CS, reset, IRQ pin</span><span id="e50d" class="ks jq hh mf b fi mn mk l ml mm">if (!LoRa.begin(433E6)) { // 915E6)) { // initialize ratio at 915 MHz<br/> Serial.println(“Error LoRa init failed”);<br/> while (true);<br/> }</span><span id="718a" class="ks jq hh mf b fi mn mk l ml mm">LoRa.setSyncWord(syncWord);<br/> LoRa.setSpreadingFactor(spreadingFactor);<br/> LoRa.setTxPower(20, true);<br/> LoRa.setTimeout(10); //set Stream timeout of 10ms<br/> Serial.println(“LoRa init succeeded”); //set the I/O pin modes:</span><span id="b7c9" class="ks jq hh mf b fi mn mk l ml mm">// — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — —<br/> // Initialize Accelerometer<br/> Serial.println(“Accelerometer Init”);<br/> Wire.begin(accelerometerIC2Address);</span><span id="51d9" class="ks jq hh mf b fi mn mk l ml mm">//Begin communication over I2C<br/> if (myAdxl.begin() == false) {<br/> Serial.println(“Error accelerometer init failed”);<br/> while(1);<br/> }</span><span id="f1cd" class="ks jq hh mf b fi mn mk l ml mm">Serial.print(“Accelerometer init succeeded”);<br/> myAdxl.measureModeOn(); // wakes up the sensor from standby and put it into measurement mode</span><span id="88d2" class="ks jq hh mf b fi mn mk l ml mm">// — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — — <br/> // Initialize GPS<br/> Serial.println(“GPS Software Serial”);<br/> GPS.begin(9600);<br/> // uncomment this line to turn on RMC (recommended minimum) and GGA (fix data) including altitude<br/> GPS.sendCommand(PMTK_SET_NMEA_OUTPUT_RMCGGA);<br/> // uncomment this line to turn on only the “minimum recommended” data<br/> //GPS.sendCommand(PMTK_SET_NMEA_OUTPUT_RMCONLY);<br/> // For parsing data, we don’t suggest using anything but either RMC only or RMC+GGA since<br/> // the parser doesn’t care about other sentences at this time</span><span id="f716" class="ks jq hh mf b fi mn mk l ml mm">// Set the update rate<br/> GPS.sendCommand(PMTK_SET_NMEA_UPDATE_1HZ); // 1 Hz update rate<br/> // For the parsing code to work nicely and have time to sort thru the data, and<br/> // print it out we don’t suggest using anything higher than 1 Hz</span><span id="4f8e" class="ks jq hh mf b fi mn mk l ml mm">// Request updates on antenna status, comment out to keep quiet<br/> GPS.sendCommand(PGCMD_ANTENNA);</span><span id="1807" class="ks jq hh mf b fi mn mk l ml mm">delay(1000);<br/> // Ask for firmware version<br/> GPSSerial.println(PMTK_Q_RELEASE);</span><span id="ee42" class="ks jq hh mf b fi mn mk l ml mm">Serial.println(“Setup Complete”);<br/> Serial.flush();<br/>}</span><span id="a4d1" class="ks jq hh mf b fi mn mk l ml mm">int counter = 0;</span><span id="1fb6" class="ks jq hh mf b fi mn mk l ml mm">void sendData(String name, String value) {<br/> String packet = “,” + name + “,” + value;<br/> Serial.print(packet);<br/> LoRa.print(packet);<br/>}</span><span id="d789" class="ks jq hh mf b fi mn mk l ml mm">void loop() {<br/> char c = GPS.read();</span><span id="3c06" class="ks jq hh mf b fi mn mk l ml mm">if ©<br/> Serial.write(c);</span><span id="7cc4" class="ks jq hh mf b fi mn mk l ml mm">// if a sentence is received, we can check the checksum, parse it…<br/> if (GPS.newNMEAreceived()) {<br/> // a tricky thing here is if we print the NMEA sentence, or data<br/> // we end up not listening and catching other sentences!<br/> // so be very wary if using OUTPUT_ALLDATA and trytng to print out data<br/> //Serial.println(GPS.lastNMEA()); // this also sets the newNMEAreceived() flag to false</span><span id="f2a2" class="ks jq hh mf b fi mn mk l ml mm">if (!GPS.parse(GPS.lastNMEA())) { // this also sets the newNMEAreceived() flag to false<br/> Serial.println(“GPS FAILED”);<br/> return; // we can fail to parse a sentence in which case we should just wait for another<br/> }<br/> }</span><span id="0b0b" class="ks jq hh mf b fi mn mk l ml mm">if (!myAdxl.dataReady()) {// check data ready interrupt, note, this clears all other int bits in INT_SOURCE reg<br/> Serial.println(“Waiting for dataReady.”);<br/> }<br/> else {<br/> myAdxl.readAccel();</span><span id="0fa0" class="ks jq hh mf b fi mn mk l ml mm">// send packet<br/> LoRa.beginPacket();<br/> LoRa.print(“BEGIN,”);<br/> sendData(“id”, String(counter));<br/> sendData(“src”, String(localAddress));<br/> sendData(“dest”, String(destinationAddress));<br/> sendData(“x”, String(myAdxl.x));<br/> sendData(“y”, String(myAdxl.y));<br/> sendData(“z”, String(myAdxl.z));<br/> sendData(“day”, String(GPS.day, DEC));<br/> sendData(“month”, String(GPS.month, DEC));<br/> sendData(“year”, String(GPS.year, DEC));<br/> sendData(“fix”, String((int)GPS.fix));<br/> sendData(“quality”, String((int)GPS.fixquality));</span><span id="1531" class="ks jq hh mf b fi mn mk l ml mm">if (GPS.fix) {<br/> sendData(“latitude”, String(GPS.latitude, 4));<br/> sendData(“lat”, String(GPS.lat));<br/> sendData(“longitude”, String(GPS.longitude, 4));<br/> sendData(“long”, String(GPS.lon));<br/> sendData(“knots”, String(GPS.speed));<br/> sendData(“angle”, String(GPS.angle));<br/> sendData(“altitude”, String(GPS.altitude));<br/> sendData(“satellites”, String((int)GPS.satellites));<br/> }<br/> LoRa.print(“,END”);<br/> Serial.println();<br/> LoRa.endPacket();<br/> }</span><span id="7df4" class="ks jq hh mf b fi mn mk l ml mm">counter++;<br/> delay(50);<br/>}</span><span id="f5eb" class="ks jq hh mf b fi mn mk l ml mm"><a class="ae jc" href="https://github.com/chrisbensen/chris-blogs/blob/main/WeekendHacks/rocket/files/pi/lora.py" rel="noopener ugc nofollow" target="_blank">lora.py</a><br/><br/>import time<br/>import busio<br/>from digitalio import DigitalInOut, Direction, Pull<br/>import board<br/>import adafruit_rfm9x<br/>import requests<br/>import os<br/>import json</span><span id="24bf" class="ks jq hh mf b fi mn mk l ml mm">URL = os.getenv(‘URL’)<br/>print(URL)</span><span id="5b93" class="ks jq hh mf b fi mn mk l ml mm">if (URL is None):<br/> print(“URL environment variable not found”)</span><span id="a893" class="ks jq hh mf b fi mn mk l ml mm">flight_file = open(“lora.log”, “a+”)</span><span id="c539" class="ks jq hh mf b fi mn mk l ml mm"># Configure LoRa Radio<br/>CS = DigitalInOut(board.CE1)<br/>RESET = DigitalInOut(board.D25)<br/>spi = busio.SPI(board.SCK, MOSI=board.MOSI, MISO=board.MISO)<br/>rfm9x = adafruit_rfm9x.RFM9x(spi, CS, RESET, 433.0)#915.0)<br/>rfm9x.tx_power = 23</span><span id="cfc9" class="ks jq hh mf b fi mn mk l ml mm">def get_val(data, name):<br/> index = data.index(name)</span><span id="06f0" class="ks jq hh mf b fi mn mk l ml mm">if index != None:<br/> return data[index + 1]</span><span id="9cb4" class="ks jq hh mf b fi mn mk l ml mm">return None</span><span id="a611" class="ks jq hh mf b fi mn mk l ml mm">def make_json(data, fields):<br/> result = {}</span><span id="7ab1" class="ks jq hh mf b fi mn mk l ml mm">for i in range(len(fields)):<br/> name = fields[i]<br/> result[name] = get_val(data, name)</span><span id="9c22" class="ks jq hh mf b fi mn mk l ml mm">return result</span><span id="02d6" class="ks jq hh mf b fi mn mk l ml mm">while True:<br/> packet = None<br/> rssi = rfm9x.last_rssi</span><span id="30c1" class="ks jq hh mf b fi mn mk l ml mm"># check for packet rx<br/> packet = rfm9x.receive(with_header=True)<br/> if packet is None:<br/> print(“waiting”)<br/> else:<br/> try:<br/> print(packet)<br/> packet_text = str(packet, “ascii”)<br/> print(packet_text)<br/> data = packet_text.split(“,”)<br/> print(data)</span><span id="63d8" class="ks jq hh mf b fi mn mk l ml mm">print(get_val(data, “x”), get_val(data, “y”), get_val(data, “z”))</span><span id="2b77" class="ks jq hh mf b fi mn mk l ml mm">fields = [‘id’, ‘x’, ‘y’, ‘z’]<br/> j = make_json(data, fields)<br/> j[“signal”] = “{0} dB”.format(rssi)</span><span id="182d" class="ks jq hh mf b fi mn mk l ml mm">if (URL is not None):<br/> response = requests.post(URL, json = j)</span><span id="cd8e" class="ks jq hh mf b fi mn mk l ml mm">flight_file.write(json.dumps(j))<br/> flight_file.write(“,\n”)<br/> except:<br/> print(“except”)</span></pre><p id="39e6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将<code class="du mo mp mq mf b">lora.py</code>复制到您的Pi。</p><h1 id="a62a" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">云</h1><p id="2bfe" class="pw-post-body-paragraph ie if hh ig b ih kn ij ik il ko in io ip kp ir is it kq iv iw ix kr iz ja jb ha bi translated">用<code class="du mo mp mq mf b">python3 lora.py</code>跑。如果你创建了环境变量<code class="du mo mp mq mf b">export URL=&lt;endpoint&gt;</code>，所有的数据都将被传输到REST endoint。这需要一个Oracle云帐户。你可以在这里得到一个:<a class="ae jc" rel="noopener" href="/oracledevs/create-an-oracle-always-free-cloud-account-bc6aa82c1397">自由层账户</a>。</p><p id="55cb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请继续关注未来如何设置流媒体云。</p></div></div>    
</body>
</html>