<html>
<head>
<title>Perils of Spring Boot Actuators Misconfiguration</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spring Boot致动器错误配置的危险</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/perils-of-spring-boot-actuators-misconfiguration-185c43a0f785?source=collection_archive---------0-----------------------#2020-11-19">https://medium.com/walmartglobaltech/perils-of-spring-boot-actuators-misconfiguration-185c43a0f785?source=collection_archive---------0-----------------------#2020-11-19</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/417591d04504f4ec70d8475f41d70433.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kjr42nf8pP4cqJuMk1CAkQ.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Image Credit: <a class="ae it" href="https://pixabay.com/photos/oil-rig-drilling-bop-actuator-1183699/" rel="noopener ugc nofollow" target="_blank">Pixabay.com</a></figcaption></figure><p id="0c76" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Spring framework提供了名为“<a class="ae it" href="https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html#production-ready-enabling" rel="noopener ugc nofollow" target="_blank"> actuators </a>的奇妙特性来帮助工程师监控和管理web应用程序。</p><p id="5977" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">执行器旨在用于审计、健康和指标收集。这些都是优秀的特性，所以您可能想知道这里有什么危险？稍等一下！虽然这些端点在非生产环境中非常有用，但是如果它们在生产环境中启用并且配置错误，它们也可能会打开服务器的后门。例如，您的应用程序可能会通过堆转储意外泄露活动内存中的凭据，允许恶意参与者<strong class="iw hi">修改</strong>应用程序环境属性，或者在最糟糕的情况下，恶意参与者可能会彻底搞垮您的应用程序。</p><p id="cbb5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">对于开发人员来说，了解使用执行器端点的安全含义是非常重要的，尤其是当一个应用程序可以通过互联网访问时。</p><p id="b2c2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">除了<em class="js">/健康</em>和<em class="js">/信息</em>之外，所有执行器端点对最终用户开放都是有风险的，因为它们会暴露应用程序转储、日志、配置数据和控制。致动器端点具有安全隐患，并且<strong class="iw hi">永远不应</strong>暴露在生产环境中。</p><p id="7c63" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">以下是常见弹簧靴致动器端点可能公开的数据和功能列表:</p><ul class=""><li id="056b" class="jt ju hh iw b ix iy jb jc jf jv jj jw jn jx jr jy jz ka kb bi translated"><em class="js"> /heapdump </em>:显示堆转储，其中可能包含敏感数据，如您的数据库凭据</li><li id="a9ba" class="jt ju hh iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated"><em class="js"> /threadump </em>:显示线程转储，包括堆栈跟踪</li><li id="40d8" class="jt ju hh iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated"><em class="js"> /trace </em>:显示可能包含会话标识符的最后几条HTTP消息</li><li id="51ed" class="jt ju hh iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated"><em class="js"> /logfile </em>:输出应用程序日志的内容，可能包含调试或其他非公开的细节。</li><li id="1978" class="jt ju hh iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated"><em class="js">/关机</em>:关闭应用程序</li><li id="8f34" class="jt ju hh iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated"><em class="js">/映射</em>:显示所有的MVC控制器映射</li><li id="9150" class="jt ju hh iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated"><em class="js"> /env </em>:提供对配置环境的访问</li><li id="c72e" class="jt ju hh iw b ix kc jb kd jf ke jj kf jn kg jr jy jz ka kb bi translated"><em class="js">/重启</em>:重启应用程序</li></ul><p id="a9a2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">还有很多。请参考Spring文档中的<a class="ae it" href="https://docs.spring.io/spring-boot/docs/current/reference/html/production-ready-features.html#production-ready-enabling" rel="noopener ugc nofollow" target="_blank">完整端点列表。</a></p><p id="ab33" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">从安全的角度来看，在生产环境中，建议禁用所有的spring actuator端点，仅暴露无害的端点，如<em class="js"> /health </em>，仅当出于监控应用程序健康等目的需要时。</p><blockquote class="kh ki kj"><p id="a08e" class="iu iv js iw b ix iy iz ja jb jc jd je kk jg jh ji kl jk jl jm km jo jp jq jr ha bi translated">注意，在Spring 1.x中，所有的执行器端点都是可以访问的，不需要任何身份验证。</p></blockquote><p id="fd9d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在Spring 2.x中，默认情况下，除了<em class="js">/健康</em>和<em class="js">/信息</em>之外的所有端点都被认为是敏感的和安全的。应用程序开发人员不应禁用安全配置并在生产环境中暴露其他端点。</p><p id="bd4b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">要禁用所有端点，在<code class="du kn ko kp kq b">application.properties</code>中，设置</p><pre class="kr ks kt ku fd kv kq kw kx aw ky bi"><span id="18ac" class="kz la hh kq b fi lb lc l ld le">management.endpoints.enabled-by-default = false</span></pre><p id="81e0" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">禁用后，通过设置相应的配置仅启用所需的端点，例如，要启用健康端点，请设置</p><pre class="kr ks kt ku fd kv kq kw kx aw ky bi"><span id="83f0" class="kz la hh kq b fi lb lc l ld le">management.endpoint.health.enabled = true</span></pre><p id="6d2b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果确实需要启用指标收集，并且您需要为此启用spring boot actuators端点，那么就要像保护任何其他敏感端点一样保护actuator端点。如果你使用弹簧安全，确保执行器端点也是安全的。如果您希望配置自定义规则，比如只允许具有特定角色的用户访问它们，spring boot提供了一些方便的<code class="du kn ko kp kq b">RequestMatcher</code>对象，可以与spring security结合使用。</p><p id="23c6" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="js">附:只有在生产环境中确实需要这些端点时，才应保护致动器端点。如果不需要执行器端点，建议将其全部禁用。</em></p><h2 id="e1c5" class="kz la hh bd lf lg lh li lj lk ll lm ln jf lo lp lq jj lr ls lt jn lu lv lw lx bi translated">摘要</h2><p id="d1c2" class="pw-post-body-paragraph iu iv hh iw b ix ly iz ja jb lz jd je jf ma jh ji jj mb jl jm jn mc jp jq jr ha bi translated">Spring boot actuator端点为监控应用程序提供了非常酷的功能，但也带来了安全问题。因此，默认情况下，不应在生产中启用这些端点。但是，如果您真的需要启用执行器，那么保护这些端点，就像对待任何其他具有敏感数据的端点一样。访问权限应该是最低要求。</p><p id="f110" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">感谢您的阅读。</p></div></div>    
</body>
</html>