<html>
<head>
<title>Bounded Apps Script with Google API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Google API的有界应用程序脚本</h1>
<blockquote>原文：<a href="https://medium.com/globant/bounded-apps-script-with-google-api-459ef6e0f367?source=collection_archive---------1-----------------------#2022-09-13">https://medium.com/globant/bounded-apps-script-with-google-api-459ef6e0f367?source=collection_archive---------1-----------------------#2022-09-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="0675" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Apps Script是一个基于云的JavaScript平台，允许您集成和自动化跨Google产品的任务。在本文中，我们将看到如何通过Google API获取用户信息，并使用Apps脚本显示在Google Sheet中。</p><p id="75d4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">什么是应用程序脚本？</p><p id="c9ef" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Apps Script是一项自动化业务系统、托管web应用程序、定制功能等的服务。它是用简单的javaScript和html编写的，带有各种内置库，可以与G-Suite应用程序进行交互。</p><p id="1cdd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">应用程序脚本最常见的用法如下:</p><ul class=""><li id="cae2" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">谷歌云:与谷歌云功能交互。</li><li id="7111" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">创建Web UI表单并在excel中整合数据</li><li id="f3d0" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">谷歌日历:获取和管理事件。</li><li id="d47e" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">Gmail:获取和管理电子邮件:创建和发送电子邮件，搜索电子邮件</li><li id="fd59" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">管理Google Drive、Google Slides以及更多与Google应用程序的交互。</li></ul><p id="3307" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">如何安装Apps脚本？</strong></p><p id="e1a9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">应用程序脚本由谷歌提供，并在谷歌服务器上执行。它只需要Gmail账户就可以访问。不需要额外安装。</p><p id="810c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">如何访问Apps脚本？</strong></p><p id="b316" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用链接:<a class="ae jq" href="https://script.google.com/home" rel="noopener ugc nofollow" target="_blank">https://script.google.com/home</a></p><p id="1fde" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Apps脚本作为扩展绑定到Google Sheets。</p><h1 id="3067" class="jr js hh bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated"><strong class="ak"> Apps脚本与Google API的交互</strong></h1><p id="ab2a" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated"><strong class="ig hi">步骤1:用Google Sheet创建一个有界应用程序脚本项目。</strong></p><ul class=""><li id="783a" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">打开一个新的Google工作表并保存它。</li><li id="5dd2" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">从菜单栏中，点击<em class="ku">扩展</em>和<em class="ku">应用程序脚本</em>。</li></ul><p id="6397" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这将创建一个与谷歌表链接的应用程序脚本项目。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es kv"><img src="../Images/10ec3015f377f940c25a12eda29eb43c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bLeZEjrGKBcyjVpI0fxyEA.png"/></div></div></figure><p id="b415" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">步骤2:为Google API定义请求参数</strong></p><p id="2182" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">作为本文的一部分，我考虑过通过Google API获取登录用户的信息。</p><p id="eb19" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">谷歌用户信息应用编程接口:<a class="ae jq" href="https://www.googleapis.com/oauth2/v2/userinfo" rel="noopener ugc nofollow" target="_blank">https://www.googleapis.com/oauth2/v2/userinfo</a></p><ul class=""><li id="de50" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">创建新的脚本文件:UserInfo.gs</li><li id="3a31" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">创建一个函数作为getUserInfo()并定义请求参数:</li></ul><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lh"><img src="../Images/62e0fa748b7585dbc8f95f0c5ea97f25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a2Fz6HoC67eeTLQu5LS4fA.png"/></div></div></figure><p id="4706" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="ku">方法</em>:根据定义的API定义http方法。</p><p id="7faa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="ku"> contentType </em>:定义请求体的格式</p><p id="9968" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="ku"> muteHttpExceptions </em>:如果t<em class="ku">true，</em> fetch不抛出异常，而是在失败的情况下返回HttpResponse。</p><p id="5fbd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="ku">头</em>:将访问令牌作为授权参数传递</p><p id="5072" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">什么是ScriptApp？</strong></p><p id="65f0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ScriptApp是一个控制授权和触发器的定义类。</p><p id="7322" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ScriptApp.getOAuthToken()获取经过身份验证的有效用户的OAuth2.0令牌。</p><p id="c187" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请注意，运行应用程序脚本需要授权才能访问用户数据。当脚本第一次启动时，它会询问“需要授权”。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es li"><img src="../Images/5e96541469d538b55e2cf8db2518c6fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*ShDbCY_GI5xpH6sEYsRPvg.png"/></div></div></figure><p id="6b07" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">点击查看权限。在下一步，它将提示进行身份验证。请输入Gmail帐户凭据。认证后，仔细阅读提供的条款并同意。</p><p id="a874" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">第三步:向Google API发出请求</strong></p><ul class=""><li id="9969" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">创建一个新的脚本文件:Properties.gs，并将URL定义如下:</li></ul><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lj"><img src="../Images/e83c415689f3a89f9be0b3c790f1d909.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HLmWpyrZpEBal8Os0IhC6A.png"/></div></div></figure><ul class=""><li id="5d7a" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">通过传递getUserInfo()函数中定义的参数向USER_INFO发出请求。</li></ul><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lk"><img src="../Images/a1f8b1afefd65ff27dbc269c435f5421.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OLYMtesmd4yEP640QieQaw.png"/></div></div></figure><p id="22e0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">步骤4:解析并读取响应</strong></p><p id="1dfd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用JSON.parse将字符串解析为JSON对象。如果您需要验证响应，请使用console.log来打印结果。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es ll"><img src="../Images/51be8f2de707db0f3583db6f0b13d69e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2O9QG_YlijtGdD5A1XPnaQ.png"/></div></div></figure><p id="a7b9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">第五步:在谷歌表单中填充数据</strong></p><ul class=""><li id="46f0" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">创建一个新函数populateData()；</li><li id="504e" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">使用SpreadsheetApp获取活动工作表，清除现有内容或任何现有过滤器，并为工作表声明一个名称。</li></ul><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lm"><img src="../Images/9f8e6e77ddb759b683dcef626033f488.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iQt6H4FWQphr-htehDS8IQ.png"/></div></div></figure><p id="4f19" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">spreadsheeapp是什么？</strong></p><p id="7c92" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">SpreadSheetApp是定义的类，用于访问和创建/修改google工作表文件。</p><ul class=""><li id="7952" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">定义标题，应用样式并冻结标题行。</li></ul><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es ln"><img src="../Images/ffdbdf59a1b2b8346433970087d57de8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Kfpju8dAVpFjGQ4luVxsYg.png"/></div></div></figure><ul class=""><li id="2b5f" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">定义单元格范围，并根据标题填充内容/响应数据。</li></ul><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lo"><img src="../Images/c328af8666d1f85724c811a0e040106a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vL4h12mud69tgGNoakvfLQ.png"/></div></div></figure><ul class=""><li id="3b5d" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">加载图像并将图像设置到指定的单元格。</li></ul><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lp"><img src="../Images/ffed358b0d7bac536d64b7bc22eb05de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JZmLqKpAl6IZNFU8SLGzew.png"/></div></div></figure><ul class=""><li id="e1cc" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">创建筛选器并调整列宽和行高</li></ul><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es lq"><img src="../Images/aec60d2f4cbbb24d980f9647ee54dd06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*c8xM3bdd0Ms0kF88_5CPbw.png"/></div></figure><p id="0f64" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">第六步:在Google Sheet中添加用户信息菜单</strong></p><ul class=""><li id="b6ce" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">在Code.gs中创建onInstall()和onOpen()函数</li><li id="2b73" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">使用SpreadsheetApp创建菜单并在菜单中添加一项。</li><li id="cac8" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">在addItem()方法中，“User-Info”是标签，“getUserInfo”是被调用的定义函数。</li></ul><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lr"><img src="../Images/ddc574043066a3aed8c2021a6e9f7a7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DBsGNjnLqPkXpLYLKjW28A.png"/></div></div></figure><p id="725d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">第7步:运行项目</strong></p><ul class=""><li id="7fe5" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">因为我们已经用Google Sheet创建了一个有界应用程序，所以只需点击Run就可以应用Google Sheet上的更改。</li></ul><p id="9260" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">结论</strong></p><p id="151b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">本教程解释了如何将Apps脚本与Google API集成。在Apps Script中，您可以做更多的事情，使excel中的计算、功能定制和托管web应用程序变得简单，并且在很短的时间内完成。这是一种有趣的学习。</p><p id="b51b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"># apps script # Google API # AutomateGoogleSheet</p></div></div>    
</body>
</html>