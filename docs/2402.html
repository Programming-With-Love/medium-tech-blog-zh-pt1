<html>
<head>
<title>API Gateway Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">API网关第2部分</h1>
<blockquote>原文：<a href="https://medium.easyread.co/api-gateway-part-2-7264ee5be187?source=collection_archive---------0-----------------------#2019-09-07">https://medium.easyread.co/api-gateway-part-2-7264ee5be187?source=collection_archive---------0-----------------------#2019-09-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="b02a" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">了解API网关的工作原理</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/7ec8f8fe5a500826b2d6160b9ce50fa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vD0v-1aP3sGe4gb7"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@piyushwadhwa?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Piyush Wadhwa</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div><div class="ab cl kt ku hr kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ig ih ii ij ik"><p id="c462" class="pw-post-body-paragraph la lb in lc b ld le jo lf lg lh jr li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">API网关系列列表</p><ul class=""><li id="5a9d" class="lw lx in lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated"><a class="ae ks" href="https://medium.com/easyread/api-gateway-part-1-7901ba703f9" rel="noopener"> API网关第1部分</a></li><li id="1f5e" class="lw lx in lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">API网关第二部分<em class="mk">(你在这里)</em></li></ul></div><div class="ab cl kt ku hr kv" role="separator"><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky kz"/><span class="kw bw bk kx ky"/></div><div class="ig ih ii ij ik"><p id="36c2" class="pw-post-body-paragraph la lb in lc b ld le jo lf lg lh jr li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">API Gateway是一种服务，它是从外部进入应用程序的入口点。它负责请求路由、API合成和其他功能，比如身份验证。所有外部客户端首先转到API网关，然后路由到适当的服务。API gateway还可以在客户端友好协议(如HTTP和WebSockets)和服务使用的客户端不友好协议之间进行转换。</p><h2 id="ba9a" class="ml mm in bd mn mo mp dn mq mr ms dp mt lj mu mv mw ln mx my mz lr na nb nc nd bi translated">请求路由</h2><p id="5c95" class="pw-post-body-paragraph la lb in lc b ld ne jo lf lg nf jr li lj ng ll lm ln nh lp lq lr ni lt lu lv ig bi translated">API网关的关键功能之一是请求路由。API gateway通过将请求路由到相应的服务来实现一些API操作。当收到请求时，API网关查询路由映射，该映射指定将请求路由到哪个服务。</p><h2 id="3857" class="ml mm in bd mn mo mp dn mq mr ms dp mt lj mu mv mw ln mx my mz lr na nb nc nd bi translated">API成分</h2><p id="2f45" class="pw-post-body-paragraph la lb in lc b ld ne jo lf lg nf jr li lj ng ll lm ln nh lp lq lr ni lt lu lv ig bi translated">API网关还提供API组合。我将用一些例子来解释它。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/8a57c879cca239e8577ee6f1eb8c5b1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*5r0t_UNF_xVQ9uwv3V_xIQ.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Illustration before used API gateway with API composition</figcaption></figure><p id="363c" class="pw-post-body-paragraph la lb in lc b ld le jo lf lg lh jr li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">如上图所示，android客户端进行多个API调用。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nk"><img src="../Images/be78f8b0ddef2e99653cf39d0741912b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xco_AbzG10GLrSSqDSqSFg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Illustration after used API gateway with API composition</figcaption></figure><p id="0fe9" class="pw-post-body-paragraph la lb in lc b ld le jo lf lg lh jr li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">如上图所示，API网关提供API组合，使android客户端能够使用单个API请求高效地检索数据。</p><h2 id="4101" class="ml mm in bd mn mo mp dn mq mr ms dp mt lj mu mv mw ln mx my mz lr na nb nc nd bi translated">协议翻译</h2><p id="3337" class="pw-post-body-paragraph la lb in lc b ld ne jo lf lg nf jr li lj ng ll lm ln nh lp lq lr ni lt lu lv ig bi translated">API网关也提供协议翻译。它可能向外部客户机提供RESTful API，即使应用程序服务在内部使用混合协议，包括REST和gRPC。当需要时，一些API操作的实现在RESTful外部API和基于gRPC的内部API之间进行转换。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nl"><img src="../Images/01bf705c5a0c1c92fdefebf724f07f92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0c6TvkhLnSMzdNFtodxZWw.png"/></div></div></figure><h2 id="0de8" class="ml mm in bd mn mo mp dn mq mr ms dp mt lj mu mv mw ln mx my mz lr na nb nc nd bi translated">API网关为每个客户端提供特定于客户端的API</h2><p id="d8ee" class="pw-post-body-paragraph la lb in lc b ld ne jo lf lg nf jr li lj ng ll lm ln nh lp lq lr ni lt lu lv ig bi translated">单一API的问题是不同的客户通常有不同的需求。例如，<code class="fe nm nn no np b">getOrder</code> API操作会返回产品数据、支付数据、库存数据。在某些情况下，并非所有的客户端都需要所有的数据。假设移动客户端只需要数据的子集。解决方案是API网关为每个客户端提供自己的API。例如，API网关为android、ios和浏览器客户端提供不同的<code class="fe nm nn no np b">getOrder</code> API。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nk"><img src="../Images/8127021d6e9860849b8fc506b439c2f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TN5gJ0U8ISZDFiP0TQBgZA.png"/></div></div></figure><h2 id="a39c" class="ml mm in bd mn mo mp dn mq mr ms dp mt lj mu mv mw ln mx my mz lr na nb nc nd bi translated">实现边缘功能</h2><p id="7ec7" class="pw-post-body-paragraph la lb in lc b ld ne jo lf lg nf jr li lj ng ll lm ln nh lp lq lr ni lt lu lv ig bi translated">可能实现的edge函数示例:</p><ul class=""><li id="b908" class="lw lx in lc b ld le lg lh lj ly ln lz lr ma lv mb mc md me bi translated">身份验证—验证发出请求的客户端的身份</li><li id="e3f6" class="lw lx in lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">授权—验证客户端是否被授权执行该特定操作</li><li id="e6e3" class="lw lx in lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">速率限制—限制每秒来自特定客户端和/或所有客户端的请求数量</li><li id="2756" class="lw lx in lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">缓存—缓存响应以减少对服务的请求数量</li><li id="c9e3" class="lw lx in lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">请求记录—记录请求</li></ul><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nq"><img src="../Images/261357e7ce09870f909dd3a27aea8ae0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QE985irHeuHXpEbNdUxIWg.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Illustration of API Gateway with some edge function</figcaption></figure><p id="0baf" class="pw-post-body-paragraph la lb in lc b ld le jo lf lg lh jr li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">API网关必须可靠。实现这一点的一种方法是在一个负载均衡器后面运行多个gateway实例。如果一个实例失败，负载平衡器会将请求路由到其他实例。此外，当API网关调用服务时，服务总是有可能很慢或不可用。解决方案是API网关在调用服务时使用断路器模式。</p><h2 id="c7bc" class="ml mm in bd mn mo mp dn mq mr ms dp mt lj mu mv mw ln mx my mz lr na nb nc nd bi translated">API网关的一些示例</h2><ul class=""><li id="1dd1" class="lw lx in lc b ld ne lg nf lj nr ln ns lr nt lv mb mc md me bi translated">AWS API网关:由AWS提供。您配置API网关，AWS处理所有其他事情，包括伸缩。不支持API组合，只支持HTTP(S ),重点是JSON。</li><li id="0425" class="lw lx in lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">孔:基于NGINX HTTP服务器。已经提供了一些API网关边缘功能。</li><li id="8244" class="lw lx in lc b ld mf lg mg lj mh ln mi lr mj lv mb mc md me bi translated">特拉菲克:用戈兰语写的。已经提供了一些API网关边缘功能。</li></ul><h2 id="168e" class="ml mm in bd mn mo mp dn mq mr ms dp mt lj mu mv mw ln mx my mz lr na nb nc nd bi translated">参考</h2><p id="3fdd" class="pw-post-body-paragraph la lb in lc b ld ne jo lf lg nf jr li lj ng ll lm ln nh lp lq lr ni lt lu lv ig bi translated">克里斯·理查森。“微服务模式。”由Marina Michaels，Christian Mennerich，Aleksandar Dragosavljevic和Corbin Collins编辑。曼宁出版公司，2019。</p><h2 id="e709" class="ml mm in bd mn mo mp dn mq mr ms dp mt lj mu mv mw ln mx my mz lr na nb nc nd bi translated">谢谢你</h2><p id="d1c0" class="pw-post-body-paragraph la lb in lc b ld ne jo lf lg nf jr li lj ng ll lm ln nh lp lq lr ni lt lu lv ig bi translated">我要再次感谢我所有的读者，我希望我会带着一个更有趣的话题回来。</p></div></div>    
</body>
</html>