<html>
<head>
<title>Polymer Unit Testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">聚合物单元测试</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/polymer-unit-testing-d6a69910dc31?source=collection_archive---------0-----------------------#2015-08-14">https://medium.com/google-developer-experts/polymer-unit-testing-d6a69910dc31?source=collection_archive---------0-----------------------#2015-08-14</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/></div><div class="ha hb hc hd he"><p id="7671" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在前端世界里，测试是一个怪异的话题。开发人员知道测试有多重要，但是他们中的许多人并不接受这种实践。这是因为测试通常被认为是耗时且困难的任务。</p><p id="f1e9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有时更难的部分是刚刚开始，这不仅仅是测试特有的。出于这个原因，在这篇文章中，我们将通过基础，留下更高级的主题和一些细节。一旦你掌握了核心概念，并且让你的第一次测试开始工作，我敢打赌你会更有动力去深入挖掘这个主题。</p></div><div class="ab cl jc jd go je" role="separator"><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh ji"/><span class="jf bw bk jg jh"/></div><div class="ha hb hc hd he"><h2 id="3140" class="jj jk hh bd jl jm jn jo jp jq jr js jt ip ju jv jw it jx jy jz ix ka kb kc kd bi translated">Web组件测试器</h2><p id="1643" class="pw-post-body-paragraph ie if hh ig b ih ke ij ik il kf in io ip kg ir is it kh iv iw ix ki iz ja jb ha bi translated">Polymer附带了一个方便的工具，叫做web-component-tester (WCT ),这将使测试你的元素变得非常容易。</p><p id="6a40" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您习惯于测试您的应用程序，您的第一个想法是您不想学习一个新工具，对吗？好消息是，你可能已经知道WCT赖以建立的工具。如果你已经熟悉了<a class="ae kj" href="http://mochajs.org/" rel="noopener ugc nofollow" target="_blank">摩卡</a>、<a class="ae kj" href="http://chaijs.com/" rel="noopener ugc nofollow" target="_blank">柴</a>和<a class="ae kj" href="http://sinonjs.org/" rel="noopener ugc nofollow" target="_blank">兴农</a>，你就可以开始了。如果您是测试新手，并且以前从未听说过这些名字，不要担心，请继续阅读。</p><h1 id="5448" class="kk jk hh bd jl kl km kn jp ko kp kq jt kr ks kt jw ku kv kw jz kx ky kz kc la bi translated">设置</h1><p id="f3ba" class="pw-post-body-paragraph ie if hh ig b ih ke ij ik il kf in io ip kg ir is it kh iv iw ix ki iz ja jb ha bi translated">首先，你需要通过NPM全球安装WCT。</p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="2d0f" class="jj jk hh lg b fi lk ll l lm ln">npm install -g web-component-tester</span></pre><p id="b4bc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">作为测试套件，您可以使用。html文件，如下所示:</p><figure class="lb lc ld le fd lo"><div class="bz dy l di"><div class="lp lq l"/></div><figcaption class="lr ls et er es lt lu bd b be z dx">The basic HTML page with the required dependencies</figcaption></figure><p id="d379" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如您所见，您的测试套件看起来与您通常用来包含聚合物元素的HTML文件几乎相同。唯一的区别是您需要包含<strong class="ig hi"> browser.js </strong>，它负责为您加载所有需要的库，以及<strong class="ig hi"> test-fixture-mocha.js </strong>，我稍后会谈到它。</p><h1 id="e63a" class="kk jk hh bd jl kl km kn jp ko kp kq jt kr ks kt jw ku kv kw jz kx ky kz kc la bi translated">编写测试</h1><p id="7a19" class="pw-post-body-paragraph ie if hh ig b ih ke ij ik il kf in io ip kg ir is it kh iv iw ix ki iz ja jb ha bi translated">在本文中，您将测试一个名为<flip-clock>的聚合物元素。</flip-clock></p><figure class="lb lc ld le fd lo er es paragraph-image"><a href="https://github.com/Granze/flip-clock"><div class="er es lv"><img src="../Images/92e78e1879fd918964cdb70164448f95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*sKHQ9YlL_Uwz9_PXLEn7ow.png"/></div></a><figcaption class="lr ls et er es lt lu bd b be z dx">Check out the &lt;flip-clock&gt; source code on Github clicking on the image</figcaption></figure><p id="3c01" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您需要做的第一件事是将<flip-clock>元素导入页面。除此之外，还要导入<test-fixture>元素。</test-fixture></flip-clock></p><blockquote class="ly lz ma"><p id="ac2b" class="ie if mb ig b ih ii ij ik il im in io mc iq ir is md iu iv iw me iy iz ja jb ha bi translated">元素可以简化一致重置测试套件DOM的工作。要使用它，将测试套件的DOM包装成一个模板。稍后你会发现为什么这个测试至关重要。</p></blockquote><figure class="lb lc ld le fd lo"><div class="bz dy l di"><div class="lp lq l"/></div><figcaption class="lr ls et er es lt lu bd b be z dx">Elements import and instantiation</figcaption></figure><p id="6443" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您已经准备好编写实际的测试了。</p><p id="5c70" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在一个脚本标签中添加<em class="mb"> describe </em>函数和被测元素的名称，在本例中是&lt; flip-clock &gt;。在每个函数之前的<em class="mb">中，我们用其<em class="mb"> id </em>引用我们的元素。正如您可能想象的那样，这个函数在每次测试之前都会被调用。<br/>context</em>函数不是强制性的，但是它是一种对我们的测试进行分组的便捷方式。</p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="46d0" class="jj jk hh lg b fi lk ll l lm ln">describe('&lt;flip-clock&gt;', function() {<br/>  var clock;<br/><br/>  beforeEach(function() {<br/>    clock = fixture('clock');<br/>  });</span><span id="1482" class="jj jk hh lg b fi mf ll l lm ln">  context('common tests', function() {<br/>  <br/>  });<br/>});</span></pre><p id="327e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该元素公开showButtons属性，其默认值为<em class="mb"> false </em>。当<em class="mb">为真</em>时，命令按钮出现。为了切换它们的可见性，您需要在您的定制元素上添加<em class="mb"> show-button </em>属性。</p><p id="9a1f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，在元素上设置<em class="mb"> show-buttons </em>属性，然后确保<em class="mb"> showButtons </em>属性为true。之后，检查包含在带有<em class="mb">按钮</em>类的<em class="mb"> div </em>中的按钮是否可见。</p><blockquote class="ly lz ma"><p id="0071" class="ie if mb ig b ih ii ij ik il im in io mc iq ir is md iu iv iw me iy iz ja jb ha bi translated">由于WCT使用<strong class="ig hi"> Mocha </strong>和<strong class="ig hi"> Chai </strong>，你可以在这些库提供的所有接口中进行选择。我个人比较喜欢柴的<em class="hh"> BDD </em>风格搭配<a class="ae kj" href="http://chaijs.com/api/bdd/" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi"> <em class="hh">期待</em> </strong> </a>界面，不过你可以选择你最喜欢的那个。</p></blockquote><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="1bd5" class="jj jk hh lg b fi lk ll l lm ln"><em class="mb">it</em>('should display the command buttons', function() {<br/>  clock.setAttribute('show-buttons', 'true');<br/>  expect(clock.showButtons).to.be.equal(true);<br/>  expect(clock.querySelector('.buttons').attributes)<br/>  .to.have.ownProperty('visible');<br/>});</span></pre><p id="564c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在重复测试，不设置<em class="mb">显示按钮</em>属性。在这种情况下，我们预计<em class="mb"> showButtons </em>属性为false，按钮不可见。</p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="859a" class="jj jk hh lg b fi lk ll l lm ln"><em class="mb">it</em>('should not display the command buttons', function() {<br/>  expect(clock.showButtons).to.be.equal(false);<br/>  expect(clock.querySelector('.buttons').attributes)<br/>  .to.not.have.ownProperty('visible');<br/>});</span></pre><p id="39a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您将得到这样的代码:</p><figure class="lb lc ld le fd lo"><div class="bz dy l di"><div class="lp lq l"/></div><figcaption class="lr ls et er es lt lu bd b be z dx">The final result</figcaption></figure><h1 id="9f55" class="kk jk hh bd jl kl km kn jp ko kp kq jt kr ks kt jw ku kv kw jz kx ky kz kc la bi translated">运行测试</h1><p id="282f" class="pw-post-body-paragraph ie if hh ig b ih ke ij ik il kf in io ip kg ir is it kh iv iw ix ki iz ja jb ha bi translated">为此，在元素的根目录中打开一个终端，并使用<em class="mb"> wct </em>命令<em class="mb">启动web组件测试器。它会自动在你机器上安装的所有浏览器中运行测试。</em></p><figure class="lb lc ld le fd lo er es paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="er es mg"><img src="../Images/161aad4557c5cbad806b85172ab195fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*81jiojIYeoWtH8ocyPrcQg.png"/></div></div></figure><p id="683b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">哇，你的前两项测试刚刚通过！但是，如果您没有使用<test-fixture>元素，会发生什么呢？简短的回答是:第二次测试会失败。<br/>这是因为您将show-buttons属性设置为true，并且在下面的测试中，您期望<em class="mb"> showButtons </em>为false。<br/>使用&lt;文本夹具&gt;(以及每个功能之前的<em class="mb">)你将在一个“干净的”元素上运行每个测试。</em></test-fixture></p><h1 id="b2db" class="kk jk hh bd jl kl km kn jp ko kp kq jt kr ks kt jw ku kv kw jz kx ky kz kc la bi translated">接下来呢？</h1><p id="cd2a" class="pw-post-body-paragraph ie if hh ig b ih ke ij ik il kf in io ip kg ir is it kh iv iw ix ki iz ja jb ha bi translated">看看<a class="ae kj" href="https://github.com/Granze/flip-clock" rel="noopener ugc nofollow" target="_blank"> Github </a>上的<flip-clock>项目，了解更多关于这个元素是如何构建的，并检查我为这个元素编写的其他测试。<br/>你可以在<a class="ae kj" href="https://github.com/PolymerElements/test-fixture" rel="noopener ugc nofollow" target="_blank">库</a>上找到更多关于&lt;测试夹具&gt;的信息。</flip-clock></p><p id="63f4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">web组件测试器<a class="ae kj" href="https://github.com/Polymer/web-component-tester/blob/master/README.md" rel="noopener ugc nofollow" target="_blank"> README.md </a>也是一个很好的入门资源。</p></div></div>    
</body>
</html>