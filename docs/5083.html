<html>
<head>
<title>Best practices for writing custom actions in Mendix</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Mendix中编写自定义操作的最佳实践</h1>
<blockquote>原文：<a href="https://medium.com/mendix/best-practices-for-writing-custom-actions-in-mendix-87ae768d424?source=collection_archive---------3-----------------------#2021-01-14">https://medium.com/mendix/best-practices-for-writing-custom-actions-in-mendix-87ae768d424?source=collection_archive---------3-----------------------#2021-01-14</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/b849e86d9aaedffec9b06d1802e3a150.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q5FEiKOwbycK_sztPYpO5Q.png"/></div></div></figure><div class=""/><h1 id="7d7c" class="jc jd if bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">在我在Mendix工作的四年中，我编写了许多Mendix模块。这些模块中有许多包含java(脚本)动作作为其接口的一部分。在某些情况下，这些动作是模块的主要接口点。这其中的原因应该是任何在Mendix中开发过的人都知道的。首先，动作支持<a class="ae ka" href="https://docs.mendix.com/refguide/java-actions#2-2-1-entity-type" rel="noopener ugc nofollow" target="_blank">类型参数</a>，允许用户为输入和输出参数分配类型。接下来，动作支持将微(纳)流作为参数传递，这是在Mendix中进行<a class="ae ka" href="https://www.mansystems.com/blog/mendix-design-patterns-callback" rel="noopener ugc nofollow" target="_blank">回调</a>的最安全方式之一。最后但并非最不重要的一点是，自定义动作可以作为本地活动添加，并带有自己的图标。</h1><p id="d4a1" class="pw-post-body-paragraph kb kc if bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">以下是我制作的公开模块的完整列表:</p><ul class=""><li id="06a1" class="ky kz if bd b kd la kh lb kl lc kp ld kt le kx lf lg lh li dt translated">Templator —文档(PDF)生成【https://marketplace.mendix.com/link/component/114043 T4】</li><li id="37ad" class="ky kz if bd b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">网页推送通知<a class="ae ka" href="https://marketplace.mendix.com/link/component/114331" rel="noopener ugc nofollow" target="_blank">https://marketplace.mendix.com/link/component/114331</a></li><li id="a8ac" class="ky kz if bd b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">打印布局<a class="ae ka" href="https://marketplace.mendix.com/link/component/114153" rel="noopener ugc nofollow" target="_blank">https://marketplace.mendix.com/link/component/114153</a></li><li id="b017" class="ky kz if bd b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">完美的滚动条<a class="ae ka" href="https://marketplace.mendix.com/link/component/105048" rel="noopener ugc nofollow" target="_blank">https://marketplace.mendix.com/link/component/105048</a></li><li id="3c12" class="ky kz if bd b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">分页符<a class="ae ka" href="https://marketplace.mendix.com/link/component/114178" rel="noopener ugc nofollow" target="_blank">https://marketplace.mendix.com/link/component/114178</a></li><li id="b28a" class="ky kz if bd b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">本土休息<a class="ae ka" href="https://marketplace.mendix.com/link/component/112178" rel="noopener ugc nofollow" target="_blank">https://marketplace.mendix.com/link/component/112178</a></li><li id="9661" class="ky kz if bd b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">并行执行<a class="ae ka" href="https://marketplace.mendix.com/link/component/116433" rel="noopener ugc nofollow" target="_blank">https://marketplace.mendix.com/link/component/116433</a></li><li id="30db" class="ky kz if bd b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">https://marketplace.mendix.com/link/component/105038</li><li id="68dd" class="ky kz if bd b kd lj kh lk kl ll kp lm kt ln kx lf lg lh li dt translated">动态页面标题<a class="ae ka" href="https://marketplace.mendix.com/link/component/115773" rel="noopener ugc nofollow" target="_blank">https://marketplace.mendix.com/link/component/115773</a></li></ul><p id="6526" class="pw-post-body-paragraph kb kc if bd b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">由于动作是许多app store模块的主要使用方式，所以在设计好的动作上投入一些时间和思想是值得的。这里是我为任何正在编写java(脚本)动作的人准备的十一种最佳实践，无论是在项目中使用还是作为可重用模块的一部分。</p><p id="9873" class="pw-post-body-paragraph kb kc if bd b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">由于动作是许多app store模块的主要使用方式，所以在设计好的动作上投入一些时间和思想是值得的。这里有<strong class="bd lr">11个最佳实践</strong>，我为任何正在<strong class="bd lr">编写java(脚本)动作</strong>的人准备的，无论是在项目中使用还是作为可重用模块的一部分。</p><h1 id="7fc2" class="jc jd if bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">1.使用描述性的参数名称，并以下划线作为后缀</h1><p id="965b" class="pw-post-body-paragraph kb kc if bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">参数的名称应该是描述性的，而不是多余的。这是命名的一般建议，在这里也适用。所以要避免像对象、参数、数据这样的名字。请记住，动作参数不仅在Mendix中被调用时使用，在java(脚本)代码中也作为变量名使用。当参数名是相应语言(如Object)中的保留字时，这会引起一个小问题。为了解决这个问题，Mendix会在代码中的变量名后面加上Parameter1等等。在较新的Mendix版本中，这一点已被重新处理，这实际上使问题变得更糟。现在，相同的操作代码可能在较旧的Mendix版本上运行良好，但在较新的Mx版本上无法编译，因为生成变量名的方式不同。</p><p id="30aa" class="pw-post-body-paragraph kb kc if bd b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">通过使用一个下划线后缀，我所知道的所有与保留字的冲突都可以被消除，并且实际上在调用动作时是不可见的，如下面的截图所示。完美！</p><figure class="lt lu lv lw fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff ls"><img src="../Images/8a1c8da7c6ba6b988e8685be61ae38b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oWbbfHvo0rIlZGm5"/></div></div></figure><h1 id="c922" class="jc jd if bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">2.添加新动作，而不是更改签名。</h1><p id="e33a" class="pw-post-body-paragraph kb kc if bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">我们都经历过。即使是最周密的行动也需要改变。这些改变中的一些将不可避免地涉及改变<a class="ae ka" href="https://en.wikipedia.org/wiki/Type_signature" rel="noopener ugc nofollow" target="_blank">签名</a>，例如，因为添加了新的参数或者返回类型被改变。这是非常具有破坏性的，因为整个项目中所有相应的动作调用都需要更新。</p><p id="4693" class="pw-post-body-paragraph kb kc if bd b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">旧的操作应该在内部调用新的操作，并为新的参数传递一个默认值，或者忽略一个返回值(如果添加了一个的话)。确保给这两个操作一个逻辑名称，也许旧的操作应该在某处包含单词deprecated。接下来描述避免过多签名改变的补充实践。</p><h1 id="6db6" class="jc jd if bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">3.将标志、枚举和整数设置捆绑到一个“选项”对象中。</h1><p id="aa64" class="pw-post-body-paragraph kb kc if bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">很多时候，一个动作会有几个标志或不同的设置，可以调整，因此需要以某种方式公开。最好将所有这些捆绑成一个单独的对象参数，通常称为选项、设置或配置。</p><p id="a60c" class="pw-post-body-paragraph kb kc if bd b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">通过使用“选项”对象，可以同时解决多个问题:1)添加新设置不会改变签名；2)默认值可以在对象中定义，不污染常量空间；3)每个旗帜的文档都有一个清晰的位置，而不会淹没动作对话框；4)动作参数列表可以更短，使得调用动作更快更干净(记住每个参数都必须显式设置)。</p><figure class="lt lu lv lw fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff lx"><img src="../Images/b614a5160a90879e3dbcb060739f7956.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_ovmBJx8lvpRijmH"/></div></div></figure><p id="2a6c" class="pw-post-body-paragraph kb kc if bd b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">并行执行应用商店模块中的“选项”对象示例。</p><h1 id="07d2" class="jc jd if bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">4.总是使用facade，而不是直接调用第三方库。</h1><p id="f498" class="pw-post-body-paragraph kb kc if bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">这是为所有使用jar文件或javascript模块形式的第三方依赖的人准备的。我写了一篇单独的<a class="ae ka" href="https://www.notion.so/Best-practice-for-adding-a-java-dependency-to-Mendix-e2ee2b5776c145f99f8e9fc77f2b62b6" rel="noopener ugc nofollow" target="_blank">详细的博客文章</a>，介绍了这方面的最佳实践。通过使用facade，我们避免了硬耦合，并使得交换库没有太多麻烦成为可能。此外，最好使用特定于语言的依赖管理和构建工具，比如java的maven或gradle，javascript的npm或webpack。这些工具提供了对可传递依赖关系的简单管理、对构建过程的测试集成以及对所需平台的打包。</p><h1 id="1da2" class="jc jd if bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">5.指导用户使用构建器模式构建对象层次结构</h1><p id="7697" class="pw-post-body-paragraph kb kc if bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">在某些情况下，动作的参数不是一个简单的数字，也不是一个只有几个参数的对象。相反，需要一个完整的对象层次结构，并且它必须以动作所期望的特定方式相关联。这在设计时是不可能实现的，所以需要一种巧妙的方法来指导用户构建正确的层次结构和设置正确的关联。</p><p id="8730" class="pw-post-body-paragraph kb kc if bd b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">对于中等规模的层次结构，也就是一到两个关联，我更喜欢使用<a class="ae ka" href="https://en.wikipedia.org/wiki/Builder_pattern" rel="noopener ugc nofollow" target="_blank">构建器模式</a>来帮助用户准备数据。构建器模式允许用简单的步骤构建复杂的层次结构，一次一步。此外，每个步骤都使用通常只能从其他步骤获得的类型进行约束。在一个理想的世界中，有可能完全<a class="ae ka" href="https://forum.mendixcloud.com/link/ideas/2221" rel="noopener ugc nofollow" target="_blank">阻止一些构建器对象</a>的手动实例化，从而迫使用户使用一个动作来创建它们。</p><figure class="lt lu lv lw fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff ly"><img src="../Images/c615f5805bfc839080bf092b7a528816.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6J95mCGC73pHhxCA"/></div></div></figure><p id="7c80" class="pw-post-body-paragraph kb kc if bd b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">我的“Web推送通知”模块中使用的构建器模式示例。在步骤1中，使用java动作构造一个通知对象。然后，在步骤2中，创建一个<em class="lz"> NotificationAction </em>对象，并将其与一个<em class="lz">通知</em>相关联，但不是直接这样做，而是使用一个java动作，它需要一个<em class="lz">通知</em>对象作为参数。这样就不会混淆步骤顺序，不会在步骤1之前调用步骤2，也不会忘记设置关联。</p><h1 id="0ec8" class="jc jd if bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">6.尽可能使用最具体、最具约束性的类型。</h1><p id="2c07" class="pw-post-body-paragraph kb kc if bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">这是另一个一般性建议，也适用于行动，并且与前面的最佳实践紧密相关。使用布尔值代替字符串“是”或“否”。在适当的地方使用枚举和日期来代替字符串。避免重载空值或其他特殊值来传递信息，而是使用特定的类型或枚举。例如，如果响应是一个错误消息或null(顺便提一下，这是个糟糕的想法，参见11 ),那么使用一个带有布尔值“HasError”和错误消息的对象来代替。</p><h1 id="b697" class="jc jd if bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">7.只对那些不能在Mendix中完成的事情使用代码。</h1><p id="860a" class="pw-post-body-paragraph kb kc if bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">如果一件事可以用门迪克斯做，那就用门迪克斯做。尤其是对于检索和/或改变对象。在Mendix中，从操作中间调用流来进行本地检索比构建XPath并用代码进行检索要容易和安全得多。</p><p id="b27d" class="pw-post-body-paragraph kb kc if bd b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">当更改对象属性时，请记住重命名属性不会自动重命名对相应代理上的getter/setter方法的现有调用。所以，再次强调，只有在别无选择的情况下，才能在Mendix中使用代码。</p><h1 id="f055" class="jc jd if bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">8.不要给Mendix运行时和核心方法增加不必要的耦合。</h1><p id="574f" class="pw-post-body-paragraph kb kc if bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">避免代码与Mendix APIs耦合，尤其是对于java动作。Mendix经常对运行时和核心方法进行修改，只是<a class="ae ka" href="https://docs.mendix.com/releasenotes/studio-pro/8.0#breaking-changes" rel="noopener ugc nofollow" target="_blank">在Mendix 8版本</a>中看到这个庞大的列表。所以为了避免麻烦，除非绝对必要，否则不要依赖Mendix运行时库或核心方法。很明显，一些耦合是不可避免的，这里的目标是将其限制到绝对最小。</p><p id="8206" class="pw-post-body-paragraph kb kc if bd b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">如果你遵循其他的最佳实践，这一个应该是自然的。一个额外的好处是，如果您决定将这一部分从Mendix转移到一个单独的服务器上，那么依赖关系的减少将使这部分功能的迁移变得更加容易。</p><h1 id="4720" class="jc jd if bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">9.验证微流参数的参数数量和类型。</h1><p id="b37f" class="pw-post-body-paragraph kb kc if bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">这仅在使用微流作为参数时适用。不幸的是，Mendix仍然不允许在动作中使用时限制参数数量和类型。在实现之前，下一个最好的事情是在运行时检查输入和输出类型。这不是小事，请检查并行执行模块，以获得一个良好的实现，其中也包括继承。</p><h1 id="d20c" class="jc jd if bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">10.使用json作为与动作通信的中介。</h1><p id="565c" class="pw-post-body-paragraph kb kc if bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">构建器模式已经作为处理中等大小的对象层次结构的一种方式被提及。但是大型对象层次结构怎么办？在这种情况下，最好求助于json。这使得用户可以完全自由地使用导出/导入映射将自己的实体图映射到json或从JSON映射出来。Mendix天生支持映射，这意味着它们具有类型安全性，并允许轻松重命名实体、关联和属性。这与任何此类重命名都会导致编译错误的代码形成对比。</p><p id="ec1a" class="pw-post-body-paragraph kb kc if bd b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">为了更进一步，我建议使用<a class="ae ka" href="https://json-schema.org/" rel="noopener ugc nofollow" target="_blank"> JSON模式</a>来验证传入/传出的JSON。使用json的一个好处是，它使操作更容易测试。不需要为每个测试用例构建对象层次结构，只需粘贴一个测试json。</p><h1 id="52ea" class="jc jd if bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">11.让异常传播，而不是吞下它们。</h1><p id="64ec" class="pw-post-body-paragraph kb kc if bd b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx hn dt translated">如果异常发生在代码内部，最好让它传播到Mendix。然后，动作的调用者可以决定如何最好地处理它。很少有一个<a class="ae ka" href="https://www.overops.com/blog/swallowed-exceptions-the-silent-killer-of-java-applications/" rel="noopener ugc nofollow" target="_blank">好的理由来接受例外</a>。</p><p id="6595" class="pw-post-body-paragraph kb kc if bd b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">有时，用更简单的错误消息重新抛出一个异常，并在错误之外的级别记录实际消息可能会很有用。例如，“NumberFormatException in line 192 *”*与“Amount不是有效数字”相比，信息量要少得多。</p><p id="471a" class="pw-post-body-paragraph kb kc if bd b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">我希望你喜欢阅读这篇文章，它能帮助你设计更好的Mendix代码动作！</p></div><div class="ab cl ma mb hb mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="hn ho hp hq hr"><p id="131c" class="pw-post-body-paragraph kb kc if bd b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated">最初发布于<a class="ae ka" href="https://www.notion.so/gajduk/Best-practices-for-writing-custom-actions-in-Mendix-b08105dd2fe241f5b460f23cbdab2e69" rel="noopener ugc nofollow" target="_blank">https://www . ignition . so/gaj Duk/Best-practices-for-writing-custom-actions-in-Mendix-b 08105 DD 2 Fe 241 F5 b 460 f 23 CBD ab 2 e 69</a></p><figure class="lt lu lv lw fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff mh"><img src="../Images/696a498afece85e7ab9f958ef16de9f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LH0gos_TpR2G_6GH"/></div></div></figure></div><div class="ab cl ma mb hb mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="hn ho hp hq hr"><p id="d93f" class="pw-post-body-paragraph kb kc if bd b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated"><em class="lz">来自发布者- </em></p><p id="b712" class="pw-post-body-paragraph kb kc if bd b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated"><em class="lz">如果你喜欢这篇文章，你可以在我们的</em> <a class="ae ka" href="https://medium.com/mendix" rel="noopener"> <em class="lz">媒体页面</em> </a> <em class="lz">或我们自己的</em> <a class="ae ka" href="https://developers.mendix.com/community-blog/" rel="noopener ugc nofollow" target="_blank"> <em class="lz">社区博客网站</em> </a> <em class="lz">找到更多类似的内容。</em></p><p id="963e" class="pw-post-body-paragraph kb kc if bd b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated"><em class="lz">对于希望入门的创客，您可以注册一个</em> <a class="ae ka" href="https://signup.mendix.com/link/signup/?source=direct" rel="noopener ugc nofollow" target="_blank"> <em class="lz">免费账户</em> </a> <em class="lz">，并通过我们的</em> <a class="ae ka" href="https://academy.mendix.com/link/home" rel="noopener ugc nofollow" target="_blank"> <em class="lz">学院</em> </a> <em class="lz">获得即时学习。</em></p><p id="0f7d" class="pw-post-body-paragraph kb kc if bd b kd la kf kg kh lb kj kk kl lo kn ko kp lp kr ks kt lq kv kw kx hn dt translated"><em class="lz">有兴趣加入我们的社区吗？你可以加入我们的</em> <a class="ae ka" href="https://join.slack.com/t/mendixcommunity/shared_invite/zt-hwhwkcxu-~59ywyjqHlUHXmrw5heqpQ" rel="noopener ugc nofollow" target="_blank"> <em class="lz">懈怠社区频道</em> </a> <em class="lz">或者想更多参与的人，看看加入我们的</em> <a class="ae ka" href="https://developers.mendix.com/meetups/#meetupsNearYou" rel="noopener ugc nofollow" target="_blank"> <em class="lz">遇见ups </em> </a> <em class="lz">。</em></p></div></div>    
</body>
</html>