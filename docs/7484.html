<html>
<head>
<title>EC2 Metadata — Evil or Genius</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">EC2元数据—邪恶还是天才</h1>
<blockquote>原文：<a href="https://medium.com/version-1/ec2-metadata-evil-or-genius-1abf73525d80?source=collection_archive---------3-----------------------#2021-07-12">https://medium.com/version-1/ec2-metadata-evil-or-genius-1abf73525d80?source=collection_archive---------3-----------------------#2021-07-12</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="7714" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">BBC Radio 4的经常听众可能熟悉“邪恶天才”系列，其中罗素·凯恩(Russell Kane)在一组专家和名人嘉宾的协助下，权衡标志性人物，以确定他们是真正的邪恶还是真正的天才。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/535b82210a014465681d206acdba1c9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f6HjiH2CJvItz7G4Y-6Jmw.jpeg"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Evil Genius, courtesy of the BBC</figcaption></figure><p id="83b2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我很想拿起这个想法，用它运行一段时间，但是将它应用到与您的普通it人员更接近的地方AWS EC2实例中可用的元数据。</p><p id="4c4b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在深入研究EC2元数据的技术细节之前，让我们先看看什么是元数据。前缀“meta-”来源于希腊语，意思是“之后”或“超越”，在“元数学”和“形而上学”等术语中变得突出，表示潜在基础学科的研究领域。令人印象深刻的是，Meta- 已经延伸到英语的许多部分，表示“关于”其他事物的任何事物，给我们带来了meta- <em class="js">规则</em>(关于规则应用的规则)，meta <em class="js">编程</em>(程序依赖其他程序)，但没有Metaxa，这是一种不太像样的希腊白兰地。那么，元数据是关于数据的数据；例如，一本书的作者和出版日期，书的内容是数据本身，还是说<em class="js">本身</em>是数据<em class="js">的复数？你好，吹毛求疵的伙伴们。</em></p><p id="a710" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这些<em class="js">开胃菜</em>已经够多了，让我们进入正题——EC2元数据，它是什么，我们可以用它来做什么，最重要的是，它是邪恶的还是天才的？</p><h2 id="ae51" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ip ke kf kg it kh ki kj ix kk kl km kn bi translated">这是什么？</h2><p id="f81d" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">这是关于您的EC2实例的数据(当然，我们从上面冗长的解释中猜到的，对吗？)，可在每个实例内部访问，并由实例元数据服务(IMDS)提供。您可以从实例中“浏览”到<a class="ae kt" href="http://169.254.169.254/latest/metadata/" rel="noopener ugc nofollow" target="_blank">http://169 . 254 . 169 . 254/latest/metadata/</a>来访问元数据。这将返回一个类别列表，您可以深入查看，以揭示关于您的实例的各种有趣的东西，这些东西不能从操作系统本身中立即获得。记住这一点，让我们继续看…</p><h2 id="f152" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ip ke kf kg it kh ki kj ix kk kl km kn bi translated">我们能用它做什么？</h2><p id="a7a6" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">想知道您的实例的公共IP地址而不在控制台上查找它吗？</p><blockquote class="ku kv kw"><p id="bea0" class="ie if js ig b ih ii ij ik il im in io kx iq ir is ky iu iv iw kz iy iz ja jb ha bi translated">curl<a class="ae kt" href="http://169.254.169.254/latest/metadata/public-ipv4" rel="noopener ugc nofollow" target="_blank">http://169 . 254 . 169 . 254/latest/metadata/public-IP v4</a>会告诉你你想知道的。</p></blockquote><p id="6deb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我使用了什么AMI来启动这个实例？</p><blockquote class="ku kv kw"><p id="d366" class="ie if js ig b ih ii ij ik il im in io kx iq ir is ky iu iv iw kz iy iz ja jb ha bi translated">curl<a class="ae kt" href="http://169.254.169.254/latest/metadata/ami-id" rel="noopener ugc nofollow" target="_blank">http://169 . 254 . 169 . 254/latest/metadata/ami-id</a>是你的朋友。</p></blockquote><p id="e64e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我真的在巴林启动了我的实例吗？！</p><blockquote class="ku kv kw"><p id="7370" class="ie if js ig b ih ii ij ik il im in io kx iq ir is ky iu iv iw kz iy iz ja jb ha bi translated">curl<a class="ae kt" href="http://169.254.169.254/latest/metadata/placement/availability-zone" rel="noopener ugc nofollow" target="_blank">http://169 . 254 . 169 . 254/latest/metadata/placement/avail ability-zone</a>让你放心。</p></blockquote><p id="8483" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我听到你说“这似乎是一大堆信息”。“安全吗？”。答案是肯定的，也是否定的，从这篇文章的语气来看，这可能是意料之中的。</p><h2 id="6dad" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ip ke kf kg it kh ki kj ix kk kl km kn bi translated">邪恶还是天才？</h2><p id="cfbd" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">人们可能会认为，只能在私有的本地地址上访问的URL是安全的，但是，如果我们设想一个场景，其中实例正在运行一个向外界呈现的服务，事情就变得不那么清晰了。输入… <em class="js">服务器端请求伪造</em>，简称SSRF。SSRF是一种强制应用程序调用非其设计的系统或服务的方法，通常会产生不良后果。它通常与执行导入或导出操作的web应用程序结合使用，例如发送PDF格式的可打印报告或上传图像。如果应用程序没有对这种传输的类型和端点进行足够的检查，那么它们就可能被利用来检索正常情况下不应该可见的信息。</p><p id="51ee" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2019年年中，对Capital One进行了这样的利用，导致1亿现有客户和潜在持卡人的个人信息泄露。攻击者有一个真实的Capital One在线帐户，他注意到上传和预览自定义图像以打印到您的新信用卡的过程使用了AWS S3桶，其URL被指定为上传图像URL的子组件。通过创建一个新的指向应用程序实例的元数据源的“子URL ”,她能够虹吸出实例的IAM角色访问密钥，然后使用这些访问和扫描大量S3桶，下载数百万人的个人信息。Kontra将这次入侵建模为一次指导性练习:<a class="ae kt" href="https://application.security/free-application-security-training/server-side-request-forgery-in-capital-one" rel="noopener ugc nofollow" target="_blank"> Capital One SSRF | Kontra </a>，让你站在负责的黑客的立场上，更好地了解漏洞是如何被发现和利用的。</p><p id="8f81" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">就其本身而言，实例元数据看起来相当安全，而且非常有用。将一个构建草率的应用程序加入其中，一个没有彻底检查其输入和输出的应用程序，突然元数据就滑入了一个黑暗的地方。</p><p id="ef03" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">根据您希望事情有多安全，会有许多选项出现。</p><p id="bfe7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在最极端的情况下，可以简单地禁用实例元数据服务。</p><p id="3da4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您仍然需要元数据，可以使用一种更新、更安全的版本，巧妙地称为IMDSv2。使用它可以阻止对较旧的、不太安全的版本的访问，并使用有时间限制的、基于令牌的访问方法。本质上，您可以在固定的时间段(1秒到6小时)内“解锁”实例元数据会话，做您需要做的事情，当令牌过期时，IMDS访问将停止工作。详见<a class="ae kt" href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/configuring-instance-metadata-service.html#configuring-instance-metadata-options" rel="noopener ugc nofollow" target="_blank">配置实例元数据服务—亚马逊弹性计算云</a></p><p id="079f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">或者坚持使用旧的IMDSv1，使用没有安全缺陷的应用程序。简单。</p><p id="54e8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">关于作者</strong></p><p id="5b3b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="js">阿历克斯·科利尔目前是版本1的</em> DevOps云工程师<em class="js">。</em></p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es la"><img src="../Images/f88ee0c8aaf15df76f3c0f5afc239fe3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IPtCfrozo28XPE1IfovYeQ.jpeg"/></div></div></figure></div></div>    
</body>
</html>