<html>
<head>
<title>Partially Correlated Uniformly Distributed Random Numbers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">部分相关均匀分布随机数</h1>
<blockquote>原文：<a href="https://medium.com/capital-one-tech/partially-correlated-uniformly-distributed-random-numbers-5ce82486b68a?source=collection_archive---------0-----------------------#2018-02-22">https://medium.com/capital-one-tech/partially-correlated-uniformly-distributed-random-numbers-5ce82486b68a?source=collection_archive---------0-----------------------#2018-02-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/5cc39b5dbefc70fa3461bfd6e62f2c0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ij4OThN8DISD0zwH-7UlWQ.jpeg"/></div></div></figure><p id="32ea" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">作为一个从事金融风险建模的人，我经常使用<a class="ae jn" href="https://en.wikipedia.org/wiki/Monte_Carlo_method" rel="noopener ugc nofollow" target="_blank">蒙特卡罗模拟</a>，并且会遇到已经证明了某种程度的相关性的输入。如果您正在对任何人群或场景进行建模，我相信您也是如此。当我开始的时候，我以为我是在追求一个简单技术问题的简单技术答案——ge<em class="jo">生成两个均匀的、部分相关的随机分布</em>，有以下约束。</p><p id="8e9e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">1.向<em class="jo">业务解释方法和数学。</em></p><p id="15a1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">2.在Excel中实现。</p><p id="c074" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了解决这个问题，我将提出三个解决方案。第一种通常被视为“解决方案”,但实际上并不奏效——我将说明为什么它是错误的。第二个是一个不错的解决方案，可以工作，但是不能在Excel中实现(约束#2)。第三种解决方案是正确的，因为它适用于约束1和约束2。对于这个解决方案，我将展示它的实现和显示它工作的图表。对于更倾向于数学的人，我将使用支持解决方案的代数来实现。</p><h1 id="c609" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">解决方案1 —加权线性组合</h1><p id="4063" class="pw-post-body-paragraph ip iq hh ir b is kn iu iv iw ko iy iz ja kp jc jd je kq jg jh ji kr jk jl jm ha bi translated">部分相关随机数的初始占位符是两个不相关随机数(创造性地命名为R1和R2)的加权和(姑且称之为R3)。R3与R1和R2有些关联。具体来说，R3 = a*R1 + (1-a)*R2其中0 ≤ a ≤ 1，本质上<strong class="ir hi"> <em class="jo"> a </em> </strong>是用于调整相关性的参数。可悲的是，这两个分布的相关性与<strong class="ir hi"><em class="jo"/></strong>并没有简单的线性关系。</p><figure class="kt ku kv kw fd ii er es paragraph-image"><div class="er es ks"><img src="../Images/40a981dc693bb3b32ecee91850dbffb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1394/format:webp/1*0mKv5tANrro93Nc0HMCXLQ.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx"><em class="lb">Fig.1: Plot of combination weight a vs. Pearson and Spearman correlation coefficients between R1 &amp; R3. The relationship between the correlation coefficients and a is non-linear which is evidenced by the fact that the line is not straight. Also, not shown in the plot, the relationship does not extend to negative partial correlations. The equality of the correlation coefficients reassures us of a ‘nice’ relationship between the two distributions.</em></figcaption></figure><p id="5b8e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">此外，这种方法不允许产生部分相关为负的群体。更糟糕的是，统计学家并不惊讶，R3不是均匀分布的(对于0 &lt; a &lt;1 the null hypothesis of the <a class="ae jn" href="https://en.wikipedia.org/wiki/Kolmogorov%E2%80%93Smirnov_test" rel="noopener ugc nofollow" target="_blank"> Kolmogorov-Smirnov检验(KS检验)</a>反对均匀分布的被拒绝):</p><figure class="kt ku kv kw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lc"><img src="../Images/74921efd8103fe92f67179b08eaf91eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0lfvU6W6J1AjcqdGGibOHA.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx"><em class="lb">Fig 2: Plot of the distributions. The distribution of R3 is not flat topped and its shape is dependent on the value of a.</em></figcaption></figure><p id="4fe5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">结果是，如果使用R3分布，异常值就没有被充分代表。根据计算的目的，这可能会对结果的准确性产生负面影响。</p><p id="5b30" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">解决方法是什么？“很明显”用的是冲天炉。我稍后会谈到这些。(还记得约束条件1吗？在我写这篇文章的时候，如果有一个适合我们约束的方案存在，我还没有遇到它。为了用Python实现高斯化铁炉解决方案，我的一个同事正在做一些我从大学一年级开始就没想过的严肃的微积分和线性代数。同样，第一个约束。</p><h1 id="2cfc" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">解决方案2 —植入二级分销</h1><p id="a0c3" class="pw-post-body-paragraph ip iq hh ir b is kn iu iv iw ko iy iz ja kp jc jd je kq jg jh ji kr jk jl jm ha bi translated">因此，这里有一个聪明的想法:使用R1作为具有σ的正态分布的平均值，并根据该分布生成R3(我知道我是从a切换到σ，抱歉，但这种表示法在这里更有意义)。将此放入while循环中，以便R3的值被约束在一个区间上。R1和R3之间会有一些关联。在大多数stats包(Python是我的首选包)中，这一点的实现非常简单，如下所示:</p><pre class="kt ku kv kw fd ld le lf lg aw lh bi"><span id="b642" class="li jq hh le b fi lj lk l ll lm">import scipy.stats as stats<br/>def generate_num(center, sigma):<br/>    num = stats.norm.rvs(loc = center, scale = abs(sigma), size = 1)<br/>    while (num &lt; 0) | (num &gt; 1):<br/>        num = stats.norm.rvs(loc = center, scale = abs(sigma), size = 1)<br/>    if sigma &gt; 0:<br/>        return num<br/>    else:<br/>        return 1 — num</span></pre><p id="43a0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">结果看起来更好，并且产生具有部分负相关的群体的方法没有改变:</p><figure class="kt ku kv kw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ln"><img src="../Images/a4be23596182b19b1afdb0e65884a7d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0_maKz9kndkA_ELsRO9Oyg.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx"><em class="lb">Fig. 3: Distributions of R1 &amp; R2 where R2 is generated by seeding the mean of second distribution with R1. The range of R2 is maintained with a loop that rejects values outside of the range</em>.</figcaption></figure><figure class="kt ku kv kw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lo"><img src="../Images/2868507f53a9366e9505c20ff43110dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RQ53qmYkrgucjWU5TCg37Q.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx"><em class="lb">Fig. 4: Relationship between the standard deviation of the secondary distribution and the correlation coefficients of R1&amp; R2.</em></figcaption></figure><p id="9e89" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">但这有两个问题。</p><ul class=""><li id="e558" class="lp lq hh ir b is it iw ix ja lr je ls ji lt jm lu lv lw lx bi translated">第一:如何<em class="jo">轻松</em>实现Excel中的while循环？如果您不实现while循环中的过滤，您将会得到一些超出[0，1]区间的R3值。</li><li id="ce1d" class="lp lq hh ir b is ly iw lz ja ma je mb ji mc jm lu lv lw lx bi translated">第二:R3周期性地不能通过针对均匀分布的KS测试。</li></ul><h1 id="441c" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">解决方案3——迈向冲天炉解决方案</h1><p id="abde" class="pw-post-body-paragraph ip iq hh ir b is kn iu iv iw ko iy iz ja kp jc jd je kq jg jh ji kr jk jl jm ha bi translated">当我重新试图理解cupolas时，我和一位同事进行了一次富有成效的谈话。他指出<em class="jo">“法线的线性组合总是法线。”</em>(如Michael Vespe所写)或者更优雅地说，“<a class="ae jn" href="2.%09https:/www.statlect.com/probability-distributions/normal-distribution-linear-combinations" rel="noopener ugc nofollow" target="_blank"> <em class="jo">具有正态分布的两个独立随机变量的线性组合也具有正态分布</em> </a> <em class="jo">。”虽然这种说法的数学基础并不十分基础，但它引起了共鸣。使用Python生成数值示例也很简单:</em></p><pre class="kt ku kv kw fd ld le lf lg aw lh bi"><span id="9f70" class="li jq hh le b fi lj lk l ll lm">import math as mt<br/>import scipy.stats as stats<br/>rho = 0.8<br/>n1 = stats.norm.rvs(size = 1000)<br/>n2 = stats.norm.rvs(size = 1000)<br/>n3 = rho * n1 — mt.sqrt(1 — rho * * 2) * n2</span></pre><p id="cdf3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">和Excel:</p><figure class="kt ku kv kw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es md"><img src="../Images/84205cea0284f544f10d1a29c113b652.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aSTwHDryHNUvWneRT1R5ew.png"/></div></div></figure><p id="d903" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Python实现产生了以下发行版:</p><figure class="kt ku kv kw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es me"><img src="../Images/48054684f122b65d44180d4c4ed2606b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TcvCKkW-xMmqQoB9BN8x8Q.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx"><em class="lb">Fig. 5: Normal distributions.</em></figcaption></figure><p id="6910" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这种情况下，ρ = 0.8(对符号变化的另一个道歉，我们将在余下的文章中坚持ρ)，N1和N3之间的皮尔逊相关系数是0.82，并且不能用KS检验拒绝正态性的零假设。另一个有用的特性是，正态分布通过其累积分布函数(CDF)转换后会产生均匀分布。</p><figure class="kt ku kv kw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mf"><img src="../Images/a389312bf3f3dc07e39d27f082908f1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y16NGMpIGrSm4vE0iFbiig.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">Fig. 6: Uniform distributions resulting from transforming normal distributions in Fig 5. with the normal CDF</figcaption></figure><p id="9fbf" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最后一点——虽然我找不到关于相关性如何(或为什么)保持在0.79的封闭形式的解决方案(一般来说不是)，但它非常接近。好的是，这种接近保持在区间-1</p><figure class="kt ku kv kw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lo"><img src="../Images/942a796c7844343ac64d80f84087bc9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bzQs3634xmfn2xO8zTQNiQ.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx"><em class="lb">Fig. 7: Relationship between r and the correlation coefficients of R1 &amp; R3.</em></figcaption></figure><p id="7ec6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你需要的只是解决方案，就此打住，我们结束了。恭喜你！但是如果你想知道更多…</p><h1 id="3b33" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">钻研数学</h1><p id="0bd1" class="pw-post-body-paragraph ip iq hh ir b is kn iu iv iw ko iy iz ja kp jc jd je kq jg jh ji kr jk jl jm ha bi translated">再往前推一点，这个优雅的解决方案引发了两个问题。</p><ul class=""><li id="3eee" class="lp lq hh ir b is it iw ix ja lr je ls ji lt jm lu lv lw lx bi translated">首先，什么是圆顶，这是一个简化版本吗？</li><li id="c26d" class="lp lq hh ir b is ly iw lz ja ma je mb ji mc jm lu lv lw lx bi translated">第二，为什么用1-ρ的平方根保持线性</li></ul><h1 id="704c" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">这是一个圆顶吗？</h1><p id="c31b" class="pw-post-body-paragraph ip iq hh ir b is kn iu iv iw ko iy iz ja kp jc jd je kq jg jh ji kr jk jl jm ha bi translated">快速回答:<em class="jo">对，我觉得是</em>。冲天炉是均匀分布变量的联合累积分布函数。如果你看一下<a class="ae jn" href="https://en.wikipedia.org/wiki/Copula_(probability_theory)" rel="noopener ugc nofollow" target="_blank">维基百科</a>对高斯冲天炉的描述，步骤可以分解如下:它取两个均匀分布的变量，用正态百分点函数命中它们(每个现在都是正态分布)，组合它们，然后用正态累积分布函数命中组合，返回一个均匀分布的变量。</p><h1 id="f234" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">为什么这会保持线性？</h1><p id="90b5" class="pw-post-body-paragraph ip iq hh ir b is kn iu iv iw ko iy iz ja kp jc jd je kq jg jh ji kr jk jl jm ha bi translated">这方面的数学有点复杂。我不会在这里给出严格的证明，但希望我的一些计算能让你相信我没有凭空捏造。</p><figure class="kt ku kv kw fd ii er es paragraph-image"><div class="er es mg"><img src="../Images/eabf110a6730a3b4bcea53db3acd5aec.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/1*IOJoRLxfKfAYjR8CIJJPqg.png"/></div></figure><p id="a8ee" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这些计算遵循了由<a class="ae jn" href="http://mathworld.wolfram.com/BivariateNormalDistribution.html" rel="noopener ugc nofollow" target="_blank"> Wolfram </a>提出的二元正态分布的解释。因此，首先，两个正态分布变量x1和x2(μ= 0且σ = 1)的联合概率为</p><figure class="kt ku kv kw fd ii er es paragraph-image"><div class="er es mh"><img src="../Images/dbd600b4b7248315b4371883dac90e3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:324/format:webp/1*s8S1uj_aAObIzaPEIJ316Q.png"/></div></figure><p id="2797" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">两个变量y1和y2的二元正态分布为:</p><figure class="kt ku kv kw fd ii er es paragraph-image"><div class="er es mi"><img src="../Images/77abf8522c792db62181c97d09bccd00.png" data-original-src="https://miro.medium.com/v2/resize:fit:968/format:webp/1*MceLpvkk8jDtBd6Z7ie6nw.png"/></div></figure><p id="427a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">从陈述<em class="jo">“两个</em> <a class="ae jn" href="https://www.statlect.com/fundamentals-of-probability/independent-random-variables" rel="noopener ugc nofollow" target="_blank"> <em class="jo">独立随机变量的线性组合</em> </a> <em class="jo">有一个</em> <a class="ae jn" href="https://www.statlect.com/probability-distributions/normal-distribution" rel="noopener ugc nofollow" target="_blank"> <em class="jo">正态分布</em> </a> <em class="jo">也有一个正态分布”</em>我们可以建立<em class="jo"> y </em> ₁和<em class="jo"> y </em> ₂如下:<em class="jo">y</em>₁=σ₁₁<em class="jo">x</em>₁+σ₁₂<em class="jo">x<em class="jo"><em class="jo"> y </em> ₁和<em class="jo"> y </em> ₂各有均值0，σ₁ = σ₁₁ + σ₁₂，σ₂ = σ₂₁ + σ₂₂有协方差矩阵</em></em></p><figure class="kt ku kv kw fd ii er es paragraph-image"><div class="er es mj"><img src="../Images/175d0f6b3e83b373b1c02de18fbd5cd3.png" data-original-src="https://miro.medium.com/v2/resize:fit:616/format:webp/1*_vE3i0DRjIXqXvUiOg4M0g.png"/></div></figure><p id="fe99" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">X = [ <em class="jo"> x </em> ₁、<em class="jo"> x </em> ₂]和Y = [ <em class="jo"> y </em> ₁、<em class="jo"> y </em> ₂]之间的关系可以用矩阵形式表示，这使得我们可以精确地计算出作为y的函数的x:</p><figure class="kt ku kv kw fd ii er es paragraph-image"><div class="er es mk"><img src="../Images/803ae1f121b43cffca6645e37f84a7a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*e1ctkqh8VlESVglJtUPXog.png"/></div></figure><p id="6b8c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，如果我们选择σ₁₁ = 1，σ₁₂ = 0，σ₂₁ = ρ，协方差矩阵中的非对角项是ρσ₁σ₂，则要求σ₂₂是1-ρ的平方根。此外，当我们进行数学运算时，我们会得到:</p><figure class="kt ku kv kw fd ii er es paragraph-image"><div class="er es ml"><img src="../Images/c4ff4a325245e79a044a27352f368b8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*_eRFGuN7NIVgtkf_H5zi1w.png"/></div></figure><p id="f82a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">所以，不是证明，而是一些建立信心的计算。</p><h1 id="2355" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结论</h1><p id="7b9f" class="pw-post-body-paragraph ip iq hh ir b is kn iu iv iw ko iy iz ja kp jc jd je kq jg jh ji kr jk jl jm ha bi translated">我们已经生成了两个均匀分布的部分相关随机分布。该解决方案用脚本语言和Excel演示。部分相关的均匀分布可以通过任何其他分布的百分点函数进行转换，从而将此解决方案扩展到任意一组分布。最后，数学论证虽然有些复杂，但即使没有完全通过计算也能引起共鸣。该解决方案可以跨工具集实现，并且业务可以理解其解释，符合我们所述的两个标准。</p><p id="db32" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> <em class="jo">披露声明:以上观点为作者个人观点。除非本帖中另有说明，否则Capital One不属于所提及的任何公司，也不被其认可。使用或展示的所有商标和其他知识产权都是其各自所有者的所有权。本文为2018首都一。</em>T3】</strong></p></div></div>    
</body>
</html>