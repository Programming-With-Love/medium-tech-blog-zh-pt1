<html>
<head>
<title>Converting Your User Stories Into Unit Tests With Jasmine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Jasmine将你的用户故事转换成单元测试</h1>
<blockquote>原文：<a href="https://medium.com/quick-code/jasmine-testing-tutorial-a8b833513de?source=collection_archive---------2-----------------------#2019-07-18">https://medium.com/quick-code/jasmine-testing-tutorial-a8b833513de?source=collection_archive---------2-----------------------#2019-07-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/ed43d535aefc99436b8e7f64abb7e52a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*e0hDmiO7rx40JfodzPPKGA.png"/></div></figure><p id="8be6" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">测试在web开发中越来越突出，尤其是DevOps越来越多。随着持续集成和部署成为标准实践，知道如何保持源代码整洁并确保没有疯狂的事情进入prod或任何其他环境非常重要。一种方法是自动化测试，尽管您仍然需要编写那些测试。</p><p id="7f4e" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这是一个关于TDD和BDD如何在敏捷环境中工作以及如何用Jasmine编写单元测试的快速教程。我们将经历使用TDD和BDD编写一些单元测试的过程，并解释我们为什么要做我们要做的事情，以及我们如何做出做这些事情的决定。</p><h1 id="5e77" class="jj jk hh bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated"><strong class="ak">TDD和BDD的背景</strong></h1><p id="e6b6" class="pw-post-body-paragraph il im hh in b io kh iq ir is ki iu iv iw kj iy iz ja kk jc jd je kl jg jh ji ha bi translated">让我们从TDD和BDD的一点背景开始。你可以在这里得到更深入、更快速的概述:<a class="ae km" href="https://flippedcoding.com/2019/05/02/testing-with-tdd-and-bdd/" rel="noopener ugc nofollow" target="_blank"> TDD/BDD概述</a>简而言之，BDD描述了特性如何工作以及用户应该如何使用它们，而TDD让你在为这些特性编写代码之前编写测试。将这两种方法结合使用会给你带来一些好处。</p><ul class=""><li id="4e88" class="kn ko hh in b io ip is it iw kp ja kq je kr ji ks kt ku kv bi translated">您的团队将理解特性需求来自哪里，以及为什么它们是必要的。</li><li id="7652" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">你将在你的项目上有广泛的测试覆盖面，这将使你更快地产生更高质量的代码。</li><li id="39b8" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">文档对于代码的任何部分都不是问题，因为任何开发人员都可以查看测试来了解代码应该如何工作。</li><li id="f2df" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">在编写代码之前编写测试可以让您更好地理解您试图解决的问题。</li><li id="e707" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">对您的代码进行测试使您的CI/CD管道更加可靠和一致。</li></ul><p id="a9d5" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这些只是你从编写测试中得到的一些好处。现在我将介绍在Jasmine.js中编写两个测试的过程。同样的过程可以用于使用前端或后端的任何库来编写测试。</p><h1 id="a31c" class="jj jk hh bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated"><strong class="ak">用户故事</strong></h1><p id="5269" class="pw-post-body-paragraph il im hh in b io kh iq ir is ki iu iv iw kj iy iz ja kk jc jd je kl jg jh ji ha bi translated">这是我们将用来编写测试的两个用户故事。</p><p id="d511" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi">用户故事1 </strong></p><p id="264a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">作为管理员用户，我可以停用具有我选择的权限的所有用户，这样我就可以同时从系统中删除多个具有相同权限的人，而不是单独删除。</p><p id="11b6" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi">用户故事2 </strong></p><p id="8a07" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">作为帐户用户，我可以启用或禁用双因素身份验证，这样我就可以决定我的帐户信息的安全级别。</p><p id="ef95" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这些都不是什么奇特的功能，但是它们都有几个任务。通常下一步是与您的团队会面，将这些用户故事分解成任务，然后您将为这些任务编写代码。让我们做一点。我们可能会省略一些东西，或者对它们进行压缩，以保持简洁。</p><p id="ce8b" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi">用户故事1任务</strong></p><ul class=""><li id="7bf7" class="kn ko hh in b io ip is it iw kp ja kq je kr ji ks kt ku kv bi translated">确保用户是管理员</li><li id="3fa7" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">基于权限选择筛选所有用户</li><li id="eacb" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">添加将用户作为一个组删除的功能</li></ul><p id="6474" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi">用户故事2任务</strong></p><ul class=""><li id="4dab" class="kn ko hh in b io ip is it iw kp ja kq je kr ji ks kt ku kv bi translated">创建一个新模型来更新两个因子设置</li><li id="fffd" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">如果他们不启用双因素身份认证，则添加有关信息安全的警告</li><li id="4df6" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">这是您可以从这些用户故事中提取的任务的粗略分类。现在我们已经定义了我们的任务，我们可以开始编写测试了。</li></ul><h1 id="6ae1" class="jj jk hh bd jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg bi translated"><strong class="ak">在茉莉中写测试</strong></h1><p id="f83b" class="pw-post-body-paragraph il im hh in b io kh iq ir is ki iu iv iw kj iy iz ja kk jc jd je kl jg jh ji ha bi translated">对于这个快速教程，我们将使用Jasmine.js。它非常容易掌握，并且可以与大多数JavaScript框架很好地集成。我喜欢用它来测试角度应用。如果你想知道关于Jasmine的细节并了解如何使用它，查看他们的文档:【https://jasmine.github.io/api/edge/global】T4我们不会为所有的任务编写一个测试，因为那会给你留下一些练习。我们将编写三个测试，这样你可以更好地理解如何编写测试。请记住，我们还没有实现任何代码，所以你可以调用任何你喜欢的东西。</p><p id="a28d" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi">确保用户是管理员</strong></p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="edb5" class="lk jk hh lg b fi ll lm l ln lo">‘use strict’;</span><span id="cca8" class="lk jk hh lg b fi lp lm l ln lo">const testAdminUser = require(‘./adminUser.js’);</span><span id="b4a2" class="lk jk hh lg b fi lp lm l ln lo">describe(‘make sure user is an admin’, () =&gt; {</span><span id="22a7" class="lk jk hh lg b fi lp lm l ln lo">    let dummyUser = {</span><span id="ae7e" class="lk jk hh lg b fi lp lm l ln lo">        username: ‘testdummy’,</span><span id="25a1" class="lk jk hh lg b fi lp lm l ln lo">        password: ‘t3StD4mM7’</span><span id="23ae" class="lk jk hh lg b fi lp lm l ln lo">    };</span><span id="3615" class="lk jk hh lg b fi lp lm l ln lo">    it(‘check if user is logged in’, () =&gt; {</span><span id="1f51" class="lk jk hh lg b fi lp lm l ln lo">expect(testAdminUser.login(dummyUser).response.success).toBe(true);</span><span id="0922" class="lk jk hh lg b fi lp lm l ln lo">    });</span><span id="a4fa" class="lk jk hh lg b fi lp lm l ln lo">    it(‘check if user has admin permissions’, () =&gt; {</span><span id="ce0e" class="lk jk hh lg b fi lp lm l ln lo">        let userPermissions = [];</span><span id="c1cd" class="lk jk hh lg b fi lp lm l ln lo">        userPermissions = testAdminUser.login(dummyUser).response.permissions;</span><span id="1217" class="lk jk hh lg b fi lp lm l ln lo">    expect(userPermissions.includes(‘Administrator’)).toBe(true);</span><span id="dd01" class="lk jk hh lg b fi lp lm l ln lo">    });</span><span id="f3e4" class="lk jk hh lg b fi lp lm l ln lo">});</span></pre><p id="4e31" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi">添加将用户作为一组移除的功能</strong></p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="9871" class="lk jk hh lg b fi ll lm l ln lo">‘use strict’;</span><span id="e803" class="lk jk hh lg b fi lp lm l ln lo">const testAdminUser = require(‘./adminUser.js’);</span><span id="55c6" class="lk jk hh lg b fi lp lm l ln lo">describe(‘functionality to remove users as a group’, () =&gt; {</span><span id="3e80" class="lk jk hh lg b fi lp lm l ln lo">    let dummyPermission = ‘Contributor’;</span><span id="a88f" class="lk jk hh lg b fi lp lm l ln lo">    it(‘gets a list of all users marked for deletion’, () =&gt; {</span><span id="c8cc" class="lk jk hh lg b fi lp lm l ln lo">expect(testAdminUser.getUsersForDeletion(dummyPermission).response).toBeDefined();</span><span id="9c14" class="lk jk hh lg b fi lp lm l ln lo">    });</span><span id="bfa9" class="lk jk hh lg b fi lp lm l ln lo">    it(‘remove all users with the targeted permissions’, () =&gt; {</span><span id="b536" class="lk jk hh lg b fi lp lm l ln lo">expect(testAdminUser.deleteUsers(dummyUser).response.success).toBe(true);</span><span id="6c3e" class="lk jk hh lg b fi lp lm l ln lo">    });</span><span id="4240" class="lk jk hh lg b fi lp lm l ln lo">    it(‘check that the users have actually been removed’, () =&gt; {</span><span id="5636" class="lk jk hh lg b fi lp lm l ln lo">        let listOfUsers = testAdminUser.getUsersForDeletion(dummyPermission).response;</span><span id="00be" class="lk jk hh lg b fi lp lm l ln lo">        expect(listOfUsers.length).toBeLessThan(1);</span><span id="6a1c" class="lk jk hh lg b fi lp lm l ln lo">    });</span><span id="32e8" class="lk jk hh lg b fi lp lm l ln lo">});</span></pre><p id="7de9" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi">制作一个新的模型来更新两个因子设置</strong></p><pre class="lb lc ld le fd lf lg lh li aw lj bi"><span id="42bf" class="lk jk hh lg b fi ll lm l ln lo">‘use strict’;</span><span id="4d1f" class="lk jk hh lg b fi lp lm l ln lo">const testAdminUser = require(‘./adminUser.js’);</span><span id="9923" class="lk jk hh lg b fi lp lm l ln lo">describe(‘make a new modal to update two factor settings’, () =&gt; {</span><span id="cd05" class="lk jk hh lg b fi lp lm l ln lo">    let dummyUser = {</span><span id="09ac" class="lk jk hh lg b fi lp lm l ln lo">        username: ‘testdummy’,</span><span id="1cec" class="lk jk hh lg b fi lp lm l ln lo">        password: ‘t3StD4mM7’</span><span id="f91a" class="lk jk hh lg b fi lp lm l ln lo">    };</span><span id="4131" class="lk jk hh lg b fi lp lm l ln lo">    it(‘check if new modal has been created’, () =&gt; {</span><span id="c890" class="lk jk hh lg b fi lp lm l ln lo">        expect(‘#two-factor-modal’).toExist();</span><span id="ee0a" class="lk jk hh lg b fi lp lm l ln lo">    });</span><span id="9b8a" class="lk jk hh lg b fi lp lm l ln lo">    it(‘check that two factor settings have loaded with the selected    value’, () =&gt; {<br/>    expect(testAdminUser.getTwoFactorSettings(dummyUser).response).not.toBeNull();</span><span id="34bf" class="lk jk hh lg b fi lp lm l ln lo">    });</span><span id="6c71" class="lk jk hh lg b fi lp lm l ln lo">    it(‘check that changing the two factor setting updates the value for the user’, () =&gt; {</span><span id="11c5" class="lk jk hh lg b fi lp lm l ln lo">        let selectedValue = false;</span><span id="05f6" class="lk jk hh lg b fi lp lm l ln lo">        let isUpdateSuccessful = testAdminUser.updateTwoFactorSettings(dummyUser).response.success;</span><span id="0c53" class="lk jk hh lg b fi lp lm l ln lo">        if (isUpdateSuccessful) {</span><span id="263a" class="lk jk hh lg b fi lp lm l ln lo">expect(testAdminUser.getTwoFactorSettings(dummyUser).response).toBe(selectedValue);</span><span id="f25b" class="lk jk hh lg b fi lp lm l ln lo">        }</span><span id="d938" class="lk jk hh lg b fi lp lm l ln lo">    });</span><span id="9946" class="lk jk hh lg b fi lp lm l ln lo">});</span></pre><p id="5fb9" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这些是一些如何使用Jasmine编写测试的例子，但是大多数测试库都遵循类似的流程。您将描述您试图测试的内容，然后编写一些虚拟条件来对您计划实现的代码执行这些测试。这并不是为这些任务编写测试的唯一方法，所以如果你觉得有改进的空间，就自己编写测试吧！无论如何，这是你获得最大利益的地方。</p><p id="e06b" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">编写测试并不难，只是需要时间来适应。当你通常得到一个任务并直接进入代码时，首先编写测试似乎很复杂。许多开发人员马上会问，如何为尚不存在的代码编写测试。那不是看待它的正确方式。您不必编写测试来检查代码的实现。您正在编写测试来检查一个<em class="lq">特性</em>是否按照业务方要求的方式工作。</p><p id="0fe6" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这就是为什么你可以在写代码之前写一个测试。一旦你写好了测试，你基本上就有了你需要写的代码的大纲。所以您编写代码来通过特性测试。然后你重构它，使它更有效。这就是TDD/BDD过程的工作方式，当你掌握了它的窍门时，它会变得非常酷。</p><p id="9936" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">你认为为什么开发人员在是否写测试的问题上如此分裂？我知道有些从事软件工作20多年的人从来没有编写过测试，也有些人不会想到在没有测试的情况下编写代码。为什么会有这样的分野？是因为整个测试相对较新，还是因为商业运作方式或其他原因？我真的很好奇！</p></div><div class="ab cl lr ls go lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ha hb hc hd he"><p id="2f41" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">确保你在推特上关注我:<a class="ae km" href="https://twitter.com/FlippedCoding" rel="noopener ugc nofollow" target="_blank">https://twitter.com/FlippedCoding</a>🙂</p></div></div>    
</body>
</html>