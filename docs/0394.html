<html>
<head>
<title>Locale changes and the AndroidViewModel antipattern</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">地区变更和AndroidViewModel反模式</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/locale-changes-and-the-androidviewmodel-antipattern-84eb677660d9?source=collection_archive---------2-----------------------#2019-04-02">https://medium.com/androiddevelopers/locale-changes-and-the-androidviewmodel-antipattern-84eb677660d9?source=collection_archive---------2-----------------------#2019-04-02</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><blockquote class="ie"><p id="e44b" class="if ig hh bd ih ii ij ik il im in io dx translated">TL；DR:从视图模型中公开资源id，以避免显示过时的数据。</p></blockquote><p id="ce1e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl io ha bi translated">在ViewModel中，如果你要公开来自资源的数据(字符串、可绘制图形、颜色……)，你必须考虑到ViewModel对象会忽略配置变化，比如<strong class="ir hi">地区变化</strong>。当用户更改他们的区域设置时，活动被重新创建，但是ViewModel对象没有。</p><figure class="jn jo jp jq fd jr er es paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="er es jm"><img src="../Images/4f385911bb5dd9ec97f1d1ed5386b0dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kL5zW7zi_ImPUwHr"/></div></div><figcaption class="jy jz et er es ka kb bd b be z dx"><em class="kc">The localized string is not updated after a locale change</em></figcaption></figure><p id="d160" class="pw-post-body-paragraph ip iq hh ir b is kd iu iv iw ke iy iz ja kf jc jd je kg jg jh ji kh jk jl io ha bi translated"><code class="du ki kj kk kl b">AndroidViewModel</code>是<code class="du ki kj kk kl b">ViewModel</code>的一个子类，它知道应用程序的上下文。然而，如果您没有观察上下文的生命周期或对其做出反应，那么访问上下文可能是危险的。<strong class="ir hi">推荐的做法是避免在视图模型中处理具有生命周期的对象。</strong></p><p id="d749" class="pw-post-body-paragraph ip iq hh ir b is kd iu iv iw ke iy iz ja kf jc jd je kg jg jh ji kh jk jl io ha bi translated">让我们来看一个基于跟踪器中这个问题的例子:<a class="ae km" href="https://issuetracker.google.com/issues/111961971" rel="noopener ugc nofollow" target="_blank"> <em class="kn">在系统区域设置改变时更新ViewModel</em></a><em class="kn">。</em></p><figure class="jn jo jp jq fd jr"><div class="bz dy l di"><div class="ko kp l"/></div></figure><p id="8aca" class="pw-post-body-paragraph ip iq hh ir b is kd iu iv iw ke iy iz ja kf jc jd je kg jg jh ji kh jk jl io ha bi translated">问题是字符串在构造函数中只被解析一次。<strong class="ir hi">如果语言环境发生了变化，ViewModel将不会被重新创建</strong>。这将导致我们的应用程序显示过时的数据，因此只有部分本地化。</p><p id="dd65" class="pw-post-body-paragraph ip iq hh ir b is kd iu iv iw ke iy iz ja kf jc jd je kg jg jh ji kh jk jl io ha bi translated">正如<a class="ae km" href="https://twitter.com/ZelenetS" rel="noopener ugc nofollow" target="_blank"> Sergey </a>在针对该问题的<a class="ae km" href="https://issuetracker.google.com/issues/111961971#comment2" rel="noopener ugc nofollow" target="_blank">评论</a>中指出的，推荐的方法是<strong class="ir hi">公开您想要加载的资源的ID，并在视图</strong>中这样做。作为视图(活动、片段等。)是生命周期感知的，它将在配置更改后被重新创建，因此资源将被正确地重新加载。</p><figure class="jn jo jp jq fd jr"><div class="bz dy l di"><div class="ko kp l"/></div></figure><p id="ece9" class="pw-post-body-paragraph ip iq hh ir b is kd iu iv iw ke iy iz ja kf jc jd je kg jg jh ji kh jk jl io ha bi translated">即使您不打算本地化您的应用程序，它也会使测试变得更加容易，并清理您的ViewModel对象，因此没有理由不面向未来。</p><p id="6eeb" class="pw-post-body-paragraph ip iq hh ir b is kd iu iv iw ke iy iz ja kf jc jd je kg jg jh ji kh jk jl io ha bi translated">我们在android架构仓库的<a class="ae km" href="https://github.com/googlesamples/android-architecture/pull/631" rel="noopener ugc nofollow" target="_blank"> Java </a>和<a class="ae km" href="https://github.com/googlesamples/android-architecture/pull/635" rel="noopener ugc nofollow" target="_blank"> Kotlin </a>分支中修复了这个问题，我们将资源加载卸载到<a class="ae km" href="https://github.com/googlesamples/android-architecture/pull/635/files#diff-7eb5d85ec3ea4e05ecddb7dc8ae20aa1R62" rel="noopener ugc nofollow" target="_blank">数据绑定布局</a>。</p></div></div>    
</body>
</html>