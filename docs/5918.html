<html>
<head>
<title>Building Multi-Architecture Containers on OCI with Podman</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用波德曼在OCI建造多建筑集装箱</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/building-multi-architecture-containers-on-oci-with-podman-67d49a8b965e?source=collection_archive---------0-----------------------#2022-05-31">https://medium.com/oracledevs/building-multi-architecture-containers-on-oci-with-podman-67d49a8b965e?source=collection_archive---------0-----------------------#2022-05-31</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/155de15b8c877ccf1c72be4610131a25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/format:webp/1*_iw6KL7aQC94S4r-2ttmKA.jpeg"/></div><figcaption class="il im et er es in io bd b be z dx">Photo by Albin Berlin: <a class="ae ip" href="https://www.pexels.com/photo/black-sail-ship-on-body-of-water-906982/" rel="noopener ugc nofollow" target="_blank">https://www.pexels.com/photo/black-sail-ship-on-body-of-water-906982/</a></figcaption></figure><p id="091b" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">我们中的许多人已经开始使用波德曼。无论是希望尽可能多地利用开源工具，还是喜欢更容易的安装(例如在Oracle Linux 8上安装Podman [] T1 ), Podman对于许多开发人员来说都是构建和运行容器的可行解决方案。这是该主题的延续，我们已经讨论了在多架构世界中使用容器的<a class="ae ip" href="https://blogs.oracle.com/developers/post/success-with-containers-in-a-multi-architecture-world" rel="noopener ugc nofollow" target="_blank">高级含义</a>以及如何使用Docker 构建<a class="ae ip" rel="noopener" href="/@timclegg/building-multi-architecture-containers-for-oci-with-docker-59cea3b5a8c4">多架构容器。本文将讨论使用Podman构建多架构容器的实用性。</a></p><h1 id="4063" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">先决条件</h1><p id="4986" class="pw-post-body-paragraph iq ir hh is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn ha bi translated">我假设您有一个<a class="ae ip" href="https://www.oracle.com/cloud/sign-in.html" rel="noopener ugc nofollow" target="_blank"> OCI账户</a>，并且创建了一个名为<em class="jo"> hello-world </em>的OCI容器库(OCIR)。如果您想跟随并亲自尝试，请确保您有这个存储库。参见<a class="ae ip" href="https://docs.oracle.com/en-us/iaas/Content/Registry/Tasks/registrycreatingarepository.htm" rel="noopener ugc nofollow" target="_blank"> OCI文档</a>了解更多关于如何创建库的信息。</p><p id="73af" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">对于这个场景，我在Oracle Linux 8(更确切地说是8.5)上使用了Podman v3.4.2。不同的版本可能会导致不同的结果。</p><p id="fed1" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">你需要做的第一件事就是让波德曼登录OCIR:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="6843" class="lb jq hh kx b fi lc ld l le lf">$ podman login phx.ocir.io</span></pre><p id="70d0" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">确保将上述主机名更新到您正在使用的任何地区！请参见<a class="ae ip" href="https://docs.oracle.com/en-us/iaas/Content/Registry/Concepts/registryprerequisites.htm#regional-availability" rel="noopener ugc nofollow" target="_blank">区域可用性</a>了解特定区域的URL。<a class="ae ip" href="https://docs.oracle.com/en-us/iaas/Content/Registry/Tasks/registrypushingimagesusingthedockercli.htm" rel="noopener ugc nofollow" target="_blank"> OCI集装箱注册文档</a>对此有更详细的描述，你也可以在<a class="ae ip" href="https://docs.oracle.com/en-us/iaas/Content/General/Concepts/regions.htm" rel="noopener ugc nofollow" target="_blank"> OCI文档</a>中找到<a class="ae ip" href="https://docs.oracle.com/en-us/iaas/Content/General/Concepts/regions.htm" rel="noopener ugc nofollow" target="_blank">区域键</a>。</p><p id="c165" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">要使用的用户名是<namespace> / <username>(或者如果您使用的是IDCS，<namespace>/oracleidentitycloudservice/<username>)。密码将是与您的帐户相关联的身份验证令牌。如果这看起来有点陌生或令人困惑，请看一下<a class="ae ip" href="https://docs.oracle.com/en-us/iaas/Content/Registry/Tasks/registrypushingimagesusingthedockercli.htm" rel="noopener ugc nofollow" target="_blank"> OCI文档</a>以了解更多细节。</username></namespace></username></namespace></p><p id="3ac5" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">完成本练习后，您可以使用以下命令退出OCIR:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="a2c1" class="lb jq hh kx b fi lc ld l le lf">$ podman logout phx.ocir.io</span></pre><h1 id="24b3" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">建造集装箱</h1><p id="4769" class="pw-post-body-paragraph iq ir hh is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn ha bi translated">我们将使用一个超级基本的docker文件:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="658d" class="lb jq hh kx b fi lc ld l le lf">FROM container-registry.oracle.com/os/oraclelinux:8-slim<br/>CMD echo “Hello world!”</span></pre><p id="86ec" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">这里没什么特别的，只是一个简单的例子。为了将重点放在容器构建上(而不是特定于语言的复杂性)，我完全省略了任何特定的应用程序二进制文件。</p><p id="1db6" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">为了尽职调查，让我们确认基础映像在我们将要构建的两种架构中都可用。查看该容器的<a class="ae ip" href="https://container-registry.oracle.com/" rel="noopener ugc nofollow" target="_blank"> Oracle容器注册中心</a>(要了解更多信息，请点击<em class="jo"> OS </em>，然后点击<em class="jo"> oraclelinux </em>)，我们可以看到该容器支持两个平台(这两个平台都是我们想要构建的平台):</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div class="er es lg"><img src="../Images/25cfe6e24a3e28a5da531aac683be628.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*O1sy1aSfi55ZdmiWwQfYlw.jpeg"/></div><figcaption class="il im et er es in io bd b be z dx">Sample screenshot of oraclelinux:8-slim containers and their respective platforms.</figcaption></figure><p id="0f51" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">检查这一点总是一个好主意，因为您的基础映像应该存在于您将要构建的不同目标体系结构中。</p><p id="f6b1" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">现在我们需要创建两个容器映像(每个架构一个:arm64和amd64):</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="e312" class="lb jq hh kx b fi lc ld l le lf">$ podman build --platform linux/arm64/v8 -t phx.ocir.io/&lt;namespace&gt;/hello-world:v1.0.0-linux-arm64 .<br/>  &lt;omitted for brevity&gt;</span><span id="beda" class="lb jq hh kx b fi lh ld l le lf">$ podman build --platform linux/amd64 -t phx.ocir.io/&lt;namespace&gt;/hello-world:v1.0.0-linux-amd64 .<br/>  &lt;omitted for brevity&gt;</span></pre><p id="f67a" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated"><em class="jo"> — platform </em>参数用于指定所需的目标架构(构建容器的架构)。对于上下文来说，一个平台通常由操作系统、架构和变体(可选的，并且经常被排除在外)组成，每一个都用正斜杠(/)分隔。</p><p id="904f" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">为了确认一切正常，请看一下构建的容器图像:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="e9bf" class="lb jq hh kx b fi lc ld l le lf">$ podman image ls<br/>REPOSITORY                                    TAG                 IMAGE ID      CREATED         SIZE<br/>phx.ocir.io/&lt;namespace&gt;/hello-world         v1.0.0-linux-amd64  de9a0c2f01c8  29 seconds ago  114 MB<br/>phx.ocir.io/&lt;namespace&gt;/hello-world         v1.0.0-linux-arm64  0f3a0bc46798  43 seconds ago  136 MB<br/>container-registry.oracle.com/os/oraclelinux  8-slim              b7c162609f52  6 days ago      114 MB</span><span id="4d0c" class="lb jq hh kx b fi lh ld l le lf">$ podman image inspect phx.ocir.io/&lt;namespace&gt;/hello-world:v1.0.0-linux-amd64 | grep Arch<br/>        "Architecture": "amd64",</span><span id="a0a0" class="lb jq hh kx b fi lh ld l le lf">$ podman image inspect phx.ocir.io/&lt;namespace&gt;/hello-world:v1.0.0-linux-arm64 | grep Arch<br/>        "Architecture": "arm64",</span></pre><p id="c14e" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">上面的输出有点混乱，但是如果你仔细观察足够长的时间，你会发现有两个<em class="jo"> hello-world </em>容器。两者都被检查并确认为合适的架构(耶！)，所以我们已经准备好将图像推送到OCI注册中心(OCIR)。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="ee2e" class="lb jq hh kx b fi lc ld l le lf">$ podman push phx.ocir.io/&lt;namespace&gt;/hello-world:v1.0.0-linux-amd64<br/>  &lt;omitted for brevity&gt;</span><span id="6da5" class="lb jq hh kx b fi lh ld l le lf">$ podman push phx.ocir.io/&lt;namespace&gt;/hello-world:v1.0.0-linux-arm64<br/>  &lt;omitted for brevity&gt;</span></pre><p id="ef63" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">我们现在在OCIR有两幅图像。为了便于使用(运行)，我们需要创建一个清单。</p><h1 id="e305" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">创建清单</h1><p id="49fc" class="pw-post-body-paragraph iq ir hh is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn ha bi translated">下面是如何使用Podman创建清单:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="af96" class="lb jq hh kx b fi lc ld l le lf">$ podman manifest create \<br/>  phx.ocir.io/&lt;namespace&gt;/hello-world:v1.0.0 \<br/>  phx.ocir.io/&lt;namespace&gt;hello-world:v1.0.0-linux-arm64 \<br/>  phx.ocir.io/&lt;namespace&gt;hello-world:v1.0.0-linux-amd64</span><span id="7192" class="lb jq hh kx b fi lh ld l le lf">$ podman manifest push phx.ocir.io/&lt;namespace&gt;/hello-world:v1.0.0 docker://phx.ocir.io/&lt;namespace&gt;/hello-world:v1.0.0</span><span id="0ea7" class="lb jq hh kx b fi lh ld l le lf">$ docker manifest rm phx.ocir.io/&lt;namespace&gt;/hello-world:v1.0.0</span></pre><p id="2bac" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">第一个命令创建清单(hello-world:v1.0.0)，然后向其中添加两个容器(hello-world:v1.0.0-linux-amd64和hello-world:v1.0.0-arm64)。</p><p id="8829" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">第二个命令将清单推送到OCIR。</p><p id="e537" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">为了开心，我们来看看清单:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="5c63" class="lb jq hh kx b fi lc ld l le lf">$ podman manifest inspect phx.ocir.io/&lt;namespace&gt;/hello-world:v1.0.0<br/>{<br/>    "schemaVersion": 2,<br/>    "mediaType": "application/vnd.docker.distribution.manifest.list.v2+json",<br/>    "manifests": [<br/>        {<br/>            "mediaType": "application/vnd.oci.image.manifest.v1+json",<br/>            "size": 569,<br/>            "digest": "sha256:de9a0c2f01c8...",<br/>            "platform": {<br/>                "architecture": "amd64",<br/>                "os": "linux"<br/>            }<br/>        },<br/>        {<br/>            "mediaType": "application/vnd.oci.image.manifest.v1+json",<br/>            "size": 569,<br/>            "digest": "sha256:0f3a0bc46798...",<br/>            "platform": {<br/>                "architecture": "arm64",<br/>                "os": "linux"<br/>            }<br/>        }<br/>    ]<br/>}</span></pre><p id="9b65" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">一旦我们将它推送到OCIR，我们真的不需要将它保存在本地缓存中，因此我们可以删除它:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="7226" class="lb jq hh kx b fi lc ld l le lf">$ podman manifest rm phx.ocir.io/&lt;namespace&gt;/hello-world:v1.0.0</span></pre><h1 id="539c" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结论</h1><p id="0f8c" class="pw-post-body-paragraph iq ir hh is b it kn iv iw ix ko iz ja jb kp jd je jf kq jh ji jj kr jl jm jn ha bi translated">波德曼是一个伟大的工具。它支持我们有效构建多架构容器映像(和清单)所需的东西，使它成为我们工具箱中的一个有价值的工具！</p><p id="8375" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">本系列还有更多内容，我们将探索如何使用Buildah做同样的事情。敬请关注…</p><p id="503a" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">有问题吗？顺便来看看我们的<a class="ae ip" href="https://bit.ly/devrel_slack" rel="noopener ugc nofollow" target="_blank">公开讨论</a>！</p><p id="e369" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">请记住，您可以随时使用我们的免费等级免费试用这个<a class="ae ip" href="https://signup.cloud.oracle.com/?language=en&amp;sourceType=:ex:tb:::::&amp;SC=:ex:tb:::::&amp;pcode=" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>