# Slutt å bruke mock-rammeverk!

> 原文：<https://medium.com/compendium/slutt-%C3%A5-bruke-mock-rammeverk-b8da305db577?source=collection_archive---------9----------------------->

Jeg kommer ofte bort i prosjekter som bruker mock-rammeverk for å skrive enhetstester. Og selv om det er bra at man har tatt i bruk et verktøy som gjør det lettere å skrive enhetstester, slik at det i hvert fall blir skrivet *noen* enhetstester, er ikke jeg særlig glad i disse mock-rammeverk.

Jeg skjønner filosofien bak mock-rammeverket: de gjør det lettere å skrive enhetstester ved å gi utviklere enkle måter å erstatte og simulere avhengigheter på. Ofte er det slik at én linje med mock-kode er nok til å erstatte en hel klasse med dummy kode. Problemet er bare at når man først har begynt å bruke et mock-rammeverk, så blir det ikke med bare én eller to linjer med mock-kode per enhetstest, men gjerne flere og flere. Og da er det ikke lenger så farlig å legge til flere avhengighetet i kildekoden — de kan jo lett håndteres i enhetstestene med enda en linje mock-kode!

Til slutt havner man i en situasjon der man trenger ti–tjue linjer med mock-kode bare for å få enhetstestene i gang. Hva som egentlig testes, og om man virkelig fortsatt tester kildekode og ikke bare mock-rammeverket, blir etter hvert mer og mer uklart. I noen prosjekter har man gått så langt at man har begynt å lage egne klasser med hjelpermetoder for å samle opp all mock-kode som man trenger for å sette opp en enhetstest. Eller det vil si, der man kan kalle *bare* fire–fem slike hjelpermetoder for å få enhetstestene satt opp riktig. Det virker ikke riktig i mine øyne: er man da ikke tilbake til det man ønsket å unngå, bare et hakk verre?

Jeg har derfor begynt å se på bruk av et mock-rammeverk som en [*code smell*](https://en.wikipedia.org/wiki/Code_smell) : her har man prøvd seg på en kjapp løsning for å få bedre testdekning, uten å angripe det virkelige problemet, nemlig at koden er for lite testbar og/eller har for mange avhengigheter som man ikke klarer å rydde opp i. Jeg har sett unntak der det var riktig å bruke et mock-rammeverk for å få skrevet enhetstester. Et eksempel var et gammelt prosjekt med legacy-kode som var så stygg at man ikke kunne instansiere en eneste klasse uten å ha en database på plass populert med omtrent halve universet. Men slike prosjekt har virkelig vært unntak.

Hva er da den riktige måten å gjøre det på? Skriv interfaces for alle dine avhengigheter, og lag dummy implementasjoner som er så ryddige at de kan gjenbrukes fra enhetstest til enhetstest. Ofte går det like raskt som å bruke et mock-rammeverk, særlig når man klarer å gjenbruke disse dummy implementasjonene fra enhetstest til enhetstest. I tillegg dokumenterer interfacene avhengighetene dine på en god måte. Jeg har mange ganger skrevet hashbaserte fasader til filsystemet, klokker som jeg kan stille akkurat som jeg vil, eller en Random som ligner veldig mye på [XKCD 221](http://xkcd.com/221/) . Men min erfaring er at det går raskere til slutt, bare man tar det litt saktere der det er viktig. Og god enhetstesting er viktig.