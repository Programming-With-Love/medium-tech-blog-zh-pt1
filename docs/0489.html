<html>
<head>
<title>One Tap sign in for Android apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">一键登录Android应用</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/one-tap-sign-in-for-android-apps-2259ce15bc2c?source=collection_archive---------0-----------------------#2020-04-20">https://medium.com/androiddevelopers/one-tap-sign-in-for-android-apps-2259ce15bc2c?source=collection_archive---------0-----------------------#2020-04-20</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/a3cd12fa7bee3841cda35aa35944431e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IzqEfOKA9rv-56TxZDuJ9A.png"/></div></div></figure><div class=""/><p id="7fce" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">新的<a class="ae jn" href="https://developers.google.com/identity/one-tap/android/overview" rel="noopener ugc nofollow" target="_blank">一键式登录和Android上的注册</a>帮助您优化应用程序中的用户认证流程。对于许多Android应用程序来说，用户帐户是转换漏斗的重要组成部分，也是用户流失的常见来源。用户(和开发人员一样！)经常忘记他们使用哪个帐户登录，或者他们使用什么密码来使用您的服务。通过优化流程，你可以提高转化率，减少掉线。</p><figure class="jp jq jr js fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es jo"><img src="../Images/040ea97c9e13d1e2c35a6089a8da860c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ZW0oGBu0nQwZpM0uZarcTw.gif"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx">Showing One Tap for assisted sign in and sign up on Android</figcaption></figure><p id="aca0" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">一次点击创建辅助登录和注册用户界面，这将增加您的现有流程与弹出窗口，让您的用户顺利认证。它不会取代您现有的登录或注册流程，但可以帮助您优化选择使用One Tap overlay的用户体验。</p><blockquote class="jx"><p id="ac0d" class="jy jz hs bd ka kb kc kd ke kf kg jm dx translated">一次点击增加您现有的登录或注册流程</p></blockquote><p id="c00b" class="pw-post-body-paragraph ip iq hs ir b is kh iu iv iw ki iy iz ja kj jc jd je kk jg jh ji kl jk jl jm ha bi translated"><strong class="ir ht">一键支持</strong></p><ul class=""><li id="46a1" class="km kn hs ir b is it iw ix ja ko je kp ji kq jm kr ks kt ku bi translated"><strong class="ir ht">使用他们的Google帐户或保存的密码登录您服务的现有帐户</strong></li><li id="a585" class="km kn hs ir b is kv iw kw ja kx je ky ji kz jm kr ks kt ku bi translated"><strong class="ir ht">使用他们的谷歌账户注册一个新账户</strong></li></ul><p id="e5b4" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">它配有<code class="du la lb lc ld b">com.google.android.gms:play-services-auth</code>版本<code class="du la lb lc ld b">18.0.0</code>。</p><h2 id="2d93" class="le lf hs bd lg lh li lj lk ll lm ln lo ja lp lq lr je ls lt lu ji lv lw lx ly bi translated">一键和谷歌身份服务</h2><p id="64e3" class="pw-post-body-paragraph ip iq hs ir b is lz iu iv iw ma iy iz ja mb jc jd je mc jg jh ji md jk jl jm ha bi translated">One Tap是目前正在开发的名为谷歌身份服务的新库套件的一部分。谷歌身份服务最终将整合<a class="ae jn" href="https://developers.google.com/identity/smartlock-passwords/android" rel="noopener ugc nofollow" target="_blank">智能密码锁</a>和<a class="ae jn" href="https://developers.google.com/identity/sign-in/android/start-integrating" rel="noopener ugc nofollow" target="_blank">谷歌登录库</a>的全部功能，并引入新功能。Google登录库允许你使用Google帐户登录(就像一次点击一样),并提供额外的功能，如Google登录按钮和请求额外权限的能力。然而，这是一项正在进行的工作，第一个版本还没有实现这些库的全部特性。</p><blockquote class="jx"><p id="82a2" class="jy jz hs bd ka kb kc kd ke kf kg jm dx translated">谷歌身份服务最终将为安卓开发者统一谷歌登录和智能密码锁</p></blockquote><p id="da88" class="pw-post-body-paragraph ip iq hs ir b is kh iu iv iw ki iy iz ja kj jc jd je kk jg jh ji kl jk jl jm ha bi translated">One Tap是我们即将推出的谷歌身份服务的第一个功能，现在已经可以在应用程序中使用，以优化登录和注册流程。我们将致力于增加谷歌登录和密码库智能锁提供的其他功能。这些功能包括保存密码、使用Google登录按钮登录、请求访问用户数据(如驱动器内容)的权限、使用Google登录执行自动和静默登录、保存idp凭据以及为自动填充流程查找电话号码。我们希望在今年晚些时候在谷歌身份服务中推出这些功能。</p><p id="106b" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">与现有的谷歌登录和智能密码锁用户界面相比，我们发现用户更有可能通过One Tap用户界面成功登录。此外，他们在重新登录时更有可能选择正确的帐户，这有助于他们进入你的应用程序，避免创建重复的帐户，并减少支持请求。之前发布的这个UI 的<a class="ae jn" href="https://developers.google.com/identity/one-tap/web" rel="noopener ugc nofollow" target="_blank">网页版已经让一些网站的转化率提高了2倍。</a></p><p id="9a39" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">对于现有的应用</strong>，我们的建议是在对你的应用和团队有意义的时候，评估增加一个点击来增强你现有的登录和注册流程(你不需要马上这么做)。</p><p id="7a56" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">需要谷歌登录或智能密码锁功能的应用程序目前还不可用，现在可以使用这两个库在现有流程的基础上添加一个Tap，或者等待今年晚些时候添加支持。</p><p id="3b98" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">对于新应用</strong>，我们建议使用一次点击来创建优化的登录和注册体验。</p><blockquote class="me mf mg"><p id="f4d3" class="ip iq mh ir b is it iu iv iw ix iy iz mi jb jc jd mj jf jg jh mk jj jk jl jm ha bi translated"><em class="hs">一键点击并不能取代</em> <a class="ae jn" href="https://developers.google.com/identity/sign-in/android/start-integrating" rel="noopener ugc nofollow" target="_blank"> <em class="hs">谷歌登录</em> </a> <em class="hs">按钮，而是增加了你的应用程序现有的登录和注册流程。除了现有的按钮之外，你可以在一个有Google登录按钮的应用程序中点击一下来创建一个辅助登录或注册流程。</em></p></blockquote><h1 id="a5f0" class="ml lf hs bd lg mm mn mo lk mp mq mr lo ms mt mu lr mv mw mx lu my mz na lx nb bi translated">一键辅助登录</h1><figure class="jp jq jr js fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es nc"><img src="../Images/4e6c60d3e1d1c3d502a5be0ad45047ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mTQcQ-RpuU3ykRz7"/></div></div></figure><p id="caa8" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">一次点击辅助登录向用户显示一个覆盖图，提示他们使用之前授权的帐户重新登录。用户必须之前已经登录，才能显示为“登录”选项。</p><p id="1249" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht"> <em class="mh">警告:</em> </strong> <em class="mh">当用户没有以前授权的帐户时，您必须实现一键注册。如果你只实现登录，你不会向以前没有使用过你的应用或服务的用户显示覆盖图。</em></p><p id="e06c" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">一次点击登录由您的代码触发。根据您的应用程序，这可能会在应用程序首次启动时触发，或者在用户尝试执行受保护的操作时触发。</p><p id="838d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">一旦你决定开始登录过程，你可以通过调用<code class="du la lb lc ld b">SignInClient</code>上的<code class="du la lb lc ld b">beginSignIn</code>来查询是否有账户可以登录。对于登录流程，重要的是您要配置使用<code class="du la lb lc ld b">setFilterByAuthorizedAccounts(true)</code>登录，以便只返回之前授权(或登录)的账户。您可以在<a class="ae jn" href="https://developers.google.com/identity/one-tap/android/get-saved-credentials" rel="noopener ugc nofollow" target="_blank">文档</a>中了解更多信息。</p><p id="99b0" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">来自<code class="du la lb lc ld b">beginSignIn</code>的回调将通过一个<code class="du la lb lc ld b">PendingIntent</code>，当启动时显示覆盖图。然后用提供的PendingIntent调用<code class="du la lb lc ld b">startIntentSenderForResult</code>，在当前活动的上显示模态登录弹出窗口<em class="mh">。</em></p><figure class="jp jq jr js fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es nd"><img src="../Images/51a7b1d50960f6ca7207f8fc5298c8d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iOpTMnt0KeMoG0ef"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx"><em class="ne">Use the PendingIntent provided by the </em><code class="du la lb lc ld b"><em class="ne">SignInClient</em></code><em class="ne"> to overlay the current </em><code class="du la lb lc ld b"><em class="ne">Activity</em></code><em class="ne"> with a One Tap login dialog.</em></figcaption></figure><blockquote class="jx"><p id="b8d8" class="jy jz hs bd ka kb nf ng nh ni nj jm dx translated">一次点击可以覆盖应用程序中的任何活动</p></blockquote><p id="f2c1" class="pw-post-body-paragraph ip iq hs ir b is kh iu iv iw ki iy iz ja kj jc jd je kk jg jh ji kl jk jl jm ha bi translated">单击对话框可以显示在应用程序的任何地方。因此，您可以让用户在要求他们登录之前开始使用您的应用程序。这允许您为应用程序构建优化的登录流。无论你在哪里调用<code class="du la lb lc ld b">startIntentSenderForResult</code>，一个轻击将覆盖在那个<code class="du la lb lc ld b">Activity</code>的顶部。</p><figure class="jp jq jr js fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es nd"><img src="../Images/0e48623baad998d16a9b91c9830d1c39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MB3YApfmmY163y_R"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx">The result of the prompt is returned using onActivityResult</figcaption></figure><p id="9983" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然后，用户只需点击一下就可以登录，或者取消提示。无论哪种方式，结果都发送到<code class="du la lb lc ld b">onActivityResult</code>。您使用同一个客户机来解析结果，并获得一个联合登录(Google Sign-In)或一个密码。然后像平常一样继续登录你的后端。</p><h1 id="ce6e" class="ml lf hs bd lg mm mn mo lk mp mq mr lo ms mt mu lr mv mw mx lu my mz na lx nb bi translated">只需轻轻一点，就能注册</h1><figure class="jp jq jr js fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es nk"><img src="../Images/8735d6b4c8397097295bfe7326a9555c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5hB936kXFYpQIuCg"/></div></div></figure><p id="002a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果一次点击找不到任何用于登录的授权帐户，<code class="du la lb lc ld b">beginSignIn</code>将调用失败监听器，而不是向您的应用程序传递一个<code class="du la lb lc ld b">PendingIntent</code>。当这种情况发生时，你应该重复查询，但这一次寻找可以用来注册的帐户。</p><p id="570a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这次用<code class="du la lb lc ld b">setFilterByAuthorizedAccounts(false)</code>配置一个Tap，它将查询任何可以用来注册的有效帐户，以及任何以前授权的帐户。如果找到了，您将获得一个<code class="du la lb lc ld b">PendingIntent</code>，您可以用它来显示一个注册覆盖图。当系统提示用户注册时，会要求用户同意共享电子邮件和个人资料权限。</p><p id="b988" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">概括来说，这是一次点击覆盖的整体流程。</p><figure class="jp jq jr js fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es jo"><img src="../Images/e7dadbbadfaa76252de8f47c39e146e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kBYo9OyEDxWFqheV"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx"><em class="ne">Flow chart showing the one tap flow using setFilterByAuthorizedAccounts</em></figcaption></figure><p id="d041" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">而且，真的就是这样。API还支持密码，但是支持联邦身份验证登录就足够了。</p><h1 id="d703" class="ml lf hs bd lg mm mn mo lk mp mq mr lo ms mt mu lr mv mw mx lu my mz na lx nb bi translated">我如何实现我的密码流？</h1><p id="7d1f" class="pw-post-body-paragraph ip iq hs ir b is lz iu iv iw ma iy iz ja mb jc jd je mc jg jh ji md jk jl jm ha bi translated">您可以将使用一次点击的密码登录视为密码管理器—凭据将被存储并与您的应用程序共享，就像用户键入了它们一样。</p><p id="cb18" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">One Tap使用与<a class="ae jn" href="https://developer.android.com/guide/topics/text/autofill" rel="noopener ugc nofollow" target="_blank">自动填充</a>和<a class="ae jn" href="https://developers.google.com/identity/smartlock-passwords/android" rel="noopener ugc nofollow" target="_blank">智能密码锁</a>相同的密码存储。因此，如果用户曾经使用其中任何一个为您的应用程序保存密码，它将在One Tap提示上作为帐户选项显示给用户。</p><blockquote class="jx"><p id="e749" class="jy jz hs bd ka kb kc kd ke kf kg jm dx translated">一次点击使用与自动填充和智能锁相同的密码存储</p></blockquote><p id="6ba2" class="pw-post-body-paragraph ip iq hs ir b is kh iu iv iw ki iy iz ja kj jc jd je kk jg jh ji kl jk jl jm ha bi translated">有三个基本的密码流:检索保存的凭据、输入新凭据和保存新凭据。</p><h2 id="9f31" class="le lf hs bd lg lh li lj lk ll lm ln lo ja lp lq lr je ls lt lu ji lv lw lx ly bi translated">检索保存的密码凭据</h2><p id="1df1" class="pw-post-body-paragraph ip iq hs ir b is lz iu iv iw ma iy iz ja mb jc jd je mc jg jh ji md jk jl jm ha bi translated">在初始的One Tap注册流程中，配置<code class="du la lb lc ld b">beginSignInRequest</code>以支持密码。然后，用户将在One Tap UI中看到任何保存的密码选项。</p><pre class="jp jq jr js fd nl ld nm nn aw no bi"><span id="4001" class="le lf hs ld b fi np nq l nr ns"><strong class="ld ht">.setPasswordRequestOptions(PasswordRequestOptions.builder()</strong></span><span id="a08f" class="le lf hs ld b fi nt nq l nr ns"><strong class="ld ht">    .setSupported(true)</strong></span><span id="fbd6" class="le lf hs ld b fi nt nq l nr ns"><strong class="ld ht">    .build())</strong></span></pre><h2 id="071d" class="le lf hs bd lg lh li lj lk ll lm ln lo ja lp lq lr je ls lt lu ji lv lw lx ly bi translated">用密码让用户登录</h2><p id="56e8" class="pw-post-body-paragraph ip iq hs ir b is lz iu iv iw ma iy iz ja mb jc jd je mc jg jh ji md jk jl jm ha bi translated">如果用户从One Tap UI中选择一个保存的密码，它将使用<code class="du la lb lc ld b">onActivityResult</code>提供给你的应用程序。然后，您应该像平常一样登录到您的后端，就像用户输入了密码一样。</p><p id="ef48" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果用户没有一键选择帐户，您可以显示常规的用户名/密码屏幕。One Tap没有用于输入密码的UI，所以您必须自己构建这个屏幕并实现登录。</p><blockquote class="jx"><p id="5c37" class="jy jz hs bd ka kb kc kd ke kf kg jm dx translated">一次点击不能提供输入密码的用户界面，你必须构建一个支持输入新密码的用户界面</p></blockquote><h2 id="3aa2" class="le lf hs bd lg lh nu lj lk ll nv ln lo ja nw lq lr je nx lt lu ji ny lw lx ly bi translated">登录后保存密码</h2><p id="1132" class="pw-post-body-paragraph ip iq hs ir b is lz iu iv iw ma iy iz ja mb jc jd je mc jg jh ji md jk jl jm ha bi translated">用户输入密码后，使用<a class="ae jn" href="https://developer.android.com/guide/topics/text/autofill" rel="noopener ugc nofollow" target="_blank">自动填充</a>提示用户保存密码。下次用户返回到您的应用程序时，保存的密码将作为一个选项出现在One Tap登录提示中。</p><p id="8e9c" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">确保<a class="ae jn" href="https://developer.android.com/guide/topics/text/autofill-optimize" rel="noopener ugc nofollow" target="_blank">已经为自动填充</a>优化了你的应用，以确保自动填充能够成功保存你的用户凭证！要测试在设备上的自动填充中保存凭据，请安装从<a class="ae jn" href="https://developer.android.com/guide/topics/text/autofill-optimize" rel="noopener ugc nofollow" target="_blank">文档</a>链接的测试自动填充服务—这可让您确保您的自动填充实现将与所有自动填充服务一起工作。要了解更多关于优化你的应用程序自动填充的信息，请查看<a class="ae jn" href="https://codelabs.developers.google.com/codelabs/optimize-autofill/#0" rel="noopener ugc nofollow" target="_blank">代码实验室</a>。</p><p id="7d2e" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在你为自动填充优化你的应用程序后，你也可以考虑为密码集成<a class="ae jn" href="https://developers.google.com/identity/smartlock-passwords/android" rel="noopener ugc nofollow" target="_blank">智能锁，让你对密码保存有更多的控制。</a></p><h1 id="81e1" class="ml lf hs bd lg mm mn mo lk mp mq mr lo ms mt mu lr mv mw mx lu my mz na lx nb bi translated">了解更多信息</h1><p id="0db7" class="pw-post-body-paragraph ip iq hs ir b is lz iu iv iw ma iy iz ja mb jc jd je mc jg jh ji md jk jl jm ha bi translated">这篇博客文章旨在向你概述One Tap为你的应用程序提供了什么，以及你将如何集成它的想法。One Tap提供了通过登录和注册Android来帮助用户的能力——提高转化率并避免掉线。使用一个相当小的API，只需一次点击就可以轻松扩充现有的授权流。</p><p id="c39e" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">查看<a class="ae jn" href="https://developers.google.com/identity/one-tap/android/overview" rel="noopener ugc nofollow" target="_blank"> One Tap文档</a>以了解更多关于将其集成到您的应用中的信息！</p></div></div>    
</body>
</html>