<html>
<head>
<title>Introducing new open-source tools for the Elixir community</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为Elixir社区引入新的开源工具</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/introducing-new-open-source-tools-for-the-elixir-community-2f7bb0bb7d8c?source=collection_archive---------0-----------------------#2015-12-18">https://medium.com/pinterest-engineering/introducing-new-open-source-tools-for-the-elixir-community-2f7bb0bb7d8c?source=collection_archive---------0-----------------------#2015-12-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="5b71" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">史蒂夫·科恩| Pinterest工程师，数据</p><p id="de04" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">80年代通常不会被认为是一个阴郁严肃的十年。然而，当大众在听王聪的“今夜人人开心”并希望有一台基于DeLorean的时间机器时，瑞典一家电信公司的几名工程师却意外地发明了未来。他们正在解决一个电信问题，但奇怪的巧合是，他们正在解决的问题也与工程师们面临的问题非常相似，他们将看到德罗宁时间机器在完成30年的未来跳跃后所面临的问题。</p><p id="bdcb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">尽管它有很多优点，这个神奇的系统从未真正得到过关注，而是像一个城市传说一样传播开来:由经验丰富的工程师小声讲述，他们总是从第三手听说它。当然，你认识一个堂兄，他的室友认识一个女孩，她在两个服务器上运行几百万个连接，但是你从来没有真正相信过这些东西。</p><p id="4c4e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我在这里告诉你这些故事是真的。而且还有续集。</p><p id="51bb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当然，我说的是Erlang，虽然Erlang最近在WhatsApp上取得了一些引人注目的成功，但它也留下了一些相当糟糕的遗产，原因是围绕“<a class="ae jc" href="http://damienkatz.net/2008/03/what_sucks_abou.html" rel="noopener ugc nofollow" target="_blank">语法</a>”的恐惧。虽然爱立信的那些无畏的工程师做得非常正确，但他们的创造是基于Prolog的，Prolog从未在某些利基社区之外流行起来。正因为如此，当程序员第一次看到Erlang时，他们很容易宣称它“看起来很奇怪”或者“让我眼睛疼”这种拒绝听起来可能没什么，但是多年来，它阻碍了Erlang的采用。</p><p id="5558" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">直到现在。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/3e448d08ddf628b732c7c54e9b31e07e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/0*XdEuanLxhH0Dx9iM.png"/></div></figure><p id="3c22" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一位<a class="ae jc" href="https://twitter.com/josevalim" rel="noopener ugc nofollow" target="_blank"> José Valim </a>走进来，他是Rails的核心提交者，他厌倦了让Rails处理并发性，并在Erlang温暖的怀抱中寻求庇护。这还不够，因为他意识到人们对其语法的精辟评论是如何不屑一顾的。经过不懈的努力，成果相当惊人:<a class="ae jc" href="http://elixir-lang.org/" rel="noopener ugc nofollow" target="_blank">仙丹语</a>。Elixir提供了一种Python或Ruby程序员可以接受的语法，它将1:1映射回原生Erlang。它实际上比这更进一步，给你一个小而强大的语言，这就是为什么我们对Pinterest的Elixir如此兴奋。</p><p id="5c77" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Elixir(和Erlang)令我们兴奋，因为它们处理并行性和错误的方式。计算机令人惊讶的一件事是，自2005年左右以来，它们并没有变得更快。发生的事情是，我们现在可以在一个CPU上安装更多的内核，将一个处理器变成多个。问题在于，编程语言并没有真正让利用这些内核变得特别容易。你也许可以创建一个线程，但是管理这个线程和处理共享状态是非常非常困难的。Elixir的不同之处在于它在Actor系统中运行。参与者系统只是实现了几个规则，它们是:</p><ul class=""><li id="55ae" class="jl jm hh ig b ih ii il im ip jn it jo ix jp jb jq jr js jt bi translated">一个演员有一个邮箱。</li><li id="37c6" class="jl jm hh ig b ih ju il jv ip jw it jx ix jy jb jq jr js jt bi translated">参与者通过向其他参与者发送不可变的消息来与他们进行通信。</li><li id="32a6" class="jl jm hh ig b ih ju il jv ip jw it jx ix jy jb jq jr js jt bi translated">消息被放入演员的邮箱。</li><li id="36ac" class="jl jm hh ig b ih ju il jv ip jw it jx ix jy jb jq jr js jt bi translated">当某个参与者的邮箱中有一条消息时，代码将该消息作为参数运行。这个代码被串行调用。</li><li id="93d7" class="jl jm hh ig b ih ju il jv ip jw it jx ix jy jb jq jr js jt bi translated">当一个演员遇到错误，它就死了。</li><li id="5f6c" class="jl jm hh ig b ih ju il jv ip jw it jx ix jy jb jq jr js jt bi translated">演员可以监督其他演员，如果被监督的演员死亡，则向监督人发送消息。如果不处理这条消息，主管就会死。</li></ul><p id="b114" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这听起来没什么，但是这些规则使得处理并发变得非常简单，并且可以从错误中恢复。关于Elixir，我没有告诉你的一件事是，它是一种函数式语言，没有可变的数据结构。例如，如果您有一个映射，并希望向该映射添加一个键和值，您可以调用一个函数，该函数返回一个带有键和值的新映射。</p><pre class="je jf jg jh fd jz ka kb kc aw kd bi"><span id="a8d7" class="ke kf hh ka b fi kg kh l ki kj">my_map = HashDict.new<br/>other_map = HashDict.put(my_map, :my_age, 39)<br/>IO.inspect(my_map)<br/>#HashDict&lt;[]&gt; # my_map has not been changed<br/>IO.inspect(other_map)<br/>#HashDict&lt;[my_age: 39]&gt; # other_map has the new values</span></pre><p id="cd87" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从上面可以看出，原图没有改变。由于这个属性，Erlang VM可以在代码中的任何时间和位置暂停执行，在将来的某个时间从停止的地方继续执行。大多数非函数式编程语言不能做到这一点，这个属性使Elixir和Erlang系统能够让您的处理器一直忙碌。</p><p id="6875" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">灵丹妙药的另一个核心哲学基础是“大多数错误都是短暂的，是由糟糕状态的积累造成的。”这种情况在运行的系统中经常发生，这就是为什么重启它们可以修复许多问题。如果这种行为是系统的一部分呢？好吧，那你就有长生不老药了，Erlang，现在你明白“让它崩溃”哲学的开始了。</p><p id="18d1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因为参与者可以互相监视，所以它们也可以互相重启，并且在出现故障的情况下，参与者可以以已知的良好状态重启。这真的很重要，因为它让暂时的错误成为真正的暂时错误，并防止您编写大量的错误处理代码。见鬼，它阻止您编写大量代码来处理数据中的越界情况，而宁愿编码到“快乐的路径”,并让参与者在发生其他事情时崩溃和烧毁。当然，这是一种过于简单化的做法，但是当用Elixir编码时，您会发现自己编写的样板错误处理代码更少，而业务逻辑更多。</p><p id="ec8b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">热爱长生不老药还有其他原因。它有出色的运行时工具。我曾经通过登录到远程控制台，诊断问题并重新启动日志应用程序来修复一个正在运行的生产系统，日志应用程序由于后端重新启动而过载。Elixir还有一个干净简单的标准库，设计得非常周到。该语言大量使用模式匹配，这是一种防止比类型错误更常见的值错误的技术。它还具有创新的流水线操作符，允许数据以清晰易读的方式从一个函数流向下一个函数。为了感受一下流水线操作，对比一下Python和Elixir中的两段代码:</p><pre class="je jf jg jh fd jz ka kb kc aw kd bi"><span id="ac8d" class="ke kf hh ka b fi kg kh l ki kj">python<br/> " ".join(map(str.capitalize, "hello_there_world".split("_")))<br/><br/>elixir<br/>"hello_there_world"<br/>|&gt; String.split("_")<br/>|&gt; Enum.map(&amp;String.capitalize\1)<br/>|&gt; Enum.join(" ")</span></pre><p id="f3a8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意在python例子中，一切都是反向的，从嵌套的内部上下文溢出到外部上下文。现在对比一下长生不老药代码的线性和清晰程度，一步一步地处理数据。上一步的输出作为第一个参数自动发送到下一个函数调用。这种技术受Unix中管道的启发。太棒了。</p><p id="1816" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以，我们喜欢长生不老药，并且已经看到了一些相当大的胜利。管理Pinterest API和Ads API速率限制的系统内置在Elixir中。其50%的响应时间约为500微秒，90%的响应时间为800微秒。是的，微秒。</p><p id="a07c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们也看到了代码清晰度的提高。我们正在将我们的通知系统从Java转换为Elixir。Java版本使用了Actor系统，大约有10，000行代码。新的长生不老药系统将这一数字缩减到了1000行左右。基于Elixir的系统也比Java系统更快、更一致，并且运行在一半数量的服务器上。</p><p id="2a56" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">等等，还有更多。</strong></p><p id="e11b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们写这篇博文并不仅仅是为了吹嘘一种新的编程语言，尽管那会很棒。我们也热爱开源，我们将向Elixir社区提供一些代码。有鉴于此，我们很兴奋地宣布两个我们一直非常依赖的项目，<a class="ae jc" href="https://github.com/pinterest/elixometer" rel="noopener ugc nofollow" target="_blank"> Elixometer </a>和<a class="ae jc" href="https://github.com/pinterest/riffed" rel="noopener ugc nofollow" target="_blank"> Riffed </a>。</p><p id="2740" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> Elixometer </strong></p><p id="5501" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Elixometer是已经非常优秀的Exometer库的包装器，它提供统计和日志记录。您不能修复无法测量的东西，Exometer提供了跨代码的可见性，甚至可以看到包含的库和Erlang VM本身。Elixometer增强了Exometer，并提供了对其深度日志记录和统计数据收集功能的灵丹妙药式的访问。</p><p id="90cb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">重复播放</strong></p><p id="170b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们大量使用了<a class="ae jc" href="https://thrift.apache.org/" rel="noopener ugc nofollow" target="_blank"> Thrift RPC </a>机制，遗憾的是，没有针对Elixir的Thrift实现。虽然有Erlang实现，但出于各种原因，它对酏剂开发人员来说不是很友好。Riffed修复了这个问题，并大量使用了Elixir宏来将Erlang实现重写为Elixir开发人员会喜欢的东西。</p><p id="ca22" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们对Elixir非常感兴趣，喜欢在其中构建高度并发、快速和可伸缩的服务器。我们也是开源的忠实粉丝，你应该看看这个空间，寻找更多的灵丹妙药。如果这听起来像是你想参与的事情，并且你对Erlang VM有深入的了解，<a class="ae jc" href="https://careers.pinterest.com/careers/" rel="noopener ugc nofollow" target="_blank">请联系我们</a>！</p></div></div>    
</body>
</html>