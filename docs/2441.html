<html>
<head>
<title>Today I Learned: Row Locking Transaction pada PostgreSQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Today I Learned: Row Locking Transaction pada PostgreSQL</h1>
<blockquote>ÂéüÊñáÔºö<a href="https://medium.easyread.co/today-i-learned-row-locking-transaction-pada-postgresql-f8dee8084f90?source=collection_archive---------2-----------------------#2020-01-07">https://medium.easyread.co/today-i-learned-row-locking-transaction-pada-postgresql-f8dee8084f90?source=collection_archive---------2-----------------------#2020-01-07</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="9be3" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">Bagaimana saya melakukan Row-Level Locking Transaction di PostgreSQL.</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/34918c93e296bd030d80c1cf60d5589c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dvAYXPuCVffbgfvn"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@theframedbear?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">The Framed Bear</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="2668" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Hari ini, setelah bergelut selama 2 hari kurang beberapa jam. Saya menemukan kasus yang cukup membuat saya pusing dan bingung. Hingga pada akhirnya, saya berhasil menemukan solusinya. Dan solusinya ternyata sangat sederhana.</p><p id="873d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Sedikit cerita, saat ini, saya lagi mengerjakan proses pengembangan <em class="lp"> core-payment </em> di <a class="ae ks" href="https://www.xendit.co/" rel="noopener ugc nofollow" target="_blank"> Xendit </a> , salah satu perusahaan <em class="lp"> payment-gateway </em> di Indonesia, tempat saya bekerja saat ini. Saya baru bergabung sekitar 6 bulan yang lalu. Dan kebetulan saya mendapat kepercayaan untuk ikut serta dalam proyek me- <em class="lp"> refactor </em> <em class="lp"> core system </em> kami.</p><p id="7755" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="lp"> Nah </em> , isu yang baru saya alami ini berkaitan dengan pengembangan sistem baru dari <em class="lp"> core payment </em> kami. Isu tersebut berkaitan dengan <em class="lp"> concurrency </em> dan <em class="lp"> transaction </em> di database, di salah satu <em class="lp"> service </em> kami, atau sebut saja <em class="lp"> service </em> <code class="fe lq lr ls lt b"><strong class="kv io">Payment Code Generator</strong></code> .</p><p id="d7b7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Seperti namanya, <em class="lp"> service </em> ini akan menerima <em class="lp"> request </em> dari user dan responsenya adalah sebuah kode pembayaran yang dapat digunakan user untuk melakukan pembayaran.</p><p id="7349" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="lp"> Service </em> ini, secara sederhana tanpa mencakup <em class="lp"> bisnis logic </em> , bisa saya sebut hanya terdiri dari 2 <em class="lp"> table </em> . Sebut saja: <code class="fe lq lr ls lt b"><strong class="kv io">master_counter</strong></code> dan <code class="fe lq lr ls lt b"><strong class="kv io">payment_code</strong></code> . Kedua <em class="lp"> table </em> ini saling berkaitan yang akan saya jelaskan nanti dibawah.</p><p id="65c0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Untuk <em class="lp"> schema </em> databasenya, bisa dilihat sebagai berikut:</p><ul class=""><li id="9933" class="lu lv in kv b kw kx kz la lc lw lg lx lk ly lo lz ma mb mc bi translated">Schema <code class="fe lq lr ls lt b"><strong class="kv io">master_counter</strong></code></li></ul><pre class="kd ke kf kg gt md lt me mf aw mg bi"><span id="9cff" class="mh mi in lt b gy mj mk l ml mm">BEGIN;<br/>CREATE TABLE IF NOT EXISTS master_counter(<br/>  id varchar(255) NOT NULL PRIMARY KEY, <br/>  user_id VARCHAR(255) NOT NULL, <br/>  counter bigint NOT NULL, <br/>  created_at timestamptz NOT NULL, <br/>  updated_at timestamptz NOT NULL, <br/>  deleted_at timestamptz, <br/>  CONSTRAINT master_counter_user_id_unique_idx UNIQUE (user_id)<br/>);<br/>COMMIT;</span></pre><ul class=""><li id="fd13" class="lu lv in kv b kw kx kz la lc lw lg lx lk ly lo lz ma mb mc bi translated">Dan schema <code class="fe lq lr ls lt b"><strong class="kv io">payment_code</strong></code></li></ul><pre class="kd ke kf kg gt md lt me mf aw mg bi"><span id="f803" class="mh mi in lt b gy mj mk l ml mm">BEGIN;<br/>CREATE TABLE IF NOT EXISTS payment_code(<br/>  id varchar(255) NOT NULL PRIMARY KEY, <br/>  payment_code varchar(255) NOT NULL, <br/>  user_id varchar(255) NOT NULL, <br/>  created_at timestamptz NOT NULL, <br/>  updated_at timestamptz NOT NULL, <br/>  CONSTRAINT payment_code_unique_idx UNIQUE(payment_code, user_id)<br/>);<br/>COMMIT;</span></pre><p id="6fa0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Jika teman-teman lihat, di <code class="fe lq lr ls lt b"><strong class="kv io">master_counter</strong></code> , terdapat kolom <code class="fe lq lr ls lt b"><strong class="kv io">counter</strong></code> . Kolom ini akan bertambah berdasarkan request yang dilakukan oleh user. Jadi jika nilai awalnya adalah 0, lalu user melakukan request baru, maka valuenya akan di update menjadi 1.</p><p id="0bda" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Secara sederhana (tanpa <em class="lp"> bisnis logic </em> yang rumit), <em class="lp"> flow </em> dari sistem ini ketika user melakukan <em class="lp"> request </em> <em class="lp"> payment code </em> yang baru dapat dilihat sebagai berikut.</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mn"><img src="../Images/76b2abaf1c7561501d8da6cdc75cc776.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mxDww1X_77Zutq2u22VoiQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Flow the Generating Payment Code</figcaption></figure><ul class=""><li id="6ac5" class="lu lv in kv b kw kx kz la lc lw lg lx lk ly lo lz ma mb mc bi translated">Pertama, ketika user <em class="lp"> request payment code </em> baru, kita akan melakukan query nilai dari <code class="fe lq lr ls lt b"><strong class="kv io">counter</strong></code> user tersebut dari database.</li><li id="26bd" class="lu lv in kv b kw mo kz mp lc mq lg mr lk ms lo lz ma mb mc bi translated">Lalu, <code class="fe lq lr ls lt b"><strong class="kv io">counter</strong></code> yang kita query tersebut, kita tambah satu di aplikasi. Lalu kita melakukan proses hash ( <em class="lp"> apply hashing logic </em> ) yang dimana hasil hashnya adalah <em class="lp"> payment code </em> yang akan dipakai user.</li><li id="872b" class="lu lv in kv b kw mo kz mp lc mq lg mr lk ms lo lz ma mb mc bi translated">Lalu, hasil hash counter tersebut, kita simpan ke table <code class="fe lq lr ls lt b"><strong class="kv io">payment_code</strong></code> . Dan karena <code class="fe lq lr ls lt b"><strong class="kv io">payment_code</strong></code> sifatnya pasti unik. Sehingga jika ada <code class="fe lq lr ls lt b"><strong class="kv io">payment_code</strong></code> yang sama, maka databasenya akan berteriak <em class="lp"> error </em> .</li><li id="63e7" class="lu lv in kv b kw mo kz mp lc mq lg mr lk ms lo lz ma mb mc bi translated">Setelah <code class="fe lq lr ls lt b"><strong class="kv io">payment_code</strong></code> nya kita simpan, nilai <code class="fe lq lr ls lt b"><strong class="kv io">counter</strong></code> yang terbaru tadi, kita simpan kembali ke table <code class="fe lq lr ls lt b"><strong class="kv io">master_counter</strong></code></li><li id="5d87" class="lu lv in kv b kw mo kz mp lc mq lg mr lk ms lo lz ma mb mc bi translated">Terakhir, <code class="fe lq lr ls lt b"><strong class="kv io">payment_code</strong></code> yang sudah kita generate (nilai counter yang di hash) kita kembalikan sebagai response ke user.</li></ul><p id="e10e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Ya kurang-lebih, keseluruhan proses yang terjadi seperti itulah. Meski masih banyak ‚Äú <em class="lp"> logic-logic </em> ‚Äù aneh lainnya, tetapi secara garis besar, cuma sesederhana itu saja.</p><h2 id="fb4a" class="mh mi in bd mt mu mv dn mw mx my dp mz lc na nb nc lg nd ne nf lk ng nh ni nj bi translated">Problems Started</h2><p id="554a" class="pw-post-body-paragraph kt ku in kv b kw nk jo ky kz nl jr lb lc nm le lf lg nn li lj lk no lm ln lo ig bi translated">Jika saya buat ke dalam bentuk SQL query, keseluruhan prosesnya bisa kita tuliskan seperti berikut.</p><pre class="kd ke kf kg gt md lt me mf aw mg bi"><span id="69ac" class="mh mi in lt b gy mj mk l ml mm">BEGIN;<br/>SELECT counter FROM master_counter;</span><span id="dd8b" class="mh mi in lt b gy np mk l ml mm">// counter++ di aplikasi<br/>// Apply Generator Logic in Application</span><span id="6a48" class="mh mi in lt b gy np mk l ml mm">INSERT INTO payment_code(payment_code) VALUES(generated_value_with_counter);</span><span id="5bba" class="mh mi in lt b gy np mk l ml mm">UPDATE master_counter SET counter=&lt;new_value_from_application&gt;;</span><span id="d684" class="mh mi in lt b gy np mk l ml mm">COMMIT;</span></pre><p id="b345" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Dan karena saya pakai Golang untuk pengaplikasikannya, hal ini menjadi lebih mudah karena di Golang sendiri proses transaksi pada database sudah di abstraksi.</p><p id="d72d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Berikut pseudo-code proses saya di aplikasi.</p><pre class="kd ke kf kg gt md lt me mf aw mg bi"><span id="4a27" class="mh mi in lt b gy mj mk l ml mm">tx,_:=db.Begin() // Mulai Transaksi</span><span id="5748" class="mh mi in lt b gy np mk l ml mm">counter, err:= SelectCounter(tx) // Query Counter <br/>if err != nil {<br/> tx.Rollback() // Rollback jika terjadi Error<br/>}</span><span id="0cdb" class="mh mi in lt b gy np mk l ml mm">counter++<br/>generatedCode:=ApplyAlgorithm(counter) // Apply Algorithm</span><span id="5d16" class="mh mi in lt b gy np mk l ml mm">err:= SaveGeneratedCode(tx, generatedCode) // Simpan GeneratedCode<br/>if err != nil {<br/> tx.Rollback() // Rollback jika terjadi Error<br/>}</span><span id="744e" class="mh mi in lt b gy np mk l ml mm">err:=UpdateCounter(tx, counter) // Update  nilai counter yang ba<br/>if err != nil {<br/> tx.Rollback() // Rollback jika terjadi Error<br/>}</span><span id="fee4" class="mh mi in lt b gy np mk l ml mm">tx.Commit() // Commit transaksi</span></pre><p id="6f4c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="lp"> Nah </em> , ketika melihat keseluruhan proses ini, seharusnya tidak ada masalah. Dan benar saja, ketika saya coba dengan melakukan call API menggunakan Postman, semua berjalan sesuai ekspektasi.</p><p id="ce6c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Kemudian ketika saya mencoba dengan <em class="lp"> concurrent request, </em> saya mencoba melakukan <em class="lp"> load testing </em> ke aplikasi tersebut. Tidak banyak, saya hanya menggunakan 2 <em class="lp"> concurent request </em> . Lalu benih-benih errornya pun muncul.</p><pre class="kd ke kf kg gt md lt me mf aw mg bi"><span id="c652" class="mh mi in lt b gy mj mk l ml mm"><strong class="lt io">pq: duplicate key value violates unique constraint \"my_unique_payment_code_index\"</strong></span></pre><p id="205c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Dari errornya, disebutkan bahwa terjadi pelanggaran <em class="lp"> constraint </em> pada <em class="lp"> unique </em> <em class="lp"> value </em> . Ini terjadi di table <code class="fe lq lr ls lt b"><strong class="kv io">payment_code</strong></code> .</p><p id="62fe" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Asumsi saya adalah, jika terjadi error duplikat pada <code class="fe lq lr ls lt b"><strong class="kv io">payment_code</strong></code> , maka terjadi race condition disini. Dimana terdapat 2 atau lebih request saling lomba-lomba melakukan insert data.</p><p id="c398" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Dan ini terjadi karena, <code class="fe lq lr ls lt b"><strong class="kv io">payment_code</strong></code> yang diinsert adalah hasil dari algoritma hashing melakukan hashing dengan nilai <code class="fe lq lr ls lt b"><strong class="kv io">counter</strong></code> yang sama. Sehingga saat disimpan ke table, datanya pun melanggar constraint dari unique key.</p><h2 id="4cad" class="mh mi in bd mt mu mv dn mw mx my dp mz lc na nb nc lg nd ne nf lk ng nh ni nj bi translated">First Attempt! ‚Äî Using Isolation Level</h2><p id="4773" class="pw-post-body-paragraph kt ku in kv b kw nk jo ky kz nl jr lb lc nm le lf lg nn li lj lk no lm ln lo ig bi translated">Mendapati kasus ini, saya pun mulai bingung. Karena setahu saya, saya sudah menggunakan transaction di query saya.</p><p id="8342" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Dan setelah menghabiskan waktu seharian untuk searching dan exploring. Saya menemukan 3 artikel yang membuat saya paham kondisi saya.</p><ul class=""><li id="ef12" class="lu lv in kv b kw kx kz la lc lw lg lx lk ly lo lz ma mb mc bi translated"><a class="ae ks" href="https://pgdash.io/blog/postgres-transactions.html" rel="noopener ugc nofollow" target="_blank"> Transaction Isolation in PostgreSQL </a></li><li id="5f72" class="lu lv in kv b kw mo kz mp lc mq lg mr lk ms lo lz ma mb mc bi translated"><a class="ae ks" href="http://shiroyasha.io/transaction-isolation-levels-in-postgresql.html" rel="noopener ugc nofollow" target="_blank"> Transaction Isolation Levels in PostgreSQL </a></li><li id="14a0" class="lu lv in kv b kw mo kz mp lc mq lg mr lk ms lo lz ma mb mc bi translated"><a class="ae ks" href="https://blog.gojekengineering.com/on-concurrency-control-in-databases-1e34c95d396e" rel="noopener ugc nofollow" target="_blank"> On Concurrency Control in Databases </a></li></ul><p id="e218" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Saya menemukan <em class="lp"> buzzword </em> baru, yakni <code class="fe lq lr ls lt b"><strong class="kv io">isolation</strong></code> pada database.</p><p id="20f5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Dari artikel tersebut, saya pun menyimpulkan bahwa isolation level yang saya gunakan pada database saya belum cukup ketat untuk proses read-write-update secara bersamaan.</p><p id="dfd6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Lalu saya pun mencoba menambah isolation level pada query saya.</p><pre class="kd ke kf kg gt md lt me mf aw mg bi"><span id="944d" class="mh mi in lt b gy mj mk l ml mm">_, err := tx.ExecContext(ctx, "SET TRANSACTION ISOLATION LEVEL REPEATABLE READ")</span><span id="01fe" class="mh mi in lt b gy np mk l ml mm">if err != nil {<br/>   return<br/>}</span></pre><p id="5349" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Dan saya coba jalanin ulang load testnya.</p><pre class="kd ke kf kg gt md lt me mf aw mg bi"><span id="56af" class="mh mi in lt b gy mj mk l ml mm"><strong class="lt io">pq: could not serialize access due to concurrent update</strong></span></pre><p id="918e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Saya pun menemukan error baru. Disini errornya mengatakan bahwa database saya memblock request yang melakukan update secara bersamaan. Memang sih, ini sudah cukup menghindari race-condition. Tetapi, dari 2 request yang bersamaan, salah satu request akan mendapat error. Yang kita inginkan adalah, kedua request tersebut harus sukses. Jika salah satu sedang melakukan operasi transaksi, maka yang lain harus menunggu sampai selesai, lalu berjalan lagi.</p><p id="c8fb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Tidak puas dengan hasil yang saya dapat, saya pun mencoba bertanya kepada orang lain. Tidak hanya teman dari kantor saya, saya bahkan tanya ke orang-orang dari luar kantor saya.</p><p id="5708" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Dan dari semua jawaban yang saya dapat baik dari teman kantor, atau teman di kantor lain, saya pun menyimpulkan, bahwa yang saya butuhkan sebenarnya adalah <strong class="kv io"> <em class="lp"> row-level locking pada postgres </em> </strong> . Karena yang saya butuhkan adalah, read dan update pada setiap row di kolom <code class="fe lq lr ls lt b"><strong class="kv io">counter</strong></code> , sehingga saya hanya butuh pada row level locking.</p><p id="61c9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Menggunakan isolation, scopenya diaplikasikan keseluruhan table. Sehingga jika terjadi 2 read yang bersamaan, maka salah satunya akan di block dan mendapat error.</p><h2 id="bc69" class="mh mi in bd mt mu mv dn mw mx my dp mz lc na nb nc lg nd ne nf lk ng nh ni nj bi translated">Second Attempt! ‚Äî Using SELECT FOR UPDATE</h2><p id="38f0" class="pw-post-body-paragraph kt ku in kv b kw nk jo ky kz nl jr lb lc nm le lf lg nn li lj lk no lm ln lo ig bi translated">Percobaan kedua saya, adalah sebagai berikut</p><ul class=""><li id="115c" class="lu lv in kv b kw kx kz la lc lw lg lx lk ly lo lz ma mb mc bi translated">Membuat isolation level: <strong class="kv io"> READ COMMITTED </strong> (Postgres default isolation level)</li><li id="bbe0" class="lu lv in kv b kw mo kz mp lc mq lg mr lk ms lo lz ma mb mc bi translated">Menggunakan row-level locking: <strong class="kv io"> SELECT FOR UPDATE </strong></li></ul><p id="0bb7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Jadi dari code original saya, perubahan yang perlu saya lakukan hanya sebatas menambah query <code class="fe lq lr ls lt b"><strong class="kv io">FOR UDPATE</strong></code> di query read <code class="fe lq lr ls lt b"><strong class="kv io">counter</strong></code> yang saya miliki.</p><p id="be31" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Sehingga perubahannya dari query pertama saya sebelumnya adalah seperti berikut.</p><pre class="kd ke kf kg gt md lt me mf aw mg bi"><span id="81c5" class="mh mi in lt b gy mj mk l ml mm">BEGIN;<br/>SELECT counter FROM master_counter <strong class="lt io">FOR UDPATE</strong>; <strong class="lt io">// notice this</strong></span><span id="f7ec" class="mh mi in lt b gy np mk l ml mm">// Do Addition to counter in application<br/>// Apply Generator Logic in Application</span><span id="e196" class="mh mi in lt b gy np mk l ml mm">INSERT INTO payment_code(payment_code) VALUES(generated_value_with_counter);</span><span id="0ac1" class="mh mi in lt b gy np mk l ml mm">UPDATE master_counter SET counter=&lt;new_value_from_application&gt;;</span><span id="7ac3" class="mh mi in lt b gy np mk l ml mm">COMMIT;</span></pre><p id="5fd5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Yap, saya hanya menambah itu saja. Cuma 2 kata <code class="fe lq lr ls lt b">FOR UDPATE</code> . Dan itu sudah menyelesaikan permasalahan saya. Meski sebenarnya, saya tidak terlalu yakin ini solusi yang tepat, tetapi untuk saat ini, itu sudah cukup memenuhi kebutuhan saya.</p><p id="56cf" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Dan ketika saya lakukan load test lagi. Semua berjalan lancar, tidak ada issue ataupun error baru. Tidak ada terjadi race condition. Aplikasinya berjalan seperti yang saya harapkan. Jadi dari sini saja, saya sudah asumsikan bahwa solusi ini adalah solusi yang tepat.</p><p id="bed2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Namun jika teman-teman, tertarik untuk explore lebih lengkap pada query <code class="fe lq lr ls lt b">SELECT ... FOR UPDATE</code> , mungkin artikel ini, <a class="ae ks" href="http://shiroyasha.io/selecting-for-share-and-update-in-postgresql.html" rel="noopener ugc nofollow" target="_blank"> Selecting for Share and Update in PostgreSQL </a> bisa lebih menjelaskan lebih lengkap, sampai kasus-kasus yang dicakup setiap querynya.</p><p id="3e43" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Tetapi karena dengan <code class="fe lq lr ls lt b">SELECT ... FOR UDPATE</code> saja sudah menyelesaikan problem saya. Saya akan eksplore lagi kebutuhannya dilain kesempatan üòâ.</p></div><div class="ab cl nq nr hr ns" role="separator"><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv nw"/><span class="nt bw bk nu nv"/></div><div class="ig ih ii ij ik"><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nx ny l"/></div></figure></div></div>    
</body>
</html>