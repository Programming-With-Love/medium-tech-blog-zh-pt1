<html>
<head>
<title>Python(Django), Service Object &amp; DDD</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python(Django), Service Object &amp; DDD</h1>
<blockquote>原文：<a href="https://medium.easyread.co/python-django-service-object-ddd-cc8ca6b88e35?source=collection_archive---------0-----------------------#2017-09-26">https://medium.easyread.co/python-django-service-object-ddd-cc8ca6b88e35?source=collection_archive---------0-----------------------#2017-09-26</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="61e8" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">Implementasi DDD &amp; Service Object di framework berbasis MVC (Django)</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/4e1acf84dea1bd2859b50387c86a6990.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SCnrYXsd_oqPwZ1or9uyag.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Source: <a class="ae ks" href="https://www.djangoproject.com/s/img/logos/django-logo-positive.png" rel="noopener ugc nofollow" target="_blank">https://www.djangoproject.com/s/img/logos/django-logo-positive.png</a></figcaption></figure><p id="f090" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Dari pengalaman, saya pernah menggunakan <em class="lp"> beberapa </em> framework berbasis MVC, diantaranya adalah :</p><ul class=""><li id="f985" class="lq lr in kv b kw kx kz la lc ls lg lt lk lu lo lv lw lx ly bi translated">Codeigniter (PHP)</li><li id="63a4" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">CakePHP (PHP)</li><li id="ee4c" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Laravel (PHP)</li><li id="ccfc" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">RubyOnRails (Ruby)</li><li id="2c1a" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Sinatra (Ruby)</li><li id="85f8" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Scalatra (Scala)</li><li id="5b12" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">PlayFramework (Scala)</li><li id="47ab" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">ExpressJS (NodeJS)</li><li id="4632" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Gin (Golang)</li><li id="a90d" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Gorilla (Golang), walaupun sebenarnya gorilla ini lebih tepat disebut dengan library / tools daripada sebuah framework.</li></ul><p id="0fb8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Dan terakhir ini (semoga menjadi yang terakhir) adalah Django (Python). Alasan saya kenapa memilih Django:</p><ul class=""><li id="d395" class="lq lr in kv b kw kx kz la lc ls lg lt lk lu lo lv lw lx ly bi translated">No magic! <code class="fe me mf mg mh b">Explicit is better than implicit</code></li><li id="586a" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Management Command Line. Saya termasuk pengguna command line yang aktif, dan saya sangat suka sekali dengan framework yang menyediakan custom command line untuk keperluan development</li><li id="25d4" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Modular. Modular di sini bukan karena hasil dari <em class="lp"> oprekan </em> atau imajinasi dari programmer, tapi django sendiri memang didesign <em class="lp"> modular </em> dari awal, dimana bagi saya hal ini sangat bermanfaat karena proses development bisa dilakukan per context flow, yang artinya kita bisa fokus per context bukan semua controller campur aduk tidak karuan, dan hebatnya setiap module ini bisa plug and play di sistem yang lain.</li><li id="abae" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Admin Generator. Saya termasuk orang yang <strong class="kv io"> sangat sangat malas </strong> untuk membuat halaman admin hanya untuk melakukan proses CRUD, dan django menyediakan proses ini <em class="lp"> by design </em> bukan menggunakan plugin seperti di Rails dengan ActiveAdmin mereka. Dan hebatnya lagi, sistem admin ini bukan hanya sekedar CRUD tapi 100% customizable sampai ke templatenya pun bisa dicustom (kalau mau, kalau saya ogah bersentuhan dengan template).</li><li id="f9ae" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Manajemen static files, yang sangat simpel, mudah dipahami</li><li id="00a2" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Manajemen deployment yang simpel</li><li id="ac6d" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Jauh lebih hemat resource daripada Rails (ok, kalau ini pendapat saya pribadi, no debat, no flamewar!)</li><li id="3df1" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Very active development &amp; community</li><li id="e6bc" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Automate test framework per module! Extend dari python unittest + ditambah beberapa fungsionalitas tambahan untuk keperluan development.</li><li id="498c" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Python! :)</li></ul><p id="010b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Tapi di sini saya bukan menerangkan tutorial cara install atau hello world menggunakan django, tapi lebih ke bagaimana kita memanage sistem kita sesuai dengan ekspektasi bisnis, maintainable &amp; readable dengan mengimplemen DDD, khususnya Service Object.</p></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><p id="1a84" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Sekilas tentang Service Object. Pattern ini sebenarnya saya pelajari ketika saya pernah bekerja menggunakan RubyOnRails. Jujur, di Rails saya malah belajar beberapa hal, yaitu :</p><ul class=""><li id="fb01" class="lq lr in kv b kw kx kz la lc ls lg lt lk lu lo lv lw lx ly bi translated">Optimasi query database (percayalah, jika anda bekerja menggunakan RoR, pengetahuan tentang hal ini <strong class="kv io"> penting </strong> )</li><li id="beac" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Thin controller, fat model</li><li id="694a" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Kompleksitas testing</li><li id="a31b" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Core model</li></ul><p id="8807" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Sebenarnya, di framework manapun itu, ketika kita melakukan modelling itu sangat susah, minimal ini untuk saya pribadi. Kenapa ? Karena rata-rata setiap framework memiliki aturan / birokrasi mereka sendiri-sendiri, dan walaupun sama-sama berbasis MVC, tapi mereka memiliki aturan yang berbeda-beda.</p><p id="fc77" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Padahal dalam membuat sebuah modelling software, kita seharusnya tidak boleh terikat oleh aturan teknis apapun itu, misal :</p><ul class=""><li id="cec3" class="lq lr in kv b kw kx kz la lc ls lg lt lk lu lo lv lw lx ly bi translated">Aturan penggunaan library X</li><li id="9480" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Aturan penggunaan framework X</li><li id="1b19" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Aturan orm X</li><li id="563c" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Atau semacamnya</li></ul><p id="2e3e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Core model, harusnya simpel dan menunjukkan proses bisnis yang akan kita buat. Mungkin ada yang pernah mendengar istilah PO*O ? Contoh :</p><ul class=""><li id="a091" class="lq lr in kv b kw kx kz la lc ls lg lt lk lu lo lv lw lx ly bi translated">POJO: Pure Object Java Object</li><li id="a090" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">PORO: Pure Object Ruby Object</li><li id="9021" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">POPO: Pure Object Python Object</li></ul><p id="1643" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Nah, disinilah seharusnya core model kita dibentuk. Awal mula wacana <em class="lp"> service object </em> itu muncul di permukaan adalah berawal dari <em class="lp"> thin controller, fat model </em> .</p><p id="c568" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Dulu (atau mungkin sekarang juga masih ada), banyak programmer (saya juga dulunya), selalu memasukkan <strong class="kv io"> seluruh </strong> logic di…controller! Padahal, di sebuah framework berbasis MVC, seharusnya controller itu tugasnya hanya sebatas request &amp; response, tidak lebih. Hanya menerima parameter dari request dan kemudian memberikan response. Pertanyaannya adalah, lalu dimana logic seharusnya diletakkan ? Jawaban awalnya adalah di .. model. Dari sinilah, kemudian muncul istilah <em class="lp"> thin controller fat model. </em> Dan dari sinilah pula, muncul masalah kedua.</p><p id="b90f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Rata-rata setiap framework modern memiliki fitur:</p><ul class=""><li id="6a13" class="lq lr in kv b kw kx kz la lc ls lg lt lk lu lo lv lw lx ly bi translated">Data modelling (modelling table/doc)</li><li id="371b" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Migration</li></ul><p id="5a09" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Model di setiap framework saat ini sudah terikat dengan ORM dari masing-masing framework, dan ORM ini sudah terikat pula dengan sub sistem seperti untuk auto migrate, dll.</p><p id="c995" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Awalnya mungkin tidak masalah, tapi kemudian ketika sistem kita semakin lama semakin berkembang, yang terjadi adalah kita akan kesulitan dalam memaintain logic, karena <em class="lp"> seluruh </em> logic ada di satu model, belum lagi dependensi antar logic yang artinya di sini adalah dependensi antar model. Dan <em class="lp"> cons </em> yang terakhir adalah, kesulitan dalam refactoring &amp; keperluan dalam membuat abstraksi karena keterikatan dengan aturan framework tadi.</p><p id="75ac" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Dari sinilah muncul ide tentang service object. Sekilas tentang pattern ini :</p><div class="mp mq gp gr mr ms"><a href="https://medium.com/selleo/essential-rubyonrails-patterns-part-1-service-objects-1af9f9573ca1" rel="noopener follow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd io gy z fp mx fr fs my fu fw im bi translated">Essential RubyOnRails patterns — part 1: Service Objects</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">Service objects (sometimes referred to as services) is a holy grail in Ruby On Rails development that helps to…</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">medium.com</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng km ms"/></div></div></a></div><p id="7203" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Yang membuat saya tertarik adalah :</p><pre class="kd ke kf kg gt nh mh ni nj aw nk bi"><span id="f6cb" class="nl nm in mh b gy nn no l np nq">Service objects (sometimes referred to as <em class="lp">services</em>) is a holy grail in Ruby On Rails development that helps to <a class="ae ks" href="http://blog.codeclimate.com/blog/2012/10/17/7-ways-to-decompose-fat-activerecord-models/" rel="noopener ugc nofollow" target="_blank">decompose your fat ActiveRecord models</a> and keep your controllers slim and readable.</span></pre><p id="1bcf" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Dan setelah saya pelajari lebih dalam, dengan menggunakan pattern ini, kita bisa mendapat manfaat :</p><ul class=""><li id="bc4f" class="lq lr in kv b kw kx kz la lc ls lg lt lk lu lo lv lw lx ly bi translated">Membuat abstraksi sesuai kebutuhan bisnis flow software</li><li id="aaa0" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Bebas dari aturan ORM</li><li id="0209" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Bebas dari aturan request response</li><li id="756d" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Dependency Injection, ketika kita membutuhkan manajemen dependensi dengan service lainnya, atau konsumsi ORM tertentu.</li><li id="c588" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Mudah untuk ditest (unittest, integration test)</li></ul><p id="7c16" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Ketika kita berhadapan dengan satu buah flow / aktivitas, maka yang perlu kita lakukan adalah membuat satu buah service terkait flow tersebut. Contoh:</p><ul class=""><li id="f784" class="lq lr in kv b kw kx kz la lc ls lg lt lk lu lo lv lw lx ly bi translated">Proses membuat product, maka akan ada ProductCreationService</li><li id="fdfa" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Proses update product, maka akan ada ProductUpdaterService</li><li id="863f" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">dan semacamnya</li></ul><p id="355d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Di dalam setiap service kita bisa mengkonsumsi library/service/orm tertentu, dan kalau kita mengimplemen DI (Dependency Injection), kita bisa mereplace objek-objek tadi dengan <em class="lp"> mock class </em> lainnya untuk keperluan testing.</p></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><p id="ea22" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Service Object ini sangat popular di komunitas Rails, contoh:</p><ul class=""><li id="a9d1" class="lq lr in kv b kw kx kz la lc ls lg lt lk lu lo lv lw lx ly bi translated"><a class="ae ks" href="http://blog.codeclimate.com/blog/2012/10/17/7-ways-to-decompose-fat-activerecord-models/" rel="noopener ugc nofollow" target="_blank"> http://blog.codeclimate.com/blog/2012/10/17/7-ways-to-decompose-fat-activerecord-models/ </a></li><li id="bd85" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated"><a class="ae ks" href="https://hackernoon.com/service-objects-in-ruby-on-rails-and-you-79ca8a1c946e" rel="noopener ugc nofollow" target="_blank"> https://hackernoon.com/service-objects-in-ruby-on-rails-and-you-79ca8a1c946e </a></li><li id="9146" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated"><a class="ae ks" href="https://www.netguru.co/blog/service-objects-in-rails-will-help" rel="noopener ugc nofollow" target="_blank"> https://www.netguru.co/blog/service-objects-in-rails-will-help </a></li></ul><p id="4905" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Terlepas dari Rails, pattern ini sangat bermanfaat untuk memanage sebuah domain logic, dan saya pun akhirnya mengimplemen konsep ini di Django.</p><p id="1468" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Bagaimana cara saya untuk mengimplemennya ?</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/98990083508c3d81900bef509f20887e.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*HcJhAe1WhAnen-PvAM3Ljw.png"/></div></figure><p id="2bda" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Struktur folder di atas, adalah salah satu project yang saya buat menggunakan Django (1.11.x). Dan tentang bagaimana struktur codebase mungkin bisa dilihat di official site nya Django saja yak.</p><p id="0832" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Yang ingin saya bahas di sini adalah :</p><ul class=""><li id="5ffb" class="lq lr in kv b kw kx kz la lc ls lg lt lk lu lo lv lw lx ly bi translated">Module commons</li><li id="189a" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Commons.entities</li><li id="4364" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Commons.services</li></ul><p id="4c60" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Commons ini bukan <code class="fe me mf mg mh b">app</code> di Django. Tapi memang module terpisah yang sengaja saya buat dimana module ini terbebas dari seluruh aturan framework django.</p><p id="5e23" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Module <code class="fe me mf mg mh b">commons.entities</code> adalah tempat dimana saya memanage seluruh entitas.</p><p id="ca47" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Module <code class="fe me mf mg mh b">commons.services</code> adalah tempat dimana saya memanage seluruh <strong class="kv io"> abstraksi </strong> dari service saya.</p><p id="3c47" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Dengan adanya abstraksi ini, harapan saya core software ini bisa ditaruh di framework manapun itu, karena memang saya design dengan tujuan itu.</p><p id="1923" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Penggunaan service object di sistem ini adalah :</p><ul class=""><li id="b5a8" class="lq lr in kv b kw kx kz la lc ls lg lt lk lu lo lv lw lx ly bi translated">Membuat abstraksi dari masing-masing service sesuai dengan domain logicnya.</li><li id="ee1e" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Setiap abstraksi ini selalu extend dari <code class="fe me mf mg mh b">BaseService</code> yaitu parent service yang mengatur bagaiman seharusnya sebuah service itu di- <code class="fe me mf mg mh b">run</code> .</li></ul><p id="f471" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Salah satu contoh abstraksi service ini adalah :</p><pre class="kd ke kf kg gt nh mh ni nj aw nk bi"><span id="0b0e" class="nl nm in mh b gy nn no l np nq">from abc import ABCMeta, abstractmethod<br/>from commons.services.base import BaseService</span><span id="66da" class="nl nm in mh b gy ns no l np nq">class ActivationService(BaseService):<br/> '''An abstract class to activate member's account</span><span id="a36a" class="nl nm in mh b gy ns no l np nq">Attributes:<br/>  _member_id: A UUID of member's id<br/>  _code: An activation code<br/> '''<br/> __metaclass__ = ABCMeta</span><span id="7cc7" class="nl nm in mh b gy ns no l np nq">def __init__(self, member_id=None, code=None):<br/>  '''Initialize base value to activate member's account</span><span id="023c" class="nl nm in mh b gy ns no l np nq">Args:<br/>   member_id: A UUID of member's id<br/>   code: A string of activation's code<br/>  '''<br/>  self._member_id = member_id<br/>  self._code = code</span></pre><p id="d930" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Implementasi dari service ini adalah :</p><pre class="kd ke kf kg gt nh mh ni nj aw nk bi"><span id="5d38" class="nl nm in mh b gy nn no l np nq">from django.contrib.auth.models import User<br/>from django.core.exceptions import ValidationError</span><span id="9b13" class="nl nm in mh b gy ns no l np nq">from commons.errors.memberships import InvalidActivationCodeError, InvalidMembershipAccountError<br/>from commons.services.memberships import ActivationService as AbstractActivationService</span><span id="5445" class="nl nm in mh b gy ns no l np nq">from memberships.models import Members</span><span id="bf9f" class="nl nm in mh b gy ns no l np nq">class ActivationService(AbstractActivationService):</span><span id="e003" class="nl nm in mh b gy ns no l np nq">def run(self):<br/>        try:<br/>            member = Members.objects.get(pk=self._member_id)<br/>            if member.activation_code != self._code:<br/>                raise InvalidActivationCodeError('Invalid activation code')</span><span id="bc81" class="nl nm in mh b gy ns no l np nq"># activate is_active status<br/>            user = User.objects.get(pk=member.user.id)<br/>            user.is_active = True<br/>            user.save()</span><span id="5a85" class="nl nm in mh b gy ns no l np nq"># disable activation process for future<br/>            member.activation_code = None<br/>            member.save()</span><span id="06bc" class="nl nm in mh b gy ns no l np nq">return True</span><span id="b40c" class="nl nm in mh b gy ns no l np nq">except ValidationError:<br/>            raise InvalidActivationCodeError('Invalid activation or member value')<br/>        except User.DoesNotExist:<br/>            raise InvalidMembershipAccountError('Invalid user account')<br/>        except Members.DoesNotExist:<br/>            raise InvalidMembershipAccountError('Invalid membership account')</span></pre><p id="0c4e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">dan ketika dipanggil di controller <em class="lp"> hanya </em> seperti ini :</p><pre class="kd ke kf kg gt nh mh ni nj aw nk bi"><span id="be14" class="nl nm in mh b gy nn no l np nq">from django.views.generic.base import TemplateResponseMixin<br/>from django.views import View<br/>from django.contrib import messages</span><span id="12db" class="nl nm in mh b gy ns no l np nq">from commons.errors.memberships import InvalidActivationCodeError, InvalidMembershipAccountError<br/>from memberships.services import ActivationService</span><span id="0b43" class="nl nm in mh b gy ns no l np nq">class ActivationView(TemplateResponseMixin, View):<br/>    template_name = 'memberships/activation.html'</span><span id="eeaa" class="nl nm in mh b gy ns no l np nq">def get(self, request, member_id=None, code=None):<br/>        try:<br/>            activate = ActivationService(member_id, code)<br/>            activate.run()</span><span id="a9cf" class="nl nm in mh b gy ns no l np nq">messages.success(request, 'Your account has been activated.')<br/>        except (InvalidMembershipAccountError, InvalidActivationCodeError) as e:<br/>            messages.error(request, e)</span><span id="6192" class="nl nm in mh b gy ns no l np nq">return self.render_to_response({})</span></pre><p id="e9dc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">dan ini contoh unittest nya :</p><pre class="kd ke kf kg gt nh mh ni nj aw nk bi"><span id="4759" class="nl nm in mh b gy nn no l np nq">import uuid</span><span id="9297" class="nl nm in mh b gy ns no l np nq">from faker import Faker<br/>from django.test import TestCase, override_settings<br/>from django.contrib.auth.models import User</span><span id="dee4" class="nl nm in mh b gy ns no l np nq">from commons.errors.memberships import InvalidActivationCodeError, InvalidMembershipAccountError<br/>from memberships.services import RegistrationService, ActivationService<br/>from memberships.models import Members</span><span id="c5a1" class="nl nm in mh b gy ns no l np nq"><a class="ae ks" href="http://twitter.com/override_settings" rel="noopener ugc nofollow" target="_blank">@override_settings</a>(TEST_MODE=True)<br/>class ActivationServiceTestCase(TestCase):</span><span id="7643" class="nl nm in mh b gy ns no l np nq">def test_invalid_member_id(self):<br/>  activate = ActivationService(str(uuid.uuid4()), 'code')</span><span id="38fd" class="nl nm in mh b gy ns no l np nq">with self.assertRaises(InvalidMembershipAccountError) as member_error:<br/>   activate.run()</span><span id="1804" class="nl nm in mh b gy ns no l np nq">exc = member_error.exception<br/>  self.assertEqual('Invalid membership account', exc.message)</span><span id="5ff5" class="nl nm in mh b gy ns no l np nq">def test_invalid_code(self):<br/>  fake = Faker()<br/>  <br/>  email = fake.email()<br/>  password = 'testing'</span><span id="e053" class="nl nm in mh b gy ns no l np nq">payload = {<br/>   'email': email,<br/>   'username': fake.user_name(),<br/>   'password': password,<br/>   'password_confirm':password <br/>  }</span><span id="5c9a" class="nl nm in mh b gy ns no l np nq">registration = RegistrationService(payload)<br/>  self.assertTrue(registration.run())</span><span id="0b06" class="nl nm in mh b gy ns no l np nq">user = User.objects.get(email=email)<br/>  member = Members.objects.get(user__id=user.id)</span><span id="9687" class="nl nm in mh b gy ns no l np nq">with self.assertRaises(InvalidActivationCodeError) as code_error:<br/>   activate = ActivationService(member.id, 'testing')<br/>   activate.run()</span><span id="73c0" class="nl nm in mh b gy ns no l np nq">exc = code_error.exception<br/>  self.assertEqual('Invalid activation code', exc.message)</span><span id="2887" class="nl nm in mh b gy ns no l np nq">def test_activate_success(self):<br/>  fake = Faker()<br/>  <br/>  email = fake.email()<br/>  password = 'testing'</span><span id="27f9" class="nl nm in mh b gy ns no l np nq">payload = {<br/>   'email': email,<br/>   'username': fake.user_name(),<br/>   'password': password,<br/>   'password_confirm':password <br/>  }</span><span id="4b4c" class="nl nm in mh b gy ns no l np nq">registration = RegistrationService(payload)<br/>  self.assertTrue(registration.run())</span><span id="255c" class="nl nm in mh b gy ns no l np nq">user = User.objects.get(email=email)<br/>  member = Members.objects.get(user__id=user.id)</span><span id="6ce0" class="nl nm in mh b gy ns no l np nq">activate = ActivationService(member.id, member.activation_code)<br/>  self.assertTrue(activate.run())</span><span id="6f3a" class="nl nm in mh b gy ns no l np nq">user = User.objects.get(email=email)<br/>  self.assertTrue(user.is_active)</span></pre><p id="84e4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Ini contoh yang paling sederhana. Ketika kita bekerja menggunakan framework, dan ketika kita menaruh seluruh logic di controller, kira-kira apa yang harus kita lakukan untuk testing terhadap fitur tersebut ? Ada dua :</p><ul class=""><li id="86d6" class="lq lr in kv b kw kx kz la lc ls lg lt lk lu lo lv lw lx ly bi translated">Buka browser, dan kemudian akses url controller tersebut, dan <em class="lp"> klak klik </em> atau semacam inilah.</li><li id="a7dc" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">Jika lewat automate test, maka yang perlu kita lakukan adalah, benar-benar mengirimkan request ke controller tersebut. Rata-rata framework modern ~yang sehat~ sudah menyediakan fitur test seperti ini di test framework mereka masing-masing.</li></ul><p id="5ebb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Padahal yang kita butuhkan hanya testing logic, dimana prosesnya hanyalah berikan input X maka ekspektasi nya adalah output Y, hanya untuk testing logic sederhana ini kita harus memberikan effort yang lumayan besar.</p><p id="83b1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Dan di contoh ini ada beberapa service dari setiap <code class="fe me mf mg mh b">app</code> , misal :</p><ul class=""><li id="b6e1" class="lq lr in kv b kw kx kz la lc ls lg lt lk lu lo lv lw lx ly bi translated">ActivationService, service untuk menampung logic aktivasi data member</li><li id="562a" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">RegistrationService, service untuk menampung logic registrasi data member</li><li id="6f30" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">dll</li></ul><p id="1472" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Di contoh di atas, kita bisa lihat kondisi yang ada di controller. Di sini saya bilang, bukan sebagai <code class="fe me mf mg mh b">thin controller</code> tapi lebih cocok disebut dengan <code class="fe me mf mg mh b">clean controller</code> .</p><p id="0d79" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Untuk struktur codebase di masing-masing <code class="fe me mf mg mh b">app</code> saya memanagenya seperti ini :</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/db1243675b19f4ce37db166dd903f521.png" data-original-src="https://miro.medium.com/v2/resize:fit:488/format:webp/1*8mAjtnXItGAEAB2JoD-lCQ.png"/></div></figure><p id="bd31" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Module <code class="fe me mf mg mh b">memberships.services</code> adalah tempat saya menaruh seluruh services yang mengimplemen abstraksi dari <code class="fe me mf mg mh b">commons.services.memberships</code> .</p><p id="b5d0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Dan untuk unittest nya di sini, yang saya test adalah per service! Jadi tidak ada unittest model atau controller, karena bagi saya pribadi yang perlu saya test memang hanyalah logic flownya saja, saya tidak perlu testing ORM atau request responsenya.</p><p id="f0cf" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Sistem yang saya kembangkan ini, masih bisa dibuat jauh lebih rapi lagi, apa yang saya tunjukkan ini hanyalah versi <code class="fe me mf mg mh b">MVP</code> nya, bagaimana saya agar bisa melakukan testing, maintain codebase saya dengan mudah &amp; flow logic yang jelas.</p><p id="a028" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Tujuan saya mengimplemen ini dari awal adalah, ketika suatu saat sistem ini berkembang, core sistem / core model nya ada di <em class="lp"> state </em> yang aman, apa itu aman ? Aman di sini adalah terbebas dari campur tangan framework / library apapun itu, prinsip saya adalah framework / library yang mengikuti core, bukan kebalikannya.</p></div><div class="ab cl mi mj hr mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ig ih ii ij ik"><p id="40f1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Semoga tulisan saya ini bermanfaat :)</p></div></div>    
</body>
</html>