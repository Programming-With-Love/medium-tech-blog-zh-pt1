<html>
<head>
<title>Open-sourcing PinLater: An asynchronous job execution system</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">开源的PinLater:一个异步作业执行系统</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/open-sourcing-pinlater-an-asynchronous-job-execution-system-d8ec4e39859a?source=collection_archive---------2-----------------------#2015-11-18">https://medium.com/pinterest-engineering/open-sourcing-pinlater-an-asynchronous-job-execution-system-d8ec4e39859a?source=collection_archive---------2-----------------------#2015-11-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="187c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">张志远|发现网站Pinterest工程师</p><p id="e641" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">PinLater是我们构建的一个异步作业执行系统，作为我们基于T2柴堆的原始解决方案的替代品。我们在生产中使用PinLater已经两年多了，它是我们最关键的系统之一。PinLater的使用范围从核心操作(如锁定、图像缩略图生成以及pinner跟踪其他pinner、公告板或主题)到较大的批量操作(如电子邮件发送、推送通知和可视化发现工作流)。我们现在在<a class="ae jc" href="https://aws.amazon.com/ec2/" rel="noopener ugc nofollow" target="_blank">亚马逊EC2 </a>上运营着10多个不同的集群。总共有500多个作业队列，每分钟处理超过600万个作业。今天我们很兴奋地宣布PinLater是我们最新的<a class="ae jc" href="https://github.com/pinterest/pinlater" rel="noopener ugc nofollow" target="_blank">开源版本</a>。</p><p id="2114" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在构建PinLater之前，我们评估了许多现有的开源选项，但没有一个满足我们的所有要求，包括:</p><ul class=""><li id="a783" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated">至少有一次保证的容错可靠执行。</li><li id="d563" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">简单的服务/API，从客户端抽象出存储细节，并支持以任何编程语言编写的可插拔存储后端和客户端/作业。</li><li id="f09e" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">将作业执行从调度/排队中分离出来，这样两者可以独立扩展，并且系统可以支持不同类型的作业。</li><li id="1907" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">完全可水平扩展，构建在可靠且易于操作的开源组件(如MySQL)之上。</li><li id="a6c7" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">可以在入队时为每个作业指定优先级、延迟执行和灵活的重试策略。</li><li id="1a65" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">作业处理的细粒度可见性，以及查询作业状态或跟踪单个作业上的操作的能力。</li><li id="dcda" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">一个基本简单的设计，使系统易于推理和调试。</li></ul><h2 id="88ee" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated">在后台</h2><p id="2706" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">PinLater有三个组件:</p><ol class=""><li id="8e40" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb kr jj jk jl bi translated">管理作业提交和调度的无状态节约服务</li><li id="aa3c" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb kr jj jk jl bi translated">存储作业和状态的存储后端</li><li id="b4ea" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb kr jj jk jl bi translated">用于执行作业的工作池</li></ol><figure class="kt ku kv kw fd kx er es paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="er es ks"><img src="../Images/aca2405cb869d1d9c56a1e1f8d550d10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4aQon-ansZme8OiU.png"/></div></div></figure><p id="2374" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">thrift服务提供了三个核心操作:入队、出队和确认。当作业排队时，它会被发送到存储后端进行跟踪。工作池不断地将作业出队并执行它们，根据执行是成功还是失败用肯定或否定的ACK进行回复。服务层负责作业调度的所有方面，包括优先级、重试和将来的执行。关于这一切的更多细节，请阅读我们之前的博客文章。</p><h2 id="ed11" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated">最近的改进</h2><p id="d37c" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">在过去的一年里，我们对系统进行了多项改进。我们进行了调整，以在MySQL后端实现更高的5X吞吐量，这使我们可以使用单个i2.2xl MySQL EC2实例每秒进行超过2，000次排队。由于MySQL通过可靠的复制提供了更高的持久性，这一变化允许我们将所有的工作负载转移到MySQL，而不再使用Redis后端。我们还构建了一个检查点功能来支持长时间运行的作业和复杂的工作流。我们添加了一个新的仪表板，这是一个一站式商店，可以查看作业状态，调试作业失败，通过ID或正文查找任何作业，以及许多其他让我们的用户高兴的功能。</p><p id="0880" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这个开源版本包括服务本身以及一个参考Java worker框架实现。我们希望PinLater能对其他有类似需求的人有所帮助，迫不及待地想看看社区能给系统带来哪些贡献和改进。将来，我们将继续发布我们整个PinLater堆栈的其他部分。试一试，如果有任何问题，请联系pinlater-users@googlegroups.com<a class="ae jc" href="mailto:pinlater-users@googlegroups.com" rel="noopener ugc nofollow" target="_blank"/>。</p></div></div>    
</body>
</html>