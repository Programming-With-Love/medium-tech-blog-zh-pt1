<html>
<head>
<title>Exploring Google Play App Signing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索Google Play应用程序签名</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/exploring-google-play-app-signing-b4d296f4ee9?source=collection_archive---------0-----------------------#2018-10-19">https://medium.com/google-developer-experts/exploring-google-play-app-signing-b4d296f4ee9?source=collection_archive---------0-----------------------#2018-10-19</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/18f845fda140d3eabb8a30fa995ec8f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1-J8hHCCRFftrS5W9Hzs0A.png"/></div></div></figure><p id="d2a2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在分发我们的Android应用程序时，我们总是被要求使用密钥库为我们的应用程序签署我们的APKs这使我们能够确保只有我们应用程序的开发人员能够将更新的APK上传到play控制台。然而，因为这个密钥库充当了我们应用程序生命周期的指纹——如果它发生了任何事情，那么我们就遇到了一点棘手的情况。由于当前签名流程带来的缺点，Google Play应用程序签名旨在帮助事情变得更顺利。在这篇文章中，我想深入这个应用程序签名方法，以便我们可以将它集成到我们的应用程序中。</p></div><div class="ab cl jn jo go jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ha hb hc hd he"><figure class="jv jw jx jy fd ii er es paragraph-image"><a href="http://eepurl.com/dIKgiT"><div class="er es ju"><img src="../Images/e8dd46ab2c119165e7a212299a73013e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p-QbIIAzOjpz4kfDKWkgGg.png"/></div></a></figure></div><div class="ab cl jn jo go jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ha hb hc hd he"><p id="5a9f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">应用程序签名是一个可供开发者使用的新流程，它允许我们将我们发布的apk的签名卸载到Google上。一旦我们为Play Console提供了我们的应用程序签名密钥，我们就可以上传我们的APK，谷歌将在将其交付给我们的用户之前为我们签名。</p><p id="33b9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">虽然当前签署apk的方式是可行的，但还是有一些缺陷，这些缺陷常常会给开发人员带来些许恐惧:</p><ul class=""><li id="e7eb" class="jz ka hh ir b is it iw ix ja kb je kc ji kd jm ke kf kg kh bi translated">如果您丢失了您的密钥，那么这将阻止您更新您的应用程序。也许你的电脑出了故障，你的备份丢失了，或者它只是以某种方式被放错了地方——任何你的密钥丢失的情况都意味着你将无法更新你的应用程序。</li><li id="f715" class="jz ka hh ir b is ki iw kj ja kk je kl ji km jm ke kf kg kh bi translated">您的密钥可能会被怀有恶意的人泄露—在这种情况下，拥有密钥的人可以更新您的应用程序，并且因为没有办法撤销这种访问，所以您无法做太多事情来重新获得对您的密钥的访问。</li></ul><p id="85f1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">当使用Google应用程序签名时，巨大的优势是Google为我们的应用程序管理签名密钥——这意味着我们可以减轻完全负责我们的密钥库的压力。对于应用程序签名，有两种不同的密钥用于签名流程:</p><ul class=""><li id="e6ec" class="jz ka hh ir b is it iw ix ja kb je kc ji kd jm ke kf kg kh bi translated"><strong class="ir hi">应用签名密钥</strong>—Google在发布APK前使用的密钥</li><li id="07f7" class="jz ka hh ir b is ki iw kj ja kk je kl ji km jm ke kf kg kh bi translated"><strong class="ir hi">上传键</strong> —开发者将APK上传到游戏控制台的键</li></ul><p id="0169" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">正如你所看到的，开发人员仍然需要保留他们自己的<strong class="ir hi">上传密钥</strong>的副本，以便在上传apk时使用——现在的不同之处在于，这个<strong class="ir hi">上传密钥</strong>不负责发布版本的签名，它只是用来标识进行上传的开发人员。因为这不是用于签署应用程序发布APK的唯一密钥，这意味着它可以随时被Google替换。因此，如果一个<strong class="ir hi">上传密钥</strong>丢失、受损或由于任何原因不再拥有上传权限，那么谷歌可以撤销这个密钥并生成一个新的供使用。</p><p id="c604" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">综上所述，您可以将上传密钥视为权威密钥，而不是主密钥——它允许开发人员将apk上传到Play控制台，但不能分发它们，该角色属于<strong class="ir hi">应用签名密钥</strong>的权限范围。</p><figure class="jv jw jx jy fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kn"><img src="../Images/6a3a8ee6ed4cdf0e2c651aa13e4e1917.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*thd9HOZBpxWi5lJV983qtw.png"/></div></div></figure><p id="a5c0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你正在为你的应用程序上传apk，那么这个过程是完全可选的，欢迎你继续管理你自己的密钥——记住你将不能利用应用程序签名带来的任何优势。例如，如果您的签名密钥丢失或泄露，您将无法再为您的应用程序上传更新的apk。</p><p id="36ec" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">当谈到Android应用程序捆绑格式时，应用程序签名是一个强制性的过程。这是因为当涉及到应用捆绑包时，Google Play需要能够在分发之前为你签署APKs所以当密钥由开发者管理时，没有办法能够执行这个流程。</p><p id="6e90" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">不管您使用的是APKs还是App Bundle格式，让我们看看如何在我们自己的应用程序中设置应用程序签名。</p></div><div class="ab cl jn jo go jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ha hb hc hd he"><h1 id="925b" class="ko kp hh bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">移植现有应用</h1><p id="e2c4" class="pw-post-body-paragraph ip iq hh ir b is lm iu iv iw ln iy iz ja lo jc jd je lp jg jh ji lq jk jl jm ha bi translated">在本例中，我们将了解Play Console中现有应用程序的已启用应用程序签名。在我们开始之前，重要的是要注意，一旦你选择加入应用程序签名，你<strong class="ir hi">就不能切换回手动密钥管理</strong>——所以确保你肯定想在启用它之前进行切换。如果你不确定，也许可以在一个示例应用程序上尝试一下以确保万无一失(这正是我所做的！).</p><p id="3a0d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">首先，我们需要导航到控制台中的应用程序签名部分。这个可以在<strong class="ir hi">发布管理</strong> &gt; <strong class="ir hi"> App签约</strong>下的导航抽屉里找到。当您进入此页面时，将会看到应用程序签名的服务条款，您需要接受这些条款才能继续。</p><figure class="jv jw jx jy fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lr"><img src="../Images/2b55c06a7604fa5fcc765204402790bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MLL2o0-NUhEHNJXC5UFKRQ.png"/></div></div></figure><p id="5e3b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在此屏幕上，您会注意到有三个选项可以设置应用签名，我们将使用第二个选项<strong class="ir hi">，您尚未导出您的应用签名密钥</strong>，用于导出和上传我们的签名密钥。</p></div><div class="ab cl jn jo go jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ha hb hc hd he"><h2 id="7e82" class="ls kp hh bd kq lt lu lv ku lw lx ly ky ja lz ma lc je mb mc lg ji md me lk mf bi translated">配置应用签名密钥</h2><figure class="jv jw jx jy fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mg"><img src="../Images/f737579ce385b4eb417ad0a1e7c088a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bl6LcQulYu0PojV1KhT7cw.png"/></div></div></figure><p id="f580" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您需要从下载Play Encrypt Private Key工具(以一个<strong class="ir hi"> jar </strong>文件的形式)开始，它将用于在上传之前加密您的密钥。下载后，您会在安装过程中看到需要运行的命令，看起来有点像这样:</p><pre class="jv jw jx jy fd mh mi mj mk aw ml bi"><span id="97f2" class="ls kp hh mi b fi mm mn l mo mp">java -jar pepk.jar — keystore=<strong class="mi hi">your.keystore</strong> — alias=<strong class="mi hi">your_alias</strong>— output=<strong class="mi hi">some_file_name </strong>—-<strong class="mi hi"> </strong>encryptionkey=<strong class="mi hi">your_encryption_key</strong></span></pre><p id="4cff" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这里，您将执行我们之前下载的pepk.jar文件，并将一些信息作为参数传递。</p><ul class=""><li id="db79" class="jz ka hh ir b is it iw ix ja kb je kc ji kd jm ke kf kg kh bi translated">首先，我们必须提供我们希望加密的<strong class="ir hi">密钥库</strong>的路径。</li><li id="4828" class="jz ka hh ir b is ki iw kj ja kk je kl ji km jm ke kf kg kh bi translated">接下来，我们提供用于访问我们正在加密的<strong class="ir hi">密钥库</strong>的别名。</li><li id="663a" class="jz ka hh ir b is ki iw kj ja kk je kl ji km jm ke kf kg kh bi translated">然后，我们为<strong class="ir hi">输出</strong>参数提供一个期望的文件名，这将是为我们生成的文件的名称</li><li id="9e8a" class="jz ka hh ir b is ki iw kj ja kk je kl ji km jm ke kf kg kh bi translated">最后，在此过程中，播放控制台显示的代码中提供了加密密钥值。</li></ul><p id="1cca" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">当您运行此命令时，会要求您输入密钥库密码。输入后，将生成应用程序签名密钥，并放在给定的输出路径中。此时，您可以使用设置过程中的给定按钮上传密钥。</p></div><div class="ab cl jn jo go jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ha hb hc hd he"><h2 id="0ac6" class="ls kp hh bd kq lt lu lv ku lw lx ly ky ja lz ma lc je mb mc lg ji md me lk mf bi translated">配置上传密钥</h2><p id="fc09" class="pw-post-body-paragraph ip iq hh ir b is lm iu iv iw ln iy iz ja lo jc jd je lp jg jh ji lq jk jl jm ha bi translated">就在您点击注册按钮之前，您可能会注意到一个可选部分，它为您的应用程序签名密钥提供了<strong class="ir hi">增强的安全性</strong>——这是指我们之前刷过的<strong class="ir hi">上传密钥</strong>和用于生成该密钥的密钥库。虽然这可能感觉与以前管理密钥没有什么变化，但这种做法的要点是允许上传过程使用不同于签名过程的密钥。上传密钥不是Android安全模型的一部分，所以它不能用于签署apk，只能上传它们。</p><p id="c4a5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">生成上传密钥是一个单步过程。我们可以为我们的上传过程创建一个新的密钥库，然后使用下面的命令生成上传所需的<strong class="ir hi"> pem </strong>文件。</p><pre class="jv jw jx jy fd mh mi mj mk aw ml bi"><span id="a79d" class="ls kp hh mi b fi mm mn l mo mp">keytool -export -rfc -keystore <strong class="mi hi">upload-keystore.jks</strong> -alias <strong class="mi hi">upload</strong> -file <strong class="mi hi">upload_certificate.pem</strong></span></pre><p id="759f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">一旦生成，您将能够将此文件上传到控制台的请求位置。</p><figure class="jv jw jx jy fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mq"><img src="../Images/017f9d6fb4f7b47ad892807806fc48a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q-azgduqWELxA0uOe47SlA.png"/></div></div></figure></div><div class="ab cl jn jo go jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ha hb hc hd he"><p id="fb97" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">点击“注册”后，将会重新加载应用程序签名屏幕，并向您显示应用程序签名设置的成功通知:</p><figure class="jv jw jx jy fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mr"><img src="../Images/e796171aeb133f3c771fcd640bf7897b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RT_I2ETtvN1_SHm5EfVIEQ.png"/></div></div></figure><p id="ab6b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您还会注意到，这里有一组指纹可用于签名和上传证书，如果需要的话，可以下载。</p><p id="e6de" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，如果您的上传密钥丢失或泄露，您可以使用与上面相同的步骤创建一个新的<strong class="ir hi">上传密钥</strong>，并通过<a class="ae ms" href="https://support.google.com/googleplay/android-developer/contact/otherbugs" rel="noopener ugc nofollow" target="_blank">表格</a>联系Google以提供一个新的上传密钥。请注意，只有帐户所有者才能提出此请求。</p><figure class="jv jw jx jy fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mq"><img src="../Images/0a3c70b9347014fc16ea73bce3e80a2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8cgvBItC9xNEezUIeIfqIQ.png"/></div></div></figure></div><div class="ab cl jn jo go jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ha hb hc hd he"><h1 id="9960" class="ko kp hh bd kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll bi translated">为新应用程序签名</h1><p id="213a" class="pw-post-body-paragraph ip iq hh ir b is lm iu iv iw ln iy iz ja lo jc jd je lp jg jh ji lq jk jl jm ha bi translated">如果您正在创建一个新的应用程序，那么整个过程并不适用于您，因为默认情况下会为您启用<strong class="ir hi">应用程序签名</strong>！当访问新应用程序的play console的<strong class="ir hi"> App Releases </strong>部分时(一旦您上传了APK)，您将看到以下消息:</p><figure class="jv jw jx jy fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mt"><img src="../Images/8f35042d84001fff5d1565636e0a9d96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FpnYFMmvmu1HGD1lE4w0Xg.png"/></div></div></figure><p id="0a81" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">虽然这里的大部分工作已经为我们完成，但我们可以使用几个选项来配置我们的密钥。首先，如果您选择不使用<strong class="ir hi">继续</strong>关闭消息，您可以通过点击左侧显示的按钮<strong class="ir hi">退出应用程序签名的</strong>。</p><p id="a02e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">但是，您也可以选择重复使用签名密钥，这意味着Google Play为您的另一个项目使用的<strong class="ir hi">签名密钥</strong>也可以用于您正在创建的这个新项目。然而，这可能会带来安全风险，就好像无论出于什么原因，您的帐户受到威胁，那么依赖于受威胁密钥的所有应用程序都可能处于危险之中。</p></div><div class="ab cl jn jo go jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ha hb hc hd he"><p id="e79a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在本文中，我们了解了什么是应用程序签名，以及如何将其集成到我们的上传/发布流程中。把这个放在适当的位置可以让你把安全的责任从你的团队中移除，让谷歌来处理这方面的事情——保护你的密钥不被丢失或泄露。如果您有任何关于应用程序签名的问题，或分享您自己的经验，请联系我们！</p><div class="mu mv ez fb mw mx"><a href="https://twitter.com/hitherejoe" rel="noopener  ugc nofollow" target="_blank"><div class="my ab dw"><div class="mz ab na cl cj nb"><h2 class="bd hi fi z dy nc ea eb nd ed ef hg bi translated">乔·伯奇(@hitherejoe) |推特</h2><div class="ne l"><h3 class="bd b fi z dy nc ea eb nd ed ef dx translated">乔伯奇的最新推文(@hitherejoe)。Android Lead @Buffer。谷歌开发专家为@Android，@GooglePay &amp;…</h3></div><div class="nf l"><p class="bd b fp z dy nc ea eb nd ed ef dx translated">twitter.com</p></div></div><div class="ng l"><div class="nh l ni nj nk ng nl in mx"/></div></div></a></div></div></div>    
</body>
</html>