<html>
<head>
<title>Learn to stop using shiny new things and love MySQL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">学会停止使用闪亮的新事物，热爱MySQL</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/learn-to-stop-using-shiny-new-things-and-love-mysql-3e1613c2ce14?source=collection_archive---------0-----------------------#2015-04-10">https://medium.com/pinterest-engineering/learn-to-stop-using-shiny-new-things-and-love-mysql-3e1613c2ce14?source=collection_archive---------0-----------------------#2015-04-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="1483" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Marty Weiner | Pinterest工程师，BlackOps</p><p id="8b10" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我遇到的很多初创公司都想用最新、最热门的技术来做一些很酷但不具有技术突破性的东西。我还没有见过一家初创公司建造时间机器、传送机或量子社交网络，这实际上需要一些令人惊叹的新技术。他们有令人敬畏的新想法和脚踏实地的技术要求，所以我一直在想，当他们需要的只是一个好的、值得信赖的数据库时，他们为什么要选择这个闪亮的(而且有风险的)新东西。我认为这是因为许多人认为，建设最新和最大的需要最新和最大的！</p><p id="4ed3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">事实证明，这只是人们追求闪亮和新奇的三个糟糕原因(陷阱)之一。原因二是人们错误地认为旧的东西速度慢，功能不丰富或者不能扩展。“MySQL是缓慢的，”他们说。“Java很慢，”我听说过。“Python不会扩展，”他们声称。这些都不是真的。</p><p id="b6ec" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">人们追求闪亮的第三个原因是，旧技术没有新技术那样被大肆宣传。年轻的公司需要与老派不同，更大胆、更有激情，并承诺实现你最大胆的梦想。但是大多数新技术的推销通常并不坦率地谈到它们的许多失败模式。</p><p id="3718" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在我们早期，我们陷入了第三个陷阱。我们在扩展架构的过程中经历了很多成长的烦恼。呼声最高、最激动的数据库公司不断来找我们，说他们会解决我们所有的可伸缩性问题。但是没有人告诉我们MySQL的优点，可能是因为MySQL只是工作，人们知道它。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/5cdce8d9e9968a1eb97935c8e80caee5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/0*T68JbO3rkfXL_w92.png"/></div></figure><p id="d3ed" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过这次挑战，我从创建Pinterest中学到了两个最重要的经验:</p><ul class=""><li id="2f53" class="jl jm hh ig b ih ii il im ip jn it jo ix jp jb jq jr js jt bi translated">不要做最大的。如果你是一项技术的最大用户，你的挑战将会被大大放大。</li><li id="41f8" class="jl jm hh ig b ih ju il jv ip jw it jx ix jy jb jq jr js jt bi translated">保持简单。不管你用什么技术，都会失败。</li></ul><p id="3595" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在Pinterest经历了一年的快速扩张后，我们有了MySQL、Memcache、MongoDB、Redis、Cassandra、Membase和Elastic Search。所有的东西都着火了，并以它们自己特殊的方式破裂。我们希望简化并摆脱所有花哨的东西，但我们也希望有一些东西可以与我们一起扩展到月球。是时候开始我们伟大的重建了。为了帮助指导我们和我们的选择，我们构建了一组适用于每种不同技术的问题:</p><ul class=""><li id="d62c" class="jl jm hh ig b ih ii il im ip jn it jo ix jp jb jq jr js jt bi translated"><em class="jc">技术满足你的需求吗？</em> <br/>固化你的要求。您需要简单查找、有序查找和/或按地理位置查找吗？图走？一种技术可能无法支持您的所有需求，但当它支持您的所有需求时，这是一件好事。</li><li id="1da5" class="jl jm hh ig b ih ju il jv ip jw it jx ix jy jb jq jr js jt bi translated"><em class="jc">它的伸缩性如何？</em> <br/>有些技术是为大规模设计的，有些不是。你可能需要在上面放一点魔法。随着规模的扩大，复杂性增加，灵活性降低。请记住这一点，避免过早扩展。</li><li id="15d3" class="jl jm hh ig b ih ju il jv ip jw it jx ix jy jb jq jr js jt bi translated">成本合理吗？ <br/>考虑支持合同或许可，看看没有支持合同你是否还能活下去。如果你是一家天使投资的初创公司，理想情况下，你会把钱花在灯光和拉面上，而不是大型主机上。</li><li id="d464" class="jl jm hh ig b ih ju il jv ip jw it jx ix jy jb jq jr js jt bi translated"><em class="jc">技术有多成熟？</em> <br/>产品的成熟度是除了基本需求之外你可以问的最重要的问题。这是我将花大部分时间写这篇文章的地方。</li></ul><h2 id="a0f8" class="jz ka hh bd kb kc kd ke kf kg kh ki kj ip kk kl km it kn ko kp ix kq kr ks kt bi translated">成熟是自然的</h2><p id="34fe" class="pw-post-body-paragraph ie if hh ig b ih ku ij ik il kv in io ip kw ir is it kx iv iw ix ky iz ja jb ha bi translated">人们越努力、越热情地推动一项技术，他们就会越快地遇到错误或性能问题，修复它们，并有希望将修复结果反馈给整个社区使用。</p><p id="656d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果技术简单，成熟会快得多。让一个五行Python程序打印“Hello，World”以避免错误需要30个人秒，而一个处理全球分布式银行交易的程序将需要许多个人年才能成熟，这是由于必须解决的复杂性。</p><p id="716a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以，让我们把这个方程化。成熟随着血汗而增长，但随着复杂性的增加而变慢。</p><p id="d373" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">成熟度=(血+汗)/复杂度</p><p id="6c9e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">(我真的很想在等式中加入一些e，I和π，但就是无法证明这一点。然而……)</p><p id="d3a1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">随着技术的发展，合作发生了，理解加深了，丰富的知识积累了。随着技术本身变得越来越稳定和美观，文档化和简化也在发生，边界和界限也在被测试和拓宽。</p><p id="597d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你不想在成熟度等式的另一端。那里有龙:</p><ul class=""><li id="dbee" class="jl jm hh ig b ih ii il im ip jn it jo ix jp jb jq jr js jt bi translated">招聘将更加困难试试在谷歌上搜索MySQL admin和Cassandra admin。试着走到旧金山繁忙的人行道上，大喊你需要一个MySQL管理员。你会找到的。Hbase，不太可能。</li><li id="f350" class="jl jm hh ig b ih ju il jv ip jw it jx ix jy jb jq jr js jt bi translated"><em class="jc">你会发现最小社区</em> <br/>现在是凌晨2点，你会收到一条奇怪的错误消息“48fe1a是不透明的”(这是我从Membase得到的一条真实的错误消息)。搞什么鬼。*k这是什么意思？糟糕，谷歌上没有任何答案。相反，我不记得上一次我的MySQL问题没有得到回答，有人称提问者为nOObXor是什么时候了。</li><li id="a8e1" class="jl jm hh ig b ih ju il jv ip jw it jx ix jy jb jq jr js jt bi translated"><em class="jc">你更有可能失败，可能是灾难性的</em> <br/>除了MySQL之外，我们曾经使用过的几乎所有技术都出现过意外的数据丢失。即使在最糟糕的日子里，当硬盘崩溃时，我们仍然设法找到了某人编写的一个脚本来进行魔法巫术，以再次获得我们的MySQL数据并过上新的一天。其他技术让我们原地踏步，因为没有人遇到过同样的问题，或者他们没有努力深入恢复他们的数据，或者他们没有将修复贡献给社区。顺便说一句，我非常感谢在早期，除了MySQL之外，我们从来没有把我们数据的黄金拷贝托付给任何其他系统。</li></ul><p id="599f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有时候你不得不在这个成熟度比率的坏的一端。例如，如果你必须为你的时间机器安装一个通量电容器，要意识到你不可能轻易的租到它。将会有一个最小的在线社区来帮助你调试为什么你只能回到100年前而不是1000年前。支持可能无法帮助你理解为什么马蒂·小飞侠现在被困在超新星中。</p><p id="e45a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你在前沿，你会遇到世界其他地方从未见过的新问题。它们的调试难度会增加10倍，并且可能需要超出当前工程师舒适范围的知识深度。你必须埋头苦干，努力学习，快速进步。我给你虚拟的拥抱和赞美。我去过那里。这将是艰难的。记录你的发现，合作和交流。</p><p id="d353" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你正在创建或发展一家公司，并且你的规模还不算大，除了基本要求之外，考虑成熟度是你最重要的因素。问问你自己MySQL足以满足我的需求吗？如果有，那就用吧。如果你想知道MySQL是否足够快，答案是<em class="jc">是的</em>。甚至比fast还要好，MySQL的性能会比较一致。</p><h2 id="be7c" class="jz ka hh bd kb kc kd ke kf kg kh ki kj ip kk kl km it kn ko kp ix kq kr ks kt bi translated">最后的话</h2><p id="fb6a" class="pw-post-body-paragraph ie if hh ig b ih ku ij ik il kv in io ip kw ir is it kx iv iw ix ky iz ja jb ha bi translated">所以我已经为一堆技术哭泣，但我似乎对MySQL有一种近乎浪漫的东西。我想花点时间提一下，MySQL虽然成熟，但并不能解决你所有的问题。有时候，你不得不冒险远离成熟带来的温暖。</p><ul class=""><li id="7e61" class="jl jm hh ig b ih ii il im ip jn it jo ix jp jb jq jr js jt bi translated"><em class="jc">笛卡尔距离</em> <br/>如果你需要在二维空间中搜索附近的点，在MySQL中以<a class="ae kz" href="http://en.wikipedia.org/wiki/Geohash" rel="noopener ugc nofollow" target="_blank"> Geohashes </a>的形式存储坐标会很好(<a class="ae kz" href="http://xkcd.com/426/" rel="noopener ugc nofollow" target="_blank">这里有一个XKCD漫画</a>可以帮忙)。三维可能也能很好地工作。但是如果你需要大的N维搜索空间，我不知道在MySQL中有效地存储和检索它们的好方法。例如，如果您已经创建了一个为某些输入生成特征向量的模型，并且您想要查看两个输入是否相似，您可能会发现自己需要存储N维点。经典的例子包括确定两个图像是否相似但不完全相同。对于这种情况，考虑构建一个分布式RP/KD树(很乐意合作！给我发邮件！).</li><li id="18da" class="jl jm hh ig b ih ju il jv ip jw it jx ix jy jb jq jr js jt bi translated"><em class="jc">写入速度</em> <br/> MySQL提供完全写入一致性。如果你愿意用“完整”来换取“最终”的一致性，你的写作会快得多。HBase、Cassandra和其他类似的技术写入更新日志的速度非常快，代价是读取速度变慢(读取现在必须读取存储的信息并遍历更新日志)。这是一个很好的反转，因为更容易缓存读取并使它们更快。</li><li id="2604" class="jl jm hh ig b ih ju il jv ip jw it jx ix jy jb jq jr js jt bi translated">我对MySQL最大的抱怨是它仍然生活在1994年(宽松的裤子和..英皇家空军阶级最低的兵..<a class="ae kz" href="https://www.youtube.com/watch?v=XiBYM6g8Tck" rel="noopener ugc nofollow" target="_blank">玛卡丽娜</a>。那时数据库的许多用途都需要关系查询。没有社交网络。MySpace再过九年都不会出现了！所以MySQL是由树构建的，没有队列的概念。插入到B树中是O(lg(N))运算(假设快乐平衡)。但今天，社交网络是互联网上的主要力量，它们严重依赖于队列。我们要超级快的O(1)入队！我的建议是不要用MySQL做提要。开销太大了。相反，考虑一下<a class="ae kz" href="http://redis.io/" rel="noopener ugc nofollow" target="_blank"> Redis </a>，尤其是如果你还是一个小团队的话。Redis速度非常快，拥有可以快速插入和检索的列表。如果你是一家较大的公司，并且可以雇佣人员来维护它，那么考虑HBase。它对我们的反馈很有效。</li><li id="2e20" class="jl jm hh ig b ih ju il jv ip jw it jx ix jy jb jq jr js jt bi translated"><em class="jc">日志</em> <br/>看在万物神圣的份上，<em class="jc">不要在MySQL </em>存储日志。如前一段所述，MySQL将事物存储在树中。原木不应该生活在树上(这么说就怪了……)。将您的日志发送到<a class="ae kz" href="http://kafka.apache.org/" rel="noopener ugc nofollow" target="_blank"> Kafka </a>，然后使用<a class="ae kz" href="https://github.com/pinterest/secor" rel="noopener ugc nofollow" target="_blank"> Secor </a>从Kafka读取并运送到S3。然后疯狂使用<a class="ae kz" href="http://aws.amazon.com/elasticmapreduce/" rel="noopener ugc nofollow" target="_blank"> EMR </a>、<a class="ae kz" href="http://qubole.com" rel="noopener ugc nofollow" target="_blank"> Qubole </a>或你的地图缩小平台。</li><li id="9c35" class="jl jm hh ig b ih ju il jv ip jw it jx ix jy jb jq jr js jt bi translated"><em class="jc">超越一个框框</em> <br/>如果你在这个位置，你已经优化了所有的查询(无连接、外键、distinct等。)，并且您现在正在考虑使用read slaves，那么您需要扩展到一个以上的MySQL服务器。MySQL不会开箱为你做这些，但这并不难。我们有一个解决方案，一旦我写完博文，你就可以阅读并了解我们是如何做到这一点的。同时，在marty@pinterest.com给我打电话，我会让你现在就开始工作。</li></ul><p id="a976" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Marty Weiner是Pinterest的工程经理。跟随他在 <a class="ae kz" href="https://twitter.com/MartyWeiner" rel="noopener ugc nofollow" target="_blank"> <em class="jc">推特</em> </a> <em class="jc">和</em><a class="ae kz" href="https://pinterest.com/martaaay" rel="noopener ugc nofollow" target="_blank"><em class="jc">Pinterest</em></a><em class="jc">上冒险。有兴趣加入他的团队吗？查看我们的</em> <a class="ae kz" href="https://about.pinterest.com/en/careers/engineering-product" rel="noopener ugc nofollow" target="_blank"> <em class="jc">招聘网站</em> </a> <em class="jc">。</em></p><p id="3fad" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jc">获取Pinterest工程新闻及更新，关注我们的工程</em><a class="ae kz" href="https://www.pinterest.com/malorie/pinterest-engineering-news/" rel="noopener ugc nofollow" target="_blank"><em class="jc">Pinterest</em></a><em class="jc"/><a class="ae kz" href="https://www.facebook.com/pinterestengineering" rel="noopener ugc nofollow" target="_blank"><em class="jc">脸书</em></a><em class="jc"/><a class="ae kz" href="https://twitter.com/PinterestEng" rel="noopener ugc nofollow" target="_blank"><em class="jc">推特</em> </a> <em class="jc">。有兴趣加入团队吗？查看我们的</em> <a class="ae kz" href="https://about.pinterest.com/en/careers/engineering-product" rel="noopener ugc nofollow" target="_blank"> <em class="jc">招聘网站</em> </a> <em class="jc">。</em></p></div></div>    
</body>
</html>