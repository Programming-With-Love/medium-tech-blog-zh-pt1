<html>
<head>
<title>Kotlin’s a great language for JSON</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kotlin是JSON的绝佳语言</h1>
<blockquote>原文：<a href="https://medium.com/square-corner-blog/kotlins-a-great-language-for-json-fcd6ef99256b?source=collection_archive---------0-----------------------#2017-05-15">https://medium.com/square-corner-blog/kotlins-a-great-language-for-json-fcd6ef99256b?source=collection_archive---------0-----------------------#2017-05-15</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><blockquote class="ie"><p id="c291" class="if ig hh bd ih ii ij ik il im in io dx translated">注意，我们已经行动了！如果您想继续了解Square的最新技术内容，请访问我们的新家<a class="ae ip" href="https://developer.squareup.com/blog" rel="noopener ugc nofollow" target="_blank">https://developer.squareup.com/blog</a></p></blockquote><p id="1823" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm io ha bi translated">虽然JSON有它的缺点，但我真的很喜欢它。它易于阅读，解析速度很快，并且非常简单。下面是来自<a class="ae ip" href="https://developer.github.com/v3/issues/" rel="noopener ugc nofollow" target="_blank"> GitHub的范例API </a>的一个示例消息:</p><pre class="jn jo jp jq fd jr js jt ju aw jv bi"><span id="5c53" class="jw jx hh js b fi jy jz l ka kb">{<br/>  "url": "https://api.github.com/repos/square/okio/issues/156",<br/>  "id": 91393390,<br/>  "number": 156,<br/>  "title": "ByteString CharSequence idea",<br/>  "state": "open",<br/>  "created_at": "2015-06-27T00:49:40.000Z",<br/>  "body": "Let's make CharSequence that's backed by bytes.\n"<br/>}</span></pre><p id="1ed5" class="pw-post-body-paragraph iq ir hh is b it kc iv iw ix kd iz ja jb ke jd je jf kf jh ji jj kg jl jm io ha bi translated">Kotlin简洁的不可变数据类使得为这个JSON构建一个基本模型变得很容易。</p><pre class="jn jo jp jq fd jr js jt ju aw jv bi"><span id="de3e" class="jw jx hh js b fi jy jz l ka kb">data class Issue(<br/>    val url: String,<br/>    val id: Long,<br/>    val number: Long,<br/>    val title: String,<br/>    val state: String,<br/>    val created_at: String,<br/>    val body: String)</span></pre><p id="3a3f" class="pw-post-body-paragraph iq ir hh is b it kc iv iw ix kd iz ja jb ke jd je jf kf jh ji jj kg jl jm io ha bi translated">就是这样。没有<code class="du kh ki kj js b">equals()</code>、<code class="du kh ki kj js b">hashCode()</code>或<code class="du kh ki kj js b">toString()</code>样板文件。我们甚至不需要建造者！让我们扩展模型以利用Kotlin的默认值和显式空值:</p><pre class="jn jo jp jq fd jr js jt ju aw jv bi"><span id="d3c5" class="jw jx hh js b fi jy jz l ka kb">data class Issue(<br/>    val url: String,<br/>    val id: Long,<br/>    val number: Long,<br/>    val title: String,<br/>    <strong class="js hi">val comments: Long = 0L</strong>,<br/>    val created_at: String,<br/>    <strong class="js hi">val closed_at: String?,</strong><br/>    <strong class="js hi">val body: String = ""</strong>)</span></pre><p id="0293" class="pw-post-body-paragraph iq ir hh is b it kc iv iw ix kd iz ja jb ke jd je jf kf jh ji jj kg jl jm io ha bi translated">默认值填补了从网络解码JSON时的空白。我喜欢在我的测试用例中创建样本数据时，我可以把它们省略掉。显式可空类型可以防止数据问题。</p><p id="6994" class="pw-post-body-paragraph iq ir hh is b it kc iv iw ix kd iz ja jb ke jd je jf kf jh ji jj kg jl jm io ha bi translated">今天我们将通过<code class="du kh ki kj js b">moshi-kotlin</code>模块发布<a class="ae ip" href="https://github.com/square/moshi/blob/master/CHANGELOG.md" rel="noopener ugc nofollow" target="_blank"> Moshi 1.5 </a>和强大的Kotlin支持。Moshi的类型适配器和注释将JSON绑定到一个惯用的数据模型。</p><pre class="jn jo jp jq fd jr js jt ju aw jv bi"><span id="1377" class="jw jx hh js b fi jy jz l ka kb">data class Issue(<br/>    val url: String,<br/>    val id: Long,<br/>    val number: Long,<br/>    val title: String,<br/>    <strong class="js hi">val state: IssueState</strong>,<br/>    val comments: Long = 0L,<br/>    <strong class="js hi">@Json(name = "created_at") val createdAt: Date</strong>,<br/>    <strong class="js hi">@Json(name = "closed_at") val closedAt: Date?</strong>,<br/>    val body: String = "")</span></pre><p id="76fa" class="pw-post-body-paragraph iq ir hh is b it kc iv iw ix kd iz ja jb ke jd je jf kf jh ji jj kg jl jm io ha bi translated">对于问题的状态和时间戳，此类使用正确的类型而不是字符串。<code class="du kh ki kj js b">@Json</code>注释将JSON中的<code class="du kh ki kj js b">snake_case</code>名称映射到Kotlin中的<code class="du kh ki kj js b">camelCase</code>属性名称。</p><p id="e11a" class="pw-post-body-paragraph iq ir hh is b it kc iv iw ix kd iz ja jb ke jd je jf kf jh ji jj kg jl jm io ha bi translated">为了设置这个，我需要一个<code class="du kh ki kj js b">Moshi.Builder</code>和一个<code class="du kh ki kj js b">JsonAdapter</code>。我可以使用Kotlin的原始字符串在代码中嵌入一个示例消息。</p><pre class="jn jo jp jq fd jr js jt ju aw jv bi"><span id="9a54" class="jw jx hh js b fi jy jz l ka kb">val issueJson = """<br/>{<br/>  "url": "<a class="ae ip" href="https://api.github.com/repos/square/okio/issues/156" rel="noopener ugc nofollow" target="_blank">https://api.github.com/repos/square/okio/issues/156</a>",<br/>  "id": 91393390,<br/>  "number": 156,<br/>  "title": "ByteString CharSequence idea",<br/>  "state": "open",<br/>  "created_at": "2015-06-27T00:49:40.000Z"<br/>}<br/>"""</span><span id="ff1d" class="jw jx hh js b fi kk jz l ka kb">val moshi = Moshi.Builder()<br/>    .add(KotlinJsonAdapterFactory())<br/>    .add(Date::class.java, Rfc3339DateJsonAdapter().nullSafe())<br/>    .build()</span><span id="4391" class="jw jx hh js b fi kk jz l ka kb">val issueAdapter = moshi.adapter(Issue::class.java)<br/>val issue = issueAdapter.fromJson(issueJson)</span></pre><p id="b8ae" class="pw-post-body-paragraph iq ir hh is b it kc iv iw ix kd iz ja jb ke jd je jf kf jh ji jj kg jl jm io ha bi translated">如果你正在使用JSON，<a class="ae ip" href="https://github.com/square/moshi" rel="noopener ugc nofollow" target="_blank"> Moshi </a>和<a class="ae ip" href="https://kotlinlang.org" rel="noopener ugc nofollow" target="_blank"> Kotlin </a>帮助你用更少的代码构建更好的模型。注意<code class="du kh ki kj js b">moshi-kotlin</code>使用<code class="du kh ki kj js b">kotlin-reflect</code>进行属性绑定。按照Android的标准，这种依赖性很大(1.7 MiB / 11，500个方法)。我们正在考虑创造性的方法来解决这个问题！</p><p id="6012" class="pw-post-body-paragraph iq ir hh is b it kc iv iw ix kd iz ja jb ke jd je jf kf jh ji jj kg jl jm io ha bi translated">这篇文章是Square的“<a class="ae ip" rel="noopener" href="/square-corner-blog/square-open-source-loves-kotlin-c57c21710a17"> Square开源♥s·科特林</a>”系列文章的一部分。</p></div></div>    
</body>
</html>