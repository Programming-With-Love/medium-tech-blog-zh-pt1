<html>
<head>
<title>Warning! For Google Analytics users</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">警告！对于谷歌分析用户</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/warning-for-google-analytics-users-44b0096084e2?source=collection_archive---------2-----------------------#2015-09-28">https://medium.com/google-developer-experts/warning-for-google-analytics-users-44b0096084e2?source=collection_archive---------2-----------------------#2015-09-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii ij ik il im in paragraph-image"><div class="er es ie"><img src="../Images/2a9ef62a7086122d48ecf4ae4679930a.png" data-original-src="https://miro.medium.com/v2/resize:fit:674/format:webp/1*m-nDJgi4cU5AB_YmMKuStA.png"/></div></figure><p id="0295" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">我有一个非常小的开源应用，叫做<a class="ae jo" href="https://github.com/tasomaniac/spaceapi_dashclock" rel="noopener ugc nofollow" target="_blank"> <strong class="is hi"> HackDash </strong> </a>。它只是在<a class="ae jo" href="https://play.google.com/store/apps/details?id=net.nurik.roman.dashclock&amp;hl=en" rel="noopener ugc nofollow" target="_blank"> DashClock </a>中显示全球各<a class="ae jo" href="http://hackerspaces.org/" rel="noopener ugc nofollow" target="_blank">黑客空间</a>的开启/关闭状态。</p><p id="421d" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">实现真的很简单。它只是使用<a class="ae jo" href="http://spaceapi.net/" rel="noopener ugc nofollow" target="_blank"> SpaceAPI </a>来获取所有黑客空间的目录，并使用它们的内部API来显示这些黑客空间的状态。</p><p id="93c4" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">除了支持库和各种助手库，我只使用Google Play服务中的<em class="jp">Play-Services-Analytics</em>来与Google Analytics集成。</p><p id="24dc" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">今天我刚刚将Play服务从版本<em class="jp"> 7.8.0 </em>升级到<em class="jp"> 8.1.0 </em>，我意识到我的应用程序大小从<strong class="is hi"> 1.7Mb </strong>增加到了<strong class="is hi"> 1.9Mb </strong>。200Kb 只为了一个没有更新日志的库更新。是的。我使用<em class="jp">progguard</em>。</p><p id="d93b" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">作为Android世界的好公民，我很注意我的应用程序的大小。你也应该这样做。为什么？这里有一篇很棒的文章详细解释了它的重要性:<a class="ae jo" href="http://cyrilmottier.com/2014/08/26/putting-your-apks-on-diet/" rel="noopener ugc nofollow" target="_blank">让你的宠物节食</a></p><p id="3d6d" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">在这里我还写了一篇关于我在土耳其航空安卓app <a class="ae jo" href="http://blog.tasomaniac.com/baska-bir-acidan-ux-ve-thy-android-incelemesi/" rel="noopener ugc nofollow" target="_blank">看到的问题的文章。他们最终将APK大小从<strong class="is hi"> 20.5Mb </strong>降低到了~ <strong class="is hi"> 8Mb。</strong></a></p></div><div class="ab cl jq jr go il" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="ha hb hc hd he"><p id="03b7" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">让我们回到问题上来调查一下。</p><p id="391e" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">我先跑</p><pre class="jw jx jy jz fd ka kb kc kd aw ke bi"><span id="e105" class="kf kg hh kb b fi kh ki l kj kk"><strong class="kb hi">./gradlew</strong> androidDependencies</span></pre><p id="6844" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">查看所有依赖项的详细信息和可传递依赖项。结果如下:</p><figure class="jw jx jy jz fd ii er es paragraph-image"><div class="er es kl"><img src="../Images/9883ed393de30a7630839f1bd25b33a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*wghImDJtUiGU81OfHhHU7A.png"/></div><figcaption class="km kn et er es ko kp bd b be z dx">Transitive dependencies of GMS 7.8.0</figcaption></figure><figure class="jw jx jy jz fd ii er es paragraph-image"><div class="er es kl"><img src="../Images/7dc982fc16fdf784019d532130a357c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*lvGAUzyA_avWW44xBpxChQ.png"/></div><figcaption class="km kn et er es ko kp bd b be z dx">Transitive dependencies of GMS 8.1.0</figcaption></figure><p id="7364" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">哇哦。发生什么事了？我们现在有谷歌广告和应用程序索引作为分析的一部分。我们有<em class="jp">游戏服务基地</em>而不是<em class="jp">游戏服务基地。</em></p><blockquote class="kq kr ks"><p id="cb8d" class="iq ir jp is b it iu iv iw ix iy iz ja kt jc jd je ku jg jh ji kv jk jl jm jn ha bi translated"><em class="hh">地下室</em>到底是什么？</p></blockquote><p id="35c7" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">当我第一次在<a class="ae jo" href="https://plus.google.com/+SebastianKaspari/posts/9LUZVJMnXeB" rel="noopener ugc nofollow" target="_blank">这篇文章</a>中看到这个<em class="jp">地下室</em>时，我认为他们只为分析和广告做了另一个轻量级依赖，我希望它能减少我的APK的大小。</p><p id="350e" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">当我看到下面的内容时，这正是我所期望的。<em class="jp">地下室</em>在<em class="jp">底座</em>下面，所以应该小一些吧？</p><figure class="jw jx jy jz fd ii er es paragraph-image"><div class="er es kl"><img src="../Images/fac656ee7963c1cb367f84d10efd1783.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*WQzFwBn-Bnj48kb05D20xA.png"/></div><figcaption class="km kn et er es ko kp bd b be z dx">basement is also a dependency of base.</figcaption></figure><p id="543f" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">即使它可能更小，有广告包的分析破坏了好处。</p><h1 id="26e6" class="kw kg hh bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">解决办法</h1><p id="ae77" class="pw-post-body-paragraph iq ir hh is b it lt iv iw ix lu iz ja jb lv jd je jf lw jh ji jj lx jl jm jn ha bi translated">我对这个问题的快速解决方案是使用下面的方法来删除Ads依赖:</p><pre class="jw jx jy jz fd ka kb kc kd aw ke bi"><span id="a6c9" class="kf kg hh kb b fi kh ki l kj kk"><strong class="kb hi">compile</strong> "com.google.android.gms:play-services-analytics:8.1.0") {<br/>    <strong class="kb hi">exclude module:</strong> 'play-services-ads'<br/>}</span></pre><p id="0b9c" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">如果你正在使用<em class="jp">progguard</em>，它会警告你移除。<em class="jp"> ProGuard </em>错误实际上表明分析中的标签管理器API使用了一些与来自Ads包的广告id相关的方法。如果您没有使用Tag Manager，将其排除是安全的。</p><p id="bfaf" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">将此添加到您的<em class="jp">progguard</em>配置中以忽略警告。</p><pre class="jw jx jy jz fd ka kb kc kd aw ke bi"><span id="aa88" class="kf kg hh kb b fi kh ki l kj kk"><strong class="kb hi">-dontwarn </strong>com.google.android.gms.ads.**</span></pre><p id="00c9" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">瞧啊。我们的APK大小现在回到了1.7Mb</p><p id="4274" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">真正的解决方案(我认为)是谷歌应该发布另一个名为<em class="jp">Play-Services-tag-manager</em>的Play Services依赖项，这将使我们的生活变得更加轻松。</p><h1 id="02b9" class="kw kg hh bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">结论</h1><p id="81bd" class="pw-post-body-paragraph iq ir hh is b it lt iv iw ix lu iz ja jb lv jd je jf lw jh ji jj lx jl jm jn ha bi translated">如果您有一个仅使用Google Play服务中的Google Analytics的小应用程序，当您将依赖性升级到<em class="jp"> 8.1.0时，您的APK将立即变大。</em></p><p id="82b2" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">做我上面做的，从你的APK中排除不必要的谷歌广告包。</p></div><div class="ab cl jq jr go il" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="ha hb hc hd he"><p id="0d33" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated"><strong class="is hi">更新:</strong>谷歌刚刚宣布这是一个错误，他们将在下一个版本中修复它。<a class="ae jo" href="https://t.co/rLPKoP7JMI" rel="noopener ugc nofollow" target="_blank">https://plus.google.com/+GoogleDevelopers/posts/HsSNWEQ6H4e</a></p><p id="dfc9" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated"><strong class="is hi">更新二:</strong> Google Play Services 8.3本周发布。这是一个真正快速的释放。现在依赖项看起来如下。它现在只对<em class="jp">基底</em>有依赖性。现在比以往任何时候都好！你的应用程序大小和索引大小现在应该更小了。</p><figure class="jw jx jy jz fd ii er es paragraph-image"><div class="er es ly"><img src="../Images/fe47c261f4fbb56eb58d79d9c5be83a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/1*L98P1EZmu8JU74lPwS4iqQ.png"/></div><figcaption class="km kn et er es ko kp bd b be z dx">Dependencies of Analytics SDK in GMS 8.3</figcaption></figure></div><div class="ab cl jq jr go il" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="ha hb hc hd he"><p id="9ba1" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">关注我的<a class="ae jo" href="https://twitter.com/tasomaniac" rel="noopener ugc nofollow" target="_blank">@塔斯曼尼亚克</a>和<a class="ae jo" href="https://plus.google.com/+SaidTahsinDane/posts" rel="noopener ugc nofollow" target="_blank"> +SaidTahsinDane </a></p></div></div>    
</body>
</html>