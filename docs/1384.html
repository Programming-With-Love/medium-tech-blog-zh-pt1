<html>
<head>
<title>Test-Driven Development –Ready, Set, Go with Google Cloud Test Lab</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">测试驱动的开发——准备好，设置好，使用谷歌云测试实验室</h1>
<blockquote>原文：<a href="https://medium.com/capital-one-tech/be-ready-for-tdd-google-cloud-test-lab-20b07ddabc8b?source=collection_archive---------0-----------------------#2016-02-12">https://medium.com/capital-one-tech/be-ready-for-tdd-google-cloud-test-lab-20b07ddabc8b?source=collection_archive---------0-----------------------#2016-02-12</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/417ccec23b821e82534102c2ecec9fa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FxjPfqjlVMf_PTc1fjS0Yw.jpeg"/></div></div></figure><div class=""/><p id="8d07" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">你是否曾经开发过一个Android应用程序，为它编写配置了CI的测试，并觉得这是一个非常累人的设置过程？如果是这样，你不是唯一的一个，这篇文章是专门为你！</p><p id="1a67" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在2015年谷歌I/O大会上，谷歌宣布了一项名为<a class="ae jn" href="https://developers.google.com/cloud-test-lab/%20for" rel="noopener ugc nofollow" target="_blank"> <strong class="ir ht">云测试实验室</strong> </a>的新测试服务，该服务将允许开发者提交一个应用程序，并从云中对多个Android设备进行自动测试。目前，有11种物理设备和6种虚拟设备可供选择，包括一些最受欢迎的Android型号和品牌。</p><p id="4e8f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">云测试实验室如何承诺减轻Android自动化测试的复杂性？</p><h2 id="ec5c" class="jo jp hs bd jq jr js jt ju jv jw jx jy ja jz ka kb je kc kd ke ji kf kg kh ki bi translated">竞争持续集成选项</h2><p id="c8d3" class="pw-post-body-paragraph ip iq hs ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated">我对Android的几个持续集成(CI)选项有经验。在过去的项目中，我使用了:</p><ol class=""><li id="011b" class="ko kp hs ir b is it iw ix ja kq je kr ji ks jm kt ku kv kw bi translated">詹金斯与Genymotion。</li><li id="3afd" class="ko kp hs ir b is kx iw ky ja kz je la ji lb jm kt ku kv kw bi translated">用模拟器圈CI(在Android Studio 2.0之前，这是<em class="lc">我们熟知已久的模拟器</em>)。</li><li id="b731" class="ko kp hs ir b is kx iw ky ja kz je la ji lb jm kt ku kv kw bi translated">詹金斯与USB连接的物理设备。</li></ol><figure class="le lf lg lh fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ld"><img src="../Images/e650dc633743ff8c6314c00e1771e0c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lJkHsov00Bivx_zepuADTQ.png"/></div></div><figcaption class="li lj et er es lk ll bd b be z dx">APK deploy and install duration comparison</figcaption></figure><p id="fdc4" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">但是，这些选项都没有真正满足我的CI需求，原因如下:</p><p id="35b1" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">复杂的配置</strong> —所有这些选项都需要一定程度的脚本，不能简单地启动和运行。例如，有些需要一个脚本来启动，这意味着等待一个在线信号，可能需要五分钟才能找到。</p><p id="d9eb" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">不稳定性</strong>——有时这些选项是不可预测的——没有实际原因的失败和没有实际原因的成功。有一次，构建失败了两次，在第三次尝试时，没有更改任何设置，它成功了。总的来说，构建不一致，没有为失败提供任何好的原因，因此没有关于如何避免失败的可教的时刻。</p><p id="c34c" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">速度慢</strong>——这听起来可能很傻，但很重要。并非所有人都能负担得起多时隙CI服务。有时我会在一个实例上运行多个应用程序的任务。一项工作的延迟会导致另一项工作的瓶颈，从而影响下一项工作，然后一切都会被延迟。</p><p id="def2" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">可扩展性</strong> —由于速度较慢，我不会考虑在上面列出的CI选项上运行多个设备和多个方向的测试。通常，在一个设备上运行一个方向的测试，对于一个一般大小的项目来说，需要大约15-20分钟。当我尝试在多个设备上运行测试时，在多个设备上进行配置并不总是那么容易。</p><p id="950c" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">此外，只使用一个配置运行验收测试不会创造很多价值；特别是考虑到Android屏幕从小到x-大各不相同，分辨率在主要设备之间从高到XXX-高各不相同。</p><h1 id="1487" class="lm jp hs bd jq ln lo lp ju lq lr ls jy lt lu lv kb lw lx ly ke lz ma mb kh mc bi translated"><strong class="ak">用云测试实验室做实验</strong></h1><p id="a635" class="pw-post-body-paragraph ip iq hs ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated">鉴于Android其他持续集成选项的复杂配置、不稳定性、速度慢和可扩展性问题，云测试实验室会成为游戏改变者吗？我乐意将测试从这些选项转移到云测试实验室吗？</p><p id="2d3f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="lc">这里是建立云测试实验室的基本纲要。</em></p><figure class="le lf lg lh fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ld"><img src="../Images/b7130edd9c3c33011a3e14a61b662e7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IbSzNalVa71kERXQRZCTIg.png"/></div></div></figure><p id="0754" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">云测试实验室仍处于测试阶段。你需要在https://console.cloud.google.com<a class="ae jn" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">的</a>注册测试版才能使用。</p><p id="b423" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">登录后，打开左上方的导航抽屉，选择“测试实验室”。如果您尚未注册，请单击“注册免费试用”并按照说明进行操作。</p><p id="f24d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">接下来，在https://console.developers.google.com/project的<a class="ae jn" href="https://console.developers.google.com/project" rel="noopener ugc nofollow" target="_blank">创建一个谷歌项目。</a></p><h2 id="739e" class="jo jp hs bd jq jr js jt ju jv jw jx jy ja jz ka kb je kc kd ke ji kf kg kh ki bi translated">设置</h2><p id="3e50" class="pw-post-body-paragraph ip iq hs ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated">关于如何使用云测试实验室，有几个选项。因为我的目标是用CI进行测试，所以我选择了命令行选项。</p><p id="6f43" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">安卓工作室选项，请参考</strong><a class="ae jn" href="https://developers.google.com/cloud-test-lab/android-studio" rel="noopener ugc nofollow" target="_blank"><strong class="ir ht">https://developers.google.com/cloud-test-lab/android-studio</strong></a></p><pre class="le lf lg lh fd md me mf mg aw mh bi"><span id="5073" class="jo jp hs me b fi mi mj l mk ml">1. Install Google Cloud SDK. Open terminal and <br/>$<strong class="me ht"><em class="lc">curl https://sdk.cloud.google.com | bash</em></strong></span><span id="9302" class="jo jp hs me b fi mm mj l mk ml">2. Restart the terminal. Now you can use gcloud command</span><span id="5744" class="jo jp hs me b fi mm mj l mk ml">3. On terminal, make sure to have sdk up-to-date<br/>$<strong class="me ht"><em class="lc">gcloud components update beta</em></strong></span><span id="cf91" class="jo jp hs me b fi mm mj l mk ml">4. Configure your project ID. You can find yours at <a class="ae jn" href="https://console.developers.google.com/" rel="noopener ugc nofollow" target="_blank">https://console.developers.google.com/</a><br/>$<strong class="me ht"><em class="lc">gcloud config set project your-project-id</em></strong></span><span id="69a7" class="jo jp hs me b fi mm mj l mk ml">5. Authenticate to use Cloud Test Lab with gcloud<br/>$<strong class="me ht"><em class="lc">gcloud auth login</em></strong></span></pre><h2 id="ba99" class="jo jp hs bd jq jr js jt ju jv jw jx jy ja jz ka kb je kc kd ke ji kf kg kh ki bi translated">现在我们跑吧，指挥官！</h2><p id="852e" class="pw-post-body-paragraph ip iq hs ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated">*假设您使用的是Gradle wrapper。<br/>* *我在底部添加了一个示例应用程序的GitHub链接，所以你可以自己尝试一下。如果你有自己的应用程序，我鼓励你设置你的应用程序。</p><pre class="le lf lg lh fd md me mf mg aw mh bi"><span id="bb18" class="jo jp hs me b fi mi mj l mk ml">1. Generate app and app test’s apk.<br/>$<strong class="me ht"><em class="lc">./gradlew assembleDebug assembleAndroidTest</em></strong></span><span id="43e6" class="jo jp hs me b fi mm mj l mk ml">2. <strong class="me ht"><em class="lc">cd app/build/outputs/apk</em></strong></span><span id="cb8b" class="jo jp hs me b fi mm mj l mk ml">3. Run Run Run  <br/>$<strong class="me ht"><em class="lc">gcloud beta test android run \<br/> --type instrumentation \<br/> --app app-debug.apk \<br/> --test app-debug-androidTest-unaligned.apk \<br/> --device-ids Nexus6,mako \<br/> --os-version-ids 21 \<br/> —-locales en \<br/> —-orientations portrait,landscape</em></strong></span></pre><p id="e798" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要查找可用的设备id，请键入$<strong class="ir ht"><em class="lc">g cloud beta test Android设备列表</em> </strong></p><figure class="le lf lg lh fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mn"><img src="../Images/6b876c9b8e72a5745876d30bd54a4415.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wzZQWVzqI9DSQ5M5AMKWOA.png"/></div></div></figure><p id="2ba9" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">同样，$ <strong class="ir ht"> <em class="lc"> gcloud beta测试android版本列表</em> </strong>和$ <strong class="ir ht"> <em class="lc"> gcloud beta测试android语言环境列表，</em> </strong>查找可用版本和语言环境，相应地。</p><p id="43e8" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">更多选项:<a class="ae jn" href="https://cloud.google.com/sdk/gcloud/reference/beta/test/android/run" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/SDK/g cloud/reference/beta/test/Android/run</a></p><h1 id="ca4c" class="lm jp hs bd jq ln lo lp ju lq lr ls jy lt lu lv kb lw lx ly ke lz ma mb kh mc bi translated">容易吗？</h1><p id="44a3" class="pw-post-body-paragraph ip iq hs ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated">简单。</p><p id="e030" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">不再需要脚本，不再需要自己使用仿真器或设备准备设备。</p><p id="e31a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">和</p><p id="8a77" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">只需一个简单的命令，您就可以将配置为在多个设备/多个方向上运行。</p><h2 id="5196" class="jo jp hs bd jq jr js jt ju jv jw jx jy ja jz ka kb je kc kd ke ji kf kg kh ki bi translated">结果输出</h2><figure class="le lf lg lh fd hj er es paragraph-image"><div class="er es mo"><img src="../Images/b819a2a0759a7af7f3050ff5b7147ea0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1092/format:webp/1*znGV1_Ng-7tddD2CclNBwQ.png"/></div></figure><p id="eaf8" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您可以像这样查看控制台输出，也可以在<a class="ae jn" href="https://console.developers.google.com/testlab" rel="noopener ugc nofollow" target="_blank">https://console.developers.google.com/testlab</a>查看更详细的分解</p><figure class="le lf lg lh fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mp"><img src="../Images/c432b9ec70ed730f6806e45bf08ae3b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZF9A4Y3TYQMa-F2K89s2sA.png"/></div></div></figure><h2 id="01ea" class="jo jp hs bd jq jr js jt ju jv jw jx jy ja jz ka kb je kc kd ke ji kf kg kh ki bi translated">这是游戏规则的改变者吗？</h2><p id="5303" class="pw-post-body-paragraph ip iq hs ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated">在引入云测试实验室之前，我提到了对当前CI解决方案的四个抱怨——复杂的配置、不稳定性、速度慢和可扩展性。让我们将这些问题与云测试实验室进行比较。</p><p id="5244" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht"> <em class="lc">复杂配置:<br/> </em> </strong>一般配置和设置体验是目前为止用云测试实验室最好的。没有云测试实验室，我不得不使用一些脚本和命令来准备测试设备。现在，我可以只用四行命令来实现。</p><p id="fef6" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht"> <em class="lc">不稳定:<br/> </em> </strong>现在判断这个还为时过早。在对云测试实验室进行试验时，我运行了一个简单的应用程序，其中只有三个测试，它表现良好。为了真正了解云测试实验室有多稳定，我需要用一些包含更多测试的工业应用程序来测试它。</p><p id="c8c5" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht"> <em class="lc">速度慢:<br/> </em> </strong>这个问题基本不变。一个包含三个Espresso测试的测试项目需要3-6分钟/配置，另外还需要几分钟将app.apk和app-test.apk上传到云测试实验室。</p><p id="54bd" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht"> <em class="lc">可扩展性:<br/> </em> </strong>一方面，云测试实验室易于设置和运行多种配置。然而，缓慢的速度仍然存在，并且在多种配置上运行要花费相当多的时间。</p><h1 id="d1cd" class="lm jp hs bd jq ln lo lp ju lq lr ls jy lt lu lv kb lw lx ly ke lz ma mb kh mc bi translated"><strong class="ak">结论</strong></h1><p id="e8d4" class="pw-post-body-paragraph ip iq hs ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated">从我个人的使用来看，测试问题要么得到了改善，要么与谷歌云测试实验室保持一致。随着额外的新功能(如自动屏幕记录)和对配置复杂性等问题的改进，以及可用设备的冗长列表，Cloud Test Lab无疑是为最大限度地使用而设计的。</p><p id="15f6" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然而，谷歌云测试实验室仍处于测试阶段，仍有改进的空间。例如，总体性能可以得到提高，虽然日志视频是一个很好的特性，但是视频延迟使得很难调试测试失败。</p><p id="184b" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我肯定会关注云测试实验室在正式发布中的进展，即使在此期间我会保留我的选择。</p><ul class=""><li id="df77" class="ko kp hs ir b is it iw ix ja kq je kr ji ks jm mq ku kv kw bi translated">*带测试的示例应用:<a class="ae jn" href="https://github.com/emmasuzuki/EspressoSpoonDemo" rel="noopener ugc nofollow" target="_blank">https://github.com/emmasuzuki/EspressoSpoonDemo</a></li></ul></div><div class="ab cl mr ms go mt" role="separator"><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw mx"/><span class="mu bw bk mv mw"/></div><div class="ha hb hc hd he"><p id="cf7d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如需了解更多关于Capital One的API、开源、社区活动和开发人员文化的信息，请访问我们的一站式开发人员门户网站DevExchange。<a class="ae jn" href="https://developer.capitalone.com/" rel="noopener ugc nofollow" target="_blank"><em class="lc">https://developer.capitalone.com/</em></a></p></div></div>    
</body>
</html>