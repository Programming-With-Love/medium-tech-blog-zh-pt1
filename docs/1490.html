<html>
<head>
<title>Serverless Transactions Serve Customers</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无服务器交易服务于客户</h1>
<blockquote>原文：<a href="https://medium.com/capital-one-tech/serverless-transactions-serve-customers-e4a279940707?source=collection_archive---------3-----------------------#2017-11-21">https://medium.com/capital-one-tech/serverless-transactions-serve-customers-e4a279940707?source=collection_archive---------3-----------------------#2017-11-21</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/9674c87884c6c0981ab25d94fb65d7c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gnjc33PPV8d_SGOiqRC3Fw.jpeg"/></div></div></figure><div class=""/><p id="f5f4" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="jn">由</em>软件工程副总裁斯里尼·乌帕拉帕蒂<em class="jn">负责</em></p><p id="38d0" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们正处于银行技术的巨变之中。许多大型金融机构依赖单一的传统大型机系统作为其核心银行平台。这种方法已经运作了几十年；然而，随着云服务和DevOps实践(现代堆栈)的最近采用，这种传统方法不再是服务我们客户的最佳方式。</p><p id="7641" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在大型机系统上构建数字产品面临着巨大的挑战:</p><ul class=""><li id="1b43" class="jo jp hs ir b is it iw ix ja jq je jr ji js jm jt ju jv jw bi translated">整体系统的变更需要一个很长的生产发布周期</li><li id="7111" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">每GB成本远远高于云中的同类存储系统</li><li id="5c35" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">计算周期(MIPS)非常昂贵</li><li id="84bc" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">扩展需要昂贵的升级</li><li id="8560" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">容量通常基于高峰流量</li><li id="56bf" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">由于复杂的依赖性，创新和实验都很麻烦</li></ul><p id="4d20" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">无服务器系统提供了明显的优势:更快的向各种渠道呈现数据的SLA，与大数据分析的更好集成，以及更好的正常运行时间、可扩展性和维护。更重要的是，通过无服务器，我们可以整合最佳DevOps实践，从而将数字产品持续交付到消费者手中。</p><p id="b8c5" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">接下来的挑战是如何在一个可扩展、可靠且可扩展的系统中，在现代基于云的无服务器基础设施上提取和提供与消费者账户和金融交易相关的数据和流程。</p><p id="581c" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">首先，决定迁移什么<br/> </strong>大型机是一个复杂的系统，任何变化都需要对深层的依赖关系网进行分析。我们确定，在我们的遗留系统中，接近80%的流量与读取事务相关。这种洞察力给了我们关注的焦点:在云中实现一个系统，该系统将服务于只读流量，并由大型机以批处理和接近实时的模式提供。</p><p id="c8f1" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">其次，建立成功标准<br/> </strong>以下是我们团队一致认为无服务器需要实现的目标:</p><ul class=""><li id="dc88" class="jo jp hs ir b is it iw ix ja jq je jr ji js jm jt ju jv jw bi translated">构建在云中，通过可扩展的API提供服务</li><li id="175d" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">处理大规模流量以及任何类型的流量高峰(如黑色星期五等)。</li><li id="c78c" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">遵循DevOps最佳实践</li><li id="e1f8" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">需求增加时无缝扩展</li><li id="1076" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">支持批处理和实时工作负载</li><li id="045b" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">在任何负载下提供一致的性能(等于或优于传统系统)</li><li id="096a" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">经济高效(每笔交易比大型机便宜)</li><li id="397e" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">不损害安全性(静态和动态数据加密)</li><li id="972a" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">与其他服务(实时欺诈分析等)轻松集成</li></ul><p id="c3f7" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">鉴于我们所述的成功标准，我们非常倾向于无服务器架构，因为它增强了将产品/功能更快地运送到客户手中的能力，同时提高了可扩展性并降低了计算能力和人力资源方面的成本。</p><p id="d9c5" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">授权人才解决问题<br/> </strong>我们组建了一个由顶尖工程人才组成的跨职能团队，并向他们提出挑战，要求他们通过倾向于<strong class="ir ht">无服务器架构</strong>来解决提高事务性数据只读请求的响应时间的问题。</p><p id="c61d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">通过高级别挑战集，我们确定了以下需要解决的其他问题:</p><ul class=""><li id="1f05" class="jo jp hs ir b is it iw ix ja jq je jr ji js jm jt ju jv jw bi translated">选择云中的数据存储(我们选择了DynamoDB)</li><li id="35fa" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">将数十亿条交易记录加载到DynamoDB中</li><li id="5798" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">创建一个消息传递基础设施，使大型机和基于云的系统中的事务保持近乎实时的同步</li><li id="70a8" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">在云中构建新版本的getTransactions API</li><li id="8946" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">将所有渠道的流量从大型机系统迁移到我们基于云的系统</li></ul><p id="0074" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这是走向无服务器的商业案例。一旦我们对成功的定义达成一致，我们的工程团队就会面临许多技术和架构上的挑战。以下是我们一路走来所学到的要点。</p><p id="d84b" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">高级方法— CQRS模式<br/> </strong>命令查询责任分离模式是一种应用程序维护两种不同数据模型的方法—一种用于“更新”,另一种用于“读取”。事实证明，这种模式对于我们维护大型、整体大型机系统和基于云的数据存储之间的事务性数据同步的挑战非常有价值。然而，使用独立的数据模型带来了保持这些模型一致性的明显挑战。这增加了使用最终一致性的可能性。下图描述了跨所有通道的读取流量如何迁移到新的目标无服务器体系结构的逻辑视图。</p><figure class="kd ke kf kg fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es kc"><img src="../Images/bb28c4aca49189e641c6f9557262fe12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NfX1ge-DJeCuC1CR48ARvw.jpeg"/></div></div></figure><p id="9c10" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">安全性<br/> </strong>客户金融交易的安全性至关重要。所有静态和传输中的数据都经过加密，我们利用我们的点对点身份认证机制来确保只有经过授权的呼叫者才能访问。</p><p id="4293" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">逻辑架构图</strong></p><figure class="kd ke kf kg fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es kh"><img src="../Images/1cc1ed2692197797ba6a0e2ebd9dc232.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8ncpKOmBl98lMMH8AA53bw.png"/></div></div></figure><p id="7546" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如上图所示，该架构中有各种无服务器组件。</p><ul class=""><li id="cc70" class="jo jp hs ir b is it iw ix ja jq je jr ji js jm jt ju jv jw bi translated">Lambda函数触发来自大型机的事务文件的到达</li><li id="29e3" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">Lambda函数维护文件的状态</li><li id="aa51" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">Lambda函数用于读取数据并将其接收到DynamoDB中</li><li id="010d" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">Lambda函数在DynamoDB上动态提供WCU和RCU</li><li id="a96e" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">DynamoDB作为只读数据存储</li></ul><p id="5a5a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">业务监控<br/> </strong>我们将监控视为一等公民，希望确保我们构建的系统不仅易于监控，还能在出现问题时提供实时警报。</p><p id="2d1a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们选择了Elastic Stack、Cloudwatch和SNS作为我们监控系统的一部分。Cloudwatch用于所有的日志记录，SNS用于警报，而Elastic用于仪表盘。我们建立了实时更新的Kibana仪表板，并持续监控任何异常情况。</p><p id="6e2c" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">最佳实践<br/>了解你的数据</strong>:源系统(大型机)提供的数据文件按主键排序。这导致在摄入过程中由于DynamoDB中的热分区而出现大规模节流。这个问题是通过在摄取之前对文件中的数据进行混洗来解决的，因此写入操作会并行分发到多个分区。</p><p id="b2ef" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">始终按比例测试</strong>:在初始负载/摄入测试期间，我们没有遇到节流。一旦我们开始大规模摄取，我们就开始观察到由于热分区造成的节流。这让我们有机会回顾我们的表设计，并对DynamoDB表中使用的密钥进行更正。</p><p id="316d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">提前了解您的访问模式</strong>:在设计表/索引之前，拥有定义良好的访问模式非常重要。如果前期设计不正确，则在摄取数据后将出现性能问题，这将需要重新摄取和重新创建表/索引，因为表/索引中的键在创建后无法更改。</p></div><div class="ab cl ki kj go kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="ha hb hc hd he"><p id="d2ba" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="jn">以上观点均为作者观点。除非本文另有说明，否则Capital One并不附属于任何上述公司，亦未获其背书。所使用或展示的所有商标和其他知识产权均为其各自所有者的所有权。本文为2017年首创。</em></p></div></div>    
</body>
</html>