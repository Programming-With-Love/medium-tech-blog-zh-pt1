<html>
<head>
<title>Revisiting BatLoader C2 structure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">重访蝙蝠装载机C2结构</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/revisiting-batloader-c2-structure-52f46ff9893a?source=collection_archive---------4-----------------------#2022-04-15">https://medium.com/walmartglobaltech/revisiting-batloader-c2-structure-52f46ff9893a?source=collection_archive---------4-----------------------#2022-04-15</a></blockquote><div><div class="es gk gl gm gn go"/><div class="gp gq gr gs gt"><div class=""/><p id="ce43" class="pw-post-body-paragraph ht hu gw hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq gp bi translated">作者:杰森·里维斯和约书亚·普拉特</p><figure class="is it iu iv ek iw dy dz paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="dy dz ir"><img src="../Images/76c546f6ff3038054eae9cdfc5071d24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fuh7mKGk39Rn-m5RZUmTdA.jpeg"/></div></div></figure><p id="b32b" class="pw-post-body-paragraph ht hu gw hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq gp bi translated">由Mandiant[7]命名的BatLoader是一个有趣的分发/加载系统，之前已经讨论过[1，2]并被各种参与者利用。最近的媒体头条显示了在多个组织[4]中断后与Zloader[3]的连接，但这不是Zloader的独家服务。</p><p id="9879" class="pw-post-body-paragraph ht hu gw hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq gp bi translated">关于中断的报道包括在他们的报告中简短提及BatLoader。我们认为这不是他们最近的破坏活动的目标，因为服务仍在运行。在研究新的BatLoader活动时，我们注意到自从我们的上一篇博客[1]以来，他们改变了加载过程的C2结构:</p><figure class="is it iu iv ek iw dy dz paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="dy dz jd"><img src="../Images/b89738ce65177e2f104632e614d82b1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s-jsvQAHMgUfvwOt9uHWUQ.png"/></div></div><figcaption class="je jf ea dy dz jg jh bd b be z ft">Ref: Virustotal.com</figcaption></figure><p id="a2bd" class="pw-post-body-paragraph ht hu gw hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq gp bi translated">该结构看起来与我们之前报告的类似，但是一些数据现在看起来像哈希值。</p><p id="2181" class="pw-post-body-paragraph ht hu gw hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq gp bi translated">前情提要:</p><pre class="is it iu iv ek ji jj jk jl aw jm bi"><span id="b183" class="jn jo gw jj b ev jp jq l jr js">/processingSetRequestBat1/?servername=<br/>/processingSetRequestBat2/?servername=<br/>/processingSetRequestBat3/?servername=<br/>/processingSetRequestBat4/?servername=<br/>/processingSetRequestBat5/?servername=<br/>/processingSetRequestBat6/?servername=<br/>/processingSetRequestBot/?servername=<br/>/processingSetRequestCoba/?servername=<br/>/processingSetRequestDownload/?servername=<br/>/processingSetRequestAtera/?servername=</span></pre><p id="fe0a" class="pw-post-body-paragraph ht hu gw hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq gp bi translated">所以这些哈希值不仅仅是处理字符串的哈希值，对吗？</p><pre class="is it iu iv ek ji jj jk jl aw jm bi"><span id="9eec" class="jn jo gw jj b ev jp jq l jr js">&gt;&gt;&gt; hashlib.md5('processingSetRequestBat1').hexdigest()<br/>'e6a5614c379561c94004c531781ee1c5'</span></pre><p id="8490" class="pw-post-body-paragraph ht hu gw hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq gp bi translated">啊，原来如此。然后我们可以根据新的模式创建新的suricata规则。但是，我注意到如果散列以数字开头，那么开发人员会将其更改为字符，例如:</p><pre class="is it iu iv ek ji jj jk jl aw jm bi"><span id="4473" class="jn jo gw jj b ev jp jq l jr js">&gt;&gt;&gt; hashlib.md5('processingSetRequestBat3').hexdigest()<br/>'73874ddb552a5b45cade5a2700d15587'</span></pre><p id="8065" class="pw-post-body-paragraph ht hu gw hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq gp bi translated">然而，流量模式中使用的哈希是:</p><pre class="is it iu iv ek ji jj jk jl aw jm bi"><span id="fbc4" class="jn jo gw jj b ev jp jq l jr js">a3874ddb552a5b45cade5a2700d15587</span></pre><p id="a596" class="pw-post-body-paragraph ht hu gw hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq gp bi translated">从其他蝙蝠的请求来看，它们似乎是按顺序进行的；a、b、c、d…因此我们可以继续将哈希值映射到新的请求结构:</p><pre class="is it iu iv ek ji jj jk jl aw jm bi"><span id="dfff" class="jn jo gw jj b ev jp jq l jr js">/e6a5614c379561c94004c531781ee1c5/?servername=<br/>/f69af5bc8498d0ebeb37b801d450c046/?servername=<br/>/a3874ddb552a5b45cade5a2700d15587/?servername=<br/>/fa777fbbb8f055cb8bfcba6cb41c62e7/?servername=<br/>/b1eeec75ef1488e2484b14c8fd46ddce/?servername=<br/>/c003996958c731652178c7113ad768b7/?servername=<br/>/d2ef590c0310838490561a205469713d/?servername=<br/>/fa0a24aafe050500595b1df4153a17fb/?servername=<br/>/i850c923db452d4556a2c46125e7b6f2/?servername=<br/>/b5e6ec2584da24e2401f9bc14a08dedf/?servername=<br/>/e747834ae24a1a43e044ea7b070048f0/?servername=</span></pre><p id="25cd" class="pw-post-body-paragraph ht hu gw hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq gp bi translated">除了部署一个窃取者，这个映射如下:</p><figure class="is it iu iv ek iw dy dz paragraph-image"><div role="button" tabindex="0" class="ix iy di iz bf ja"><div class="dy dz jt"><img src="../Images/02984d80b92f3a140db4e6538e63e623.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YNTLdmvFPeNWrfU8NgAKnw.png"/></div></div></figure><p id="f37e" class="pw-post-body-paragraph ht hu gw hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq gp bi translated">大多数报道还显示，msi安装程序的模板是基于Zoom和Teamviewer的虚假安装程序，但是正如我们之前提到的，这项服务涉及许多分支机构。初始MSI文件的假冒软件模板的更详尽列表可以在下面找到:</p><pre class="is it iu iv ek ji jj jk jl aw jm bi"><span id="7c0f" class="jn jo gw jj b ev jp jq l jr js">zoom<br/>teamviewer<br/>AnyDesk<br/>Telegram<br/>youtube<br/>cheats<br/>ccleaner<br/>discord<br/>thunderbird<br/>luminar<br/>adobe reader<br/>chrome<br/>firefox<br/>brave<br/>gemini<br/>grammarly<br/>quicken<br/>robinhood<br/>amazon<br/>smbc<br/>fidelity<br/>logmein</span></pre><p id="47c2" class="pw-post-body-paragraph ht hu gw hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq gp bi translated"><strong class="hv gx">参考文献</strong>:</p><p id="d094" class="pw-post-body-paragraph ht hu gw hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq gp bi translated">1:<a class="ae ju" rel="noopener" href="/walmartglobaltech/signed-dll-campaigns-as-a-service-7760ac676489">https://medium . com/walmartglobaltech/signed-dll-campaigns-as-a-service-7760 AC 676489</a></p><p id="f5e2" class="pw-post-body-paragraph ht hu gw hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq gp bi translated">2:<a class="ae ju" href="https://news.sophos.com/en-us/2022/01/19/zloader-installs-remote-access-backdoors-and-delivers-cobalt-strike/" rel="noopener ugc nofollow" target="_blank">https://news . sophos . com/en-us/2022/01/19/zloader-installs-remote-access-back doors-and-delivers-cobalt-strike/</a></p><p id="614f" class="pw-post-body-paragraph ht hu gw hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq gp bi translated">3:<a class="ae ju" href="https://www.microsoft.com/security/blog/2022/04/13/dismantling-zloader-how-malicious-ads-led-to-disabled-security-tools-and-ransomware/" rel="noopener ugc nofollow" target="_blank">https://www . Microsoft . com/security/blog/2022/04/13/拆解-zloader-how-恶意-ads-led-to-disabled-security-tools-and-ransomware/</a></p><p id="e865" class="pw-post-body-paragraph ht hu gw hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq gp bi translated">4:<a class="ae ju" href="https://blogs.microsoft.com/on-the-issues/2022/04/13/zloader-botnet-disrupted-malware-ukraine/" rel="noopener ugc nofollow" target="_blank">https://blogs . Microsoft . com/on-the-issues/2022/04/13/zloader-botnet-disrupted-malware-Ukraine/</a></p><p id="ae31" class="pw-post-body-paragraph ht hu gw hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq gp bi translated">5:<a class="ae ju" href="https://www.welivesecurity.com/2022/04/13/eset-takes-part-global-operation-disrupt-zloader-botnets/" rel="noopener ugc nofollow" target="_blank">https://www . welivesecurity . com/2022/04/13/ESET-takes-part-global-operation-disrupt-zloader-botnets/</a></p><p id="62c0" class="pw-post-body-paragraph ht hu gw hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq gp bi translated">6:<a class="ae ju" href="https://decoded.avast.io/vladimirmartyanov/zloader-the-silent-night/" rel="noopener ugc nofollow" target="_blank">https://decoded . avast . io/vladimirmartyanov/zloader-the-silent-night/</a></p><p id="7750" class="pw-post-body-paragraph ht hu gw hv b hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ip iq gp bi translated">7:<a class="ae ju" href="https://www.mandiant.com/resources/seo-poisoning-batloader-atera" rel="noopener ugc nofollow" target="_blank">https://www . man diant . com/resources/SEO-poisoning-bat loader-atera</a></p></div></div>    
</body>
</html>