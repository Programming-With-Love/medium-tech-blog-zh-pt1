<html>
<head>
<title>Airflow: a workflow management platform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Airflow:一个工作流管理平台</h1>
<blockquote>原文：<a href="https://medium.com/airbnb-engineering/airflow-a-workflow-management-platform-46318b977fd8?source=collection_archive---------0-----------------------#2015-06-02">https://medium.com/airbnb-engineering/airflow-a-workflow-management-platform-46318b977fd8?source=collection_archive---------0-----------------------#2015-06-02</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="ecf5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">马克西姆·博彻明</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/f77db04e78f578de5518cd772e7ab7e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:200/format:webp/0*277Imf2r7ouTXOVy.png"/></div></figure><p id="ddd8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> Airbnb </strong>是一家快速增长的数据信息公司。我们的数据团队和数据量正在快速增长，相应地，我们所面临的挑战的复杂性也在增长。我们越来越多的数据工程师、数据科学家和分析师正在使用<strong class="ig hi">气流</strong>，这是一个我们构建的平台，让我们能够快速移动，在创作、监控和改造<strong class="ig hi">数据管道</strong>时保持我们的势头。</p><p id="2bfe" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">今天，我们自豪地宣布我们的工作流管理平台<strong class="ig hi">开源</strong>和<strong class="ig hi">共享Airflow </strong>。</p><p id="6198" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jm" href="https://github.com/airbnb/airflow" rel="noopener ugc nofollow" target="_blank">https://github.com/airbnb/airflow</a></p></div><div class="ab cl jn jo go jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ha hb hc hd he"><h1 id="88f0" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">狗开花了</h1><p id="c987" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip ku ir is it kv iv iw ix kw iz ja jb ha bi translated">随着处理数据的人开始自动化他们的过程，他们不可避免地要编写批处理作业。这些作业需要按计划运行，通常对其他现有数据集有一组依赖关系，并且有依赖于它们的其他作业。将几个数据工作者放在一起，即使时间很短，很快就会有一个不断增长的复杂的计算批处理作业图。现在，如果你考虑一个快节奏的中等规模的数据团队在一个不断发展的数据基础设施上工作几年，并且你手头有一个大规模复杂的计算工作网络。这种复杂性会成为数据团队管理甚至理解的一个重大负担。</p><p id="3238" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这些作业网络通常是<strong class="ig hi">有向无环图</strong> ( <strong class="ig hi">有向无环图</strong>)，具有以下特性:</p><ul class=""><li id="69e6" class="kx ky hh ig b ih ii il im ip kz it la ix lb jb lc ld le lf bi translated"><strong class="ig hi">已调度:</strong>每个作业应该以某个预定的时间间隔运行</li><li id="32a5" class="kx ky hh ig b ih lg il lh ip li it lj ix lk jb lc ld le lf bi translated">任务关键:如果一些任务没有运行，我们就有麻烦了</li><li id="439f" class="kx ky hh ig b ih lg il lh ip li it lj ix lk jb lc ld le lf bi translated"><strong class="ig hi">不断发展:</strong>随着公司和数据团队的成熟，数据处理也在不断发展</li><li id="1641" class="kx ky hh ig b ih lg il lh ip li it lj ix lk jb lc ld le lf bi translated"><strong class="ig hi">异构:</strong>现代分析的堆栈变化很快，大多数公司运行多个需要粘合在一起的系统</li></ul><h1 id="a30c" class="ju jv hh bd jw jx ll jz ka kb lm kd ke kf ln kh ki kj lo kl km kn lp kp kq kr bi translated">每个公司都有一个(或多个)</h1><p id="489a" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip ku ir is it kv iv iw ix kw iz ja jb ha bi translated">工作流管理已经成为一种普遍的需求，以至于大多数公司都有多种方式在内部创建和安排工作。总是有很好的cron调度程序可以开始使用，并且许多供应商的软件包都附带了调度功能。下一步是让脚本调用其他脚本，这在短时间内是可行的。最终出现了简单的框架来解决像存储作业状态和依赖关系这样的问题。</p><p id="f5bf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通常情况下，这些解决方案<strong class="ig hi">会被动增长</strong>,以响应日益增长的调度单个作业的需求，通常是因为当前的系统不允许简单的扩展。还要注意，编写数据管道的人通常不是软件工程师，他们的任务和能力主要是处理和分析数据，而不是构建工作流管理系统。</p><p id="0c79" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">考虑到内部开发的工作流管理系统通常比公司的需求落后至少一代，围绕创作、调度和故障排除工作的<strong class="ig hi">摩擦</strong>造成了巨大的低效和挫折，使数据工作者偏离了他们的生产路径。</p><h1 id="9263" class="ju jv hh bd jw jx ll jz ka kb lm kd ke kf ln kh ki kj lo kl km kn lp kp kq kr bi translated">气流</h1><p id="47be" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip ku ir is it kv iv iw ix kw iz ja jb ha bi translated">在审查了开源解决方案，并利用Airbnb员工对他们过去使用的系统的洞察力后，我们得出结论，市场上没有任何东西可以满足我们当前和未来的需求。我们决定建立一个现代系统来妥善解决这个问题。随着项目的发展，我们意识到我们有一个极好的机会来回馈我们如此依赖的开源社区。因此，我们决定在Apache许可下开源这个项目。</p><p id="6c2b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以下是Airbnb中由气流推动的一些流程:</p><ul class=""><li id="1037" class="kx ky hh ig b ih ii il im ip kz it la ix lb jb lc ld le lf bi translated"><strong class="ig hi">数据仓库:</strong>清理、组织、数据质量检查，并将数据发布到我们不断增长的数据仓库中</li><li id="1c2d" class="kx ky hh ig b ih lg il lh ip li it lj ix lk jb lc ld le lf bi translated"><strong class="ig hi">增长分析:</strong>计算客人和主人参与度以及增长核算的指标</li><li id="9f67" class="kx ky hh ig b ih lg il lh ip li it lj ix lk jb lc ld le lf bi translated"><strong class="ig hi">实验:</strong>计算我们的A/B测试实验框架逻辑和集合</li><li id="ea6b" class="kx ky hh ig b ih lg il lh ip li it lj ix lk jb lc ld le lf bi translated"><strong class="ig hi">电子邮件定位:</strong>应用规则，通过电子邮件活动来定位和吸引我们的用户</li><li id="f0a2" class="kx ky hh ig b ih lg il lh ip li it lj ix lk jb lc ld le lf bi translated"><strong class="ig hi">会话化:</strong>计算点击流和耗时数据集</li><li id="b7b0" class="kx ky hh ig b ih lg il lh ip li it lj ix lk jb lc ld le lf bi translated"><strong class="ig hi">搜索:</strong>计算搜索排名相关指标</li><li id="afd3" class="kx ky hh ig b ih lg il lh ip li it lj ix lk jb lc ld le lf bi translated"><strong class="ig hi">数据基础架构维护:</strong>数据库清理、文件夹清理、应用数据保留策略等</li></ul><h1 id="96c8" class="ju jv hh bd jw jx ll jz ka kb lm kd ke kf ln kh ki kj lo kl km kn lp kp kq kr bi translated">体系结构</h1><p id="591a" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip ku ir is it kv iv iw ix kw iz ja jb ha bi translated">就像英语是商业语言一样，Python已经牢固地确立了自己作为数据语言的地位。气流是用Python语言从头开始写的。代码库是可扩展的、文档化的、一致的、经过测试的，并且具有广泛的单元测试覆盖面。</p><p id="2330" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">管道创作也是在Python中完成的，这意味着从配置文件或任何其他元数据来源生成动态管道是自然而然的事情。“<strong class="ig hi">配置为代码</strong>”是我们袖手旁观为此制定的原则。虽然yaml或json作业配置允许使用任何语言来生成气流管道，但我们觉得在翻译中会失去一些流畅性。能够自省代码(ipython！ide)子类、元程序和使用导入库来帮助编写管道增加了巨大的价值。请注意，仍然可以用任何语言或标记来创作作业，只要您编写解释这些配置的Python。</p><p id="a8be" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">虽然您只需几个命令就可以启动并运行Airflow，但完整的架构包含以下组件:</p><ul class=""><li id="fcf2" class="kx ky hh ig b ih ii il im ip kz it la ix lb jb lc ld le lf bi translated">源代码控制中的<strong class="ig hi">作业定义</strong>。</li><li id="ea68" class="kx ky hh ig b ih lg il lh ip li it lj ix lk jb lc ld le lf bi translated">一个丰富的<strong class="ig hi"> CLI </strong>(命令行界面)来测试、运行、回填、描述和清除Dag的各个部分。</li><li id="1cab" class="kx ky hh ig b ih lg il lh ip li it lj ix lk jb lc ld le lf bi translated">一个<strong class="ig hi">网络应用</strong>，探索你的DAGs定义，它们的依赖，进度，元数据和日志。web服务器与Airflow打包在一起，构建在Flask Python web框架之上。</li><li id="598e" class="kx ky hh ig b ih lg il lh ip li it lj ix lk jb lc ld le lf bi translated">一个<strong class="ig hi">元数据存储库</strong>，通常是一个MySQL或Postgres数据库，Airflow使用它来跟踪任务作业状态和其他持久信息。</li><li id="f6e6" class="kx ky hh ig b ih lg il lh ip li it lj ix lk jb lc ld le lf bi translated">一组<strong class="ig hi">工作者</strong>，以分布式方式运行作业任务实例。</li><li id="3117" class="kx ky hh ig b ih lg il lh ip li it lj ix lk jb lc ld le lf bi translated"><strong class="ig hi">调度器</strong>进程，启动准备运行的任务实例。</li></ul><h1 id="ce87" class="ju jv hh bd jw jx ll jz ka kb lm kd ke kf ln kh ki kj lo kl km kn lp kp kq kr bi translated">展开性</h1><p id="7bbc" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip ku ir is it kv iv iw ix kw iz ja jb ha bi translated">虽然Airflow完全加载了与常用系统(如Hive、Presto、MySQL、HDFS、Postgres和S3)进行交互的方式，并允许您触发任意脚本，但基本模块的设计非常容易扩展。</p><p id="b065" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">钩子</strong>被定义为外部系统抽象，共享一个同质接口。钩子使用一个集中的保险库，提取主机/端口/登录/密码信息，并公开与这些系统交互的方法。</p><p id="05da" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">操作符</strong>利用钩子生成某种类型的任务，当实例化时，这些任务成为工作流中的节点。所有运算符都从BaseOperator派生，并继承了一组丰富的属性和方法。有3种主要类型的运算符:</p><ul class=""><li id="242f" class="kx ky hh ig b ih ii il im ip kz it la ix lb jb lc ld le lf bi translated">执行<strong class="ig hi">动作</strong>或告诉另一个系统执行动作的操作员</li><li id="9f00" class="kx ky hh ig b ih lg il lh ip li it lj ix lk jb lc ld le lf bi translated">操作员把数据从一个系统转移到另一个系统</li><li id="8d8f" class="kx ky hh ig b ih lg il lh ip li it lj ix lk jb lc ld le lf bi translated"><strong class="ig hi">传感器</strong>是某种类型的操作器，它会一直运行，直到满足某个标准</li></ul><p id="2acc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">执行器</strong>实现一个接口，允许Airflow组件(CLI、调度程序、web服务器)远程运行作业。Airflow目前附带了一个SequentialExecutor(用于测试目的)、一个线程化的LocalExecutor和一个利用了<a class="ae jm" href="http://www.celeryproject.org/" rel="noopener ugc nofollow" target="_blank">芹菜</a>的CeleryExecutor，这是一个基于分布式消息传递的优秀异步任务队列。我们还计划在不久的将来共享一个YarnExecutor。</p><h1 id="6695" class="ju jv hh bd jw jx ll jz ka kb lm kd ke kf ln kh ki kj lo kl km kn lp kp kq kr bi translated">闪亮的用户界面</h1><p id="f615" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip ku ir is it kv iv iw ix kw iz ja jb ha bi translated">虽然Airflow公开了丰富的<a class="ae jm" href="http://pythonhosted.org/airflow/cli.html" rel="noopener ugc nofollow" target="_blank">命令行界面</a>，但是监控和与工作流交互的最佳方式是通过web用户界面。您可以轻松地可视化您的管道依赖关系，了解它们的进展情况，轻松访问日志，查看相关代码，触发任务，修复误报/漏报，分析时间消耗，以及全面了解不同任务通常在一天中的什么时间完成。UI也是公开一些管理功能的地方:管理连接、池和暂停特定Dag上的进度。</p><div class="jf jg jh ji fd ab cb"><figure class="lq jj lr ls lt lu lv paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><img src="../Images/18da77aa24c104aca9d7ff26a1385153.png" data-original-src="https://miro.medium.com/v2/resize:fit:612/format:webp/1*nbwR8O-CDH67fkHrXVDvYw.png"/></div></figure><figure class="lq jj ma ls lt lu lv paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><img src="../Images/5e71c84079ff804a882672f5ecd5b906.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/1*0Mask8UZw_aCsd_7JM2Rjw.png"/></div></figure><figure class="lq jj mb ls lt lu lv paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><img src="../Images/ec1edfeee976d89f1c2611a566178226.png" data-original-src="https://miro.medium.com/v2/resize:fit:612/format:webp/1*JNOJotSnC3t0TIQC8gYcsg.png"/></div></figure></div><div class="ab cb"><figure class="lq jj mc ls lt lu lv paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><img src="../Images/b10fb48d7e0a502e3154e5bfb2fe2feb.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*qqOg_8bMS_MzDgWSbgdtOw.png"/></div></figure><figure class="lq jj md ls lt lu lv paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><img src="../Images/7d8de86e1dc46a418a427374298e321f.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/1*rNaZuJ2168jvUYiEkdu1ww.png"/></div></figure><figure class="lq jj me ls lt lu lv paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><img src="../Images/33805005fece4b5e280edfc96556ebd0.png" data-original-src="https://miro.medium.com/v2/resize:fit:554/format:webp/1*ojItdtSC6etsUWOZIK8trw.png"/></div></figure></div><p id="4a7a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最重要的是，UI提供了一个<a class="ae jm" href="http://pythonhosted.org/airflow/profiling.html" rel="noopener ugc nofollow" target="_blank">数据分析</a>部分，允许用户对注册的连接运行SQL查询，浏览结果集，并提供创建和共享简单图表的方法。图表应用程序是由<a class="ae jm" href="http://www.highcharts.com/" rel="noopener ugc nofollow" target="_blank"> Highcharts </a>、<a class="ae jm" href="https://flask-admin.readthedocs.org/en/v1.0.9/" rel="noopener ugc nofollow" target="_blank"> Flask Admin </a>的CRUD接口和Airflow的<a class="ae jm" href="http://pythonhosted.org/airflow/code.html#module-airflow.hooks" rel="noopener ugc nofollow" target="_blank">钩子</a>和<a class="ae jm" href="http://pythonhosted.org/airflow/code.html#macros" rel="noopener ugc nofollow" target="_blank">宏</a>库组成的混搭。URL参数可以传递给图表中的SQL，而Airflow宏可以通过<a class="ae jm" href="http://jinja.pocoo.org/" rel="noopener ugc nofollow" target="_blank"> Jinja模板</a>获得。借助这些功能，Airflow用户可以轻松创建和共享查询、结果集和图表。</p><div class="jf jg jh ji fd ab cb"><figure class="lq jj mf ls lt lu lv paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><img src="../Images/47f04b1041292640496c6ea02c3f1f17.png" data-original-src="https://miro.medium.com/v2/resize:fit:614/format:webp/1*8SD5x-62kLVzZ9SSfAXKCg.png"/></div></figure><figure class="lq jj mg ls lt lu lv paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><img src="../Images/a21c56141850a6912641617bf48d600f.png" data-original-src="https://miro.medium.com/v2/resize:fit:614/format:webp/1*2L-uvEnYDvf5FG3eMuknuQ.png"/></div></figure><figure class="lq jj mh ls lt lu lv paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><img src="../Images/328de4143ab65b4607b4d4ad75414c31.png" data-original-src="https://miro.medium.com/v2/resize:fit:774/format:webp/1*EbUXRyeS65GZTXbCPWrF7w.png"/></div></figure></div><h1 id="2d44" class="ju jv hh bd jw jx ll jz ka kb lm kd ke kf ln kh ki kj lo kl km kn lp kp kq kr bi translated">催化剂</h1><p id="18ef" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip ku ir is it kv iv iw ix kw iz ja jb ha bi translated">由于使用了Airflow，Airbnb数据处理人员的工作效率和热情得到了成倍提高。创作流程加快了，监控和故障排除的时间也大大减少了。更重要的是，这个平台允许人们在更高的抽象层次上执行，创建可重用的构建模块以及计算框架和服务。</p><h1 id="5594" class="ju jv hh bd jw jx ll jz ka kb lm kd ke kf ln kh ki kj lo kl km kn lp kp kq kr bi translated">说够了！</h1><p id="b095" class="pw-post-body-paragraph ie if hh ig b ih ks ij ik il kt in io ip ku ir is it kv iv iw ix kw iz ja jb ha bi translated">我们已经使它变得非常容易，以测试驱动气流，同时通过一个启发性的教程。几个shell命令就能得到令人满意的结果。查看<a class="ae jm" href="http://pythonhosted.org/airflow/" rel="noopener ugc nofollow" target="_blank"> Airflow文档</a>的<a class="ae jm" href="http://pythonhosted.org/airflow/start.html" rel="noopener ugc nofollow" target="_blank">快速入门</a>和<a class="ae jm" href="http://pythonhosted.org/airflow/tutorial.html" rel="noopener ugc nofollow" target="_blank">教程</a>部分，你应该可以在几分钟内让你的Airflow web应用加载交互式示例！</p><p id="2277" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jm" href="https://github.com/airbnb/airflow" rel="noopener ugc nofollow" target="_blank">https://github.com/airbnb/airflow</a></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es mi"><img src="../Images/3913f6470a7657e02386189e67b4eb30.png" data-original-src="https://miro.medium.com/v2/resize:fit:108/format:webp/1*YsUOrWx3mRxZZljtc9xZyw.png"/></div></figure><h2 id="f6f2" class="mj jv hh bd jw mk ml mm ka mn mo mp ke ip mq mr ki it ms mt km ix mu mv kq mw bi translated">在<a class="ae jm" href="http://airbnb.io" rel="noopener ugc nofollow" target="_blank"> airbnb.io </a>查看我们所有的开源项目，并在Twitter上关注我们:<a class="ae jm" href="https://twitter.com/AirbnbEng" rel="noopener ugc nofollow" target="_blank">@ Airbnb eng</a>+<a class="ae jm" href="https://twitter.com/AirbnbData" rel="noopener ugc nofollow" target="_blank">@ Airbnb data</a></h2></div><div class="ab cl jn jo go jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ha hb hc hd he"><p id="ff31" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="mx">原载于2015年6月2日nerds.airbnb.com</em><a class="ae jm" href="http://nerds.airbnb.com/airflow/" rel="noopener ugc nofollow" target="_blank"><em class="mx"/></a><em class="mx">。</em></p></div></div>    
</body>
</html>