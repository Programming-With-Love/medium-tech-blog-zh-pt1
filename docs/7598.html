<html>
<head>
<title>Build and Deploy Angular Application to Azure Static Web App using Azure DevOps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Azure DevOps将Angular应用程序构建和部署到Azure静态Web应用程序</h1>
<blockquote>原文：<a href="https://medium.com/version-1/build-and-deploy-angular-application-to-azure-static-web-app-using-azure-devops-264f846d63f5?source=collection_archive---------0-----------------------#2022-09-21">https://medium.com/version-1/build-and-deploy-angular-application-to-azure-static-web-app-using-azure-devops-264f846d63f5?source=collection_archive---------0-----------------------#2022-09-21</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/29df7a4b8b427d8bbe4a2966978f9bba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Jpzq2pY60JdMFcuP"/></div></div></figure><p id="eac0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> Azure Static Web App </strong>是一个现代化的Web应用服务，提供从源代码到高全球可用性的简化全栈开发。好处包括无缝的开发者体验，包括Visual Studio代码扩展、CICD等等。</p><p id="0db3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">微软推出了“GA”(普遍可用)服务，目前支持2个计划。免费计划允许您免费开始，而标准计划包括所有免费功能以及定制功能(如身份验证和API)的能力。</p><p id="e62a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这篇文章中，我将带你在Azure DevOps中使用两个独立的基于YAML的管道(Build &amp; Deploy)构建和部署一个Angular应用程序到Azure static web app。</p><h2 id="3293" class="jn jo hh bd jp jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh bi translated">先决条件:</h2><ul class=""><li id="8acf" class="ki kj hh ir b is kk iw kl ja km je kn ji ko jm kp kq kr ks bi translated">一个<strong class="ir hi"> Azure </strong>账号(你可以使用免费试用，如果你没有，你可以<a class="ae kt" href="https://azure.microsoft.com/free/" rel="noopener ugc nofollow" target="_blank">T5】创建一个免费T7】账号)</a></li><li id="c532" class="ki kj hh ir b is ku iw kv ja kw je kx ji ky jm kp kq kr ks bi translated"><strong class="ir hi"> Azure DevOps </strong>(如果需要帮助入门，请参见<a class="ae kt" href="https://azure.microsoft.com/en-us/services/devops/?nav=min" rel="noopener ugc nofollow" target="_blank"> <strong class="ir hi">创建</strong> </a>一个)</li><li id="af60" class="ki kj hh ir b is ku iw kv ja kw je kx ji ky jm kp kq kr ks bi translated">Azure Repo中的角度代码</li><li id="8176" class="ki kj hh ir b is ku iw kv ja kw je kx ji ky jm kp kq kr ks bi translated">熟悉Azure DevOps任务</li></ul><h2 id="aa84" class="jn jo hh bd jp jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh bi translated">创建静态Web应用程序:</h2><p id="a593" class="pw-post-body-paragraph ip iq hh ir b is kk iu iv iw kl iy iz ja kz jc jd je la jg jh ji lb jk jl jm ha bi translated"><strong class="ir hi">步骤1 </strong>:导航到Azure门户，通过搜索静态Web应用创建一个新资源，然后点击“创建”。</p><figure class="ld le lf lg fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lc"><img src="../Images/fa5d0290164b4b9b1f78287500a997a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MtMe7H2dan8SmrDjCx6GoQ.png"/></div></div></figure><p id="195e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">第二步</strong>:选择订阅和资源组，填写详细信息。然后继续静态Web应用程序的细节:选择名称——“我的第一视角应用程序”——并坚持免费计划。然后选择你的地区——我的是“西欧”。</p><figure class="ld le lf lg fd ii er es paragraph-image"><div class="er es lh"><img src="../Images/c63081a60c3db5bc90e79d03599a49c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*uChj0Z0MZqSK5lBysu3yLQ.png"/></div></figure><p id="be9d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">注意</strong>:由于我将利用Azure DevOps作为部署方法，我选择了“<em class="li">其他”</em>作为选项。</p><p id="3c9a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">第三步:现在你已经准备好创建你的静态Web应用了。点击“查看+创建”,看看会发生什么。这是我的应用程序的概述:</p><figure class="ld le lf lg fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lj"><img src="../Images/8d75ce54f994225a1f4722498cf32860.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BFHuW__NbKNuR7I_1wMGMw.png"/></div></div></figure><p id="976c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤4 </strong>:一旦部署成功，导航到新创建的静态Web Apps资源，并从概览页面中选择<em class="li">管理部署令牌</em>。记下该值，以备后续步骤使用。</p><figure class="ld le lf lg fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lk"><img src="../Images/eed7b3512d418f6811c52c66f6eb7707.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TRJ6bqaIYqpayahKN44_vg.png"/></div></div></figure><h2 id="e07a" class="jn jo hh bd jp jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh bi translated">在Azure DevOps中创建管道任务:</h2><p id="5419" class="pw-post-body-paragraph ip iq hh ir b is kk iu iv iw kl iy iz ja kz jc jd je la jg jh ji lb jk jl jm ha bi translated">我们将使用YAML文件创建两条管道，一条用于构建，一条用于部署。我们可以预先在回购中包含这个YAML文件，也可以在管道创建过程中添加相同的文件。</p><p id="abf6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">注意</strong>:在创建管道之前，请将角度代码保留在Azure Repo中。</p><h2 id="eb99" class="jn jo hh bd jp jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh bi translated">构建管道:</h2><p id="e915" class="pw-post-body-paragraph ip iq hh ir b is kk iu iv iw kl iy iz ja kz jc jd je la jg jh ji lb jk jl jm ha bi translated"><strong class="ir hi">步骤1 </strong>:登录angular代码所在的Azure DevOps项目。点击左侧的<em class="li">管道</em>。</p><figure class="ld le lf lg fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ll"><img src="../Images/2e80dae98f772bab10bd71c52a863b33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a3KgV5cuO2irElYlnFQ7lw.png"/></div></div></figure><p id="4375" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">第二步</strong>:点击<em class="li">新管道</em>，选择<em class="li">蔚蓝回购Git </em>。</p><figure class="ld le lf lg fd ii er es paragraph-image"><div class="er es lm"><img src="../Images/519200f232427fc703bf69255b0a78e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*q9m6eKF-n6sBLVE50_aCsw.png"/></div></figure><p id="f5d4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">第三步</strong>:选择保存角码的<em class="li"> Azure repo名称</em>。</p><p id="4454" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">第四步</strong>:点击<em class="li">启动管道</em>写入YAML文件。</p><figure class="ld le lf lg fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ln"><img src="../Images/2fc7bfe61b537ab31ba44ebc16e13a2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jrmCuDKyyIFJReUYPF58uw.png"/></div></div></figure><p id="57a7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤5 </strong>:将以下内容复制粘贴到<em class="li">启动器管道</em>部分。</p><pre class="ld le lf lg fd lo lp lq lr aw ls bi"><span id="abca" class="jn jo hh lp b fi lt lu l lv lw"># Build pipeline<br/>trigger:<br/>  batch: false<br/>  branches:<br/>    include:<br/>     - master<br/>  paths:<br/>    exclude:<br/>     - readme.md</span><span id="e025" class="jn jo hh lp b fi lx lu l lv lw">pool:<br/>  vmImage: ubuntu-latest</span><span id="a055" class="jn jo hh lp b fi lx lu l lv lw">steps:<br/> - task: NodeTool@0<br/>   displayName: 'Use Node 14.x'<br/>   inputs:<br/>     versionSpec: 14.x</span><span id="71cd" class="jn jo hh lp b fi lx lu l lv lw"> - script: |<br/>     npm install -g @angular/cli<br/>   displayName: 'install angular cli'</span><span id="f97e" class="jn jo hh lp b fi lx lu l lv lw"> - task: Npm@1<br/>   displayName: 'npm install '<br/>   inputs:<br/>     workingDir: '$(System.DefaultWorkingDirectory)'<br/>     verbose: false</span><span id="11bd" class="jn jo hh lp b fi lx lu l lv lw"> - task: Npm@1<br/>   displayName: 'npm build'<br/>   inputs:<br/>     command: custom<br/>     workingDir: '$(System.DefaultWorkingDirectory)'<br/>     verbose: false<br/>     customCommand: 'run build'</span><span id="2344" class="jn jo hh lp b fi lx lu l lv lw"> - task: PublishBuildArtifacts@1<br/>   inputs:<br/>     PathtoPublish: 'dist'<br/>     ArtifactName: 'app'<br/>     publishLocation: 'Container'</span></pre><p id="c81f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了更好地理解目录结构，请访问<a class="ae kt" href="https://docs.microsoft.com/en-us/azure/static-web-apps/build-configuration?tabs=github-actions" rel="noopener ugc nofollow" target="_blank">构建配置</a></p><p id="aca3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">第六步</strong>:点击<em class="li">保存并运行</em>。</p><h2 id="50ea" class="jn jo hh bd jp jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh bi translated"><strong class="ak">部署管线:</strong></h2><p id="6e53" class="pw-post-body-paragraph ip iq hh ir b is kk iu iv iw kl iy iz ja kz jc jd je la jg jh ji lb jk jl jm ha bi translated">重复上面的步骤1到步骤4来创建部署管道。</p><p id="c497" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤5 </strong>:将以下内容复制粘贴到<em class="li">启动管线</em>部分。</p><pre class="ld le lf lg fd lo lp lq lr aw ls bi"><span id="6df4" class="jn jo hh lp b fi lt lu l lv lw"># Deploy pipeline<br/>trigger:<br/> batch: false<br/> branches:<br/>  include:<br/>  - master<br/> paths:<br/>  exclude:<br/>  - readme.md</span><span id="39fc" class="jn jo hh lp b fi lx lu l lv lw">stages:<br/> - stage: Deploy<br/>   pool:<br/>     vmImage: 'ubuntu-latest'<br/>   jobs:<br/>    - job: DeployWebAppProd<br/>      steps:<br/>       - task: DownloadPipelineArtifact@2<br/>         inputs:<br/>           buildType: 'specific'<br/>           project: 'ab43f2c4-cbec-8f34-b6a6-b1b96af2c4bf'<br/>           definition: '408'<br/>           buildVersionToDownload: 'latest'<br/>           allowPartiallySucceededBuilds: true<br/>           allowFailedBuilds: true<br/>           artifactName: 'app'<br/>           targetPath: '$(Pipeline.Workspace)'</span><span id="5e84" class="jn jo hh lp b fi lx lu l lv lw">       - bash: cd $(Pipeline.Workspace); echo $(ls)</span><span id="866c" class="jn jo hh lp b fi lx lu l lv lw">       - bash: cd $(Pipeline.Workspace)/app; echo $(ls)</span><span id="64a4" class="jn jo hh lp b fi lx lu l lv lw">       - task: AzureStaticWebApp@0<br/>         inputs:<br/>           cwd: '$(Pipeline.Workspace)'<br/>           app_location: '/'<br/>           skip_app_build: true<br/>           skip_api_build: true<br/>           verbose: true<br/>         env:<br/>           azure_static_web_apps_api_token: '$(deployment_token)'</span></pre><p id="09e8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">注意</strong>:根据您的值替换<em class="li">downloadpipeliartifact @ 2</em>任务中的值。</p><p id="22f6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">第六步</strong>:我们需要提供<strong class="ir hi"><em class="li">azure _ static _ web _ apps _ API _ token</em></strong>值。为此，选择<strong class="ir hi">管道中的<em class="li">变量</em> </strong>。</p><figure class="ld le lf lg fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ly"><img src="../Images/c75df945289fc9dc0330b7ca63e5477a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g9F4prTcRfGDk3VlDEw8DQ.png"/></div></div></figure><p id="42d9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">第七步</strong>:新建一个名为<strong class="ir hi"><em class="li">deployment _ token</em></strong>的变量(与上面发布YAML中提到的名称相同)。勾选<strong class="ir hi"> <em class="li">对该值保密</em> </strong>框，点击<strong class="ir hi">确定</strong>。最后，<strong class="ir hi"> <em class="li">保存并运行。</em>T59】</strong></p><figure class="ld le lf lg fd ii er es paragraph-image"><div class="er es lz"><img src="../Images/55d4ff71074a148d8cd9f1fd5d73bce8.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*kVJ6hS3DdYnqbbdt9IcnlQ.png"/></div></figure><p id="463d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">管道将执行应用程序并将其部署到azure静态web应用程序。现在，您可以使用静态web应用程序URL来访问应用程序。</p><p id="ead1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">结论:</strong></p><p id="32c5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我希望这个细节已经展示了如何使用Azure DevOps到带有两个独立YAML文件的Azure static web app来构建和部署Angular应用程序。</p><p id="d880" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你对此感兴趣或有任何反馈，请在评论区告诉我。</p><p id="e472" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">快乐学习！</p><p id="1dc4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">关于作者:<br/> </strong> Raghavendra BN是一名DevOps工程师，目前在Version 1的Foundation的团队工作。关注版本1和Raghavendra BN，了解更多关于Microsoft Azure和Azure DevOps的博客。</p></div></div>    
</body>
</html>