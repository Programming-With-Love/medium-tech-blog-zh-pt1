<html>
<head>
<title>Publishing private apps just got easier</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">发布私人应用变得更加容易</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/publishing-private-apps-just-got-easier-40399c424b8a?source=collection_archive---------4-----------------------#2018-12-03">https://medium.com/androiddevelopers/publishing-private-apps-just-got-easier-40399c424b8a?source=collection_archive---------4-----------------------#2018-12-03</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/9dfcd6e8d26b7f626a57b18aefe0a8b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pMcEGyuowOHWqtbwVs74-g.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Illustration by <a class="ae it" href="https://twitter.com/VPoltrack" rel="noopener ugc nofollow" target="_blank">Virginia Poltrack</a></figcaption></figure><p id="17dc" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">无论您的组织有5个还是100个应用程序，都有工具可以帮助您自动管理所有Play Store列表。Google Play有一个开发者API，可以管理Play商店列表、apk等等。2017年1月，谷歌从Twitter收购了开发者工具套件<a class="ae it" href="http://fabric.io/blog/fabric-joins-google/" rel="noopener ugc nofollow" target="_blank"> Fabric </a>，作为此次收购的一部分是应用自动化工具套件<a class="ae it" href="https://fastlane.tools/" rel="noopener ugc nofollow" target="_blank"> <em class="js"> fastlane </em> </a>。<em class="js"> fastlane </em>可以自动截图、管理测试版部署，以及将应用程序签名/推送至Play store。</p><p id="75b1" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">此外，<a class="ae it" href="https://developers.google.com/android/work/play/custom-app-api/get-started" rel="noopener ugc nofollow" target="_blank">自定义应用发布API </a>支持受管Google Play用户创建私有托管应用，无需<a class="ae it" href="https://developer.android.com/distribute/best-practices/develop/target-sdk" rel="noopener ugc nofollow" target="_blank">最低版本检查</a>。<a class="ae it" href="https://support.google.com/googleplay/work/answer/6137711?hl=en" rel="noopener ugc nofollow" target="_blank">托管Google Play </a>是一个面向Android企业的市场，增加了对私有应用的支持。<a class="ae it" href="https://support.google.com/a/answer/2494992?hl=en" rel="noopener ugc nofollow" target="_blank">私有应用</a>是只分发给内部用户，不对外公开的Android应用。创建后几分钟内即可部署私有应用。一个<em class="js">快速通道</em> <a class="ae it" href="https://github.com/fastlane/fastlane/pull/13421" rel="noopener ugc nofollow" target="_blank">拉请求</a>，由<a class="ae it" href="https://github.com/janpio" rel="noopener ugc nofollow" target="_blank">Jan piotrovski</a>构建，一个核心贡献者，被构建来允许一个无代码的部署方法。关于功能请求的历史记录在本期github中<a class="ae it" href="https://github.com/fastlane/fastlane/issues/13122" rel="noopener ugc nofollow" target="_blank">这里</a>。有关托管Google Play和Google Play Protect的更多背景信息，请参见这篇<a class="ae it" href="https://www.blog.google/products/android-enterprise/safely-and-quickly-distribute-private-enterprise-apps-google-play/" rel="noopener ugc nofollow" target="_blank">博文</a>。</p><p id="0277" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">为什么重要:</strong>自定义应用发布API或<em class="js"> fastlane </em>极大地简化和减少了迁移到托管Google Play的摩擦，并集成到持续集成工具和流程中。</p><h1 id="3d91" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">设置</h1><p id="6a02" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated"><strong class="iw hi">重要提示:</strong>在创建调试和生产密钥库时，确保使用以下用于<a class="ae it" href="https://developer.android.com/studio/publish/app-signing" rel="noopener ugc nofollow" target="_blank">应用程序签名的最佳实践</a>。不要丢失您的生产密钥库！一旦在Google Play上与应用程序id一起使用(包括私有应用程序)，如果不创建新的应用程序列表并修改应用程序id，就无法更改密钥库。</p><p id="45a9" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">推荐:</strong>利用<a class="ae it" href="https://developer.android.com/studio/publish/app-signing#google-play-app-signing" rel="noopener ugc nofollow" target="_blank"> Google Play应用签名</a>为您的apk签名。这是一个安全的选项，可以确保您的密钥库不会丢失。请看这里的实施细节<a class="ae it" href="https://support.google.com/googleplay/android-developer/answer/7384423?hl=en" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="b289" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">重要提示:</strong>Google Play上的所有应用(包括私人应用)都必须有唯一的应用id，不能重复使用。</p><p id="4ce4" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">发布私人应用程序时，您需要执行3个步骤才能发布。</p><p id="f89e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">请遵循<a class="ae it" href="https://developers.google.com/android/work/play/custom-app-api/get-started" rel="noopener ugc nofollow" target="_blank">设置说明</a>，该说明将指导您完成以下步骤:</p><ol class=""><li id="a14f" class="kw kx hh iw b ix iy jb jc jf ky jj kz jn la jr lb lc ld le bi translated">在云API控制台中启用Google Play自定义应用发布API</li><li id="cae2" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">创建一个服务帐户，下载一个JSON格式的新私钥。</li><li id="3e19" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">启用私人应用程序，遵循说明。</li></ol><h1 id="6981" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">快速通道设置</h1><ul class=""><li id="e5f1" class="kw kx hh iw b ix kr jb ks jf lk jj ll jn lm jr ln lc ld le bi translated">请参见此<a class="ae it" href="https://docs.fastlane.tools/getting-started/android/setup/" rel="noopener ugc nofollow" target="_blank">文档</a>安装<em class="js">快速通道。</em>fast lane包含托管google play支持。</li></ul><h1 id="8c4d" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">启用私有应用程序-获取开发者帐户Id</h1><p id="7feb" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">本<a class="ae it" href="https://developers.google.com/android/work/play/custom-app-api/get-started" rel="noopener ugc nofollow" target="_blank">指南</a>展示了创建私有应用程序的步骤，这需要创建一个OAuth回调来接收developerAccount id。有两种方法可以启用私有应用程序:使用fastlane或使用API。以下是如何使用每个选项及其难度:</p><h2 id="1d7d" class="lo ju hh bd jv lp lq lr jz ls lt lu kd jf lv lw kh jj lx ly kl jn lz ma kp mb bi translated">使用快车道——简单</h2><pre class="mc md me mf fd mg mh mi mj aw mk bi"><span id="668c" class="lo ju hh mh b fi ml mm l mn mo">&gt; fastlane run get_managed_play_store_publishing_rights</span></pre><p id="7b59" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">示例输出:</strong></p><pre class="mc md me mf fd mg mh mi mj aw mk bi"><span id="df97" class="lo ju hh mh b fi ml mm l mn mo">[13:20:46]: To obtain publishing rights for custom apps on Managed Play Store, open the following URL and log in:</span><span id="c1c8" class="lo ju hh mh b fi mp mm l mn mo">[13:20:46]: <a class="ae it" href="https://play.google.com/apps/publish/delegatePrivateApp?service_account=SERVICE-ACCOUNT-EMAIL.iam.gserviceaccount.com&amp;continueUrl=https://fastlane.github.io/managed_google_play-callback/callback.html" rel="noopener ugc nofollow" target="_blank">https://play.google.com/apps/publish/delegatePrivateApp?service_account=<strong class="mh hi"><em class="js">SERVICE-ACCOUNT-EMAIL</em></strong>.iam.gserviceaccount.com&amp;continueUrl=https://fastlane.github.io/managed_google_play-callback/callback.html</a></span><span id="14a1" class="lo ju hh mh b fi mp mm l mn mo">[13:20:46]: ([Cmd/Ctrl] + [Left click] lets you open this URL in many consoles/terminals/shells)</span><span id="b857" class="lo ju hh mh b fi mp mm l mn mo">[13:20:46]: After successful login you will be redirected to a page which outputs some information that is required for usage of the `create_app_on_managed_play_store` action.</span></pre><p id="3392" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">将链接粘贴到web浏览器中，并向您的帐户所有者验证托管play帐户，将会发送</p><h2 id="14a8" class="lo ju hh bd jv lp lq lr jz ls lt lu kd jf lv lw kh jj lx ly kl jn lz ma kp mb bi translated">使用API —中等</h2><p id="34a1" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated"><strong class="iw hi">如果</strong>您不打算构建一个web用户界面来管理您的应用程序，您可以使用下面的这个基本节点脚本并启动Firebase函数来快速轻松地获得developerAccountId。如果您不介意，您可以将continueUrl设置为<a class="ae it" href="https://foo.bar" rel="noopener ugc nofollow" target="_blank"> https://foo.bar </a>(或另一个假Url)来获取developerAccountId，尽管出于安全目的不建议这样做。</p><p id="9229" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">用于Firebase设置的云函数</strong></p><p id="c9d4" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">本<a class="ae it" href="https://firebase.google.com/docs/functions/get-started" rel="noopener ugc nofollow" target="_blank">指南</a>展示了如何设置云功能。以下代码可用于端点。</p><figure class="mc md me mf fd ii"><div class="bz dy l di"><div class="mq mr l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">functions/index.js</figcaption></figure><h1 id="ac14" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">创建私人应用列表</h1><h2 id="700b" class="lo ju hh bd jv lp lq lr jz ls lt lu kd jf lv lw kh jj lx ly kl jn lz ma kp mb bi translated">使用快车道——简单</h2><figure class="mc md me mf fd ii"><div class="bz dy l di"><div class="mq mr l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Example Fastfile</figcaption></figure><pre class="mc md me mf fd mg mh mi mj aw mk bi"><span id="88f3" class="lo ju hh mh b fi ml mm l mn mo">&gt; fastlane create_private_app</span></pre><h2 id="2904" class="lo ju hh bd jv lp lq lr jz ls lt lu kd jf lv lw kh jj lx ly kl jn lz ma kp mb bi translated">使用API —中等</h2><p id="efcb" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">API <a class="ae it" href="https://developers.google.com/android/work/play/custom-app-api/publish" rel="noopener ugc nofollow" target="_blank">文档</a>。客户端库在<a class="ae it" href="https://developers.google.com/api-client-library/java/apis/playcustomapp/v1" rel="noopener ugc nofollow" target="_blank"> Java </a>、<a class="ae it" href="https://developers.google.com/api-client-library/python/apis/playcustomapp/v1" rel="noopener ugc nofollow" target="_blank"> Python </a>、<a class="ae it" href="https://developers.google.com/api-client-library/dotnet/apis/playcustomapp/v1" rel="noopener ugc nofollow" target="_blank"> C# </a>和<a class="ae it" href="https://developers.google.com/api-client-library/ruby/apis/playcustomapp/v1" rel="noopener ugc nofollow" target="_blank"> Ruby </a>中可用。</p><h2 id="eda3" class="lo ju hh bd jv lp lq lr jz ls lt lu kd jf lv lw kh jj lx ly kl jn lz ma kp mb bi translated">API示例</h2><p id="fa53" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">用Ruby编写的这个示例代码使用一个<a class="ae it" href="https://developers.google.com/android/work/play/custom-app-api/get-started#create_a_service_account" rel="noopener ugc nofollow" target="_blank"> Google服务帐户</a> json keyfile进行身份验证，然后调用Play自定义应用服务来创建和上传第一个版本的私有APK。此代码仅在首次创建应用程序时使用，后续更新应使用Play Publishing API中的upload apk功能。</p><figure class="mc md me mf fd ii"><div class="bz dy l di"><div class="mq mr l"/></div></figure><h1 id="9e2b" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">更新私人应用程序</h1><p id="cb7e" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">一旦创建了一个私人应用，<a class="ae it" href="https://developers.google.com/android-publisher/" rel="noopener ugc nofollow" target="_blank"> Google Play发布API </a>可以在Play store列表的初始创建之后推送新的apk。<em class="js"> fastlane </em>支持这个功能上传新的apk来玩，更多信息可以在<a class="ae it" href="https://docs.fastlane.tools/getting-started/android/release-deployment/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h1 id="2697" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">部署给用户</h1><p id="d683" class="pw-post-body-paragraph iu iv hh iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">托管Google Play需要一个EMM(企业移动管理)系统来向用户分发应用。更多信息<a class="ae it" href="https://support.google.com/googleplay/work/answer/6145139?hl=en" rel="noopener ugc nofollow" target="_blank">此处</a>。</p><p id="3b26" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">部署和管理您的私有企业应用从未如此简单。通过托管Google Play部署应用程序的两种方法都是可行的，这都取决于你的CI系统以及你是否想编写任何代码。给<a class="ae it" href="https://fastlane.tools" rel="noopener ugc nofollow" target="_blank">快车道</a>打个预防针，它会节省你大量的时间。</p><p id="5ad3" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你遇到任何问题，可以在<a class="ae it" href="https://github.com/fastlane/fastlane/issues" rel="noopener ugc nofollow" target="_blank"> github </a>上对fastlane提出错误。</p></div></div>    
</body>
</html>