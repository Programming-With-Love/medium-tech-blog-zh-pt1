<html>
<head>
<title>Bag — The Counter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">包——柜台</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/bag-the-counter-2689e901aadb?source=collection_archive---------0-----------------------#2018-06-04">https://medium.com/oracledevs/bag-the-counter-2689e901aadb?source=collection_archive---------0-----------------------#2018-06-04</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex ie if ig ih er es paragraph-image"><div class="ab fe cl ii"><img src="../Images/646e03edbe26fbaed675a53d4e7de85d.png" data-original-src="https://miro.medium.com/v2/format:webp/1*d1FllHC2H0SXv7CK-aV_iQ.png"/></div><figcaption class="il im et er es in io bd b be z dx"><a class="ae ip" href="https://www.eclipse.org/collections/" rel="noopener ugc nofollow" target="_blank">https://www.eclipse.org/collections/</a></figcaption></figure><p id="4f2e" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">我经常遇到计算物体数量的需要。我经历了两种方式计数的必要性，第一种是计数满足某一标准的对象的数量，第二种是找到某一特定对象被遇到的次数。在这篇博客中，我们将看到如何解决第二个问题:找到一个特定对象被遇到的次数。</p><p id="d139" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated"><strong class="is hi">包(或多件套):</strong></p><p id="cc5c" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">Bag是一种数据结构，当您通过输入一个<code class="du jo jp jq jr b">Map&lt;K, Integer&gt;</code>来计数对象时会用到它。包类似于您的购物袋或杂货袋，其中您可以有一个或多个事件或特定项目，没有特定的顺序。因此，包是一个像集合一样的顺序独立的数据结构，但是它允许重复。</p><p id="376f" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">让我们考虑一个物品清单，你想数一数清单上的每种水果的数量。你可以简单地将物品分组并计数，JDK有<code class="du jo jp jq jr b">Collectors</code>为你做这些。代码如下所示:</p><figure class="jt ju jv jw fd ih er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es js"><img src="../Images/1598721a57a6e00eebf42ad43ae06dc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JFcsY5vECKHJzzxUS3heXA.png"/></div></div><figcaption class="il im et er es in io bd b be z dx">Using a Map to count</figcaption></figure><p id="7808" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">“苹果”、“香蕉”和“橘子”有一个有效的计数，然而，“葡萄”不是<code class="du jo jp jq jr b">items</code>的一部分，该断言必须用于<code class="du jo jp jq jr b">null</code>。从而使这个实现不是空安全的。</p><p id="af3b" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">现在让我们通过在这种情况下使用Eclipse Collections包来解决相同的问题。Eclipse Collections提供了返回一个包的<code class="du jo jp jq jr b">toBag()</code> API。</p><figure class="jt ju jv jw fd ih er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es kb"><img src="../Images/894f02e371fde057cc0a001de313644e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CqP7n7MbLSjRQRkS4gjwQw.png"/></div></div><figcaption class="il im et er es in io bd b be z dx">Using a Bag to count</figcaption></figure><p id="4bcf" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">袋子上有<code class="du jo jp jq jr b">occurrencesOf()</code> API，它返回计数。从“Grapes”的断言可以看出,<code class="du jo jp jq jr b">occurrencesOf()</code> API是空安全的。</p><p id="29d0" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">除了在<a class="ae ip" href="https://www.eclipse.org/collections/javadoc/9.2.0/org/eclipse/collections/api/RichIterable.html" rel="noopener ugc nofollow" target="_blank"> RichIterable </a>上提供的丰富API之外，Eclipse Collections <a class="ae ip" href="https://www.eclipse.org/collections/javadoc/9.2.0/org/eclipse/collections/api/bag/Bag.html" rel="noopener ugc nofollow" target="_blank"> Bag </a>还有更具体、更直观的API，比如<code class="du jo jp jq jr b">occurrencesOf()</code>、<code class="du jo jp jq jr b">addOccurrences()</code>、<code class="du jo jp jq jr b">topOccurrences()</code>、<code class="du jo jp jq jr b">bottomOccurrences()</code>等等。</p><p id="8ceb" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">Eclipse集合包实现被称为HashBag。HashBag由来自Eclipse集合本身的ObjectIntMap <k>支持。ObjectIntMap是一个开放的地址映射，它以Objects作为键，但值是原始的int。这种实施方式使得袋子更薄。</k></p><p id="b2c7" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">下面是JDK 1.8 HashMap和Eclipse Collections 9.2.0 Bag之间的一些内存和性能比较</p><p id="8a50" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated"><strong class="is hi">内存占用(数字越低越好)</strong></p><p id="e761" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">这显示了包括数据结构成分在内的总内存占用量。</p><figure class="jt ju jv jw fd ih er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es kc"><img src="../Images/5f4e0890cdbad2fa82b5aaf86a3b62a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SuPY8rcEPI7xfahQ4phQMA.png"/></div></div><figcaption class="il im et er es in io bd b be z dx">Memory Comparison HashMap&lt;Integer, Integer&gt; vs Eclipse Collections HashBag&lt;Integer&gt;</figcaption></figure><figure class="jt ju jv jw fd ih er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es kd"><img src="../Images/17638fccd412040e439ce03488691283.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2dN20K5t283ieOgf4ja9mw.png"/></div></div><figcaption class="il im et er es in io bd b be z dx">Memory Comparison HashMap&lt;String, Integer&gt; vs Eclipse Collections HashBag&lt;String&gt;</figcaption></figure><p id="10da" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated"><strong class="is hi">性能测试(数字越大越好)</strong></p><p id="cc2f" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">所有测量值以操作/秒为单位报告</p><figure class="jt ju jv jw fd ih er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es ke"><img src="../Images/dd869015ea11a60e1bdeab29177af84a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gjk05HQxUyx5Ft_91oCCiA.png"/></div></div></figure><figure class="jt ju jv jw fd ih er es paragraph-image"><div class="er es kf"><img src="../Images/ee69556468b5e5ed4ecdf896b3224cde.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/1*wO1-XOa3W-mmux86fFTVDQ.png"/></div></figure><p id="d291" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">内存测试和性能测试的源代码可以在<a class="ae ip" href="https://github.com/nikhilnanivadekar/MemoryPerformanceTest" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</p><p id="6b62" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated"><strong class="is hi">注意:</strong> <code class="du jo jp jq jr b">Map&lt;K, Integer&gt;</code>被考虑用于内存和性能测试，而不是<code class="du jo jp jq jr b">Map&lt;K, Long&gt;</code>以便比较具有可比性，因为Eclipse Collections包由<code class="du jo jp jq jr b">ObjectIntMap&lt;K&gt;</code>支持。我已经验证了这些测试的<code class="du jo jp jq jr b">Map&lt;K, Integer&gt;</code>和<code class="du jo jp jq jr b">Map&lt;K, Long&gt;</code>的内存占用是相同的。</p><p id="61bb" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated"><strong class="is hi">总结:</strong></p><ol class=""><li id="0f7e" class="kh ki hh is b it iu ix iy jb kj jf kk jj kl jn km kn ko kp bi translated">与JDK HashMap相比，Eclipse Collections HashBag的内存占用要少40%。</li><li id="b52d" class="kh ki hh is b it kq ix kr jb ks jf kt jj ku jn km kn ko kp bi translated">对于大小小于40，000个元素的add()和查找操作，JDK HashMap的性能优于Eclipse Collections HashBag。</li><li id="684e" class="kh ki hh is b it kq ix kr jb ks jf kt jj ku jn km kn ko kp bi translated">对于大于40，000个元素的大小，JDK散列表和Eclipse集合散列表具有相当的性能。</li><li id="1be2" class="kh ki hh is b it kq ix kr jb ks jf kt jj ku jn km kn ko kp bi translated">当添加相同的元素10次时，Eclipse Collections HashBag比JDK HashMap表现得更好。</li><li id="2abe" class="kh ki hh is b it kq ix kr jb ks jf kt jj ku jn km kn ko kp bi translated">对于查找操作，JDK HashMap的性能略好于Eclipse Collections HashBag。</li><li id="fb4e" class="kh ki hh is b it kq ix kr jb ks jf kt jj ku jn km kn ko kp bi translated">Eclipse Collections HashBag有API，它有助于特定于包(计数)的操作。</li><li id="2abc" class="kh ki hh is b it kq ix kr jb ks jf kt jj ku jn km kn ko kp bi translated">对于包中不存在特定对象的情况，Eclipse Collections HashBag是空安全的。</li></ol><p id="fa13" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated"><em class="kg">表示支持</em> <a class="ae ip" href="https://github.com/eclipse/eclipse-collections/stargazers" rel="noopener ugc nofollow" target="_blank"> <em class="kg">星美上GitHub </em> </a> <em class="kg">。</em></p><p id="2160" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated"><strong class="is hi"> Eclipse Collections资源:</strong><br/><a class="ae ip" href="https://github.com/eclipse/eclipse-collections" rel="noopener ugc nofollow" target="_blank">Eclipse Collections</a>自带实现<a class="ae ip" href="https://www.eclipse.org/collections/javadoc/9.0.0/org/eclipse/collections/impl/list/mutable/FastList.html" rel="noopener ugc nofollow" target="_blank"> List </a>、<a class="ae ip" href="https://www.eclipse.org/collections/javadoc/9.0.0/org/eclipse/collections/impl/set/mutable/UnifiedSet.html" rel="noopener ugc nofollow" target="_blank"> Set </a>和<a class="ae ip" href="https://www.eclipse.org/collections/javadoc/9.0.0/org/eclipse/collections/impl/map/mutable/UnifiedMap.html" rel="noopener ugc nofollow" target="_blank"> Map </a>。它还有额外的数据结构，如<a class="ae ip" href="https://www.eclipse.org/collections/javadoc/9.0.0/org/eclipse/collections/api/multimap/Multimap.html" rel="noopener ugc nofollow" target="_blank"> Multimap </a>、<a class="ae ip" href="https://www.eclipse.org/collections/javadoc/9.0.0/org/eclipse/collections/api/bag/Bag.html" rel="noopener ugc nofollow" target="_blank"> Bag </a>和一个完整的原始集合层次结构。我们的每一个集合都有一个丰富的API用于通常需要的迭代模式。</p><ol class=""><li id="c3a4" class="kh ki hh is b it iu ix iy jb kj jf kk jj kl jn km kn ko kp bi translated"><a class="ae ip" href="https://www.eclipse.org/collections/" rel="noopener ugc nofollow" target="_blank">网站</a></li><li id="49a6" class="kh ki hh is b it kq ix kr jb ks jf kt jj ku jn km kn ko kp bi translated"><a class="ae ip" href="https://github.com/eclipse/eclipse-collections" rel="noopener ugc nofollow" target="_blank">GitHub上的源代码</a></li><li id="9496" class="kh ki hh is b it kq ix kr jb ks jf kt jj ku jn km kn ko kp bi translated"><a class="ae ip" href="https://github.com/eclipse/eclipse-collections/blob/master/CONTRIBUTING.md" rel="noopener ugc nofollow" target="_blank">投稿指南</a></li><li id="9f41" class="kh ki hh is b it kq ix kr jb ks jf kt jj ku jn km kn ko kp bi translated"><a class="ae ip" href="https://github.com/eclipse/eclipse-collections/blob/master/docs/guide.md#eclipse-collections-reference-guide" rel="noopener ugc nofollow" target="_blank">参考指南</a></li></ol></div></div>    
</body>
</html>