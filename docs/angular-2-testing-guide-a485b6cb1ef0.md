# è§’åº¦â€”æµ‹è¯•æŒ‡å—(v4+)

> åŸæ–‡ï¼š<https://medium.com/google-developer-experts/angular-2-testing-guide-a485b6cb1ef0?source=collection_archive---------0----------------------->

ä½¿ç”¨ TestBedã€fixturesã€async å’Œ fakeAsync/tick çš„ä¹ä¸ªæ˜“äºç†è§£çš„ç¤ºä¾‹ã€‚

![](img/a777f90602e08b2079df40dc60d20dd2.png)

[Fluidscapes](http://www.syedrezaali.com/#/fluidscapes/) (Reza Ali)

åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æƒ³æ¶µç›–æœ€å¸¸è§çš„å•å…ƒæµ‹è¯•ï¼Œå¦‚:ç»„ä»¶ã€æœåŠ¡ã€Http å’Œç®¡é“ï¼›è¿˜åŒ…æ‹¬ä¸€äº›ä¸å¤ªä¸ºäººæ‰€çŸ¥çš„é¢†åŸŸï¼Œå¦‚:æŒ‡ä»¤ã€è·¯ç”±å™¨æˆ–å¯è§‚å¯Ÿå¯¹è±¡ã€‚æˆ‘ä»¬å°†æä¾›è®¾è®¡çš„ç¤ºä¾‹ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥ä½¿ç”¨å®ƒä»¬ä½œä¸ºå¿«é€Ÿå‚è€ƒã€‚ä¸è¦é”™è¿‡ [**æµ‹è¯•æ¸…å•**](#8ea4) æ¥å¸®åŠ©ä½ åˆ›å»ºä½ è‡ªå·±çš„æµ‹è¯•ã€‚

ä» RC åˆ° finalï¼Œæµ‹è¯•å·²ç»æ”¹è¿›äº†å¾ˆå¤šï¼Œåœ¨è¿ç§»åˆ° NgModule ä¹‹åç”šè‡³æ›´å¤šã€‚Angular æ ¸å¿ƒå›¢é˜ŸåŠªåŠ›å‡å°‘æ ·æ¿æ–‡ä»¶ï¼Œä¸ä»…èƒ½å¤Ÿä½¿ç”¨ Jasmineï¼Œè¿˜èƒ½å¤Ÿä½¿ç”¨å…¶ä»–æµ‹è¯•æ¡†æ¶ï¼Œå¦‚ Mochaã€‚

ä¸ºäº†ä»æµ‹è¯•ä¸­è·å¾—æœ€ä½³æ•ˆæœï¼Œæ‚¨åº”è¯¥äº†è§£ä¸€äº›æ–°çš„ APIã€‚æˆ‘ä»¬å°†æ¶µç›–:

*   **èŒ‰è‰**ç®€ä»‹:[å¥—ä»¶](#b343)ã€[è§„æ ¼](#b343)ã€[æœŸæœ›](#b343)å’Œ[åŒ¹é…å™¨](#b343)ã€‚
*   **è§’åº¦æµ‹è¯•** : [è®¾ç½®](#e122)ã€[ä¾èµ–æ³¨å…¥](#4625)å’Œ[æµ‹è¯•æ£€æŸ¥è¡¨](#8ea4)ã€‚
*   **æµ‹è¯•å®ç”¨ç¨‹åº** : [æµ‹è¯•åºŠ](#4625)ï¼Œ[æ³¨å…¥](#4625)ï¼Œ[å¤¹å…·](#8d61)ï¼Œ[å¼‚æ­¥](#4625)ï¼Œ [fakeAsync/tick](#6134) å’Œ jasmine.doneã€‚
*   **æµ‹è¯•å®ä¾‹** : [ç»„ä»¶](#8d61)ï¼Œ[æœåŠ¡](#d889)ï¼Œ [Http](#b1fc) å’Œ [MockBackend](#f7c7) ï¼Œ [Directives](#6134) ï¼Œ [Pipes](#2626) ï¼Œ [Routes](#97c2) ï¼Œ [Observables](#9fa4) å’Œ [EventEmitter](#3882) ã€‚

è¦æµ‹è¯•æ‰€æœ‰çš„ **26 è§„æ ¼**æˆ–æ›´æ”¹ä»£ç ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ª [Plunker](https://plnkr.co/edit/jm6T17qPbzM8abmRMckw?p=preview) ã€‚

[](http://slides.com/gerardsans/ng-stockholm-testing-recipes) [## Gerard Sans çš„è§’åº¦æµ‹è¯•æ–¹æ³•å’Œæœ€ä½³å®è·µ(v2+)

### åœ¨æœ¬æ¬¡æ¼”è®²ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»å¼€å‘åšå¦‚ç£çŸ³çš„è§’åº¦åº”ç”¨æ—¶æœ€å¸¸è§çš„æµ‹è¯•åœºæ™¯â€¦

slides.com](http://slides.com/gerardsans/ng-stockholm-testing-recipes) 

åœ¨ [@gerardsans](https://twitter.com/intent/user?screen_name=gerardsans) çš„æˆ‘çš„è®¢é˜…ä¸­æ‰¾åˆ°æœ€æ–°çš„è§’åº¦å†…å®¹ã€‚

> æˆ‘ä»¬ä½¿ç”¨äº†[èŒ‰è‰](http://jasmine.github.io/)ï¼Œä½†æ˜¯æ—¢ç„¶ Angular final ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–æµ‹è¯•æ¡†æ¶ï¼Œæ¯”å¦‚[æ‘©å¡](https://mochajs.org/)ã€‚

# èŒ‰è‰ç®€ä»‹

Jasmine æ˜¯æ¥è‡ª [Pivotal Labs](http://pivotal.io/labs) çš„å¼€æºæµ‹è¯•æ¡†æ¶ï¼Œå®ƒä½¿ç”¨è¡Œä¸ºé©±åŠ¨çš„ç¬¦å·ï¼Œå¸¦æ¥æµç•…å’Œæ”¹è¿›çš„æµ‹è¯•ä½“éªŒã€‚

## ä¸»è¦æ¦‚å¿µ

*   Suites â€” ***describe(stringï¼Œfunction)****functionsï¼Œå–ä¸€ä¸ªæ ‡é¢˜å’Œä¸€ä¸ªåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªè§„æ ¼çš„å‡½æ•°ã€‚*
*   *Specs â€” ***it(stringï¼Œfunction)*** functionsï¼Œå–ä¸€ä¸ªæ ‡é¢˜å’Œä¸€ä¸ªåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæœŸæœ›çš„å‡½æ•°ã€‚*
*   *æœŸæœ›â€”â€”æ˜¯è¯„ä¼°ä¸º*çœŸ*æˆ–*å‡*çš„æ–­è¨€ã€‚åŸºæœ¬è¯­æ³•ä¸º ***expect(å®é™…)ã€‚****
*   *åŒ¹é…å™¨â€”æ˜¯é€šç”¨æ–­è¨€çš„é¢„å®šä¹‰åŠ©æ‰‹ã€‚ä¾‹å¦‚: ***toBe(é¢„æœŸ)******to equal(é¢„æœŸ)*** ã€‚ç‚¹å‡»æŸ¥çœ‹å®Œæ•´åˆ—è¡¨[ã€‚](https://github.com/JamieMason/Jasmine-Matchers)*

> *æ³¨æ„**ã€‚toEqual()** åšæ·±åº¦æ¯”è¾ƒè€Œ**ã€‚toBe()** åªæ˜¯ä¸€ä¸ªå¼•ç”¨ç­‰å¼ã€‚*

## *å®‰è£…å’Œæ‹†å¸*

*Jasmine æä¾›äº†å››ä¸ªå¤„ç†ç¨‹åºæ¥æ·»åŠ æˆ‘ä»¬çš„å®‰è£…å’Œæ‹†å¸ä»£ç :æ¯ä¸ª ä¹‹å‰çš„***ï¼›æ¯ä¸ªè§„æ ¼æ‰§è¡Œä¸€æ¬¡çš„*** ä¹‹åçš„**ï¼›æ¯ä¸ªå¥—ä»¶æ‰§è¡Œä¸€æ¬¡çš„ ***ä¹‹å‰çš„*** ã€ ***ä¹‹åçš„*** ã€‚***

> *ä½¿ç”¨ beforeEach å’Œ afterEach åœ¨æ¯ä¸ªè§„èŒƒä¹‹å‰å’Œä¹‹åè¿›è¡Œæ›´æ”¹*

*åœ¨æˆ‘ä»¬çš„è§„èŒƒä¸­é¿å…ä»£ç é‡å¤çš„ä¸€ä¸ªå¥½æ–¹æ³•æ˜¯åœ¨è®¾ç½®ä¸­é‡æ„é‡å¤çš„ä»£ç ã€‚*

# *è§’åº¦æµ‹è¯•*

## *æµ‹è¯•è®¾ç½®*

*è®¾ç½®ç¯å¢ƒçš„é€‰é¡¹å¾ˆå°‘ã€‚ä½ å¯ä»¥ä½¿ç”¨æ¥è‡ª[ç‹¬ç«‹å‘è¡Œç‰ˆ](https://github.com/pivotal/jasmine/releases)çš„ Jasmine*SpecRunner.html*æ¥å¼€å§‹æˆ–åˆ›å»ºä½ è‡ªå·±çš„ã€‚ä½ ä¹Ÿå¯ä»¥æŠŠå®ƒå’Œä¸€ä¸ªç±»ä¼¼ [Karma](https://karma-runner.github.io) çš„æµ‹è¯•è€…æ•´åˆåœ¨ä¸€èµ·ã€‚æˆ‘ä»¬ä¸ä¼šæ¶µç›–æ‰€æœ‰ç»„åˆï¼Œå› ä¸ºæˆ‘ä»¬å¯¹å®é™…æµ‹è¯•æ›´æ„Ÿå…´è¶£ã€‚*

> *æ­¤è®¾ç½®ä»…ä¾›å‚è€ƒï¼Œä»…é€‚ç”¨äº Plunkerã€‚*

*æˆ‘ä»¬åŠ è½½ Jasmine ä¾èµ–é¡¹ï¼Œåé¢æ˜¯ Angular ä¾èµ–é¡¹ã€‚æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨ä¸€ä¸ª **System.js** å’Œ **TypeScript** è®¾ç½®ã€‚æˆ‘ä»¬ä½¿ç”¨ *Promise.all()* ä¸€æ¬¡æ€§åŠ è½½æˆ‘ä»¬çš„è§„èŒƒï¼Œä¸€æ—¦æ‰€æœ‰è§„èŒƒéƒ½å¯ç”¨ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨ **onload** æ‰‹åŠ¨è§¦å‘ Jasmine æµ‹è¯•è¿è¡Œç¨‹åºã€‚*

## *ä¾èµ–æ³¨å…¥*

***TestBed** ï¼Œç±»ä¼¼äº@NgModule å¸®åŠ©æˆ‘ä»¬å»ºç«‹æµ‹è¯•çš„ä¾èµ–å…³ç³»ã€‚æˆ‘ä»¬è°ƒç”¨**testbed . configuretestingmodule**ä¼ é€’æˆ‘ä»¬çš„é…ç½®ã€‚æ­¤ä¿¡æ¯å°†ç”¨äºè§£å†³ä»»ä½•ä¾èµ–å…³ç³»ã€‚ä¸‹é¢æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªä¾‹å­:*

```
*@NgModule({
  declarations: [ **ComponentToTest** ] 
  providers: [ **MyService** ]
}) 
class AppModule { }TestBed.configureTestingModule({
  declarations: [ **ComponentToTest** ],
  providers: [ **MyService** ]  
});//get instance from TestBed (root injector)
let service = TestBed.get(**MyService**);*
```

***æ³¨å…¥**ï¼Œå…è®¸æˆ‘ä»¬åœ¨æµ‹è¯•å±‚è·å¾—ä¾èµ–å…³ç³»ã€‚*

```
*it('should return ...', **inject**([MyService], service => { 
  service.foo();
}));*
```

***ç»„ä»¶æ³¨å…¥å™¨**ï¼Œå…è®¸æˆ‘ä»¬åœ¨ç»„ä»¶çº§åˆ«å¾—åˆ°ä¸€ä¸ªä¾èµ–ã€‚*

```
*@Component({ 
  providers: [ **MyService** ] 
}) 
class **ComponentToTest** { }let fixture = TestBed.createComponent(**ComponentToTest**);
let service = fixture.debugElement.injector.get(**MyService**);*
```

*å¯¹äºåœ¨ç»„ä»¶çº§å®šä¹‰çš„ä¾èµ–å…³ç³»ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨å¦‚ä¸Šæ‰€ç¤ºçš„ç»„ä»¶æ³¨å…¥å™¨ã€‚TestBed.get æˆ– inject ä¸èµ·ä½œç”¨ã€‚*

*è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å°† **TestBed** ä¸*languageservice*ç»„ä»¶ä¸€èµ·ä½¿ç”¨:*

*é¦–å…ˆï¼Œæˆ‘ä»¬ç”¨**testbed . configuretestingmodule**åŠ è½½æµ‹è¯•æ‰€éœ€çš„ä¾èµ–é¡¹ã€‚ç„¶ååœ¨æˆ‘ä»¬çš„è§„èŒƒä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ [*æ³¨å…¥*](https://angular.io/docs/ts/latest/api/testing/inject-function.html) æ¥è‡ªåŠ¨å®ä¾‹åŒ–æ¯ä¸ªä¾èµ–é¡¹ã€‚*

*æˆ‘ä»¬ç°åœ¨å¯ä»¥é‡æ„*æ³¨å…¥*ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ä¼šä¸ºæ¯ä¸ªè§„èŒƒé‡å¤å®ƒã€‚*

*è®©æˆ‘ä»¬çœ‹ä¸¤ä¸ªå®ä¾‹åŒ–ç»„ä»¶çš„ä¾‹å­ã€‚ç¬¬ä¸€ä¸ªä¾‹å­æ˜¯åŒæ­¥çš„ï¼Œå®ƒåˆ›å»ºäº†ä¸€ä¸ª fixtureï¼ŒåŒ…å«ä¸€ä¸ªå®ä¾‹ **MyTestComponent** ã€‚*

```
*// synchronous
  beforeEach(() => {
    fixture = TestBed.createComponent(**MyTestComponent**);
  });*
```

*ç¬¬äºŒä¸ªä¾‹å­æ˜¯å¼‚æ­¥çš„**ï¼Œ**å› ä¸ºä½¿ç”¨å¤–éƒ¨æ¨¡æ¿å’Œ cssï¼Œéœ€è¦ XHR è°ƒç”¨ã€‚*

```
*// asynchronous 
  beforeEach(**async**(() => {
    TestBed.configureTestingModule({
      declarations: [ **MyTestComponent** ],
    }).**compileComponents**(); // compile external templates and css
  }));*
```

*å½“ä¾èµ–å…³ç³»æ¶‰åŠå¼‚æ­¥å¤„ç†æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨[*async*](https://angular.io/docs/ts/latest/api/core/testing/index/async-function.html)*ã€‚è¿™å°†åœ¨å†…éƒ¨åˆ›å»ºä¸€ä¸ªåŒºåŸŸï¼Œå¹¶å¤„ç†ä»»ä½•å¼‚æ­¥å¤„ç†ã€‚**

> **æ ¹æ®æ‚¨çš„æ„å»ºè®¾ç½®ï¼Œæ‚¨çš„æ¨¡æ¿å’Œ css å¯èƒ½éƒ½æ˜¯å†…è”çš„ï¼Œå› æ­¤æ‚¨å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨åŒæ­¥æ–¹æ³•**

## **æµ‹è¯•æ¸…å•**

*   ****å“ªç§æµ‹è¯•**ï¼Ÿ[å­¤ç«‹](https://angular.io/docs/ts/latest/guide/testing.html#!#isolated-unit-tests)ã€[æµ…](https://angular.io/docs/ts/latest/guide/testing.html#!#shallow-component-test)æˆ–[ç»¼åˆæµ‹è¯•](https://vsavkin.com/three-ways-to-test-angular-2-components-dcea8e90bd8d)ã€‚**
*   **æˆ‘å¯ä»¥ä½¿ç”¨æ¨¡æ‹Ÿã€å­˜æ ¹æˆ–é—´è°å—ï¼Ÿä¾èµ–å…³ç³»åº”è¯¥è¢«ä»–ä»¬è‡ªå·±çš„æµ‹è¯•æ‰€è¦†ç›–ã€‚ä½¿ç”¨å®ƒä»¬å¯ä»¥æé«˜ä½ çš„æµ‹è¯•ï¼Œè€Œä¸ä¼šå¤±å»æ•ˆåŠ›ã€‚**
*   ****åŒæ­¥è¿˜æ˜¯å¼‚æ­¥**ï¼Ÿä½ çš„æµ‹è¯•è¿›è¡Œå¼‚æ­¥è°ƒç”¨äº†å—ï¼Ÿä½¿ç”¨ XHRã€æ‰¿è¯ºã€å¯è§‚æµ‹é‡ç­‰ã€‚ç»„ä»¶ä½¿ç”¨çš„æ˜¯ TemplateUrl è¿˜æ˜¯ styleUrls è¿˜æ˜¯ inlineï¼Ÿç¡®ä¿æ‚¨ä½¿ç”¨çš„æ˜¯ç›¸åº”çš„ APIã€‚**

**è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•æµ‹è¯•åº”ç”¨ç¨‹åºçš„ä¸åŒæ„ä»¶ã€‚ä¸ºäº†ç®€æ´èµ·è§ï¼Œæˆ‘ä»¬å°†è·³è¿‡æ‰€æœ‰å¿…éœ€çš„ ***å¯¼å…¥*** ã€‚æˆ‘ä»¬åœ¨å¿…è¦æ—¶æ·»åŠ äº†æ³¨é‡Šã€‚ä»–ä»¬å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ã€‚**

# **æµ‹è¯•ç¤ºä¾‹**

## **æµ‹è¯•ç»„ä»¶**

**è®©æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªç®€å•çš„ç»„ä»¶ï¼Œå®ƒä½¿ç”¨ä¸€ä¸ª [@ *Input()*](https://angular.io/docs/ts/latest/api/core/Input-var.html) å±æ€§æ¥å‘ˆç°ä¸€ä¸ª*é—®å€™*æ¶ˆæ¯ã€‚**

**ä¸ºäº†æµ‹è¯•è¯¥ç»„ä»¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªé€šç”¨è®¾ç½®ï¼Œè¯¥è®¾ç½®ä½¿ç”¨*è¯•éªŒå°*ã€‚**

> **ä½¿ç”¨ TestBed åŠ è½½ç›¸åº”çš„ä¾èµ–é¡¹ï¼Œä»¥ä¾¿å®ƒä»¬åœ¨æµ‹è¯•æœŸé—´å¯ç”¨**

**é€šå¸¸çš„åšæ³•æ˜¯åœ¨æ¯ä¸ªä¹‹å‰ä½¿ç”¨*æ¥é‡æ„æˆ‘ä»¬çš„æµ‹è¯•ã€‚é€šè¿‡è¿™æ ·åšï¼Œæˆ‘ä»¬é¿å…äº†ä¸ºæ¯ä¸ªæµ‹è¯•*é‡å¤ä¸€äº›ä»£ç ï¼Œæ¯”å¦‚*æ³¨å…¥*ã€‚è¿™ä¹Ÿå°†ç®€åŒ–æˆ‘ä»¬çš„è§„æ ¼ã€‚****

æˆ‘ä»¬ä½¿ç”¨*testbed . create component*æ¥åˆ›å»ºæˆ‘ä»¬çš„ *Greeter* ç»„ä»¶çš„ä¸€ä¸ªå®ä¾‹ã€‚ç»„ä»¶å®ä¾‹å¯åœ¨[å¤¹å…·](https://github.com/angular/angular/blob/a7e9bc97f6a19a2b47b962bd021cb91346a44baa/modules/angular2/src/testing/test_component_builder.ts#L31)ä¸­è®¿é—®ã€‚è¿™æ˜¯å®ƒçš„ä¸»è¦ API:

```
abstract class [ComponentFixture](https://github.com/angular/angular/blob/a7e9bc97f6a19a2b47b962bd021cb91346a44baa/modules/angular2/src/testing/test_component_builder.ts#L31) {
  debugElement;       // test helper 
  componentInstance;  // to access properties and methods
  nativeElement;      // to access DOM element
  detectChanges();    // trigger component change detection
}
```

æˆ‘ä»¬ä½¿ç”¨ *name* å±æ€§è®¾ç½®ä¸€ä¸ªå€¼ï¼Œä½¿ç”¨ **detectChanges** è§¦å‘å˜åŒ–æ£€æµ‹ï¼Œå¹¶ä½¿ç”¨ **whenStable** æ£€æŸ¥æ‰€æœ‰å¼‚æ­¥è°ƒç”¨ç»“æŸæ—¶çš„é¢„æœŸç»“æœã€‚ä¸ºäº†è®¿é—®å‘ˆç°çš„æ–‡æœ¬ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†ä¸¤ç§ä¸åŒçš„ APIï¼Œé€šè¿‡ CSS é€‰æ‹©å™¨è¿›è¡Œè¿‡æ»¤(ç¬¬ 22â€“23 è¡Œ)ã€‚

> debugElement çš„å…¶ä»–æŸ¥è¯¢æœ‰:query(by . all())query(by . directive(my directive))

## æµ‹è¯•æœåŠ¡

*LanguagesService* åªæœ‰ä¸€ä¸ªæ–¹æ³•è¿”å›åº”ç”¨ç¨‹åºå¯ç”¨è¯­è¨€çš„æ•°ç»„ã€‚

ç±»ä¼¼äºæˆ‘ä»¬ä¹‹å‰çš„ä¾‹å­ï¼Œæˆ‘ä»¬ä½¿ç”¨ *beforeEach å®ä¾‹åŒ–æœåŠ¡ã€‚*æ­£å¦‚æˆ‘ä»¬æ‰€è¯´ï¼Œè¿™æ˜¯å³ä½¿æˆ‘ä»¬åªæœ‰ä¸€ä¸ªè§„æ ¼ï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å®è·µã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ­£åœ¨æ£€æŸ¥æ¯ç§è¯­è¨€å’Œæ€»è®¡æ•°ã€‚

## ä½¿ç”¨ Http è¿›è¡Œæµ‹è¯•

æˆ‘ä»¬é€šå¸¸ä¸å¸Œæœ›åœ¨æµ‹è¯•è¿‡ç¨‹ä¸­è¿›è¡Œ HTTP è°ƒç”¨ï¼Œä½†æ˜¯æˆ‘ä»¬å°†æ˜¾ç¤ºå®ƒä½œä¸ºå‚è€ƒã€‚æˆ‘ä»¬å·²ç»å°†æœ€åˆçš„æœåŠ¡ *LanguageService* æ›¿æ¢ä¸º *LanguageServiceHttpã€‚*

åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå®ƒä½¿ç”¨ *http.get()* æ¥è¯»å–ä¸€ä¸ª JSON æ–‡ä»¶ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨[*observable . map()*](https://github.com/ReactiveX/RxJS/blob/master/src/operator/map.ts)*ä½¿ç”¨ *json()å°†å“åº”è½¬æ¢æˆæœ€ç»ˆç»“æœã€‚**

*æˆ‘ä»¬çš„æµ‹è¯•çœ‹èµ·æ¥ä¸å‰ä¸€ä¸ªéå¸¸ç›¸ä¼¼ã€‚ä¸»è¦çš„åŒºåˆ«æ˜¯ç”±äºè®¢é˜…ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†å¼‚æ­¥æµ‹è¯•ï¼Œå°±åƒæˆ‘ä»¬å¯¹ç»„ä»¶æ‰€åšçš„é‚£æ ·ã€‚*

> *æ³¨æ„ï¼Œå¦‚æœæ¶‰åŠ XHR å‘¼å«ï¼Œæ‚¨ä¸èƒ½ä½¿ç”¨ *fakeAsync* ã€‚è¿™æ˜¯ç”±[è®¾è®¡çš„](https://github.com/angular/angular/issues/8280)ã€‚*

*è¿”å›ä¸€ä¸ªæˆ‘ä»¬å¯ä»¥è®¢é˜…çš„å¯è§‚å¯Ÿå€¼ã€‚æˆ‘ä»¬å°†åœ¨åé¢æ›´è¯¦ç»†åœ°è®¨è®ºå¯è§‚å¯Ÿåˆ°çš„ç°è±¡ã€‚*

## *ä½¿ç”¨æ¨¡æ‹Ÿåç«¯è¿›è¡Œæµ‹è¯•*

*æ›´æ˜æ™ºçš„æ–¹æ³•æ˜¯ç”¨ä¸€ä¸ª *MockBackend* ä»£æ›¿ HTTP è°ƒç”¨ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨*æä¾›*(ç¬¬ 10 è¡Œ)*ã€‚è¿™ä¸ª**

**åœ¨æˆ‘ä»¬çš„æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬æ„å»ºäº†æ¨¡æ‹Ÿå“åº”(ç¬¬ 23â€“25 è¡Œ),æ‰€ä»¥å½“æˆ‘ä»¬æœ€ç»ˆè°ƒç”¨æˆ‘ä»¬çš„æœåŠ¡æ—¶ï¼Œå®ƒä¼šå¾—åˆ°é¢„æœŸçš„ç»“æœã€‚**

> **æ³¨æ„:æˆ‘ä»¬ä¸éœ€è¦å¼‚æ­¥ï¼Œå› ä¸º MockBackend çš„è¡Œä¸ºæ˜¯åŒæ­¥çš„ã€‚æ„Ÿè°¢[å¸•æ–¯å¡Â·æ™®é›·å¸Œç‰¹Â·Ê•â€¢Ì«Í¡â€¢Ê”](https://medium.com/u/32a0d1331713?source=post_page-----a485b6cb1ef0--------------------------------)æŒ‡å‡ºè¿™ä¸€ç‚¹ã€‚**

## **æµ‹è¯•æŒ‡ä»¤**

**Angular ä¸­çš„æŒ‡ä»¤æ˜¯ä¸€ç§ç‰¹æ®Šç±»å‹çš„ç»„ä»¶ï¼Œé€šå¸¸æ²¡æœ‰é™„å¸¦è§†å›¾ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ª[å±æ€§æŒ‡ä»¤](https://angular.io/docs/ts/latest/guide/attribute-directives.html)ã€ *logClicksã€*æ¥è®°å½•æˆ‘ä»¬åœ¨**ã€*ä¸»æœºå…ƒç´ *ã€**ä¸Šç‚¹å‡»äº†å¤šå°‘æ¬¡ï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥ç†è§£äº†ã€‚**

**ä¸ºäº†æµ‹è¯•è¿™ä¸ªæŒ‡ä»¤ï¼Œæˆ‘ä»¬å†³å®šåˆ›å»ºä¸€ä¸ª*å®¹å™¨*ç»„ä»¶ã€‚æˆ‘ä»¬å°†å¯¹å®ƒè¿›è¡Œè®¾ç½®ï¼Œä½¿å®ƒå……å½“æˆ‘ä»¬çš„ä¸»æœºï¼Œå†ç°ç”±æˆ‘ä»¬çš„æŒ‡ä»¤å‘å‡ºçš„äº‹ä»¶ã€‚**

**æˆ‘ä»¬åœ¨æ¯ä¸ªä¹‹å‰ä½¿ç”¨*æ¥å°†åˆ›å»ºç»„ä»¶çš„é€»è¾‘ä¸æµ‹è¯•åˆ†å¼€ã€‚è¯¥å™¨ä»¶ç°åœ¨å¯ç”¨äºæ‰€æœ‰è§„æ ¼ã€‚***

**ä¸ºäº†è§¦å‘å®¹å™¨ä¸Šçš„**ç‚¹å‡»**ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† DOM API(æ¨è)ã€‚æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨*fixture . debug element . triggereventhandler(' click ')ã€‚***

**åœ¨è¿™ä¸ªæµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† **fakeAsync** å’Œ **tick** ã€‚ä½¿ç”¨ **fakeAsync** æ‰€æœ‰çš„å¼‚æ­¥å¤„ç†å°†è¢«æš‚åœï¼Œç›´åˆ°æˆ‘ä»¬è°ƒç”¨ **tick** ã€‚è¿™ç»™äº†æˆ‘ä»¬æ›´å¤§çš„æ§åˆ¶æƒï¼Œå¹¶é¿å…äº†ä¸å¾—ä¸æ±‚åŠ©äºåµŒå¥—çš„æ‰¿è¯ºæˆ–å¯è§‚å¯Ÿçš„å—ã€‚**

> **ä½¿ç”¨ fakeAsync/tick æˆ‘ä»¬å¯ä»¥æ›´å¥½åœ°æ§åˆ¶å¼‚æ­¥ä»£ç ï¼Œå°½ç®¡å®ƒä¸èƒ½ç”¨äº XHRã€‚**

## **æµ‹è¯•ç®¡é“**

**ç®¡é“æ˜¯å¯ä»¥å°†è¾“å…¥æ•°æ®è½¬æ¢æˆç”¨æˆ·å¯è¯»æ ¼å¼çš„å‡½æ•°ã€‚æˆ‘ä»¬å°†ä½¿ç”¨æ ‡å‡†çš„[*string . toupper case*](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String/toUpperCase)*()*æ¥ç¼–å†™ä¸€ä¸ªè‡ªå®šä¹‰çš„å¤§å†™ç®¡é“*ã€‚è¿™åªæ˜¯ä¸ºäº†ç®€å•èµ·è§ä½œä¸ºæœ‰è§’çš„æœ‰è‡ªå·±çš„[](https://angular.io/docs/ts/latest/api/common/UpperCasePipe-class.html)**å®ç°ã€‚*****

***ç®¡é“åªæ˜¯å¯ä»¥è¢«æ³¨å…¥çš„æ™®é€šç±»ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ *inject* éå¸¸å®¹æ˜“åœ°è®¾ç½®æˆ‘ä»¬çš„è§„èŒƒã€‚***

**ä¸ºäº†æµ‹è¯•æˆ‘ä»¬çš„ç®¡é“ï¼Œæˆ‘ä»¬æ£€æŸ¥äº†å¸¸è§çš„æƒ…å†µ:å®ƒåº”è¯¥ä¸ç©ºå­—ç¬¦ä¸²ä¸€èµ·å·¥ä½œï¼Œå®ƒåº”è¯¥å¤§å†™ï¼Œæœ€åï¼Œå½“ä¸ä¸å­—ç¬¦ä¸²ä¸€èµ·ä½¿ç”¨æ—¶ï¼Œå®ƒæŠ›å‡ºã€‚**

> **æ³¨æ„:æˆ‘ä»¬ä½¿ç”¨äº†ä¸€ä¸ªç®­å¤´å‡½æ•°æ¥æ•è· *expect* ä¸­çš„å¼‚å¸¸**

## **æµ‹è¯•è·¯çº¿**

**è·¯çº¿æœ‰æ—¶ä¼šè¢«é—æ¼ï¼Œä½†è¿™é€šå¸¸è¢«è§†ä¸ºå¤å¼ç°¿è®°çš„è‰¯å¥½åšæ³•ã€‚åœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªç®€å•çš„è·¯ç”±é…ç½®ï¼Œå…¶ä¸­åªæœ‰å‡ æ¡è·¯ç”±å’Œä¸€æ¡æŒ‡å‘ home çš„è·¯ç”±ã€‚**

**å¦‚æœæ²¡æœ‰æä¾›é‡å®šå‘åˆ°å½’å±çš„åˆå§‹è·¯ç”±ï¼Œåˆ™ç¬¬ä¸€ä¸ªè·¯ç”±å®šä¹‰æ•è·åˆå§‹è·¯ç”±(ç¬¬ 14 è¡Œ)ã€‚ç¬¬äºŒä¸ªå®ä¾‹åŒ–äº† **Home** ç»„ä»¶(ç¬¬ 15 è¡Œ)ï¼›æœ€åä¸€ä¸ªæ•è·æ‰€æœ‰å‰©ä½™çš„è·¯ç”±ï¼Œå¹¶å°†å®ƒä»¬é‡å®šå‘åˆ° home(ç¬¬ 16 è¡Œ)ã€‚æˆ‘ä»¬çš„æµ‹è¯•å°†ä½¿ç”¨è¿™äº›è·¯çº¿æ¥æ£€éªŒæˆ‘ä»¬çš„æœŸæœ›ã€‚**

**æˆ‘ä»¬å¯¼å…¥äº†**routertestingmodule . with routes(routes)**ï¼Œç”¨æˆ‘ä»¬æµ‹è¯•çš„è·¯ç”±åˆå§‹åŒ– **Router** å®ä¾‹(ç¬¬ 6 è¡Œ)ã€‚åœ¨ä¸Šé¢æˆ‘ä»¬æµ‹è¯•çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ **async** ã€ **asyncFake/tick** å’Œ **done** å¯¼èˆªåˆ° homeã€‚æ³¨æ„æˆ‘ä»¬å¦‚ä½•ä½¿ç”¨ **asyncFake** ç¼–å†™æ›´å¥½çš„æµ‹è¯•ï¼Œå› ä¸ºæˆ‘ä»¬ä¸å¿…åµŒå¥—æ‰¿è¯ºå¤„ç†ã€‚**

> **fakeAsync/tick éå¸¸é€‚åˆä¸æ¶‰åŠ XHR çš„å¤æ‚å¼‚æ­¥æµ‹è¯•**

## **æµ‹è¯•å¯è§‚æµ‹é‡**

**å¯è§‚æµ‹é‡éå¸¸é€‚åˆå¤„ç†å¼‚æ­¥ä»»åŠ¡ã€‚å®ƒä»¬è¢«ç”¨åœ¨ Angular ä¸­çš„å‡ ä¸ªåœ°æ–¹ï¼Œåƒ *Http* ï¼Œè¡¨å•æ§ä»¶ï¼ŒéªŒè¯æˆ–è€…åœ¨ *EventEmitter* åé¢ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ä¸‹é¢çš„*è§‚å¯Ÿå€¼*æ¥å±•ç¤ºæˆ‘ä»¬å¦‚ä½•æµ‹è¯•å®ƒä»¬çš„è¡Œä¸ºã€‚**

**æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª*å¯è§‚å¯Ÿçš„*ï¼Œå®ƒå‘å‡º 1ï¼Œ2ï¼Œ3 å¹¶å®Œæˆã€‚ä¸ºäº†æµ‹è¯•å®ƒï¼Œæˆ‘ä»¬åœ¨ subscribe ä¸Šè®¾ç½®äº† nextã€error å’Œ complete å›è°ƒã€‚ç”±äºä¸‹ä¸€æ¬¡å›è°ƒå°†è¢«è°ƒç”¨å‡ æ¬¡ï¼Œæˆ‘ä»¬å¿…é¡»åŠ¨æ€åœ°è®¾ç½®æˆ‘ä»¬çš„æœŸæœ›ã€‚**

## **æµ‹è¯•äº‹ä»¶å‘å°„å™¨**

****äº‹ä»¶å‘å°„å™¨**ç”¨äº Angular ç»„ä»¶ä¹‹é—´çš„äº‹ä»¶é€šä¿¡ã€‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªè®¡æ•°å™¨ç»„ä»¶ï¼Œ **Counter** ï¼Œï¼Œå®ƒå…è®¸æˆ‘ä»¬å¢åŠ æˆ–å‡å°‘åˆå§‹å€¼ 0ã€‚æ¯æ¬¡æˆ‘ä»¬è¿™æ ·åšçš„æ—¶å€™ï¼Œæ–°çš„å€¼å°†ä¼šä½¿ç”¨ä¸€ä¸ª *EventEmitter* åœ¨*æ”¹å˜*æ—¶è¢«å…¬å¼€ã€‚**

**è®¾ç½®å°†éå¸¸ç±»ä¼¼äº Observablesã€‚**

**åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬æ£€æŸ¥æ˜¯å¦å¯ä»¥ä½¿ç”¨ *EventEmitter* ä¸Šçš„ subscribe**å¢åŠ **æˆ–**å‡å°‘**ï¼Œå› ä¸ºå®ƒå…¬å¼€äº†ä¸€ä¸ª*å¯è§‚å¯Ÿå¯¹è±¡*ã€‚æˆ‘ä»¬é€šè¿‡è°ƒç”¨ change æ–¹æ³•è§¦å‘ä¸åŒçš„å€¼ï¼Œå¹¶åœ¨ä¸‹ä¸€æ¬¡å›è°ƒä¸­æ£€æŸ¥æˆ‘ä»¬çš„æœŸæœ›ã€‚**

**ä½ å¯ä»¥åœ¨è¿™ç¯‡æ–‡ç« ä¸­æ‰¾åˆ°æ‰€æœ‰çš„æµ‹è¯•ï¼Œæ›´å¤šçš„æµ‹è¯•å¯ä»¥åœ¨æ¼”ç¤ºä¸­æ‰¾åˆ°ã€‚**

**æˆ‘åªæœ‰è¿™äº›äº†ï¼æ„Ÿè°¢é˜…è¯»ï¼æœ‰ä»€ä¹ˆé—®é¢˜å—ï¼Ÿåœ¨ [@gerardsans](https://twitter.com/intent/user?screen_name=gerardsans) ç»™æˆ‘å‘çŸ­ä¿¡**

## **æƒ³è¦æ›´å¤šå—ï¼Ÿ**

**å¦‚æœæ‚¨éœ€è¦æ›´å¤šç¤ºä¾‹ï¼Œè¯·éšæ—¶é€šè¿‡ Gerard _ dot _ sans _ at _ Gmail _ dot _ com è”ç³»æˆ‘ï¼Œæˆ–è€…å‰å¾€ GitHub ä¸­çš„[è§’åº¦å•å…ƒæµ‹è¯•](https://github.com/angular/angular/tree/e748adda2e7a1f6e302628d0d76b5c3d1e3fc196/modules/angular2/test)ï¼**

**[](http://www.meetup.com/AngularZone/) [## å®‰å¤æ‹‰å®—ç¤¾åŒº

### æ¬¢è¿æ¥åˆ°æˆ‘ä»¬çš„ç¤¾åŒºã€‚æˆ‘ä»¬çš„æ¿€æƒ…æ˜¯æœ‰æ£±è§’çš„ã€‚åŠ å…¥æˆ‘ä»¬å§ï¼ğŸš€](http://www.meetup.com/AngularZone/) 

# è¿›ä¸€æ­¥é˜…è¯»

*   [æµ‹è¯•](https://angular.io/docs/ts/latest/guide/testing.html)(æ­£å¼æ–‡ä»¶)
*   è§’åº¦åº”ç”¨çš„å•å…ƒæµ‹è¯•ç”±**vik ram subra manian**([@ viker man)](https://twitter.com/vikerman)åœ¨ [ng-Europe](https://ngeurope.org/) æ¼”è®²ã€‚[è§†é¢‘](https://www.youtube.com/watch?v=dVtDnvTLaIo) | [å¹»ç¯ç‰‡](https://docs.google.com/presentation/d/1fFxQvx2WHFPqR4piq0oWgKBuSMvrCwc1vfYggHlYEbQ/edit?usp=sharing)
*   [ä¸‰ç§æµ‹è¯•è§’åº¦ç»„ä»¶çš„æ–¹æ³•](https://vsavkin.com/three-ways-to-test-angular-2-components-dcea8e90bd8d)ä½œè€…**ç»´å…‹æ‰˜Â·è¨ç»´é‡‘**([@ç»´å…‹æ‰˜Â·è¨ç»´é‡‘](https://twitter.com/victorsavkin))

[![](img/abefda0aa7864742686ec7f7fdffe2b5.png)](https://twitter.com/intent/user?screen_name=gerardsans)![](img/e7feb1af735b3fcdd1c800bfa8958065.png)![](img/67b37e5d672384f0953563450fca0029.png)**