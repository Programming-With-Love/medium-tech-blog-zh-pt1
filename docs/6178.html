<html>
<head>
<title>Supporting React Native at Pinterest</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">支持Pinterest的Native reaction</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/supporting-react-native-at-pinterest-f8c2233f90e6?source=collection_archive---------1-----------------------#2018-05-10">https://medium.com/pinterest-engineering/supporting-react-native-at-pinterest-f8c2233f90e6?source=collection_archive---------1-----------------------#2018-05-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="6c48" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">文晏| Pinterest工程师，增长</p><p id="2f0e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">去年初，一小群工程师开始研究在Pinterest采用React Native的可能性。自从生态系统在2015年首次开放以来，我们一直饶有兴趣地关注着它。从那时起，一个强大的社区围绕着它发展，它已经被整个<a class="ae jc" href="https://facebook.github.io/react-native/showcase.html" rel="noopener ugc nofollow" target="_blank">行业</a>的公司整合。我们决定认真研究一下在Pinterest使用这项技术的商业案例。</p><p id="814b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们从旅程本身中学到了很多。在接下来的两节中，我们将从技术和组织的角度分享我们开发的评估流程，并讨论我们为Pinterest找到的特别优势。请继续阅读，了解支持React Native的最终判决。</p><h1 id="ff6d" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated"><strong class="ak">技术评估流程</strong></h1><p id="3e9e" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">技术评估分为两个阶段:</p><ol class=""><li id="987b" class="kg kh hh ig b ih ii il im ip ki it kj ix kk jb kl km kn ko bi translated">内部评估</li><li id="402c" class="kg kh hh ig b ih kp il kq ip kr it ks ix kt jb kl km kn ko bi translated">收集真实世界的数据</li></ol><p id="d10c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第一阶段是内部评估，我们计划在两个平台上制作一个小型表面原型。我们进行了广泛的性能测试，并致力于减轻关键指标的影响，如应用启动时间。</p><p id="1883" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们原型化了一个范围小但影响大的表面——主题选择器视图。该视图在Pinners注册后显示给他们，是他们入职过程中的关键屏幕。屏幕也有很高的迭代需求，团队经常测试用户界面优化。</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div class="er es ku"><img src="../Images/8a6af761f6b5a6c1e2b7844fcf3a1b5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/0*CsO3FfRUAG2jiao7."/></div></figure><p id="44d3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">内部原型给了我们一个早期的迹象，共享代码确实为开发者速度带来了巨大的好处。通常，我们发现每个平台上的本机实现需要相同的时间，因为没有代码可以重用，并且客户工程师需要花时间在技术细节和边缘案例上共享上下文。使用React Native，iOS的初始实施耗时约10天，包括引导所有集成到我们现有的基础架构中。然后，我们能够在两天内将屏幕移植到Android平台上，平台之间100%共享UI代码，节省了一周多的实现时间。展望未来，我们预计更多功能可以更快构建，因为基础设施基础已经到位。</p><p id="b49a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在尽可能多地从内部分析了这个特性之后，是时候在野外进行测试了。我们首先在每个平台上做了一个仔细监控的发布，只有框架(没有功能代码)来评估对二进制文件大小和安装速度的影响。在确定对安装的影响最小后，我们在每个平台上运行了一个A/B实验，使用完全相同的UI设计和功能，只比较底层的本机实现和反应本机实现。我们跟踪了绩效和参与数据，以了解新框架是否对用户行为产生了影响。</p><p id="fc37" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">尽管<a class="ae jc" href="https://news.ycombinator.com/item?id=13568381" rel="noopener ugc nofollow" target="_blank">被警告Android </a>上的 <a class="ae jc" href="https://blog.discordapp.com/using-react-native-one-year-later-91fd5e949933" rel="noopener ugc nofollow" target="_blank">性能问题，但我们的内部测试显示，React Native的性能与Native一样好。实验结果也支持这一发现，性能和关键指标没有下降。主题选择器功能的参与度持平或略有上升，这让我们有信心继续探索React Native在Pinterest的功能。</a></p><h1 id="5b09" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated"><strong class="ak">组织评估流程</strong></h1><p id="88be" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">我们在Pinterest的核心原则之一是“编织”我们相信，当来自不同团队和学科的个人一起合作时，最好的产品就会被制造出来。从一开始，评估团队就由代表增长、核心产品和平台团队的工程师组成。此外，在整个技术评估过程中，我们通过与团队领导和高级移动工程师会面来讨论他们关注的问题并收集宝贵的见解，从而收集关于React Native的内部反馈。</p><p id="3475" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在一次公司黑客马拉松中，我们邀请了对React Native感兴趣的工程师，他们给了我们关于开发者体验和平台支持需求的实际反馈。我们特别征求了那些想尝试开发移动功能的web工程师的反馈。这只是我们收集的众多有用数据中的一个:</p><blockquote class="lc"><p id="1f6e" class="ld le hh bd lf lg lh li lj lk ll jb dx translated">“我很乐意看到React Native在Pinterest成长，并获得更多功能。它有很大的潜力在一些原型上迭代。在网络方面工作，很容易上手。” — Pinterest网站工程师</p></blockquote><p id="33cd" class="pw-post-body-paragraph ie if hh ig b ih ln ij ik il lo in io ip lp ir is it lq iv iw ix lr iz ja jb ha bi translated">根据内部反馈，我们看到了进一步拉近我们平台之间距离的机会。Pinterest web应用程序使用<a class="ae jc" href="https://github.com/pinterest/gestalt" rel="noopener ugc nofollow" target="_blank"> Gestalt </a>，这是我们的一组开源React UI组件，符合Pinterest设计语言。因为React Native共享相同的React范式，所以我们可以通过构建共享相同完形API的React Native组件，使web工程师更容易实现移动特性。我们还确保使用与Pinterest web应用程序相同的工具和测试框架，这样我们就可以在公司现有知识的基础上进行构建。</p><p id="3a9f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，我们通过联系其他公司从事React Native的工程师，利用了这个强大的社区。他们的经历是很好的案例研究，说明我们应该如何处理采用流程，并帮助我们了解如何在Pinterest内发展和支持React本地社区。</p><h1 id="159c" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated"><strong class="ak">React Native的好处</strong></h1><p id="3132" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">在整个评估过程中，我们对React Native在Pinterest的工作方式有了清晰的认识。在原生移动平台上编写JavaScript并做出反应的能力有许多理论上的积极因素，但是这些表现比我们现有的工程能力更好吗？</p><p id="6f5b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对我们来说，最大的潜在好处是开发速度的提高。React Native使我们能够在平台之间共享代码。代码共享不仅意味着可以节省实现时间，当您需要多个特定于平台的工程师处理同一个特性时，它还可以减少共享上下文的认知开销。换句话说，站立和<a class="ae jc" rel="noopener" href="/@Pinterest_Engineering/three-day-no-meeting-schedule-for-engineers-fca9f857a567">会议</a>所需的时间更少，平台之间的不一致性也更少。</p><p id="d4d7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们对潜在的速度增益感到兴奋，因为React Native允许我们创建一个感觉完全本机的UI，所以不会为了迭代速度而牺牲用户体验。此外，由于代码共享的速度优势是主要动机，我们得出结论，如果我们不能在iOS和Android上集成该技术，我们不会采用React Native。</p><p id="d167" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果该技术在任何一个平台上的性能都有所下降，那么它将会成为一个阻碍因素。我们知道React Native不是专门为滚动视图的高性能而构建的。这尤其令人担忧，因为性能对于Pinterest至关重要，尤其是对于我们标志性的图像网格。2016年，我们<a class="ae jc" rel="noopener" href="/@Pinterest_Engineering/re-architecting-pinterest-039-s-ios-app-e0a2d34a6ac2">重新架构了我们的iOS应用</a>，使用异步UI渲染，以实现高响应性和滚动流畅度。React Native不太可能击败我们现有的优化系统。在没有高度优化的性能需求的屏幕上，在React Native中构建最有意义。</p><p id="8a89" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">React Native的一些采用者发现<a class="ae jc" href="https://github.com/Microsoft/react-native-code-push" rel="noopener ugc nofollow" target="_blank">代码推送</a>极大地提高了速度，这是一种从服务器动态更新UI代码的能力，但我们认为这对于我们最初的采用来说是不必要的。我们的Android团队已经每周发布新的应用程序版本，我们最近在iOS上切换到相同的一周发布周期。我们可能最终会通过使用代码推送来加快部署时间，但并不认为它是工程能力中阶跃函数改进的主要驱动力。</p><h1 id="5fc8" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated"><strong class="ak">决定:支持React Native </strong></h1><p id="81b0" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">基于我们发现的Pinterest的优势，我们明确将React Native作为我们工程工具箱中的一个额外工具，与我们在iOS和Android上现有的原生代码功能一起使用。转变成一个完全反应的本地应用程序并不是最终目标。相反，我们专注于为特性团队确定具体的用例，以及采用React Native会产生的实际成本。</p><p id="f5dd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">去年年底，我们成功完成了评估阶段，现在在我们的iOS和Android应用程序中支持React Native。React Native版本的主题选择器视图是100%交付的。</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="er es lt"><img src="../Images/0a67665b7385e9a6ba6921afa282c567.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5VHx3TLcIHx98GYY."/></div></div></figure><p id="1f40" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们最近还在React Native中构建了我们的业务注册流程。展望未来，我们将探索更多使用React Native的界面，并发展和扩展我们在Pinterest的React Native基础。</p><p id="9192" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在未来的博客文章中，我们将概述我们在最初采用时面临的具体技术挑战，以及我们如何解决这些问题。如果你对我们正在做的工作感到兴奋，<a class="ae jc" href="https://careers.pinterest.com/careers/engineering" rel="noopener ugc nofollow" target="_blank">加入我们</a>！</p><p id="76e2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="ls">鸣谢:React Native evaluation and integration是文晏、Michael Schneider和Thorben Primke的合作成果。商业签约由李瑱、沙鲁兹·塔瓦科利、瑞恩·施和蒂芙尼·布莱克创建。特别感谢Shana Hu，Zachary Westlake，Chris Lloyd，Garrett Moon，Rahul Malik，Brandon Kase，Dom Bhuphaibool，，Jon Parise和Bill Kunz。</em></p></div></div>    
</body>
</html>