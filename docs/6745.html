<html>
<head>
<title>Qlik - Optimized Load with where clause and date</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有where子句和日期的Qlik优化装载</h1>
<blockquote>原文：<a href="https://medium.com/quick-code/qlik-optimized-load-with-where-clause-and-date-43be30c909c0?source=collection_archive---------0-----------------------#2019-11-22">https://medium.com/quick-code/qlik-optimized-load-with-where-clause-and-date-43be30c909c0?source=collection_archive---------0-----------------------#2019-11-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/7114d5e338acad3fb56286f13cfe662a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3qiH_F0w_5dF3AF2yr1VYw.jpeg"/></div></div></figure><p id="712f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">经常需要部分加载一个巨大的QVD，它包含了你活着的时候的历史数据。</p><p id="f9ef" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">玩笑归玩笑，有一种奇妙的方法可以做到这一点，而无需编写大量代码，并且负载得到优化。</p><p id="b4bc" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">假设您有一个2017年的历史QVD，其中包含5亿条记录。因此，不使用Where date _ field &gt; = ' 2017–05–01 '，您可以创建一个表，该表将为您自动生成日期范围，然后您可以使用Where EXISTS加载您的QVD，然后<em class="jn">瞧，</em>您将获得优化的加载，从而节省服务器资源并大大减少重新加载时间。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="4363" class="jx jy hh jt b fi jz ka l kb kc">LET vDateMin = AddMonths(Today())-60; //5 Years from now<br/>LET vDateMax = Today();</span><span id="0048" class="jx jy hh jt b fi kd ka l kb kc">TMP_DATE_TABLE:<br/>LOAD<br/> Date(Date(‘$(vDateMin)’)+IterNo()-1) as Sales_Date<br/> AutoGenerate(1)<br/> While Date(Date(‘$(vDateMin)’)+IterNo()-1) &lt;= Date(‘$(vDateMax)’); <br/> <br/>Sales:<br/>LOAD <br/> Sales_ID,<br/> Product_ID<br/> Price,<br/> UnitPrice,<br/> Discount<br/> Sales_Date</span><span id="6792" class="jx jy hh jt b fi kd ka l kb kc">FROM Sales.qvd (qvd) <br/>WHERE EXISTS Sales_Date;</span><span id="014d" class="jx jy hh jt b fi kd ka l kb kc">Drop Table TMP_DATE_TABLE;</span></pre><p id="ac86" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您不知道您的QVD的最大日期，有一种更简单的方法可以找到答案:</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="043c" class="jx jy hh jt b fi jz ka l kb kc">//Optimized load<br/>TMP_INV_DATE: <br/>Load INV_DATE <br/>FROM invoice_data.qvd (qvd);</span><span id="d6b6" class="jx jy hh jt b fi kd ka l kb kc">TMP_MAXINV_DATE:<br/>//preceding load<br/>Load Max(INV_DATE) as maxinvdate;<br/>;<br/>Load FieldValue(‘INV_DATE’,IterNo()) as INV_DATE<br/>AutoGenerate(1)<br/>While not Isnull(FieldValue(‘INV_DATE’,IterNo()));</span><span id="3ccd" class="jx jy hh jt b fi kd ka l kb kc">Let var_maxinvdate = Peek(‘maxinvdate’,-1,’TMP_MAXINV_DATE’);</span><span id="0409" class="jx jy hh jt b fi kd ka l kb kc">Drop tables TMP_INV_DATE, TMP_MAXINV_DATE; //not needed</span></pre><p id="f274" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我希望你们喜欢这些漂亮的把戏！敬请关注后续文章。</p></div></div>    
</body>
</html>