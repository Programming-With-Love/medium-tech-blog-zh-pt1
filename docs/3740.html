<html>
<head>
<title>From Black Duck to Grafana</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从黑鸭到格拉夫纳</h1>
<blockquote>原文：<a href="https://medium.com/globant/from-black-duck-to-grafana-529bc83e4de6?source=collection_archive---------1-----------------------#2021-08-31">https://medium.com/globant/from-black-duck-to-grafana-529bc83e4de6?source=collection_archive---------1-----------------------#2021-08-31</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="19b0" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">介绍</h1><p id="f62b" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">Black Duck是一个用于管理安全性、许可证合规性和代码质量风险的解决方案，这些风险来自于在应用程序和容器中使用开源。</p><p id="ebae" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">它有一个很好的web界面，很酷的工具，很容易与CI系统集成，但是它缺少一个重要的东西:被扫描项目的漏洞演化历史。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kf"><img src="../Images/b341835d890f0b0bbf89aa7dac9463e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xSbdfqzqGtT5Wtgsrmz9xQ.png"/></div></div></figure><p id="4b13" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">Grafana可以用我们的方式来帮助我们实现这一点，使用以下3个步骤，您也可以在您的环境中复制它。</p><p id="3795" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">本文将描述如何使用Grafana完成漏洞故事。</p><h1 id="a485" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">本文涵盖了以下几点:</h1><p id="eb7c" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">如果你想简化这个过程，我建议在你的环境中安装docker。在我们的例子中，我们将使用Windows机器来实现这一点，但是对于其他操作系统来说，这个过程几乎是相同的。</p><ol class=""><li id="96fe" class="kr ks hh je b jf ka jj kb jn kt jr ku jv kv jz kw kx ky kz bi translated"><strong class="je hi">黑鸭子</strong>:把黑鸭子的扫描结果放到易于解析和使用的地方。在我们的例子中是CSV格式。</li><li id="532c" class="kr ks hh je b jf la jj lb jn lc jr ld jv le jz kw kx ky kz bi translated"><strong class="je hi">弹性搜索</strong>:将这些结果安装并导入到弹性搜索实例中。</li><li id="6e43" class="kr ks hh je b jf la jj lb jn lc jr ld jv le jz kw kx ky kz bi translated"><strong class="je hi"> Grafana </strong>:安装Grafana，使用弹性搜索里面存储的数据生成想要的图形。</li><li id="b94e" class="kr ks hh je b jf la jj lb jn lc jr ld jv le jz kw kx ky kz bi translated"><strong class="je hi">参考文献</strong></li></ol><h1 id="6a02" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak">第一部分:黑鸭子</strong></h1><p id="edf7" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">在这个github存储库中，您可以找到将黑鸭扫描结果导出为CSV格式的python代码。</p><p id="1cac" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">在使用它之前，请转到黑鸭web界面-&gt;“我的访问令牌”并生成一个具有“读写访问权限”的新令牌。</p><p id="9a1d" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">克隆以下github库:<a class="ae lf" href="https://github.com/ciorceri/BlackDuckReporting" rel="noopener ugc nofollow" target="_blank">https://github.com/ciorceri/BlackDuckReporting</a></p><p id="66de" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">按照README.md中的说明设置环境。</p><p id="8e8d" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">工具的使用:</p><pre class="kg kh ki kj fd lg lh li lj aw lk bi"><span id="476a" class="ll if hh lh b fi lm ln l lo lp">usage: main.py [-h] -b BASEURL -t TOKEN [-v VERSION] <br/>               [-f FILTERPROJECT]</span><span id="24ba" class="ll if hh lh b fi lq ln l lo lp">BlackDuck reporting</span><span id="fd58" class="ll if hh lh b fi lq ln l lo lp">optional arguments:<br/>  -h, --help            show this help message and exit<br/>  -b BASEURL, --baseurl BASEURL<br/>                        Url to BlackDuck server<br/>  -t TOKEN, --token TOKEN<br/>                        Token used to connect to BlackDuck server<br/>  -f FILTERPROJECT, --filterproject FILTERPROJECT<br/>                        Filter project names<br/>  -v VERSION, --version VERSION<br/>                        Project version to scan</span></pre><p id="e7bd" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi"> -b </strong> / <strong class="je hi"> - baseurl </strong>和<strong class="je hi"> -t </strong> / <strong class="je hi"> - token </strong>参数是必需的，并且必须用BlackDuck基本url填充，其格式可以是“https://your _ name . app . black duck . com ”,并且token是BASE64字符串。</p><p id="f54e" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">使用<strong class="je hi">-f</strong>/<strong class="je hi">-filter project</strong>参数，您可以过滤将要生成报告的项目。如果未提供，则将所有项目添加到报告中。</p><p id="af68" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi"> -v </strong> / <strong class="je hi"> - version </strong>是一个可选参数，仅过滤指定版本的扫描。如果在扫描时没有指定版本，默认情况下BlackDuck将使用git标签/分支名称来检测版本。在我的例子中，默认版本是‘master’(与被扫描的存储库的分支名称相同)</p><p id="6477" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">报告的输出在<strong class="je hi">中。csv格式</strong>很容易解析，以后可以用它进行弹性搜索。</p><h1 id="a718" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak">第2部分:弹性搜索安装</strong></h1><p id="7e2e" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">为了测试Elastic Search是否已安装并运行，我建议使用本指南安装ElasticHQ(或任何其他类似的工具):<a class="ae lf" href="http://docs.elastichq.org/installation.html#running-with-docker" rel="noopener ugc nofollow" target="_blank">http://docs . Elastic HQ . org/installation . html # running-with-docker</a>。</p><p id="1c01" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">ElasticHQ是一个监控和管理Elasticsearch集群的平台。</p><p id="6192" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">打开ElasticHQ web ui，连接到您的弹性搜索实例。</p><p id="a592" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">注意:您不能使用“localhost:9200”进行连接，因为使用您的路由器为您的机器分配的IP地址。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es lr"><img src="../Images/91cfbcd3f26f3a9ee823ca03f260119e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DYioahNp_ma1OCHUofKVfg.png"/></div></div></figure><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es lr"><img src="../Images/f389dcb88d6ad69a902fca63de6ddc49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eWLiminPAe0K5kDrW2GQ5w.png"/></div></div></figure><p id="67bd" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">我们可以看到，我们有一个节点和一个索引，名为<strong class="je hi">。橡皮筋</strong>。</p><p id="5368" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">要将黑鸭扫描结果导入弹性搜索，我们必须运行一个简单的Python 3脚本</p><pre class="kg kh ki kj fd lg lh li lj aw lk bi"><span id="8177" class="ll if hh lh b fi lm ln l lo lp">import csv<br/>from elasticsearch import Elasticsearch, helpers</span><span id="6cce" class="ll if hh lh b fi lq ln l lo lp">def main():<br/>    es = Elasticsearch([{'host': 'localhost', 'port': 9200}])<br/>    with open('black_duck_nodegoat_scan.csv') as f:<br/>        reader = csv.DictReader(f)<br/>        helpers.bulk(es, reader, index='nodegoat')</span><span id="94c7" class="ll if hh lh b fi lq ln l lo lp">if __name__ == '__main__':<br/>main()</span></pre><p id="d561" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">导入后，一个名为“nodegoat”的新索引出现在ElasticHQ界面中。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es lr"><img src="../Images/79f67b305c1ed0b990ba2ae99adbdb6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cB0RD3sAocSCsnDtxZybNQ.png"/></div></div></figure><p id="5bca" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">我们都很好，扫描结果被上传到弹性搜索，剩下的就是使用Grafana内部的这些数据。</p><h1 id="148b" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak">第三部分:Grafana安装</strong></h1><p id="1141" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">使用什么样的图片并不重要，在我们的例子中，我使用的是Ubuntu。</p><p id="f1c4" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">打开Grafana web界面:<a class="ae lf" href="http://127.0.0.1:3000" rel="noopener ugc nofollow" target="_blank"> http://127.0.0.1:3000 </a> /使用admin:admin登录并转到配置- &gt;数据源</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es lr"><img src="../Images/11690e84f78a7bff1a28b6d95f7b083d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OT3FKelp7bS5IxTvPjdOTg.png"/></div></div></figure><p id="aebd" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">并添加了“弹性搜索”数据源。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es lr"><img src="../Images/f5c9dd01d6586ad7bd1004fc19a0b9e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ljK6Vv15p3lzPNSZErbniA.png"/></div></div></figure><p id="87d8" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">更改配置:</p><pre class="kg kh ki kj fd lg lh li lj aw lk bi"><span id="edc1" class="ll if hh lh b fi lm ln l lo lp">HTTP -&gt; URL : <a class="ae lf" href="http://localhost:9200" rel="noopener ugc nofollow" target="_blank">http://10.18.21.47:9200</a> (use your IP Address assigned to your machine by your router)<br/>Elasticsearch details -&gt; Index name : nodegoat<br/>Elasticsearch details -&gt; Pattern : Daily/Weekly<br/>Elasticsearch details -&gt; Time field name : Timestamp<br/>Elasticsearch details -&gt; Version : 7.0+</span></pre><p id="d22c" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">Grafana -&gt; Create -&gt; Dashboard，使用Lucene查询语言定制Grafana仪表盘。下面是几个例子:</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es ls"><img src="../Images/9fd2ca3d75d077109577212234059829.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TIUfqFswfgeVCD3WcyFifQ.png"/></div></div></figure><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es ls"><img src="../Images/b380e25ad0d44239c80ddd06e4944078.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D2zlQRv0FNVJ69vXA9yvpg.png"/></div></div></figure><p id="4134" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">配置Grafana Dashboard后，您应该有一些包含过去数据的图表，如下所示:</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es lt"><img src="../Images/66f457020966dc112ed5466abce8c7ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Dg8raKdhJZ4ikUc0qN7ZOA.png"/></div></div></figure><h1 id="6e09" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">第4部分:参考</h1><p id="efd0" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">Grafana官方指南:<a class="ae lf" href="https://grafana.com/docs/grafana/latest/installation/docker/" rel="noopener ugc nofollow" target="_blank">https://grafana . com/docs/grafana/latest/installation/docker/</a></p><p id="dac7" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">弹性官方指南:<a class="ae lf" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html" rel="noopener ugc nofollow" target="_blank">https://www . elastic . co/guide/en/elastic search/reference/current/docker . html</a></p><p id="06a6" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><a class="ae lf" href="https://www.globant.com/studio/cybersecurity" rel="noopener ugc nofollow" target="_blank">全球网络安全</a></p></div></div>    
</body>
</html>