<html>
<head>
<title>Deep Links Crash Course : Part 3 Troubleshooting Your Deep Links</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">深层链接速成班:第3部分深层链接故障排除</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/deep-links-crash-course-part-3-troubleshooting-your-deep-links-61329fecb93?source=collection_archive---------0-----------------------#2022-09-16">https://medium.com/androiddevelopers/deep-links-crash-course-part-3-troubleshooting-your-deep-links-61329fecb93?source=collection_archive---------0-----------------------#2022-09-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/2028a332d052aeed0b257d7479450448.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IsRqP0Fe9I6YLxrJybIG6Q.png"/></div></div></figure><h1 id="99ef" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">介绍</h1><p id="c486" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">当你的Android应用程序链接不按你想要的方式工作时，你会怎么做？Google提供了许多工具来帮助您，例如<a class="ae kl" href="https://play.google.com/console/about/deeplinks/" rel="noopener ugc nofollow" target="_blank"> Play Console深层链接</a>页面，它为您提供了一个查看和解决许多应用程序链接常见问题的单一位置。在Play控制台中收到问题通知后，您可以按照以下步骤调试您的Android应用程序链接。这篇博文将带您使用adb调试应用程序中的深层链接，使用curl检查您的数字资产链接文件，并演示如何在设备上处理用户体验。</p><p id="a2ae" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">让我们启动终端。我们正在运行adb命令！</p><h1 id="e5d4" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">症状1:链接从不工作</h1><p id="9d97" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">如果用户点击链接，而他们没有在你的应用程序中打开，那么你的意图过滤器可能有问题。您可以使用命令<code class="du kr ks kt ku b"><a class="ae kl" href="https://developer.android.com/training/app-links/deep-linking#testing-filters" rel="noopener ugc nofollow" target="_blank">adb shell am start</a></code>和一个<a class="ae kl" href="https://developer.android.com/reference/android/content/Intent#ACTION_VIEW" rel="noopener ugc nofollow" target="_blank">视图</a>动作、一个深度链接的URL和包id来测试您的意图过滤器。这将检查应用程序是否可以处理显式发送给它的深层链接。</p><figure class="kv kw kx ky fd ii"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="96b8" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">如果应用程序的意图过滤器配置正确，这个命令应该可以打开应用程序。但是，如果您看到如下所示的错误，您应该检查<code class="du kr ks kt ku b">AndroidManifest.xml</code>文件并仔细检查它的配置。</p><pre class="kv kw kx ky fd lb ku lc ld aw le bi"><span id="9b25" class="lf iq hh ku b fi lg lh l li lj">Error: Activity not started, unable to resolve Intent { act=android.intent.action.VIEW dat=https://droidfood.example.com/... flg=0x10000000 pkg=com.example.droidfood }</span></pre><p id="8e0f" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">在Android应用的<code class="du kr ks kt ku b">AndroidManifest.xml</code>文件中，Android应用链接被声明为<code class="du kr ks kt ku b">intent-filter</code>元素。当它们被正确配置后，Android应用程序将成为匹配意图过滤参数的链接的默认处理程序。</p><p id="b369" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">正确配置这些参数包括:</p><ul class=""><li id="49be" class="lk ll hh jp b jq km ju kn jy lm kc ln kg lo kk lp lq lr ls bi translated">将<code class="du kr ks kt ku b">intent-filter</code>元素的<code class="du kr ks kt ku b"><a class="ae kl" href="https://developer.android.com/reference/android/R.styleable#AndroidManifestIntentFilter_autoVerify" rel="noopener ugc nofollow" target="_blank">autoVerify</a></code>属性设置为<code class="du kr ks kt ku b">true</code></li><li id="a82c" class="lk ll hh jp b jq lt ju lu jy lv kc lw kg lx kk lp lq lr ls bi translated">将带有名称属性的<code class="du kr ks kt ku b">action</code>元素设置为<a class="ae kl" href="https://developer.android.com/reference/android/content/Intent#ACTION_VIEW" rel="noopener ugc nofollow" target="_blank">视图</a></li><li id="1a76" class="lk ll hh jp b jq lt ju lu jy lv kc lw kg lx kk lp lq lr ls bi translated">将name属性的<code class="du kr ks kt ku b">category</code>元素设置为<a class="ae kl" href="https://developer.android.com/reference/android/content/Intent#CATEGORY_BROWSABLE" rel="noopener ugc nofollow" target="_blank">可浏览</a></li><li id="6a6a" class="lk ll hh jp b jq lt ju lu jy lv kc lw kg lx kk lp lq lr ls bi translated">将具有名称属性的第二个<code class="du kr ks kt ku b">category</code>元素设置为<a class="ae kl" href="https://developer.android.com/reference/android/content/Intent#CATEGORY_DEFAULT" rel="noopener ugc nofollow" target="_blank">默认值</a></li><li id="ec12" class="lk ll hh jp b jq lt ju lu jy lv kc lw kg lx kk lp lq lr ls bi translated">包括至少一个方案属性为“HTTP”或“HTTPS”的<code class="du kr ks kt ku b">data</code>元素</li><li id="05a6" class="lk ll hh jp b jq lt ju lu jy lv kc lw kg lx kk lp lq lr ls bi translated">包括一个带有“<code class="du kr ks kt ku b">host</code>”属性的数据元素，该属性设置为您托管深层链接的域</li><li id="80de" class="lk ll hh jp b jq lt ju lu jy lv kc lw kg lx kk lp lq lr ls bi translated">具有自定义方案的<code class="du kr ks kt ku b">no data</code>元素</li></ul><p id="2121" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">例如，下面是一个正确配置的意图过滤器，用于处理与<a class="ae kl" href="https://food.example.com" rel="noopener ugc nofollow" target="_blank">https://droidfood.example.com</a>匹配的深层链接:</p><figure class="kv kw kx ky fd ii"><div class="bz dy l di"><div class="kz la l"/></div></figure><figure class="kv kw kx ky fd ii er es paragraph-image"><div class="er es ly"><img src="../Images/edf821caac61ea360470c1f35e9c8262.png" data-original-src="https://miro.medium.com/v2/resize:fit:484/format:webp/1*bYN4dnEE0Nu4cTmy-Rak0Q.png"/></div></figure><p id="496f" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">一旦正确配置了应用程序的意图过滤器，重新运行adb命令并确保应用程序正确打开。</p><figure class="kv kw kx ky fd ii"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="cfa2" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">一旦出现这种情况，请在没有显式包名“com.example.droidfood”的情况下再次尝试该命令。这测试了Android可以正确地打开带有链接的应用程序。</p><figure class="kv kw kx ky fd ii"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="cb21" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">如果应用程序打开，那么你已经解决了问题！如下图所示，如果系统web浏览器打开了链接，您还需要做更多的调试工作。</p><figure class="kv kw kx ky fd ii er es paragraph-image"><div class="er es lz"><img src="../Images/ad3c47ee5d2edc4775088d59c2b98fff.png" data-original-src="https://miro.medium.com/v2/resize:fit:544/format:webp/1*IwbzUVplp8SxvGMGVbJliQ.png"/></div></figure><h1 id="ae3b" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">症状2:链接在浏览器中打开(但使用ADB)</h1><p id="482d" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">系统web浏览器已经处理了该链接。Android 12中引入的下面两个命令应该有助于诊断发生了什么:。</p><ul class=""><li id="4021" class="lk ll hh jp b jq km ju kn jy lm kc ln kg lo kk lp lq lr ls bi translated"><code class="du kr ks kt ku b">adb shell pm verify-app-links -- re-verify</code>强制Android操作系统<a class="ae kl" href="https://developer.android.com/training/app-links/verify-site-associations" rel="noopener ugc nofollow" target="_blank">验证应用程序和web主机之间的站点关联</a>。这是一个异步命令，可能需要几分钟才能完成。</li><li id="c4c0" class="lk ll hh jp b jq lt ju lu jy lv kc lw kg lx kk lp lq lr ls bi translated"><code class="du kr ks kt ku b">adb shell pm get-app-links</code>列出清单中声明的Android应用链接及其验证状态。</li></ul><p id="c9b5" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">在Android中，HTTP链接必须经过验证，应用程序才能成为深度链接的默认处理程序。这两个命令都将应用程序的包名作为参数。为应用程序运行这些命令会得到以下结果:</p><figure class="kv kw kx ky fd ii"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="2834" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">链接是安卓应用链接；然而，它们不是“经过验证的”Android应用程序链接，该应用程序不会成为droidfood.example.com主机链接的默认处理程序。Android开发者文档提供了<a class="ae kl" href="https://developer.android.com/training/app-links/verify-site-associations#review-results" rel="noopener ugc nofollow" target="_blank">验证结果</a>的完整列表以及如何解释它们。</p><p id="9fcb" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">Android使用<a class="ae kl" href="https://developers.google.com/digital-asset-links" rel="noopener ugc nofollow" target="_blank">数字资产链接API </a>在网络域和应用程序之间建立信任。实际上，这意味着AndroidManifest.xml中应用程序的一组<code class="du kr ks kt ku b">intent-filter</code>元素中的每个主机都服务于/ <code class="du kr ks kt ku b">.well-known</code> /路径中的assetlinks.json文件。</p><p id="0bbe" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">assetlinks.json文件通过提供以下信息来建立信任:</p><ul class=""><li id="e74e" class="lk ll hh jp b jq km ju kn jy lm kc ln kg lo kk lp lq lr ls bi translated">Android应用程序的包名</li><li id="daf4" class="lk ll hh jp b jq lt ju lu jy lv kc lw kg lx kk lp lq lr ls bi translated">标识应用程序的签名密钥证书指纹的数组</li><li id="2d3f" class="lk ll hh jp b jq lt ju lu jy lv kc lw kg lx kk lp lq lr ls bi translated">应用程序签名密钥证书指纹必须与该数组中的指纹相匹配</li></ul><p id="2ad8" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated"><code class="du kr ks kt ku b">curl</code>命令可以很容易地从主机获取文件，并可以用来检查文件的内容。</p><figure class="kv kw kx ky fd ii"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="34f1" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">此外，文件的托管必须满足几个标准:</p><ul class=""><li id="dcb8" class="lk ll hh jp b jq km ju kn jy lm kc ln kg lo kk lp lq lr ls bi translated">assetlinks.json必须公开提供，不能在身份验证或VPN之后</li><li id="0f07" class="lk ll hh jp b jq lt ju lu jy lv kc lw kg lx kk lp lq lr ls bi translated">主机必须使用安全的HTTPS连接来提供文件</li><li id="6e1e" class="lk ll hh jp b jq lt ju lu jy lv kc lw kg lx kk lp lq lr ls bi translated">重定向不能用于访问assetlinks.json</li><li id="e0bd" class="lk ll hh jp b jq lt ju lu jy lv kc lw kg lx kk lp lq lr ls bi translated">文件的<code class="du kr ks kt ku b">Content-Type</code> HTTP头必须是<code class="du kr ks kt ku b">application/json</code></li></ul><p id="4709" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated"><code class="du kr ks kt ku b">curl</code>也可用于检查文件是否被正确托管。应该使用<code class="du kr ks kt ku b">-i</code>选项来打印HTTP头，可以检查其正确性</p><figure class="kv kw kx ky fd ii"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="9cbb" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">assetlinks.json文件似乎被正确托管，内容看起来一目了然。有几项检查可以缩小可能导致链路故障的问题范围。如果文件没有正确托管，请查看“第3节:诊断其他问题”以了解更多信息。</p><h1 id="125a" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">确认我们的签名密钥</h1><p id="14f3" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated"><a class="ae kl" href="https://food.example.com" rel="noopener ugc nofollow" target="_blank">https://</a><a class="ae kl" href="https://example.com/.well-known/assetlinks.json" rel="noopener ugc nofollow" target="_blank">droid</a><a class="ae kl" href="https://food.example.com" rel="noopener ugc nofollow" target="_blank">food.example.com</a>的assetlinks.json文件引用了证书指纹“4C:D7:E4:04:B8:54:04:A0:5F:50:35:38:CF:B6:89:3D:35:CE:54:C7:01:8E:ED:78:7A:50:9B:4A:2E:A8:BE:B4”。</p><p id="879f" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">在Android应用程序的开发生命周期中，许多密钥用于对应用程序进行签名。一个常见的错误来源是在Play Store中签署APK时使用的密钥与assetlinks.json文件中引用的密钥不匹配。</p><blockquote class="ma mb mc"><p id="4c77" class="jn jo md jp b jq km js jt ju kn jw jx me ko ka kb mf kp ke kf mg kq ki kj kk ha bi translated">“如果您正在使用<a class="ae kl" href="https://support.google.com/googleplay/android-developer/answer/9842756" rel="noopener ugc nofollow" target="_blank"> Play App Signing </a>为您的应用程序签名，那么在本地运行keytool生成的证书指纹通常不会与用户设备上的指纹相匹配。您可以在<strong class="jp hi">发布&gt;设置&gt;应用完整性</strong>下的<a class="ae kl" href="https://play.google.com/console/" rel="noopener ugc nofollow" target="_blank"> Play Console </a>开发者账户中验证您是否在使用Play App Signing for your app如果你这样做了，那么你也会在同一个页面上为你的应用找到正确的数字资产链接JSON片段。"</p></blockquote><p id="01da" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">命令<code class="du kr ks kt ku b">adb shell pm get-app-links</code>显示Android用来验证链接的证书指纹，这可以与assetlinks.json中使用的证书进行比较:</p><figure class="kv kw kx ky fd ii"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="58fd" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">在这个例子中，指纹不匹配。要修复该错误，请将正确的指纹需求应用到assetlinks.json文件。要测试修复，请使用adb命令重新验证链接:</p><figure class="kv kw kx ky fd ii"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="8e96" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">更新<code class="du kr ks kt ku b">assetlinks.json</code>文件中的证书指纹已修复该问题！现在，当您的应用程序接收到查看意图时，应该会打开应用程序而不是浏览器。这可以通过adb使用我们在第1节中使用的相同命令进行测试:</p><figure class="kv kw kx ky fd ii"><div class="bz dy l di"><div class="kz la l"/></div></figure><figure class="kv kw kx ky fd ii er es paragraph-image"><div class="er es lz"><img src="../Images/ad3c47ee5d2edc4775088d59c2b98fff.png" data-original-src="https://miro.medium.com/v2/resize:fit:544/format:webp/1*IwbzUVplp8SxvGMGVbJliQ.png"/></div></figure><p id="9313" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">有关密钥生成的更多信息，请参见developer.android.com上的“<a class="ae kl" href="https://developer.android.com/studio/publish/app-signing" rel="noopener ugc nofollow" target="_blank">签署您的应用</a>”。</p><h1 id="1f73" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">症状3:你的链接曾经可以工作，但是现在不行了</h1><p id="b52c" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">有许多不同的提供商、服务和服务器应用程序可能会托管<code class="du kr ks kt ku b">assetlinks.json</code>。此外，可能存在可能干扰链接验证的内容传递网络或其他类似服务。接下来的几节将展示如何检测这些故障，但不研究如何解决它们。这项任务更适合主机运营团队，而不是Android应用开发者。</p><p id="ed2b" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">每个例子都使用了<code class="du kr ks kt ku b">curl</code>工具，并强调了在托管错误的情况下需要注意的输出。</p><h1 id="c60b" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">不正确托管的文件(使用重定向)</h1><figure class="kv kw kx ky fd ii"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="4c08" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">如上所示的301重定向将导致验证失败。当一个<code class="du kr ks kt ku b">assetlinks.json</code>文件被托管在一个有一个域的服务器上，但是应用程序的<code class="du kr ks kt ku b">intent-filter</code>处理一个不同的域时，通常会出现这种情况。例如，Android应用程序链接可能会处理“example.com”，但内容会重定向到“<a class="ae kl" href="https://example.com/.well-known/assetlinks.json" rel="noopener ugc nofollow" target="_blank">droid food</a><a class="ae kl" href="http://www.example.com" rel="noopener ugc nofollow" target="_blank">. example . com</a>”。</p><p id="c7dd" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">还有其他几种常见的重定向头也会阻止验证。IETF HTTP RFC 指定了可能遇到的其他3xx重定向。记住，<code class="du kr ks kt ku b">assetlinks.json</code>文件必须返回HTTP状态200才能成功验证。</p><h1 id="2ef4" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">失踪的HTTPS</h1><figure class="kv kw kx ky fd ii"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="5600" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">端口443是加密HTTPS通信的标准端口。上面的输出演示了加载<code class="du kr ks kt ku b">assetlinks.json</code>文件的失败，因为服务器没有使用HTTPS。如果使用未加密的HTTP协议，Android将不会验证链接。</p><h1 id="58ad" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">不正确的内容类型标题</h1><figure class="kv kw kx ky fd ii"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="d602" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">在上面的例子中，文件将<code class="du kr ks kt ku b">content-type</code>头设置为<code class="du kr ks kt ku b">text/plain</code>(明文)，而不是JSON。Android应用程序链接要求使用HTTP Content-Type头值<code class="du kr ks kt ku b">application/json</code>来提供<code class="du kr ks kt ku b">assetlinks.json</code>文件。</p><h1 id="37c5" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">私有assetlinks.json文件</h1><p id="aaf5" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated"><code class="du kr ks kt ku b">assetlinks.json</code>文件必须是公共的。开发、测试和调试通常在连接到办公室VPN时进行。这可能会造成一种情况，即在测试和调试期间，应用程序维护人员可以访问文件，但公众无法访问。要验证您的应用程序可以加载<code class="du kr ks kt ku b">assetlinks.json</code>文件，请使用没有VPN连接的公共网络。这些网络的示例包括:手机蜂窝网络、家庭连接和当地咖啡店的Wi-Fi网络。</p><h1 id="68e0" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">assetlinks.json文件丢失或放错位置</h1><p id="74fe" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">在<code class="du kr ks kt ku b">AndroidManifest.xml</code>文件中将<code class="du kr ks kt ku b">autoVerify</code>属性设置为<code class="du kr ks kt ku b">true</code>的意图过滤器所引用的每个主机也必须有一个<code class="du kr ks kt ku b">assetlinks.json</code>文件，该文件在该域和应用程序之间建立关联。此外，如果在意图过滤器元素中使用通配符，那么<code class="du kr ks kt ku b">assetlinks.json</code>文件必须在主机的顶级<code class="du kr ks kt ku b">/.well-known/</code>目录中可用。例如，如果<code class="du kr ks kt ku b">example.com</code>没有托管<code class="du kr ks kt ku b">assetlinks.json</code>文件，那么<code class="du kr ks kt ku b">*.example.com</code>将无法通过验证。</p><h1 id="67ff" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">其他服务器错误</h1><p id="0d99" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">我们展示了开发人员报告的常见问题。，检查您的服务器是否存在可能影响<code class="du kr ks kt ku b">assetlinks.json</code>验证的其他类型的意外行为</p><h1 id="4a6c" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">症状4:出现歧义消除对话框</h1><p id="8915" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">当Android系统无法确定哪个应用程序活动应该处理一个意图时，就会出现消除歧义对话框。即使在确认所有链接都有正确的意图过滤器，所有主机都有<code class="du kr ks kt ku b">assetlinks.json</code>文件，并且这些文件被正确托管后，消除歧义对话框可能会出现。本节描述了Android系统无法确定正确活动的常见情况。您可以使用这些信息来减少用户看到消除歧义对话框的次数。</p><figure class="kv kw kx ky fd ii er es paragraph-image"><div class="er es mh"><img src="../Images/9f77e9b46f905319d941ca2af7d06446.png" data-original-src="https://miro.medium.com/v2/resize:fit:486/format:webp/1*lq3YgLPXswVZGhr5nLcLiQ.png"/></div></figure><h1 id="8a82" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">意图冲突</h1><p id="3e63" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">下面的例子定义了两个活动:<code class="du kr ks kt ku b">DessertActivity</code>和<code class="du kr ks kt ku b">FoodActivity</code>。两者都处理深层链接“https://droid food . example . com/food/dessert ”,因为这个链接匹配它们的两个<code class="du kr ks kt ku b">pathPrefix</code>属性。</p><figure class="kv kw kx ky fd ii"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="617f" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">当一个应用程序中的多个活动为同一个链接定义意图过滤器时，会出现消除歧义对话框。意图过滤器不应该在不同的活动中重叠，如果这是应用程序的一个有意的特性，那么应该设置“activity”元素上的“label”属性来区分哪个活动将处理链接意图。</p><h1 id="f4b8" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">Android 12的变化</h1><p id="7936" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">在Android 12之前，如果你的应用中的<strong class="jp hi"> <em class="md">任何</em> </strong>链接验证失败，或者<strong class="jp hi"> <em class="md">所有意向过滤器</em> </strong>缺少<code class="du kr ks kt ku b">autoVerify=true</code>，那么这些Android应用链接会显示消歧对话框。然而，在Android 12中，这些链接将改为由默认的web浏览器处理(参见Android 12<a class="ae kl" href="https://developer.android.com/about/versions/12/behavior-changes-all#web-intent-resolution" rel="noopener ugc nofollow" target="_blank">Web intent resolution</a>行为变化)。为了避免早期版本Android上的歧义对话框，请确保您的所有Android应用程序链接都可以被验证，并从您的AndroidManifest.xml中删除测试意图过滤器。</p><h1 id="87de" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">其他应用程序处理相同的链接</h1><p id="89d9" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">有时，用户会安装第三方应用程序，该应用程序处理与另一个应用程序相同的链接。如果两个应用程序都使用匹配的自定义方案，则会出现消除歧义对话框。为了避免这种情况，使用带有<code class="du kr ks kt ku b">autoVerify=”true”</code>设置的web链接，并将<code class="du kr ks kt ku b">assetlinks.json</code>文件添加到每个托管Android应用链接的域中。</p><h1 id="de9b" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">用户选择了不同的默认应用程序</h1><p id="f963" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">用户可以选择让一个链接总是由一个特定的应用程序打开。您的应用程序可以检测到这一点，并显示一个教育用户界面，建议用户将自己与这些深层链接相关联。</p><p id="51a3" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">以下示例显示了如何检测包id为“com.example.droidfood”的应用程序是否是链接“https://droid food . example . com/about”的默认处理程序。</p><figure class="kv kw kx ky fd ii"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="1fc1" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">这段代码使用<a class="ae kl" href="https://developer.android.com/reference/android/content/pm/PackageManager" rel="noopener ugc nofollow" target="_blank"> PackageManager </a>来查找您期望处理的链接的默认处理程序。然后，代码将这个包名与我们的应用程序的包名进行比较。如果名称匹配，那么用户已经选择了我们的应用程序来处理“【https://droidfood.example.com/about】”域名的安卓应用程序链接。否则，用户会更改他们的默认处理程序。</p><h1 id="8717" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">继续学习</h1><p id="f56c" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">这篇文章展示了如何检测和处理深层链接的常见错误。在未来，我们还将探索新的深度链接播放控制台，它为开发人员提供关于他们的深度链接性能和常见错误的实时反馈，就像本文中的那些。有许多UX设计模式和最佳实践——shell pm verify-app-links——重新验证我们在DAC中记录的内容，以帮助您将应用做到最好！</p><ul class=""><li id="2c8c" class="lk ll hh jp b jq km ju kn jy lm kc ln kg lo kk lp lq lr ls bi translated"><strong class="jp hi"> Part 1: </strong> <a class="ae kl" rel="noopener" href="/androiddevelopers/the-deep-links-crash-course-part-1-introduction-to-deep-links-2189e509e269">深度链接能做什么？</a></li><li id="2b84" class="lk ll hh jp b jq lt ju lu jy lv kc lw kg lx kk lp lq lr ls bi translated"><strong class="jp hi">第二部:</strong> <a class="ae kl" rel="noopener" href="/androiddevelopers/the-deep-links-crash-course-part2-deep-links-from-zero-to-hero-37f94cc8fb88">从零到英雄的深度链接</a></li><li id="b103" class="lk ll hh jp b jq lt ju lu jy lv kc lw kg lx kk lp lq lr ls bi translated"><strong class="jp hi">第三部分:</strong> <em class="md">克服挑战创建安卓应用链接</em></li><li id="8b3c" class="lk ll hh jp b jq lt ju lu jy lv kc lw kg lx kk lp lq lr ls bi translated"><strong class="jp hi">第4部分:</strong>为您的企业提供深层链接</li><li id="dcec" class="lk ll hh jp b jq lt ju lu jy lv kc lw kg lx kk lp lq lr ls bi translated"><a class="ae kl" href="https://developer.android.com/training/app-links/deep-linking" rel="noopener ugc nofollow" target="_blank">创建应用内容的深度链接| Android开发者</a></li><li id="6ed1" class="lk ll hh jp b jq lt ju lu jy lv kc lw kg lx kk lp lq lr ls bi translated"><a class="ae kl" href="https://play.google.com/console/about/deeplinks/" rel="noopener ugc nofollow" target="_blank"> Google Play控制台深度链接仪表盘</a></li><li id="b0ae" class="lk ll hh jp b jq lt ju lu jy lv kc lw kg lx kk lp lq lr ls bi translated"><a class="ae kl" href="https://developer.android.com/studio/command-line/adb" rel="noopener ugc nofollow" target="_blank">安卓调试桥</a></li></ul><p id="f0b8" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">链接愉快！</p></div></div>    
</body>
</html>