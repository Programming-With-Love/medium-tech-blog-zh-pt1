<html>
<head>
<title>Airflow on GCP (May 2020)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GCP的气流(2020年5月)</h1>
<blockquote>原文：<a href="https://medium.com/compendium/airflow-on-gcp-may-2020-cdcdfe594019?source=collection_archive---------0-----------------------#2020-05-15">https://medium.com/compendium/airflow-on-gcp-may-2020-cdcdfe594019?source=collection_archive---------0-----------------------#2020-05-15</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="30a9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是一个从头开始在谷歌云平台(GCP)虚拟机(VM)上安装Apache Airflow的完整指南。</p><p id="d7e9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">另一种方法是使用Google提供的管理版本Cloud Composer。</p><p id="fd9b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是我2019年4月发表的关于在GCP虚拟机上安装气流<a class="ae jc" rel="noopener" href="/grensesnittet/install-apache-airflow-on-a-google-cloud-platform-virtual-machine-f9a5b01b6c33">的帖子的更新版本。一年过去了，从那以后我学会了一些新的技巧。Airflow、Ubuntu、PostgreSQL和Python的新版本已经到来，我决定用谷歌的负载平衡器替换Nginx。</a></p><h1 id="1330" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">模块</h1><ul class=""><li id="d839" class="kb kc hh ig b ih kd il ke ip kf it kg ix kh jb ki kj kk kl bi translated">阿帕奇气流—版本1.10.10</li><li id="cb8d" class="kb kc hh ig b ih km il kn ip ko it kp ix kq jb ki kj kk kl bi translated">PostgreSQL 10 —托管云SQL版本</li><li id="9adf" class="kb kc hh ig b ih km il kn ip ko it kp ix kq jb ki kj kk kl bi translated">python 3.7—air flow使用的最新版本。</li><li id="6cb1" class="kb kc hh ig b ih km il kn ip ko it kp ix kq jb ki kj kk kl bi translated">Ubuntu 20.04</li><li id="7e30" class="kb kc hh ig b ih km il kn ip ko it kp ix kq jb ki kj kk kl bi translated">具有托管HTTPS证书的Google负载平衡器</li><li id="508b" class="kb kc hh ig b ih km il kn ip ko it kp ix kq jb ki kj kk kl bi translated">Systemd服务—自动启动</li></ul><h1 id="c423" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">体系结构</h1><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es kr"><img src="../Images/46c44bfed1e218e99df2dea71ad98a09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xVO3bfm78nF7hXtPtbumDw.png"/></div></div></figure><p id="1cac" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">系统的核心是VM，我们在上面安装气流。我们使用一个云SQL实例作为我们的数据库。</p><p id="c5b7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">负载平衡器仅用作HTTPS终结器，提供并自动更新证书。如果你更喜欢使用Nginx和Let's Encrypt，请参见<a class="ae jc" rel="noopener" href="/grensesnittet/install-apache-airflow-on-a-google-cloud-platform-virtual-machine-f9a5b01b6c33">在GCP虚拟机上安装气流(2019年4月)</a>。</p><p id="f6ef" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了能够将云负载平衡器与我们的虚拟机连接起来，虚拟机必须驻留在一个实例组中。您只能将GCP负载平衡器连接到实例组，而不能直接连接到特定的虚拟机。</p><h1 id="3f73" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">安装概述</h1><ol class=""><li id="46f8" class="kb kc hh ig b ih kd il ke ip kf it kg ix kh jb ld kj kk kl bi translated">网络设置(虚拟私有云)</li><li id="b8d5" class="kb kc hh ig b ih km il kn ip ko it kp ix kq jb ld kj kk kl bi translated">虚拟计算机</li><li id="71cc" class="kb kc hh ig b ih km il kn ip ko it kp ix kq jb ld kj kk kl bi translated">防火墙规则(允许ssh访问)</li><li id="4b98" class="kb kc hh ig b ih km il kn ip ko it kp ix kq jb ld kj kk kl bi translated">实例组</li><li id="36b1" class="kb kc hh ig b ih km il kn ip ko it kp ix kq jb ld kj kk kl bi translated">安装所需的软件包</li><li id="509a" class="kb kc hh ig b ih km il kn ip ko it kp ix kq jb ld kj kk kl bi translated">安装数据库(云SQL)</li><li id="6fb7" class="kb kc hh ig b ih km il kn ip ko it kp ix kq jb ld kj kk kl bi translated">配置气流</li><li id="c3fe" class="kb kc hh ig b ih km il kn ip ko it kp ix kq jb ld kj kk kl bi translated">自动启动</li><li id="b042" class="kb kc hh ig b ih km il kn ip ko it kp ix kq jb ld kj kk kl bi translated">静态IP地址</li><li id="dfda" class="kb kc hh ig b ih km il kn ip ko it kp ix kq jb ld kj kk kl bi translated">负载平衡器</li></ol></div><div class="ab cl le lf go lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ha hb hc hd he"><h1 id="661e" class="jd je hh bd jf jg ll ji jj jk lm jm jn jo ln jq jr js lo ju jv jw lp jy jz ka bi translated">网络安装程序</h1><p id="9848" class="pw-post-body-paragraph ie if hh ig b ih kd ij ik il ke in io ip lq ir is it lr iv iw ix ls iz ja jb ha bi translated">如果您已经有了自己的基础设施，或者只想使用默认网络，请跳过这一部分。</p><p id="7fec" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">设置新的虚拟私有云(网络)来隔离我们的虚拟机的原因。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es lt"><img src="../Images/8a3648de90331ce0f53a2831dfe8a45c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eKSlYHgqx_6RkylOeY7p8g.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx">Google Cloud Console — VPC network — Create VPC Network</figcaption></figure><p id="70d7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在GCP控制台中，选择VPC网络并+创建VPC网络。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es ly"><img src="../Images/ae118dbd6a04666f886dcb9e8dfe730a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-jSK3NxRO4_540TkMAnWdA.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx">Create a VPC network — Enter a name</figcaption></figure><p id="b101" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将你的新网络命名为<em class="lz">气流网络</em>。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div class="er es ma"><img src="../Images/fd5a8326cff13a44a0b587a85be542c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:972/format:webp/1*exkcUmYl8etwBT5mjW_sXw.png"/></div><figcaption class="lu lv et er es lw lx bd b be z dx">Create a VPC network — New subnet</figcaption></figure><p id="2d43" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我使用了名称<em class="lz">气流网络</em>和<em class="lz">气流子网</em>。名字并不重要，只要你以后能认出他们。</p><p id="d9a8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">选择一个靠近最终用户的地区。请注意，网络层有两种类型；标准和高级。标准针对成本和速度进行了优化。标准在某些地区不可用。参见<a class="ae jc" href="https://www.google.com/url?q=https://cloud.google.com/network-tiers/docs/overview&amp;sa=D&amp;ust=1589539163946000" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/network-tiers/docs/overview</a>。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div class="er es mb"><img src="../Images/ba7573e5c92fc1d3c5463694333c1fee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/1*1ZP6aXP7j7_dCQ6YNSE0tw.png"/></div><figcaption class="lu lv et er es lw lx bd b be z dx">The new airflow-network and airflow-subnet.</figcaption></figure></div><div class="ab cl le lf go lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ha hb hc hd he"><h1 id="b87b" class="jd je hh bd jf jg ll ji jj jk lm jm jn jo ln jq jr js lo ju jv jw lp jy jz ka bi translated">虚拟计算机</h1><p id="fe01" class="pw-post-body-paragraph ie if hh ig b ih kd ij ik il ke in io ip lq ir is it lr iv iw ix ls iz ja jb ha bi translated">使用以下设置，从“计算引擎”|“虚拟机实例”菜单创建新的虚拟机:</p><p id="29f4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">名称:air flow-VM<br/>Region/Zone:Europe-west 1/Europe-west 1-b(与您的网络相同的区域)<br/>机器类型:g1-small(如果您需要更大的，以后很容易更改)<br/>启动盘:Ubuntu 20.04 LTS最小映像<br/>磁盘大小:10 GB(您以后可以增加磁盘，但永远不会缩小)<br/>防火墙:允许HTTP流量(以后会更改)<br/>联网:选择airflow-network和airflow-subnet</p><div class="ks kt ku kv fd ab cb"><figure class="mc kw md me mf mg mh paragraph-image"><img src="../Images/159499a05f548f76f074dddd417e00e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*z_xvCq6Yj25S_wG27uInmA.png"/></figure><figure class="mc kw mi me mf mg mh paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><img src="../Images/c92b606e59b3b3cde1f73b072c8b5028.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*kbSgUpjb6Mr-bn2-iyt0Hg.png"/></div><figcaption class="lu lv et er es lw lx bd b be z dx mj di mk ml">Create an instance form</figcaption></figure></div></div><div class="ab cl le lf go lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ha hb hc hd he"><h1 id="abbf" class="jd je hh bd jf jg ll ji jj jk lm jm jn jo ln jq jr js lo ju jv jw lp jy jz ka bi translated">防火墙规则</h1><p id="bfc0" class="pw-post-body-paragraph ie if hh ig b ih kd ij ik il ke in io ip lq ir is it lr iv iw ix ls iz ja jb ha bi translated">对于管理和安装，我需要对新虚拟机的ssh访问。因为我们创建了自己的自定义VPC，所以我们需要添加一个防火墙规则来允许访问。</p><p id="ac92" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">选择“VPC网络”|“防火墙规则”|“创建防火墙规则”。</p><p id="378d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用:<br/>名称:allow-ssh-access <br/>网络:airflow-network <br/>目标:网络中的所有实例<br/>源IP-ranges:0 . 0 . 0/0(All)<br/>指定的协议和端口:tcp 22</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div class="er es mm"><img src="../Images/125a4161869a318931a944efae3f7ae7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*ccHghRQhFvtKvJzdFhuzvg.png"/></div></figure><p id="82b2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">点击“创建”按钮。您可以根据访问需要在以后禁用/启用此规则。</p><p id="4c45" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">计划是在TCP端口8080上提供气流。在设置和测试期间，我修改了现有的防火墙规则<em class="lz">airflow-network-allow-http</em>，并添加了端口8080。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div class="er es mn"><img src="../Images/3aea7ea6541fdd66d9db92c198ea6cbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1082/format:webp/1*mROks6YBEoM2fvTr2LTO3g.png"/></div><figcaption class="lu lv et er es lw lx bd b be z dx">Modify the existing firewall rule. Add TCP port 8080.</figcaption></figure><p id="3016" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建另一个防火墙规则，以允许流量从负载平衡器流向后端。负载平衡器的流量可能来自IP范围130.211.0.0/22和35.191.0.0/16中的地址。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div class="er es mo"><img src="../Images/a66afc2b15fc3c42ea881d2c187347d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1094/format:webp/1*_l9e_8-YKJ4Yzxjr-p-HCA.png"/></div></figure><p id="0541" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您应该以下列规则结束:</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es mp"><img src="../Images/aa2857fc030ff9f11c3f40aa7d52a8d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oaid3HynTgph4ymTsUkbOw.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx">Resulting firewall rules for the airflow-network.</figcaption></figure><p id="f70e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">目前，<em class="lz">airflow-network-allow-http</em>和<em class="lz"> allow-loadbalancer </em>是重叠的，因为它们都允许流量到达虚拟机上的端口8080。我们的想法是在完成后禁用<em class="lz">airflow-network-allow-http</em>。</p><h1 id="6445" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">实例组</h1><p id="1e66" class="pw-post-body-paragraph ie if hh ig b ih kd ij ik il ke in io ip lq ir is it lr iv iw ix ls iz ja jb ha bi translated">我们创建一个非托管实例组，并添加新创建的虚拟机。在菜单元素“计算引擎”|“实例组”下选择“创建实例组”:</p><p id="e4d2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">输入<br/>名称:气流-实例-组<br/>区域/分区:欧洲-西方1/欧洲-西方1-b <br/>网络/子网:气流-网络/气流-子网<br/>展开“指定端口名称映射”(见下文)<br/>虚拟机实例:气流-虚拟机</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es mq"><img src="../Images/bc3df4c5c8be0d1a2a134698717f1d34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZPEYUavgs5hm-tQdV3h23g.png"/></div></div><figcaption class="lu lv et er es lw lx bd b be z dx">Compute Engine | Instance groups | Create instance group</figcaption></figure><p id="b39b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">展开“指定端口名映射”并使用端口号“8080”定义端口名“http8080”:</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div class="er es mr"><img src="../Images/28cdc786981c39d2420847d312522adc.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*q4Q9bzs8vMWqvcPbBPtmwQ.png"/></div><figcaption class="lu lv et er es lw lx bd b be z dx">Specify a new port name “http8080”.</figcaption></figure><p id="ec14" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">负载平衡器稍后会使用这个端口名。</p><p id="3567" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">点击“创建”按钮。您应该得到一个包含一个实例的新实例组。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div class="er es ms"><img src="../Images/6c857c48b44908c9476034e3d388ebda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*TBqfFbvlT2U0lbD2AIN0sA.png"/></div><figcaption class="lu lv et er es lw lx bd b be z dx">Result after creating a new instance group.</figcaption></figure></div><div class="ab cl le lf go lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ha hb hc hd he"><h1 id="82c2" class="jd je hh bd jf jg ll ji jj jk lm jm jn jo ln jq jr js lo ju jv jw lp jy jz ka bi translated">安装所需的软件包</h1><p id="a0fc" class="pw-post-body-paragraph ie if hh ig b ih kd ij ik il ke in io ip lq ir is it lr iv iw ix ls iz ja jb ha bi translated">下面的命令安装所需的包，在<em class="lz"> /srv </em>下创建一个Python虚拟环境，创建一个服务器将作为其运行的airflow用户，并设置所有者和权限。</p><pre class="ks kt ku kv fd mt mu mv mw aw mx bi"><span id="d8f2" class="my je hh mu b fi mz na l nb nc">sudo su<br/>apt update<br/>apt upgrade</span><span id="811f" class="my je hh mu b fi nd na l nb nc">apt install software-properties-common<br/>add-apt-repository ppa:deadsnakes/ppa</span><span id="5682" class="my je hh mu b fi nd na l nb nc">apt install python3.7 python3.7-venv python3.7-dev</span><span id="c828" class="my je hh mu b fi nd na l nb nc">adduser airflow --disabled-login --disabled-password --gecos "Airflow system user"</span><span id="9ee1" class="my je hh mu b fi nd na l nb nc">cd /srv<br/>python3.7 -m venv airflow<br/>cd airflow<br/>source bin/activate</span><span id="ccb8" class="my je hh mu b fi nd na l nb nc"># With an activated virtual environment<br/>pip install --upgrade pip<br/>pip install wheel<br/>pip install apache-airflow[postgres,crypto]==1.10.10</span><span id="6253" class="my je hh mu b fi nd na l nb nc">chown airflow.airflow . -R<br/>chmod g+rwx . -R</span></pre></div><div class="ab cl le lf go lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ha hb hc hd he"><h1 id="af35" class="jd je hh bd jf jg ll ji jj jk lm jm jn jo ln jq jr js lo ju jv jw lp jy jz ka bi translated">安装数据库</h1><p id="0842" class="pw-post-body-paragraph ie if hh ig b ih kd ij ik il ke in io ip lq ir is it lr iv iw ix ls iz ja jb ha bi translated">使用没有公共IP地址的托管云SQL数据库。保持<br/>低成本，选择所有最小资源(1个CPU、3.75 GB RAM、10 GB <br/> HDD)。</p><p id="1880" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们希望最后得到:<br/>数据库实例(服务器)，实例ID: airflow-db <br/>数据库名称:airflow <br/>数据库用户名:airflow-user <br/>气流的数据库密码-user:&lt;d b-password&gt;<br/>数据库IP地址:&lt; db-server-ip &gt;</p><p id="38bd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从Google控制台，进入“存储”|“SQL”|“创建新的<br/>实例”，然后“选择PostgreSQL”。</p><p id="4ab2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">选择“私有IP ”,并将其关联到气流网络。点击“分配和连接”，然后点击表格底部的“创建”按钮。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div class="er es ne"><img src="../Images/390a9e1129da5d59ee8561095bdca7d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*VK1Zc9SIzQJL2SsfjXAejw.png"/></div></figure><p id="9fdc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">等待新的服务器实例被创建。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es nf"><img src="../Images/77eedb6b4229887f62ab561b272a0349.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cGsC36ONao3dcDaKUKp9Yw.png"/></div></div></figure><p id="bc19" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当新的数据库实例启动并运行时，您应该创建一个新的数据库<em class="lz"> airflow </em>和一个新的用户<em class="lz"> airflow-user </em>。进入<em class="lz"> airflow-db </em>实例，选择“数据库”，然后选择“创建数据库”。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div class="er es ng"><img src="../Images/7cf090f194202a953b488e8981c88653.png" data-original-src="https://miro.medium.com/v2/resize:fit:1106/format:webp/1*p7FzKEbcW5KC_k9FuKQ9Wg.png"/></div></figure><p id="3821" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在弹出窗口中输入“气流”,然后点击“创建”按钮。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div class="er es nh"><img src="../Images/c9bc018d32a44367393739b4d8878861.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*-wnFWaKT_hLH0ILh4pcEnw.png"/></div></figure><p id="2f99" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后创建一个新用户。选择菜单项“用户”，然后选择“创建用户帐户”按钮。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div class="er es ni"><img src="../Images/1c25ef9edf26880d9d293f84f5668c99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*dsKNRIgkotviKUOtcHJJRw.png"/></div></figure><p id="10a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">输入用户名<em class="lz"> airflow-user </em>并选择新密码，以下简称为&lt; db-password &gt;。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div class="er es nj"><img src="../Images/861902932d86ceed0377ad2ee768c71c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*tkx4L5jxDP1JRgyo2ozErQ.png"/></div></figure><p id="8647" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">此时，您应该能够连接到新的数据库。您需要从数据库实例详细信息概览窗格中找到“专用IP地址”。</p><pre class="ks kt ku kv fd mt mu mv mw aw mx bi"><span id="f841" class="my je hh mu b fi mz na l nb nc">$ psql -h &lt;db-server-ip&gt; -U airflow-user -d airflow<br/>Password for user airflow-user: &lt;db-password&gt;<br/>psql (12.2 (Ubuntu 12.2-4), server 11.6)<br/>SSL connection (protocol: TLSv1.3, cipher: TLS_AES_256_GCM_SHA384)<br/>Type "help" for help</span><span id="337c" class="my je hh mu b fi nd na l nb nc">airflow=&gt;</span></pre></div><div class="ab cl le lf go lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ha hb hc hd he"><h1 id="760d" class="jd je hh bd jf jg ll ji jj jk lm jm jn jo ln jq jr js lo ju jv jw lp jy jz ka bi translated">配置气流</h1><p id="6066" class="pw-post-body-paragraph ie if hh ig b ih kd ij ik il ke in io ip lq ir is it lr iv iw ix ls iz ja jb ha bi translated">运行<em class="lz"> airflow initdb </em>将创建配置文件和元数据数据库。<br/>因为我们使用PostgreSQL数据库，所以我们必须修改配置文件中的数据库<br/>连接字符串，然后重新运行<em class="lz"> airflow <br/> initdb </em>命令。</p><pre class="ks kt ku kv fd mt mu mv mw aw mx bi"><span id="70bb" class="my je hh mu b fi mz na l nb nc">sudo su airflow<br/>cd /srv/airflow<br/>source bin/activate<br/>export AIRFLOW_HOME=/srv/airflow</span><span id="573e" class="my je hh mu b fi nd na l nb nc">airflow initdb</span></pre><p id="9018" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">查看<em class="lz">/SRV/air flow/air flow . CFG</em>文件并更改以下内容:</p><pre class="ks kt ku kv fd mt mu mv mw aw mx bi"><span id="af82" class="my je hh mu b fi mz na l nb nc"># This is not the complete airflow.cfg<br/># but only show configurations you need to change<br/>sql_alchemy_conn = postgresql+psycopg2://airflow-user:&lt;db-password&gt;@&lt;db-server-ip&gt;/airflow</span><span id="eab4" class="my je hh mu b fi nd na l nb nc">default_impersonation = airflow</span><span id="2956" class="my je hh mu b fi nd na l nb nc">load_examples = False</span><span id="934d" class="my je hh mu b fi nd na l nb nc">rbac = True</span><span id="0286" class="my je hh mu b fi nd na l nb nc">enable_proxy_fix = True</span></pre><p id="974c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">编辑配置文件后，初始化PostgreSQL数据库(激活虚拟环境):</p><pre class="ks kt ku kv fd mt mu mv mw aw mx bi"><span id="4dd4" class="my je hh mu b fi mz na l nb nc">airflow initdb</span></pre><p id="00b0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">添加新的气流管理员用户(激活的虚拟环境):</p><pre class="ks kt ku kv fd mt mu mv mw aw mx bi"><span id="d92e" class="my je hh mu b fi mz na l nb nc">airflow create_user -r Admin -u jon -e jon@exampl.com -f Jon -l Snow</span></pre><p id="3e2b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您现在可以启动airflow服务器:</p><pre class="ks kt ku kv fd mt mu mv mw aw mx bi"><span id="394e" class="my je hh mu b fi mz na l nb nc">airflow webserver -p 8080</span></pre><p id="4f7d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您现在可以通过http:// <vm external="" ip=""> :8080访问网络服务器</vm></p><p id="8e2f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以使用以下命令启动调度程序:</p><pre class="ks kt ku kv fd mt mu mv mw aw mx bi"><span id="ecd3" class="my je hh mu b fi mz na l nb nc">airflow scheduler</span></pre></div><div class="ab cl le lf go lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ha hb hc hd he"><h1 id="12fc" class="jd je hh bd jf jg ll ji jj jk lm jm jn jo ln jq jr js lo ju jv jw lp jy jz ka bi translated">自动启动</h1><p id="a76e" class="pw-post-body-paragraph ie if hh ig b ih kd ij ik il ke in io ip lq ir is it lr iv iw ix ls iz ja jb ha bi translated">使用systemd设置Airflow webserver和调度程序，以便在服务器启动时自动启动<br/>。</p><pre class="ks kt ku kv fd mt mu mv mw aw mx bi"><span id="3744" class="my je hh mu b fi mz na l nb nc">[Unit]<br/>Description=Airflow webserver daemon<br/>After=network.target</span><span id="7571" class="my je hh mu b fi nd na l nb nc">[Service]<br/>Environment=”PATH=/srv/airflow/bin”<br/>Environment=”AIRFLOW_HOME=/srv/airflow”<br/>User=airflow<br/>Group=airflow<br/>Type=simple<br/>ExecStart=/srv/airflow/bin/airflow webserver -p 8080 — pid /srv/airflow/webserver.pid<br/>Restart=on-failure<br/>RestartSec=5s<br/>PrivateTmp=true</span><span id="e33f" class="my je hh mu b fi nd na l nb nc">[Install]<br/>WantedBy=multi-user.target</span></pre><p id="0a30" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">用上面列出的内容创建一个文件<em class="lz">air flow-web server . service</em>。然后运行以下命令:</p><pre class="ks kt ku kv fd mt mu mv mw aw mx bi"><span id="63ff" class="my je hh mu b fi mz na l nb nc">sudo cp airflow-webserver.service /lib/systemd/system/<br/>sudo systemctl daemon-reload<br/>sudo systemctl enable airflow-webserver.service<br/>sudo systemctl start airflow-webserver.service<br/>sudo systemctl status airflow-webserver.service</span></pre><p id="361b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对<em class="lz">气流调度器进行同样的操作。</em></p><pre class="ks kt ku kv fd mt mu mv mw aw mx bi"><span id="9707" class="my je hh mu b fi mz na l nb nc">[Unit]<br/>Description=Airflow scheduler daemon<br/>After=network.target</span><span id="6d75" class="my je hh mu b fi nd na l nb nc">[Service]<br/>Environment=”PATH=/srv/airflow/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin”<br/>Environment=”AIRFLOW_HOME=/srv/airflow”<br/>User=airflow<br/>Group=airflow<br/>Type=simple<br/>ExecStart=/srv/airflow/bin/airflow scheduler<br/>Restart=always<br/>RestartSec=5s</span><span id="5eb2" class="my je hh mu b fi nd na l nb nc">[Install]<br/>WantedBy=multi-user.target</span></pre><p id="e729" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">并运行命令:</p><pre class="ks kt ku kv fd mt mu mv mw aw mx bi"><span id="a7b8" class="my je hh mu b fi mz na l nb nc">sudo cp airflow-scheduler.service /lib/systemd/system/<br/>sudo systemctl daemon-reload<br/>sudo systemctl enable airflow-scheduler.service<br/>sudo systemctl start airflow-scheduler.service<br/>sudo systemctl status airflow-scheduler.service</span></pre><p id="9bbb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，您应该能够使用systemctl命令启动和停止服务:</p><pre class="ks kt ku kv fd mt mu mv mw aw mx bi"><span id="a4f4" class="my je hh mu b fi mz na l nb nc">sudo systemctl start airflow-webserver<br/>sudo systemctl stop airflow-webserver</span><span id="7cb8" class="my je hh mu b fi nd na l nb nc">sudo systemctl start airflow-scheduler<br/>sudo systemctl stop airflow-scheduler</span></pre><p id="2f77" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">尝试重新启动您的服务器，并看到气流调度程序和网络服务器自动启动。</p><pre class="ks kt ku kv fd mt mu mv mw aw mx bi"><span id="f89d" class="my je hh mu b fi mz na l nb nc">sudo reboot now</span></pre></div><div class="ab cl le lf go lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ha hb hc hd he"><h1 id="3db6" class="jd je hh bd jf jg ll ji jj jk lm jm jn jo ln jq jr js lo ju jv jw lp jy jz ka bi translated">静态IP地址</h1><p id="429a" class="pw-post-body-paragraph ie if hh ig b ih kd ij ik il ke in io ip lq ir is it lr iv iw ix ls iz ja jb ha bi translated">保留一个外部静态IP地址。这将是用户从互联网连接到的地方，我们需要设置一个DNS A记录指向这个IP地址。该IP地址将是负载平衡器的前端，并不直接连接到服务器。</p><p id="df0a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在谷歌控制台进入“VPC网络”|“外部IP地址”|“保留静态地址”。输入名称(<em class="lz">气流-静电-ip </em>)和地区(欧洲-西方1)。暂时不要将IP地址附加到任何东西上。稍后我们将把它连接到负载平衡器。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es nk"><img src="../Images/156e58085061fd94f75892b4bd0be229.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tY9TcnAKMvCw871F1WspYQ.png"/></div></div></figure><p id="5310" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">点击“预订”按钮。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es nl"><img src="../Images/090d1de2857a2ab41dfef5f06196df1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZiW_HAbT6fB9r-Ztb3LCVw.png"/></div></div></figure><p id="4cc5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建一个DNS A记录，指向上面创建的静态IP地址。这是在DNS提供商的设置中完成的。我使用的DNS名称是airflow.leira.net:</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es nm"><img src="../Images/cc1ac210499158f55c52a51a7bddd5ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tfTw03hn3LRbq91imojuDg.png"/></div></div></figure><p id="b8bc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当然，您应该使用自己的IP地址和DNS名称。请注意，在我们创建HTTPS证书之前，DNS A记录必须准备就绪。</p><p id="a23f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过运行以下命令检查目前一切正常:</p><pre class="ks kt ku kv fd mt mu mv mw aw mx bi"><span id="ecb2" class="my je hh mu b fi mz na l nb nc">ping airflow.leira.net</span><span id="857d" class="my je hh mu b fi nd na l nb nc">Pinging airflow.leira.net [35.206.141.120] with 32 bytes of data</span></pre><p id="5a9b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你不应该得到任何答复，但你应该看到正确的IP地址。</p></div><div class="ab cl le lf go lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ha hb hc hd he"><h1 id="bc8a" class="jd je hh bd jf jg ll ji jj jk lm jm jn jo ln jq jr js lo ju jv jw lp jy jz ka bi translated">负载平衡器</h1><p id="66f5" class="pw-post-body-paragraph ie if hh ig b ih kd ij ik il ke in io ip lq ir is it lr iv iw ix ls iz ja jb ha bi translated">在Google控制台中，选择“网络服务”|“负载平衡”|“创建负载平衡器”。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div class="er es nn"><img src="../Images/7695657bef088377fd785eaec2406232.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*ZJGqsWPGPcve0BbYHg9R3w.png"/></div></figure><p id="69cc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在“HTTP(S)负载平衡”框中选择“启动配置”。</p><p id="e751" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第一步选择“从互联网到我的虚拟机”:</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div class="er es no"><img src="../Images/d1fd0c9750b70df3b8abecd2dcbe24d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*-WPT8MW-jrG-JUIPdlZmCA.png"/></div></figure><p id="f1df" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后给负载平衡器起一个你自己选择的名字，点击第一个项目符号“后端配置”，然后点击“后端服务”|“创建后端服务”:</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es np"><img src="../Images/5585c2600e085fe99e2ac1c25b34effc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_x7_Tzh-3EwLASX7g5iZwg.png"/></div></div></figure><p id="3d1e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">进入运行状况检查下拉列表时，会显示另一个表单。</p><p id="45de" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">命名端口:http8080 <br/>新后端:<br/>实例组:气流-实例-组<br/>端口号:8080</p><div class="ks kt ku kv fd ab cb"><figure class="mc kw nq me mf mg mh paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><img src="../Images/f12982e51e9e3ae7f2b3967ff4fa6461.png" data-original-src="https://miro.medium.com/v2/resize:fit:690/format:webp/1*ZFR1PEjnoHAFG3ifwo2KBw.png"/></div></figure><figure class="mc kw nr me mf mg mh paragraph-image"><img src="../Images/069a0a04553b50dcb2451200add3a991.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/format:webp/1*JUUNmfWgaxJcDbjhjQ7-sA.png"/></figure></div><p id="9b07" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们不必在“主机和路径规则”中做任何事情，所以现在跳过这一步。</p><p id="1567" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">进入“前端配置”。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es ns"><img src="../Images/034db6fef23e5039797697bd7f303d8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lM7aRnxZ8qOPgmkTxSC3kA.png"/></div></div></figure><p id="5ddc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">选择一个名称，然后选择:</p><p id="ec1a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">协议:HTTPS <br/> IP地址:airflow-static-id(我们在上面创建的)<br/>证书:创建一个新的证书(同样，在此之前，您的域名必须有一个指向静态IP地址的A记录)。</p><p id="bdea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一个新的弹出窗口:</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div class="er es nt"><img src="../Images/6d91d85583b4e2f83e220c1b8d293d79.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*xMw0FLOEIHxYa6Syo8Fuuw.png"/></div></figure><p id="8fa0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">输入名称，然后选择“创建Google管理的证书”。</p><p id="035c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">输入指向静态IP地址的DNS名称，然后点击“创建”按钮。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es nu"><img src="../Images/cf0fe8778744b7c3ff0dec1395f48e86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EGu3jU4rE2dw4cCyISiciQ.png"/></div></div></figure><p id="26ae" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">点击前端配置表单中的“完成”按钮。</p><p id="3f21" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后点击“新建HTTP(S)负载平衡器”表单中的“创建”按钮。</p><p id="c664" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，您应该得到这样的负载平衡器:</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es lt"><img src="../Images/da40106b625b6b59627d24c7d9264ffd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bo35zKlbW_LPanUkvskZSg.png"/></div></div></figure><p id="7fcf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">进入新创建的负载平衡器，我们可以看到证书还没有准备好。在这种情况下，大约需要10分钟才能准备好。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es nv"><img src="../Images/a77669d01a77008e6f819d15b8e4ce13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z6e1hC2c5nlKKCyQ8OmHUQ.png"/></div></div></figure><h1 id="1d99" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">结论</h1><p id="dbc2" class="pw-post-body-paragraph ie if hh ig b ih kd ij ik il ke in io ip lq ir is it lr iv iw ix ls iz ja jb ha bi translated">希望这篇帖子能帮到你。</p><p id="7b5c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">未解决。如何自动从HTTP(端口80)重定向到HTTPS(端口443)。应该是负载均衡器里的一个设置，希望以后能来。</p><p id="5803" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请给我反馈。</p><h1 id="0e3e" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">多方面的</h1><p id="d0fc" class="pw-post-body-paragraph ie if hh ig b ih kd ij ik il ke in io ip lq ir is it lr iv iw ix ls iz ja jb ha bi translated">我使用环境systemd配置文件来设置调度程序使用的路径。我只使用BashOperator和DummyOperator，并为我的操作符设置我的python作业和所需Python版本的路径:</p><pre class="ks kt ku kv fd mt mu mv mw aw mx bi"><span id="0a93" class="my je hh mu b fi mz na l nb nc">task = BashOperator(<br/> task_id=’my_task’,<br/> bash_command=f’/srv/&lt;virtualenv&gt;/bin/python3 src/transfer.py’,<br/> …<br/>)</span></pre><p id="6dc2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我不需要在相同的Python版本或虚拟环境中运行我的操作符。每个人可以使用自己的，或分享。</p></div></div>    
</body>
</html>