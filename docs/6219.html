<html>
<head>
<title>Ad Metrics Quality and Testing on Mobile</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">移动广告度量质量与测试</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/ad-metrics-quality-and-testing-on-mobile-fae9e70e7761?source=collection_archive---------7-----------------------#2019-08-05">https://medium.com/pinterest-engineering/ad-metrics-quality-and-testing-on-mobile-fae9e70e7761?source=collection_archive---------7-----------------------#2019-08-05</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="bfc6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Maya Reddy |软件工程师，广告格式</p><p id="d529" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在Pinterest，我们每天都帮助我们的广告合作伙伴通过不同的广告形式接触Pinners，并为他们提供关于其广告表现的指标和分析。保持合作伙伴的信任和提供价值至关重要，因此我们公开的指标(最终基于包含客户事件的日志)必须正确。</p><p id="f98d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2017年初，我们每两周有一次移动发布，我们会在每次发布前做人工QA来验证日志行为。很快，客户团队开始投资集成测试框架；在这种情况下，集成测试是通过UI流程的自动化测试，从登录应用程序开始，执行诸如点击pin、保存pin等行为。在自动化操作结束时，测试会验证日志是否与UI操作相匹配。</p><h1 id="797f" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">为什么我们创建了ads日志集成测试套件</h1><ul class=""><li id="b864" class="ka kb hh ig b ih kc il kd ip ke it kf ix kg jb kh ki kj kk bi translated">在发布周期的早期捕获并修复bug—以前，我们依赖人工QA，这意味着团队可能直到发布周期的后期才捕获bug，而且我们经常在发布截止日期前不久修复P1的bug。</li><li id="b19c" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated"><strong class="ig hi">满怀信心地发布代码</strong> —自动化测试允许我们运行更多的测试用例，并且更加确信新代码没有引入错误或问题。</li><li id="1798" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated"><strong class="ig hi">重新分配手动测试</strong>——将重复的QA任务转移到集成测试意味着手动QA可以做更多的探索性测试和新功能测试。</li></ul><h1 id="439a" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">挑战</h1><h2 id="96cd" class="kq jd hh bd je kr ks kt ji ku kv kw jm ip kx ky jq it kz la ju ix lb lc jy ld bi translated">如何确保我们测试了正确的格式</h2><p id="216d" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip le ir is it lf iv iw ix lg iz ja jb ha bi translated">我们需要一种方法来保证某个广告会出现在用户的提要中，这样我们就可以对所需的广告格式进行测试。在下面的例子中，我们需要一个应用安装广告来显示。</p><p id="f29c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">测试案例示例:</p><ol class=""><li id="abe1" class="ka kb hh ig b ih ii il im ip lh it li ix lj jb lk ki kj kk bi translated">滚动提要并完整查看应用程序安装Pin</li><li id="f0db" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb lk ki kj kk bi translated">确认印象触发。验证:id已填充，并且看起来像有效的复合Id</li></ol><p id="ae61" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们使用一个方便的工具，根据JSON数据在API级别插入提升的pin。我们有许多不同的测试帐户，每个帐户都有一个特定的Pin。然后，我们的自动化测试可以登录特定格式测试所需的任何帐户！</p><figure class="lm ln lo lp fd lq er es paragraph-image"><div class="er es ll"><img src="../Images/85db5e08996aef0232e5a212849780fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/1*5sIlZhLctZlPlZDjxKjUSg.png"/></div></figure><h2 id="5cf9" class="kq jd hh bd je kr ks kt ji ku kv kw jm ip kx ky jq it kz la ju ix lb lc jy ld bi translated">我们如何组织测试</h2><p id="7182" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip le ir is it lf iv iw ix lg iz ja jb ha bi translated">我们的广告出现在Pinterest应用的很多地方。当用户执行搜索等操作时，它们会出现在主页提要中。有时，一个bug可能只影响一个表面，所以我们需要在所有不同的表面上进行测试。这增加了测试的数量，但是很容易从逻辑上将它们分开。我们有一个执行所有UI操作和日志记录检查的基方法，我们有一个针对每个表面的测试方法，该方法在调用基方法之前导航到该表面。</p><figure class="lm ln lo lp fd lq er es paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="er es lt"><img src="../Images/c3b2f669e3cf406c0c963638ec33cd0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HHx7-TNBtUIudVVKOxW1Vg.png"/></div></div></figure><p id="5246" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是在home feed、search和相关Pins feed上运行的一个测试。测试是检查当上下文菜单出现时，印象是否正确结束。</p><figure class="lm ln lo lp fd lq er es paragraph-image"><div class="er es ly"><img src="../Images/37f490809469197dfc2ba59a90051bcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/0*W4jr-92Q_ogb0P1Z"/></div></figure><figure class="lm ln lo lp fd lq er es paragraph-image"><div class="er es ly"><img src="../Images/747d04f93dc35142babd13bf5d9d4cea.png" data-original-src="https://miro.medium.com/v2/resize:fit:604/0*3pf4HMLsW8_e-WdD"/></div></figure><figure class="lm ln lo lp fd lq er es paragraph-image"><div class="er es lz"><img src="../Images/3ae3cc0b2397c0f8a5f2c754677b63a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/0*pLxyE0_artJuilLT"/></div></figure><h2 id="726e" class="kq jd hh bd je kr ks kt ji ku kv kw jm ip kx ky jq it kz la ju ix lb lc jy ld bi translated">测试复制</h2><p id="7fed" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip le ir is it lf iv iw ix lg iz ja jb ha bi translated">随着广告在新的表面上投放，我们需要证明广告行为和日志工作符合预期。例如，在用户板上，有一个名为“更多想法”的新部分，广告现在可以出现在那里，我们希望能够轻松复制现有的测试，以便在这个新的表面上运行。理想情况下，拥有表面的团队也应该能够拥有他们的测试子集，从测试创建到维护。由于大多数测试都是以一致的结构编写的，因此我们创建了一个Python脚本，通过复制和修改现有的测试来为新的曲面生成测试。</p><figure class="lm ln lo lp fd lq er es paragraph-image"><div class="er es ma"><img src="../Images/42782c435660104ed43988554469d47e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1338/format:webp/1*WU3NtLCblME1M4UcYB29QA.png"/></div></figure><h1 id="f774" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">连续累计</h1><p id="e9df" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip le ir is it lf iv iw ix lg iz ja jb ha bi translated">随着我们添加更多的格式及其相关的测试覆盖，测试套件变得越来越大。我们可用的内部容量限制了我们运行完整测试套件的频率。经过一些迭代之后，我们当前的流程是在有更多可用容量时，每晚运行一次测试套件。然而，我们也挑选了一小部分测试在每次提交时运行，以便获得关于bug的早期信号。我们总是确保在将构建提交到App Store/Play Store之前，完整的测试套件通过了发布候选。我们在集成环境中使用以下设置:</p><ul class=""><li id="24d5" class="ka kb hh ig b ih ii il im ip lh it li ix lj jb kh ki kj kk bi translated">Buildkite——我们为在远程机器上运行的集成测试设置了build kite管道。</li><li id="b3c4" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">测试完成得更快，因为它们是并行运行的。</li><li id="b98e" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">测试运行时，开发人员可以开发其他功能。</li><li id="d170" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">我们可以安排构建，以便测试在夜间运行，或者设置集成，以便测试在每次提交时运行。</li><li id="966b" class="ka kb hh ig b ih kl il km ip kn it ko ix kp jb kh ki kj kk bi translated">Metro —用于分析测试结果和趋势的内部工具。我们可以看到一段时间内特定管道以及单个测试的成功率。</li></ul><h1 id="1c83" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">我们如何维护测试</h1><p id="f701" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip le ir is it lf iv iw ix lg iz ja jb ha bi translated">一旦编写了一个测试，它就被添加到阶段化Buildkite管道中。新的测试会运行几天，我们会修复出现的任何问题。稳定后，我们将其添加到生产Buildkite管道中。除了编写测试的前期成本之外，还需要一些维护测试的工作。</p><ul class=""><li id="89b6" class="ka kb hh ig b ih ii il im ip lh it li ix lj jb kh ki kj kk bi translated">有时一个特性的改变会破坏集成测试。例如,“后退”按钮可能会变成“关闭”按钮。因为我们依赖于可访问性标签，所以我们的测试会失败。在这种情况下，我们会向适当的团队提交一个bug，以便他们可以修复这个问题。</li></ul><figure class="lm ln lo lp fd lq er es paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="er es mb"><img src="../Images/8b3a40c578741a6aa05a0594c4b86b77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xxPYRufljiNuDOE4"/></div></div></figure><figure class="lm ln lo lp fd lq er es paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="er es mb"><img src="../Images/ef8c8cef6eea08fdc1436c91a0fb6684.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IOVxDtsCKZhTXzH0"/></div></div></figure><ul class=""><li id="198f" class="ka kb hh ig b ih ii il im ip lh it li ix lj jb kh ki kj kk bi translated">其他时候，随着时间的推移，我们如何编写测试的问题变得越来越明显。在那些情况下，我们更新测试框架/设置本身。</li></ul><h1 id="eb81" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">结论</h1><p id="19b5" class="pw-post-body-paragraph ie if hh ig b ih kc ij ik il kd in io ip le ir is it lf iv iw ix lg iz ja jb ha bi translated">自动化集成测试让我们对报告给广告客户的指标充满信心。我们正在不断地改进流程，使我们的测试更容易运行和维护。</p><p id="f1b7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="mc">鸣谢:感谢Wendy Lu、Matt Mo、Joseph Smalls-Mantey、Jordan Maler、Tony Lu、Jerry Marino、Freddy蒙塔诺、广告格式iOS团队、Metrics Quality &amp;测试工具团队、iOS核心平台团队，以及所有为此提供帮助的人！</em></p></div></div>    
</body>
</html>