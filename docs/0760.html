<html>
<head>
<title>Jetpack Compose Composition Tracing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Jetpack撰写撰写跟踪</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/jetpack-compose-composition-tracing-9ec2b3aea535?source=collection_archive---------0-----------------------#2022-09-20">https://medium.com/androiddevelopers/jetpack-compose-composition-tracing-9ec2b3aea535?source=collection_archive---------0-----------------------#2022-09-20</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex ig ih ii ij er es paragraph-image"><div class="er es if"><img src="../Images/52145c9370bb785e22eb90da1e9e801a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jPVPY4GjPRK3prnJ2o09cQ.png"/></div></figure><p id="b915" class="pw-post-body-paragraph im in hh io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj ha bi translated">今天，我们推出了第一个alpha Compose composite Tracing，这是一个新功能，允许在Android Studio Flamingo系统跟踪分析器中显示Jetpack Compose可组合函数。它提供了系统跟踪的低侵入性，方法跟踪组合中的细节层次。这对于检查您的Compose应用程序的性能并找出您的应用程序可能无法如您所愿执行的原因非常有用。</p><p id="eae5" class="pw-post-body-paragraph im in hh io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj ha bi translated">以前，系统跟踪只会为您显示每帧一个用于重组的块，但它不会告诉您实际上正在重组哪些组件。这些信息已经可以通过方法跟踪获得，但是方法跟踪可能会非常麻烦，并且会显著影响应用程序的性能。现在，您可以在系统跟踪中看到您的所有组件，没有这个问题，并找到任何比您预期的时间更长的组件！下面是它的预览图:</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es jk"><img src="../Images/28ff3cd415d9a8b8562c8827f970d394.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2GUDLlyuDHYTtJVG"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx">Composables in the system trace</figcaption></figure><p id="4226" class="pw-post-body-paragraph im in hh io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj ha bi translated">以防不清楚这提供了多少额外的细节，下面是没有启用合成跟踪时的样子:</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es jx"><img src="../Images/9ca8781b6d9c84387ee6962a2ee7f3eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*R6kuFefS8HIBo4BR"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx">System trace without composition tracing</figcaption></figure><h1 id="cbf7" class="jy jz hh bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">设置合成跟踪</h1><p id="386f" class="pw-post-body-paragraph im in hh io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj ha bi translated">要在项目中尝试重组跟踪，您必须至少更新到以下版本。</p><ul class=""><li id="267f" class="lb lc hh io b ip iq it iu ix ld jb le jf lf jj lg lh li lj bi translated">安卓工作室火烈鸟金丝雀1</li><li id="efd6" class="lb lc hh io b ip lk it ll ix lm jb ln jf lo jj lg lh li lj bi translated">撰写用户界面:1.3.0-beta01</li><li id="68e3" class="lb lc hh io b ip lk it ll ix lm jb ln jf lo jj lg lh li lj bi translated">编译编译器:1.3.0</li></ul><p id="5a4e" class="pw-post-body-paragraph im in hh io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj ha bi translated">运行跟踪的设备或模拟器也必须至少为API级别30。</p><p id="118b" class="pw-post-body-paragraph im in hh io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj ha bi translated">此外，您将需要在撰写运行时跟踪上添加一个新的依赖项:</p><p id="0ab3" class="pw-post-body-paragraph im in hh io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj ha bi translated"><code class="du lp lq lr ls b">implementation("androidx.compose.runtime:runtime-tracing:1.0.0-alpha01")</code></p><p id="9bd6" class="pw-post-body-paragraph im in hh io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj ha bi translated">有了这种依赖性，当您进行包含重组的系统跟踪时，您将自动看到可组合的函数。</p><h1 id="ae70" class="jy jz hh bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">进行系统跟踪</h1><p id="a32d" class="pw-post-body-paragraph im in hh io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj ha bi translated">要进行系统跟踪并查看新的重组跟踪的运行情况，首先要打开分析器</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es lt"><img src="../Images/b1a1152682af9f987724de8ce5175bb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8KoPRLy0p2REgh-G"/></div></div></figure><p id="3264" class="pw-post-body-paragraph im in hh io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj ha bi translated">单击CPU时间线</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es lu"><img src="../Images/8c640758bd2a374e1112aba775f12e46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*io6anSlwXafEiXAW"/></div></div></figure><p id="0215" class="pw-post-body-paragraph im in hh io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj ha bi translated">将您的应用导航至您想要追踪的UI，然后选择<strong class="io hi">系统追踪</strong>和<strong class="io hi">记录</strong></p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es lv"><img src="../Images/d37bd31e602623d1203648e5f1ef4073.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*83ZDLn4H9_9WDK0V"/></div></div></figure><p id="cc29" class="pw-post-body-paragraph im in hh io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj ha bi translated">使用您的应用程序进行重组并停止录制。一旦跟踪被处理并出现，您现在应该能够在重组跟踪中看到composables。您可以使用键盘和鼠标来缩放和平移轨迹；如果您不熟悉跟踪导航，请参见<a class="ae lw" href="https://developer.android.com/studio/profile/record-traces#ui-shortcuts" rel="noopener ugc nofollow" target="_blank">文档</a>。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es jk"><img src="../Images/b857a5db77571055ab15a1bcfcaa1bd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*edyh-uEMprZvfYns"/></div></div></figure><p id="8529" class="pw-post-body-paragraph im in hh io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj ha bi translated">您还可以在火焰图中看到组件以及文件和行号。</p><figure class="jl jm jn jo fd ij er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es lx"><img src="../Images/e7139e8cab888608ae158efe35981f25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wpBVPnVXQwhzkQOZ"/></div></div></figure><h1 id="6b40" class="jy jz hh bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">警告</h1><h2 id="02f3" class="ly jz hh bd ka lz ma mb ke mc md me ki ix mf mg km jb mh mi kq jf mj mk ku ml bi translated">APK规模开销</h2><p id="3dce" class="pw-post-body-paragraph im in hh io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj ha bi translated">虽然我们的目标是尽可能减少该功能的开销，但由于Compose编译器跟踪嵌入APK中的字符串，Compose应用程序的APK大小有所增加。如果您的应用程序不经常使用Compose，这可能相对较小，而对于完全合成的应用程序，这可能较大。这些都是不模糊的，所以它们可以出现在跟踪工具中，如上所示。从1.3.0版本开始，Compose编译器将它们注入所有应用程序。</p><p id="e210" class="pw-post-body-paragraph im in hh io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj ha bi translated">通过添加以下proguard规则，可以在生产版本中删除这些内容:</p><figure class="jl jm jn jo fd ij"><div class="bz dy l di"><div class="mm mn l"/></div></figure><p id="0d41" class="pw-post-body-paragraph im in hh io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj ha bi translated">这些功能可能会在未来发生变化，但任何变化都会在撰写<a class="ae lw" href="https://developer.android.com/jetpack/androidx/releases/compose-compiler" rel="noopener ugc nofollow" target="_blank">发行说明</a>中提及。</p><p id="f602" class="pw-post-body-paragraph im in hh io b ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj ha bi translated">请注意，保留它们，虽然会产生一些APK大小的成本，但可以保证被分析的APK与应用程序用户运行的是同一个。</p><h2 id="8bb4" class="ly jz hh bd ka lz ma mb ke mc md me ki ix mf mg km jb mh mi kq jf mj mk ku ml bi translated">精确计时</h2><p id="10ab" class="pw-post-body-paragraph im in hh io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj ha bi translated">为了进行准确的分析，就像任何性能测试一样，您需要根据<a class="ae lw" href="https://developer.android.com/studio/profile#profileable-apps" rel="noopener ugc nofollow" target="_blank">https://developer . Android . com/studio/profile # profile able-apps</a>制作应用<code class="du lp lq lr ls b">profileable</code> / <code class="du lp lq lr ls b">non-debuggable</code></p><h1 id="73b6" class="jy jz hh bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">反馈</h1><p id="70bf" class="pw-post-body-paragraph im in hh io b ip kw ir is it kx iv iw ix ky iz ja jb kz jd je jf la jh ji jj ha bi translated">我们希望听到您对此功能的反馈，您发现的任何问题以及您的任何请求。您可以通过<a class="ae lw" href="https://issuetracker.google.com/issues/new?component=898851&amp;template=1458540" rel="noopener ugc nofollow" target="_blank">问题跟踪器向我们发送反馈。</a></p></div></div>    
</body>
</html>