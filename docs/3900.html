<html>
<head>
<title>Testing in Vapor</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">蒸汽测试</h1>
<blockquote>原文：<a href="https://medium.com/globant/testing-in-vapor-72af46c8cdb9?source=collection_archive---------0-----------------------#2022-06-25">https://medium.com/globant/testing-in-vapor-72af46c8cdb9?source=collection_archive---------0-----------------------#2022-06-25</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="08ff" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">测试在软件开发过程中非常重要。当你重构代码时，编写单元测试给你信心。Vapor包含一个<strong class="ig hi"> XCTVapor </strong>模块，它提供了基于XCTest构建的测试助手。这些测试助手允许以编程方式或通过HTTP服务器向Vapor应用程序发送测试请求。</p><p id="5d70" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">初始设置写单元测试代码<br/> </strong>要使用XCTVapor模块，应该将它添加到包的测试目标中。<br/>要将它添加到测试目标，在XCode app <br/>中打开“<strong class="ig hi"> Package.swift </strong>”文件，并在targets数组中定义测试目标，如下所示:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/7bb519c07dc221aec07172ddf1c719f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iefcrHHfvF1tYXypXuGk3g.png"/></div></div></figure><p id="2d54" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">开始编写单元测试代码<br/> </strong>一旦我们添加了依赖项，我们必须从终端运行下面的命令:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jo"><img src="../Images/501ec57efc34e7c95b033f197343768a.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/1*IQtTyMbhCtNqyTI2Mk2OtQ.png"/></div></figure><p id="5ada" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这将打开Xcode项目，但我们应该等到所有的依赖项都加载完毕。一旦加载了所有的项目依赖，我们就可以开始编写单元测试用例了。现在我们可以创建一个遵循以下命名约定的测试文件:<br/>&lt;FileName&gt;tests . swift<br/>示例:AppTests.swift</p><p id="9a1d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦文件被创建，它有一些内置的可用方法，这些方法是不言自明的，如下所示:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jp"><img src="../Images/4971b5ba762045e9aa425f444c99df89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vPoJSFq50GbHqtrFb2UvWw.png"/></div></div></figure><p id="59e1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在要包含app target并扩展XCTestCase来编写Vapor相关的测试用例，我们必须在顶部导入下面的库:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jq"><img src="../Images/6acbaed1dd43b521cb4eb39c9b73ef91.png" data-original-src="https://miro.medium.com/v2/resize:fit:744/format:webp/1*kaAPzE5QP7jmUSmnkxTNQQ.png"/></div></figure><p id="7725" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在下一步是创建你自己的方法，但是要确保每个函数名称都以测试前缀开头，这样当你的类和应用程序被测试时它们会自动运行。</p><p id="04ca" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">单元测试测试一个GET API调用<br/> </strong>我们以一个GET API为例来了解整个测试过程。我们正在编写一个单元测试用例，从API调用中获取位置细节。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jr"><img src="../Images/bef2a15684c2a41fc21d3a6afe315ca2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DBp4VAuwNh39hgUTk1uC7Q.png"/></div></div></figure><p id="dd0c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们来讨论一下上面的代码是怎么回事:<br/> 1。为测试定义一些期望值:即纬度和经度。</p><p id="f510" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.创建应用程序，这将创建整个应用程序对象。它不负责运行应用程序。</p><p id="12c8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3.在测试结束时关闭应用程序，以便它关闭数据库连接并清除事件循环。</p><p id="2f2c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">4.为测试配置您的应用程序。这是为了确保我们正确配置我们的应用程序。</p><p id="30cb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">5.调用API并将数据保存在数据库中。</p><p id="8fd1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">6.创建一个响应者类型，它只是响应你的请求。使用XCTVapor(vapor的测试模块)向/myApi/location details发送GET请求。使用XCTVapor，我们可以指定路径和HTTP方法。XCTVapor还允许我们在发送API请求之前和收到API响应之后提供闭包来运行。</p><p id="b85e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">7.我们需要确保收到的响应包含预期的状态代码。</p><p id="0453" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">8.将响应数据解码为LocationDetails对象的数组。</p><p id="0213" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">9.确保响应中有正确的值，并且位置详细信息与测试开始时创建的信息相匹配。</p><p id="bac9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，在运行这个应用程序之前，我们必须更新应用程序的配置以支持测试。因此，打开"<strong class="ig hi"> Configure.swift </strong>"并用以下内容替换app.databases.use:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es js"><img src="../Images/4e7f3aa662febe540e4537192d65bee8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RZAlPUK7Z1inv29OFCF6zQ.png"/></div></div></figure><p id="6322" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">单元测试测试一个POST API调用<br/> </strong>现在让我们再举一个POST API方法的例子。这里是一个登录页面的示例，用户在成功登录后将导航到仪表板屏幕，该屏幕将检查并获取用户的详细信息。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jt"><img src="../Images/405c5d4589be99969ad8753e6885bd89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yrl5MPQLyZmMaUT6g-7CMQ.png"/></div></div></figure><p id="a835" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们讨论一下上面的代码是怎么回事:</p><ol class=""><li id="fa1f" class="ju jv hh ig b ih ii il im ip jw it jx ix jy jb jz ka kb kc bi translated">为测试定义一些预期值:即预期名称</li><li id="7cda" class="ju jv hh ig b ih kd il ke ip kf it kg ix kh jb jz ka kb kc bi translated">调用带有两个参数用户电子邮件和密码的API</li><li id="ef30" class="ju jv hh ig b ih kd il ke ip kf it kg ix kh jb jz ka kb kc bi translated">检查响应状态代码是否成功</li><li id="6965" class="ju jv hh ig b ih kd il ke ip kf it kg ix kh jb jz ka kb kc bi translated">将响应解析到用户模型中</li><li id="21ea" class="ju jv hh ig b ih kd il ke ip kf it kg ix kh jb jz ka kb kc bi translated">用预期结果测试用户模型的用户名值</li></ol><h1 id="c16b" class="ki kj hh bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">运行测试</h1><p id="0b4a" class="pw-post-body-paragraph ie if hh ig b ih lg ij ik il lh in io ip li ir is it lj iv iw ix lk iz ja jb ha bi translated">要运行Vapor应用程序，选择package scheme并使用键盘上的cmd+u，这将在Xcode中运行您的单元测试。要通过命令行对此进行测试，请使用以下命令:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es ll"><img src="../Images/dfbbc8da56dd3b2e92690f374166ee47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1140/format:webp/1*8Ni3XirnAbsippoplYzT3g.png"/></div></figure><h1 id="d9df" class="ki kj hh bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">可测试方法</h1><p id="52b4" class="pw-post-body-paragraph ie if hh ig b ih lg ij ik il lh in io ip li ir is it lj iv iw ix lk iz ja jb ha bi translated">Vapor以编程方式提供测试API支持，并通过实时HTTP服务器发送测试请求。使用testable方法，我们可以指定您想要使用的方法。要以编程方式执行测试，需要以下代码:<br/> app.testable(方法:。inMemory)。测试(…)</p><p id="efa7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用下面的代码通过live HTTP运行单元测试用例severe: <br/> app.testable(方法:。跑步)。测试(…)</p><p id="263a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">的。inMemory选项是默认选项，我们也可以使用。运行选项。在这种情况下，我们必须指定我们将使用哪个端口号。<br/>举例:。正在运行(端口:8080) <br/>这里默认的端口是8080。</p></div><div class="ab cl lm ln go lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ha hb hc hd he"><h1 id="14c7" class="ki kj hh bd kk kl lt kn ko kp lu kr ks kt lv kv kw kx lw kz la lb lx ld le lf bi translated">结论</h1><p id="d55e" class="pw-post-body-paragraph ie if hh ig b ih lg ij ik il lh in io ip li ir is it lj iv iw ix lk iz ja jb ha bi translated">让我告诉你整个蒸汽测试过程的要点。<br/> 1。将XCTVapor模块和所需的依赖项添加到测试目标中。<br/> 2。安装依赖项。<br/> 3。打开项目并使用Tests作为后缀创建文件。<br/> 4。导入XCTVapor模块<br/> 5。更新configure.swift文件以设置数据库配置。<br/> 6。编写单元测试用例。<br/> 7。选择包方案并运行您的测试用例。</p><p id="d0c4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这些实践帮助我们到达测试的好点，并且它有利于超过成本，并且它也有利于编写单元测试并尽可能地自动化它们。</p></div></div>    
</body>
</html>