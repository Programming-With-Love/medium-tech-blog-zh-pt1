<html>
<head>
<title>Share data between two applications, Flutter and Android.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Flutter和Android这两个应用程序之间共享数据。</h1>
<blockquote>原文：<a href="https://medium.com/globant/share-data-between-two-applications-flutter-and-android-1bb6e2573103?source=collection_archive---------0-----------------------#2019-07-11">https://medium.com/globant/share-data-between-two-applications-flutter-and-android-1bb6e2573103?source=collection_archive---------0-----------------------#2019-07-11</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="5d8b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第一个应用程序基于Flutter，第二个应用程序基于Android。</p><h2 id="1566" class="jc jd hh bd je jf jg jh ji jj jk jl jm ip jn jo jp it jq jr js ix jt ju jv jw bi translated">目的</h2><p id="b4dc" class="pw-post-body-paragraph ie if hh ig b ih jx ij ik il jy in io ip jz ir is it ka iv iw ix kb iz ja jb ha bi translated">第一个应用<em class="kc"> (App1) </em>会发送<strong class="ig hi"><em class="kc">userId</em></strong><em class="kc">(say 1111)</em>给第二个应用<em class="kc"> (App2) </em>。第二个应用程序<em class="kc"> (App2) </em>将使用一个<strong class="ig hi"> <em class="kc">用户名</em> </strong> <em class="kc">(比如Rana Ranvijay Singh) </em>向调用应用程序作出响应。</p><h2 id="8a27" class="jc jd hh bd je jf jg jh ji jj jk jl jm ip jn jo jp it jq jr js ix jt ju jv jw bi translated">这是什么？</h2><ol class=""><li id="6ca8" class="kd ke hh ig b ih jx il jy ip kf it kg ix kh jb ki kj kk kl bi translated">在Flutter代码和Android代码之间建立一座桥梁。</li><li id="d734" class="kd ke hh ig b ih km il kn ip ko it kp ix kq jb ki kj kk kl bi translated">将数据从第一个应用程序发送到第二个应用程序，并读回响应。</li></ol></div><div class="ab cl kr ks go kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ha hb hc hd he"><h2 id="87d3" class="jc jd hh bd je jf jg jh ji jj jk jl jm ip jn jo jp it jq jr js ix jt ju jv jw bi translated">1.在Flutter代码和Android代码之间建立一座桥梁。</h2><p id="b2e3" class="pw-post-body-paragraph ie if hh ig b ih jx ij ik il jy in io ip jz ir is it ka iv iw ix kb iz ja jb ha bi translated">首先，我们必须在第一个应用程序中使用一个叫做<a class="ae ky" href="https://flutter.dev/docs/development/platform-integration/platform-channels" rel="noopener ugc nofollow" target="_blank"> <em class="kc">平台通道</em> </a>的东西来创建Flutter代码和Android代码之间的桥梁。</p><p id="2126" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们从</p><blockquote class="kz la lb"><p id="e520" class="ie if kc ig b ih ii ij ik il im in io lc iq ir is ld iu iv iw le iy iz ja jb ha bi translated">App1 &gt; main.dart</p></blockquote><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="5d71" class="jc jd hh lk b fi lo lp l lq lr">import 'package:flutter/material.dart';<br/><br/>import 'app.dart';<br/><br/>void main() {<br/>  runApp(App());<br/>}</span></pre><blockquote class="kz la lb"><p id="b624" class="ie if kc ig b ih ii ij ik il im in io lc iq ir is ld iu iv iw le iy iz ja jb ha bi translated">App1&gt; app.dart</p></blockquote><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="5b1f" class="jc jd hh lk b fi lo lp l lq lr">import 'package:flutter/material.dart';<br/><br/>import 'homescreen.dart';<br/><br/>class App extends StatelessWidget {<br/>  build(context) {<br/>    return MaterialApp(<br/>      title: 'First Application',<br/>      home: Scaffold(<br/>        appBar: AppBar(),<br/>        body: HomeScreen(),<br/>      ),<br/>    );<br/>  }<br/>}</span></pre><blockquote class="kz la lb"><p id="a83f" class="ie if kc ig b ih ii ij ik il im in io lc iq ir is ld iu iv iw le iy iz ja jb ha bi translated">App1 &gt;主屏幕. dart</p></blockquote><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="1ed5" class="jc jd hh lk b fi lo lp l lq lr">import 'package:flutter/material.dart';<br/>import 'package:flutter/services.dart';<br/><br/>class HomeScreen extends StatefulWidget {<br/>  State&lt;StatefulWidget&gt; createState() {<br/>    return HomeState();<br/>  }<br/>}<br/><br/>class HomeState extends State&lt;HomeScreen&gt; {<br/>  static const platform = const<br/>  MethodChannel('going.native.for.userdata');</span><span id="281e" class="jc jd hh lk b fi ls lp l lq lr">  String _username = 'Data received: No data';<br/>  String _userId = '1111';<br/><br/>  Widget build(BuildContext context) {<br/>    return _body();<br/>  }<br/><br/>  Widget _body() {<br/>    return Container(<br/>      margin: EdgeInsets.only(top: 100.0),<br/>      child: Align(<br/>        alignment: Alignment(0, 0),<br/>        child: Column(<br/>          children: &lt;Widget&gt;[<br/>            Container(margin: EdgeInsets.only(top: 20.0)),<br/>            _textView('Flutter app '),<br/>            Container(margin: EdgeInsets.only(top: 80.0)),<br/>            _textView('User ID: $_userId'),<br/>            Container(margin: EdgeInsets.only(top: 20.0)),<br/>            _textView(_username),<br/>            Container(margin: EdgeInsets.only(top: 20.0)),<br/>            RaisedButton(<br/>              child: Text('Launch App2'),<br/>              onPressed: launchApp2,<br/>            )<br/>          ],<br/>        ),<br/>      ),<br/>    );<br/>  }<br/><br/>  Widget _textView(String text) {<br/>    return Text(text,textScaleFactor: 1.3,);<br/>  }<br/><br/>  Future&lt;void&gt; launchApp2() async {<br/>    String username;<br/>    try {<br/>      final result = await platform.invokeMethod('launchApp2');<br/>      username = 'Data received: $result';<br/>    } on PlatformException catch (e) {<br/>      username = 'Data received: No data';<br/>    }<br/><br/>    setState(() {<br/>      _username = username;<br/>    });<br/>  }<br/>}</span></pre><p id="09c1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以上代码是您的最终代码。</p><p id="dead" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">出于解释，这是我们创建通道的地方。</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="0206" class="jc jd hh lk b fi lo lp l lq lr">static const platform = const MethodChannel('going.native.for.userdata');</span></pre><p id="6085" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">id<strong class="ig hi"><em class="kc">going . native . for . user data</em></strong>用于标识Android端的频道。你可以把它改成任何东西，但是要确保Flutter和Android代码有相同的密钥。</p><p id="6b51" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">点击<strong class="ig hi">上的<em class="kc">启动App2 </em>上的</strong>按钮。我们使用这个通道来运行Android代码。</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="0855" class="jc jd hh lk b fi lo lp l lq lr">final result = await platform.invokeMethod('launchApp2');</span></pre><p id="e497" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这等待结果，然后向前移动。</p><p id="5e11" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在安卓方面。</p><blockquote class="kz la lb"><p id="8771" class="ie if kc ig b ih ii ij ik il im in io lc iq ir is ld iu iv iw le iy iz ja jb ha bi translated">附录1 MainActivity.java</p></blockquote><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="16b2" class="jc jd hh lk b fi lo lp l lq lr">public class MainActivity extends FlutterActivity {<br/> private static final String INTENT_ACTION =<br/>  "com.example.app1.userdata";<br/><br/> private static MethodChannel.Result result;<br/><br/> @Override<br/> protected void onCreate(Bundle savedInstanceState) {<br/>  super.onCreate(savedInstanceState);<br/>  GeneratedPluginRegistrant.registerWith(this);<br/>  new MethodChannel(<br/>   getFlutterView(), <br/>   "going.native.for.userdata")<br/>  .setMethodCallHandler(callHandler);<br/> }</span><span id="86f4" class="jc jd hh lk b fi ls lp l lq lr"> private MethodChannel.MethodCallHandler callHandler = new<br/> MethodChannel.MethodCallHandler() {<br/><br/>  @Override<br/>  public void onMethodCall(MethodCall methodCall,<br/>  MethodChannel.Result result) {<br/>   MainActivity.result = result;<br/>   launchApp2();<br/>  }<br/> };<br/><br/> @SuppressLint("NewApi")<br/> private void launchApp2() {<br/>  Intent sendIntent = new Intent();<br/>  sendIntent.setAction(INTENT_ACTION);<br/>  Bundle bundle = new Bundle();<br/>  bundle.putString("user_id","1111");<br/>  sendIntent.putExtra("data",bundle);<br/>  sendIntent.setType("text/plain");<br/>  if (sendIntent.resolveActivity(getPackageManager())! = null) {<br/>   startActivityForResult(sendIntent,11);<br/>  }<br/> }<br/><br/> @Override<br/> protected void onActivityResult(int req, int res, Intent data) {<br/>  if (req == 11) {<br/>   if (res == Activity.RESULT_OK) {<br/>     Bundle bundle = data.getBundleExtra("data");<br/>     String username = bundle.getString("username");<br/>     result.success(username);<br/>    }<br/>   } else {<br/>    super.onActivityResult(req, res, data);<br/>   }<br/>  }<br/>}</span></pre><p id="c3d3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以上是你的最终代码。</p><p id="01f8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你需要有一个方法通道来接受Flutter代码的调用，并等待响应。通道<strong class="ig hi"><em class="kc">going . native . for . user data</em></strong><em class="kc"/>将与颤振代码中使用的通道相同。</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="a774" class="jc jd hh lk b fi lo lp l lq lr">new MethodChannel(getFlutterView(), "going.native.for.userdata")<br/>.setMethodCallHandler(callHandler);</span></pre><p id="f6d8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">调用处理程序将接收来自Flutter的调用，并将结果设置回结果中，以将其返回给Flutter代码。</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="547e" class="jc jd hh lk b fi lo lp l lq lr"><strong class="lk hi"> </strong>@Override<br/> public void onMethodCall(...) {<br/>   MainActivity.result = result;<br/>   launchApp2();<br/> }<br/> <br/> result.success(username);</span></pre></div><div class="ab cl kr ks go kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ha hb hc hd he"><h2 id="77dc" class="jc jd hh bd je jf jg jh ji jj jk jl jm ip jn jo jp it jq jr js ix jt ju jv jw bi translated">2.将数据从第一个应用程序发送到第二个应用程序，并读回响应。</h2><p id="ecf6" class="pw-post-body-paragraph ie if hh ig b ih jx ij ik il jy in io ip jz ir is it ka iv iw ix kb iz ja jb ha bi translated">为了实现这一点，我们简单地使用隐式意图来启动第二个应用程序并发送包中的数据。我们将使用<strong class="ig hi"><em class="kc">startActivityForResult</em></strong><em class="kc"/>并将在<strong class="ig hi"><em class="kc">on activity result</em></strong><em class="kc">中读取响应。</em></p><p id="d28b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你的<strong class="ig hi"><em class="kc">MainActivity.java</em></strong>来自上面给出的第一个app。</p><p id="8e95" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们使用特定动作来启动第二个应用程序。</p><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="1bf1" class="jc jd hh lk b fi lo lp l lq lr">private static final String INTENT_ACTION = "com.example.app1.userdata";</span></pre><p id="3fcc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="kc">需要在第二个应用程序清单文件中针对该活动注册相同的操作。我给了&lt;包名&gt;.用户数据</em> </strong></p><blockquote class="kz la lb"><p id="dbc4" class="ie if kc ig b ih ii ij ik il im in io lc iq ir is ld iu iv iw le iy iz ja jb ha bi translated">App2 &gt; AndroidManifest.xml</p></blockquote><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="fead" class="jc jd hh lk b fi lo lp l lq lr">&lt;activity android:name = ".UserLoginActivity"&gt;<br/> &lt;intent-filter&gt;<br/>  &lt;!--The action has to be same as App1--&gt;<br/>   &lt;action android:name = "com.example.app1.userdata" /&gt;<br/>   &lt;category android:name = "android.intent.category.DEFAULT" /&gt;<br/>   &lt;data android:mimeType = "text/plain" /&gt;<br/>  &lt;/intent-filter&gt;<br/>&lt;/activity&gt;</span></pre><blockquote class="kz la lb"><p id="9596" class="ie if kc ig b ih ii ij ik il im in io lc iq ir is ld iu iv iw le iy iz ja jb ha bi translated">App2 &gt; UserLoginActivity.kt</p></blockquote><pre class="lf lg lh li fd lj lk ll lm aw ln bi"><span id="8af6" class="jc jd hh lk b fi lo lp l lq lr">class UserLoginActivity : AppCompatActivity() {<br/><br/> override fun onResume() {<br/>  super.onResume()<br/>  var userId = "No data received"<br/>  val intent = intent<br/>  if (intent != null<br/>      &amp;&amp; intent.action != null<br/>      &amp;&amp; intent.action.equals("com.example.app1.userdata")) <br/>  {<br/>   val bundle = intent.getBundleExtra("data")<br/>   if (bundle != null) {<br/>    userId = bundle.getString("user_id")<br/>    userId = " User id is $userId"<br/>   }<br/>  }<br/>  tvMessage.text = "Data Received: $userId"<br/> }<br/><br/> fun onClickLoginButton(view: View) {<br/>  val intent = intent<br/>  val bundle = Bundle()<br/>  bundle.putString("username", "Rana Ranvijay Singh")<br/>  intent.putExtra("data", bundle)<br/>  setResult(Activity.RESULT_OK, intent)<br/>  finish()<br/> }<br/>}</span></pre><p id="d4c7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">完成了。</p></div></div>    
</body>
</html>