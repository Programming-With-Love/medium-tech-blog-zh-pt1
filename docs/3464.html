<html>
<head>
<title>Kubeflow on AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS上的Kubeflow</h1>
<blockquote>原文：<a href="https://medium.com/globant/kubeflow-on-aws-ee50d211cf2b?source=collection_archive---------0-----------------------#2020-08-20">https://medium.com/globant/kubeflow-on-aws-ee50d211cf2b?source=collection_archive---------0-----------------------#2020-08-20</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="c344" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本文中，我将简要介绍Kubeflow，并展示在AWS上安装和设置Kubeflow的步骤。在开始技术步骤和命令之前，让我们先看看什么是Kubeflow，并理解它的用例。</p><h1 id="03ce" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">介绍</h1><p id="a4bf" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">每个利用机器学习(ML)的组织的最终目标都是让他们的ML模型成功地在生产中运行，并为企业创造价值。但是，达到这一点需要什么呢？</p><p id="789d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在模型投入生产之前，可能需要许多步骤来构建和部署ML模型:数据加载、验证、分割、处理、特征工程、模型训练和验证、超参数调整和模型服务。</p><p id="6b35" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">此外，ML模型可能比传统应用程序需要更多的观察，因为您的数据输入可能会随时间漂移。手动重建模型和数据集既耗时又容易出错。</p><p id="8fdc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了简化这些需求和挑战，Kubeflow应运而生。</p><p id="7b5f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Kubeflow基于可移植性和可伸缩性原则，利用了Kubernetes的底层功能。可移植性意味着模型和应用程序不是特定于平台的，可以跨多个云提供商工作。借助K8S的可伸缩性，用户可以轻松地向应用程序添加资源。</p><h1 id="70a5" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">关于Kubeflow</h1><p id="a5d3" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">下图提供了Kubeflow的概念性概述，描述了ML系统的关键组件。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div class="er es kf"><img src="../Images/f00f93d6da08927d8f256006ee0881b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:120/0*-8XfbkB8Ft75csA3"/></div></figure><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es kn"><img src="../Images/2d202af27ab2d0922b5eb3b385f79592.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*f_WdTwwHr4zAiiZG"/></div></div></figure><p id="d313" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">每个组件的简要说明如下:</p><h1 id="b921" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">ML工具</h1><ul class=""><li id="7926" class="ks kt hh ig b ih ka il kb ip ku it kv ix kw jb kx ky kz la bi translated">Chainer  —一个强大、灵活、直观的神经网络框架。</li><li id="50cc" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://jupyter.org/#:~:text=The%20Jupyter%20Notebook%20is%20an,machine%20learning%2C%20and%20much%20more." rel="noopener ugc nofollow" target="_blank">Jupyter</a>——一个开源的网络应用程序，允许你创建和分享包含实时代码、方程式、可视化和叙述性文本的文档。用途包括:数据清理和转换、数值模拟、统计建模、数据可视化、机器学习等等。</li><li id="89ad" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://github.com/kubeflow/mpi-operator" rel="noopener ugc nofollow" target="_blank">MPI</a>—kube flow中的MPI operator使得在Kubernetes上运行所有reduce风格的分布式培训变得容易。</li><li id="9d09" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://mxnet.apache.org/versions/1.6/" rel="noopener ugc nofollow" target="_blank"> MXNet </a> —深度学习的灵活高效库。</li><li id="ad07" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://pytorch.org/" rel="noopener ugc nofollow" target="_blank"> PyTorch </a> —开源深度学习平台，提供从研究原型到生产部署的无缝路径。</li><li id="8a4b" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://scikit-learn.org/stable/" rel="noopener ugc nofollow" target="_blank">sci kit-learn</a>—sci kit-learn提供了数十种内置的机器学习算法和模型。</li><li id="2cae" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://www.tensorflow.org/" rel="noopener ugc nofollow" target="_blank"> TensorFlow </a> —一个端到端的开源机器学习平台，它是一个符号数学库，用于神经网络等机器学习应用。</li><li id="6a0e" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://xgboost.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank"> XGBoost </a> —这是一个优化的分布式梯度增强库，旨在高效、灵活和可移植。它在梯度推进框架下实现机器学习算法。</li></ul><h1 id="6876" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">Kubeflow组件</h1><ul class=""><li id="b3a9" class="ks kt hh ig b ih ka il kb ip ku it kv ix kw jb kx ky kz la bi translated"><a class="ae lb" href="https://jupyter.org/hub" rel="noopener ugc nofollow" target="_blank"> Jupyterhub </a> —为公司、教室和研究实验室设计的多用户版本的笔记本电脑。</li><li id="1bf1" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://github.com/kubeflow/chainer-operator" rel="noopener ugc nofollow" target="_blank"> Chainer Operator </a> —提供一个Kubernetes定制资源来运行分布式或非分布式链接作业。</li><li id="01b3" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://github.com/kubeflow/mpi-operator" rel="noopener ugc nofollow" target="_blank"> MPI操作员</a> — Kubernetes操作员，用于全还原式分布式培训。</li><li id="67d1" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://github.com/kubeflow/mxnet-operator" rel="noopener ugc nofollow" target="_blank"> MXNet操作员</a> — Kubernetes操作员运行分布式或非分布式MXNet作业以进行培训和调整。</li><li id="f6d0" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://github.com/kubeflow/pytorch-operator" rel="noopener ugc nofollow" target="_blank"> PyTorch操作员</a> —提供创建和管理PyTorch作业的资源。</li><li id="2c9c" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://github.com/kubeflow/tf-operator" rel="noopener ugc nofollow" target="_blank"> TFJob Operator </a> — TFJob提供了一个Kubernetes自定义资源，可以轻松地在Kubernetes上运行分布式或非分布式TensorFlow作业。</li><li id="ca18" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://github.com/kubeflow/xgboost-operator" rel="noopener ugc nofollow" target="_blank"> XGBoot操作员</a> —这是<a class="ae lb" href="https://github.com/dmlc/xgboost" rel="noopener ugc nofollow" target="_blank">XG boot</a>操作员的孵化项目。XGBoost操作符使得在Kubernetes集群上运行分布式XGBoost作业培训和批量预测变得很容易。</li><li id="825d" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://github.com/kubeflow/katib" rel="noopener ugc nofollow" target="_blank"> Katlib </a> — Katib是一个基于Kubernetes的系统，用于<a class="ae lb" href="https://en.wikipedia.org/wiki/Hyperparameter_optimization" rel="noopener ugc nofollow" target="_blank">超参数调整</a>和神经架构搜索。Katib支持许多ML框架，包括TensorFlow、Apache MXNet、PyTorch、XGBoost等。</li><li id="350a" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://github.com/kubeflow/fairing" rel="noopener ugc nofollow" target="_blank">整流罩</a> — Kubeflow整流罩是一个Python包，它简化了在混合云环境中构建、训练和部署机器学习(ML)模型的过程。通过使用Kubeflow整流并添加几行代码，您可以直接从Python代码或Jupyter笔记本在本地或云中运行您的ML训练作业。训练工作完成后，您可以使用kube flow strength将训练好的模型部署为预测端点。</li><li id="7e8c" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://github.com/kubeflow/metadata" rel="noopener ugc nofollow" target="_blank">元数据</a> —元数据相关资产的存储库。</li><li id="73bf" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://github.com/kubeflow/pipelines" rel="noopener ugc nofollow" target="_blank">管道</a> — Kubeflow管道是使用Kubeflow管道SDK构建的可重复使用的端到端ML工作流。</li><li id="0a7c" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://www.kubeflow.org/docs/components/central-dash/overview/" rel="noopener ugc nofollow" target="_blank"> Kubeflow UI </a> —跟踪所有组件的中央仪表盘。</li><li id="d913" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://www.kubeflow.org/docs/components/serving/kfserving/" rel="noopener ugc nofollow" target="_blank"> KFServing </a> — KFServing支持Kubernetes上的无服务器推理，并为TensorFlow、XGBoost、scikit-learn、PyTorch和ONNX等常见机器学习(ML)框架提供高性能、高抽象的接口，以解决生产模型服务用例。</li><li id="2677" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://v0-6.kubeflow.org/docs/components/serving/tfbatchpredict/" rel="noopener ugc nofollow" target="_blank"> TensorFlow批处理预测</a> —允许用户在批处理模式下以SavedModel格式对经过训练的TensorFlow模型运行预测作业。</li><li id="aa75" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://pytorch.org/blog/model-serving-in-pyorch/#:~:text=This%20is%20an%20application%20built,of%20managing%20and%20serving%20models." rel="noopener ugc nofollow" target="_blank"> PyTorch Serving </a> —它允许您上传多个模型，并为每个模型获取不同的预测终点。通常这样的系统包括许多其他的特性来帮助解决更多的管理和服务模型的问题。</li><li id="341b" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://www.tensorflow.org/tfx/guide/serving" rel="noopener ugc nofollow" target="_blank"> TensorFlow serving </a> —这是一个灵活、高性能的机器学习模型服务系统，专为生产环境而设计。TensorFlow服务可以轻松部署新的算法和实验，同时保持相同的服务器架构和API。</li><li id="c64e" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://docs.seldon.io/projects/seldon-core/en/v0.4.0/#:~:text=Seldon%20Core%20is%20an%20open,the%20cloud%20or%20on%2Dpremise.&amp;text=Provide%20a%20consistent%20serving%20layer%20for%20models%20built%20using%20heterogeneous%20ML%20toolkits." rel="noopener ugc nofollow" target="_blank"> Seldon core </a> —在Kubernetes集群上部署机器学习模型的开源平台。在云中或内部部署机器学习模型。为使用异构ML工具包构建的模型提供一致的服务层。</li><li id="5bd2" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://cloud.google.com/istio" rel="noopener ugc nofollow" target="_blank"> Istio </a> —这是一个开源的独立服务网格，提供了成功运行分布式微服务架构所需的基础。Istio通过提供统一的方法来保护、连接和监控微服务，降低了管理微服务部署的复杂性。</li><li id="c818" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://argoptoj.github.io/argo" rel="noopener ugc nofollow" target="_blank">Argo</a>—Kubernetes的一个健壮的工作流引擎，支持将工作流中的每个步骤作为一个容器来实现。</li><li id="89a6" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated">Prometheus  —系统监控和警报工具包。</li><li id="cde0" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated"><a class="ae lb" href="https://github.com/kubernetes-incubator/spartakus" rel="noopener ugc nofollow" target="_blank"> Spartakus </a> —它用于报告和收集指标。</li></ul><h1 id="7933" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">在AWS上安装Kubeflow的步骤</h1><h1 id="def3" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">先决条件:</h1><ul class=""><li id="243c" class="ks kt hh ig b ih ka il kb ip ku it kv ix kw jb kx ky kz la bi translated">安装kubectl。</li><li id="dbc4" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated">安装和配置AWS命令行界面(AWS CLI):</li></ul><pre class="kg kh ki kj fd lh li lj lk aw ll bi"><span id="0646" class="lm jd hh li b fi ln lo l lp lq">1. Install the <a class="ae lb" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html" rel="noopener ugc nofollow" target="_blank">AWS Command Line Interface</a>.<br/>2. Configure the AWS CLI by running the following command: <br/>           <strong class="li hi">Command:</strong> aws configure<br/>3. Enter your Access Keys (<a class="ae lb" href="https://docs.aws.amazon.com/general/latest/gr/aws-sec-cred-types.html#access-keys-and-secret-access-keys" rel="noopener ugc nofollow" target="_blank">Access Key ID and Secret Access Key</a>).<br/>4. Enter your preferred AWS Region and default output options.</span></pre><ul class=""><li id="2fe2" class="ks kt hh ig b ih ii il im ip lr it ls ix lt jb kx ky kz la bi translated">安装eksctl(版本0.1.31或更高版本)和aws-iam-authenticator。</li></ul><h1 id="35da" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">创建EKS集群:</h1><p id="0906" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">使用AWS EKS CLI、CloudFormation或Terraform、AWS CDK或eksctl，可以通过多种方式调配EKS集群。如果这是您第一次<strong class="ig hi">创建</strong>亚马逊<strong class="ig hi"> EKS集群</strong>建议使用eksctl创建EKS集群，因为它会自动满足所有基础架构供应需求。您只需使用eksctl工具传递参数，如下所示。即创建自动调用者、设置VPC、rbac认证等。</p><pre class="kg kh ki kj fd lh li lj lk aw ll bi"><span id="02c8" class="lm jd hh li b fi ln lo l lp lq"><strong class="li hi">Example: </strong>eksctl create cluster \<br/>         --name prod \<br/>         --version 1.17 \<br/>         --region us-west-2 \<br/>         --nodegroup-name linux-nodes \<br/>         --node-type t3.medium \<br/>         --nodes 3 \<br/>         --nodes-min 1 \<br/>         --nodes-max 4 \<br/>         --ssh-access \<br/>         --ssh-public-key my-public-key.pub \<br/>         --managed</span></pre><h1 id="30b7" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">准备您的环境:</h1><p id="1ff5" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">为了在现有的亚马逊EKS集群上部署Kubeflow，您需要提供AWS_CLUSTER_NAME、集群区域和worker角色。按照以下步骤为Kubeflow CLI下载kfctl二进制文件，并设置一些方便的环境变量:</p><ol class=""><li id="a2d2" class="ks kt hh ig b ih ii il im ip lr it ls ix lt jb lu ky kz la bi translated">从kubeflow发布页面下载kfctl v1.1.0版本。</li><li id="c3a5" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb lu ky kz la bi translated">打开焦油球包装:</li></ol><pre class="kg kh ki kj fd lh li lj lk aw ll bi"><span id="dccb" class="lm jd hh li b fi ln lo l lp lq"><strong class="li hi">Command: </strong>tar -xvf kfctl_v1.1.0_&lt;platform&gt;.tar.gz</span></pre><p id="e91a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3.创建环境变量以简化部署过程:</p><ul class=""><li id="d6ad" class="ks kt hh ig b ih ii il im ip lr it ls ix lt jb kx ky kz la bi translated">将kfctl添加到PATH中，以使kfctl二进制文件更易于使用:</li></ul><pre class="kg kh ki kj fd lh li lj lk aw ll bi"><span id="5c76" class="lm jd hh li b fi ln lo l lp lq"><strong class="li hi">Command:</strong> export PATH=$PATH:"&lt;path to kfctl&gt;"</span></pre><ul class=""><li id="e7bb" class="ks kt hh ig b ih ii il im ip lr it ls ix lt jb kx ky kz la bi translated">使用以下kfctl配置文件进行AWS设置，无需验证:</li></ul><pre class="kg kh ki kj fd lh li lj lk aw ll bi"><span id="06ce" class="lm jd hh li b fi ln lo l lp lq"><strong class="li hi">Command:</strong> export CONFIG_URI="https://raw.githubusercontent.com/kubeflow/manifests/v1.1-branch/kfdef/kfctl_aws.v1.1.0.yaml"</span></pre><ul class=""><li id="18eb" class="ks kt hh ig b ih ii il im ip lr it ls ix lt jb kx ky kz la bi translated">或者，如果要启用身份验证、授权和多用户，请使用以下kfctl配置:</li></ul><pre class="kg kh ki kj fd lh li lj lk aw ll bi"><span id="110a" class="lm jd hh li b fi ln lo l lp lq"><strong class="li hi">Command:</strong> export CONFIG_URI="https://raw.githubusercontent.com/kubeflow/manifests/v1.1-branch/kfdef/kfctl_aws_cognito.v1.1.0.yaml"</span></pre><ul class=""><li id="bbdd" class="ks kt hh ig b ih ii il im ip lr it ls ix lt jb kx ky kz la bi translated">为AWS集群名设置一个环境变量:</li></ul><pre class="kg kh ki kj fd lh li lj lk aw ll bi"><span id="bbe1" class="lm jd hh li b fi ln lo l lp lq"><strong class="li hi">Command: </strong>export AWS_CLUSTER_NAME=&lt;YOUR EKS CLUSTER NAME&gt;</span></pre><ul class=""><li id="b961" class="ks kt hh ig b ih ii il im ip lr it ls ix lt jb kx ky kz la bi translated">创建要存储部署的目录，该目录必须是${AWS_CLUSTER_NAME}:</li></ul><pre class="kg kh ki kj fd lh li lj lk aw ll bi"><span id="b512" class="lm jd hh li b fi ln lo l lp lq"><strong class="li hi">Command: </strong>mkdir ${AWS_CLUSTER_NAME} &amp;&amp; cd ${AWS_CLUSTER_NAME}</span></pre><ul class=""><li id="fde1" class="ks kt hh ig b ih ii il im ip lr it ls ix lt jb kx ky kz la bi translated">下载您的配置文件，以便您可以在部署Kubeflow之前定制配置:</li></ul><pre class="kg kh ki kj fd lh li lj lk aw ll bi"><span id="da9c" class="lm jd hh li b fi ln lo l lp lq"><strong class="li hi">Command: </strong>wget -O kfctl_aws.yaml $CONFIG_URI</span></pre><h1 id="17eb" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">配置kubeflow:</h1><p id="c838" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">我们可以用两种方式配置kubeflow:</p><p id="fd91" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">选项1:将IAM用于服务帐户</strong></p><p id="5aa9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">kfctl将帮助创建或重用IAM OIDC身份提供者，创建角色并处理与Kubernetes服务帐户的信任关系绑定。</p><p id="ea01" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">注意:</strong>默认情况下，我们不会为KF-user-$ { region }-$ { cluster _ name }附加任何策略，您可以根据需要附加策略。</p><p id="db80" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在＄{ CONFIG _ URI }文件中添加enablePodIamPolicy: true:</p><pre class="kg kh ki kj fd lh li lj lk aw ll bi"><span id="a595" class="lm jd hh li b fi ln lo l lp lq">region: us-west-2<br/>enablePodIamPolicy: true</span><span id="dc85" class="lm jd hh li b fi lv lo l lp lq"># you can delete following roles settings.<br/>#roles:<br/>#- eksctl-kubeflow-example-nodegroup-ng-185-NodeInstanceRole-1DDJJXQBG9EM6</span></pre><p id="4636" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">选项2:使用节点组角色</strong></p><ol class=""><li id="3c69" class="ks kt hh ig b ih ii il im ip lr it ls ix lt jb lu ky kz la bi translated">检索工作节点的AWS区域和IAM角色名。要获取Amazon EKS工作节点的IAM角色名，请运行以下命令:</li></ol><pre class="kg kh ki kj fd lh li lj lk aw ll bi"><span id="2000" class="lm jd hh li b fi ln lo l lp lq">aws iam list-roles \<br/>    | jq -r ".Roles[] \<br/>    | select(.RoleName \<br/>    | startswith(\"eksctl-$AWS_CLUSTER_NAME\") and contains(\"NodeInstanceRole\")) \<br/>    .RoleName"</span><span id="52f1" class="lm jd hh li b fi lv lo l lp lq">eksctl-kubeflow-example-nodegroup-ng-185-NodeInstanceRole-1DDJJXQBG9EM6</span></pre><p id="395a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.在kfctl_aws.yaml文件中更改集群区域和工作角色名称:</p><pre class="kg kh ki kj fd lh li lj lk aw ll bi"><span id="07ed" class="lm jd hh li b fi ln lo l lp lq">region: us-west-2<br/>roles:<br/>- eksctl-kubeflow-example-nodegroup-ng-185-NodeInstanceRole-1DDJJXQBG9EM6</span></pre><h1 id="5e2c" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">部署Kubeflow:</h1><ol class=""><li id="78e6" class="ks kt hh ig b ih ka il kb ip ku it kv ix kw jb lu ky kz la bi translated">运行以下命令来初始化Kubeflow集群:</li></ol><pre class="kg kh ki kj fd lh li lj lk aw ll bi"><span id="3e17" class="lm jd hh li b fi ln lo l lp lq"><strong class="li hi">Command:</strong> kfctl apply -V -f kfctl_aws.yaml</span></pre><p id="47ff" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.等待kubeflow名称空间中的所有资源准备就绪:</p><pre class="kg kh ki kj fd lh li lj lk aw ll bi"><span id="805b" class="lm jd hh li b fi ln lo l lp lq"><strong class="li hi">Command: </strong>kubectl -n kubeflow get all</span></pre><p id="f709" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">访问Kubeflow中央仪表盘:</strong></p><p id="ca5c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">运行以下命令获取Kubeflow服务的端点主机名，并在浏览器中复制链接。</p><pre class="kg kh ki kj fd lh li lj lk aw ll bi"><span id="290e" class="lm jd hh li b fi ln lo l lp lq"><strong class="li hi">Command: </strong>kubectl get ingress -n istio-system</span><span id="6335" class="lm jd hh li b fi lv lo l lp lq">NAMESPACE      NAME            HOSTS   ADDRESS                                                             PORTS   AGE<br/>istio-system   istio-ingress   *       a743484b-istiosystem-istio-2af2-xxxxxx.us-west-2.elb.amazonaws.com   80      1h</span></pre><figure class="kg kh ki kj fd kk er es paragraph-image"><div class="er es kf"><img src="../Images/af41386761de4e3901fe0c3e2dd2899f.png" data-original-src="https://miro.medium.com/v2/resize:fit:120/0*za-Ou1KjiT7UtcQ6"/></div></figure><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es lw"><img src="../Images/df9000fc875c9c333f1da15a277cc5b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZRC3KGFClRnxLxNN"/></div></div></figure><h1 id="ef50" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">主要学习内容</h1><p id="b639" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">根据安装该工具的经验，可以观察到以下几点:</p><ul class=""><li id="d762" class="ks kt hh ig b ih ii il im ip lr it ls ix lt jb kx ky kz la bi translated">请注意，每个实例类型的每个节点都有POD限制。在AWS中，最大Pod限制基于实例类型。我们不能更改每个节点的单元数量，因此在调配基础架构时选择节点非常重要。</li><li id="23c0" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated">Kubeflow文档是一个很好的开端，但用户应该熟悉kubernetes/集装箱化平台来设置kubeflow。</li><li id="5691" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated">当我们使用eksctl工具创建EKS集群时，它会自动创建并执行两个云结构堆栈，一个用于集群，另一个用于节点组。我们可以通过CloudFormation堆栈事件跟踪集群和节点创建的进度。</li><li id="4e88" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated">我们需要一台专用的机器/服务器，用于安装和设置使用eksctl启动EKS集群所需的所有工具，例如kubectl、kfctl、eksctl和aws-iam-authenticator。</li><li id="32f5" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated">由于EKS主机完全由AWS自己管理，我们在那里没有任何控制权，因此在撰写本文时启动/停止选项不可用，但是我们可以控制属于同一个集群的worker-nodes，根据需要调整其大小。这些动作也可以通过手动或使用自动缩放功能来处理。这取决于您如何启动集群。</li></ul><h1 id="aa78" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">摘要</h1><ul class=""><li id="0631" class="ks kt hh ig b ih ka il kb ip ku it kv ix kw jb kx ky kz la bi translated">Kubeflow是一个面向数据科学家和ML工程师的平台，他们希望在各种环境中构建和部署ML系统，用于开发、测试和生产级服务。</li><li id="3623" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated">Kubeflow可以根据用户需求托管在托管和自托管的kubernetes集群上。</li><li id="aab2" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated">要在AWS上设置kubeflow，我们需要首先创建EKS集群，可以使用AWS EKS CLI、CloudFormation或Terraform、AWS CDK或eksctl以多种方式进行配置。</li><li id="2e9b" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated">为了在现有的亚马逊EKS集群上部署Kubeflow，您需要提供AWS_CLUSTER_NAME、集群区域和worker角色。</li><li id="bfb5" class="ks kt hh ig b ih lc il ld ip le it lf ix lg jb kx ky kz la bi translated">AWS上的Kubeflow可以通过两种方式进行配置，一种是将IAM用于服务帐户，另一种是节点组角色。</li></ul></div></div>    
</body>
</html>