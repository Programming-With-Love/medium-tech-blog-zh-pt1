<html>
<head>
<title>Database Inspector</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据库检查器</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/database-inspector-9e91aa265316?source=collection_archive---------0-----------------------#2020-04-17">https://medium.com/androiddevelopers/database-inspector-9e91aa265316?source=collection_archive---------0-----------------------#2020-04-17</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/489cd7cf85281136cc35f061580a6a32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fsiieKz_0I_MbqYwhXdsrA.png"/></div></div></figure><div class=""/><div class=""><h2 id="e432" class="pw-subtitle-paragraph ip hr hs bd b iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg dx translated">我们期待已久的实时数据库工具！</h2></div><p id="f419" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">创建和管理本地数据库是大多数移动应用的核心组件。但是不管你是直接使用<strong class="jj ht"> SQLite </strong>还是通过<a class="ae kd" href="https://developer.android.com/topic/libraries/architecture/room" rel="noopener ugc nofollow" target="_blank"> <strong class="jj ht"> Room </strong> </a>持久性库，Android开发者一直在寻求一种更好的方法来检查和调试他们正在运行的应用程序中的数据库。要了解更多信息，请观看视频或阅读下面的博客。</p><figure class="ke kf kg kh fd hj"><div class="bz dy l di"><div class="ki kj l"/></div></figure><p id="afb1" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">最新版本的Android Studio 4.1(目前在Canary中可用)附带了一个名为<strong class="jj ht">数据库检查器</strong>、<strong class="jj ht"> </strong>的新工具，可以帮助您检查、查询和修改正在运行的应用程序中的数据库。</p><figure class="ke kf kg kh fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es kk"><img src="../Images/30920fc380492f38e14dac56e335d0f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*L-jzOKs-4UTaQDXScsJ00w.gif"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx">Database Inspector helps you to modify the data just like editing a spreadsheet.</figcaption></figure><p id="4857" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">使用Database Inspector，修改数据库中的数据并不比编辑电子表格困难多少；如果您正在使用Room并观察查询结果，这些变化将立即反映在您的应用程序中！</p><p id="f2f3" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">在本帖中，我们将使用带有<a class="ae kd" href="https://github.com/android/sunflower" rel="noopener ugc nofollow" target="_blank"> <strong class="jj ht">向日葵</strong> </a> app的数据库检查器来测试一些边缘案例。向日葵是一个园艺应用程序，它用Android Jetpack展示了Android开发的最佳实践。我鼓励你克隆回购协议，并在阅读这篇文章时跟随它。</p></div><div class="ab cl kp kq go kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="ha hb hc hd he"><h1 id="482a" class="kw kx hs bd ky kz la lb lc ld le lf lg iy lh iz li jb lj jc lk je ll jf lm ln bi translated">开始</h1><p id="8ef7" class="pw-post-body-paragraph jh ji hs jj b jk lo it jm jn lp iw jp jq lq js jt ju lr jw jx jy ls ka kb kc ha bi translated">向日葵应用程序的用户界面包括两个选项卡。为了给我的花园添加一些植物，让我们看看<strong class="jj ht">植物列表</strong>选项卡，它列出了我的花园可用的植物。在右上角，有一个过滤器按钮。当我按下此按钮时，会显示以下植物列表:</p><figure class="ke kf kg kh fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lt"><img src="../Images/72f4b0c3401178f50c94b6597ee1ae80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ow5tMzyqxNmEOlrR-41Rsw.png"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx">Click to filter Plant List</figcaption></figure><p id="3888" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">显然，这个按钮根据一些标准过滤植物。但是让我们假设我对这个项目不是很熟悉，我想通过使用Database Inspector弄清楚过滤是如何工作的。</p><p id="9dbb" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">要在Android Studio中打开数据库检查器，我需要从菜单栏中选择<strong class="jj ht">视图&gt;工具窗口&gt;数据库检查器</strong>。</p><figure class="ke kf kg kh fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lu"><img src="../Images/5e84eff03e7dcd5c2d8ce5366ef9b038.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*M3VF-E0jPElPb8Mnfy6_gg.gif"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx">Select View &gt; Tool Windows &gt; Database Inspector from the menu bar to open Database Inspector.</figcaption></figure><p id="2c51" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">这将打开数据库检查器。</p><figure class="ke kf kg kh fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lv"><img src="../Images/a8173d6c1c4f5920d51bcae465c156a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iTxVjNIHImMaO_w8tsoWWQ.png"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx">Database Inspector window</figcaption></figure><p id="a046" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">现在，我需要在运行API级别26或更高的设备上运行应用程序，然后从下拉菜单中选择应用程序流程。</p><figure class="ke kf kg kh fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lw"><img src="../Images/1c2b73b755384694950a838f759d63f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tsNHeckfiUA0pNqbtR3ilw.png"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx">Select the running app process from the dropdown menu.</figcaption></figure><p id="8b0b" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">在我选择了要检查的应用程序进程后，数据库模式出现在下面的面板中。要查看Sunflower数据库表，我需要展开<strong class="jj ht">…/databases/Sunflower-db</strong>模式。</p><figure class="ke kf kg kh fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lx"><img src="../Images/43b4b4009e2e92fdb3bc7eefcba3e444.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9d-9EWX5GgkjluyWLF2kKA.png"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx">Once you select a process, the app databases are listed.</figcaption></figure><p id="8291" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">让我们回到应用程序，看看过滤后的植物列表。名单中有<em class="ly">牛油果</em>、<em class="ly">葡萄</em>、<em class="ly">橙子</em>和<em class="ly">番茄</em>。如果我能把植物表按植物名称排序，就不难找到<em class="ly">鳄梨</em>。让我们看看数据库检查员是否能做到这一点！</p><p id="26fd" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">首先，我双击<em class="ly"> plants </em>表来显示它的数据。数据显示的默认页面大小为50，但是您可以减少这个数字，并在较短的结果列表之间分页。点击<em class="ly">名称</em>列，根据条目名称对<em class="ly">工厂</em>表进行排序。不出所料，<em class="ly">鳄梨</em>在列表的下方不远，我在表格的第二行找到了它。</p><h1 id="87a4" class="kw kx hs bd ky kz lz lb lc ld ma lf lg iy mb iz li jb mc jc lk je md jf lm ln bi translated">查询您的数据库</h1><p id="8eb5" class="pw-post-body-paragraph jh ji hs jj b jk lo it jm jn lp iw jp jq lq js jt ju lr jw jx jy ls ka kb kc ha bi translated">查看<em class="ly"> Avocado </em>的数据条目，<em class="ly"> growZoneNumber </em>很可能是应用程序用于过滤的属性。为了验证这一点，让我们在<em class="ly"> growZoneNumber，</em>上运行一个查询，对于<em class="ly"> Avocado </em>来说是9。实际上，这个查询已经存在于PlantDao.kt中，我可以直接从Room的<em class="ly"> @Query </em>注释中运行这个查询。每个<em class="ly"> @Query </em>注释的行号旁边都有一个小的运行图标。</p><p id="2a91" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">当我点击getPlantsWithGrowZoneNumber()查询的运行图标并选择正确的数据库时，会出现一个弹出窗口，询问我<em class="ly"> :growZoneNumber </em>的值。</p><figure class="ke kf kg kh fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lu"><img src="../Images/3b82ddecbacf643dd5ee7d71ac7ad424.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*qYx-SooqaRJdXrn8G7zhKQ.gif"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx">You can run queries directly from @Query annotation.</figcaption></figure><p id="89f7" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">我可以输入值<em class="ly"> 9 </em>并点击<strong class="jj ht">运行</strong>来查看查询结果。</p><p id="e857" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">或者，我可以键入自己的查询并在工具窗口中运行它。这给了我更多的自由，因为我不局限于在DAO接口中定义的查询。要运行我自己的查询，我单击<strong class="jj ht"> Run SQL </strong>并从右边新打开的选项卡中选择<em class="ly"> plants </em>数据库。</p><figure class="ke kf kg kh fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es me"><img src="../Images/7fba790918b1be267eb3e8d04f1854c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rn9FE3Gx7tNrOjViC3W7NA.png"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx">Click Run SQL and select the app database.</figcaption></figure><p id="9fec" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">接下来，我在数据库选择下拉列表旁边的框中键入以下查询，并单击<strong class="jj ht">运行</strong>。</p><p id="96b3" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">"<em class="ly">Select * from plants where grow zone number = 9</em>"</p><figure class="ke kf kg kh fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mf"><img src="../Images/54f56201645d0c0ff065dd7815b5f4a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*KoyAS4Miojy-O173HLrI_A.gif"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx">You can execute SQL queries in Database Inspector</figcaption></figure><p id="c136" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">在这里！当过滤器打开时，我们有完全相同的植物列表。</p><h1 id="01c1" class="kw kx hs bd ky kz lz lb lc ld ma lf lg iy mb iz li jb mc jc lk je md jf lm ln bi translated">修改和调试您的数据库</h1><p id="8a2c" class="pw-post-body-paragraph jh ji hs jj b jk lo it jm jn lp iw jp jq lq js jt ju lr jw jx jy ls ka kb kc ha bi translated">数据库检查器允许您在设备上运行应用程序时修改应用程序数据库中的值，从而使调试应用程序变得轻而易举。</p><p id="1213" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">首先，我想测试真正长的植物名称的应用程序UI。我将使用Database Inspector直接在数据库上编辑值，而不是更改数据源并用新数据刷新数据库。</p><figure class="ke kf kg kh fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mg"><img src="../Images/6fd5ccc1101d602f6322253f93b558b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JKC2gujzMlQM1zxE"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx">You can edit your database in Database Inspector</figcaption></figure><p id="3b77" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">现在单元格是可编辑的了，我把名字从<em class="ly">苹果</em>改成<em class="ly">一种非常特殊的苹果</em>，然后按回车键。如果您正在跟进，您可以在应用程序UI中键入任何您想要测试的长度。</p><figure class="ke kf kg kh fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mh"><img src="../Images/7fb6ce1f7c6cbfc440c9c1829bba0695.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*o2Se5bHuePXzYOTW6UQBmg.gif"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx">If your app uses Room and observes the query results, you don’t need to restart the app to see the changes.</figcaption></figure><p id="a817" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">现在让我们回到应用程序。请注意，在我们不做任何事情的情况下，应用程序正在显示更新的数据！如果您的应用程序使用Room并观察查询结果(使用LiveData/Flow ),您不需要触发数据库查询来刷新数据。否则，根据您的应用程序触发查询的方式，您可能需要重新启动应用程序或再次导航到相关活动/片段。为了充分发挥Database Inspector的潜力，这可能是一个将您的应用程序迁移到使用LiveData或Flow的好借口。</p><p id="f2c7" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">回头看看我们的应用程序，看起来卡片视图不是为处理这么长的植物名称而设计的。我稍后会解决这个问题，但是让我们继续下一个测试。</p><figure class="ke kf kg kh fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mi"><img src="../Images/b7a899dd448332a76d4a392a7fdf18ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*X8-8XRQuSS9iS1uh"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx">The app doesn’t seem to handle long text well.</figcaption></figure><p id="e01a" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">每种植物都有不同的浇水时间间隔，我想看看浇水时间过了会发生什么。为此，我需要在我的花园里添加一些植物；但是首先，我在数据库检查器中选择了<strong class="jj ht">实时更新</strong>复选框。选中<strong class="jj ht">实时更新</strong>时，数据库检查器会自动显示您的应用程序对其数据库所做的任何更改。</p><figure class="ke kf kg kh fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mj"><img src="../Images/99f4b4927c981ef25fa2141bd0059b4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*y5UhOOYZUh_wdCjW3CevVg.png"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx">Select Live Updates.</figcaption></figure><p id="d9e5" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">我回到<strong class="jj ht">我的花园</strong>标签，添加一些植物，比如<em class="ly">鳄梨</em>和<em class="ly">茄子；首先，我回到数据库检查器，双击<em class="ly"> garden_plantings </em>来观察这个表。请注意，当我添加新植物时，garden_plantings表中的数据是如何自动更新的。</em></p><figure class="ke kf kg kh fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mh"><img src="../Images/d7a655423fd6a5ea33e9baeac4fc406e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*1_b-6xksPzrkCPiQa2JMsA.gif"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx">Database Inspector can automatically display changes.</figcaption></figure><p id="d892" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">这两种植物每隔3天浇水一次。我真的不想等3天看看会发生什么，所以我会编辑数据库并更改<em class="ly"> last_watering_day </em>。我再次回到数据库检查器，双击<em class="ly"> garden_plantings </em>。<em class="ly">最后浇水日期</em>是表格的最后一列。我将把两个记录的值都改为较小的值，以反映今天之前的某个时间。</p><figure class="ke kf kg kh fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mk"><img src="../Images/da6ce5f5a297edfea5518cd0f9eb021e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KfJNb5gfO4idNZ9GaXT4Gw.png"/></div></div><figcaption class="kl km et er es kn ko bd b be z dx">Edits to your databases are visible instantly!</figcaption></figure><p id="49d8" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">好的，看起来我回到过去有点太远了，但是这对于我的测试来说应该仍然有效。应用程序用户界面显示到期日期似乎很好。对于未来的发展，也许我们可以建议添加一个警告时，浇水一天过去了用户。</p><p id="6aae" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">继续前进，给新的数据库检查员一个尝试！让我们知道你的想法；如果你遇到任何问题，请不要忘记<a class="ae kd" href="https://issuetracker.google.com/issues/new?component=192708&amp;template=840533&amp;title=%23database-inspector" rel="noopener ugc nofollow" target="_blank">归档bug</a>！</p></div></div>    
</body>
</html>