<html>
<head>
<title>Exporting Firestore Collection as CSV into Cloud Storage on Demand, the easy way</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">按需将Firestore收藏以CSV格式导出到云存储，这是一种简单的方法</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/exporting-firestore-collection-csv-into-cloud-storage-on-demand-the-easy-way-4a4a08c664ab?source=collection_archive---------0-----------------------#2020-07-31">https://medium.com/google-developer-experts/exporting-firestore-collection-csv-into-cloud-storage-on-demand-the-easy-way-4a4a08c664ab?source=collection_archive---------0-----------------------#2020-07-31</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/83a709ed169998f46d84facf467b5c96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SSmbccTkeqQPDJJogq3tQg.png"/></div></div></figure><div class=""/><p id="eef1" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">假设我们有一个Firestore收藏，出于某种原因需要导出为CSV，我们希望随时随地按需轻松下载CSV。</p><p id="c73a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">通常，在编写代码下载CSV之前，我们需要开发一些先决条件，例如:</p><ol class=""><li id="683b" class="jn jo hs ir b is it iw ix ja jp je jq ji jr jm js jt ju jv bi translated">开发下载CSV的用户界面。</li><li id="9c4b" class="jn jo hs ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">编写一个云函数API来返回CSV，然后在您的首选客户机上调用它。</li><li id="ad71" class="jn jo hs ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">处理UI / API云功能的认证和权限。</li></ol><p id="88cb" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您不想构建UI或API来下载CSV，本文将指导您如何尽快从Firestore收藏中获取CSV文件。<strong class="ir ht">唯一要写的代码是生成CSV，并将其转储到Firebase的云存储中。</strong>如果你是一个图表爱好者，这里有一个图解说明了整个过程。我们将在本文中详细介绍每个过程。</p><figure class="kc kd ke kf fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es kb"><img src="../Images/e142a2d8186cfa5f018b11c1e75be9f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AvcHC1huOOestFEYCkfiXQ.png"/></div></div></figure><h1 id="e379" class="kg kh hs bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">步骤1:编写发布/订阅触发器</h1><p id="b436" class="pw-post-body-paragraph ip iq hs ir b is le iu iv iw lf iy iz ja lg jc jd je lh jg jh ji li jk jl jm ha bi translated">让我们创建一个云函数，它将从Firestore中读取一个集合，然后将其转换为CSV格式并上传到云存储中:</p><figure class="kc kd ke kf fd hj"><div class="bz dy l di"><div class="lj lk l"/></div></figure><p id="1ea6" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">上面的云函数是一个<strong class="ir ht">发布/订阅触发器</strong>函数，可以通过向主题<code class="du ll lm ln lo b">generate-application-csv</code>发送消息来执行。可以通过<a class="ae lp" href="https://console.cloud.google.com/cloudpubsub/topic/list" rel="noopener ugc nofollow" target="_blank">谷歌云平台&gt; Pub/Sub </a>触发。该功能使用<a class="ae lp" href="https://mircozeiss.com/json2csv/" rel="noopener ugc nofollow" target="_blank"> Json2CSV </a>将firestore文档转换为CSV，然后上传到您的云存储桶。</p><h1 id="3172" class="kg kh hs bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">步骤2:部署功能</h1><p id="e910" class="pw-post-body-paragraph ip iq hs ir b is le iu iv iw lf iy iz ja lg jc jd je lh jg jh ji li jk jl jm ha bi translated">通过Firebase CLI部署该功能。部署完成后，您就完成了所有需要的编码工作！</p><pre class="kc kd ke kf fd lq lo lr ls aw lt bi"><span id="700d" class="lu kh hs lo b fi lv lw l lx ly">firebase deploy --only functions:generateApplicationCsv</span></pre><h1 id="f488" class="kg kh hs bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">第3步:触发发布/订阅功能以生成CSV</h1><p id="9c6d" class="pw-post-body-paragraph ip iq hs ir b is le iu iv iw lf iy iz ja lg jc jd je lh jg jh ji li jk jl jm ha bi translated">要触发该功能，请前往<a class="ae lp" href="https://console.cloud.google.com/cloudpubsub/topic/list" rel="noopener ugc nofollow" target="_blank">谷歌云平台&gt;发布/订阅</a>。(确保选择与Firebase项目相同的项目)。您应该看到主题<code class="du ll lm ln lo b">generate-application-csv</code>是我们在云函数中定义的内容:</p><figure class="kc kd ke kf fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lz"><img src="../Images/80a361a7554b50e105520eb867971c7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9LKTcAPcaOgXMqzVCiN-Kg.png"/></div></div></figure><p id="5fb0" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">单击主题，然后选择发布消息，并输入任何消息。我们的云函数中不使用这个消息字段。点击发布，触发云功能。</p><figure class="kc kd ke kf fd hj er es paragraph-image"><div class="er es ma"><img src="../Images/ad188913cb4c3f5b3f0bcaa0afa1859e.png" data-original-src="https://miro.medium.com/v2/resize:fit:684/format:webp/1*_sUUMdBgtNOloKoktiZDvw.png"/></div></figure><h1 id="12ed" class="kg kh hs bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">🎉最后一步:通过Firebase控制台从云存储中下载CSV文件</h1><p id="c1b2" class="pw-post-body-paragraph ip iq hs ir b is le iu iv iw lf iy iz ja lg jc jd je lh jg jh ji li jk jl jm ha bi translated">转到存储&gt; Firebase控制台，你应该看到你的文件在那里！要下载，请检查CSV并单击打开。</p><figure class="kc kd ke kf fd hj er es paragraph-image"><div class="er es mb"><img src="../Images/fec6c381e9337fe8fdba2e11fd0b25b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*v8QDypRFGp6V6OmuT6sTnw.png"/></div></figure><h1 id="5eeb" class="kg kh hs bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">🎁好处:将CSV创建为批处理作业</h1><p id="c9c8" class="pw-post-body-paragraph ip iq hs ir b is le iu iv iw lf iy iz ja lg jc jd je lh jg jh ji li jk jl jm ha bi translated">通过这种方法，您可以将此功能扩展到<strong class="ir ht">创建批处理作业</strong>，将Firestore收藏转换为CSV。当CSV生成时，您可以使用<a class="ae lp" href="https://firebase.google.com/docs/functions/schedule-functions" rel="noopener ugc nofollow" target="_blank"> <strong class="ir ht">计划功能</strong> </a>创建固定计划，或者使用发布/订阅，您可以使用<a class="ae lp" href="https://console.cloud.google.com/cloudscheduler" rel="noopener ugc nofollow" target="_blank"> <strong class="ir ht">云调度器</strong> </a> <strong class="ir ht">灵活地计划/暂停/停止您的批处理作业。</strong></p><figure class="kc kd ke kf fd hj"><div class="bz dy l di"><div class="lj lk l"/></div><figcaption class="mc md et er es me mf bd b be z dx">Scheduled Function</figcaption></figure><figure class="kc kd ke kf fd hj er es paragraph-image"><div class="er es mg"><img src="../Images/107516d31c499d5507fcc420224bb439.png" data-original-src="https://miro.medium.com/v2/resize:fit:824/format:webp/1*2UfBOk7ccm8rwmOyC0oYNw.png"/></div><figcaption class="mc md et er es me mf bd b be z dx">Schedule CSV generation nightly</figcaption></figure><h1 id="0e61" class="kg kh hs bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">底线/一线希望</h1><p id="79b2" class="pw-post-body-paragraph ip iq hs ir b is le iu iv iw lf iy iz ja lg jc jd je lh jg jh ji li jk jl jm ha bi translated">有了这个设置，您就不必担心构建ui/API时可能出现的安全问题，<em class="mh">当然，除了保护您的云存储免受未经授权的读取之外！</em>这是因为设置存在于Google云平台和Firebase环境中，您可以方便地使用它们的工具。</p><p id="0ee2" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">和往常一样，这只是从Firestore生成CSV的众多方法之一，应该有所保留。请尝试一下，看看它是否符合您从Firestore快速获得CSV的需求。</p><p id="c47f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">此外，提醒一下，从Firestore中提取大量收藏也会导致额外的阅读量。</strong></p><p id="a89d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你觉得这有用，请给这篇文章一些急需的👏👏👏</p></div></div>    
</body>
</html>