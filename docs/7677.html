<html>
<head>
<title>Flank: Smart Test Runner for Firebase</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">侧翼:Firebase的智能测试运行程序</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/flank-smart-test-runner-for-firebase-cf65e1b1eca7?source=collection_archive---------0-----------------------#2017-05-10">https://medium.com/walmartglobaltech/flank-smart-test-runner-for-firebase-cf65e1b1eca7?source=collection_archive---------0-----------------------#2017-05-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/46449936ef7afe307ed25b2ed095f59e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P6SiWTqA9UiHXTGEluQWmg.jpeg"/></div></div></figure><p id="716d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在航海术语中，船速是一艘船能达到的最大速度。这正是我们想要实现的android测试自动化，这一需求导致了我们最新加入TestArmada工具套件的Flank的诞生。</p><p id="2e7d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这篇文章详细介绍了我们的android测试自动化需求，为什么我们选择了<a class="ae jn" href="https://firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> firebase </a>并创建了Flank，Flank如何帮助我们，以及它如何帮助所有使用android开发人员的firebase。</p><h2 id="4d2d" class="jo jp hh bd jq jr js jt ju jv jw jx jy ja jz ka kb je kc kd ke ji kf kg kh ki bi translated">Android自动化@ WalmartLabs</h2><p id="3e33" class="pw-post-body-paragraph ip iq hh ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated">对于我们的开发人员，我们支持基于仪器(Espresso)和非仪器(Appium)的测试自动化。Espresso和任何其他基于仪器的测试框架总是比Appium功能更丰富，速度更快。然而，Appium具有测试重用的吸引力。Appium可以让你重用你的移动网络测试，或者ios和android的本地应用测试。以iOS和android或web和移动web的组合为目标的团队通常选择Appium，而原生Android开发人员出于显而易见的原因更喜欢Espresso。</p><p id="4a15" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们使用外部设备云供应商来运行我们的移动网络和本地应用程序测试。我们一直在寻找新的工具/服务，使WalmartLabs的测试自动化更加高效。这就是我们如何了解Firebase，并在去年年初成为他们测试计划的一部分。</p><h2 id="c5c8" class="jo jp hh bd jq jr js jt ju jv jw jx jy ja jz ka kb je kc kd ke ji kf kg kh ki bi translated">Firebase测试实验室</h2><p id="1aed" class="pw-post-body-paragraph ip iq hh ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated">我们评估所有测试自动化工具和服务的三个关键特征是:</p><ol class=""><li id="9f7d" class="ko kp hh ir b is it iw ix ja kq je kr ji ks jm kt ku kv kw bi translated"><strong class="ir hi">速度</strong></li><li id="5ef2" class="ko kp hh ir b is kx iw ky ja kz je la ji lb jm kt ku kv kw bi translated"><strong class="ir hi">可靠性</strong></li><li id="4502" class="ko kp hh ir b is kx iw ky ja kz je la ji lb jm kt ku kv kw bi translated"><strong class="ir hi">可操作的见解</strong></li></ol><p id="2d4d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Firebase TestLab最吸引人的特点是完全不同的东西，那就是定价。当您使用外部供应商时，您的脑海中总是会出现构建还是购买的问题。虚拟设备每小时1美元，真实设备每小时5美元的Firebase让这个问题变得过时了。我提到过吗，他们按分钟计算测试执行时间，并且不收取设备安装和拆卸时间的费用。</p><p id="b29c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">成本节约非常显著，我们开始根据其他评估标准评估firebase。它的得分很高，但是我们发现了一个问题:Firebase不支持测试分片。</p><p id="e3d5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这对我们来说是一个大问题，因为我们对公关工作的执行时间有严格的SLA。我们喜欢分布我们的测试，最好每个设备一个，以确保最快的测试执行时间。而Firebase只允许我们在给定的设备上连续运行测试。</p><figure class="ld le lf lg fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lc"><img src="../Images/c11cdcdf4283c474ca29a84b1dc3762e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*luqlzDLCMWNwguHELWWwZg.jpeg"/></div></div></figure><p id="8e82" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这个需求/问题是我们创建Flank的核心原因。</p><h2 id="7512" class="jo jp hh bd jq jr js jt ju jv jw jx jy ja jz ka kb je kc kd ke ji kf kg kh ki bi translated">侧面</h2><p id="5299" class="pw-post-body-paragraph ip iq hh ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated">我们开始与Google Firebase团队讨论我们的侧翼需求，他们非常合作，分享了许多关于如何创建一个支持分片的高效运行器的想法和技巧。</p><p id="5b8c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><a class="lh li ge" href="https://medium.com/u/cbfc2689c304?source=post_page-----cf65e1b1eca7--------------------------------" rel="noopener" target="_blank">我们团队的Renas Reda </a>开始着手这项工作，很快第一个版本的Flank就具备了这些特性:</p><ol class=""><li id="ec54" class="ko kp hh ir b is it iw ix ja kq je kr ji ks jm kt ku kv kw bi translated"><strong class="ir hi">测试分片</strong>:你所有的Espresso测试都会自动分发到尽可能多的Firebase设备上，而Flank会输出综合测试报告，就好像它们在同一个设备上运行一样。</li><li id="6e1d" class="ko kp hh ir b is kx iw ky ja kz je la ji lb jm kt ku kv kw bi translated"><strong class="ir hi">节流支持</strong>:如果您有很多测试，并且您担心Firebase可能没有足够的设备来一次运行所有的测试。您可以指定一个限制数量，Flank将确保您的测试套件永远不会使用超过指定数量的设备。</li><li id="e037" class="ko kp hh ir b is kx iw ky ja kz je la ji lb jm kt ku kv kw bi translated"><strong class="ir hi">设备配置支持</strong>:选择单个或多个设备，通过配置文件进行测试。</li><li id="ee78" class="ko kp hh ir b is kx iw ky ja kz je la ji lb jm kt ku kv kw bi translated"><strong class="ir hi">测试报告:</strong> Flanks输出标准的XUnit报告格式，因此您可以将其与您选择的任何CI系统集成。侧面还包括每个测试的设备名称、api级别、地区和方向，以确保开发人员获得完整的图片。</li></ol><figure class="ld le lf lg fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lc"><img src="../Images/05d72252db9ccd380dfdd345954a0d2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MH57Pyrw0NeQlogLLnp8JA.jpeg"/></div></div></figure><p id="66ec" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这对我们很有用，我们的测试运行得更快，执行成本很低，每个人都很高兴。我们开始进行成本预测以获得财务批准，并注意到一件非常奇怪的事情。Firebase向我们收取的费用是预期价格的2到3倍。</p><h2 id="266c" class="jo jp hh bd jq jr js jt ju jv jw jx jy ja jz ka kb je kc kd ke ji kf kg kh ki bi translated">聪明的侧翼</h2><p id="214d" class="pw-post-body-paragraph ip iq hh ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated">我们开始调试价格差异。我们的用例是一个包含312个测试用例的测试套件，过去在单个设备上本地运行需要2个小时。我们用312个碎片在Firebase上运行相同的测试，我们的测试总共花费了大约15分钟。由于本地测试运行时间约为2小时，我们预计每次执行收费约为2美元，但我们的收费超过了5美元。</p><p id="f3d3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们花了一些时间，但我们找到了罪魁祸首。记住，我在上面提到过Firebase如何将测试执行时间精确到分钟。这意味着任何设备的使用时间都不能少于一分钟。我们大多数测试的执行时间不到30秒，平均10秒。这种以分钟为单位的舍入意味着312个测试将花费312分钟，不考虑它们的执行时间。因此，在我们的例子中，我们被收取312/60 = 5.2美元的费用。</p><p id="08d1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">一旦我们了解到这一点，我们就开始在Flank中开发一个新特性，它考虑到了最后一次测试运行，然后以这样一种方式对测试进行分片，每个分片运行将近X分钟。这里X是可配置的，但默认为两分钟。我们内部称这个特性为“智能侧翼”。</p><p id="f4d6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Smart Flank很快就准备好了，我们惊喜地发现，它不仅降低了我们的成本，还帮助我们缩短了测试执行时间。由于多个测试使用相同的设备，我们观察到安装/拆卸时间的节省，这反映在我们的总测试执行时间中。现在，我们的15分钟测试只需7分钟左右，成本降到了2美元。换句话说，这一新功能允许我们以两倍的速度运行测试，而成本仅为之前的1/3。很聪明，对吧？</p><figure class="ld le lf lg fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lc"><img src="../Images/0d0fdc27d0d5ba46ae4f930863c476c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2Q5COtRC91zQ-6uGR0RTgA.jpeg"/></div></div></figure><h2 id="74e5" class="jo jp hh bd jq jr js jt ju jv jw jx jy ja jz ka kb je kc kd ke ji kf kg kh ki bi translated">下一步是什么</h2><p id="fd93" class="pw-post-body-paragraph ip iq hh ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated">我们有开源的侧翼，并愿意在社区支持和反馈下进一步发展它。Flank应该可以与任何基于JUnit的android测试套件一起工作，这可能是在Firebase上运行android测试用例的最佳方式，无需对代码库进行任何更改。</p><p id="a1d8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">下面是我们的Github回购:【https://github.com/TestArmada/flank T2】</p><h2 id="57a3" class="jo jp hh bd jq jr js jt ju jv jw jx jy ja jz ka kb je kc kd ke ji kf kg kh ki bi translated">承认</h2><ol class=""><li id="2804" class="ko kp hh ir b is kj iw kk ja lj je lk ji ll jm kt ku kv kw bi translated"><a class="lh li ge" href="https://medium.com/u/cbfc2689c304?source=post_page-----cf65e1b1eca7--------------------------------" rel="noopener" target="_blank">雷纳斯·瑞达</a>:用于创造侧翼</li><li id="e0b5" class="ko kp hh ir b is kx iw ky ja kz je la ji lb jm kt ku kv kw bi translated">Google Firebase团队(Louis Amira、Nalin Mittal和Ahmed Mounir Gad):感谢你们所有的支持和想法。</li></ol></div></div>    
</body>
</html>