<html>
<head>
<title>OkHttp 3.13 Requires Android 5+</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OkHttp 3.13要求安卓5+版</h1>
<blockquote>原文：<a href="https://medium.com/square-corner-blog/okhttp-3-13-requires-android-5-818bb78d07ce?source=collection_archive---------0-----------------------#2019-02-05">https://medium.com/square-corner-blog/okhttp-3-13-requires-android-5-818bb78d07ce?source=collection_archive---------0-----------------------#2019-02-05</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/e8e91389e5562a7e67d6ded807312b1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lHzfyewWjcTLTiFLQVDaBA.png"/></div></div></figure><blockquote class="ip iq ir"><p id="6255" class="is it iu iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">注意，我们已经行动了！如果您想继续了解Square的最新技术内容，请访问我们的新家<a class="ae jr" href="https://developer.squareup.com/blog" rel="noopener ugc nofollow" target="_blank">https://developer.squareup.com/blog</a></p></blockquote><p id="cfea" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">今天我们发布OkHttp 3.13。通过此次更新，我们将从以下方面提升项目要求:</p><ul class=""><li id="5d5b" class="jv jw hh iv b iw ix ja jb js jx jt jy ju jz jq ka kb kc kd bi translated">Android 2.3+/API 9+(2010年12月发布)</li><li id="22f5" class="jv jw hh iv b iw ke ja kf js kg jt kh ju ki jq ka kb kc kd bi translated">Java 7+(2011年7月发布)</li></ul><p id="60f3" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">对此:</p><ul class=""><li id="33ce" class="jv jw hh iv b iw ix ja jb js jx jt jy ju jz jq ka kb kc kd bi translated">Android 5.0+/API 21+(2014年11月发布)</li><li id="e2d9" class="jv jw hh iv b iw ke ja kf js kg jt kh ju ki jq ka kb kc kd bi translated">Java 8+(2014年3月发布)</li></ul><p id="e283" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">淘汰旧设备是一项重大变革，我们不会轻易放弃！我想解释一下我们为什么要这样做，我们正在做什么来最大限度地减少中断，以及如何升级。</p><h1 id="5582" class="kj kk hh bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">为什么是Android 5+为什么是现在？</h1><p id="4ba1" class="pw-post-body-paragraph is it hh iv b iw lh iy iz ja li jc jd js lj jg jh jt lk jk jl ju ll jo jp jq ha bi translated">TLS是使HTTPS呼叫安全、保密和经过身份验证的机制。OkHttp知晓五个版本:<em class="iu"> SSLv3 </em> (1996年)、<em class="iu"> TLSv1 </em> (1999年)、<em class="iu"> TLSv1.1 </em> (2006年)、<em class="iu"> TLSv1.2 </em> (2008年)、<em class="iu"> TLSv1.3 </em> (2018年)。我们在2014年放弃了对<em class="iu"> SSLv3 </em>的支持，以回应<a class="ae jr" href="https://googleonlinesecurity.blogspot.ca/2014/10/this-poodle-bites-exploiting-ssl-30.html" rel="noopener ugc nofollow" target="_blank">狮子狗攻击</a>。</p><p id="16fa" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">现在是时候放弃TLSv1和TLSv1.1，让TLSv1.2成为互联网新的最低标准了。10月15日，我们在<a class="ae jr" href="https://security.googleblog.com/2018/10/modernizing-transport-security.html" rel="noopener ugc nofollow" target="_blank">谷歌</a>、<a class="ae jr" href="https://blog.mozilla.org/security/2018/10/15/removing-old-versions-of-tls/" rel="noopener ugc nofollow" target="_blank"> Mozilla </a>、<a class="ae jr" href="https://blogs.windows.com/msedgedev/2018/10/15/modernizing-tls-edge-ie11/" rel="noopener ugc nofollow" target="_blank">微软</a>和<a class="ae jr" href="https://webkit.org/blog/8462/deprecation-of-legacy-tls-1-0-and-1-1-versions/" rel="noopener ugc nofollow" target="_blank">苹果</a>的同事宣布，从2020年初开始，他们的浏览器将要求<em class="iu"> TLSv1.2 </em>或更高版本。</p><p id="80b9" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">谷歌在Android 5.0中增加了对<em class="iu"> TLSv1.2 </em>的支持。Oracle在Java 8中添加了它。在OkHttp 3.13中，我们要求主机平台内置对<em class="iu"> TLSv1.2 </em>的支持。</p><h1 id="823a" class="kj kk hh bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">Android 4.x呢？</h1><p id="f2a6" class="pw-post-body-paragraph is it hh iv b iw lh iy iz ja li jc jd js lj jg jh jt lk jk jl ju ll jo jp jq ha bi translated">谷歌的<a class="ae jr" href="https://developer.android.com/about/dashboards/" rel="noopener ugc nofollow" target="_blank">分发仪表板</a>显示，2018年10月访问Play Store的设备中约有11%运行的是Android 4.x，我们已经创建了一个分支<a class="ae jr" href="https://github.com/square/okhttp/tree/okhttp_3.12.x" rel="noopener ugc nofollow" target="_blank"> OkHttp 3.12.x </a>，来支持这些设备。如果我们遇到任何严重的错误或安全问题，我们将反向移植修复和发布。我们计划在2020年12月31日之前维持这一分支机构。</p><p id="e26a" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">如果你真的需要Android 4.x上的<em class="iu"> TLSv1.2 </em>，那是可以的！Ankush Gupta已经写了一个全面的指南，解释了如何让Google Play服务做到这一点。即使你遵循这个过程，你仍然应该在Android 4.x设备上使用OkHttp 3.12.x。</p><h1 id="14aa" class="kj kk hh bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">我如何升级？</h1><p id="ea01" class="pw-post-body-paragraph is it hh iv b iw lh iy iz ja li jc jd js lj jg jh jt lk jk jl ju ll jo jp jq ha bi translated">确认你的项目的<code class="du lm ln lo lp b">minSdkVersion</code>至少是21，并且你的Android Gradle插件版本至少是3.2。然后在您的<code class="du lm ln lo lp b">build.gradle</code>中使用我们新的Maven坐标:</p><pre class="lq lr ls lt fd lu lp lv lw aw lx bi"><span id="c500" class="ly kk hh lp b fi lz ma l mb mc">dependencies {<br/>  implementation "com.squareup.okhttp3:okhttp:3.13.1"<br/>  ...<br/>}</span></pre><p id="ee11" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">您还需要将Java版本设置为1.8或更高版本。我们现在在源代码中使用Java 8特性(耶<a class="ae jr" href="https://github.com/square/okhttp/pull/4549/files" rel="noopener ugc nofollow" target="_blank"> lambdas！</a>)这使得Android的编译器能够<a class="ae jr" href="https://jakewharton.com/androids-java-8-support/" rel="noopener ugc nofollow" target="_blank">处理它</a>:</p><pre class="lq lr ls lt fd lu lp lv lw aw lx bi"><span id="758f" class="ly kk hh lp b fi lz ma l mb mc">android {<br/>  compileOptions {<br/>    sourceCompatibility JavaVersion.VERSION_1_8<br/>    targetCompatibility JavaVersion.VERSION_1_8<br/>  }<br/>  ...<br/>}</span></pre><p id="a5b1" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">默认情况下，更新还需要具备<em class="iu"> TLSv1.2 </em>功能的web服务器。如果你的网络服务器过时了，HTTPS对它们的调用将会失败，并出现一个<code class="du lm ln lo lp b">SSLException</code>。如有必要，您可以配置OkHttp 3.13以允许<em class="iu"> TLSv1 </em>和<em class="iu"> TLSv1.1 </em>连接:</p><pre class="lq lr ls lt fd lu lp lv lw aw lx bi"><span id="bf1b" class="ly kk hh lp b fi lz ma l mb mc">OkHttpClient client = new OkHttpClient.Builder()<br/>    .connectionSpecs(Arrays.asList(ConnectionSpec.COMPATIBLE_TLS))<br/>    .build();</span></pre><p id="1201" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">如果你发现自己正在这样做，请注意:在2020年初，网络浏览器将停止连接到你的网络服务器！我们建议尽可能提高服务器的能力，而不是降低客户端的要求。</p><p id="54e0" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">我们在项目wiki上记录了<a class="ae jr" href="https://github.com/square/okhttp/wiki/TLS-Configuration-History" rel="noopener ugc nofollow" target="_blank"> TLS配置变更</a>。</p><h1 id="f6ea" class="kj kk hh bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">谢谢</h1><p id="66bf" class="pw-post-body-paragraph is it hh iv b iw lh iy iz ja li jc jd js lj jg jh jt lk jk jl ju ll jo jp jq ha bi translated">我们开发人员花费大量的时间和精力来保持依赖关系最新。我们应该庆祝这项工作！我们的用户信任他们的应用程序，信任他们最重要的东西，包括私人谈话、金钱和家庭照片。我们通过尽最大努力保护他们的数据来兑现这种信任。</p><p id="8ca0" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">我很感谢你花时间更新。这可能不容易，但很重要。</p></div></div>    
</body>
</html>