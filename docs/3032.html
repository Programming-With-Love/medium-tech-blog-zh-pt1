<html>
<head>
<title>Know How To Visualize Kubernetes Cluster with Elasticsearch and Kibana</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">知道如何用Elasticsearch和Kibana可视化Kubernetes集群</h1>
<blockquote>原文：<a href="https://medium.com/edureka/logging-monitoring-elasticsearch-fluentd-kibana-e2cd477a576b?source=collection_archive---------0-----------------------#2019-06-21">https://medium.com/edureka/logging-monitoring-elasticsearch-fluentd-kibana-e2cd477a576b?source=collection_archive---------0-----------------------#2019-06-21</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/7f39207efc93f1a747d9b19aaf95964e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*98hSP7MvmR8JWr0JhNCuCw.png"/></div></figure><p id="ab65" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在本文中，您将了解如何使用Fluentd日志代理将Kubernetes集群事件数据发布到Amazon Elastic Search。这些数据将通过Kibana查看，Kibana是一个用于Elasticsearch的开源可视化工具。亚马逊ES由集成的Kibana集成组成。</p><p id="70f6" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我们将带您完成以下流程:</p><ul class=""><li id="7628" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">创建Kubernetes集群</li><li id="c8d0" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">创建Amazon ES集群</li><li id="11b8" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">在Kubernetes集群上部署Fluentd日志代理</li><li id="5ca2" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">想象一下基巴纳的库伯内特人的约会</li></ul><h1 id="0f31" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">步骤1:创建Kubernetes集群</h1><p id="b1ae" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">Kubernetes是Google创建的一个开源平台，用于管理容器化的应用程序。它使您能够在集群环境中管理、扩展和部署您的容器化应用。我们可以使用Kubernetes在各种主机上协调我们的容器，动态扩展包含所有资源的容器化应用程序，并拥有一个集中的容器管理环境。</p><p id="fc12" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我们将从创建Kubernetes集群开始，我将逐步向您演示如何在CentOS 7上安装和配置Kubernetes。</p><ol class=""><li id="c115" class="jj jk hh in b io ip is it iw jl ja jm je jn ji la jp jq jr bi translated">配置主机</li></ol><ul class=""><li id="bcc4" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">vi /etc/hosts</li><li id="2a1e" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">根据主机文件中的主机详细信息进行更改</li></ul><figure class="lc ld le lf fd ii er es paragraph-image"><div class="er es lb"><img src="../Images/5dfc4cdc07ef5d58afcfbd0defba0a2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*TkovAkd7f-4gS7jIDBrmZA.png"/></div></figure><p id="65a8" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> 2。</strong>通过执行以下命令禁用SELinux</p><ul class=""><li id="251b" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">setenforce 0</li><li id="cb3d" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">sed-I–follow-symlinks ' s/SELINUX = enforcing/SELINUX = disabled/g '/etc/sys config/SELINUX</li></ul><p id="4e57" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> 3。</strong>启用br_netfilter内核模块</p><p id="3d6f" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">安装kubernetes需要br_netfilter模块。</p><p id="b57d" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">运行以下命令以启用br_netfilter内核模块。</p><ul class=""><li id="2099" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">modprobe br_netfilter</li><li id="afb1" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">echo ' 1 ' &gt;/proc/sys/net/bridge/bridge-nf-call-iptables</li></ul><p id="dbd6" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> 4。</strong>通过运行以下命令禁用交换。</p><ul class=""><li id="4d83" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">swapoff -a</li><li id="ff7a" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">然后编辑/etc/fstab并注释掉交换行</li></ul><figure class="lc ld le lf fd ii er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es lg"><img src="../Images/59ffe8b234dd0e1fb62d215285fec7d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ix78nyGvoymbL_3nqeHdxA.png"/></div></div></figure><p id="381e" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> 5。</strong>安装Docker CE的最新版本。通过运行以下命令安装docker-ce的包依赖项。</p><ul class=""><li id="53c9" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">yum install -y yum-utils设备映射器持久数据lvm2</li></ul><p id="51a7" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">将docker存储库添加到系统中，并使用yum命令安装docker-ce。</p><ul class=""><li id="c6d0" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">yum-config-manager-add-repo<a class="ae ll" href="https://download.docker.com/linux/centos/docker-ce.repo" rel="noopener ugc nofollow" target="_blank">https://download.docker.com/linux/centos/docker-ce.repo</a></li><li id="ff99" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">yum安装-y docker-ce</li></ul><p id="f265" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> 6。</strong>安装Kubernetes</p><p id="0b92" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">使用以下命令将kubernetes存储库添加到centos 7系统中。</p><ul class=""><li id="de2d" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">yum install-y kube let kube ADM kube CTL</li></ul><pre class="lc ld le lf fd lm ln lo lp aw lq bi"><span id="11f4" class="lr jy hh ln b fi ls lt l lu lv">[kubernetes]<br/> <br/>name=Kubernetes<br/>baseurl=<a class="ae ll" href="https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64" rel="noopener ugc nofollow" target="_blank">https://packages.cloud.google.com/yum/repos/kubernetes-el7-x86_64</a><br/>enabled=1<br/>gpgcheck=1<br/>repo_gpgcheck=1<br/>gpgkey=<a class="ae ll" href="https://packages.cloud.google.com/yum/doc/yum-key.gpg" rel="noopener ugc nofollow" target="_blank">https://packages.cloud.google.com/yum/doc/yum-key.gpg</a><br/>       <a class="ae ll" href="https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg" rel="noopener ugc nofollow" target="_blank">https://packages.cloud.google.com/yum/doc/rpm-package-key.gpg</a><br/>EOF</span></pre><p id="cf3c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">通过运行下面的yum命令，使用安装kubernetes包kubeadm、kubelet和kubectl。</p><ul class=""><li id="3b11" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">系统启动对接器&amp;&amp;系统启动对接器</li></ul><p id="8079" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">安装完成后，重新启动所有这些服务器。重启后，启动docker和kubelet服务</p><ul class=""><li id="fe2e" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">系统启动对接器&amp;&amp;系统启动对接器</li><li id="33aa" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">系统控制启动库删除&amp;&amp;系统控制启用库删除</li></ul><p id="5102" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> 7。</strong> Kubernetes集群初始化</p><p id="7a06" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">登录到主服务器并运行下面的命令。</p><ul class=""><li id="a6a6" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">系统控制启动库删除&amp;&amp;系统控制启用库删除</li></ul><p id="c85a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">一旦Kubernetes初始化完成，您将得到结果。从得到的结果中复制命令并执行它，开始使用集群。</p><figure class="lc ld le lf fd ii er es paragraph-image"><div class="er es lw"><img src="../Images/e855a7ee98e1d93c4d28941e53b94e70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*A615EyKD007aQS_vjIo6CA.png"/></div></figure><p id="a825" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">记下结果中的kubeadm join命令。该命令将用于向kubernetes集群注册新节点。</p><figure class="lc ld le lf fd ii er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es lg"><img src="../Images/965d8e7140a5bef63d6cc08576cf18f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KvChNrYzIW7KZt7baM_x_Q.png"/></div></div></figure><p id="97df" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> 8。</strong>将法兰绒网络部署到kubernetes集群</p><p id="c5c5" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><a class="ae ll" href="https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml" rel="noopener ugc nofollow" target="_blank">https://raw . githubusercontent . com/core OS/法兰绒/master/Documentation/kube-法兰绒. yml </a></p><figure class="lc ld le lf fd ii er es paragraph-image"><div class="er es lx"><img src="../Images/646985cb5346c1962809912cb9aae6d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:796/format:webp/1*X1Dg9KGEOuG_kPSR4Zr_eQ.png"/></div></figure><p id="0133" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">法兰绒网络已经部署到Kubernetes集群。</p><p id="c37d" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">等待一段时间，然后使用下面的命令检查kubernetes节点和pod。</p><ul class=""><li id="3c07" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">kubectl获取节点</li><li id="05a9" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">kubectl get pods——所有名称空间</li></ul><p id="2382" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">您将看到“k8s-master”节点作为状态为“ready”的“master”群集运行，并且您将看到该群集所需的所有pod，包括用于网络pod配置的“kube-法兰绒-ds”。</p><p id="5945" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> 9。</strong>向集群添加节点连接到node01服务器并运行kubeadm join命令</p><ul class=""><li id="2961" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">kube ADM join 172 . 31 . 7 . 47:6443–token at 03m 9 . iinkh 5 PS 9 q 12 sh 2 I–discovery-token-ca-cert-hash sha 256:3 f6c 1824796 e f1 ff 3d 9427 c 883 bde 915 D5 BC 13331d 74891d 831 f 29 a 8 C4 A0 C5 ab</li></ul><p id="dc63" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">连接到node02服务器并运行kubeadm join命令</p><ul class=""><li id="aef0" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">kube ADM join 172 . 31 . 7 . 47:6443–token at 03m 9 . iinkh 5 PS 9 q 12 sh 2 I–discovery-token-ca-cert-hash sha 256:3 f6c 1824796 e f1 ff 3d 9427 c 883 bde 915 D5 BC 13331d 74891d 831 f 29 a 8 C4 A0 C5 ab</li></ul><p id="ecd0" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">等待一段时间并验证“k8s-master”主集群服务器，使用以下命令检查节点和pod。</p><ul class=""><li id="82e6" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">kubectl获取节点</li></ul><figure class="lc ld le lf fd ii er es paragraph-image"><div class="er es ly"><img src="../Images/09f777e20f66c2b2ab8175a4f7c27e30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/1*jc3YEY0X0Wd9Io3lzEbg2A.png"/></div></figure><p id="622e" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">现在，您将看到worker1和worker2已添加到集群中，状态为“ready”。</p><ul class=""><li id="64e7" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">kubectl get pods——所有名称空间</li></ul><figure class="lc ld le lf fd ii er es paragraph-image"><div class="er es ly"><img src="../Images/1804c62f99372618988ae2e9c4015c22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/1*NM3G8vrtCk-b3JZgKkLoWA.png"/></div></figure><p id="b257" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">Kubernetes集群主服务器初始化和配置已完成。</p><h1 id="a6ed" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">步骤2:创建Amazon ES集群</h1><p id="55e1" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">Elasticsearch是一个开源搜索和分析引擎，用于日志分析和实时监控应用程序。Amazon Elasticsearch Service(Amazon ES)是一项AWS服务，允许在AWS云中部署、操作和扩展elastic search。您可以使用Amazon ES来分析来自Amazon SES的电子邮件发送事件</p><p id="ebf0" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我们将创建一个Amazon ES集群，然后将Fluentd日志记录代理部署到Kubernetes集群，该集群将收集日志并发送到Amazon ES集群</p><p id="a657" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">本节展示了如何使用Amazon ES控制台创建Amazon ES集群。</p><h2 id="0175" class="lr jy hh bd jz lz ma mb kd mc md me kh iw mf mg kl ja mh mi kp je mj mk kt ml bi translated"><strong class="ak">创建Amazon ES集群</strong></h2><ol class=""><li id="9695" class="jj jk hh in b io kv is kw iw mm ja mn je mo ji la jp jq jr bi translated">登录AWS管理控制台，打开位于<a class="ae ll" href="https://console.aws.amazon.com/es/" rel="noopener ugc nofollow" target="_blank">https://console.aws.amazon.com/es/</a>的亚马逊Elasticsearch服务控制台</li><li id="517a" class="jj jk hh in b io js is jt iw ju ja jv je jw ji la jp jq jr bi translated">选择<strong class="in hi">创建一个新的域，并在Amazon ES控制台中选择部署类型</strong>。</li></ol><figure class="lc ld le lf fd ii er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es mp"><img src="../Images/b437ab30d6fbbf61512859e7ebc73458.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OaYK-MUhh3brlawbsI6gug.png"/></div></div></figure><p id="fb68" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">3.在版本下，保留Elasticsearch版本字段的默认值。</p><p id="95ee" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">4.选择下一步</p><p id="595a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">5.在<strong class="in hi">配置域下的<strong class="in hi">配置集群</strong>页面上为您的弹性搜索域键入一个名称。</strong></p><p id="671e" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">6.在“配置群集”页面上，选择“数据实例”下的以下选项</p><ul class=""><li id="a124" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated"><strong class="in hi">实例类型</strong> —选择t2.micro.elasticsearch(符合自由层条件)。</li><li id="d956" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated"><strong class="in hi">实例数量</strong> — 1</li></ul><p id="4583" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">7.在专用主实例下</p><ul class=""><li id="cc5c" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated"><strong class="in hi">启用专用主机</strong> —不启用该选项。</li><li id="a252" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated"><strong class="in hi">启用区域感知</strong> —不启用此选项。</li></ul><p id="fee8" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">8.在存储配置下，选择以下选项。</p><ul class=""><li id="94a7" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated"><strong class="in hi">存储类型</strong> —选择EBS。对于EBS设置，选择EBS卷类型通用(SSD ), EBS卷大小为10。</li></ul><p id="3708" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">9.在加密下— <strong class="in hi">不要启用此选项</strong></p><p id="c063" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">10.快照配置不足</p><ul class=""><li id="a610" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated"><strong class="in hi">自动快照开始时间</strong> —选择自动快照开始时间00:00 UTC(默认)。</li></ul><p id="b6c7" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">11.选择下一步</p><p id="bedb" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">12.在“网络配置”下，选择“VPC接入”,然后根据您的VPC选择详细信息，如下所示。</p><figure class="lc ld le lf fd ii er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es mq"><img src="../Images/e1a1cae55e1eaa02e0674fc179f9c918.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HpQFZ8KYPZ3LoKpEUu4agA.png"/></div></div></figure><p id="3eb1" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在Kibana身份验证下:—不要启用此选项。</p><p id="d624" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">13.要设置访问策略，请选择允许对域的开放访问。注意:-在生产中，您应该限制对特定IP地址或范围的访问。</p><figure class="lc ld le lf fd ii er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es mr"><img src="../Images/f6270fa59a903b64f0dc70e17635a69d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vh_qEUpgcDYsOBPKv-CvBQ.png"/></div></div></figure><p id="d59d" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">14.选择下一步。</p><p id="c505" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">15.在“查看”页面上，查看您的设置，然后选择“确认并创建”。</p><p id="20fd" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi">注意:</strong>部署集群最多需要十分钟。点击创建的弹性搜索域后，记下您的Kibana URL。</p><h1 id="f1fb" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">步骤3:在Kubernetes集群上部署Fluentd日志代理</h1><p id="7c73" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">Fluentd是一个开源数据收集器，它让您统一数据收集和消费，以便更好地使用和理解数据。在这种情况下，我们将在Kubernetes集群上部署Fluentd日志记录，它将收集日志文件并发送到Amazon Elastic Search。</p><p id="9973" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我们将创建一个ClusterRole，它提供对pod和名称空间对象的权限，以便向集群发出get、list和watch请求。</p><p id="64e9" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">首先，我们需要配置RBAC(基于角色的访问控制)权限，以便Fluentd可以访问适当的组件。</p><h2 id="4011" class="lr jy hh bd jz lz ma mb kd mc md me kh iw mf mg kl ja mh mi kp je mj mk kt ml bi translated"><strong class="ak"> 1.fluentd-rbac.yaml: </strong></h2><pre class="lc ld le lf fd lm ln lo lp aw lq bi"><span id="3880" class="lr jy hh ln b fi ls lt l lu lv">apiVersion: v1<br/>kind: ServiceAccount<br/>metadata:<br/>  name: fluentd<br/>  namespace: kube-system<br/> <br/>---<br/> <br/>apiVersion: rbac.authorization.k8s.io/v1beta1<br/>kind: ClusterRole<br/>metadata:<br/>  name: fluentd<br/>  namespace: kube-system<br/>rules:<br/>- apiGroups:<br/>  - ""<br/>  resources:<br/>  - pods<br/>  - namespaces<br/>  verbs:<br/>  - get<br/>  - list<br/>  - watch<br/> <br/>---<br/> <br/>kind: ClusterRoleBinding<br/>apiVersion: rbac.authorization.k8s.io/v1beta1<br/>metadata:<br/>  name: fluentd<br/>roleRef:<br/>  kind: ClusterRole<br/>  name: fluentd<br/>  apiGroup: rbac.authorization.k8s.io<br/>subjects:<br/>- kind: ServiceAccount<br/>  name: fluentd<br/>  namespace: kube-system</span></pre><p id="0289" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">创建:$ ku bectl create-f kubernetes/fluentd-RBAC . YAML</p><p id="4a35" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">现在，我们可以创造恶魔集了。</p><h2 id="3d4c" class="lr jy hh bd jz lz ma mb kd mc md me kh iw mf mg kl ja mh mi kp je mj mk kt ml bi translated"><strong class="ak"> 2。fluentd-daemonset.yaml </strong></h2><pre class="lc ld le lf fd lm ln lo lp aw lq bi"><span id="50c1" class="lr jy hh ln b fi ls lt l lu lv">apiVersion: extensions/v1beta1<br/>kind: DaemonSet<br/>metadata:<br/>  name: fluentd<br/>  namespace: kube-system<br/>  labels:<br/>    k8s-app: fluentd-logging<br/>    version: v1<br/>    kubernetes.io/cluster-service: "true"<br/>spec:<br/>  template:<br/>    metadata:<br/>      labels:<br/>        k8s-app: fluentd-logging<br/>        version: v1<br/>        kubernetes.io/cluster-service: "true"<br/>    spec:<br/>      serviceAccount: fluentd<br/>      serviceAccountName: fluentd<br/>      tolerations:<br/>      - key: node-role.kubernetes.io/master<br/>        effect: NoSchedule<br/>      containers:<br/>      - name: fluentd<br/>        image: fluent/fluentd-kubernetes-daemonset:v1.3-debian-elasticsearch<br/>        env:<br/>          - name:  FLUENT_ELASTICSEARCH_HOST<br/>            value: "elasticsearch.logging"<br/>          - name:  FLUENT_ELASTICSEARCH_PORT<br/>            value: "9200"<br/>          - name: FLUENT_ELASTICSEARCH_SCHEME<br/>            value: "http"<br/>          - name: FLUENT_UID<br/>            value: "0"<br/>        resources:<br/>          limits:<br/>            memory: 200Mi<br/>          requests:<br/>            cpu: 100m<br/>            memory: 200Mi<br/>        volumeMounts:<br/>        - name: varlog<br/>          mountPath: /var/log<br/>        - name: varlibdockercontainers<br/>          mountPath: /var/lib/docker/containers<br/>          readOnly: true<br/>      terminationGracePeriodSeconds: 30<br/>      volumes:<br/>      - name: varlog<br/>        hostPath:<br/>          path: /var/log<br/>      - name: varlibdockercontainers<br/>        hostPath:<br/>          path: /var/lib/docker/containers</span></pre><p id="a160" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">确保根据您的弹性搜索环境定义FLUENT _ elastic search _ HOST &amp; FLUENT _ elastic search _ PORT</p><h2 id="525b" class="lr jy hh bd jz lz ma mb kd mc md me kh iw mf mg kl ja mh mi kp je mj mk kt ml bi translated"><strong class="ak">部署:</strong></h2><pre class="lc ld le lf fd lm ln lo lp aw lq bi"><span id="ebe1" class="lr jy hh ln b fi ls lt l lu lv">$ kubectl create -f kubernetes/fluentd-daemonset.yaml</span></pre><figure class="lc ld le lf fd ii er es paragraph-image"><div class="er es lw"><img src="../Images/ff3eaa7937457db758e43660eb5dd681.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*c2A8PJ0CI8Jxr8Fv2W3NJg.png"/></div></figure><h2 id="d360" class="lr jy hh bd jz lz ma mb kd mc md me kh iw mf mg kl ja mh mi kp je mj mk kt ml bi translated"><strong class="ak">验证日志</strong></h2><pre class="lc ld le lf fd lm ln lo lp aw lq bi"><span id="17d9" class="lr jy hh ln b fi ls lt l lu lv">$ kubectl logs fluentd-lwbt6 -n kube-system | grep Connection</span></pre><p id="a724" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">您应该在日志中看到Fluentd连接到Elasticsearch:</p><figure class="lc ld le lf fd ii er es paragraph-image"><div class="er es lw"><img src="../Images/52d4edd3c2fc509463933bbf08f2f0d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1180/format:webp/1*BogABZ7ZErid8yeAYHb2sQ.png"/></div></figure><h1 id="4615" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">步骤4:在Kibana中可视化kubernetes数据</h1><ol class=""><li id="b223" class="jj jk hh in b io kv is kw iw mm ja mn je mo ji la jp jq jr bi translated">连接到kibana dashboard URL以从Amazon ES控制台获取</li><li id="8139" class="jj jk hh in b io js is jt iw ju ja jv je jw ji la jp jq jr bi translated">要在Kibana中查看Fluentd收集的日志，请单击“管理”,然后选择“Kibana”下的“索引模式”</li><li id="c053" class="jj jk hh in b io js is jt iw ju ja jv je jw ji la jp jq jr bi translated">选择默认索引模式(logstash-*)</li></ol><figure class="lc ld le lf fd ii er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es ms"><img src="../Images/ecf6c387349cb040cb8f60e6cc87db20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4QhmrpyHogkg6QqJXorYSQ.png"/></div></div></figure><p id="377c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">4.单击可视化并选择创建可视化，然后选择饼图。如下所示填写以下字段。</p><figure class="lc ld le lf fd ii er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es mt"><img src="../Images/acfcc6c08a2e2e5ff868fc5949ca3e96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IX7Xu-UGlk8Ey6eSUxpkbQ.png"/></div></div></figure><p id="42f4" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">5.单击发现查看您的应用程序日志</p><figure class="lc ld le lf fd ii er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es mu"><img src="../Images/1e5464ab6f58dfd9ffea251e416f42f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a5PeR25do3L924uTAm0avg.png"/></div></div></figure><p id="e920" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">6.单击可视化并选择创建可视化，然后选择饼图。如下所示填写以下字段。</p><ul class=""><li id="bb2d" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">选择Logstash-* index并单击拆分切片</li><li id="23e1" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">聚合—重要术语</li><li id="4c3c" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">field = kubernetes . pod _ name . keyword</li><li id="15ab" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">尺寸— 10</li></ul><figure class="lc ld le lf fd ii er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es mv"><img src="../Images/70d7d8810bc9b778c929457b84480d7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F0Nbpfr3N0VC2RWqoNYS5Q.png"/></div></div></figure><p id="ef81" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">7.并应用更改</p><figure class="lc ld le lf fd ii er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es mw"><img src="../Images/17c44f68c59e9f18841deb644e2ee937.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SvvDzVOncarCkxS7ukhNnA.png"/></div></div></figure><p id="4ab1" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">就是这样！这就是你如何想象在基巴纳创造的库伯内特豆荚。</p><h2 id="da18" class="lr jy hh bd jz lz ma mb kd mc md me kh iw mf mg kl ja mh mi kp je mj mk kt ml bi translated"><strong class="ak">总结</strong>:</h2><p id="cc0a" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">通过日志分析进行监控是任何应用程序部署的重要组成部分。您可以在Kubernetes中收集和整合集群中的日志，以便从一个单一的仪表板监控整个集群。在我们的例子中，我们看到fluentd充当了kubernetes集群和Amazon ES之间的中介。Fluentd结合了日志收集和聚合，并将日志发送到Amazon ES，以便使用kibana进行日志分析和数据可视化。</p><p id="bbdc" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">上面的例子展示了如何使用fluentd向kubernetes集群添加AWS弹性搜索日志记录和kibana监控。</p><p id="e376" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如果你想查看更多关于人工智能、Python、道德黑客等市场最热门技术的文章，你可以参考Edureka的官方网站。</p><p id="f4d4" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">请留意本系列中的其他文章，它们将解释Kubernetes的各个方面。</p><blockquote class="mx my mz"><p id="4cc8" class="il im na in b io ip iq ir is it iu iv nb ix iy iz nc jb jc jd nd jf jg jh ji ha bi translated">1.<a class="ae ll" rel="noopener" href="/edureka/what-is-kubernetes-container-orchestration-tool-d972741550f6">什么是Kubernetes？</a></p><p id="d1d0" class="il im na in b io ip iq ir is it iu iv nb ix iy iz nc jb jc jd nd jf jg jh ji ha bi translated">2.<a class="ae ll" rel="noopener" href="/edureka/install-kubernetes-on-ubuntu-5cd1f770c9e4">在Ubuntu上安装Kubernetes</a></p><p id="1a5f" class="il im na in b io ip iq ir is it iu iv nb ix iy iz nc jb jc jd nd jf jg jh ji ha bi translated">3.<a class="ae ll" rel="noopener" href="/edureka/kubernetes-tutorial-fe6de6a20325"> Kubernetes教程</a></p><p id="36c2" class="il im na in b io ip iq ir is it iu iv nb ix iy iz nc jb jc jd nd jf jg jh ji ha bi translated">4.<a class="ae ll" rel="noopener" href="/edureka/kubernetes-dashboard-d909b8b6579c"> Kubernetes仪表板安装&amp;视图</a></p><p id="a57a" class="il im na in b io ip iq ir is it iu iv nb ix iy iz nc jb jc jd nd jf jg jh ji ha bi translated">5.<a class="ae ll" rel="noopener" href="/edureka/kubernetes-architecture-c43531593ca5"> Kubernetes建筑</a></p><p id="c38f" class="il im na in b io ip iq ir is it iu iv nb ix iy iz nc jb jc jd nd jf jg jh ji ha bi translated">6.<a class="ae ll" rel="noopener" href="/edureka/kubernetes-networking-a46d9f994bab"> <em class="hh"> Kubernetes网络</em> </a></p><p id="37c1" class="il im na in b io ip iq ir is it iu iv nb ix iy iz nc jb jc jd nd jf jg jh ji ha bi translated">7.<a class="ae ll" rel="noopener" href="/edureka/kubernetes-vs-docker-45231abeeaf1">Kubernetes vs Docker Swarm</a></p><p id="d92c" class="il im na in b io ip iq ir is it iu iv nb ix iy iz nc jb jc jd nd jf jg jh ji ha bi translated">8.<a class="ae ll" rel="noopener" href="/edureka/kubernetes-interview-questions-c9790e5abddb"> Kubernetes面试问题</a></p><p id="5c2f" class="il im na in b io ip iq ir is it iu iv nb ix iy iz nc jb jc jd nd jf jg jh ji ha bi translated">9.<a class="ae ll" rel="noopener" href="/edureka/amazon-eks-ac646c23abf8">与亚马逊EKS合作开发Kubernetes应用</a></p><p id="26e0" class="il im na in b io ip iq ir is it iu iv nb ix iy iz nc jb jc jd nd jf jg jh ji ha bi translated">10.<a class="ae ll" rel="noopener" href="/edureka/kubernetes-ingress-controller-nginx-c5cf9e8ff031">在AWS上设置Kubernetes入口控制器</a></p></blockquote></div><div class="ab cl ne nf go ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ha hb hc hd he"><p id="2bab" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><em class="na">原载于2019年6月21日</em><a class="ae ll" href="https://www.edureka.co/blog/logging-monitoring-elasticsearch-fluentd-kibana/" rel="noopener ugc nofollow" target="_blank"><em class="na">https://www.edureka.co</em></a><em class="na">。</em></p></div></div>    
</body>
</html>