<html>
<head>
<title>Deploying a Kubernetes cluster with Vagrant on Virtual Box | Gerald on IT on WordPress.com</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在WordPress.com的虚拟机箱| Gerald上部署Kubernetes集群</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/deploying-a-kubernetes-cluster-with-vagrant-on-virtual-box-gerald-on-it-on-wordpress-com-b87c53e97c16?source=collection_archive---------0-----------------------#2018-03-26">https://medium.com/oracledevs/deploying-a-kubernetes-cluster-with-vagrant-on-virtual-box-gerald-on-it-on-wordpress-com-b87c53e97c16?source=collection_archive---------0-----------------------#2018-03-26</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="3ec8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Oracle已经包含了Kubernetes对其<a class="ae jc" href="https://github.com/oracle/vagrant-boxes" rel="noopener ugc nofollow" target="_blank"> VirtualBox流浪者GitHub库</a>的支持。有了它，现在在虚拟机内启动和运行Kubernetes集群比以往任何时候都更容易。如果你还没有遇到过<a class="ae jc" href="https://www.vagrantup.com/" rel="noopener ugc nofollow" target="_blank">vagger</a>，这是HashiCorp的一个很好的工具，可以让<em class="jd">开发环境变得简单</em>。</p><h1 id="a615" class="je jf hh bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">TL；博士；医生</h1><ol class=""><li id="3878" class="kc kd hh ig b ih ke il kf ip kg it kh ix ki jb kj kk kl km bi translated">安装VirtualBox</li><li id="1e0c" class="kc kd hh ig b ih kn il ko ip kp it kq ix kr jb kj kk kl km bi translated">安装流浪者</li><li id="a8ca" class="kc kd hh ig b ih kn il ko ip kp it kq ix kr jb kj kk kl km bi translated">克隆GitHub库git克隆<a class="ae jc" href="https://github.com/oracle/vagrant-boxes" rel="noopener ugc nofollow" target="_blank">https://github.com/oracle/vagrant-boxes</a></li><li id="8e58" class="kc kd hh ig b ih kn il ko ip kp it kq ix kr jb kj kk kl km bi translated">切换到<code class="du ks kt ku kv b">vagrant-boxes/Kubernetes</code>文件夹</li><li id="2d93" class="kc kd hh ig b ih kn il ko ip kp it kq ix kr jb kj kk kl km bi translated">运行<code class="du ks kt ku kv b">vagrant up master; vagrant ssh master</code></li><li id="f50a" class="kc kd hh ig b ih kn il ko ip kp it kq ix kr jb kj kk kl km bi translated">在主客户机中，以<code class="du ks kt ku kv b"><strong class="ig hi">root</strong></code> : <code class="du ks kt ku kv b">/vagrant/scripts/kubeadm-setup-master.sh</code> <br/>的身份运行，您将被要求登录到Oracle容器注册表</li><li id="6bc3" class="kc kd hh ig b ih kn il ko ip kp it kq ix kr jb kj kk kl km bi translated">跑<code class="du ks kt ku kv b">vagrant up worker1; vagrant ssh worker1</code></li><li id="d02f" class="kc kd hh ig b ih kn il ko ip kp it kq ix kr jb kj kk kl km bi translated">在worker1 guest中，作为<code class="du ks kt ku kv b"><strong class="ig hi">root</strong></code> : <code class="du ks kt ku kv b">/vagrant/scripts/kubeadm-setup-worker.sh</code> <br/>运行，您将被要求登录到Oracle容器注册中心</li><li id="869c" class="kc kd hh ig b ih kn il ko ip kp it kq ix kr jb kj kk kl km bi translated">对worker2重复最后2个步骤</li></ol><p id="1162" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您的集群已经准备好了！<br/>作为<code class="du ks kt ku kv b"><strong class="ig hi">vagrant</strong></code>用户，您可以在主访客中检查集群的状态，例如:</p><pre class="kw kx ky kz fd la kv lb lc aw ld bi"><span id="faf2" class="le jf hh kv b fi lf lg l lh li">kubectl cluster-info</span><span id="7267" class="le jf hh kv b fi lj lg l lh li">kubectl get nodes</span><span id="55d2" class="le jf hh kv b fi lj lg l lh li">kubectl get pods --namespace=kube-system</span></pre></div><div class="ab cl lk ll go lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ha hb hc hd he"><h1 id="ff46" class="je jf hh bd jg jh lr jj jk jl ls jn jo jp lt jr js jt lu jv jw jx lv jz ka kb bi translated">你需要什么</h1><p id="49d0" class="pw-post-body-paragraph ie if hh ig b ih ke ij ik il kf in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">为了开始，你只需要先做四件事:</p><h1 id="6fe0" class="je jf hh bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">设置</h1><p id="6ff4" class="pw-post-body-paragraph ie if hh ig b ih ke ij ik il kf in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">在你的机器上安装VirtualBox和vagger，不管它是Mac、Windows还是Linux，都非常简单。就我在Mac上的情况而言，这只是一个简单的下载和几次点击，所以我不打算在这里涵盖它。</p><h1 id="440a" class="je jf hh bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">Oracle容器注册中心</h1><p id="bdda" class="pw-post-body-paragraph ie if hh ig b ih ke ij ik il kf in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">供应脚本将从Oracle的一个完全免费的Docker映像存储库<a class="ae jc" href="https://container-registry.oracle.com/" rel="noopener ugc nofollow" target="_blank">Oracle Container Registry</a>中提取几个Kubernetes Docker映像。为此，您必须拥有一个Oracle帐户来登录容器注册中心并接受许可协议。这是一个快速的一次性任务，因为容器注册中心将在后续的拉取中记住您的许可接受。因此，如果您之前已经这样做了，您可以直接跳到<strong class="ig hi">在VirtualBox上创建Kubernetes集群</strong>。</p><h1 id="d92b" class="je jf hh bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">为container-registry.oracle.com创建Oracle帐户</h1><p id="7cab" class="pw-post-body-paragraph ie if hh ig b ih ke ij ik il kf in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">容器注册所需的用户与您可能已经用于OTN或其他Oracle网站的用户相同。如果您已经有一个，请跳过这一步，转到“<strong class="ig hi">接受最终用户许可协议</strong>”。否则，创建一个用户是快速和容易的。只需进入https://container-registry.oracle.com的<a class="ae jc" href="https://container-registry.oracle.com/" rel="noopener ugc nofollow" target="_blank"/>，点击右上角的<strong class="ig hi">注册</strong>，点击<strong class="ig hi">创建新的甲骨文账户</strong>:</p><figure class="kw kx ky kz fd ma er es paragraph-image"><div class="er es lz"><img src="../Images/93b4389f3a6ef4a2a93ad294bbea00dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/0*4EnmoKdUG6hETI9C."/></div></figure><p id="2741" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建帐户并登录后，就该接受许可协议了。</p><h1 id="97ec" class="je jf hh bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">接受最终用户许可协议</h1><p id="256c" class="pw-post-body-paragraph ie if hh ig b ih ke ij ik il kf in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">同样，这一步也是简单而直接的。从注册表中取出的所有组件都在“<strong class="ig hi">容器服务</strong>下:</p><figure class="kw kx ky kz fd ma er es paragraph-image"><div class="er es md"><img src="../Images/5c05bf71c820768d4b9924b7c1ec94eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:438/0*HA_aP01P_1LYDwC1."/></div></figure><p id="a9d1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您只需点击“Container Services ”,它会告诉您在从Oracle Container Registry下载之前，您必须同意并接受Oracle标准条款和限制。请仔细阅读下页的许可协议。 ”:</p><figure class="kw kx ky kz fd ma er es paragraph-image"><div class="er es lz"><img src="../Images/b6115a187d20a760a97fe68ba42f8c80.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/0*jUAAcgvivAY7MqvM."/></div></figure><p id="bc45" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">点击“<strong class="ig hi">继续</strong>，通读协议并点击右下角的“<strong class="ig hi">接受</strong>”，当然前提是您同意许可条款🙂</p><figure class="kw kx ky kz fd ma er es paragraph-image"><div role="button" tabindex="0" class="mf mg di mh bf mi"><div class="er es me"><img src="../Images/2296b8ae5d5a51e8c405a05c4f1ae483.png" data-original-src="https://miro.medium.com/v2/resize:fit:300/0*7FK8Wo2vh7BbCHK1."/></div></div></figure><p id="57dc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">就这样，现在您已经准备好构建您的Kubernetes集群了。请再次记住，许可接受只是一次性步骤。无论您构建或重建Kubernetes集群的频率有多高，今后您都不必再同意它了。</p><h1 id="351d" class="je jf hh bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">在VirtualBox上创建Kubernetes集群</h1><p id="695c" class="pw-post-body-paragraph ie if hh ig b ih ke ij ik il kf in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">在本例中，我们将创建一个一个主节点、两个工作节点的群集。</p><h1 id="e8a3" class="je jf hh bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">克隆GitHub存储库</h1><p id="247e" class="pw-post-body-paragraph ie if hh ig b ih ke ij ik il kf in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">首先，你必须在你的机器上有流浪者文件。这可以通过<code class="du ks kt ku kv b">git clone <a class="ae jc" href="https://github.com/oracle/vagrant-boxes" rel="noopener ugc nofollow" target="_blank">https://github.com/oracle/vagrant-boxes</a></code>克隆GitHub repo来完成，也可以通过浏览器中的<a class="ae jc" href="https://github.com/oracle/vagrant-boxes" rel="noopener ugc nofollow" target="_blank">“下载”按钮下载repo并解压:</a></p><pre class="kw kx ky kz fd la kv lb lc aw ld bi"><span id="6ffe" class="le jf hh kv b fi lf lg l lh li">$ git clone https://github.com/oracle/vagrant-boxes</span><span id="19e4" class="le jf hh kv b fi lj lg l lh li">Cloning into 'vagrant-boxes'...</span><span id="bc90" class="le jf hh kv b fi lj lg l lh li">remote: Counting objects: 342, <strong class="kv hi">done</strong>.</span><span id="5e97" class="le jf hh kv b fi lj lg l lh li">remote: Compressing objects: 100% (58/58), <strong class="kv hi">done</strong>.</span><span id="3879" class="le jf hh kv b fi lj lg l lh li">remote: Total 342 (delta 42), reused 71 (delta 31), pack-reused 249</span><span id="0d9b" class="le jf hh kv b fi lj lg l lh li">Receiving objects: 100% (342/342), 69.52 KiB | 4.63 MiB/s, <strong class="kv hi">done</strong>.</span><span id="db7f" class="le jf hh kv b fi lj lg l lh li">Resolving deltas: 100% (170/170), <strong class="kv hi">done</strong>.</span></pre><p id="d9c5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">完成后，进入Kubernetes文件夹:</p><pre class="kw kx ky kz fd la kv lb lc aw ld bi"><span id="70dc" class="le jf hh kv b fi lf lg l lh li">$ cd vagrant-boxes/Kubernetes/</span></pre><h1 id="9def" class="je jf hh bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">创造Kubernetes大师</h1><p id="9a66" class="pw-post-body-paragraph ie if hh ig b ih ke ij ik il kf in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">要创建主文件，只需输入<code class="du ks kt ku kv b">vagrant up master</code>。这将为您提供带有Kubernetes主服务器的虚拟机:</p><pre class="kw kx ky kz fd la kv lb lc aw ld bi"><span id="d8fb" class="le jf hh kv b fi lf lg l lh li">$ vagrant up master</span><span id="8577" class="le jf hh kv b fi lj lg l lh li">Bringing machine 'master'<!-- --> <!-- -->up with 'virtualbox'<!-- --> <!-- -->provider...</span><span id="79df" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Box 'ol7-latest'<!-- --> <!-- -->could not be found. Attempting to find<!-- --> <!-- -->and install...</span><span id="0436" class="le jf hh kv b fi lj lg l lh li">master: Box Provider: virtualbox</span><span id="a20e" class="le jf hh kv b fi lj lg l lh li">master: Box Version: &gt;= 0</span><span id="576c" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Box file<!-- --> <!-- -->was not detected as metadata. Adding it directly...</span><span id="451a" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Adding box 'ol7-latest'<!-- --> <!-- -->(v0) <strong class="kv hi">for</strong> <!-- -->provider: virtualbox</span><span id="3e6c" class="le jf hh kv b fi lj lg l lh li">master: Downloading: https://yum.oracle.com/boxes/oraclelinux/latest/ol7-latest.box</span><span id="1a8c" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Successfully added box 'ol7-latest'<!-- --> <!-- -->(v0) <strong class="kv hi">for</strong> <!-- -->'virtualbox'!</span><span id="cef5" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Importing base box 'ol7-latest'...</span><span id="d13a" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Matching MAC address <strong class="kv hi">for</strong> <!-- -->NAT networking...</span><span id="fdde" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Setting the name of the VM: Kubernetes_master_1521841817878_31194</span><span id="65f8" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Clearing any previously set<!-- --> <!-- -->network interfaces...</span><span id="3c42" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Preparing network interfaces based on configuration...</span><span id="8c75" class="le jf hh kv b fi lj lg l lh li">master: Adapter 1: nat</span><span id="735b" class="le jf hh kv b fi lj lg l lh li">master: Adapter 2: hostonly</span><span id="177f" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Forwarding ports...</span><span id="b7ce" class="le jf hh kv b fi lj lg l lh li">master: 8001 (guest) =&gt; 8001 (host) (adapter 1)</span><span id="cfae" class="le jf hh kv b fi lj lg l lh li">master: 22 (guest) =&gt; 2222 (host) (adapter 1)</span><span id="90bd" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Running 'pre-boot'<!-- --> <!-- -->VM customizations...</span><span id="9429" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Booting VM...</span><span id="d5e3" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Waiting <strong class="kv hi">for</strong> <!-- -->machine to boot. This may take a few minutes...</span><span id="325b" class="le jf hh kv b fi lj lg l lh li">master: SSH address: 127.0.0.1:2222</span><span id="30ca" class="le jf hh kv b fi lj lg l lh li">master: SSH username: vagrant</span><span id="faef" class="le jf hh kv b fi lj lg l lh li">master: SSH auth method: private key</span><span id="2c48" class="le jf hh kv b fi lj lg l lh li">master:</span><span id="a668" class="le jf hh kv b fi lj lg l lh li">master: Vagrant insecure key detected. Vagrant will automatically replace</span><span id="4e2c" class="le jf hh kv b fi lj lg l lh li">master: this with a newly generated keypair <strong class="kv hi">for</strong> <!-- -->better security.</span><span id="16c0" class="le jf hh kv b fi lj lg l lh li">master:</span><span id="8300" class="le jf hh kv b fi lj lg l lh li">master: Inserting generated public key within guest...</span><span id="be41" class="le jf hh kv b fi lj lg l lh li">master: Removing insecure key from the guest <strong class="kv hi">if</strong> <!-- -->it's present...</span><span id="9510" class="le jf hh kv b fi lj lg l lh li">master: Key inserted! Disconnecting and reconnecting using new SSH key...</span><span id="2637" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Machine booted and ready!</span><span id="7a59" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Checking <strong class="kv hi">for</strong> <!-- -->guest additions <strong class="kv hi">in</strong> <!-- -->VM...</span><span id="ba18" class="le jf hh kv b fi lj lg l lh li">master: The guest additions on this VM <strong class="kv hi">do</strong> <!-- -->not match the installed version of</span><span id="35b5" class="le jf hh kv b fi lj lg l lh li">master: VirtualBox! In most cases this is fine, but <strong class="kv hi">in</strong> <!-- -->rare cases it can</span><span id="17f7" class="le jf hh kv b fi lj lg l lh li">master: prevent things such as shared folders from working properly. If you see</span><span id="d468" class="le jf hh kv b fi lj lg l lh li">master: shared folder errors, please make<!-- --> <!-- -->sure the guest additions within the</span><span id="5ec7" class="le jf hh kv b fi lj lg l lh li">master: virtual machine match the version of VirtualBox you have installed on</span><span id="eead" class="le jf hh kv b fi lj lg l lh li">master: your host and reload your VM.</span><span id="3c02" class="le jf hh kv b fi lj lg l lh li">master:</span><span id="9e89" class="le jf hh kv b fi lj lg l lh li">master: Guest Additions Version: 5.1.24</span><span id="96a6" class="le jf hh kv b fi lj lg l lh li">master: VirtualBox Version: 5.2</span><span id="656c" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Setting hostname...</span><span id="a2a4" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Configuring and enabling network interfaces...</span><span id="8628" class="le jf hh kv b fi lj lg l lh li">master: SSH address: 127.0.0.1:2222</span><span id="31c8" class="le jf hh kv b fi lj lg l lh li">master: SSH username: vagrant</span><span id="1507" class="le jf hh kv b fi lj lg l lh li">master: SSH auth method: private key</span><span id="34a1" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Configuring proxy environment variables...</span><span id="f8a5" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Mounting shared folders...</span><span id="71e0" class="le jf hh kv b fi lj lg l lh li">master: /vagrant<!-- --> <!-- -->=&gt; /Users/gvenzl/Downloads/vagrant-boxes/Kubernetes</span><span id="b636" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Running provisioner: shell...</span><span id="ea32" class="le jf hh kv b fi lj lg l lh li">master: Running: /var/folders/5m/xnj65v6d4dx8vbkp_7dt_pyw0000gn/T/vagrant-shell20180323-6639-15ftx0.sh</span><span id="3b01" class="le jf hh kv b fi lj lg l lh li">master: Installing and configuring Docker Engine</span><span id="f3e0" class="le jf hh kv b fi lj lg l lh li">...</span><span id="f219" class="le jf hh kv b fi lj lg l lh li">...</span><span id="3b0e" class="le jf hh kv b fi lj lg l lh li">...</span><span id="bf5a" class="le jf hh kv b fi lj lg l lh li">master: Installed:</span><span id="c5d7" class="le jf hh kv b fi lj lg l lh li">master: kubeadm.x86_64 0:1.9.1-2.0.2.el7</span><span id="8069" class="le jf hh kv b fi lj lg l lh li">master:</span><span id="b762" class="le jf hh kv b fi lj lg l lh li">master: Dependency Installed:</span><span id="f2e5" class="le jf hh kv b fi lj lg l lh li">master: kubectl.x86_64 0:1.9.1-2.0.2.el7</span><span id="5b71" class="le jf hh kv b fi lj lg l lh li">master: kubelet.x86_64 0:1.9.1-2.0.2.el7</span><span id="d519" class="le jf hh kv b fi lj lg l lh li">master: kubernetes-cni.x86_64 0:0.6.0-2.0.1.el7</span><span id="d2db" class="le jf hh kv b fi lj lg l lh li">master: kubernetes-cni-plugins.x86_64 0:0.6.0-2.0.1.el7</span><span id="1ced" class="le jf hh kv b fi lj lg l lh li">master: socat.x86_64 0:1.7.3.2-2.el7</span><span id="7dfe" class="le jf hh kv b fi lj lg l lh li">master: Complete!</span><span id="5f1c" class="le jf hh kv b fi lj lg l lh li">master: net.bridge.bridge-nf-call-ip6tables = 1</span><span id="298d" class="le jf hh kv b fi lj lg l lh li">master: net.bridge.bridge-nf-call-iptables = 1</span><span id="dcb6" class="le jf hh kv b fi lj lg l lh li">master: Your Kubernetes VM is ready to use!</span><span id="f0a4" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Configuring proxy <strong class="kv hi">for</strong> <!-- -->Docker...</span><span id="7953" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Running provisioner: shell...</span><span id="3ae7" class="le jf hh kv b fi lj lg l lh li">master: Running: inline script</span><span id="a559" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Configuring proxy <strong class="kv hi">for</strong> <!-- -->Docker...</span><span id="6028" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Running provisioner: shell...</span><span id="c7db" class="le jf hh kv b fi lj lg l lh li">master: Running: inline script</span><span id="d58f" class="le jf hh kv b fi lj lg l lh li">==&gt; master: Configuring proxy <strong class="kv hi">for</strong> <!-- -->Docker...</span><span id="ac3c" class="le jf hh kv b fi lj lg l lh li">$</span></pre><p id="35f9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦主虚拟机启动，ssh进入虚拟机并作为<code class="du ks kt ku kv b"><strong class="ig hi">root</strong></code>用户<code class="du ks kt ku kv b">/vagrant/scripts/kubeadm-setup-master.sh</code>运行。这将为您提供Kubernetes主注释。<strong class="ig hi">请注意，脚本会要求您输入container-registry.oracle.com的用户名和密码</strong>:</p><pre class="kw kx ky kz fd la kv lb lc aw ld bi"><span id="c84c" class="le jf hh kv b fi lf lg l lh li">$ vagrant ssh<!-- --> <!-- -->master</span><span id="f36e" class="le jf hh kv b fi lj lg l lh li">Welcome to Oracle Linux Server release 7.4 (GNU/Linux<!-- --> <!-- -->4.1.12-112.14.13.el7uek.x86_64)</span><span id="5665" class="le jf hh kv b fi lj lg l lh li">The Oracle Linux End-User License Agreement can be viewed here:</span><span id="273f" class="le jf hh kv b fi lj lg l lh li">* /usr/share/eula/eula.en_US</span><span id="2e82" class="le jf hh kv b fi lj lg l lh li">For additional packages, updates, documentation and community help, see:</span><span id="3dcf" class="le jf hh kv b fi lj lg l lh li">* http://yum.oracle.com/</span><span id="d75d" class="le jf hh kv b fi lj lg l lh li">[vagrant@master ~]$ su<!-- --> <!-- -->-</span><span id="4ac7" class="le jf hh kv b fi lj lg l lh li">[root@master ~]# /vagrant/scripts/kubeadm-setup-master.sh</span><span id="6714" class="le jf hh kv b fi lj lg l lh li">/vagrant/scripts/kubeadm-setup-master.sh: Login to container registry</span><span id="ce9a" class="le jf hh kv b fi lj lg l lh li">Username: gerald[dot]venzl[at]oracle[dot]com</span><span id="0d12" class="le jf hh kv b fi lj lg l lh li">Password:</span><span id="b6f7" class="le jf hh kv b fi lj lg l lh li">Login Succeeded</span><span id="c8c7" class="le jf hh kv b fi lj lg l lh li">/vagrant/scripts/kubeadm-setup-master.sh: Setup Master node</span><span id="9ce5" class="le jf hh kv b fi lj lg l lh li">Starting to initialize master node ...</span><span id="ad1d" class="le jf hh kv b fi lj lg l lh li">Checking <strong class="kv hi">if</strong> <!-- -->env<!-- --> <!-- -->is ready ...</span><span id="39f5" class="le jf hh kv b fi lj lg l lh li">Checking whether docker can pull busybox image ...</span><span id="e83f" class="le jf hh kv b fi lj lg l lh li">Checking access to container-registry.oracle.com/kubernetes<!-- --> <!-- -->...</span><span id="5fb5" class="le jf hh kv b fi lj lg l lh li">v1.9.1: Pulling from kubernetes/kube-proxy-amd64</span><span id="2497" class="le jf hh kv b fi lj lg l lh li">Digest: sha256:852fbdc6be8b357356c047bd9649e1c62f572c0e61a0526cd048c0d0dc675e4d</span><span id="4a9e" class="le jf hh kv b fi lj lg l lh li">Status: Image is up to date<!-- --> <strong class="kv hi">for</strong> <!-- -->container-registry.oracle.com/kubernetes/kube-proxy-amd64:v1.9.1</span><span id="cfce" class="le jf hh kv b fi lj lg l lh li">Checking whether docker can run container ...</span><span id="d9ea" class="le jf hh kv b fi lj lg l lh li">Checking iptables default rule ...</span><span id="8330" class="le jf hh kv b fi lj lg l lh li">Checking br_netfilter module ...</span><span id="9cb6" class="le jf hh kv b fi lj lg l lh li">Checking sysctl variables ...</span><span id="508c" class="le jf hh kv b fi lj lg l lh li">Enabling kubelet ...</span><span id="3916" class="le jf hh kv b fi lj lg l lh li">Created symlink<!-- --> <!-- -->from /etc/systemd/system/multi-user.target.wants/kubelet.service to /etc/systemd/system/kubelet.service.</span><span id="77b5" class="le jf hh kv b fi lj lg l lh li">Check successful, ready to run 'up'<!-- --> <!-- -->command<!-- --> <!-- -->...</span><span id="b5e5" class="le jf hh kv b fi lj lg l lh li">Waiting <strong class="kv hi">for</strong> <!-- -->kubeadm to setup master cluster...</span><span id="4066" class="le jf hh kv b fi lj lg l lh li">Please wait ...</span><span id="7710" class="le jf hh kv b fi lj lg l lh li">- - 75% completed</span><span id="2ab8" class="le jf hh kv b fi lj lg l lh li">Waiting <strong class="kv hi">for</strong> <!-- -->the control plane to become ready ...</span><span id="4e45" class="le jf hh kv b fi lj lg l lh li">...............</span><span id="2a4a" class="le jf hh kv b fi lj lg l lh li">100% completed</span><span id="0b6f" class="le jf hh kv b fi lj lg l lh li">clusterrole "flannel"<!-- --> <!-- -->created</span><span id="7158" class="le jf hh kv b fi lj lg l lh li">clusterrolebinding "flannel"<!-- --> <!-- -->created</span><span id="937e" class="le jf hh kv b fi lj lg l lh li">serviceaccount "flannel"<!-- --> <!-- -->created</span><span id="c567" class="le jf hh kv b fi lj lg l lh li">configmap "kube-flannel-cfg"<!-- --> <!-- -->created</span><span id="822f" class="le jf hh kv b fi lj lg l lh li">daemonset "kube-flannel-ds"<!-- --> <!-- -->created</span><span id="f86f" class="le jf hh kv b fi lj lg l lh li">Installing kubernetes-dashboard ...</span><span id="ff22" class="le jf hh kv b fi lj lg l lh li">Creating self-signed certificates</span><span id="5ac1" class="le jf hh kv b fi lj lg l lh li">Generating a 2048 bit RSA private key</span><span id="7d95" class="le jf hh kv b fi lj lg l lh li">..................................................+++</span><span id="81fc" class="le jf hh kv b fi lj lg l lh li">.......................+++</span><span id="c895" class="le jf hh kv b fi lj lg l lh li">writing new private key to 'dashboard.key'</span><span id="cc77" class="le jf hh kv b fi lj lg l lh li">-----</span><span id="58d5" class="le jf hh kv b fi lj lg l lh li">No value provided <strong class="kv hi">for</strong> <!-- -->Subject Attribute C, skipped</span><span id="8445" class="le jf hh kv b fi lj lg l lh li">No value provided <strong class="kv hi">for</strong> <!-- -->Subject Attribute ST, skipped</span><span id="2e32" class="le jf hh kv b fi lj lg l lh li">No value provided <strong class="kv hi">for</strong> <!-- -->Subject Attribute L, skipped</span><span id="58fd" class="le jf hh kv b fi lj lg l lh li">No value provided <strong class="kv hi">for</strong> <!-- -->Subject Attribute O, skipped</span><span id="6ee8" class="le jf hh kv b fi lj lg l lh li">No value provided <strong class="kv hi">for</strong> <!-- -->Subject Attribute OU, skipped</span><span id="a549" class="le jf hh kv b fi lj lg l lh li">Signature ok</span><span id="1a11" class="le jf hh kv b fi lj lg l lh li">subject=/CN=kubernetes-dashboard</span><span id="3d22" class="le jf hh kv b fi lj lg l lh li">Getting Private key</span><span id="ae67" class="le jf hh kv b fi lj lg l lh li">secret "kubernetes-dashboard-certs"<!-- --> <!-- -->created</span><span id="7549" class="le jf hh kv b fi lj lg l lh li">serviceaccount "kubernetes-dashboard"<!-- --> <!-- -->created</span><span id="0528" class="le jf hh kv b fi lj lg l lh li">role "kubernetes-dashboard-minimal"<!-- --> <!-- -->created</span><span id="eed8" class="le jf hh kv b fi lj lg l lh li">rolebinding "kubernetes-dashboard-minimal"<!-- --> <!-- -->created</span><span id="19aa" class="le jf hh kv b fi lj lg l lh li">deployment "kubernetes-dashboard"<!-- --> <!-- -->created</span><span id="57eb" class="le jf hh kv b fi lj lg l lh li">service "kubernetes-dashboard"<!-- --> <!-- -->created</span><span id="b4f2" class="le jf hh kv b fi lj lg l lh li">Enabling kubectl-proxy.service ...</span><span id="0d95" class="le jf hh kv b fi lj lg l lh li">Starting kubectl-proxy.service ...</span><span id="42d8" class="le jf hh kv b fi lj lg l lh li">[===&gt; PLEASE DO THE FOLLOWING STEPS BELOW: &lt;===]</span><span id="7188" class="le jf hh kv b fi lj lg l lh li">Your Kubernetes master has initialized successfully!</span><span id="2f38" class="le jf hh kv b fi lj lg l lh li">To start using your cluster, you need to run the following as a regular user:</span><span id="7136" class="le jf hh kv b fi lj lg l lh li">mkdir<!-- --> <!-- -->-p $HOME/.kube</span><span id="5c46" class="le jf hh kv b fi lj lg l lh li">sudo<!-- --> <!-- -->cp<!-- --> <!-- -->-i /etc/kubernetes/admin.conf $HOME/.kube/config</span><span id="880d" class="le jf hh kv b fi lj lg l lh li">sudo<!-- --> <!-- -->chown<!-- --> <!-- -->$(id<!-- --> <!-- -->-u):$(id<!-- --> <!-- -->-g) $HOME/.kube/config</span><span id="9cf7" class="le jf hh kv b fi lj lg l lh li">You can now join<!-- --> <!-- -->any number of machines by running the following on each node</span><span id="acee" class="le jf hh kv b fi lj lg l lh li">as root:</span><span id="8bd7" class="le jf hh kv b fi lj lg l lh li">kubeadm-setup.sh join<!-- --> <!-- -->--token ce109c.ae7671a693f813d9 192.168.99.100:6443 --discovery-token-ca-cert-hash<!-- --> <!-- -->sha256:861b4d11c037bae9069c8a22c47391b986ea95cab299534d9d0d7f6657eae4f1</span><span id="f4af" class="le jf hh kv b fi lj lg l lh li">/vagrant/scripts/kubeadm-setup-master.sh: Copying admin.conf <strong class="kv hi">for</strong> <!-- -->vagrant user</span><span id="8a24" class="le jf hh kv b fi lj lg l lh li">/vagrant/scripts/kubeadm-setup-master.sh: Copying admin.conf into host directory</span><span id="20d2" class="le jf hh kv b fi lj lg l lh li">/vagrant/scripts/kubeadm-setup-master.sh: Saving token <strong class="kv hi">for</strong> <!-- -->worker nodes</span><span id="6c47" class="le jf hh kv b fi lj lg l lh li">/vagrant/scripts/kubeadm-setup-master.sh: Master node ready, run</span><span id="e3e5" class="le jf hh kv b fi lj lg l lh li">/vagrant/scripts/kubeadm-setup-worker.sh</span><span id="df0c" class="le jf hh kv b fi lj lg l lh li">on the worker nodes</span><span id="a011" class="le jf hh kv b fi lj lg l lh li">[root@master ~]# exit</span><span id="70ec" class="le jf hh kv b fi lj lg l lh li">logout</span><span id="91fd" class="le jf hh kv b fi lj lg l lh li">[vagrant@master ~]$ exit</span><span id="5887" class="le jf hh kv b fi lj lg l lh li">logout</span><span id="16a2" class="le jf hh kv b fi lj lg l lh li">Connection to 127.0.0.1 closed.</span><span id="b73e" class="le jf hh kv b fi lj lg l lh li">$</span></pre><h1 id="3d6d" class="je jf hh bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">创建Kubernetes工作节点</h1><p id="bccd" class="pw-post-body-paragraph ie if hh ig b ih ke ij ik il kf in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">一旦主节点启动并运行，现在就可以配置工作节点了。这同样容易。要提供第一个工作者节点类型<code class="du ks kt ku kv b">vagrant up worker1</code>:</p><pre class="kw kx ky kz fd la kv lb lc aw ld bi"><span id="84e5" class="le jf hh kv b fi lf lg l lh li">$ vagrant up worker1</span><span id="c0ba" class="le jf hh kv b fi lj lg l lh li">Bringing machine 'worker1'<!-- --> <!-- -->up with 'virtualbox'<!-- --> <!-- -->provider...</span><span id="c46d" class="le jf hh kv b fi lj lg l lh li">==&gt; worker1: Importing base box 'ol7-latest'...</span><span id="aa02" class="le jf hh kv b fi lj lg l lh li">==&gt; worker1: Matching MAC address <strong class="kv hi">for</strong> <!-- -->NAT networking...</span><span id="0122" class="le jf hh kv b fi lj lg l lh li">==&gt; worker1: Setting the name of the VM: Kubernetes_worker1_1521842646941_61070</span><span id="73a1" class="le jf hh kv b fi lj lg l lh li">==&gt; worker1: Fixed port collision <strong class="kv hi">for</strong> <!-- -->22 =&gt; 2222. Now on port 2200.</span><span id="97d4" class="le jf hh kv b fi lj lg l lh li">==&gt; worker1: Clearing any previously set<!-- --> <!-- -->network interfaces...</span><span id="6b46" class="le jf hh kv b fi lj lg l lh li">==&gt; worker1: Preparing network interfaces based on configuration...</span><span id="ecd2" class="le jf hh kv b fi lj lg l lh li">worker1: Adapter 1: nat</span><span id="57c5" class="le jf hh kv b fi lj lg l lh li">worker1: Adapter 2: hostonly</span><span id="9f46" class="le jf hh kv b fi lj lg l lh li">==&gt; worker1: Forwarding ports...</span><span id="12bf" class="le jf hh kv b fi lj lg l lh li">worker1: 22 (guest) =&gt; 2200 (host) (adapter 1)</span><span id="e9f0" class="le jf hh kv b fi lj lg l lh li">==&gt; worker1: Running 'pre-boot'<!-- --> <!-- -->VM customizations...</span><span id="e4e4" class="le jf hh kv b fi lj lg l lh li">==&gt; worker1: Booting VM...</span><span id="96f7" class="le jf hh kv b fi lj lg l lh li">==&gt; worker1: Waiting <strong class="kv hi">for</strong> <!-- -->machine to boot. This may take a few minutes...</span><span id="9e06" class="le jf hh kv b fi lj lg l lh li">worker1: SSH address: 127.0.0.1:2200</span><span id="846d" class="le jf hh kv b fi lj lg l lh li">...</span><span id="eb54" class="le jf hh kv b fi lj lg l lh li">...</span><span id="19a5" class="le jf hh kv b fi lj lg l lh li">...</span><span id="fd02" class="le jf hh kv b fi lj lg l lh li">worker1: Installed:</span><span id="e728" class="le jf hh kv b fi lj lg l lh li">worker1: kubeadm.x86_64 0:1.9.1-2.0.2.el7</span><span id="6dad" class="le jf hh kv b fi lj lg l lh li">worker1:</span><span id="fa12" class="le jf hh kv b fi lj lg l lh li">worker1: Dependency Installed:</span><span id="c172" class="le jf hh kv b fi lj lg l lh li">worker1: kubectl.x86_64 0:1.9.1-2.0.2.el7</span><span id="fa61" class="le jf hh kv b fi lj lg l lh li">worker1: kubelet.x86_64 0:1.9.1-2.0.2.el7</span><span id="5cda" class="le jf hh kv b fi lj lg l lh li">worker1: kubernetes-cni.x86_64 0:0.6.0-2.0.1.el7</span><span id="cee7" class="le jf hh kv b fi lj lg l lh li">worker1: kubernetes-cni-plugins.x86_64 0:0.6.0-2.0.1.el7</span><span id="1838" class="le jf hh kv b fi lj lg l lh li">worker1: socat.x86_64 0:1.7.3.2-2.el7</span><span id="0fbc" class="le jf hh kv b fi lj lg l lh li">worker1: Complete!</span><span id="d6c6" class="le jf hh kv b fi lj lg l lh li">worker1: net.bridge.bridge-nf-call-ip6tables = 1</span><span id="819d" class="le jf hh kv b fi lj lg l lh li">worker1: net.bridge.bridge-nf-call-iptables = 1</span><span id="0dfc" class="le jf hh kv b fi lj lg l lh li">worker1: Your Kubernetes VM is ready to use!</span><span id="aedc" class="le jf hh kv b fi lj lg l lh li">==&gt; worker1: Configuring proxy <strong class="kv hi">for</strong> <!-- -->Docker...</span><span id="74e3" class="le jf hh kv b fi lj lg l lh li">$</span></pre><p id="ca15" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦<code class="du ks kt ku kv b">worker1</code>虚拟机启动并运行，再次通过ssh进入虚拟机，并作为<code class="du ks kt ku kv b"><strong class="ig hi">root</strong></code>用户:<code class="du ks kt ku kv b">/vagrant/scripts/kubeadm-setup-worker.sh</code>运行。您将再次被要求提供container-registry.oracle.com的用户名和密码:</p><pre class="kw kx ky kz fd la kv lb lc aw ld bi"><span id="9ea9" class="le jf hh kv b fi lf lg l lh li">$ vagrant ssh<!-- --> <!-- -->worker1</span><span id="4197" class="le jf hh kv b fi lj lg l lh li">Welcome to Oracle Linux Server release 7.4 (GNU/Linux<!-- --> <!-- -->4.1.12-112.14.13.el7uek.x86_64)</span><span id="b7b3" class="le jf hh kv b fi lj lg l lh li">The Oracle Linux End-User License Agreement can be viewed here:</span><span id="a310" class="le jf hh kv b fi lj lg l lh li">* /usr/share/eula/eula.en_US</span><span id="f327" class="le jf hh kv b fi lj lg l lh li">For additional packages, updates, documentation and community help, see:</span><span id="28d5" class="le jf hh kv b fi lj lg l lh li">* http://yum.oracle.com/</span><span id="8c76" class="le jf hh kv b fi lj lg l lh li">[vagrant@worker1 ~]$ su<!-- --> <!-- -->-</span><span id="3030" class="le jf hh kv b fi lj lg l lh li">[root@worker1 ~]# /vagrant/scripts/kubeadm-setup-worker.sh</span><span id="9980" class="le jf hh kv b fi lj lg l lh li">/vagrant/scripts/kubeadm-setup-worker.sh: Login to container registry</span><span id="6fda" class="le jf hh kv b fi lj lg l lh li">Username: gerald[dot]venzl[at]oracle[dot]com</span><span id="f4a0" class="le jf hh kv b fi lj lg l lh li">Password:</span><span id="87a0" class="le jf hh kv b fi lj lg l lh li">Login Succeeded</span><span id="1d95" class="le jf hh kv b fi lj lg l lh li">/vagrant/scripts/kubeadm-setup-worker.sh: Setup Worker node</span><span id="ba0b" class="le jf hh kv b fi lj lg l lh li">Starting to initialize worker node ...</span><span id="f60f" class="le jf hh kv b fi lj lg l lh li">Checking <strong class="kv hi">if</strong> <!-- -->env<!-- --> <!-- -->is ready ...</span><span id="cc0b" class="le jf hh kv b fi lj lg l lh li">Checking whether docker can pull busybox image ...</span><span id="0a4e" class="le jf hh kv b fi lj lg l lh li">Checking access to container-registry.oracle.com/kubernetes<!-- --> <!-- -->...</span><span id="82f0" class="le jf hh kv b fi lj lg l lh li">v1.9.1: Pulling from kubernetes/kube-proxy-amd64</span><span id="4693" class="le jf hh kv b fi lj lg l lh li">Digest: sha256:852fbdc6be8b357356c047bd9649e1c62f572c0e61a0526cd048c0d0dc675e4d</span><span id="3e23" class="le jf hh kv b fi lj lg l lh li">Status: Image is up to date<!-- --> <strong class="kv hi">for</strong> <!-- -->container-registry.oracle.com/kubernetes/kube-proxy-amd64:v1.9.1</span><span id="1e53" class="le jf hh kv b fi lj lg l lh li">Checking whether docker can run container ...</span><span id="b6e1" class="le jf hh kv b fi lj lg l lh li">Checking iptables default rule ...</span><span id="57ba" class="le jf hh kv b fi lj lg l lh li">Checking br_netfilter module ...</span><span id="6cba" class="le jf hh kv b fi lj lg l lh li">Checking sysctl variables ...</span><span id="02d1" class="le jf hh kv b fi lj lg l lh li">Enabling kubelet ...</span><span id="9654" class="le jf hh kv b fi lj lg l lh li">Created symlink<!-- --> <!-- -->from /etc/systemd/system/multi-user.target.wants/kubelet.service to /etc/systemd/system/kubelet.service.</span><span id="c392" class="le jf hh kv b fi lj lg l lh li">Check successful, ready to run 'join'<!-- --> <!-- -->command<!-- --> <!-- -->...</span><span id="5253" class="le jf hh kv b fi lj lg l lh li">[preflight] Running pre-flight checks.</span><span id="32c3" class="le jf hh kv b fi lj lg l lh li">[validation] WARNING: kubeadm doesn't fully support multiple API Servers yet</span><span id="0e9f" class="le jf hh kv b fi lj lg l lh li">[discovery] Trying to connect to API Server "192.168.99.100:6443"</span><span id="dad4" class="le jf hh kv b fi lj lg l lh li">[discovery] Trying to connect to API Server "192.168.99.100:6443"</span><span id="215a" class="le jf hh kv b fi lj lg l lh li">[discovery] Created cluster-info discovery client, requesting info from "<a class="ae jc" href="https://192.168.99.100:6443/" rel="noopener ugc nofollow" target="_blank">https://192.168.99.100:6443</a>"</span><span id="9add" class="le jf hh kv b fi lj lg l lh li">[discovery] Created cluster-info discovery client, requesting info from "<a class="ae jc" href="https://192.168.99.100:6443/" rel="noopener ugc nofollow" target="_blank">https://192.168.99.100:6443</a>"</span><span id="2f15" class="le jf hh kv b fi lj lg l lh li">[discovery] Requesting info from "<a class="ae jc" href="https://192.168.99.100:6443/" rel="noopener ugc nofollow" target="_blank">https://192.168.99.100:6443</a>"<!-- --> <!-- -->again to validate TLS against the pinned public key</span><span id="0ffe" class="le jf hh kv b fi lj lg l lh li">[discovery] Cluster info signature and contents are valid and TLS certificate validates against pinned roots, will use API Server "192.168.99.100:6443"</span><span id="8b7f" class="le jf hh kv b fi lj lg l lh li">[discovery] Successfully established connection with API Server "192.168.99.100:6443"</span><span id="a723" class="le jf hh kv b fi lj lg l lh li">[discovery] Requesting info from "<a class="ae jc" href="https://192.168.99.100:6443/" rel="noopener ugc nofollow" target="_blank">https://192.168.99.100:6443</a>"<!-- --> <!-- -->again to validate TLS against the pinned public key</span><span id="7f6f" class="le jf hh kv b fi lj lg l lh li">[discovery] Cluster info signature and contents are valid and TLS certificate validates against pinned roots, will use API Server "192.168.99.100:6443"</span><span id="055a" class="le jf hh kv b fi lj lg l lh li">[discovery] Successfully established connection with API Server "192.168.99.100:6443"</span><span id="61f6" class="le jf hh kv b fi lj lg l lh li">This node has joined the cluster:</span><span id="eb71" class="le jf hh kv b fi lj lg l lh li">* Certificate signing request was sent to master and a response</span><span id="6c1f" class="le jf hh kv b fi lj lg l lh li">was received.</span><span id="f9ec" class="le jf hh kv b fi lj lg l lh li">* The Kubelet was informed of the new secure connection details.</span><span id="5c5c" class="le jf hh kv b fi lj lg l lh li">Run 'kubectl get nodes'<!-- --> <!-- -->on the master to see this node join<!-- --> <!-- -->the cluster.</span><span id="a229" class="le jf hh kv b fi lj lg l lh li">/vagrant/scripts/kubeadm-setup-worker.sh: Worker node ready</span><span id="8ae2" class="le jf hh kv b fi lj lg l lh li">[root@worker1 ~]# exit</span><span id="086a" class="le jf hh kv b fi lj lg l lh li">logout</span><span id="662f" class="le jf hh kv b fi lj lg l lh li">[vagrant@worker1 ~]$ exit</span><span id="d4d5" class="le jf hh kv b fi lj lg l lh li">logout</span><span id="043a" class="le jf hh kv b fi lj lg l lh li">Connection to 127.0.0.1 closed.</span><span id="3231" class="le jf hh kv b fi lj lg l lh li">$</span></pre><p id="a418" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">设置完成后，退出虚拟机并执行<code class="du ks kt ku kv b">worker2</code>的步骤:</p><pre class="kw kx ky kz fd la kv lb lc aw ld bi"><span id="820d" class="le jf hh kv b fi lf lg l lh li">$ vagrant up worker2</span><span id="79de" class="le jf hh kv b fi lj lg l lh li">Bringing machine 'worker2'<!-- --> <!-- -->up with 'virtualbox'<!-- --> <!-- -->provider...</span><span id="2a84" class="le jf hh kv b fi lj lg l lh li">==&gt; worker2: Importing base box 'ol7-latest'...</span><span id="8299" class="le jf hh kv b fi lj lg l lh li">==&gt; worker2: Matching MAC address <strong class="kv hi">for</strong> <!-- -->NAT networking...</span><span id="d2ca" class="le jf hh kv b fi lj lg l lh li">==&gt; worker2: Setting the name of the VM: Kubernetes_worker2_1521843186488_78983</span><span id="38c1" class="le jf hh kv b fi lj lg l lh li">==&gt; worker2: Fixed port collision <strong class="kv hi">for</strong> <!-- -->22 =&gt; 2222. Now on port 2201.</span><span id="cdf8" class="le jf hh kv b fi lj lg l lh li">==&gt; worker2: Clearing any previously set<!-- --> <!-- -->network interfaces...</span><span id="a1f9" class="le jf hh kv b fi lj lg l lh li">==&gt; worker2: Preparing network interfaces based on configuration...</span><span id="f7f0" class="le jf hh kv b fi lj lg l lh li">worker2: Adapter 1: nat</span><span id="ec1c" class="le jf hh kv b fi lj lg l lh li">worker2: Adapter 2: hostonly</span><span id="844c" class="le jf hh kv b fi lj lg l lh li">==&gt; worker2: Forwarding ports...</span><span id="43ca" class="le jf hh kv b fi lj lg l lh li">worker2: 22 (guest) =&gt; 2201 (host) (adapter 1)</span><span id="76b2" class="le jf hh kv b fi lj lg l lh li">==&gt; worker2: Running 'pre-boot'<!-- --> <!-- -->VM customizations...</span><span id="b868" class="le jf hh kv b fi lj lg l lh li">==&gt; worker2: Booting VM...</span><span id="04e6" class="le jf hh kv b fi lj lg l lh li">==&gt; worker2: Waiting <strong class="kv hi">for</strong> <!-- -->machine to boot. This may take a few minutes...</span><span id="6bda" class="le jf hh kv b fi lj lg l lh li">worker2: SSH address: 127.0.0.1:2201</span><span id="125f" class="le jf hh kv b fi lj lg l lh li">...</span><span id="32ba" class="le jf hh kv b fi lj lg l lh li">...</span><span id="4d8e" class="le jf hh kv b fi lj lg l lh li">...</span><span id="1274" class="le jf hh kv b fi lj lg l lh li">worker2: Installed:</span><span id="ef5b" class="le jf hh kv b fi lj lg l lh li">worker2: kubeadm.x86_64 0:1.9.1-2.0.2.el7</span><span id="fdce" class="le jf hh kv b fi lj lg l lh li">worker2:</span><span id="1cf8" class="le jf hh kv b fi lj lg l lh li">worker2: Dependency Installed:</span><span id="e9b9" class="le jf hh kv b fi lj lg l lh li">worker2: kubectl.x86_64 0:1.9.1-2.0.2.el7</span><span id="e019" class="le jf hh kv b fi lj lg l lh li">worker2: kubelet.x86_64 0:1.9.1-2.0.2.el7</span><span id="e736" class="le jf hh kv b fi lj lg l lh li">worker2: kubernetes-cni.x86_64 0:0.6.0-2.0.1.el7</span><span id="6686" class="le jf hh kv b fi lj lg l lh li">worker2: kubernetes-cni-plugins.x86_64 0:0.6.0-2.0.1.el7</span><span id="eac0" class="le jf hh kv b fi lj lg l lh li">worker2: socat.x86_64 0:1.7.3.2-2.el7</span><span id="e6ec" class="le jf hh kv b fi lj lg l lh li">worker2: Complete!</span><span id="d3da" class="le jf hh kv b fi lj lg l lh li">worker2: net.bridge.bridge-nf-call-ip6tables = 1</span><span id="be9d" class="le jf hh kv b fi lj lg l lh li">worker2: net.bridge.bridge-nf-call-iptables = 1</span><span id="76d3" class="le jf hh kv b fi lj lg l lh li">worker2: Your Kubernetes VM is ready to use!</span><span id="28b4" class="le jf hh kv b fi lj lg l lh li">==&gt; worker2: Configuring proxy <strong class="kv hi">for</strong> <!-- -->Docker...</span><span id="7f86" class="le jf hh kv b fi lj lg l lh li">$</span><span id="60a3" class="le jf hh kv b fi lj lg l lh li">$ vagrant ssh<!-- --> <!-- -->worker2</span><span id="caf9" class="le jf hh kv b fi lj lg l lh li">Welcome to Oracle Linux Server release 7.4 (GNU/Linux<!-- --> <!-- -->4.1.12-112.14.13.el7uek.x86_64)</span><span id="003f" class="le jf hh kv b fi lj lg l lh li">The Oracle Linux End-User License Agreement can be viewed here:</span><span id="8991" class="le jf hh kv b fi lj lg l lh li">* /usr/share/eula/eula.en_US</span><span id="eb00" class="le jf hh kv b fi lj lg l lh li">For additional packages, updates, documentation and community help, see:</span><span id="bdbe" class="le jf hh kv b fi lj lg l lh li">* http://yum.oracle.com/</span><span id="b76d" class="le jf hh kv b fi lj lg l lh li">[vagrant@worker2 ~]$ su<!-- --> <!-- -->-</span><span id="d113" class="le jf hh kv b fi lj lg l lh li">[root@worker2 ~]# /vagrant/scripts/kubeadm-setup-worker.sh</span><span id="b2dd" class="le jf hh kv b fi lj lg l lh li">/vagrant/scripts/kubeadm-setup-worker.sh: Login to container registry</span><span id="b696" class="le jf hh kv b fi lj lg l lh li">Username: gerald[dot]venzl[at]oracle[dot]com</span><span id="757c" class="le jf hh kv b fi lj lg l lh li">Password:</span><span id="3e9a" class="le jf hh kv b fi lj lg l lh li">Login Succeeded</span><span id="ab5c" class="le jf hh kv b fi lj lg l lh li">/vagrant/scripts/kubeadm-setup-worker.sh: Setup Worker node</span><span id="c9fb" class="le jf hh kv b fi lj lg l lh li">Starting to initialize worker node ...</span><span id="c939" class="le jf hh kv b fi lj lg l lh li">Checking <strong class="kv hi">if</strong> <!-- -->env<!-- --> <!-- -->is ready ...</span><span id="b732" class="le jf hh kv b fi lj lg l lh li">Checking whether docker can pull busybox image ...</span><span id="1767" class="le jf hh kv b fi lj lg l lh li">Checking access to container-registry.oracle.com/kubernetes<!-- --> <!-- -->...</span><span id="d4bd" class="le jf hh kv b fi lj lg l lh li">v1.9.1: Pulling from kubernetes/kube-proxy-amd64</span><span id="793f" class="le jf hh kv b fi lj lg l lh li">Digest: sha256:852fbdc6be8b357356c047bd9649e1c62f572c0e61a0526cd048c0d0dc675e4d</span><span id="d413" class="le jf hh kv b fi lj lg l lh li">Status: Image is up to date<!-- --> <strong class="kv hi">for</strong> <!-- -->container-registry.oracle.com/kubernetes/kube-proxy-amd64:v1.9.1</span><span id="821b" class="le jf hh kv b fi lj lg l lh li">Checking whether docker can run container ...</span><span id="9a7c" class="le jf hh kv b fi lj lg l lh li">Checking iptables default rule ...</span><span id="8710" class="le jf hh kv b fi lj lg l lh li">Checking br_netfilter module ...</span><span id="4a06" class="le jf hh kv b fi lj lg l lh li">Checking sysctl variables ...</span><span id="a587" class="le jf hh kv b fi lj lg l lh li">Enabling kubelet ...</span><span id="6026" class="le jf hh kv b fi lj lg l lh li">Created symlink<!-- --> <!-- -->from /etc/systemd/system/multi-user.target.wants/kubelet.service to /etc/systemd/system/kubelet.service.</span><span id="b2b4" class="le jf hh kv b fi lj lg l lh li">Check successful, ready to run 'join'<!-- --> <!-- -->command<!-- --> <!-- -->...</span><span id="e41a" class="le jf hh kv b fi lj lg l lh li">[preflight] Running pre-flight checks.</span><span id="589a" class="le jf hh kv b fi lj lg l lh li">[validation] WARNING: kubeadm doesn't fully support multiple API Servers yet</span><span id="484f" class="le jf hh kv b fi lj lg l lh li">[discovery] Trying to connect to API Server "192.168.99.100:6443"</span><span id="08f2" class="le jf hh kv b fi lj lg l lh li">[discovery] Created cluster-info discovery client, requesting info from "<a class="ae jc" href="https://192.168.99.100:6443/" rel="noopener ugc nofollow" target="_blank">https://192.168.99.100:6443</a>"</span><span id="d5ab" class="le jf hh kv b fi lj lg l lh li">[discovery] Trying to connect to API Server "192.168.99.100:6443"</span><span id="af76" class="le jf hh kv b fi lj lg l lh li">[discovery] Created cluster-info discovery client, requesting info from "<a class="ae jc" href="https://192.168.99.100:6443/" rel="noopener ugc nofollow" target="_blank">https://192.168.99.100:6443</a>"</span><span id="ad3a" class="le jf hh kv b fi lj lg l lh li">[discovery] Requesting info from "<a class="ae jc" href="https://192.168.99.100:6443/" rel="noopener ugc nofollow" target="_blank">https://192.168.99.100:6443</a>"<!-- --> <!-- -->again to validate TLS against the pinned public key</span><span id="27b9" class="le jf hh kv b fi lj lg l lh li">[discovery] Cluster info signature and contents are valid and TLS certificate validates against pinned roots, will use API Server "192.168.99.100:6443"</span><span id="1b64" class="le jf hh kv b fi lj lg l lh li">[discovery] Successfully established connection with API Server "192.168.99.100:6443"</span><span id="4da5" class="le jf hh kv b fi lj lg l lh li">[discovery] Requesting info from "<a class="ae jc" href="https://192.168.99.100:6443/" rel="noopener ugc nofollow" target="_blank">https://192.168.99.100:6443</a>"<!-- --> <!-- -->again to validate TLS against the pinned public key</span><span id="f7b2" class="le jf hh kv b fi lj lg l lh li">[discovery] Cluster info signature and contents are valid and TLS certificate validates against pinned roots, will use API Server "192.168.99.100:6443"</span><span id="855e" class="le jf hh kv b fi lj lg l lh li">[discovery] Successfully established connection with API Server "192.168.99.100:6443"</span><span id="2dd0" class="le jf hh kv b fi lj lg l lh li">This node has joined the cluster:</span><span id="bbcd" class="le jf hh kv b fi lj lg l lh li">* Certificate signing request was sent to master and a response</span><span id="4bbb" class="le jf hh kv b fi lj lg l lh li">was received.</span><span id="8ee8" class="le jf hh kv b fi lj lg l lh li">* The Kubelet was informed of the new secure connection details.</span><span id="b9e9" class="le jf hh kv b fi lj lg l lh li">Run 'kubectl get nodes'<!-- --> <!-- -->on the master to see this node join<!-- --> <!-- -->the cluster.</span><span id="6f27" class="le jf hh kv b fi lj lg l lh li">/vagrant/scripts/kubeadm-setup-worker.sh: Worker node ready</span><span id="c0d0" class="le jf hh kv b fi lj lg l lh li">[root@worker2 ~]# exit</span><span id="9e8c" class="le jf hh kv b fi lj lg l lh li">logout</span><span id="d59d" class="le jf hh kv b fi lj lg l lh li">[vagrant@worker2 ~]$ exit</span><span id="f181" class="le jf hh kv b fi lj lg l lh li">logout</span><span id="964d" class="le jf hh kv b fi lj lg l lh li">Connection to 127.0.0.1 closed.</span><span id="1ad6" class="le jf hh kv b fi lj lg l lh li">$</span></pre><h1 id="9ac1" class="je jf hh bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">验证Kubernetes集群</h1><p id="d527" class="pw-post-body-paragraph ie if hh ig b ih ke ij ik il kf in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">一旦<code class="du ks kt ku kv b">worker1</code>和<code class="du ks kt ku kv b">worker2</code>虚拟机启动并运行，您就可以开始工作了！您可以通过ssh连接到主节点并使用以下一个或多个命令来验证集群。<strong class="ig hi">注意:</strong>设置完成后，这些命令必须作为<code class="du ks kt ku kv b"><strong class="ig hi">vagrant</strong></code>用户执行，该用户是Kubernetes设备的所有者:</p><ul class=""><li id="667d" class="kc kd hh ig b ih ii il im ip mj it mk ix ml jb mm kk kl km bi translated">kubectl集群信息</li><li id="a379" class="kc kd hh ig b ih kn il ko ip kp it kq ix kr jb mm kk kl km bi translated">kubectl获取节点</li><li id="2de4" class="kc kd hh ig b ih kn il ko ip kp it kq ix kr jb mm kk kl km bi translated">kubectl get pods–namespace = kube-system</li></ul><pre class="kw kx ky kz fd la kv lb lc aw ld bi"><span id="abbc" class="le jf hh kv b fi lf lg l lh li">$ vagrant ssh<!-- --> <!-- -->master</span><span id="1dc2" class="le jf hh kv b fi lj lg l lh li">Last login: Fri Mar 23 21:53:41 2018 from 10.0.2.2</span><span id="a2a9" class="le jf hh kv b fi lj lg l lh li">Welcome to Oracle Linux Server release 7.4 (GNU/Linux<!-- --> <!-- -->4.1.12-112.14.13.el7uek.x86_64)</span><span id="4d3e" class="le jf hh kv b fi lj lg l lh li">The Oracle Linux End-User License Agreement can be viewed here:</span><span id="eebb" class="le jf hh kv b fi lj lg l lh li">* /usr/share/eula/eula.en_US</span><span id="8a85" class="le jf hh kv b fi lj lg l lh li">For additional packages, updates, documentation and community help, see:</span><span id="263a" class="le jf hh kv b fi lj lg l lh li">* http://yum.oracle.com/</span><span id="25dd" class="le jf hh kv b fi lj lg l lh li">[vagrant@master ~]$ kubectl cluster-info</span><span id="7403" class="le jf hh kv b fi lj lg l lh li">Kubernetes master is running at https://192.168.99.100:6443</span><span id="6715" class="le jf hh kv b fi lj lg l lh li">KubeDNS is running at https://192.168.99.100:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy</span><span id="0bb6" class="le jf hh kv b fi lj lg l lh li">To further debug and diagnose cluster problems, use 'kubectl cluster-info dump'.</span><span id="0711" class="le jf hh kv b fi lj lg l lh li">[vagrant@master ~]$ kubectl get nodes</span><span id="2b98" class="le jf hh kv b fi lj lg l lh li">NAME                STATUS  ROLES    AGE    VERSION</span><span id="259d" class="le jf hh kv b fi lj lg l lh li">master.vagrant.vm   Ready   master   24m    v1.9.1+2.0.2.el7</span><span id="f611" class="le jf hh kv b fi lj lg l lh li">worker1.vagrant.vm  Ready   &lt;none&gt;   13m    v1.9.1+2.0.2.el7</span><span id="b2bd" class="le jf hh kv b fi lj lg l lh li">worker2.vagrant.vm  Ready   &lt;none&gt;   5m     v1.9.1+2.0.2.el7</span><span id="ac08" class="le jf hh kv b fi lj lg l lh li">[vagrant@master ~]$ kubectl get pods --namespace=kube-system</span><span id="dcbd" class="le jf hh kv b fi lj lg l lh li">NAME                                      READY  STATUS   RESTARTS AGE</span><span id="97a4" class="le jf hh kv b fi lj lg l lh li">etcd-master.vagrant.vm                    1/1<!-- -->    <!-- -->Running  0        24m</span><span id="4f45" class="le jf hh kv b fi lj lg l lh li">kube-apiserver-master.vagrant.vm          1/1<!-- -->    <!-- -->Running  0        23m</span><span id="71b3" class="le jf hh kv b fi lj lg l lh li">kube-controller-manager-master.vagrant.vm 1/1<!-- -->    <!-- -->Running  0        24m</span><span id="5b96" class="le jf hh kv b fi lj lg l lh li">kube-dns-855949bbf-cwsgc                  3/3<!-- -->    <!-- -->Running  0        24m</span><span id="e603" class="le jf hh kv b fi lj lg l lh li">kube-flannel-ds-f56w9                     1/1<!-- -->    <!-- -->Running  0        5m</span><span id="b42f" class="le jf hh kv b fi lj lg l lh li">kube-flannel-ds-flpql                     1/1<!-- -->    <!-- -->Running  0        13m</span><span id="d2fa" class="le jf hh kv b fi lj lg l lh li">kube-flannel-ds-fxp9z                     1/1<!-- -->    <!-- -->Running  0        24m</span><span id="7748" class="le jf hh kv b fi lj lg l lh li">kube-proxy-5thk9                          1/1<!-- -->    <!-- -->Running  0        5m</span><span id="8497" class="le jf hh kv b fi lj lg l lh li">kube-proxy-jmswg                          1/1<!-- -->    <!-- -->Running  0        13m</span><span id="5296" class="le jf hh kv b fi lj lg l lh li">kube-proxy-lfg9v                          1/1<!-- -->    <!-- -->Running  0        24m</span><span id="0c3c" class="le jf hh kv b fi lj lg l lh li">kube-scheduler-master.vagrant.vm          1/1<!-- -->    <!-- -->Running  0        24m</span><span id="c748" class="le jf hh kv b fi lj lg l lh li">kubernetes-dashboard-7c966ddf6d-hp7br     1/1<!-- -->    <!-- -->Running  0        24m</span><span id="3542" class="le jf hh kv b fi lj lg l lh li">[vagrant@master ~]$ exit</span><span id="e1c7" class="le jf hh kv b fi lj lg l lh li">logout</span><span id="6915" class="le jf hh kv b fi lj lg l lh li">Connection to 127.0.0.1 closed.</span><span id="1bef" class="le jf hh kv b fi lj lg l lh li">$</span></pre><h1 id="c659" class="je jf hh bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">在VirtualBox上定制您的Kubernetes集群</h1><p id="9bc5" class="pw-post-body-paragraph ie if hh ig b ih ke ij ik il kf in io ip lw ir is it lx iv iw ix ly iz ja jb ha bi translated">流浪者文件允许一些定制，例如:</p><ul class=""><li id="9cd5" class="kc kd hh ig b ih ii il im ip mj it mk ix ml jb mm kk kl km bi translated"><code class="du ks kt ku kv b">NB_WORKERS</code>(默认:<code class="du ks kt ku kv b">2</code>):要置备的工作节点数。</li><li id="aba0" class="kc kd hh ig b ih kn il ko ip kp it kq ix kr jb mm kk kl km bi translated"><code class="du ks kt ku kv b">USE_PREVIEW</code>(默认:<code class="du ks kt ku kv b">true</code>):当<code class="du ks kt ku kv b">true</code>时，流浪汉供应脚本将对Docker引擎和Kubernetes使用<em class="jd"> Oracle Linux 7预览版</em>和<em class="jd">附加模块</em>通道(最新版本由<code class="du ks kt ku kv b">yum</code>选择)。<br/>否则它将只使用<em class="jd">附加模块</em>通道。</li><li id="5ea3" class="kc kd hh ig b ih kn il ko ip kp it kq ix kr jb mm kk kl km bi translated"><code class="du ks kt ku kv b">MANAGE_FROM_HOST</code>(默认:<code class="du ks kt ku kv b">false</code>):当<code class="du ks kt ku kv b">true</code>时，流浪者将从主节点绑定端口<code class="du ks kt ku kv b">6443</code>到主机。这允许您使用生成的<code class="du ks kt ku kv b">admin.conf</code>文件从主机本身管理集群(假设主机上安装了<code class="du ks kt ku kv b">kubectl</code>)。</li><li id="3cda" class="kc kd hh ig b ih kn il ko ip kp it kq ix kr jb mm kk kl km bi translated"><code class="du ks kt ku kv b">BIND_PROXY</code>(默认:<code class="du ks kt ku kv b">true</code>):当<code class="du ks kt ku kv b">true</code>时，vagger会将Kubernetes代理端口从主节点绑定到主机。有助于从集群外的<em class="jd">访问仪表板或任何其他应用程序。这是ssh隧道的一个更简单的替代方案。</em></li><li id="69d0" class="kc kd hh ig b ih kn il ko ip kp it kq ix kr jb mm kk kl km bi translated"><code class="du ks kt ku kv b">MEMORY</code>(默认值:2048):所有虚拟机都配有2GB内存。如果内存是一个问题，这可以稍微减少。</li></ul><p id="e4d3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你可以在你的流浪者档案中找到它们，并根据你的需要修改它们。</p><p id="d3a1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">另请查看与Kubernetes用户指南一起使用的<a class="ae jc" href="https://docs.oracle.com/cd/E52668_01/E88884/html/kubectl-basics.html" rel="noopener ugc nofollow" target="_blank"> Oracle容器服务，了解更多信息。</a></p></div><div class="ab cl lk ll go lm" role="separator"><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp lq"/><span class="ln bw bk lo lp"/></div><div class="ha hb hc hd he"><p id="0e6e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jd">原载于2018年3月26日</em><a class="ae jc" href="https://geraldonit.com/2018/03/26/deploying-a-kubernetes-cluster-with-vagrant-on-virtual-box/" rel="noopener ugc nofollow" target="_blank"><em class="jd">geraldonit.com</em></a><em class="jd">。</em></p></div></div>    
</body>
</html>