<html>
<head>
<title>SonarQube : Reinventing code quality</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SonarQube:重塑代码质量</h1>
<blockquote>原文：<a href="https://medium.com/globant/sonarqube-reinventing-code-quality-81894ddc1d52?source=collection_archive---------0-----------------------#2022-06-16">https://medium.com/globant/sonarqube-reinventing-code-quality-81894ddc1d52?source=collection_archive---------0-----------------------#2022-06-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="91e8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我最近遇到了一个问题，不得不花大量时间试图解决它。就在那时，我决定与大家分享。</p><p id="8525" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我当时正在开发一个门户应用程序，它最初启动时运行得非常完美。过了一会儿，我们注意到应用程序出现了一些性能问题和速度变慢。我查看了代码和模块，以及构建和文件，但毫无用处。我似乎找不到任何东西。然后我学习并理解了如何使用一个叫做SonarQube的程序来帮助优化你的应用程序。</p><p id="1c3b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在我把它放入我的应用程序后，它向我展示了我正在手动寻找的确切疼痛位置。</p><p id="e4a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，应用程序的代码质量和速度显著提高。让我们看看它是如何帮助我的。</p><p id="fe48" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">先来了解一下SonarQube是什么？</strong></p><p id="d991" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">SonarQube是SonarSource创建的一个开源平台，用于持续的代码质量检查。它使用静态分析来发现用20多种编程语言编写的代码中的缺陷、代码味道和安全漏洞。</p><p id="efcd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本地运行声纳可能是有益的。这份文件将告诉你如何做。</p><p id="3d59" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Sonar由两个主要组件组成:SonarQube，一个显示扫描结果的服务器(以及其他东西)，和sonar-scanner，它执行实际的扫描。</p><p id="e431" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">Mac上的配置问题……</strong></p><p id="2517" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我在Mac上设置SonarQube时遇到了很多问题。然后，我发现在Mac上配置SonarQube时，有一些事情需要记住。</p><h1 id="d46a" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">先决条件</h1><p id="413b" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">安装了Java版本8或更高版本。<a class="ae kf" href="https://java.com/en/download/apple.jsp" rel="noopener ugc nofollow" target="_blank">https://java.com/en/download/apple.jsp</a></p><h1 id="f5b6" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">第一步。下载并安装SonarQube</h1><p id="79ce" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">下载SonarQube:<a class="ae kf" href="https://www.sonarqube.org/downloads/" rel="noopener ugc nofollow" target="_blank">https://www.sonarqube.org/downloads/</a></p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/7370a76a1de225bc07ef9612f34dad37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GcZQjSpq-GRi3i3b"/></div></div></figure><p id="e012" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">注:请下载LTS版本</strong></p><ul class=""><li id="c742" class="ks kt hh ig b ih ii il im ip ku it kv ix kw jb kx ky kz la bi translated">解压你刚刚下载的文件。</li><li id="fe3c" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">将下载的文件放在方便的位置。(我喜欢放在项目文件夹里。)</li><li id="2736" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">删除版本后缀，并将其重命名为SonarQube。</li></ul><h1 id="ca7d" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">第二步。使用您的项目配置SonarQube</h1><p id="19fd" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">现在是时候将Sonar与Angular项目整合在一起了，这需要Angular app中的<strong class="ig hi"><em class="lg">Sonar-scanner</em></strong><em class="lg"/>节点包。请使用下面概述的方法来包括这一点。</p><p id="561d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将sonar-scanner作为<strong class="ig hi"><em class="lg">dev dependency</em></strong>包含在package.json中，然后运行下面的脚本。</p><p id="3ef3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lh li lj lk b">npm install sonar-scanner — save-dev</code></p><h1 id="4ce3" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">第三步。在项目中配置SonarQube属性文件</h1><p id="8322" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">创建一个名为sonar-project的文件。属性，然后将下列属性添加到同一文件中。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/d58987d8980a925441089ffc9c047a2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*p3zM-drMRUta3a2-"/></div></div></figure><p id="ee01" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lh li lj lk b">sonar.host.url = <a class="ae kf" href="http://localhost:9000" rel="noopener ugc nofollow" target="_blank">http://localhost:9000</a></code></p><p id="714d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lh li lj lk b">sonar.login=admin</code></p><p id="1791" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lh li lj lk b">sonar.password=admin</code></p><p id="a865" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lh li lj lk b">sonar.projectKey=demo-app</code></p><p id="2c86" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lh li lj lk b">sonar.projectName=demo-app</code></p><p id="7a80" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lh li lj lk b">sonar.projectVersion=1.0</code></p><p id="57b7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lh li lj lk b">sonar.sourceEncoding=UTF-8</code></p><p id="f4d8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lh li lj lk b">sonar.sources=src</code></p><p id="671f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lh li lj lk b">sonar.exclusions=**/node_modules/**</code></p><p id="70bd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lh li lj lk b">sonar.tests=src</code></p><p id="7db7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lh li lj lk b">sonar.test.inclusions=**/*.spec.ts</code></p><p id="3f1a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lh li lj lk b">sonar.typescript.lcov.reportPaths=coverage/lcov.info</code></p><h1 id="6035" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">为什么是SonarQube？</h1><p id="4ef7" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">开发人员在紧张的时间表下工作，为客户提供所需的功能。这对开发人员来说非常重要，以至于他们经常忽略代码质量、潜在的错误、代码重复和不良的复杂性分布。</p><p id="5267" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">他们也习惯于留下不需要的变量、方法等等。在这种情况下，代码将按预期执行。</p><p id="52ad" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你认为这是交付功能的合适方法吗？</p><p id="c023" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">没有。</p><p id="8a64" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">开发人员应该始终遵循良好的编码实践来避免代码中的这些错误。然而，由于各种原因，并不总是能够遵循标准并保持可接受的质量。</p><p id="a043" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了完成持续的代码集成和部署，开发人员需要一种工具，它不仅能检查并通知他们代码缺陷，还能跟踪和控制代码以确保持续的代码质量。SonarQube可以满足所有这些要求。</p><h1 id="3082" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">SonarQube和编码问题…</h1><p id="6fff" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">当SonarQube运行分析时，如果一段代码违反了编码准则，就会出现问题。项目中每种语言的相关质量概要定义了编码规则集。</p><p id="687d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">有三类问题</strong>:</p><ol class=""><li id="13b0" class="ks kt hh ig b ih ii il im ip ku it kv ix kw jb ll ky kz la bi translated"><strong class="ig hi"> Bug </strong> —运行时可能导致错误或意外行为的编程错误。</li><li id="f10f" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb ll ky kz la bi translated"><strong class="ig hi">漏洞</strong> —代码中可以被利用的开放位置。</li><li id="e394" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb ll ky kz la bi translated"><strong class="ig hi">代码味道</strong> —一个可维护性的问题，使你的代码难以理解和维护。</li></ol><blockquote class="lm ln lo"><p id="08bf" class="ie if lg ig b ih ii ij ik il im in io lp iq ir is lq iu iv iw lr iy iz ja jb ha bi translated"><strong class="ig hi">每期都有</strong> <a class="ae kf" href="https://docs.sonarqube.org/latest/user-guide/issues/" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi">五种严重程度</strong> </a>之一</p></blockquote><p id="f13c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们假设当声纳扫描仪分析在后台运行时，我们运行了项目测试。</p><p id="5d72" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">导航到SonarQube概览仪表板以查看分析结果。</p><p id="041b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">概览仪表板上显示以下数据:</p><ul class=""><li id="564f" class="ks kt hh ig b ih ii il im ip ku it kv ix kw jb kx ky kz la bi translated">漏洞和缺陷</li><li id="48a2" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">你花在修复这些问题上的时间和代码的味道。</li><li id="8602" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">运行测试时你所覆盖的代码的平均值。</li><li id="d63a" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">您的代码有一定比例的重复和许多重复的块。</li><li id="ddf0" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">我们的示例代码有一种代码味道，如下图所示，这将花费我们两分钟来解决。</li></ul><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/d2c6d1e3b014490ed9b3efa221b0be8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jeeeosD1PMl5TrkD"/></div></div></figure><p id="b191" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要更深入地研究这种代码味道，请转到“问题”一节。您将在下一个屏幕上看到哪个文件受到了影响。要查看提供的解决方案，请单击警告消息。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/707e685dd5933406e8ffad39c87c7b69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CXQiG6cEFTA_-Uqk"/></div></div></figure><p id="f000" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">尝试下面的测试，看看代码中是否有新的错误，以及如何修复它们。</p><ol class=""><li id="fe28" class="ks kt hh ig b ih ii il im ip ku it kv ix kw jb ll ky kz la bi translated">打开<strong class="ig hi"> Questions.vue </strong>文件，将以下新错误添加到代码中:</li></ol><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ls"><img src="../Images/a389b65f25ac4326c922a99250cf7e05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Gy4YeNjzaNvW7Dof"/></div></div></figure><p id="c3e5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.再次运行声纳扫描命令。正如预期的那样，新的代码味道出现了，解决这些问题所需的时间增加了。</p></div><div class="ab cl lt lu go lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ha hb hc hd he"><p id="e8a5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在屏幕右侧，会出现一个新区域(以黄色突出显示)。SonarQube处理当前状态(白色)和最近的更改。如屏幕截图所示，上一次扫描中所做的更改导致添加了四种新的代码气味。SonarQube根据各种因素为每个部分分配一个分数，其中“A”为最佳状态。它还指示新代码的质量是否低于以前的版本，以及增加了五行代码:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/9841bfd10ddce078ebd119bcd4b61b72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*j45XklLA95k3GI0E"/></div></div></figure><blockquote class="lm ln lo"><p id="306b" class="ie if lg ig b ih ii ij ik il im in io lp iq ir is lq iu iv iw lr iy iz ja jb ha bi translated">要查看新错误的详细信息，请转到“问题”部分:</p></blockquote><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/9edbf39efa06995dc240759d9a342658.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bJMJx6ke9ZMMELAz"/></div></div></figure><p id="3e29" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">更正代码中的所有错误。运行新的分析来仔细检查项目。恭喜你！您的代码已经通过测试，并且没有新的代码气味:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/7f1dcd4bda73ef05157017d3124afe7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NMqGT4ySepYZWw8n"/></div></div></figure><p id="0081" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">#有不同的选择，我们为什么选择SonarQube？</strong></p><p id="dea7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">说到自动化编码审查平台，我们知道您有很多选择。虽然它不完美，但也不可怕。</p><h1 id="e0f9" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">SonarQube的好处？</h1><ol class=""><li id="e371" class="ks kt hh ig b ih ka il kb ip ma it mb ix mc jb ll ky kz la bi translated"><strong class="ig hi">可持续性</strong> —降低应用程序复杂性、潜在漏洞和代码重复，延长应用程序寿命。</li><li id="bc06" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb ll ky kz la bi translated"><strong class="ig hi">提高生产力</strong> —降低应用程序的规模、维护成本和风险；因此，它消除了花费额外时间更新代码的需要。</li><li id="6a73" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb ll ky kz la bi translated">质量代码 —代码质量保证是软件开发过程中不可或缺的一部分。</li><li id="89aa" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb ll ky kz la bi translated"><strong class="ig hi">检测错误</strong> —检测代码中的错误，并通知开发人员在提交它们进行输出之前修复它们。</li><li id="a86e" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb ll ky kz la bi translated"><strong class="ig hi">提高一致性</strong>-确定何时违反了规范标准，并提高产品质量。</li><li id="7559" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb ll ky kz la bi translated"><strong class="ig hi">业务规模</strong> —可以审查的项目数量没有限制。</li><li id="b505" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb ll ky kz la bi translated"><strong class="ig hi">提高开发人员技能</strong> —开发人员可以通过定期收到质量问题的反馈来提高他们的编码技能。</li></ol></div><div class="ab cl lt lu go lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="ha hb hc hd he"><h1 id="5d27" class="jc jd hh bd je jf md jh ji jj me jl jm jn mf jp jq jr mg jt ju jv mh jx jy jz bi translated">结论</h1><p id="5e62" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">SonarQube的使命是增强开发者的能力，并培育一个关注代码质量和安全性的开放社区。希望你看完这篇文章后对SonarQube的功能有个基本的了解。</p><p id="31f8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="lg">如果你同意，请留下评论以示支持。</em></p></div></div>    
</body>
</html>