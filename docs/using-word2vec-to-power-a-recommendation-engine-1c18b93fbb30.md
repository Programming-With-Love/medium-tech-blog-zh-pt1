# 使用 Word2Vec 驱动推荐引擎

> 原文：<https://medium.com/square-corner-blog/using-word2vec-to-power-a-recommendation-engine-1c18b93fbb30?source=collection_archive---------0----------------------->

## 妮可·米切尔&乔伊·王

> 注意，我们已经行动了！如果您想继续了解 Square 的最新技术内容，请访问我们的新家[https://developer.squareup.com/blog](https://developer.squareup.com/blog)

**关于我们**

妮可是莱斯大学的大三学生，乔伊是宾夕法尼亚大学的大四学生，今年夏天我们都是 Square 的软件工程实习生。Square 每年夏天都会举办一次实习生黑客周，让实习生有机会实现我们对新功能或工具的想法。以下是对我们实习生黑客周项目的描述。

**语境**

在 Square，我们一直在寻找利用我们的大型数据集来自动化面向客户的体验的方法。随着实习黑客周的临近，我们希望挑选一个项目，它可以帮助激发每个人思考更多领域，在这些领域中，我们可以自动化 Square 卖家在设置帐户时通常必须做的工作。

这个 hack week 项目的目的是产生想法，而不是作为产品特性来实现。

我们决定解决卖家的长期问题，即决定提供什么产品，并计算出好的价格来推动销售。市场调研可能非常耗时、昂贵，而且需要大量资源。企业主可能会花几天时间试图了解他们的社区趋势和商业环境，或者他们如何才能改善他们的产品和价格，以实现收入最大化。

在与产品经理、分析师和销售团队讨论了这个问题后，我们决定开发一个工具，为销售人员提供对行业和社区特定趋势的可行见解。这启发我们开发了一个工具，它可以根据来自附近本地商家的信息，自动向卖家推荐商品价格和附加菜单项。

我们有一周的时间来做这个项目，所以我们决定把它扩展到食品和饮料行业。Square 近 20%的 GPV(总支付量)仅来自食品和饮料行业。这些大量的交易数据提供了一个社区和行业市场的鸟瞰图。

**演示:市场洞察工具**

出于演示的目的，我们用 D3 可视化构建了一个 Python Flask 应用程序，它包括了现有 Square 卖家和新卖家的功能。

![](img/7dc96444989bc078249ae032f94e1885.png)

Home Page

*现有广场卖家个性化市场报告*

我们创建了一个工具，当前的卖家可以输入他们的用户 ID，并查看定制的报告。在第一部分，卖家可以从他们自己的产品中选择一种产品，并查看附近其他卖家出售的所有类似商品的价格分布。我们还包括了第二部分，根据附近类似的 Square 卖家菜单上的内容，列出了卖家目前没有提供但应该考虑出售的三种商品。(参见文章的下一部分，了解我们是如何提出这些建议的！)

![](img/dc4b5cceaf109a555a2c1f809bb4726e.png)

Interface for Existing Sellers

*帮助新卖家的价格建议*

对于新的 Square 卖家，我们使用本地商品定价数据来构建一个工具，帮助他们为自己的菜单项定价。给定新卖家的邮政编码，他或她可以在搜索栏中输入一个商品，并获得该商品在他们附近的价格分布，以及基于本地卖家交易的平均建议价格点。

![](img/0e0c62b1899fa5a6570276651fe99d51.png)

Pricing Tool for New Sellers

**背后的数据科学**

众所周知，文本数据很难处理！自由格式文本数据的挑战在于，销售者为他们销售的产品输入他们自己的项目名称，这为命名约定的变化留下了很大的空间。如果没有控制文本输入的规则，分析项目级数据是相当棘手的。例如，一个咖啡店老板可以制作一杯“拿铁”或“拿铁咖啡”或“弗拉普拿铁”或“南瓜香料拿铁”，这样的例子不胜枚举。如果没有一个规范的项目名称列表，数据会非常混乱，很难分组。

为了解决商品名称缺乏结构的问题，我们使用食品数据库过滤交易数据中的商品，只得到食品和饮料商品。

![](img/ffe3fa94e1e3fe5362ca0475f49cf5ef.png)

Data Cleaning Process

我们的下一步是对这些食品和饮料进行分组，这样我们就可以比较附近商店出售的类似商品的价格，并为 Square 卖家提供新的商品。我们在分析这些文本数据时遇到的困难是解释潜在的潜台词。因为比较像“soda”和“pop”这样的词并纯粹通过查看文本来理解它们的相似性是具有挑战性的，所以我们使用预先训练的 [word2vec 模型](https://www.tensorflow.org/tutorials/word2vec)来执行词法分析。这个 gensim word2vec 模型是在 Google News 上训练出来的，将单词表示为向量。

通过对我们的食品和饮料数据运行该模型生成的矢量化单词，我们能够进行文本分类，因为我们可以对项目进行数字比较。单词之间的关系越密切，它们对应的向量之间的距离就越短。因为一个商品名称可以由多个单词组成，所以我们对每个单词的向量求和，并对其进行归一化，以获得该商品的向量。因此，在我们的食物项目数据集上运行该模型的结果是向量空间中相似项目的分组。

![](img/131f7cd4a2e5d6277d1ad14aa90a52fd.png)

[*Vectorized Mapping of Items*](https://erikbern.com/2015/09/24/nearest-neighbor-methods-vector-models-part-1.html)

为了确定这些分组，我们计算了每对矢量化项目之间的余弦距离。利用这个 *n* x *n* 矩阵，我们选择一个阈值来分类最近的邻居，然后调整它，直到它给我们合理的结果。为了更直观地描述这一点，实际上我们在向量空间中的每个项目周围画了一个球体，并认为向量在该球体中的所有项目都非常相似。下面是我们模型输出的一个例子。正如你所看到的，类似的项目并不完美，但相当合理。如果我们分析与*汉堡、*相关的单词，我们会捕捉到鸡肉三明治和沙拉三明治，它们显然不一样，但仍然相关。

*模型输出示例*

## ***拿铁***

*焦焦糖拿铁、拿铁咖啡、拿铁咖啡外带、卡布奇诺、焦糖拿铁、奶茶拿铁、伯爵茶拿铁、Frapp 拿铁、Horchata 拿铁、冰拿铁/抹茶绿茶、冰拿铁/抹茶/奶茶、抹茶拿铁、烤乌龙拿铁、大豆拿铁、香草拿铁、香草拿铁、卡布奇诺*

## ***汉堡***

*汉堡、羊肉汉堡晚餐、羊肉汉堡卷午餐、卡普雷塞三明治、鸡肉三明治、鸡肉沙拉三明治、沙拉三明治、沙拉三明治晚餐、午餐鸡肉沙拉三明治、午餐沙拉三明治、肉丸三明治*

对于给定卖家的每个菜单项，我们能够使用其附近空间中其他项目的价格来生成价格分布。我们通过[核密度估计](https://en.wikipedia.org/wiki/Kernel_density_estimation)来估计分布的潜在概率密度，并绘制它来表示附近卖家之间的项目价格分布。查看给定卖家的每个商品“范围”内的类似商品，我们能够通过返回卖家菜单上没有的前三个最常出现的类似商品来生成商品建议。

![](img/8f4e31c0383cea734579dd94679a4777.png)

Our Process for Generating Results

**接下来的步骤**

这个项目帮助我们的产品团队思考如何让食品和饮料销售人员的入职自动化。当新卖家在我们的销售点系统中设置他们的菜单项时，预先填充价格将简化我们卖家的大部分工作，并使定价更容易。此外，这项工作可以应用于销售者仪表板报告页面，增加由 Square 的数据支持的现有分析见解。