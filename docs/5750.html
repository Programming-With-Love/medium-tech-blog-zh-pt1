<html>
<head>
<title>How to migrate or clone AWS EC2 VM to Oracle OCI Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将AWS EC2虚拟机迁移或克隆到Oracle OCI云</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/how-to-migrate-or-clone-aws-ec2-vm-into-oracle-oci-cloud-26a13d767eec?source=collection_archive---------0-----------------------#2021-02-10">https://medium.com/oracledevs/how-to-migrate-or-clone-aws-ec2-vm-into-oracle-oci-cloud-26a13d767eec?source=collection_archive---------0-----------------------#2021-02-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="86fc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">企业与多云战略保持一致，以避免停机，并利用工作负载在最佳云环境中运行。Oracle云基础架构在最安全的模式下以更低的成本运行Oracle工作负载，同时实现最高的性能。对于非Oracle客户来说，Oracle云基础架构提供的企业级云版本价格低廉，可带来直接的成本节约和更高的投资回报。在我之前的客户项目中，他们有许多运行Oracle数据库的AWS EC2虚拟机，并且不恰当地燃烧许可证，性能较低。</p><p id="ca42" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">由于成本等一个或多个原因，或者出于灵活性、备选云中的灾难恢复或其他战略原因(<a class="ae jc" href="https://www.uscloud.com/blog/3-reasons-33-companies-ditching-aws-azure/" rel="noopener ugc nofollow" target="_blank">更多阅读请点击</a>，我们将探讨以下选项将AWS EC2虚拟机迁移或克隆到OCI。</p><h2 id="b911" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">云间迁移期间需要考虑的重要事项</h2><p id="07b7" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">下面是为技术流程进行迁移时要考虑的一些关键因素。明智的做法是查看官方文档，了解基于每一点可能遇到的任何限制因素。</p><ol class=""><li id="bb31" class="kd ke hh ig b ih ii il im ip kf it kg ix kh jb ki kj kk kl bi translated">什么是源服务器操作系统及其在目标云上的可支持性？</li><li id="f0c9" class="kd ke hh ig b ih km il kn ip ko it kp ix kq jb ki kj kk kl bi translated">半虚拟化驱动程序的内核及其可支持性是什么？</li><li id="04ce" class="kd ke hh ig b ih km il kn ip ko it kp ix kq jb ki kj kk kl bi translated">磁盘卷的大小以及对目标云大小的支持</li><li id="cc82" class="kd ke hh ig b ih km il kn ip ko it kp ix kq jb ki kj kk kl bi translated">迁移方法和可用工具</li><li id="c401" class="kd ke hh ig b ih km il kn ip ko it kp ix kq jb ki kj kk kl bi translated">网络要求和带宽</li><li id="5225" class="kd ke hh ig b ih km il kn ip ko it kp ix kq jb ki kj kk kl bi translated">特定应用要求</li></ol><h1 id="2ad6" class="kr je hh bd jf ks kt ku jj kv kw kx jn ky kz la jq lb lc ld jt le lf lg jw lh bi translated">移民OCI有哪些选择？</h1><p id="6e68" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">目前有两种方法来完成这项任务:(1)使用手动方法，这种方法可以非常方便地进行故障排除和更多的技术审查，或者(2)使用Rackware、ZConverter等商业迁移工具。将在此对这两个选项进行回顾。</p><figure class="lj lk ll lm fd ln er es paragraph-image"><div class="er es li"><img src="../Images/7826448017597ca951641bbe57667c47.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*hZqj0JdFDLE9oW64zYk9Wg.png"/></div></figure><p id="1825" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">大多数云对可以导出的磁盘数量有限制。在AWS中，如果虚拟机连接了磁盘，我们将无法导出虚拟机。</p><p id="c22c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">云供应商为导入和导出服务器提供了特定的格式。Oracle云支持以VMDK或QCOW2格式提供服务器映像。但是，有一些简单的工具可以将这些格式从一种格式转换成另一种格式，而不会破坏可支持性。</p><figure class="lj lk ll lm fd ln er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es lq"><img src="../Images/fb13d5335031a46cf148b9b539e4af3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tN0Bnam673FLLJz4VEAWrA.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">Various cloud infrastructure providers and their supported formats based on respective documents</figcaption></figure><p id="5745" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在我的练习中，我将以VMDK的身份从AWS导出，并以VMDK的身份将其导入OCI。虚拟机映像的磁盘格式是基础原始磁盘映像的优化打包格式。虚拟设备供应商有不同的格式来展示虚拟机磁盘映像中包含的信息。</p><p id="03e8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">VM容器格式:VM容器格式指的是虚拟机映像是否是包含关于实际虚拟机的元数据的文件格式。因此，这里的容器格式是OVA，而磁盘映像实际上位于VMDK。</p><h2 id="7709" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">从AWS EC2迁移到OCI时，需要考虑哪些其他技术因素？</h2><ul class=""><li id="86b8" class="kd ke hh ig b ih jy il jz ip lz it ma ix mb jb mc kj kk kl bi translated">最大图像大小(压缩格式)为400 GB。</li><li id="0573" class="kd ke hh ig b ih km il kn ip ko it kp ix kq jb mc kj kk kl bi translated">必须为BIOS引导设置映像。</li><li id="ac4e" class="kd ke hh ig b ih km il kn ip ko it kp ix kq jb mc kj kk kl bi translated">仅支持一个磁盘。</li><li id="a27e" class="kd ke hh ig b ih km il kn ip ko it kp ix kq jb mc kj kk kl bi translated">无法加密磁盘映像。</li><li id="0779" class="kd ke hh ig b ih km il kn ip ko it kp ix kq jb mc kj kk kl bi translated">网络接口必须使用DHCP来发现网络。</li></ul><p id="879d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">阅读其他细节，确保你涵盖了所有因素——Linux——<a class="ae jc" href="https://docs.oracle.com/en-us/iaas/Content/Compute/Tasks/importingcustomimagewindows.htm#requirements" rel="noopener ugc nofollow" target="_blank">Windows</a>。</p><h1 id="a551" class="kr je hh bd jf ks kt ku jj kv kw kx jn ky kz la jq lb lc ld jt le lf lg jw lh bi translated">迁移方法</h1><figure class="lj lk ll lm fd ln er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es md"><img src="../Images/ce4ab5795ce4b1e0991d5029af1addba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mf48il24ikZEkBJMmCOiHA.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">Oracle OCI Marketplace Migration tools</figcaption></figure><p id="7756" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最直接的方法是利用在<a class="ae jc" href="https://cloudmarketplace.oracle.com" rel="noopener ugc nofollow" target="_blank"> OCI市场</a>可以买到的工具。请记住取消“简易安装”的默认复选框下面我将重点介绍使用Rackware应用程序从AWS迁移到OCI的步骤。或者，可以通过手动方法完成迁移，对于大型工作负载，可以使用terraform和其他工具简化可重复的过程。</p><h1 id="df75" class="kr je hh bd jf ks kt ku jj kv kw kx jn ky kz la jq lb lc ld jt le lf lg jw lh bi translated">机架件/工具迁移方法</h1><p id="6ebc" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">订阅市场上的任何“迁移”SaaS工具。在我的练习中，我使用Rackware (RMM)工具将AWS EC2 VM迁移到OCI。</p><p id="3a93" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用他们的<a class="ae jc" href="https://cloudmarketplace.oracle.com/marketplace/en_US/listing/67762747" rel="noopener ugc nofollow" target="_blank"> OCI市场</a>信息在OCI租赁上安装RMM。</p><figure class="lj lk ll lm fd ln er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es me"><img src="../Images/2838ec02850383e79013b16ba1c425f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g1vLF5NR03tUqqbclcGB8g.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">High-level architecture of the deployment</figcaption></figure><p id="dceb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">按照RMM市场底部的指南成功安装它。这个RMM在SSH上工作，所以对于Windows虚拟机，您需要安装RackWare SSHD安装程序。</p><figure class="lj lk ll lm fd ln er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es mf"><img src="../Images/3af5ef6a0533d38c3acce6d658076fd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x_UP8Ky41XXzcwdqHWixiQ.png"/></div></div></figure><p id="991e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">安装后，创建一个wave并添加源和目标虚拟机IP。确保在RMM虚拟机与AWS EC2虚拟机和OCI虚拟机之间设置了SSH等同权限。</p><p id="59c2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">或者上传RMM提供的带有标准CSV模板的主机列表。</p><figure class="lj lk ll lm fd ln er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es mg"><img src="../Images/a1b2640a19064f9e73a97b37a4c18ecc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZKs0XgO04VJW0D-WGgdNhg.png"/></div></div></figure><figure class="lj lk ll lm fd ln er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es mh"><img src="../Images/90f78f702c87eb526a1874923de0dfbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2BumTWZcvxc_6-uLUeDWlw.png"/></div></div></figure><p id="b624" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">开始同步过程。</p><p id="a581" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">同步完成后，验证虚拟机中的数据。</p></div><div class="ab cl mi mj go mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ha hb hc hd he"><h1 id="48de" class="kr je hh bd jf ks mp ku jj kv mq kx jn ky mr la jq lb ms ld jt le mt lg jw lh bi translated">手操纵进场着陆</h1><p id="0b0d" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">或者，我们可以采用手动方式从AWS导出图像，并将其导入OCI。</p><figure class="lj lk ll lm fd ln er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es mu"><img src="../Images/6bcce124ec34685dec36af29df8ad72e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kiq2s48B50wmWNO-L-kt4A.png"/></div></div></figure><h2 id="0d18" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">在AWS准备虚拟机</h2><ol class=""><li id="dda9" class="kd ke hh ig b ih jy il jz ip lz it ma ix mb jb ki kj kk kl bi translated">使用<a class="ae jc" href="https://docs.oracle.com/en-us/iaas/Content/Compute/Tasks/enablingserialconsoleaccess.htm" rel="noopener ugc nofollow" target="_blank">这些步骤</a>启用虚拟机的串行控制台。这对于解决虚拟机启动问题非常有用，就像我们今天在数据中心所做的那样。</li><li id="b466" class="kd ke hh ig b ih km il kn ip ko it kp ix kq jb ki kj kk kl bi translated">关闭虚拟机(AWS控制台或AWS CLI)</li><li id="1f57" class="kd ke hh ig b ih km il kn ip ko it kp ix kq jb ki kj kk kl bi translated">请注意将迁移到OCI的instanceID。</li><li id="191c" class="kd ke hh ig b ih km il kn ip ko it kp ix kq jb ki kj kk kl bi translated">验证可以存储图像的S3存储桶详细信息</li><li id="3654" class="kd ke hh ig b ih km il kn ip ko it kp ix kq jb ki kj kk kl bi translated">此S3存储桶必须设置其ACL，以允许AWS的“虚拟机导入导出”拥有列表、上传/删除和管理权限。</li><li id="6a0b" class="kd ke hh ig b ih km il kn ip ko it kp ix kq jb ki kj kk kl bi translated">如果附加了卷，请将第一个卷(/dev/sda)中的数据复制到单独的文件夹中。</li><li id="2106" class="kd ke hh ig b ih km il kn ip ko it kp ix kq jb ki kj kk kl bi translated">分离连接到虚拟机的所有卷。</li></ol><p id="9e3f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在我的环境中，我创建了一个新的VPC和组件来执行这个过程。为了我的重复测试，我使用terraform制作所有组件。(假设您已经拥有AWS EC2 VM，您可以跳过这一步)</p></div><div class="ab cl mi mj go mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ha hb hc hd he"><figure class="lj lk ll lm fd ln"><div class="bz dy l di"><div class="mv mw l"/></div></figure><h2 id="d91e" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">导出图像</h2><p id="d8fd" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">AWS CLI创建要导出的图像。请注意，有一个唯一的帐户(vm-import-export)需要被允许对存储桶进行读/写以导出映像。</p><figure class="lj lk ll lm fd ln"><div class="bz dy l di"><div class="mv mw l"/></div></figure><h2 id="50bf" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">将映像从AWS传输到Oracle OCI</h2><figure class="lj lk ll lm fd ln er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es mx"><img src="../Images/661f9a3ae3a68a0a4078385260c63c2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hFQz753fvGd38zOG6Gx0pg.png"/></div></div></figure><p id="d03b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">任务完成后。ova文件将放在AWS S3存储桶上。复制。从AWS S3存储桶到Oracle云基础架构对象存储桶的ova文件。我使用rclone(<a class="ae jc" href="https://rclone.org/" rel="noopener ugc nofollow" target="_blank">https://rclone.org/</a>)将数据从AWS S3对象存储复制到OCI对象存储。</p><figure class="lj lk ll lm fd ln er es paragraph-image"><div role="button" tabindex="0" class="lr ls di lt bf lu"><div class="er es my"><img src="../Images/607d67786100c172d3db6986be4c2f36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NCY_MjkVVJ8fQBdBOzYC3w.png"/></div></div></figure><p id="e85c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用rclone，图像文件被复制到OCI存储桶中。</p><h2 id="8724" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">在Oracle OCI中创建虚拟机</h2><p id="9a7b" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">现在，我们准备使用<code class="du mz na nb nc b">.ova</code>文件来创建我们的虚拟机。使用terraform在Oracle云基础架构上创建虚拟机，这将从。OCI对象存储和创建VM中的ova文件。您可能需要根据自己的需求进行定制。</p><figure class="lj lk ll lm fd ln"><div class="bz dy l di"><div class="mv mw l"/></div></figure><h2 id="dcfa" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">最后一步，同步应用数据。</h2><p id="901d" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">创建虚拟机后，您可以在Oracle云基础架构中将数据块卷连接到虚拟机，并将应用程序文件系统复制回来。我使用rsync进行同步，您可以做类似的事情，将应用程序数据复制回单独的设备。</p><pre class="lj lk ll lm fd nd nc ne nf aw ng bi"><span id="de04" class="jd je hh nc b fi nh ni l nj nk"># rsync -vuar /tmp-fs /application<br/>sending incremental file list<br/>tmp-fs/<br/>tmp-fs/lost+found/<br/>tmp-fs/application-file.txt<br/>....</span></pre><h2 id="7e93" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">参考资料:</h2><p id="c779" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated"><a class="ae jc" href="https://registry.terraform.io/providers/hashicorp/oci/latest/docs" rel="noopener ugc nofollow" target="_blank">OCI的terra form</a><br/><a class="ae jc" href="https://docs.oracle.com/en-us/iaas/Content/Compute/References/bringyourownimage.htm" rel="noopener ugc nofollow" target="_blank">OCI虚拟机导入</a><br/><a class="ae jc" href="https://registry.terraform.io/providers/hashicorp/aws/latest/docs" rel="noopener ugc nofollow" target="_blank">AWS的terra form</a><br/><a class="ae jc" href="https://docs.aws.amazon.com/vm-import/latest/userguide/vmexport_image.html" rel="noopener ugc nofollow" target="_blank">AWS虚拟机导出</a></p></div></div>    
</body>
</html>