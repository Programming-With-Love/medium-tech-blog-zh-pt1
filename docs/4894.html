<html>
<head>
<title>Android’s billion-dollar mistake(s)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android的十亿美元错误</h1>
<blockquote>原文：<a href="https://blog.kotlin-academy.com/androids-billion-dollar-mistake-s-63518cc3ba26?source=collection_archive---------0-----------------------#2019-10-09">https://blog.kotlin-academy.com/androids-billion-dollar-mistake-s-63518cc3ba26?source=collection_archive---------0-----------------------#2019-10-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/fd7e8b71567ae8554c52955d00ff1418.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cqZ5nYxFJyNH4dQaE8Eucg.png"/></div></div></figure><p id="efdf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">一篇关于<em class="kt">十亿美元的错误</em>，那些被假设的错误和那些<em class="kt">保持沉默的错误</em>，以及关于<em class="kt">不要用糟糕的文档误导新开发人员的重要性</em>的文章。</p><h1 id="ca87" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">十亿美元的错误报价</h1><p id="a90a" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">你听说过十亿美元的报价吗？大概是:</p><blockquote class="lx ly lz"><p id="0844" class="jv jw kt jx b jy jz ka kb kc kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ks ig bi translated">我称之为我的十亿美元错误。这是1965年零引用的发明。当时，我正在用面向对象语言(ALGOL W)设计第一个用于引用的综合类型系统。我的目标是确保所有引用的使用都是绝对安全的，由编译器自动执行检查。但是我无法抗拒放入空引用的诱惑，仅仅是因为它太容易实现了。这导致了数不清的错误、漏洞和系统崩溃，在过去的四十年里，这可能造成了数十亿美元的痛苦和损失。</p><p id="94a5" class="jv jw kt jx b jy jz ka kb kc kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ks ig bi translated">2009年伦敦QCon上的东尼·霍尔<a class="ae md" href="https://en.wikipedia.org/wiki/Tony_Hoare" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Tony_Hoare</a></p></blockquote><h1 id="c674" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">托尼·霍尔是编程英雄🦸</h1><p id="70fc" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">如果你像我一样，当第一次听到这句话时，你的反应是:“哇。我也犯了很多错误，但通常不会花那么多钱！”。</p><p id="4864" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">最近我对此有了更深的思考，我现在认为<strong class="jx io">东尼·霍尔</strong>是一个伟大的编程英雄！不仅仅是因为他在那个十亿美元的错误之外所做的令人印象深刻的工作</p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><div class="gh gi me"><img src="../Images/ea7e72887f39de146b9165f461f4a008.png" data-original-src="https://miro.medium.com/v2/resize:fit:540/format:webp/0*9MFGoONo2rNBJx7x.png"/></div></figure><p id="ac9a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">不，我的主张是，他还因为公开承担了它的“错误”而伟大！</p><p id="2978" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你认为他是唯一一个犯了十亿美元错误的程序员吗？再想想。IT部门是巨大的。脸书、谷歌、亚马逊、苹果、微软的市值在5000亿到1万亿美元之间。任何让他们的估值损失0.2%的编程错误都是一个十亿美元的错误。</p><p id="cb7e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">不，东尼·霍尔被称为犯了十亿美元错误的人的真正原因是<strong class="jx io">他明确公开地将自己的决定描述为一个错误，并通过这样做发出了一个明确的信号，事情必须改变</strong>。</p><p id="e763" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><strong class="jx io">我的朋友们，这个</strong>对软件行业非常有益，这就是Kotlin和其他编程语言在它们的类型系统中内置了<a class="ae md" href="https://kotlinlang.org/docs/reference/null-safety.html" rel="noopener ugc nofollow" target="_blank">零安全的原因</a>。它们仍然有<code class="fe mj mk ml mm b">null</code>，这本身不是问题，但是它被集成到类型系统中<em class="kt">以确保所有引用绝对安全，检查由编译器自动执行</em>。</p><p id="2c88" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">东尼·霍尔是真正的男子汉，一个没有自我意识的程序员，他为错误承担责任，这样我们就能认识到错误，我们都应该心存感激。</p><p id="83d9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在Android世界，事情有点不同。在深入探讨之前，让我们先从一个简单的例子开始。</p><h2 id="0f91" class="mn kv in bd kw mo mp dn la mq mr dp le kg ms mt li kk mu mv lm ko mw mx lq my bi translated">沙地匈牙利旋转</h2><p id="bd4e" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">直到2019年5月，世界上大多数的sAndroid mCodebases都被匈牙利语的一个<a class="ae md" href="https://jakewharton.com/just-say-no-to-hungarian-notation/" rel="noopener ugc nofollow" target="_blank">无意义的mVariant所困扰。它的缺点是没有给Android Studio中简单的代码高亮规则带来任何好处，还有一个明显的缺点是<em class="kt">使得所有东西都不那么可读</em>。</a></p><p id="4666" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">当你在2019年之前提出这个问题时，你通常会得到两个答案之一:</p><ul class=""><li id="2f80" class="mz na in jx b jy jz kc kd kg nb kk nc ko nd ks ne nf ng nh bi translated">这是现状，所以很好。</li><li id="f307" class="mz na in jx b jy ni kc nj kg nk kk nl ko nm ks ne nf ng nh bi translated">我们Android团队只是说，如果你在Android开源项目中贡献代码，就必须遵守这个约定。</li></ul><p id="5f52" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但是实际上</p><ul class=""><li id="281f" class="mz na in jx b jy jz kc kd kg nb kk nc ko nd ks ne nf ng nh bi translated">第一个回答是<em class="kt">错</em>。我们知道这一点，因为自从匈牙利记谱法被废除后，没有人抱怨要恢复它。</li><li id="25c4" class="mz na in jx b jy ni kc nj kg nk kk nl ko nm ks ne nf ng nh bi translated">第二个答案是<em class="kt">差</em>，它属于<a class="ae md" href="https://en.wikipedia.org/wiki/Not_even_wrong" rel="noopener ugc nofollow" target="_blank">非错范畴</a>。这种说法本质上是说其他人都错了。那么显而易见的问题是:<em class="kt">为什么？</em>。因为每个人都在学习Android文档和示例，这种惯例无处不在。这正是你应该做的创建一个约定的艰苦而一致的工作。它只是碰巧是一个有害的惯例。</li></ul><p id="9a13" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">是什么杀死了2019年5月的mHungarian符号？不是承认错误，而是引进科特林。为什么我们要等这么久？</p><h1 id="5caa" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">Android的十亿美元错误💣</h1><h1 id="1171" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">定义“错误”一词</h1><p id="5776" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">Android显然是一个巨大的商业成功，我并没有相反的说法。Android和iPhone已经成功地对智能手机世界实施了双重垄断，因此接下来发生的事情可能也不是战术上的“错误”。无论如何，我们必须使用Android团队提供的任何工具。</p><p id="063a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我也认为从用户的角度来看，Android是一个很好的操作系统。你可以更喜欢iOS，我没意见，但这并不能让Android变坏。</p><p id="17f1" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在本文的<code class="fe mj mk ml mm b">Context</code>中，<em class="kt">错误</em>是指专门误导开发者走上一条会给他们带来痛苦和磨难的道路。</p><p id="ee34" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我也不认为这是Android SDK中唯一的大错误，甚至是Android SDK中最重要的错误。</p><p id="8516" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你对了解Android的不好的部分感到好奇，那么#androiddev Reddit社区已经整理了一个非常有用的列表，列出了他们在Android中发现的不好的地方。但在这里，我将关注一个有趣的基本错误。</p><h1 id="0704" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">Android玉米煎饼设计模式🌯</h1><p id="d8fd" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">关于Android的一件悲哀的事情是，官方的Android样本遵循以色列费勒卡马乔所谓的<a class="ae md" href="https://speakerdeck.com/rallat/androiddevlikeaprodroidconsf?slide=24" rel="noopener ugc nofollow" target="_blank"> Android玉米煎饼设计模式</a>:只是把<em class="kt">所有的东西</em>都包在一个玉米煎饼里🌯做<em class="kt">所有事情</em>的<code class="fe mj mk ml mm b">GodActivity</code>和/或<code class="fe mj mk ml mm b">GodFragment</code>。</p><p id="a259" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">看看<code class="fe mj mk ml mm b"><a class="ae md" href="https://github.com/android/camera-samples/blob/f555592364979f4005db0bea40753e0de52c8d86/Camera2BasicKotlin/Application/src/main/java/com/example/android/camera2basic/Camera2BasicFragment.kt#L60-L817" rel="noopener ugc nofollow" target="_blank">😱 camera-samples/Camera2BasicFragment.kt 😭</a></code>的精彩源代码吧。我不得不剪切文件的大部分以适合一个要点，但它仍然是可读的:</p><figure class="mf mg mh mi gt jo"><div class="bz fp l di"><div class="nn no l"/></div><figcaption class="np nq gj gh gi nr ns bd b be z dk">See in its full glory at <a class="ae md" href="https://github.com/android/camera-samples/blob/f555592364979f4005db0bea40753e0de52c8d86/Camera2BasicKotlin/Application/src/main/java/com/example/android/camera2basic/Camera2BasicFragment.kt#L60-L817" rel="noopener ugc nofollow" target="_blank">https://github.com/android/camera-samples/blob/f555592364979f4005db0bea40753e0de52c8d86/Camera2BasicKotlin/Application/src/main/java/com/example/android/camera2basic/Camera2BasicFragment.kt#L60-L817</a></figcaption></figure><p id="cd21" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">每当你建议在<code class="fe mj mk ml mm b">Activity</code>里再放一个东西的时候，上帝就会杀死一只小猫。这正是Android官方文档和示例至今所做的事情。</p><p id="bcd7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果你遵循Android玉米煎饼设计模式，会出什么问题？</p><h1 id="0dae" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">猛撞</h1><p id="2e2e" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated"><code class="fe mj mk ml mm b">Activity</code>是一种特殊的环境，充满了随时可能爆炸的地雷。最明显的问题是，由于这种复杂的生命周期，你的<code class="fe mj mk ml mm b">Activity</code>随时可能被系统杀死。使用像<code class="fe mj mk ml mm b">Application</code>这样生命周期更简单的<code class="fe mj mk ml mm b">Context</code>要安全得多。</p><h1 id="60a6" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">内存泄漏</h1><p id="2873" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated"><code class="fe mj mk ml mm b">Activity</code>是一个昂贵的对象，它依赖于整个用户界面。抓住活动对象不放是很容易掉入陷阱的。随之而来的是内存泄漏。事实上，这是一个如此常见的陷阱，以至于你甚至会在Android SDK本身的类中看到这个错误，无论是在一些蹩脚的三星fork中还是在Android开源项目本身中。这是一个如此普遍的问题，以至于square的好人投入时间和精力来自动检测这些问题。</p><div class="nt nu gp gr nv nw"><a href="https://github.com/square/leakcanary" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab fo"><div class="ny ab nz cl cj oa"><h2 class="bd io gy z fp ob fr fs oc fu fw im bi translated">方形/泄漏金丝雀</h2><div class="od l"><h3 class="bd b gy z fp ob fr fs oc fu fw dk translated">LeakCanary是一个用于Android的内存泄漏检测库。-正方形/leakcanary</h3></div><div class="oe l"><p class="bd b dl z fp ob fr fs oc fu fw dk translated">github.com</p></div></div><div class="of l"><div class="og l oh oi oj of ok jt nw"/></div></div></a></div><h1 id="78ac" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">即时遗留代码</h1><p id="99aa" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated"><code class="fe mj mk ml mm b">Legacy code</code>经常被用作一个模糊的术语，意思是“<em class="kt">代码难以理解，以至于你害怕改变它</em>”。Michael Feathers的经典著作:<a class="ae md" href="https://www.amazon.de/Working-Effectively-Legacy-Robert-Martin/dp/0131177052" rel="noopener ugc nofollow" target="_blank">《有效地使用遗留代码》</a>有一个更为精确和可操作的定义:任何没有被单元测试自动覆盖的代码都有资格成为遗留代码。</p><blockquote class="lx ly lz"><p id="9b0e" class="jv jw kt jx b jy jz ka kb kc kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ks ig bi translated"><em class="in">任何遵循Android玉米煎饼设计模式的代码都立即被视为遗留代码。</em></p></blockquote><p id="4c76" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我一直想知道为什么Android官方文档如此强调仪器测试。</p><p id="e3d9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">根据我的经验，这些很难写，基本上很慢——它们必须在Android设备上运行——最糟糕的是，当它们失败时，它们通常不会告诉你什么。</p><p id="53b9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我走了完全相反的方向，写了许多简单、快速、集中的JVM测试，并且有了更好的结果。事实上，谷歌的测试团队有一篇精彩的文章，解释了为什么端到端测试是一个明显的好主意，但在实践中却失败了:</p><blockquote class="lx ly lz"><p id="e8c0" class="jv jw kt jx b jy jz ka kb kc kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ks ig bi translated"><strong class="jx io"> <em class="in">对更多的端到端测试说不</em> </strong></p><p id="9571" class="jv jw kt jx b jy jz ka kb kc kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ks ig bi translated"><em class="in">好主意经常在实践中失败，在测试领域，一个普遍的好主意经常在实践中失败，那就是围绕端到端测试构建的测试策略。</em></p><p id="e827" class="jv jw kt jx b jy jz ka kb kc kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ks ig bi translated"><em class="in">[…请阅读整篇文章，非常好……]<br/></em><a class="ae md" href="https://testing.googleblog.com/2015/04/just-say-no-to-more-end-to-end-tests.html" rel="noopener ugc nofollow" target="_blank"><em class="in">Google测试博客:对更多端到端测试说不</em> </a></p></blockquote><p id="a97d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所以仪器化的Android测试不是一个好主意。</p><p id="e56b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但是老实说，如果你把你的逻辑放在Android组件里面，那几乎是你能做的全部:</p><blockquote class="lx ly lz"><p id="c9af" class="jv jw kt jx b jy jz ka kb kc kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ks ig bi translated">检验玉米煎饼的唯一方法是尝一尝。</p></blockquote><p id="b734" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">回想起来，Android玉米煎饼的设计模式显然是错误的，这让我很好奇:它来自哪里，它是如何存活到今天的？</p><h1 id="4690" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">安卓卷饼设计模式是怎么成为一个东西的？</h1><h1 id="cbe9" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">有的<code class="fe mj mk ml mm b">Context</code>📚</h1><p id="633e" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">给你一些<code class="fe mj mk ml mm b">Context</code>，这是Android SDK 1.0的两个最基本的构建模块:</p><ul class=""><li id="2cca" class="mz na in jx b jy jz kc kd kg nb kk nc ko nd ks ne nf ng nh bi translated"><a class="ae md" href="https://developer.android.com/reference/android/content/Context?hl=en" rel="noopener ugc nofollow" target="_blank">Android . content . context</a>提供对关于应用环境的所有全局信息的访问。它允许访问特定于应用程序的资源和类，以及对应用程序级操作的向上调用，如启动活动、广播和接收意图等。</li><li id="85a8" class="mz na in jx b jy ni kc nj kg nk kk nl ko nm ks ne nf ng nh bi translated"><a class="ae md" href="https://developer.android.com/reference/android/app/Activity?hl=en" rel="noopener ugc nofollow" target="_blank"> android.app.Activity </a>为应用程序提供了相当于<code class="fe mj mk ml mm b">main()</code>的功能，但增加了移动操作系统所需的许多功能，最重要的是复杂的<a class="ae md" href="https://developer.android.com/guide/components/activities/activity-lifecycle?hl=en" rel="noopener ugc nofollow" target="_blank">活动生命周期</a>。</li></ul><p id="84e5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这两个概念有什么关系？</p><h1 id="e830" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">活动就是背景</h1><p id="e264" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">这是一个在Android 1.0中犯的致命错误</p><pre class="mf mg mh mi gt ol mm om on aw oo bi"><span id="78dd" class="mn kv in mm b gy op oq l or os">package android.app;</span><span id="969e" class="mn kv in mm b gy ot oq l or os">import android.content.Context;</span><span id="4c9e" class="mn kv in mm b gy ot oq l or os">class Activity extends Context { <br/>}</span></pre><p id="6189" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但首先要讲一点理论。</p><h1 id="e529" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">构图的遗传🙄</h1><p id="09ce" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">从你的<a class="ae md" href="https://en.wikipedia.org/wiki/Object-oriented_programming" rel="noopener ugc nofollow" target="_blank">面向对象编程</a> 101课程中，你可能记得对象之间有两种非常不同的关系:</p><ul class=""><li id="2436" class="mz na in jx b jy jz kc kd kg nb kk nc ko nd ks ne nf ng nh bi translated"><strong class="jx io">继承</strong>:房子<strong class="jx io">是</strong>建筑</li><li id="407d" class="mz na in jx b jy ni kc nj kg nk kk nl ko nm ks ne nf ng nh bi translated"><strong class="jx io">构图</strong>:一栋房子<strong class="jx io">有一个</strong>房间</li></ul><p id="9c1c" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><a class="ae md" href="https://en.wikipedia.org/wiki/Composition_over_inheritance" rel="noopener ugc nofollow" target="_blank">优于继承的组合</a>是一个众所周知的设计原则，在一些有影响力的书籍中有所陈述，如</p><ul class=""><li id="5c32" class="mz na in jx b jy jz kc kd kg nb kk nc ko nd ks ne nf ng nh bi translated"><a class="ae md" href="https://en.wikipedia.org/wiki/Design_Patterns" rel="noopener ugc nofollow" target="_blank">设计模式:可重用面向对象软件的元素(1994) </a>，作者:Erich Gamma、Richard Helm、Ralph Johnson和John Vlissides</li><li id="e193" class="mz na in jx b jy ni kc nj kg nk kk nl ko nm ks ne nf ng nh bi translated">约书亚·布洛赫的《有效的Java》</li></ul><p id="1a45" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">Android仅仅是另一个SDK ( <a class="ae md" href="https://en.wikipedia.org/wiki/Software_development_kit" rel="noopener ugc nofollow" target="_blank">软件开发工具包</a>)，但是是否有理由说明这个原理在这里并不适用？嗯，不，我知道如果他们今天有机会重写<code class="fe mj mk ml mm b">Activity</code>，Android团队不会这样做，因为…</p><h1 id="509a" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">碎片！是上下文🤔</h1><p id="70f5" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">如果你看一下<a class="ae md" href="https://developer.android.com/reference/androidx/fragment/app/Fragment.html?hl=en" rel="noopener ugc nofollow" target="_blank"> androidx.app.Fragment </a>，Android SDK的另一个构建块与Activity非常相似，但在<strong class="jx io">之后</strong>引入，你会意识到它确实<strong class="jx io">而不是</strong>扩展了上下文。相反，片段<strong class="jx io">具有</strong>上下文。</p><p id="0d53" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">那么，为什么Android团队会改变主意，尽管是悄悄的？</p><h1 id="aaa4" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">在Android中，一切都需要上下文📱</h1><p id="b1e2" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">你可以也应该避免墨西哥卷饼的设计模式。你无法逃避的是，在Android中，你需要一个上下文来做基本上所有的事情:</p><pre class="mf mg mh mi gt ol mm om on aw oo bi"><span id="e3a9" class="mn kv in mm b gy op oq l or os">class SomeThirdPartyClass {<br/>    fun doStuff(contex: Context) = TODO()<br/>}</span></pre><p id="a6ea" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但即使是这种平庸的课程也是一颗等待爆炸的地雷。</p><p id="ae23" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">活动<strong class="jx io">是一个</strong>上下文，所以很容易将<code class="fe mj mk ml mm b">this@Activity</code>作为参数传递给<code class="fe mj mk ml mm b">doStuff()</code>。但是这样做是错误的，你不能确定<code class="fe mj mk ml mm b">SomeThirdPartyClass</code>正在做正确的事情，或者你正在做正确的事情。崩溃、内存泄漏和不可测试性随之而来。</p><p id="d3c5" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我想指出，我说的不仅仅是一个历史性的短视决定。</p><h1 id="9409" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">文件和样品今天仍然是糟糕的</h1><p id="47ea" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">2014年，我是一个年轻的没有经验的Android开发者团队中的一个年轻的没有经验的Android开发者。我们试图了解这些东西是如何工作的，并使用Android文档和样本作为蓝图。回想起来，这是一个可怕的错误。我们最终得到了一个痛苦的难以理解、难以测试、甚至更难修改的烂摊子。不是因为我们没有遵循“Android最佳实践”，而是<em class="kt">正是因为我们遵循了！</em></p><p id="f3ab" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">快进到今天，虽然已经在几个领域取得了进展，但很大一部分官方Android文档和示例仍然写得很差。它继续误导新一代没有经验的开发人员。正如Bob叔叔会告诉你的，大多数开发人员都是新手，因为IT行业每五年就要翻一番。</p><p id="dbf0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我意识到，对于某些学派来说，所有这些都是公平的游戏:“<em class="kt">那些错误是愚蠢的，我是一个真正的程序员，不会上当。你不能阻止愚蠢的人变得愚蠢，不是吗？</em>”。</p><p id="bc81" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但是我来自<em class="kt">为人类而设计</em>学派，所以在我看来，当一个程序员犯了一个错误，那是程序员的错，但是当十多年过去了，成千上万的程序员一次又一次地犯同样的错误，那么就是设计者和文档作者没有做好工作。理想情况下，做正确的事应该很容易，搬起石头砸自己的脚应该更难。</p><p id="e889" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所以是时候说清楚了，卷饼活动和片段是不可以的。已经过了修改文档和样本的时间了。</p><h1 id="c1ec" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">“犯了错误”😔</h1><p id="4cbe" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">我确实明白，尽管这些错误在今天是痛苦的，但它们是在特定的历史背景下犯下的。Android项目必须发布一些东西或者变得无关紧要，当智能手机远不如今天强大时，这是一个不同的领域。</p><p id="bbb6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">JavaScript也是如此。<a class="ae md" href="https://thenewstack.io/brendan-eich-on-creating-javascript-in-10-days-and-what-hed-do-differently-today/" rel="noopener ugc nofollow" target="_blank">它的设计在短短十天内匆匆完成</a>，然后在<a class="ae md" href="https://fr.wikipedia.org/wiki/Netscape_Navigator" rel="noopener ugc nofollow" target="_blank">网景导航器1.0 </a>中出货，剩下的就是历史了。</p><p id="178f" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">并不是说没有解决方案可以让这种历史错误变得可控。</p><p id="bcaf" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">聪明人一旦痛苦地意识到问题所在，通常会很快找到解决方案。</p><p id="2fc0" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这正是东尼·霍尔无我的诚实的伟大之处:它立刻让人意识到这里有一个问题需要解决。这就是今天Android世界所缺乏的。Android官方文档延续至今，用奇妙的Android卷饼设计模式杀死小猫。</p><p id="a832" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">请允许我引用东尼·霍尔的话来结束我的发言:</p><blockquote class="lx ly lz"><p id="ae66" class="jv jw kt jx b jy jz ka kb kc kd ke kf ma kh ki kj mb kl km kn mc kp kq kr ks ig bi translated">这导致了数不清的错误、漏洞和系统崩溃，在过去的十年中，这可能造成了数十亿美元的痛苦和损失。</p></blockquote></div><div class="ab cl ou ov hr ow" role="separator"><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz pa"/><span class="ox bw bk oy oz"/></div><div class="ig ih ii ij ik"><h1 id="ae99" class="ku kv in bd kw kx pb kz la lb pc ld le lf pd lh li lj pe ll lm ln pf lp lq lr bi translated">单击👏说“谢谢！”并帮助他人找到这篇文章。</h1><p id="3e8a" class="pw-post-body-paragraph jv jw in jx b jy ls ka kb kc lt ke kf kg lu ki kj kk lv km kn ko lw kq kr ks ig bi translated">了解卡帕头最新的重大新闻。学院、<a class="ae md" href="https://kotlin-academy.us17.list-manage.com/subscribe?u=5d3a48e1893758cb5be5c2919&amp;id=d2ba84960a" rel="noopener ugc nofollow" target="_blank">订阅时事通讯</a>、<a class="ae md" href="https://twitter.com/ktdotacademy" rel="noopener ugc nofollow" target="_blank">观察Twitter </a>并在medium上关注我们。</p><p id="3cd8" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您需要Kotlin工作室，请查看我们如何帮助您:<a class="ae md" href="https://www.kt.academy/" rel="noopener ugc nofollow" target="_blank"> kt.academy </a>。</p><figure class="mf mg mh mi gt jo gh gi paragraph-image"><a href="https://kotlin-academy.us17.list-manage.com/subscribe?u=5d3a48e1893758cb5be5c2919&amp;id=d2ba84960a"><div class="gh gi pg"><img src="../Images/3146970f03e44cb07afe660b0d43e045.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*54OqlYA4etu7wfpmMP5TKQ.png"/></div></a></figure></div></div>    
</body>
</html>