<html>
<head>
<title>Getting started with the MySQL Operator for Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes的MySQL操作器入门</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/getting-started-with-the-mysql-operator-for-kubernetes-8df48591f592?source=collection_archive---------0-----------------------#2019-04-24">https://medium.com/oracledevs/getting-started-with-the-mysql-operator-for-kubernetes-8df48591f592?source=collection_archive---------0-----------------------#2019-04-24</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="d4dd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Kubernetes的操作员非常出色，他们已经在管理大规模应用程序的人员中扮演了重要的角色。我个人认为我们会用运营商来管理所有的应用。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/9848204eca8001ff0080a30be7032fa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4JspDZGDtpJER0NUbIFnlA.png"/></div></div></figure><p id="8a13" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本教程中，我将向你展示如何在Kubernetes上使用MySQL操作符来设置一个MySQL集群。</p><p id="9029" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">先决条件:</p><ol class=""><li id="53de" class="jo jp hh ig b ih ii il im ip jq it jr ix js jb jt ju jv jw bi translated">安装<a class="ae jx" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" rel="noopener ugc nofollow" target="_blank">库贝克特尔</a></li><li id="2815" class="jo jp hh ig b ih jy il jz ip ka it kb ix kc jb jt ju jv jw bi translated">安装<a class="ae jx" href="https://helm.sh/docs/using_helm/" rel="noopener ugc nofollow" target="_blank">舵</a></li><li id="1ae4" class="jo jp hh ig b ih jy il jz ip ka it kb ix kc jb jt ju jv jw bi translated">Kubernetes集群:在本地使用<a class="ae jx" href="https://kubernetes.io/docs/setup/minikube/" rel="noopener ugc nofollow" target="_blank"> minikube </a>或者查看<a class="ae jx" rel="noopener" href="/devopslinks/kubernetes-deploying-a-cluster-with-a-few-clicks-using-a-web-console-5dbf75abc853"> Luca的帖子</a>关于如何设置OKE。</li></ol><p id="849c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们从克隆包含操作符的MySQL存储库开始。</p><pre class="jd je jf jg fd kd ke kf kg aw kh bi"><span id="3975" class="ki kj hh ke b fi kk kl l km kn">$ git clone <a class="ae jx" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:oracle/mysql-operator.git</span></pre><p id="0782" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在输入目录。</p><pre class="jd je jf jg fd kd ke kf kg aw kh bi"><span id="8299" class="ki kj hh ke b fi kk kl l km kn">$ cd mysql-operator</span></pre><p id="017d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">确保您的helm repo是最新的。</p><pre class="jd je jf jg fd kd ke kf kg aw kh bi"><span id="93da" class="ki kj hh ke b fi kk kl l km kn">$ helm repo update</span></pre><p id="bbc5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们创建一个将要安装操作符的名称空间。</p><pre class="jd je jf jg fd kd ke kf kg aw kh bi"><span id="89e0" class="ki kj hh ke b fi kk kl l km kn">$ kubectl create ns mysql-operator</span></pre><p id="dd15" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">安装mysql操作程序。</p><pre class="jd je jf jg fd kd ke kf kg aw kh bi"><span id="ecd7" class="ki kj hh ke b fi kk kl l km kn">$ helm install --name mysql-operator mysql-operator</span></pre><p id="bb0e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您应该会看到类似如下的输出:</p><pre class="jd je jf jg fd kd ke kf kg aw kh bi"><span id="b3e2" class="ki kj hh ke b fi kk kl l km kn">NAME:   mysql-operator<br/>LAST DEPLOYED: Tue Apr 23 15:48:53 2019<br/>NAMESPACE: default<br/>STATUS: DEPLOYED</span><span id="fd9a" class="ki kj hh ke b fi ko kl l km kn">RESOURCES:<br/>==&gt; v1beta1/CustomResourceDefinition<br/>NAME                                   AGE<br/>mysqlbackupschedules.mysql.oracle.com  4s<br/>mysqlclusters.mysql.oracle.com         4s<br/>mysqlbackups.mysql.oracle.com          4s<br/>mysqlrestores.mysql.oracle.com         4s</span><span id="c1a2" class="ki kj hh ke b fi ko kl l km kn">==&gt; v1beta1/ClusterRole<br/>mysql-operator  4s<br/>mysql-agent     4s</span><span id="434a" class="ki kj hh ke b fi ko kl l km kn">==&gt; v1beta1/ClusterRoleBinding<br/>NAME            AGE<br/>mysql-operator  3s<br/>mysql-agent     3s</span><span id="32a2" class="ki kj hh ke b fi ko kl l km kn">==&gt; v1beta1/Deployment<br/>NAME            DESIRED  CURRENT  UP-TO-DATE  AVAILABLE  AGE<br/>mysql-operator  1        1        1           0          3s</span><span id="af4c" class="ki kj hh ke b fi ko kl l km kn">==&gt; v1/Pod(related)<br/>NAME                           READY  STATUS             RESTARTS  AGE<br/>mysql-operator-d99c84c9-sldb7  0/1    ContainerCreating  0         3s</span><span id="7cd1" class="ki kj hh ke b fi ko kl l km kn">==&gt; v1/ServiceAccount<br/>NAME            SECRETS  AGE<br/>mysql-agent     1        5s<br/>mysql-operator  1        4s</span><span id="c1c7" class="ki kj hh ke b fi ko kl l km kn">NOTES:<br/>Thanks for installing the MySQL Operator.</span><span id="e85b" class="ki kj hh ke b fi ko kl l km kn">Check if the operator is running with</span><span id="a75b" class="ki kj hh ke b fi ko kl l km kn">kubectl -n mysql-operator get po</span></pre><p id="20d7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">正如文档所述，我们可以检查集群的状态。请注意，因为我们将它安装在名为mysql-operator的名称空间中，所以我们使用了-n标志。</p><pre class="jd je jf jg fd kd ke kf kg aw kh bi"><span id="9720" class="ki kj hh ke b fi kk kl l km kn">$ kubectl -n mysql-operator get po</span><span id="9d65" class="ki kj hh ke b fi ko kl l km kn">NAME                            READY     STATUS    RESTARTS   AGE<br/>mysql-operator-d99c84c9-sldb7   1/1       Running   0          2m</span></pre><p id="cd8a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们的操作员已经开始工作了。</p><p id="6fda" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们创建一个新的命名空间，我们将在其中安装MySQL集群:</p><pre class="jd je jf jg fd kd ke kf kg aw kh bi"><span id="c35e" class="ki kj hh ke b fi kk kl l km kn">$ kubectl create ns mysql-cluster</span></pre><p id="0720" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因为我们在一个新的名称空间中创建MySQL集群，我们将其命名为“mysql-cluster”，所以我们需要在该名称空间中创建<code class="du kp kq kr ke b">mysql-agent</code> ServiceAccount和RoleBinding。</p><p id="33a9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你决定把你的名字空间命名为其他名字，请确保在下面也进行更改。</p><p id="d539" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们创建<code class="du kp kq kr ke b">mysql-agent</code> ServiceAccount和RoleBinding:</p><pre class="jd je jf jg fd kd ke kf kg aw kh bi"><span id="60ef" class="ki kj hh ke b fi kk kl l km kn">$ cat &lt;&lt;EOF | kubectl create -f -<br/>apiVersion: v1<br/>kind: ServiceAccount<br/>metadata:<br/>  name: mysql-agent<br/>  namespace: mysql-cluster<br/>---<br/>kind: RoleBinding<br/>apiVersion: rbac.authorization.k8s.io/v1beta1<br/>metadata:<br/>  name: mysql-agent<br/>  namespace: mysql-cluster<br/>roleRef:<br/>  apiGroup: rbac.authorization.k8s.io<br/>  kind: ClusterRole<br/>  name: mysql-agent<br/>subjects:<br/>- kind: ServiceAccount<br/>  name: mysql-agent<br/>  namespace: mysql-cluster<br/>EOF</span></pre><p id="9179" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您应该会看到类似如下的输出:</p><pre class="jd je jf jg fd kd ke kf kg aw kh bi"><span id="10e8" class="ki kj hh ke b fi kk kl l km kn">serviceaccount "mysql-agent" created<br/>rolebinding "mysql-agent" created</span></pre><p id="8b71" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">用数据库名和名称空间创建一个<code class="du kp kq kr ke b">cluster.yaml</code>文件。我将我的数据库命名为“my-first-db ”,我使用的名称空间是“mysql-cluster”。</p><pre class="jd je jf jg fd kd ke kf kg aw kh bi"><span id="d597" class="ki kj hh ke b fi kk kl l km kn">apiVersion: mysql.oracle.com/v1alpha1<br/>kind: Cluster<br/>metadata:<br/>  name: my-first-db<br/>  namespace: mysql-cluster</span></pre><p id="59d1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在让我们创建MySQL集群。</p><pre class="jd je jf jg fd kd ke kf kg aw kh bi"><span id="1f47" class="ki kj hh ke b fi kk kl l km kn">$ kubectl apply -f cluster.yaml<br/>mysqlcluster "my-first-db" created</span></pre><p id="ad6c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意下面，因为我们已经安装了mysql-operator，kubernetes现在有了一个名为“mysqlclusters”的新资源。类似于我们如何编写<em class="ks"> kubectl get pods </em>我们现在可以编写<em class="ks">kubectl get MySQL clusters</em>。</p><p id="0691" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们仍然使用-n标志，因为我们在名为“mysql-cluster”的名称空间中安装了mysql集群。我也许应该选择一个不同的名称，以避免与资源名称混淆。</p><p id="d4d8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们检查一下我们的mysql集群:</p><pre class="jd je jf jg fd kd ke kf kg aw kh bi"><span id="b94a" class="ki kj hh ke b fi kk kl l km kn">$ kubectl -n mysql-cluster get mysqlclusters<br/>NAME          AGE<br/>my-first-db   32s</span></pre><p id="873d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以看到，我们有一个mysql-cluster正在运行。</p><p id="d1b5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们检查有多少个单元正在运行:</p><pre class="jd je jf jg fd kd ke kf kg aw kh bi"><span id="9476" class="ki kj hh ke b fi kk kl l km kn">$ kubectl -n mysql-cluster get pods <br/>NAME            READY     STATUS    RESTARTS   AGE<br/>my-first-db-0   2/2       Running   0          5m<br/>my-first-db-1   2/2       Running   0          5m<br/>my-first-db-2   2/2       Running   0          5m</span></pre><p id="5363" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如您所见，我们的集群由三个单元组成。默认情况下，集群有三个成员。您可以通过将<em class="ks"> spec: members: 3 </em>添加到cluster.yaml文件来指定其他内容。还有其他的选择，但我会在另一篇博文中介绍。</p><p id="6288" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们获取新数据库的root密码。注意，由操作员自动创建的秘密和配置以我们在上面的cluster.yaml文件中输入的数据库名称为前缀。</p><pre class="jd je jf jg fd kd ke kf kg aw kh bi"><span id="d5fd" class="ki kj hh ke b fi kk kl l km kn">$ kubectl -n mysql-cluster get secret my-first-db-root-password -o jsonpath="{.data.password}" | base64 --decode</span><span id="4e39" class="ki kj hh ke b fi ko kl l km kn">#output<br/>FDlQQxPCVdMZ6lAt</span></pre><p id="6a68" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们创建一个包含MySQL客户端的临时容器来测试我们是否可以连接到新创建的数据库。</p><p id="2604" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意，我们在同一个名称空间中创建容器。如果我们不这样做，我们将无法使用主机名来访问创建的数据库。</p><pre class="jd je jf jg fd kd ke kf kg aw kh bi"><span id="4e9f" class="ki kj hh ke b fi kk kl l km kn">$ kubectl -n mysql-cluster run mysql-client --image=mysql:5.7 -it --rm --restart=Never -- /bin/bash</span><span id="c7ef" class="ki kj hh ke b fi ko kl l km kn">If you don't see a command prompt, try pressing enter.<br/>root@mysql-client:/#</span></pre><p id="0cb8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">用上面生成的密码替换下面的密码。</p><pre class="jd je jf jg fd kd ke kf kg aw kh bi"><span id="5e74" class="ki kj hh ke b fi kk kl l km kn">$ mysql -h my-first-db -uroot -pFDlQQxPCVdMZ6lAt -e 'SELECT 1'</span><span id="0c66" class="ki kj hh ke b fi ko kl l km kn">mysql: [Warning] Using a password on the command line interface can be insecure.<br/>+---+<br/>| 1 |<br/>+---+<br/>| 1 |<br/>+---+</span></pre><p id="5c8b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">恭喜你。您已经安装了MySQL操作器，创建了一个MySQL集群并连接到它。</p><p id="825a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您想在Oracle Cloud上尝试一下，请注册一个<a class="ae jx" href="http://bit.ly/OKEMySQL" rel="noopener ugc nofollow" target="_blank">免费试用版</a>并在几分钟内启动Kubernetes。</p><p id="967d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你在建立生产级别系统时遇到问题或需要建议，请随时通过<a class="ae jx" href="https://twitter.com/hassanajan" rel="noopener ugc nofollow" target="_blank"> twitter </a>或<a class="ae jx" href="https://www.linkedin.com/in/hassanajan" rel="noopener ugc nofollow" target="_blank"> linkedin </a>联系我。</p></div></div>    
</body>
</html>