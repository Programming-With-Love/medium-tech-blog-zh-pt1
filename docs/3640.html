<html>
<head>
<title>Microsoft Azure Traffic Manager</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Microsoft Azure流量管理器</h1>
<blockquote>原文：<a href="https://medium.com/globant/microsoft-azure-traffic-manager-1e9f1302e8db?source=collection_archive---------0-----------------------#2021-03-11">https://medium.com/globant/microsoft-azure-traffic-manager-1e9f1302e8db?source=collection_archive---------0-----------------------#2021-03-11</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/fc0844020cbb31dafabf147c932152d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9KtStJkNVuK-rozlyIr35g.png"/></div></div></figure><p id="5876" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">什么是Azure流量管理器:</strong></p><ul class=""><li id="41dc" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm js jt ju jv bi translated">将流量(请求)从客户端路由到适当的端点。</li><li id="f33f" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">端点只不过是运行在Azure内部或外部的服务或应用程序。</li><li id="6ed8" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">可以跟踪端点的状态(正在运行、已停止、已删除)，这只是端点的运行状况监控。</li><li id="d4d0" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">Azure Traffic Manager使用DNS根据各种流量路由方法将请求定向到适当的服务端点。</li></ul><h1 id="c7d2" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">流量管理器功能</h1><p id="4323" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated"><strong class="ir hi">应用程序的高可用性</strong>，通过监控端点并在端点关闭时提供自动故障转移。</p><p id="a6ad" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">通过将请求重定向到延迟最低的端点，提高了性能</strong>。</p><p id="0cf5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">无停机时间</strong>，在维护过程中，流量管理器可以将请求重定向到备用端点。</p><h1 id="e0d1" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">Azure流量管理器配置文件</h1><p id="8ea1" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">流量管理器配置文件使用流量路由方法来控制到您的网站端点的流量分配。您可以使用任何方法创建流量管理器配置文件—门户、PowerShell、Azure CLI、ARM模板。</p><h1 id="a7b1" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak">流量管理器端点</strong></h1><p id="e24e" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">Azure traffic manager允许您控制如何将网络流量分配给在不同数据中心运行的应用程序部署。您可以在traffic manager中将每个应用程序部署配置为“端点”。当traffic manager收到DNS请求时，它会根据运行状况检查或状态选择可用端点，并在DNS响应中返回路由方法。</p><p id="20fa" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">流量管理器支持3种类型的端点</p><p id="492b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> Azure端点</strong>——用于Azure中托管的服务。</p><p id="5bc6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">外部端点</strong> -这些服务位于内部或由不同的托管提供商提供。</p><p id="c5b5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">嵌套端点</strong> -这些端点用于创建更灵活的流量路由方案，以支持大型和更复杂的部署需求。</p></div><div class="ab cl le lf go lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="ha hb hc hd he"><p id="e1a3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">配置端点监控:</strong></p><figure class="lm ln lo lp fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ll"><img src="../Images/0129e44e809c2ea85bbe5b6fe226f2d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yzwLTb0jSbLvsgSxd38peQ.png"/></div></div></figure><p id="c1cc" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要配置端点监控，您必须在流量管理器配置文件中指定以下设置:</p><ul class=""><li id="aad4" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm js jt ju jv bi translated"><strong class="ir hi">协议- </strong>选择HTTP、HTTPS或TCP作为Traffic Manager在探测端点以检查其健康状况时使用的协议</li><li id="c0bf" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated"><strong class="ir hi"> Port- </strong>选择用于请求的端口。</li><li id="e9ec" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated"><strong class="ir hi">路径- </strong>此配置设置仅对HTTP和HTTPS协议有效，对于这些协议，需要指定路径设置。为TCP监控协议提供此设置会导致错误。对于HTTP和HTTPS协议，给出监控访问的网页或文件的相对路径和名称。正斜杠(/)是相对路径的有效条目。这个值意味着文件在根目录中(默认)。</li><li id="9be8" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated"><strong class="ir hi">探测间隔- </strong>该值指定从流量管理器探测代理检查端点健康状况的频率。您可以在这里指定两个值:30秒(正常探测)和10秒(快速探测)。如果没有提供值，该配置文件将设置为默认值30秒。访问<a class="ae lq" href="https://azure.microsoft.com/pricing/details/traffic-manager" rel="noopener ugc nofollow" target="_blank">流量管理器定价</a>页面，了解有关快速探测定价的更多信息。</li><li id="dbf5" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated"><strong class="ir hi">容许失败次数- </strong>该值指定在将端点标记为不健康之前，流量管理器探测代理可以容许的失败次数。它的值可以在0到9之间。值为0表示单次监控失败会导致该端点被标记为不健康。如果没有指定值，则使用默认值3。</li><li id="3984" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated"><strong class="ir hi">监控超时- </strong>此属性指定当健康检查探测发送到端点时，流量管理器探测代理在认为检查失败之前应等待的时间。如果探测间隔设置为30秒，那么您可以将超时值设置在5到10秒之间。如果没有指定值，则使用默认值10秒。如果探测间隔设置为10秒，那么您可以将超时值设置在5到9秒之间。如果没有指定超时值，它将使用默认值9秒。</li></ul><h1 id="e30f" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">端点监控的工作原理:</h1><p id="4cee" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">如果监控协议设置为HTTP或HTTPS，Traffic Manager探测代理将使用给定的协议、端口和相对路径向端点发出GET请求。如果它返回200-OK响应，则该端点被认为是健康的。</p><p id="202e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果监控协议是TCP，Traffic Manager探测代理将使用指定的端口发起TCP连接请求。如果端点用建立连接的响应来响应请求，则健康检查被标记为成功，并且Traffic Manager探测代理重置TCP连接。</p><p id="ad1c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果响应是HTTP/HTTPS或TCP的不同值，或者如果在指定的超时期限内未收到响应，则Traffic Manager探测代理将根据允许的失败次数设置进行重试(如果此设置为0，则不会进行重试)。如果连续失败的次数高于允许的失败次数设置，则该端点被标记为不健康。</p><p id="8ba1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">流量管理器路由方法</strong></p><p id="4700" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">支持六种路由方法</p><p id="2156" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">路由方法决定了如何将流量路由到各种服务端点，以及哪个端点将作为DNS响应返回。</p><p id="c9fa" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Traffic Manager中提供了以下流量路由方法</p><figure class="lm ln lo lp fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/54db0d61668b6b722809b3da862883fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XIw4cJHSgR7GZO2mtvhmKw.png"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx"><strong class="bd kd">Routing Methods</strong></figcaption></figure><h1 id="600d" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak">Azure流量管理器如何工作:</strong></h1><figure class="lm ln lo lp fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lv"><img src="../Images/7031f191ed43c8b5a8db709cf60cab12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0HSzLIhMCKxqbkJumyGxpQ.jpeg"/></div></div></figure><ol class=""><li id="dbf8" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm lw jt ju jv bi translated">客户要求网站名称portal.mywebsite.com。此请求被发送到配置的递归DNS服务以解析名称。</li><li id="5aef" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm lw jt ju jv bi translated">为了解析DNS名称，递归DNS服务查找mywebsite.com域的名称服务器。然后，它联系这些域名服务器，请求portal.mywesite.com的DNS记录。“my website . com”DNS服务器返回指向mywebsite.trafficmanager.net的CName</li><li id="59a0" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm lw jt ju jv bi translated">递归DNS服务查找由Azure流量管理器服务提供的“trafficmanager.net”域的名称服务器。它向这些DNS服务器请求mywebsite.trafficmanager.net DNS记录</li><li id="ed1a" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm lw jt ju jv bi translated">流量管理器名称服务器接收请求，并根据每个端点的状态、每个端点的当前健康状况以及所选的流量路由方法来选择端点。</li><li id="4fd4" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm lw jt ju jv bi translated">返回选定的端点mywebsite-eu.cloudapp.net。</li><li id="613a" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm lw jt ju jv bi translated">递归DNS服务查找“cloudapp.net”域的名称服务器。它联系那些名称服务器以请求“my website-eu . cloud app . net”DNS记录，返回包含基于EU的服务端点的IP地址的记录。</li><li id="9681" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm lw jt ju jv bi translated">递归DNS服务合并结果，并向客户端返回单个DNS响应。</li><li id="40b5" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm lw jt ju jv bi translated">客户端接收DNS结果并连接到给定的IP地址。</li></ol></div></div>    
</body>
</html>