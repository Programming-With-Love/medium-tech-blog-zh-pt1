<html>
<head>
<title>Navigating with Deep Links</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用深层链接导航</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/navigating-with-deep-links-910a4a6588c?source=collection_archive---------0-----------------------#2020-10-21">https://medium.com/androiddevelopers/navigating-with-deep-links-910a4a6588c?source=collection_archive---------0-----------------------#2020-10-21</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/df057cee2217722997881dc9591e8025.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ro1bEG-392ym7JVa"/></div></div></figure><div class=""/><div class=""><h2 id="d827" class="pw-subtitle-paragraph ip hr hs bd b iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg dx translated">关于深层链接的深层思考…带有导航组件</h2></div><p id="a080" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">这是关于<a class="ae kd" href="https://developer.android.com/guide/navigation" rel="noopener ugc nofollow" target="_blank">导航组件</a> API和工具系列文章的第四篇。这些文章是基于视频形式解释的内容，作为<a class="ae kd" href="https://www.youtube.com/playlist?list=PLWz5rJ2EKKc91i2QT8qfrfKgLNlJiG1z7" rel="noopener ugc nofollow" target="_blank"> MAD Skills </a>系列的一部分，所以你可以随意以你喜欢的任何方式使用这些材料(尽管从文本中复制代码比从视频中复制代码更容易，这也是我们提供这个版本的原因)。</p><p id="7140" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">如果您更喜欢视频形式的内容，这里是:</p><figure class="ke kf kg kh fd hj"><div class="bz dy l di"><div class="ki kj l"/></div></figure><h1 id="b4f0" class="kk kl hs bd km kn ko kp kq kr ks kt ku iy kv iz kw jb kx jc ky je kz jf la lb bi translated">介绍</h1><p id="204b" class="pw-post-body-paragraph jh ji hs jj b jk lc it jm jn ld iw jp jq le js jt ju lf jw jx jy lg ka kb kc ha bi translated">这一集是关于<a class="ae kd" href="https://developer.android.com/guide/navigation/navigation-deep-link" rel="noopener ugc nofollow" target="_blank">深度链接</a>，导航组件提供的工具，用于帮助用户从应用程序外部的UI到达应用程序的更深部分。</p><p id="521f" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">有时你想让用户容易地到达你的应用程序流程中的某个特定部分，而不必从开始屏幕<em class="lh">点击-点击-点击</em>到达那里。例如，也许你想在一个聊天应用程序中显示正在进行的对话，或者在一个购物应用程序中显示用户的购物车。你可以使用深层链接来做到这一点，在应用程序之外，在快捷方式和通知中显示这些链接，允许用户从这些其他位置单击并到达应用程序的更深层部分。</p><p id="7c64" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">导航组件简化了这些深层链接的创建。为了展示它们是如何工作的，我们将再看看我在<a class="ae kd" rel="noopener" href="/androiddevelopers/navigation-component-dialog-destinations-bfeb8b022759">前几集</a>中使用的甜甜圈跟踪器应用程序。app的<a class="ae kd" href="https://github.com/android/architecture-components-samples/tree/main/MADSkillsNavigationSample" rel="noopener ugc nofollow" target="_blank">完成代码</a>在GitHub上；请随意下载并在Android Studio中打开它，以便继续学习。</p><p id="5fcf" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">由于代码已经完成，我将带您完成我所经历的步骤，以使它全部工作。</p><h1 id="83e4" class="kk kl hs bd km kn ko kp kq kr ks kt ku iy kv iz kw jb kx jc ky je kz jf la lb bi translated">圆环深度链接</h1><p id="74af" class="pw-post-body-paragraph jh ji hs jj b jk lc it jm jn ld iw jp jq le js jt ju lf jw jx jy lg ka kb kc ha bi translated">在甜甜圈追踪器中，有几个动作非常有用，可以快速进入。例如，如果我在野外有一个非常好的甜甜圈，我希望能够将该信息添加到列表中，而不必先启动应用程序，然后单击<code class="du li lj lk ll b">FloatingActionButton</code>来打开数据输入对话框。此外，如果我刚刚添加或编辑了一个甜甜圈的信息，我想发布一个通知，这样我就可以快速回到编辑最近的条目。</p><p id="c6e5" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">我为这两个操作添加了深层链接:一个用于添加新的甜甜圈，另一个用于返回正在进行的编辑。“添加”操作使用“隐式”深层链接。<em class="lh">隐性</em>是我们所说的链接，它把你带到你的层级结构中的一个静态位置，一个不会随着时间而改变的位置。在我的应用程序中，隐式深度链接将始终带您到允许您向列表添加新甜甜圈的表单。</p><p id="3a74" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">“继续编辑”动作使用“显式”深层链接。<em class="lh"> Explicit </em>就是我们所说的链接，它把你带到应用程序内部的动态内容。</p><h1 id="adf6" class="kk kl hs bd km kn ko kp kq kr ks kt ku iy kv iz kw jb kx jc ky je kz jf la lb bi translated">含蓄的</h1><p id="3a04" class="pw-post-body-paragraph jh ji hs jj b jk lc it jm jn ld iw jp jq le js jt ju lf jw jx jy lg ka kb kc ha bi translated">让我们从添加一个新的甜甜圈的隐式深度链接开始。</p><p id="9a6e" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">首先，我需要创建深层链接，这是我在导航编辑器中完成的。单击对话框目标会在右侧显示该目标的属性:</p><figure class="ke kf kg kh fd hj er es paragraph-image"><div class="er es lm"><img src="../Images/b15b097d3eae9075430a8ce0467f47d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1034/0*v3J2UKqStMfFdP4k"/></div><figcaption class="ln lo et er es lp lq bd b be z dx">Clicking on a destination shows its properties, which is where we can create a new deep link to navigate to that destination</figcaption></figure><p id="f36f" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">我点击了<strong class="jj ht">深度链接</strong>旁边的<strong class="jj ht"> + </strong>。这打开了一个对话框，我在其中输入了一个URI(统一资源标识符)。在这种情况下，我想要一个特定于应用程序的URI(而不是可能被浏览器应用程序获取的通用网址)，所以我使用“myapp”作为特定于我们的应用程序的标识符:</p><figure class="ke kf kg kh fd hj er es paragraph-image"><div class="er es lr"><img src="../Images/6e1206d30ae0a1ed33a3c6c67768cce3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/0*2hTGM-hLyhX1UDvs"/></div><figcaption class="ln lo et er es lp lq bd b be z dx">Creating a new deep link brings up a dialog where you enter a URL associated with the deep link to that destination</figcaption></figure><p id="9d51" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">接下来，我编辑了应用程序清单，通知应用程序我需要深层链接的快捷方式:</p><pre class="ke kf kg kh fd ls ll lt lu aw lv bi"><span id="1791" class="lw kl hs ll b fi lx ly l lz ma">&lt;activity<br/>    android:name="com.android.samples.donuttracker.MainActivity"<br/>    android:label="@string/app_name"<br/>    android:theme="@style/AppTheme.NoActionBar"&gt;<br/><strong class="ll ht">    &lt;nav-graph android:value="@navigation/nav_graph" /&gt;<br/></strong>    &lt;intent-filter&gt;<br/>        &lt;action android:name="android.intent.action.MAIN" /&gt;<br/>        &lt;category android:name="android.intent.category.LAUNCHER" /&gt;<br/>    &lt;/intent-filter&gt;<br/><strong class="ll ht">    &lt;meta-data android:name="android.app.shortcuts"<br/>        android:resource="@xml/shortcuts" /&gt;<br/></strong>&lt;/activity&gt;</span></pre><p id="b4df" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">在那个<code class="du li lj lk ll b">meta-data</code>块中，我告诉活动在导航图中有关于深层链接的信息。我还引用了<code class="du li lj lk ll b">xml </code>资源目录中的一个新文件，该文件包含关于此活动的应用程序快捷方式的信息。</p><p id="ed56" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">然后我创建了<code class="du li lj lk ll b">xml</code>文件夹，并在这个新目录下创建了一个新的<code class="du li lj lk ll b">shortcuts.xml</code>文件。在快捷方式文件中，我输入了关于应用程序快捷方式的信息，包括我们上面看到的URI:</p><pre class="ke kf kg kh fd ls ll lt lu aw lv bi"><span id="320c" class="lw kl hs ll b fi lx ly l lz ma">&lt;shortcuts<br/>    xmlns:android="http://schemas.android.com/apk/res/android"&gt;<br/>  &lt;shortcut<br/>    android:shortcutId="NewDonutDialogFragment"<br/>    android:enabled="true"<br/>    android:shortcutShortLabel="@string/static_shortcut_label_short"<br/>    android:shortcutLongLabel="@string/static_shortcut_label_long"<br/>    android:shortcutDisabledMessage=<br/>        "@string/static_shortcut_disabled_message"<br/>    android:icon="@drawable/donut_with_sprinkles"&gt;<br/>    &lt;intent<br/>       android:action="android.intent.action.VIEW"<br/><strong class="ll ht">       android:data="myapp://navdonutcreator.com/donutcreator" /&gt;<br/></strong>  &lt;/shortcut&gt;<br/>&lt;/shortcuts&gt;</span></pre><p id="8934" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">这里重要的部分是数据项，它使用了与我之前在导航工具的深层链接对话框中输入的相同的URI字符串。这是连接胶水，导致导航发生从应用程序快捷方式到对话目的地。</p><p id="4e04" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">这就是隐式深度链接所需要的:我告诉它要导航到的目的地，创建完成导航的快捷方式，然后我就完成了。如果你运行应用程序，你可以通过长按应用程序图标看到快捷方式。单击该快捷方式会将您带到创建新的甜甜圈项目的表单。</p><p id="aace" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">那是隐含的深层联系。现在让我们创建一个显式的深度链接，它将根据应用程序的状态动态创建。</p><h1 id="890c" class="kk kl hs bd km kn ko kp kq kr ks kt ku iy kv iz kw jb kx jc ky je kz jf la lb bi translated">明确的</h1><p id="e85a" class="pw-post-body-paragraph jh ji hs jj b jk lc it jm jn ld iw jp jq le js jt ju lf jw jx jy lg ka kb kc ha bi translated">如果你像我一样，那么甜甜圈对你来说真的很重要。当我输入一个新发现的甜甜圈的信息时，我可能想慢慢来。因此，我将用一些信息开始这个条目，但我可能希望以后回来，当我真正有机会欣赏这个经历时，输入更多的信息。</p><p id="8fd4" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">这可以通过通知来实现:当我输入一个甜甜圈的信息时，应用程序会创建一个通知，让我更容易回到正在进行的输入。这样做并不需要很多代码；我只需要创建一个带有<code class="du li lj lk ll b">PendingIntent</code>的通知来到达应用程序中的正确位置。</p><p id="64e9" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">这大部分发生在<code class="du li lj lk ll b">DonutEntryDialogFragment</code>中，在<strong class="jj ht">完成</strong>按钮的<code class="du li lj lk ll b">onClick()</code>监听器中。我们在上一集已经看到了这个点击监听器代码；这是我们向视图模型添加新数据或更新数据的地方。我只需要在这里添加一个额外的步骤来创建通知。<strong class="jj ht">粗体</strong>部分是我为处理通知而添加的代码。</p><pre class="ke kf kg kh fd ls ll lt lu aw lv bi"><span id="c3f3" class="lw kl hs ll b fi lx ly l lz ma">binding.doneButton.setOnClickListener {<br/>    <strong class="ll ht"><em class="lh">// Grab these now since Fragment may go away before the<br/>    // lambda below is called<br/>    </em>val context = requireContext().<em class="lh">applicationContext<br/>    </em>val navController = <em class="lh">findNavController</em>()<br/></strong><br/>    donutEntryViewModel.addData(<br/>        donut?.id ?: 0,<br/>        binding.name.<em class="lh">text</em>.toString(),<br/>        binding.description.<em class="lh">text</em>.toString(),<br/>        binding.ratingBar.<em class="lh">rating</em>.toInt()<br/>    ) <strong class="ll ht">{ actualId -&gt;<br/>        val arg = DonutEntryDialogFragmentArgs(actualId).toBundle()<br/>        val pendingIntent = navController<br/>            .createDeepLink()<br/>            .setDestination(R.id.<em class="lh">donutEntryDialogFragment</em>)<br/>            .setArguments(arg)<br/>            .createPendingIntent()<br/><br/>        Notifier.postNotification(actualId, context, pendingIntent)<br/>    }</strong><br/>    dismiss()<br/>}</span></pre><p id="7f78" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">首先，代码用要使用的甜甜圈id创建<code class="du li lj lk ll b">arg</code>。这将用于告诉目标对话框检索哪个甜甜圈，用户将继续编辑。</p><p id="a829" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">然后代码使用<code class="du li lj lk ll b">NavigationController</code>中的API为深层链接创建<code class="du li lj lk ll b">pendingIntent</code>。目的地被设置为这个对话片段。该调用还设置保存ID和创建意图的参数。</p><p id="6e7c" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">然后代码调用<code class="du li lj lk ll b">Notifer.postNotification()</code>，这是我创建的一个实用类/方法，用于处理创建和发布通知的细节。</p><pre class="ke kf kg kh fd ls ll lt lu aw lv bi"><span id="6473" class="lw kl hs ll b fi lx ly l lz ma">fun postNotification(id: Long, <br/>                     context: Context, <br/>                     intent: PendingIntent) {<br/>    val builder = NotificationCompat.Builder(context, channelId)<br/>    builder.setContentTitle(context<br/>            .getString(R.string.<em class="lh">deepLinkNotificationTitle</em>))<br/>        .setSmallIcon(R.drawable.<em class="lh">donut_with_sprinkles</em>)<br/>    val text = context.getString(R.string.<em class="lh">addDonutInfo</em>)<br/>    val notification = builder.setContentText(text)<br/>        .setPriority(NotificationCompat.<em class="lh">PRIORITY_HIGH</em>)<br/>        .setContentIntent(intent)<br/>        .setAutoCancel(true)<br/>        .build()<br/>    val notificationManager =<br/>        NotificationManagerCompat.from(context)<br/>    notificationManager.cancelAll()<br/>    notificationManager.notify(id.toInt(), notification)<br/>}</span></pre><p id="8680" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">首先，代码创建通知构建器。注意，它需要一个<code class="du li lj lk ll b">channelId</code>来构建构建器，这个构建器是根据需要在<code class="du li lj lk ll b">Notifier</code>的<code class="du li lj lk ll b">init()</code>函数中创建的(详见代码；是标准的东西)。</p><p id="63e6" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">然后，我为通知提供必要的数据，设置<code class="du li lj lk ll b">intent</code>，并构建它。在发布之前，现有的通知被取消(我只想能够编辑最新的甜甜圈)。</p><p id="cd9c" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">最后，新的通知被发布……完成了。现在，每一个新的编辑操作(无论是新的甜甜圈还是现有的甜甜圈)都将显示一个通知，用户可以单击该通知返回到编辑操作。</p><h1 id="3d05" class="kk kl hs bd km kn ko kp kq kr ks kt ku iy kv iz kw jb kx jc ky je kz jf la lb bi translated">摘要</h1><p id="1987" class="pw-post-body-paragraph jh ji hs jj b jk lc it jm jn ld iw jp jq le js jt ju lf jw jx jy lg ka kb kc ha bi translated">在这一集中，我创建了一个<strong class="jj ht">隐式</strong>深度链接，它将用户带到应用程序中的一个静态位置，在那里他们可以输入关于一个新甜甜圈的信息，还创建了一个<strong class="jj ht">显式</strong>深度链接，它允许用户在他们离开的地方继续编辑现有的甜甜圈。</p><p id="78d7" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">这个甜甜圈追踪器应用程序越来越好了。当然，没有甜甜圈好吃…但是也没有什么比得上。</p><p id="b9b9" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">这次到此为止。去拿个甜甜圈吧——这是你应得的。</p><h1 id="4f38" class="kk kl hs bd km kn ko kp kq kr ks kt ku iy kv iz kw jb kx jc ky je kz jf la lb bi translated">了解更多信息</h1><p id="f357" class="pw-post-body-paragraph jh ji hs jj b jk lc it jm jn ld iw jp jq le js jt ju lf jw jx jy lg ka kb kc ha bi translated">有关导航组件的更多详细信息，请查看指南<a class="ae kd" href="https://developer.android.com/guide/navigation/navigation-getting-started" rel="noopener ugc nofollow" target="_blank">开始使用developer.android.com上的导航组件</a>。</p><p id="0cf8" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">要查看完成的甜甜圈跟踪器应用程序(它包含上面概述的代码，但也包含未来剧集中涉及的代码)，请查看<a class="ae kd" href="https://github.com/android/architecture-components-samples/tree/main/MADSkillsNavigationSample" rel="noopener ugc nofollow" target="_blank"> GitHub示例</a>。</p><p id="a423" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">最后，要查看MAD Skills系列的其他内容，请查看YouTube上Android开发者频道的<a class="ae kd" href="https://www.youtube.com/playlist?list=PLWz5rJ2EKKc91i2QT8qfrfKgLNlJiG1z7" rel="noopener ugc nofollow" target="_blank">视频播放列表</a>。</p></div></div>    
</body>
</html>