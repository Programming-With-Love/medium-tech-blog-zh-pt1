<html>
<head>
<title>The power of Chrome Devtools Protocol — Part IV</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Chrome Devtools协议的力量——第四部分</h1>
<blockquote>原文：<a href="https://medium.com/globant/the-power-of-chrome-devtools-protocol-d4711a1db53d?source=collection_archive---------0-----------------------#2022-11-01">https://medium.com/globant/the-power-of-chrome-devtools-protocol-d4711a1db53d?source=collection_archive---------0-----------------------#2022-11-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="9e71" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第四部分—绩效领域</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jc"><img src="../Images/3006acba5c2df8cbfe1ba22c48f04099.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*xjQcB4YVt40p68vI"/></div></figure><p id="5413" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在<a class="ae jk" rel="noopener" href="/globant/the-power-of-chrome-devtools-protocol-f4b1bcd4fb34">上一篇文章</a>中，我们介绍了使用<a class="ae jk" href="https://chromedevtools.github.io/devtools-protocol/" rel="noopener ugc nofollow" target="_blank"> CDP </a>的<a class="ae jk" href="https://chromedevtools.github.io/devtools-protocol/tot/Runtime/" rel="noopener ugc nofollow" target="_blank">运行时</a>域的强大特性，以及如何在Selenium测试中实现它。在本文中，我们将讨论<a class="ae jk" href="https://chromedevtools.github.io/devtools-protocol/tot/Performance/" rel="noopener ugc nofollow" target="_blank">性能</a>领域，以及我们如何在测试运行期间从页面中获取性能指标。</p><p id="44b4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你可以在https://github.com/germanbisogno/cdp-utils找到完整的代码。让我们投入进去吧！</p><h1 id="4ac3" class="jl jm hh bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">使用性能域</h1><p id="6437" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated"><a class="ae jk" href="https://chromedevtools.github.io/devtools-protocol/tot/Performance/" rel="noopener ugc nofollow" target="_blank">性能</a>域的主要目的是从页面中获取指标。我们将关注于<code class="du ko kp kq kr b">getMetrics</code>方法，它将允许我们在测试执行期间提取运行时指标。</p><p id="cb99" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请在下面找到一些可以通过这个API使用的基准；如果你需要更多关于度量的信息，你可以查看木偶师文档<a class="ae jk" href="https://github.com/puppeteer/puppeteer/blob/main/docs/api/puppeteer.page.metrics.md" rel="noopener ugc nofollow" target="_blank">这里</a>:</p><ul class=""><li id="c0e3" class="ks kt hh ig b ih ii il im ip ku it kv ix kw jb kx ky kz la bi translated"><code class="du ko kp kq kr b">Timestamp</code>:获取度量样本时的时间戳。</li><li id="19c3" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated"><code class="du ko kp kq kr b">Documents</code>:页面上的文件数量。</li><li id="29c7" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated"><code class="du ko kp kq kr b">Frames</code>:页面的帧数。</li><li id="1cac" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated"><code class="du ko kp kq kr b">JSEventListeners</code>:页面上事件的数量。</li><li id="58df" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated"><code class="du ko kp kq kr b">Nodes</code>:页面上DOM节点的数量。</li><li id="73ad" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated"><code class="du ko kp kq kr b">LayoutCount</code>:全部或部分页面布局的总数。</li><li id="1597" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated"><code class="du ko kp kq kr b">RecalcStyleCount</code>:页面样式重新计算的总数。</li><li id="7c15" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated"><code class="du ko kp kq kr b">LayoutDuration</code>:所有页面布局的组合持续时间。</li><li id="69c2" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated"><code class="du ko kp kq kr b">RecalcStyleDuration</code>:所有页面样式重新计算的总持续时间。</li><li id="aaaf" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated"><code class="du ko kp kq kr b">ScriptDuration</code>:JavaScript执行的组合持续时间。</li><li id="47a7" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated"><code class="du ko kp kq kr b">TaskDuration</code>:浏览器执行的所有任务的总时长。</li><li id="4b37" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated"><code class="du ko kp kq kr b">JSHeapUsedSize</code>:使用的JavaScript堆大小。</li><li id="2795" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated"><code class="du ko kp kq kr b">JSHeapTotalSize</code>:总的JavaScript堆大小。</li></ul><p id="9550" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你想获得其他web重要KPI，如<a class="ae jk" href="https://web.dev/lighthouse-largest-contentful-paint/" rel="noopener ugc nofollow" target="_blank"> LCP </a>(最大内容油漆)<a class="ae jk" href="https://web.dev/cls/?gclid=Cj0KCQjwteOaBhDuARIsADBqRejyKA3K3vtbIbyFeUeclXYShlDEOk4jeGOqgkJ548C8nVdsMdPinlkaAjCbEALw_wcB" rel="noopener ugc nofollow" target="_blank"> CLS </a>(累计布局移位)或<a class="ae jk" href="https://web.dev/lighthouse-total-blocking-time/" rel="noopener ugc nofollow" target="_blank"> TBT </a>(总阻塞时间)，你可以使用Google <a class="ae jk" href="https://github.com/GoogleChrome/lighthouse" rel="noopener ugc nofollow" target="_blank"> Lighthouse </a>，本文不做介绍。</p><h1 id="5c51" class="jl jm hh bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">我们如何实现自动化？</h1><p id="6e78" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">让我们实现一个用Typescript编写的类<code class="du ko kp kq kr b">Performance</code>，我们将从<code class="du ko kp kq kr b">TraceOperations</code>再次扩展它，就像在以前的文章中一样。上一篇<a class="ae jk" rel="noopener" href="/globant/the-power-of-chrome-devtools-protocol-cbb2c47f1c29">文章</a>中使用的所有npm依赖项都是必需的。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lg lh l"/></div></figure><p id="cb55" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在最后一个类示例中，我们使用了<code class="du ko kp kq kr b">Performance.enable</code>来收集和报告指标，使用<code class="du ko kp kq kr b">Performance.disable</code>来禁用和停止。此外，我们添加了<code class="du ko kp kq kr b">getMetrics</code>方法来获取测试中返回的指标，或者将它们存储在一个文件中。</p><p id="9060" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意<code class="du ko kp kq kr b">Protocol.Performance.GetMetricsResponse</code>是包含我们将在<code class="du ko kp kq kr b">getMetrics</code>方法中返回的指标的对象。看看这个物体的样子:</p><pre class="jd je jf jg fd li kr lj lk aw ll bi"><span id="0082" class="lm jm hh kr b fi ln lo l lp lq">export interface GetMetricsResponse {<br/> /**        <br/>  * Current values for run-time metrics.             <br/>  */ <br/>  metrics: Metric[];        <br/>}</span></pre><p id="18b6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">那么，<code class="du ko kp kq kr b">Metric</code>接口的格式如下:</p><pre class="jd je jf jg fd li kr lj lk aw ll bi"><span id="68b6" class="lm jm hh kr b fi ln lo l lp lq">/**<br/>* Run-time execution metric.<br/>*/</span><span id="3b3b" class="lm jm hh kr b fi lr lo l lp lq">export interface Metric {<br/>  /**<br/>  * Metric name.<br/>  */<br/>  name: string;</span><span id="334c" class="lm jm hh kr b fi lr lo l lp lq">  /**<br/>  * Metric value.<br/>  */<br/>  value: number;<br/>}</span></pre><p id="bd71" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有关此协议的类型脚本定义的更多信息，请查看<a class="ae jk" href="https://github.com/ChromeDevTools/devtools-protocol/tree/master/types" rel="noopener ugc nofollow" target="_blank">‘类型/协议. d . ts’</a></p><h1 id="6f87" class="jl jm hh bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">开发一个测试！</h1><p id="f84d" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">现在让我们编写一个测试，它将使用性能域并在用户操作中获取性能指标。<code class="du ko kp kq kr b">startTrace</code>和<code class="du ko kp kq kr b">stopTrace</code>方法再次发挥作用。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lg lh l"/></div></figure><p id="10c2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，这个测试将输出两个文件，startTrace.json和endTrace.json:前者在跟踪开始时记录指标，后者在跟踪结束时记录指标。运行测试后，您将拥有两个文件，其内容类似于以下内容:</p><pre class="jd je jf jg fd li kr lj lk aw ll bi"><span id="4ee0" class="lm jm hh kr b fi ln lo l lp lq">{ metrics:<br/>[ { name: ‘Timestamp’, value: 1760243.235006 },<br/>  { name: ‘AudioHandlers’, value: 3 },<br/>  { name: ‘Documents’, value: 9 },<br/>  { name: ‘Frames’, value: 4 },<br/>  { name: ‘JSEventListeners’, value: 1455 },<br/>  { name: ‘LayoutObjects’, value: 1745 },<br/>  { name: ‘MediaKeySessions’, value: 0 },<br/>  { name: ‘MediaKeys’, value: 0 },<br/>  { name: ‘Nodes’, value: 2778 },<br/>  { name: ‘Resources’, value: 56 },<br/>  { name: ‘ContextLifecycleStateObservers’, value: 17 },<br/>  { name: ‘V8PerContextDatas’, value: 3 },<br/>  { name: ‘WorkerGlobalScopes’, value: 0 },<br/>  { name: ‘UACSSResources’, value: 0 },<br/>  { name: ‘RTCPeerConnections’, value: 0 },<br/>  { name: ‘ResourceFetchers’, value: 9 },<br/>  { name: ‘AdSubframes’, value: 0 },<br/>  { name: ‘DetachedScriptStates’, value: 1 },<br/>  { name: ‘ArrayBufferContents’, value: 42 },<br/>  { name: ‘LayoutCount’, value: 37 },<br/>  { name: ‘RecalcStyleCount’, value: 115 },<br/>  { name: ‘LayoutDuration’, value: 0.25534 },<br/>  { name: ‘RecalcStyleDuration’, value: 0.092492 },<br/>  { name: ‘DevToolsCommandDuration’, value: 0.14261 },<br/>  { name: ‘ScriptDuration’, value: 0.839995 },<br/>  { name: ‘V8CompileDuration’, value: 0.063373 },<br/>  { name: ‘TaskDuration’, value: 2.691882 },<br/>  { name: ‘TaskOtherDuration’, value: 1.298072 },<br/>  { name: ‘ThreadTime’, value: 1.760892 },<br/>  { name: ‘ProcessTime’, value: 2.734375 },<br/>  { name: ‘JSHeapUsedSize’, value: 17165052 },<br/>  { name: ‘JSHeapTotalSize’, value: 34803712 },<br/>  { name: ‘FirstMeaningfulPaint’, value: 0 },<br/>  { name: ‘DomContentLoaded’, value: 1760241.873843 },<br/>  { name: ‘NavigationStart’, value: 1760241.082286 } ]<br/>}</span></pre><p id="8138" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有了这些信息，您可以在测试自动化过程中的任何时刻比较性能的状态。</p><p id="7bad" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有了这些指标，你就可以测量你的测试步骤的持续时间，比如用<code class="du ko kp kq kr b">TimeStamp</code>来获取初始和结束时间，或者用<code class="du ko kp kq kr b">JSHeapUsedSize</code>来表示JavaScript的内存使用情况，或者评估任何其他指标来确保你的应用程序的预期性能。</p><h1 id="047d" class="jl jm hh bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">结论</h1><p id="ffe8" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">我们讨论了性能领域及其一些不同的特性。这个域将有助于评估来自页面的指标，并使用这个API返回的基准值在您的测试自动化中执行必要的断言。</p><p id="508c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，我们完成了关于CDP及其强大功能的四篇文章。我们已经介绍了<a class="ae jk" rel="noopener" href="/globant/the-power-of-chrome-devtools-protocol-cbb2c47f1c29">跟踪</a>、<a class="ae jk" rel="noopener" href="/globant/the-power-of-chrome-devtools-protocol-part-ii-3fb8239785db">网络</a>、<a class="ae jk" rel="noopener" href="/globant/the-power-of-chrome-devtools-protocol-f4b1bcd4fb34">运行时</a>和性能域。</p><p id="e072" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我邀请您自己探索更多的领域，并发现这个协议在您的测试自动化中是多么有用！</p><p id="4dd9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我希望你喜欢这次旅行！下次见！</p><p id="b1a4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">感谢阅读！</strong></p></div></div>    
</body>
</html>