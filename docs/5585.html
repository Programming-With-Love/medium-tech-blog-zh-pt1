<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://medium.com/oracledevs/you-take-the-high-road-and-ill-take-the-unload-f93742dc4f52?source=collection_archive---------0-----------------------#2019-03-10">https://medium.com/oracledevs/you-take-the-high-road-and-ill-take-the-unload-f93742dc4f52?source=collection_archive---------0-----------------------#2019-03-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><h2 id="1f52" class="hf hg hh bd hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id bi translated">你走大路，我去卸货</h2><p id="ef09" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io hr ip iq ir hv is it iu hz iv iw ix iy ha bi translated">有时你需要选择人迹罕至的捷径。</p><p id="e6bd" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">简单大容量装载的一个示例是Create Table As Select (CTAS)命令，如下所示:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="fbba" class="hf hg hh jk b fi jo jp l jq jr">CREATE TABLE &amp;tbl_1<br/>AS<br/>SELECT * FROM &amp;tbl_2;</span></pre><p id="6dc5" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">但是，简单的大容量装载对于以下两种情况都不是最佳选择:</p><ul class=""><li id="c7d5" class="js jt hh ig b ih ja il jb hr ju hv jv hz jw iy jx jy jz ka bi translated">将应用程序迁移到另一个数据库。</li><li id="dc75" class="js jt hh ig b ih kb il kc hr kd hv ke hz kf iy jx jy jz ka bi translated">将新功能迁移到另一个数据库中的应用程序。</li></ul><p id="1e6b" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">相反，datapump导出和导入实用程序是迁移整个模式或者只是几个表和索引的绝佳选择。</p><p id="5600" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">使用datapump导出，数据被卸载到转储文件集，然后datapump导入使用传统路径或直接路径将数据加载到目标数据库。</p><p id="15b6" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">直接路径提供了用无效重做记录替换传统重做记录的能力。无效重做记录将一系列块标记为逻辑损坏，但减少了加载开销，从而提高了插入性能。</p><p id="fc18" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">生成无效重做记录的直接路径加载的性能取决于许多因素。</p><p id="593d" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">但是，使用生成无效重做记录的直接路径加载可以获得哪些性能优势呢？</p><h1 id="16c6" class="kg hg hh bd hi kh ki kj hm kk kl km hq kn ko kp hu kq kr ks hy kt ku kv ic kw bi translated">初始设置</h1><p id="0143" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io hr ip iq ir hv is it iu hz iv iw ix iy ha bi translated">在评估负载的性能之前，我们首先需要datapump导出来卸载数据，以创建一个转储文件集。</p><p id="b104" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">创建转储文件集非常简单，如下所示:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="5209" class="hf hg hh jk b fi jo jp l jq jr">&gt; expdp system parfile=d:\exportdp.table.index.par</span></pre><p id="f209" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">一旦转储文件集完成，就有一个先决条件配置来确保直接路径加载可以生成无效重做记录。</p><p id="bc63" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">要生成无效重做记录，需要在数据库级别禁用强制日志记录配置。</p><p id="ddca" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">禁用重做记录的强制日志记录按如下方式执行:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="06de" class="hf hg hh jk b fi jo jp l jq jr">ALTER DATABASE NO FORCE LOGGING;</span><span id="cb77" class="hf hg hh jk b fi kx jp l jq jr">Database altered.</span><span id="b4fb" class="hf hg hh jk b fi kx jp l jq jr">SQL&gt;<br/></span><span id="6ea4" class="hf hg hh jk b fi kx jp l jq jr">SELECT force_logging FROM v$database;</span><span id="8f83" class="hf hg hh jk b fi kx jp l jq jr">FORCE_LOGGING<br/>——————————---<br/>NO</span><span id="324a" class="hf hg hh jk b fi kx jp l jq jr">SQL&gt;</span></pre><p id="33aa" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">现在，强制日志记录已被禁用，我们有机会最大限度地提高负载性能。</p><h1 id="de55" class="kg hg hh bd hi kh ki kj hm kk kl km hq kn ko kp hu kq kr ks hy kt ku kv ic kw bi translated">直接路径负载</h1><p id="ea9a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io hr ip iq ir hv is it iu hz iv iw ix iy ha bi translated">以下datapump import语句使用直接路径作为默认访问方法:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="c00e" class="hf hg hh jk b fi jo jp l jq jr">&gt; impdp system parfile=d:\importdp.par</span></pre><p id="9659" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">数据泵导入的日志文件头如下:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="6c5c" class="hf hg hh jk b fi jo jp l jq jr">Import: Release 12.2.0.1.0 — Production on Sun Oct 21 01:40:24 2018</span><span id="bc4c" class="hf hg hh jk b fi kx jp l jq jr">Copyright © 1982, 2018, Oracle and/or its affiliates. All rights reserved.<br/>Password:</span><span id="e334" class="hf hg hh jk b fi kx jp l jq jr">Connected to: Oracle Database 12c Enterprise Edition Release 12.2.0.1.0–64bit Production<br/>Database Directory Object has defaulted to: “DATA_PUMP_DIR”.<br/>Master table “SYSTEM”.”IMPDP” successfully loaded/unloaded<br/>Starting “SYSTEM”.”IMPDP”: system/******** parfile=d:importdp.par<br/>Processing object type SCHEMA_EXPORT/USER<br/>..</span></pre><p id="cdd9" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">现在使用ctrl+c从命令行模式切换到交互模式，然后退出交互模式:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="99a3" class="hf hg hh jk b fi jo jp l jq jr">Export&gt; exit_client</span></pre><p id="ba9f" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">数据泵导入将继续在后台加载。</p><p id="9a18" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">从SQLPLUS客户端，通过查询事务统计信息，很容易证明负载的访问方法是直接路径:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="c249" class="hf hg hh jk b fi jo jp l jq jr">col name format a40<br/>SELECT name, status, noundo, used_ublk, log_io, phy_io<br/>FROM v$transaction;</span><span id="2087" class="hf hg hh jk b fi kx jp l jq jr">NAME                           STATUS NOU USED_UBLK LOG_IO PHY_IO<br/>—————————————————------------- ------ --- --------- ------ ------<br/>                               ACTIVE NO          1  13103  12990</span><span id="cdb9" class="hf hg hh jk b fi kx jp l jq jr">SQL&gt; /</span><span id="cffb" class="hf hg hh jk b fi kx jp l jq jr">NAME                           STATUS NOU USED_UBLK LOG_IO PHY_IO<br/>—————————————————------------- ------ --- --------- ------ ------<br/>                               ACTIVE NO          1  40640  40398</span><span id="71c9" class="hf hg hh jk b fi kx jp l jq jr">SQL&gt; /</span><span id="2beb" class="hf hg hh jk b fi kx jp l jq jr">NAME                           STATUS NOU USED_UBLK LOG_IO PHY_IO<br/>—————————————————------------- ------ --- --------- ------ ------ <br/>                               ACTIVE NO          1  64784  64258</span><span id="d322" class="hf hg hh jk b fi kx jp l jq jr">SQL&gt;</span></pre><p id="4110" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">该事务有几千个I/O，但很少使用撤销块，这种行为与直接路径访问方法一致。</p><p id="5241" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">强制日志记录先前已被禁用，但由于被迁移的对象仍处于日志记录模式，我们预计直接路径加载会生成正常的重做记录:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="e234" class="hf hg hh jk b fi jo jp l jq jr">col name format a30<br/>SELECT sid, name, TRUNC(value/1024/1024,1) "MB"<br/>FROM v$sesstat ss<br/>INNER JOIN v$statname sn<br/>ON (ss.statistic# = sn.statistic#)<br/>WHERE name IN ('redo size for direct writes', —- direct path only<br/>               'redo size') -— conventional plus direct path<br/>  AND sid IN (SELECT sid<br/>              FROM v$session<br/>              WHERE program='impdp.exe' or module like 'Data Pump%')<br/>ORDER BY sid, name;</span><span id="a32e" class="hf hg hh jk b fi kx jp l jq jr">SID NAME                             MB<br/>—-— -—-—-—---------------—------ ------<br/> 20 redo size                        .3<br/> 20 redo size for direct writes      .1<br/> 23 redo size                        .8<br/> 23 redo size for direct writes       0<br/>151 redo size                     244.1<br/>151 redo size for direct writes   242.2</span><span id="ec28" class="hf hg hh jk b fi kx jp l jq jr">SQL&gt; /</span><span id="00e0" class="hf hg hh jk b fi kx jp l jq jr">SID NAME                             MB<br/>—-— ———————————----------------- ------<br/> 20 redo size                        .3<br/> 20 redo size for direct writes      .1<br/> 23 redo size                        .8<br/> 23 redo size for direct writes       0<br/>151 redo size                    1143.1<br/>151 redo size for direct writes  1141.1</span><span id="2b08" class="hf hg hh jk b fi kx jp l jq jr">SQL&gt; /</span><span id="53f9" class="hf hg hh jk b fi kx jp l jq jr">SID NAME                             MB<br/>--— —---------------—-—————————- ------<br/> 20 redo size                        .4<br/> 20 redo size for direct writes      .1<br/> 23 redo size                        .8<br/> 23 redo size for direct writes       0<br/>151 redo size                    1618.5<br/>151 redo size for direct writes  1616.1</span><span id="a9f2" class="hf hg hh jk b fi kx jp l jq jr">SQL&gt;</span></pre><p id="c208" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">会话统计数据显示,“直接写入的重做大小”正在稳步增加，这表明正在为直接路径负载创建正常的重做记录。</p><p id="8157" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">对于许多重做记录的生成，我们期望在线重做日志的许多切换:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="11f3" class="hf hg hh jk b fi jo jp l jq jr">-— recent activity of the online redo logs<br/>col 1st_time format a15<br/>SELECT SEQUENCE#,<br/>  (sysdate-FIRST_TIME) day(1) to second (0) "1st_time",<br/>  FIRST_CHANGE#,<br/>  NEXT_CHANGE#<br/>FROM v$log_history<br/>WHERE NUMTODSINTERVAL(sysdate-first_time,'DAY')<br/>  &lt; NUMTODSINTERVAL(20,'MINUTE');</span><span id="d087" class="hf hg hh jk b fi kx jp l jq jr">SEQUENCE# 1st_time    FIRST_CHANGE# NEXT_CHANGE#<br/>————————— —————------ ------------- ------------<br/>      779 +0 00:20:01       7718053      7718210<br/>      780 +0 00:19:06       7718210      7718366<br/>      781 +0 00:18:14       7718366      7718552<br/>      782 +0 00:17:40       7718552      7718726<br/>      783 +0 00:17:02       7718726      7718882<br/>      784 +0 00:16:27       7718882      7719653<br/>      785 +0 00:15:27       7719653      7719870<br/>      786 +0 00:14:23       7719870      7720156</span><span id="7e26" class="hf hg hh jk b fi kx jp l jq jr">SQL&gt;</span></pre><p id="2e13" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">在直接路径加载期间，在线重做日志有许多切换，原因是因为创建的对象处于日志记录模式。</p><p id="6a3c" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">SQL Developer客户机还可以通过DBA菜单的实例查看器显示重做记录的生成和撤消利用情况。</p><figure class="jf jg jh ji fd kz er es paragraph-image"><div class="er es ky"><img src="../Images/865f347beef9b517f9f89d65606bdf63.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*7abC-hKZ1aKahBZIk5jhFg.jpeg"/></div></figure><p id="9f8b" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">显示屏的右上角显示撤消利用率仅为2.8%，很低。左下角显示了高达5.5 MB/秒的重做记录生成速率。</p><p id="58b9" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">直接路径加载完成后，如果创建了任何无效重做记录，它们将被记录:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="377d" class="hf hg hh jk b fi jo jp l jq jr">SELECT UNRECOVERABLE_CHANGE#,<br/>  TO_CHAR(UNRECOVERABLE_TIME, 'Dy ddMonyyyy hh24:mi:ss') timestamp<br/>FROM V$DATAFILE<br/>WHERE UNRECOVERABLE_CHANGE# &gt; 0<br/>  AND ts# IN (SELECT ts# FROM v$tablespace<br/>              WHERE name=UPPER('&amp;tblspc'))<br/>  AND NUMTODSINTERVAL(sysdate-UNRECOVERABLE_TIME,'DAY')<br/>    &lt; NUMTODSINTERVAL(20,'MINUTE');</span><span id="984b" class="hf hg hh jk b fi kx jp l jq jr">no rows selected</span><span id="ec1f" class="hf hg hh jk b fi kx jp l jq jr">SQL&gt;</span></pre><p id="710b" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">因此，肯定会生成正常的重做记录，而不是无效的重做记录。</p><p id="8d67" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">datapump导入的日志文件的尾部也将显示datapump导入的基准性能:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="da5b" class="hf hg hh jk b fi jo jp l jq jr">..<br/>Processing object type SCHEMA_EXPORT/TABLE/INDEX/INDEX<br/>Job “SYSTEM”.”IMPDP” completed with 0 error(s) at Sun Oct 21 23:32:03 2018 elapsed 0 00:08:13</span></pre><p id="a1a3" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">因此，datapump导入用了8分钟进行直接路径加载，并生成了正常的重做记录。</p><h1 id="fcbe" class="kg hg hh bd hi kh ki kj hm kk kl km hq kn ko kp hu kq kr ks hy kt ku kv ic kw bi translated">使用TRANSFORM子句的直接路径加载</h1><p id="d7e6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io hr ip iq ir hv is it iu hz iv iw ix iy ha bi translated">Oracle 12c新增了生成无效重做记录的能力，即使加载的所有对象都处于日志记录模式。</p><p id="dd81" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">要生成失效重做记录，需要指定带有DISABLE_ARCHIVE_LOGGING:Y的TRANSFORM子句。</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="ece6" class="hf hg hh jk b fi jo jp l jq jr">&gt; impdp system transform=disable_archive_logging:y parfile=d:\importdp.par</span></pre><p id="87ff" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">值DISABLE_ARCHIVE_LOGGING:Y表示为装载中的所有表和索引生成无效重做记录。</p><p id="2ce5" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">数据泵导入的日志文件头如下:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="02fe" class="hf hg hh jk b fi jo jp l jq jr">Import: Release 12.2.0.1.0 — Production on Mon Oct 22 00:11:26 2018</span><span id="9adc" class="hf hg hh jk b fi kx jp l jq jr">Copyright © 1982, 2018, Oracle and/or its affiliates. All rights reserved.<br/>Password:</span><span id="5be6" class="hf hg hh jk b fi kx jp l jq jr">Connected to: Oracle Database 12c Enterprise Edition Release 12.2.0.1.0–64bit Production<br/>Database Directory Object has defaulted to: “DATA_PUMP_DIR”.<br/>Master table “SYSTEM”.”IMPDP” successfully loaded/unloaded<br/>Starting “SYSTEM”.”IMPDP”: system/******** transform=disable_archive_logging:y parfile=d:importdp.par<br/>Processing object type SCHEMA_EXPORT/USER<br/>..</span></pre><p id="89ff" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">现在使用ctrl+c从命令行模式切换到交互模式，然后退出交互模式:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="8c6c" class="hf hg hh jk b fi jo jp l jq jr">Export&gt; exit_client</span></pre><p id="6d32" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">数据泵导入将继续在后台加载。</p><p id="f70b" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">从SQLPLUS客户端，通过查询事务统计信息，很容易证明负载的访问方法是直接路径:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="bf69" class="hf hg hh jk b fi jo jp l jq jr">col name format a40<br/>SELECT name, status, noundo, used_ublk, log_io, phy_io<br/>FROM v$transaction;</span><span id="e4f8" class="hf hg hh jk b fi kx jp l jq jr">NAME                           STATUS NOU USED_UBLK LOG_IO PHY_IO<br/>—————————————————------------- ------ --- --------- ------ ------<br/>                               ACTIVE NO          1     61  75269</span><span id="1f36" class="hf hg hh jk b fi kx jp l jq jr">SQL&gt; /</span><span id="bfb0" class="hf hg hh jk b fi kx jp l jq jr">NAME                           STATUS NOU USED_UBLK LOG_IO PHY_IO<br/>—————————————————------------- ------ --- --------- ------ ------<br/>                               ACTIVE NO          1   6854 107258</span><span id="5396" class="hf hg hh jk b fi kx jp l jq jr">SQL&gt; /</span><span id="0598" class="hf hg hh jk b fi kx jp l jq jr">NAME                           STATUS NOU USED_UBLK LOG_IO PHY_IO<br/>—————————————————------------- ------ --- --------- ------ ------ <br/>                               ACTIVE NO          1  16203 127761</span><span id="73ac" class="hf hg hh jk b fi kx jp l jq jr">SQL&gt;</span></pre><p id="c593" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">对于之前的加载，事务统计显示使用了很少的撤销块，所以使用了直接路径访问方法。</p><p id="bdb1" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">问题是—这次生成了多少重做记录？</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="240c" class="hf hg hh jk b fi jo jp l jq jr">col name format a30<br/>SELECT sid, name, TRUNC(value/1024/1024,1) "MB"<br/>FROM v$sesstat ss<br/>INNER JOIN v$statname sn<br/>ON (ss.statistic# = sn.statistic#)<br/>WHERE name IN ('redo size for direct writes', -— direct path only<br/>               'redo size') -— conventional plus direct path<br/>  AND sid IN (SELECT sid<br/>              FROM v$session <br/>              WHERE program='impdp.exe' or module like 'Data Pump%')<br/>ORDER BY sid, name;</span><span id="6468" class="hf hg hh jk b fi kx jp l jq jr">SID NAME                             MB<br/>—-— -—-—-—---------------—------ ------<br/>132 redo size                       2.4<br/>132 redo size for direct writes      .8<br/>133 redo size                        .8<br/>133 redo size for direct writes       0<br/>385 redo size                        .4<br/>385 redo size for direct writes      .1</span><span id="0557" class="hf hg hh jk b fi kx jp l jq jr">SQL&gt; /</span><span id="7ddc" class="hf hg hh jk b fi kx jp l jq jr">SID NAME                             MB<br/>—-— -—-—-—---------------—------ ------<br/>132 redo size                       3.1<br/>132 redo size for direct writes      .8<br/>133 redo size                        .8<br/>133 redo size for direct writes       0<br/>385 redo size                        .4<br/>385 redo size for direct writes      .1</span><span id="9ac0" class="hf hg hh jk b fi kx jp l jq jr">SQL&gt; /</span><span id="90fa" class="hf hg hh jk b fi kx jp l jq jr">SID NAME                             MB<br/>—-— -—-—-—---------------—------ ------<br/>132 redo size                       3.1<br/>132 redo size for direct writes      .8<br/>133 redo size                        .8<br/>133 redo size for direct writes       0<br/>385 redo size                        .4<br/>385 redo size for direct writes      .1</span><span id="3a33" class="hf hg hh jk b fi kx jp l jq jr">SQL&gt;</span></pre><p id="814c" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">对于之前的加载，会话统计数据显示“直接写入的重做大小”在稳步增加，但现在情况并非如此。</p><p id="1306" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">“直接写入的重做大小”指标是静态的。</p><p id="c976" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">在线重做日志有很多开关吗？</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="10a5" class="hf hg hh jk b fi jo jp l jq jr">—- recent activity of the online redo logs<br/>col 1st_time format a15<br/>SELECT SEQUENCE#,<br/>  (sysdate-FIRST_TIME) day(1) to second (0) "1st_time",<br/>  FIRST_CHANGE#,<br/>  NEXT_CHANGE#<br/>FROM v$log_history<br/>WHERE NUMTODSINTERVAL(sysdate-first_time,'DAY')<br/>  &lt; NUMTODSINTERVAL(20,'MINUTE');</span><span id="3a0a" class="hf hg hh jk b fi kx jp l jq jr">no rows selected</span><span id="ece9" class="hf hg hh jk b fi kx jp l jq jr">SQL&gt;</span></pre><p id="2750" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">因此，负载具有较小的“直接写入的重做大小”，并且没有在线重做日志的切换，这表明正在生成无效重做记录。</p><p id="5cbd" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">SQL Developer客户端还将显示重做记录生成:</p><figure class="jf jg jh ji fd kz er es paragraph-image"><div class="er es lc"><img src="../Images/aeb1867ab7ba75b4edde022c49be59ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*ymmMvIx6p94l-YC53Wr_BQ.jpeg"/></div></figure><p id="b7bb" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">撤销利用率仍然很低(2.8%)，重做记录生成的图表显示速率为45kB/秒或更低。</p><p id="6dd7" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">45kB/秒的重做记录生成速率远低于之前的负载(最大5.5 MB/秒)。</p><p id="b6b8" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">直接路径加载完成后，如果创建了任何无效重做记录，它们将被记录:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="e54a" class="hf hg hh jk b fi jo jp l jq jr">SELECT UNRECOVERABLE_CHANGE#,<br/>  TO_CHAR(UNRECOVERABLE_TIME, 'Dy ddMonyyyy hh24:mi:ss') timestamp<br/>FROM V$DATAFILE<br/>WHERE UNRECOVERABLE_CHANGE# &gt; 0<br/>  AND ts# IN (SELECT ts# FROM v$tablespace <br/>              WHERE name = UPPER('&amp;tblspc'))<br/>  AND NUMTODSINTERVAL(sysdate-UNRECOVERABLE_TIME,'DAY') &lt; NUMTODSINTERVAL(20,'MINUTE');</span><span id="bb01" class="hf hg hh jk b fi kx jp l jq jr">UNRECOVERABLE_CHANGE# TIMESTAMP<br/>————————————--------— ———-------------------<br/>              7727610 Mon 22Oct2018 00:12:49</span><span id="9704" class="hf hg hh jk b fi kx jp l jq jr">SQL&gt;</span></pre><p id="78c9" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">对于最后一次加载，没有无效重做记录，但现在在最近的历史中有一个记录。</p><p id="d7a0" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">由于生成的重做记录比以前少，所以装载性能应该会有所提高。</p><p id="7859" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">datapump导入的日志文件的尾部将显示加载性能的提高:</p><pre class="jf jg jh ji fd jj jk jl jm aw jn bi"><span id="5fee" class="hf hg hh jk b fi jo jp l jq jr">..<br/>Processing object type SCHEMA_EXPORT/TABLE/INDEX/INDEX<br/>Job “SYSTEM”.”IMPDP” completed with 0 error(s) at Mon Oct 22 00:12:49 2018 elapsed 0 00:01:17</span></pre><p id="af4b" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">因此，以前数据泵导入花费的时间超过了8分钟，但是现在相同的负载只需要1分钟多一点！</p><p id="b162" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated">在Oracle 12c中，使用TRANSFORM子句进行数据泵导入，以最高的Oracle数据库性能加载对象从未如此简单。</p><h1 id="6987" class="kg hg hh bd hi kh ki kj hm kk kl km hq kn ko kp hu kq kr ks hy kt ku kv ic kw bi translated">请参见</h1><p id="f19b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io hr ip iq ir hv is it iu hz iv iw ix iy ha bi translated">TRANSFORM子句的选项如下:</p><p id="81ed" class="pw-post-body-paragraph ie if hh ig b ih ja ij ik il jb in io hr jc iq ir hv jd it iu hz je iw ix iy ha bi translated"><a class="ae ld" href="https://docs.oracle.com/en/database/oracle/oracle-database/12.2/sutil/datapump-import-utility.html#GUID-64FB67BD-EB67-4F50-A4D2-5D34518E6BDB" rel="noopener ugc nofollow" target="_blank">https://docs . Oracle . com/en/database/Oracle/Oracle-database/12.2/sutil/data pump-import-utility . html # GUID-64 FB 67 BD-EB67-4 f50-a4 D2-5d 34518 E6 BDB</a></p><h1 id="d302" class="kg hg hh bd hi kh ki kj hm kk kl km hq kn ko kp hu kq kr ks hy kt ku kv ic kw bi translated">关于作者</h1><p id="a703" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io hr ip iq ir hv is it iu hz iv iw ix iy ha bi translated"><em class="iz"> Paul Guerin是一名专注于Oracle数据库性能的国际顾问。Paul在东南亚的全球交付中心工作，但他的客户来自澳大利亚、欧洲、亚洲和北美。此外，他还出席了一些世界领先的甲骨文会议，包括甲骨文2013年世界开放大会。他的工作还入选了2015年IOUG最佳实践技巧手册，以及甲骨文技术网络(OTN)。他是一名DBA OCP，并将继续参与Oracle ACE计划。</em></p></div></div>    
</body>
</html>