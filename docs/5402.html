<html>
<head>
<title>Using Prometheus to monitor apps on Oracle Application Container Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Prometheus监控Oracle应用容器云上的应用</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/using-prometheus-to-monitor-apps-on-oracle-cloud-7b75dea9f2f3?source=collection_archive---------0-----------------------#2018-02-15">https://medium.com/oracledevs/using-prometheus-to-monitor-apps-on-oracle-cloud-7b75dea9f2f3?source=collection_archive---------0-----------------------#2018-02-15</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><blockquote class="ie if ig"><p id="27d0" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated">有关微服务主题的博客帖子的主目录，请参考—<a class="ae jg" rel="noopener" href="/oracledevs/bunch-of-microservices-related-blogs-57b5f1f062e5">https://medium . com/Oracle devs/bunch-of-microservice-related-blogs-57 b5 f1 f 062 e 5</a></p></blockquote><p id="848a" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">监控很难..在生产中更是如此，如果生产环境恰好是<em class="ij">云</em>中的<em class="ij"> PaaS </em>组件，情况就更是如此</p><ul class=""><li id="431b" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated">您(通常)无法访问底层基础架构/容器/虚拟机</li><li id="f05f" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">有太多的语言(多语言)，每一种都有无数的框架</li></ul><p id="f5b9" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">有多种解决方案，其中<strong class="ik hi">普罗米修斯</strong>是一个(相对)新的但有前途的选择。借助一个简单的例子，这篇博客展示了如何使用Prometheus来监控在<a class="ae jg" href="https://cloud.oracle.com/application-container-cloud" rel="noopener ugc nofollow" target="_blank"> Oracle应用容器云</a>上的<strong class="ik hi"> Spring Boot </strong>应用</p></div><div class="ab cl jy jz go ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ha hb hc hd he"><h1 id="06de" class="kf kg hh bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">在我们开始之前…</h1><p id="25e3" class="pw-post-body-paragraph ih ii hh ik b il ld in io ip le ir is jh lf iv iw ji lg iz ja jj lh jd je jf ha bi translated">..值得指出的是，Oracle应用容器云支持以下基本结构</p><ul class=""><li id="d8ac" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated">能够<a class="ae jg" href="https://docs.oracle.com/en/cloud/paas/app-container-cloud/dvcjv/java-mission-control-and-java-flight-recorder.html#GUID-70D59FA2-04D3-40B1-8F8E-8131300E25C7" rel="noopener ugc nofollow" target="_blank">使用JFR分析您的(Java)应用程序</a>并下载它们以供进一步分析</li><li id="773e" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">特定应用程序(每个实例)<a class="ae jg" href="https://docs.oracle.com/en/cloud/paas/app-container-cloud/csjse/viewing-service-metrics-application.html" rel="noopener ugc nofollow" target="_blank">内存指标</a></li><li id="8c39" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">访问<a class="ae jg" href="https://docs.oracle.com/en/cloud/paas/app-container-cloud/dvcjv/retrieving-application-logs.html#GUID-19455093-3D4E-46AD-B203-37BA1BB51874" rel="noopener ugc nofollow" target="_blank">应用程序日志</a></li></ul><h1 id="09dd" class="kf kg hh bd kh ki li kk kl km lj ko kp kq lk ks kt ku ll kw kx ky lm la lb lc bi translated">让我们开始吧</h1><blockquote class="ie if ig"><p id="6471" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated"><em class="hh">Github上有源代码</em></p></blockquote><div class="ln lo ez fb lp lq"><a href="https://github.com/abhirockzz/accs-prometheus-spring-boot-example" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab dw"><div class="ls ab lt cl cj lu"><h2 class="bd hi fi z dy lv ea eb lw ed ef hg bi translated">abhirockzz/accs-Prometheus-spring-boot-示例</h2><div class="lx l"><h3 class="bd b fi z dy lv ea eb lw ed ef dx translated">accs-prometheus-spring-boot-example-使用Prometheus监控Oracle应用程序容器上的Spring Boot应用程序…</h3></div><div class="ly l"><p class="bd b fp z dy lv ea eb lw ed ef dx translated">github.com</p></div></div><div class="lz l"><div class="ma l mb mc md lz me mf lq"/></div></div></a></div><p id="7deb" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">高级流程(和示例应用程序)非常简单</p><ul class=""><li id="02df" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated">Prometheus从Spring Boot应用程序(<code class="du mg mh mi mj b">HTTP GET</code>)中获取指标并存储它们(在本例中是本地存储)</li><li id="c619" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">然后，您可以使用Prometheus UI以图表的形式内省这些指标</li></ul><figure class="ml mm mn mo fd mp er es paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="er es mk"><img src="../Images/b7778bcf32dd3a649823accca4fc355b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wnFipmnQ6JzLfXxgW4ibsw.jpeg"/></div></div><figcaption class="mv mw et er es mx my bd b be z dx">Solution overview</figcaption></figure><p id="aac4" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">让我们探索一些重要的组件</p><h2 id="0cef" class="mz kg hh bd kh na nb nc kl nd ne nf kp jh ng nh kt ji ni nj kx jj nk nl lb nm bi translated">普罗米修斯</h2><p id="8cb1" class="pw-post-body-paragraph ih ii hh ik b il ld in io ip le ir is jh lf iv iw ji lg iz ja jj lh jd je jf ha bi translated">这是一个开源监控服务，最初是由<em class="ij"> SoundCloud </em>开发的</p><ul class=""><li id="e812" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated">部分<a class="ae jg" href="https://cncf.io/" rel="noopener ugc nofollow" target="_blank"> CNCF </a></li><li id="6ff8" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">支持时序数据模型和查询语言</li><li id="47aa" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">与外部系统(如Grafana等)的集成挂钩。)</li></ul><div class="ln lo ez fb lp lq"><a href="https://prometheus.io/docs/introduction/overview/" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab dw"><div class="ls ab lt cl cj lu"><h2 class="bd hi fi z dy lv ea eb lw ed ef hg bi translated">概述|普罗米修斯</h2><div class="lx l"><h3 class="bd b fi z dy lv ea eb lw ed ef dx translated">一个具有维度数据模型、灵活的查询语言、高效的时间序列数据库…</h3></div><div class="ly l"><p class="bd b fp z dy lv ea eb lw ed ef dx translated">普罗米修斯</p></div></div></div></a></div><h2 id="a3be" class="mz kg hh bd kh na nb nc kl nd ne nf kp jh ng nh kt ji ni nj kx jj nk nl lb nm bi translated">Spring Boot (+弹簧执行器)</h2><p id="477c" class="pw-post-body-paragraph ih ii hh ik b il ld in io ip le ir is jh lf iv iw ji lg iz ja jj lh jd je jf ha bi translated">我们的Spring Boot应用很简单，它使用<code class="du mg mh mi mj b">@RestController</code>公开了一个REST端点</p><p id="5d5b" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">Spring Actuator使用HTTP端点自动启用应用程序监控部分</p><blockquote class="ie if ig"><p id="9f3d" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated"><em class="hh">弹簧执行器(</em> <code class="du mg mh mi mj b"><em class="hh">spring-boot-starter-actuator</em></code> <em class="hh">)暴露的端点有很多(如</em><code class="du mg mh mi mj b"><em class="hh">info</em></code><em class="hh"/><code class="du mg mh mi mj b"><em class="hh">health</em></code><em class="hh"/><code class="du mg mh mi mj b"><em class="hh">dump</em></code><em class="hh"/><code class="du mg mh mi mj b"><em class="hh">env</em></code><em class="hh"/><code class="du mg mh mi mj b"><em class="hh">trace </em></code><em class="hh">等)。)，但是示例应用程序只激活了</em> <code class="du mg mh mi mj b"><em class="hh">metrics</em></code> <em class="hh">端点，它公开了诸如JVM内存、线程、系统正常运行时间等信息。</em></p></blockquote><p id="0cd3" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">这些度量细节以JSON的形式公开——这不是普罗米修斯所理解的格式。因此，除此之外，示例应用程序使用适配器/转换器层，作为Prometheus Java客户端的<em class="ij">附加模块</em>提供。</p><p id="144a" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">它帮助将Spring Actuator metrics info(最初是JSON)转换成Prometheus可以使用的纯文本格式(默认情况下，它在<code class="du mg mh mi mj b">/prometheus</code>端点公开)</p><div class="ln lo ez fb lp lq"><a href="https://github.com/prometheus/client_java/tree/master/simpleclient_spring_boot" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab dw"><div class="ls ab lt cl cj lu"><h2 class="bd hi fi z dy lv ea eb lw ed ef hg bi translated">普罗米修斯/客户端_java</h2><div class="lx l"><h3 class="bd b fi z dy lv ea eb lw ed ef dx translated">用于JVM应用程序的client_java - Prometheus检测库</h3></div><div class="ly l"><p class="bd b fp z dy lv ea eb lw ed ef dx translated">github.com</p></div></div><div class="lz l"><div class="nn l mb mc md lz me mf lq"/></div></div></a></div><p id="866a" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">下面的Maven依赖项是所有需要的</p><figure class="ml mm mn mo fd mp er es paragraph-image"><div class="er es no"><img src="../Images/5ca0f09274f7f71d84e40c8d91aab462.png" data-original-src="https://miro.medium.com/v2/resize:fit:1106/format:webp/1*wHglyt1fVPg14irQSDKHaA.png"/></div><figcaption class="mv mw et er es mx my bd b be z dx">Maven dependency for Prometheus Spring Boot client</figcaption></figure><p id="080a" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">你需要做的就是使用注释(下面突出显示)来激活插件</p><pre class="ml mm mn mo fd np mj nq nr aw ns bi"><span id="4ed7" class="mz kg hh mj b fi nt nu l nv nw"><a class="ae jg" href="http://twitter.com/SpringBootApplicatio" rel="noopener ugc nofollow" target="_blank">@SpringBootApplicatio</a>n<br/><a class="ae jg" href="http://twitter.com/RestController" rel="noopener ugc nofollow" target="_blank">@RestController</a><br/><a class="ae jg" href="http://twitter.com/EnablePrometheusEndp" rel="noopener ugc nofollow" target="_blank"><strong class="mj hi"><em class="ij">@EnablePrometheusEndp</em></strong></a><strong class="mj hi"><em class="ij">oint<br/></em></strong><a class="ae jg" href="http://twitter.com/EnableSpringBootMetr" rel="noopener ugc nofollow" target="_blank"><strong class="mj hi"><em class="ij">@EnableSpringBootMetr</em></strong></a><strong class="mj hi"><em class="ij">icsCollector</em></strong></span><span id="831f" class="mz kg hh mj b fi nx nu l nv nw">public class Bootstrap {</span><span id="edff" class="mz kg hh mj b fi nx nu l nv nw">public static void main(String[] args) {<br/> SpringApplication.run(Bootstrap.class, args);<br/> }<br/>.....<br/>}</span></pre><p id="499d" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">这就是概述…现在是准备应用程序并将其发送到云的时候了</p></div><div class="ab cl jy jz go ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ha hb hc hd he"><h1 id="d779" class="kf kg hh bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">构建和部署</h1><p id="34c7" class="pw-post-body-paragraph ih ii hh ik b il ld in io ip le ir is jh lf iv iw ji lg iz ja jj lh jd je jf ha bi translated">借助Oracle Application Container Cloud，您在部署应用程序方面有多种选择。这个博客将利用PSM CLI，这是一个用于管理Oracle云服务的强大命令行界面</p><blockquote class="ie if ig"><p id="ee26" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated"><em class="hh">其他部署选项包括</em><a class="ae jg" href="https://docs.oracle.com/en/cloud/paas/app-container-cloud/apcsr/index.html" rel="noopener ugc nofollow" target="_blank"><em class="hh">REST API</em></a><em class="hh"/><a class="ae jg" href="https://docs.oracle.com/en/cloud/paas/developer-cloud/csdcs/deploying-application-oracle-developer-cloud-service.html#GUID-6FE6D850-65DC-471D-A249-F7CCA9CAB56F" rel="noopener ugc nofollow" target="_blank"><em class="hh">Oracle开发者云</em> </a> <em class="hh">当然还有</em> <a class="ae jg" href="https://docs.oracle.com/en/cloud/paas/app-container-cloud/csjse/creating-application.html" rel="noopener ugc nofollow" target="_blank"> <em class="hh">控制台/UI </em> </a></p></blockquote><p id="e681" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">首先，在您的机器上下载并设置PSM CLI(使用<code class="du mg mh mi mj b">psm setup</code> ) — <a class="ae jg" href="https://docs.oracle.com/en/cloud/paas/java-cloud/pscli/using-command-line-interface-1.html" rel="noopener ugc nofollow" target="_blank">详情请见</a></p><p id="d99b" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">从克隆git repo开始— <code class="du mg mh mi mj b">git clone <a class="ae jg" href="https://github.com/abhirockzz/accs-prometheus-spring-boot-example" rel="noopener ugc nofollow" target="_blank">https://github.com/abhirockzz/accs-prometheus-spring-boot-example</a></code></p><h2 id="ac47" class="mz kg hh bd kh na nb nc kl nd ne nf kp jh ng nh kt ji ni nj kx jj nk nl lb nm bi translated">构建Spring Boot应用程序</h2><ul class=""><li id="71a3" class="jk jl hh ik b il ld ip le jh ny ji nz jj oa jf jp jq jr js bi translated"><code class="du mg mh mi mj b">cd <a class="ae jg" href="https://github.com/abhirockzz/accs-prometheus-spring-boot-example/tree/master/accs-springboot-app" rel="noopener ugc nofollow" target="_blank">accs-springboot-app</a></code></li><li id="bd07" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated"><code class="du mg mh mi mj b">mvn clean install</code></li></ul><p id="aa49" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">构建过程将在<code class="du mg mh mi mj b">target </code>目录中创建<code class="du mg mh mi mj b">accs-spring-boot-hello-world-dist.zip</code></p><h2 id="aaae" class="mz kg hh bd kh na nb nc kl nd ne nf kp jh ng nh kt ji ni nj kx jj nk nl lb nm bi translated">将其推至云</h2><p id="383b" class="pw-post-body-paragraph ih ii hh ik b il ld in io ip le ir is jh lf iv iw ji lg iz ja jj lh jd je jf ha bi translated"><code class="du mg mh mi mj b">psm accs push -n SpringBootOnACCS -r java -s hourly -m manifest.json -d deployment.json -p target/accs-spring-boot-hello-world-dist.zip</code></p><blockquote class="ie if ig"><p id="d77b" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated"><em class="hh">一旦执行，一个</em>异步<em class="hh">进程被启动，CLI返回它的</em>作业ID <em class="hh">，以便您跟踪应用程序创建</em></p></blockquote><p id="1751" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">等待应用程序被创建，<em class="ij">记下它的URL </em></p><figure class="ml mm mn mo fd mp er es paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="er es ob"><img src="../Images/9ef2cdabc8b6bb8bdc505406da26e665.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zVJE1f19FECgNSWk_ZHnzQ.png"/></div></div><figcaption class="mv mw et er es mx my bd b be z dx">Simple Spring Boot app deployed to Oracle Application Container Cloud</figcaption></figure><h2 id="193d" class="mz kg hh bd kh na nb nc kl nd ne nf kp jh ng nh kt ji ni nj kx jj nk nl lb nm bi translated">建造普罗米修斯服务器</h2><ul class=""><li id="3a49" class="jk jl hh ik b il ld ip le jh ny ji nz jj oa jf jp jq jr js bi translated"><code class="du mg mh mi mj b">cd <a class="ae jg" href="https://github.com/abhirockzz/accs-prometheus-spring-boot-example/tree/master/prometheus-on-accs" rel="noopener ugc nofollow" target="_blank">prometheus-on-accs</a></code></li><li id="6442" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">从这里下载<strong class="ik hi">普罗米修斯</strong>T38】并放入目录</li></ul><blockquote class="ie if ig"><p id="478f" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated"><em class="hh">有关最新发布版本，请参考下面的页面</em></p></blockquote><div class="ln lo ez fb lp lq"><a href="https://prometheus.io/download/" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab dw"><div class="ls ab lt cl cj lu"><h2 class="bd hi fi z dy lv ea eb lw ed ef hg bi translated">下载|普罗米修斯</h2><div class="lx l"><h3 class="bd b fi z dy lv ea eb lw ed ef dx translated">一个具有维度数据模型、灵活的查询语言、高效的时间序列数据库…</h3></div><div class="ly l"><p class="bd b fp z dy lv ea eb lw ed ef dx translated">普罗米修斯</p></div></div></div></a></div><blockquote class="ie if ig"><p id="f42a" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated"><em class="hh">最后，你的目录结构应该是这样的</em></p></blockquote><figure class="ml mm mn mo fd mp er es paragraph-image"><div class="er es oc"><img src="../Images/d1482f2e4771e606551daf0d0aacfebd.png" data-original-src="https://miro.medium.com/v2/resize:fit:506/format:webp/1*zRKWZ4s-1TxUHlUPbCAADA.png"/></div><figcaption class="mv mw et er es mx my bd b be z dx">Prometheus artifacts</figcaption></figure><ul class=""><li id="3e1c" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated">现在只需压缩/添加内容即可</li></ul><p id="d76c" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">在把普罗米修斯推到云端之前还有最后一件事…..</p><h2 id="7ffd" class="mz kg hh bd kh na nb nc kl nd ne nf kp jh ng nh kt ji ni nj kx jj nk nl lb nm bi translated">更新普罗米修斯配置</h2><p id="441a" class="pw-post-body-paragraph ih ii hh ik b il ld in io ip le ir is jh lf iv iw ji lg iz ja jj lh jd je jf ha bi translated">编辑<code class="du mg mh mi mj b">prometheus_config.yml</code>文件，输入您在Oracle Application Container Cloud上的Spring Boot应用程序的URL(您在上一步中部署的应用程序)</p><figure class="ml mm mn mo fd mp er es paragraph-image"><div class="er es od"><img src="../Images/2e001b9d80682aa6d4a8d9a9bac0d7b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*Vp7jDocDQSjaruE0tZbFcg.png"/></div><figcaption class="mv mw et er es mx my bd b be z dx">Replace this with the URL specific to your environment</figcaption></figure><h2 id="fe40" class="mz kg hh bd kh na nb nc kl nd ne nf kp jh ng nh kt ji ni nj kx jj nk nl lb nm bi translated">部署普罗米修斯服务器</h2><p id="5012" class="pw-post-body-paragraph ih ii hh ik b il ld in io ip le ir is jh lf iv iw ji lg iz ja jj lh jd je jf ha bi translated">只需一个命令，您就可以将Prometheus部署到Oracle应用容器云</p><p id="0a05" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated"><code class="du mg mh mi mj b">psm accs push -n PrometheusServer -r <strong class="ik hi">golang </strong>-e <strong class="ik hi">dockerhub </strong>-s hourly -m manifest.json -d deployment.json -p accs-prometheus-server.zip</code></p><p id="3a75" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">等待Prometheus服务器进行配置和引导</p><figure class="ml mm mn mo fd mp er es paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="er es oe"><img src="../Images/07782c6d0647382946d2920c3d194e04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hy0siADIXw6CHcT-_UaE0g.png"/></div></div><figcaption class="mv mw et er es mx my bd b be z dx">Prometheus on Oracle Application Container Cloud</figcaption></figure><p id="cc79" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">单击应用程序名称导航至详细信息屏幕</p><figure class="ml mm mn mo fd mp er es paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="er es of"><img src="../Images/d77ee6dcf7801d6cb2473c88427a0c7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YrmhXBV79tgmjr9CD_05hA.png"/></div></div><figcaption class="mv mw et er es mx my bd b be z dx">Prometheus server details</figcaption></figure></div><div class="ab cl jy jz go ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ha hb hc hd he"><h1 id="6247" class="kf kg hh bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">试车</h1><p id="f494" class="pw-post-body-paragraph ih ii hh ik b il ld in io ip le ir is jh lf iv iw ji lg iz ja jj lh jd je jf ha bi translated">首先，让我们从几个健全性检查开始</p><h2 id="aa18" class="mz kg hh bd kh na nb nc kl nd ne nf kp jh ng nh kt ji ni nj kx jj nk nl lb nm bi translated">访问弹簧致动器指标端点</h2><p id="7778" class="pw-post-body-paragraph ih ii hh ik b il ld in io ip le ir is jh lf iv iw ji lg iz ja jj lh jd je jf ha bi translated"><code class="du mg mh mi mj b">curl -X GET <a class="ae jg" href="https://springbootonaccs-ocloud109.apaas.us2.oraclecloud.com/metrics" rel="noopener ugc nofollow" target="_blank">https://springbootonaccs-ocloud109.apaas.us2.oraclecloud.com/metrics</a></code></p><p id="77f2" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">它应该返回一个带有度量信息和属性(如堆、线程等)的JSON。</p><figure class="ml mm mn mo fd mp er es paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="er es og"><img src="../Images/a5ac23674ae1777e76fbced1b96093bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9JO2H39OGbjjtGnq9pXBOg.png"/></div></div><figcaption class="mv mw et er es mx my bd b be z dx">Spring Actuator metrics (JSON format)</figcaption></figure><h2 id="a6b8" class="mz kg hh bd kh na nb nc kl nd ne nf kp jh ng nh kt ji ni nj kx jj nk nl lb nm bi translated">访问普罗米修斯端点</h2><p id="dded" class="pw-post-body-paragraph ih ii hh ik b il ld in io ip le ir is jh lf iv iw ji lg iz ja jj lh jd je jf ha bi translated">如前所述，弹簧执行器度量信息被转换成普罗米修斯(纯文本)格式，并在<code class="du mg mh mi mj b">prometheus </code>端点上公开(默认)</p><p id="72a0" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated"><code class="du mg mh mi mj b">curl -X GET <a class="ae jg" href="https://springbootonaccs-ocloud109.apaas.us2.oraclecloud.com/prometheus" rel="noopener ugc nofollow" target="_blank">https://springbootonaccs-ocloud109.apaas.us2.oraclecloud.com/prometheus</a></code></p><figure class="ml mm mn mo fd mp er es paragraph-image"><div class="er es oh"><img src="../Images/fe82b4a6b038c43311eb0907f8831d86.png" data-original-src="https://miro.medium.com/v2/resize:fit:888/format:webp/1*KapScRT4t2e58Lxj50ZNRg.png"/></div><figcaption class="mv mw et er es mx my bd b be z dx">Metrics in Prometheus format</figcaption></figure><h2 id="db89" class="mz kg hh bd kh na nb nc kl nd ne nf kp jh ng nh kt ji ni nj kx jj nk nl lb nm bi translated">检查普罗米修斯配置</h2><p id="6862" class="pw-post-body-paragraph ih ii hh ik b il ld in io ip le ir is jh lf iv iw ji lg iz ja jj lh jd je jf ha bi translated">访问Oracle应用容器云上的Prometheus服务器，打开其控制台，从<strong class="ik hi">状态</strong>菜单中选择<strong class="ik hi">配置</strong></p><p id="7bb8" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated"><strong class="ik hi">目标</strong>的值是您刚刚部署的Spring Boot应用程序，<strong class="ik hi">度量_路径</strong>的值是prometheus格式的度量数据可用的端点</p><figure class="ml mm mn mo fd mp er es paragraph-image"><div class="er es oi"><img src="../Images/c1cddfb6267ec0d748c9a2fd69c81a6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*lWnxjBzowm1_GKKLseL2Tw.png"/></div><figcaption class="mv mw et er es mx my bd b be z dx">Prometheus configuration</figcaption></figure><h2 id="fcea" class="mz kg hh bd kh na nb nc kl nd ne nf kp jh ng nh kt ji ni nj kx jj nk nl lb nm bi translated">我的目标怎么样了？</h2><p id="c6c9" class="pw-post-body-paragraph ih ii hh ik b il ld in io ip le ir is jh lf iv iw ji lg iz ja jj lh jd je jf ha bi translated">在<strong class="ik hi">状态</strong>菜单下检查<strong class="ik hi">目标</strong>。您将看到Spring Boot应用程序已启动，正在被抓取以提取监控指标</p><figure class="ml mm mn mo fd mp er es paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="er es og"><img src="../Images/2d1f852d45623266fb4ddcfd3dcc7f79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rI6_QjjFW6Xb-CE2gsmBbQ.png"/></div></div><figcaption class="mv mw et er es mx my bd b be z dx">Prometheus target (Spring Boot app) status</figcaption></figure><h2 id="83cd" class="mz kg hh bd kh na nb nc kl nd ne nf kp jh ng nh kt ji ni nj kx jj nk nl lb nm bi translated">探索指标</h2><p id="2a31" class="pw-post-body-paragraph ih ii hh ik b il ld in io ip le ir is jh lf iv iw ji lg iz ja jj lh jd je jf ha bi translated">在主页上，下拉列表显示了Spring Boot应用程序生成的所有可用指标，如类、堆等。</p><figure class="ml mm mn mo fd mp er es paragraph-image"><div class="er es oj"><img src="../Images/1434ba4fc60099203c7bebb7fc1c7440.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*P2QSB_w_LvGOM0zRc5Xfvw.png"/></div><figcaption class="mv mw et er es mx my bd b be z dx">List of metrics extracted by Prometheus</figcaption></figure><p id="4e30" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">有很多指标，但让我们快速看一下其中的几个— <code class="du mg mh mi mj b">used memory</code>、<code class="du mg mh mi mj b">free memory</code>和<code class="du mg mh mi mj b">used heap</code></p><p id="01e4" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">从metrics下拉列表中选择<code class="du mg mh mi mj b">mem</code>(JVM使用的总内存)显示图表。这里我们看到，在15分钟的窗口中，内存利用率在增加</p><figure class="ml mm mn mo fd mp er es paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="er es ok"><img src="../Images/a118b31c1a4280f9498a85f96642113c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SqtHelCs7rCgOvudA5IDdQ.png"/></div></div><figcaption class="mv mw et er es mx my bd b be z dx">JVM utilized memory</figcaption></figure><p id="21b6" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">通过分析，<code class="du mg mh mi mj b">mem_free</code>(JVM的空闲内存)显示它呈下降趋势——这一点很明显，因为我们刚刚看到内存利用率在上升</p><figure class="ml mm mn mo fd mp er es paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="er es ok"><img src="../Images/70d617875bc40ae450541e298fe3c030.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7ZaY_BNPCCYDgCrflLf1Zg.png"/></div></div><figcaption class="mv mw et er es mx my bd b be z dx">JVM free memory</figcaption></figure><p id="8727" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">堆的使用情况(使用<code class="du mg mh mi mj b">heap_used</code>指标很明显)是已用JVM内存的一部分(<code class="du mg mh mi mj b">mem</code>)。从图中可以明显看出，堆利用率(对于所选的15分钟时间窗口)呈上升趋势</p><figure class="ml mm mn mo fd mp er es paragraph-image"><div role="button" tabindex="0" class="mq mr di ms bf mt"><div class="er es ol"><img src="../Images/14bcd6c8c75878bbe9101ae879251d7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HBw1h919Au2UyASJ08CEUQ.png"/></div></div><figcaption class="mv mw et er es mx my bd b be z dx">JVM heap utlization</figcaption></figure><h1 id="14b8" class="kf kg hh bd kh ki li kk kl km lj ko kp kq lk ks kt ku ll kw kx ky lm la lb lc bi translated">其他注意事项</h1><p id="b455" class="pw-post-body-paragraph ih ii hh ik b il ld in io ip le ir is jh lf iv iw ji lg iz ja jj lh jd je jf ha bi translated">有趣但未涉及的事情(也许是其他博客？)</p><ul class=""><li id="13f6" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated">自定义指标</li><li id="c856" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">非Spring应用程序</li><li id="b0e3" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">格拉夫纳集成</li><li id="69b0" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">远程存储</li></ul></div><div class="ab cl jy jz go ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ha hb hc hd he"><h1 id="4a7b" class="kf kg hh bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">快速回顾一下我们做了什么</h1><ul class=""><li id="1fd7" class="jk jl hh ik b il ld ip le jh ny ji nz jj oa jf jp jq jr js bi translated">在Oracle应用容器云上部署Spring Boot应用</li><li id="1394" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">在Oracle应用程序容器云上部署Prometheus服务器(<code class="du mg mh mi mj b">golang </code>运行时)</li><li id="eac8" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">使用发送给Prometheus的指标监控Spring Boot应用程序(感谢Spring Boot执行器)</li></ul><p id="8ef3" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">这篇博文到此为止！</p><h1 id="228a" class="kf kg hh bd kh ki li kk kl km lj ko kp kq lk ks kt ku ll kw kx ky lm la lb lc bi translated">不要忘记…</h1><ul class=""><li id="42ff" class="jk jl hh ik b il ld ip le jh ny ji nz jj oa jf jp jq jr js bi translated">查看Oracle Application Container Cloud教程—每个运行时都有适合的内容！</li></ul><div class="ln lo ez fb lp lq"><a href="https://docs.oracle.com/en/cloud/paas/app-container-cloud/create-first-applications.html" rel="noopener  ugc nofollow" target="_blank"><div class="lr ab dw"><div class="ls ab lt cl cj lu"><h2 class="bd hi fi z dy lv ea eb lw ed ef hg bi translated">Oracle应用容器云服务—创建您的第一批应用</h2><div class="lx l"><h3 class="bd b fi z dy lv ea eb lw ed ef dx translated">Oracle应用容器云服务教程。学习创建你的第一个应用程序。</h3></div><div class="ly l"><p class="bd b fp z dy lv ea eb lw ed ef dx translated">docs.oracle.com</p></div></div></div></a></div><ul class=""><li id="fea7" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated">关于应用程序容器云的其他博客</li></ul><div class="ln lo ez fb lp lq"><a rel="noopener follow" target="_blank" href="/tag/app-container-cloud/latest"><div class="lr ab dw"><div class="ls ab lt cl cj lu"><h2 class="bd hi fi z dy lv ea eb lw ed ef hg bi translated">关于应用容器云的最新故事和新闻—中型</h2><div class="lx l"><h3 class="bd b fi z dy lv ea eb lw ed ef dx translated">阅读关于应用容器云的最新文章。每天，成千上万的声音阅读、书写和分享重要的…</h3></div><div class="ly l"><p class="bd b fp z dy lv ea eb lw ed ef dx translated">medium.com</p></div></div><div class="lz l"><div class="om l mb mc md lz me mf lq"/></div></div></a></div><p id="fe33" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">干杯！</p><blockquote class="ie if ig"><p id="91d2" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated">本文表达的观点是我个人的观点，不一定代表甲骨文的观点。</p></blockquote></div></div>    
</body>
</html>