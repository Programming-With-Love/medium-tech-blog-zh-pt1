<html>
<head>
<title>5 tips for preparing for Multi-Window in Android N</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android N中多窗口准备的5个技巧</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/5-tips-for-preparing-for-multi-window-in-android-n-7bed803dda64?source=collection_archive---------1-----------------------#2016-03-23">https://medium.com/androiddevelopers/5-tips-for-preparing-for-multi-window-in-android-n-7bed803dda64?source=collection_archive---------1-----------------------#2016-03-23</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="d76d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你一直在挖掘Android N 的新功能<a class="ae jc" href="https://www.youtube.com/watch?v=CsulIu3UaUM&amp;utm_campaign=adp_series_prepareformultiwindow_032316&amp;utm_source=medium&amp;utm_medium=blog" rel="noopener ugc nofollow" target="_blank">，你可能会偶然发现</a><a class="ae jc" href="http://developer.android.com/preview/features/multi-window.html?utm_campaign=adp_series_prepareformultiwindow_032316&amp;utm_source=medium&amp;utm_medium=blog" rel="noopener ugc nofollow" target="_blank">多窗口支持</a>。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/4ee9371c596889551de19cb8e83bbb97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/0*6ubw3wnJCWvjJYdU."/></div></figure><p id="5859" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过分屏多窗口，两个应用程序将并排可见。很高兴看到这是如何工作的，我知道我立即浏览了文档，寻找是什么新的API使这种魔法工作。</p><p id="8c3b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">事实证明，新的API并不多。一些用于定制是否支持多窗口的XML属性和一些用于检查当前是否处于多窗口模式的Activity方法。那么魔力在哪里呢？<strong class="ig hi"> <em class="jl">魔力一直都在。</em> </strong></p><p id="e4ee" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">而所谓的神奇，我们指的是Android的<a class="ae jc" href="http://developer.android.com/guide/topics/resources/overview.html?utm_campaign=adp_series_prepareformultiwindow_032316&amp;utm_source=medium&amp;utm_medium=blog" rel="noopener ugc nofollow" target="_blank">资源系统</a>。资源系统最强大的部分之一是<a class="ae jc" href="http://developer.android.com/guide/topics/resources/providing-resources.html?utm_campaign=adp_series_prepareformultiwindow_032316&amp;utm_source=medium&amp;utm_medium=blog#AlternativeResources" rel="noopener ugc nofollow" target="_blank">提供替代资源</a>的能力——改变尺寸、布局、绘图、菜单等。基于不同的限定词。</p><p id="4d5f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">多窗口通过根据您的窗口大小调整配置来利用资源系统</strong> —屏幕大小是最明显的一个，但最小宽度(即宽度或高度的最小值)和方向也会在调整大小时更新。</p><p id="94c7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这让我们想到了第一个技巧。</p><h1 id="8d08" class="jm jn hh bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">提示1:使用正确的上下文</h1><p id="f153" class="pw-post-body-paragraph ie if hh ig b ih kk ij ik il kl in io ip km ir is it kn iv iw ix ko iz ja jb ha bi translated">加载适当的资源需要<a class="ae jc" href="https://possiblemobile.com/2013/06/context?utm_campaign=adp_series_prepareformultiwindow_032316&amp;utm_source=medium&amp;utm_medium=blog" rel="noopener ugc nofollow" target="_blank">适当的上下文</a>。如果您正在使用<a class="ae jc" href="http://developer.android.com/reference/android/app/Activity.html?utm_campaign=adp_series_prepareformultiwindow_032316&amp;utm_source=medium&amp;utm_medium=blog" rel="noopener ugc nofollow" target="_blank"> <em class="jl">活动</em> </a>上下文来扩展您的布局、检索资源等，那么您可以开始了。</p><p id="5f57" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然而，如果你使用你的<a class="ae jc" href="http://developer.android.com/reference/android/app/Application.html?utm_campaign=adp_series_prepareformultiwindow_032316&amp;utm_source=medium&amp;utm_medium=blog" rel="noopener ugc nofollow" target="_blank"> <em class="jl">应用</em> </a>上下文来处理任何与UI相关的事情，你会发现被加载的资源并没有意识到多窗口。除了不使用活动主题的问题之外，你可能完全加载了错误的资源！最好让你的用户界面和<em class="jl">活动</em>的上下文保持一致。</p><h1 id="45fd" class="jm jn hh bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">提示2:正确处理配置更改</h1><p id="e82b" class="pw-post-body-paragraph ie if hh ig b ih kk ij ik il kl in io ip km ir is it kn iv iw ix ko iz ja jb ha bi translated">有了正确的上下文，你就一定能在给定窗口大小的情况下获得正确的资源(无论是像以前一样全屏显示还是在你的应用程序和另一个应用程序之间拆分)。重新加载这些资源的过程基于您如何处理运行时变化。</p><p id="2021" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">默认情况下，您的整个活动被销毁并重新创建，恢复您在<a class="ae jc" href="http://developer.android.com/reference/android/app/Activity.html?utm_campaign=adp_series_prepareformultiwindow_032316&amp;utm_source=medium&amp;utm_medium=blog#onSaveInstanceState(android.os.Bundle)" rel="noopener ugc nofollow" target="_blank"><em class="jl">onSaveInstanceState()</em></a>中保存的任何状态，并重新加载所有资源/布局。这有一个很好的特性，你知道一切都与新的配置一致，并且每种类型的配置都被处理。</p><p id="e029" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">不言而喻，每次配置更改都应该快速无缝</strong>。确保您没有在<a class="ae jc" href="http://developer.android.com/reference/android/app/Activity.html?utm_campaign=adp_series_prepareformultiwindow_032316&amp;utm_source=medium&amp;utm_medium=blog#onResume()" rel="noopener ugc nofollow" target="_blank"> <em class="jl"> onResume() </em> </a>中做大量工作，并考虑使用<a class="ae jc" rel="noopener" href="/google-developers/making-loading-data-on-android-lifecycle-aware-897e12760832?utm_campaign=adp_series_prepareformultiwindow_032316&amp;utm_source=medium&amp;utm_medium=blog">加载器</a>来确保您的数据在配置更改后仍然存在。</p><p id="3ae6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您仍然可以<a class="ae jc" href="http://developer.android.com/guide/topics/resources/runtime-changes.html?utm_campaign=adp_series_prepareformultiwindow_032316&amp;utm_source=medium&amp;utm_medium=blog#HandlingTheChange" rel="noopener ugc nofollow" target="_blank">自己处理配置更改</a>，在这种情况下，您的活动(和片段)将收到对<a class="ae jc" href="http://developer.android.com/reference/android/app/Activity.html?utm_campaign=adp_series_prepareformultiwindow_032316&amp;utm_source=medium&amp;utm_medium=blog#onConfigurationChanged(android.content.res.Configuration)" rel="noopener ugc nofollow" target="_blank"><em class="jl">onConfigurationChanged()</em></a>的回调，而不是被销毁和重新创建，您将需要手动更新您的视图、重新加载资源等。</p><p id="db49" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了捕捉与多窗口相关的配置更改，您需要向您的清单添加一个<a class="ae jc" href="http://developer.android.com/guide/topics/manifest/activity-element.html?utm_campaign=adp_series_prepareformultiwindow_032316&amp;utm_source=medium&amp;utm_medium=blog#config" rel="noopener ugc nofollow" target="_blank"><em class="jl">Android:config changes</em></a>属性，至少包含以下值:</p><pre class="je jf jg jh fd kp kq kr ks aw kt bi"><span id="5b3f" class="ku jn hh kq b fi kv kw l kx ky">&lt;activity<br/>  android:name=".MyActivity"<br/>  android:configChanges="screenSize|smallestScreenSize<br/>      |screenLayout|orientation"</span><span id="90e7" class="ku jn hh kq b fi kz kw l kx ky">/&gt;</span></pre><p id="ce29" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">确保您正在处理每一个可能发生变化的资源(当您自己处理配置变化时，这是您的责任)。</p><p id="6eee" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这包括重新加载以前可能被认为是常量的资源。考虑在<em class="jl">值</em>和<em class="jl">值-sw600dp </em>中有一个尺寸的情况。在非多窗口世界中，你永远不会在运行时在这两个窗口之间切换，因为最小宽度永远不会改变(它永远是你的设备的最小宽度)。然而，有了多窗口，当你的应用程序调整大小时，你将不得不在这些资源之间切换。</p><h1 id="a377" class="jm jn hh bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">提示3:处理所有方向</h1><p id="27b5" class="pw-post-body-paragraph ie if hh ig b ih kk ij ik il kl in io ip km ir is it kn iv iw ix ko iz ja jb ha bi translated">还记得我们在介绍中谈到的当窗口调整大小时方向的变化吗？没错:<strong class="ig hi">即使设备是横向的，你的应用也可能是纵向的。</strong></p><p id="c686" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">原来:“纵向”实际上意味着高度大于宽度，“横向”意味着宽度大于高度。因此，考虑到这个定义，你的应用程序可以在调整大小时从一个过渡到另一个，这当然是有意义的。</p><p id="b95c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这也意味着方向之间的过渡应该尽可能平滑。引用<a class="ae jc" href="https://www.google.com/design/spec/layout/split-screen.html?utm_campaign=adp_series_prepareformultiwindow_032316&amp;utm_source=medium&amp;utm_medium=blog#split-screen-layout" rel="noopener ugc nofollow" target="_blank">分屏材料设计规格</a>:</p><blockquote class="la"><p id="8d42" class="lb lc hh bd ld le lf lg lh li lj jb dx translated">改变设备的方向不会导致用户界面发生意外的变化。例如，如果设备旋转到横向模式，在其中一个分屏(纵向模式)中显示视频的应用程序不应开始全屏播放。</p></blockquote><blockquote class="lk ll lm"><p id="51ba" class="ie if jl ig b ih ln ij ik il lo in io lp lq ir is lr ls iv iw lt lu iz ja jb ha bi translated"><strong class="ig hi">注意</strong>:如果当你的应用程序全屏显示时，你仍然需要这种功能，你可以使用<em class="hh"> inMultiWindowMode() </em>方法来检查你到底处于哪种情况。</p></blockquote><p id="da04" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用<a class="ae jc" href="http://developer.android.com/guide/topics/manifest/activity-element.html?utm_campaign=adp_series_prepareformultiwindow_032316&amp;utm_source=medium&amp;utm_medium=blog#screen" rel="noopener ugc nofollow" target="_blank"> <em class="jl">锁定你的屏幕方向安卓:屏幕方向</em> </a>也受多窗口影响。<strong class="ig hi">对于不针对Android N的应用，</strong> <strong class="ig hi">添加<em class="jl">Android:screen orientation</em>意味着你将根本不支持多窗口</strong>——你将总是迫使用户退出多窗口模式。当你以N为目标时，事情发生了一点变化——不是完全不支持多窗口，而是在多窗口模式下，你通过<em class="jl">Android:screen orientation</em>设置的任何方向都会被忽略。</p><p id="4fa6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请记住，在运行时使用<a class="ae jc" href="http://developer.android.com/reference/android/app/Activity.html?utm_campaign=adp_series_prepareformultiwindow_032316&amp;utm_source=medium&amp;utm_medium=blog#setRequestedOrientation(int)" rel="noopener ugc nofollow" target="_blank"><em class="jl">setrequesteorientation()</em></a>锁定您的方向在多窗口模式下不会有任何效果，无论您是否以N为目标。</p><blockquote class="lk ll lm"><p id="e76f" class="ie if jl ig b ih ii ij ik il im in io lp iq ir is lr iu iv iw lt iy iz ja jb ha bi translated"><strong class="ig hi">将<em class="hh"> android:immersive </em>属性添加到您的活动清单</strong> <strong class="ig hi">中，还会禁用不针对N </strong>的应用上的多窗口，规则与上面的<em class="hh">Android:screen orientation</em>相同。</p></blockquote><h1 id="a0fb" class="jm jn hh bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">专业技巧4:为所有屏幕尺寸构建一个响应迅速的UI</h1><p id="6b4a" class="pw-post-body-paragraph ie if hh ig b ih kk ij ik il kl in io ip km ir is it kn iv iw ix ko iz ja jb ha bi translated">对于分屏设计来说，方向并不是唯一需要考虑的事情。多窗口是你第一次平板UI(你有平板UI吧？毕竟，14亿个设备中的12.5%是一个很大的设备……)将被缩小到微型尺寸。</p><p id="9861" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你一直在构建一个对可用空间做出反应的用户界面，并且拥有相对相似的手机和平板电脑布局，你会发现你已经为多窗口做好了充分的准备。正如所建议的，<strong class="ig hi">将用户界面缩小到220dp宽/高，然后从那个尺寸扩大到全屏尺寸是你现在可以做的事情。</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es lv"><img src="../Images/67387a470788a9056098cffab4785ec4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*l8MfhEL7Gt1YtQY5.png"/></div></div><figcaption class="ma mb et er es mc md bd b be z dx">Building a single responsive layout makes for smooth transitions as your app resizes</figcaption></figure><p id="4776" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然而，如果你的手机和平板电脑用户界面有很大的不同，不要在两者之间切换，让用户不知所措——坚持使用平板电脑用户界面，努力缩小它的尺寸。有许多<a class="ae jc" href="https://www.google.com/design/spec/layout/responsive-ui.html?utm_campaign=adp_series_prepareformultiwindow_032316&amp;utm_source=medium&amp;utm_medium=blog#responsive-ui-patterns" rel="noopener ugc nofollow" target="_blank">响应的UI模式</a>你可以考虑用来为你的用户提供无缝的调整大小体验——同样，不需要N个API。</p><h1 id="5895" class="jm jn hh bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">Pro-tip 5:其他app启动的活动必须始终支持多窗口</h1><p id="1e4e" class="pw-post-body-paragraph ie if hh ig b ih kk ij ik il kl in io ip km ir is it kn iv iw ix ko iz ja jb ha bi translated">在多窗口世界中，你的整个<a class="ae jc" href="http://developer.android.com/guide/components/tasks-and-back-stack.html?utm_campaign=adp_series_prepareformultiwindow_032316&amp;utm_source=medium&amp;utm_medium=blog" rel="noopener ugc nofollow" target="_blank">任务</a>由一个窗口表示。这就是为什么如果你想<a class="ae jc" href="http://developer.android.com/preview/features/multi-window.html?utm_campaign=adp_series_prepareformultiwindow_032316&amp;utm_source=medium&amp;utm_medium=blog#launch" rel="noopener ugc nofollow" target="_blank">发起一个相邻的活动</a>，你需要开始一个新任务——新任务，新窗口。</p><p id="608b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这也意味着反过来也是正确的，引用同一页:</p><blockquote class="la"><p id="df52" class="lb lc hh bd ld le lf lg lh li lj jb dx translated">如果在任务堆栈中启动一个活动，该活动将替换屏幕上的活动，并继承其所有多窗口属性。</p></blockquote><p id="68d5" class="pw-post-body-paragraph ie if hh ig b ih ln ij ik il lo in io ip lq ir is it ls iv iw ix lu iz ja jb ha bi translated"><strong class="ig hi">这意味着如果你有一个可以被其他应用程序启动的活动，你的活动将继承与调用活动相同的多窗口属性</strong>。这包括最小尺寸等属性。在<a class="ae jc" href="http://developer.android.com/reference/android/app/Activity.html?utm_campaign=adp_series_prepareformultiwindow_032316&amp;utm_source=medium&amp;utm_medium=blog#startActivityForResult(android.content.Intent,%20int)" rel="noopener ugc nofollow" target="_blank"><em class="jl">startActivityForResult()</em></a>的情况下，您的活动必须是同一个任务堆栈的一部分，即使在<a class="ae jc" href="http://developer.android.com/guide/components/intents-filters.html?utm_campaign=adp_series_prepareformultiwindow_032316&amp;utm_source=medium&amp;utm_medium=blog#ExampleSend" rel="noopener ugc nofollow" target="_blank">隐式意图</a>的情况下，您也不能保证它们也会包含一个<a class="ae jc" href="http://developer.android.com/reference/android/content/Intent.html?utm_campaign=adp_series_prepareformultiwindow_032316&amp;utm_source=medium&amp;utm_medium=blog#FLAG_ACTIVITY_NEW_TASK" rel="noopener ugc nofollow" target="_blank"><em class="jl">FLAG _ Activity _ NEW _ TASK</em></a>。</p><p id="d030" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，这些活动中的每一个(以及由该活动启动的任何活动)<strong class="ig hi">都必须</strong>支持多窗口，一直到最小的尺寸。彻底测试！</p><h1 id="7f78" class="jm jn hh bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">测试所有的东西！</h1><p id="06b0" class="pw-post-body-paragraph ie if hh ig b ih kk ij ik il kl in io ip km ir is it kn iv iw ix ko iz ja jb ha bi translated">准备多窗口的最好方法是<strong class="ig hi">测试你的应用</strong>。即使没有任何代码更改或经历设置Android N SDK的过程，在Android N设备或模拟器上安装您现有的应用程序也是一个了不起的第一步，是一个捕捉低挂水果和#BuildBetterApps的简单方法。</p><p id="8f1b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">关注<a class="ae jc" href="https://plus.google.com/collection/sLR0p?utm_campaign=adp_series_prepareformultiwindow_032316&amp;utm_source=medium&amp;utm_medium=blog" rel="noopener ugc nofollow" target="_blank"> Android开发模式集</a>了解更多！</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lw lx di ly bf lz"><div class="er es me"><img src="../Images/ede78edee0069962aa0daa7cc8c85f02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S6K7IYkWhCzkS6YAgxLfXw.png"/></div></div></figure></div></div>    
</body>
</html>