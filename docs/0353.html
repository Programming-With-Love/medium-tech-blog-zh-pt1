<html>
<head>
<title>Camera Enumeration on Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android上的摄像头枚举</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/camera-enumeration-on-android-9a053b910cb5?source=collection_archive---------2-----------------------#2018-07-20">https://medium.com/androiddevelopers/camera-enumeration-on-android-9a053b910cb5?source=collection_archive---------2-----------------------#2018-07-20</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="a9b8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从Android P开始，增加了逻辑多摄像头和USB摄像头支持。这对Android开发者意味着什么？</p><p id="218e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2019–05–22更新:这篇博文已经更新，增加了关于过滤掉不具备RGB输出功能但被列为相机设备的设备的指导；例如深度传感器。</p><h1 id="bdcc" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">多个摄像头</h1><p id="7ffa" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">单个设备中的多个摄像头并不是什么新鲜事，但直到现在，Android设备都被限制在最多两个摄像头:前置和后置。如果你想打开第一个摄像头，你要做的就是:</p><figure class="kf kg kh ki fd kj"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="7d48" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但那是更简单的时代。如今，多个摄像头意味着前面和/或后面有两个或更多摄像头。可供选择的镜头太多了！</p><h1 id="6c2f" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">照相机2 API</h1><p id="c3be" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">出于兼容性原因，即使在旧的Camera API被弃用多年后，上面的代码仍然有效。但是，随着生态系统的发展，需要更先进的相机功能。于是安卓推出了安卓5.0(棒棒糖)的Camera2，API等级21及以上。使用Camera2 API打开第一个现有摄像机的等效代码如下所示:</p><figure class="kf kg kh ki fd kj"><div class="bz dy l di"><div class="kk kl l"/></div></figure><h1 id="3125" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">第一次不总是最好的</h1><p id="4393" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">到目前为止一切顺利。如果我们需要的只是一个打开第一个现有相机的应用程序，这将在大多数Android手机上工作。但是考虑以下场景:</p><ul class=""><li id="1c6e" class="km kn hh ig b ih ii il im ip ko it kp ix kq jb kr ks kt ku bi translated">如果设备没有摄像头，应用程序将会崩溃。这看起来似乎不太可能，直到我们意识到Android运行在多种设备中，包括Android Things、Android Wear和Android TV，这些设备加起来有数百万用户。</li><li id="ed79" class="km kn hh ig b ih kv il kw ip kx it ky ix kz jb kr ks kt ku bi translated">如果设备至少有一个后置摄像头，它将被映射到列表中的第一个摄像头。但在没有后置摄像头的设备上运行的应用程序，如PixelBooks和大多数其他ChromeOS笔记本电脑，将打开单个前置摄像头。</li></ul><p id="a05d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们做什么呢检查摄像机列表和摄像机特性:</p><figure class="kf kg kh ki fd kj"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="eec5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">变量<code class="du la lb lc ld b">cameraLensFacing</code>将是以下之一:</p><ul class=""><li id="a8c9" class="km kn hh ig b ih ii il im ip ko it kp ix kq jb kr ks kt ku bi translated"><a class="ae le" href="https://developer.android.com/reference/android/hardware/camera2/CameraMetadata#LENS_FACING_FRONT" rel="noopener ugc nofollow" target="_blank"> CameraMetadata。镜头_正面_正面</a></li><li id="aa3e" class="km kn hh ig b ih kv il kw ip kx it ky ix kz jb kr ks kt ku bi translated"><a class="ae le" href="https://developer.android.com/reference/android/hardware/camera2/CameraMetadata#LENS_FACING_BACK" rel="noopener ugc nofollow" target="_blank"> CameraMetadata。镜头_正面_背面</a></li><li id="a007" class="km kn hh ig b ih kv il kw ip kx it ky ix kz jb kr ks kt ku bi translated"><a class="ae le" href="https://developer.android.com/reference/android/hardware/camera2/CameraMetadata#LENS_FACING_EXTERNAL" rel="noopener ugc nofollow" target="_blank"> CameraMetadata。镜头_饰面_外部</a></li></ul><p id="e9d9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有关面向镜头配置的更多信息，请看文档。</p><p id="ba5e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">变量<code class="du la lb lc ld b">cameraCapabilities</code>将告诉我们各种能力，包括该相机是否能够产生标准帧作为输出(例如，与仅深度传感器数据相反)。我们应该寻找<code class="du la lb lc ld b">CameraMetadata.REQUEST_AVAILABLE_CAPABILITIES_BACKWARD_COMPATIBLE</code>是否是相机列出的功能之一，它作为一个标志存储在<code class="du la lb lc ld b">cameraCompatible</code>中。</p><h1 id="7fdb" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">合理的违约</h1><p id="91c6" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">根据应用程序的用例，我们可能希望默认打开一个特定的相机镜头配置(如果可用的话)。例如，自拍应用程序最有可能希望打开前置摄像头，而增强现实应用程序可能应该从后置摄像头开始。我们可以将此逻辑封装到一个函数中，该函数可以正确处理上述情况:</p><figure class="kf kg kh ki fd kj"><div class="bz dy l di"><div class="kk kl l"/></div></figure><h1 id="5de5" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">切换摄像机</h1><p id="8d24" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">到目前为止，我们已经讨论了如何根据应用程序想要做的事情来选择默认摄像机。许多相机应用程序还为用户提供了在相机之间切换的选项:</p><figure class="kf kg kh ki fd kj er es paragraph-image"><div class="er es lf"><img src="../Images/6449698d26930ec01b391bd9a02983e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:582/0*bv1q93VR4XIoazVZ"/></div><figcaption class="li lj et er es lk ll bd b be z dx">Switch camera button in the Google Camera app</figcaption></figure><p id="cd0f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了实现这个功能，从<a class="ae le" href="https://developer.android.com/reference/android/hardware/camera2/CameraManager#getCameraIdList()" rel="noopener ugc nofollow" target="_blank">camera manager . getcameraidlist()</a>提供的列表中选择下一个摄像机是很诱人的，但这不是一个好主意。原因是从Android P开始，我们期望看到更多的设备具有多个面向同一方向的摄像头，甚至通过USB连接外部摄像头。如果我们想为用户提供一个UI，让他们在不同的摄像头之间切换，建议(<a class="ae le" href="https://developer.android.com/reference/android/hardware/camera2/CameraMetadata#REQUEST_AVAILABLE_CAPABILITIES_LOGICAL_MULTI_CAMERA" rel="noopener ugc nofollow" target="_blank">根据文档</a>)为每个可能的镜头配置选择第一个可用的摄像头。</p><p id="0143" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">虽然选择下一台摄像机没有通用的逻辑，但以下代码适用于大多数情况:</p><figure class="kf kg kh ki fd kj"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="ac6c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这可能看起来很复杂，但我们需要考虑一大组具有许多不同配置的设备。</p><h1 id="7754" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">兼容性行为</h1><p id="2f04" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">对于仍在使用已弃用的相机API的应用程序，由<a class="ae le" href="https://developer.android.com/reference/android/hardware/Camera#getNumberOfCameras()" rel="noopener ugc nofollow" target="_blank">Camera . getnumberofcameras()</a>公布的相机数量取决于OEM实现。文件指出:</p><blockquote class="lm ln lo"><p id="db54" class="ie if lp ig b ih ii ij ik il im in io lq iq ir is lr iu iv iw ls iy iz ja jb ha bi translated">如果系统中有一个逻辑多摄像机，为了保持应用程序的向后兼容性，该方法将只为每个逻辑摄像机和底层物理摄像机组显示一个摄像机。使用camera2 API查看所有摄像机。</p></blockquote><p id="859e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">仔细阅读文档的其余部分，了解更多详情。一般来说，类似的建议也适用:使用<a class="ae le" href="https://developer.android.com/reference/android/hardware/Camera#getCameraInfo(int,%20android.hardware.Camera.CameraInfo)" rel="noopener ugc nofollow" target="_blank">camera . getcamerainfo()</a>API来查询所有的摄像机<a class="ae le" href="https://developer.android.com/reference/android/hardware/Camera.CameraInfo.html#orientation" rel="noopener ugc nofollow" target="_blank">方位</a>，对于每个可用的方位，只向在摄像机之间切换的用户展示一个摄像机。</p><h1 id="29c0" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">最佳实践</h1><p id="79e7" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">Android可以在许多不同的设备上运行。您不应该假设您的应用程序将总是运行在带有一个或两个摄像头的传统手持设备上。为应用选择最合适的摄像机。如果您不需要特定的相机，请选择具有所需镜头朝向配置的第一台相机。如果连接了外部摄像头，可以合理地假设用户更喜欢先看到这些摄像头。</p></div></div>    
</body>
</html>