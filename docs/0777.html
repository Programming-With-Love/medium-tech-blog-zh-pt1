<html>
<head>
<title>Making Jellyfish move in Compose: Animating ImageVectors and applying AGSL RenderEffects 🐠</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让水母在构图中移动:动画图像矢量和应用AGSL渲染效果🐠</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/making-jellyfish-move-in-compose-animating-imagevectors-and-applying-agsl-rendereffects-3666596a8888?source=collection_archive---------1-----------------------#2022-11-22">https://medium.com/androiddevelopers/making-jellyfish-move-in-compose-animating-imagevectors-and-applying-agsl-rendereffects-3666596a8888?source=collection_archive---------1-----------------------#2022-11-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/49badcf0499c6eecfad79d5710f3c3f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iIHWyLfhiFBCqRMc-cJSeQ.png"/></div></div></figure><div class=""/><p id="c773" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我喜欢在互联网上关注鼓舞人心的人，看看他们做了什么——其中一个人是<a class="ae jn" href="https://www.cassie.codes/" rel="noopener ugc nofollow" target="_blank">卡西码</a>，她为网络制作了令人难以置信的动画。她的一个鼓舞人心的例子是这个可爱的动画水母。</p><figure class="jo jp jq jr fd hj"><div class="bz dy l di"><div class="js jt l"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">Animated Jellyfish by Cassie Codes</figcaption></figure><p id="0089" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">看到这个并痴迷了一段时间后，我一直在想，这个可爱的小生物也需要在Compose中活过来。这篇博文描述了我是如何在Jetpack Compose中完成的，最终代码可以在这里找到。这里的技术当然不仅仅适用于水母……任何其他鱼类也可以！开个玩笑——这篇博文将涵盖:</p><ul class=""><li id="ea47" class="jy jz hs ir b is it iw ix ja ka je kb ji kc jm kd ke kf kg bi translated">自定义图像向量</li><li id="7ba6" class="jy jz hs ir b is kh iw ki ja kj je kk ji kl jm kd ke kf kg bi translated">动画图像矢量路径或组</li><li id="7505" class="jy jz hs ir b is kh iw ki ja kj je kk ji kl jm kd ke kf kg bi translated">在可组合的AGSL渲染效果上应用扭曲噪波效果。</li></ul><p id="e630" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">让我们开始吧！🤿</p><h1 id="0c20" class="km kn hs bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">分析SVG</h1><p id="6b8a" class="pw-post-body-paragraph ip iq hs ir b is lk iu iv iw ll iy iz ja lm jc jd je ln jg jh ji lo jk jl jm ha bi translated">要实现这个水母，我们首先需要了解SVG是由什么组成的——并尝试复制它的不同部分。弄清楚svg在画什么的最好方法是注释掉它的各个部分，并查看SVG的每个部分呈现的视觉效果。为此，您可以在上面链接的codepen中更改它，或者下载并在文本编辑器中打开一个SVG(这是一种文本可读格式)。</p><p id="a41a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">所以让我们来看一下这个SVG:</p><pre class="jo jp jq jr fd lp lq lr bn ls lt bi"><span id="d060" class="lu kn hs lq b be lv lw l lx ly">&lt;!-- <br/>    Jellyfish SVG, path data removed for brevity <br/>--&gt; <br/>&lt;svg  viewBox="0 0 530.46 563.1"&gt;<br/>  &lt;defs&gt;<br/>  &lt;filter id="turbulence" filterUnits="objectBoundingBox" x="0" y="0" width="100%" height="100%"&gt;<br/>    &lt;feTurbulence data-filterId="3" baseFrequency="0.02 0.03" result="turbulence" id="feturbulence" type="fractalNoise" numOctaves="1" seed="1"&gt;&lt;/feTurbulence&gt;<br/>    &lt;feDisplacementMap id="displacement" xChannelSelector="R" yChannelSelector="G" in="SourceGraphic" in2="turbulence" scale="13" /&gt;<br/>  &lt;/filter&gt;    <br/>  &lt;/defs&gt;<br/>  &lt;g class="jellyfish" filter="url(#turbulence)"&gt;<br/>    &lt;path class="tentacle"/&gt;<br/>    &lt;path class="tentacle"/&gt;<br/>    &lt;path class="tentacle" /&gt;<br/>    &lt;path class="tentacle" /&gt;<br/>    &lt;path class="tentacle"/&gt;<br/>    &lt;path class="tentacle"/&gt;<br/>    &lt;path class="tentacle"/&gt;<br/>    &lt;path class="tentacle"/&gt;<br/>    &lt;path class="tentacle"/&gt;<br/>    &lt;path class="face" /&gt;<br/>    &lt;path class="outerJelly"/&gt;<br/>    &lt;path id="freckle" /&gt;<br/>    &lt;path id="freckle"/&gt;<br/>    &lt;path id="freckle-4"/&gt;<br/>  &lt;/g&gt;<br/>  &lt;g id="bubbles" fill="#fff"&gt;<br/>    &lt;path class="bubble"/&gt;<br/>    &lt;path class="bubble"/&gt;<br/>    &lt;path class="bubble" /&gt;<br/>    &lt;path class="bubble"/&gt;<br/>    &lt;path class="bubble"/&gt;<br/>    &lt;path class="bubble"/&gt;<br/>    &lt;path class="bubble" /&gt;<br/>  &lt;/g&gt;<br/>  &lt;g class="jellyfish face"&gt;<br/>    &lt;path class="eye lefteye"  fill="#b4bebf" d=""/&gt;<br/>    &lt;path class="eye righteye" fill="#b4bebf" d=""/&gt;<br/>    &lt;path class="mouth" fill="#d3d3d3" opacity=".72"/&gt;<br/>  &lt;/g&gt;<br/>&lt;/svg&gt;</span></pre><p id="18df" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">SVG由以下元素组成:</p><ol class=""><li id="96c0" class="jy jz hs ir b is it iw ix ja ka je kb ji kc jm lz ke kf kg bi translated">构成SVG的路径和路径组:</li></ol><ul class=""><li id="1af4" class="jy jz hs ir b is it iw ix ja ka je kb ji kc jm kd ke kf kg bi translated">触须</li><li id="9f6f" class="jy jz hs ir b is kh iw ki ja kj je kk ji kl jm kd ke kf kg bi translated">面部——斑点和外部果冻</li><li id="2701" class="jy jz hs ir b is kh iw ki ja kj je kk ji kl jm kd ke kf kg bi translated">眼睛——睁开和闭上的动物</li><li id="26fb" class="jy jz hs ir b is kh iw ki ja kj je kk ji kl jm kd ke kf kg bi translated">泡泡——在水母周围随机产生动画——大小和alpha产生动画</li></ul><p id="19be" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">2.总的来说，水母的身体也应用了<code class="du ma mb mc lq b">feTurbulence</code>(噪波)作为<code class="du ma mb mc lq b">feDisplacementMap</code>，这给了它不稳定的外观。</p><p id="7233" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">既然我们已经了解了这个SVG是由什么组成的，那么让我们开始在Compose中呈现静态版本。</p><h1 id="2c5c" class="km kn hs bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">创建自定义图像向量</h1><p id="a1df" class="pw-post-body-paragraph ip iq hs ir b is lk iu iv iw ll iy iz ja lm jc jd je ln jg jh ji lo jk jl jm ha bi translated">Compose有一个<a class="ae jn" href="https://developer.android.com/jetpack/compose/graphics/images/compare#image-vector" rel="noopener ugc nofollow" target="_blank"> ImageVector </a>的概念，您可以通过编程构建一个向量——类似于SVG。对于你只想渲染而不想改变的vector/SVG，你也可以使用painter resource(r . drawable . vector _ image)加载一个VectorDrawable。这将会把它转换成Compose将要渲染的ImageVector。</p><p id="f5d4" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在你可能会问自己——为什么不把水母作为SVG导入xml文件，然后用<code class="du ma mb mc lq b">painterResource(R.drawable.jelly_fish)</code>加载它呢？</p><p id="6bad" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这是一个很好的问题——以这种方式加载水母是可能的，去除SVG的湍流方面，图像将呈现加载的XML(如这里的<a class="ae jn" href="https://developer.android.com/jetpack/compose/graphics/images/compare#image-vector" rel="noopener ugc nofollow" target="_blank">文档中所解释的</a>)。但是我们想对路径的单个部分做更多的工作，比如点击时动画部分和对身体应用噪声效果，所以我们将以编程方式构建我们的<code class="du ma mb mc lq b">ImageVector</code>。</p><p id="f00b" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了在Compose中渲染这个水母，我们可以复制组成鱼的路径数据(或者路径上的“<code class="du ma mb mc lq b">d</code>”标签)，例如，第一个触手有以下路径数据:</p><pre class="jo jp jq jr fd lp lq lr bn ls lt bi"><span id="5d8d" class="lu kn hs lq b be lv lw l lx ly">M226.31 258.64c.77 8.68 2.71 16.48 1.55 25.15-.78 8.24-5 15.18-7.37 23-3.1 10.84-4.65 22.55 1.17 32.52 4.65 7.37 7.75 11.71 5.81 21.25-2.33 8.67-7.37 16.91-2.71 26 4.26 8.68 7.75 4.34 8.14-3 .39-12.14 0-24.28.77-36 .78-16.91-12-27.75-2.71-44.23 7-12.15 11.24-33 7.76-46.83z</span></pre><p id="da1a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你是第一次接触路径/矢量/SVG，上面的内容可能会有点让人不知所措。但是不要担心，这些只是指定如何画东西的数学指令的命令。例如，<strong class="ir ht"> M </strong>是将虚拟光标移动到新位置而不进行绘制的命令，<strong class="ir ht"> L </strong>是在指定位置绘制一条线的命令，还有一些其他命令，例如:</p><ul class=""><li id="3451" class="jy jz hs ir b is it iw ix ja ka je kb ji kc jm kd ke kf kg bi translated"><strong class="ir ht"> M，m </strong>:移动到</li><li id="feb4" class="jy jz hs ir b is kh iw ki ja kj je kk ji kl jm kd ke kf kg bi translated"><strong class="ir ht"> L，L，H，H，V，v </strong>:行到</li><li id="4dfb" class="jy jz hs ir b is kh iw ki ja kj je kk ji kl jm kd ke kf kg bi translated"><strong class="ir ht"> C，C，S，s </strong>:三次贝塞尔曲线</li><li id="6420" class="jy jz hs ir b is kh iw ki ja kj je kk ji kl jm kd ke kf kg bi translated"><strong class="ir ht"> Q，Q，T，t: </strong>二次贝塞尔曲线</li><li id="65a5" class="jy jz hs ir b is kh iw ki ja kj je kk ji kl jm kd ke kf kg bi translated"><strong class="ir ht"> A、a: </strong>椭圆弧曲线向</li><li id="f073" class="jy jz hs ir b is kh iw ki ja kj je kk ji kl jm kd ke kf kg bi translated"><strong class="ir ht"> Z，z </strong> —关闭路径</li></ul><p id="b787" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">命令<strong class="ir ht">区分大小写</strong>，大写字母表示视口空间中的绝对坐标，而小写字母表示命令相对于当前位置。</p><p id="e25b" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在你可能在想——我是不是必须在脑子里画图，并且用手知道所有的位置和命令？不——一点也不。您可以在大多数设计程序(如Figma或Inkscape)中创建一个矢量，并将绘图结果导出到SVG中，以便自己获取这些信息。咻！😅</p><p id="155f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在Compose中创建向量:我们调用<code class="du ma mb mc lq b">rememberVectorPainter</code>，它创建一个<code class="du ma mb mc lq b">ImageVector</code>，我们创建一个叫做<code class="du ma mb mc lq b">jellyfish</code>的<code class="du ma mb mc lq b">Group</code>，然后创建另一个叫做<code class="du ma mb mc lq b">tentacles</code>的<code class="du ma mb mc lq b">Group</code>，我们将第一个<code class="du ma mb mc lq b">Path</code>放入其中作为第一个触手。我们还设置了一个<code class="du ma mb mc lq b">RadialGradient</code>作为整个水母的背景。</p><figure class="jo jp jq jr fd hj"><div class="bz dy l di"><div class="md jt l"/></div></figure><p id="f09a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">和下面的结果是一个小触手绘制在屏幕上与径向梯度背景！</p><figure class="jo jp jq jr fd hj er es paragraph-image"><div class="er es me"><img src="../Images/7ab26d81a3c22e8c108955e1673186f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/format:webp/1*W_Ajp2rWu7mMJiYmaIPuAA.png"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">First tentacle rendered</figcaption></figure><p id="df30" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们对SVG的所有元素重复这一过程——从SVG文件中提取路径位，并将颜色和alpha应用于将要绘制的路径，我们还将路径逻辑分组为触角、面部、气泡等:</p><figure class="jo jp jq jr fd hj"><div class="bz dy l di"><div class="md jt l"/></div></figure><p id="58a5" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们现在已经用上面的<code class="du ma mb mc lq b">ImageVector</code>渲染了整个水母:</p><figure class="jo jp jq jr fd hj er es paragraph-image"><div class="er es me"><img src="../Images/aff1612a8cc2d25738198b6202905acc.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/format:webp/1*5Y5jIM5wdivyfgjEGKizfw.png"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">Whole static Jellyfish rendering in Compose</figcaption></figure><h1 id="6d81" class="km kn hs bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">动画图像矢量路径和组</h1><p id="2728" class="pw-post-body-paragraph ip iq hs ir b is lk iu iv iw ll iy iz ja lm jc jd je ln jg jh ji lo jk jl jm ha bi translated">我们想制作这个向量的动画部分:</p><ul class=""><li id="e6e9" class="jy jz hs ir b is it iw ix ja ka je kb ji kc jm kd ke kf kg bi translated">水母应该慢慢地上下移动</li><li id="1944" class="jy jz hs ir b is kh iw ki ja kj je kk ji kl jm kd ke kf kg bi translated">点击水母时，眼睛会眨一下</li><li id="5bdf" class="jy jz hs ir b is kh iw ki ja kj je kk ji kl jm kd ke kf kg bi translated">水母的身体应该有一个抖动/噪音效果。</li></ul><p id="34ae" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">用XML文件做这件事很困难:制作动画很棘手，我们需要使用XML，而且如果不把它转换成一个<code class="du ma mb mc lq b">AnimatedVectorDrawable</code>，我们就不能对文件内部的部分应用其他效果。例如，我们想引入一个交互，点击水母时眼睛会眨眼。我们能够更好地控制我们的元素，并以编程方式创建自定义动画。</p><p id="e197" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">因此，让我们看看我们如何能够动画的<code class="du ma mb mc lq b">ImageVector</code>的个别位。</p><h1 id="b4d1" class="km kn hs bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">上下移动水母</h1><p id="cde2" class="pw-post-body-paragraph ip iq hs ir b is lk iu iv iw ll iy iz ja lm jc jd je ln jg jh ji lo jk jl jm ha bi translated">查看codepen，我们可以看到水母在上下平移(y平移)。为了在compose中做到这一点，我们创建了一个无限过渡和一个超过3000毫秒的动画<code class="du ma mb mc lq b">translationY</code>，然后我们设置包含水母的组，并且面部有一个<code class="du ma mb mc lq b">translationY</code>，这将产生上下动画。</p><figure class="jo jp jq jr fd hj"><div class="bz dy l di"><div class="md jt l"/></div></figure><figure class="jo jp jq jr fd hj er es paragraph-image"><div class="er es mf"><img src="../Images/236e2fd9a60f3cb6e753acb3fd795b5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/1*TxOwiv1dhUbLsLb92Tjbmg.gif"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">Translation Up and down</figcaption></figure><p id="2e48" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">棒极了——<code class="du ma mb mc lq b">ImageVector</code>的一部分现在上下移动，你会注意到气泡保持在相同的位置。</p><h1 id="6976" class="km kn hs bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">眨眼睛👁️</h1><p id="ed9a" class="pw-post-body-paragraph ip iq hs ir b is lk iu iv iw ll iy iz ja lm jc jd je ln jg jh ji lo jk jl jm ha bi translated">查看codepen，我们可以看到每只眼睛上都有一个<code class="du ma mb mc lq b">scaleY</code>和<code class="du ma mb mc lq b">opacity</code>动画。让我们创建这两个变量，并将比例应用于<code class="du ma mb mc lq b">Group</code>和<code class="du ma mb mc lq b">Path</code>上的alpha。我们也将只在点击水母时应用这些，以使这成为一个更具互动性的动画。</p><p id="cc59" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们创建了两个保存动画状态的<a class="ae jn" href="https://developer.android.com/jetpack/compose/animation#animatable" rel="noopener ugc nofollow" target="_blank">动画对象</a>和一个点击水母时调用的暂停函数——我们制作了这些属性的动画来缩放和淡化眼睛。</p><figure class="jo jp jq jr fd hj"><div class="bz dy l di"><div class="md jt l"/></div></figure><p id="b1f5" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们现在有了一个可爱的眨眼动画——我们的水母差不多完成了！</p><figure class="jo jp jq jr fd hj er es paragraph-image"><div class="er es mg"><img src="../Images/931627a5e401805e626fa95332ccbd7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:974/1*5gM6eI9TKamjahcDyBnaHA.gif"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">Blinking on click of ImageVector</figcaption></figure><h1 id="8234" class="km kn hs bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">应用失真/噪声效果📯</h1><p id="ea46" class="pw-post-body-paragraph ip iq hs ir b is lk iu iv iw ll iy iz ja lm jc jd je ln jg jh ji lo jk jl jm ha bi translated">所以我们已经得到了大部分我们想要动画的东西——上下运动和眨眼。让我们来看看水母的身体是如何应用这种摇摆效果的，身体和触须在应用噪声的情况下移动，以给它一种运动的感觉。</p><figure class="jo jp jq jr fd hj er es paragraph-image"><div class="er es mh"><img src="../Images/98721127a8749f3013618b67703b2292.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/1*1iho4qjbJnfe2V25S1E-yw.gif"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">Codepen: Jellyfish without noise vs with noise applied</figcaption></figure><p id="48ee" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">查看SVG和动画代码，我们可以看到它使用<code class="du ma mb mc lq b">feTurbulence</code>生成噪声，然后作为<code class="du ma mb mc lq b">feDisplacementMap</code>应用于SVG。</p><pre class="jo jp jq jr fd lp lq lr bn ls lt bi"><span id="aad0" class="lu kn hs lq b be lv lw l lx ly"> &lt;filter id="turbulence" filterUnits="objectBoundingBox" x="0" y="0" width="100%" height="100%"&gt;<br/>    &lt;feTurbulence data-filterId="3" baseFrequency="0.02 0.03" result="turbulence" id="feturbulence" type="fractalNoise" numOctaves="1" seed="1"&gt;&lt;/feTurbulence&gt;<br/>    &lt;feDisplacementMap id="displacement" xChannelSelector="R" yChannelSelector="G" in="SourceGraphic" in2="turbulence" scale="13" /&gt;<br/>  &lt;/filter&gt;    <br/>  &lt;/defs&gt;<br/>  &lt;g class="jellyfish" filter="url(#turbulence)"&gt;</span></pre><p id="ac77" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">不幸的是，目前Android不支持这些原语(见<a class="ae jn" href="https://issuetracker.google.com/257007553" rel="noopener ugc nofollow" target="_blank">这个公开的bug </a>)，但是我们确实有其他工具可以帮助解决这个问题。<code class="du ma mb mc lq b">feTurbulence</code>正在生成噪声，然后将其用作位移图来移动SVG。</p><p id="fb4a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们可以使用<a class="ae jn" href="https://developer.android.com/develop/ui/views/graphics/agsl/using-agsl#using_runtimeshader_with_jetpack_compose" rel="noopener ugc nofollow" target="_blank"> AGSL </a>着色器来实现这一点，值得注意的是，这仅在提拉米苏和更高版本(API 33+)上受支持。首先，我们需要创建一个着色器，作为一个摆动，我们不会使用噪音在第一-只是一个简单的映射函数。</p><p id="369e" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">着色器的工作方式是它们作用于单个像素——我们得到一个坐标(<code class="du ma mb mc lq b">fragCoord</code>)，我们期望产生一个将在该坐标处渲染的颜色结果。下面是我们将用于转换可组合的初始着色器:</p><figure class="jo jp jq jr fd hj"><div class="bz dy l di"><div class="md jt l"/></div></figure><p id="4485" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在我们的例子中，我们将使用的输入是我们当前在屏幕上渲染的像素。我们通过作为输入发送的<code class="du ma mb mc lq b">uniform shader contents;</code>变量来访问它。我们获取输入坐标(<code class="du ma mb mc lq b">fragCoord</code>)，并对该坐标应用一些变换——随时间移动它，并对它执行一些数学运算来移动它。</p><p id="f4e1" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这产生了一个新的坐标，所以我们不是在<code class="du ma mb mc lq b">fragCoord</code>位置返回精确的颜色，而是移动输入像素的位置。例如，如果我们有<code class="du ma mb mc lq b">return contents.eval(fragCoord)</code>，它不会产生任何变化——它将是一个传递。我们现在从可组合内容的不同点获取像素颜色，这将对可组合内容产生不稳定的失真效果。</p><p id="1d60" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要在我们的可组合组件上使用它，我们可以将这个着色器作为<code class="du ma mb mc lq b">RenderEffect</code>应用于可组合组件的内容:</p><figure class="jo jp jq jr fd hj"><div class="bz dy l di"><div class="md jt l"/></div></figure><p id="97b7" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们使用<code class="du ma mb mc lq b"><a class="ae jn" href="https://developer.android.com/reference/android/graphics/RenderEffect#createRuntimeShaderEffect(android.graphics.RuntimeShader,%20java.lang.String)" rel="noopener ugc nofollow" target="_blank">createRuntimeShaderEffect</a></code>，传入<code class="du ma mb mc lq b">WOBBLE_SHADER</code>作为输入。它获取可组合对象的当前内容，并将其作为着色器的输入，参数名为“<code class="du ma mb mc lq b">contents</code>”。然后我们查询<code class="du ma mb mc lq b">WOBBLE_SHADER</code>中的内容。<code class="du ma mb mc lq b">time</code>变量随时间改变摆动(创建动画)。</p><p id="08dd" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">运行这个，我们可以看到整个<code class="du ma mb mc lq b">Image</code>现在扭曲了，看起来有点不稳定——就像水母一样。</p><figure class="jo jp jq jr fd hj er es paragraph-image"><div class="er es mf"><img src="../Images/37f765655c3d8c0f8d7d48837096d8a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/1*7f-Me_q8UybS19mts9GP4g.gif"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">Wobble applied all over the whole jellyfish</figcaption></figure><p id="4e68" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果我们不想让效果应用到脸和泡泡上，我们可以将它们提取到单独的<code class="du ma mb mc lq b">ImageVectors</code>中，然后跳过将渲染效果应用到这些矢量上:</p><figure class="jo jp jq jr fd hj er es paragraph-image"><div class="er es mf"><img src="../Images/02fb8fe8b9df500f2ab6f0775c4ccb45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/1*D2Ide-lczpXaWsZp-sivvg.gif"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">Wobble Applied without affecting the face</figcaption></figure><h1 id="3b09" class="km kn hs bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">应用噪波效果🙉</h1><p id="d151" class="pw-post-body-paragraph ip iq hs ir b is lk iu iv iw ll iy iz ja lm jc jd je ln jg jh ji lo jk jl jm ha bi translated">我们上面指定的着色器没有使用噪波函数来对可组合内容应用位移。噪波是一种应用置换的方式，具有更结构化的随机函数。其中一种类型的噪声是柏林噪声(这是<code class="du ma mb mc lq b">feTurbulence</code>在幕后使用的)，这是我们渲染运行柏林噪声函数的结果时的样子:</p><figure class="jo jp jq jr fd hj er es paragraph-image"><div class="er es mi"><img src="../Images/dd33f80fa531ab9cd4c1d82a7c91f21a.png" data-original-src="https://miro.medium.com/v2/resize:fit:608/format:webp/1*F_Mgs81qMU-xlwHEd6gnew.png"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">Perlin Noise output</figcaption></figure><p id="ce79" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们使用空间中每个坐标的噪波值，并使用它来查询“<code class="du ma mb mc lq b">contents</code>”着色器中的新坐标。</p><p id="8dc8" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">让我们更新我们的着色器，使用一个柏林噪声函数(改编自<a class="ae jn" href="https://github.com/ashima/webgl-noise/blob/master/src/classicnoise2D.glsl" rel="noopener ugc nofollow" target="_blank">这个Github repo </a>)。然后，我们将使用它来确定从输入坐标到输出坐标的坐标映射(即位移映射)。</p><figure class="jo jp jq jr fd hj"><div class="bz dy l di"><div class="md jt l"/></div></figure><p id="4d72" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">应用这个噪声函数，我们得到一个更好的结果！水母看起来好像在水中移动。</p><figure class="jo jp jq jr fd hj er es paragraph-image"><div class="er es mf"><img src="../Images/43c3fb66ba67bdae6722d97b38f6f62b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/1*kSvYzDBs5YepG4egq2nPhA.gif"/></div><figcaption class="ju jv et er es jw jx bd b be z dx">Perlin Noise applied to the jellyfish body</figcaption></figure><h1 id="f70f" class="km kn hs bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">但我为什么要用这个？</h1><p id="1389" class="pw-post-body-paragraph ip iq hs ir b is lk iu iv iw ll iy iz ja lm jc jd je ln jg jh ji lo jk jl jm ha bi translated">在这一点上，你可能想知道，这很酷——但在其用例中非常合适，丽贝卡。当然——也许你不会每天在工作中制作一个动画水母(我们可以做梦，对吗？).但是<code class="du ma mb mc lq b">RenderEffects</code>可以应用于任何可组合的树——允许你对任何你想要的东西应用效果。</p><p id="f763" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">例如，为什么你不希望你的渐变文本或整个可组合屏幕有一个噪声效果或任何其他你想要的AGSL效果呢？</p><figure class="jo jp jq jr fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mj"><img src="../Images/09e903ad4a3bf38e29d2fd0581e62786.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ZKNjqguVaCV9XbCJcIOyCw.gif"/></div></div><figcaption class="ju jv et er es jw jx bd b be z dx">Perlin Noise applied to whole Composable</figcaption></figure><h1 id="57ef" class="km kn hs bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">包裹🌯</h1><p id="5b0a" class="pw-post-body-paragraph ip iq hs ir b is lk iu iv iw ll iy iz ja lm jc jd je ln jg jh ji lo jk jl jm ha bi translated">因此，我们已经在这篇博文中涵盖了许多有趣的概念——从SVG创建自定义的<code class="du ma mb mc lq b">ImageVectors</code>,制作<code class="du ma mb mc lq b">ImageVector</code>的部分动画，以及在Compose中将AGSL着色器作为<code class="du ma mb mc lq b">RenderEffects</code>应用于我们的UI。</p><p id="d2bf" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">水母的完整代码——点击查看完整的<a class="ae jn" href="https://gist.github.com/riggaroo/b139b0dfbf1fee932862dc52d1b08950" rel="noopener ugc nofollow" target="_blank">要点。关于</a><a class="ae jn" href="https://developer.android.com/develop/ui/views/graphics/agsl/using-agsl#using_runtimeshader_with_jetpack_compose" rel="noopener ugc nofollow" target="_blank"> AGSL渲染效果</a>的更多信息——查看文档，或者<a class="ae jn" href="http://goo.gle/compose-jetlagged" rel="noopener ugc nofollow" target="_blank">时差样本</a>的另一个使用示例。</p><p id="6260" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你有任何问题，请随时联系乳齿象<a class="ae jn" href="https://androiddev.social/@riggaroo" rel="noopener ugc nofollow" target="_blank">androiddev.social/@riggaroo</a>或<a class="ae jn" href="https://twitter.com/riggaroo" rel="noopener ugc nofollow" target="_blank">推特</a>。</p></div><div class="ab cl mk ml go mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ha hb hc hd he"><p id="bda3" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="mr">感谢</em> <a class="ms mt ge" href="https://medium.com/u/7c4e8b4f1538?source=post_page-----3666596a8888--------------------------------" rel="noopener" target="_blank"> <em class="mr">约兰达·维尔霍夫</em> </a> <em class="mr">，</em> <a class="ms mt ge" href="https://medium.com/u/22c02a30ae04?source=post_page-----3666596a8888--------------------------------" rel="noopener" target="_blank"> <em class="mr">尼克·布彻</em> </a> <em class="mr">，</em> <a class="ms mt ge" href="https://medium.com/u/d5885adb1ddf?source=post_page-----3666596a8888--------------------------------" rel="noopener" target="_blank"> <em class="mr">弗洛里纳·芒特内斯库</em> </a> <em class="mr">，</em> <a class="ms mt ge" href="https://medium.com/u/c967b7e51f8b?source=post_page-----3666596a8888--------------------------------" rel="noopener" target="_blank"> <em class="mr">罗曼·盖伊</em> </a> <em class="mr">，纳德·贾瓦德对本帖的宝贵反馈。</em></p></div></div>    
</body>
</html>