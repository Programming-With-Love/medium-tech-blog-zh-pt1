<html>
<head>
<title>Demystify the TensorFlow APIs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">揭开TensorFlow APIs的神秘面纱</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/demystify-the-tensorflow-apis-57d2b0b8b6c0?source=collection_archive---------3-----------------------#2018-11-13">https://medium.com/google-developer-experts/demystify-the-tensorflow-apis-57d2b0b8b6c0?source=collection_archive---------3-----------------------#2018-11-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="4b6c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您是否对使用哪些TensorFlow APIs感到困惑？在这篇博文中，我将向您概述TensorFlow中的各种<strong class="ig hi">模型构建</strong>API，以及它们是如何组合在一起的。我将介绍一些最佳实践，并回答一些常见问题。</p><p id="8dac" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">TensorFlow团队在开发更易于使用的API方面投入了大量精力，TensorFlow正在快速发展。这篇博客文章涵盖了当前的状态(从TensorFlow 1.12开始)和TensorFlow 2.0的一瞥。</p><h1 id="5c08" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">介绍</h1><p id="34cd" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">2015年末开源的TensorFlow是最受欢迎的深度学习框架。它同时面向<strong class="ig hi">的研究人员</strong>和<strong class="ig hi">的开发者</strong>。</p><p id="0447" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">张量流<strong class="ig hi">灵活</strong>:</p><ul class=""><li id="9a3f" class="kf kg hh ig b ih ii il im ip kh it ki ix kj jb kk kl km kn bi translated">用tf之类的高级API写TensorFlow代码。Keras(推荐)，估计器，或者在低级API中，如果你需要更好的控制。</li><li id="1d52" class="kf kg hh ig b ih ko il kp ip kq it kr ix ks jb kk kl km kn bi translated">用不同的语言写TensorFlow代码:Python，JavaScript或者SWIFT。</li><li id="fc31" class="kf kg hh ig b ih ko il kp ip kq it kr ix ks jb kk kl km kn bi translated">在CPU、GPU或TPU上进行培训，并部署到移动(Android / iOS)、Web、Android Things、Raspberry Pi和AIY套件等。</li></ul><p id="9be3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">TensorFlow的灵活性也给其架构带来了<strong class="ig hi">复杂性</strong>。我经常听到类似这样的问题(无论是初学者还是TensorFlow的专家用户)“tf有什么不同？Keras和其他TensorFlow高级API？我选哪个？”所以我写了这篇博文来帮助澄清一些常见的问题:</p><ul class=""><li id="4bd3" class="kf kg hh ig b ih ii il im ip kh it ki ix kj jb kk kl km kn bi translated">tf。Keras还是Keras？</li><li id="6686" class="kf kg hh ig b ih ko il kp ip kq it kr ix ks jb kk kl km kn bi translated">tf。Keras还是估计量？</li><li id="3284" class="kf kg hh ig b ih ko il kp ip kq it kr ix ks jb kk kl km kn bi translated">低级TensorFlow APIs还是高级API？</li><li id="aaff" class="kf kg hh ig b ih ko il kp ip kq it kr ix ks jb kk kl km kn bi translated">热切的执行是如何融入这一切的？</li></ul><h1 id="5d49" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">TensorFlow(模型构建)API</h1><p id="e757" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">首先让我们从TensorFlow模型构建API的各种选项开始，从低级到高级:</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="kz la di lb bf lc"><div class="er es kt"><img src="../Images/b7fdf9902c94bf85d05e0714eab96236.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DQEBDw-wdXuw_5tqLLinBg.png"/></div></div></figure><p id="0772" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">注意:</strong>TF . layers API将随TensorFlow 2.0一起消失。建议你用tf。Keras将取代tf.layers API。</p><h1 id="56f3" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">tf.keras还是keras？</h1><p id="1a23" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">如果你是深度学习新手，刚入门，从<a class="ae lf" href="https://www.tensorflow.org/guide/keras" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi"> tf开始。Keras </strong> </a>是作为TensorFlow核心API的一部分集成的Keras。Keras继续作为一个独立的开源项目。</p><ul class=""><li id="1e98" class="kf kg hh ig b ih ii il im ip kh it ki ix kj jb kk kl km kn bi translated">不再问“我用Keras还是TensorFlow？”因为Keras现在是TensorFlow的一部分。</li><li id="dfa8" class="kf kg hh ig b ih ko il kp ip kq it kr ix ks jb kk kl km kn bi translated">不需要“以TensorFlow作为后端的Keras”，因为Keras现在是TensorFlow的一部分。您可以继续使用Theano和CNTK等。作为Keras后端，如果你愿意。</li></ul><p id="8e94" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，与其将keras作为单独的包导入:</p><pre class="ku kv kw kx fd lg lh li lj aw lk bi"><span id="10eb" class="ll jd hh lh b fi lm ln l lo lp">$ pip install keras<br/>import keras as keras</span></pre><p id="11b9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用keras作为TensorFlow核心API的一部分:</p><pre class="ku kv kw kx fd lg lh li lj aw lk bi"><span id="e143" class="ll jd hh lh b fi lm ln l lo lp">$ pip install --upgrade tensorflow<br/>import tensorflow as tf<br/>from tensorflow import keras</span></pre><blockquote class="lq lr ls"><p id="18b8" class="ie if lt ig b ih ii ij ik il im in io lu iq ir is lv iu iv iw lw iy iz ja jb ha bi translated"><strong class="ig hi">常见问题:“我为什么要用tf。喀拉斯？”</strong>用tf。Keras代替Keras是为了更好地与其他TensorFlow APIs集成，如<a class="ae lf" href="https://www.tensorflow.org/guide/eager" rel="noopener ugc nofollow" target="_blank">急切执行</a>和<a class="ae lf" href="https://www.tensorflow.org/guide/datasets" rel="noopener ugc nofollow" target="_blank"> tf.data </a>等。</p></blockquote><p id="d512" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在tf中有三种创建模型的方法。Keras:</p><ol class=""><li id="4027" class="kf kg hh ig b ih ii il im ip kh it ki ix kj jb lx kl km kn bi translated"><strong class="ig hi">顺序</strong>API——使用顺序API，您可以使用大约10行代码来定义和训练图像分类模型。看看我写的这篇关于如何用tf分类<a class="ae lf" href="http://bit.ly/fashion-mnist-with-keras" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi">时尚-MNIST的教程。以Keras </strong> </a> <strong class="ig hi"> </strong>为例。</li><li id="0bf5" class="kf kg hh ig b ih ko il kp ip kq it kr ix ks jb lx kl km kn bi translated"><strong class="ig hi">功能性</strong>API——关于这一点的一个很好的教程是<a class="ae lf" rel="noopener" href="/tensorflow/predicting-the-price-of-wine-with-the-keras-functional-api-and-tensorflow-a95d1c2c1b03"> <strong class="ig hi">用Keras功能性API和TensorFlow </strong> </a>预测葡萄酒的价格。</li><li id="4a8d" class="kf kg hh ig b ih ko il kp ip kq it kr ix ks jb lx kl km kn bi translated"><strong class="ig hi">模型子类化—<a class="ae lf" href="http://tensorflow.org" rel="noopener ugc nofollow" target="_blank">Tensorflow.org</a>上的<a class="ae lf" href="https://www.tensorflow.org/guide/keras" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi"> TensorFlow Keras指南</strong> </a>中有这方面的例子。那里还有很多其他很棒的tf.keras教程和示例代码。</strong></li></ol><blockquote class="lq lr ls"><p id="25c6" class="ie if lt ig b ih ii ij ik il im in io lu iq ir is lv iu iv iw lw iy iz ja jb ha bi translated"><strong class="ig hi"> Protip: </strong> <a class="ae lf" href="https://www.manning.com/books/deep-learning-with-python" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi">用Python进行深度学习</strong> </a>弗朗索瓦·乔莱(Franç ois Chollet)的书是一本学习Keras的好书。</p></blockquote><h1 id="b147" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">tf。Keras还是估计量？</h1><p id="684e" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">Estimators是另一个高级TensorFlow API，它通过封装训练、评估、预测和服务导出的步骤来简化ML过程。</p><p id="3c3f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有两种类型的估计器:1) <strong class="ig hi">预制估计器</strong>和2) <strong class="ig hi">定制估计器</strong>。根据官方TensorFlow文档，预制估算器和定制估算器之间的差异在于模型函数:</p><ul class=""><li id="ce5b" class="kf kg hh ig b ih ii il im ip kh it ki ix kj jb kk kl km kn bi translated"><strong class="ig hi">预制估算器</strong>:模型函数已经为你写好了。当你不想训练你自己的模型时，这些是你盒子里的模型。</li><li id="bc5c" class="kf kg hh ig b ih ko il kp ip kq it kr ix ks jb kk kl km kn bi translated"><strong class="ig hi">自定义估算器</strong>:需要自己编写模型函数。</li></ul><p id="808e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">建议您在编写自己的定制估算器之前，先研究一下预制的估算器，看看它是否能解决您的问题。</p><h2 id="a65d" class="ll jd hh bd je ly lz ma ji mb mc md jm ip me mf jq it mg mh ju ix mi mj jy mk bi translated"><strong class="ak">预制估算器</strong></h2><p id="bcac" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">预制估计量是tf.estimator.Estimator基类的子类。预制估值器的例子包括DNNClassifier、LinearClassifier、LinearRegressor等。</p><h2 id="03eb" class="ll jd hh bd je ly lz ma ji mb mc md jm ip me mf jq it mg mh ju ix mi mj jy mk bi translated">自定义评估员</h2><p id="78f4" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">到目前为止，有3种可能性来定义用于创建定制估计器的模型:</p><ol class=""><li id="0c8c" class="kf kg hh ig b ih ii il im ip kh it ki ix kj jb lx kl km kn bi translated">用Keras定义你的模型，然后把它变成一个估计器。(<a class="ae lf" href="https://www.tensorflow.org/api_docs/python/tf/keras/estimator/model_to_estimator" rel="noopener ugc nofollow" target="_blank">链接</a>)</li><li id="47b3" class="kf kg hh ig b ih ko il kp ip kq it kr ix ks jb lx kl km kn bi translated">使用来自<a class="ae lf" href="https://www.tensorflow.org/hub/" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi"> TensorFlow Hub </strong> </a>的模块，这是一个可重复使用的机器学习模块库。[对TensorFlow团队的反馈:请为我们提供一些TensorFlow Hub如何与tf.Keras一起工作的好例子]</li><li id="d254" class="kf kg hh ig b ih ko il kp ip kq it kr ix ks jb lx kl km kn bi translated">使用层的API编写函数。这里的见例<a class="ae lf" href="https://www.tensorflow.org/guide/custom_estimators" rel="noopener ugc nofollow" target="_blank">。<strong class="ig hi">注意:</strong> tf.layers将从TensorFlow 2.0中移除，但您可以使用tf.keras.layers来实现此目的。</a></li></ol><blockquote class="lq lr ls"><p id="7671" class="ie if lt ig b ih ii ij ik il im in io lu iq ir is lv iu iv iw lw iy iz ja jb ha bi translated"><strong class="ig hi">常见问题—“我需要使用评估员API吗？”</strong>在我看来，跟tf走。除非你想利用预制的估计。注意:在最近的TensorFlow 1.12版本中，Keras模型现在可以直接导出为SavedModel格式(<code class="du ml mm mn lh b">tf.contrib.saved_model.save_keras_model()</code>)并与TensorFlow服务一起使用。</p></blockquote><h1 id="73b2" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">TensorFlow低级API</h1><p id="ab7d" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">在低级API中，你将使用张量、常数、占位符、图形和会话等。直接。一些学习资源:</p><ul class=""><li id="d413" class="kf kg hh ig b ih ii il im ip kh it ki ix kj jb kk kl km kn bi translated">张量流<a class="ae lf" href="https://www.tensorflow.org/guide/low_level_intro" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi">低级张量流官方文档</strong> </a></li><li id="e9ec" class="kf kg hh ig b ih ko il kp ip kq it kr ix ks jb kk kl km kn bi translated">博客帖子<a class="ae lf" href="https://jacobbuckman.com/post/tensorflow-the-confusing-parts-1/" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi"> TensorFlow:令人困惑的部分</strong> </a>，由Jacob Buckman撰写，详细介绍了这方面的内容。</li></ul><blockquote class="lq lr ls"><p id="efa1" class="ie if lt ig b ih ii ij ik il im in io lu iq ir is lv iu iv iw lw iy iz ja jb ha bi translated"><strong class="ig hi">常见问题</strong> : <strong class="ig hi">“我什么时候需要写低级张量流代码？”如果你是一名研究深度学习的学生或需要对你的实验进行更大控制的研究人员，你只需要在这个低水平上工作；否则就坚持使用高级API。</strong></p></blockquote><h1 id="727f" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">急切的执行</h1><p id="3b6e" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">2017年底，在博客文章<a class="ae lf" href="https://developers.googleblog.com/2017/10/eager-execution-imperative-define-by.html" rel="noopener ugc nofollow" target="_blank">中宣布了渴望执行:TensorFlow </a>的一个命令式、由运行定义的接口。从TensorFlow 1.7开始就搬出了contrib。</p><p id="55a8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是TensorFlow的一个重要特性，使您能够在不创建图形的情况下调试tensor flow—调用session.run()。热切的执行让TensorFlow更加直观和pythonic化。您只需要一行代码来实现急切执行:</p><pre class="ku kv kw kx fd lg lh li lj aw lk bi"><span id="49e8" class="ll jd hh lh b fi lm ln l lo lp">import tensorflow as tf<br/>import tensorflow.contrib.eager as tfe</span><span id="847d" class="ll jd hh lh b fi mo ln l lo lp"># Enable eager execution<br/>tfe.enable_eager_execution()</span></pre><p id="c40e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里有一个很好的<a class="ae lf" href="https://twitter.com/i/moments/999070517108748289?lang=en" rel="noopener ugc nofollow" target="_blank">例子</a>,展示了启用渴望模式如何使调试变得更容易。</p><blockquote class="lq lr ls"><p id="0cc9" class="ie if lt ig b ih ii ij ik il im in io lu iq ir is lv iu iv iw lw iy iz ja jb ha bi translated"><strong class="ig hi"> Protip: </strong>在渴望模式下使用defun提升性能。</p></blockquote><p id="5f6d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">急切执行可能比执行等价的图要慢，因为它不能从图的整体程序优化中受益，并且还会导致解释Python代码的开销。您可以使用<a class="ae lf" href="https://www.tensorflow.org/api_docs/python/tf/contrib/eager/defun" rel="noopener ugc nofollow" target="_blank"><strong class="ig hi">TF . contrib . eager . defun</strong></a>来创建图形函数并获得性能提升。例如，在您的培训步骤中调用defun，如下所示:</p><pre class="ku kv kw kx fd lg lh li lj aw lk bi"><span id="49de" class="ll jd hh lh b fi lm ln l lo lp"># define train_step function<br/>...</span><span id="9d0c" class="ll jd hh lh b fi mo ln l lo lp"># use defun on train_step</span><span id="74ec" class="ll jd hh lh b fi mo ln l lo lp">train_step = tf.contrib.eager.defun(train_step)</span></pre><blockquote class="lq lr ls"><p id="c5d3" class="ie if lt ig b ih ii ij ik il im in io lu iq ir is lv iu iv iw lw iy iz ja jb ha bi translated"><strong class="ig hi"> Protip </strong>:研究用<strong class="ig hi">急切执行</strong>，生产用<strong class="ig hi">图形执行</strong>。</p></blockquote><p id="53f2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">TensorFlow有一个名为<strong class="ig hi"> Autograph </strong>的新功能，它将使渴望模式和图形模式之间的转换无缝进行——在这里阅读TensorFlow团队<a class="ae lf" rel="noopener" href="/tensorflow/autograph-converts-python-into-tensorflow-graphs-b2a871f87ec7">的博客文章。同样在TensorFlow 2.0中，渴望模式将成为默认模式。</a></p></div><div class="ab cl mp mq go mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ha hb hc hd he"><p id="aa6b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">总之，启用<strong class="ig hi">急切执行</strong>并将TensorFlow代码写入<strong class="ig hi"> tf。喀拉斯</strong>。TensorFlow团队正在努力使我们的过程尽可能简单。他们还在tensor flow 2.0<strong class="ig hi"/>中提供了关于高级API的官方<a class="ae lf" rel="noopener" href="/tensorflow/standardizing-on-keras-guidance-on-high-level-apis-in-tensorflow-2-0-bad2b04c819a"> <strong class="ig hi">指南，其中包含了我上面讨论的主题的更多细节。我期待TensorFlow 2.0有更简单的API、更好的文档和更多的示例代码。</strong></a></p></div></div>    
</body>
</html>