<html>
<head>
<title>Data Conflict Solution for ADF BC REST with Versioning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ADF BC REST与版本控制的数据冲突解决方案</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/data-conflict-solution-for-adf-bc-rest-with-versioning-d94c710daca4?source=collection_archive---------1-----------------------#2018-08-06">https://medium.com/oracledevs/data-conflict-solution-for-adf-bc-rest-with-versioning-d94c710daca4?source=collection_archive---------1-----------------------#2018-08-06</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="74b0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我想分享在ADF BC REST中使用版本控制处理数据冲突的示例解决方案。当多个用户同时编辑同一数据行时，在覆盖其他用户已经提交的更改之前通知用户是很重要的。实现数据冲突控制还有其他方法，在应用之前，您应该评估下面解释的解决方案是否适合您的用例。</p><p id="b0c9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">示例代码可以从<a class="ae jc" href="https://github.com/abaranovskis-redsamurai/ADFBCRestApp" rel="noopener ugc nofollow" target="_blank"> GitHub </a>资源库获得。</p><p id="54e6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我使用自定义更改指示器属性来评估客户端数据是否过期。改变指示符值与请求数据一起被发送到客户端。补丁请求必须包括当前客户端更改指示符值，如果更改指示符与后端中的值匹配，则允许打补丁，否则新的更改指示符将返回给客户端，并且响应将标记有<em class="jd"> 409冲突</em>状态代码。基于此，客户端可以决定重新提交带有新更改指示符的补丁请求并覆盖数据库中的当前数据，或者刷新客户端数据并尝试稍后提交更改。</p><p id="c65c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本例中——使用有效的变更指示器执行补丁，响应状态为<em class="jd"> 200 OK </em>。向客户端返回新的变更指示符值(应该在下一次对当前行进行补丁调用时提交):</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/5016122b19edc28d74217e7ff192c15c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xERYBqSEp-_Mxrw0KdJMAw.png"/></div></div></figure><p id="2263" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了测试数据更改冲突，我会直接转到DB并更改相同的记录。变更指示器也将更新:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jq"><img src="../Images/155d4e9b98706d35e06b5e7777aa0798.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XqZnOOMWFc1Pu7WHc3C0uw.png"/></div></div></figure><p id="ae17" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">客户端不知道更改指示器更新(数据已被另一个用户更改)。客户端将包括当前已知的更改指示符值并执行补丁。这将导致<em class="jd"> 409冲突</em>状态。后端在响应中返回最新的更改指示器值:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jr"><img src="../Images/bc807975ce98e8bf8708226d5c451fd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3AKIzBHWrFDM_FF1bRfThw.png"/></div></div></figure><p id="d4ef" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">数据未更新，补丁请求在后端停止:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es js"><img src="../Images/55480a28961f379302eead370b3b90b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nwSoHeLoABCtC1YaA-Z4lg.png"/></div></div></figure><p id="d6b7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">客户端知道最新的更改指示符值，并且可以再次提交它—这一次是成功的(在此期间没有其他人更改数据):</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jt"><img src="../Images/30ee26b4e7b64526e4e5c8e70d9289c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L7lLNYPE5efaG3rv-seB-g.png"/></div></div></figure><p id="ccda" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">返回状态<em class="jd"> 200 OK </em>，以及新的变化指示器值。数据库中的数据按预期更改:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jq"><img src="../Images/2ca5dc6ad0d95847b0849133b9a4d15f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f8T53sOkO3W0mO1kJxdeaw.png"/></div></div></figure><p id="0e32" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">后端实现并不复杂。您需要DB触发器，它将从DB序列中获取值，并将其分配给每个已更改的行:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es ju"><img src="../Images/1047b2102a58af37bfab9d3ca5e8a299.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qFVhEtjf-RSPu41tro4YBg.png"/></div></div></figure><p id="a9ac" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ADF BC REST包括更改指示器属性，它标记有<em class="jd">更新时刷新</em>支持。这允许获取从数据库触发器分配的最新值，并将其返回给客户端:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jv"><img src="../Images/5c0bffa21730e4cfa30d02db8e4cf708.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tRt9SP1nFp8ISK1ZwCrgoA.png"/></div></div></figure><p id="6fdf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在doDML方法中，我们比较当前存储在数据库中的变化指示器属性值和来自客户端的值。如果值不匹配(客户端没有最新值)—不允许更新:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jw"><img src="../Images/b2ce15080f42f2a286fb4f5c420cedce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P4vqo-JKGqPGKwuCccvgCg.png"/></div></div></figure><p id="0459" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当不允许更新时，我们还必须将HTTP响应代码更改为<em class="jd"> 409冲突</em>。这将允许在客户端执行错误回调，并采取必要的措施来处理客户端的数据冲突。HTTP响应代码是从自定义ADF BC REST筛选器设置的:</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es jx"><img src="../Images/9603eb169dfc6765b3baed8af9f73c5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O-bG-dQXr76_-HDhXUmH6Q.png"/></div></div></figure></div><div class="ab cl jy jz go ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ha hb hc hd he"><p id="e8ba" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jd">原载于2018年8月6日</em><a class="ae jc" href="http://andrejusb.blogspot.com/2018/08/data-conflict-solution-for-adf-bc-rest.html" rel="noopener ugc nofollow" target="_blank"><em class="jd">【andrejusb.blogspot.com</em></a><em class="jd">。</em></p></div></div>    
</body>
</html>