<html>
<head>
<title>Performance Testing of OAuth 2.0 authorization code secured APIs using JMeter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用JMeter对OAuth 2.0授权代码保护的API进行性能测试</h1>
<blockquote>原文：<a href="https://medium.com/version-1/performance-testing-of-oauth-2-0-authorization-code-secured-apis-using-jmeter-7a9d711716a1?source=collection_archive---------0-----------------------#2022-10-04">https://medium.com/version-1/performance-testing-of-oauth-2-0-authorization-code-secured-apis-using-jmeter-7a9d711716a1?source=collection_archive---------0-----------------------#2022-10-04</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/42edaf493abe5a0a9a6fe6bf6c237363.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NGwH2NKDEFhMbjAAODhdFg.jpeg"/></div></figure><p id="87a1" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">Apache JMeter java应用程序旨在测试功能行为和衡量性能。API认证的实现使它变得更加有趣，因为我们需要编写脚本来获取访问令牌，稍后可以使用这些令牌从API获取资源。OAuth 2.0授权代码授权类型身份验证实现需要基于用户的身份验证。这是通过使用JMeter中的Selenium、JavaScript和web driver sampler实现的。</p><h1 id="284c" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated"><strong class="ak">什么是OAuth 2.0？</strong></h1><p id="581d" class="pw-post-body-paragraph il im hh in b io ki iq ir is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji ha bi translated">授权框架是一种协议，允许用户授予第三方网站或应用程序对用户受保护资源的访问权限。它是一种标准，旨在允许网站或应用程序代表用户访问其他web应用程序托管的资源，而不必暴露他们的长期凭据甚至身份。</p><h1 id="dca7" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">先决条件</h1><ol class=""><li id="1a20" class="kn ko hh in b io ki is kj iw kp ja kq je kr ji ks kt ku kv bi translated">关于JMeter工作原理的基本知识。</li><li id="059f" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">Selenium web驱动程序基础知识。</li><li id="8ec9" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">应该安装JDK。</li><li id="cca7" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">使用JMeter中的插件管理器安装selenium/Web驱动程序支持插件。</li><li id="9dcf" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">设置环境变量。</li></ol><h1 id="8bfb" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">它是如何工作的</h1><figure class="lc ld le lf fd ii er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lb"><img src="../Images/e536f3cab52f91f22eb5a825eb4fe81e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1WCbLcETIgC_pgsUO4dFag.png"/></div></div></figure><ol class=""><li id="2273" class="kn ko hh in b io ip is it iw lk ja ll je lm ji ks kt ku kv bi translated">本机应用程序打开授权端点。</li><li id="4a66" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">会弹出一个浏览器对话框，要求输入用户名和密码。</li><li id="e7cb" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">用户输入用户名和密码。</li><li id="2157" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">授权端点返回一个授权码。</li><li id="54f3" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">请求被发送到令牌端点，提供授权码、客户端id、范围和来源。</li><li id="5ae3" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">令牌端点返回访问令牌和刷新令牌。</li><li id="3831" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">使用授权头中的这个访问令牌，向Web API发出请求。</li><li id="b69a" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">Web API验证令牌并将安全的数据和资源返回给应用程序。</li></ol><h1 id="ddef" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">授权代码流</h1><ol class=""><li id="0d35" class="kn ko hh in b io ki is kj iw kp ja kq je kr ji ks kt ku kv bi translated">在测试计划下添加一个线程组。</li><li id="0e98" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">添加WebDriver示例。</li><li id="dde8" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">添加一个Chrome驱动配置。</li><li id="d815" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">在Chrome驱动配置中设置Chrome driver.exe的路径，如下所示。</li></ol><figure class="lc ld le lf fd ii er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es ln"><img src="../Images/1757d0fa027c9f3721919d86966c461d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1ZSgL6Jw92uesNyWzeJRlw.png"/></div></div></figure><p id="6a73" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">5.添加视图结果树。</p><p id="46f5" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">6.从JMeter的配置元素中添加用户定义变量。</p><p id="fe7b" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">7.添加调试采样器。</p><h1 id="2e48" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">获取访问令牌的JMeter脚本</h1><figure class="lc ld le lf fd ii"><div class="bz dy l di"><div class="lo lp l"/></div></figure><ol class=""><li id="5287" class="kn ko hh in b io ip is it iw lk ja ll je lm ji ks kt ku kv bi translated">将代码放在WebDriver Sampler的脚本部分。</li><li id="e9d2" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">在脚本中，web驱动程序打开授权端点URL。</li><li id="2c65" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">该脚本输入用户名并单击next按钮。</li><li id="2ad1" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">该脚本输入密码并点击登录按钮。</li><li id="0e5c" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">单击弹出窗口中的是按钮。</li><li id="66e4" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">用户身份验证完成后，脚本中使用的函数“allstorage()”从浏览器的本地存储中获取刷新令牌密钥的令牌存储值。</li><li id="a655" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">令牌存储值为JSON格式的多个数据。</li><li id="1b71" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">使用“JSON.parse”方法，我们只从JSON中获取秘密值，并将其保存在一个名为“refress_Token”的变量中。</li></ol><h1 id="ca94" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">获取访问令牌的HTTP请求</h1><p id="21cb" class="pw-post-body-paragraph il im hh in b io ki iq ir is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji ha bi translated">创建一个HTTP POST请求来标记端点URL，如下所示。</p><figure class="lc ld le lf fd ii er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lq"><img src="../Images/7e2c7d5ddfdbfef6c646b72625798d58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ozO_9i09A3NTz9D57FuS9Q.png"/></div></div></figure><ol class=""><li id="e5bd" class="kn ko hh in b io ip is it iw lk ja ll je lm ji ks kt ku kv bi translated">添加从上述web驱动程序采样器脚本中检索的参数，如“cliend_id”、“scope”、“grant_type”和“refresh_token”。</li><li id="98f0" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">在get token请求中添加带有源名称值的HTTP头管理器，如下所示。</li></ol><figure class="lc ld le lf fd ii er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lr"><img src="../Images/adebddef0c2fa8fd9b7b1616de10ed1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OSgICqfpscxL7IcmJpGcHg.png"/></div></div></figure><p id="7387" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">3.添加JSON提取器，从get access token HTTP请求的JSON响应中检索访问令牌，如下所示。</p><figure class="lc ld le lf fd ii er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es ls"><img src="../Images/36bd96723903c4ebc8e6d78628facd3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8FDBkWLvHUmt71w6Yd6gFQ.png"/></div></div></figure><h1 id="c432" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">用API请求发送访问令牌</h1><ol class=""><li id="0b5e" class="kn ko hh in b io ki is kj iw kp ja kq je kr ji ks kt ku kv bi translated">创建新的HTTP请求</li><li id="6ef4" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">添加路径、服务器名称和请求正文。</li><li id="e801" class="kn ko hh in b io kw is kx iw ky ja kz je la ji ks kt ku kv bi translated">在HTTP请求采样器中添加一个HTTP头管理器，如下所示</li></ol><figure class="lc ld le lf fd ii er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lt"><img src="../Images/614852467408e63743d5a6210a82b10d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MABm5U0RYlYx5dldxf3EtQ.png"/></div></div></figure><p id="52bc" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">4.在HTTP头管理器中，将授权头名称和值添加为“Bearer ${access_token}”</p><p id="d330" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">5.添加源头名称和值。</p><p id="8a04" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">6.发送请求后，API对令牌进行身份验证，并将安全数据和资源返回给应用程序。</p><h1 id="fefb" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">结论</h1><p id="87b8" class="pw-post-body-paragraph il im hh in b io ki iq ir is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji ha bi translated">这就是使用JMeter对OAuth 2.0授权代码保护的API进行性能测试需要执行的步骤。</p><h1 id="9526" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">关于作者:</h1><p id="bde8" class="pw-post-body-paragraph il im hh in b io ki iq ir is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji ha bi translated">Rajeev Kalal是Version 1的测试自动化顾问。</p></div></div>    
</body>
</html>