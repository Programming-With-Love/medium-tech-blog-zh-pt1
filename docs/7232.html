<html>
<head>
<title>How Square makes its SDKs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Square如何制作其SDK</h1>
<blockquote>原文：<a href="https://medium.com/square-corner-blog/how-square-makes-its-sdks-6a0fd7ea4b2d?source=collection_archive---------5-----------------------#2017-07-28">https://medium.com/square-corner-blog/how-square-makes-its-sdks-6a0fd7ea4b2d?source=collection_archive---------5-----------------------#2017-07-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="481d" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">在Square，我们利用OpenAPI标准、Swagger Codegen &amp; GitHub以可扩展的方式构建和交付我们的客户端SDK。</h2></div><blockquote class="iw"><p id="403f" class="ix iy hh bd iz ja jb jc jd je jf jg dx translated">注意，我们已经行动了！如果您想继续了解Square的最新技术内容，请访问我们在https://developer.squareup.com/blog<a class="ae jh" href="https://developer.squareup.com/blog" rel="noopener ugc nofollow" target="_blank">的新家</a></p></blockquote><figure class="jj jk jl jm jn jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es ji"><img src="../Images/82009a76cde54fc333c256273c2031b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AqIqz_d42G1GjoXsIoq48A.jpeg"/></div></div></figure><p id="00d9" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp jg ha bi translated">Square的开发者平台团队与大多数团队有所不同。我们不是为我们的开发人员产品构建单独的API，而是专注于公开我们的第一方产品用来为开发人员创建无缝体验的API。我们有许多上游团队，他们是我们面向外部的API的利益相关者，不断地想要展示新的特性并做出改进。在决定我们应该如何构建我们的SDK时，这是一个重要的因素；我们不希望我们的团队成为瓶颈，在发布新功能之前，产品团队必须等待我们完成SDK的更新。我们避免这种情况的主要方法是SDK生成。</p><h1 id="cab5" class="kq kr hh bd ks kt ku kv kw kx ky kz la in lb io lc iq ld ir le it lf iu lg lh bi translated">SDK生成</h1><p id="5c75" class="pw-post-body-paragraph jv jw hh jx b jy li ii ka kb lj il kd ke lk kg kh ki ll kk kl km lm ko kp jg ha bi translated">我们使用了一个非常依赖SDK生成的过程，而不是手动编写我们的每个SDK(这不仅耗时、容易出错，而且会减慢SDK中新功能的发布)。SDK的生成有很多种，所以如果你正在考虑为你的SDK采用类似的方法，一定要考虑各种可能性，找到适合你的。我们的首选风格使用OpenAPI规范来定义我们的API端点，并使用Swagger Codegen以编程方式为SDK生成代码。</p><h2 id="46d0" class="ln kr hh bd ks lo lp lq kw lr ls lt la ke lu lv lc ki lw lx le km ly lz lg ma bi translated">美国石油学会技术规格</h2><p id="859f" class="pw-post-body-paragraph jv jw hh jx b jy li ii ka kb lj il kd ke lk kg kh ki ll kk kl km lm ko kp jg ha bi translated">我们使用<a class="ae jh" href="https://www.openapis.org/" rel="noopener ugc nofollow" target="_blank"> OpenAPI </a>标准来定义我们的API。对我们来说，这是一个<code class="du mb mc md me b">JSON</code>文件，它定义了url、要发出什么样的HTTP请求，以及要提供什么样的信息，或者期望为每个API端点获取什么样的信息。我们的规范由3个主要部分组成:一般信息/元数据、路径和模型。</p><h2 id="3ac4" class="ln kr hh bd ks lo lp lq kw lr ls lt la ke lu lv lc ki lw lx le km ly lz lg ma bi translated">一般信息/元数据</h2><p id="fcb8" class="pw-post-body-paragraph jv jw hh jx b jy li ii ka kb lj il kd ke lk kg kh ki ll kk kl km lm ko kp jg ha bi translated">规范的这一部分包含了API整体的一些描述性信息，比如在哪里可以找到许可信息，或者联系谁寻求帮助。</p><figure class="mf mg mh mi fd jo"><div class="bz dy l di"><div class="mj mk l"/></div></figure><h2 id="3b69" class="ln kr hh bd ks lo lp lq kw lr ls lt la ke lu lv lc ki lw lx le km ly lz lg ma bi translated">小路</h2><p id="8ef5" class="pw-post-body-paragraph jv jw hh jx b jy li ii ka kb lj il kd ke lk kg kh ki ll kk kl km lm ko kp jg ha bi translated">这些描述了API的各个端点(或URL路径)。它描述了发出什么样的<code class="du mb mc md me b">HTTP</code>请求，应该如何授权，应该在请求中添加什么样的信息，以及应该期望得到什么样的回报。在下面的例子中，你可以看到这是一个<code class="du mb mc md me b">POST</code>请求，在URL中有两个必需的参数，在主体中还有一个，你得到的是一个<code class="du mb mc md me b">CreateRefundResponse</code>对象。</p><figure class="mf mg mh mi fd jo"><div class="bz dy l di"><div class="mj mk l"/></div></figure><h2 id="55cd" class="ln kr hh bd ks lo lp lq kw lr ls lt la ke lu lv lc ki lw lx le km ly lz lg ma bi translated">模型</h2><p id="0e65" class="pw-post-body-paragraph jv jw hh jx b jy li ii ka kb lj il kd ke lk kg kh ki ll kk kl km lm ko kp jg ha bi translated">模型描述了API与之交互的不同对象。它们主要用于将来自API的JSON响应序列化为每种语言的本地对象。在这个<code class="du mb mc md me b">CreateRefundResponse</code>中，你可以看到它包含了几个其他的模型，还有一个描述，甚至是一个响应的例子。</p><figure class="mf mg mh mi fd jo"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="f717" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp jg ha bi translated">你可以在GitHub上的<a class="ae jh" href="https://github.com/square/connect-api-specification/blob/master/api.json" rel="noopener ugc nofollow" target="_blank">Connect-API-Specification</a>repo中看到我们规范的最新版本。</p><p id="c6ef" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp jg ha bi translated">规范是我们生成过程的重要部分，因为它是关于我们的API如何工作的事实的来源。当其他团队想要扩展他们的API，发布新的API，或者只是增加模型描述的清晰度时，他们可以对这个文件进行编辑，并将他们的更改传播到所有的客户端SDK。我们实际上从描述内部服务到服务通信的文件中生成我们的大部分规范，以实现更多的流程自动化和更容易的更改。</p><h1 id="4d9e" class="kq kr hh bd ks kt ku kv kw kx ky kz la in lb io lc iq ld ir le it lf iu lg lh bi translated">斯瓦格代码根</h1><p id="6d25" class="pw-post-body-paragraph jv jw hh jx b jy li ii ka kb lj il kd ke lk kg kh ki ll kk kl km lm ko kp jg ha bi translated">既然我们已经准备好了API的规范，那么我们如何将它转化为面向客户端的SDK呢？答案是Swagger Codegen。Swagger Codegen是一个由<a class="ae jh" href="https://smartbear.com/" rel="noopener ugc nofollow" target="_blank"> Smartbear </a>(就像其他Swagger工具一样)支持的开源项目，它将您的开放API规范应用于一系列不同语言的SDK模板，并加入了一些配置。</p><h2 id="ef66" class="ln kr hh bd ks lo lp lq kw lr ls lt la ke lu lv lc ki lw lx le km ly lz lg ma bi translated">模板</h2><p id="cd88" class="pw-post-body-paragraph jv jw hh jx b jy li ii ka kb lj il kd ke lk kg kh ki ll kk kl km lm ko kp jg ha bi translated">模板使用一种叫做<a class="ae jh" href="https://mustache.github.io/" rel="noopener ugc nofollow" target="_blank"> mustache </a>的语言来定义它们的部分，并且在很大程度上看起来和读起来像是一个期望语言的文件。下面这个是我们PHP SDK模板的一部分。您可以看到，像代码注释这样有用的东西也是自动生成的，所以最终SDK可以内置文档、片段等。</p><figure class="mf mg mh mi fd jo"><div class="bz dy l di"><div class="mj mk l"/></div></figure><h2 id="850a" class="ln kr hh bd ks lo lp lq kw lr ls lt la ke lu lv lc ki lw lx le km ly lz lg ma bi translated">配置</h2><p id="b209" class="pw-post-body-paragraph jv jw hh jx b jy li ii ka kb lj il kd ke lk kg kh ki ll kk kl km lm ko kp jg ha bi translated">这些实际上并不复杂，本质上是描述你的SDK的各个方面的小<code class="du mb mc md me b">json</code>文件，通常围绕着它如何适合相关的包管理器。</p><figure class="mf mg mh mi fd jo"><div class="bz dy l di"><div class="mj mk l"/></div></figure><p id="60a2" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp jg ha bi translated">因为Codegen项目非常活跃，所以我们实际上为每个支持的SDK签入了模板文件的副本，并固定到特定的Codegen版本，以确保我们不会因为所有的自动化而意外地将重大更改推送给我们的用户。您可以在与我们的规范文件相同的存储库中看到支持{Java、PHP、C#、Python、Ruby、JavaScript } SDKs的所有模板和配置文件:<a class="ae jh" href="https://github.com/square/connect-api-specification/tree/master/swagger-templates" rel="noopener ugc nofollow" target="_blank">Connect-API-Specification</a>。</p><h2 id="a331" class="ln kr hh bd ks lo lp lq kw lr ls lt la ke lu lv lc ki lw lx le km ly lz lg ma bi translated">其他想法</h2><p id="1c71" class="pw-post-body-paragraph jv jw hh jx b jy li ii ka kb lj il kd ke lk kg kh ki ll kk kl km lm ko kp jg ha bi translated">我们的流程有了很大的发展，Travis CI等工具在流程中产生了巨大的影响。您可以使用CI &amp; CD工具来使这个过程更加自动化，但是要确保您有一套好的测试覆盖范围来帮助防止意外的变化悄悄进入您发布的代码。</p><p id="72c5" class="pw-post-body-paragraph jv jw hh jx b jy jz ii ka kb kc il kd ke kf kg kh ki kj kk kl km kn ko kp jg ha bi translated">希望您喜欢我们的SDK生成流程。你也可以在这里看到我在DevRelCon上关于这个主题的演讲录音。如果你想了解更多关于我们的SDK，或者Square的其他技术方面，一定要关注这个<a class="ae jh" href="https://medium.com/square-corner-blog" rel="noopener">博客</a>，我们的<a class="ae jh" href="https://twitter.com/SquareDev" rel="noopener ugc nofollow" target="_blank">推特</a>账号，并注册我们的<a class="ae jh" href="https://www.workwithsquare.com/developer-newsletter.html?channel=Online%20Social&amp;sqmethod=Blog" rel="noopener ugc nofollow" target="_blank">开发者简讯</a>！</p></div></div>    
</body>
</html>