<html>
<head>
<title>How to use Puppet Modules for IT Infrastructure Automation?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将Puppet模块用于IT基础设施自动化？</h1>
<blockquote>原文：<a href="https://medium.com/edureka/puppet-modules-bb07c2e74f41?source=collection_archive---------4-----------------------#2019-10-18">https://medium.com/edureka/puppet-modules-bb07c2e74f41?source=collection_archive---------4-----------------------#2019-10-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/0afab26b2db1373fab2f591c52401b36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1388/format:webp/1*vQGn0prFTUcX-XrC47JhIw.png"/></div></figure><p id="5edf" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">以前，系统管理员使用shell脚本来运行他们的服务器，这种方法的可伸缩性为零。为成百上千个不断变化的服务器及其系统配置不断修改脚本是一项令人望而生畏的任务。</p><p id="5eb7" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在这篇关于<strong class="in hi">傀儡模块&amp;清单</strong>的文章中，让我们看看如何使用傀儡模块来自动化服务器设置、程序安装和系统管理。</p><p id="a6b5" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">本博客将涵盖以下主题:</p><ul class=""><li id="68c2" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">木偶编程入门</li><li id="8fd2" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">木偶编程中的关键术语</li><li id="a36e" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">木偶程序工作流程</li><li id="e602" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">演示:自动安装Apache和MySQL</li></ul><h1 id="14af" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">木偶编程入门</h1><p id="c5f2" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">Puppet是广泛用于配置管理的流行DevOps工具之一。它用于在基础架构中实现<em class="la">一致性</em>。Puppet可以将基础设施定义为代码，管理多个服务器，并执行系统配置，从而帮助自动化基础设施管理过程。</p><p id="55d5" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">Puppet有自己的配置语言，<code class="du lb lc ld le b"><strong class="in hi">Puppet DSL</strong></code>。与其他DevOps程序一样，Puppet自动化了更改，消除了手动脚本驱动的更改。但是，Puppet不是简单的另一种shell语言，也不是纯粹的编程语言，比如PHP。相反，Puppet使用一种<strong class="in hi">基于声明性模型的方法</strong>来实现IT自动化。这使得Puppet能够将基础设施定义为代码，并通过程序来执行系统配置。</p><p id="bdc7" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在开始演示之前，让我们先看看puppet编程的几个核心方面。</p><h1 id="ea0e" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak">木偶编程中的关键术语</strong></h1><h2 id="4c09" class="lf jy hh bd jz lg lh li kd lj lk ll kh iw lm ln kl ja lo lp kp je lq lr kt ls bi translated">表明</h2><p id="d3dc" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">一个傀儡程序被称为<strong class="in hi">清单</strong>，其文件名为<strong class="in hi">。pp </strong>扩展。Puppet的默认主清单是<code class="du lb lc ld le b"><em class="la">/etc/puppet/manifests/site.pp</em></code>。(这定义了全局系统配置，如LDAP配置、DNS服务器或适用于每个节点的其他配置)。</p><h2 id="2616" class="lf jy hh bd jz lg lh li kd lj lk ll kh iw lm ln kl ja lo lp kp je lq lr kt ls bi translated">班级</h2><p id="4b04" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">在这些清单中有其他模块可以调用的称为<strong class="in hi">类</strong>的代码块。类配置大型或中型的功能块，例如运行应用程序所需的所有包、配置文件和服务。类使得重用Puppet代码和提高可读性变得更加容易。</p><h2 id="f0c4" class="lf jy hh bd jz lg lh li kd lj lk ll kh iw lm ln kl ja lo lp kp je lq lr kt ls bi translated">资源</h2><p id="86f2" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">Puppet代码主要由资源声明组成。<strong class="in hi">资源</strong>描述了关于系统期望状态的特定元素。例如，它可以包括一个特定的文件应该存在或一个软件包应该安装。</p><h2 id="d5bb" class="lf jy hh bd jz lg lh li kd lj lk ll kh iw lm ln kl ja lo lp kp je lq lr kt ls bi translated">木偶模块</h2><p id="21eb" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">除了主<code class="du lb lc ld le b">site.pp</code>清单，它在<strong class="in hi">模块</strong>中存储清单。</p><p id="50bb" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我们所有的puppet代码都组织在模块中，这些模块是我们可以重用和共享的Puppet的基本构件。每个模块管理基础设施中的特定任务，例如安装和配置一个软件。</p><p id="67c6" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">模块包含Puppet类、定义的类型、任务、任务计划、容量、资源类型和插件，例如自定义类型或事实。在Puppet模块路径中安装模块。Puppet从模块路径中的每个模块加载所有内容，使这段代码可供使用。</p><figure class="lu lv lw lx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es lt"><img src="../Images/c589a3600dd4462ee76d81b4fbc89019.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3TGXwZNMUb0T4u7g.png"/></div></div></figure><p id="7992" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">Puppetlabs有预定义的模块，我们可以通过从<code class="du lb lc ld le b"><a class="ae mc" href="https://forge.puppet.com/" rel="noopener ugc nofollow" target="_blank"><strong class="in hi">PuppetForge</strong></a></code>下载它们来立即使用。您还可以创建一个定制的puppet模块来满足您的需求。</p><h1 id="1c23" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated"><strong class="ak">木偶程序工作流程</strong></h1><p id="2e22" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">我们将使用Puppet的声明性语言在称为清单的文件中描述系统的期望状态。清单描述了应该如何配置网络和操作系统资源，如文件、包和服务。</p><figure class="lu lv lw lx fd ii er es paragraph-image"><div class="er es md"><img src="../Images/edab0c507af05efc926f7758223cf49e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1158/format:webp/0*pUaXBgRQjF2eCRVe.png"/></div></figure><p id="9f32" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">Puppet将清单编译成<strong class="in hi">目录</strong>，并将每个目录应用到其对应的节点，以确保节点的配置在整个基础设施中是正确的。</p><h1 id="cf59" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">演示:自动安装Apache和MySQL</h1><p id="956e" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">这篇关于puppet模块的文章是实践性的，它将展示使用puppet模块的两种方法，并教你如何自动安装配置了这两个模块的服务器。</p><ul class=""><li id="36d9" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">从头开始创建一个木偶模块——Apache模块</li><li id="6206" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">使用PuppetForge的Puppet模块——MySQL模块</li><li id="9fe3" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">从傀儡主人到傀儡代理的傀儡模块的自动化安装</li></ul><p id="93ea" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">首先，确保您已经准备好一个傀儡基础设施，包括一个傀儡主服务器和2个傀儡代理。</p><ul class=""><li id="94bf" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">傀儡师:Ubuntu 18.04</li><li id="f476" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">代理1: Ubuntu 18.04</li><li id="1196" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">特工2: CentOS7</li></ul><p id="cee9" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">下面是我们将在这次实践中实现的目标的概述:</p><figure class="lu lv lw lx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es me"><img src="../Images/b3d9ee7a2c7da76cc9848af37cc68a70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RO-6X1jHp7xhApbc.png"/></div></div></figure><p id="e084" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">让我们从动手开始:</p><h2 id="62ee" class="lf jy hh bd jz lg lh li kd lj lk ll kh iw lm ln kl ja lo lp kp je lq lr kt ls bi translated">从头开始创建模块</h2><p id="3a8e" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">在这个puppet模块中，我们将处理下载Apache包、配置文件和设置虚拟主机等任务。</p><ul class=""><li id="b9c7" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">从Puppet Master中，导航到Puppet的模块目录并创建Apache目录:</li></ul><pre class="lu lv lw lx fd mf le mg mh aw mi bi"><span id="3c7b" class="lf jy hh le b fi mj mk l ml mm">cd /etc/puppet/modules<br/>sudo mkdir apache</span></pre><ul class=""><li id="b49c" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">在apache目录中，创建子目录:清单、模板、文件和示例。</li></ul><pre class="lu lv lw lx fd mf le mg mh aw mi bi"><span id="61f7" class="lf jy hh le b fi mj mk l ml mm">cd apache<br/>sudo mkdir {manifests, templates, files, examples}</span></pre><ul class=""><li id="76d0" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">导航到清单目录:</li><li id="34e7" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated"><code class="du lb lc ld le b">cd manifests</code></li><li id="7159" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">从这里开始，我们将根据代码部分的目标将模块分成不同的类。</li></ul><p id="0a8b" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> init.pp </strong> - &gt;下载Apache包</p><p id="8bde" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> params.pp </strong> - &gt;定义任何变量和参数</p><p id="8588" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> config.pp </strong> - &gt;管理Apache服务的任何配置文件。</p><p id="5541" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> vhosts.pp </strong> - &gt;定义虚拟主机。</p><p id="ae44" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">该模块还将利用<strong class="in hi"> Hiera </strong>(一个内置的键值配置数据查找系统，用于将数据从Puppet代码中分离出来)数据来存储每个节点的变量。</p><h2 id="6040" class="lf jy hh bd jz lg lh li kd lj lk ll kh iw lm ln kl ja lo lp kp je lq lr kt ls bi translated">步骤1:下载Apache包</h2><p id="6f8e" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">创建init.pp类</p><p id="93c5" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">现在我们将在manifests目录下创建一个<code class="du lb lc ld le b">init.pp</code>文件来保存apache包。<br/>因为我们有两个不同的操作系统(ubuntu和CentOS7)使用不同的Apache包名，所以我们必须使用一个变量<code class="du lb lc ld le b">$apachename</code>。</p><pre class="lu lv lw lx fd mf le mg mh aw mi bi"><span id="eb9c" class="lf jy hh le b fi mj mk l ml mm">/etc/puppetlabs/code/environments/production/modules/apache/manifests/init.pp</span><span id="6c04" class="lf jy hh le b fi mn mk l ml mm">class apache {<br/>package { 'apache':<br/>name    =&gt; $apachename,<br/>ensure  =&gt; present,<br/>}<br/>}</span></pre><p id="c8b1" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> <em class="la">包</em> </strong>资源允许管理一个包。这用于添加、删除或确保包存在。</p><p id="419b" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在大多数情况下，资源的<strong class="in hi"> <em class="la">名称</em></strong>(Apache，如上)应该是被管理的包的名称。由于不同的命名约定，我们使用<em class="la">名称</em>引用来调用包的实际名称。所以<strong class="in hi"> </strong> <em class="la">取名</em>，称之为尚未定义的变量<code class="du lb lc ld le b">$apachename</code>。</p><p id="c8cd" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> <em class="la">确保</em> </strong>参考确保包存在。</p><h2 id="9d50" class="lf jy hh bd jz lg lh li kd lj lk ll kh iw lm ln kl ja lo lp kp je lq lr kt ls bi translated">创建params.pp文件</h2><p id="3670" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated"><code class="du lb lc ld le b">params.pp</code>文件将定义所需的变量。虽然我们可以在<code class="du lb lc ld le b">init.pp</code>文件中定义这些变量，但是由于需要在资源类型本身之外使用更多的变量，所以使用<code class="du lb lc ld le b"> params.pp</code>文件允许在if语句中定义变量，并在多个类中使用。</p><p id="7b99" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">创建一个<code class="du lb lc ld le b">params.pp</code>文件和下面的代码。</p><pre class="lu lv lw lx fd mf le mg mh aw mi bi"><span id="0458" class="lf jy hh le b fi mj mk l ml mm">/etc/puppetlabs/code/environments/production/modules/apache/manifests/params.pp</span><span id="ab2c" class="lf jy hh le b fi mn mk l ml mm">class apache::params {<br/>if $::osfamily == 'RedHat' {<br/>$apachename = 'httpd'<br/>}<br/>elsif $::osfamily == 'Debian' {<br/>$apachename = 'apache2'<br/>}<br/>else {<br/>fail('this is not a supported distro.')<br/>}<br/>}</span></pre><p id="0c18" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在最初的<code class="du lb lc ld le b">init.pp</code>类之外，每个类名都需要从apache中分支出来。我们称这个类为<strong class="in hi"> apache::params </strong>。双冒号后的名称应该与文件共享一个名称。如果该语句用于定义参数，从<strong class="in hi"> Facter </strong>提供的信息中提取，Puppet将Facter安装作为其安装本身的一部分。这里，Facter将下拉操作系统系列(osfamily)，以辨别它是<code class="du lb lc ld le b">Red Hat</code>还是<code class="du lb lc ld le b">Debian-based.</code></p><p id="0ba1" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">有了最终定义的参数，我们需要将<code class="du lb lc ld le b">params.pp</code>文件和参数调用到<code class="du lb lc ld le b">init.pp</code>中。为此，我们需要在类名之后、左花括号({)之前添加参数。</p><p id="eae5" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">所以我们之前创建的<code class="du lb lc ld le b">init.pp</code>应该是这样的:</p><pre class="lu lv lw lx fd mf le mg mh aw mi bi"><span id="fff3" class="lf jy hh le b fi mj mk l ml mm">class apache ( $apachename = $::apache::params::apachename,) inherits ::apache::params<br/>{<br/>package { 'apache':<br/>name =&gt; $apachename,<br/>ensure =&gt; present,<br/>}<br/>}</span></pre><p id="b995" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">值字符串<code class="du lb lc ld le b"><em class="la">$::apache::params::value</em></code>告诉Puppet从<strong class="in hi"> apache </strong>模块、<strong class="in hi"> params </strong>类中提取值，后跟参数名。片段<code class="du lb lc ld le b"><em class="la">inherits ::apache::params</em></code>允许<code class="du lb lc ld le b">init.pp</code>继承这些值。</p><h2 id="47f5" class="lf jy hh bd jz lg lh li kd lj lk ll kh iw lm ln kl ja lo lp kp je lq lr kt ls bi translated">步骤2:管理配置文件</h2><p id="a1c5" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">Apache配置文件会有所不同，这取决于您是在基于Red Hat还是基于Debian的系统上工作。</p><p id="1b95" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">你可以在这个演示的最后找到以下依赖文件:<code class="du lb lc ld le b"> httpd.conf</code>(红帽)<code class="du lb lc ld le b">apache2.conf</code> (Debian)。</p><ul class=""><li id="e04f" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">将<code class="du lb lc ld le b">httpd.conf</code>和<code class="du lb lc ld le b">apache2.conf</code>的内容复制到单独的文件中，保存在<code class="du lb lc ld le b"><em class="la">/etc/puppetlabs/code/environments/production/modules/apache/files.</em></code>的<strong class="in hi">文件</strong>目录下</li><li id="773d" class="jj jk hh in b io js is jt iw ju ja jv je jw ji jo jp jq jr bi translated">将这两个文件编辑为<strong class="in hi">禁用</strong> keepalive。您需要在<code class="du lb lc ld le b">httpd.conf</code>文件中添加行<strong class="in hi"> KeepAlive Off </strong>。如果你不想改变这个设置，我们应该在每个文件的顶部添加一个注释:<br/> <code class="du lb lc ld le b">/etc/puppetlabs/code/environments/production/modules/apache/files/httpd.conf</code></li></ul><p id="b65b" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><code class="du lb lc ld le b">#This file is managed by puppet</code></p><p id="76b8" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">将这些文件添加到<code class="du lb lc ld le b">init.pp</code>文件中，这样Puppet将知道这些文件在主服务器和代理节点上的位置。为此，我们使用<strong class="in hi"> <em class="la">文件</em> </strong>资源。</p><pre class="lu lv lw lx fd mf le mg mh aw mi bi"><span id="764a" class="lf jy hh le b fi mj mk l ml mm">/etc/puppetlabs/code/environments/production/modules/apache/manifests/init.pp</span><span id="4602" class="lf jy hh le b fi mn mk l ml mm">file { 'configuration-file':</span><span id="b96b" class="lf jy hh le b fi mn mk l ml mm">path    =&gt;$conffile,</span><span id="c7ce" class="lf jy hh le b fi mn mk l ml mm">ensure  =&gt;file,</span><span id="fbd3" class="lf jy hh le b fi mn mk l ml mm">source  =&gt;$confsource,</span><span id="7cdf" class="lf jy hh le b fi mn mk l ml mm">}</span></pre><p id="a586" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">因为我们在两个不同的位置有配置文件，所以我们给资源一个通用名称<strong class="in hi">配置文件</strong>，文件<strong class="in hi"> <em class="la">路径</em> </strong>被定义为一个带有path属性的参数。</p><p id="0326" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> <em class="la">保证</em> </strong>保证它是一个文件。</p><p id="e699" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> <em class="la">来源</em> </strong>提供了在傀儡师的位置上面创建的文件。</p><p id="57a3" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">打开<code class="du lb lc ld le b">params.pp </code>文件。</p><p id="4c7a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我们在if语句中定义了<code class="du lb lc ld le b">$conffile</code>和<code class="du lb lc ld le b">$confsource</code>变量:</p><pre class="lu lv lw lx fd mf le mg mh aw mi bi"><span id="7f39" class="lf jy hh le b fi mj mk l ml mm">/etc/puppetlabs/code/environments/production/modules/apache/manifests/params.pp</span><span id="ec17" class="lf jy hh le b fi mn mk l ml mm">if $::osfamily == 'RedHat' {<br/>...<br/>$conffile     = '/etc/httpd/conf/httpd.conf'<br/>$confsource   = 'puppet:///modules/apache/httpd.conf'<br/>}<br/>elsif $::osfamily == 'Debian' {<br/>...<br/>$conffile     = '/etc/apache2/apache2.conf'<br/>$confsource   = 'puppet:///modules/apache/apache2.conf'<br/>}<br/>else {<br/>...</span></pre><p id="d8fb" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我们需要将参数添加到<code class="du lb lc ld le b">init.pp</code>文件中apache类声明的开头，类似于前面的例子。</p><p id="efec" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">当配置文件改变时，Apache需要重新启动。为了实现自动化，我们可以将服务资源与<strong class="in hi"> <em class="la"> notify </em> </strong>属性结合使用，每当配置文件发生更改时，该属性将调用资源运行:</p><pre class="lu lv lw lx fd mf le mg mh aw mi bi"><span id="2491" class="lf jy hh le b fi mj mk l ml mm">/etc/puppetlabs/code/environments/production/modules/apache/manifests/init.pp</span><span id="a524" class="lf jy hh le b fi mn mk l ml mm">file { 'configuration-file':<br/>path    =&gt;$conffile,<br/>ensure  =&gt;file,<br/>source  =&gt;$confsource,<br/>notify  =&gt; Service['apache-service'],<br/>}<br/>service { 'apache-service':<br/>name          =&gt;$apachename,<br/>hasrestart    =&gt; true,<br/>}</span></pre><p id="2d70" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> <em class="la">服务</em> </strong>资源使用已经创建的参数，该参数定义了Red Hat和Debian系统上的Apache名称。<br/><strong class="in hi"><em class="la">has restart</em></strong>属性用于触发已定义服务的重启。</p><h2 id="70a1" class="lf jy hh bd jz lg lh li kd lj lk ll kh iw lm ln kl ja lo lp kp je lq lr kt ls bi translated">步骤3:创建虚拟主机文件</h2><p id="e9da" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">根据您的系统的分布，虚拟主机的文件将被不同地管理。因此，我们将把虚拟主机的代码放在一个if语句中，类似于在<code class="du lb lc ld le b">params.pp</code>类中使用的语句，但是包含实际的傀儡资源。</p><ul class=""><li id="8185" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">在Apache/manifest/目录中，创建并打开一个<code class="du lb lc ld le b">vhosts.pp</code>文件。添加if语句的框架:</li></ul><pre class="lu lv lw lx fd mf le mg mh aw mi bi"><span id="a1c3" class="lf jy hh le b fi mj mk l ml mm">/etc/puppetlabs/code/environments/production/modules/apache/manifests/vhosts.pp</span><span id="55d8" class="lf jy hh le b fi mn mk l ml mm">class apache::vhosts {<br/>if $::osfamily == 'RedHat' {<br/>}<br/>elsif $::osfamily == 'Debian' {<br/>}<br/>else {}<br/>}</span></pre><p id="c795" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">虚拟主机文件在CentOS 7服务器上的位置是<code class="du lb lc ld le b">/etc/httpd/conf.d/vhost.conf<strong class="in hi">.</strong></code>,您需要在Puppet master上创建该文件作为模板。对位于<code class="du lb lc ld le b">/etc/apache2/sites-available/example.com.conf</code>的Ubuntu虚拟主机文件做同样的操作，用服务器的FQDN替换example.com。</p><ul class=""><li id="698c" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">导航到<strong class="in hi"> apache </strong>模块中的<strong class="in hi">模板</strong>文件，然后为您的虚拟主机创建两个文件:</li></ul><p id="60d9" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi">对于红帽系统:</strong></p><pre class="lu lv lw lx fd mf le mg mh aw mi bi"><span id="2e99" class="lf jy hh le b fi mj mk l ml mm">/etc/puppetlabs/code/environments/production/modules/apache/templates/vhosts-rh.conf.erb<br/>&lt;VirtualHost *:80&gt;<br/>ServerAdmin &lt;%= <a class="ae mc" href="http://twitter.com/adminemail" rel="noopener ugc nofollow" target="_blank">@adminemail</a> %&gt;<br/>ServerName &lt;%= <a class="ae mc" href="http://twitter.com/servername" rel="noopener ugc nofollow" target="_blank">@servername</a> %&gt;<br/>ServerAlias www.&lt;%= <a class="ae mc" href="http://twitter.com/servername" rel="noopener ugc nofollow" target="_blank">@servername</a> %&gt;<br/>DocumentRoot /var/www/&lt;%= <a class="ae mc" href="http://twitter.com/servername" rel="noopener ugc nofollow" target="_blank">@servername</a> -%&gt;/public_html/<br/>ErrorLog /var/www/&lt;%- <a class="ae mc" href="http://twitter.com/servername" rel="noopener ugc nofollow" target="_blank">@servername</a> -%&gt;/logs/error.log<br/>CustomLog /var/www/&lt;%= <a class="ae mc" href="http://twitter.com/servername" rel="noopener ugc nofollow" target="_blank">@servername</a> -%&gt;/logs/access.log combined<br/>&lt;/Virtual Host&gt;</span></pre><p id="b7e3" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi">对于Debian系统:</strong></p><pre class="lu lv lw lx fd mf le mg mh aw mi bi"><span id="1f17" class="lf jy hh le b fi mj mk l ml mm">/etc/puppet/modules/apache/templates/vhosts-deb.conf.erb</span><span id="c583" class="lf jy hh le b fi mn mk l ml mm">&lt;VirtualHost *:80&gt;<br/>ServerAdmin &lt;%= <a class="ae mc" href="http://twitter.com/adminemail" rel="noopener ugc nofollow" target="_blank">@adminemail</a> %&gt;<br/>ServerName &lt;%= <a class="ae mc" href="http://twitter.com/servername" rel="noopener ugc nofollow" target="_blank">@servername</a> %&gt;<br/>ServerAlias www.&lt;%= <a class="ae mc" href="http://twitter.com/servername" rel="noopener ugc nofollow" target="_blank">@servername</a> %&gt;<br/>DocumentRoot /var/www/html/&lt;%= <a class="ae mc" href="http://twitter.com/servername" rel="noopener ugc nofollow" target="_blank">@servername</a> -%&gt;/public_html/<br/>ErrorLog /var/www/html/&lt;%- <a class="ae mc" href="http://twitter.com/servername" rel="noopener ugc nofollow" target="_blank">@servername</a> -%&gt;/logs/error.log<br/>CustomLog /var/www/html/&lt;%= <a class="ae mc" href="http://twitter.com/servername" rel="noopener ugc nofollow" target="_blank">@servername</a> -%&gt;/logs/access.log combined<br/>&lt;Directory /var/www/html/&lt;%= <a class="ae mc" href="http://twitter.com/servername" rel="noopener ugc nofollow" target="_blank">@servername</a> -%&gt;/public_html&gt;<br/>Require all granted<br/>&lt;/Directory&gt;<br/>&lt;/Virtual Host&gt;</span></pre><p id="e6de" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我们在这些文件中只使用了两个变量:<code class="du lb lc ld le b"><em class="la">adminemail</em></code>和<code class="du lb lc ld le b"><em class="la">servername</em></code>。我们将在<code class="du lb lc ld le b">site.pp</code>文件中逐个节点地定义它们。</p><ul class=""><li id="202d" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">返回到<code class="du lb lc ld le b"> vhosts.pp</code>文件。现在可以在代码中引用创建的模板:</li></ul><pre class="lu lv lw lx fd mf le mg mh aw mi bi"><span id="847e" class="lf jy hh le b fi mj mk l ml mm">/etc/puppetlabs/code/environments/production/modules/apache/manifests/vhosts.pp</span><span id="5561" class="lf jy hh le b fi mn mk l ml mm">class apache::vhosts {<br/>if $::osfamily == 'RedHat' {<br/>file { '/etc/httpd/conf.d/vhost.conf':<br/>ensure    =&gt; file,<br/>content   =&gt; template('apache/vhosts-rh.conf.erb'),<br/>}<br/>} elsif $::osfamily == 'Debian' {<br/>file { "/etc/apache2/sites-available/$servername.conf":<br/>ensure  =&gt; file,<br/>content  =&gt; template('apache/vhosts-deb.conf.erb'),<br/>}<br/>} else {<br/>fail('This is not a supported distro.')<br/>}<br/>}</span></pre><p id="5b9a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这两个分发系列都调用文件资源，并在各自的分发中采用虚拟主机位置的名称。对于Debian来说，这再次意味着引用<code class="du lb lc ld le b"> $servername</code>值。内容属性调用各自的模板。</p><ul class=""><li id="e19b" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">两个虚拟主机文件都引用两个目录。默认情况下，它们不在系统中。我们可以通过使用文件资源来创建它们，每个都在if语句中。完整的<code class="du lb lc ld le b"> vhosts.conf</code>文件应该类似于:</li></ul><pre class="lu lv lw lx fd mf le mg mh aw mi bi"><span id="9442" class="lf jy hh le b fi mj mk l ml mm">/etc/puppetlabs/code/environments/production/modules/apache/manifests/vhosts.pp</span><span id="4f67" class="lf jy hh le b fi mn mk l ml mm">class apache::vhosts {<br/>if $::osfamily == 'RedHat' {<br/>file { '/etc/httpd/conf.d/vhost.conf':<br/>ensure    =&gt; file,<br/>content   =&gt; template('apache/vhosts-rh.conf.erb'),<br/>}<br/>file { [ '/var/www/$servername',<br/>'/var/www/$servername/public_html',<br/>'/var/www/$servername/log', ]:<br/>ensure    =&gt; directory,<br/>}<br/>} elsif $::osfamily == 'Debian' {<br/>file { "/etc/apache2/sites-available/$servername.conf":<br/>ensure  =&gt; file,<br/>content  =&gt; template('apache/vhosts-deb.conf.erb'),<br/>}<br/>file { [ '/var/www/$servername',<br/>'/var/www/$servername/public_html',<br/>'/var/www/$servername/logs', ]:<br/>ensure    =&gt; directory,<br/>}<br/>} else {<br/>fail ( 'This is not a supported distro.')<br/>}<br/>}</span></pre><h2 id="ef03" class="lf jy hh bd jz lg lh li kd lj lk ll kh iw lm ln kl ja lo lp kp je lq lr kt ls bi translated">步骤4:测试模块</h2><ul class=""><li id="eab2" class="jj jk hh in b io kv is kw iw mo ja mp je mq ji jo jp jq jr bi translated">导航到<code class="du lb lc ld le b">apache/manifests/</code>目录，对所有文件运行<strong class="in hi">木偶解析器</strong>以确保木偶编码没有错误:</li></ul><pre class="lu lv lw lx fd mf le mg mh aw mi bi"><span id="d115" class="lf jy hh le b fi mj mk l ml mm">sudo /opt/puppetlabs/bin/puppet parser validate init.pp params.pp vhosts.pp</span></pre><p id="8cad" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">它应该返回空的，没有问题。</p><figure class="lu lv lw lx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mr"><img src="../Images/9303887f65283b5d3e8dd6637562e9c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nZiKaftc1mVSHMiz.png"/></div></div></figure><ul class=""><li id="50b2" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">导航到apache模块中的<strong class="in hi">示例</strong>目录。创建一个<code class="du lb lc ld le b">init.pp</code>文件并包含创建的类。用您自己的值替换<code class="du lb lc ld le b">$servername </code>和<code class="du lb lc ld le b">$adminemail</code>的值:</li></ul><pre class="lu lv lw lx fd mf le mg mh aw mi bi"><span id="c77e" class="lf jy hh le b fi mj mk l ml mm">/etc/puppetlabs/code/environments/production/modules/apache/examples/init.pp</span><span id="f40e" class="lf jy hh le b fi mn mk l ml mm">serveremail = '<a class="ae mc" href="mailto:webmaster@example.com" rel="noopener ugc nofollow" target="_blank">webmaster@example.com</a>'<br/>$servername = 'puppet.example.com'<br/>include apache<br/>include apache::vhosts</span></pre><ul class=""><li id="d8f6" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">通过使用<strong class="in hi">–noop</strong>标签:<br/> <code class="du lb lc ld le b">sudo /opt/puppetlabs/bin/puppet apply --noop init.pp</code>运行<strong class="in hi">木偶应用</strong>来测试模块</li></ul><figure class="lu lv lw lx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mr"><img src="../Images/8757a738878c1946c5b846151e12d893.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*U1ZSk8LIWwDAi8vE.png"/></div></div></figure><p id="92b8" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">它应该不返回任何错误，并输出它将从事件中触发刷新。要在Puppet master上安装和配置apache，如果需要的话，可以在没有–noop的情况下再次运行。</p><ul class=""><li id="8ad1" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">导航回主Puppet目录，然后导航到manifests文件夹(不是Apache模块中的文件夹)。</li></ul><p id="18a9" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><code class="du lb lc ld le b">cd /etc/puppetlabs/code/environments/production/manifests</code></p><p id="8c08" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">创建一个<code class="du lb lc ld le b">site.pp</code>文件，并为每个代理节点包含Apache模块。同时输入<code class="du lb lc ld le b">adminemail</code>和<code class="du lb lc ld le b">servername</code>参数的变量。您的<code class="du lb lc ld le b">site.pp</code>应该如下所示:</p><pre class="lu lv lw lx fd mf le mg mh aw mi bi"><span id="660e" class="lf jy hh le b fi mj mk l ml mm">/etc/puppetlabs/code/environments/production/manifests/site.pp</span><span id="1827" class="lf jy hh le b fi mn mk l ml mm">node 'puppet-agent-ubuntu.example.com' {<br/>$adminemail = '<a class="ae mc" href="mailto:webmaster@example.com" rel="noopener ugc nofollow" target="_blank">webmaster@example.com</a>'<br/>$servername = 'puppet.example.com'<br/>include apache<br/>include apache::vhosts<br/>}<br/>node 'puppet-agent-centos.example.com' {<br/>$adminemail = '<a class="ae mc" href="mailto:webmaster@example.com" rel="noopener ugc nofollow" target="_blank">webmaster@example.com</a>'<br/>$servername = 'puppet.example.com'<br/>include apache<br/>include apache::vhosts<br/>}</span></pre><p id="f189" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">默认情况下，受管节点上的Puppet agent服务将每30分钟自动检查一次主节点，并应用主节点上的任何新配置。您还可以在自动代理运行之间手动调用Puppet代理进程。要在代理节点上手动运行新模块，请登录到节点并运行:</p><p id="d7fb" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><code class="du lb lc ld le b">sudo /opt/puppetlabs/bin/puppet agent -t</code></p><p id="fb4b" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">既然我们已经学习了如何从头开始创建一个模块，那么让我们学习如何使用puppetlabs的puppet forge中已经存在的模块。</p><h2 id="884c" class="lf jy hh bd jz lg lh li kd lj lk ll kh iw lm ln kl ja lo lp kp je lq lr kt ls bi translated">使用PuppetForge的模块</h2><p id="c322" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">傀儡锻造已经有很多模块供服务器运行。我们可以像您创建的模块一样广泛地配置它们，并且可以节省时间，因为我们不需要从头开始创建模块。</p><p id="34a7" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">确保你在<code class="du lb lc ld le b"><em class="la">/etc/puppetlabs/code/environments/production/modules</em></code>目录下，安装<a class="ae mc" href="https://forge.puppetlabs.com/puppetlabs/mysql" rel="noopener ugc nofollow" target="_blank"> Puppet Forge的MySQL模块</a>由PuppetLabs提供。这也将安装任何必备模块。</p><p id="caef" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><code class="du lb lc ld le b">cd /etc/puppetlabs/code/environments/production/modules</code></p><p id="f5f9" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><code class="du lb lc ld le b">sudo /opt/puppetlabs/bin/puppet module install puppetlabs-mysql</code></p><h2 id="24a0" class="lf jy hh bd jz lg lh li kd lj lk ll kh iw lm ln kl ja lo lp kp je lq lr kt ls bi translated">使用Hiera创建数据库</h2><p id="20c2" class="pw-post-body-paragraph il im hh in b io kv iq ir is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji ha bi translated">在为MySQL模块创建配置文件之前，请考虑您可能不希望在所有代理节点上使用相同的值。为了给Puppet提供每个节点的正确数据，我们使用Hiera。您将在每个节点上使用不同的根密码，从而创建不同的MySQL数据库。</p><ul class=""><li id="6f75" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">导航到<code class="du lb lc ld le b">/etc/puppet</code>并在主puppet目录中创建Hiera的配置文件<code class="du lb lc ld le b">hiera.yaml</code>。您将使用Hiera的默认值:</li></ul><pre class="lu lv lw lx fd mf le mg mh aw mi bi"><span id="74ff" class="lf jy hh le b fi mj mk l ml mm">/etc/puppetlabs/code/environments/production/hiera.yaml</span><span id="b648" class="lf jy hh le b fi mn mk l ml mm">version: 5<br/>hierarchy:<br/>- name: Common<br/>path: common.yaml<br/>defaults:<br/>data_hash: yaml_data<br/>datadir: data</span></pre><ul class=""><li id="0037" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">创建文件<code class="du lb lc ld le b">common.yaml</code>。它将为MySQL定义默认的<strong class="in hi"> root </strong>密码:</li></ul><p id="98b1" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><code class="du lb lc ld le b"><em class="la">/etc/puppetlabs/code/environments/production/common.yam</em></code></p><p id="3b3a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><code class="du lb lc ld le b">mysql::server::root_password: 'password'</code></p><p id="6246" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">当变量没有在别处定义时，我们使用<code class="du lb lc ld le b">common.yaml</code>文件。这意味着所有服务器将共享相同的MySQL根密码。这些密码也可以被散列以增加安全性。</p><ul class=""><li id="eed4" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">要使用MySQL模块的默认设置，您可以在<code class="du lb lc ld le b">site.pp</code>文件中添加一个<strong class="in hi">include '::MySQL::server '</strong>行。但是，在本例中，您将覆盖模块的一些默认设置，为您的每个节点创建一个数据库。</li></ul><p id="368e" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">用以下值编辑<code class="du lb lc ld le b">site.pp</code>文件:</p><pre class="lu lv lw lx fd mf le mg mh aw mi bi"><span id="ca24" class="lf jy hh le b fi mj mk l ml mm">node 'Puppetagent-ubuntu.example.com' {<br/>$adminemail = '<a class="ae mc" href="mailto:webmaster@example.com" rel="noopener ugc nofollow" target="_blank">webmaster@example.com</a>'<br/>$servername = 'hostname.example.com'<br/>include apache<br/>include apache::vhosts<br/>include mysql::server<br/>mysql::db { "mydb_${fqdn}":<br/>user     =&gt; 'myuser',<br/>password =&gt; 'mypass',<br/>dbname   =&gt; 'mydb',<br/>host     =&gt; $::fqdn,<br/>grant    =&gt; ['SELECT', 'UPDATE'],<br/>tag      =&gt; $domain,<br/>}<br/>}<br/>node 'Puppetagent-centos.example.com' {<br/>$adminemail = '<a class="ae mc" href="mailto:webmaster@example.com" rel="noopener ugc nofollow" target="_blank">webmaster@example.com</a>'<br/>$servername = 'hostname.example.com'<br/>include apache<br/>include apache::vhosts<br/>include mysql::server<br/>mysql::db { "mydb_${fqdn}":<br/>user     =&gt; 'myuser',<br/>password =&gt; 'mypass',<br/>dbname   =&gt; 'mydb',<br/>host     =&gt; $::fqdn,<br/>grant    =&gt; ['SELECT', 'UPDATE'],<br/>tag      =&gt; $domain,<br/>}<br/>}</span></pre><h2 id="6ecd" class="lf jy hh bd jz lg lh li kd lj lk ll kh iw lm ln kl ja lo lp kp je lq lr kt ls bi translated">从傀儡主人到傀儡代理的傀儡模块的自动化安装</h2><ul class=""><li id="c281" class="jj jk hh in b io kv is kw iw mo ja mp je mq ji jo jp jq jr bi translated">您可以登录每个节点并发出以下命令，在每个节点上手动运行这些更新:</li></ul><p id="aa0e" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><code class="du lb lc ld le b">sudo /opt/puppetlabs/bin/puppet agent -t</code></p><ul class=""><li id="2ab2" class="jj jk hh in b io ip is it iw jl ja jm je jn ji jo jp jq jr bi translated">否则，受管节点上的傀儡代理服务将每30分钟自动检查一次主节点，并应用主节点上的任何新配置。</li></ul><figure class="lu lv lw lx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es ms"><img src="../Images/0368c83d6d2db6ec2a6db34045b5093c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yEal-_nbEInRXJu7.png"/></div></div></figure><figure class="lu lv lw lx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ly lz di ma bf mb"><div class="er es mt"><img src="../Images/4f1c4442b60bbfe8e5477ca47f69a50f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1Zrrp0FBwKSkt3mJ.png"/></div></div></figure><p id="e72f" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">因此，通过应用目录，整个安装在代理节点上实现了自动化。在这里可以找到用于这个演示的代码文件和依赖项。</p><p id="034d" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我希望这个演示能够帮助您清楚地了解puppet模块和清单，以及它们在自动化IT基础设施中的用途。在这种情况下，您的工作变得非常简单，只需在Puppet Master中指定配置，Puppet agents就会自动评估主清单并应用指定Apache和MySQL设置的模块。如果你有任何疑问，请随时张贴在Edureka社区。</p><p id="3afd" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">就是这样，伙计们，这就把我们带到了这篇文章的结尾。如果你想查看更多关于人工智能、DevOps、道德黑客等市场最热门技术的文章，那么你可以参考<a class="ae mc" href="https://www.edureka.co/blog/?utm_source=medium&amp;utm_medium=content-link&amp;utm_campaign=puppet-modules-automation" rel="noopener ugc nofollow" target="_blank"> Edureka的官方网站。</a></p><p id="b525" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">请留意本系列中解释DevOps各个方面的其他文章。</p><blockquote class="mu mv mw"><p id="02b5" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 1。</em> <a class="ae mc" rel="noopener" href="/edureka/devops-tutorial-89363dac9d3f"> <em class="hh"> DevOps教程</em> </a></p><p id="52b6" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 2。</em> <a class="ae mc" rel="noopener" href="/edureka/git-tutorial-da652b566ece"> <em class="hh">饭桶教程</em> </a></p><p id="a7cb" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 3。</em> <a class="ae mc" rel="noopener" href="/edureka/jenkins-tutorial-68110a2b4bb3"> <em class="hh">詹金斯教程</em> </a></p><p id="0dbb" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 4。</em> <a class="ae mc" rel="noopener" href="/edureka/docker-tutorial-9a6a6140d917"> <em class="hh"> Docker教程</em> </a></p><p id="46e8" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 5。</em> <a class="ae mc" rel="noopener" href="/edureka/ansible-tutorial-9a6794a49b23"> <em class="hh"> Ansible教程</em> </a></p><p id="8227" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 6。</em> <a class="ae mc" rel="noopener" href="/edureka/puppet-tutorial-848861e45cc2"> <em class="hh">傀儡教程</em> </a></p><p id="335c" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 7。</em> <a class="ae mc" rel="noopener" href="/edureka/chef-tutorial-8205607f4564"> <em class="hh">厨师教程</em> </a></p><p id="a7b5" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 8。</em> <a class="ae mc" rel="noopener" href="/edureka/nagios-tutorial-e63e2a744cc8"> <em class="hh"> Nagios教程</em> </a></p><p id="c006" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 9。</em> <a class="ae mc" rel="noopener" href="/edureka/devops-tools-56e7d68994af"> <em class="hh">如何编排DevOps工具？</em>T47】</a></p><p id="8be4" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 10。</em> <a class="ae mc" rel="noopener" href="/edureka/continuous-delivery-5ca2358aedd8"> <em class="hh">连续交货</em> </a></p><p id="7019" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 11。</em> <a class="ae mc" rel="noopener" href="/edureka/continuous-integration-615325cfeeac"> <em class="hh">持续集成</em> </a></p><p id="12d1" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 12。</em> <a class="ae mc" rel="noopener" href="/edureka/continuous-deployment-b03df3e3c44c"> <em class="hh">连续部署</em> </a></p><p id="1514" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 13。</em> <a class="ae mc" rel="noopener" href="/edureka/continuous-delivery-vs-continuous-deployment-5375642865a"> <em class="hh">持续交付vs持续部署</em> </a></p><p id="19d3" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 14。</em> <a class="ae mc" rel="noopener" href="/edureka/ci-cd-pipeline-5508227b19ca"> <em class="hh"> CI CD管道</em> </a></p><p id="c6dd" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 15。</em> <a class="ae mc" rel="noopener" href="/edureka/docker-compose-containerizing-mean-stack-application-e4516a3c8c89"> <em class="hh"> Docker作曲</em> </a></p><p id="b07c" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 16。</em> <a class="ae mc" rel="noopener" href="/edureka/docker-swarm-cluster-of-docker-engines-for-high-availability-40d9662a8df1"> <em class="hh">码头工人群</em> </a></p><p id="cce9" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 17。</em> <a class="ae mc" rel="noopener" href="/edureka/docker-networking-1a7d65e89013"> <em class="hh"> Docker联网</em> </a></p><p id="f929" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 18。</em> <a class="ae mc" rel="noopener" href="/edureka/ansible-vault-secure-secrets-f5c322779c77"> <em class="hh">天穹</em> </a></p><p id="7c6e" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 19。</em> <a class="ae mc" rel="noopener" href="/edureka/ansible-roles-78d48578aca1"> <em class="hh">可变角色</em> </a></p><p id="885b" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 20。</em> <a class="ae mc" rel="noopener" href="/edureka/ansible-for-aws-provision-ec2-instance-9308b49daed9"> <em class="hh">适用于AWS </em> </a></p><p id="11fd" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 21。</em> <a class="ae mc" rel="noopener" href="/edureka/jenkins-pipeline-tutorial-continuous-delivery-75a86936bc92"> <em class="hh">詹金斯管道</em> </a></p><p id="7eac" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated">22。 <a class="ae mc" rel="noopener" href="/edureka/docker-commands-29f7551498a8"> <em class="hh">顶级Docker命令</em> </a></p><p id="d5bc" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 23。</em><a class="ae mc" rel="noopener" href="/edureka/git-vs-github-67c511d09d3e"><em class="hh">Git vs GitHub</em></a></p><p id="c0dd" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 24。</em> <a class="ae mc" rel="noopener" href="/edureka/git-commands-with-example-7c5a555d14c"> <em class="hh">顶级Git命令</em> </a></p><p id="f44b" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated">25。 <a class="ae mc" rel="noopener" href="/edureka/devops-interview-questions-e91a4e6ecbf3"> <em class="hh"> DevOps面试问题</em> </a></p><p id="c0bc" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh">二十六。</em> <a class="ae mc" rel="noopener" href="/edureka/devops-engineer-role-481567822e06"> <em class="hh">谁是DevOps工程师？</em> </a></p><p id="52df" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh">二十七。</em> <a class="ae mc" rel="noopener" href="/edureka/devops-lifecycle-8412a213a654"> <em class="hh"> DevOps生命周期</em> </a></p><p id="5331" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 28。</em><a class="ae mc" rel="noopener" href="/edureka/git-reflog-dc05158c1217"><em class="hh">Git Reflog</em></a></p><p id="e8d0" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 29。</em> <a class="ae mc" rel="noopener" href="/edureka/ansible-provisioning-setting-up-lamp-stack-d8549b38dc59"> <em class="hh">易变条款</em> </a></p><p id="737e" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated">30。 <a class="ae mc" rel="noopener" href="/edureka/devops-skills-f6a7614ac1c7"> <em class="hh">组织正在寻找的顶尖DevOps技能</em> </a></p><p id="3168" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 30。</em> <a class="ae mc" rel="noopener" href="/edureka/waterfall-vs-agile-991b14509fe8"> <em class="hh">瀑布vs敏捷</em> </a></p><p id="16ff" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 31。</em> <a class="ae mc" rel="noopener" href="/edureka/jenkins-cheat-sheet-e0f7e25558a3"> <em class="hh">詹金斯小抄</em> </a></p><p id="e65c" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 32。</em> <a class="ae mc" rel="noopener" href="/edureka/ansible-cheat-sheet-guide-5fe615ad65c0"> <em class="hh"> Ansible备忘单</em> </a></p><p id="c6ba" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 33。</em> <a class="ae mc" rel="noopener" href="/edureka/ansible-interview-questions-adf8750be54"> <em class="hh"> Ansible面试问答</em> </a></p><p id="d84c" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 34。</em> <a class="ae mc" rel="noopener" href="/edureka/docker-interview-questions-da0010bedb75"> <em class="hh"> 50码头工人面试问题</em> </a></p><p id="59cd" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 35。</em> <a class="ae mc" rel="noopener" href="/edureka/what-is-agile-methodology-fe8ad9f0da2f"> <em class="hh">敏捷方法论</em> </a></p><p id="bdc8" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 36。</em> <a class="ae mc" rel="noopener" href="/edureka/jenkins-interview-questions-7bb54bc8c679"> <em class="hh">詹金斯面试问题</em> </a></p><p id="2b91" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 37。</em> <a class="ae mc" rel="noopener" href="/edureka/git-interview-questions-32fb0f618565"> <em class="hh"> Git面试问题</em> </a></p><p id="b3ae" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 38。</em> <a class="ae mc" rel="noopener" href="/edureka/docker-architecture-be79628e076e"> <em class="hh"> Docker架构</em> </a></p><p id="d2aa" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated">39。<a class="ae mc" rel="noopener" href="/edureka/linux-commands-in-devops-73b5a2bcd007"><em class="hh">devo PS中使用的Linux命令</em> </a></p><p id="47a2" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated">40。 <a class="ae mc" rel="noopener" href="/edureka/jenkins-vs-bamboo-782c6b775cd5"> <em class="hh">詹金斯vs竹子</em> </a></p><p id="26cb" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 41。</em> <a class="ae mc" rel="noopener" href="/edureka/nagios-tutorial-e63e2a744cc8"> <em class="hh"> Nagios教程</em> </a></p><p id="4a77" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 42。</em> <a class="ae mc" rel="noopener" href="/edureka/nagios-interview-questions-f3719926cc67"> <em class="hh"> Nagios面试问题</em> </a></p><p id="66cb" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated">43。 <a class="ae mc" rel="noopener" href="/edureka/jenkins-x-d87c0271af57"> <em class="hh"> DevOps实时场景</em> </a></p><p id="51da" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated">44。 <a class="ae mc" rel="noopener" href="/edureka/jenkins-vs-bamboo-782c6b775cd5"> <em class="hh">詹金斯和詹金斯X的区别</em> </a></p><p id="ed98" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated">45。<a class="ae mc" rel="noopener" href="/edureka/docker-for-windows-ed971362c1ec"><em class="hh">Windows Docker</em></a></p><p id="4f11" class="il im la in b io ip iq ir is it iu iv mx ix iy iz my jb jc jd mz jf jg jh ji ha bi translated"><em class="hh"> 46。</em><a class="ae mc" href="http://git%20vs%20github/" rel="noopener ugc nofollow" target="_blank"><em class="hh">Git vs Github</em></a></p></blockquote></div><div class="ab cl na nb go nc" role="separator"><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf ng"/><span class="nd bw bk ne nf"/></div><div class="ha hb hc hd he"><p id="eff5" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><em class="la">原载于2019年10月18日</em><a class="ae mc" href="https://www.edureka.co/blog/puppet-modules-automation/" rel="noopener ugc nofollow" target="_blank"><em class="la">https://www.edureka.co</em></a><em class="la">。</em></p></div></div>    
</body>
</html>