<html>
<head>
<title>Understanding MediaSession (Part 4/4)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解MediaSession(第4/4部分)</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/understanding-mediasession-part-4-4-dcc77c535f99?source=collection_archive---------3-----------------------#2017-09-03">https://medium.com/androiddevelopers/understanding-mediasession-part-4-4-dcc77c535f99?source=collection_archive---------3-----------------------#2017-09-03</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="8de2" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">如何将它用于复杂的用例</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/1772ccf0e006705db4026bc2e48cc286.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FYMPRMaZAvtmRVBPFozsig.png"/></div></div></figure><h1 id="a657" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">介绍</h1><p id="bfcd" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">这一系列文章的目标是让你深入了解<code class="du kw kx ky kz b">MediaSession</code>，它有什么用途，什么时候用，什么时候不用。这是4部分系列的最后一部分，包括:</p><ol class=""><li id="7c62" class="la lb hh kc b kd lc kg ld kj le kn lf kr lg kv lh li lj lk bi translated"><a class="ae ll" rel="noopener" href="/@nazmul/understanding-mediasession-part-1-3-e4d2725f18e4">media session适合我吗？</a></li><li id="c8dc" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lh li lj lk bi translated"><a class="ae ll" rel="noopener" href="/@nazmul/understanding-mediasession-part-2-3-ad291fd32d60">理解复杂的媒体环境</a></li><li id="edcc" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lh li lj lk bi translated"><a class="ae ll" rel="noopener" href="/@nazmul/understanding-mediasession-part-2-3-b4919583a82">简单用例如何使用</a></li><li id="240d" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lh li lj lk bi translated"><strong class="kc hi">复杂用例如何使用</strong> <em class="lr">(本文)</em></li></ol><h1 id="c468" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">在后台播放音频的应用程序</h1><p id="4fdc" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">下图提供了创建一个使用<code class="du kw kx ky kz b">MediaSession</code>和<code class="du kw kx ky kz b">MediaBrowserService</code>在后台播放音频的音频播放应用程序所必须实现的所有不同组件的高级概述。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ls"><img src="../Images/7ed60d133c191b114866494c8a36291b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hNBUSvLDdX6HezzRy-7-vQ.png"/></div></div></figure><p id="1c31" class="pw-post-body-paragraph ka kb hh kc b kd lc ii kf kg ld il ki kj lt kl km kn lu kp kq kr lv kt ku kv ha bi translated">请参考<a class="ae ll" href="https://developer.android.com/guide/topics/media-apps/media-apps-overview.html" rel="noopener ugc nofollow" target="_blank">developers.android.com</a>来获得更多关于你需要使用的每个类的细节。总体而言，您必须:</p><ul class=""><li id="d2c3" class="la lb hh kc b kd lc kg ld kj le kn lf kr lg kv lw li lj lk bi translated"><strong class="kc hi">服务</strong> —创建一个<code class="du kw kx ky kz b">Service</code>来管理播放器并处理准备和播放媒体。创建与此服务相关的<code class="du kw kx ky kz b">MediaStyle</code>通知。这个服务需要扩展<code class="du kw kx ky kz b">MediaBrowserService</code>以便提供内容(例如:Android Auto就是这样浏览app提供的内容的)。该服务的详细信息在下面的章节中提供。</li><li id="9a2e" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lw li lj lk bi translated"><strong class="kc hi">客户端</strong> —使用<code class="du kw kx ky kz b">MediaBrowser</code>创建一个连接到该服务的<code class="du kw kx ky kz b">Activity</code>或<code class="du kw kx ky kz b">Fragment</code>。<code class="du kw kx ky kz b">MediaBrowser</code>允许访问由<code class="du kw kx ky kz b">Service</code>提供的内容，并允许使用<code class="du kw kx ky kz b">MediaSession</code>来控制回放，并获取关于加载了什么媒体以及回放状态改变的更新(这实际上发生在您的<code class="du kw kx ky kz b">Service</code>中)。客户端的详细信息在下面的章节中提供。</li></ul><h1 id="d901" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">服务码</h1><p id="e140" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">下图详细介绍了管理玩家的应用程序中需要的<code class="du kw kx ky kz b">Service</code>(<code class="du kw kx ky kz b">MediaPlayer</code>或<code class="du kw kx ky kz b">ExoPlayer</code>)，并创建<code class="du kw kx ky kz b">MediaSession</code>，使其与玩家的状态变化保持同步。总体而言，您必须:</p><ul class=""><li id="4353" class="la lb hh kc b kd lc kg ld kj le kn lf kr lg kv lw li lj lk bi translated">在<code class="du kw kx ky kz b">onCreate()</code>中，你必须创建一个<code class="du kw kx ky kz b">MediaSession</code>并获得它的令牌。</li><li id="a806" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lw li lj lk bi translated">通过调用<code class="du kw kx ky kz b">setSessionToken</code>将这个令牌传递给<code class="du kw kx ky kz b">MediaBrowserService</code>，这将把<code class="du kw kx ky kz b">MediaBrowserService</code>连接到<code class="du kw kx ky kz b">MediaSession</code>，并允许<code class="du kw kx ky kz b">MediaBrowser</code>(客户端与<code class="du kw kx ky kz b">MediaSession</code>一起工作)。</li><li id="b10e" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lw li lj lk bi translated">要实现的最重要的回调是<code class="du kw kx ky kz b">MediaSession.Callback</code>。这个回调函数允许传输控件在回调函数上调用播放、停止、暂停等操作，然后这些操作用于播放、停止、暂停底层播放器。</li><li id="f25d" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lw li lj lk bi translated">您必须扩展<code class="du kw kx ky kz b">MediaBrowserService</code>并实现两个方法，以便公开您正在创建的可浏览的媒体内容目录— <code class="du kw kx ky kz b">onGetRoot()</code>和<code class="du kw kx ky kz b">onLoadChildren()</code>。</li></ul><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ls"><img src="../Images/c861fd8149febccb220951b3b96486fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VtWayH4MGWkH35wo8WO0XQ.png"/></div></div></figure><p id="2576" class="pw-post-body-paragraph ka kb hh kc b kd lc ii kf kg ld il ki kj lt kl km kn lu kp kq kr lv kt ku kv ha bi translated"><strong class="kc hi">注意</strong>:如果你不需要Android Auto浏览你的内容，或者你的应用程序UI之外的其他应用程序，那么你可以安全地移除你的<code class="du kw kx ky kz b">Service</code>中的<code class="du kw kx ky kz b">MediaBrowserService</code>(以及你的客户端代码中的<code class="du kw kx ky kz b">MediaBrowser</code>)。在这种情况下，只需使用<code class="du kw kx ky kz b">MediaSession</code>，您就可以获得允许其他应用程序控制回放和报告状态变化的所有好处，而无需从应用程序的用户界面之外浏览应用程序中的内容。</p><h1 id="2fed" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">活动/客户端/用户界面代码</h1><p id="d264" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">下图仔细观察了客户端代码，为了与<code class="du kw kx ky kz b">MediaSession</code>和<code class="du kw kx ky kz b">MediaBrowser</code>集成，你需要在你的应用程序中包含这些代码。总体而言，您必须:</p><ul class=""><li id="87cc" class="la lb hh kc b kd lc kg ld kj le kn lf kr lg kv lw li lj lk bi translated">在你的<code class="du kw kx ky kz b">Activity</code>的<code class="du kw kx ky kz b">onStart()</code>方法中，用一个<code class="du kw kx ky kz b">MediaBrowser</code>连接到<code class="du kw kx ky kz b">Service</code>。这将允许您获得可以在应用程序的UI中浏览的内容，并使用您从<code class="du kw kx ky kz b">MediaSession’s</code> <code class="du kw kx ky kz b">MediaController</code>获得的<code class="du kw kx ky kz b">TransportControls</code>进行回放。请注意，您必须从<code class="du kw kx ky kz b">MediaBrowser</code>获取<code class="du kw kx ky kz b">MediaSession</code>令牌，以便将您的<code class="du kw kx ky kz b">TransportControls</code>正确连接到<code class="du kw kx ky kz b">MediaSession</code>。</li><li id="6934" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lw li lj lk bi translated">您必须在您的<code class="du kw kx ky kz b">Activity</code>中实现三个回调</li><li id="588c" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lw li lj lk bi translated"><code class="du kw kx ky kz b">MediaController.Callback</code> —这用于使用当前播放状态以及当前加载的媒体来更新应用的。</li><li id="b456" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lw li lj lk bi translated"><code class="du kw kx ky kz b">MediaBrowser.ConnectionCallback</code> —用于使用<code class="du kw kx ky kz b">MediaBrowser’s</code> <code class="du kw kx ky kz b">MediaSession</code>令牌获取<code class="du kw kx ky kz b">MediaController</code>。然后您可以使用<code class="du kw kx ky kz b">TransportControls</code>来启动回放、暂停、停止、跳过等操作。</li><li id="5a37" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lw li lj lk bi translated"><code class="du kw kx ky kz b">MediaBrowser.SubscriptionCallback</code> —这用于更新您的UI，以便您可以显示用户内容(来自<code class="du kw kx ky kz b">Service</code>),他们可以浏览以进行回放。</li></ul><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ls"><img src="../Images/5bddba2f428991a4b18d4b86ab27aabc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iu1emZtq5AorvsfYNzoF6A.png"/></div></div></figure><h1 id="be91" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">Android媒体资源</h1><ul class=""><li id="1c93" class="la lb hh kc b kd ke kg kh kj lx kn ly kr lz kv lw li lj lk bi translated"><a class="ae ll" href="https://developer.android.com/guide/topics/media-apps/media-apps-overview.html" rel="noopener ugc nofollow" target="_blank">媒体应用程序指南—媒体应用程序概述</a></li><li id="3fea" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lw li lj lk bi translated"><a class="ae ll" href="https://developer.android.com/guide/topics/media-apps/working-with-a-media-session.html" rel="noopener ugc nofollow" target="_blank">媒体API指南—使用媒体会话</a></li><li id="9a73" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lw li lj lk bi translated"><a class="ae ll" rel="noopener" href="/google-developers/building-a-simple-audio-app-in-android-part-1-3-c14d1a66e0f1">使用MediaPlayer构建简单的音频播放应用</a></li><li id="4821" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lw li lj lk bi translated"><a class="ae ll" href="https://github.com/googlesamples/android-MediaBrowserService" rel="noopener ugc nofollow" target="_blank">示例代码— MediaBrowserService </a></li><li id="614a" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lw li lj lk bi translated"><a class="ae ll" href="https://github.com/googlesamples/android-media-controller" rel="noopener ugc nofollow" target="_blank">示例代码—媒体会话控制器测试</a></li></ul></div></div>    
</body>
</html>