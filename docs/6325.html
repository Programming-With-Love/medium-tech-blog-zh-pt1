<html>
<head>
<title>How Pinterest powers a healthy comment ecosystem with machine learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Pinterest如何通过机器学习推动健康的评论生态系统</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/how-pinterest-powers-a-healthy-comment-ecosystem-with-machine-learning-9e5c3414c8ad?source=collection_archive---------0-----------------------#2021-12-03">https://medium.com/pinterest-engineering/how-pinterest-powers-a-healthy-comment-ecosystem-with-machine-learning-9e5c3414c8ad?source=collection_archive---------0-----------------------#2021-12-03</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="0feb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">宋远方|机器学习工程师，信任与安全；曾庆龙|工程经理，内容质量信号；和Vishwakarma Singh |机器学习领导，信任和安全</p><p id="3786" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">随着Pinterest继续从一个只是保存想法的地方发展成为一个发现激发行动的内容的平台，创作者直接发布到Pinterest的原生内容越来越多。随着Pinterest上的创作者生态系统不断发展，我们致力于通过像<a class="ae jc" href="https://business.pinterest.com/creator-code/" rel="noopener ugc nofollow" target="_blank">创作者守则</a>这样的举措来确保Pinterest仍然是一个积极和鼓舞人心的环境，这是一项内容政策，在创作者可以发布想法pin之前，强制接受准则(如“善良”和“核实事实”)。我们还在Idea Pin评论上设置了护栏，包括正面提醒、评论删除和关键词过滤工具以及垃圾邮件预防信号。在技术方面，我们使用机器学习中的尖端技术来近乎实时地识别和执行违反社区政策的评论。我们还使用这些技术首先展示最鼓舞人心和最高质量的评论，以便带来更富有成效的体验和推动参与。</p><p id="42c4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">自从3月份推出机器学习解决方案，在报告之前自动检测潜在的违反政策的评论并采取适当的措施，我们已经看到评论报告率(每100万次评论展示的用户评论报告)下降了53%。</p><p id="6ed4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这里，我们分享了我们如何构建一个可扩展的近实时机器学习解决方案，以识别违反政策的评论并按质量对评论进行排名。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/ff59079490a8858c9e0045ba64635f4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gfyepPLYveEOPIxF"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx"><strong class="bd jt">Figure 1: Comment ecosystem on Pinterest</strong></figcaption></figure><h1 id="e225" class="ju jv hh bd jt jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">评论的各个方面</h1><p id="67a2" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">我们大致确定了评论的四个方面:不安全，或者评论违反了我们的<a class="ae jc" href="http://policy.pinterest.com/en/community-guidelines" rel="noopener ugc nofollow" target="_blank">社区指南</a>；垃圾邮件；感悟；和质量。评论的情感可以是积极的、中性的或消极的。评论的质量可高可低。我们通过使用内在维度来衡量评论的质量:可读性、与Pin的相关性和细微差别。如果一个评论没有错误并且可以理解，那么它就是可读的。相关注释是特定的，并且与Pin的内容相关。细致入微的评论是问题、提示、建议、请求或描述评论者的个人经历或与Pin的互动。细致入微、可读性强且与Pin相关的注释被认为是高质量的。</p><h1 id="b7fc" class="ju jv hh bd jt jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">机器学习解决方案</h1><p id="5bce" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">我们利用机器学习技术来识别违反政策(不安全和垃圾)的评论，以及评估评论的情绪和质量。我们将这些任务建模为分类任务，如表1所示。我们的机器学习解决方案目前支持多种语言(英语、法语、德语、葡萄牙语、西班牙语、意大利语和日语)，未来将扩展到其他语言。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kw"><img src="../Images/0fbad2151821e54a30814df77f755fa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1384/format:webp/1*rHydSaIb3aIZLZrF24JVZA.png"/></div><figcaption class="jp jq et er es jr js bd b be z dx"><strong class="bd jt">Table 1. Comment objectives transformed into classification tasks</strong></figcaption></figure><h2 id="6c95" class="kx jv hh bd jt ky kz la jz lb lc ld kd ip le lf kh it lg lh kl ix li lj kp lk bi translated">培训用数据</h2><p id="7e82" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">我们仅使用英语的标记注释来训练模型。我们采用混合方法来限制收集标记数据的成本。不安全、垃圾邮件和非垃圾邮件标记的评论是通过对社区报告的评论进行人工验证而获得的。安全标签评论是通过对Pinterest上的所有评论进行随机抽样生成的，因为不安全评论的数量非常低。正面和负面情感类别的标记数据是通过对随机采样的评论进行人工标记而获得的。由于负面评论的流行率也非常低，我们使用<a class="ae jc" href="https://github.com/cjhutto/vaderSentiment" rel="noopener ugc nofollow" target="_blank"> Vader情绪分析器</a>对评论进行采样，以进行负面情绪标记。对于质量标签，我们收集了评论者对评论中每个质量定义因素的回应。最后，我们使用图2所示的决策流程图将这些响应分为三个质量等级。目前，我们将所有中等质量的评论视为高质量的评论，并将在未来探索一种单独的处理方式，以便更好地控制评论质量排名。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ll"><img src="../Images/e029eb44322ceb1be8da52a758ba9d1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2tkL2OEC4gCj5WiA"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx"><strong class="bd jt">Figure 2: Labeling a comment for quality using intrinsic factors</strong></figcaption></figure><h2 id="a3f5" class="kx jv hh bd jt ky kz la jz lb lc ld kd ip le lf kh it lg lh kl ix li lj kp lk bi translated">模型</h2><p id="2de9" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">我们设计了一个多任务模型，如图3所示，它通过微调一个强大的最先进的预训练transformer模型(多语言<a class="ae jc" href="https://huggingface.co/distilbert-base-multilingual-cased" rel="noopener ugc nofollow" target="_blank"> DistilBERT </a>)来利用迁移学习。这种设计选择在整体性能、生命周期成本和开发速度方面产生了最佳价值。成本降低来自于使用预先训练的模型，该模型需要相对少量的标记数据用于进一步训练，并且必须在整个生命周期中维护单个模型。我们的评估表明，对于每个分类任务，多任务模型的性能与独立模型相当。我们利用了多语言预培训模型，因为它帮助我们将模型的覆盖范围扩大到除英语之外的许多语言，而不需要针对这些语言的任何特定培训，尽管性能有所下降。</p><p id="5a50" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了带来上下文并提高模型的性能，我们还使用了Pin、Pinner、commenter和附加评论功能，这些功能是Pinterest评论生态系统的组件(如图1所示)。这些特征与DistilBERT的最后一个隐藏层输出连接在一起，并输入到一个联合多层感知器(MLP)中，该感知器还允许特征之间的交叉学习。Pin特征包括<a class="ae jc" href="https://arxiv.org/abs/1806.01973" rel="noopener ugc nofollow" target="_blank"> PinSage </a>嵌入和Pin语言。品酒师和评论者特征包括使用<a class="ae jc" href="https://arxiv.org/abs/2007.03634" rel="noopener ugc nofollow" target="_blank">品酒法</a>嵌入和像语言这样的简档特征导出的他们之间的口味相似性。附加的注释特性是注释长度和语言。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/cf2fb5ec2dc5aff2c004526a37d0b410.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yrDLA3kN9GlOLDbb"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx"><strong class="bd jt">Figure 3: Multi-task comment model architecture</strong></figcaption></figure><p id="651d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">每个任务头都有自己的输出层，它可以生成各个类的分数分布。二进制分类头使用sigmoid激活进行输出，使用二进制交叉熵进行损失。情感分类头使用softmax输出层和交叉熵损失。对于每个训练数据实例，只有那些任务头对数据点具有标签的总损失函数有贡献。该模型使用Tensorflow和Keras实现，并使用多个GPU上的数据并行性进行训练。我们对召回率和误报率进行了优化。我们学习了一个分数临界值来识别不安全、垃圾和负面情绪的评论。</p><h2 id="fb2e" class="kx jv hh bd jt ky kz la jz lb lc ld kd ip le lf kh it lg lh kl ix li lj kp lk bi translated">推理</h2><p id="407a" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">我们使用<a class="ae jc" rel="noopener" href="/pinterest-engineering/unified-flink-source-at-pinterest-streaming-data-processing-c9d4e89f2ed6"> Pinterest的流媒体数据平台</a> ( <a class="ae jc" href="https://flink.apache.org/" rel="noopener ugc nofollow" target="_blank"> Flink </a>)对新创建/编辑的评论进行近实时评分，如图4所示。我们在Pinterest的在线模型服务平台(<a class="ae jc" rel="noopener" href="/pinterest-engineering/building-a-dynamic-and-responsive-pinterest-7d410e99f0a9">短信</a>)托管多任务评论模型。为了准备DistilBERT的输入，我们在Python <a class="ae jc" href="https://flask.palletsprojects.com/en/2.0.x/" rel="noopener ugc nofollow" target="_blank"> Flask </a>中托管了来自<a class="ae jc" href="https://huggingface.co/distilbert-base-multilingual-cased" rel="noopener ugc nofollow" target="_blank"> hugging face </a>的相应标记器作为服务。Flink作业从由前端API服务在新的comment-create或comment-edit事件上填充的<a class="ae jc" href="https://kafka.apache.org/intro" rel="noopener ugc nofollow" target="_blank"> Kafka </a>队列中接收注释及其关联的元数据。该作业使用注释的语言作为过滤器，仅推断受支持语言的注释。它通过HTTP与Flask服务通信，以获取DistilBERT输入。它从Pinterest的一堆数据服务(如<a class="ae jc" rel="noopener" href="/pinterest-engineering/pinterest-visual-signals-infrastructure-evolution-from-lambda-to-kappa-architecture-f8f58b127d98"> Galaxy Signal Service </a>和<a class="ae jc" rel="noopener" href="/pinterest-engineering/open-sourcing-terrapin-a-serving-system-for-batch-generated-data-7aa2f38c4472"> Terrapin </a>)中获取模型所需的其他输入特征。Flink作业将所有特征转换为张量，然后向SMS发出请求进行预测。最终，它将推理结果汇集到几个数据客户端，如Rockstore、RealPin和Kafka，供其他消费者使用。Rockstore是一个分布式键值存储，也是Pinterest KVStore平台的一个管理和协调API &amp; MySQL后端存储。RealPin是一个高性能的对象检索系统，具有高度可定制的排序、聚合和过滤功能。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/f449f1d46bf277618cf25a79a4ca5bd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8ViMbD3pVdN5dMIZ"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx"><strong class="bd jt">Figure 4. Inference workflow for scoring comments</strong></figcaption></figure><h1 id="c70b" class="ju jv hh bd jt jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">服务</h1><p id="e229" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">我们有两个独立的服务工作流，它们使用推理输出、执行策略以及对评论进行排名。工作流的分离提供了逻辑模块化，并有助于简化操作、管理和诊断。第一个工作流过滤不安全和垃圾评论，另一个工作流使用情感和质量分数等因素采取适当的过滤或排名行动。我们目前将回复视为独立评论，并提供类似的处理方式。</p><h1 id="e5d5" class="ju jv hh bd jt jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">结论</h1><p id="f499" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">我们的机器学习解决方案针对可能违反政策的评论提供了强大的防御，并确保我们的Pinner社区有一个安全的生态系统来参与和受到启发。识别有害的评论和评估评论的质量将继续发展，因为上下文、发展趋势和其他细微差别，如讽刺、否定、比较、语气、极性、情感转变、意义转变等都在发挥作用。我们计划反复改进我们的解决方案，并修订我们的社区指南。我们也看到了将该模式用于其他用例的机会，如隐藏式字幕、直接消息传递和其他基于文本的用户参与形式。</p><p id="31dc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="lm">要在Pinterest了解更多关于工程的信息，请查看我们的</em> <a class="ae jc" href="https://medium.com/pinterest-engineering" rel="noopener"> <em class="lm">工程博客</em> </a> <em class="lm">，并访问我们的</em><a class="ae jc" href="https://www.pinterestlabs.com/?utm_source=medium&amp;utm_medium=blog-article-link&amp;utm_campaign=song-et-al-december-3-2021" rel="noopener ugc nofollow" target="_blank"><em class="lm">Pinterest Labs</em></a><em class="lm">网站。要查看和申请空缺职位，请访问我们的</em> <a class="ae jc" href="https://www.pinterestcareers.com/?utm_source=medium&amp;utm_medium=blog-article-link&amp;utm_campaign=song-et-al-december-3-2021" rel="noopener ugc nofollow" target="_blank"> <em class="lm">职业</em> </a> <em class="lm">页面。</em></p><h1 id="9a69" class="ju jv hh bd jt jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">感谢</h1><p id="b85e" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">非常感谢尼娜·王启尧、比阿特丽斯·张、阿布舍克·贾森和在模型开发和部署过程中做出的贡献。我们感谢蔡美诗·萨缪尔森和Ashley Chin的分析、产品见解和支持。感谢安德烈·古塞夫的见解和帮助。感谢沙基·陈楠·昆努梅尔和尼尔什·戈赫尔分享他们的技术见解。最后，我们感谢哈里·沙曼斯基对发表这篇博客的支持。</p></div></div>    
</body>
</html>