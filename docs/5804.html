<html>
<head>
<title>Multipart Upload a large file to Oracle Cloud Infrastructure Object Storage using cURL</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用cURL将大文件多部分上传到Oracle云基础架构对象存储</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/multipart-upload-a-large-file-to-oracle-cloud-infrastructure-object-storage-using-curl-8aa8d0021ff1?source=collection_archive---------0-----------------------#2021-08-03">https://medium.com/oracledevs/multipart-upload-a-large-file-to-oracle-cloud-infrastructure-object-storage-using-curl-8aa8d0021ff1?source=collection_archive---------0-----------------------#2021-08-03</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/0a21f5cd2219bcde6763695ac1d1c827.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d_FpG69da4fEsDkr0uvTvA.png"/></div></div></figure><p id="3850" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">当您有大型文件要从本地或另一个云传输到OCI时，最好的方法是使用多部分上传。多部分上传有助于容纳对于单次上传操作来说太大的对象。OCI现在支持直接从cURL进行多部分上传，而不是使用SDK或oci-cli。通过预认证URL (PAR ),您可以避免配置API密钥并与外部方共享。解析URL可以提供一种快速安全方式将文件上传到OCI对象存储。</p><p id="11ee" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在OCI上，上传对象的最大大小是10 TiB，对象部分不能大于50 GiB。强烈建议使用多部分上载来上载大于100 MiB的对象。您可以将文件分割成块，并从curl发起多部分上传。您负责创建要上传的零件。对象存储只是为剩下的步骤提供API操作。一旦上传了所有的部分，就需要一个最后的POST调用来组装文件。现在让我们看看这些步骤是什么:</p><h2 id="1a49" class="jn jo hh bd jp jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh bi translated">1.在Bucket上创建解析URL</h2><figure class="kj kk kl km fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ki"><img src="../Images/6f3500d87601b88d8337a576a05ec532.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lQRtDfnzH5QmQriqZG6h8g.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">PAR URL</figcaption></figure><p id="ebb4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="kr">生成的PAR URL: </em></p><pre class="kj kk kl km fd ks kt ku kv aw kw bi"><span id="96e4" class="jn jo hh kt b fi kx ky l kz la"><a class="ae lb" href="https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/o/" rel="noopener ugc nofollow" target="_blank">https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/o/</a></span></pre><h2 id="edf3" class="jn jo hh bd jp jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh bi translated">2.将大文件分成几部分</h2><p id="9d8a" class="pw-post-body-paragraph ip iq hh ir b is lc iu iv iw ld iy iz ja le jc jd je lf jg jh ji lg jk jl jm ha bi translated">您可以使用任何操作系统实用程序将文件分成几部分。我们将在Linux上使用<em class="kr"> split </em>把大文件<strong class="ir hi">T5】large _ random _ data . CSV</strong>分成250MB的块</p><p id="8d9e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">决定每个零件要使用的零件号。零件号的范围从1到10，000。您不需要指定连续的编号，但是对象存储通过按升序排列零件号来构造对象。</p><pre class="kj kk kl km fd ks kt ku kv aw kw bi"><span id="1ca0" class="jn jo hh kt b fi kx ky l kz la">split -b 250M -d large_random_data.csv</span><span id="070a" class="jn jo hh kt b fi lh ky l kz la">ls -ltrh x*</span><span id="0484" class="jn jo hh kt b fi lh ky l kz la">-rw-rw-r — . 1 opc opc 250M Aug 2 22:56 x00<br/>-rw-rw-r — . 1 opc opc 250M Aug 2 22:56 x01<br/>-rw-rw-r — . 1 opc opc 250M Aug 2 22:56 x02<br/>-rw-rw-r — . 1 opc opc 250M Aug 2 22:56 x03<br/>-rw-rw-r — . 1 opc opc 250M Aug 2 22:56 x04<br/>-rw-rw-r — . 1 opc opc 250M Aug 2 22:56 x05<br/>-rw-rw-r — . 1 opc opc 250M Aug 2 22:56 x06<br/>-rw-rw-r — . 1 opc opc 250M Aug 2 22:56 x07<br/>-rw-rw-r — . 1 opc opc 50M Aug 2 22:56 x08</span></pre><h2 id="ef41" class="jn jo hh bd jp jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh bi translated">3.使用解析URL为OCI对象存储上的文件创建多部分上传</h2><pre class="kj kk kl km fd ks kt ku kv aw kw bi"><span id="16e2" class="jn jo hh kt b fi kx ky l kz la">curl -X PUT -H “opc-multipart:true” <a class="ae lb" href="https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/o/large_random_data.csv" rel="noopener ugc nofollow" target="_blank">https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/o/large_random_data.csv</a></span></pre><p id="78c8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">输出</strong></p><pre class="kj kk kl km fd ks kt ku kv aw kw bi"><span id="b324" class="jn jo hh kt b fi kx ky l kz la">{<br/> “namespace”: “idmldytingzx”,<br/> “bucket”: “DWH-Load”,<br/> “object”: “large_random_data.csv”,<br/> “uploadId”: “7f878479–00e1–4630–23b6–683deac88a78”,<br/> “timeCreated”: “2021–08–03T21:10:59.273Z”,<br/> “storageTier”: “Standard”,<br/> “accessUri”: “/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/u/large_random_data.csv/id/7f878479–00e1–4630–23b6–683deac88a78/”<br/>}</span></pre><p id="3ef9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">使用目标区域的访问URI和对象存储主机名来上传部件，并在URI的末尾指定部件号。例如，要上传包含9个部分的对象，请发出以下PUT命令</p><pre class="kj kk kl km fd ks kt ku kv aw kw bi"><span id="f7a1" class="jn jo hh kt b fi kx ky l kz la">curl -X PUT — data-binary ‘<a class="ae lb" href="http://twitter.com/x00" rel="noopener ugc nofollow" target="_blank">@x00</a>’ <a class="ae lb" href="https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/u/large_random_data.csv/id/7f878479-00e1-4630-23b6-683deac88a78/1" rel="noopener ugc nofollow" target="_blank">https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/u/large_random_data.csv/id/7f878479-00e1-4630-23b6-683deac88a78/1</a></span><span id="7e1b" class="jn jo hh kt b fi lh ky l kz la">curl -X PUT — data-binary ‘<a class="ae lb" href="http://twitter.com/x01" rel="noopener ugc nofollow" target="_blank">@x01</a>’ <a class="ae lb" href="https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/u/large_random_data.csv/id/7f878479-00e1-4630-23b6-683deac88a78/2" rel="noopener ugc nofollow" target="_blank">https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/u/large_random_data.csv/id/7f878479-00e1-4630-23b6-683deac88a78/2</a></span><span id="ecb9" class="jn jo hh kt b fi lh ky l kz la">curl -X PUT — data-binary ‘<a class="ae lb" href="http://twitter.com/x02" rel="noopener ugc nofollow" target="_blank">@x02</a>’ <a class="ae lb" href="https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/u/large_random_data.csv/id/7f878479-00e1-4630-23b6-683deac88a78/3" rel="noopener ugc nofollow" target="_blank">https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/u/large_random_data.csv/id/7f878479-00e1-4630-23b6-683deac88a78/3</a></span><span id="a5cf" class="jn jo hh kt b fi lh ky l kz la">curl -X PUT — data-binary ‘<a class="ae lb" href="http://twitter.com/x03" rel="noopener ugc nofollow" target="_blank">@x03</a>’ <a class="ae lb" href="https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/u/large_random_data.csv/id/7f878479-00e1-4630-23b6-683deac88a78/4" rel="noopener ugc nofollow" target="_blank">https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/u/large_random_data.csv/id/7f878479-00e1-4630-23b6-683deac88a78/4</a></span><span id="2232" class="jn jo hh kt b fi lh ky l kz la">curl -X PUT — data-binary ‘<a class="ae lb" href="http://twitter.com/x04" rel="noopener ugc nofollow" target="_blank">@x04</a>’ <a class="ae lb" href="https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/u/large_random_data.csv/id/7f878479-00e1-4630-23b6-683deac88a78/5" rel="noopener ugc nofollow" target="_blank">https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/u/large_random_data.csv/id/7f878479-00e1-4630-23b6-683deac88a78/5</a></span><span id="857c" class="jn jo hh kt b fi lh ky l kz la">curl -X PUT — data-binary ‘<a class="ae lb" href="http://twitter.com/x05" rel="noopener ugc nofollow" target="_blank">@x05</a>’ <a class="ae lb" href="https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/u/large_random_data.csv/id/7f878479-00e1-4630-23b6-683deac88a78/6" rel="noopener ugc nofollow" target="_blank">https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/u/large_random_data.csv/id/7f878479-00e1-4630-23b6-683deac88a78/6</a></span><span id="6daa" class="jn jo hh kt b fi lh ky l kz la">curl -X PUT — data-binary ‘<a class="ae lb" href="http://twitter.com/x06" rel="noopener ugc nofollow" target="_blank">@x06</a>’ <a class="ae lb" href="https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/u/large_random_data.csv/id/7f878479-00e1-4630-23b6-683deac88a78/7" rel="noopener ugc nofollow" target="_blank">https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/u/large_random_data.csv/id/7f878479-00e1-4630-23b6-683deac88a78/7</a></span><span id="fc08" class="jn jo hh kt b fi lh ky l kz la">curl -X PUT — data-binary ‘<a class="ae lb" href="http://twitter.com/x07" rel="noopener ugc nofollow" target="_blank">@x07</a>’ <a class="ae lb" href="https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/u/large_random_data.csv/id/7f878479-00e1-4630-23b6-683deac88a78/8" rel="noopener ugc nofollow" target="_blank">https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/u/large_random_data.csv/id/7f878479-00e1-4630-23b6-683deac88a78/8</a></span><span id="e691" class="jn jo hh kt b fi lh ky l kz la">curl -X PUT — data-binary ‘<a class="ae lb" href="http://twitter.com/x08" rel="noopener ugc nofollow" target="_blank">@x08</a>’ <a class="ae lb" href="https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/u/large_random_data.csv/id/7f878479-00e1-4630-23b6-683deac88a78/9" rel="noopener ugc nofollow" target="_blank">https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/u/large_random_data.csv/id/7f878479-00e1-4630-23b6-683deac88a78/9</a></span></pre><h2 id="6ed7" class="jn jo hh bd jp jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh bi translated">4.要提交多部分上传，请使用带有访问URI的POST命令。例如:</h2><pre class="kj kk kl km fd ks kt ku kv aw kw bi"><span id="fa4f" class="jn jo hh kt b fi kx ky l kz la">curl -X POST <a class="ae lb" href="https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/u/large_random_data.csv/id/7f878479-00e1-4630-23b6-683deac88a78/" rel="noopener ugc nofollow" target="_blank">https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/u/large_random_data.csv/id/7f878479-00e1-4630-23b6-683deac88a78/</a></span></pre><p id="f5e0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您可以使用带有访问URI的delete命令删除未提交或失败的多部分上传的所有部分。例如:</p><pre class="kj kk kl km fd ks kt ku kv aw kw bi"><span id="e1a3" class="jn jo hh kt b fi kx ky l kz la">curl -X DELETE <a class="ae lb" href="https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/u/large_random_data.csv/id/7f878479-00e1-4630-23b6-683deac88a78/" rel="noopener ugc nofollow" target="_blank">https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/u/large_random_data.csv/id/7f878479-00e1-4630-23b6-683deac88a78/</a></span></pre><h2 id="809f" class="jn jo hh bd jp jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh bi translated">5.获取对象列表</h2><pre class="kj kk kl km fd ks kt ku kv aw kw bi"><span id="a9ee" class="jn jo hh kt b fi kx ky l kz la">curl -X get &lt;unique-par-url&gt;</span><span id="6bb9" class="jn jo hh kt b fi lh ky l kz la">curl -X GET <a class="ae lb" href="https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/o/" rel="noopener ugc nofollow" target="_blank">https://objectstorage.us-ashburn-1.oraclecloud.com/p/OxZ47fcsRhQRxNqhPJzCpqvw23zqZQGV1L9nnLY-g3FzNgO223qo9mR77K2U1gpE/n/idmldytingzx/b/DWH-Load/o/</a></span></pre><p id="c1fd" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">确保上传完成后删除par URL，或者出于安全目的创建一个有效期较短的par URL。</p></div><div class="ab cl li lj go lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="ha hb hc hd he"><h2 id="db00" class="jn jo hh bd jp jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh bi translated">参考文献:<br/>_ _ _ _ _ _ _ _ _ _ _ _ _</h2><p id="9352" class="pw-post-body-paragraph ip iq hh ir b is lc iu iv iw ld iy iz ja le jc jd je lf jg jh ji lg jk jl jm ha bi translated">[1]<a class="ae lb" href="https://docs.oracle.com/en-us/iaas/Content/Object/Tasks/usingmultipartuploads.htm" rel="noopener ugc nofollow" target="_blank">https://docs . Oracle . com/en-us/iaas/Content/Object/Tasks/using multipart uploads . htm</a><br/>【2】<a class="ae lb" href="https://docs.oracle.com/en-us/iaas/Content/Object/Tasks/usingpreauthenticatedrequests.htm" rel="noopener ugc nofollow" target="_blank">https://docs . Oracle . com/en-us/iaas/Content/Object/Tasks/usingpreauthenticatedrequests . htm</a></p></div></div>    
</body>
</html>