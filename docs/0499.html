<html>
<head>
<title>Support new form factors with the new Jetpack WindowManager library</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过新的Jetpack WindowManager库支持新的外形</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/support-new-form-factors-with-the-new-jetpack-windowmanager-library-4be98f5450da?source=collection_archive---------4-----------------------#2020-05-08">https://medium.com/androiddevelopers/support-new-form-factors-with-the-new-jetpack-windowmanager-library-4be98f5450da?source=collection_archive---------4-----------------------#2020-05-08</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/8e1a363e9f8a31cb895ac08db942c66d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*zy5IG2inEQSqeWyPJ7vo-g.gif"/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx">Image by <a class="ae hu" href="http://guswinkelman.com/" rel="noopener ugc nofollow" target="_blank">Gus Winkelman</a></figcaption></figure><div class=""/><p id="04ff" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">由肯尼斯·福特和安德里·库连发布</p><p id="06d7" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">WindowManager是最近添加到<a class="ae hu" href="https://developer.android.com/jetpack" rel="noopener ugc nofollow" target="_blank"> Android Jetpack </a>中的，旨在帮助应用程序开发人员支持新的设备外形，并为新旧平台版本上的不同窗口管理器功能提供一个通用的API表面。最初的版本针对可折叠设备，未来的版本将扩展到支持更多的显示类型和窗口功能。</p><h1 id="b8c2" class="js jt hx bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">我为什么需要它？</h1><p id="e0c1" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr ha bi translated">市场上出现了新的可折叠设备，它们提供了一组独特的硬件功能。针对这些新设备和外形优化您的应用，让您带来与众不同的体验，并让您的用户充分利用他们使用的任何设备。</p><p id="dc28" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">例如，三星Galaxy Z Flip是一款<a class="ae hu" href="https://en.wikipedia.org/wiki/Clamshell_design" rel="noopener ugc nofollow" target="_blank">翻盖式</a>设备，支持折叠和部分折叠状态(三星称之为<a class="ae hu" href="https://www.samsung.com/us/support/answer/ANS00086025/" rel="noopener ugc nofollow" target="_blank"> Flex模式</a>)。当设备处于部分折叠状态时，该应用程序可以优化其布局，并将底部的控件与顶部的其余内容分开。</p><div class="kv kw kx ky fd ab cb"><figure class="kz hj la lb lc ld le paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><img src="../Images/c5668752ad3927c2180577c57280a2f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:790/format:webp/1*hYT_XxdL-Q-NuLS4j8_nrQ.png"/></div></figure><figure class="kz hj lf lb lc ld le paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><img src="../Images/7369d7fc59ac4181f2fa0871e7f95d55.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/1*UPUJYEy2Ecsre2qoHESlfA.png"/></div></figure><figure class="kz hj lf lb lc ld le paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><img src="../Images/d05bd8b9149c6078d7ec1e65d5a9da42.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/1*6Eq5IipFiRycb2Gjah8yeg.png"/></div><figcaption class="hq hr et er es hs ht bd b be z dx lg di lh li">Example of how a camera or photo viewer app may adjust (image copyright by Samsung)</figcaption></figure></div><p id="a210" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">用户可以将手机放在平坦的地方，如桌子上，并使用屏幕的下半部分来导航和与应用程序交互。</p><figure class="kv kw kx ky fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lj"><img src="../Images/7873f92893a0537c3ded74b1dfef9596.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bjWGGUjCqESGHhna"/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx">Google Duo and Youtube screenshots shown during Samsung Galaxy Unpacked 2020</figcaption></figure><p id="5f4f" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Jetpack WindowManager库的目标是为进入市场的不同类型的可折叠设备提供单一的API表面，以便应用程序开发人员可以针对所有类别的设备，而不是单一的型号。</p><p id="10e2" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在版本<a class="ae hu" href="https://developer.android.com/jetpack/androidx/releases/window#version_100_2" rel="noopener ugc nofollow" target="_blank"> 1.0.0 </a>中，该库提供了关于可折叠设备的两个物理属性的信息——显示功能和设备状态。</p><h1 id="ab1f" class="js jt hx bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">显示特征</h1><p id="2821" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr ha bi translated">单个显示面板或多显示器配置可以具有不同的特征，这些特征在连续屏幕表面中产生中断。这些例子可以是折叠、铰链、弯曲区域或切口。如果应用程序窗口中存在这种中断，则可以调整窗口中内容的布局和位置以避开这种区域，或者利用它们并将其用作自然分隔符。</p><p id="02c6" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">每个显示特征区域可以通过其在窗口坐标空间中的边界矩形及其类型来表征。矩形将指示特征的物理边界。特征的类型将有助于定义如何对待它。例如，一些特征可以创建物理分隔和/或非交互区域(例如，两个显示面板之间的铰链、显示剪切)，而其他特征可以用作逻辑分隔(例如，折叠)。</p><figure class="kv kw kx ky fd hj"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="2035" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">支持库的第一个版本只包括两种类型的特性:<code class="du lm ln lo lp b">TYPE_FOLD</code>和<code class="du lm ln lo lp b">TYPE_HINGE</code>。</p><figure class="kv kw kx ky fd hj"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="d265" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">对于<code class="du lm ln lo lp b">TYPE_FOLD</code>来说，边界矩形应该是零高(0，y，width，y)或零宽(x，0，x，height)。这表明不存在不可访问的区域，但它仍然在屏幕上报告位置。</p><h1 id="581a" class="js jt hx bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">设备状态</h1><p id="432c" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr ha bi translated">取决于铰链硬件设计，不同的可折叠设备可以具有几种中间状态:闭合、部分打开、完全打开(平面)或翻转。使用该库，应用程序可以根据这些设备状态提供不同的功能。这些状态被定义为不同的姿势:</p><figure class="kv kw kx ky fd hj"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="ca50" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">每个设备可以根据它们的硬件和期望的UX来报告上面定义的姿态的任何子集</p><h1 id="17d3" class="js jt hx bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">我如何使用它？</h1><p id="d7ac" class="pw-post-body-paragraph iu iv hx iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr ha bi translated">要添加对窗口管理器的依赖，您必须将<a class="ae hu" href="https://android.devsite.corp.google.com/studio/build/dependencies?skip_cache=true#google-maven" rel="noopener ugc nofollow" target="_blank"> Google Maven资源库</a>添加到您的项目中。</p><p id="31ae" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在您的应用程序或模块的<code class="du lm ln lo lp b">build.gradle</code>文件中添加您需要的工件的依赖关系:</p><figure class="kv kw kx ky fd hj"><div class="bz dy l di"><div class="lk ll l"/></div></figure><figure class="kv kw kx ky fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lq"><img src="../Images/b88638abf8c829f43990ce67bbdd6890.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HAdNYk-hu9ii9lK474PJMA.png"/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx">Google Duo on the Samsung Galaxy Z Flip</figcaption></figure><p id="22c7" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">比方说，你想要像可折叠设备上的Google Duo一样拆分你的应用程序的UI。通常，在设备的物理配置和状态为用户创建了逻辑分离的情况下，这样做是有意义的。例如，Galaxy Z Flip在“弯曲”或“半折叠”模式下会产生这样的逻辑分离。因此，你需要知道折叠在应用程序窗口中的位置以及设备的状态。</p><p id="02db" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">首先，从一个活动中获取一个<code class="du lm ln lo lp b">androidx.window.WindowManager</code>的实例。</p><figure class="kv kw kx ky fd hj"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="6d7f" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">注意这里的参数。</p><p id="d0b6" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">首先，上下文用于初始化并将<code class="du lm ln lo lp b">WindowManager</code>的实例连接到屏幕上的可视实体。所以一定是目测<code class="du lm ln lo lp b">Context</code>，也就是说不是<code class="du lm ln lo lp b">Activity</code>就是一个左右的<code class="du lm ln lo lp b">ContextWrapper</code>。</p><p id="e30f" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">其次，窗口后端是支持库的信息提供者。在这里传递<code class="du lm ln lo lp b">null</code>意味着将使用默认的设备信息，并且当应用程序在普通手机上运行时，库将报告没有显示功能和未知的设备状态。然而，您也可以传递一个定制的<code class="du lm ln lo lp b">androidx.window.WindowBackend</code>实现来模拟任何种类的可折叠设备，而无需访问物理硬件。我们在示例应用程序中展示了一个<a class="ae hu" href="https://github.com/android/user-interface-samples/blob/master/WindowManager/app/src/main/java/com/example/windowmanagersample/backend/MidScreenFoldBackend.kt" rel="noopener ugc nofollow" target="_blank">例子。</a></p><p id="bd48" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">由于只有在逻辑硬件分离的情况下分离UI才有意义，因此有两种情况需要这样做:</p><ol class=""><li id="9168" class="lr ls hx iw b ix iy jb jc jf lt jj lu jn lv jr lw lx ly lz bi translated">显示特征的类型是<code class="du lm ln lo lp b">TYPE_HINGE</code>，并且在活动窗口内总是有物理分隔。</li><li id="53d8" class="lr ls hx iw b ix ma jb mb jf mc jj md jn me jr lw lx ly lz bi translated">或者显示特征类型为<code class="du lm ln lo lp b">Type_Fold</code>，屏幕状态不平坦(例如不是<code class="du lm ln lo lp b">POSTURE_OPENED</code>)。具体到Galaxy Z Flip，我们会对<code class="du lm ln lo lp b">POSTURE_HALF_OPENED</code>感兴趣。</li></ol><p id="574e" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">对于折叠的情况，我们需要了解设备姿态的变化，因此我们需要注册一个<code class="du lm ln lo lp b">DeviceState</code>变化监听器:</p><figure class="kv kw kx ky fd hj"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="440c" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在回调中，如果需要，您可以更改设备状态并更新UI。</p><p id="a51b" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">最后，我们需要获得位于活动窗口中的实际显示特性。</p><figure class="kv kw kx ky fd hj"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="2a5d" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">根据您的活动如何处理(或不处理)配置变更，您可能需要在活动生命周期的不同点询问它。在窗口装饰视图的布局上请求它将确保它在活动状态改变后总是最新的:</p><figure class="kv kw kx ky fd hj"><div class="bz dy l di"><div class="lk ll l"/></div></figure><p id="3c91" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">注意，显示特征的位置是相对于活动窗口坐标空间计算的。因此，它只能在将活动附加到窗口后提供。在此之前请求信息将引发异常。</p><p id="181f" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们强烈建议探索图书馆的演示应用程序。它还包含计算视图层次结构中显示特性的<a class="ae hu" href="https://github.com/android/user-interface-samples/blob/master/WindowManager/app/src/main/java/com/example/windowmanagersample/SampleTools.kt" rel="noopener ugc nofollow" target="_blank">位置的示例、</a>和<a class="ae hu" href="https://github.com/android/user-interface-samples/blob/master/WindowManager/app/src/main/java/com/example/windowmanagersample/SplitLayout.kt" rel="noopener ugc nofollow" target="_blank">一个如果发现分割显示特性则自动分割内容的布局示例</a>。</p></div></div>    
</body>
</html>