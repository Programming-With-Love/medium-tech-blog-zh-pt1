<html>
<head>
<title>The Full-Stack Guide to Actions for Google Assistant</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">谷歌助手全栈操作指南</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/the-full-stack-guide-to-actions-for-google-assistant-e1765edd075b?source=collection_archive---------1-----------------------#2018-01-16">https://medium.com/google-developer-experts/the-full-stack-guide-to-actions-for-google-assistant-e1765edd075b?source=collection_archive---------1-----------------------#2018-01-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="f4bd" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">另外:我们如何教谷歌助手教你西班牙语</h2></div><p id="fbdb" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你目前正在构建或考虑开发一个自定义的谷歌助手操作，这篇文章就是为你准备的！</p><p id="0c6a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我的朋友Daniel Gwerzman和我最近发布了<a class="ae ju" href="https://assistant.google.com/services/a/id/78ef501ffbad84c8?hl=en" rel="noopener ugc nofollow" target="_blank">西班牙语课</a>，这是一个助手，它将通过每天教你一些新单词，并为你朗读西班牙语例句，让你翻译成英语来帮助你学习西班牙语。</p><p id="9d58" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">由于我们在构建应用程序时获得了如此多的乐趣，我们想向您展示我们是如何做到的，包括一些有趣的代码片段。我们的目标是帮助您在开发自己的行动时节省一些宝贵的时间，并向您展示创建这些行动是多么有趣！</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es jv"><img src="../Images/09740f82f3f502ad9c22f6be33a0e76d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6i5vbeqyuvn7tRi2o4G0sg.png"/></div></div><figcaption class="kh ki et er es kj kk bd b be z dx">The Spanish Lesson Logo :)</figcaption></figure><h2 id="b200" class="kl km hh bd kn ko kp kq kr ks kt ku kv jf kw kx ky jj kz la lb jn lc ld le lf bi translated">那么这整件事是怎么开始的呢？</h2><p id="9175" class="pw-post-body-paragraph iw ix hh iy b iz lg ii jb jc lh il je jf li jh ji jj lj jl jm jn lk jp jq jr ha bi translated">几个月前，我的生活伴侣Ariella得到了一个新的Google Home设备。她对此非常兴奋，尝试了各种各样的东西。在某个时候，我听到她问设备:“嘿，谷歌，教我西班牙语”，设备回答说:“对不起，我还不知道如何帮助那个<em class="ll">。</em></p><p id="0d98" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">巧合的是，在同一天的早些时候，我读了丹尼尔·格威兹曼的文章，他在文章中解释了为什么现在是在谷歌上采取行动的好时机。他有一些非常好的观点——人们很懒，宁愿说话也不愿意打字，由于这仍是平台的早期阶段，因此有很多机会在技术领域产生重大影响。</p><p id="9804" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因此，当助手回答Ariella说它还不能教她西班牙语时，我突然想到:为什么我不这样做呢？！</p><p id="083b" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">第二天，我打电话给丹尼尔，问他是否准备好开始新的冒险。丹尼尔对这个想法非常兴奋，我们开始合作。我们坐在一起，<a class="ae ju" rel="noopener" href="/@zps270/designing-personas-for-google-action-bdfdcd2b4abc">设计了一个人物角色</a>，这是创建文本和可能的对话流的基础。我们在这个过程中学到了很多，几周后我们可能会从产品/ UX的角度发表另一篇文章。</p><p id="9385" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">然而，这篇文章的重点是创建助手动作的技术部分——我们遇到的挑战，我们选择的堆栈，基本上是与您分享如何在Google Assistant上提供真实、复杂的动作的完整解决方案的架构。</p><p id="0654" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们将报道我们做出的技术决策，并分享我们的经验和我们选择的结果。</p><h1 id="6360" class="lm km hh bd kn ln lo lp kr lq lr ls kv in lt io ky iq lu ir lb it lv iu le lw bi translated">模板、对话流还是动作SDK？</h1><p id="7f4e" class="pw-post-body-paragraph iw ix hh iy b iz lg ii jb jc lh il je jf li jh ji jj lj jl jm jn lk jp jq jr ha bi translated">目前有三种构建助手动作的方法:现成的模板、Dialogflow和Actions SDK。</p><p id="eb47" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><a class="ae ju" href="https://developers.google.com/actions/templates/first-app" rel="noopener ugc nofollow" target="_blank">现成的模板</a>非常适用于创建小游戏或闪存卡应用程序等用例。当您使用模板时，您不需要编写一行代码，只需填写一些电子表格，就会根据您填写的信息为您创建操作。这对于学校教师来说非常有用，他们可以很容易地为学生创建游戏。</p><p id="1a9c" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">然而，在我们的例子中，我们需要更多的功能:我们希望能够跟踪用户的进度，实际上在一个应用程序中混合西班牙语和英语是一个相当大的挑战，正如你马上会看到的那样。所以我们必须在Dialogflow和Actions SDK之间做出选择。</p><p id="61be" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Dialogflow为您提供了一个很好的用户界面来构建对话流(在某些情况下，您甚至可以不写任何代码就离开)，并且还结合了一些人工智能来帮助您理解用户意图。</p><p id="aa40" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Actions SDK为您提供了对用户输入的“基本”访问，并且由您提供一个后端来解析该输入并生成适当的响应。</p><p id="f5fe" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们决定使用Dialogflow，因为它可以为我们处理一些流(例如，问用户一个是或否的问题，并理解用户的反应)，而且它还可以让我们快速地构建原型。</p><p id="2fa3" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Dialogflow的内置功能证明对我们非常有用。例如，如果用户不知道如何翻译给他们的句子，他们可以说“我不知道”来得到答案并跳到下一个。</p><p id="fade" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在我们发布这款应用后，我们很快意识到用户有很多方式来表达他们不知道这句话——“我不知道”、“我忘了”、“这是什么”，甚至是老一套的“idk”。</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es lx"><img src="../Images/0793237c5820e9eafe6535655c0391d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A5OoPixM1I1p-tx4_aElUA.png"/></div></div><figcaption class="kh ki et er es kj kk bd b be z dx">“I don’t know” — Dialogflow in Action</figcaption></figure><p id="a68a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">将这些备选方案添加到应用程序中很容易，因为Dialogflow允许我们在进行中快速添加新的变化。这意味着我们可以很容易地改进我们的应用程序，因为我们可以从用户对应用程序的实际评论中学习。既然快速迭代这么简单，我们就一直这么做！</p><h1 id="cff6" class="lm km hh bd kn ln lo lp kr lq lr ls kv in lt io ky iq lu ir lb it lv iu le lw bi translated">后端和持续集成</h1><p id="ab21" class="pw-post-body-paragraph iw ix hh iy b iz lg ii jb jc lh il je jf li jh ji jj lj jl jm jn lk jp jq jr ha bi translated">作为一名Web开发人员，JavaScript是我的谋生之道，所以在选择后端技术时，我选择了Node.js，这一决定也是基于这样一个事实，即有一个官方的Node SDK可以使用dialog flow(Google上的<a class="ae ju" href="https://www.npmjs.com/package/actions-on-google" rel="noopener ugc nofollow" target="_blank">操作</a>包)来开发Google上的操作。丹尼尔已经有过使用它的经验，<a class="ae ju" rel="noopener" href="/@zps270/building-google-action-with-javascript-bb5c136d3cdc">全心全意地推荐了它</a>。</p><p id="59ec" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了补充开发经验，我还建立了<a class="ae ju" href="https://www.typescriptlang.org" rel="noopener ugc nofollow" target="_blank"> TypeScript </a>，这是现在我对任何大于几行代码的项目的首选解决方案。方便的是，Actions SDK带有完整的类型定义，所以我使用了自动完成和类型检查。最后，我用来自脸书的测试框架<a class="ae ju" href="https://facebook.github.io/jest/" rel="noopener ugc nofollow" target="_blank"> Jest </a>建立了单元测试。我将它与<a class="ae ju" href="http://google search Wallaby.js" rel="noopener ugc nofollow" target="_blank"> Wallaby.js </a>结合使用，这是一个持续运行您的测试并在您键入代码时向您显示执行结果和代码覆盖率的解决方案。我感谢Artem创造了它。</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es ly"><img src="../Images/e065dc9a3a9482f6f80281fd727b10de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZepeEsnaiON6967tw5cSkw.png"/></div></div><figcaption class="kh ki et er es kj kk bd b be z dx">Excerpt from our answer verification logic — the green bullets on the left is how Wallaby indicates our coverage</figcaption></figure><p id="9302" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">除了测试应用程序逻辑，我们还使用单元测试来验证我们的西班牙语单词课程的一致性，例如，下面是一个测试的摘录，该测试验证了数据库中的每个单词至少有3个句子出现:</p><figure class="jw jx jy jz fd ka"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="387f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">拥有一个坚实的测试基础是持续集成的一个关键因素，这也是我们在行动中所采用的。我们使用<a class="ae ju" href="https://circleci.com/" rel="noopener ugc nofollow" target="_blank"> CircleCI </a>，并对其进行设置，以便每当我将变更推送到<code class="du mb mc md me b">master</code>分支时，测试套件就会被执行，代码会用<a class="ae ju" href="https://palantir.github.io/tslint/" rel="noopener ugc nofollow" target="_blank"> tslint </a>进行检查，如果一切顺利，新版本会立即部署并投入生产。</p><p id="3d29" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们使用Docker创建一个包含transpiled应用程序的容器，然后将它推送到<a class="ae ju" href="https://cloud.google.com/container-registry/?" rel="noopener ugc nofollow" target="_blank">Google Container Registry</a>，然后部署到我们为此设置的一台小型机器上(还有Metabase，见下文)。对于将代码部署到<a class="ae ju" href="https://cloud.google.com/functions/" rel="noopener ugc nofollow" target="_blank"> Firebase Functions </a>、<a class="ae ju" href="https://cloud.google.com/appengine/docs/flexible/" rel="noopener ugc nofollow" target="_blank"> Google App Engine </a>、<a class="ae ju" href="https://cloud.google.com/run/" rel="noopener ugc nofollow" target="_blank"> Google Cloud Run </a>或<a class="ae ju" href="https://cloud.google.com/kubernetes-engine/" rel="noopener ugc nofollow" target="_blank"> Google Kubernetes Engine </a>，我们有一些备选方案，但是我们决定在我们的服务器上简单地运行Docker。</p><p id="d667" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这是我们的Dockerfile，它使用了Docker 17中引入的<a class="ae ju" href="https://docs.docker.com/engine/userguide/eng-image/multistage-build/" rel="noopener ugc nofollow" target="_blank">多阶段构建</a>特性。首先，我们构建一个容器，在其中运行我们的测试并用JavaScript传输源代码。成功完成后，我们将进入第二阶段，在此阶段，我们将基于更精简的Node-Alpine映像构建实际的生产容器:</p><figure class="jw jx jy jz fd ka"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="f137" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">最后，我们使用名为<a class="ae ju" href="https://sentry.io" rel="noopener ugc nofollow" target="_blank"> Sentry </a>的服务来跟踪错误。它收集我们生产环境中发生的任何异常的信息，并向我们发送包含信息的电子邮件。您还可以在docker文件的第32行中看到，我们用当前版本的标签定义了一个环境变量，然后Sentry使用它来跟踪在我们部署新版本后是否还会出现问题。我们用CircleCI构建号填充<code class="du mb mc md me b">${BUILD}</code>变量，方法是在构建映像时将<code class="du mb mc md me b">--build-arg</code>参数传递给<code class="du mb mc md me b">docker</code>命令。</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es mf"><img src="../Images/a52b13abc98081e659a69d7a9f6a68e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g6a8f4rqv4VWhGol1-sK0Q.png"/></div></div><figcaption class="kh ki et er es kj kk bd b be z dx">Example for an error we had, tracked by sentry down to the exact source code line</figcaption></figure><p id="ae83" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">总的来说，我们目前的设置包括测试和哨兵作为安全网，我们相信这一点，这样我们就可以做出很大的改变，将东西部署到生产中，而不用进行大量的手动测试，也不用担心我们会破坏应用程序。我喜欢这样工作。</p><h1 id="69b0" class="lm km hh bd kn ln lo lp kr lq lr ls kv in lt io ky iq lu ir lb it lv iu le lw bi translated">分析学</h1><p id="6809" class="pw-post-body-paragraph iw ix hh iy b iz lg ii jb jc lh il je jf li jh ji jj lj jl jm jn lk jp jq jr ha bi translated">作为一名企业家，如果生活教会了我一件事，那就是每当你开始一个新产品时，你拥有的每一个用户都是一个学习你的产品的新东西的巨大机会。</p><p id="f704" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在原型制作时，我坐在Ariella旁边，观察她使用应用程序，我们从这样做中得到了非常有价值的反馈。例如，这就是我们如何决定添加上面提到的“我不知道”场景。</p><p id="06d4" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">有鉴于此，我们很清楚，我们希望跟踪所有用户与我们的应用程序的交互，也希望有一种简单的方法来查询这些交互，分析它们并将其可视化，以帮助我们了解模式。我们希望从第0天开始收集分析，并寻找一个简单的解决方案，不需要太多的编码，并且能够随着应用程序的发展而发展。我们选择了Google的数据仓库解决方案<a class="ae ju" href="https://cloud.google.com/bigquery/" rel="noopener ugc nofollow" target="_blank"> BigQuery </a>，它可以轻松扩展到海量数据，并支持我们熟悉的SQL查询语言。</p><p id="5df5" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们使用BigQuery的方式是使用一个称为“流插入”的特性直接向它报告任何用户交互，这个特性允许您在新行出现时逐个插入新行。您可以在下面看到报告用户交互的代码片段:</p><figure class="jw jx jy jz fd ka"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="9f25" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">基本上，你用<code class="du mb mc md me b">DialogflowConversation</code>实例调用这个函数，以及你发送给用户的响应(如果有的话)，就都设置好了。这是我们如何定义BigQuery表模式的:</p><figure class="jw jx jy jz fd ka"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="0ac9" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">最初，我们只跟踪输入和响应，但当我们开始看到用户与应用程序交互时，我们看到许多应用程序似乎没有正确理解用户的情况，因此我们想了解用户如何与应用程序交互，以及他们来自世界的哪个地方。</p><p id="87ba" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这就是我们开始收集<code class="du mb mc md me b">locale</code>、<code class="du mb mc md me b">inputType </code>和<code class="du mb mc md me b">surfaceCapabilities</code>零件的地方。后两种方法不是很直接，因为在我们将它们存储到数据库之前，它们需要一些预处理:</p><figure class="jw jx jy jz fd ka"><div class="bz dy l di"><div class="lz ma l"/></div></figure><p id="6088" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们了解到，绝大多数用户使用语音与我们的应用程序互动:</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es mg"><img src="../Images/d43301c735d17ccf01410d07e39e93ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dHpIq3TCUAaGkNH4HtG-ew.png"/></div></div></figure><p id="7f48" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">通过查看表面功能，我们还可以看到许多用户使用仅具有音频输出和媒体响应音频功能的设备与我们进行交互，我们认为这是Google Home(与支持屏幕输出的设备，如智能手机形成对比):</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es mh"><img src="../Images/056ff3d169ccc2f6e0eb6c38f96d933b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PrQW42seBpwbBjqEytI6bQ.png"/></div></div></figure><p id="3491" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">总的来说，设置BigQuery大约需要一个小时的编码和测试，然后生成一个带有凭证的<a class="ae ju" href="https://developers.google.com/identity/protocols/OAuth2ServiceAccount#creatinganaccount" rel="noopener ugc nofollow" target="_blank">服务帐户文件</a>，并将其包含在我们的代码中。幸运的话，这是一个我们不需要很快重新访问的部分，因为整个数据库完全是为我们管理的。如您所见，我们已经产生了一些非常有用的见解，有助于我们塑造和改进我们的产品。</p><p id="0395" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">你可能想知道上面的图表从何而来。BigQuery没有内置的数据可视化，虽然您可以将查询结果导出到Excel，但这不是很方便。我们使用一个名为<a class="js jt ge" href="https://medium.com/u/d8cd1c2343d5?source=post_page-----e1765edd075b--------------------------------" rel="noopener" target="_blank"> Metabase </a>的免费产品，它连接到BigQuery并允许您轻松地查询和可视化数据。例如，我是这样为第一个图设置查询的:</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es mi"><img src="../Images/3f2a571d425d5122913ef04666d83587.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5AmPP_9kl_rZsrwIwoQ8dw.png"/></div></div></figure><p id="caee" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">您还可以选择使用SQL编写查询，以防需要更复杂的聚合，或者连接几个表中的数据。最后，Metabase允许您创建漂亮的仪表板，您可以设置它来显示您关心的指标:</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es mj"><img src="../Images/e65104f1dde796bd5a5c4dcab4a6b9fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AgIMXgTJy5ruUMzWF1leeA.png"/></div></div><figcaption class="kh ki et er es kj kk bd b be z dx">Our Current Metabase Dashboard</figcaption></figure><p id="5237" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">嗯，根据上面的图表，你大概可以猜出我们在哪个时间点启动了这个应用程序:-)</p><p id="955d" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">更新:截至2019年5月，谷歌推出了自己的数据可视化工具，<a class="ae ju" href="https://support.google.com/datastudio/answer/9005651?hl=en" rel="noopener ugc nofollow" target="_blank"> Data Studio Explorer </a>。它仍处于测试阶段，但可以成为元数据库的可行替代方案，并且不需要任何设置。</p><p id="1d6e" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">谷歌还在谷歌控制台上的操作中的专用分析部分提供了一些对应用程序的见解，在那里您可以了解应用程序的健康状况、延迟、发现等。</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es mk"><img src="../Images/1740aef2a96f14013171b8c7131a6190.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AIOfl9B8pu9bizmlm2Qvlg.png"/></div></div><figcaption class="kh ki et er es kj kk bd b be z dx">Our latency stats from the Actions on Google console. How do they compare with your?</figcaption></figure><p id="7c94" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">需要指出的是，建立一个分析解决方案非常简单，而且你可以从你的数据中学到很多东西，所以这绝对是你在启动应用程序之前要做的事情。</p><h1 id="8c9a" class="lm km hh bd kn ln lo lp kr lq lr ls kv in lt io ky iq lu ir lb it lv iu le lw bi translated">会说西班牙语</h1><p id="0733" class="pw-post-body-paragraph iw ix hh iy b iz lg ii jb jc lh il je jf li jh ji jj lj jl jm jn lk jp jq jr ha bi translated">这一部分对于我们的用例来说有些特殊，所以我会尽量简短。我们希望该应用程序除了英语之外，还能说西班牙语。谷歌助手允许你使用一种叫做<a class="ae ju" href="https://en.wikipedia.org/wiki/Speech_Synthesis_Markup_Language" rel="noopener ugc nofollow" target="_blank"> SSML </a>的语言定制回应，这种语言可以指定语音参数，如速度、音高，还可以给出如何阅读文本特定部分的提示，如添加<a class="ae ju" href="https://www.w3.org/TR/speech-synthesis11/#S3.2.2" rel="noopener ugc nofollow" target="_blank">强调</a>。</p><p id="f746" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">不幸的是，谷歌的SSML实现目前不支持不同语言之间的切换。然而，它允许你插入外部音频文件，所以理论上我们可以用不同的方法生成西班牙语语音。</p><p id="765d" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">然而，有趣的是，我们在一个相当意想不到的地方找到了解决方案:亚马逊云。它有一个名为<a class="ae ju" href="https://aws.amazon.com/polly/pricing/" rel="noopener ugc nofollow" target="_blank"> Amazon Polly </a>的云TTS服务，免费等级很高:每月500万个字符。他们还支持SSML，这意味着当用户要求重复一个句子时，我们可以要求它说得慢一些。</p><p id="74b4" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这个故事的寓意是，有时，如果您混合和匹配来自多个云提供商的服务来满足您的特定需求，您可以获得更好的结果。</p><h1 id="8b75" class="lm km hh bd kn ln lo lp kr lq lr ls kv in lt io ky iq lu ir lb it lv iu le lw bi translated">用户数据的数据库</h1><p id="30a4" class="pw-post-body-paragraph iw ix hh iy b iz lg ii jb jc lh il je jf li jh ji jj lj jl jm jn lk jp jq jr ha bi translated">该应用的第一个原型只是给用户一个随机的西班牙语句子，让他们翻译成英语。当看着我们的#1 beta测试员Ariella使用它时，我意识到这不是正确的方法，因为有许多单词她还不熟悉；让这个动作吐出一个随机的句子，而没有考虑到她目前的词汇量，这没有多大意义。</p><p id="04b3" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这时，我意识到我们需要使用某种数据库来存储每个用户的进度。</p><p id="84a5" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们选择了新的<a class="ae ju" href="https://firebase.google.com/docs/firestore/" rel="noopener ugc nofollow" target="_blank"> Cloud Firestore </a>数据库，因为它是完全托管和管理的，并且是无模式的文档数据库，这使得它非常适合快速原型开发。我仍然是Firestore的新手，但我真的很喜欢使用Firebase(实际上，自从2013年他们公开测试以来，我一直是他们的用户，我甚至编写了自己的<a class="ae ju" href="https://github.com/urish/firebase-server" rel="noopener ugc nofollow" target="_blank"> firebase-server </a>实现)，所以我决定尝试一下。</p><p id="d841" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">到目前为止，我很高兴:从Node.js连接到它是一件轻而易举的事情，在我们构建的小型前端应用程序中也是如此。他们的控制台是开发原型时浏览和管理文档的一种非常方便的方式:</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div class="er es ml"><img src="../Images/3571e343be3e9bd772e2e18e8f23c162.png" data-original-src="https://miro.medium.com/v2/resize:fit:1162/format:webp/1*L9RKfVAEgyp5HkAYJYo19w.png"/></div><figcaption class="kh ki et er es kj kk bd b be z dx">Using the FireStore console to check on our users progress</figcaption></figure><p id="06da" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在某个时候，丹尼尔问我为什么我们同时需要BigQuery和Firestore。答案在于两者之间的根本区别:BigQuery非常适合对大量数据进行复杂查询。无论数据大小如何，您都可以在几秒钟内得到答案。这也是它的弱点所在——即使你只想要一条记录，引擎仍然需要扫描整个表，你可以在几秒钟内得到答案。虽然等待5秒来获得复杂查询的结果是有意义的，但让我们的用户在每次与应用程序交互时等待5秒或更多不是我们想要的那种体验。</p><p id="ce12" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">此外，在修改现有数据方面，big query<a class="ae ju" href="https://cloud.google.com/bigquery/docs/reference/standard-sql/data-manipulation-language#quotas" rel="noopener ugc nofollow" target="_blank">非常有限。因此Firestore非常适合快速读取/插入/更新操作，而BigQuery擅长存储和查询聚合用户数据。因此，就像我们最终如何使用多种服务来让我们的应用程序说西班牙语一样，这都是为了找到适合这项工作的正确工具。</a></p><h1 id="62e1" class="lm km hh bd kn ln lo lp kr lq lr ls kv in lt io ky iq lu ir lb it lv iu le lw bi translated">前端</h1><p id="8517" class="pw-post-body-paragraph iw ix hh iy b iz lg ii jb jc lh il je jf li jh ji jj lj jl jm jn lk jp jq jr ha bi translated">现在你可能想知道:前端和辅助动作有什么关系？在某个时候，我们可能会为我们的用户建立一个网页，以便他们可以看到自己的进展，但现在，我们决定为自己建立一个小工具，以探索我们的用户如何与应用程序交互。没错，我们在BigQuery中有所有的数据，但是从表中读取对话不是很方便。</p><p id="4dde" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我决定抓住这个机会学习一项新技术，<a class="js jt ge" href="https://medium.com/u/9b930cf6db26?source=post_page-----e1765edd075b--------------------------------" rel="noopener" target="_blank"> Vue.js </a>。我从<a class="ae ju" href="https://github.com/fuse-box/fuse-box-vue-seed" rel="noopener ugc nofollow" target="_blank"> fuse-box-vue-seed </a>开始，其中还包括<a class="ae ju" href="https://vuetifyjs.com/" rel="noopener ugc nofollow" target="_blank">vue ify</a>，一个用于Vue的材质设计组件库，以及<a class="ae ju" href="https://fuse-box.org/" rel="noopener ugc nofollow" target="_blank"> fuse-box </a>，一个超快速的模块捆绑器，它是Webpack的一个很好的替代品。</p><p id="af12" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">然后，我使用<a class="ae ju" href="https://firebase.google.com/docs/auth/?gclid=Cj0KCQiA-ebSBRC8ARIsAGuxJIpY4tsEkZVcVXbd1OXUrYUjBS7V9u75AvXdJYD0nmWuyd9Mpgo1BfYaAvXHEALw_wcB" rel="noopener ugc nofollow" target="_blank"> Firebase认证</a>添加了Google单点登录，使用<a class="ae ju" href="https://firebase.google.com/docs/hosting/" rel="noopener ugc nofollow" target="_blank"> Firebase托管</a>将应用程序部署到web，并使用firebase-admin SDK在我们的后端<a class="ae ju" href="https://firebase.google.com/docs/auth/admin/verify-id-tokens" rel="noopener ugc nofollow" target="_blank">验证用户身份</a>。</p><figure class="jw jx jy jz fd ka er es paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="er es mm"><img src="../Images/eb973a2fa3af467aad9f011ec22ae0a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*np1-dWzL-1BpfG6awxFPeA.png"/></div></div><figcaption class="kh ki et er es kj kk bd b be z dx">One of my testing sessions, visualized by our Vue.js frontend</figcaption></figure><p id="084c" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">总的来说，我对Vue非常满意——学习曲线很平缓，使用Vuetify很容易，我设法快速构建了一个我们现在日常使用的工具，并向其添加了新功能。</p><h1 id="ab90" class="lm km hh bd kn ln lo lp kr lq lr ls kv in lt io ky iq lu ir lb it lv iu le lw bi translated">结论</h1><p id="e8ff" class="pw-post-body-paragraph iw ix hh iy b iz lg ii jb jc lh il je jf li jh ji jj lj jl jm jn lk jp jq jr ha bi translated">我们的应用已经取得了一些成绩，但这仍是一个开始。基于现有技术并利用云服务，如Dialogflow、BigQuery、Firestore、Sentry、Amazon Polly，同时使用Jest、Docker、Circle CI和Google Container Registry的持续部署设置，使我们能够快速启动并运行，即使应用保持运行，也能保持这种速度。</p><p id="30b5" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们的应用程序发布已经两周了，我们已经为数百名用户提供了服务，并了解了许多我们可以改进的地方。一些较小的改进已经在应用程序中实现了，我们现在正在对课程结构进行彻底改革，以使其更加有效。在接下来的几周里，你可能会看到我们的另一个帖子，更多地从产品的角度来讨论。</p><p id="93f4" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">看到用户每天都回到我们的应用程序来学习新单词，这给我们带来了极大的满足感，Ariella在学习新的西班牙语单词方面也很开心！</p><h1 id="43db" class="lm km hh bd kn ln lo lp kr lq lr ls kv in lt io ky iq lu ir lb it lv iu le lw bi translated">听起来有趣吗？试试我们的行动吧！</h1><p id="bf4a" class="pw-post-body-paragraph iw ix hh iy b iz lg ii jb jc lh il je jf li jh ji jj lj jl jm jn lk jp jq jr ha bi translated">哦，别忘了试试我们的<a class="ae ju" href="https://assistant.google.com/services/a/id/78ef501ffbad84c8?hl=en" rel="noopener ugc nofollow" target="_blank">动作</a>！你可以在Google Home、Android 6.0+电视、Android 6.0+手机、iOS 9.0+手机或者你的Chromebook上查看。只要安装谷歌助手(如果你还没有的话)，然后说:</p><blockquote class="mn"><p id="58df" class="mo mp hh bd mq mr ms mt mu mv mw jr dx translated">“和西班牙语课对话”</p></blockquote><p id="39fb" class="pw-post-body-paragraph iw ix hh iy b iz mx ii jb jc my il je jf mz jh ji jj na jl jm jn nb jp jq jr ha bi translated">迪维埃蒂特！(“玩得开心”，别忘了在评论区给我们留下任何反馈！)</p></div></div>    
</body>
</html>