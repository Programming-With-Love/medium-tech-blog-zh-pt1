<html>
<head>
<title>Deploying a simple node.js App to Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将一个简单的node.js应用程序部署到Kubernetes</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/deploying-a-simple-node-js-app-to-kubernetes-56b313b99061?source=collection_archive---------0-----------------------#2019-03-23">https://medium.com/oracledevs/deploying-a-simple-node-js-app-to-kubernetes-56b313b99061?source=collection_archive---------0-----------------------#2019-03-23</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/3b56473de2bb251bb32cde2798e9c810.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RgCNLyra9rfaJdWUxh38xw.jpeg"/></div></div></figure><p id="88a6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">几天前，我向一个小型IT团队展示Kubernetes，一如既往地，我首先解释了容器、Docker Hub、Docker构建文件的概念，然后继续谈论使用Helm Charts部署多层应用程序。最后，我展示了如何用Wercker设置CI/CD。事情没有像我预料的那样发展。</p><p id="7c9b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我正在演示的IT团队被众多工具弄得不知所措，我完全能够理解这一点。试图理解Kubernetes和整个生态系统，同时又不熟悉容器的概念，可能会相当困难。</p><p id="f582" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们后退了几步，展示了一个非常简单的例子:</p><ol class=""><li id="5a27" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm js jt ju jv bi translated">构建一个公开REST API的简单应用程序</li><li id="95ba" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">将应用程序和依赖项打包在Docker映像中</li><li id="a35e" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">将Docker映像推送到注册中心，在本例中是Oracle云基础设施注册中心(OCIR)</li><li id="9974" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">将应用程序部署到Kubernetes</li></ol><p id="4694" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">先决条件:</strong></p><p id="4956" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">本教程有几个先决条件。你可以在这里了解更多。</p><ul class=""><li id="6305" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm kb jt ju jv bi translated">创建Oracle Kubernetes集群</li><li id="718f" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm kb jt ju jv bi translated">安装OCI工具</li><li id="320a" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm kb jt ju jv bi translated">安装Kubectl</li><li id="75a6" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm kb jt ju jv bi translated">下载OKE配置</li><li id="497c" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm kb jt ju jv bi translated">创建一个关于OCIR的知识库</li></ul><p id="a727" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我不打算从头开始构建一个应用程序，即使它不会花很长时间。我去了github，尝试了几个不同的应用程序，最终我找到了这个应用程序并克隆了它:</p><div class="kc kd ez fb ke kf"><a href="https://github.com/haj/rest-api-sample" rel="noopener  ugc nofollow" target="_blank"><div class="kg ab dw"><div class="kh ab ki cl cj kj"><h2 class="bd hi fi z dy kk ea eb kl ed ef hg bi translated">朝觐/休息-API-样本</h2><div class="km l"><h3 class="bd b fi z dy kk ea eb kl ed ef dx translated">带身份验证的REST API示例。在GitHub上创建一个帐户，为haj/rest-api-sample的开发做出贡献。</h3></div><div class="kn l"><p class="bd b fp z dy kk ea eb kl ed ef dx translated">github.com</p></div></div><div class="ko l"><div class="kp l kq kr ks ko kt in kf"/></div></div></a></div><p id="3771" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">从github克隆应用:</strong></p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="bfbe" class="ld le hh kz b fi lf lg l lh li">git clone git@github.com:haj/rest-api-sample.git</span></pre><p id="63c5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">转到文件夹:</strong></p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="b179" class="ld le hh kz b fi lf lg l lh li">cd rest-api-sample</span></pre><p id="0b8e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">构建容器:</strong></p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="4e6e" class="ld le hh kz b fi lf lg l lh li">docker build -t fra.ocir.io/&lt;tenancyname&gt;/&lt;reponame&gt;/node-web-app .</span></pre><p id="ae2b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">为Oracle容器注册表创建凭据</strong></p><p id="52b7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Kubernetes需要访问容器注册中心来从中提取图像。</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="1ad0" class="ld le hh kz b fi lf lg l lh li">kubectl create secret docker-registry regcred --docker-server=fra.ocir.io --docker-username=&lt;tenancyname&gt;/myemail@email.com  --docker-password=’very secret’ --docker-email=myemail@email.com</span></pre><p id="354f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">创建一个deployment.yaml文件，它定义了我们的部署和服务。我们将在下一步中使用它来部署容器并创建一个负载平衡器来公开服务:</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="4373" class="ld le hh kz b fi lf lg l lh li">cat &lt;&lt;EOF &gt;&gt; deployment.yaml<br/>apiVersion: apps/v1beta1</span><span id="49d1" class="ld le hh kz b fi lj lg l lh li">kind: Deployment</span><span id="5601" class="ld le hh kz b fi lj lg l lh li">metadata:</span><span id="f1c7" class="ld le hh kz b fi lj lg l lh li">name: hello-world</span><span id="38ba" class="ld le hh kz b fi lj lg l lh li">spec:</span><span id="e53d" class="ld le hh kz b fi lj lg l lh li">replicas: 1 # tells deployment to run 2 pods matching the template</span><span id="9e3c" class="ld le hh kz b fi lj lg l lh li">template: # create pods using pod definition in this template</span><span id="dfeb" class="ld le hh kz b fi lj lg l lh li">metadata:</span><span id="2446" class="ld le hh kz b fi lj lg l lh li"># unlike pod-nginx.yaml, the name is not included in the meta data as a unique name is</span><span id="0e0c" class="ld le hh kz b fi lj lg l lh li"># generated from the deployment name</span><span id="23de" class="ld le hh kz b fi lj lg l lh li">labels:</span><span id="2917" class="ld le hh kz b fi lj lg l lh li">app: hello-world</span><span id="6216" class="ld le hh kz b fi lj lg l lh li">spec:</span><span id="3bd4" class="ld le hh kz b fi lj lg l lh li">containers:</span><span id="dafc" class="ld le hh kz b fi lj lg l lh li">- name: hello-world</span><span id="ac35" class="ld le hh kz b fi lj lg l lh li">image: fra.ocir.io/&lt;tenancyname&gt;/&lt;reponame&gt;/node-web-app:latest</span><span id="77be" class="ld le hh kz b fi lj lg l lh li">ports:</span><span id="47a2" class="ld le hh kz b fi lj lg l lh li">- containerPort: 8081</span><span id="77c7" class="ld le hh kz b fi lj lg l lh li">imagePullSecrets:</span><span id="b87b" class="ld le hh kz b fi lj lg l lh li"># enter the name of the secret you created</span><span id="4c80" class="ld le hh kz b fi lj lg l lh li">- name: regcred</span><span id="0e36" class="ld le hh kz b fi lj lg l lh li">---</span><span id="95fe" class="ld le hh kz b fi lj lg l lh li">apiVersion: v1</span><span id="81d5" class="ld le hh kz b fi lj lg l lh li">kind: Service</span><span id="0d50" class="ld le hh kz b fi lj lg l lh li">metadata:</span><span id="bc18" class="ld le hh kz b fi lj lg l lh li">name: hello-world</span><span id="4016" class="ld le hh kz b fi lj lg l lh li">spec:</span><span id="91a4" class="ld le hh kz b fi lj lg l lh li">type: LoadBalancer</span><span id="61c0" class="ld le hh kz b fi lj lg l lh li">ports:</span><span id="37b9" class="ld le hh kz b fi lj lg l lh li">- port: 80</span><span id="da8b" class="ld le hh kz b fi lj lg l lh li">protocol: TCP</span><span id="32ca" class="ld le hh kz b fi lj lg l lh li">targetPort: 8081</span><span id="51fc" class="ld le hh kz b fi lj lg l lh li">selector:</span><span id="3090" class="ld le hh kz b fi lj lg l lh li">app: hello-world<br/>EOF</span></pre><p id="51c8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">部署到Kubernetes </strong></p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="ab91" class="ld le hh kz b fi lf lg l lh li">kubectl create -f deployment.yaml</span></pre><p id="922a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">检查已创建部署的状态</strong></p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="9eed" class="ld le hh kz b fi lf lg l lh li">kubectl get pods</span></pre><p id="5c6d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">检查服务创建的状态</strong></p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="92dc" class="ld le hh kz b fi lf lg l lh li">kubectl get service</span></pre><p id="d086" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">发布一些内容到部署的App:</strong></p><p id="c362" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">使用创建的负载平衡器的外部ip更改下面的ip。</p><pre class="ku kv kw kx fd ky kz la lb aw lc bi"><span id="53ec" class="ld le hh kz b fi lf lg l lh li">curl -d '{"body":"This is amazing", "feel":"happy"}' -H "Content-Type: application/json" -X POST <a class="ae lk" href="http://132.145.254.60:8081/api/v1/tweet/" rel="noopener ugc nofollow" target="_blank">http://&lt;IP&gt;:80/api/v1/tweet/</a></span></pre><p id="898b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">就这样，您现在已经将一个应用程序打包到一个容器中，将其推送到一个容器注册表中，并将其部署到Kubernetes。</p><p id="ecee" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">查看helm图表，了解如何以更易于管理的方式将容器部署到Kubernetes。</p></div></div>    
</body>
</html>