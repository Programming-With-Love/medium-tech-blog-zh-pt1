<html>
<head>
<title>Building web-based points of sale for Android &amp; iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为Android和iOS建立基于网络的销售点</h1>
<blockquote>原文：<a href="https://medium.com/square-corner-blog/building-web-based-points-of-sale-for-android-ios-9dfbc0f261e4?source=collection_archive---------0-----------------------#2017-08-25">https://medium.com/square-corner-blog/building-web-based-points-of-sale-for-android-ios-9dfbc0f261e4?source=collection_archive---------0-----------------------#2017-08-25</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><blockquote class="ie if ig"><p id="c56d" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated">注意，我们已经行动了！如果您想继续了解Square的最新技术内容，请访问我们的新家<a class="ae jg" href="https://developer.squareup.com/blog" rel="noopener ugc nofollow" target="_blank">https://developer.squareup.com/blog</a></p></blockquote><p id="9bad" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">使用Square，您可以构建一个web应用程序，切换到Square销售点应用程序来接受当面支付。最棒的是，你可以在Android和iOS上做到这一点，因此有可能建立一个基于网络的销售点，可以利用Square的硬件在iOS和Android上接受当面支付。在这篇文章中，我们将通过必要的步骤来构建你自己的应用程序。</p><figure class="jl jm jn jo fd jp er es paragraph-image"><div role="button" tabindex="0" class="jq jr di js bf jt"><div class="er es jk"><img src="../Images/419b806e32d556a6a0d99f7f5fb412f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p9gyP5djmvJVRqI21FLErA.png"/></div></div></figure><p id="234d" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">为了制作一个跨平台的web app，我们需要逻辑来检测目标设备运行的是什么平台。准确地做到这一点可能真的很难，有很多专门解析用户代理的库。为了使这个例子简单，我们将使用在这个<a class="ae jg" href="http://stackoverflow.com/a/21742107/4541769" rel="noopener ugc nofollow" target="_blank">堆栈溢出答案</a>中粗略列出的javascript解决方案，它在用户代理上使用正则表达式。</p><pre class="jl jm jn jo fd jw jx jy jz aw ka bi"><span id="e0f9" class="kb kc hh jx b fi kd ke l kf kg">var userAgent = navigator.userAgent || navigator.vendor;</span><span id="2662" class="kb kc hh jx b fi kh ke l kf kg">if (/android/i.test(userAgent)) {<br/>    return "Android";<br/>}<br/>if (/iPad|iPhone|iPod/.test(userAgent) &amp;&amp; !window.MSStream) {<br/>    return "iOS";<br/>}<br/>return "unknown OS"</span></pre><p id="7dd2" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">如果用户在Android或iOS设备上，那么我们将显示一个按钮，单击该按钮将切换到原生Square销售点应用程序。对于桌面和其他平台，我们将展示一个虚拟的<a class="ae jg" href="https://docs.connect.squareup.com/articles/adding-payment-form" rel="noopener ugc nofollow" target="_blank">电子商务表单</a>，供用户输入他们的卡信息。</p><h2 id="81b7" class="kb kc hh bd ki kj kk kl km kn ko kp kq jh kr ks kt ji ku kv kw jj kx ky kz la bi translated">开始之前</h2><p id="b305" class="pw-post-body-paragraph ih ii hh ik b il lb in io ip lc ir is jh ld iv iw ji le iz ja jj lf jd je jf ha bi translated">如果您尚未创建Square帐户或注册应用程序来获取API凭证，请遵循本<a class="ae jg" href="https://docs.connect.squareup.com/articles/getting-started/" rel="noopener ugc nofollow" target="_blank">Square API入门</a>指南中的步骤1和2。你需要你的<code class="du lg lh li jx b">application id</code>并填写你的<code class="du lg lh li jx b">callback url</code>。</p><h2 id="cfc3" class="kb kc hh bd ki kj kk kl km kn ko kp kq jh kr ks kt ji ku kv kw jj kx ky kz la bi translated">构建URL</h2><p id="7970" class="pw-post-body-paragraph ih ii hh ik b il lb in io ip lc ir is jh ld iv iw ji le iz ja jj lf jd je jf ha bi translated">你可以通过一个链接启动到原生Square应用的切换，就像导航到网络上的任何其他页面一样。请记住，这个链接看起来会与你通常放在<code class="du lg lh li jx b">href</code>中的略有不同。</p><p id="e529" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated"><strong class="ik hi"> iOS: </strong> <br/>基本结构是有一个像这样的链接<code class="du lg lh li jx b">&lt;a href="square-commerce-v1://payment/create?data=PARAMETERS"&gt;</code>，其中<code class="du lg lh li jx b">PARAMETERS</code>是一个编码的JSON对象，包含关于销售价格的信息，Square应用程序应该允许支付的投标等。您的<code class="du lg lh li jx b">PARAMETERS</code>可能看起来像这样:</p><pre class="jl jm jn jo fd jw jx jy jz aw ka bi"><span id="b98c" class="kb kc hh jx b fi kd ke l kf kg">{   <br/>   "amount_money": {<br/>     "amount": 500,<br/>     "currency_code": "USD"<br/>   },<br/>   "callback_url": "myapp-url-scheme://payment-complete",<br/>   "client_id": "MY_APPLICATION_ID",<br/>   "version": "1.2",<br/>   "notes": "Rental fee",<br/>   "options": {<br/>     "supported_tender_types": [<br/>       "CREDIT_CARD",<br/>       "CASH",<br/>       "SQUARE_GIFT_CARD",<br/>     ]<br/>   }<br/> }</span></pre><p id="00d2" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">一定要记得用类似<code class="du lg lh li jx b">encodeURIComponent()</code>的函数对它们进行编码，这样你最终的URL看起来就像这样:</p><pre class="jl jm jn jo fd jw jx jy jz aw ka bi"><span id="9f40" class="kb kc hh jx b fi kd ke l kf kg">&lt;a href="square-commerce-v1://payment/create?data=<!-- -->%7B%22amount_money%22%3A%7B%22amount%22%3A500%2C%22currency_code%22%3A%22USD%22%7D%2C%22callback_url%22%3A%22myapp-url-scheme%3A%2F%2Fpayment-complete%22%2C%22client_id%22%3A%22MY_APPLICATION_ID%22%2C%22version%22%3A%221.2%22%2C%22notes%22%3A%22Rental%20fee%22%2C%22options%22%3A%7B%22supported_tender_types%22%3A%5B%22CREDIT_CARD%22%2C%22CASH%22%2C%22SQUARE_GIFT_CARD%22%5D%7D%7D<!-- -->"&gt;Click on me to Check out!&lt;/a&gt;</span></pre><p id="d772" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">您可以在<a class="ae jg" href="https://docs.connect.squareup.com/articles/register-api-ios/" rel="noopener ugc nofollow" target="_blank">使用iOS版销售点API指南了解更多选项。</a></p><p id="101f" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated"><strong class="ik hi">安卓:<br/> </strong>安卓链接看起来很不一样，但如果你以前用过安卓，应该会有些熟悉。你所要做的就是把你的意图直接放在链接里:</p><pre class="jl jm jn jo fd jw jx jy jz aw ka bi"><span id="f8ec" class="kb kc hh jx b fi kd ke l kf kg">&lt;a href="intent:#Intent;action=com.squareup.register.action.CHARGE;package=com.squareup;S.browser_fallback_url=https://my.website.com/index.html;S.com.squareup.register.WEB_CALLBACK_URI=https://my.website.com/index.html;S.com.squareup.register.CLIENT_ID=sq0ids-yOurCLieNtId;S.com.squareup.register.API_VERSION=v1.3;i.com.squareup.register.TOTAL_AMOUNT=100;S.com.squareup.register.CURRENCY_CODE=USD;S.com.squareup.register.TENDER_TYPES=com.squareup.register.TENDER_CARD,com.squareup.register.TENDER_CARD_ON_FILE,com.squareup.register.TENDER_CASH,com.squareup.register.TENDER_OTHER;end"&gt;Buy Now!&lt;/a&gt;</span></pre><p id="e954" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">交易的所有信息被添加到不同的参数中。参见参考资料<a class="ae jg" href="https://docs.connect.squareup.com/articles/web-api-android/" rel="noopener ugc nofollow" target="_blank">使用Android Web API</a>。</p><h2 id="c9c7" class="kb kc hh bd ki kj kk kl km kn ko kp kq jh kr ks kt ji ku kv kw jj kx ky kz la bi translated">把所有的放在一起</h2><p id="06dc" class="pw-post-body-paragraph ih ii hh ik b il lb in io ip lc ir is jh ld iv iw ji le iz ja jj lf jd je jf ha bi translated">现在我们有了粗略检测操作系统的逻辑，以及处理iOS、Android和web支付的逻辑。我们代码的其余部分由HTML和javascript组成，它们将所有东西粘合在一起。别忘了，测试代码的一个简单方法是使用<a class="ae jg" rel="noopener" href="/@tristansokol/easing-your-development-with-ngrok-5389d6bbbc68"> ngrok </a>将您的开发环境暴露给一个URL。</p><p id="24e9" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">如果您对该代码或使用web API进行销售有任何疑问，请<a class="ae jg" href="https://docs.connect.squareup.com/articles/register-api-overview" rel="noopener ugc nofollow" target="_blank">阅读更多文档</a>，或留下评论，或在Twitter上联系我们(<a class="ae jg" href="https://twitter.com/SquareDev" rel="noopener ugc nofollow" target="_blank"> @SquareDev </a>)。并查看我们在下面创建的示例中的最终代码！</p><figure class="jl jm jn jo fd jp"><div class="bz dy l di"><div class="lj lk l"/></div></figure></div></div>    
</body>
</html>