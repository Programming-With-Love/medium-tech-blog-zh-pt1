<html>
<head>
<title>Mystery of changes not reflected on Docker container</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Docker容器上未反映的变化之谜</h1>
<blockquote>原文：<a href="https://medium.com/version-1/mystery-of-changes-not-reflected-on-docker-container-2b48891c7c11?source=collection_archive---------1-----------------------#2022-12-06">https://medium.com/version-1/mystery-of-changes-not-reflected-on-docker-container-2b48891c7c11?source=collection_archive---------1-----------------------#2022-12-06</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/807651828d43412b44c55996f4d7ed11.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*RelLHV4U77sDkZiBgPAs_g.png"/></div></figure><p id="b63e" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我最近在做一个项目，需要调整现有的Dockerfile配置来添加新的数据库模式。</p><p id="7aff" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">由于一个(当时)神秘的原因，我没有看到我所期望的在数据库容器中创建的新数据库模式。我花了一段时间才想明白。我分享这个希望这将为其他面临类似情况的开发者节省时间。</p><p id="fc33" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">发生了什么事？为什么<em class="jj"> Dockerfile </em>的变化没有反映在数据库容器上？</p><p id="2b88" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">为了解释这一点，让我们用一个小例子来看看它的作用:<a class="ae jk" href="https://github.com/taomoh/docker-gotcha1" rel="noopener ugc nofollow" target="_blank">https://github.com/taomoh/docker-gotcha1</a></p><p id="313c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在这个例子中，我们使用了一个<em class="jj">docker file</em>to "<em class="jj">docker ese</em>"一个基本的<em class="jj">" Hello World "</em><em class="jj">Python</em>应用程序，暴露在端口8000上。</p><p id="4160" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">从这个<em class="jj">Docker文件</em>构建的Docker映像将包含应用程序需要的所有依赖项。</p><p id="0913" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">1.克隆github项目<em class="jj">docker-gotcha 1</em>:<a class="ae jk" href="https://github.com/taomoh/docker-gotcha1" rel="noopener ugc nofollow" target="_blank">https://github.com/taomoh/docker-gotcha1</a></p><p id="f26a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">2.从项目的根文件夹运行<code class="du jl jm jn jo b">docker compose</code>命令启动应用程序:</p><pre class="jp jq jr js fd jt jo ju bn jv jw bi"><span id="a87e" class="jx jy hh jo b be jz ka l kb kc">$ docker-compose up -d web</span></pre><p id="9745" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">检查容器是否按预期启动:</p><pre class="jp jq jr js fd jt jo ju bn jv jw bi"><span id="40fe" class="jx jy hh jo b be jz ka l kb kc">$ docker ps<br/>CONTAINER ID IMAGE     COMMAND     CREATED       STATUS       PORTS                                     NAMES<br/>97f84f04df98 tip-1_web "flask run" 6 seconds ago Up 3 seconds 0.0.0.0:8000-&gt;5000/tcp, :::8000-&gt;5000/tcp tip-1_web_1</span></pre><p id="aab1" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">第一次运行该命令时，它将根据<em class="jj"> Dockerfile </em>中提供的指令构建应用程序Docker映像:</p><pre class="jp jq jr js fd jt jo ju bn jv jw bi"><span id="fbef" class="jx jy hh jo b be jz ka l kb kc">$ docker image ls<br/>REPOSITORY TAG        IMAGE ID     CREATED        SIZE<br/>tip-1_web  latest     268f207b4ba4 19 seconds ago 179MB<br/>python     3.7-alpine caace8ae014d 11 days ago    45.5MB</span></pre><p id="6484" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">3.在浏览器上点击<a class="ae jk" href="http://localhost:8000/" rel="noopener ugc nofollow" target="_blank"> http://localhost:8000/ </a>:你会看到信息<em class="jj">“你好，世界！”不出所料。</em></p><p id="99f8" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">4.现在让我们修改一下应用程序代码:<br/>例如，在<em class="jj"> app.py </em>中，用<code class="du jl jm jn jo b">return `Hola Mundo!`</code>替换:<code class="du jl jm jn jo b">return `Hello World`</code>并重启Docker容器:</p><pre class="jp jq jr js fd jt jo ju bn jv jw bi"><span id="30ea" class="jx jy hh jo b be jz ka l kb kc">$ docker-compose stop<br/>$ docker-compose up -d web</span></pre><p id="b2e0" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">6.在浏览器上点击<a class="ae jk" href="http://localhost:8000/" rel="noopener ugc nofollow" target="_blank"><em class="jj">http://localhost:8000/</em></a>:你还是会看到<em class="jj">“你好世界！”而不是“你好，世界！”</em>不出所料。这是怎么回事？</p><p id="3ec0" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">嗯，<code class="du jl jm jn jo b">docker compose</code>命令重用了第一次运行时创建的映像，其中仍然有旧版本的代码:</p><pre class="jp jq jr js fd jt jo ju bn jv jw bi"><span id="7fd2" class="jx jy hh jo b be jz ka l kb kc">$ docker image ls<br/>REPOSITORY TAG        IMAGE ID     CREATED        SIZE<br/>tip-1_web  latest     268f207b4ba4 17 minutes ago 179MB<br/>python     3.7-alpine caace8ae014d 11 days ago    45.5M</span></pre><p id="04e3" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">您需要重新构建一个新的Docker映像来反映代码更改。为此，您需要通过<em class="jj"> -构建</em>开关:</p><pre class="jp jq jr js fd jt jo ju bn jv jw bi"><span id="91a7" class="jx jy hh jo b be jz ka l kb kc">$ docker-compose stop<br/>$ docker-compose up -d --build web</span></pre><p id="acc4" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">列出Docker映像，您会看到刚刚创建了一个web应用程序的新Docker映像:</p><pre class="jp jq jr js fd jt jo ju bn jv jw bi"><span id="8a4d" class="jx jy hh jo b be jz ka l kb kc">$ docker image ls<br/>REPOSITORY TAG    IMAGE ID     CREATED            SIZE<br/>tip-1_web  latest 5e6982bdd0f1 About a minute ago 179MB<br/>&lt;none&gt;     &lt;none&gt; 268f207b4ba4 23 minutes ago     179M</span></pre><p id="28b5" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这一次，如果你在浏览器上点击<a class="ae jk" href="http://localhost:8000/" rel="noopener ugc nofollow" target="_blank"><em class="jj">http://localhost:8000/</em></a>，你会看到新的消息<em class="jj">“你好，世界！”</em>不出所料。</p><p id="b26b" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如果您必须更改<em class="jj"> Dockerfile </em>，同样的原则也适用:您必须通过向<code class="du jl jm jn jo b">docker compose up</code>命令提供<em class="jj"> - build </em>开关来重新构建您的应用程序映像。</p><p id="6918" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi">关于作者:</strong> <br/> Taoufik Mohdit是这里的高级Java开发人员，负责版本1。</p></div></div>    
</body>
</html>