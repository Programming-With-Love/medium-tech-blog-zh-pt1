<html>
<head>
<title>callback-ktx</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">回拨-ktx</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/callback-ktx-64f57b9fc6cc?source=collection_archive---------4-----------------------#2021-10-05">https://medium.com/google-developer-experts/callback-ktx-64f57b9fc6cc?source=collection_archive---------4-----------------------#2021-10-05</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/57a9a087d2cff92fcb663fb7a5e774af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OYUXyuLvo1Y3b142QhOOPQ.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo by <a class="ae it" href="https://unsplash.com/@cjred?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">CJ Dayrit</a> on <a class="ae it" href="https://unsplash.com/s/photos/ideas?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="03a5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这篇博客是关于<a class="ae it" href="https://github.com/sagar-viradiya/callback-ktx" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hi">图书馆</strong> </a>的，是在阅读了<a class="js jt ge" href="https://medium.com/u/9303277cb6db?source=post_page-----64f57b9fc6cc--------------------------------" rel="noopener" target="_blank"> Chris Banes </a>关于<a class="ae it" href="https://chris.banes.dev/suspending-views/" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hi">暂停浏览</strong> </a>的博客系列后产生的。这个博客背后的意图是揭示这个库，并从社区获得反馈。所以享受这一小段吧！:)</p><p id="57fb" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">安卓❤️s回电。所有的框架和jetpack库API都使用它来通知事件，但是当你有嵌套的回调时，它就变得混乱了。很难理解和衡量。此外，当您处理嵌套回调时，出现错误的几率非常高。</p><p id="15bf" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">好的一面是，我们可以通过Kotlin的协程API轻松避免它。<a class="ae it" href="https://github.com/sagar-viradiya/callback-ktx" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hi"> callback-ktx </strong> </a>是试图将潜在的框架和基于jetpack回调的API包装成挂起的扩展函数。在多次回调的情况下，它暴露<code class="du ju jv jw jx b">Flow</code>来观察所有回调。</p><p id="29b2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果我解释将回调封装到挂起函数中会带来的所有好处，那就有点多余了，因为Chris Banes <a class="ae it" href="https://chris.banes.dev/suspending-views/" rel="noopener ugc nofollow" target="_blank">博客系列</a>已经很好地介绍了这些好处。如果你还没有读过，我建议你在继续读这本书之前先读一读。</p><p id="38e8" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">将基于回调的API封装到挂起函数中并不困难。然而，具有挑战性的是要检查所有的框架和jetpack APIs，并找出哪个API可以从中受益。让我们看看这个库现在能做什么。</p><h2 id="e281" class="jy jz hh bd ka kb kc kd ke kf kg kh ki jf kj kk kl jj km kn ko jn kp kq kr ks bi translated">这是什么？</h2><p id="9ca6" class="pw-post-body-paragraph iu iv hh iw b ix kt iz ja jb ku jd je jf kv jh ji jj kw jl jm jn kx jp jq jr ha bi translated">目前，该库涵盖了来自framework和jetpack的以下API。</p><ul class=""><li id="e7f0" class="ky kz hh iw b ix iy jb jc jf la jj lb jn lc jr ld le lf lg bi translated">动画</li><li id="aa41" class="ky kz hh iw b ix lh jb li jf lj jj lk jn ll jr ld le lf lg bi translated">位置</li><li id="b40d" class="ky kz hh iw b ix lh jb li jf lj jj lk jn ll jr ld le lf lg bi translated">回收视图</li><li id="bab3" class="ky kz hh iw b ix lh jb li jf lj jj lk jn ll jr ld le lf lg bi translated">传感器</li><li id="36a6" class="ky kz hh iw b ix lh jb li jf lj jj lk jn ll jr ld le lf lg bi translated">视角</li><li id="a9ef" class="ky kz hh iw b ix lh jb li jf lj jj lk jn ll jr ld le lf lg bi translated">小部件(文本视图)</li></ul><p id="6daf" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们看一个观察位置更新的例子。</p><p id="f1c7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">要得到最后一个位置，你需要做的就是调用<code class="du ju jv jw jx b">awaitLastLocation</code>，它是<code class="du ju jv jw jx b"><a class="ae it" href="https://developers.google.com/android/reference/com/google/android/gms/location/FusedLocationProviderClient" rel="noopener ugc nofollow" target="_blank">FusedLocationProviderClient</a></code>的一个扩展函数</p><figure class="lm ln lo lp fd ii"><div class="bz dy l di"><div class="lq lr l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Last location through callback-ktx</figcaption></figure><p id="949a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了观察位置更新，它公开了位置流。</p><figure class="lm ln lo lp fd ii"><div class="bz dy l di"><div class="lq lr l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Location updates through callback-ktx</figcaption></figure><p id="d457" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">请注意，扩展需要生命周期所有者和位置请求。这使得流量生命周期感知，所以它不会在应用程序处于后台时触发位置更新。可以访问GitHub上的<a class="ae it" href="https://github.com/sagar-viradiya/callback-ktx" rel="noopener ugc nofollow" target="_blank">库</a>查看更多例子。</p><p id="ae01" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在将回调封装到挂起函数中以避免潜在的内存泄漏和协程不必要的资源使用时，有两件重要的事情</p><ol class=""><li id="debd" class="ky kz hh iw b ix iy jb jc jf la jj lb jn lc jr ls le lf lg bi translated">如果协程由于某种原因被取消，回调需要被取消注册。</li><li id="c41f" class="ky kz hh iw b ix lh jb li jf lj jj lk jn ll jr ls le lf lg bi translated">如果期望回调的异步操作被取消，则需要终止协程。</li></ol><p id="cd2d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">图书馆负责这两者。此外，回调扩展根据它们所属的类别被划分到不同的模块中。例如，所有的框架API都属于核心模块。任何与框架无关的东西都在单独的模块中。因此，根据需要，用户可以依赖特定的maven工件。</p><h2 id="b04d" class="jy jz hh bd ka kb kc kd ke kf kg kh ki jf kj kk kl jj km kn ko jn kp kq kr ks bi translated">下一步是什么？</h2><p id="bf6c" class="pw-post-body-paragraph iu iv hh iw b ix kt iz ja jb ku jd je jf kv jh ji jj kw jl jm jn kx jp jq jr ha bi translated">正如我前面提到的，使用这个库的最大挑战是找出所有可以受益的API。我希望看到社区在提交新扩展、错误修复和优化方面的贡献。</p><div class="lt lu ez fb lv lw"><a href="https://github.com/sagar-viradiya/callback-ktx" rel="noopener  ugc nofollow" target="_blank"><div class="lx ab dw"><div class="ly ab lz cl cj ma"><h2 class="bd hi fi z dy mb ea eb mc ed ef hg bi translated">GitHub-Sagar-vira diya/callback-ktx:Android基于回调的API的扩展函数…</h2><div class="md l"><h3 class="bd b fi z dy mb ea eb mc ed ef dx translated">Android基于回调的API上的扩展函数允许在协程中以顺序方式编写它们…</h3></div><div class="me l"><p class="bd b fp z dy mb ea eb mc ed ef dx translated">github.com</p></div></div><div class="mf l"><div class="mg l mh mi mj mf mk in lw"/></div></div></a></div><p id="312c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">请在下面的评论中告诉我你的想法或任何反馈。直到下次👋🏻</p></div></div>    
</body>
</html>