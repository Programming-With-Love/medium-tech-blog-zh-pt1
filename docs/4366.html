<html>
<head>
<title>MLOps: Big Picture in GCP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">MLOps:GCP的大图景</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/mlops-big-picture-in-gcp-a637566d6ae8?source=collection_archive---------1-----------------------#2021-05-11">https://medium.com/google-developer-experts/mlops-big-picture-in-gcp-a637566d6ae8?source=collection_archive---------1-----------------------#2021-05-11</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/3bf97b40010fc69aa37c6de537b1ca7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1290/format:webp/1*5htR4kopsTb8ii_X0QNVzA.png"/></div></figure></div><div class="ab cl il im go in" role="separator"><span class="io bw bk ip iq ir"/><span class="io bw bk ip iq ir"/><span class="io bw bk ip iq"/></div><div class="ha hb hc hd he"><p id="e4c7" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">自著名理论家、实践家等以来，Twitter已经成为各类人获取最新消息的最重要平台。在你的兴趣是不断张贴他们所发现的，建立的，和更多。</p><p id="a5f6" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">我相信我不是唯一一个每当遇到有趣的推文就转发的人。我告诉自己“好吧，这看起来很有趣，但是我现在不打算读它。让我把它放到我的feed里，这样我以后就可以阅读它了..”。但这从未发生过。</p><p id="3c0b" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">我已经决定构建一个小应用程序，每周推送包含所有转发推文的时事通讯。然而，如果我只是发送它们而不进行任何预处理，这与在Twitter应用程序中滚动没有任何区别。这就是机器学习可以通过以一种有意义的方式对推文进行分类来发挥巨大作用的地方。</p></div><div class="ab cl il im go in" role="separator"><span class="io bw bk ip iq ir"/><span class="io bw bk ip iq ir"/><span class="io bw bk ip iq"/></div><div class="ha hb hc hd he"><h1 id="88a8" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">概观</h1><p id="66b6" class="pw-post-body-paragraph is it hh iu b iv ko ix iy iz kp jb jc jd kq jf jg jh kr jj jk jl ks jn jo jp ha bi translated">这个项目的名字是“个性化/策划的简讯服务”，但我不打算在这篇博文中做深入的解释。相反，我将提供一个关于什么是MLOps(机器学习操作)以及如何在GCP(谷歌云平台)环境中实现它的大图。</p><p id="0c0d" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">这篇博文将简要介绍以下组件。深入的解释有望在未来通过专门的额外博客文章发布。</p><ul class=""><li id="cf12" class="kt ku hh iu b iv iw iz ja jd kv jh kw jl kx jp ky kz la lb bi translated"><strong class="iu hi"> GCP Kubernetes引擎:</strong>管理底层硬件资源，并将适当的资源分配给适当的作业。</li><li id="864d" class="kt ku hh iu b iv lc iz ld jd le jh lf jl lg jp ky kz la lb bi translated"><strong class="iu hi"> GCP AI平台(流水线):</strong>通过保证某些作业应该在Kubernetes环境中预先运行来管理机器学习作业依赖性。</li><li id="a1b6" class="kt ku hh iu b iv lc iz ld jd le jh lf jl lg jp ky kz la lb bi translated"><strong class="iu hi">tensor flow Extended(TFX/m lops):</strong>一个高级框架，为AI平台管道和Kubernetes提供了一种便捷的编写作业规范的方式。</li><li id="8dc2" class="kt ku hh iu b iv lc iz ld jd le jh lf jl lg jp ky kz la lb bi translated"><strong class="iu hi"> GCP人工智能平台(培训):</strong>大规模分布式培训服务，具有高度灵活的可配置性。</li><li id="7d67" class="kt ku hh iu b iv lc iz ld jd le jh lf jl lg jp ky kz la lb bi translated"><strong class="iu hi"> GCP AI平台(预测):</strong>具有统一端点和模型版本控制的可扩展模型服务。</li><li id="b625" class="kt ku hh iu b iv lc iz ld jd le jh lf jl lg jp ky kz la lb bi translated"><strong class="iu hi"> GCP云存储:</strong>一个文件系统服务，可以保存机器学习常用的文件(CSV、Parquet、TFRecord、…)</li><li id="3ebc" class="kt ku hh iu b iv lc iz ld jd le jh lf jl lg jp ky kz la lb bi translated"><strong class="iu hi"> GCP云函数:</strong>基于事件触发的一组逻辑。你可以监听云存储中数据的变化，并为新收集的数据触发运行机器学习管道。</li><li id="16a2" class="kt ku hh iu b iv lc iz ld jd le jh lf jl lg jp ky kz la lb bi translated"><strong class="iu hi"> GCP云构建/ GitHub动作:</strong>为新集成/合并的代码库提供单元测试和部署服务。机器学习流水线可以在新代码上运行，用于不同的数据预处理或建模。</li></ul><p id="839a" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">这些组件可以组合在一起，为我的玩具项目构建一个完整的架构。这有点像图1。如果你不明白每个组件是做什么的，你也不需要担心。我将对每一个进行简短的描述，你可以在读完这篇博文后回来检查它是否有意义。</p><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es lh"><img src="../Images/2d6a96e5ea9fa9194980461fe11499d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CVBzVWMsz4fnV_Uq3OVJVA.png"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx">Fig1. Overall Architecture</figcaption></figure><p id="39ef" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">如果你只考虑应用程序部分,“策划简讯服务”听起来很容易，因为它只是简单地查询公共API。然而，想象你是一个正在构建自己的API的人，并且API是建立在机器学习的能力之上的。</p><h1 id="b02d" class="jq jr hh bd js jt lu jv jw jx lv jz ka kb lw kd ke kf lx kh ki kj ly kl km kn bi translated">我们为什么需要机器学习操作？</h1><p id="6766" class="pw-post-body-paragraph is it hh iu b iv ko ix iy iz kp jb jc jd kq jf jg jh kr jj jk jl ks jn jo jp ha bi translated">这可以通过另一个问题更好地理解，“为什么我们需要为机器学习项目考虑不同的CI/CD管道？”</p><p id="7243" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">我相信这个问题最简单的答案就是“因为不管你愿不愿意，数据都会随着时间而改变”。事实上，我们不是主要的代理人，而是环境，环境会对数据进行更改，我们无法阻止这些更改的发生。所以我们总是要为这种情况做好准备是有道理的。否则，我们会因为缺乏责任感而受到批评。</p><p id="c70b" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">作为开发人员，当数据发生变化时，我们必须处理两种常见的场景(假设我已经收集了全新的数据，并对它们进行了适当的标记)。</p><ul class=""><li id="ae10" class="kt ku hh iu b iv iw iz ja jd kv jh kw jl kx jp ky kz la lb bi translated">当前部署的模型相应地重新学习改变的数据。在这种情况下，系统监听数据改变事件，并运行整个机器学习流水线。</li><li id="facd" class="kt ku hh iu b iv lc iz ld jd le jh lf jl lg jp ky kz la lb bi translated">当前部署的模型无法达到预期的准确性，因此我们需要一个具有适当数据预处理的新模型。一个新的模型意味着代码基础已经改变。在这种情况下，系统应该对新的代码库进行单元测试，听取代码集成，并运行整个机器学习管道。</li></ul></div><div class="ab cl il im go in" role="separator"><span class="io bw bk ip iq ir"/><span class="io bw bk ip iq ir"/><span class="io bw bk ip iq"/></div><div class="ha hb hc hd he"><h1 id="177c" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">为什么是GCP，为什么是云？</h1><p id="ed0f" class="pw-post-body-paragraph is it hh iu b iv ko ix iy iz kp jb jc jd kq jf jg jh kr jj jk jl ks jn jo jp ha bi translated">整个机器学习管道由多个组件组成。图2是在一篇流行的论文“<a class="ae lz" href="https://papers.nips.cc/paper/2015/file/86df7dcfd896fcaf2674f757a2463eba-Paper.pdf" rel="noopener ugc nofollow" target="_blank">机器学习系统中隐藏的技术债务</a>中介绍的，以强调建模只是整个管道的一小部分。</p><p id="5ea8" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">我不同意“ML代码”的框的大小。在我看来，模特是一项艰苦的工作，我不认为有什么比其他的更重要。我只是想从一个角度来看图2，当我们计划推出机器学习驱动的产品时，我们必须考虑多个部分。</p><p id="38be" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">问题是我们必须把几个部分联系在一起。如果你曾经经历过将不同的软件组件集成到一个完整的系统中，你可能知道这有多难。尤其是，构建基础架构非常困难，因为数据科学家或工程师通常不熟悉硬件、软件、操作系统等方面的高深知识。</p><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es ma"><img src="../Images/626526c7b8b037191418e66e183f924e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VZnos_NpvmtIldE7.png"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx">Fig2. Components Consisting of Machine Learning as a Product</figcaption></figure><p id="6903" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">然而，基础设施同时也非常重要，因为一切都应该规模化运行。例如，当您拥有更多数据时，应该使用更多高性能CPU和高容量ram。随着机器学习世界中最先进的(SOTA)模型越来越大，模型训练系统应该能够相应地扩展。您无法预测服务的用户数量何时会激增，因此服务系统也应该能够相应地扩展。</p><p id="7a2f" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">一次做好这些事情并不容易，即使你是一个开源天才。你必须花费大量的时间来建立这样的系统，而且必须不断地对其进行监控。在我看来，最好的选择是利用公共云服务，并在必要时(当您认为自己准备就绪时)逐渐从云环境迁移到本地环境。</p><p id="48c4" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">就像其他云平台一样，你可以将谷歌云平台(GCP)视为你的机器学习产品的一体化解决方案。你仍然需要挂钩GCP提供的不同服务，但这要容易得多，因为它们都在同一个平台上。此外，它们不是开源项目，这意味着它们的大部分功能已被证明适用于大多数情况。</p><p id="2f63" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">我选择使用GCP，不是因为我是机器学习谷歌开发专家(ML GDE)，而是因为GCP是使用TensorFlow、TensorFlow Extended和谷歌发布的其他框架的最佳环境。在我看来，PyTorch是建模的一个很好的选择，但是生态系统还没有成熟到支持MLOps。</p></div><div class="ab cl il im go in" role="separator"><span class="io bw bk ip iq ir"/><span class="io bw bk ip iq ir"/><span class="io bw bk ip iq"/></div><div class="ha hb hc hd he"><h1 id="3af1" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">各GCP服务机构在MLOps中的作用</h1><p id="9a69" class="pw-post-body-paragraph is it hh iu b iv ko ix iy iz kp jb jc jd kq jf jg jh kr jj jk jl ks jn jo jp ha bi translated">在本节中，我将采用自下而上的方法简要概述构成整个MLOps系统的每个GCP服务(如从基础设施到更高级别的服务)。深入的解释和动手实践将在以后的独立博文中涉及。</p><h2 id="7c48" class="mb jr hh bd js mc md me jw mf mg mh ka jd mi mj ke jh mk ml ki jl mm mn km mo bi translated">谷歌Kubernetes引擎</h2><p id="c45d" class="pw-post-body-paragraph is it hh iu b iv ko ix iy iz kp jb jc jd kq jf jg jh kr jj jk jl ks jn jo jp ha bi translated">谷歌Kubernetes引擎(GKE)是一个完全托管在GCP的Kubernetes。在这里，“全面管理”意味着您关心它是什么，而不是它在幕后如何工作。GKE做的很简单。它通过将底层硬件资源分组到所谓的“节点池”中来管理它们。然后，GKE挑选适合所请求作业的节点。例如，一个请求可能类似于“我需要一个GPU”或“我需要一个超过10G RAM的节点”。</p><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mp"><img src="../Images/e9879a688998012dd35733969fa946ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8skkEFy2Kbdytfs5ovAJhQ.png"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx">Fig3. Google Kubernetes Engine</figcaption></figure><p id="c0ee" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">在原生GKE或Kubernetes环境中，您应该编写由元数据、标签、docker图像、策略等组成的详细规范。全靠你自己。不过不要担心。当GKE与TFX和人工智能平台管道服务结合时，您不需要自己处理非常具体的请求和资源分配规则，我们将很快讨论这些内容。你可以把它们想象成一个高级包装器，以一种对机器学习特定管道有意义的方式来控制GKE。</p><h2 id="87f1" class="mb jr hh bd js mc md me jw mf mg mh ka jd mi mj ke jh mk ml ki jl mm mn km mo bi translated">AI平台管道</h2><p id="4201" class="pw-post-body-paragraph is it hh iu b iv ko ix iy iz kp jb jc jd kq jf jg jh kr jj jk jl ks jn jo jp ha bi translated">如你所知，构成整个机器学习管道的作业依赖于其他作业。这意味着某些工作必须在下一个工作之前完成。比如在进行数据预处理之前先注入数据，在模型训练之前进行数据预处理等等。</p><p id="85c8" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">一般来说，GKE不关心顺序依赖。它只是出租可用资源来执行任何给定的作业。此外，在GKE上运行的作业是无状态的，这意味着应用程序本身不存储任何永久信息，因此管理附加存储以保存永久信息是程序员的职责。此外，附加存储对于机器学习管道是不够的，因为信息应该在不同的作业之间共享。</p><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mq"><img src="../Images/9b39890da5bfaaa71ee1c4ef708ded48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zxkPyZtCUTQP5kL4jZh_yg.png"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx">Fig4. AI Platform (Pipeline)</figcaption></figure><p id="d7f3" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">Kubeflow是这种复杂的依赖管理的拯救者。顾名思义，它管理给定作业的流程。您编写一些不同的代码部分，指定作业之间的依赖关系，然后Kubeflow将每个作业包装在一个容器中，并将它们传递给GKE。信息共享在内部处理。</p><p id="a85c" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">然而，Kubeflow本身很难管理。我想整个团队或者至少一个人应该有一个专门的角色来安装、管理和监控它。幸运的是，GCP还提供了Kubeflow的完全管理版本，这就是AI平台管道。有了AI平台管道，你不再需要关心这些麻烦。</p><h2 id="66f9" class="mb jr hh bd js mc md me jw mf mg mh ka jd mi mj ke jh mk ml ki jl mm mn km mo bi translated">AI平台笔记本</h2><p id="e85c" class="pw-post-body-paragraph is it hh iu b iv ko ix iy iz kp jb jc jd kq jf jg jh kr jj jk jl ks jn jo jp ha bi translated">人工智能平台笔记本只是一个位于GCP的Jupyter实验室。关于人工智能平台笔记本，我唯一想提的是它可以很容易地与人工智能平台管道连接起来。这意味着你可以很容易地为AI平台管道编写代码，因为notebook是一个很好的交互环境。</p><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mr"><img src="../Images/f1c9f932d28093d6781c1ed7216d2c92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0yz5VCdSHKp2nFkVp4LGPA.png"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx">Fig5. AI Platform (Notebook)</figcaption></figure><p id="0ea6" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">但是，你几乎肯定不想自己为AI平台管道写代码，因为你应该对AI平台管道的内部运行时环境有深刻的理解。你当然想越来越深，你可能最终要掌握库巴流。但是，如果你真正关心的是建立整个管道，然后在以后检查细节(就像你现在不顾一切地推出一个产品)，你就不会想在这上面花太多时间。</p><p id="511e" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">TensorFlow eXtended(TFX)是救星TFX只是一种定义工作规范的包装框架，可以很容易地扔给AI平台管道。这就像让你只关注你的业务逻辑，而把内部细节放在一边。</p><h2 id="72f6" class="mb jr hh bd js mc md me jw mf mg mh ka jd mi mj ke jh mk ml ki jl mm mn km mo bi translated">张量流扩展(TFX)</h2><p id="203c" class="pw-post-body-paragraph is it hh iu b iv ko ix iy iz kp jb jc jd kq jf jg jh kr jj jk jl ks jn jo jp ha bi translated">顾名思义，TFX是TensorFlow的扩展。TensorFlow是机器学习和深度学习的建模框架，与生产环境处理无关。TFX与TensorFlow一起提供了许多插件，以使用TensorFlow编写的模型可以投入生产。</p><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es ms"><img src="../Images/53893634cb1822221351dfafad31f324.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HgA_mWUSTWHy-6iZlvJPJQ.png"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx">Fig6. TensorFlow Extended</figcaption></figure><p id="bfef" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">图6显示了标准TFX组件列表。举几个简单的例子，让我在下面列出其中的一些。</p><ul class=""><li id="f796" class="kt ku hh iu b iv iw iz ja jd kv jh kw jl kx jp ky kz la lb bi translated"><strong class="iu hi"> ExampleGen: </strong>负责处理数据注入。数据可以来自本地文件系统(有各种格式，比如Parquet、CSV、TFRecord等等)、BigQuery、Google云存储等等。</li><li id="4d4a" class="kt ku hh iu b iv lc iz ld jd le jh lf jl lg jp ky kz la lb bi translated"><strong class="iu hi">转换:</strong>建立一个数据转换图，该图稍后将被附加到模型图上。它可以让你避免训练/发球偏斜的问题。您可以简单地将TensorFlow库与TensorFlow变换(TFT)库一起使用。</li><li id="1aeb" class="kt ku hh iu b iv lc iz ld jd le jh lf jl lg jp ky kz la lb bi translated"><strong class="iu hi">培训师:</strong>就是定义和培训模型。在TFX的早期版本中，只允许基于tf.estimator的模型。然而，你也可以只写基于tf.keras的模型，这应该是你非常熟悉的。此外，您可以轻松地将该组件与AI平台培训服务相结合，以进行分布式模型培训。</li><li id="cf45" class="kt ku hh iu b iv lc iz ld jd le jh lf jl lg jp ky kz la lb bi translated"><strong class="iu hi">推送器:</strong>是将被祝福的模特推到指定位置。这里的“被祝福”指的是通过给定的指标评估并与最新的模型进行比较而得到的最好的一个。此外，您可以轻松地将该组件与AI平台预测服务结合起来，如果这样做，您将成为一个模型版本管理系统和为模型服务的端点，只需少量的努力。</li></ul><h2 id="5435" class="mb jr hh bd js mc md me jw mf mg mh ka jd mi mj ke jh mk ml ki jl mm mn km mo bi translated">管道的首次启动</h2><p id="b01c" class="pw-post-body-paragraph is it hh iu b iv ko ix iy iz kp jb jc jd kq jf jg jh kr jj jk jl ks jn jo jp ha bi translated">实际上，您不需要在笔记本环境中运行TFX管道。但是，如果是项目的初始阶段，建议这样做，因为您必须与TFX、云服务、云环境进行大量的交互实验。</p><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mt"><img src="../Images/67754659be10a41e583ae4913c49686e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qTbqYGdJY1l844JwvZENug.png"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx">Fig7. GKE Job Allocation</figcaption></figure><p id="83c5" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">图7显示了运行TFX管道时会发生什么。作业规范扔给AI平台管道，然后AI平台管道把每个作业包装在一个容器里，传给GKE，然后GKE在一个当前可用的资源里执行每个作业。如您所见，每个作业都保证按顺序运行。</p><h2 id="7bb6" class="mb jr hh bd js mc md me jw mf mg mh ka jd mi mj ke jh mk ml ki jl mm mn km mo bi translated">人工智能平台训练/预测</h2><p id="ed3c" class="pw-post-body-paragraph is it hh iu b iv ko ix iy iz kp jb jc jd kq jf jg jh kr jj jk jl ks jn jo jp ha bi translated">GCP提供的服务不仅仅是人工智能平台笔记本/管道和GKE，还有一些专门用于数据预处理、模型训练、模型调整和模型预测的服务。您希望利用这些服务，因为它们具有可伸缩性和灵活的可配置性。此外，请注意，GKE不知道超过一个图形处理器协作的分布式训练。</p><p id="c299" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">试想一下以下几种情况。</p><ul class=""><li id="eb83" class="kt ku hh iu b iv iw iz ja jd kv jh kw jl kx jp ky kz la lb bi translated"><strong class="iu hi">您的数据越来越大:</strong>您不断地收集更多的数据，相应地，您需要更多的计算资源来进行数据预处理。对于这种特殊的工作，需要高端CPU和大容量ram是正常的。</li><li id="0ead" class="kt ku hh iu b iv lc iz ld jd le jh lf jl lg jp ky kz la lb bi translated"><strong class="iu hi">您的模型和数据越来越大:</strong>随着您收集的数据越来越多，您可以期望从当前模型中获得更多的信息。或者，由于SOTA车型最近发布得太频繁，您希望用更有前景的车型来取代现有车型。无论是哪种情况，在分布式有保障的环境中，你肯定需要更多的GPU甚至TPU。</li><li id="50bb" class="kt ku hh iu b iv lc iz ld jd le jh lf jl lg jp ky kz la lb bi translated"><strong class="iu hi">终端用户的数量越来越多:</strong>如果您有100个用户，那么只需一台服务器就足够了。最终用户的数量会增长到10万左右。如果是这样，一台服务器是不够的，但是您应该为您的模型配置更多的服务器，以适应不断增长的用户数量。</li></ul><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mu"><img src="../Images/970a907fc9692bc126e6b621d64ec0e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MgX7UPVbvLI_MpLo-GiLew.png"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx">Fig8. Dedicated GCP Services for Data Preprocessing, Model Training/Tuning, and Prediction</figcaption></figure><p id="96b6" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">所列情况可以反方向走，所以关键是可扩展性，可扩展性来自于强大的基础设施。然而，基础设施很难配置和管理，因为你应该对硬件、系统程序、操作系统、Kubernetes之类的软件基础设施、一般的机器学习等有扎实的了解。应该有一整个团队来做这件事。但是，如果你利用GCP提供的服务，这件事会非常容易。</p><p id="c9ba" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">列出的每种情况都可以映射到一个专用的GCP服务，您只需要对TFX配置做一点小小的更改。</p><ul class=""><li id="443d" class="kt ku hh iu b iv iw iz ja jd kv jh kw jl kx jp ky kz la lb bi translated">你的数据变大:<strong class="iu hi">数据流</strong></li><li id="f1f9" class="kt ku hh iu b iv lc iz ld jd le jh lf jl lg jp ky kz la lb bi translated">你的模型和数据变大:<strong class="iu hi"> AI平台训练/调优</strong></li><li id="4a86" class="kt ku hh iu b iv lc iz ld jd le jh lf jl lg jp ky kz la lb bi translated">终端用户数量变大:<strong class="iu hi"> AI平台预测</strong></li></ul><h2 id="fad2" class="mb jr hh bd js mc md me jw mf mg mh ka jd mi mj ke jh mk ml ki jl mm mn km mo bi translated">数据源</h2><p id="6791" class="pw-post-body-paragraph is it hh iu b iv ko ix iy iz kp jb jc jd kq jf jg jh kr jj jk jl ks jn jo jp ha bi translated">机器学习的数据可以以多种方式存储，但最常见的情况可能是使用文件系统(以多种不同的格式，如CSV、Parquet、TFRecord等)或DBMS(数据库管理系统)。在GCP，您可以将云存储服务用于正式情况，将BigQuery用于后一种情况。</p><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mv"><img src="../Images/6ad5c2d7ba73f35974167aeafb6bf01e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SvEvWN0Sg2ew_hFYMIQZsQ.png"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx">Fig9. Data Storage Options</figcaption></figure><p id="1530" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">当然，他们两人都可以很容易地与TFX勾搭上。您只需要导入适当的包(对于文件系统是ExampleGen，对于BigQuery是BigQueryExampleGen)。还要注意，使用云存储服务，您可以免费获得数据版本控制。</p><h2 id="1b29" class="mb jr hh bd js mc md me jw mf mg mh ka jd mi mj ke jh mk ml ki jl mm mn km mo bi translated">云功能和云构建</h2><p id="ddf6" class="pw-post-body-paragraph is it hh iu b iv ko ix iy iz kp jb jc jd kq jf jg jh kr jj jk jl ks jn jo jp ha bi translated">现在，在这一点上，整个机器学习管道建立起来了。然而，有两个缺失的部分。我们不希望每次都通过打开笔记本来运行整个管道。相反，我们可能需要自动的方式来运行管道。</p><p id="468b" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">那么，在什么情况下我们希望自动运行管道呢？</p><ul class=""><li id="d563" class="kt ku hh iu b iv iw iz ja jd kv jh kw jl kx jp ky kz la lb bi translated">当我们收集了更多的数据后</li><li id="3ed2" class="kt ku hh iu b iv lc iz ld jd le jh lf jl lg jp ky kz la lb bi translated">当我们编写更好的数据预处理策略或最近公布的SOTA模型时。</li></ul><p id="3360" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">在前一种情况下，应该有某种东西能够监听数据版本的变化，并基于监听触发动作。在后一种情况下，您应该能够通过调用端点来运行管道。这和笔记本的处理过程是一样的，但是我们现在需要一种自动的方式。</p><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mw"><img src="../Images/99db7117be828a61b84959fad0017698.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B2HIpTrcWjECJZ9G229leQ.png"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx">Fig10. Cloud Function Listening to the Changes of Data Source and Launching the Pipeline</figcaption></figure><p id="010c" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">图10中的云功能是一种无服务器服务。这意味着它会在某个事件中醒来，并运行指定的代码。在GCP环境中，触发云功能的事件之一是云存储或BigQuery的变化。因此，通过简单地监听该事件，我们可以确定何时应该运行整个管道。</p><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="lm ln di lo bf lp"><div class="er es mx"><img src="../Images/c9d014ecf07d31b7213c18fca7af7c26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xa-whOwtoBE2yNGadw7NJA.png"/></div></div><figcaption class="lq lr et er es ls lt bd b be z dx">Fig11. Cloud Build Building Source Code and Launch the Pipeline</figcaption></figure><p id="fae6" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">图11中的云构建是当代码库中有变化时的源代码构建服务。您可以运行许多单元测试，当一切顺利时，可以部署和运行新的机器学习管道代码。当我们修改现有代码以支持不同的数据预处理策略、不同的模型，甚至不同的部署选项(如TFJS或TensorFlow Lite)时，这是一个非常有用的特性。</p></div><div class="ab cl il im go in" role="separator"><span class="io bw bk ip iq ir"/><span class="io bw bk ip iq ir"/><span class="io bw bk ip iq"/></div><div class="ha hb hc hd he"><h1 id="d2b7" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">摘要</h1><p id="d3e8" class="pw-post-body-paragraph is it hh iu b iv ko ix iy iz kp jb jc jd kq jf jg jh kr jj jk jl ks jn jo jp ha bi translated">我们已经看到哪些GCP服务可以构成整个端到端的机器学习管道系统。</p><p id="4330" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">软硬件基础设施由<strong class="iu hi"> GKE </strong>和<strong class="iu hi"> AI平台管道</strong>管理，传递给AI平台管道的作业规范可以用高层<strong class="iu hi"> TFX </strong>框架编写。此外，可扩展数据预处理、分布式模型训练和可扩展模型服务可以由专用GCP服务来处理，这些服务是<strong class="iu hi">数据流</strong>、<strong class="iu hi"> AI平台训练</strong>和<strong class="iu hi"> AI平台预测</strong>。有许多存储选项，但我推荐使用<strong class="iu hi">云存储</strong>或<strong class="iu hi"> BigQuery </strong>。当这些存储选项与<strong class="iu hi">云功能</strong>相结合时，可以检测到数据的变化，并且可以触发管道用新收集的数据重新训练模型。最后，<strong class="iu hi"> Cloud Build </strong>让你编写/修改新代码，并基于新集成的代码库触发管道。</p><p id="0e43" class="pw-post-body-paragraph is it hh iu b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp ha bi translated">然而，如果您仍然认为您必须自己构建一切，您可以将每个GCP服务映射到其他等价服务或开源项目。</p></div><div class="ab cl il im go in" role="separator"><span class="io bw bk ip iq ir"/><span class="io bw bk ip iq ir"/><span class="io bw bk ip iq"/></div><div class="ha hb hc hd he"><h1 id="3fa4" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">我是谁？</h1><p id="8253" class="pw-post-body-paragraph is it hh iu b iv ko ix iy iz kp jb jc jd kq jf jg jh kr jj jk jl ks jn jo jp ha bi translated">我的名字叫朴成星，我是机器学习谷歌开发专家(ML GDE)之一。虽然我对机器学习的一切都感兴趣，但我今年(2021年)的重点是GCP环境中的MLOps。</p></div></div>    
</body>
</html>