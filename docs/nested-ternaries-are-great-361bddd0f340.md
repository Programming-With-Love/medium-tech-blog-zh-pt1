# 嵌套三角形很棒

> 原文：<https://medium.com/javascript-scene/nested-ternaries-are-great-361bddd0f340?source=collection_archive---------0----------------------->

![](img/b5319c93f5a4237f1472d1686f5b1e6f.png)

Smoke Art Cubes to Smoke — MattysFlicks — (CC BY 2.0)

> 注意:这是关于从头开始学习 JavaScript ES6+中的函数式编程和组合软件技术的“组合软件”系列的一部分。敬请关注。还会有更多这样的事情发生！
> [<上一部](/javascript-scene/the-hidden-treasures-of-object-composition-60cd89480381) | [< <在第一部](/javascript-scene/composing-software-an-introduction-27b72500d6ea) | [下一部>](/javascript-scene/abstraction-composition-cb2849d5bdd6) 重新开始

传统智慧会让你相信嵌套 ternaries 是不可读的，应该避免。

> 传统智慧有时是不明智的。

事实是，名词通常比 if 语句简单得多。人们相信相反的情况有两个原因:

1.  他们更熟悉 if 语句。熟悉偏见会让我们相信不真实的事情，即使我们有相反的证据。
2.  人们试图使用三元语句，就好像它们是 if 语句一样。那不行，因为三元表达式是*表达式，不是语句。*

在我们进入细节之前，让我们定义一个三元表达式:

三元表达式是计算结果为值的条件表达式。它由一个条件、一个 truthy 子句(如果条件的计算结果为 truthy 值，则生成的值)和一个 falsy 子句(如果条件的计算结果为 falsy 值，则生成的值)组成。

它们看起来像这样:

```
(conditional)
  ? truthyClause
  : falsyClause
```

# 表达式与语句

一些编程语言(包括 Smalltalk、Haskell 和大多数函数式编程语言)根本没有 if 语句。他们用`if` *表情*代替。

if 表达式是计算结果为值的条件表达式。它由一个条件、一个 truthy 子句(如果条件的计算结果为 truthy 值，则生成的值)和一个 falsy 子句(如果条件的计算结果为 falsy 值，则生成的值)组成。

这看起来眼熟吗？大多数函数式编程语言使用*三元表达式*作为它们的`if`关键字。为什么？

表达式是一段计算结果为单个值的代码。

语句是一段代码，可能根本不计算任何值。在 JavaScript 中，if 语句*不计算值*。为了让 JavaScript 中的 if 语句做任何有用的事情，它*必须*产生副作用或者从包含函数返回值。

在函数式编程中，我们倾向于*避免*突变和其他副作用。由于 JavaScript 中的`if`自然地*提供了*变异和副作用，许多函数式程序员转而使用 ternaries 嵌套的或不嵌套的。包括我。

从三元表达式的角度思考与从 if 语句的角度思考有些不同，但是如果你练习了几个星期，你会很自然地开始被三元表达式吸引，如果仅仅是因为输入更少的话，你很快就会看到。

# 熟悉性偏差

我听到的普遍说法是嵌套的三元表达式“难以阅读”。让我们用一些代码示例来打破这个神话:

```
const withIf = ({
  conditionA, conditionB
}) => {
  if (conditionA) {
    if (conditionB) {
      return valueA;
    }
    return valueB;
  }
  return valueC;
};
```

请注意，在这个版本中，有嵌套条件和大括号在视觉上将 truthy 子句与 falsy 子句分开，使它们感觉非常不连贯。这是相当简单的逻辑，但是解析起来有点费力。

下面是以三元表达式形式编写的相同逻辑:

```
const withTernary = ({
  conditionA, conditionB
}) => (
  (!conditionA)
    ? valueC
    : (conditionB)
    ? valueA
    : valueB
);
```

这里有几个有趣的观点:

# 菊花链与嵌套

首先，我们把巢弄平了。“嵌套”ternaries 有点用词不当，因为 ternaries 很容易写成一条直线，你根本不需要用缩进层次来嵌套它们。它们只是以一条直线从上到下读取，一旦遇到真值条件或回退就返回值。

如果你写的 ternaries 正确，没有嵌套需要解析。沿着直线走很难迷路。

我们或许应该称它们为“连锁的 ternaries”。

我想指出的第二件事是，为了简化这种直线链接，我稍微改变了一下顺序:如果您到达一个三元表达式的末尾，发现您需要编写两个冒号子句(`:`)，抓取最后一个子句，将其移动到顶部，并反转第一个条件的逻辑以简化三元表达式的解析。不再困惑！

值得注意的是，我们可以使用相同的技巧来简化 if 语句的形式:

```
const withIf = ({
  conditionA, conditionB
}) => {
  if (!conditionA) return valueC;
  if (conditionB) {
    return valueA;
  }
  return valueB;
};
```

这样更好，但还是在视觉上把`conditionB`的相关子句打散了，会造成混乱。我看到过这个问题导致代码维护过程中的逻辑错误。即使逻辑扁平化，这个版本仍然比三进制版本更杂乱。

# 语法混乱

`if`版本包含了更多的噪声:`if`关键字 vs `?`，`return`强制语句返回值，额外的分号，额外的括号，等等...与这个例子不同，大多数 if 语句也会改变一些外部状态，这进一步增加了额外的代码和复杂性。

额外的代码是不好的，有几个重要原因。这些我以前都说过，但是值得重复，直到每个开发人员都牢记在心:

## 内存储器

普通人的大脑在工作记忆中只有少量用于离散[量子的共享资源，每个变量都可能消耗其中一个量子。当你增加更多的变量时，你准确回忆每个变量含义的能力就会减弱。工作记忆模型通常包含 4-7 个离散量子。在这些数字之上，错误率急剧增加。](https://www.nature.com/articles/nn.3655)

当我们用 if 语句而不是 ternaries 来强制突变或副作用时，这通常需要在组合中添加不需要的变量。

## 信噪比

简洁的代码还可以提高代码的信噪比。这就像听收音机——当收音机没有调到合适的电台时，你会听到很多干扰噪音，更难听到音乐。当你调到正确的电台时，噪音就消失了，你会得到更强的音乐信号。

代码也是一样。更简洁的代码表达有助于理解。有些代码给了我们有用的信息，有些代码只是占用了空间。如果你能减少你使用的代码量而不减少要传递的意思，你将使代码更容易被其他需要阅读它的人解析和理解。

## 虫子的表面区域

看看之前和之后的函数。看起来这个功能好像节食减肥了。这很重要，因为额外的代码意味着有额外的表面区域让虫子藏在里面，这意味着会有更多的虫子藏在里面。

> *代码越少= bug 越少= bug 越少。*

# 副作用和共享可变状态

许多 if 语句不仅仅是计算一个值。它们还会产生副作用，或者使变量变异，所以如果不知道这些副作用的影响以及涉及其共享可变状态的所有其他事物的完整历史，就无法看到 if 语句的完整效果。

限制自己返回一个值会迫使你遵守纪律:切断依赖关系，使你的程序更容易理解、调试、重构和维护。

这实际上是我最喜欢的三元表达式的好处:

> *使用 ternaries 会让你成为更好的开发者。*

# 结论

由于所有的三元组都很容易从上到下排成一条直线，称它们为“嵌套三元组”有点用词不当。让我们称他们为“连锁 ternaries”，而不是。

与 if 语句相比，链式术语有几个优点:

*   把它们从上到下写成一条直线总是很容易的。如果你能沿着一条直线，你就能读出一个链式三元组。
*   词条减少了语法混乱。更少的代码=更少的 bug 表面积=更少的 bug。
*   Ternaries 不需要临时变量，减少了工作记忆的负荷。
*   Ternaries 有更好的信噪比。
*   如果声明鼓励副作用和突变。术语鼓励纯代码。
*   纯代码将我们的表达式和函数彼此解耦，所以术语训练我们成为更好的开发人员。

# 在 EricElliottJS.com 了解更多信息

EricElliottJS.com 的会员可以上函数式编程的视频课。如果您还不是会员，[今天就注册吧](https://ericelliottjs.com/)。

[![](img/ebd7dfc9ae8d8938e30bdbdbe428fd4c.png)](https://ericelliottjs.com/product/lifetime-access-pass/)

***埃里克艾略特*** *著有* [*【编程 JavaScript 应用】*](http://pjabook.com) *(奥赖利)，以及* [*【跟埃里克艾略特学 JavaScript】*](http://ericelliottjs.com/product/lifetime-access-pass/)*。他曾为****Adobe Systems*******尊巴健身*******华尔街日报*******ESPN*******BBC****等顶级录音师贡献过软件经验*****

**他在远离任何地方的地方和世界上最美丽的女人一起工作。**