<html>
<head>
<title>Styling internationalized text in Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android中国际化文本的样式</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/styling-internationalized-text-in-android-f99759fb7b8f?source=collection_archive---------1-----------------------#2018-06-12">https://medium.com/androiddevelopers/styling-internationalized-text-in-android-f99759fb7b8f?source=collection_archive---------1-----------------------#2018-06-12</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/495466d4892549cbe855f6801f35b155.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wznzKB5fC41ELteyRXcCPg.png"/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx">Illustration by <a class="ae hu" href="https://twitter.com/VPoltrack" rel="noopener ugc nofollow" target="_blank">Virginia Poltrack</a></figcaption></figure><div class=""/><p id="b2a8" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在之前的一篇文章中，我们谈到了在Android中使用spans来设计字符或段落的样式。但是所有使用的例子都是基于硬编码的文本，我们确切地知道在哪个索引上应用span。大多数时候，我们处理的文本来自资源，并且是国际化的。因此<strong class="iw hy">我们需要设计的文本及其在句子中的位置可能会改变</strong>。</p><p id="45fe" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">例如，假设我们有英文和西班牙文的字符串"<em class="js">Best practices for text on Android</em>"，我们想要对单词"<em class="js"> text </em>"进行样式化。</p><p id="16f1" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">values/strings.xml</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="0799" class="kc kd hx jy b fi ke kf l kg kh">&lt;resources&gt;<br/>&lt;string name=”title”&gt;Best practices for <strong class="jy hy">text</strong> on Android&lt;/string&gt;<br/>&lt;/resources&gt;</span></pre><p id="23ae" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">values-es/strings.xml</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="df1e" class="kc kd hx jy b fi ke kf l kg kh">&lt;resources&gt;<br/>&lt;string name=”title”&gt;<strong class="jy hy">Texto</strong> en Android: mejores prácticas&lt;/string&gt;<br/>&lt;/resources&gt;</span></pre><p id="0afc" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们最终不得不设计不同单词的样式，“T31]text和“<em class="js"> Texto </em>”，这些单词在它们所属的字符串中有不同的位置，因此寻找特定单词的出现不是一项可行的任务。根据我们想要应用哪种样式，我们有多种方式来样式化国际化文本:通过使用HTML标签或者将注释span与注释标签一起使用。</p><h1 id="b6f1" class="ki kd hx bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">使用HTML标签的基本文本样式</h1><p id="62ed" class="pw-post-body-paragraph iu iv hx iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr ha bi translated">如果你只想应用基本的样式，在字符串资源或<code class="du lk ll lm jy b"><a class="ae hu" href="https://developer.android.com/reference/android/text/Html#fromHtml(java.lang.String,%20int)" rel="noopener ugc nofollow" target="_blank">Html.fromHtml</a></code>中使用HTML标签。支持以下样式:</p><ul class=""><li id="70a4" class="ln lo hx iw b ix iy jb jc jf lp jj lq jn lr jr ls lt lu lv bi translated">加粗:<code class="du lk ll lm jy b">&lt;b&gt;</code>，<code class="du lk ll lm jy b">&lt;em&gt;</code></li><li id="5078" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr ls lt lu lv bi translated">斜体:<code class="du lk ll lm jy b">&lt;i&gt;</code>、<code class="du lk ll lm jy b">&lt;cite&gt;</code>、<code class="du lk ll lm jy b">&lt;dfn&gt;</code></li><li id="1ea2" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr ls lt lu lv bi translated">文本大小增加25%<code class="du lk ll lm jy b">&lt;big&gt;</code></li><li id="6655" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr ls lt lu lv bi translated">文本尺寸减少20%<code class="du lk ll lm jy b">&lt;small&gt;</code></li><li id="28ab" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr ls lt lu lv bi translated">设置字体属性:<code class="du lk ll lm jy b">&lt;font face=”font_family“ color=”hex_color”&gt;</code>。可能的字体系列包括<code class="du lk ll lm jy b">monospace</code>、<code class="du lk ll lm jy b">serif</code>和<code class="du lk ll lm jy b">sans_serif</code>。</li><li id="f25d" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr ls lt lu lv bi translated">设置等宽字体系列:<code class="du lk ll lm jy b">&lt;tt&gt;</code></li><li id="8b61" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr ls lt lu lv bi translated">删除线:<code class="du lk ll lm jy b">&lt;s&gt;</code>、<code class="du lk ll lm jy b">&lt;strike&gt;</code>、<code class="du lk ll lm jy b">&lt;del&gt;</code></li><li id="ad12" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr ls lt lu lv bi translated">下划线:<code class="du lk ll lm jy b">&lt;u&gt;</code></li><li id="f9d7" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr ls lt lu lv bi translated">上标:<code class="du lk ll lm jy b">&lt;sup&gt;</code></li><li id="531f" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr ls lt lu lv bi translated">下标:<code class="du lk ll lm jy b">&lt;sub&gt;</code></li><li id="4843" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr ls lt lu lv bi translated">要点:<code class="du lk ll lm jy b">&lt;ul&gt;</code>，<code class="du lk ll lm jy b">&lt;li&gt;</code></li><li id="d4ed" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr ls lt lu lv bi translated">换行:<code class="du lk ll lm jy b">&lt;br&gt;</code></li><li id="2625" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr ls lt lu lv bi translated">分部:<code class="du lk ll lm jy b">&lt;div&gt;</code></li><li id="4a6b" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr ls lt lu lv bi translated">CSS样式:<code class="du lk ll lm jy b">&lt;span style=”color|background_color|text-decoration”&gt;</code></li><li id="8db9" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr ls lt lu lv bi translated">段落:<code class="du lk ll lm jy b">&lt;p dir=”rtl | ltr” style=”…”&gt;</code></li></ul><p id="8cd8" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">例如，要将单词"<em class="js"> text </em>"加粗，strings.xml中的文本应该是这样的:</p><p id="7394" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">// values/strings.xml</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="336e" class="kc kd hx jy b fi ke kf l kg kh">&lt;string name=”title”&gt;Best practices for <strong class="jy hy">&lt;b&gt;text&lt;/b&gt;</strong> on Android&lt;/string&gt;</span></pre><p id="ceca" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">// values-es/strings.xml</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="c075" class="kc kd hx jy b fi ke kf l kg kh">&lt;string name=”title”&gt;<strong class="jy hy">&lt;b&gt;Texto&lt;/b&gt;</strong> en Android: mejores prácticas&lt;/string&gt;</span></pre><p id="cb71" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在用户界面中，可以这样设置文本:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="6432" class="kc kd hx jy b fi ke kf l kg kh">textView.setText(R.string.title)</span></pre><h1 id="26f7" class="ki kd hx bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">带注释的复杂文本样式</h1><p id="1e4c" class="pw-post-body-paragraph iu iv hx iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr ha bi translated">如果您的样式需求超出了HTML标签所支持的能力，或者如果您想要使用自定义样式，比如自定义项目符号样式或者甚至全新的样式，那么我们需要另一种解决方案。标记要设置样式的单词，并使用strings.xml资源文件中的<code class="du lk ll lm jy b"><a class="ae hu" href="https://developer.android.com/reference/java/text/Annotation" rel="noopener ugc nofollow" target="_blank">android.text.Annotation</a></code>类和相应的<code class="du lk ll lm jy b">&lt;annotation&gt;</code>标记。</p><p id="b34c" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">注释标签允许我们在xml中定义定制的<code class="du lk ll lm jy b">&lt;key, value&gt;</code>对。当获取字符串资源为<code class="du lk ll lm jy b">SpannedString</code>时，这些对被Android框架自动转换为<code class="du lk ll lm jy b">Annotation</code>跨度，并带有相应的键和值。然后，我们可以解析附加到文本的注释列表，并为我们的文本添加正确的跨度。</p><p id="d824" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">确保在每个strings.xml文件中将<code class="du lk ll lm jy b">&lt;annotation&gt;</code>标记添加到字符串的所有翻译中。</p><figure class="jt ju jv jw fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mb"><img src="../Images/4692b1325627fbb50c2a878a66d59858.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*orHoyjEp_FHNxx7R."/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx">Apply a custom typeface to the word “text”, in all languages</figcaption></figure><p id="e579" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">假设我们想要设置一个自定义字体，通过对单词“text”应用一个<code class="du lk ll lm jy b">CustomTypefaceSpan</code>。我们需要做的是:</p><ol class=""><li id="9780" class="ln lo hx iw b ix iy jb jc jf lp jj lq jn lr jr mc lt lu lv bi translated">添加<code class="du lk ll lm jy b">&lt;annotation&gt;</code>标签并定义<code class="du lk ll lm jy b">&lt;key, value&gt;</code>对。在我们的例子中，键是<code class="du lk ll lm jy b"><em class="js">font</em></code>，值是我们要使用的字体类型:<code class="du lk ll lm jy b"><em class="js">title_emphasis</em></code>。</li></ol><p id="7b07" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">// values/strings.xml</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="f0c3" class="kc kd hx jy b fi ke kf l kg kh">&lt;string name=”title”&gt;Best practices for <br/><strong class="jy hy">&lt;annotation font=”title_emphasis”&gt;text&lt;/annotation&gt;</strong> on Android&lt;/string&gt;</span></pre><p id="f023" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">// values-es/strings.xml</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="fed3" class="kc kd hx jy b fi ke kf l kg kh">&lt;string name=”title”&gt;<br/><strong class="jy hy">&lt;annotation font=”title_emphasis”&gt;Texto&lt;/annotation&gt;</strong> en Android: mejores prácticas&lt;/string&gt;</span></pre><p id="a655" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">2.从资源中获取字符串，遍历注释并获取带有键<code class="du lk ll lm jy b"><em class="js">font</em></code>和相应值的注释。然后创建自定义范围，并将其设置为与注释范围位置相同的文本。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="1451" class="kc kd hx jy b fi ke kf l kg kh">// get the text as SpannedString so we can get the spans attached to the text<br/>val titleText = getText(R.string.<em class="js">title</em>) as SpannedString</span><span id="6f4f" class="kc kd hx jy b fi md kf l kg kh">// get all the annotation spans from the text<br/>val annotations = titleText.getSpans(0, titleText.<em class="js">length</em>, Annotation::class.<em class="js">java</em>)</span><span id="4d3e" class="kc kd hx jy b fi md kf l kg kh">// create a copy of the title text as a SpannableString <br/>// so we can add and remove spans<br/>val spannableString = SpannableString(titleText)</span><span id="255d" class="kc kd hx jy b fi md kf l kg kh">// iterate through all the annotation spans<br/>for (annotation in annotations) {   </span><span id="5740" class="kc kd hx jy b fi md kf l kg kh">    // look for the span with the key "font"<br/>    if (annotation.<em class="js">key </em>== "font") {<br/>        val fontName = annotation.<em class="js">value </em></span><span id="1ec8" class="kc kd hx jy b fi md kf l kg kh"><em class="js">        </em>// check the value associated with the annotation key<br/>        if (fontName == "title_emphasis") { </span><span id="1a13" class="kc kd hx jy b fi md kf l kg kh">            // create the typeface<br/>            val typeface = getFontCompat(R.font.permanent_marker) </span><span id="9052" class="kc kd hx jy b fi md kf l kg kh">            // set the span to the same indices as the annotation<br/>            spannableString.setSpan(CustomTypefaceSpan(typeface),<br/>                    titleText.getSpanStart(annotation),<br/>                    titleText.getSpanEnd(annotation),<br/>                    Spannable.<em class="js">SPAN_EXCLUSIVE_EXCLUSIVE</em>)<br/>        }<br/>    }<br/>}</span><span id="b399" class="kc kd hx jy b fi md kf l kg kh">// now the spannableString contains both the annotation spans and the CustomTypefaceSpan<br/>styledText.<em class="js">text </em>= spannableString</span></pre><p id="5f39" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">你可以在这里找到这个例子<a class="ae hu" href="https://gist.github.com/florina-muntenescu/08d751d843d55b75061039fee4e97931" rel="noopener ugc nofollow" target="_blank">的完整代码。</a></p><p id="8d47" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">举一个更复杂的例子，在Java中，使用注释向文本添加图像并设置前景色，查看来自<a class="ae hu" href="https://github.com/nickbutcher/plaid/" rel="noopener ugc nofollow" target="_blank"> Plaid </a>的<a class="ae hu" href="https://github.com/nickbutcher/plaid/commit/951c361b0df28719b4a5bf83deade618135bb683" rel="noopener ugc nofollow" target="_blank"> this commit </a>。</p><p id="5f92" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果您多次使用相同的文本，例如在一个<code class="du lk ll lm jy b">RecyclerView</code>中，并且您为每个项目重建了<code class="du lk ll lm jy b">SpannableString</code>，那么您需要记住一些性能和内存方面的问题:</p><ul class=""><li id="093f" class="ln lo hx iw b ix iy jb jc jf lp jj lq jn lr jr ls lt lu lv bi translated">该字符串被迭代多次:一次由框架添加<code class="du lk ll lm jy b">Annotation</code>跨度，一次由您手动添加跨度</li><li id="449f" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr ls lt lu lv bi translated">为每个项目创建一个新的<code class="du lk ll lm jy b">SpannableString</code>实例。</li></ul><p id="e2a0" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了解决这个问题，只构建一次文本，缓存然后重用<code class="du lk ll lm jy b">SpannableString</code>。</p><h1 id="93e7" class="ki kd hx bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">附加部分:<code class="du lk ll lm jy b">Annotation</code>跨度和文本打包</h1><p id="b479" class="pw-post-body-paragraph iu iv hx iw b ix lf iz ja jb lg jd je jf lh jh ji jj li jl jm jn lj jp jq jr ha bi translated">在上一篇文章中，我们提到当样式化的文本在同一个进程中(例如，通过<code class="du lk ll lm jy b">Intent</code>bundle)或者在进程间(通过复制文本)传递时，只有框架跨度被打包。</p><div class="hg hh ez fb hi me"><a rel="noopener follow" target="_blank" href="/google-developers/underspanding-spans-1b91008b97e4"><div class="mf ab dw"><div class="mg ab mh cl cj mi"><h2 class="bd hy fi z dy mj ea eb mk ed ef hw bi translated">下跨跨度</h2><div class="ml l"><h3 class="bd b fi z dy mj ea eb mk ed ef dx translated">跨度是强大的概念，通过提供对组件的访问，允许在字符或段落级别对文本进行样式化…</h3></div><div class="mm l"><p class="bd b fp z dy mj ea eb mk ed ef dx translated">medium.com</p></div></div><div class="mn l"><div class="mo l mp mq mr mn ms ho me"/></div></div></a></div><p id="0e30" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因为<code class="du lk ll lm jy b">Annotation</code>span也是<code class="du lk ll lm jy b">ParcelableSpan</code>span，所以<code class="du lk ll lm jy b">&lt;key, value&gt;</code>对是打包的和未打包的，这使得<code class="du lk ll lm jy b">Annotation</code> span成为一种将定制样式应用于打包的文本的方式，只要接收端知道如何解释注释。</p><p id="1869" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因此，为了在将文本传递给Intent Bundle时保持您的定制样式，您首先需要将<code class="du lk ll lm jy b">Annotation</code> spans添加到您的文本中。您可以通过如上所示的<code class="du lk ll lm jy b">&lt;annotation&gt;</code>标记在XML资源中实现这一点，或者通过创建一个新的<code class="du lk ll lm jy b">Annotation</code>并将其设置为span:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="631f" class="kc kd hx jy b fi ke kf l kg kh">val spannableString = SpannableString(“My spantastic text”)<br/>val annotation = Annotation(“font”, “title_emphasis”)<br/>spannableString.setSpan(annotation, 3, 7, Spannable.SPAN_EXCLUSIVE_EXCLUSIVE)</span><span id="1e2c" class="kc kd hx jy b fi md kf l kg kh">// start Activity with text with spans<br/>val intent = Intent(this, MainActivity::class.java)<br/>intent.putExtra(TEXT_EXTRA, spannableString)<br/>startActivity(intent)</span></pre><p id="99db" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">从包中检索文本作为SpannableString，然后解析附加的注释，如上例所示。</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="94a1" class="kc kd hx jy b fi ke kf l kg kh">// read text with Spans</span><span id="9dc3" class="kc kd hx jy b fi md kf l kg kh">val intentCharSequence = intent.getCharSequenceExtra(TEXT_EXTRA) as SpannableString</span></pre></div><div class="ab cl mt mu go mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ha hb hc hd he"><p id="643e" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">对于国际化文本的简单样式，更新您的字符串资源以使用HTML标记。但是当您的样式需求超出了所支持的HTML标签的限制时，请使用<code class="du lk ll lm jy b">Annotation</code> span和相关的注释标签。作为一个额外的好处，<code class="du lk ll lm jy b">Annotation</code>跨度是可打包的，因此您可以轻松地设置文本样式，无论您如何处理它。</p><p id="7269" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">有关文本的更多最佳实践，请查看Google I/O 2018 talk:</p><figure class="jt ju jv jw fd hj"><div class="bz dy l di"><div class="na nb l"/></div></figure></div></div>    
</body>
</html>