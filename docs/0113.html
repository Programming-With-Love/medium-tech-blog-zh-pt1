<html>
<head>
<title>How Airbnb is Moving 10x Faster at Scale with GraphQL and Apollo</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Airbnb如何通过GraphQL和Apollo以10倍的速度发展</h1>
<blockquote>原文：<a href="https://medium.com/airbnb-engineering/how-airbnb-is-moving-10x-faster-at-scale-with-graphql-and-apollo-aa4ec92d69e2?source=collection_archive---------0-----------------------#2018-12-05">https://medium.com/airbnb-engineering/how-airbnb-is-moving-10x-faster-at-scale-with-graphql-and-apollo-aa4ec92d69e2?source=collection_archive---------0-----------------------#2018-12-05</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="d111" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">揭秘我的GraphQL峰会演讲</h2></div><p id="06fd" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">上个月，我有机会在GraphQL峰会上发表了一篇涉及大量实时编码的演讲(如果您赶时间，主题介绍将在6:00分钟后结束！).看看这个:</p><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="jx jy l"/></div></figure><p id="2875" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">从我在随后几天的会议中收集到的反馈来看，好消息是人们显然很高兴看到产品被如此快速地制造出来。人们带着对未来的憧憬离开了(任务完成！).坏消息是，我没有时间解释这一切是如何工作的，许多人以为Airbnb已经投入了多年的工程师时间来构建无懈可击的基础设施来支持GraphQL。</p><p id="9fcb" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">事实与真相相去甚远！事实上，演示中90%的繁重工作都是由Apollo的CLI工具管理的。</p><p id="8aa5" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">所以我承诺通过写一篇博客解释我们在做什么来补救这种情况:</p><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="jz jy l"/></div></figure><p id="d671" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">事实上，我希望在这里包括一些我们用来实现这种开发体验的代码，您将会看到，在开源的Apollo工具和您的一点努力之间，将所有这些连接起来实际上是一组可管理的任务。</p><p id="73bf" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">同样值得注意的是，我们还处于GraphQL之旅的早期。还有很多东西需要学习，例如，我们讨论的通过CI管理的一些东西仍在开发中。随着我们了解的越来越多，我会继续更新这篇文章，这样我们最好的知识就会被反映出来。</p></div><div class="ab cl ka kb go kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="ha hb hc hd he"><h2 id="f1e8" class="kh ki hh bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">后端驱动UI的GraphQL联合</h2><p id="62b6" class="pw-post-body-paragraph iw ix hh iy b iz lc ii jb jc ld il je jf le jh ji jj lf jl jm jn lg jp jq jr ha bi translated">演讲开始时产品的现有状态预先假定我们已经建立了一个系统，在这个系统中，一个非常动态的页面是基于一个查询构建的，这个查询将返回一组可能的“部分”这些部分是响应性的，并且完整地定义了UI。</p><p id="5681" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">管理它的中心文件是一个生成的文件(稍后，我们将讨论如何生成它),看起来像这样:</p><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="lh jy l"/></div></figure><p id="f59d" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">由于可能的部分列表相当大(今天大约有50个搜索部分)，它还假设我们有一个合理的机制来通过服务器渲染来延迟加载组件，这是另一篇文章的主题。可以说，我们不需要将所有可能的部分打包成一个巨大的包来预先考虑所有的事情。</p><p id="dba1" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">每个部分组件都定义了自己的查询片段，与部分的组件代码放在一起。看起来像这样:</p><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="lh jy l"/></div></figure><p id="2432" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这是Airbnb后端驱动UI的总体思路。它被用在很多地方，包括搜索、旅行计划、主机工具和各种登录页面。我们以此为起点，然后在演示中展示如何(1)制作和更新现有部分，以及(2)添加新部分。</p><h2 id="13bd" class="kh ki hh bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">使用Playground探索您的模式</h2><p id="8c70" class="pw-post-body-paragraph iw ix hh iy b iz lc ii jb jc ld il je jf le jh ji jj lf jl jm jn lg jp jq jr ha bi translated">在构建产品时，您希望能够探索您的模式，发现字段名并测试对实时开发数据的潜在查询。我们今天通过<a class="ae li" href="https://github.com/prisma/graphql-playground" rel="noopener ugc nofollow" target="_blank"> GraphQL操场</a>、我们在<a class="ae li" href="https://www.prisma.io/" rel="noopener ugc nofollow" target="_blank"> Prisma </a>的朋友们的工作实现了这个目标。这些工具是阿波罗服务器的标准配置。</p><p id="a6f0" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在我们的例子中，后端服务主要是用Java编写的，它们的模式由我们的Apollo Server缝合在一起，我们称之为Niobe。目前，由于Apollo Gateway和Schema Composition还没有上线，我们所有的后端服务都是按服务命名的。这就是为什么探索操场要从服务名称列表开始。树的下一层是服务方法。在这种情况下，<code class="du lj lk ll lm b">getJourney()</code>。正如我在演讲中提到的，模式合成，一个由阿波罗团队提出的新概念，应该能帮助我们建立一个更合理的模式模型。在接下来的几个月里会有更多。</p><h2 id="d0be" class="kh ki hh bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">用阿波罗插件在VS代码中查看您的模式</h2><p id="0c0e" class="pw-post-body-paragraph iw ix hh iy b iz lc ii jb jc ld il je jf le jh ji jj lf jl jm jn lg jp jq jr ha bi translated">我想在演讲中展示的乐趣之一是，在构建我们的产品时，有这么多有用的工具触手可及。这包括访问VS代码中的Git，以及运行经常需要的命令的集成终端和任务。</p><p id="efd4" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">当然，我们也为GraphQL和Apollo展示了一些有趣的东西！大多数人没有看到的部分是新的<a class="ae li" href="https://marketplace.visualstudio.com/items?itemName=apollographql.vscode-apollo" rel="noopener ugc nofollow" target="_blank">阿波罗GraphQL VS代码扩展</a>。没有必要我从他们的营销网站上复制所有有趣的功能(有很多！)，但我将详细说明一个特性:<strong class="iy hi">模式标签</strong>。</p><p id="03dd" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果您要对正在处理的模式进行lint查询，您总是会得到“哪个模式”的决定默认的可能是你的生产模式(“当前的”，按照惯例)，但是正如我们在演示中讨论的，如果你需要迭代和探索新的想法，你需要灵活地瞄准一个临时的模式。</p><p id="f52b" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">由于我们使用的是Apollo Engine，使用标签发布多个模式让我们有了这种灵活性，并且多个工程师可以在一个提议的模式上进行协作。一旦为服务提议的模式改变被上游合并，并且这些改变在当前的生产模式中自然地向下流动，我们就可以在VS代码中翻转回“当前”模式。很酷。</p><h2 id="8b86" class="kh ki hh bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">自动生成类型</h2><p id="5043" class="pw-post-body-paragraph iw ix hh iy b iz lc ii jb jc ld il je jf le jh ji jj lf jl jm jn lg jp jq jr ha bi translated">Codegen的目标是从强类型安全中获益，而不必手动创建TypeScript类型或React PropTypes。这很重要，因为我们的查询片段分布在使用它们的组件中。这就是为什么对查询片段进行一行更改会导致6–7个文件被更新；因为相同的片段出现在查询层次结构中的许多地方——与组件层次结构并行。</p><p id="d80d" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这部分只是Apollo CLI功能。我们正在开发一个特别奇特的文件监视器(名字叫做“<strong class="iy hi">索隆</strong>”，很明显)，但是现在根据需要运行<code class="du lj lk ll lm b">apollo client:codegen --target=typescript --watch --queries=frontend/luxury-guest/**/*.{ts,tsx}</code>一点也不麻烦。能够在rebases期间关闭codegen是很好的，我通常会将我的范围过滤到我正在工作的项目。</p><p id="de2d" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我最喜欢的部分是，因为我们将片段与组件放在一起，所以当我们在组件层次结构中向上移动时，更改单个文件会导致查询中的许多文件被更新。这意味着在靠近route组件的树的更高处，我们可以看到统一的查询以及它可以通过的所有各种类型的数据。</p><p id="6a46" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">一点魔法都没有。只有阿波罗CLI。</p><h2 id="33e4" class="kh ki hh bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">用故事书隔离你的用户界面变化</h2><p id="0531" class="pw-post-body-paragraph iw ix hh iy b iz lc ii jb jc ld il je jf le jh ji jj lf jl jm jn lg jp jq jr ha bi translated">我们用来编辑UI的工具是<a class="ae li" href="https://storybook.js.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="iy hi">故事书</strong> </a>。这是一个完美的地方，以确保您的工作符合断点像素的设计。你可以快速热模块重载和一些复选框来启用/禁用浏览器功能，如Flexbox。</p><p id="c381" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我对Storybook应用的唯一技巧是用我们从API中提取的模拟数据加载故事。如果您的模拟数据确实涵盖了您的UI的所有各种可能的状态，那么您就可以开始了。除此之外，如果您想要考虑其他状态，比如加载或错误状态，您可以手动添加它们。</p><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="lh jy l"/></div></figure><p id="6170" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这是故事书的症结所在。这个文件完全由Yeoman生成(将在下面讨论)，默认情况下，它提供了Alps Journey中的示例。<code class="du lj lk ll lm b">getSectionsFromJourney()</code>只过滤部分。</p><p id="03ba" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">您会注意到的另一个漏洞是，我添加了一对div来垂直地阻挡我的组件，因为Storybook在组件周围呈现空白。这对于带边框的按钮或用户界面来说很好，但是很难准确地说出组件的开始和结束位置，所以我把它们放在了那里。</p><p id="8baa" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">既然我们在讨论所有这些神奇的工具是如何很好地协同工作来帮助你提高工作效率的，我能不能说与<em class="ln"> Zeplin或Figma一起使用UI，与Storybook </em>一起工作是一件多么愉快的事情。以这种抽象的方式深入研究UI，可以一次一个断点地消除这个疯狂世界的所有混乱，在那个安静的领域中，每次都可以精确到像素。</p><h2 id="1bab" class="kh ki hh bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">自动检索模拟数据</h2><p id="d4ec" class="pw-post-body-paragraph iw ix hh iy b iz lc ii jb jc ld il je jf le jh ji jj lf jl jm jn lg jp jq jr ha bi translated">为了给Storybook和我们的单元测试提供真实的模拟数据，我们希望直接从我们的共享开发环境中提取模拟数据。与codegen一样，即使查询片段中的一个小变化也会触发模拟数据中的许多小变化。这里，类似地，困难的部分完全由Apollo CLI解决，您可以立即用自己的代码将它缝合在一起。</p><p id="20fb" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">第一步只是运行<code class="du lj lk ll lm b">apollo client:extract frontend/luxury-guest/apollo-manifest.json</code>，您将拥有一个清单文件，其中包含来自您的产品代码的所有查询。您可能注意到的一件事是，该命令是这个“豪华客人”项目的命名空间，因为我不想刷新所有可能的团队的所有可能的模拟数据。</p><p id="df10" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这个命令很可爱，因为我的查询都分布在许多TypeScript文件中，但是这个命令将在源代码上执行并组合所有的导入。我不必在babel/webpack输出上运行它。</p><p id="08f8" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们随后添加的作品短小而机械:</p><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="lh jy l"/></div></figure><p id="3d02" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们目前正与Apollo团队合作，将这一逻辑提取到Apollo CLI中。我可以想象一个世界，在那里你唯一需要指定的是你想要的例子的数组，把它们和一个查询放在一个文件夹中会自动按需编码模拟。想象一下这样指定您需要的模拟:</p><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="lh jy l"/></div></figure><p id="4db2" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你对如何使用它有一些想法，请不要犹豫联系我们！</p><h2 id="81e9" class="kh ki hh bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">使用Happo将屏幕截图测试添加到代码审查中</h2><p id="4d53" class="pw-post-body-paragraph iw ix hh iy b iz lc ii jb jc ld il je jf le jh ji jj lf jl jm jn lg jp jq jr ha bi translated"><a class="ae li" href="https://happo.io/" rel="noopener ugc nofollow" target="_blank"> <strong class="iy hi"> Happo </strong> </a>是直截了当的救命恩人。这是我用过的唯一一个截图测试工具，所以我还没有成熟到可以和其他工具进行比较，如果有的话，但是基本的想法是你推送代码，它会关闭并渲染你的PR中的所有组件，与master上的版本进行比较。</p><p id="0fab" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这意味着如果你编辑一个像<code class="du lj lk ll lm b">&lt;Input /&gt;</code>这样的组件，它会显示对使用输入的组件的影响，包括你不小心修改的<em class="ln">搜索栏</em>。它。是。太棒了。</p><p id="8749" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">有多少次你认为你的改变被包含了，却发现十个其他团队开始使用你构建的东西，而你的改变破坏了十个中的三个？没有Happo，你可能不知道。</p><p id="3e28" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">直到最近，Happo的唯一缺点是我们的故事书变体(截图测试过程的输入)并不总是充分反映可靠的数据。既然Storybook利用了API数据，我们可以更有信心了。另外，正如我们的演示所探索的，它是自动的。如果您向查询中添加一个字段，然后添加组件，Happo会自动将差异发布到您的PR中，让坐在您旁边的工程师、设计师和产品经理看到您所做更改的视觉效果。</p><h2 id="9661" class="kh ki hh bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">用约曼生成新文件</h2><p id="690b" class="pw-post-body-paragraph iw ix hh iy b iz lc ii jb jc ld il je jf le jh ji jj lf jl jm jn lg jp jq jr ha bi translated">如果您需要多次搭建一堆文件，您应该构建一个生成器。它会把你变成你的军队。听完演讲后，我震惊地发现，很多人以为我们有一支基础设施工程师队伍在为我在视频中展示的东西工作。除了AST转换(我将在下面介绍)，这只是三个模板文件和这个小东西:</p><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="lh jy l"/></div></figure><p id="580b" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">你可以想象在2-3分钟内为一个只持续一个下午的项目创建类似上面的东西。约曼发电机不需要等待基础设施团队或大规模的多季度项目。</p><h2 id="7127" class="kh ki hh bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">使用AST Explorer了解如何编辑现有文件</h2><p id="56c0" class="pw-post-body-paragraph iw ix hh iy b iz lc ii jb jc ld il je jf le jh ji jj lf jl jm jn lg jp jq jr ha bi translated">对于约曼生成器来说，棘手的部分是编辑<em class="ln">现有的</em>文件。但是有了抽象语法树(AST)转换，这个任务就简单多了。</p><p id="3c16" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下面是我们如何实现Sections.tsx的预期转换，我们将在本文的顶部讨论:</p><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="lh jy l"/></div></figure><p id="34cc" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><code class="du lj lk ll lm b">_updateFile</code>是使用Babel应用AST转换的样板文件。作品的关键是<code class="du lj lk ll lm b">_addToSectionMapping</code>，你看:</p><ol class=""><li id="3589" class="lo lp hh iy b iz ja jc jd jf lq jj lr jn ls jr lt lu lv lw bi translated">在程序级别，它插入一个新的导入声明。</li><li id="bef1" class="lo lp hh iy b iz lx jc ly jf lz jj ma jn mb jr lt lu lv lw bi translated">在两个对象表达式中，具有多个属性的一个是我们的部分映射，我们将在那里插入一个键/值对。</li><li id="91bf" class="lo lp hh iy b iz lx jc ly jf lz jj ma jn mb jr lt lu lv lw bi translated">带标签的模板文字是我们的gql片段，我们想在那里插入两行，第一行是成员表达式，第二行是一组“准”表达式中的一个。(嗯……)</li></ol><p id="b02a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果执行转换的代码看起来令人生畏，我只能说对我来说也是如此。在写这个转换之前，我没有遇到过准，公平地说，我发现它们有点令人困惑。</p><p id="46f0" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">好消息是，AST Explorer使得解决这类问题变得很容易。这是<a class="ae li" href="https://astexplorer.net/#/gist/e675b0068a8b74098c213b8065d7583c/dac289f77e481e68fdff052392aa789ee05d4e78" rel="noopener ugc nofollow" target="_blank">在探索者</a>中同样的转变。在这四个窗格中，左上角包含源文件，右上角包含已解析的树，左下角包含建议的转换，右下角包含转换后的结果。</p><p id="a3bd" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">查看经过解析的树会立即告诉您用Babel术语编写的代码的结构(您知道这是一个带标记的模板文字，对吗？)，这就为您提供了您所需要的东西来弄清楚如何应用转换并测试它们。</p><p id="f0b3" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">AST转换在Codemods中也起着至关重要的作用。请查看我的朋友<a class="ae li" rel="noopener" href="/@lencioni">乔·伦乔尼</a>关于此事的帖子。</p><h2 id="4b8c" class="kh ki hh bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">从Zeplin或Figma中提取模拟内容</h2><p id="42a5" class="pw-post-body-paragraph iw ix hh iy b iz lc ii jb jc ld il je jf le jh ji jj lf jl jm jn lg jp jq jr ha bi translated">Zeplin和Figma都允许工程师直接提取内容以促进产品开发。</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mc"><img src="../Images/2fe66e6efea6b9e394f3647b9d5d7807.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-_KzHG5cPzyJDr7JmfsSkw.png"/></div></div></figure><p id="26ff" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在上图的例子中，提取整个段落的副本就像在Zeplin中选择内容并点击侧边栏内容部分的“复制”图标一样简单。</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es mj"><img src="../Images/3692853a15fa1a45768e817bb3d22037.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ffeh09qkQ7I-BadWLFijbQ.png"/></div></div></figure><p id="b940" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在Zeplin的情况下，可以通过选择并点击侧边栏资产部分的“下载”图标来提取图像。</p><h2 id="8d15" class="kh ki hh bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">自动照片处理…通过建立媒体松鼠？</h2><p id="8364" class="pw-post-body-paragraph iw ix hh iy b iz lc ii jb jc ld il je jf le jh ji jj lf jl jm jn lg jp jq jr ha bi translated">照片处理管道肯定是Airbnb特有的东西。我想强调的部分实际上是<a class="ae li" href="https://twitter.com/briebunge?lang=en" rel="noopener ugc nofollow" target="_blank">布里干酪</a>在创建“媒体松鼠”来包装现有API端点方面的贡献。没有Media Squirrel，我们无法将机器上的原始图像转换为包含图像处理管道中的内容的JSON对象，更不用说使用静态URL作为图像源了。</p><p id="ff66" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">媒体松鼠的建议是，当你需要一些很多人都需要的常规工具时，不要犹豫，创建一个每个人都可以使用的有用工具。这是Airbnb滑稽文化的一部分，也是我非常珍视的一个习惯。</p><h2 id="09f9" class="kh ki hh bd kj kk kl km kn ko kp kq kr jf ks kt ku jj kv kw kx jn ky kz la lb bi translated">在Apollo服务器中截取模式和数据</h2><p id="0bac" class="pw-post-body-paragraph iw ix hh iy b iz lc ii jb jc ld il je jf le jh ji jj lf jl jm jn lg jp jq jr ha bi translated">就最终的API而言，这一部分仍在进行中。我们想要做的关键事情是(a)截取一个远程模式并修改它，以及(b)截取一个远程响应并修改它。原因是，虽然远程服务是事实的来源，但我们希望能够在上游服务中的模式变更等正式化之前迭代产品。</p><p id="e985" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这是演示中唯一的地方，我们得到了一点厚脸皮，并与API的自由。对于Apollo近期路线图中的模式组合和分布式执行，我们不想猜测每件事将如何精确地工作，所以我们只是提出了基本的概念。</p><p id="5544" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">实际上，模式组合应该让我们能够定义一个类型，并按照以下方式做一些事情:</p><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="lh jy l"/></div></figure><p id="5152" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">注意:在这种情况下，模式知道EditorialContent是一个联合，因此通过扩展它，我们实际上是要求它知道另一种可能的类型。</p><p id="445b" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">修改Berzerker响应的代码如下所示:</p><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="lh jy l"/></div></figure><p id="2953" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这个想法是对你在<a class="ae li" href="https://www.apollographql.com/docs/apollo-server/features/mocking.html#Using-MockList-in-resolvers" rel="noopener ugc nofollow" target="_blank"> Apollo服务器模拟API </a>中发现的东西的一种发挥。这里，模拟并没有填补API中的任何空白，而是实际上保留了所有空白，并根据您提供的内容主动覆盖内容。这更有可能是我们想要的那种嘲弄的API。</p><h1 id="cf89" class="mk ki hh bd kj ml mm mn kn mo mp mq kr in mr io ku iq ms ir kx it mt iu la mu bi translated">最后</h1><p id="d790" class="pw-post-body-paragraph iw ix hh iy b iz lc ii jb jc ld il je jf le jh ji jj lf jl jm jn lg jp jq jr ha bi translated">比这些技巧中的任何一个都更重要的是更广泛的一点，即异常快速地移动并尽可能多地自动化该过程，尤其是围绕样板文件、类型和文件创建。</p><p id="9aa1" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Apollo CLI负责所有特定于Apollo的领域，这使您能够以对您的用例有意义的方式连接这些实用程序。</p><p id="ad77" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">其中一些用例，比如类型的codegen，是通用的，并且最终成为你的整体基础设施的一部分。但是它们中的许多就像你用它们制造的部件一样是一次性的。没有一个是产品工程师在等待基础设施工程师为他们做些什么！</p><p id="b6ff" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">所以我希望这篇文章能解释你在视频中所看到的，我也希望你有机会在日常工作中应用这些技巧。</p></div><div class="ab cl ka kb go kc" role="separator"><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf kg"/><span class="kd bw bk ke kf"/></div><div class="ha hb hc hd he"><p id="dd76" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="ln">很自然，如果你喜欢阅读这本书，并想以同样的方式度过你的日子，我们一直在寻找有才华、有好奇心的人加入到</em> <a class="ae li" href="https://www.airbnb.com/careers/departments/engineering" rel="noopener ugc nofollow" target="_blank"> <em class="ln">团队</em> </a> <em class="ln">。或者，如果你只是想谈谈工作，可以随时在twitter上联系我们。</em></p></div></div>    
</body>
</html>