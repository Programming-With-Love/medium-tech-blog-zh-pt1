<html>
<head>
<title>Cache results for pagination to improve performance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">缓存分页结果以提高性能</h1>
<blockquote>原文：<a href="https://medium.com/globant/cache-results-for-pagination-to-improve-performance-2ad706d8f9c?source=collection_archive---------0-----------------------#2022-03-08">https://medium.com/globant/cache-results-for-pagination-to-improve-performance-2ad706d8f9c?source=collection_archive---------0-----------------------#2022-03-08</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="7a85" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在现代应用中，缓存是不可或缺的一部分。它可以提高应用程序的性能、可伸缩性和可用性。主要想法是减少延迟，使应用程序更快。当请求数量增加时，缓存对于容纳整个请求非常有用。</p><h1 id="09ec" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated"><strong class="ak">缓存</strong></h1><p id="96d6" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">缓存是一种提高应用程序性能的技术。缓存可以位于内存、数据库或服务器中，具体取决于实现。</p><p id="e838" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">缓存使数据访问更快，因为数据是在第一次请求时从数据库或数据存储中提取的。对于后续请求，将从缓存中提取数据，并且不访问数据库或数据存储。</p><p id="b568" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">应用程序首先在缓存中查找所需的数据，而不会直接命中数据库或实际的数据存储。如果在高速缓存中找不到数据，则它访问数据库或数据存储。</p><h1 id="2fd9" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">为什么要缓存分页？</h1><p id="7d21" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">我们知道分页是一种将多个记录的列表分割成子列表的技术。一次显示一小部分数据，以便用户可以更容易和方便地使用信息。在这方面，可以从数据存储中重复获取完整的列表，或者我们可以一次性获取并存储在缓存中，以避免数据访问的成本。</p><p id="88fc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本文中，我们将涉及如何在微服务中配置缓存和实现分页用例。</p><h1 id="d9f6" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated"><strong class="ak">春季开机缓存注解</strong></h1><p id="4b69" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">下面是为Spring boot应用程序添加缓存支持所需的注释。</p><h2 id="c34b" class="kf jd hh bd je kg kh ki ji kj kk kl jm ip km kn jq it ko kp ju ix kq kr jy ks bi translated"><strong class="ak">@ enable cache</strong></h2><p id="ae4f" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">这个注释用于通知Spring boot我们希望在这个应用程序中启用缓存。该注释应用于Spring boot主类或Spring配置类。Spring提供了一个并发hashmap作为默认缓存，但是我们也可以覆盖缓存管理器来注册外部缓存提供者。</p><h2 id="88d4" class="kf jd hh bd je kg kh ki ji kj kk kl jm ip km kn jq it ko kp ju ix kq kr jy ks bi translated"><strong class="ak">@可缓存</strong></h2><p id="2e36" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">这个注释用于通知Spring boot我们想要缓存哪些对象。该注释可以应用于方法或类。</p><p id="603a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当注释应用于一个方法时，Spring会缓存该方法的返回值。</p><p id="4214" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当在类上应用注释时，缓存行为被添加到类中的所有方法，并且来自所有方法的返回值被缓存。</p><h2 id="64bf" class="kf jd hh bd je kg kh ki ji kj kk kl jm ip km kn jq it ko kp ju ix kq kr jy ks bi translated"><strong class="ak"> @CachePut </strong></h2><p id="3bcb" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">这个注释用于通知Spring boot更新缓存的对象。缓存对象是数据库中原始对象的副本，应该始终与它们相同。当原始对象改变时，缓存的对象也应该改变。这是通过使用@CachePut注释来完成的。此方法确保从数据库或数据存储中提取数据，并在缓存中更新结果。</p><h2 id="de2f" class="kf jd hh bd je kg kh ki ji kj kk kl jm ip km kn jq it ko kp ju ix kq kr jy ks bi translated"><strong class="ak"> @CacheEvict </strong></h2><p id="67a5" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">此注释用于指示从缓存中移除数据的操作。该注释应用于在数据库中执行删除操作的方法。</p><h1 id="fe94" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated"><strong class="ak">使用Spring Boot的微服务缓存</strong></h1><p id="4caf" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">在这个例子中，我们将看到如何在spring boot项目中启用默认缓存，以及如何通过重复调用相同的方法来提高应用程序的性能。此外，我们将看到分页如何与缓存一起工作。</p><p id="2026" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">创建Spring boot项目:</strong></p><p id="90d3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用spring boot web依赖项创建一个简单的spring boot项目，用于托管在web服务器上。</p><p id="0664" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要做到这一点，请前往https://start.spring.io/的<a class="ae kt" href="https://start.spring.io/" rel="noopener ugc nofollow" target="_blank">并提供maven坐标和选择依赖关系。点击生成按钮。它将下载一个包含框架项目的zip文件。解压缩文件并导入IDE。执行maven全新安装以下载初始依赖项。</a></p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/34071c23dda0c52c46df5de08918d168.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6Al4qtJWQ_79HEXe"/></div></div></figure><p id="958f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">主类:</strong></p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lg"><img src="../Images/9b7941cf5dba587eb655a5431e803f6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dN7XOvkdmVsrmwwq3V_VdQ.png"/></div></div></figure><p id="e637" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">域类:</strong></p><figure class="kv kw kx ky fd kz er es paragraph-image"><div class="er es lh"><img src="../Images/0d6d3e056042f5b25e607d6a8873a5cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/0*CuyEEUoM4Q93ETqx"/></div></figure><p id="111a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">控制器类别:</strong></p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es li"><img src="../Images/757deba8f93b694a5ba42ae1fc2b1f4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QRYg3e_ljauW8Esz"/></div></div></figure><p id="5af2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">服务接口:- </strong></p><figure class="kv kw kx ky fd kz er es paragraph-image"><div class="er es lj"><img src="../Images/61625c19760ad002ada61b184376f0a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/0*25WAx8qug61YQkHW"/></div></figure><p id="c9a1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">服务实现类:</strong></p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lk"><img src="../Images/5db5861e96f2bc4fdb576babcc6e1b79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TJR1_xam4GVKFXQL"/></div></div></figure><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ll"><img src="../Images/fe28b5c74a7c3510fdc52dfca2b2962f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uYLJ1gpp5rZRKn2z"/></div></div></figure><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lm"><img src="../Images/956824a6b1240c7a747170e281502652.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ok4FV4O8GRopMPRA"/></div></div></figure><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ln"><img src="../Images/c264f2517474cedebc628ff023bb1dde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JfjIFkLN1slDTwsAkPkTtg.png"/></div></div></figure><p id="cf72" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">让我们测试几个场景，看看缓存是如何工作的。</strong></p><p id="51f0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">案例1:带有分页的多个搜索请求</strong></p><p id="6040" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们将在url中传递部门id，在标题中传递页码。我们在代码(DepartmentServiceImpl.java)中将页面大小定义为2</p><p id="541d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们点击<a class="ae kt" href="http://localhost:8080/student/1" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/department/1</a>。它应该打印:</p><p id="f40e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">控制器&gt;&gt;按id 1搜索</p><p id="eeb4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">###从数据存储中提取学生#####</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lo"><img src="../Images/c6659a36e48bdbed97be863fb32bdd7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QrjNxPM7c56iO36r"/></div></div></figure><figure class="kv kw kx ky fd kz er es paragraph-image"><div class="er es lp"><img src="../Images/c6c8e555afb026097267bfc33531e542.png" data-original-src="https://miro.medium.com/v2/resize:fit:1396/0*dNVn4z55eriiZqiS"/></div></figure><p id="27da" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当我们一次又一次点击网址时，它应该只打印出来</p><p id="b179" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">控制器&gt;&gt;按id 1搜索</p><p id="cc72" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这意味着服务方法仅在缓存提供结果后第一次被调用。我们可以在截图中看到，第一次用了108毫秒来提供响应，第二次以后只用了10毫秒。在本例中，我们从地图中访问数据，我们可以观察到请求执行时间减少了10倍。当我们拥有来自数据库或其他rest服务的大量数据时，性能会有很大提高。</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lq"><img src="../Images/cac12e625f84f2304721c2c6f28e37ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AOp4cqz7ZfTwvptL"/></div></div></figure><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lr"><img src="../Images/d60400b5b0f19d465c128c2c244d24a0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-x7DFbN3QuhL7f7K"/></div></div></figure><p id="2932" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，如果我们更改页码，将从缓存中获取数据，我们可以看到显示数据只需要10ms。</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ls"><img src="../Images/61a348e6c9c71d2ca279835636f53c33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vw1DtgMqVjorJbuA4UZEyw.png"/></div></div></figure><p id="196b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，如果我们更改id，那么该方法将被第一次调用。</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lt"><img src="../Images/c28682130aabd9e75fb2e078dfdaeccf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AaQXm6sOaCBvmEsH"/></div></div></figure><p id="2995" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">案例2:更新数据并搜索</strong></p><p id="10c4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当我们更新数据时，缓存中的数据也应该更新。@CachePut确保从数据存储或数据库中获取数据，并将更新后的结果放入缓存中。因此，当请求获取数据时，缓存会提供更新的结果。</p><p id="899c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意:-记录将被添加到地图的最后，所以我们需要更新请求中的页面编号以查看结果。</p><p id="144c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了测试这一点，让我们点击<a class="ae kt" href="http://localhost:8080/updateDepartment/1" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/update department/1</a></p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lu"><img src="../Images/6fac8ff763b22683654064253f98c238.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aORmb3VJptt94ON6"/></div></div></figure><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lv"><img src="../Images/8b08cf0e111f9225e481ae61c4f84e78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5BPr_zzZ3ZVATJJp"/></div></div></figure><p id="c885" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，让我们再次点击获取请求。</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lw"><img src="../Images/8e66be3d1da0fe214c9e5947a2326848.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*S0wH_U6S7wJwwm0W"/></div></div></figure><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lx"><img src="../Images/35f433043fb8db4ec92290b50ccd4cdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UurZh_isNpgUfDp4"/></div></div></figure><p id="22ab" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">情况3 :-删除数据并搜索</strong></p><p id="5a94" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当我们删除数据时，它也应该从缓存中删除。@CacheEvict从缓存中移除数据，当有获取数据的请求时，则没有结果。</p><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ly"><img src="../Images/797e9ddb5e8eae331e0f70a9ae2d6566.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nkzOetiqQ9yA1tLH"/></div></div></figure><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es lz"><img src="../Images/30e50a1841fcfab348391d4006aea595.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qpQOsL_EzhVMtQC3"/></div></div></figure><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ma"><img src="../Images/c21f5183a888f5f18a199b6c67d393bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RzQz8U6R5Hw1PrhA"/></div></div></figure><p id="2e00" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是实现分页缓存的最佳方式之一，在类似的路径上，我们也可以实现过滤和排序。</p></div></div>    
</body>
</html>