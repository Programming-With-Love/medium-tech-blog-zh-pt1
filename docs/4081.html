<html>
<head>
<title>A Comprehensive Introduction to Perform an Efficient Android Code Review</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">执行高效Android代码审查的全面介绍</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/a-comprehensive-introduction-to-perform-an-efficient-android-code-review-75975ccaa20a?source=collection_archive---------3-----------------------#2015-12-09">https://medium.com/google-developer-experts/a-comprehensive-introduction-to-perform-an-efficient-android-code-review-75975ccaa20a?source=collection_archive---------3-----------------------#2015-12-09</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="af20" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你在一个关心代码质量的团队中工作。你一直在做——或者考虑做——一些代码配对。你的团队定期开展黑客活动来谈论和展示新技术，或者谈论每个成员的个人发现。并且您正试图为您的组织设计完美的代码审查过程。这种情况你熟悉吗？</p><p id="181f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">代码审查很难实现。团队由N人组成，每个人都有自己的日程和优先事项。有些人可能更完美，可能对代码审查有不同的接受标准。其他一些人真的相信评论应该在每个新功能或修复的顶部，并且完全是自愿的。和任何团队一样，需要做的是说服，而不是强加于人。</p><h2 id="106a" class="jc jd hh bd je jf jg jh ji jj jk jl jm ip jn jo jp it jq jr js ix jt ju jv jw bi translated">代码评审的目的是什么？</h2><p id="3ee6" class="pw-post-body-paragraph ie if hh ig b ih jx ij ik il jy in io ip jz ir is it ka iv iw ix kb iz ja jb ha bi translated">在应用它几年后(更具体地说，与我不使用它们的时候相比)，我只能从正面看待代码评审。如果它们得到适当的实施，那么它们就没有单一的不利之处，而都是有益的。这是我曾经写的一个作弊清单，用来说服其他团队成员为什么我们应该应用代码评审:</p><ul class=""><li id="c800" class="kc kd hh ig b ih ii il im ip ke it kf ix kg jb kh ki kj kk bi translated"><strong class="ig hi">其他开发者的教育:</strong>软件系统很复杂。你可能会在广泛的平台上工作，知道全球5%，也许10%的市场份额。你不知道另一边发生了什么，这是一个很大的限制。时间是有限的，压力通常大到足以阻止你在其他模块中自由漫步。代码审查可以在这里向你介绍平台的另一部分，而不需要花费大量的时间——是的，对于团队中的新成员来说，这是一个令人惊奇的介绍方法。代码评审是<em class="kl">知识转移</em>的工具。</li><li id="355b" class="kc kd hh ig b ih km il kn ip ko it kp ix kq jb kh ki kj kk bi translated">提高代码质量:编程让你置身于一个心流中，远离外部影响，专注于单一目标。这让你有偏见，因为你在想“我如何让这个工作？”。一个外部开发人员会想“<em class="kl">我该怎么破这个，哪里能找到薄弱点？”</em>。这就是为什么开发人员不应该测试他们的代码，也是为什么我们有专门的QA测试人员。引入第三个人来评审很可能会发现那些没有人注意到的错误。</li><li id="cbf0" class="kc kd hh ig b ih km il kn ip ko it kp ix kq jb kh ki kj kk bi"><strong class="ig hi">Creating a developing culture:</strong> we all have work with coding guidelines and style. We all have our own oddities and crazes we have acquired during years of development, but in an organisation we want to make all fit in the same developing culture. <em class="kl">“But what happens with our team creativity!”</em> I have heard many times when exposing this argument. There is a Japanese proverb, 出る釘は打たれる, <em class="kl">“A nail that sticks out will be hammered”</em>. We do not need to hammer any nail here. We can take the finest from the Western and Eastern philosophies to create a radically cool process, taking the best of each world.</li><li id="b72e" class="kc kd hh ig b ih km il kn ip ko it kp ix kq jb kh ki kj kk bi translated">自信:如果你独自工作，你就是在为自己编码。你不关心代码是否能被其他人阅读，这将损害你的质量。一个人永远不应该在任何团队中独自工作:他/她会筋疲力尽，代码质量会下降，项目会灭亡)。如果你知道第三个人会阅读和分析你的代码，你的内部代码会额外努力使它清晰、简洁和可读。就像是一个非常便宜的静态代码分析工具。</li></ul><h1 id="3d21" class="kr jd hh bd je ks kt ku ji kv kw kx jm ky kz la jp lb lc ld js le lf lg jv lh bi translated">Android应该如何进行代码审查？</h1><p id="3954" class="pw-post-body-paragraph ie if hh ig b ih jx ij ik il jy in io ip jz ir is it ka iv iw ix kb iz ja jb ha bi translated">这些是支持代码审查的一般理由和论据，但是你已经在本文开头的标题“Android”中读到了。那么如何才能高效的审核Android代码呢？嗯，有一些工具和技术，我们可以专门应用在我们的绿色平台。</p><p id="e31e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">免责声明/50%垃圾邮件</strong>:我不久前写了一篇关于<a class="ae li" rel="noopener" href="/google-developer-experts/automating-android-development-6daca3a98396#.njcyjponb">自动化Android开发</a>的文章，提供了一个分支和提交到Git存储库的模型。为了实现代码评审过程，采用分支和开发模型是至关重要的。所有的代码审查必须在一个分支实际合并到另一个分支之前完成。在我的特定模型中，代码审查在以下部分中完成:</p><ul class=""><li id="fde5" class="kc kd hh ig b ih ii il im ip ke it kf ix kg jb kh ki kj kk bi translated">当一个特性已经完成，并且需要合并到alpha中时。</li><li id="09f4" class="kc kd hh ig b ih km il kn ip ko it kp ix kq jb kh ki kj kk bi translated">当在bug修复冲刺阶段发现了一个bug，并且需要合并到beta/alpha中时。</li><li id="90de" class="kc kd hh ig b ih km il kn ip ko it kp ix kq jb kh ki kj kk bi translated">当一个修补程序已经完成，并需要再次合并。</li></ul><figure class="lk ll lm ln fd lo er es paragraph-image"><div role="button" tabindex="0" class="lp lq di lr bf ls"><div class="er es lj"><img src="../Images/c1f7d4e7128c9748dd2a21b4781366a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W2okKfHKuW7-ikomRdotZg.png"/></div></div><figcaption class="lv lw et er es lx ly bd b be z dx">In the model proposed in the previous post, this is where you apply the code reviews</figcaption></figure><p id="0712" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">更新:我的同事<a class="ae li" href="https://twitter.com/nshred" rel="noopener ugc nofollow" target="_blank"> Nick Skelton </a>，他在不同的会议上向我提出了这个话题，也在<a class="ae li" href="http://www.androidshortcuts.com/a-scaleable-git-branching-strategy-for-android/" rel="noopener ugc nofollow" target="_blank">上发表了他自己的文章</a>，提出了一些想法并进一步扩展了这个模型。我完全可以推荐去看看。</p><h2 id="b505" class="jc jd hh bd je jf jg jh ji jj jk jl jm ip jn jo jp it jq jr js ix jt ju jv jw bi translated">入门指南</h2><p id="e9da" class="pw-post-body-paragraph ie if hh ig b ih jx ij ik il jy in io ip jz ir is it ka iv iw ix kb iz ja jb ha bi translated">首先，这是我在之前的公司和现在作为独立承包人使用过的模型。对我很有效。它在Android开发中特别有效。但是不要忘记在软件工程中没有任何教条。理论必须适应每个场景，所以从这里选择你喜欢的，并随时修改它。</p><p id="d724" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当我在前面提到的三个案例中有一个需要合并的分支时，我打开一个Pull请求，并指派至少一个(最好是两个)其他开发人员来检查代码。令人费解的是，有些环境只允许每个PR有一个审核者(早上好<a class="ae li" href="https://github.com" rel="noopener ugc nofollow" target="_blank"> GitHub </a>！)，所以这个过程需要手工完成(当审核人<strong class="ig hi"> A </strong>完成后，他要把审核分配给审核人<strong class="ig hi"> B </strong>)。最理想的是，一个评审者必须来自开发团队(他们知道项目的限制和状态)，第二个评审者将来自一个外来的团队(我们希望与这个人分享知识)。</p><p id="592f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">审查者有否决权。他们都需要同意合并分支机构。这就产生了团队精神，因为每个人对提交到我们系统中的每个特性都有点反应，即使他们不是直接贡献者。当有不同意见时，需要在我们的公关仪表板上进行讨论和解决，直到我们达成共识。如果绝对需要一名裁判，团队领导或类似的人物应该有决定权——尽管在我多年的经验中，我从未遇到过由于缺乏优秀混蛋的同意而导致公关受阻的问题！</p><p id="bad5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">正确的PR从本地下载分支并在我们的仿真器或设备中编译它开始。为什么需要这样做？嗯，Android是一个碎片化的平台，拥有丰富的插件和版本生态系统。99%的问题可以通过在不同的计算机和设备/仿真器上再现环境来避免。</p><p id="777a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我也主张对新特性或新错误进行非正式测试。由于我们后天的偏见，我们在开发时往往会忽略琐碎的点，因为我们专注于我们的功能。另一个很大比例的错误可以通过这个简单的步骤检测出来:询问功能需求并测试应用程序是否遵循这些需求。</p><blockquote class="lz ma mb"><p id="813e" class="ie if kl ig b ih ii ij ik il im in io mc iq ir is md iu iv iw me iy iz ja jb ha bi translated">为了将功能需求与分支和PR容易地联系起来，将我们的分支命名为我们的发行单(例如，PROJECT-123)是一个很好的策略。大多数环境都允许我们将PR与包含票据描述和功能需求的票据存储库连接起来，这样审核者就可以更快地访问它。</p></blockquote><h2 id="3759" class="jc jd hh bd je jf jg jh ji jj jk jl jm ip jn jo jp it jq jr js ix jt ju jv jw bi translated">我们应该什么时候做？</h2><p id="cdc6" class="pw-post-body-paragraph ie if hh ig b ih jx ij ik il jy in io ip jz ir is it ka iv iw ix kb iz ja jb ha bi translated">我们应该避免被打扰。除非它是一个修补程序，否则我通常会在午休后进行代码审查，或者在Pomodoro休息时开始。这样，我确保它们不会干扰我的发展，而是在一个更放松的时刻完成。</p><p id="5fca" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">代码审查也不应该超过30分钟，但这与您正在实现的特性的粒度密切相关。如果您发现自己连续30多分钟忙于进行代码评审，这是一个与您的项目经理交谈并讨论您正在实现的特性的维度是否足够的好时机。</p><h1 id="35a4" class="kr jd hh bd je ks kt ku ji kv kw kx jm ky kz la jp lb lc ld js le lf lg jv lh bi translated">代码分析</h1><p id="5b0e" class="pw-post-body-paragraph ie if hh ig b ih jx ij ik il jy in io ip jz ir is it ka iv iw ix kb iz ja jb ha bi translated">所以我们的电脑里有这个功能。它已经编译好了，满足了功能需求，现在我们要开始分析代码了。我们能从哪里开始？我们可以对代码提出哪些问题？</p><h2 id="5793" class="jc jd hh bd je jf jg jh ji jj jk jl jm ip jn jo jp it jq jr js ix jt ju jv jw bi translated">架构模式</h2><ul class=""><li id="b68f" class="kc kd hh ig b ih jx il jy ip mf it mg ix mh jb kh ki kj kk bi translated">这段代码是否遵循了我们的架构模式？MVP，MVC，MVVM，事件总线？</li><li id="6206" class="kc kd hh ig b ih km il kn ip ko it kp ix kq jb kh ki kj kk bi translated">是否在错误的类中执行了任何操作？(即片段中的数据逻辑)</li></ul><h2 id="16a1" class="jc jd hh bd je jf jg jh ji jj jk jl jm ip jn jo jp it jq jr js ix jt ju jv jw bi translated">测试</h2><ul class=""><li id="0511" class="kc kd hh ig b ih jx il jy ip mf it mg ix mh jb kh ki kj kk bi translated">是否为特性或缺陷创建了测试？之前的测试有更新吗？</li><li id="a957" class="kc kd hh ig b ih km il kn ip ko it kp ix kq jb kh ki kj kk bi translated">所有的测试类型都实现了吗？单元测试、集成测试和UI测试。</li><li id="b523" class="kc kd hh ig b ih km il kn ip ko it kp ix kq jb kh ki kj kk bi translated">新的测试目前有效吗？</li></ul><h2 id="a424" class="jc jd hh bd je jf jg jh ji jj jk jl jm ip jn jo jp it jq jr js ix jt ju jv jw bi translated">静态代码分析</h2><p id="c6c0" class="pw-post-body-paragraph ie if hh ig b ih jx ij ik il jy in io ip jz ir is it ka iv iw ix kb iz ja jb ha bi translated">我的最爱之一！在Android中，我们可以使用<a class="ae li" href="http://developer.android.com/tools/help/lint.html" rel="noopener ugc nofollow" target="_blank"> Lint </a>对我们的源代码进行静态分析。其中一些评论可能有意义，而另一些则没有意义(例如，我收到了很多“拼写错误”的警告……因为我主要与倾向于使用德语名称的德国团队合作，导致了诸如<em class="kl">datenbankwerbindung</em>之类的可变名称。如果您有遗留代码并且没有重构资源，您可能希望禁用弃用警告。</p><p id="05b4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">根据经验:我在所有新添加的文件和之前修改的文件中应用Lint。我会手动检查Lint警告是否有意义，并在有意义时发出通知，这样代码就可以改进了。</p><p id="0836" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Lint可能非常方便。它通知可能的错误和内存泄漏。它还通知不推荐使用的代码、样式问题和命名约定。它可以成为一种强有力的教育工具。</p><h2 id="04e8" class="jc jd hh bd je jf jg jh ji jj jk jl jm ip jn jo jp it jq jr js ix jt ju jv jw bi translated">代码样式</h2><p id="e3ae" class="pw-post-body-paragraph ie if hh ig b ih jx ij ik il jy in io ip jz ir is it ka iv iw ix kb iz ja jb ha bi translated">每个组织都应该有自己的编码指南(如果你没有，是时候开始定义一个了)。我在Sixt工作期间，我们开源了我们的<a class="ae li" href="https://speakerdeck.com/kikoso/android-coding-guidelines" rel="noopener ugc nofollow" target="_blank">编码指南</a>。Android为贡献者提供了一些<a class="ae li" href="https://source.android.com/source/code-style.html" rel="noopener ugc nofollow" target="_blank">编码指南</a>，你可以用它们来启发自己的贡献者。当然,<a class="ae li" href="http://bit.ly/1SNR4Yp" rel="noopener ugc nofollow" target="_blank"> Clean Code </a>圣经有一套关于干净编码和代码风格的广泛建议——如果你还没有读过的话，这是一本必读的书。</p><h1 id="17df" class="kr jd hh bd je ks kt ku ji kv kw kx jm ky kz la jp lb lc ld js le lf lg jv lh bi translated">自动化宝贝！</h1><p id="6ad4" class="pw-post-body-paragraph ie if hh ig b ih jx ij ik il jy in io ip jz ir is it ka iv iw ix kb iz ja jb ha bi translated">从前面的步骤来看，有几个步骤可以非常容易地自动化。Lint可以很容易地在Jenkins中设置，以便在每次构建时执行。我们首先需要在Jenkins CI服务器上安装<a class="ae li" href="https://wiki.jenkins-ci.org/display/JENKINS/Android+Lint+Plugin" rel="noopener ugc nofollow" target="_blank"> Lint插件</a>。然后，我们只需在作业配置中激活它:</p><figure class="lk ll lm ln fd lo er es paragraph-image"><div class="er es mi"><img src="../Images/013742e6085fce41328970be36261a84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1130/format:webp/1*JYLP-nr_f_bGm0c62pe0Ww.png"/></div><figcaption class="lv lw et er es lx ly bd b be z dx">Now we are applying and saving our Lint results!</figcaption></figure><p id="cb05" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">作为一个有用的规则，您应该在Gradle文件中停用Lint，以防止应用程序停止构建。这可以通过下面的代码片段轻松完成:</p><pre class="lk ll lm ln fd mj mk ml mm aw mn bi"><span id="8fa9" class="jc jd hh mk b fi mo mp l mq mr">android {<br/>    // ...<br/><br/>    lintOptions {<br/>        // Don't abort if Lint finds an error, otherwise the Jenkins build<br/>        // will be marked as failed, and Jenkins won't analyse the Lint output<br/>        abortOnError false<br/>    }<br/>}</span></pre><p id="a9a1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我更喜欢将Lint构建标记为不稳定而不是失败，并手动检查输出(同样，这将取决于您公司的策略)。詹金斯甚至可以设置运行林特时，公关是开放的！我不停地说使用Jenkins让办公室每个人的生活变得更加轻松，但我仍然很惊讶有多少人仍然没有使用它——我在许多会议上问了这个问题后随机猜测可能是三分之一的公司。</p><p id="427f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">编码指南和样式也可以在Android中自动检查。您可以使用<a class="ae li" href="http://checkstyle.sourceforge.net/" rel="noopener ugc nofollow" target="_blank"> Checkstyle </a>(一种开发工具，用于确保实现编码风格)并针对您的代码运行它。Checkstyle有针对<a class="ae li" href="https://plugins.jetbrains.com/plugin/1065" rel="noopener ugc nofollow" target="_blank">安卓工作室</a>、<a class="ae li" href="https://wiki.jenkins-ci.org/display/JENKINS/Checkstyle+Plugin" rel="noopener ugc nofollow" target="_blank">詹金斯</a>以及其他平台的插件。根据您遵循的严格程度，您可能希望构建失败或将其标记为不稳定。我个人喜欢向提交者发送一份自动报告，提及其编码风格中的缺陷。</p><h1 id="48e4" class="kr jd hh bd je ks kt ku ji kv kw kx jm ky kz la jp lb lc ld js le lf lg jv lh bi translated">结论</h1><p id="b923" class="pw-post-body-paragraph ie if hh ig b ih jx ij ik il jy in io ip jz ir is it ka iv iw ix kb iz ja jb ha bi translated">执行代码审查就像烹饪一样:是一个个人的过程，其中只有一个主要的指导方针必须遵循，并且最终的过程往往会出现分支，与最初的种子不同。然而，读完这篇文章后，你应该对如何开始和如何检查有一个更清楚的想法——同样，如果你是一个有经验的开发人员，我希望你能得到一些想法和灵感。</p><p id="93a8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在结束这篇文章之前，我还想提几点:</p><ul class=""><li id="ff20" class="kc kd hh ig b ih ii il im ip ke it kf ix kg jb kh ki kj kk bi translated">代码评审是关于代码的，而不是关于人的。这必须是每个团队成员都清楚的一点，以避免针对个人。目的是出货一个高质量的代码，而不是增加ego。</li><li id="ff1c" class="kc kd hh ig b ih km il kn ip ko it kp ix kq jb kh ki kj kk bi translated">好事也要指出来。当我发现一些聪明或优秀的东西时，我从中学习，并让开发者知道。</li></ul><p id="07e6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我总是认为现场演示比理论性的帖子好得多，所以我计划再贴几篇有特殊想法和代码评论的文章。如果你对这个话题感兴趣，欢迎订阅或关注我的<a class="ae li" href="http://twitter.com/eenriquelopez" rel="noopener ugc nofollow" target="_blank"> Twitter </a>！如果你喜欢文章，点击底部的小心脏推荐一下，随时分享:-)吧</p><p id="57b6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">感谢你的反馈，你真棒！</p></div></div>    
</body>
</html>