<html>
<head>
<title>How to get app install date in React Native?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在React Native中获取app安装日期？</h1>
<blockquote>原文：<a href="https://medium.com/quick-code/how-to-get-app-install-date-in-react-native-ba4519150478?source=collection_archive---------0-----------------------#2019-03-06">https://medium.com/quick-code/how-to-get-app-install-date-in-react-native-ba4519150478?source=collection_archive---------0-----------------------#2019-03-06</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="9388" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我已经在React native上工作了一段时间，我喜欢用它来构建应用程序。尽管React native带来了很多好处，但有时很难完成一些在native中可以轻松完成的琐碎任务。其中一件事就是找出Android和iOS中应用程序的安装日期。</p><p id="3cb9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我在React Native中搜索了很多库，想找出这个应用程序是什么时候安装在我的手机上的，但每次都失败了，因为目前没有办法在React Native中找到这个问题的解决方案。</p><p id="36a5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后听说了React Native里的原生模块。本机模块有助于我们集成本机代码以实现本机反应。众所周知，react native是市场上的新技术，因此不能提供我们需要的所有原生功能，所以我们需要自己构建它。我们将通过使用Android<a class="ae jc" href="https://facebook.github.io/react-native/docs/native-modules-android" rel="noopener ugc nofollow" target="_blank">和iOS </a>的原生模块来做到这一点。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/b1aa58a22cdee87e9580a290c6202ffa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kBZEyecEfgsR3bWQ5h5giw.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Photo by <a class="ae jc" href="https://unsplash.com/photos/c7LoNDd4nKI?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Nicole Honeywill</a> on <a class="ae jc" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="7c07" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">入门指南</h1><p id="4734" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">首先，使用react native cli创建react native项目。</p><pre class="je jf jg jh fd kw kx ky kz aw la bi"><span id="9b15" class="lb ju hh kx b fi lc ld l le lf">react-native init NativeModuleExample</span></pre><p id="bf3c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，我们需要在本机代码和JavaScript代码之间建立一座桥梁。React Native中有两种环境，JavaScript环境和原生环境。它们两者相互通信，并且这种通信是通过使用“桥”来完成的。该桥为这两种环境之间的双向和异步通信提供了一种方式。</p><p id="f7d9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，为了在我们的示例应用程序中创建这个桥，我们需要安装<a class="ae jc" href="https://github.com/peggyrayzis/react-native-create-bridge" rel="noopener ugc nofollow" target="_blank">react-native-create-bridge</a>包。</p><pre class="je jf jg jh fd kw kx ky kz aw la bi"><span id="70fb" class="lb ju hh kx b fi lc ld l le lf">npm install --save react-native-create-bridge</span></pre><p id="8f75" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，从我们项目的根目录，运行</p><pre class="je jf jg jh fd kw kx ky kz aw la bi"><span id="983b" class="lb ju hh kx b fi lc ld l le lf">react-native new-module</span></pre><p id="386f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将会出现一个提示，询问您:</p><ol class=""><li id="56b9" class="lg lh hh ig b ih ii il im ip li it lj ix lk jb ll lm ln lo bi translated">您的桥接模块名称:<code class="du lp lq lr kx b">AppInstallDate</code></li><li id="6f5a" class="lg lh hh ig b ih ls il lt ip lu it lv ix lw jb ll lm ln lo bi translated">从桥类型中选择<code class="du lp lq lr kx b">Native Module</code>。</li><li id="c844" class="lg lh hh ig b ih ls il lt ip lu it lv ix lw jb ll lm ln lo bi translated">选择默认平台，即iOS/Obj-C和Android/Java。</li><li id="1d9a" class="lg lh hh ig b ih ls il lt ip lu it lv ix lw jb ll lm ln lo bi translated">您想要存放JS文件的目录。如果它不存在，它会为你创建一个。</li></ol><p id="f003" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这将在我们的项目中创建一个文件<code class="du lp lq lr kx b">AppInstallDateNativeModule.js</code>。现在，是时候在我们的react原生项目中引入原生环境了。所以，为此，我们必须要有Android studio和Xcode来写原生代码。</p><h2 id="47b5" class="lb ju hh bd jv lx ly lz jz ma mb mc kd ip md me kh it mf mg kl ix mh mi kp mj bi translated">对于iOS/Obj-C</h2><p id="5780" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">打开Xcode，右键点击你的根项目文件夹名和<code class="du lp lq lr kx b">Add files to your NativeModuleExample</code>。选择与您的模块相关的文件并点击<code class="du lp lq lr kx b">Add</code></p><p id="436f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在是时候写一些本地代码了，所以对于这个open <code class="du lp lq lr kx b">AppInstallDate.m</code>和update方法<code class="du lp lq lr kx b">RCT_EXPORT_METHOD</code>它应该看起来像这样。</p><pre class="je jf jg jh fd kw kx ky kz aw la bi"><span id="1dac" class="lb ju hh kx b fi lc ld l le lf">RCT_EXPORT_METHOD(exampleMethod)<br/>{<br/>NSURL* urlToDocumentsFolder = [[[NSFileManager defaultManager] URLsForDirectory:NSDocumentDirectory inDomains:NSUserDomainMask] lastObject];</span><span id="e1f6" class="lb ju hh kx b fi mk ld l le lf"><strong class="kx hi">__autoreleasing</strong> NSError *error;</span><span id="89f5" class="lb ju hh kx b fi mk ld l le lf">NSDate *installDate = [[[NSFileManager defaultManager] attributesOfItemAtPath:urlToDocumentsFolder.path error:&amp;error] objectForKey:NSFileCreationDate];</span><span id="5518" class="lb ju hh kx b fi mk ld l le lf">NSDateFormatter *dateFormatter = [[NSDateFormatter alloc] init];</span><span id="0e02" class="lb ju hh kx b fi mk ld l le lf">[dateFormatter setDateFormat:@"dd/mm/yyyy hh:mm:ss"];</span><span id="c961" class="lb ju hh kx b fi mk ld l le lf">NSString *stringDate = [dateFormatter stringFromDate:installDate];</span><span id="ea22" class="lb ju hh kx b fi mk ld l le lf">[<strong class="kx hi">self</strong> emitMessageToRN:@"EXAMPLE_EVENT" :@{ @"date":stringDate }];</span><span id="afc4" class="lb ju hh kx b fi mk ld l le lf">}</span></pre><h2 id="2665" class="lb ju hh bd jv lx ly lz jz ma mb mc kd ip md me kh it mf mg kl ix mh mi kp mj bi translated">适用于Android/Java</h2><p id="c290" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">打开Android Studio，在<code class="du lp lq lr kx b">android/app/src/main/java/com/NativeModuleExample</code>中查找<code class="du lp lq lr kx b">MainApplication.java</code>，然后将您的包添加到getPackages函数中，如下所示:</p><pre class="je jf jg jh fd kw kx ky kz aw la bi"><span id="b35b" class="lb ju hh kx b fi lc ld l le lf"><strong class="kx hi">import </strong>com.nativemoduleexample.appinstalldate.AppInstallDatePackage;</span><span id="b78f" class="lb ju hh kx b fi mk ld l le lf">@Override<br/>  protected List&lt;ReactPackage&gt; getPackages() {<br/>    return Arrays.&lt;ReactPackage&gt;asList(<br/>        new MainReactPackage(),<br/>        new <!-- -->AppInstallDatePackage<!-- -->()<br/>    );<br/>  }</span></pre><p id="2009" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">打开<code class="du lp lq lr kx b">java/yourapp</code>中的<code class="du lp lq lr kx b">AppInstallDateModule</code>文件，更新<code class="du lp lq lr kx b">exampleMethod</code>函数，如下所示。</p><pre class="je jf jg jh fd kw kx ky kz aw la bi"><span id="fe02" class="lb ju hh kx b fi lc ld l le lf">@ReactMethod<br/>    <strong class="kx hi">public void </strong>exampleMethod () {<br/>        <em class="ml">// An example native method that you will expose to React<br/>        // </em><a class="ae jc" href="https://facebook.github.io/react-native/docs/native-modules-android.html#the-toast-module" rel="noopener ugc nofollow" target="_blank"><em class="ml">https://facebook.github.io/react-native/docs/native-modules-android.html#the-toast-module</em></a></span><span id="f9c7" class="lb ju hh kx b fi mk ld l le lf"><strong class="kx hi">try</strong>{<em class="ml"><br/>            </em><strong class="kx hi">long </strong>installedTime = <em class="ml">reactContext</em>.getPackageManager().getPackageInfo(<em class="ml">reactContext</em>.getPackageName(),0).<strong class="kx hi">firstInstallTime</strong>;</span><span id="17fd" class="lb ju hh kx b fi mk ld l le lf"><em class="ml">// Format the date time<br/>            </em>String dateString = DateFormat.<em class="ml">format</em>(<strong class="kx hi">"dd/mm/yyyy hh:mm:ss"</strong>, <strong class="kx hi">new </strong>Date(installedTime)).toString();</span><span id="235b" class="lb ju hh kx b fi mk ld l le lf"><strong class="kx hi">final </strong>WritableMap event = Arguments.<em class="ml">createMap</em>();<br/>            event.putString(<strong class="kx hi">"date"</strong>, dateString);<br/>            <em class="ml">emitDeviceEvent</em>(<strong class="kx hi">"EXAMPLE_EVENT"</strong>, event);</span><span id="5e1a" class="lb ju hh kx b fi mk ld l le lf">}<strong class="kx hi">catch</strong>(PackageManager.NameNotFoundException e){<br/>            e.printStackTrace();<br/>        }<br/>    }</span></pre><h1 id="415a" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">最后的步骤</h1><p id="7a00" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">打开文件<code class="du lp lq lr kx b">AppInstallDateNativeModule.js from </code>您的项目，即NativeModuleExample，并将代码更新为:</p><pre class="je jf jg jh fd kw kx ky kz aw la bi"><span id="bd98" class="lb ju hh kx b fi lc ld l le lf">//  Created by react-native-create-bridge</span><span id="2450" class="lb ju hh kx b fi mk ld l le lf">import { NativeModules, NativeEventEmitter } from "react-native";</span><span id="dff3" class="lb ju hh kx b fi mk ld l le lf">const { AppInstallDate } = NativeModules;</span><span id="d28a" class="lb ju hh kx b fi mk ld l le lf">const AppInstallDateEmitter = new NativeEventEmitter(AppInstallDate);</span><span id="8190" class="lb ju hh kx b fi mk ld l le lf">export default {<br/>   exampleMethod() {<br/>     return AppInstallDate.exampleMethod();<br/>  },</span><span id="9211" class="lb ju hh kx b fi mk ld l le lf">emitter: AppInstallDateEmitter,</span><span id="a0cd" class="lb ju hh kx b fi mk ld l le lf">EXAMPLE_CONSTANT: AppInstallDate.EXAMPLE_CONSTANT</span><span id="0ada" class="lb ju hh kx b fi mk ld l le lf">};</span></pre><p id="8a25" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，打开<code class="du lp lq lr kx b">App.js file, and update code</code></p><pre class="je jf jg jh fd kw kx ky kz aw la bi"><span id="ba43" class="lb ju hh kx b fi lc ld l le lf">import AppInstallDate from "./AppInstallDateNativeModule";</span><span id="1d11" class="lb ju hh kx b fi mk ld l le lf">componentWillMount() {<br/>  AppInstallDate.emitter.addListener("EXAMPLE_EVENT", ({ date }) =&gt;   {<br/>  alert(date);<br/>  });<br/>}</span><span id="7f25" class="lb ju hh kx b fi mk ld l le lf">componentWillUnmount() {<br/>  AppInstallDate.emitter.remove();<br/>}</span><span id="1135" class="lb ju hh kx b fi mk ld l le lf">onPress = () =&gt; {<br/>  AppInstallDate.exampleMethod();<br/>};</span><span id="5349" class="lb ju hh kx b fi mk ld l le lf">render(){<br/> return(<br/>         &lt;TouchableOpacity onPress={this.onPress}&gt;<br/>           &lt;Text&gt;Click Me!!!&lt;/Text&gt;<br/>         &lt;/TouchableOpacity&gt;<br/>      );<br/>}</span></pre><h1 id="ba1b" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">结论</h1><p id="e74f" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">我们已经成功创建了一个获取应用安装日期的React本机应用。</p><p id="9c14" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我跳过了这个应用程序的一些样板代码，但你可以在GitHub repo <a class="ae jc" href="https://github.com/meenunegi/react-native-app-install-date" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></div><div class="ab cl mm mn go mo" role="separator"><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr ms"/><span class="mp bw bk mq mr"/></div><div class="ha hb hc hd he"><p id="22f8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">希望这个回购能帮助你理解react native app中的NativeModule链接。也许你可以从中获得灵感来建造一些令人惊叹的东西。请随时留下任何反馈，我一直在寻找更好的解决方案！</p></div></div>    
</body>
</html>