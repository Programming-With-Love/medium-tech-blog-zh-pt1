<html>
<head>
<title>PL/SQL Constants for Data Type Lengths: 12 Things Developers Will Love About Oracle Database 12c Release 2 Part 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据类型长度的PL/SQL常量:开发人员喜欢的关于Oracle Database 12c第2版第3部分的12件事</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/pl-sql-constants-for-data-type-lengths-12-things-developers-will-love-about-oracle-database-12c-cb5f4d7c2d06?source=collection_archive---------4-----------------------#2016-11-10">https://medium.com/oracledevs/pl-sql-constants-for-data-type-lengths-12-things-developers-will-love-about-oracle-database-12c-cb5f4d7c2d06?source=collection_archive---------4-----------------------#2016-11-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="f97b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本系列的第2部分中，我们看到您现在可以创建名称长度为128字节的对象。我知道你们中的一些人非常渴望开始制作名字长得可笑的桌子。但是在你这么做之前，检查一下你的代码。如果你的开发团队使用草率的编码实践，可能会有一些陷阱等着你…</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/adf002582e3b45497b5e914110582820.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/0*vxgmXQYABTRW5NBX.jpg"/></div></figure><p id="2e1e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">大多数应用程序至少有一段PL/SQL从数据字典中选择。例如:</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="476f" class="jq jr hh jm b fi js jt l ju jv">begin select table_name into tab from user_tables where ...</span></pre><p id="71d6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因为表名的最大长度一直是30个字节<em class="jw">永远是</em>，一些开发人员开始这样声明变量:</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="3107" class="jq jr hh jm b fi js jt l ju jv">declare tab varchar2(30);</span></pre><p id="848f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因为谁需要超过30个字符，对吗？</p><p id="e47c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但是正如我们<a class="ae jc" rel="noopener" href="/oracledevs/loooooooooooooooong-names-12-things-developers-will-love-about-oracle-database-12c-release-2-part-b5f6e79698">在第2部分</a>中看到的，升级到12.2，极限现在是128字节！所以人们创建名字更长的表只是时间问题。最终，该代码将失败，并显示:</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="a005" class="jq jr hh jm b fi js jt l ju jv">ORA-06502: PL/SQL: numeric or value error: character string buffer too small</span></pre><p id="d117" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">那怎么办呢？</p><p id="4f9a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果能动态改变varchar2的最大长度就好了。因此，您可以在一个地方增加大小，而不是遍历您的PL/SQL，更改varchar2 ( 30 ) -&gt; varchar2 ( 128)。</p><p id="c0b8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">幸运的是，在12.2你可以！</p><p id="7996" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">新版本使您能够使用常数声明可变长度。所以你可以创建一个常量包:</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="a6df" class="jq jr hh jm b fi js jt l ju jv">create or replace package constants as tab_length <br/>  constant pls_integer := 128; <br/>end constants; <br/>/</span></pre><p id="1b1d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后在声明变量时使用它:</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="f3d1" class="jq jr hh jm b fi js jt l ju jv">declare tab varchar2( constants.tab_length );</span></pre><p id="c85e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，如果我们再次增加名字的长度，你只需要做一个改变:常量的值！</p><p id="def9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意这些并不是完全动态的。PL/SQL编译器必须在编译时知道变量size的值。这意味着你不能把它建立在查询结果的基础上。用户自定义函数也不可用。因此，要使变量能够保存更长的字符串，需要增加constants.tab_length的值，并重新编译代码。</p><p id="025d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在您可能会想:对于像对象名这样常见的东西，Oracle肯定会提供说明它们的最大长度的东西吗？</p><p id="87e2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">好消息是:我们有:)</p><p id="96e4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在DBMS_standard中你会发现一个新的常量。这包括ora_max_name_len。顾名思义，它规定了对象名的最大长度。因此，您可以将表名变量声明改为:</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="0fd9" class="jq jr hh jm b fi js jt l ju jv">declare <br/>  tab varchar2( ora_max_name_len ); <br/>begin</span></pre><p id="6f05" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最棒的是你现在可以让你的代码经得起未来的考验！通过使用条件编译，您可以将基于数据字典的变量声明更改为:</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="2a00" class="jq jr hh jm b fi js jt l ju jv">declare <br/>  $if DBMS_DB_VERSION.VER_LE_12_1 $then <br/>    tab varchar2( 30 ); <br/>  $else <br/>    tab varchar2( ora_max_name_len ); <br/>  $end</span></pre><p id="13b1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后当你来升级的时候tab变量会自动有更大的限制！</p><p id="0ca5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你可能会想，这听起来需要做很多工作。你是对的。</p><p id="7e01" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您还可以使您的变量12.2现在与类型锚定兼容:</p><pre class="je jf jg jh fd jl jm jn jo aw jp bi"><span id="ccda" class="jq jr hh jm b fi js jt l ju jv">declare tab user_tables.table_name%type;</span></pre><p id="c51a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">无论您使用哪种方法，现在就开始准备代码吧。可能要等很久才能升级。但是你的代码越健壮，你就越容易使用新的特性。</p></div><div class="ab cl jx jy go jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="ha hb hc hd he"><p id="7c28" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jw">全文原载于2016年11月10日</em><a class="ae jc" href="https://blogs.oracle.com/sql/12-things-developers-will-love-about-oracle-database-12c-release-2" rel="noopener ugc nofollow" target="_blank"><em class="jw">【blogs.oracle.com】</em></a><em class="jw">。</em></p></div></div>    
</body>
</html>