<html>
<head>
<title>Big Data Analytics with Cloud Notebooks and Query Style ML</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用云笔记本和查询风格ML的大数据分析</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/big-data-analytics-with-cloud-notebooks-and-query-style-ml-4a5c71ac2960?source=collection_archive---------7-----------------------#2021-05-14">https://medium.com/walmartglobaltech/big-data-analytics-with-cloud-notebooks-and-query-style-ml-4a5c71ac2960?source=collection_archive---------7-----------------------#2021-05-14</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="42fb" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">关于将机器学习与云服务相结合的迷你指南</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/14b879020f4c43fa137bcba08e7df5ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JnD4DKIXRG7ysZ-2IRAXDg.jpeg"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Photo credit: Pixabay</figcaption></figure><p id="ad35" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">云服务由于其灵活性、可持续性、成本节约、安全性等，扮演着比以前重要得多的角色。那么如何将机器学习与云服务相结合成为云未来的另一个方面。目前，云服务供应商有多种选择。对于他们中的每一个人，他们在云服务下都有一些类似的与机器学习相关的组件。比如有微软Azure笔记本，GCP云AI平台笔记本，AWS EMR笔记本，Azure SQL中的机器学习服务等。在我们的特例中，我们以GCP为例。当我看着他们比如AI平台笔记本，BigQuery ML，AutoML等。，我心中有一个很大的问号——我们如何选择正确的方法来达到我们的目标？在这篇博客中，我们将使用两种不同的方法来创建基于“泰坦尼克号——灾难中的机器学习”(参考文献1)的数据的逻辑回归。我们试着根据结果比较云笔记本和查询风格ML的优缺点。</p><p id="e2ae" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">我们使用的数据来自Kaggle，主要目标是预测哪些乘客在泰坦尼克号沉船事故中幸存。</p></div><div class="ab cl ki kj go kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="ha hb hc hd he"><h1 id="501c" class="kp kq hh bd kr ks kt ku kv kw kx ky kz in la io lb iq lc ir ld it le iu lf lg bi translated">议程</h1><ul class=""><li id="f2a7" class="lh li hh jo b jp lj js lk jv ll jz lm kd ln kh lo lp lq lr bi translated">通用云笔记本的架构</li><li id="bda6" class="lh li hh jo b jp ls js lt jv lu jz lv kd lw kh lo lp lq lr bi translated">基于笔记本预测数据</li><li id="7309" class="lh li hh jo b jp ls js lt jv lu jz lv kd lw kh lo lp lq lr bi translated">查询样式ML</li><li id="2702" class="lh li hh jo b jp ls js lt jv lu jz lv kd lw kh lo lp lq lr bi translated">基于查询样式ML预测数据</li><li id="8dc4" class="lh li hh jo b jp ls js lt jv lu jz lv kd lw kh lo lp lq lr bi translated">云笔记本与查询风格ML的比较</li><li id="c5ae" class="lh li hh jo b jp ls js lt jv lu jz lv kd lw kh lo lp lq lr bi translated">推荐</li></ul></div><div class="ab cl ki kj go kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="ha hb hc hd he"><h1 id="a06f" class="kp kq hh bd kr ks kt ku kv kw kx ky kz in la io lb iq lc ir ld it le iu lf lg bi translated">通用云笔记本的架构</h1><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lx"><img src="../Images/b264f4bb328217dcf3dc3aecb1141f5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HT--nvEdtUECvI6oKrkbpA.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Cloud Notebook — Architecture</figcaption></figure><p id="2f78" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">根据上面的图表，我们可以发现Jupyter笔记本位于带有预配置实例的Compute VM下。它可以接触到不同的服务，如SQL、存储等。这是一款高级Jupyter笔记本电脑，具有以下优势。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ly"><img src="../Images/b0dea2a01c4289e7138976c8d9828e23.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bkBikLNsg6vFdccU7ZBiiA.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Benefits for Notebook</figcaption></figure></div><div class="ab cl ki kj go kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="ha hb hc hd he"><h1 id="ad0e" class="kp kq hh bd kr ks kt ku kv kw kx ky kz in la io lb iq lc ir ld it le iu lf lg bi translated">基于笔记本预测数据</h1><p id="fa6b" class="pw-post-body-paragraph jm jn hh jo b jp lj ii jr js lk il ju jv lz jx jy jz ma kb kc kd mb kf kg kh ha bi translated">我们按照以下步骤构建笔记本，您可以在参考2笔记本下找到所有详细代码:</p><ul class=""><li id="deef" class="lh li hh jo b jp jq js jt jv mc jz md kd me kh lo lp lq lr bi translated">业务理解(目标和描述)</li><li id="e1b2" class="lh li hh jo b jp ls js lt jv lu jz lv kd lw kh lo lp lq lr bi translated">数据理解:统计摘要、可视化和数据质量检查</li><li id="a534" class="lh li hh jo b jp ls js lt jv lu jz lv kd lw kh lo lp lq lr bi translated">数据准备:缺失值插补、特征工程和整合数据</li><li id="9e3d" class="lh li hh jo b jp ls js lt jv lu jz lv kd lw kh lo lp lq lr bi translated">建模:建立一个模型。符合模型。验证模型</li><li id="5a6e" class="lh li hh jo b jp ls js lt jv lu jz lv kd lw kh lo lp lq lr bi translated">估价</li></ul></div><div class="ab cl ki kj go kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="ha hb hc hd he"><h1 id="a800" class="kp kq hh bd kr ks kt ku kv kw kx ky kz in la io lb iq lc ir ld it le iu lf lg bi translated">查询样式ML？</h1><p id="cfb4" class="pw-post-body-paragraph jm jn hh jo b jp lj ii jr js lk il ju jv lz jx jy jz ma kb kc kd mb kf kg kh ha bi translated">查询风格ML是机器学习的一个新领域。查询风格ML最关键的一点是创建一个基于SQL的ML模型。即使我们不知道像python或其他ML库这样的编程语言，我们仍然可以使用SQL构建ML建模。</p><p id="4121" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">在这个特殊的例子中，我们使用BigQuery ML，它包括四个步骤:获取数据集、创建和训练模型、评估模型和预测结果。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mf"><img src="../Images/512f7bdb52ec1268d9cafd070f46804b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k-xXu2t7_dwqNMnufW7AgA.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Photo credit: Google Cloud Platform</figcaption></figure><p id="9ac0" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">但是BigQuery ML到目前为止只支持以下回归、分类、聚类的模型。我们可以在下面的桌子下面找到它们。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mg"><img src="../Images/2c75ad16cb0dd097036624a6d9d2982c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gp59JX0rjmFUTFBoDLK_5w.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">BigQueryML: Support Models</figcaption></figure></div><div class="ab cl ki kj go kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="ha hb hc hd he"><h1 id="5f72" class="kp kq hh bd kr ks kt ku kv kw kx ky kz in la io lb iq lc ir ld it le iu lf lg bi translated">基于查询样式ML预测数据</h1><p id="f0e4" class="pw-post-body-paragraph jm jn hh jo b jp lj ii jr js lk il ju jv lz jx jy jz ma kb kc kd mb kf kg kh ha bi translated">因为做统计汇总、可视化、数据质量检查和特征工程不是那么容易，所以我们使用来自笔记本部分的特征工程的结果数据，并将数据输入到BigQuery表中(我们使用BigQuery作为例子)。</p><p id="f85f" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">输入数据后，我们在下面的四个步骤中处理BigQuery ML流程:</p><h2 id="68bc" class="mh kq hh bd kr mi mj mk kv ml mm mn kz jv mo mp lb jz mq mr ld kd ms mt lf mu bi translated">步骤1:基于训练数据创建模型</h2><p id="ed45" class="pw-post-body-paragraph jm jn hh jo b jp lj ii jr js lk il ju jv lz jx jy jz ma kb kc kd mb kf kg kh ha bi translated">与创建表一样，我们可以基于训练集创建逻辑回归模型。我们可以设置很多参数，但是现在，我们只使用所有的默认值。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mv"><img src="../Images/e49308f9ee5eac6c6468d4ee9bcb4ec3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ebxTzbUkSw6ojxfv0NkRrA.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">BigQueryML — Create Model</figcaption></figure><h2 id="e6b9" class="mh kq hh bd kr mi mj mk kv ml mm mn kz jv mo mp lb jz mq mr ld kd ms mt lf mu bi translated">步骤2:获取模型信息</h2><p id="0bd3" class="pw-post-body-paragraph jm jn hh jo b jp lj ii jr js lk il ju jv lz jx jy jz ma kb kc kd mb kf kg kh ha bi translated">创建模型后，我们可以使用SQL获得许多不同的模型信息。以下查询将返回所有要素的权重。同样，我们可以得到很多模型元数据，我们可以参考参考文献3中的页面。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mw"><img src="../Images/ec7f062dbdfba9d0215316f9dac7cd0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GEBlRjkWxIOmlstzNSIGRw.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">BigQuery — Get Model Info</figcaption></figure><h2 id="1275" class="mh kq hh bd kr mi mj mk kv ml mm mn kz jv mo mp lb jz mq mr ld kd ms mt lf mu bi translated">步骤3:评估模型</h2><p id="91d2" class="pw-post-body-paragraph jm jn hh jo b jp lj ii jr js lk il ju jv lz jx jy jz ma kb kc kd mb kf kg kh ha bi translated">使用下面的查询和测试数据集，我们可以获得分类问题的6个性能指标，如精度、召回率、准确度、f1_score、log_loss和roc_auc。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mx"><img src="../Images/3a26b23ca489595ea6a31d9d04108afe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9CJWis7DSNQoWohS9BvsPQ.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">BigQuery — Evaluate Model</figcaption></figure><h2 id="c087" class="mh kq hh bd kr mi mj mk kv ml mm mn kz jv mo mp lb jz mq mr ld kd ms mt lf mu bi translated">第四步:预测</h2><p id="bd05" class="pw-post-body-paragraph jm jn hh jo b jp lj ii jr js lk il ju jv lz jx jy jz ma kb kc kd mb kf kg kh ha bi translated">最后一步是根据模型预测数据。我们可以使用下面的查询来预测数据。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es my"><img src="../Images/f1a45619e47fb3d2a49d91b009388d4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qa00waApELu_cGdzgNAjPg.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">BigQuery — Predict</figcaption></figure></div><div class="ab cl ki kj go kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="ha hb hc hd he"><h1 id="a267" class="kp kq hh bd kr ks kt ku kv kw kx ky kz in la io lb iq lc ir ld it le iu lf lg bi translated">云笔记本与查询风格ML的比较</h1><p id="5d97" class="pw-post-body-paragraph jm jn hh jo b jp lj ii jr js lk il ju jv lz jx jy jz ma kb kc kd mb kf kg kh ha bi translated">我们使用两种不同的方法来创建基于相同数据的逻辑回归。让我们来看看这两种型号的性能结果。根据下表，我们可以发现这两个模型有非常相似的结果。</p><pre class="ix iy iz ja fd mz na nb nc aw nd bi"><span id="0b05" class="mh kq hh na b fi ne nf l ng nh">| Metric    | Notebook    | BigQuery ML |<br/>|-----------|-------------|-------------|<br/>| precision | 0.798407557 | 0.790697674 |<br/>| recall    | 0.746405229 | 0.790697674 |<br/>| accuracy  | 0.842602041 | 0.850622407 |<br/>| roc_auc   | 0.901349357 | 0.902874126 |</span></pre><p id="b36f" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">除了模型性能，让我们深入下面的7个类别，以获得云笔记本和查询风格ML之间更详细的方面。得分范围从低到高。我们也可以在下面找到最终的比较表。</p><h2 id="93fc" class="mh kq hh bd kr mi mj mk kv ml mm mn kz jv mo mp lb jz mq mr ld kd ms mt lf mu bi translated">数据清理灵活/特征工程:</h2><p id="6b70" class="pw-post-body-paragraph jm jn hh jo b jp lj ii jr js lk il ju jv lz jx jy jz ma kb kc kd mb kf kg kh ha bi translated">编程语言可以更灵活地处理数据，甚至SQL也可以做一些基本的方法。</p><h2 id="7d70" class="mh kq hh bd kr mi mj mk kv ml mm mn kz jv mo mp lb jz mq mr ld kd ms mt lf mu bi translated">模型多样性:</h2><p id="bd4a" class="pw-post-body-paragraph jm jn hh jo b jp lj ii jr js lk il ju jv lz jx jy jz ma kb kc kd mb kf kg kh ha bi translated">BigQuery ML对模型选择有限制。</p><h2 id="d9ca" class="mh kq hh bd kr mi mj mk kv ml mm mn kz jv mo mp lb jz mq mr ld kd ms mt lf mu bi translated">模型创建和保存:</h2><p id="b673" class="pw-post-body-paragraph jm jn hh jo b jp lj ii jr js lk il ju jv lz jx jy jz ma kb kc kd mb kf kg kh ha bi translated">BigQuery ML在这里表现很好，因为它可以像创建表一样创建模型。</p><h2 id="8a7f" class="mh kq hh bd kr mi mj mk kv ml mm mn kz jv mo mp lb jz mq mr ld kd ms mt lf mu bi translated">基本模型性能:</h2><p id="2e0c" class="pw-post-body-paragraph jm jn hh jo b jp lj ii jr js lk il ju jv lz jx jy jz ma kb kc kd mb kf kg kh ha bi translated">对于基本模型，这两种方法具有相同的性能结果。</p><h2 id="fc9e" class="mh kq hh bd kr mi mj mk kv ml mm mn kz jv mo mp lb jz mq mr ld kd ms mt lf mu bi translated">自动性能调节:</h2><p id="2e3d" class="pw-post-body-paragraph jm jn hh jo b jp lj ii jr js lk il ju jv lz jx jy jz ma kb kc kd mb kf kg kh ha bi translated">BigQuery ML需要在SQL语句下手动设置一些参数，但是对于编程语言，我们有一些像GridSearchCV这样的库来自动调整模型。</p><h2 id="bc08" class="mh kq hh bd kr mi mj mk kv ml mm mn kz jv mo mp lb jz mq mr ld kd ms mt lf mu bi translated">可视化:</h2><p id="1f84" class="pw-post-body-paragraph jm jn hh jo b jp lj ii jr js lk il ju jv lz jx jy jz ma kb kc kd mb kf kg kh ha bi translated">BigQuery ML不支持数据可视化，它需要looker或其他工具的支持。然而，在笔记本电脑下执行可视化要灵活得多。</p><h2 id="c701" class="mh kq hh bd kr mi mj mk kv ml mm mn kz jv mo mp lb jz mq mr ld kd ms mt lf mu bi translated">技能多样性:</h2><p id="950d" class="pw-post-body-paragraph jm jn hh jo b jp lj ii jr js lk il ju jv lz jx jy jz ma kb kc kd mb kf kg kh ha bi translated">学习SQL可能比学习编程语言简单一点。</p><pre class="ix iy iz ja fd mz na nb nc aw nd bi"><span id="90b6" class="mh kq hh na b fi ne nf l ng nh">| Aspects                   | AI Platform Notebooks | BigQuery ML |<br/>|---------------------------|-----------------------|-------------|<br/>| Data Cleaning Flexible    | high                  | low         |<br/>| Feature Engineering       | high                  | low         |<br/>| Model Diversity           | high                  | low         |<br/>| Model Creation and Saving | medium                | high        |<br/>| Basic Model Performance   | high                  | high        |<br/>| Auto Performance Tuning   | high                  | low         |<br/>| Visualizing               | high                  | low         |<br/>| Skill Diversity           | high                  | medium      |</span></pre></div><div class="ab cl ki kj go kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="ha hb hc hd he"><h1 id="ee28" class="kp kq hh bd kr ks kt ku kv kw kx ky kz in la io lb iq lc ir ld it le iu lf lg bi translated">推荐</h1><p id="c705" class="pw-post-body-paragraph jm jn hh jo b jp lj ii jr js lk il ju jv lz jx jy jz ma kb kc kd mb kf kg kh ha bi translated">基于上一节，我们可以发现查询风格ML在模型创建和保存、基本模型性能和技能多样性方面具有良好的性能。我们来讨论一下什么时候用查询风格ML，什么时候用云笔记本。</p><h2 id="cd07" class="mh kq hh bd kr mi mj mk kv ml mm mn kz jv mo mp lb jz mq mr ld kd ms mt lf mu bi translated">查询样式ML:</h2><p id="dac1" class="pw-post-body-paragraph jm jn hh jo b jp lj ii jr js lk il ju jv lz jx jy jz ma kb kc kd mb kf kg kh ha bi translated">在处理基于干净数据集的简单回归、分类和聚类时，我们可以使用查询样式ML进行初始分析。</p><h2 id="eea7" class="mh kq hh bd kr mi mj mk kv ml mm mn kz jv mo mp lb jz mq mr ld kd ms mt lf mu bi translated">云笔记本:</h2><p id="c956" class="pw-post-body-paragraph jm jn hh jo b jp lj ii jr js lk il ju jv lz jx jy jz ma kb kc kd mb kf kg kh ha bi translated">我们可以在任何时候用它来处理任何情况，比如图像分类，自然语言处理等等。</p><p id="c44b" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">就我的理解，当我需要创建一些简单的模型时，我会同时使用笔记本和查询样式ML。使用笔记本对数据和特征工程进行预处理，使用查询样式ML创建和存储模型。</p></div><div class="ab cl ki kj go kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="ha hb hc hd he"><h1 id="b109" class="kp kq hh bd kr ks kt ku kv kw kx ky kz in la io lb iq lc ir ld it le iu lf lg bi translated">参考</h1><ol class=""><li id="ef62" class="lh li hh jo b jp lj js lk jv ll jz lm kd ln kh ni lp lq lr bi translated"><a class="ae nj" href="https://www.kaggle.com/c/titanic" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/c/titanic</a></li><li id="3385" class="lh li hh jo b jp ls js lt jv lu jz lv kd lw kh ni lp lq lr bi translated"><a class="ae nj" href="https://github.com/jason-jz-zhu/Webinar_BigQueryML/blob/main/basic-notebook-for-titanic-demo.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/Jason-JZ-Zhu/Webinar _ BigQueryML/blob/main/basic-notebook-for-titanic-demo . ipynb</a></li><li id="2fbf" class="lh li hh jo b jp ls js lt jv lu jz lv kd lw kh ni lp lq lr bi translated"><a class="ae nj" href="https://cloud.google.com/bigquery-ml/docs/getting-model-metadata" rel="noopener ugc nofollow" target="_blank">https://cloud . Google . com/big query-ml/docs/getting-model-metadata</a></li></ol></div></div>    
</body>
</html>