<html>
<head>
<title>Building your first app bundle</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建您的第一个应用捆绑包</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/building-your-first-app-bundle-bbcd228bf631?source=collection_archive---------0-----------------------#2020-11-12">https://medium.com/androiddevelopers/building-your-first-app-bundle-bbcd228bf631?source=collection_archive---------0-----------------------#2020-11-12</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/78243efcf455993e6100439f3f7a559a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v7S7LKg4TlrMRlneeP224Q.jpeg"/></div></div></figure><div class=""/><div class=""><h2 id="2ca5" class="pw-subtitle-paragraph ip hr hs bd b iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg dx translated">Android应用捆绑包是Android应用的新的官方发布格式。</h2></div><blockquote class="jh ji jj"><p id="a5a5" class="jk jl jm jn b jo jp it jq jr js iw jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated"><strong class="jn ht">本文以视频形式提供，并在帖子末尾有链接。</strong></p></blockquote><p id="1e67" class="pw-post-body-paragraph jk jl hs jn b jo jp it jq jr js iw jt kh jv jw jx ki jz ka kb kj kd ke kf kg ha bi translated">通过Android应用捆绑包，我们创建了一种解锁格式，其中包括向您的用户发送较小的应用。当磁盘空间变得紧张时，较小的应用程序<em class="jm">更可能被安装</em>而<em class="jm">不太可能被卸载</em>。</p><p id="3572" class="pw-post-body-paragraph jk jl hs jn b jo jp it jq jr js iw jt kh jv jw jx ki jz ka kb kj kd ke kf kg ha bi translated">在本帖中，我们将进一步了解如何构建您的第一个应用捆绑包，如何使用Play控制台上传它，并深入了解一些配置选项。</p><blockquote class="kk"><p id="d1cf" class="kl km hs bd kn ko kp kq kr ks kt kg dx translated"><strong class="ak">开始不需要对你现有的代码库做任何改变。</strong></p></blockquote><p id="3f25" class="pw-post-body-paragraph jk jl hs jn b jo ku it jq jr kv iw jt kh kw jw jx ki kx ka kb kj ky ke kf kg ha bi translated">你需要做的就是使用命令行或Android Studio创建一个Android应用包。</p><h1 id="4ae5" class="kz la hs bd lb lc ld le lf lg lh li lj iy lk iz ll jb lm jc ln je lo jf lp lq bi translated">在命令行上构建</h1><p id="e3b8" class="pw-post-body-paragraph jk jl hs jn b jo lr it jq jr ls iw jt kh lt jw jx ki lu ka kb kj lv ke kf kg ha bi translated">在命令行上，您将像这样运行一个<code class="du lw lx ly lz b">bundle</code>任务:</p><pre class="ma mb mc md fd me lz mf mg aw mh bi"><span id="aea1" class="mi la hs lz b fi mj mk l ml mm">./gradlew bundleRelease</span></pre><p id="5eb2" class="pw-post-body-paragraph jk jl hs jn b jo jp it jq jr js iw jt kh jv jw jx ki jz ka kb kj kd ke kf kg ha bi translated">然后在应用程序的构建目录中找到这个包。默认位置是<code class="du lw lx ly lz b">app/build/outputs/bundle/release</code>。</p><p id="4e62" class="pw-post-body-paragraph jk jl hs jn b jo jp it jq jr js iw jt kh jv jw jx ki jz ka kb kj kd ke kf kg ha bi translated">这个包需要签名。使用<code class="du lw lx ly lz b">jarsigner</code>时，您可以这样签署捆绑包:</p><pre class="ma mb mc md fd me lz mf mg aw mh bi"><span id="be02" class="mi la hs lz b fi mj mk l ml mm">jarsigner -keystore $pathToKeystore app-release.aab $keyAlias</span></pre><p id="42b6" class="pw-post-body-paragraph jk jl hs jn b jo jp it jq jr js iw jt kh jv jw jx ki jz ka kb kj kd ke kf kg ha bi translated">一旦用实际值替换了变量并输入了密钥库密码，包就会被签名并准备好上传。</p><h1 id="df43" class="kz la hs bd lb lc ld le lf lg lh li lj iy lk iz ll jb lm jc ln je lo jf lp lq bi translated">在Android Studio中构建</h1><p id="72cb" class="pw-post-body-paragraph jk jl hs jn b jo lr it jq jr ls iw jt kh lt jw jx ki lu ka kb kj lv ke kf kg ha bi translated">在Android Studio中，选择“Build = &gt; Generate Signed Bundle/APK”并按照对话框进行操作。</p><p id="4882" class="pw-post-body-paragraph jk jl hs jn b jo jp it jq jr js iw jt kh jv jw jx ki jz ka kb kj kd ke kf kg ha bi translated">无论您使用命令行还是Android Studio，该过程都将为您留下一个已构建和签名的发布包，可以随时上传到Play Store。</p><h2 id="98bd" class="mi la hs bd lb mn mo mp lf mq mr ms lj kh mt mu ll ki mv mw ln kj mx my lp mz bi translated">通过播放控制台上传</h2><p id="c003" class="pw-post-body-paragraph jk jl hs jn b jo lr it jq jr ls iw jt kh lt jw jx ki lu ka kb kj lv ke kf kg ha bi translated">要将您的应用捆绑包上传到Play Store，请在所选的发布轨道上创建一个新版本。您可以将捆绑包拖放到“应用包和apk”部分，或者使用<a class="ae na" href="https://developers.google.com/android-publisher" rel="noopener ugc nofollow" target="_blank"> Google Play开发者API </a>。</p><figure class="ma mb mc md fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/d54d8368ba480b11ea734e00716bbfa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gvYVJ4ew6ebOO5KW"/></div></div><figcaption class="nb nc et er es nd ne bd b be z dx">Highlighted (green) section of Play Console for upload of App Bundles.</figcaption></figure><p id="048e" class="pw-post-body-paragraph jk jl hs jn b jo jp it jq jr js iw jt kh jv jw jx ki jz ka kb kj kd ke kf kg ha bi translated">一旦上传了捆绑包，Play Store就可以根据用户的配置优化它提供给用户设备的apk。这反过来减少了下载和安装的规模。</p><h1 id="119c" class="kz la hs bd lb lc ld le lf lg lh li lj iy lk iz ll jb lm jc ln je lo jf lp lq bi translated">探索您的Android应用捆绑包</h1><p id="3ccd" class="pw-post-body-paragraph jk jl hs jn b jo lr it jq jr ls iw jt kh lt jw jx ki lu ka kb kj lv ke kf kg ha bi translated">要查看Play Store如何将您的应用程序发送到用户的设备，您可以单击捆绑包行末尾的“详细信息”按钮。</p><figure class="ma mb mc md fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es nf"><img src="../Images/9dbf1315637cc415b9617e2ea6a6f191.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CNvrIH4zZE2VOruF"/></div></div><figcaption class="nb nc et er es nd ne bd b be z dx">Screenshot of the highlighted “Details” button</figcaption></figure><p id="fabf" class="pw-post-body-paragraph jk jl hs jn b jo jp it jq jr js iw jt kh jv jw jx ki jz ka kb kj kd ke kf kg ha bi translated">在详细信息屏幕中，您已经看到了许多关于您的应用捆绑包的信息，如版本代码、minSdk级别、目标Sdk、所需功能、权限、屏幕布局、本地化等等。</p><p id="6137" class="pw-post-body-paragraph jk jl hs jn b jo jp it jq jr js iw jt kh jv jw jx ki jz ka kb kj kd ke kf kg ha bi translated">你还可以为你的应用程序下载签名的apk，以查看Play Store向特定设备提供了什么。要导航到那里，点击“探索捆绑包”,然后打开“下载”标签。</p><p id="e604" class="pw-post-body-paragraph jk jl hs jn b jo jp it jq jr js iw jt kh jv jw jx ki jz ka kb kj kd ke kf kg ha bi translated">您可以选择一个特定的设备，也可以从“添加过滤器”选项卡中应用一个或多个过滤器。</p><figure class="ma mb mc md fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ng"><img src="../Images/48634a0ab61eb2707aa99d4c3787ed53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nfvZmnEYHxH14TtH"/></div></div><figcaption class="nb nc et er es nd ne bd b be z dx">Opened filter tab in the app bundle explorer</figcaption></figure><h1 id="813b" class="kz la hs bd lb lc ld le lf lg lh li lj iy lk iz ll jb lm jc ln je lo jf lp lq bi translated">下载应用捆绑包并在本地安装</h1><p id="25f9" class="pw-post-body-paragraph jk jl hs jn b jo lr it jq jr ls iw jt kh lt jw jx ki lu ka kb kj lv ke kf kg ha bi translated">在应用捆绑包浏览器中，在屏幕的末端，有一个“下载”按钮，它提供了一个zip文件，其中包含几个APK，这些文件是为特定设备量身定制的。</p><p id="34ad" class="pw-post-body-paragraph jk jl hs jn b jo jp it jq jr js iw jt kh jv jw jx ki jz ka kb kj kd ke kf kg ha bi translated">下载并解压缩文件后，可以使用包含目录中的“adb install — multiple *.apk”将包含的APK安装在本地仿真器或设备上。</p><p id="6c9f" class="pw-post-body-paragraph jk jl hs jn b jo jp it jq jr js iw jt kh jv jw jx ki jz ka kb kj kd ke kf kg ha bi translated">虽然这组中的每个apk都与保证正确执行您的应用程序相关，但我想指出的是，为了提供您的应用程序的核心功能，<strong class="jn ht"> base.apk </strong>必须安装在设备上。除了代码和资源，基本模块还包含合并的AndroidManifest和整个应用程序的共享依赖项。</p><p id="2a91" class="pw-post-body-paragraph jk jl hs jn b jo jp it jq jr js iw jt kh jv jw jx ki jz ka kb kj kd ke kf kg ha bi translated">每个功能模块或配置部分都提供了自己的资源，并且可以包含代码，但是基础模块将它们联系在一起。</p><h1 id="2a45" class="kz la hs bd lb lc ld le lf lg lh li lj iy lk iz ll jb lm jc ln je lo jf lp lq bi translated">禁用优化</h1><p id="251c" class="pw-post-body-paragraph jk jl hs jn b jo lr it jq jr ls iw jt kh lt jw jx ki lu ka kb kj lv ke kf kg ha bi translated">您可以在每个模块的<code class="du lw lx ly lz b">build.gradle</code>文件中禁用优化。你所要做的就是编辑<code class="du lw lx ly lz b">language</code>、<code class="du lw lx ly lz b">density</code>或<code class="du lw lx ly lz b">abi</code>属性，并将<code class="du lw lx ly lz b">enableSplit</code>设置为<code class="du lw lx ly lz b">false</code>。这将告诉构建系统它不应该优化这个特定的维度。</p><blockquote class="jh ji jj"><p id="c9e6" class="jk jl jm jn b jo jp it jq jr js iw jt ju jv jw jx jy jz ka kb kc kd ke kf kg ha bi translated"><strong class="jn ht">除非你有充分的理由，否则我建议不要接触这一部分，因为将enableSplit设置为false会显著增加应用程序在设备上的安装大小。</strong></p></blockquote><pre class="ma mb mc md fd me lz mf mg aw mh bi"><span id="eb6d" class="mi la hs lz b fi mj mk l ml mm">// This configuration specifies how an app bundle should be split<br/>// in terms of language, density and cpu architecture (abi).<br/>// The default values are true.<br/>// This means a split will be generated.</span><span id="18d2" class="mi la hs lz b fi nh mk l ml mm">bundle <strong class="lz ht">{<br/>    </strong>language <strong class="lz ht">{</strong><br/>        enableSplit = true<br/>    <strong class="lz ht">}<br/></strong>    density <strong class="lz ht">{</strong><br/>        enableSplit = true<br/>    <strong class="lz ht">}<br/></strong>    abi <strong class="lz ht">{</strong><br/>        enableSplit = true<br/>    <strong class="lz ht">}<br/>}</strong></span></pre><p id="2258" class="pw-post-body-paragraph jk jl hs jn b jo jp it jq jr js iw jt kh jv jw jx ki jz ka kb kj kd ke kf kg ha bi translated">也可能有例外，比如当你的应用程序内置了自己的语言选择器，而你想让所有潜在的语言随时可供选择。但即便如此，使用Android应用捆绑包也能让你按需加载功能。这可以用来避免预装应用程序中只有一小部分用户可能需要的部分。</p><p id="272e" class="pw-post-body-paragraph jk jl hs jn b jo jp it jq jr js iw jt kh jv jw jx ki jz ka kb kj kd ke kf kg ha bi translated">由于我们使您能够以编程的方式下载和安装功能，因此我们提供了您可以使用的非捆绑API。它是PlayCore库的一部分，在我们的现代Android开发技能系列的下一篇文章和本视频<a class="ae na" href="https://www.youtube.com/watch?v=5HriGkqNqwk" rel="noopener ugc nofollow" target="_blank">中有所涉及。</a></p><p id="d1a2" class="pw-post-body-paragraph jk jl hs jn b jo jp it jq jr js iw jt kh jv jw jx ki jz ka kb kj kd ke kf kg ha bi translated">捆绑愉快！</p><h2 id="c817" class="mi la hs bd lb mn mo mp lf mq mr ms lj kh mt mu ll ki mv mw ln kj mx my lp mz bi translated">这是这篇文章的视频版本</h2><figure class="ma mb mc md fd hj"><div class="bz dy l di"><div class="ni nj l"/></div></figure></div></div>    
</body>
</html>