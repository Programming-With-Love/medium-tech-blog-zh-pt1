<html>
<head>
<title>Making a difference with Mendix</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与Mendix一起创造不同</h1>
<blockquote>原文：<a href="https://medium.com/mendix/making-a-difference-with-mendix-33e581adced7?source=collection_archive---------3-----------------------#2020-03-23">https://medium.com/mendix/making-a-difference-with-mendix-33e581adced7?source=collection_archive---------3-----------------------#2020-03-23</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/9fa9101438595c0980383330f9014cd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JdS8Z-MvLQPF4MayHrkihg.png"/></div></div></figure><p id="7c54" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">我最近向Mendix应用商店发布了模块<a class="ae jz" href="https://appstore.mendix.com/link/app/113326/" rel="noopener ugc nofollow" target="_blank"> Diff </a>。它允许您获取两段文本，并返回它们之间的差异列表。</p><p id="0fec" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">该模块附带了一个名为<code class="eh ka kb kc kd b">Diff_PrettyHTML</code>的Java动作，它接受两个字符串并返回一些突出显示差异的HTML。这是一个简单的过程，所以我想向您展示如何在Mendix中使用底层的<code class="eh ka kb kc kd b">Diff_Semantic </code> Java操作来实现这一点。</p><p id="8816" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">Diff_Semantic接受两个字符串，并返回包含差异的Diff实体列表。这是一个简单的实体，它包含操作(类型为<code class="eh ka kb kc kd b">ENUM_Operation </code>，可以是插入、删除或等于)，以及一个文本字符串。</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div class="fe ff ke"><img src="../Images/7f6340ba1a5b0ec359cd974c3d08164d.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*kat2j5-_LJ77Pz7uls9fnQ.png"/></div><figcaption class="kj kk fg fe ff kl km bd b be z ek">The Diff entity</figcaption></figure><p id="ac9d" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">为了构建我们的HTML生成微流，我们首先需要创建它。姑且称之为<code class="eh ka kb kc kd b">SUB_PrettyHTML</code>。</p><p id="fd66" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">我们知道这个微流需要将Diff实体的列表作为输入参数，所以我们可以称之为<code class="eh ka kb kc kd b">$DiffList</code>。我们还知道它需要返回一个HTML字符串。我们可以把这个字符串叫做<code class="eh ka kb kc kd b">$vHTML</code>，它将只是一个空白开始。</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kn"><img src="../Images/b26c364a38c81b12bc183c1eb019a8d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y0SLku9ERyK7d0aAEOVRDA.png"/></div></div><figcaption class="kj kk fg fe ff kl km bd b be z ek">Step 1</figcaption></figure><p id="daa2" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">接下来，我们需要迭代<code class="eh ka kb kc kd b">$DiffList</code>,看看实际上有什么不同。</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ko"><img src="../Images/049e72c8c08bfdb66eaccaf089bf7e7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P_05u6q8-lrIifLMNU3usA.png"/></div></div><figcaption class="kj kk fg fe ff kl km bd b be z ek">Step 2</figcaption></figure><p id="8146" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">在循环中，<code class="eh ka kb kc kd b">$IteratorDiff</code>将是我们当前正在处理的Diff的实例。</p><p id="0b85" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">我们需要看看这个Diff中的操作是什么，并相应地修改<code class="eh ka kb kc kd b">$vHTML </code>。如果是删除，我们需要用一个<code class="eh ka kb kc kd b">&lt;del&gt;</code>标签将文本包装起来，并将其添加到<code class="eh ka kb kc kd b">$vHTML</code>的末尾。如果是插页，我们用一个<code class="eh ka kb kc kd b">&lt;ins&gt;</code>标签将文本包装起来，并将其添加到<code class="eh ka kb kc kd b">$vHTML</code>。最后，如果是其他内容，我们只需用一个<code class="eh ka kb kc kd b">&lt;span&gt;</code>标签包装文本，并将其添加到<code class="eh ka kb kc kd b">$vHTML</code>。</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kp"><img src="../Images/35c92409f84313b468b57863975b31d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ci_MbEotS395cW09NYzP0g.png"/></div></div><figcaption class="kj kk fg fe ff kl km bd b be z ek">Step 3</figcaption></figure><p id="fdcf" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">“删除变更变量”操作如下所示。</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kq"><img src="../Images/143197ec96f010b3b9549448d20267e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VsTXuhg-XiBH_QvWQc-JOg.png"/></div></div><figcaption class="kj kk fg fe ff kl km bd b be z ek">Adding the DELETE to vHTML</figcaption></figure><p id="bdab" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">我们也添加了红色的背景色，但是如果你想要一个干净的代码，这可以很容易地添加到你的CSS中。我们为INSERT做了类似的事情，但是把它变成了绿色。</p><p id="25de" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">由于输出的是HTML，我们需要确保输入的文本不包含任何HTML标签。我们可以使用Community Commons模块中的EscapeHTML操作来避免这种情况。我们也可以把<code class="eh ka kb kc kd b">&amp;</code>变成<code class="eh ka kb kc kd b">&amp;amp;</code>、<code class="eh ka kb kc kd b">&lt;</code>变成<code class="eh ka kb kc kd b">&amp;lt;</code>、<code class="eh ka kb kc kd b">&gt;</code>变成<code class="eh ka kb kc kd b">&amp;gt;</code>，换行符变成<code class="eh ka kb kc kd b">&lt;br&gt;</code>来滚动自己的。这可以使用<code class="eh ka kb kc kd b">replaceAll</code>来完成。</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff kr"><img src="../Images/8772d53e706f2f68ab97bc5395702e06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ireeoqrbA3-u-jZYbuTebA.png"/></div></div><figcaption class="kj kk fg fe ff kl km bd b be z ek">Escaping any &amp; we find in the Text</figcaption></figure><p id="bfb2" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">我们逃跑的顺序很重要，因为我们不想逃跑。应该是<code class="eh ka kb kc kd b">&amp;</code>、<code class="eh ka kb kc kd b">&lt;</code>、<code class="eh ka kb kc kd b">&gt;</code>，然后换行。最终的微流应该是这样的。</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ks"><img src="../Images/0a74a4acadc5e862725b0111978ff8b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yVC517GMZwy5U9T63I0dbA.png"/></div></div></figure><h1 id="4601" class="kt ku hu bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq dt translated">测试我们的微流</h1><p id="5a22" class="pw-post-body-paragraph jc jd hu bd b je lr jg jh ji ls jk jl jm lt jo jp jq lu js jt ju lv jw jx jy hn dt translated">我们想看看我们的微流是否可行。为此，我们可以构建一个简单的测试页面来获取两个字符串，并在按钮被按下时显示它们之间的差异。</p><p id="9b15" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">首先，我们创建一个实体来保存原始文本、新文本和我们生成的diff HTML。我们称这个实体为DiffHTML。</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div class="fe ff lw"><img src="../Images/2583c2d44cb6b4b873880710359f89c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*seJrWbf0ZHp8doBp1pUkKw.png"/></div></figure><p id="848f" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">我们的页面可以获取一个DiffHTML实例，并使用Mendix应用商店中的<a class="ae jz" href="https://appstore.mendix.com/link/app/264/" rel="noopener ugc nofollow" target="_blank">格式字符串小部件</a>在屏幕上呈现生成的HTML。</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lx"><img src="../Images/0b2494a6e917702b95a9af7a0ed9670f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d4pEfhHdDnkgz2KS-nLtgg.png"/></div></div></figure><p id="1f18" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">我们运行difference的微流需要在两段文本上运行<code class="eh ka kb kc kd b">Diff_Semantic</code>，将它传递给我们新的<code class="eh ka kb kc kd b">SUB_PrettyHTML</code>微流，更新DiffHTML实例，最后显示页面。</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ly"><img src="../Images/d557adea139dc221527f7532cb7a2525.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U6GekdzQTmvZhN67hr6pdQ.png"/></div></div></figure><p id="54f5" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">运行应用程序并添加一些示例文本，我们的最终输出如下所示。</p><figure class="kf kg kh ki fq iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff lz"><img src="../Images/f3e0fccae22698816cf96cae8fa9e52a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wuyHGpKh3zv5YChgDpKv9A.png"/></div></div><figcaption class="kj kk fg fe ff kl km bd b be z ek">The output from our test</figcaption></figure><p id="8249" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">我们可以看到，删除的文本以红色突出显示并加了下划线，而更改的文本以绿色突出显示并加了下划线。未更改的文本保持中立。</p><h1 id="e77c" class="kt ku hu bd kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq dt translated">结论</h1><p id="04a5" class="pw-post-body-paragraph jc jd hu bd b je lr jg jh ji ls jk jl jm lt jo jp jq lu js jt ju lv jw jx jy hn dt translated">在本文中，我们已经看到了如何在Diff模块中使用<code class="eh ka kb kc kd b">Diff_Semantic</code> Java动作来重新创建微流中的<code class="eh ka kb kc kd b">Diff_PrettyHTML</code>动作。我们已经看到了三种不同，并用它们来突出两段文字之间的变化。</p></div></div>    
</body>
</html>