<html>
<head>
<title>Using leanback’s DiffCallback</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用leanback的DiffCallback</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/using-leanbacks-diffcallback-77d47949212b?source=collection_archive---------6-----------------------#2017-12-15">https://medium.com/androiddevelopers/using-leanbacks-diffcallback-77d47949212b?source=collection_archive---------6-----------------------#2017-12-15</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="9f57" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">不同回调之间的区别</h2></div><p id="cf17" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在支持库的<a class="ae jw" href="https://developer.android.com/topic/libraries/support-library/rev-archive.html#24-2-0-api-updates" rel="noopener ugc nofollow" target="_blank">版本24.2中引入了一个名为<code class="du js jt ju jv b"><a class="ae jw" href="https://developer.android.com/reference/android/support/v7/util/DiffUtil.html" rel="noopener ugc nofollow" target="_blank">DiffUtil</a> </code>的类，它使得更新一个<code class="du js jt ju jv b"><a class="ae jw" href="https://developer.android.com/reference/android/support/v7/widget/RecyclerView.Adapter.html" rel="noopener ugc nofollow" target="_blank">RecyclerView.Adapter</a></code>变得很简单。在向后倾斜支持库</a>的<a class="ae jw" href="https://developer.android.com/topic/libraries/support-library/revisions.html#27-0-0" rel="noopener ugc nofollow" target="_blank">版本27.0中，添加了一个支持<code class="du js jt ju jv b"><a class="ae jw" href="https://developer.android.com/reference/android/support/v17/leanback/widget/ArrayObjectAdapter.html" rel="noopener ugc nofollow" target="_blank">ArrayObjectAdapter</a></code>的<code class="du js jt ju jv b">DiffUtil</code>抽象。</a></p><p id="7c86" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><code class="du js jt ju jv b"><a class="ae jw" href="https://developer.android.com/reference/android/support/v17/leanback/widget/ArrayObjectAdapter.html" rel="noopener ugc nofollow" target="_blank">ArrayObjectAdapter</a></code>有一个叫做<code class="du js jt ju jv b"><a class="ae jw" href="https://developer.android.com/reference/android/support/v17/leanback/widget/ArrayObjectAdapter.html#setItems(java.util.List,%20android.support.v17.leanback.widget.DiffCallback)" rel="noopener ugc nofollow" target="_blank">setItems(final List itemList, final DiffCallback callback)</a></code>的新方法，它接受一个叫做<code class="du js jt ju jv b"><a class="ae jw" href="https://developer.android.com/reference/android/support/v17/leanback/widget/DiffCallback.html" rel="noopener ugc nofollow" target="_blank">DiffCallback</a></code>的新类。<code class="du js jt ju jv b">DiffCallback</code>看起来像<code class="du js jt ju jv b"><a class="ae jw" href="https://developer.android.com/reference/android/support/v7/util/DiffUtil.Callback.html" rel="noopener ugc nofollow" target="_blank">DiffUtil.Callback</a></code>，缺少了一些方法。</p><figure class="jx jy jz ka fd kb"><div class="bz dy l di"><div class="kc kd l"/></div></figure><p id="990b" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">列表大小方法消失了！适配器中的<code class="du js jt ju jv b">setItems()</code>方法知道旧项和新项。当适配器创建<code class="du js jt ju jv b">DiffUtil.Callback</code>时，它会覆盖<code class="du js jt ju jv b"><a class="ae jw" href="https://developer.android.com/reference/android/support/v7/util/DiffUtil.Callback.html#getOldListSize()" rel="noopener ugc nofollow" target="_blank">getOldListSize()</a></code>和<code class="du js jt ju jv b"><a class="ae jw" href="https://developer.android.com/reference/android/support/v7/util/DiffUtil.Callback.html#getNewListSize()" rel="noopener ugc nofollow" target="_blank">getNewListSize()</a></code>，让您可以专注于比较列表中的项目。</p><pre class="jx jy jz ka fd ke jv kf kg aw kh bi"><span id="795d" class="ki kj hh jv b fi kk kl l km kn">val diffCallback = object : DiffCallback&lt;DummyItem&gt;() {<br/>    override fun areItemsTheSame(oldItem: DummyItem, <br/>                                 newItem: DummyItem): Boolean = <br/>        oldItem.id == newItem.id</span><span id="0c11" class="ki kj hh jv b fi ko kl l km kn">    override fun areContentsTheSame(oldItem: DummyItem, <br/>                                    newItem: DummyItem): Boolean =<br/>        oldItem == newItem<br/>}</span><span id="0264" class="ki kj hh jv b fi ko kl l km kn">itemsAdapter.setItems(randomItems(), diffCallback)</span></pre><p id="3aa1" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">适配器更新项目并调度动画。</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es kp"><img src="../Images/94bd15f631824ec1f9b6ebe0d7ce373b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*3MLrzRJAXtHBQeO4KA0TRA.gif"/></div></div><figcaption class="kw kx et er es ky kz bd b be z dx">ArrayObjectAdapter will dispatch the appropriate animations</figcaption></figure><p id="a4e4" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">你不必用一个<code class="du js jt ju jv b">DiffCallback</code>来称呼<code class="du js jt ju jv b">setItems()</code>。如果您不提供<code class="du js jt ju jv b">DiffCallback</code>，适配器会清除当前项目并添加所有新项目，这可能会导致您的内容在屏幕上闪烁。</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es la"><img src="../Images/292ff5df72892dd5248634a40da00f82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*HAKJdXzrZVRvcIuQ-J2-eQ.gif"/></div></div><figcaption class="kw kx et er es ky kz bd b be z dx">The content in the row jumps as items are removed and added</figcaption></figure><p id="ac4a" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">查看<code class="du js jt ju jv b">setItems()</code>的源代码，我们可以看到<code class="du js jt ju jv b">ArrayObjectAdapter</code>是如何从<code class="du js jt ju jv b">DiffUtil</code>中抽象出样板文件的——给开发者一个更干净的API。</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div role="button" tabindex="0" class="kq kr di ks bf kt"><div class="er es lb"><img src="../Images/c04157efad1eb51474a0c92fb6cb42e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1AIJuAbtOBUPxUT0_ib8Eg.png"/></div></div><figcaption class="kw kx et er es ky kz bd b be z dx">Part of the source code for <code class="du js jt ju jv b">setItems()</code> in ArrayObjectAdapter</figcaption></figure><p id="6361" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你想尝试一下<code class="du js jt ju jv b">DiffCallback</code>，看看这个<a class="ae jw" href="https://gist.github.com/benbaxter/6c9fbb568d05d8cb4b3829dbdb23e0cb" rel="noopener ugc nofollow" target="_blank">要点</a>就可以开始了。</p><p id="4b19" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你正在开发Android TV的应用程序，我很想知道你喜欢什么，你的痛点是什么。如果您想继续讨论，请在<a class="ae jw" href="https://twitter.com/benjamintravels" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上给我留言。</p></div></div>    
</body>
</html>