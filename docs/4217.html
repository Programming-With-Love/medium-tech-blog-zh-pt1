<html>
<head>
<title>CodeLab — Connect Actions on Google with BigQuery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CodeLab——用BigQuery连接Google上的操作</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/codelab-connect-actions-on-google-with-bigquery-db0d1933f467?source=collection_archive---------0-----------------------#2018-12-22">https://medium.com/google-developer-experts/codelab-connect-actions-on-google-with-bigquery-db0d1933f467?source=collection_archive---------0-----------------------#2018-12-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/c60b270ac8e9200e8cc2b059daff072f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bJR4mYIjCrKtjD07KHS-Dw.jpeg"/></div></div></figure><p id="232d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最近我创建了一个新的codelab，教授如何用BigQuery连接AoG，我认为在这里发布它会很好。</p><p id="51b8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">但是为什么我需要将AoG连接到BigQuery呢？</p><p id="ea6e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果说在房地产领域，一切都是为了“位置、位置、位置”，那么我的数字产品就是为了“数据、数据、数据”。如果您计划收集和分析大量数据，您可能应该使用BigQuery来完成这项工作。</p><p id="021e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这个codelab中，我将展示如何收集我们从操作中获得的基本可用数据，以及如何创建一个有助于读取数据的仪表板。</p><p id="8b36" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">享受实验室</p></div><div class="ab cl jn jo go jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ha hb hc hd he"><h1 id="7d44" class="ju jv hh bd jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr bi translated">1.概观</h1><p id="8a5e" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">谷歌上的行动是一个开发者平台，让你可以创建软件来扩展谷歌虚拟个人助理<a class="ae kx" href="https://assistant.google.com/" rel="noopener ugc nofollow" target="_blank">的功能，跨越5亿多种设备，包括智能扬声器、电话、汽车、电视、耳机等。</a></p><p id="59a0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">用户在对话中使用谷歌助手来完成事情，比如购买食品杂货或预定行程(关于现在可能的完整列表，请参见<a class="ae kx" href="https://assistant.google.com/explore/" rel="noopener ugc nofollow" target="_blank">行动目录</a>)。)作为开发人员，您可以使用Google上的操作来轻松创建和管理用户与您自己的第三方服务之间愉快而有效的对话体验。</p><p id="9efe" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">该平台提供基本的分析工具，如活跃用户和中止率。作为开发人员，您可能希望对报告有更多的控制，并创建自己的包含操作数据的分析报告。在这个codelab中，你将学习如何将你的动作的所有活动日志存储到BigQuery中，以便对其进行分析。</p><p id="301c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">此codelab模块是多模块教程的一部分。每个模块可以单独学习，也可以与其他模块一起学习。在每个模块中，您将获得如何根据给定的软件需求构建操作的端到端指导。我们还将教授实现动作的必要概念和最佳实践，为用户提供高质量的对话体验。</p><p id="34c9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这个codelab涵盖了使用Google上的动作进行开发的中级概念。我们强烈建议您在开始本代码实验室之前，熟悉<a class="ae kx" href="https://codelabs.developers.google.com/codelabs/actions-1/index.html" rel="noopener ugc nofollow" target="_blank">Google Assistant(Level 1)</a>的构建操作和<a class="ae kx" href="https://codelabs.developers.google.com/codelabs/actions-2/index.html" rel="noopener ugc nofollow" target="_blank">Google Assistant(Level 2)</a>的构建操作中涵盖的主题。</p><h1 id="11a5" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">你将建造什么</h1><p id="8a74" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">在这个codelab中，您将构建一个使用BigQuery记录数据复杂对话操作。</p><h1 id="9ed1" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">你会学到什么</h1><ul class=""><li id="2e5c" class="ld le hh ir b is ks iw kt ja lf je lg ji lh jm li lj lk ll bi translated">如何在bigQuery上创建DB表？</li><li id="98f6" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm li lj lk ll bi translated">如何将数据从动作加载到BigQuery。</li></ul><h1 id="9eb3" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">你需要什么</h1><p id="aad1" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">您的环境中必须有以下工具:</p><ul class=""><li id="f589" class="ld le hh ir b is it iw ix ja lr je ls ji lt jm li lj lk ll bi translated">您选择的IDE/文本编辑器，如<a class="ae kx" href="https://www.jetbrains.com/webstorm" rel="noopener ugc nofollow" target="_blank"> WebStorm </a>、<a class="ae kx" href="https://atom.io/" rel="noopener ugc nofollow" target="_blank"> Atom </a>或<a class="ae kx" href="https://www.sublimetext.com/" rel="noopener ugc nofollow" target="_blank"> Sublime </a>。</li><li id="3fa0" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm li lj lk ll bi translated">安装了NodeJS、npm和git的运行shell命令的终端。</li><li id="c57e" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm li lj lk ll bi translated">一个网络浏览器，比如<a class="ae kx" href="https://www.google.com/chrome/" rel="noopener ugc nofollow" target="_blank"> Chrome </a>。</li><li id="2063" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm li lj lk ll bi translated">关于<a class="ae kx" href="https://github.com/" rel="noopener ugc nofollow" target="_blank">GitHub.com的一个记述。</a>(可以免费创建一个。)</li><li id="b2f9" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm li lj lk ll bi translated">强烈建议您熟悉JavaScript  (ES6 ),尽管不是必需的，以理解本代码实验室中使用的webhook代码。</li></ul><h1 id="16f9" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">2.这项技术</h1><h1 id="2858" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">BigQuery</h1><p id="cfb6" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">BigQuery是谷歌针对超大型数据集的数据分析服务。它有一个RESTful API，支持用SQL编写的查询。如果您有带纬度和经度值的数据，它们可用于按位置查询您的数据。其优势在于，您可以直观地探索非常大的数据集来查看模式，而无需管理任何服务器或数据库基础架构。使用BigQuery强大的可伸缩性和托管基础设施，无论您的表有多大，您都可以在几秒钟内获得问题的答案。</p><h1 id="a2d8" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">3.为当地发展而设立</h1><p id="c69e" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">在<a class="ae kx" href="https://codelabs.developers.google.com/codelabs/actions-2/index.html" rel="noopener ugc nofollow" target="_blank">为Google Assistant (Level 2) </a>构建行动中，您使用了Dialogflow和fulfillment来快速启动您的第一个行动项目。</p><p id="6edf" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">对于这个代码实验室，您将从2级代码实验室的操作开始。</p><p id="37d9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您已经完成了Google Assistant(Level 2)codelab的<a class="ae kx" href="https://codelabs.developers.google.com/codelabs/actions-2/index.html" rel="noopener ugc nofollow" target="_blank">构建操作，请转到下一步。</a></p><p id="b4e1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您是从零开始，请执行以下操作:</p><h1 id="8426" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">下载您的基本文件</h1><p id="08f0" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">要获得这个codelab的基本文件，运行以下命令来克隆2级codelab的GitHub存储库。</p><p id="4004" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">git克隆<a class="ae kx" href="https://github.com/actions-on-google/codelabs-nodejs" rel="noopener ugc nofollow" target="_blank">https://github.com/actions-on-google/codelabs-nodejs</a></p><p id="2d08" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">该存储库包含以下重要文件:</p><ul class=""><li id="926f" class="ld le hh ir b is it iw ix ja lr je ls ji lt jm li lj lk ll bi translated">level 2-complete/functions/index . js。包含您的webhook实现代码的Javascript文件。这是您将要编辑的主文件，以便添加附加的操作和功能。</li><li id="93dc" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm li lj lk ll bi translated">level 2-complete/functions/package . JSON<em class="lu">。</em>该文件概述了Node.js项目的依赖关系和其他元数据。对于此codelab，您可以忽略此文件；如果您想在Google client library或其他Node.js模块上使用不同版本的操作，您应该只需要编辑这个文件。</li><li id="76fb" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm li lj lk ll bi translated">Level 2-complete/code lab-Level-two . zip。这是Level 2 codelab的代理文件。如果您已经完成了1级和2级代码实验室，您可以放心地忽略此文件。</li><li id="9cc5" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm li lj lk ll bi translated">为了清楚起见，将/level2-complete目录名重命名为/level4。您可以在终端中使用mv命令来实现这一点。例如:</li></ul><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="6fb3" class="me jv hh ma b fi mf mg l mh mi">$ cd codelabs-nodejs<br/>$ mv ./level2-complete ./level4</span></pre><h1 id="0b13" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">设置您的项目和代理</h1><p id="83f3" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">接下来，您需要为codelab设置Actions项目和Dialogflow代理。</p><ol class=""><li id="067c" class="ld le hh ir b is it iw ix ja lr je ls ji lt jm mj lj lk ll bi translated">打开<a class="ae kx" href="https://console.actions.google.com/" rel="noopener ugc nofollow" target="_blank">动作控制台</a>。</li><li id="12d4" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">点击<strong class="ir hi">添加/导入项目</strong>。</li><li id="3989" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">键入一个<strong class="ir hi">项目名</strong>，比如“actions-codelab-4”。此名称供您自己内部参考；稍后，您可以为项目设置一个外部名称。</li><li id="9af2" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">点击<strong class="ir hi">创建项目</strong>。</li><li id="a996" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">与其挑选类别，不如点击右上角的<strong class="ir hi">跳过</strong>。</li><li id="62aa" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">点击<strong class="ir hi">构建您的操作</strong>，然后点击<strong class="ir hi">添加操作</strong></li><li id="e094" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">单击添加您的第一个操作。</li><li id="8a26" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">在<strong class="ir hi">创建动作</strong>对话框中，选择<strong class="ir hi">自定义意图</strong>，然后点击<strong class="ir hi">构建</strong>启动Dialogflow控制台。</li><li id="fe07" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">在Dialogflow控制台的<strong class="ir hi">创建代理</strong>页面中，点击<strong class="ir hi">创建</strong>。</li><li id="1cd6" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">单击左侧导航栏上的齿轮图标。</li><li id="f946" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">点击<strong class="ir hi">导出和导入</strong>。</li><li id="f9f3" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">点击<strong class="ir hi">从Zip文件中恢复</strong>。</li></ol><figure class="lv lw lx ly fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mk"><img src="../Images/1fdb146c141b9bbaff464402c0727e47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dGZPEMWslxU7ho5I"/></div></div></figure><ol class=""><li id="8cf0" class="ld le hh ir b is it iw ix ja lr je ls ji lt jm mj lj lk ll bi translated">从您之前创建的/level4目录中上传codelab-level-two.zip文件。</li><li id="354b" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">输入“恢复”并点击<strong class="ir hi">恢复</strong>按钮。</li><li id="ec3a" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">点击<strong class="ir hi">完成</strong>。</li></ol><h1 id="d0b5" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">部署您的履行</h1><p id="d863" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">现在，您的操作项目和Dialogflow代理已经准备就绪，请执行以下操作，使用Firebase Functions CLI部署您的本地index.js文件:</p><ol class=""><li id="21e6" class="ld le hh ir b is it iw ix ja lr je ls ji lt jm mj lj lk ll bi translated">在终端中，导航到基本文件克隆的/level4/functions目录。</li><li id="b16c" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">使用您设置的操作项目ID，运行以下命令:</li></ol><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="b8eb" class="me jv hh ma b fi mf mg l mh mi">firebase use &lt;PROJECT_ID&gt;</span></pre><blockquote class="ml mm mn"><p id="201a" class="ip iq lu ir b is it iu iv iw ix iy iz mo jb jc jd mp jf jg jh mq jj jk jl jm ha bi translated">提示:您的动作的项目ID可以在动作控制台中的概述&gt;(齿轮图标) &gt;项目设置下找到。</p></blockquote><figure class="lv lw lx ly fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mr"><img src="../Images/9fa7e0a95dd5f63baf87be24c64562c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Z1VaA4j1Oaeob9_g"/></div></div></figure><p id="301e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在终端中运行以下命令来安装依赖项。</p><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="ff53" class="me jv hh ma b fi mf mg l mh mi">npm install</span></pre><p id="f65e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在终端中运行以下命令，将webhook部署到Firebase。</p><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="6c76" class="me jv hh ma b fi mf mg l mh mi">firebase deploy</span></pre><blockquote class="ml mm mn"><p id="fb1d" class="ip iq lu ir b is it iu iv iw ix iy iz mo jb jc jd mp jf jg jh mq jj jk jl jm ha bi translated">提示:如果您看到一条错误消息，上面写着“发生了意外错误”，尝试再次运行firebase deploy命令。</p></blockquote><p id="7a16" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">几分钟后，您应该看到“部署完成！”表明您已经成功地将webhook部署到Firebase。</p><h1 id="b733" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">检索部署URL</h1><p id="5bdf" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">您需要向Dialogflow提供云函数的URL。要检索此URL，请按照下列步骤操作:</p><ol class=""><li id="9341" class="ld le hh ir b is it iw ix ja lr je ls ji lt jm mj lj lk ll bi translated">打开<a class="ae kx" href="https://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank">火焰基座控制台</a>。</li><li id="ed30" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">从选项列表中选择您的操作项目。</li><li id="7855" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">导航到左侧导航栏上的<strong class="ir hi">开发&gt;功能</strong>。如果提示您“选择数据共享设置”，您可以通过点击<strong class="ir hi">稍后再做</strong>忽略此选项。</li><li id="88ca" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">在<strong class="ir hi">仪表板</strong>选项卡下，您应该会看到一个“dialogflowfirbaseflementation”条目，其URL位于<strong class="ir hi">触发器</strong>下。复制此URL。</li></ol><figure class="lv lw lx ly fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ms"><img src="../Images/0b1f4dd8cbf00ceb26546d0a36f96a2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hh_EXgK1cKC9vMEp"/></div></div></figure><h1 id="417c" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">在Dialogflow中设置URL</h1><p id="6d7b" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">现在，您需要更新您的Dialogflow代理，以使用您的webhook来实现。为此，请按照下列步骤操作:</p><ol class=""><li id="6e2c" class="ld le hh ir b is it iw ix ja lr je ls ji lt jm mj lj lk ll bi translated">打开<a class="ae kx" href="https://console.dialogflow.com/" rel="noopener ugc nofollow" target="_blank"> Dialogflow控制台</a>(如果您愿意，可以关闭Firebase控制台)。</li><li id="94ec" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">导航至左侧导航栏上的<strong class="ir hi">完成</strong>。</li><li id="0c18" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">启用<strong class="ir hi"> Webhook </strong>。</li><li id="7bdd" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">如果您从Firebase仪表板复制的URL尚未出现，请粘贴它。</li><li id="80b5" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">点击<strong class="ir hi">保存</strong>。</li></ol><figure class="lv lw lx ly fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mt"><img src="../Images/a3394c1f43eba4a8cec4158614b79275.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*oqyZYqknnnENsjNK"/></div></div></figure><h1 id="39c9" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">验证您的项目设置是否正确</h1><p id="5ef9" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">此时，用户可以通过显式调用您的操作来开始对话。一旦用户在交谈中，他们可以通过提供一种颜色来触发“最喜欢的颜色”的自定义意图。Dialogflow将解析用户的输入，以提取您的履行所需的信息，即颜色，并将其发送到您的履行。然后，您的订单会自动生成一个幸运数字发送给用户。</p><blockquote class="ml mm mn"><p id="af3f" class="ip iq lu ir b is it iu iv iw ix iy iz mo jb jc jd mp jf jg jh mq jj jk jl jm ha bi translated">提示:您可以在本<a class="ae kx" href="https://developers.google.com/actions/tools/simulator" rel="noopener ugc nofollow" target="_blank">指南</a>中找到关于使用动作控制台模拟器的最新信息。如果您在下面列出的步骤中遇到任何问题，请参考那里。</p></blockquote><p id="e438" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要在动作控制台模拟器中测试您的动作:</p><ol class=""><li id="869b" class="ld le hh ir b is it iw ix ja lr je ls ji lt jm mj lj lk ll bi translated">在Dialogflow控制台左侧导航中，点击<strong class="ir hi">集成&gt;谷歌助手</strong>。</li><li id="4971" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">确保<strong class="ir hi">自动预览更改</strong>已启用，并点击<strong class="ir hi">测试</strong>以更新您的行动项目。</li><li id="1551" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">动作控制台模拟器加载您的动作项目。要测试您的操作，请在<strong class="ir hi">输入</strong>字段中键入“与我的测试应用对话”,然后点击enter。</li><li id="ccc1" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">你应该会看到这样的回复:“你好，为了更好地了解你，我需要从谷歌上得到你的名字。这样可以吗？”</li><li id="07cd" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">键入“否”。</li><li id="e354" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">您应该会看到一个响应:“好的，不用担心。你最喜欢什么颜色？”</li><li id="0150" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">键入“蓝色”。</li><li id="ace0" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">你应该会看到一个回应:“你的幸运数字是4。”</li></ol><blockquote class="ml mm mn"><p id="a7f7" class="ip iq lu ir b is it iu iv iw ix iy iz mo jb jc jd mp jf jg jh mq jj jk jl jm ha bi translated">如果您看不到此响应，可能是您的Firebase设置有问题。在这种情况下，请尝试重复“部署您的实施”部分下的步骤。</p></blockquote><h1 id="4ed7" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">4.设置BigQuery</h1><p id="646f" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">登录谷歌云平台控制台(<a class="ae kx" href="http://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">console.cloud.google.com</a>)，选择行动项目。在屏幕的顶部，有一个项目下拉菜单:</p><figure class="lv lw lx ly fd ii er es paragraph-image"><div class="er es mu"><img src="../Images/6dc355303a5a576bb17d833fa1c931ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/0*3RkK4F_a-x-AgETF"/></div></figure><h1 id="1076" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">启用计费</h1><p id="53a6" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">必须对此项目启用计费。一旦启用了计费，您就可以启用BigQuery API了。</p><blockquote class="ml mm mn"><p id="757e" class="ip iq lu ir b is it iu iv iw ix iy iz mo jb jc jd mp jf jg jh mq jj jk jl jm ha bi translated">注意:在这个codelab中运行的查询不应该收费，但是如果您超过了<a class="ae kx" href="https://cloud.google.com/bigquery/pricing" rel="noopener ugc nofollow" target="_blank"> BigQuery免费等级</a>(每月1TB的数据查询)，您可能会产生费用。</p></blockquote><p id="b84c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如何启用计费取决于您是在创建新项目还是在为现有项目重新启用计费。</p><p id="61a8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">谷歌提供价值高达300美元的12个月免费试用谷歌云平台，你可以在https://cloud.google.com/free/<a class="ae kx" href="https://cloud.google.com/free/" rel="noopener ugc nofollow" target="_blank">了解更多细节。</a></p><h1 id="f490" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">新项目</h1><p id="6582" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">创建新项目时，系统会提示您选择要链接到项目的付费帐户。如果您只有一个帐单帐户，该帐户会自动链接到您的项目。</p><p id="a8a6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您没有计费帐户，您必须创建一个帐户并为您的项目启用计费，然后才能使用许多Google Cloud Platform功能。要创建新的计费账户并为您的项目启用计费，请遵循<a class="ae kx" href="https://support.google.com/cloud/answer/6288653#new-billing" rel="noopener ugc nofollow" target="_blank">创建新的计费账户</a>中的说明。</p><h1 id="88d7" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">现有项目</h1><p id="ff83" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">如果您有一个临时禁用开单的项目，您可以重新启用开单:</p><ol class=""><li id="27ee" class="ld le hh ir b is it iw ix ja lr je ls ji lt jm mj lj lk ll bi translated">转到<a class="ae kx" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">云平台控制台</a>。</li><li id="1792" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">从项目列表中，选择要重新启用计费的项目。</li><li id="9e8f" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">打开控制台左侧菜单，选择计费。系统会提示您选择一个计费帐户。</li><li id="e271" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">点击<strong class="ir hi">设置账户</strong>。</li></ol><h1 id="97ff" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">创建新的账单账户</h1><p id="a688" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">要创建新的计费帐户:</p><ol class=""><li id="1b95" class="ld le hh ir b is it iw ix ja lr je ls ji lt jm mj lj lk ll bi translated">转到<a class="ae kx" href="https://console.cloud.google.com/" rel="noopener ugc nofollow" target="_blank">云平台控制台</a>并登录，如果您还没有帐户，请注册。</li><li id="7c7d" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">打开控制台左侧菜单，选择<strong class="ir hi">计费</strong></li><li id="20d8" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">点击<strong class="ir hi">新建计费账户</strong>按钮。(请注意，如果这不是您的第一个帐单帐户，首先您需要打开帐单帐户列表，方法是单击页面顶部附近现有帐单帐户的名称，然后单击管理帐单帐户。)</li><li id="935e" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">输入帐单帐户的名称，并输入您的帐单信息。您看到的选项取决于您的帐单邮寄地址所在的国家。请注意，对于美国帐户，您不能在创建帐户后更改纳税状态。</li><li id="e407" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm mj lj lk ll bi translated">点击<strong class="ir hi">提交</strong>和<strong class="ir hi">启用计费</strong>。</li></ol><p id="6ce4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">默认情况下，创建计费帐户的人是该帐户的计费管理员。</p><p id="9566" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">有关验证银行账户和添加备用支付方式的信息，请参见<a class="ae kx" href="https://support.google.com/cloud/answer/6293589" rel="noopener ugc nofollow" target="_blank">添加、删除或更新支付方式</a>。</p><h1 id="23ef" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">启用BigQuery API</h1><p id="4f96" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">打开谷歌云控制台，点击左侧菜单中的<strong class="ir hi"> API管理器</strong>项。您可能需要点击左上方的三线图标来打开<strong class="ir hi">产品和服务</strong>菜单。</p><figure class="lv lw lx ly fd ii er es paragraph-image"><div class="er es mv"><img src="../Images/e583799e0fba5e11409f3f5b00d08f96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/0*ipskquxi8phl5a2c"/></div></figure><p id="918f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您在仪表板页面上，它也可能在主页上显示为卡片。</p><figure class="lv lw lx ly fd ii er es paragraph-image"><div class="er es mw"><img src="../Images/3c4621b85858d91b4a1cb2d6d4cb5893.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/0*UXUYye-k8MkIWvTP"/></div></figure><p id="7c21" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在API管理器屏幕上，点击主屏幕顶部的<strong class="ir hi">启用API </strong>。</p><p id="42df" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">将显示API列表。</p><figure class="lv lw lx ly fd ii er es paragraph-image"><div class="er es mx"><img src="../Images/ac1f3549084e328bbe9c60457099b052.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/0*h5D3SJxcxYNACnSp"/></div></figure><p id="03f2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">找到并点击<strong class="ir hi"> Google BigQuery API </strong>。</p><p id="fee5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在BigQuery页面上，如果API尚未启用，单击<strong class="ir hi"> Enable </strong>。</p><h1 id="a8a9" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">5.在BigQuery中创建数据集和表</h1><h1 id="0cf6" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">在BigQuery中创建新表</h1><p id="0f26" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">在谷歌云平台控制台(<a class="ae kx" href="https://console.cloud.google.com/bigquery" rel="noopener ugc nofollow" target="_blank">https://console.cloud.google.com/bigquery</a>)上进入BigQuery，选择行动项目。在屏幕的顶部，有一个项目下拉菜单:</p><figure class="lv lw lx ly fd ii er es paragraph-image"><div class="er es mu"><img src="../Images/525a928c0950faeadb147205363d5081.png" data-original-src="https://miro.medium.com/v2/resize:fit:922/0*9K0-Q5xYfHN7bB1x"/></div></figure><p id="c7d4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在资源下选择您的项目名称，并点击<strong class="ir hi">创建数据集</strong>。</p><p id="a833" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在弹出区域，将“报表”设置为<strong class="ir hi">数据集ID </strong>，点击<strong class="ir hi">创建数据集</strong></p><figure class="lv lw lx ly fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es my"><img src="../Images/617b8886e6f384520b6d82a9d1dc122a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RkDMrwsScOwoIDzr"/></div></div></figure><p id="d48c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在左侧面板中，数据集“reports”将被添加到项目名称下。选择它并点击<strong class="ir hi">创建表格</strong></p><figure class="lv lw lx ly fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mz"><img src="../Images/52c3d3f4d3fac808d6c2e40f7e995d53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LNUhAH1O5caIhcPp"/></div></div></figure><p id="b69b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">将<strong class="ir hi">目的表</strong>中的表名设置为“actionLog”</p><p id="cca0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">并将模式更改为“作为文本编辑”</p><p id="96e9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然后将这个JSON复制到:</p><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="ee7e" class="me jv hh ma b fi mf mg l mh mi">[</span><span id="e4a5" class="me jv hh ma b fi na mg l mh mi">{</span><span id="7716" class="me jv hh ma b fi na mg l mh mi">"description": "Time",</span><span id="727a" class="me jv hh ma b fi na mg l mh mi">"name": "time",</span><span id="e767" class="me jv hh ma b fi na mg l mh mi">"type": "TIMESTAMP",</span><span id="11ee" class="me jv hh ma b fi na mg l mh mi">"mode": "REQUIRED"</span><span id="4173" class="me jv hh ma b fi na mg l mh mi">},</span><span id="4eb8" class="me jv hh ma b fi na mg l mh mi">{</span><span id="e3c1" class="me jv hh ma b fi na mg l mh mi">"description": "User ID",</span><span id="0a01" class="me jv hh ma b fi na mg l mh mi">"name": "userId",</span><span id="f323" class="me jv hh ma b fi na mg l mh mi">"type": "STRING",</span><span id="6921" class="me jv hh ma b fi na mg l mh mi">"mode": "NULLABLE"</span><span id="289e" class="me jv hh ma b fi na mg l mh mi">},</span><span id="429b" class="me jv hh ma b fi na mg l mh mi">{</span><span id="8769" class="me jv hh ma b fi na mg l mh mi">"description": "Conversation ID",</span><span id="23d0" class="me jv hh ma b fi na mg l mh mi">"name": "conversationId",</span><span id="11fe" class="me jv hh ma b fi na mg l mh mi">"type": "STRING",</span><span id="2b9b" class="me jv hh ma b fi na mg l mh mi">"mode": "NULLABLE"</span><span id="3796" class="me jv hh ma b fi na mg l mh mi">},</span><span id="e4cc" class="me jv hh ma b fi na mg l mh mi">{</span><span id="ed74" class="me jv hh ma b fi na mg l mh mi">"description": "Intent",</span><span id="605f" class="me jv hh ma b fi na mg l mh mi">"name": "intent",</span><span id="7b70" class="me jv hh ma b fi na mg l mh mi">"type": "STRING",</span><span id="74e4" class="me jv hh ma b fi na mg l mh mi">"mode": "NULLABLE"</span><span id="216a" class="me jv hh ma b fi na mg l mh mi">},</span><span id="31dd" class="me jv hh ma b fi na mg l mh mi">{</span><span id="6db9" class="me jv hh ma b fi na mg l mh mi">"description": "Raw text",</span><span id="0df9" class="me jv hh ma b fi na mg l mh mi">"name": "text",</span><span id="6a3e" class="me jv hh ma b fi na mg l mh mi">"type": "STRING",</span><span id="68e1" class="me jv hh ma b fi na mg l mh mi">"mode": "NULLABLE"</span><span id="3e5e" class="me jv hh ma b fi na mg l mh mi">},</span><span id="5ee8" class="me jv hh ma b fi na mg l mh mi">{</span><span id="67e1" class="me jv hh ma b fi na mg l mh mi">"description": "Response Text",</span><span id="7afd" class="me jv hh ma b fi na mg l mh mi">"name": "responseText",</span><span id="d4c0" class="me jv hh ma b fi na mg l mh mi">"type": "STRING",</span><span id="1a8e" class="me jv hh ma b fi na mg l mh mi">"mode": "NULLABLE"</span><span id="3b52" class="me jv hh ma b fi na mg l mh mi">},</span><span id="ea29" class="me jv hh ma b fi na mg l mh mi">{</span><span id="4103" class="me jv hh ma b fi na mg l mh mi">"description": "Locale",</span><span id="9093" class="me jv hh ma b fi na mg l mh mi">"name": "locale",</span><span id="1130" class="me jv hh ma b fi na mg l mh mi">"type": "STRING",</span><span id="d34f" class="me jv hh ma b fi na mg l mh mi">"mode": "NULLABLE"</span><span id="6b42" class="me jv hh ma b fi na mg l mh mi">}</span><span id="933f" class="me jv hh ma b fi na mg l mh mi">]</span></pre><p id="c922" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">点击<strong class="ir hi">创建表格</strong></p><p id="cef5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在是时候设置将数据加载到BigQuery的操作了</p><h1 id="ae38" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">6.将BigQuery客户端API添加到您的操作中</h1><p id="393e" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">这个代码实验室使用了<a class="ae kx" href="https://www.npmjs.com/package/@google-cloud/bigquery" rel="noopener ugc nofollow" target="_blank"> BigQuery Node.js客户端API </a></p><h1 id="0951" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">安装客户端库:</h1><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="18ea" class="me jv hh ma b fi mf mg l mh mi">npm install — save @google-cloud/bigquery</span></pre><h1 id="447c" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">在index.js中设置BigQuery连接</h1><p id="c917" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">在index.js的副本中添加以下几行:</p><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="967b" class="me jv hh ma b fi mf mg l mh mi">// Imports the Google Cloud client library</span><span id="768b" class="me jv hh ma b fi na mg l mh mi">const BigQuery = require(‘@google-cloud/bigquery’);</span><span id="0fe9" class="me jv hh ma b fi na mg l mh mi">// Your Google Cloud Platform project ID</span><span id="e37a" class="me jv hh ma b fi na mg l mh mi">const projectId = ‘YOUR_PROJECT_ID’;</span><span id="1f0e" class="me jv hh ma b fi na mg l mh mi">const datasetId = ‘reports’;</span><span id="472d" class="me jv hh ma b fi na mg l mh mi">const tableId = ‘actionLog’;</span><span id="c831" class="me jv hh ma b fi na mg l mh mi">// Creates a BigQuery client</span><span id="fd3e" class="me jv hh ma b fi na mg l mh mi">const bigquery = new BigQuery({</span><span id="4acb" class="me jv hh ma b fi na mg l mh mi">projectId: projectId,</span><span id="ad02" class="me jv hh ma b fi na mg l mh mi">});</span></pre><h1 id="9b38" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">添加报告功能</h1><p id="5d3b" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">创建一个向BigQuery报告动作活动的新函数。</p><p id="7010" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这个代码实验室中，你将收集动作提供的所有基本数据，但在你自己的动作中，你可以添加更多你收集的信息(用户名，游戏级别等。)</p><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="889b" class="me jv hh ma b fi mf mg l mh mi">function report(conv, line) {</span><span id="dfa1" class="me jv hh ma b fi na mg l mh mi">const logInput = {</span><span id="1833" class="me jv hh ma b fi na mg l mh mi">time: bigquery.timestamp(new Date()),</span><span id="9518" class="me jv hh ma b fi na mg l mh mi">userId: conv.user.id,</span><span id="9e0d" class="me jv hh ma b fi na mg l mh mi">text: conv.input.raw,</span><span id="e69d" class="me jv hh ma b fi na mg l mh mi">intent: conv.intent,</span><span id="8fd9" class="me jv hh ma b fi na mg l mh mi">locale: conv.user.locale,</span><span id="5ce8" class="me jv hh ma b fi na mg l mh mi">responseText: typeof line === ‘string’ ? line : JSON.stringify(line),</span><span id="cb01" class="me jv hh ma b fi na mg l mh mi">conversationId: conv.id,</span><span id="ff36" class="me jv hh ma b fi na mg l mh mi">};</span><span id="523c" class="me jv hh ma b fi na mg l mh mi">let dataset = bigquery.dataset(datasetId);</span><span id="3225" class="me jv hh ma b fi na mg l mh mi">let errors = dataset.table(tableId).insert([logInput]);</span><span id="14fe" class="me jv hh ma b fi na mg l mh mi">if (errors &amp;&amp; errors.length &amp;&amp; errors[0].insertErrors) {</span><span id="302a" class="me jv hh ma b fi na mg l mh mi">console.error(‘Bigquery Insert failed’, errors[0].insertErrors);</span><span id="ce86" class="me jv hh ma b fi na mg l mh mi">}</span><span id="e695" class="me jv hh ma b fi na mg l mh mi">}</span></pre><h1 id="fb30" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">替换询问和关闭命令</h1><p id="61b2" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">为了在动作中的任何事件上向BigQuery发送更新，为ask和close创建新的函数来报告所有内容。</p><p id="e00e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">从添加新功能开始:</p><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="4bf6" class="me jv hh ma b fi mf mg l mh mi">function ask(conv, line) {<br/> report(conv, line);<br/> conv.ask(line);<br/>}</span><span id="f611" class="me jv hh ma b fi na mg l mh mi">function close(conv, line) {<br/> report(conv, line);<br/> conv.close(line);<br/>}</span></pre><p id="53b8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在用对新函数的调用替换所有的<code class="du nb nc nd ma b">conv.ask</code>和<code class="du nb nc nd ma b">conv.close</code>。</p><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="a7b2" class="me jv hh ma b fi mf mg l mh mi">conv.ask(`OK, no worries. What’s your favorite color?`);</span></pre><p id="e24d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">到</p><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="4bdd" class="me jv hh ma b fi mf mg l mh mi">ask(conv, `OK, no worries. What’s your favorite color?`);</span></pre><h1 id="8c05" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">部署和测试</h1><p id="cd8d" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">现在您可以部署代码并使用模拟器在BigQuery中创建一些日志行。</p><p id="3e5c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要在BigQuery中检查表，请转到BigQuery控制台:【https://console.cloud.google.com/bigquery T2】</p><p id="92eb" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在查询编辑器中键入以下SQL查询:</p><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="be96" class="me jv hh ma b fi mf mg l mh mi">SELECT *</span><span id="2644" class="me jv hh ma b fi na mg l mh mi">FROM `YOUR_PROJECT_ID.reports.actionLog`</span><span id="f4c8" class="me jv hh ma b fi na mg l mh mi">ORDER BY time desc</span></pre><p id="cbdf" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">检查您的所有活动是否都记录在表格中。</p><h1 id="56cb" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">7.奖励—使用Data Studio为您的行动创建仪表板</h1><p id="61ed" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">既然已经在BigQuery中收集了所有的动作数据，就可以开始从中获取分析和处理信息了。</p><h1 id="dac9" class="ju jv hh bd jw jx ky jz ka kb kz kd ke kf la kh ki kj lb kl km kn lc kp kq kr bi translated">数据工作室</h1><p id="d793" class="pw-post-body-paragraph ip iq hh ir b is ks iu iv iw kt iy iz ja ku jc jd je kv jg jh ji kw jk jl jm ha bi translated">Google Data Studio让您免费构建带有漂亮数据可视化效果的实时交互式仪表盘。您可以从各种来源获取数据，并在Data Studio中创建无限的报告，具有完整的编辑和共享功能。</p><p id="cc13" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在本例中，您将创建一个显示一段时间内新用户和返回用户计数的查询。</p><p id="9f61" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">前往https://console.cloud.google.com/bigquery<a class="ae kx" href="https://console.cloud.google.com/bigquery" rel="noopener ugc nofollow" target="_blank">的BigQuery控制台</a></p><p id="a5b2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">运行以下SQL查询:</p><pre class="lv lw lx ly fd lz ma mb mc aw md bi"><span id="0892" class="me jv hh ma b fi mf mg l mh mi">SELECT</span><span id="8ba3" class="me jv hh ma b fi na mg l mh mi">day2 AS date,</span><span id="9d47" class="me jv hh ma b fi na mg l mh mi">users,</span><span id="b506" class="me jv hh ma b fi na mg l mh mi">IFNULL(unique_users, 0) new_users,</span><span id="451e" class="me jv hh ma b fi na mg l mh mi">(users - IFNULL(unique_users, 0)) old_users</span><span id="866f" class="me jv hh ma b fi na mg l mh mi">FROM (</span><span id="5ef0" class="me jv hh ma b fi na mg l mh mi">SELECT</span><span id="4d78" class="me jv hh ma b fi na mg l mh mi">COUNT( DISTINCT userId) users,</span><span id="2fa9" class="me jv hh ma b fi na mg l mh mi">DATE(time) day2</span><span id="73a9" class="me jv hh ma b fi na mg l mh mi">FROM</span><span id="b844" class="me jv hh ma b fi na mg l mh mi">`<strong class="ma hi">YOUR_PROJECT_ID</strong>.reports.actionLog`</span><span id="d54c" class="me jv hh ma b fi na mg l mh mi">GROUP BY</span><span id="255d" class="me jv hh ma b fi na mg l mh mi">day2) AS totalAll</span><span id="1ad1" class="me jv hh ma b fi na mg l mh mi">LEFT JOIN (</span><span id="e857" class="me jv hh ma b fi na mg l mh mi">SELECT</span><span id="1304" class="me jv hh ma b fi na mg l mh mi">COUNT(DISTINCT userId) unique_users,</span><span id="9e5f" class="me jv hh ma b fi na mg l mh mi">day3</span><span id="47a5" class="me jv hh ma b fi na mg l mh mi">FROM (</span><span id="d765" class="me jv hh ma b fi na mg l mh mi">SELECT</span><span id="c2f7" class="me jv hh ma b fi na mg l mh mi">userId,</span><span id="69f3" class="me jv hh ma b fi na mg l mh mi">MIN(DATE(time)) day3</span><span id="7e7c" class="me jv hh ma b fi na mg l mh mi">FROM</span><span id="0018" class="me jv hh ma b fi na mg l mh mi">`YOUR_PROJECT_ID.reports.actionLog`</span><span id="984d" class="me jv hh ma b fi na mg l mh mi">GROUP BY</span><span id="6823" class="me jv hh ma b fi na mg l mh mi">userId )</span><span id="13d7" class="me jv hh ma b fi na mg l mh mi">GROUP BY</span><span id="783c" class="me jv hh ma b fi na mg l mh mi">day3</span><span id="7894" class="me jv hh ma b fi na mg l mh mi">ORDER BY</span><span id="7112" class="me jv hh ma b fi na mg l mh mi">day3) uniqueAll</span><span id="b1f3" class="me jv hh ma b fi na mg l mh mi">ON</span><span id="26aa" class="me jv hh ma b fi na mg l mh mi">uniqueAll.day3 = totalAll.day2</span><span id="1022" class="me jv hh ma b fi na mg l mh mi">ORDER BY</span><span id="6696" class="me jv hh ma b fi na mg l mh mi">day2</span></pre><p id="6fca" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在查询结果中，你会得到一个看起来像这样的表格:</p><figure class="lv lw lx ly fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ne"><img src="../Images/c4620658a6e7caf02ac324b9d9cc02e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Sm76moK9oS81oN0t"/></div></div></figure><p id="8de7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">点击DATA STUDIO中的<strong class="ir hi">浏览</strong></p><p id="b5af" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">将打开带有Data Studio的新选项卡。</p><p id="18e4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">将视图样式从表格更改为组合图</p><figure class="lv lw lx ly fd ii er es paragraph-image"><div class="er es nf"><img src="../Images/3595513b50342869d7b608dc4441e3ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/0*JGpNtEW3axg4v7dL"/></div></figure><p id="39cd" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">将度量设置为:用户、新用户、旧用户</p><figure class="lv lw lx ly fd ii er es paragraph-image"><div class="er es ng"><img src="../Images/b5cac51dda18302855f01e43fa4d0d6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:632/0*ns47l9YTk45QHoHV"/></div></figure><p id="71cd" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">将排序设置为日期和升序</p><figure class="lv lw lx ly fd ii er es paragraph-image"><div class="er es nh"><img src="../Images/367327d4e6e3522cbc3008be1be1a34e.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/0*_rKNMLPc9AfvQMNE"/></div></figure><p id="e547" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">转到样式选项卡，将堆叠条形图设置为打开。</p><p id="6760" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在系列1集合上显示数据标签</p><p id="07e7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在左侧Y轴上，将自定义刻度间隔设置为1</p><figure class="lv lw lx ly fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ms"><img src="../Images/06e3142f134b2c20ae5717c81b8b1ea7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ginRfIyhBY_tJhK_"/></div></div></figure><blockquote class="ml mm mn"><p id="302e" class="ip iq lu ir b is it iu iv iw ix iy iz mo jb jc jd mp jf jg jh mq jj jk jl jm ha bi translated">*这是您在bigQuery控制台上运行的查询的图表。它不会随着时间的推移而更新。为了获得实时仪表板，您必须在<a class="ae kx" href="https://datastudio.google.com/u/0/navigation/reporting" rel="noopener ugc nofollow" target="_blank">https://datastudio.google.com/u/0/navigation/reporting</a>上创建新报告。</p><p id="0320" class="ip iq lu ir b is it iu iv iw ix iy iz mo jb jc jd mp jf jg jh mq jj jk jl jm ha bi translated">了解有关DataStudio的更多信息:<a class="ae kx" href="https://support.google.com/datastudio/answer/6283323?hl=en&amp;ref_topic=6267740" rel="noopener ugc nofollow" target="_blank">https://support.google.com/datastudio/answer/6283323?hl=en&amp;ref _ topic = 6267740</a></p></blockquote></div></div>    
</body>
</html>