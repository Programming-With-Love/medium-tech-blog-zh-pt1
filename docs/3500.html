<html>
<head>
<title>Tracing resources using Environment of Azure DevOps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Azure DevOps环境跟踪资源</h1>
<blockquote>原文：<a href="https://medium.com/globant/tracing-resources-using-environment-of-azure-devops-c8802c0668de?source=collection_archive---------0-----------------------#2020-09-18">https://medium.com/globant/tracing-resources-using-environment-of-azure-devops-c8802c0668de?source=collection_archive---------0-----------------------#2020-09-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/185678f481e1b3e42e8a5ce7304994ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7axio_ycArODHqng"/></div></div></figure><p id="7800" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">本文将展示Azure DevOps管道的<strong class="ir hi"> <em class="jn">环境</em> </strong> <em class="jn"> </em>特性如何为复杂的<strong class="ir hi"> K8S集群</strong>启用资源跟踪。</p><h1 id="8b7d" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">简介:</h1><p id="929b" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated"><strong class="ir hi"> <em class="jn">环境</em> </strong>代表每个管道的一组资源，这允许我们在Azure Devops中映射物理或虚拟环境，如开发、QA、暂存、生产等。Kubernetes是一个容器编排和管理工具。当处理Kubernetes时，我们必须注意pod、服务、名称空间、部署日志。<strong class="ir hi"> Azure DevOps </strong>提供了从工作项到部署的完全可追溯性。</p><p id="cb15" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Azure Kubernetes服务(AKS)是Azure Devops环境中支持的第一种资源类型，以下是一些关键功能:</p><ul class=""><li id="8738" class="kr ks hh ir b is it iw ix ja kt je ku ji kv jm kw kx ky kz bi translated">提交和工作项目的可追溯性</li><li id="d6ce" class="kr ks hh ir b is la iw lb ja lc je ld ji le jm kw kx ky kz bi translated">部署历史</li><li id="373d" class="kr ks hh ir b is la iw lb ja lc je ld ji le jm kw kx ky kz bi translated">认证和检查的诊断</li><li id="b487" class="kr ks hh ir b is la iw lb ja lc je ld ji le jm kw kx ky kz bi translated">通过为用户和管道指定权限来确保安全</li></ul><p id="37e3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">建立可追溯性的高级过程是在满足先决条件后创建环境和创建构建和发布管道。一旦遵循上述步骤，就可以查看资源的可追溯性。</p><h1 id="7a31" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">1.先决条件</h1><ul class=""><li id="d52a" class="kr ks hh ir b is km iw kn ja lf je lg ji lh jm kw kx ky kz bi translated">确保您拥有存储库和管道的<strong class="ir hi"> Azure DevOps </strong>帐户</li><li id="f74d" class="kr ks hh ir b is la iw lb ja lc je ld ji le jm kw kx ky kz bi translated">确保你的Azure订阅拥有构建AKS集群的权限</li></ul><h1 id="d4ea" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">2.在Azure Devops管道中创建环境</h1><p id="3078" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">本节描述了创建Azure DevOps管道的步骤</p><ul class=""><li id="f7f5" class="kr ks hh ir b is it iw ix ja kt je ku ji kv jm kw kx ky kz bi translated">在Azure DevOps中，在pipelines选项卡中查找环境。点击环境标签&amp;你会看到下面的图片。你可以创造一个空的环境。您可以在创建时或以后添加资源。</li></ul><figure class="lj lk ll lm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es li"><img src="../Images/653a5fd55bde80fa60a09c0dde5f6258.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WP10AWZkzKNkcV-U"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx">Fig: Creation of Environment</figcaption></figure><ul class=""><li id="8923" class="kr ks hh ir b is it iw ix ja kt je ku ji kv jm kw kx ky kz bi translated">下图显示了一个名为“Dev”的环境</li></ul><figure class="lj lk ll lm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es li"><img src="../Images/8d794f5d671a61c82fc0b1b6ce036119.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5bHEVIudInLyJADF"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx">Fig: Sample Eenviroment</figcaption></figure><p id="e13c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">注意</strong>:如果指定的环境不存在，会用你的azure-pipeline.yaml中提供的名称创建一个环境</p><ul class=""><li id="4051" class="kr ks hh ir b is it iw ix ja kt je ku ji kv jm kw kx ky kz bi translated">您可以在创建环境时配置资源。在这种情况下，当从管道定位环境时，不必为资源指定服务连接，因为管道会自动使用环境中定义的服务连接。</li></ul><h1 id="d93d" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">3.用简单的构建和发布管道测试可追溯性</h1><p id="2da5" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated"><strong class="ir hi">用简单管道测试变化:</strong></p><ul class=""><li id="2002" class="kr ks hh ir b is it iw ix ja kt je ku ji kv jm kw kx ky kz bi translated">现在，在这一步中，我在配置环境变量后运行现有的azure-pipelines.yaml文件。您可以为“环境:<env-name>”更新您的azure-pipeline.yaml文件并运行管道。</env-name></li></ul><figure class="lj lk ll lm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lr"><img src="../Images/40c7a7be08fbf967fa10f09b9864fce3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SHWDvtjqSFWllRHW"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx">Fig: azure-pipelines.yaml</figcaption></figure><ul class=""><li id="96c0" class="kr ks hh ir b is it iw ix ja kt je ku ji kv jm kw kx ky kz bi translated">运行管道后，我可以看到执行被标记在environments下(在Yaml文件中提到的是“Dev”)。正如您在开发环境下看到的，有最近的部署，这使我们能够跟踪作业、变更和工作项。</li></ul><figure class="lj lk ll lm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ls"><img src="../Images/f67f57cd1f27edb20568161addced6d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BhjmnLfEuR28nM_u"/></div></div></figure><h1 id="b538" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">4.Kubernetes的可追溯性</h1><p id="bcfa" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">现在，我们将看到Azure DevOps如何与Kubernetes集成。</p><ul class=""><li id="597c" class="kr ks hh ir b is it iw ix ja kt je ku ji kv jm kw kx ky kz bi translated">为库伯内特集群创造环境。创建环境时，您可以选择AKS或通用提供程序(您必须指定所有细节，如集群名称、命名空间等。)</li></ul><figure class="lj lk ll lm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es li"><img src="../Images/e2ac6c6d9ef7fb384ec5647154a891ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rQwm8IS1VvgpOY3y"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx">Fig: Adding cluster in environment</figcaption></figure><ul class=""><li id="1419" class="kr ks hh ir b is it iw ix ja kt je ku ji kv jm kw kx ky kz bi translated">在这里，我有一个如下所示的环境(AKSdemo ),单击它会向您显示选项卡——资源和部署。部署选项卡提供诸如正在部署的内容和时间范围等信息。当你点击它，你会看到标签，如工作，改变，工作项目。</li></ul><figure class="lj lk ll lm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lt"><img src="../Images/5d05bc8f3daf64a1a8baa187d483f362.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FW4eTbwL-3Mrenbc"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx">Fig: Demo environment</figcaption></figure><ul class=""><li id="797a" class="kr ks hh ir b is it iw ix ja kt je ku ji kv jm kw kx ky kz bi translated">在文件中，我添加了环境部分，如<strong class="ir hi">" environment:AKSdemo . demons "</strong>，其中aks demo表示环境的名称，demons表示我的kubernetes集群中的名称空间的名称。</li></ul><figure class="lj lk ll lm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lu"><img src="../Images/14dbd2fd59e530800f833bfe065d709d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2ceaFnmJX9UPk8rH"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx">Fig: azure-pipeline.yaml</figcaption></figure><h1 id="2240" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">5.查看K8集群中的可追溯性</h1><ul class=""><li id="8759" class="kr ks hh ir b is km iw kn ja lf je lg ji lh jm kw kx ky kz bi translated">在参考资料中，我有名称空间“demons ”,其中有如下的<strong class="ir hi">工作负载</strong>和<strong class="ir hi">服务</strong>。</li></ul><figure class="lj lk ll lm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es li"><img src="../Images/cb850306c5d975e1a027d17e7dc20ad7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6q-PSn3O-0hlic1t"/></div></div></figure><ul class=""><li id="020b" class="kr ks hh ir b is it iw ix ja kt je ku ji kv jm kw kx ky kz bi translated">我的名称空间包含kubernetes对象，如<strong class="ir hi">副本集</strong>，与<strong class="ir hi"> Pod </strong>相关联的图像，当前运行2个Pod。</li></ul><figure class="lj lk ll lm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lv"><img src="../Images/c824668761cef33258c7de33c2325599.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-TT9ev1S1Ddpxf0s"/></div></div></figure><ul class=""><li id="57e8" class="kr ks hh ir b is it iw ix ja kt je ku ji kv jm kw kx ky kz bi translated">深入到单个pod会在overview选项卡中显示更多详细信息，如节点池、pod的条件、状态等。</li></ul><figure class="lj lk ll lm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lw"><img src="../Images/1840e4a04d11a571387a996e0947df5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*umLaIOS3iiuWLsHG"/></div></div></figure><ul class=""><li id="bbeb" class="kr ks hh ir b is it iw ix ja kt je ku ji kv jm kw kx ky kz bi translated">我们还可以看到pod内部生成的日志以及与pod相关联的清单文件，如下所示</li></ul><figure class="lj lk ll lm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lx"><img src="../Images/1d8466c987ed1ccb81fb7e4f1d10323a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2IG6GED18-ZAprJV"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx">Fig: pod Logs</figcaption></figure><figure class="lj lk ll lm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ly"><img src="../Images/526e1927bb0464c08cde477495a3b2f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CkjkH5mwiS81qIyX"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx">Fig: Pod Yaml file</figcaption></figure><ul class=""><li id="e599" class="kr ks hh ir b is it iw ix ja kt je ku ji kv jm kw kx ky kz bi translated">在services选项卡中，我已经部署了一个web服务，使用<strong class="ir hi">类型</strong>作为<strong class="ir hi">负载平衡器</strong>。您可以使用下面显示的IP地址和端口连接到此服务。</li></ul><figure class="lj lk ll lm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lz"><img src="../Images/e69177fc9e79306f16d3ef3d0274e86b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4K_zXEtvyi1EOlyC"/></div></div><figcaption class="ln lo et er es lp lq bd b be z dx">Fig: Service detail</figcaption></figure><h1 id="3039" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">总结:</h1><ul class=""><li id="e514" class="kr ks hh ir b is km iw kn ja lf je lg ji lh jm kw kx ky kz bi translated">使用Azure DevOps的环境跟踪功能管理和部署应用程序代码，无需登录Azure portal即可查看AKS集群资源。这对于VM来说也是一样的，但是我没有在我的文章中涉及到。</li><li id="ab24" class="kr ks hh ir b is la iw lb ja lc je ld ji le jm kw kx ky kz bi translated">请留意微软在该环境下提供的资源数量。这将减少登录Azure portal(通过GUI或CLI)的时间和负担，除非绝对必要。</li><li id="9cf3" class="kr ks hh ir b is la iw lb ja lc je ld ji le jm kw kx ky kz bi translated">到目前为止，微软只发布了Kubernetes集群、虚拟机(VM)等资源的环境，在不久的将来，微软计划发布更多资源，如Azure web app等。</li></ul><p id="5616" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">参考链接:</p><ul class=""><li id="b01d" class="kr ks hh ir b is it iw ix ja kt je ku ji kv jm kw kx ky kz bi translated"><a class="ae ma" href="https://docs.microsoft.com/en-us/azure/devops/pipelines/process/environments-kubernetes?view=azure-devops" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/azure/devo PS/pipelines/process/environments-kubernetes？view=azure-devops </a></li><li id="66a4" class="kr ks hh ir b is la iw lb ja lc je ld ji le jm kw kx ky kz bi translated"><a class="ae ma" href="https://docs.microsoft.com/en-us/azure/devops/pipelines/process/environments?view=azure-devops" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/azure/devo PS/pipelines/process/environments？view=azure-devops </a>先决条件</li></ul></div></div>    
</body>
</html>