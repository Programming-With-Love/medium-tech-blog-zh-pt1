<html>
<head>
<title>An Optional’s place in Kotlin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">科特林的一个可选的地方</h1>
<blockquote>原文：<a href="https://medium.com/square-corner-blog/an-optionals-place-in-kotlin-17d7b271eefe?source=collection_archive---------0-----------------------#2017-05-14">https://medium.com/square-corner-blog/an-optionals-place-in-kotlin-17d7b271eefe?source=collection_archive---------0-----------------------#2017-05-14</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><blockquote class="ie"><p id="c072" class="if ig hh bd ih ii ij ik il im in io dx translated">注意，我们已经行动了！如果您想继续了解Square的最新技术内容，请访问我们的新家<a class="ae ip" href="https://developer.squareup.com/blog" rel="noopener ugc nofollow" target="_blank">https://developer.squareup.com/blog</a></p></blockquote><p id="fcf8" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm io ha bi translated">随着可空性成为Kotlin类型系统中的一等公民，对一个<code class="du jn jo jp jq b">Optional</code>类型的需求几乎消失了。但是，仅仅因为您可以显式地表示可空性，并不意味着总是允许null。</p><p id="fbac" class="pw-post-body-paragraph iq ir hh is b it jr iv iw ix js iz ja jb jt jd je jf ju jh ji jj jv jl jm io ha bi translated">例如，retreate为RxJava 1.x和2.x提供了适配器，允许将您的请求建模为单元素流。</p><pre class="jw jx jy jz fd ka jq kb kc aw kd bi"><span id="a0c2" class="ke kf hh jq b fi kg kh l ki kj">interface MyApiService {<br/>  @GET("/api/user/settings")<br/>  fun userSettings(): Observable&lt;Settings&gt;<br/>}</span></pre><p id="832e" class="pw-post-body-paragraph iq ir hh is b it jr iv iw ix js iz ja jb jt jd je jf ju jh ji jj jv jl jm io ha bi translated">RxJava 2与RxJava 1的不同之处在于，它不允许流中包含null。如果我们使用RxJava 2，并且<code class="du jn jo jp jq b">Settings</code>的转换器返回null，将会发生异常。因此，为了表示这个流中没有响应体的值，我们需要一个像<code class="du jn jo jp jq b">Optional</code>这样的抽象。</p><p id="8887" class="pw-post-body-paragraph iq ir hh is b it jr iv iw ix js iz ja jb jt jd je jf ju jh ji jj jv jl jm io ha bi translated"><a class="ae ip" href="https://github.com/square/retrofit/blob/master/CHANGELOG.md#version-230-2017-05-13" rel="noopener ugc nofollow" target="_blank">改型2.3.0 </a>引入了两个新的<em class="kk">委托</em>转换器，用于Guava和Java 8中的<code class="du jn jo jp jq b">Optional</code>类型。与Moshi、Gson和Wire等其他库转换器不同，这些新转换器的不同之处在于它们并不真正将字节转换为对象。相反，它们委托其他转换器来处理字节，然后将可能为空的结果包装成一个<code class="du jn jo jp jq b">Optional</code>。</p><pre class="jw jx jy jz fd ka jq kb kc aw kd bi"><span id="477c" class="ke kf hh jq b fi kg kh l ki kj">val retrofit = Retrofit.Builder()<br/>    .baseUrl("https://example.com")<br/>    .addConverterFactory(Java8OptionalConverterFactory.create())<br/>    .addConverterFactory(WireConverterFactory.create())<br/>    .addCallAdapter(RxJava2CallAdapterFactory.create())<br/>    .build()</span></pre><p id="7fdf" class="pw-post-body-paragraph iq ir hh is b it jr iv iw ix js iz ja jb jt jd je jf ju jh ji jj jv jl jm io ha bi translated">通过在序列化转换器旁边添加一个<code class="du jn jo jp jq b">Optional</code>转换器，其主体可以反序列化为null的请求可以改为返回一个<code class="du jn jo jp jq b">Optional</code>。</p><pre class="jw jx jy jz fd ka jq kb kc aw kd bi"><span id="d90f" class="ke kf hh jq b fi kg kh l ki kj">interface MyApiService {<br/>  @GET("/api/user/settings")<br/>  fun userSettings(): Observable&lt;<strong class="jq hi">Optional&lt;</strong>Settings<strong class="jq hi">&gt;</strong>&gt;<br/>}</span></pre><p id="4d80" class="pw-post-body-paragraph iq ir hh is b it jr iv iw ix js iz ja jb jt jd je jf ju jh ji jj jv jl jm io ha bi translated">今天的<a class="ae ip" href="https://github.com/square/retrofit/blob/master/CHANGELOG.md#version-230-2017-05-13" rel="noopener ugc nofollow" target="_blank">改进2.3.0 </a>版本包含了与我们最近的Okio和OkHttp版本相同的针对Java和Kotlin显式空性的JSR 305注释。正如我们在上面所看到的，仅仅拥有这些注释或者一个可以模拟可空性的类型系统有时是不够的。对于这些情况，在Java和Kotlin中都一样，使用<code class="du jn jo jp jq b">Optional</code>有它的位置。</p><p id="248a" class="pw-post-body-paragraph iq ir hh is b it jr iv iw ix js iz ja jb jt jd je jf ju jh ji jj jv jl jm io ha bi translated">这篇文章是Square的“<a class="ae ip" rel="noopener" href="/square-corner-blog/square-open-source-loves-kotlin-c57c21710a17"> Square开源♥s·科特林</a>”系列文章的一部分。</p></div></div>    
</body>
</html>