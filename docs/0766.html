<html>
<head>
<title>Permissionless is the future of Storage on Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无许可是安卓存储的未来</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/permissionless-is-the-future-of-storage-on-android-3fbceeb3d70a?source=collection_archive---------0-----------------------#2022-10-13">https://medium.com/androiddevelopers/permissionless-is-the-future-of-storage-on-android-3fbceeb3d70a?source=collection_archive---------0-----------------------#2022-10-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/54a1b2e6e6bfac795d71683ceee6dd78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mf1pwOw2cr5432f2SHI0gA.png"/></div></div></figure><div class=""/><p id="9664" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">无论是更改个人资料头像、分享度假照片，还是在电子邮件中添加附件，选择和分享媒体文件都是用户在移动应用程序上最常见的事情之一。在听取了Android用户的反馈后，我们对应用程序访问媒体文件的方式做了一些改变。根据我们从与开发人员的交谈中了解到的情况，我们引入了一个有用的新工具。</p><p id="7265" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在Android，我们认为让用户选择照片和视频应该是有帮助的，易于实施，并且有隐私意识。</p><h1 id="090b" class="jn jo hs bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">现有存储权限的弃用</h1><p id="50bf" class="pw-post-body-paragraph ip iq hs ir b is kl iu iv iw km iy iz ja kn jc jd je ko jg jh ji kp jk jl jm ha bi translated">许多用户告诉我们，文件和媒体权限困扰着他们，因为他们不知道应用程序想要访问哪些文件。</p><p id="12b1" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在Android 13上，我们放弃了<code class="du kq kr ks kt b">READ_EXTERNAL_STORAGE</code>和<code class="du kq kr ks kt b">WRITE_EXTERNAL_STORAGE</code>权限，转而支持更好的替代API来访问媒体文件。</p><p id="297f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">请记住</strong>从Android 10向共享存储添加文件不需要任何权限。所以如果你的应用程序<strong class="ir ht">只在共享存储中添加文件</strong>，你可以在Android 10+上停止请求任何权限</p><p id="7e9a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">历史上，应用程序要求<code class="du kq kr ks kt b">READ_EXTERNAL_STORAGE</code>请求用户授权访问文件&amp;媒体。然后，他们实现了自己的媒体挑选体验，给开发者团队增加了沉重的开发&amp;维护成本。或者，应用程序通过<code class="du kq kr ks kt b">ACTION_GET_CONTENT</code>或<code class="du kq kr ks kt b">ACTION_OPEN_CONTENT</code>依赖于系统文件拾取器，但我们从开发者那里听说它并没有很好地集成到他们的应用程序UX:</p><figure class="kv kw kx ky fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ku"><img src="../Images/ca7d3dfcace0d28b24fceb487783e1dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o2ra9z6NrpZIneA7lnJrSA.png"/></div></div><figcaption class="kz la et er es lb lc bd b be z dx">System File Picker using <code class="du kq kr ks kt b">ACTION_OPEN_CONTENT</code></figcaption></figure><h1 id="02ae" class="jn jo hs bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">介绍照片拾取器</h1><p id="aac6" class="pw-post-body-paragraph ip iq hs ir b is kl iu iv iw km iy iz ja kn jc jd je ko jg jh ji kp jk jl jm ha bi translated">在Android 13中，我们引入了一个新的视觉媒体拾取工具:Android photo picker。该工具为用户提供了一种选择媒体文件的方式，而无需授予对其整个媒体库的访问权限。</p><p id="47cd" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">它提供了一个干净、可浏览的界面，向用户展示他们的照片和视频，并按日期排序。此外，“相册”部分允许用户通过有用的类别进行浏览，如截图或下载。通过指定用户应该只看到照片还是只看到视频，或者通过设置他们可以选择的最大项目数，照片选择器是可定制的。简而言之，这个解决方案是私有的，有一个干净和完整的UX，并且易于实现。</p><figure class="kv kw kx ky fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ld"><img src="../Images/a9f18448030011a570707f271923a80c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ic7H6PeL6LNFX4wH"/></div></div></figure><p id="1e0e" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们还通过Google Play系统更新(【2022年5月1日发布)在Android 11和12*上移植了照片拾取器，以将其带给更广泛的Android受众。</p><p id="ba8a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">虽然开发和更新您自己的媒体拾取器是一个复杂而费力的项目，但照片拾取器不需要您的团队进行任何维护。这是一个简单的启动意图，我们已经在<a class="ae lf" href="https://developer.android.com/jetpack/androidx/releases/activity#1.6.0" rel="noopener ugc nofollow" target="_blank"> ActivityX 1.6.0版本</a>中为它创建了一个<a class="ae lf" href="https://developer.android.com/reference/androidx/activity/result/contract/ActivityResultContract" rel="noopener ugc nofollow" target="_blank"> ActivityResultContract </a>。它将在可用时使用照片选择器，并在旧设备上回退到ACTION_OPEN_DOCUMENT:</p><pre class="kv kw kx ky fd lg kt lh li aw lj bi"><span id="f54f" class="lk jo hs kt b fi ll lm l ln lo">// Registering Photo Picker activity launcher with a max limit of 5 items<br/>val pickMultipleVisualMedia = registerForActivityResult(PickMultipleVisualMedia(5)) { uris -&gt;<br/>    // TODO: process URIs<br/>}</span><span id="63f8" class="lk jo hs kt b fi lp lm l ln lo">// Launching the photo picker (photos &amp; video included)<br/>pickMultipleVisualMedia.launch(PickVisualMediaRequest(PickVisualMedia.ImageAndVideo))</span></pre><p id="7649" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您想添加类型过滤，可以这样做:</p><pre class="kv kw kx ky fd lg kt lh li aw lj bi"><span id="da8a" class="lk jo hs kt b fi ll lm l ln lo">// Launching the photo picker (photos only)<br/>pickMultipleVisualMedia.launch(PickVisualMediaRequest(PickVisualMedia.ImageOnly))</span><span id="7d81" class="lk jo hs kt b fi lp lm l ln lo">// Launching the photo picker (video only)<br/>pickMultipleVisualMedia.launch(PickVisualMediaRequest(PickVisualMedia.VideoOnly))</span><span id="743f" class="lk jo hs kt b fi lp lm l ln lo">// Launching the photo picker (GIF only)<br/>pickMultipleVisualMedia.launch(PickVisualMediaRequest(PickVisualMedia.SingleMimeType("image/gif")))</span></pre><p id="4ba4" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您可以通过调用<code class="du kq kr ks kt b"><a class="ae lf" href="https://developer.android.com/reference/kotlin/androidx/activity/result/contract/ActivityResultContracts.PickVisualMedia.Companion#isPhotoPickerAvailable()" rel="noopener ugc nofollow" target="_blank">isPhotoPickerAvailable</a>.</code>来验证照片拾取器在给定设备上是否可用</p><p id="5e7d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">查看<a class="ae lf" href="https://developer.android.com/training/data-storage/shared/photopicker" rel="noopener ugc nofollow" target="_blank">文档</a>了解更多关于添加照片拾取器到你的应用程序的细节。</p><h1 id="f6a1" class="jn jo hs bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated"><code class="du kq kr ks kt b">ACTION_GET_CONTENT</code>行为改变</h1><p id="e36b" class="pw-post-body-paragraph ip iq hs ir b is kl iu iv iw km iy iz ja kn jc jd je ko jg jh ji kp jk jl jm ha bi translated">正如我们刚刚看到的，采用Android照片拾取器只需要几行代码。虽然我们希望所有应用程序都使用它，但您的应用程序中的迁移可能需要一些时间。这就是为什么我们将Android photo picker的好处带到现有的使用<code class="du kq kr ks kt b">ACTION_GET_CONTENT</code>的应用程序中，在接下来的几个月里，无需任何代码更改，就可以将系统文件picker切换为引擎盖下的photo picker。如果您使用图像和/或视频mime类型过滤器启动<code class="du kq kr ks kt b">ACTION_GET_CONTENT</code>意图，将显示照片选择器，而不是文档选择器。对于应用程序，预期的结果是一样的:一个<code class="du kq kr ks kt b">Uri</code>列表。</p><figure class="kv kw kx ky fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lq"><img src="../Images/b385f17379bf811fd36439904d47a8c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*7r-dWNcQyqyXwhO2JPdeTg.gif"/></div></div><figcaption class="kz la et er es lb lc bd b be z dx">ACTION_GET_CONTENT will open the photo picker instead of the document picker</figcaption></figure><h1 id="e188" class="jn jo hs bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">针对特定用例的新权限</h1><p id="be83" class="pw-post-body-paragraph ip iq hs ir b is kl iu iv iw km iy iz ja kn jc jd je ko jg jh ji kp jk jl jm ha bi translated">虽然我们<strong class="ir ht">强烈</strong> <strong class="ir ht">建议</strong>您使用新的照片拾取器，而不是请求访问所有媒体文件，但您的应用程序可能有需要这种广泛访问的用例(例如图库照片备份)。对于这些特定用途，我们引入了新的权限，提供对特定类型媒体文件的访问，包括图像、视频或音频。你可以在文档中了解更多。</p><p id="bb65" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果用户之前授予您的应用程序<code class="du kq kr ks kt b">READ_EXTERNAL_STORAGE</code>权限，系统会自动授予您的应用程序粒度媒体权限。否则，当您的应用程序请求任何新权限时，系统会显示一个面向用户的对话框。</p><p id="f5d0" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">记住</strong>你必须总是检查是否有任何权限仍然被授予，而不是存储它们的授予状态。通过应用程序休眠和过期许可授权</p><figure class="kv kw kx ky fd hj er es paragraph-image"><div class="er es lr"><img src="../Images/d8c394af8d537e45c1fcdea817134bdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/0*-hnd2MGr20PA3rwi"/></div></figure><p id="ec53" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">查看此决策树，帮助您了解这些变化:</p><figure class="kv kw kx ky fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ls"><img src="../Images/569dabfd6d0732dd2ae306bdbb327c43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uCbURAPjFhNBVTA-"/></div></div></figure><p id="cb07" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">通过这些公告，我们致力于不断改进照片拾取器和整体存储开发人员体验，同时保护用户隐私，以创建一个安全透明的Android生态系统。如果您有任何反馈或建议，请将票证提交给我们的问题跟踪器！</p><p id="e398" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="le">*:Android photo picker后移植到所有Android 11 &amp; 12设备，不包括Android Go和非GMS设备。</em></p></div></div>    
</body>
</html>