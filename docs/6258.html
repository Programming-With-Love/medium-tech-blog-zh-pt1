<html>
<head>
<title>Improving the Quality of Recommended Pins with Lightweight Ranking</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过轻量级排名提高推荐的图钉的质量</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/improving-the-quality-of-recommended-pins-with-lightweight-ranking-8ff5477b20e3?source=collection_archive---------1-----------------------#2020-09-10">https://medium.com/pinterest-engineering/improving-the-quality-of-recommended-pins-with-lightweight-ranking-8ff5477b20e3?source=collection_archive---------1-----------------------#2020-09-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="05db" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Poorvi Bhargava |软件工程师，Homefeed推荐，王森|软件工程师，Homefeed推荐，廖骏伦|技术主管，Homefeed推荐，张铎|工程经理，Homefeed推荐</p><p id="bf2f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Pinterest语料库由数十亿个pin组成，然而，每个Pinner在浏览其主页feed或其他推荐表面时，只能看到基于其兴趣的一小部分子集。我们如何向每个人提供这些建议？</p><h1 id="1047" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">Pixie简介:Pinterest的一个关键推荐系统</h1><p id="f5ef" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">Pixie 是Pinterest的主要推荐系统之一，用于获取相关pin。Pixie由Pinterest上所有引脚和电路板的二分图组成。从一个最近交互过的引脚开始，我们沿着图形执行多次随机遍历，为该引脚生成数千个相似的引脚。这些pin按“访问计数”排序，或在随机行走中被“访问”的次数。从Pixie获取pin后，它们被发送到Pixie的客户端进行进一步的个性化排序。</p><p id="2b25" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">作为一个主要的推荐源，Pixie每秒生成超过7500万个pin，并为多个下游客户端提供支持，包括重要的表面，如主页馈送、推荐馈送、电子邮件通知、搜索和广告。</p><h1 id="1ab9" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">Pixie如何融入Pinterest推荐管道？</h1><p id="ac43" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">像其他推荐系统一样，我们使用两步方法来缩小数十亿个pin的范围，为Pinner选择最好的几个。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/f2189ca5039dfa5f1184f0084d702f44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WOgP35ChcjiXJ9Nn"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx">Figure 1. Number of Pins at each stage of the current Recommendation Funnel</figcaption></figure><p id="7d67" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第一步，“候选生成”，是一个召回驱动的步骤，旨在有效地获取一组广泛相关的引脚。Pixie就是这样一个候选发电机。该步骤使用最近的用户参与来制定代表Pinner兴趣的输入。input Pin用于获取类似的Pin，这些Pin基于简单的启发式算法(在Pixie的情况下，这是访问计数分数)快速评分，并针对特定的业务需求应用附加的提升逻辑。得分最高的大头针然后被传递到漏斗的下一个步骤。</p><p id="a7b1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第二步，或“完全排序”层，对从多个候选生成器中提取的所有推荐进行聚合和排序。它由一个精确而复杂的神经网络组成，使用用户、Pin和上下文特征来准确预测Pinner与候选人互动的可能性。很大程度上由于模型的复杂性，这一步通常是非常昂贵和耗时的，所以我们在这一步对有限的数量进行排名。然后向用户显示排名最高的大头针。</p><h1 id="e420" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">让Pixie推荐更加个性化</h1><p id="8acc" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">尽管Pixie在Pinterest的多个主要产品表面取得了巨大成功，但它目前面临着几个挑战，这些挑战限制了它生成更多相关内容:</p><ol class=""><li id="7161" class="kw kx hh ig b ih ii il im ip ky it kz ix la jb lb lc ld le bi translated">Pixie的“访问计数”分数纯粹根据图形结构对生成的pin进行排序；它不考虑任何用户偏好。在Pinterest，我们建立了一系列代表用户兴趣和pin信息的功能，这些功能可能有助于改善个性化。</li><li id="708d" class="kw kx hh ig b ih lf il lg ip lh it li ix lj jb lb lc ld le bi translated">特别的业务需求(例如本地内容的推广)不容易合并，需要添加到现有的增强逻辑网络中。</li></ol><p id="48fd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这两个挑战都可以通过用机器学习模型替换Pixie中现有的访问计数评分和提升层来优雅地解决。</p><p id="fe2c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然而，机器学习模型在生产中运行可能会非常昂贵和耗时。由于Pixie每秒推荐超过7500万个引脚，并且位于多个推荐面的关键路径上，因此添加模型不会显著增加Pixie的延迟是至关重要的。此外，由于Pixie候选生成之后是客户端上更彻底的完整排序步骤，因此我们可以使用更简单的模型，并牺牲一些精度来提高效率。这种类型的“轻量级”排名(与“重量级”全排名相比)通常在行业中建立，以改善推荐漏斗中早期的个性化。最后，由于Pixie为Pinterest的各种主要表面提供支持，因此记住设计应该灵活、可伸缩和可扩展，以支持整个公司的多种客户需求，这一点很重要。因此，Pixie的这个轻量级排名模型的主要目标是:</p><ol class=""><li id="c004" class="kw kx hh ig b ih ii il im ip ky it kz ix la jb lb lc ld le bi translated">向用户推荐相关性和个性化更好的pin，尤其是与现有的“访问计数”解决方案相比。</li><li id="eb4d" class="kw kx hh ig b ih lf il lg ip lh it li ix lj jb lb lc ld le bi translated">构建一个高效的机器学习模型，支持每秒7500万个pin的评分。</li><li id="5ecd" class="kw kx hh ig b ih lf il lg ip lh it li ix lj jb lb lc ld le bi translated">构建一个可伸缩和可扩展的多租户框架，可以轻松应用该框架来支持不同的Pixie客户端。</li><li id="6098" class="kw kx hh ig b ih lf il lg ip lh it li ix lj jb lb lc ld le bi translated">增加灵活性，以便能够根据客户端不断变化的业务需求来强调特定类型的引脚。</li></ol><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lk"><img src="../Images/fbea369fef87c1464e77ae889a65d0f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*K7PAlQCKrK4qvBGc"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx">Figure 2. Recommendation Funnel after adding a Lightweight Ranking Step</figcaption></figure><h1 id="c5e8" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">构建多租户轻量级排名系统</h1><p id="2f76" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">在实践中，基于机器学习的推荐系统由多个关键组件组成，如训练数据管道和模型训练策略。在这里，我们将重点关注需要主要设计决策的组件，这些组件允许我们为Pixie构建一个多租户轻量级排名系统。</p><h2 id="fc24" class="ll jd hh bd je lm ln lo ji lp lq lr jm ip ls lt jq it lu lv ju ix lw lx jy ly bi translated">创建可扩展到多个客户端的训练数据集</h2><p id="3b1f" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">机器学习模型的成功很大程度上依赖于训练数据。为了生成这些数据，我们将来自Pinners的标签与Pin和用户上下文功能的显式结合起来。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lz"><img src="../Images/6c153957237010f9a7a62976d027b8b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*voeQtuxPPteBlMuH"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx">Figure 3. Logging Pipeline Design: logging at the front end stage versus at the serving stage.</figcaption></figure><p id="bc04" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">记录训练数据的一种常见做法是在“前端阶段”进行记录。这意味着我们将特征数据传递到前端，并且只存储用户看到的管脚的数据。在前端阶段进行日志记录的主要好处是节省存储空间，因为我们不需要存储任何用户看不到的(因此没有标记的)数据。绝大多数数据，尤其是轻量级评分级别的数据，是用户看不到的。</p><p id="930a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然而，由于该项目的主要设计目标之一是为多个客户端构建一个可扩展的管道，我们决定使用另一种方法，在“服务阶段”直接登录。这包括存储Pixie立即生成的所有候选图钉的特征数据，包括看不见的图钉的特征数据。这避免了每个客户端必须将特性传递给前端并建立自己的日志记录基础设施。此外，看不见的数据帮助我们定义轻量级排名特有的训练优化策略，如下所述。</p><h2 id="6542" class="ll jd hh bd je lm ln lo ji lp lq lr jm ip ls lt jq it lu lv ju ix lw lx jy ly bi translated">如何训练和优化轻量级排名模型</h2><p id="c4ff" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">因为轻量级排名的目标是有效地对大量瓶进行评分，所以我们从训练低复杂度的XGBoost GBDT模型开始。我们包括了每个客户端全排名器中最重要的用户和pin功能，但也包括了Pixie独有的功能，如图形和输入Pin功能。该功能集在所有Pixie客户端界面上共享。</p><p id="339c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">由于我们的轻量级模型后面是更精确的全排序步骤，因此模型训练期间的主要设计选择是选择模型优化策略。全排名通常为预测用户参与度而优化。然而，因为在轻量级排名之后有一个额外的排名层，并且我们可以获得看不见的数据，所以我们也可以选择优化我们的模型，以便(a)通过称为模型提取的技术尝试明确地模仿完整排名器的结果，或者(b)通过提高“漏斗效率”来通过完整排名器。</p><p id="614a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">模型提炼是指训练一个较小的“学生”模型，以尽可能准确地再现一个较大的“教师”模型的行为，但使用的参数较少。这涉及到从教师模型到学生模型的“提炼”知识。漏斗效率优化是一个探索较少，但相关的概念。它旨在最大化通过下游排序层的候选人数量。</p><p id="f68f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们将在未来的博客文章中探索模型的提炼，目前重点放在比较参与度和漏斗效率优化策略上。我们是如何实施这些战略的？因为我们的日志记录管道在服务阶段捕获数据，所以我们可以访问通过(已施加引脚)和未通过(未施加引脚)整个排序层的示例。我们设计了培训渠道，使我们能够根据我们的优化策略轻松定义正面和负面标签:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ma"><img src="../Images/f476205b06c92aca8a1c17e23e4f414a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T-PSq1pg-K_0_baL"/></div></div></figure><p id="8a00" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在实践中，我们看到这两种漏斗效率方法确实增加了通过推荐漏斗的Pixie pins的数量。然而,“纯粹的”漏斗效率方法在预测用户将对哪些大头针采取行动方面不太有效。这是因为，即使对于动作标签具有明显更高的训练权重，大量的印象标签和模型的低复杂性使得模型很难区分两种类型的正面标签。我们看到，“混合”漏斗效率方法显示了最有利的结果，甚至与针对参与度优化的模型相比也是如此。</p><p id="ef16" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">此外，每个客户都有不同的业务需求。例如，主页feed可能希望最大化为给定人员保存的pin，而通知可能希望最大化电子邮件中的点击。为了解决这些问题，我们为每个客户训练了不同的模型，并强调了与特定表面相关的训练权重。在实践中，我们看到，与原始的、严格的基于启发式的排序相比，这导致了对重要标签的更精细的控制和主要度量增益。</p><p id="ba00" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，诸如“局部性提升”的特别提升先前被应用于每个引脚的最终等级。为了匹配这种类型的提升的性能，我们不仅向模型添加了区域设置特性，还为我们的训练集中pin的区域设置与用户的区域设置相匹配的那些示例分配了“本地标签”。在实践中，我们看到这些标签显著提升了本地推荐，使我们能够替换以前的提升层。</p><h1 id="07cb" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">视窗网际网路名称服务</h1><h2 id="282d" class="ll jd hh bd je lm ln lo ji lp lq lr jm ip ls lt jq it lu lv ju ix lw lx jy ly bi translated">对Pixie及其客户的影响</h2><p id="6703" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">我们看到为Pixie的每个主要客户建立的模型取得了巨大的成功。在主页feed上，我们看到节省量增加了1-2 %,在相关的pin上，我们看到在网站和CTR上花费的时间增加了1%。对于Pixie支持的电子邮件通知，我们看到CTR增加了6%,结果是每周活跃用户显著增加。拥有一个可扩展的管道，能够灵活地定义新的标签和优化策略，使我们能够干净地满足每个客户的动态业务需求。</p><h2 id="7059" class="ll jd hh bd je lm ln lo ji lp lq lr jm ip ls lt jq it lu lv ju ix lw lx jy ly bi translated">对用户的影响:提高推荐质量</h2><p id="051b" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">在用户方面，轻量级排名允许我们在漏斗的早期获取更多相关和个性化的推荐。下面就是这样一个例子。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lz"><img src="../Images/3ee9652c51afab050b73aa29b36cb8b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zeL5hd6TVswwQP6M"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx">Figure 4. Comparing recommendations from old heuristic-based sorting versus those with lightweight ranking.</figcaption></figure><p id="b3a5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在图4的左侧，您可以看到，对于一个查看秘鲁彩虹山徒步旅行提示的用户，没有轻量级排名的推荐主要是一般旅行场景的壁纸图像，与提示、徒步旅行或秘鲁无关。在右侧，您会看到所有推荐的大头针都是关于秘鲁、徒步旅行提示或其他山区旅游目的地的，因此相关性更高。</p><h1 id="279a" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">未来方向</h1><p id="162c" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">在开发这一模型的过程中，我们面临着一些反复出现的挑战:</p><ol class=""><li id="f5cd" class="kw kx hh ig b ih ii il im ip ky it kz ix la jb lb lc ld le bi translated">基础设施限制:由于Pixie的规模，高工作负载限制了我们添加新功能和使用更复杂的机器学习模型来提高性能的能力。</li><li id="f68a" class="kw kx hh ig b ih lf il lg ip lh it li ix lj jb lb lc ld le bi translated">模型分段:在一些客户端界面上，比如Home Feed，我们有几个不同的轻量级排名模型。拥有多个模型会导致计算资源的浪费和单个表面上多余的开发工作。</li></ol><p id="6c8a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了应对这些挑战，我们计划在特定的表面上统一所有候选生成器(不仅仅是Pixie)使用的服务框架和模型设计。通过将轻量级排序从单个候选生成器中移出，我们能够更广泛地共享特性，统一日志记录管道，并轻松地在所有模型上统一迭代。</p><p id="b481" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们计划进一步研究不同优化策略之间的性能差异，如模型提取，并试验更强大但成本更低的模型架构，如基于双塔嵌入的DNN(灵感来自<a class="ae kf" href="https://static.googleusercontent.com/media/research.google.com/en//pubs/archive/45530.pdf" rel="noopener ugc nofollow" target="_blank"> YouTube </a>)。</p><p id="306e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">鸣谢</strong></p><p id="d7ca" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="mb">郑涛，尚雯婕，陈晨，张世元，杰伊·亚当斯，娜迪亚·法瓦兹</em></p></div></div>    
</body>
</html>