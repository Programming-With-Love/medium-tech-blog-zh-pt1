<html>
<head>
<title>Kotlin DSL —defining mandatory parameters</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">kot Lin DSL—定义强制参数</h1>
<blockquote>原文：<a href="https://blog.kotlin-academy.com/kotlin-dsl-know-your-limits-2deaef1bab66?source=collection_archive---------1-----------------------#2020-08-16">https://blog.kotlin-academy.com/kotlin-dsl-know-your-limits-2deaef1bab66?source=collection_archive---------1-----------------------#2020-08-16</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="d7f5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">或者为什么我写了另一个Android库</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/69839b1acd58a5813efd0d4c0e62bfc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EEiduivdAWkwPohW.png"/></div></div></figure><p id="3232" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">自从Kotlin推出以来，多个库都选择了它们API的DSL实现。<br/> Kotlin DSL是一个很棒的工具，它让你的API可读性更好，也更容易使用，如果你还没有时间使用它，我强烈建议你试一试。</p><p id="e2d7" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">但是这篇文章并不是要解释如何实现一个基于Kotlin DSL的API，有一些关于它的很棒的文章。<br/>我也不会谈论Kotlin DSL有多棒(确实如此)。<br/>相反，我将把重点放在当我试图把它应用到我自己的用例中时所面临的问题上。</p><h1 id="685b" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">第一</h1><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ls lt l"/></div></figure><p id="836e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">DSL的一个很好的例子可以在名为<a class="ae lu" href="https://github.com/Kotlin/anko" rel="noopener ugc nofollow" target="_blank"> Anko </a>的Android库中找到，它允许以编程方式布置UI组件(Flutter/Jetpack开发人员可能会很熟悉):</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="61ba" class="ma kv in lw b gy mb mc l md me">verticalLayout {<br/>   editText {<br/>    hint = "Name"<br/>    textSize = 24f<br/>  }  <br/>   button("Say Hello") {<br/>    onClick { toast(“Hello!”) }<br/>  }<br/>}</span></pre><p id="4364" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">看起来很容易理解，对吧？</p><h1 id="d751" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">那么，关键在哪里？</h1><p id="7861" class="pw-post-body-paragraph jk jl in jm b jn mf jp jq jr mg jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">让我们仔细看看:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="1961" class="ma kv in lw b gy mb mc l md me">button("Say Hello") {<br/>    onClick { toast("Hello!") }<br/>}</span></pre><p id="3ed2" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">正如您所看到的，按钮文本是作为参数提供的，因为它是创建按钮所必需的，而<code class="fe mk ml mm lw b">onClickListener</code>是可选的，因此是在lambda块中定义的。</p><p id="2837" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于单个参数来说，这似乎仍然很容易理解，但是如果有多个强制参数呢？</p><p id="4785" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在尝试了DSL之后，我很快发现我遇到了和普通老构建者一样的问题——接收强制参数。</p><h1 id="073f" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">那解决办法是什么？</h1><p id="cd0d" class="pw-post-body-paragraph jk jl in jm b jn mf jp jq jr mg jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">显而易见的解决方案是验证所有强制参数都被设置为最终对象构建的一部分，但这是一个运行时解决方案，在我看来是糟糕的API的标志。</p><p id="230f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我在构建器中使用的另一个解决方案是在构造函数中定义强制参数。同样的技巧也适用于DSL，但是我发现这违背了DSL的一个目的——可读。</p><p id="4623" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我尝试的最后一个选项是使用<a class="ae lu" href="https://kotlinlang.org/docs/reference/whatsnew13.html#contracts" rel="noopener ugc nofollow" target="_blank"> Kotlin契约</a>，我很快排除了它，原因有两个:我觉得它不够成熟。<br/> 2。他们只申请顶级功能，不完全是我在寻找的。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="mn lt l"/></div></figure><p id="0fc3" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我的目标很明确——强制参数的编译时验证。我想要一个简单的方法来解决这个常见的问题。</p><h1 id="9d40" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">DSLint简介</h1><p id="8d95" class="pw-post-body-paragraph jk jl in jm b jn mf jp jq jr mg jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">最终，我决定成为自己最好的朋友，并使用自定义的Android linter库(抱歉，非Android开发者)来实现这个问题的解决方案。</p><p id="dd31" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这就是它的工作原理，假设我要使用DSL实现一个<code class="fe mk ml mm lw b">Person</code>构建器，并希望确保设置了这个人的名字。<br/>我需要做的就是注释类和name属性，让我的自定义linter发挥魔力:</p><pre class="kj kk kl km gt lv lw lx ly aw lz bi"><span id="9c98" class="ma kv in lw b gy mb mc l md me">@DSLint<br/>class Person {<br/><br/>    @set:DSLMandatory<br/>    var name: String<br/>}</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mo"><img src="../Images/e57ade095eeaa53e62a0d8e7435ba309.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lzanVUqZD7kfnX3cuiBNOQ.png"/></div></div></figure><p id="b398" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">干净简单。我把它开源了，所以你可以在你的项目中使用它，或者克隆repo并基于它创建你的定制解决方案。</p><p id="de58" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">你可以看看这里:</p><div class="mp mq gp gr mr ms"><a href="https://github.com/ironSource/dslint" rel="noopener  ugc nofollow" target="_blank"><div class="mt ab fo"><div class="mu ab mv cl cj mw"><h2 class="bd io gy z fp mx fr fs my fu fw im bi translated">铁源/dslint</h2><div class="mz l"><h3 class="bd b gy z fp mx fr fs my fu fw dk translated">在您希望DSLint验证的DSL类/接口上使用。@DSLMandatory用于强制DSL属性设置器或…</h3></div><div class="na l"><p class="bd b dl z fp mx fr fs my fu fw dk translated">github.com</p></div></div><div class="nb l"><div class="nc l nd ne nf nb ng ks ms"/></div></div></a></div><h1 id="90d3" class="ku kv in bd kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr bi translated">综上</h1><p id="4203" class="pw-post-body-paragraph jk jl in jm b jn mf jp jq jr mg jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">正如我前面所说的，DSL是一个很好的工具，我鼓励您尝试它，但也要意识到它的局限性。<br/>我希望您喜欢阅读，并期待听到您在尝试DSL时所面临的挑战以及您是如何应对这些挑战的。</p></div><div class="ab cl nh ni hr nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ig ih ii ij ik"><h1 id="50a5" class="ku kv in bd kw kx no kz la lb np ld le lf nq lh li lj nr ll lm ln ns lp lq lr bi translated">单击👏说“谢谢！”并帮助他人找到这篇文章。</h1><p id="9d17" class="pw-post-body-paragraph jk jl in jm b jn mf jp jq jr mg jt ju jv mh jx jy jz mi kb kc kd mj kf kg kh ig bi translated">了解卡帕头最新的重大新闻。学院、<a class="ae lu" href="https://kotlin-academy.us17.list-manage.com/subscribe?u=5d3a48e1893758cb5be5c2919&amp;id=d2ba84960a" rel="noopener ugc nofollow" target="_blank">订阅时事通讯</a>、<a class="ae lu" href="https://twitter.com/ktdotacademy" rel="noopener ugc nofollow" target="_blank">观察Twitter </a>并在medium上关注我们。</p><p id="adc9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您需要Kotlin工作室，请查看我们如何帮助您:<a class="ae lu" href="https://www.kt.academy/" rel="noopener ugc nofollow" target="_blank"> kt.academy </a>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><a href="https://kotlin-academy.us17.list-manage.com/subscribe?u=5d3a48e1893758cb5be5c2919&amp;id=d2ba84960a"><div class="gh gi nt"><img src="../Images/3146970f03e44cb07afe660b0d43e045.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*54OqlYA4etu7wfpmMP5TKQ.png"/></div></a></figure></div></div>    
</body>
</html>