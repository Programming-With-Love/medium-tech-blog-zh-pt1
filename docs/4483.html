<html>
<head>
<title>Don’t fear the CDK</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">不要害怕CDK</h1>
<blockquote>原文：<a href="https://medium.com/compendium/dont-fear-the-cdk-7e40b7d27d8b?source=collection_archive---------0-----------------------#2018-08-27">https://medium.com/compendium/dont-fear-the-cdk-7e40b7d27d8b?source=collection_archive---------0-----------------------#2018-08-27</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="3e98" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">创建自定义UI并不难</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/1c41acc79746e86b9be28e9321fc7214.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1fBwu1i1SdDU8bFObN81UA.png"/></div></div></figure><p id="8a6d" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">开发人员使用<a class="ae ke" href="https://material.angular.io/" rel="noopener ugc nofollow" target="_blank"> Angular Material </a>的一个常见模式是在每一个UI上使用框架，甚至是他们创建的应用程序定制的UI，因此超出了Angular Material的预期工作范围。有时这仅仅是为一个组件稍微调整一下CSS的问题，而其他时候则需要进行功能上的改变。这可能很麻烦，结果可能包含难以维护和保持无bug的难看的黑客攻击。我希望引起大家对<a class="ae ke" href="https://material.angular.io/cdk/categories" rel="noopener ugc nofollow" target="_blank"> Angular CDK </a>的关注，这是一个组件开发工具包，可能正是你创建特定应用组件所需要的。我们将研究<code class="du kf kg kh ki b">OverlayModule</code>，以及它如何帮助我们创建一个定制的小吃店。</p><p id="86b3" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">完成的小吃店示例可以在<a class="ae ke" href="https://stackblitz.com/github/eTallang/angular-feedback-service/" rel="noopener ugc nofollow" target="_blank"> StackBlitz </a>上查看，而代码托管在<a class="ae ke" href="https://github.com/eTallang/angular-feedback-service" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上。</p></div><div class="ab cl kj kk go kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="ha hb hc hd he"><h1 id="cb8e" class="kq kr hh bd ks kt ku kv kw kx ky kz la in lb io lc iq ld ir le it lf iu lg lh bi translated">意见的艺术</h1><p id="7780" class="pw-post-body-paragraph ji jj hh jk b jl li ii jn jo lj il jq jr lk jt ju jv ll jx jy jz lm kb kc kd ha bi translated">虽然从头创建一个定制组件比使用现有组件更难，但是创建一个试图在各个方面都可以配置的组件会极大地增加复杂性。所以，帮你自己一个忙，尽可能让组件保持固执己见。这自然取决于您的组件的用途，因为特定于应用程序的组件可能非常固执己见，而例如一个用于共享NPM包的组件可能在如何使用方面有更大的灵活性。为特定应用程序创建的组件实际上可能具有固执己见的优势，因为这强调了它的预期用途，限制了团队中的开发人员使用您的组件的不同方式。这是在整个应用程序中保持用户体验一致性的许多方法之一。</p><h1 id="55cc" class="kq kr hh bd ks kt ln kv kw kx lo kz la in lp io lc iq lq ir le it lr iu lg lh bi translated">认识一下CDK</h1><p id="1d55" class="pw-post-body-paragraph ji jj hh jk b jl li ii jn jo lj il jq jr lk jt ju jv ll jx jy jz lm kb kc kd ha bi translated">当<a class="ae ke" href="https://angular.io/" rel="noopener ugc nofollow" target="_blank"> Angular </a>团队在Angular材料上工作时，他们遇到了不同组件之间相似的UI行为。这一发现成为了创建Angular CDK的动机，这是一个包含用于创建组件的低级构建块的库。在撰写本文时，该库提供了三个组件，即步进器、表格和树。这些组件对样式没有意见，这使得这些组件非常完美，如果你想自己设计它们的话。该库还包含几个方便的实用模块。其中之一是<code class="du kf kg kh ki b">A11yModule</code>，它提供了一个<code class="du kf kg kh ki b">FocusKeyManager</code>来控制标签焦点。这在创建弹出窗口时非常有用，因为您希望在弹出窗口关闭之前捕获焦点。CDK的另一个公用事业是<code class="du kf kg kh ki b">OverlayModule</code>。这个模块是创建菜单、对话框、工具提示和任何一种应该放在DOM中其他元素之上的UI的基础(因此得名)。我们将使用这个模块创建一个小吃栏，这是一个通常用于向用户显示反馈的组件。</p><h1 id="6010" class="kq kr hh bd ks kt ln kv kw kx lo kz la in lp io lc iq lq ir le it lr iu lg lh bi translated">创建项目并设置我们的模块</h1><p id="0550" class="pw-post-body-paragraph ji jj hh jk b jl li ii jn jo lj il jq jr lk jt ju jv ll jx jy jz lm kb kc kd ha bi translated">如果还没有全局安装<a class="ae ke" href="https://cli.angular.io/" rel="noopener ugc nofollow" target="_blank"> Angular CLI </a>，并生成一个新项目。我们还将为我们的小吃店创建一个新的模块(从现在开始作为反馈引用),并提供相应的组件和服务。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="9d73" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">为了使用角CDK的功能，我们必须将它添加到我们的项目中。使用NPM或<a class="ae ke" href="https://yarnpkg.com/en/" rel="noopener ugc nofollow" target="_blank">纱线</a>添加。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="3dfc" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">因为我们将使用来自Angular CDK的OverlayModule，所以我们必须在我们的<code class="du kf kg kh ki b">FeedbackModule</code>中导入它。我们的<code class="du kf kg kh ki b">FeedbackComponent</code>也必须添加到我们模块的<code class="du kf kg kh ki b">entryComponents</code>-数组中，因为它将被动态添加到DOM中。我们的<code class="du kf kg kh ki b">FeedbackModule</code>现在应该是这样的:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="ls lt l"/></div></figure><h1 id="67b3" class="kq kr hh bd ks kt ln kv kw kx lo kz la in lp io lc iq lq ir le it lr iu lg lh bi translated">为我们的反馈组件提供覆盖样式</h1><p id="c97a" class="pw-post-body-paragraph ji jj hh jk b jl li ii jn jo lj il jq jr lk jt ju jv ll jx jy jz lm kb kc kd ha bi translated">为了保持这篇文章合理的简短，我将不讨论反馈组件的样式，也不讨论如何在我们的out中动画化它。关于样式，唯一要记住的是从有角度的CDK项目中导入叠加样式。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="66f8" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这可以在项目中的任何地方进行，但必须是全球可用的。如果你从你的<code class="du kf kg kh ki b">FeedbackComponent</code>开始，你必须记住通过设置<code class="du kf kg kh ki b">ViewEncapsulation.None</code>来禁用视图封装。反馈组件可以根据您的需要变得简单或复杂。一个好的技巧是将文本作为变量显示在组件中，然后将其绑定到HTML，这样开发人员就可以提供他们想要的任何消息。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="fbe0" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">您还可以添加其他属性，例如显示/隐藏关闭按钮，更改反馈的严重性，或者您想要添加的任何其他内容。如果你想从我的演示中抓取剩余的SCSS和动画，可以在<a class="ae ke" href="https://github.com/eTallang/angular-feedback-service" rel="noopener ugc nofollow" target="_blank"> GitHub项目</a>中找到。</p><h1 id="da86" class="kq kr hh bd ks kt ln kv kw kx lo kz la in lp io lc iq lq ir le it lr iu lg lh bi translated">使用叠加服务</h1><p id="d1cc" class="pw-post-body-paragraph ji jj hh jk b jl li ii jn jo lj il jq jr lk jt ju jv ll jx jy jz lm kb kc kd ha bi translated">这个例子中真正的魔法发生在<code class="du kf kg kh ki b">feedback.service.ts</code>。我将完整地展示该服务，然后逐一解释:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="02ca" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">服务的奇妙之处在于服务的构造者。该服务有一个<code class="du kf kg kh ki b">create</code>-函数，它接受一个配置对象，您可以在其中指定您的覆盖图应该如何运行。请特别注意<code class="du kf kg kh ki b">positionStrategy</code>房产的漂亮设计。每种方法都是可链接的，为你的覆盖图创建一个可读性很强的位置定义。如果你想让开发人员有机会在他/她想的地方调整反馈，这个位置也很容易修改。</p><p id="001c" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">唯一从服务中暴露出来的是<code class="du kf kg kh ki b">openFeedback</code>-方法，它接受一条消息和一个可选的options-object，开发者可以在其中设置一些我们已经实现的选项。注意选项使用了<code class="du kf kg kh ki b">Partial</code>，因为这使得<code class="du kf kg kh ki b">FeedbackOptions</code>接口上的每个属性都是可选的。</p><p id="9d3c" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">我们检查的第一件事是是否有一个现有的覆盖处于活动状态。如果是这样，我们分离它，这实际上意味着从DOM中移除它。然后，我们为我们的<code class="du kf kg kh ki b">FeedbackComponent</code>创建一个<code class="du kf kg kh ki b">ComponentPortal</code>，并将其附加到我们在构造函数中创建的<code class="du kf kg kh ki b">overlayRef</code>。我还擅自在组件实例中设置了message和options对象。基本就是这样。当调用<code class="du kf kg kh ki b">openFeedback</code>-方法时，<code class="du kf kg kh ki b">FeedbackComponent</code>将被插入到DOM中我们在构造函数中指定的位置，并设置消息和选项。GitHub演示中的反馈也有一个超时时间，这样在4秒后，或者开发者提供的任何自定义时间后，反馈就会被删除。</p><h1 id="9f73" class="kq kr hh bd ks kt ln kv kw kx lo kz la in lp io lc iq lq ir le it lr iu lg lh bi translated">这并不难</h1><p id="eba1" class="pw-post-body-paragraph ji jj hh jk b jl li ii jn jo lj il jq jr lk jt ju jv ll jx jy jz lm kb kc kd ha bi translated">我们创建的用于显示反馈的服务总共包含39行代码。就是这样。这包括进口。考虑到我们现在已经完全控制了反馈的特性和视觉效果，这是一个非常实惠的定制实现，我会随时选择它来破解一个预制的NPM包，以便让它按照我想要的方式工作。CDK也在积极开发中，新的功能会定期添加到库中。我希望这个小例子能让一些开发人员放下架子，敢于走进CDK，看看它能提供什么工具。</p></div></div>    
</body>
</html>