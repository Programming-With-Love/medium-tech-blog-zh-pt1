<html>
<head>
<title>Getting Started With Ruby (and Ruby on Rails) on OCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在OCI上开始使用Ruby(和Ruby on Rails)</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/getting-started-with-ruby-and-ruby-on-rails-on-oci-3ce2d4c65833?source=collection_archive---------0-----------------------#2022-01-28">https://medium.com/oracledevs/getting-started-with-ruby-and-ruby-on-rails-on-oci-3ce2d4c65833?source=collection_archive---------0-----------------------#2022-01-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/7263752a669a6b79efb00b89b7fa95df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4ePLJeRgqrw3qZ-GwbevVw.jpeg"/></div></div></figure><p id="a627" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="jn">照片由</em> <a class="ae jo" href="https://www.pexels.com/@divinetechygirl?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> <em class="jn">克里斯蒂娜·莫里洛</em> </a> <em class="jn">发自</em> <a class="ae jo" href="https://www.pexels.com/photo/black-and-gray-laptop-computer-turned-on-doing-computer-codes-1181271/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"> <em class="jn"> Pexels </em> </a></p><p id="972e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我喜欢红宝石。我很高兴在各种应用程序中使用它，并且非常喜欢它的适应性。它面向对象的优点非常棒——能够在我需要的时候快速轻松地对我需要的功能进行猴子式修补，这既是一件好事，也是一件坏事。大量的灵活性(有些人——不是我——可能会争论太多)可能会阻止一些潜在的采用者，但对我们其他人来说，这很好。</p><p id="10c2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">也就是说，Ruby不像以前那样受欢迎了。Python的出现抢尽了风头(至少就高级运行时语言而言)。特别是在Python 3中包含了面向对象的支持，Python是一种很好的语言。不管怎样，我还是喜欢露比。需要明确的是，我并不是一个只会一招的小马——我用C、C++、ASM、PHP、Python和许多其他语言进行过编程。尽管如此，鲁比在我心中占有特殊的位置。</p><p id="1f0e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这篇文章诞生于帮助在OCI上使用Ruby变得更容易的愿望。这是一个非常基本的话题，有些用户可能不需要/不想要，但我们中的许多人可能会找到有用的参考。事不宜迟，让我们深入了解如何为Ruby(和Ruby on Rails)引导一个OCI实例。</p><h1 id="c308" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">嗯……这很简单。为什么是这篇文章？</h1><p id="d3ca" class="pw-post-body-paragraph ip iq hh ir b is kn iu iv iw ko iy iz ja kp jc jd je kq jg jh ji kr jk jl jm ha bi translated">是啊，我知道。这是我最初的反应。有几个变量使得这个特定的场景比我最初的反应稍微不那么简单:</p><p id="edab" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">aarch64</p><p id="3867" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><a class="ae jo" href="https://github.com/rbenv/rbenv" rel="noopener ugc nofollow" target="_blank"> rbenv </a></p><p id="4330" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">aarch64架构不应该是一个惊天动地的平台。毕竟，单是过多的Raspberry Pi(和其他嵌入式/物联网)设备(更不用说企业中基于RISC的平台的复兴)就意味着aarch64不再是几年前的陌生邻居了。遗憾的是，并不是所有的开发人员都跟上了时代的步伐，所以偶尔会有一些库和/或工具在aarch64上不能正常工作。这将会改变。这是必然的。时间和技术无情地向前迈进，所以这只是时间问题。无论如何，我对此感到非常兴奋，并尽我所能在我的解决方案中尽可能地多语种化(利用AMD64和aarch64 ),通常默认为aarch64。</p><p id="928b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><a class="ae jo" href="https://github.com/rbenv/rbenv" rel="noopener ugc nofollow" target="_blank"> rbenv </a>确实是这里最大的因素之一，因为Ruby可以通过<em class="jn"> dnf install ruby </em>获得:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="c601" class="lb jq hh kx b fi lc ld l le lf">[opc@ruby ~]$ dnf info ruby<br/>Oracle Linux 8 BaseOS Latest (aarch64)                                                   77 kB/s | 3.6 kB     00:00<br/>Oracle Linux 8 BaseOS Latest (aarch64)                                                   44 MB/s |  38 MB     00:00<br/>Oracle Linux 8 Application Stream (aarch64)                                             103 kB/s | 3.9 kB     00:00<br/>Oracle Linux 8 Application Stream (aarch64)                                              46 MB/s |  27 MB     00:00<br/>Oracle Linux 8 Addons (aarch64)                                                          69 kB/s | 3.0 kB     00:00<br/>Available Packages<br/>Name         : ruby<br/>Version      : 2.5.9<br/>Release      : 107.module+el8.4.0+20203+c00aa653<br/>Architecture : aarch64<br/>Size         : 87 k<br/>Source       : ruby-2.5.9-107.module+el8.4.0+20203+c00aa653.src.rpm<br/>Repository   : ol8_appstream<br/>Summary      : An interpreter of object-oriented scripting language<br/>URL          : <a class="ae jo" href="http://ruby-lang.org/" rel="noopener ugc nofollow" target="_blank">http://ruby-lang.org/</a><br/>License      : (Ruby or BSD) and Public Domain and MIT and CC0 and zlib and UCD<br/>Description  : Ruby is the interpreted scripting language for quick and easy<br/>             : object-oriented programming.  It has many features to process text<br/>             : files and to do system management tasks (as in Perl).  It is simple,<br/>             : straight-forward, and extensible.</span><span id="621a" class="lb jq hh kx b fi lg ld l le lf">[opc@ruby ~]$</span></pre><p id="af54" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">大多数严肃的Ruby开发都需要对Ruby运行时的控制(更不用说Rails和其他可能用到的gem了)。这就是<a class="ae jo" href="https://github.com/rbenv/rbenv" rel="noopener ugc nofollow" target="_blank"> rbenv </a>的亮点。是的，这篇文章本来可以用<em class="jn"> sudo dnf install ruby </em>来绕过，但那会安装yum repo中当时可用的特定版本…这不是我想要的。在本教程下面，你会注意到我选择安装3.0.1，而yum repo版本(上面)是2.5.9。也许对你来说这不是世界末日，但我想要一些更有控制力的东西。我怀疑很多其他的Ruby开发者也会想要这种级别的控制。</p><h1 id="dcfe" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">关于OCI的一些情况</h1><p id="7bb2" class="pw-post-body-paragraph ip iq hh ir b is kn iu iv iw ko iy iz ja kp jc jd je kq jg jh ji kr jk jl jm ha bi translated">在继续之前，有必要停下来了解一下发生的背景:Oracle云基础设施(OCI)。如果你还没有一个OCI帐户，你真的应该得到一个！</p><p id="169a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为什么你应该有一个OCI帐户？！</p><p id="60bb" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">很高兴你问了。有了OCI永远免费账户，你可以免费使用计算、存储、数据库和许多其他OCI云服务。永远。是啊…没错。永远！这就解释了为什么我们会在这里工作，对吗？！在这里注册一个账户<a class="ae jo" href="https://www.oracle.com/cloud/free/#always-free?source=:ex:tb:::::WWMK220126P00007&amp;SC=:ex:tb:::::WWMK220126P00007&amp;pcode=WWMK220126P00007" rel="noopener ugc nofollow" target="_blank"/>。想要有一次沿着黄砖路的美好经历，看看我尊敬的同事克里斯写的伟大的<a class="ae jo" rel="noopener" href="/oracledevs/create-an-oracle-always-free-cloud-account-bc6aa82c1397">如何做</a>。</p><h1 id="42aa" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">入门指南</h1><p id="2dd0" class="pw-post-body-paragraph ip iq hh ir b is kn iu iv iw ko iy iz ja kp jc jd je kq jg jh ji kr jk jl jm ha bi translated">首先创建并登录您的OCI计算实例。如果你不确定如何做到这一点，Chris碰巧为此写了另一个<a class="ae jo" href="https://chrisbensen.medium.com/create-an-oci-compute-instance-493d10e2e6a6" rel="noopener">教程</a>——现在是浏览它的好时机。我选择使用基于A1的形状(<em class="jn"> VM。Standard.A1.Flex </em>)运行当时可用的最新Oracle Linux 8映像。我选择为我的实例使用arm CPU，尽管您也可以使用基于amd64的CPU。在做任何事情之前，让我们升级系统:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="4a80" class="lb jq hh kx b fi lc ld l le lf">[opc@ruby ~]$ sudo dnf update -y &amp;&amp; sudo dnf upgrade -y</span></pre><p id="88e0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我从零开始——一个全新的例子。现在让乐趣开始吧！安装rbenv有几个选项，但是我使用的方法是使用<a class="ae jo" href="https://github.com/rbenv/rbenv-installer#rbenv-installer" rel="noopener ugc nofollow" target="_blank"> rbenv安装脚本</a>。让我们现在就开始吧:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="3694" class="lb jq hh kx b fi lc ld l le lf">[opc@ruby ~]$ curl -fsSL <a class="ae jo" href="https://github.com/rbenv/rbenv-installer/raw/HEAD/bin/rbenv-installer" rel="noopener ugc nofollow" target="_blank">https://github.com/rbenv/rbenv-installer/raw/HEAD/bin/rbenv-installer</a> | bash</span><span id="b2ed" class="lb jq hh kx b fi lg ld l le lf">[opc@ruby ~]$ echo 'PATH="$HOME/.rbenv/bin:$PATH"' &gt;&gt; ~/.bashrc<br/>[opc@ruby ~]$ source ~/.bashrc<br/>[opc@ruby ~]$ echo 'eval "$(rbenv init - bash)"' &gt;&gt; ~/.bash_profile<br/>[opc@ruby ~]$ source ~/.bash_profile</span></pre><p id="febe" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">耶！我们现在已经设置好了rbenv。我们需要安装开发工具和一堆其他的包(库)，这样Ruby就可以在我们的机器上本地构建和安装了(更多信息见<a class="ae jo" href="https://github.com/rbenv/ruby-build/wiki#suggested-build-environment" rel="noopener ugc nofollow" target="_blank">本页</a>):</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="61ee" class="lb jq hh kx b fi lc ld l le lf">[opc@ruby ~]$ sudo dnf config-manager --set-enabled ol8_codeready_builder<br/>[opc@ruby ~]$ sudo dnf groupinstall -y 'Development Tools'<br/>[opc@ruby ~]$ sudo dnf install -y openssl-devel libffi-devel readline-devel gdbm-devel ncurses-devel libyaml-devel</span></pre><p id="29d2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">值得一提的是，libyaml-devel包在<em class="jn">ol8 _ codeready _ builder</em>yum repo中(参见<a class="ae jo" href="https://serverfault.com/questions/1050246/oracle-linux-8-3-cant-find-libyaml-devel" rel="noopener ugc nofollow" target="_blank">本页</a>了解更多信息)，这也是启用它的原因。上面的命令将安装相当多的包，所以在它完成它的工作时，请耐心等待。现在我们可以构建Ruby运行时了，让我们安装我们的第一个Ruby运行时。</p><h1 id="5cbb" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">使用rbenv安装Ruby</h1><p id="8d9f" class="pw-post-body-paragraph ip iq hh ir b is kn iu iv iw ko iy iz ja kp jc jd je kq jg jh ji kr jk jl jm ha bi translated">注意系统上还没有安装Ruby运行时:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="bd14" class="lb jq hh kx b fi lc ld l le lf">[opc@ruby ~]$ ruby -v<br/>-bash: ruby: command not found<br/>[opc@ruby ~]$</span></pre><p id="1e7f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">让我们解决这个问题。rbenv允许设置一个全局的(系统范围的，默认的)Ruby运行时，以及为一个给定的目录(比如项目/应用程序)安装一个特定的Ruby运行时的选项。对于我们的需求，让我们只设置一个单一的，全局的运行时。首先，您需要确定可用的最新运行时版本:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="120a" class="lb jq hh kx b fi lc ld l le lf">[opc@ruby ~]$ rbenv install -l<br/>2.6.9<br/>2.7.5<br/>3.0.3<br/>3.1.0<br/>jruby-9.3.3.0<br/>mruby-3.0.0<br/>rbx-5.0<br/>truffleruby-22.0.0.2<br/>truffleruby+graalvm-22.0.0.2</span><span id="8f08" class="lb jq hh kx b fi lg ld l le lf">Only latest stable releases for each Ruby implementation are shown.<br/>Use 'rbenv install --list-all / -L' to show all local versions.<br/>[opc@ruby ~]$</span></pre><p id="ce08" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这些是我写这篇文章时可用的内容——在您的机器上运行时，您可能会看到不同的输出。对我来说，我打算安装3.1.0(你可以根据自己的喜好选择最新的版本)。</p><blockquote class="lh li lj"><p id="f995" class="ip iq jn ir b is it iu iv iw ix iy iz lk jb jc jd ll jf jg jh lm jj jk jl jm ha bi translated">警告:版本不断变化。为您的环境选择正确的版本(可能与本文中显示的版本不同)。</p></blockquote><h1 id="46d4" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">注意:dtrace</h1><p id="2099" class="pw-post-body-paragraph ip iq hh ir b is kn iu iv iw ko iy iz ja kp jc jd je kq jg jh ji kr jk jl jm ha bi translated">在继续之前…如果您只是尝试运行<em class="jn"> rbenv install </em>您可能会遇到我遇到的阻碍，dtrace会失败:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="d845" class="lb jq hh kx b fi lc ld l le lf">[opc@ruby ~]$ rbenv install 3.1.0<br/>Installing ruby-3.1.0...</span><span id="42b4" class="lb jq hh kx b fi lg ld l le lf">BUILD FAILED (Oracle Linux Server 8.5 using ruby-build 20220125)</span><span id="7f39" class="lb jq hh kx b fi lg ld l le lf">Inspect or clean up the working tree at /tmp/ruby-build.20220126152117.391237.wsPH1J<br/>Results logged to /tmp/ruby-build.20220126152117.391237.log</span><span id="29bf" class="lb jq hh kx b fi lg ld l le lf">Last 10 log lines:<br/>compiling vm_backtrace.c<br/>compiling vm_dump.c<br/>compiling vm_sync.c<br/>compiling vm_trace.c<br/>compiling yjit.c<br/>assembling coroutine/arm64/Context.S<br/>processing probes in object files<br/>dtrace: failed to link script ./probes.d: an error was encountered while processing array.o<br/>DTrace 2.0.0 [Pre-Release with limited functionality]<br/>make: *** [Makefile:469: probes.o] Error 1<br/>[opc@ruby ~]$</span></pre><p id="8fd1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在网上做了一个快速搜索，我找到了这篇文章说要禁用dtrace。</p><h1 id="7ef4" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">向前发展…</h1><p id="ab22" class="pw-post-body-paragraph ip iq hh ir b is kn iu iv iw ko iy iz ja kp jc jd je kq jg jh ji kr jk jl jm ha bi translated">有了必要的上下文注释，让我们继续安装吧！你会注意到这就是我设置<em class="jn"> RUBY_CONFIGURE_OPTS </em>环境变量的原因，该变量在运行<em class="jn">时传递<em class="jn"> — disable-dtrace </em>参数。/配置</em>。</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="e827" class="lb jq hh kx b fi lc ld l le lf">[opc@ruby ~]$ RUBY_CONFIGURE_OPTS="--disable-dtrace" rbenv install -v 3.1.0</span></pre><p id="a0bb" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，rbenv需要将其设置为全局Ruby运行时:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="417f" class="lb jq hh kx b fi lc ld l le lf">[opc@ruby ~]$ rbenv global 3.1.0</span></pre><p id="b7db" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在我们有了一个正常工作的Ruby运行时！看看这个:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="bdc1" class="lb jq hh kx b fi lc ld l le lf">[opc@ruby ~]$ ruby -v<br/>ruby 3.1.0p0 (2021-12-25 revision fb4df44d16) [aarch64-linux]<br/>[opc@ruby ~]$</span></pre><p id="8291" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">耶！让我们稍微重构一下，这样我们可以有一个更短的<em class="jn"> rbenv </em>命令(为shell默认设置RUBY_CONFIGURE_OPTS变量):</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="9121" class="lb jq hh kx b fi lc ld l le lf">[opc@ruby ~]$ echo 'export RUBY_CONFIGURE_OPTS="--disable-dtrace"' &gt;&gt; ~/.bashrc<br/>[opc@ruby ~]$ source ~/.bashrc</span></pre><p id="9e4e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在我们可以用更短的命令运行rbenv:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="9b05" class="lb jq hh kx b fi lc ld l le lf">[opc@ruby ~]$ rbenv install 2.7.5</span></pre><p id="457a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">瞧啊。成功了。因为我们已经将“disable dtrace”标志设置为一个环境变量，所以我们现在可以愉快地忽略它(它一直存在)。这是一段旅程，但不是疯狂的纪念。不过，展示在OCI上使用Oracle Linux快速进行Ruby开发的“简单途径”是值得的。</p><h1 id="233c" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">安装导轨</h1><p id="a8cb" class="pw-post-body-paragraph ip iq hh ir b is kn iu iv iw ko iy iz ja kp jc jd je kq jg jh ji kr jk jl jm ha bi translated">Ruby超级棒……但是如果你在做一个web应用，你可能会想要使用Rails(又名Ruby on Rails，缩写为RoR)框架。有了Ruby的安装，这其实真的很简单！遵循<a class="ae jo" href="https://guides.rubyonrails.org/getting_started.html" rel="noopener ugc nofollow" target="_blank">导轨安装说明</a>，以下是需要的内容:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="4fde" class="lb jq hh kx b fi lc ld l le lf">[opc@ruby ~]$ sudo dnf install -y nodejs</span></pre><p id="25bc" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">需要安装纱线(按照<a class="ae jo" href="https://yarnpkg.com/getting-started/install" rel="noopener ugc nofollow" target="_blank">安装说明</a>):</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="1453" class="lb jq hh kx b fi lc ld l le lf">[opc@ruby ~]$ sudo npm i -g corepack</span></pre><p id="0476" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">让我们安装一些gems Rails所需要的包和库:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="848e" class="lb jq hh kx b fi lc ld l le lf">[opc@ruby ~]$ sudo dnf install sqlite-devel<br/>[opc@ruby ~]$ bundle config set force_ruby_platform true</span></pre><p id="edd9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果不提供第二个命令，nokogiri安装将会失败:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="fd7e" class="lb jq hh kx b fi lc ld l le lf">...<br/>ERROR: It looks like you're trying to use Nokogiri as a precompiled native gem on a system with glibc &lt; 2.17:</span><span id="8730" class="lb jq hh kx b fi lg ld l le lf">/lib64/libm.so.6: version `GLIBC_2.29' not found (required by /home/opc/.rbenv/versions/3.1.0/lib/ruby/gems/3.1.0/gems/nokogiri-1.13.1-aarch64-linux/lib/nokogiri/3.1/nokogiri.so) - /home/opc/.rbenv/versions/3.1.0/lib/ruby/gems/3.1.0/gems/nokogiri-1.13.1-aarch64-linux/lib/nokogiri/3.1/nokogiri.so</span><span id="7775" class="lb jq hh kx b fi lg ld l le lf">If that's the case, then please install Nokogiri via the `ruby` platform gem:<br/>      gem install nokogiri --platform=ruby<br/>  or:<br/>      bundle config set force_ruby_platform true</span><span id="8a0b" class="lb jq hh kx b fi lg ld l le lf">Please visit <a class="ae jo" href="https://nokogiri.org/tutorials/installing_nokogiri.html" rel="noopener ugc nofollow" target="_blank">https://nokogiri.org/tutorials/installing_nokogiri.html</a> for more help.<br/>...</span></pre><p id="ea56" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">看起来我们有glibc 2.28:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="732c" class="lb jq hh kx b fi lc ld l le lf">[opc@ruby ~]$ ldd --version<br/>ldd (GNU libc) 2.28<br/>Copyright (C) 2018 Free Software Foundation, Inc.<br/>This is free software; see the source for copying conditions.  There is NO<br/>warranty; not even for MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.<br/>Written by Roland McGrath and Ulrich Drepper.<br/>[opc@ruby ~]$</span></pre><p id="d8a0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">因此，我们按照指示，告诉bundler使用Ruby平台。您可能会注意到Rails安装指南中的一些内容被跳过了…这是因为系统已经有了它。继续安装Rails gem:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="edde" class="lb jq hh kx b fi lc ld l le lf">[opc@ruby ~]$ gem install rails</span></pre><p id="c945" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">测试以确保可以看到轨道:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="8893" class="lb jq hh kx b fi lc ld l le lf">[opc@ruby ~]$ rails --version<br/>Rails 7.0.1<br/>[opc@ruby ~]$</span></pre><p id="3890" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要创建新的Rails项目:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="b021" class="lb jq hh kx b fi lc ld l le lf">[opc@ruby ~]$ rails new my_app</span></pre><p id="7480" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们点火了！这太棒了——我们现在可以开发一个Rails应用程序了。可能还需要一些其他的东西，这取决于你想做什么(比如使用Redis或者类似的东西，用于turbo流，等等。).你可以从这里接手。可以说，我们已经有了一个坚实的平台来构建下一个优秀的Rails应用程序！！！</p><h1 id="0387" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">自动化这项工作</h1><p id="175e" class="pw-post-body-paragraph ip iq hh ir b is kn iu iv iw ko iy iz ja kp jc jd je kq jg jh ji kr jk jl jm ha bi translated">这可以作为计算实例的云初始化的一部分自动完成。这可以在启动计算实例时直接复制并粘贴到OCI控制台中。以下是如何做到这一点。创建计算实例时，在单击“创建”按钮之前，请单击“显示高级选项”(位于屏幕底部):</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div class="er es ln"><img src="../Images/8d47eacd4b307ab698c485d8708e15d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*bRCfh6PXPm-oTDs6dzq5PA.png"/></div></figure><p id="b027" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然后在“管理”选项卡中，选择“粘贴云-初始化脚本”单选按钮(在“初始化脚本”标题下):</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div class="er es lo"><img src="../Images/c748de1f2c03c39f4fae9dc812a241fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*lxVO3mO_MIprmWER9BRzXw.png"/></div></figure><p id="425c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">并将以下文本粘贴到文本框中:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="d527" class="lb jq hh kx b fi lc ld l le lf">#cloud-config</span><span id="3566" class="lb jq hh kx b fi lg ld l le lf">runcmd:<br/>  - dnf config-manager --set-enabled ol8_codeready_builder<br/>  - dnf update -y &amp;&amp; dnf upgrade -y<br/>  - dnf groupinstall -y 'Development Tools'<br/>  - dnf install -y openssl-devel libffi-devel readline-devel gdbm-devel ncurses-devel libyaml-devel<br/>  - su - opc -c "curl -fsSL <a class="ae jo" href="https://github.com/rbenv/rbenv-installer/raw/HEAD/bin/rbenv-installer" rel="noopener ugc nofollow" target="_blank">https://github.com/rbenv/rbenv-installer/raw/HEAD/bin/rbenv-installer</a> | bash"<br/>  - su - opc -c "echo 'PATH=\$HOME/.rbenv/bin:\$PATH' &gt;&gt; ~/.bashrc"<br/>  - su - opc -c "echo 'export PATH' &gt;&gt; ~/.bashrc"<br/>  - su - opc -c "echo 'eval \"\$(rbenv init - bash)\"' &gt;&gt; ~/.bash_profile"<br/>  - su - opc -c "echo 'export RUBY_CONFIGURE_OPTS=\"--disable-dtrace\"' &gt;&gt; ~/.bashrc"<br/>  # update this to whatever version of Ruby you'd like installed (this will be outdated and potentially unsafe very quickly)<br/>  - su - opc -c "rbenv install 3.1.0"<br/>  - su - opc -c "rbenv global 3.1.0"<br/>  # begin Rails part - remove if not needed<br/>  - dnf install -y nodejs sqlite-devel<br/>  - npm i -g corepack<br/>  - su - opc -c "bundle config set force_ruby_platform true"<br/>  - su - opc -c "gem install rails"<br/>  # let us know things are all done<br/>  - su - opc -c "echo '1' &gt;&gt; ~/cloud-init-status.txt"</span></pre><p id="ecbd" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这会将上述内容传递给实例。如果您愿意，可以将其嵌入到计算实例的Terraform资源定义中:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="d354" class="lb jq hh kx b fi lc ld l le lf">resource "oci_core_instance" "my_compute" {<br/>  ...<br/>  metadata {<br/>      ...<br/>      user_data = "${base64encode(file("ror.tpl"))}"<br/>      ...<br/>  }<br/>  ...<br/>}</span></pre><p id="3c2a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">下面是<em class="jn"> ror.tpl </em>文件中的内容(注意，它与上面的内容相同——我们在创建实例时会将它复制到OCI控制台中):</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="ec4f" class="lb jq hh kx b fi lc ld l le lf">#cloud-config</span><span id="7500" class="lb jq hh kx b fi lg ld l le lf">runcmd:<br/>  - dnf config-manager --set-enabled ol8_codeready_builder<br/>  - dnf update -y &amp;&amp; dnf upgrade -y<br/>  - dnf groupinstall -y 'Development Tools'<br/>  - dnf install -y openssl-devel libffi-devel readline-devel gdbm-devel ncurses-devel libyaml-devel<br/>  - su - opc -c "curl -fsSL <a class="ae jo" href="https://github.com/rbenv/rbenv-installer/raw/HEAD/bin/rbenv-installer" rel="noopener ugc nofollow" target="_blank">https://github.com/rbenv/rbenv-installer/raw/HEAD/bin/rbenv-installer</a> | bash"<br/>  - su - opc -c "echo 'PATH=\$HOME/.rbenv/bin:\$PATH' &gt;&gt; ~/.bashrc"<br/>  - su - opc -c "echo 'export PATH' &gt;&gt; ~/.bashrc"<br/>  - su - opc -c "echo 'eval \"\$(rbenv init - bash)\"' &gt;&gt; ~/.bash_profile"<br/>  - su - opc -c "echo 'export RUBY_CONFIGURE_OPTS=\"--disable-dtrace\"' &gt;&gt; ~/.bashrc"<br/>  # update this to whatever version of Ruby you'd like installed (this will be outdated and potentially unsafe very quickly)<br/>  - su - opc -c "rbenv install 3.1.0"<br/>  - su - opc -c "rbenv global 3.1.0"<br/>  # begin Rails part - remove if not needed<br/>  - dnf install -y nodejs sqlite-devel<br/>  - npm i -g corepack<br/>  - su - opc -c "bundle config set force_ruby_platform true"<br/>  - su - opc -c "gem install rails"<br/>  # let us know things are all done<br/>  - su - opc -c "echo '1' &gt;&gt; ~/cloud-init-status.txt"</span></pre><p id="e8f5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最终结果是一样的:您得到了一个功能完整、随时可用的OCI计算实例，Ruby、rbenv和Rails都已准备就绪。如果你不想要Rails，省略这部分…你明白了。</p><p id="b6a5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您以前没有经常使用它，请知道cloud-init在后台运行(很大程度上是静默的)，这就是为什么我们在完成所有操作后会写入文件。它会很高兴地在后台运行一段时间。如果你想监视它在做什么，试试这个:</p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="4ad9" class="lb jq hh kx b fi lc ld l le lf">[opc@ruby ~]$ sudo tail -f /var/log/cloud-init-output.log</span></pre><p id="d8df" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这会告诉你它在做什么。在之后，可能需要几分钟<em class="jn">来完成实例的创建。耐心是关键，但是请放心，您将在几分钟内获得一个现成的实例。如果在</em> cloud-init完全完成后，您没有打开一个<em class="jn">新的</em> shell会话<em class="jn">，请不要忘记运行:</em></p><pre class="ks kt ku kv fd kw kx ky kz aw la bi"><span id="c57c" class="lb jq hh kx b fi lc ld l le lf">[opc@ruby ~]$ source ~/.bash_profile</span></pre><p id="a1c7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">否则，您可以退出您的shell(可能是SSH)会话并启动一个新的会话，此时您应该可以访问Ruby并准备好运行了！</p><h1 id="4192" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">结论</h1><p id="c252" class="pw-post-body-paragraph ip iq hh ir b is kn iu iv iw ko iy iz ja kp jc jd je kq jg jh ji kr jk jl jm ha bi translated">我们现在已经有了一个很好的Ruby开发平台。我们不仅可以手动设置，而且有一种全自动的方式来实现这一点。多酷啊。！直到下一次，快乐编码，保持位流！</p><h1 id="b117" class="jp jq hh bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">加入对话！</h1><p id="1746" class="pw-post-body-paragraph ip iq hh ir b is kn iu iv iw ko iy iz ja kp jc jd je kq jg jh ji kr jk jl jm ha bi translated">如果你对甲骨文开发人员在他们的自然栖息地发生的事情感到好奇，请加入我们的<a class="ae jo" href="https://oracledevrel.slack.com/join/shared_invite/zt-uffjmwh3-ksmv2ii9YxSkc6IpbokL1g#/shared-invite/email" rel="noopener ugc nofollow" target="_blank">公共休闲频道</a>！我们不介意成为你的鱼缸🐠</p></div></div>    
</body>
</html>