<html>
<head>
<title>How to Learn React #5 — Quick Introduction to Component State</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何学习React #5 —组件状态快速介绍</h1>
<blockquote>原文：<a href="https://medium.com/quick-code/lets-learn-react-chapter-5-component-state-f9eccc8df2cf?source=collection_archive---------0-----------------------#2018-02-12">https://medium.com/quick-code/lets-learn-react-chapter-5-component-state-f9eccc8df2cf?source=collection_archive---------0-----------------------#2018-02-12</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/169ddc681d5c7de65d9ffe77087409fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cx88IOHNXLLxt3VqlvN4Ig.png"/></div></div></figure><p id="f222" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">亲爱的读者你好！如果你阅读了本系列的前几章，你应该已经对组件非常熟悉了。如果没有，请继续阅读！我保证你不会后悔的。如果你给我发邮件，我会补偿你浪费的时间。顾名思义，本章我们将讨论组件状态。我知道我应该从一开始就描述它是什么，但首先让我们为自己创造一些挑战。到目前为止，我们的应用程序告诉我们今天是哪一天，以及我们今天是否应该工作。我不知道你怎么想，但我认为它可以做得更好。假设我们想给我们的应用程序添加新功能。在我们的应用程序中，我们希望能够添加我今天打算吃的食物。就这么简单。它会是什么样子。我们将有单独的组件，这个组件将包含1个文本输入，1个按钮和一个项目列表。当我们点击按钮时，来自文本输入的项目将被添加到项目列表中。好了，让我们翻到编辑器，创建这个组件。</p><p id="0b6f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在<em class="jo">组件</em>目录中，我将创建名为<em class="jo"> MealPlan.js </em>的新文件，我还将添加基本组件结构。它看起来会像这样</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="9a48" class="jy jz hh ju b fi ka kb l kc kd">import React, { Component } from 'react';</span><span id="3fb9" class="jy jz hh ju b fi ke kb l kc kd">class MealPlan extends Component {<br/>  render() {<br/>  }<br/>}</span><span id="eebf" class="jy jz hh ju b fi ke kb l kc kd">export default MealPlan;</span></pre><p id="425c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">目前我还不知道什么新奇的东西。我们现在继续添加文本输入按钮和列表，我已经开始添加了。我还为组件添加了标题，但这不是必需的。我们的<em class="jo"> MealPlan.js </em>看起来会像这样</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="cb51" class="jy jz hh ju b fi ka kb l kc kd">import React, { Component } from 'react';</span><span id="9d6f" class="jy jz hh ju b fi ke kb l kc kd">class MealPlan extends Component {<br/>  render() {<br/>    return(<br/>      &lt;div&gt;<br/>        &lt;h2&gt;Today you should eat this&lt;/h2&gt;<br/>        &lt;input type="text" /&gt;<br/>        &lt;button&gt;Add meal&lt;/button&gt;<br/>        &lt;ul&gt;<br/>          &lt;li&gt;Spaghetti&lt;/li&gt;<br/>          &lt;li&gt;Ice cream&lt;/li&gt;<br/>        &lt;/ul&gt;<br/>      &lt;/div&gt;<br/>    );<br/>  }<br/>}</span><span id="b2b8" class="jy jz hh ju b fi ke kb l kc kd">export default MealPlan;</span></pre><p id="472b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">好的，这里有文本输入，这里有按钮，还有餐单。到目前为止，列表中的值是硬编码的，但不要担心，我们会改变这一点。你可能在想。好的，我们需要在某个地方存放餐食清单。还是想知道？我希望你…相信我，这是个好兆头。为了回答这个问题，我们将以组件状态存储用餐列表。所以我们要做两件事，不，让我们做三件事。首先，我要解释什么是组件状态。让我们现在做那件事。</p><p id="4c17" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">react中的每个组件都有自己的状态，你可以用它来描述你的组件。我们的组件将在它的状态列表中存储食物。我希望这没什么难懂的。我们可以操作组件状态，我们可以添加、删除或修改它们。然而重要的是，每次状态改变时，组件被重新呈现。如果这些都不能让你想起什么，我很确定当我们使用它的时候会的。所以不要再用无聊的理论浪费时间了，让我们更进一步。</p><p id="3178" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">第二，我们要定义组件状态。将<code class="du kf kg kh ju b">state = {meals: []};</code>添加到<em class="jo"> MealPlan </em>类的正下方，以确保它应该在这里</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="a1b8" class="jy jz hh ju b fi ka kb l kc kd">class MealPlan extends Component {<br/>  state = {meals: []};</span></pre><p id="81c4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">就这么简单。我们告诉我们的组件将在它的状态下存储膳食，并且膳食在开始时是空数组。继续第三件事。现在我们在渲染方法中有硬编码的食物，你会猜到我们会改变它。在render方法中，我们希望迭代一组饭菜，并将每一份都写入饭菜列表。为此，我们将使用名为lodash的库—<a class="ae jn" href="https://lodash.com" rel="noopener ugc nofollow" target="_blank">https://lodash.com</a>。打开终端和内部应用程序目录运行<code class="du kf kg kh ju b">npm install — save lodash</code>安装好所有东西后，我们需要退出我们的开发服务器并重新启动它。好了，现在让我们开始实现饭菜的渲染。在MealPlan.js中，我们将添加一个导入语句<code class="du kf kg kh ju b">import _ from 'lodash';</code>,然后我们将添加一个名为<em class="jo"> renderMeals </em>的新函数，它看起来像这样</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="6315" class="jy jz hh ju b fi ka kb l kc kd">renderMeals() {<br/>    return _.map(this.state.meals, meal =&gt; &lt;li&gt;{meal}&lt;/li&gt;);<br/>}</span></pre><p id="4429" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这里我使用了lodash库的<em class="jo"> map </em>函数。基本上这个函数有两个参数。第一个要迭代的集合，第二个是告诉我要对每一项做什么的函数。我在函数中说，对于每顿饭，我想返回新的<code class="du kf kg kh ju b">&lt;li&gt;</code>元素，其中包含饭菜的名称。现在我们可以在render中调用这个函数，我们的组件看起来会像这样</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="5b7e" class="jy jz hh ju b fi ka kb l kc kd">import React, { Component } from 'react';<br/>import _ from 'lodash';</span><span id="bbdb" class="jy jz hh ju b fi ke kb l kc kd">class MealPlan extends Component {<br/>  state = {meals: []};</span><span id="9f63" class="jy jz hh ju b fi ke kb l kc kd">renderMeals() {<br/>    return _.map(this.state.meals, meal =&gt; &lt;li&gt;{meal}&lt;/li&gt;);<br/>  }</span><span id="154e" class="jy jz hh ju b fi ke kb l kc kd">render() {<br/>    return(<br/>      &lt;div&gt;<br/>        &lt;h2&gt;Today you should eat this&lt;/h2&gt;<br/>        &lt;input type="text" /&gt;<br/>        &lt;button&gt;Add meal&lt;/button&gt;<br/>        &lt;ul&gt;<br/>          {this.renderMeals()}<br/>        &lt;/ul&gt;<br/>      &lt;/div&gt;<br/>    );<br/>  }<br/>}</span><span id="b6d5" class="jy jz hh ju b fi ke kb l kc kd">export default MealPlan;</span></pre><p id="bbe6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">好的…目前为止我们看起来不错。但是我们有一个问题。我们不知道文本输入的价值。我们不能说用户真正输入了什么。正如您所猜测的，我们将把这些信息存储到我们的州。让我们继续扩展我们的状态，如下所示</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="ec97" class="jy jz hh ju b fi ka kb l kc kd">state = {<br/>    meal: '',<br/>    meals: []<br/>};</span></pre><p id="82cd" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，我们需要确保当输入改变时，状态被正确地更新，并且输入与我们的状态一致。我们要这样做，通过改变我们的输入看起来像这样</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="0cc9" class="jy jz hh ju b fi ka kb l kc kd">&lt;input onChange={e =&gt; this.setState({meal: e.target.value})} value={this.state.meal} type="text" /&gt;</span></pre><p id="ec49" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如你所见，我添加了<em class="jo"> value </em>属性，我是说这个输入的值应该等于该州的meal。而且我加了<em class="jo"> onChange。每次输入改变时都会调用OnChange </em>。每次我提供的函数都会被调用。所以当你检查这个函数时</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="502f" class="jy jz hh ju b fi ka kb l kc kd">e =&gt; this.setState({meal: e.target.value})</span></pre><p id="19d7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">它只从输入中取值并存储到状态中。现在，当我们单击按钮时，我们希望从state中获取膳食值，并将其添加到out state中的膳食列表中。每个按钮元素都有方法<em class="jo"> onClick </em>，当按钮被点击时调用该方法。我们将在这个<em class="jo"> onClick </em>方法中实现我们的逻辑。我们可以将按钮修改成这样，我们完成的组件<em class="jo"> MealPlan.js </em>将会是这样</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="c847" class="jy jz hh ju b fi ka kb l kc kd">import React, { Component } from 'react';<br/>import _ from 'lodash';</span><span id="e734" class="jy jz hh ju b fi ke kb l kc kd">class MealPlan extends Component {<br/>  state = {<br/>    meal: '',<br/>    meals: []<br/>  };</span><span id="eff4" class="jy jz hh ju b fi ke kb l kc kd">renderMeals() {<br/>    return _.map(this.state.meals, meal =&gt; &lt;li&gt;{meal}&lt;/li&gt;);<br/>  }</span><span id="6c3f" class="jy jz hh ju b fi ke kb l kc kd">render() {<br/>    return(<br/>      &lt;div&gt;<br/>        &lt;h2&gt;Today you should eat this&lt;/h2&gt;<br/>        &lt;input <br/>          onChange={e =&gt; this.setState({meal: e.target.value})} <br/>          value={this.state.meal} <br/>          type="text" <br/>        /&gt;<br/>        &lt;button <br/>          onClick={() =&gt; this.setState({meals: [...this.state.meals, this.state.meal]})}&gt;<br/>          Add meal&lt;/button&gt;<br/>        &lt;ul&gt;<br/>          {this.renderMeals()}<br/>        &lt;/ul&gt;<br/>      &lt;/div&gt;<br/>    );<br/>  }<br/>}</span><span id="9b8c" class="jy jz hh ju b fi ke kb l kc kd">export default MealPlan;</span></pre><p id="9402" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">所以我们给<em class="jo"> onClick </em>增加了函数。在那里我们称之为<em class="jo"> setState </em>。正如你所猜测的，它改变了状态，当状态改变时，组件被重新渲染。这基本上就是我们想要的。</p><pre class="jp jq jr js fd jt ju jv jw aw jx bi"><span id="a394" class="jy jz hh ju b fi ka kb l kc kd">[...this.state.meals, this.state.meal]</span></pre><p id="6b6e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">你可能会问为什么要使用这种奇怪的语法，这是个很好的问题。老实说，这一章太长了，所以我会在下一章回答。感谢阅读，并希望你有一个伟大的一天。干杯！</p></div></div>    
</body>
</html>