<html>
<head>
<title>Distributed tracing for microservices on Oracle Cloud with Spring Cloud Sleuth and Zipkin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Spring Cloud Sleuth和Zipkin对Oracle云上的微服务进行分布式跟踪</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/distributed-tracing-for-microservices-on-oracle-cloud-with-spring-cloud-sleuth-and-zipkin-b67158ebb34a?source=collection_archive---------0-----------------------#2018-02-06">https://medium.com/oracledevs/distributed-tracing-for-microservices-on-oracle-cloud-with-spring-cloud-sleuth-and-zipkin-b67158ebb34a?source=collection_archive---------0-----------------------#2018-02-06</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><blockquote class="ie if ig"><p id="0f18" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated">有关微服务主题的博客帖子的主目录，请参考—<a class="ae jg" rel="noopener" href="/oracledevs/bunch-of-microservices-related-blogs-57b5f1f062e5">https://medium . com/Oracle devs/bunch-of-microservice-related-blogs-57 b5 f1 f 062 e 5</a></p></blockquote><p id="f390" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">好了，现在你有了一个云原生/微服务风格的架构，其中有多个服务相互协作来实现某个目标……太棒了！</p><p id="c443" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">调试和故障排除可能会很困难</p><ul class=""><li id="cb28" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated">多个(微)服务——每个服务做自己的事情</li><li id="26cb" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">每个服务有多个实例——毕竟，我们的服务是无状态的，可水平扩展的！</li><li id="b43a" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">有时，您甚至可能无法访问底层机器/虚拟机/节点，而只能通过特定于供应商/产品的方式来访问应用程序日志</li><li id="c745" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">等等。</li></ul><p id="8c64" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">上述限制没有任何问题——事实上，它们对于一般的分布式应用(无论是否是微服务)来说都是不可避免的，尤其是当它们在托管的PaaS(平台即服务)环境中运行时</p><p id="e1a2" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">那么，当涉及到深入的应用程序级可见性时，我们可以做些什么来使事情变得更容易和可管理呢？没有灵丹妙药，但是<strong class="ik hi">分布式跟踪</strong>是一个工具，如果使用得当，可以帮助我们</p></div><div class="ab cl jy jz go ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ha hb hc hd he"><p id="e9ed" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">这篇博客展示了<a class="ae jg" href="https://projects.spring.io/spring-boot/" rel="noopener ugc nofollow" target="_blank"> Spring Boot </a>应用程序利用<a class="ae jg" href="https://cloud.spring.io/spring-cloud-sleuth/" rel="noopener ugc nofollow" target="_blank"> Spring Cloud Sleuth </a>跟踪应用程序级别的事务，并将跟踪信息传输到远程<a class="ae jg" href="https://zipkin.io/" rel="noopener ugc nofollow" target="_blank"> Zipkin </a>服务器</p><blockquote class="ie if ig"><p id="aba0" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated">虽然重点是基于Java的应用程序，但是这个概念适用于任何能够以OpenZipkin格式生成跟踪数据的系统/服务</p></blockquote><p id="7e31" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated"><strong class="ik hi"> Oracle应用程序容器云</strong>作为运行时</p><ul class=""><li id="232e" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated"><code class="du kf kg kh ki b"><strong class="ik hi">Zipkin </strong></code>服务器和…</li><li id="5a14" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">…以及Spring Boot应用程序— <code class="du kf kg kh ki b">inventory </code>和<code class="du kf kg kh ki b">product</code>(我们将继续使用我们在<a class="ae jg" rel="noopener" href="/oracledevs/microservices-service-discovery-on-oracle-cloud-with-spring-cloud-and-zookeeper-627e6bb59ea2">之前的一篇博客</a>中使用的同一组应用程序，只做了一些小的修改来演示这个概念)</li></ul><div class="kj kk ez fb kl km"><a href="https://cloud.oracle.com/application-container-cloud" rel="noopener  ugc nofollow" target="_blank"><div class="kn ab dw"><div class="ko ab kp cl cj kq"><h2 class="bd hi fi z dy kr ea eb ks ed ef hg bi translated">应用容器云| ACC | Oracle云</h2><div class="kt l"><h3 class="bd b fi z dy kr ea eb ks ed ef dx translated">云中的Java标准版和Node.js。</h3></div><div class="ku l"><p class="bd b fp z dy kr ea eb ks ed ef dx translated">cloud.oracle.com</p></div></div><div class="kv l"><div class="kw l kx ky kz kv la lb km"/></div></div></a></div></div><div class="ab cl jy jz go ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ha hb hc hd he"><h1 id="bcb0" class="lc ld hh bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">体系结构</h1><blockquote class="ie if ig"><p id="0d27" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated"><em class="hh">Github上有示例应用</em></p></blockquote><div class="kj kk ez fb kl km"><a href="https://github.com/abhirockzz/accs-spring-boot-zipkin-distributed-tracing" rel="noopener  ugc nofollow" target="_blank"><div class="kn ab dw"><div class="ko ab kp cl cj kq"><h2 class="bd hi fi z dy kr ea eb ks ed ef hg bi translated">abhirockzz/accs-spring-boot-zipkin-分布式跟踪</h2><div class="kt l"><h3 class="bd b fi z dy kr ea eb ks ed ef dx translated">在GitHub上创建一个账号，为accs-spring-boot-zipkin-distributed-tracing开发做贡献。</h3></div><div class="ku l"><p class="bd b fp z dy kr ea eb ks ed ef dx translated">github.com</p></div></div><div class="kv l"><div class="ma l kx ky kz kv la lb km"/></div></div></a></div><p id="dd62" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">下图提供了一个高层次的概述</p><figure class="mc md me mf fd mg er es paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="er es mb"><img src="../Images/980931fe6748137ba97bf3ba8a708ff8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KHeAnct847lqe3WvQ9sAEA.jpeg"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx">High level architecture</figcaption></figure><p id="7b8b" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">非常简单——多亏了Spring Cloud Sleuth (Zipkin模块),单个Spring Boot应用程序将交易数据(跟踪)发送到Zipkin，然后可以使用Zipkin自己提供的仪表板查看这些数据</p><p id="47de" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">以下是组件/服务的摘要</p><h2 id="9d99" class="mq ld hh bd le mr ms mt li mu mv mw lm jh mx my lq ji mz na lu jj nb nc ly nd bi translated">齐普金</h2><p id="341e" class="pw-post-body-paragraph ih ii hh ik b il ne in io ip nf ir is jh ng iv iw ji nh iz ja jj ni jd je jf ha bi translated">Zipkin server是另一个Spring Boot应用程序，它运行在嵌入式Tomcat容器中(在本例中)。这里几乎没有什么要求，除了</p><ul class=""><li id="10e9" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated">使用<code class="du kf kg kh ki b">zipkin-server</code>和<code class="du kf kg kh ki b">zipkin-autoconfigure-ui</code>(用于可视化仪表板)依赖关系，然后…</li><li id="6a6d" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">…在Spring Boot引导类上使用<code class="du kf kg kh ki b"><a class="ae jg" href="http://twitter.com/EnableZipkinServer" rel="noopener ugc nofollow" target="_blank">@EnableZipkinServer</a></code>就可以了！</li></ul><h2 id="0eb0" class="mq ld hh bd le mr ms mt li mu mv mw lm jh mx my lq ji mz na lu jj nb nc ly nd bi translated">库存和产品服务</h2><p id="2453" class="pw-post-body-paragraph ih ii hh ik b il ne in io ip nf ir is jh ng iv iw ji nh iz ja jj ni jd je jf ha bi translated">关于库存和产品服务的详细信息，请参考<em class="ij">关于Oracle Cloud with Spring Cloud和Zookeeper的微服务服务发现</em>博文</p><div class="kj kk ez fb kl km"><a rel="noopener follow" target="_blank" href="/oracledevs/microservices-service-discovery-on-oracle-cloud-with-spring-cloud-and-zookeeper-627e6bb59ea2"><div class="kn ab dw"><div class="ko ab kp cl cj kq"><h2 class="bd hi fi z dy kr ea eb ks ed ef hg bi translated">基于Spring Cloud和Zookeeper的Oracle Cloud微服务服务发现</h2><div class="ku l"><p class="bd b fp z dy kr ea eb ks ed ef dx translated">medium.com</p></div></div><div class="kv l"><div class="nj l kx ky kz kv la lb km"/></div></div></a></div><p id="2b77" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">需要知道的重要事情是</p><ul class=""><li id="8e1b" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated">应用程序使用<code class="du kf kg kh ki b">spring-cloud-starter-sleuth</code>和<code class="du kf kg kh ki b">spring-cloud-sleuth-zipkin</code>模块(在<code class="du kf kg kh ki b"><strong class="ik hi">pom.xml</strong></code>中)</li><li id="3308" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated"><code class="du kf kg kh ki b">application.properties</code>使用<code class="du kf kg kh ki b">spring.zipkin.baseUrl</code>属性指向Zipkin服务器</li><li id="ea85" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">为了简单起见，基于Zookeeper的服务发现<em class="ij">已被排除</em>并专注于单个主题，即<em class="ij">分布式跟踪</em></li><li id="fa73" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">而且它用了<code class="du kf kg kh ki b">RestTemplate </code>而不是<code class="du kf kg kh ki b">FeignClient</code></li></ul></div><div class="ab cl jy jz go ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ha hb hc hd he"><h1 id="d779" class="lc ld hh bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">构建和部署</h1><p id="1baf" class="pw-post-body-paragraph ih ii hh ik b il ne in io ip nf ir is jh ng iv iw ji nh iz ja jj ni jd je jf ha bi translated">首先从Github获取项目— <code class="du kf kg kh ki b">git clone <a class="ae jg" href="https://github.com/abhirockzz/accs-microservices-service-discovery" rel="noopener ugc nofollow" target="_blank">https://github.com/abhirockzz/accs-spring-boot-zipkin-distributed-</a>tracing.git</code></p><h2 id="ac47" class="mq ld hh bd le mr ms mt li mu mv mw lm jh mx my lq ji mz na lu jj nb nc ly nd bi translated">建设</h2><p id="9de9" class="pw-post-body-paragraph ih ii hh ik b il ne in io ip nf ir is jh ng iv iw ji nh iz ja jj ni jd je jf ha bi translated"><strong class="ik hi"> Zipkin服务器</strong></p><ul class=""><li id="ffc0" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated"><code class="du kf kg kh ki b">cd zipkinserver</code></li><li id="c946" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated"><code class="du kf kg kh ki b">mvn clean install</code></li></ul><p id="4cc2" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">构建过程将在<code class="du kf kg kh ki b">target </code>目录中创建<code class="du kf kg kh ki b">zipkin-dist.zip</code></p><p id="a311" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated"><strong class="ik hi">库存服务</strong></p><ul class=""><li id="a8d4" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated"><code class="du kf kg kh ki b">cd inventory</code></li><li id="547e" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated"><code class="du kf kg kh ki b">mvn clean install</code></li></ul><p id="c596" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">构建过程将在<code class="du kf kg kh ki b">target </code>目录中创建<code class="du kf kg kh ki b">inventory-dist.zip</code></p><p id="6367" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated"><strong class="ik hi">产品服务</strong></p><ul class=""><li id="ec4a" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated"><code class="du kf kg kh ki b">cd product</code></li><li id="9545" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated"><code class="du kf kg kh ki b">mvn clean install</code></li></ul><p id="4dce" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">构建过程将在<code class="du kf kg kh ki b">target </code>目录中创建<code class="du kf kg kh ki b">product-dist.zip</code></p><h2 id="c86b" class="mq ld hh bd le mr ms mt li mu mv mw lm jh mx my lq ji mz na lu jj nb nc ly nd bi translated">部署也称为向云推进</h2><p id="2f1d" class="pw-post-body-paragraph ih ii hh ik b il ne in io ip nf ir is jh ng iv iw ji nh iz ja jj ni jd je jf ha bi translated">借助Oracle Application Container Cloud，您在部署应用程序方面有多种选择。本博客将利用<strong class="ik hi"> PSM CLI </strong>，这是一个用于管理Oracle云服务的强大命令行界面</p><blockquote class="ie if ig"><p id="4b77" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated">其他部署选项包括<a class="ae jg" href="https://docs.oracle.com/en/cloud/paas/app-container-cloud/apcsr/index.html" rel="noopener ugc nofollow" target="_blank"> REST API </a>、<a class="ae jg" href="https://docs.oracle.com/en/cloud/paas/developer-cloud/csdcs/deploying-application-oracle-developer-cloud-service.html#GUID-6FE6D850-65DC-471D-A249-F7CCA9CAB56F" rel="noopener ugc nofollow" target="_blank"> Oracle开发人员云</a>，当然还有<a class="ae jg" href="https://docs.oracle.com/en/cloud/paas/app-container-cloud/csjse/creating-application.html" rel="noopener ugc nofollow" target="_blank">控制台/UI </a></p></blockquote><p id="89eb" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">您可以在您的机器上下载并设置PSM CLI(使用<code class="du kf kg kh ki b">psm setup</code>)——<a class="ae jg" href="https://docs.oracle.com/en/cloud/paas/java-cloud/pscli/using-command-line-interface-1.html" rel="noopener ugc nofollow" target="_blank">详情请点击</a></p><p id="326a" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">首先从部署Zipkin服务器应用程序开始，因为我们的两个微服务都依赖于它</p><ul class=""><li id="66d8" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated"><strong class="ik hi">齐普金</strong>——<code class="du kf kg kh ki b">psm accs push -n zipkin -r java -s hourly -m manifest.json -d deployment.json -p target/zipkin-dist.zip</code></li></ul><p id="ccd0" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">一旦Zipkin启动并运行，记下它在Oracle Application Container Cloud的<strong class="ik hi">应用</strong>页面中的URL(下面突出显示)</p><figure class="mc md me mf fd mg er es paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="er es nk"><img src="../Images/4168708093a106632cb7fd4fd8317b0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I1b_Xsfk2o4IwWFWNoy04w.png"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx"><strong class="bd le">Zipkin </strong>server deployed</figcaption></figure><p id="fc2a" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">现在，更新<code class="du kf kg kh ki b">inventory</code>应用的<code class="du kf kg kh ki b">deployment.json</code>,输入Zipkin服务器信息</p><pre class="mc md me mf fd nl ki nm nn aw no bi"><span id="04d6" class="mq ld hh ki b fi np nq l nr ns">{<br/> "memory": "2G",<br/> "instances": 1,<br/> "environment":{<br/> <strong class="ki hi">"ZIPKIN":"&lt;ZIPKIN_URL&gt;"</strong><br/> }<br/>}</span></pre><ul class=""><li id="fc07" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated"><strong class="ik hi">库存服务</strong> — <code class="du kf kg kh ki b">psm accs push -n inventory -r java -s hourly -m manifest.json -d deployment.json -p target/inventory-dist.zip</code></li></ul><p id="5dd2" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">记下URL，因为它将在产品服务中使用</p><figure class="mc md me mf fd mg er es paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="er es nt"><img src="../Images/af76d77d1f018e55cc64f62da1710d78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cfhHgfzjEWYh0nkmWpTHjA.png"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx"><strong class="bd le">inventory </strong>service deployed</figcaption></figure><p id="2b90" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">更新产品应用程序的<code class="du kf kg kh ki b">deployment.json</code>,以包括<code class="du kf kg kh ki b">inventory </code>和<code class="du kf kg kh ki b">zipkin </code>坐标</p><pre class="mc md me mf fd nl ki nm nn aw no bi"><span id="376d" class="mq ld hh ki b fi np nq l nr ns">{<br/> "memory": "2G",<br/> "instances": 1,<br/> environment":{<br/> <strong class="ki hi">"INVENTORY_SERVICE":"&lt;INVENTORY_APP_URL&gt;",<br/> "ZIPKIN":"&lt;ZIPKIN_URL&gt;"</strong><br/> }<br/>}</span></pre><ul class=""><li id="41a8" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated"><strong class="ik hi">产品服务</strong> — <code class="du kf kg kh ki b"> psm accs push -n product -r java -s hourly -m manifest.json -d deployment.json -p target/product-dist.zip</code></li></ul><figure class="mc md me mf fd mg er es paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="er es nu"><img src="../Images/e40a62d128424d54c73d37ffa1c1f2d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jZPXTZK6z7sAKOxmPU3w2Q.png"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx">Spring Boot (<strong class="bd le">product</strong>) service deployed</figcaption></figure><p id="8985" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">一切都准备好了，我们可以看到事情的进展…</p></div><div class="ab cl jy jz go ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ha hb hc hd he"><h1 id="6247" class="lc ld hh bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">试车</h1><p id="2a85" class="pw-post-body-paragraph ih ii hh ik b il ne in io ip nf ir is jh ng iv iw ji nh iz ja jj ni jd je jf ha bi translated">访问Zipkin服务器—记下应用程序的URL，例如<code class="du kf kg kh ki b"><a class="ae jg" href="https://zipkin-ocloud200.uscom-central-1.oraclecloud.com" rel="noopener ugc nofollow" target="_blank">https://zipkin-&lt;mydomain&gt;.apaas.us2.oraclecloud.com</a></code></p><figure class="mc md me mf fd mg er es paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="er es nv"><img src="../Images/703973c31e9c41a430af3dfd4f795095.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZTWfyHOD4paFXZFV1McrVw.png"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx">Zipkin on Oracle Application Container Cloud</figcaption></figure><h2 id="50fe" class="mq ld hh bd le mr ms mt li mu mv mw lm jh mx my lq ji mz na lu jj nb nc ly nd bi translated">快乐之路</h2><p id="d1e7" class="pw-post-body-paragraph ih ii hh ik b il ne in io ip nf ir is jh ng iv iw ji nh iz ja jj ni jd je jf ha bi translated">首先，调用几次产品服务端点</p><p id="adb2" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">例如<code class="du kf kg kh ki b">curl -X <a class="ae jg" href="https://ProductService-ocloud100.apaas.us2.oraclecloud.com/product/iphone2" rel="noopener ugc nofollow" target="_blank">https://product-ocloud100.apaas.us2.oraclecloud.com/product/iPhone</a>X</code>和<code class="du kf kg kh ki b">curl -X <a class="ae jg" href="https://ProductService-ocloud100.apaas.us2.oraclecloud.com/product/iphone2" rel="noopener ugc nofollow" target="_blank">https://product-ocloud100.apaas.us2.oraclecloud.com/product/</a>AppleWatch</code></p><p id="abac" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">产品服务在内部调用库存服务来返回JSON响应</p><pre class="mc md me mf fd nl ki nm nn aw no bi"><span id="173c" class="mq ld hh ki b fi np nq l nr ns">{"name":"iPhoneX","description":"Description for iPhoneX","stock":{"inventory":8,"node":"7e8127f0-c1a6-41db-b893-b786b773590b_67000ba4-ee1f-405c-9249-37ecd56b705d"}}</span></pre><p id="a9c1" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">让我们跳到Zipkin仪表板，查询最新的跟踪(通过点击<strong class="ik hi"> Find Traces </strong>)</p><figure class="mc md me mf fd mg er es paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="er es nw"><img src="../Images/bedb70fd081ec6f3c07fcc749654a405.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kJpxH6cCYNyHww2Qpo6r-w.png"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx"><strong class="bd le">Query </strong>transactions in Zipkin</figcaption></figure><p id="9a44" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated"><strong class="ik hi">对应于我们的调用，生成了两个独立的事务</strong>(突出显示)</p><p id="79b2" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">值得注意的要点</p><ul class=""><li id="3c82" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated">每个交易被分成<strong class="ik hi"> 2个区间</strong></li><li id="7b49" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">每个跨度由<strong class="ik hi">服务跳</strong>产生，即产品服务调用库存服务</li><li id="2797" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">您还可以准确地看到<em class="ij">库存服务在总时间方面贡献了多少时间</em>，即在第一个事务中，库存服务花费了7137 ms ( <strong class="ik hi"> 7.137秒</strong>)，而调用花费了<strong class="ik hi"> 8.06秒</strong></li><li id="3b4b" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">通过服务过滤将会给你花费的时间的百分比</li></ul><p id="4dd6" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated"><strong class="ik hi">过滤</strong>只是通过<strong class="ik hi">库存</strong>服务然后查询Zipkin，这就是你将会看到的——大约<strong class="ik hi"> 88% </strong>的时间都花在库存服务上了(在第一个事务中)</p><figure class="mc md me mf fd mg er es paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="er es nx"><img src="../Images/0e5b62e32b2a2cea4b9cc8de2a94723d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*auM9XEJFrXDP_rERgxe7dg.png"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx"><strong class="bd le">Filter </strong>by application in Zipkin</figcaption></figure><p id="6b24" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">让我们通过单击第一个事务来更深入地了解一个特定的事务——这将为您提供一个详细的划分，调用的顺序也很明显</p><figure class="mc md me mf fd mg er es paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="er es ny"><img src="../Images/7a095baff1b65e7ce5c2128c28e5d4bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gnR16d603QDXXD_D5eHqeA.png"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx">Spawned spans</figcaption></figure><p id="f7a6" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">单击产品范围将会显示更多细节，如调用时间表和HTTP请求信息</p><figure class="mc md me mf fd mg er es paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="er es nz"><img src="../Images/38d4fac9531b39bbe4a3c6531f9a5ebe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ee6RiFjPDq027DZ7Ztvlkw.png"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx">Parent transaction (<strong class="bd le">product </strong>service)</figcaption></figure><p id="fa45" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">请注意下面屏幕截图中的父事务ID</p><figure class="mc md me mf fd mg er es paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="er es oa"><img src="../Images/e306d1b8a0249ece8cf138a33c9a3594.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TAy57PzBpbRqtUTZGza_tQ.png"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx">child transaction (<strong class="bd le">inventory </strong>service)</figcaption></figure><p id="5923" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">到目前为止一切顺利——让我们<strong class="ik hi">停止</strong>库存服务，看看会发生什么，并向Zipkin寻求帮助！</p><h2 id="fa05" class="mq ld hh bd le mr ms mt li mu mv mw lm jh mx my lq ji mz na lu jj nb nc ly nd bi translated">失败案例</h2><p id="d214" class="pw-post-body-paragraph ih ii hh ik b il ne in io ip nf ir is jh ng iv iw ji nh iz ja jj ni jd je jf ha bi translated">停止(使用命令行界面)——<code class="du kf kg kh ki b">psm accs <strong class="ik hi">stop </strong>-n inventory</code></p><p id="9a75" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">再次调用产品服务(几次)——<code class="du kf kg kh ki b">curl -X <a class="ae jg" href="https://ProductService-ocloud100.apaas.us2.oraclecloud.com/product/iphone2" rel="noopener ugc nofollow" target="_blank">https://product-ocloud100.apaas.us2.oraclecloud.com/product/iPhone</a>X</code></p><p id="1d57" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">您应该会看到一个<code class="du kf kg kh ki b"><strong class="ik hi">HTTP 500</strong></code>响应</p><pre class="mc md me mf fd nl ki nm nn aw no bi"><span id="c743" class="mq ld hh ki b fi np nq l nr ns">{<br/> “timestamp”: 1517114482192,<br/> <strong class="ki hi">“status”: 500</strong>,<br/> “error”: “Internal Server Error”,<br/> “exception”: “org.springframework.web.client.HttpServerErrorException”,<br/> “message”: “504 Gateway Time-out”,<br/> “path”: “/product/MotoZ”<br/>}</span></pre><figure class="mc md me mf fd mg er es paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="er es ob"><img src="../Images/c36febf76b898290a3bb119e587042b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2HRWWDkDOVM0u4g-uw8GXg.png"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx"><strong class="bd le">Failed </strong>transactions</figcaption></figure><p id="31f0" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">我喜欢红色，但不是在这种情况下，因为它意味着危险——深入研究特定的交易会发现更多</p><figure class="mc md me mf fd mg er es paragraph-image"><div role="button" tabindex="0" class="mh mi di mj bf mk"><div class="er es oc"><img src="../Images/d8701ead7402aa2e432eec61e12efdb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xMXsfWMwagVJPL8ADqQckw.png"/></div></div><figcaption class="mm mn et er es mo mp bd b be z dx">explicit error message</figcaption></figure></div><div class="ab cl jy jz go ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ha hb hc hd he"><h1 id="14b8" class="lc ld hh bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">其他注意事项</h1><p id="3a98" class="pw-post-body-paragraph ih ii hh ik b il ne in io ip nf ir is jh ng iv iw ji nh iz ja jj ni jd je jf ha bi translated">这些都是在这篇文章中没有提到的，但是值得一提的</p><ul class=""><li id="dea3" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated">编写自定义跨度</li><li id="1748" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">跟踪其他系统(如数据库)</li></ul><p id="d2bb" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">好了，这篇博文到此为止！</p><h1 id="47dd" class="lc ld hh bd le lf od lh li lj oe ll lm ln of lp lq lr og lt lu lv oh lx ly lz bi translated">不要忘记…</h1><ul class=""><li id="42ff" class="jk jl hh ik b il ne ip nf jh oi ji oj jj ok jf jp jq jr js bi translated">查看Oracle Application Container Cloud教程—每个运行时都有适合的内容！</li></ul><div class="kj kk ez fb kl km"><a href="https://docs.oracle.com/en/cloud/paas/app-container-cloud/create-first-applications.html" rel="noopener  ugc nofollow" target="_blank"><div class="kn ab dw"><div class="ko ab kp cl cj kq"><h2 class="bd hi fi z dy kr ea eb ks ed ef hg bi translated">Oracle应用容器云服务—创建您的第一批应用</h2><div class="kt l"><h3 class="bd b fi z dy kr ea eb ks ed ef dx translated">Oracle应用容器云服务教程。学习创建你的第一个应用程序。</h3></div><div class="ku l"><p class="bd b fp z dy kr ea eb ks ed ef dx translated">docs.oracle.com</p></div></div></div></a></div><ul class=""><li id="fea7" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated">关于应用程序容器云的其他博客</li></ul><div class="kj kk ez fb kl km"><a rel="noopener follow" target="_blank" href="/tag/app-container-cloud/latest"><div class="kn ab dw"><div class="ko ab kp cl cj kq"><h2 class="bd hi fi z dy kr ea eb ks ed ef hg bi translated">关于应用容器云的最新故事和新闻—中型</h2><div class="kt l"><h3 class="bd b fi z dy kr ea eb ks ed ef dx translated">阅读关于应用容器云的最新文章。每天，成千上万的声音阅读、书写和分享重要的…</h3></div><div class="ku l"><p class="bd b fp z dy kr ea eb ks ed ef dx translated">medium.com</p></div></div><div class="kv l"><div class="ol l kx ky kz kv la lb km"/></div></div></a></div><p id="fe33" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">干杯！</p><blockquote class="ie if ig"><p id="91d2" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated">本文表达的观点是我个人的观点，不一定代表甲骨文的观点。</p></blockquote></div></div>    
</body>
</html>