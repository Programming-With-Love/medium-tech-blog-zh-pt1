<html>
<head>
<title>Write Tests for all your Missed Branches</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为所有遗漏的分支编写测试</h1>
<blockquote>原文：<a href="https://blog.kotlin-academy.com/write-tests-for-all-your-missed-branches-3c74459ed512?source=collection_archive---------1-----------------------#2021-10-08">https://blog.kotlin-academy.com/write-tests-for-all-your-missed-branches-3c74459ed512?source=collection_archive---------1-----------------------#2021-10-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/41e26d3b3d95406a5a88f757b76eea56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kb9BKGChsgqCTalAtdB8pA.png"/></div></div></figure><p id="71b9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在编写测试时，分支覆盖经常被忽略，但是如果你知道你的代码可以采用的所有路径，这将帮助你理解所有的边缘情况。在这篇博文中，您将了解如何识别缺失的分支，并为您的代码编写更好的测试。</p><p id="0ea6" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们从基础开始。</p><h2 id="1dd4" class="kt ku in bd kv kw kx dn ky kz la dp lb kg lc ld le kk lf lg lh ko li lj lk ll bi translated">什么是分行覆盖率？</h2><blockquote class="lm ln lo"><p id="0807" class="jv jw lp jx b jy jz ka kb kc kd ke kf lq kh ki kj lr kl km kn ls kp kq kr ks ig bi translated">分支覆盖率是一个度量标准，它表明代码库中的所有分支是否都经过了测试。“分支”是代码在决策语句——例如，<strong class="jx io"> if </strong>语句——被评估后可能采取的执行路径之一。</p><p id="fc3c" class="jv jw lp jx b jy jz ka kb kc kd ke kf lq kh ki kj lr kl km kn ls kp kq kr ks ig bi translated">来源:https://linearb.io/blog/what-is-branch-coverage/<a class="ae lt" href="https://linearb.io/blog/what-is-branch-coverage/" rel="noopener ugc nofollow" target="_blank"/></p></blockquote><p id="37f7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们从一个简单的例子开始，我们有一个基于<code class="fe lu lv lw lx b">if</code>条件执行某些事情的方法</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="7c5d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果我们决定只为我们的方法编写下面的测试</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="0353" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">该方法将具有100%的代码覆盖率，因为该方法的所有行都是在运行测试时执行的，但是有一个缺失的分支，当<code class="fe lu lv lw lx b">condition</code>为<code class="fe lu lv lw lx b">false</code>时，我们没有添加测试。如果您添加另一个类似下面的测试，您将能够覆盖所有的分支。</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="57e7" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，当我们的<code class="fe lu lv lw lx b">if</code>条件变得有点复杂时，事情变得有点有趣了</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="4e99" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你可能会想，如果你添加两个类似下面的测试，所有的分支都会被覆盖</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="bb25" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但是如果你看过这个博客的封面图片，你会注意到实际上有4个分支。</p><ul class=""><li id="da88" class="me mf in jx b jy jz kc kd kg mg kk mh ko mi ks mj mk ml mm bi translated"><code class="fe lu lv lw lx b">true &amp;&amp; true</code></li><li id="58a6" class="me mf in jx b jy mn kc mo kg mp kk mq ko mr ks mj mk ml mm bi translated"><code class="fe lu lv lw lx b">true &amp;&amp; false</code></li><li id="61f6" class="me mf in jx b jy mn kc mo kg mp kk mq ko mr ks mj mk ml mm bi translated"><code class="fe lu lv lw lx b">false &amp;&amp; true</code></li><li id="7bae" class="me mf in jx b jy mn kc mo kg mp kk mq ko mr ks mj mk ml mm bi translated"><code class="fe lu lv lw lx b">false &amp;&amp; false</code></li></ul><p id="0fe9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">您可以为您的代码编写以下测试，以实现100%的分支覆盖率</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="95be" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在让我们看另一个例子</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="33fe" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这个例子中，我们使用安全调用操作符(<code class="fe lu lv lw lx b">?.</code>)。如果我们编写一个测试来检查<code class="fe lu lv lw lx b">name</code>的值，我们将错过可以是<code class="fe lu lv lw lx b">null</code>的分支。因此，每当我们使用安全调用操作符时，我们应该记住，它将创建两个分支，这两个分支都应该被测试。既然我们知道了这一点，我们的测试用例将会是这样的</p><figure class="ly lz ma mb gt jo"><div class="bz fp l di"><div class="mc md l"/></div></figure><p id="012a" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">即使您的测试已经覆盖了所有的分支，您也可以根据自己的理解添加更多的测试。在这篇博文中，我只强调了缺失的分支，但是可以编写更多的测试。我希望现在你对你的代码可以执行的所有路径/分支有了更好的理解，并且在编写单元测试时你会考虑这些边缘情况。</p><p id="ca56" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated"><em class="lp">如果您有反馈，请随时在</em> <a class="ae lt" href="https://twitter.com/NikitBhandari" rel="noopener ugc nofollow" target="_blank"> <em class="lp">推特</em> </a> <em class="lp">上推文/发消息给我。</em></p><div class="ms mt gp gr mu mv"><a href="https://twitter.com/NikitBhandari" rel="noopener  ugc nofollow" target="_blank"><div class="mw ab fo"><div class="mx ab my cl cj mz"><h2 class="bd io gy z fp na fr fs nb fu fw im bi translated">尼基特·班达里</h2><div class="nc l"><p class="bd b dl z fp na fr fs nb fu fw dk translated">twitter.com/NikitBhandari</p></div></div><div class="nd l"><div class="ne l nf ng nh nd ni jt mv"/></div></div></a></div></div><div class="ab cl nj nk hr nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ig ih ii ij ik"><h1 id="d2f2" class="nq ku in bd kv nr ns nt ky nu nv nw lb nx ny nz le oa ob oc lh od oe of lk og bi translated">点击👏说“谢谢！”并帮助他人找到这篇文章。</h1><p id="ba6e" class="pw-post-body-paragraph jv jw in jx b jy oh ka kb kc oi ke kf kg oj ki kj kk ok km kn ko ol kq kr ks ig bi translated">了解卡帕头最新的重大新闻。学院，<a class="ae lt" href="https://kotlin-academy.us17.list-manage.com/subscribe?u=5d3a48e1893758cb5be5c2919&amp;id=d2ba84960a" rel="noopener ugc nofollow" target="_blank">订阅时事通讯</a>，<a class="ae lt" href="https://twitter.com/ktdotacademy" rel="noopener ugc nofollow" target="_blank">观察Twitter </a>并在Medium上关注我们。</p><p id="2637" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您需要Kotlin工作室，请查看我们如何帮助您:<a class="ae lt" href="https://kt.academy/" rel="noopener ugc nofollow" target="_blank"> kt.academy </a>。</p><figure class="ly lz ma mb gt jo gh gi paragraph-image"><a href="https://kotlin-academy.us17.list-manage.com/subscribe?u=5d3a48e1893758cb5be5c2919&amp;id=d2ba84960a"><div class="gh gi om"><img src="../Images/0f75035864c8777980691ea01b2909c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V9G3D67yqAvCKwAlxLkvDQ.png"/></div></a></figure></div></div>    
</body>
</html>