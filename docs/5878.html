<html>
<head>
<title>Introducing myfile: A base Rails app on OCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">介绍my file:OCI上的一个基础Rails应用</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/introducing-myfile-a-base-rails-app-on-oci-a91149812cbc?source=collection_archive---------5-----------------------#2022-02-15">https://medium.com/oracledevs/introducing-myfile-a-base-rails-app-on-oci-a91149812cbc?source=collection_archive---------5-----------------------#2022-02-15</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/3b8f7f38c89045aa1baee4faf8997b74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mEXyC9E29gmXyv--VkQ6zQ.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx"><em class="it">Photo by </em><a class="ae iu" href="https://www.pexels.com/@iriser?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"><strong class="bd iv"><em class="it">Irina Iriser</em></strong></a><em class="it"> from </em><a class="ae iu" href="https://www.pexels.com/photo/train-rail-during-golden-hour-724712/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank"><strong class="bd iv"><em class="it">Pexels</em></strong></a></figcaption></figure><h1 id="0b9b" class="iw ix hh bd iv iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">介绍</h1><p id="ebfa" class="pw-post-body-paragraph jt ju hh jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">在我最近的一篇<a class="ae iu" rel="noopener" href="/oracledevs/getting-started-with-ruby-and-ruby-on-rails-on-oci-3ce2d4c65833">帖子</a>中，我展示了如何在OCI上安装Ruby运行时(和Ruby on Rails)。在本文中，我们将花几分钟时间创建一个“基础”Rails应用程序，我们将在接下来的文章中构建这个应用程序。</p><h1 id="c34a" class="iw ix hh bd iv iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">事实真相</h1><p id="30e9" class="pw-post-body-paragraph jt ju hh jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">这是一个非常简单的应用程序，允许我们在一个小的web应用程序中上传/下载/管理文件。这款应用将是一款<em class="kr">非常</em>轻量级的文件共享应用。假设是我们将是唯一使用这个应用程序的人。这意味着我们限制了对应用程序的网络访问(它是通过到OCI实例的SSH隧道来访问的)，并且我们不关心身份验证(AuthN)或授权(AuthZ)。</p><p id="b8bc" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">显然，这对于任何实际应用程序来说都是不可接受的。没关系……因为重点不是如何正确地设计和/或保护Rails应用程序，而是如何将一些流行的宝石用于OCI。</p><h1 id="11ce" class="iw ix hh bd iv iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">它不是什么</h1><p id="8961" class="pw-post-body-paragraph jt ju hh jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">这不是为生产级web应用程序而设计的。这不是生产就绪代码。我并不真正关注Rails强化或Rails安全最佳实践。AuthN/AuthZ完全缺失。这是为了展示不同的Ruby宝石如何与OCI交互而特意构建的。了解它的位置并自行承担部署风险。可以把它看作是如何让不同的红宝石与OCI互动的“食谱”。</p><h1 id="3445" class="iw ix hh bd iv iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">云环境</h1><p id="d872" class="pw-post-body-paragraph jt ju hh jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">本文假设您有一个OCI帐户。还没有账户？真的吗？！<a class="ae iu" href="https://www.oracle.com/cloud/free/#always-free?source=:ex:tb:::::WWMK220204P00041&amp;SC=:ex:tb:::::WWMK220204P00041&amp;pcode=WWMK220204P00041" rel="noopener ugc nofollow" target="_blank">现在就买一个</a>！你完全没有理由不享受免费(永远)提供的许多OCI资源。查看这篇文章，了解<a class="ae iu" rel="noopener" href="/oracledevs/create-an-oracle-always-free-cloud-account-bc6aa82c1397">一步一步的操作</a>。</p><p id="83fa" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">我还假设您将继续关注一个OCI实例(使用<a class="ae iu" href="https://github.com/oracle-devrel/terraform-oci-ruby" rel="noopener ugc nofollow" target="_blank"> Ruby/Rails on OCI的例子</a>或类似的东西)。您可以通过访问<a class="ae iu" href="https://github.com/oracle-devrel/terraform-oci-ruby" rel="noopener ugc nofollow" target="_blank"> this repo </a>轻松部署预构建的OCI环境。</p><h1 id="9892" class="iw ix hh bd iv iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">Rails入门</h1><p id="dedf" class="pw-post-body-paragraph jt ju hh jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">因为这是超级基本的，我们有一个单一的控制器，给我们一个文件的CRUD接口。首先，让我们创建一个新的Rails应用程序:</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="f1a1" class="lg ix hh lc b fi lh li l lj lk">rails new myfile</span></pre><p id="bd4a" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">进入项目目录:</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="ac2e" class="lg ix hh lc b fi lh li l lj lk">cd myfile</span></pre><p id="289a" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">Rails倾向于将许多其他有用的词保留给内部的东西，这意味着虽然我最初想将我们的资源称为“文件”，但Rails对此有一个问题:</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="0989" class="lg ix hh lc b fi lh li l lj lk">$ rails g scaffold file</span><span id="0941" class="lg ix hh lc b fi ll li l lj lk">invoke  active_record</span><span id="78a2" class="lg ix hh lc b fi ll li l lj lk">The name 'File' is either already used in your application or reserved by Ruby on Rails. Please choose an alternative or use --skip-collision-check or --force to skip this check and run this generator again.</span></pre><p id="062e" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">类似地，试图使用<em class="kr">资产</em>也会在以后引起心痛——相信我，我尝试过并遇到了这种情况。的确，您将能够生成脚手架，但是Rails稍后会给您带来一些奇怪的东西(至少对我来说是这样)。正因为如此，我选择称文件为“东西”。现在让我们创建<em class="kr">的东西</em>脚手架(模型、视图、控制器等)。):</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="0382" class="lg ix hh lc b fi lh li l lj lk">rails g scaffold thing file_name:string content_type:string file_data:binary description:string</span></pre><p id="f376" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">继续执行数据库迁移(此时，我们只是使用内置的SQLite3):</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="6a91" class="lg ix hh lc b fi lh li l lj lk">rake db:migrate</span></pre><p id="f501" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">启动本地web服务器，以便您可以随时查看:</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="99f2" class="lg ix hh lc b fi lh li l lj lk">rails s</span></pre><p id="d430" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">如果你正在使用一个OCI实例(你正在使用预建的<a class="ae iu" href="https://github.com/oracle-devrel/terraform-oci-ruby" rel="noopener ugc nofollow" target="_blank"> Ruby/Rails on OCI的例子</a>，对吗？)，您需要通过SSH会话重定向端口。类似这样的…</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="0a94" class="lg ix hh lc b fi lh li l lj lk">ssh -L 3000:localhost:3000 opc@&lt;public_ip&gt;</span></pre><p id="c3e1" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">(您可能需要用<em class="kr"> -i </em>参数指定您的私钥)</p><p id="6854" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">然后你就可以去<a class="ae iu" href="http://localhost:3000/things/" rel="noopener ugc nofollow" target="_blank">http://localhost:3000/things/</a>看看了。耶！您应该会看到一个相当无聊的页面。</p><h1 id="4a93" class="iw ix hh bd iv iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">但是它看起来太丑了</h1><p id="2613" class="pw-post-body-paragraph jt ju hh jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">是啊，我明白了，它<em class="kr">就是</em>丑。对于这其中的大部分，我们将很大程度上让它变得极其无聊。重点不是放在前端(让它看起来漂亮)，而是放在后端功能(与OCI的集成)，所以它会有点乏味。没关系。</p><p id="2b1f" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">为了使它变得更加易读，在/app/assets/style sheets/application . CSS中添加以下内容:</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="6568" class="lg ix hh lc b fi lh li l lj lk">...</span><span id="eada" class="lg ix hh lc b fi ll li l lj lk">#things p {<br/>  display: inline;<br/>  border-right: 1px solid #999;<br/>}</span></pre><p id="86da" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">没多大帮助，但还是那句话..这篇文章(或系列文章)不是关于UI/UX的，而是关于后端的本质。继续表演…</p><h1 id="efbb" class="iw ix hh bd iv iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">添加默认路由</h1><p id="882e" class="pw-post-body-paragraph jt ju hh jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">虽然它可以工作，但我不喜欢必须键入<em class="kr"> /things </em>，所以让我们设置一个默认路线。这是一件小事，但会让生活变得更简单，将<em class="kr"> things#index </em>设置为我们的默认路线(editing /config/routes.rb):</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="c081" class="lg ix hh lc b fi lh li l lj lk">Rails.application.routes.draw do</span><span id="27e8" class="lg ix hh lc b fi ll li l lj lk">  ...</span><span id="8518" class="lg ix hh lc b fi ll li l lj lk">  root "things#index"<br/>end</span></pre><h1 id="8693" class="iw ix hh bd iv iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">上传功能</h1><p id="1ff8" class="pw-post-body-paragraph jt ju hh jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">首先，我们需要一种上传文件的方法。为我们生成的默认CRUD是可以的，但对于我们想要的东西来说确实不理想。想要露齿一笑，点击<em class="kr">新事物</em>，就能看到它提供的开箱即用的非常温和的形式:</p><figure class="kx ky kz la fd ii er es paragraph-image"><div class="er es lm"><img src="../Images/426ca47d7b0c071e3bf786278763b018.png" data-original-src="https://miro.medium.com/v2/resize:fit:354/format:webp/1*2pCSywG5lSuyfZT5FrgYlw.png"/></div></figure><p id="53eb" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">这不是我们想要的文件上传体验，所以让我们更改GET视图，修改/app/views/things/_ form . html . erb，更改file_data字段的字段类型:</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="e548" class="lg ix hh lc b fi lh li l lj lk">...<br/>  &lt;div&gt;<br/>    &lt;%= form.label :file_data, style: "display: block" %&gt;<br/>    &lt;%= form.file_field :file_data %&gt;<br/>  &lt;/div&gt;<br/>...</span></pre><p id="a610" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">从同一个文件中删除以下内容(我们将通过file_data参数获取文件名和内容类型):</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="e050" class="lg ix hh lc b fi lh li l lj lk">...<br/>  &lt;div&gt;<br/>    &lt;%= form.label :file_name, style: "display: block" %&gt;<br/>    &lt;%= form.text_field :file_name %&gt;<br/>  &lt;/div&gt;</span><span id="aa9f" class="lg ix hh lc b fi ll li l lj lk">&lt;div&gt;<br/>    &lt;%= form.label :content_type, style: "display: block" %&gt;<br/>    &lt;%= form.text_field :content_type %&gt;<br/>  &lt;/div&gt;<br/>...</span></pre><p id="ff83" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">为了上传工作，我们需要修改控制器(/app/controllers/things _ controller . Rb)中的一些内容:</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="52f2" class="lg ix hh lc b fi lh li l lj lk">  private<br/>    ...</span><span id="5188" class="lg ix hh lc b fi ll li l lj lk">  # Only allow a list of trusted parameters through.<br/>    def thing_params<br/>      ret = params.require(:thing).permit(:description)<br/>      ret.merge( { file_data: params[:thing][:file_data].read, file_name: params[:thing][:file_data].original_filename, content_type: params[:thing][:file_data].content_type } )<br/>    end<br/>end</span></pre><p id="7551" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">我们在这里做的是从<em class="kr"> file_data </em>字段追加一些字段值。当生成脚手架时，它假设我们已经为<em class="kr"> content_type </em>和<em class="kr"> file_name </em>字段提供了用户提供的(手动输入的)值。我们不想那样。这是一种痛苦，真的没有必要。内容类型和文件名与文件数据本身包含在一起(作为上传过程的一部分)，所以我们只是将它们添加到参数中，就好像它们是单独提供的一样(使我们和任何用户都更容易)。</p><p id="b7eb" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">通过以这种方式修改散列，我们根本不需要修改<em class="kr"> #create </em>或<em class="kr"> #update </em>方法…这些都是易于使用的，总是使用正确的数据！</p><h1 id="424c" class="iw ix hh bd iv iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">查看“事物”</h1><p id="1aa2" class="pw-post-body-paragraph jt ju hh jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">到目前为止，我们可以上传一个文件，但查看它有点混乱。更新/app/views/things/_ thing . html . erb，替换:</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="845e" class="lg ix hh lc b fi lh li l lj lk">  &lt;p&gt;<br/>    &lt;strong&gt;File data:&lt;/strong&gt;<br/>    &lt;%= thing.file_data %&gt;<br/>  &lt;/p&gt;</span></pre><p id="91c7" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">有了这个:</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="c39c" class="lg ix hh lc b fi lh li l lj lk">  &lt;p&gt;<br/>    &lt;strong&gt;File data length (bytes):&lt;/strong&gt;<br/>    &lt;%= thing.file_data.length %&gt;<br/>  &lt;/p&gt;</span></pre><p id="f0d7" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">试图在屏幕上显示原始文件数据确实不太理想。这将显示在索引上，以及一个特定的“东西”(资源)。相反，我们将让它显示资源的字节(长度)。</p><h1 id="ade2" class="iw ix hh bd iv iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">下载一个“东西”</h1><p id="cd38" class="pw-post-body-paragraph jt ju hh jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">这实际上很简单，只需要几个步骤:</p><ul class=""><li id="bf0a" class="ln lo hh jv b jw ks ka kt ke lp ki lq km lr kq ls lt lu lv bi translated">添加新路线</li><li id="4bd6" class="ln lo hh jv b jw lw ka lx ke ly ki lz km ma kq ls lt lu lv bi translated">添加新的控制器方法</li><li id="c4b7" class="ln lo hh jv b jw lw ka lx ke ly ki lz km ma kq ls lt lu lv bi translated">更新视图</li></ul><p id="ac12" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">要添加新路由，只需更新/app/config/routes.rb文件即可。更新此零件:</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="8605" class="lg ix hh lc b fi lh li l lj lk">  ...<br/>  resources :things<br/>  ...</span></pre><p id="db95" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">看起来像这样:</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="1619" class="lg ix hh lc b fi lh li l lj lk">  ...<br/>  resources :things do<br/>    get 'download', on: :member<br/>  end<br/>  ...</span></pre><p id="6a3b" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">这告诉Rails为特定的<em class="kr">事物</em>项(称为成员)添加一个新的<em class="kr"> #download </em> GET动作。让我们为此添加控制器逻辑，更新/app/controllers/things _ controller . Rb，向ThingsController类添加一个<em class="kr"> #download </em>方法:</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="c221" class="lg ix hh lc b fi lh li l lj lk">class ThingsController &lt; ApplicationController<br/>  ...</span><span id="3d70" class="lg ix hh lc b fi ll li l lj lk">  def download<br/>    response.set_header('Content-Disposition', "attachment; filename=\"#{<a class="ae iu" href="http://twitter.com/thing" rel="noopener ugc nofollow" target="_blank">@thing</a>.file_name}\"")<br/>    response.content_type = <a class="ae iu" href="http://twitter.com/thing" rel="noopener ugc nofollow" target="_blank">@thing</a>.content_type<br/>    response.write(<a class="ae iu" href="http://twitter.com/thing" rel="noopener ugc nofollow" target="_blank">@thing</a>.file_data)<br/>  end</span><span id="1776" class="lg ix hh lc b fi ll li l lj lk">  ...<br/>end</span></pre><p id="f25b" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">我必须给它应得的荣誉。虽然文件传输头不是Rails特有的，但我在本文的<a class="ae iu" href="https://piotrmurach.com/articles/streaming-large-zip-files-in-rails/" rel="noopener ugc nofollow" target="_blank">中找到了一个资源。其中讨论了一个文件传输实现。我能够根据我在那里找到的内容修改内容处置头部分。为协作和知识共享而欢呼！</a></p><p id="01df" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">对同一个控制器再进行一次更新，更改如下:</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="84a3" class="lg ix hh lc b fi lh li l lj lk">class ThingsController &lt; ApplicationController<br/>  before_action :set_thing, only: %i[ show edit update destroy ]</span></pre><p id="bb07" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">对此:</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="bf96" class="lg ix hh lc b fi lh li l lj lk">class ThingsController &lt; ApplicationController<br/>  before_action :set_thing, only: %i[ show edit update destroy download ]</span></pre><p id="d42f" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">我们告诉它为#download动作设置@thing全局变量(除了其他特定于成员的动作之外)。</p><p id="46fb" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">最后，但同样重要的是，我们需要一种启动下载的方法。更新/app/views/things/_ thing . html . erb中的视图，替换以下内容:</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="bd82" class="lg ix hh lc b fi lh li l lj lk">  ...</span><span id="192c" class="lg ix hh lc b fi ll li l lj lk">  &lt;p&gt;<br/>    &lt;strong&gt;File name:&lt;/strong&gt;<br/>    &lt;%= thing.file_name %&gt;<br/>  &lt;/p&gt;</span><span id="400e" class="lg ix hh lc b fi ll li l lj lk">  ...</span></pre><p id="403c" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">有了这个:</p><pre class="kx ky kz la fd lb lc ld le aw lf bi"><span id="5561" class="lg ix hh lc b fi lh li l lj lk">  ...<br/>  &lt;p&gt;<br/>    &lt;strong&gt;File name:&lt;/strong&gt;<br/>    &lt;%= link_to thing.file_name, download_thing_path(thing) %&gt;<br/>  &lt;/p&gt;<br/>  <br/>  ...</span></pre><p id="0785" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">这使得文件名显示为下载“东西”(文件)的超链接。虽然它可能不是超级直观，但它是实用的，不会进一步扰乱我们令人难以置信的用户界面/UX设计。☺</p><h1 id="26b5" class="iw ix hh bd iv iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">结果呢</h1><p id="b8a9" class="pw-post-body-paragraph jt ju hh jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">我们有一个基本的(超级难看的)应用程序，它提供:</p><ul class=""><li id="bb67" class="ln lo hh jv b jw ks ka kt ke lp ki lq km lr kq ls lt lu lv bi translated">文件上传</li><li id="58e5" class="ln lo hh jv b jw lw ka lx ke ly ki lz km ma kq ls lt lu lv bi translated">文件存储器</li><li id="c211" class="ln lo hh jv b jw lw ka lx ke ly ki lz km ma kq ls lt lu lv bi translated">文件下载</li></ul><p id="fa5a" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">用户界面/UX不存在。文件上传非常简单——没有AJAXy的优点(比如我们期待的非常熟悉的拖放体验)。文件下载，嗯，它只是工作。这里没有华而不实的东西！</p><p id="b84e" class="pw-post-body-paragraph jt ju hh jv b jw ks jy jz ka kt kc kd ke ku kg kh ki kv kk kl km kw ko kp kq ha bi translated">文件存储不太理想。我们将数据存储在SQLite数据库中。是的，太可怕了。但这仅仅是开始。我们必须从某个地方开始，所以我们从尽可能最小的共同点开始。当然，有些人可能会认为我们应该将文件存储在数据库之外的本地文件系统中。我们本可以做到的。坦白地说，除了绝对需要的时间，我不想在这上面花更多的时间，因为这实际上是一个跳板。</p><h1 id="d086" class="iw ix hh bd iv iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">资源</h1><p id="aace" class="pw-post-body-paragraph jt ju hh jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">这里有一些很棒的参考资料和资源，你可能会觉得有用(我找到了！):</p><ul class=""><li id="e3bb" class="ln lo hh jv b jw ks ka kt ke lp ki lq km lr kq ls lt lu lv bi translated"><a class="ae iu" href="https://piotrmurach.com/articles/streaming-large-zip-files-in-rails/" rel="noopener ugc nofollow" target="_blank">https://piotrmurach . com/articles/streaming-large-zip-files-in-rails/</a></li><li id="f4c3" class="ln lo hh jv b jw lw ka lx ke ly ki lz km ma kq ls lt lu lv bi translated"><a class="ae iu" href="https://api.rubyonrails.org/classes/ActionDispatch/Response.html" rel="noopener ugc nofollow" target="_blank">https://API . ruby on rails . org/classes/action dispatch/response . html</a></li><li id="a02e" class="ln lo hh jv b jw lw ka lx ke ly ki lz km ma kq ls lt lu lv bi translated"><a class="ae iu" href="https://guides.rubyonrails.org/action_controller_overview.html%23the-response-object" rel="noopener ugc nofollow" target="_blank">https://guides . ruby on rails . org/action _ controller _ overview . html # the-response-object</a></li><li id="65a6" class="ln lo hh jv b jw lw ka lx ke ly ki lz km ma kq ls lt lu lv bi translated"><a class="ae iu" href="https://guides.rubyonrails.org/form_helpers.html%23uploading-files" rel="noopener ugc nofollow" target="_blank">https://guides . ruby on rails . org/form _ helpers . html #上传文件</a></li><li id="5e4d" class="ln lo hh jv b jw lw ka lx ke ly ki lz km ma kq ls lt lu lv bi translated"><a class="ae iu" href="https://guides.rubyonrails.org/routing.html" rel="noopener ugc nofollow" target="_blank">https://guides.rubyonrails.org/routing.html</a></li><li id="71db" class="ln lo hh jv b jw lw ka lx ke ly ki lz km ma kq ls lt lu lv bi translated"><a class="ae iu" href="https://api.rubyonrails.org/classes/ActiveRecord/ConnectionAdapters/SchemaStatements.html%23method-i-add_column" rel="noopener ugc nofollow" target="_blank">https://API . ruby on rails . org/classes/active record/connection adapters/schema statements . html # method-I-add _ column</a></li></ul><h1 id="e41f" class="iw ix hh bd iv iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">下一步是什么</h1><p id="a606" class="pw-post-body-paragraph jt ju hh jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">请关注下一篇文章，我们将在那里使用这个超级基本的应用程序，并让它使用<a class="ae iu" href="https://guides.rubyonrails.org/active_storage_overview.html" rel="noopener ugc nofollow" target="_blank">活动存储</a>。也许将来会探索一些其他的宝石选择——可能性几乎是无限的！</p><h1 id="3f72" class="iw ix hh bd iv iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js bi translated">加入对话！</h1><p id="1755" class="pw-post-body-paragraph jt ju hh jv b jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq ha bi translated">如果你对甲骨文开发人员在他们的自然栖息地发生的事情感到好奇，请加入我们的<a class="ae iu" href="https://oracledevrel.slack.com/join/shared_invite/zt-uffjmwh3-ksmv2ii9YxSkc6IpbokL1g#/shared-invite/email" rel="noopener ugc nofollow" target="_blank">公共休闲频道</a>！我们不介意成为你的鱼缸🐠</p></div></div>    
</body>
</html>