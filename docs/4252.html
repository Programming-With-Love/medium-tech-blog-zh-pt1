<html>
<head>
<title>Some APIs for Interactive Canvas have been changed</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">交互式画布的一些API已经更改</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/some-apis-for-interactive-canvas-have-been-changed-8b099bb98eb2?source=collection_archive---------3-----------------------#2019-07-22">https://medium.com/google-developer-experts/some-apis-for-interactive-canvas-have-been-changed-8b099bb98eb2?source=collection_archive---------3-----------------------#2019-07-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="f68f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在Google I/O 2019上，在一些关于Google Assistant的话题中，Google Assistant支持智能显示被视为一个重大宣布。此外，为了使用Smart Display的一项功能“屏幕”构建操作，引入了交互式画布功能。通过使用该功能，操作可以为Smart Display提供一个web应用程序。</p><p id="0b6f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有关交互式画布的更多详细信息，请参考以下文档。</p><p id="8afa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jc" href="https://developers.google.com/actions/interactivecanvas/" rel="noopener ugc nofollow" target="_blank">交互式画布——对谷歌参考文档的操作</a></p><p id="71b8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">目前，它是一个开发者预览版，您还不能使用交互式画布发布您的操作。但是，您现在可以使用交互式画布来构建动作。我认为许多开发人员已经在挑战用交互式画布来构建动作。</p><p id="4ae8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我猜许多开发人员可能认识到一些API的命名没有一致性(我也是其中之一)。在几天前，为了使命名更加一致，一些API被修改了。</p><p id="7651" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我在这里介绍这些变化。</p><h1 id="4b8e" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">将ImmersiveResponse更改为HtmlResponse</h1><p id="1ca7" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">为了从您的实现中发送对交互式画布的响应，到目前为止，必须使用沉浸式响应类。但是，我们需要使用<a class="ae jc" href="https://actions-on-google.github.io/actions-on-google-nodejs/2.9.1-preview.1/classes/_service_actionssdk_conversation_response_html_.htmlresponse.html" rel="noopener ugc nofollow" target="_blank"> HtmlResponse </a>类来代替。用法与ImmersiveResponse类相同，创建一个HtmlResponse类的对象并将其传递给conv.ask()方法。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="9526" class="kp je hh kl b fi kq kr l ks kt">const {<br/>  dialogflow,<br/>  HtmlResponse,<br/>  ...<br/>} = require('actions-on-google');</span><span id="4da6" class="kp je hh kl b fi ku kr l ks kt">const app = dialogflow();</span><span id="3c13" class="kp je hh kl b fi ku kr l ks kt">app.intent('Default Welcome Intent', conv =&gt; {<br/>  conv.ask('...');<br/>  conv.ask(new HtmlResponse({<br/>    url: '...'<br/>  }));<br/>});</span></pre><h1 id="5ebb" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">将状态更改为数据</h1><p id="66eb" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">在更改HtmlResponse类的同时，属性名从“state”更改为“<a class="ae jc" href="https://actions-on-google.github.io/actions-on-google-nodejs/2.9.1-preview.1/classes/_service_actionssdk_conversation_response_html_.htmlresponse.html#data" rel="noopener ugc nofollow" target="_blank"> data </a>”。此属性用于将信息从您的实现传递到您的Web应用程序。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="3e27" class="kp je hh kl b fi kq kr l ks kt">conv.ask(new HtmlResponse({<br/>  data: {<br/>    ...<br/>  }<br/>}));</span></pre><h1 id="9d12" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">更改JavaScript SDK文件URL</h1><p id="0458" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">JavaScript SDK在Web app端是必要的，以支持交互式画布。JavaScript SDK的URL已更改。</p><ul class=""><li id="d63a" class="kv kw hh ig b ih ii il im ip kx it ky ix kz jb la lb lc ld bi translated"><a class="ae jc" href="https://www.gstatic.com/assistant/interactivecanvas/api/interactive_canvas.min.js" rel="noopener ugc nofollow" target="_blank">https://www . gstatic . com/assistant/interactive canvas/API/interactive _ canvas . min . js</a></li></ul><p id="ca56" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您需要将其加载到您的HTML文件中。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="ea74" class="kp je hh kl b fi kq kr l ks kt">&lt;!DOCTYPE html&gt;<br/>&lt;html&gt;<br/>  &lt;head&gt;<br/>    ...<br/>    &lt;script type="text/javascript" src="<a class="ae jc" href="https://www.gstatic.com/assistant/interactivecanvas/api/interactive_canvas.min.js" rel="noopener ugc nofollow" target="_blank">https://www.gstatic.com/assistant/interactivecanvas/api/interactive_canvas.min.js</a>"&gt;&lt;/script&gt;<br/>    ...<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    ...<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><h1 id="5918" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">将assistantCanvas改为interactiveCanvas</h1><p id="a991" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">对应JavaScript SDK变化，需要修改代码。提供了“assistantCanvas”对象，但是名称被更改为“<a class="ae jc" href="https://developers.google.com/actions/interactivecanvas/reference/interactivecanvas" rel="noopener ugc nofollow" target="_blank"> interactiveCanvas </a>”。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="bb71" class="kp je hh kl b fi kq kr l ks kt">interactiveCanvas.ready({<br/>  onUpdate(data) {<br/>    ...<br/>  }<br/>});</span><span id="4367" class="kp je hh kl b fi ku kr l ks kt">interactiveCanvas.sendTextQuery(...);</span></pre><p id="f6a6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">由履行方将“状态”改为“数据”。同样，您最好将传递给interactiveCanvas对象的ready()方法的回调函数的参数名称从“state”更改为“data”。</p><h1 id="6fb1" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">弃用CSS文件</h1><p id="b9cb" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">在交互式画布的web应用程序中，为了显示动作名称，在屏幕的客户区顶部有一个标题区。标题区域的高度因设备而异。也就是说，动作可以使用的高度是整个客户区的高度减去标题区的高度后的剩余高度。并且，可用高度将动态变化。</p><p id="191f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">到目前为止，CSS文件被提供来将标题高度设置为body元素的padding-top样式属性值。但是，这个CSS文件已被弃用。</p><h1 id="a8c1" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">添加一个新的API来检索页眉高度</h1><p id="d9de" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">不使用CSS文件，而是提供了一个新的API来动态检索标题高度。开发人员可以通过调用interactiveCanvas对象的<a class="ae jc" href="https://developers.google.com/actions/interactivecanvas/reference/interactivecanvas#getheaderheightpx" rel="noopener ugc nofollow" target="_blank"> getHeaderHeightPx() </a>方法来检索页眉高度。</p><pre class="kg kh ki kj fd kk kl km kn aw ko bi"><span id="eb32" class="kp je hh kl b fi kq kr l ks kt">const headerHeight = await interactiveCanvas.getHeaderHeightPx();</span></pre><p id="983a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意，getHeaderHeightPx()方法返回值的类型是Promise <number>。您将需要使用await或then()来调用API。</number></p><h1 id="0e4b" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">如何应用更改</h1><p id="f1ec" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">为了反映现有动作的这些变化，有必要更新Google客户端库上的动作版本。</p><ul class=""><li id="62a8" class="kv kw hh ig b ih ii il im ip kx it ky ix kz jb la lb lc ld bi translated">NodeJS —执行<code class="du le lf lg kl b">npm install actions-on-google@preview</code></li></ul><p id="9f86" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">执行上面的命令后，可以使用HtmlResponse这样的API。</p><p id="91d6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">不幸的是，在我写这篇文章的时候，Google Client Library for Java上的动作不支持交互式画布。</p></div></div>    
</body>
</html>