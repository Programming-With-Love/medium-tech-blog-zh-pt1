<html>
<head>
<title>How to use Actions on Google Client Library on Azure App Service</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Azure App Service上使用Google客户端库上的操作</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/how-to-use-actions-on-google-client-library-on-azure-app-service-44257ea33d84?source=collection_archive---------7-----------------------#2019-01-08">https://medium.com/google-developer-experts/how-to-use-actions-on-google-client-library-on-azure-app-service-44257ea33d84?source=collection_archive---------7-----------------------#2019-01-08</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="b9e7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我在下面的故事中介绍了如何在Azure Functions Node.js上的Google客户端库上使用<a class="ae jc" href="https://github.com/actions-on-google/actions-on-google-nodejs" rel="noopener ugc nofollow" target="_blank">动作:</a></p><div class="jd je ez fb jf jg"><a rel="noopener follow" target="_blank" href="/@yoichiro/how-to-use-actions-on-google-client-library-on-azure-functions-node-js-178d5ecd04e3"><div class="jh ab dw"><div class="ji ab jj cl cj jk"><h2 class="bd hi fi z dy jl ea eb jm ed ef hg bi translated">如何在Azure Functions Node.js上使用Google客户端库上的操作</h2><div class="jn l"><h3 class="bd b fi z dy jl ea eb jm ed ef dx translated">如果你是一个经常使用Azure Functions Node.js的开发者，你可以为Google Assistant构建你的动作…</h3></div><div class="jo l"><p class="bd b fp z dy jl ea eb jm ed ef dx translated">medium.com</p></div></div><div class="jp l"><div class="jq l jr js jt jp ju jv jg"/></div></div></a></div><p id="84b3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">事实上，我们有另一种方法来在Azure上构建您的操作。就是使用<a class="ae jc" href="https://docs.microsoft.com/en-us/azure/app-service/" rel="noopener ugc nofollow" target="_blank"> Azure App服务</a>。</p><div class="jd je ez fb jf jg"><a href="https://docs.microsoft.com/en-us/azure/app-service/" rel="noopener  ugc nofollow" target="_blank"><div class="jh ab dw"><div class="ji ab jj cl cj jk"><h2 class="bd hi fi z dy jl ea eb jm ed ef hg bi translated">Azure应用服务文档-教程、API参考</h2><div class="jn l"><h3 class="bd b fi z dy jl ea eb jm ed ef dx translated">Azure App Service使您能够在编程中构建和托管web应用、移动后端和RESTful APIs</h3></div><div class="jo l"><p class="bd b fp z dy jl ea eb jm ed ef dx translated">docs.microsoft.com</p></div></div><div class="jp l"><div class="jw l jr js jt jp ju jv jg"/></div></div></a></div><p id="a481" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">基本上，你可以将你的<a class="ae jc" href="https://www.npmjs.com/package/express" rel="noopener ugc nofollow" target="_blank"> express </a>应用程序部署到Azure应用程序服务中，而无需任何操作。Google Client Library上的操作可以与express一起使用。</p><div class="jd je ez fb jf jg"><a href="https://www.npmjs.com/package/express" rel="noopener  ugc nofollow" target="_blank"><div class="jh ab dw"><div class="ji ab jj cl cj jk"><h2 class="bd hi fi z dy jl ea eb jm ed ef hg bi translated">表达</h2><div class="jn l"><h3 class="bd b fi z dy jl ea eb jm ed ef dx translated">快速、非个性化、极简主义的web框架</h3></div><div class="jo l"><p class="bd b fp z dy jl ea eb jm ed ef dx translated">www.npmjs.com</p></div></div><div class="jp l"><div class="jx l jr js jt jp ju jv jg"/></div></div></a></div><div class="jd je ez fb jf jg"><a href="https://github.com/actions-on-google/actions-on-google-nodejs" rel="noopener  ugc nofollow" target="_blank"><div class="jh ab dw"><div class="ji ab jj cl cj jk"><h2 class="bd hi fi z dy jl ea eb jm ed ef hg bi translated">谷歌上的操作/谷歌节点上的操作</h2><div class="jn l"><h3 class="bd b fi z dy jl ea eb jm ed ef dx translated">用于Google上操作的Node.js客户端库。通过以下方式为actions-on-Google/actions-on-Google-nodejs开发做出贡献…</h3></div><div class="jo l"><p class="bd b fp z dy jl ea eb jm ed ef dx translated">github.com</p></div></div><div class="jp l"><div class="jy l jr js jt jp ju jv jg"/></div></div></a></div><p id="1a4c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这个故事中，我介绍了如何在Azure App Service上使用Google客户端库上的操作。</p><h1 id="415b" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">体系结构</h1><p id="f79e" class="pw-post-body-paragraph ie if hh ig b ih kx ij ik il ky in io ip kz ir is it la iv iw ix lb iz ja jb ha bi translated">我假设您想要在Azure App Service上实现您的实现代码，以处理来自Dialogflow的请求，如下所示:</p><figure class="ld le lf lg fd lh er es paragraph-image"><div role="button" tabindex="0" class="li lj di lk bf ll"><div class="er es lc"><img src="../Images/74c05bfffc1a2c2d7b1831d69c1ca554.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m1fdS5FQc7zBFEgdK8XzWA.png"/></div></div></figure><h1 id="c36d" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">先决条件</h1><p id="ea86" class="pw-post-body-paragraph ie if hh ig b ih kx ij ik il ky in io ip kz ir is it la iv iw ix lb iz ja jb ha bi translated">您需要准备以下内容:</p><ul class=""><li id="bd17" class="ln lo hh ig b ih ii il im ip lp it lq ix lr jb ls lt lu lv bi translated">您已经在Azure上注册了您的帐户。</li><li id="1caf" class="ln lo hh ig b ih lw il lx ip ly it lz ix ma jb ls lt lu lv bi translated">您已经安装了<a class="ae jc" href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest" rel="noopener ugc nofollow" target="_blank"> Azure CLI </a>并登录到Azure。</li><li id="c98d" class="ln lo hh ig b ih lw il lx ip ly it lz ix ma jb ls lt lu lv bi translated">你已经了解了如何在谷歌云平台或亚马逊网络服务上为谷歌助手构建动作。</li><li id="064c" class="ln lo hh ig b ih lw il lx ip ly it lz ix ma jb ls lt lu lv bi translated">您已经在Google project上有了您的操作，并且您的Dialogflow代理已经连接到AoG项目。</li></ul><p id="0861" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你不知道如何构建动作，你可以用codelabs来研究一下:</p><div class="jd je ez fb jf jg"><a href="https://codelabs.developers.google.com/codelabs/actions-1/index.html#0" rel="noopener  ugc nofollow" target="_blank"><div class="jh ab dw"><div class="ji ab jj cl cj jk"><h2 class="bd hi fi z dy jl ea eb jm ed ef hg bi translated">为Google Assistant构建操作(第1级)</h2><div class="jn l"><h3 class="bd b fi z dy jl ea eb jm ed ef dx translated">这个codelab是多模块教程的一部分。每个模块可以单独学习，也可以按照学习顺序学习…</h3></div><div class="jo l"><p class="bd b fp z dy jl ea eb jm ed ef dx translated">codelabs.developers.google.com</p></div></div><div class="jp l"><div class="mb l jr js jt jp ju jv jg"/></div></div></a></div><div class="jd je ez fb jf jg"><a href="https://codelabs.developers.google.com/codelabs/actions-2/index.html#0" rel="noopener  ugc nofollow" target="_blank"><div class="jh ab dw"><div class="ji ab jj cl cj jk"><h2 class="bd hi fi z dy jl ea eb jm ed ef hg bi translated">为Google Assistant构建操作(第2级)</h2><div class="jn l"><h3 class="bd b fi z dy jl ea eb jm ed ef dx translated">此codelab模块是多模块教程的一部分。每个模块可以单独学习，也可以按学习顺序学习…</h3></div><div class="jo l"><p class="bd b fp z dy jl ea eb jm ed ef dx translated">codelabs.developers.google.com</p></div></div><div class="jp l"><div class="mc l jr js jt jp ju jv jg"/></div></div></a></div><h1 id="f1fb" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">创建您的应用服务</h1><p id="6bfa" class="pw-post-body-paragraph ie if hh ig b ih kx ij ik il ky in io ip kz ir is it la iv iw ix lb iz ja jb ha bi translated">让我们开始在Azure上创建您的应用服务。如果您没有资源组，请使用以下命令创建它们:</p><pre class="ld le lf lg fd md me mf mg aw mh bi"><span id="4327" class="mi ka hh me b fi mj mk l ml mm">$ az group create --name &lt;RESOURCE_GROUP_NAME&gt; --location &lt;LOCATION_NAME&gt;</span></pre><p id="aab9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，使用下面的命令创建您的应用服务。在这里，我们使用免费计划。</p><pre class="ld le lf lg fd md me mf mg aw mh bi"><span id="a701" class="mi ka hh me b fi mj mk l ml mm">$ az appservice plan create --name &lt;PLAN_NAME&gt; --resource-group &lt;RESOURCE_GROUP_NAME&gt; --sku FREE<br/>$ az webapp create --resource-group &lt;RESOURCE_GROUP_NAME&gt; --plan &lt;PLAN_NAME&gt; --name &lt;APP_NAME&gt;</span></pre><p id="0e7f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要在Google Client Library上执行操作，您需要准备一个Node.js环境。请使用以下命令将Node.js版本设置为您的应用程序服务:</p><pre class="ld le lf lg fd md me mf mg aw mh bi"><span id="a5cc" class="mi ka hh me b fi mj mk l ml mm">$ az webapp config appsettings set --resource-group &lt;RESOURCE_GROUP_NAME&gt; --name &lt;APP_NAME&gt; --settings WEBSITE_NODE_DEFAULT_VERSION=8.11.1</span></pre><h1 id="a22d" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">创建Node.js项目并安装依赖项</h1><p id="55ed" class="pw-post-body-paragraph ie if hh ig b ih kx ij ik il ky in io ip kz ir is it la iv iw ix lb iz ja jb ha bi translated">您可以使用Google客户端库上的操作来构建您的操作。要将其部署为Azure App服务，需要使用express来处理HTTP请求和响应。</p><p id="5833" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，用<code class="du mn mo mp me b">npm</code>命令创建Node.js项目:</p><pre class="ld le lf lg fd md me mf mg aw mh bi"><span id="05c9" class="mi ka hh me b fi mj mk l ml mm">$ mkdir &lt;APP_NAME&gt;<br/>$ cd &lt;APP_NAME&gt;<br/>$ npm init</span></pre><p id="dcbd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您将从命令中询问一些问题，但基本上您可以通过按回车键来回答所有问题。然后，通过以下命令安装依赖项:</p><pre class="ld le lf lg fd md me mf mg aw mh bi"><span id="def6" class="mi ka hh me b fi mj mk l ml mm">$ npm install --save actions-on-google express</span></pre><p id="2baa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将创建<code class="du mn mo mp me b">node_modules</code>,并将依赖项安装到目录中。</p><h1 id="9037" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">编写履行代码</h1><p id="06da" class="pw-post-body-paragraph ie if hh ig b ih kx ij ik il ky in io ip kz ir is it la iv iw ix lb iz ja jb ha bi translated">让我们开始编写您的实现代码。创建一个名为<code class="du mn mo mp me b">index.js</code>的新文件，并写入以下内容:</p><pre class="ld le lf lg fd md me mf mg aw mh bi"><span id="b1b8" class="mi ka hh me b fi mj mk l ml mm">const express = require('express');<br/>const bodyParser = require('body-parser');<br/>const {dialogflow} = require('actions-on-google');</span><span id="722a" class="mi ka hh me b fi mq mk l ml mm">const port = process.env.PORT || 4567;</span><span id="2c2c" class="mi ka hh me b fi mq mk l ml mm">const app = dialogflow();</span><span id="ddc7" class="mi ka hh me b fi mq mk l ml mm">app.intent('Default Welcome Intent', conv =&gt; {<br/>    conv.close('Hello, Azure!');<br/>});</span><span id="9511" class="mi ka hh me b fi mq mk l ml mm">const expressApp = express().use(bodyParser.json());<br/>expressApp.post('/', app);</span><span id="c804" class="mi ka hh me b fi mq mk l ml mm">expressApp.listen(port);</span></pre><h1 id="fdfd" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">创建Web配置文件</h1><p id="de52" class="pw-post-body-paragraph ie if hh ig b ih kx ij ik il ky in io ip kz ir is it la iv iw ix lb iz ja jb ha bi translated">App Service有一个名为“微软互联网信息服务(IIS)”的Web服务器。而且，您的实现代码在Node.js上工作。IIS必须将请求委托给节点流程。也就是说，您需要创建一个名为<code class="du mn mo mp me b">web.config</code>的Web配置文件。这是一个用XML格式写的IIS配置文件。</p><p id="b876" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建一个名为“web.config”的新文件，并写入以下内容:</p><pre class="ld le lf lg fd md me mf mg aw mh bi"><span id="7644" class="mi ka hh me b fi mj mk l ml mm">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;configuration&gt;<br/>  &lt;system.webServer&gt;<br/>    &lt;webSocket enabled="false" /&gt;<br/>    &lt;handlers&gt;<br/>      &lt;add name="iisnode" path="index.js" verb="*" modules="iisnode" /&gt;<br/>    &lt;/handlers&gt;<br/>    &lt;rewrite&gt;<br/>      &lt;rules&gt;<br/>        &lt;rule name="DynamicContent"&gt;<br/>          &lt;conditions&gt;<br/>            &lt;add input="{REQUEST_FILENAME}" matchType="IsFile" negate="True" /&gt;<br/>          &lt;/conditions&gt;<br/>          &lt;action type="Rewrite" url="index.js" /&gt;<br/>        &lt;/rule&gt;<br/>      &lt;/rules&gt;<br/>    &lt;/rewrite&gt;<br/>    &lt;security&gt;<br/>      &lt;requestFiltering&gt;<br/>        &lt;hiddenSegments&gt;<br/>          &lt;remove segment="bin" /&gt;<br/>        &lt;/hiddenSegments&gt;<br/>      &lt;/requestFiltering&gt;<br/>    &lt;/security&gt;<br/>    &lt;httpErrors existingResponse="PassThrough" /&gt;<br/>  &lt;/system.webServer&gt;<br/>&lt;/configuration&gt;</span></pre><h1 id="096a" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">打包、部署和测试</h1><p id="83c1" class="pw-post-body-paragraph ie if hh ig b ih kx ij ik il ky in io ip kz ir is it la iv iw ix lb iz ja jb ha bi translated">现在你可以打包你的代码并将其部署到Azure应用服务。首先，执行以下命令来打包文件:</p><pre class="ld le lf lg fd md me mf mg aw mh bi"><span id="4ad7" class="mi ka hh me b fi mj mk l ml mm">$ zip -r files.zip .</span></pre><p id="2273" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，将zip文件部署到Azure应用服务:</p><pre class="ld le lf lg fd md me mf mg aw mh bi"><span id="46d5" class="mi ka hh me b fi mj mk l ml mm">$ az webapp deployment source config-zip --resource-group &lt;RESOURCE_GROUP_NAME&gt; --name &lt;APP_NAME&gt; --src &lt;ZIP_FILE_PATH&gt;</span></pre><p id="9249" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果部署成功，您的fulfillment webhook端点的URL如下:</p><pre class="ld le lf lg fd md me mf mg aw mh bi"><span id="692c" class="mi ka hh me b fi mj mk l ml mm">https://&lt;APP_NAME&gt;.azurewebsites.net/</span></pre><p id="f22d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在您的Dialogflow代理上将该URL注册为fulfillment webhook URL。然后，在动作模拟器上调用您的动作。</p><h1 id="690a" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">结论</h1><p id="3c15" class="pw-post-body-paragraph ie if hh ig b ih kx ij ik il ky in io ip kz ir is it la iv iw ix lb iz ja jb ha bi translated">在这个故事中，我介绍了如何在Azure App Service上使用Google客户端库上的操作。如果你正在使用Azure应用服务，尝试在Azure上为谷歌助手构建你的动作！</p></div></div>    
</body>
</html>