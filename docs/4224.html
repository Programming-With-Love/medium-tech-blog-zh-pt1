<html>
<head>
<title>How to build actions with Java Client Library on Azure App Service</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Azure App Service上使用Java客户端库构建操作</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/how-to-build-actions-with-java-client-library-on-azure-app-service-3df7e6b1aa0b?source=collection_archive---------6-----------------------#2019-01-23">https://medium.com/google-developer-experts/how-to-build-actions-with-java-client-library-on-azure-app-service-3df7e6b1aa0b?source=collection_archive---------6-----------------------#2019-01-23</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="9a50" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，谷歌发布了一个新的客户端库。名字是“Google Java/Kotlin客户端库上的动作”。</p><div class="jc jd ez fb je jf"><a href="https://github.com/actions-on-google/actions-on-google-java" rel="noopener  ugc nofollow" target="_blank"><div class="jg ab dw"><div class="jh ab ji cl cj jj"><h2 class="bd hi fi z dy jk ea eb jl ed ef hg bi translated">google上的操作/Google-Java上的操作</h2><div class="jm l"><h3 class="bd b fi z dy jk ea eb jl ed ef dx translated">用于在Google上操作的Java/Kotlin库。通过以下方式为actions-on-Google/actions-on-Google-Java开发做出贡献…</h3></div><div class="jn l"><p class="bd b fp z dy jk ea eb jl ed ef dx translated">github.com</p></div></div><div class="jo l"><div class="jp l jq jr js jo jt ju jf"/></div></div></a></div><p id="1091" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">到目前为止，大多数开发人员可以使用一个名为“Node.js的Google客户端库上的操作”的客户端库。也就是说，我们只有用Node.js构建动作的方法。但是，目前，我们可以使用Java/Kotlin客户端库轻松地用Java编程语言构建动作。</p><p id="e843" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在以下文章中描述了用法摘要:</p><div class="jc jd ez fb je jf"><a rel="noopener follow" target="_blank" href="/google-developers/announcing-the-java-kotlin-client-library-for-actions-on-google-217828dead"><div class="jg ab dw"><div class="jh ab ji cl cj jj"><h2 class="bd hi fi z dy jk ea eb jl ed ef hg bi translated">宣布Java &amp; Kotlin客户端库可以在Google上运行</h2><div class="jm l"><h3 class="bd b fi z dy jk ea eb jl ed ef dx translated">自从平台首次推出以来，我们已经为Google上的操作支持了Node.js客户端库。我们学到了很多…</h3></div><div class="jn l"><p class="bd b fp z dy jk ea eb jl ed ef dx translated">medium.com</p></div></div><div class="jo l"><div class="jv l jq jr js jo jt ju jf"/></div></div></a></div><p id="2a21" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本文中，我将介绍如何用Java/Kotlin客户端库构建动作，并将它们部署到Azure App服务。</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="er es jw"><img src="../Images/254bf967780bdbefb2a28957b64ff0d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b8iQ2lg1i4cbCsvFi7yNCw.png"/></div></div></figure><h1 id="3350" class="kh ki hh bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">先决条件</h1><p id="ea86" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">您需要准备以下内容:</p><ul class=""><li id="bd17" class="lk ll hh ig b ih ii il im ip lm it ln ix lo jb lp lq lr ls bi translated">Java开发工具包1.8版或更高版本。</li><li id="6e65" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated"><a class="ae ly" href="https://maven.apache.org/" rel="noopener ugc nofollow" target="_blank"> Maven </a>版本3.6.0以上。</li><li id="3d3d" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated">您已经在Azure上注册了您的帐户。</li><li id="1caf" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated">您已经安装了<a class="ae ly" href="https://docs.microsoft.com/en-us/cli/azure/install-azure-cli?view=azure-cli-latest" rel="noopener ugc nofollow" target="_blank"> Azure CLI </a>并登录到Azure。</li><li id="c98d" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated">你已经了解了如何在谷歌云平台或亚马逊网络服务上为谷歌助手构建动作。</li><li id="064c" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated">您已经在Google project上有了您的操作，并且您的Dialogflow代理已经连接到AoG项目。</li></ul><p id="0861" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你不知道如何构建动作，你可以用codelabs来研究一下:</p><div class="jc jd ez fb je jf"><a href="https://codelabs.developers.google.com/codelabs/actions-1/index.html#0" rel="noopener  ugc nofollow" target="_blank"><div class="jg ab dw"><div class="jh ab ji cl cj jj"><h2 class="bd hi fi z dy jk ea eb jl ed ef hg bi translated">为Google Assistant构建操作(第1级)</h2><div class="jm l"><h3 class="bd b fi z dy jk ea eb jl ed ef dx translated">这个codelab是多模块教程的一部分。每个模块可以单独学习，也可以按照学习顺序学习…</h3></div><div class="jn l"><p class="bd b fp z dy jk ea eb jl ed ef dx translated">codelabs.developers.google.com</p></div></div><div class="jo l"><div class="lz l jq jr js jo jt ju jf"/></div></div></a></div><div class="jc jd ez fb je jf"><a href="https://codelabs.developers.google.com/codelabs/actions-2/index.html#0" rel="noopener  ugc nofollow" target="_blank"><div class="jg ab dw"><div class="jh ab ji cl cj jj"><h2 class="bd hi fi z dy jk ea eb jl ed ef hg bi translated">为Google Assistant构建操作(第2级)</h2><div class="jm l"><h3 class="bd b fi z dy jk ea eb jl ed ef dx translated">此codelab模块是多模块教程的一部分。每个模块可以单独学习，也可以按学习顺序学习…</h3></div><div class="jn l"><p class="bd b fp z dy jk ea eb jl ed ef dx translated">codelabs.developers.google.com</p></div></div><div class="jo l"><div class="ma l jq jr js jo jt ju jf"/></div></div></a></div><p id="dca1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">此外，您需要使用Azure CLI登录Azure。如果您尚未登录，请执行以下命令:</p><pre class="jx jy jz ka fd mb mc md me aw mf bi"><span id="b64f" class="mg ki hh mc b fi mh mi l mj mk">$ az login<br/>$ az account set --subscription &lt;SUBSCRIPTION_ID&gt;</span></pre><h1 id="6284" class="kh ki hh bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">创建您的资源组</h1><p id="b0e7" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">让我们开始创建您的行动。首先，使用以下命令创建一个新的资源组:</p><pre class="jx jy jz ka fd mb mc md me aw mf bi"><span id="932e" class="mg ki hh mc b fi mh mi l mj mk">$ az group create --name &lt;RESOURCE_GROUP_NAME&gt; --location &lt;LOCATION_NAME&gt;</span></pre><h1 id="12e5" class="kh ki hh bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">创建项目</h1><p id="c5b4" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">让我们开始构建您的操作。首先，用Maven创建您的新项目。在本文中，我们使用“simple-action”作为项目名，使用“jp.eisbahn . actions . simple action”作为包名(“jp . EIS Bahn”是我拥有的域)。</p><pre class="jx jy jz ka fd mb mc md me aw mf bi"><span id="e58c" class="mg ki hh mc b fi mh mi l mj mk">$ mvn archetype:generate -DgroupId=jp.eisbahn.actions.simpleaction -DartifactId=simple-action -DarchetypeArtifactId=maven-archetype-webapp -DinteractiveMode=false</span></pre><p id="e4d9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在执行上面的命令之后，您有了<code class="du ml mm mn mc b">simple-action</code>目录，并且在该目录中生成了一些文件。但是有些文件对于本文来说是不必要的。删除下列文件和目录:</p><ul class=""><li id="f4fa" class="lk ll hh ig b ih ii il im ip lm it ln ix lo jb lp lq lr ls bi translated"><code class="du ml mm mn mc b">src/main/webapp/WEB-INF/web.xml</code></li><li id="28c5" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated"><code class="du ml mm mn mc b">src/main/webapp/index.jsp</code></li></ul><h1 id="9875" class="kh ki hh bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">编辑pom.xml文件</h1><p id="a006" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">创建项目后，用以下内容替换<code class="du ml mm mn mc b">pom.xml</code>文件:</p><pre class="jx jy jz ka fd mb mc md me aw mf bi"><span id="9ffb" class="mg ki hh mc b fi mh mi l mj mk">&lt;project ae ly" href="http://maven.apache.org/POM/4.0.0" rel="noopener ugc nofollow" target="_blank"&gt;http://maven.apache.org/POM/4.0.0"<br/>  xmlns:xsi="<a class="ae ly" href="http://www.w3.org/2001/XMLSchema-instance" rel="noopener ugc nofollow" target="_blank">http://www.w3.org/2001/XMLSchema-instance</a>" xsi:schemaLocation="<a class="ae ly" href="http://maven.apache.org/POM/4.0.0" rel="noopener ugc nofollow" target="_blank">http://maven.apache.org/POM/4.0.0</a> <a class="ae ly" href="http://maven.apache.org/maven-v4_0_0.xsd" rel="noopener ugc nofollow" target="_blank">http://maven.apache.org/maven-v4_0_0.xsd</a>"&gt;<br/>  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;<br/>  &lt;groupId&gt;jp.eisbahn.actions.simpleaction&lt;/groupId&gt;<br/>  &lt;artifactId&gt;simple-action&lt;/artifactId&gt;<br/>  &lt;packaging&gt;war&lt;/packaging&gt;<br/>  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;<br/>  &lt;name&gt;simple-action Maven Webapp&lt;/name&gt;<br/>  &lt;url&gt;<a class="ae ly" href="http://maven.apache.org" rel="noopener ugc nofollow" target="_blank">http://maven.apache.org</a>&lt;/url&gt;<br/>  &lt;properties&gt;<br/>    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;<br/>    &lt;java.version&gt;1.8&lt;/java.version&gt;<br/>  &lt;/properties&gt;</span><span id="9e5b" class="mg ki hh mc b fi mo mi l mj mk">  &lt;dependencies&gt;<br/>    &lt;dependency&gt;<br/>      &lt;groupId&gt;javax.servlet&lt;/groupId&gt;<br/>      &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;<br/>      &lt;version&gt;3.1.0&lt;/version&gt;<br/>      &lt;scope&gt;provided&lt;/scope&gt;<br/>    &lt;/dependency&gt;<br/>    &lt;dependency&gt;<br/>      &lt;groupId&gt;com.google.actions&lt;/groupId&gt;<br/>      &lt;artifactId&gt;actions-on-google&lt;/artifactId&gt;<br/>      &lt;version&gt;1.0.1&lt;/version&gt;<br/>    &lt;/dependency&gt;<br/>  &lt;/dependencies&gt;</span><span id="9639" class="mg ki hh mc b fi mo mi l mj mk">  &lt;build&gt;<br/>    &lt;finalName&gt;simple-action&lt;/finalName&gt;</span><span id="7464" class="mg ki hh mc b fi mo mi l mj mk">    &lt;plugins&gt;<br/>      &lt;plugin&gt;<br/>        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br/>        &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;<br/>        &lt;version&gt;3.8.0&lt;/version&gt;<br/>        &lt;configuration&gt;<br/>          &lt;source&gt;${java.version}&lt;/source&gt;<br/>          &lt;target&gt;${java.version}&lt;/target&gt;<br/>        &lt;/configuration&gt;<br/>      &lt;/plugin&gt;</span><span id="fba3" class="mg ki hh mc b fi mo mi l mj mk">      &lt;plugin&gt;<br/>        &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;<br/>        &lt;artifactId&gt;maven-war-plugin&lt;/artifactId&gt;<br/>        &lt;version&gt;3.2.2&lt;/version&gt;<br/>        &lt;configuration&gt;<br/>          &lt;failOnMissingWebXml&gt;false&lt;/failOnMissingWebXml&gt;<br/>        &lt;/configuration&gt;<br/>      &lt;/plugin&gt;</span><span id="f9f9" class="mg ki hh mc b fi mo mi l mj mk">      &lt;plugin&gt;<br/>        &lt;groupId&gt;com.microsoft.azure&lt;/groupId&gt;<br/>        &lt;artifactId&gt;azure-webapp-maven-plugin&lt;/artifactId&gt;<br/>        &lt;version&gt;1.5.2&lt;/version&gt;<br/>        &lt;configuration&gt;<br/>          &lt;schemaVersion&gt;v2&lt;/schemaVersion&gt;<br/>          &lt;resourceGroup&gt;__RESOURCE_GROUP_NAME__&lt;/resourceGroup&gt;<br/>          &lt;appName&gt;__APP_NAME__&lt;/appName&gt;<br/>          &lt;region&gt;__LOCATION_NAME__&lt;/region&gt;<br/>          &lt;pricingTier&gt;__PRICE_TEAR_NAME__&lt;/pricingTier&gt;<br/>          &lt;runtime&gt;<br/>            &lt;os&gt;windows&lt;/os&gt;<br/>            &lt;javaVersion&gt;1.8&lt;/javaVersion&gt;<br/>            &lt;webContainer&gt;tomcat 8.5&lt;/webContainer&gt;<br/>          &lt;/runtime&gt;<br/>          &lt;deployment&gt;<br/>            &lt;resources&gt;<br/>              &lt;resource&gt;<br/>                &lt;directory&gt;${project.basedir}/target&lt;/directory&gt;<br/>                &lt;includes&gt;<br/>                  &lt;include&gt;*.war&lt;/include&gt;<br/>                &lt;/includes&gt;<br/>              &lt;/resource&gt;<br/>            &lt;/resources&gt;<br/>          &lt;/deployment&gt;<br/>        &lt;/configuration&gt;<br/>      &lt;/plugin&gt;<br/>    &lt;/plugins&gt;<br/>  &lt;/build&gt;<br/>&lt;/project&gt;</span></pre><p id="27ea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在上面的代码中，<code class="du ml mm mn mc b"><a class="ae ly" href="https://docs.microsoft.com/en-us/java/api/overview/azure/maven/azure-webapp-maven-plugin/readme?view=azure-java-stable" rel="noopener ugc nofollow" target="_blank">azure-webapp-maven-plugin</a></code>插件元素有一些占位符。您需要替换以下占位符:</p><ul class=""><li id="0db8" class="lk ll hh ig b ih ii il im ip lm it ln ix lo jb lp lq lr ls bi translated"><code class="du ml mm mn mc b">__RESOURCE_GROUP_NAME__</code>:您创建的资源组名称。</li><li id="e061" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated"><code class="du ml mm mn mc b">__APP_NAME__</code>:您的应用程序的标识符。</li><li id="9519" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated"><code class="du ml mm mn mc b">__LOCATION_NAME__</code>:您要创建app的位置名称。</li><li id="934b" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated"><code class="du ml mm mn mc b">__PRICING_TIER_NAME__</code>:定价层级<a class="ae ly" href="https://docs.microsoft.com/en-us/java/api/overview/azure/maven/azure-webapp-maven-plugin/readme?view=azure-java-stable#pricingtier" rel="noopener ugc nofollow" target="_blank">名称</a>。</li></ul><p id="d4d8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果不存在，则<code class="du ml mm mn mc b">azure-webapp-maven-plugin</code>会自动生成新的应用服务。现在就决定他们的名字，换掉他们。</p><h2 id="b7e6" class="mg ki hh bd kj mp mq mr kn ms mt mu kr ip mv mw kv it mx my kz ix mz na ld nb bi translated">对于Java开发工具包版本11</h2><p id="f5bb" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">如果您使用的是Java Development Kit版本11或更高版本，您将会在使用上面的<code class="du ml mm mn mc b">pom.xml</code>文件执行<code class="du ml mm mn mc b">mvn</code>命令时看到一个错误。原因是JAXB被弃用了。要解决这个问题，您需要向<code class="du ml mm mn mc b">azure-webapp-maven-plugin</code>插件元素添加以下定义:</p><pre class="jx jy jz ka fd mb mc md me aw mf bi"><span id="0f0d" class="mg ki hh mc b fi mh mi l mj mk">&lt;plugin&gt;<br/>  &lt;groupId&gt;com.microsoft.azure&lt;/groupId&gt;<br/>  &lt;artifactId&gt;azure-webapp-maven-plugin&lt;/artifactId&gt;<br/>  &lt;version&gt;1.5.2&lt;/version&gt;<br/>  &lt;configuration&gt;<br/>    ...<br/>  &lt;/configuration&gt;</span><span id="692b" class="mg ki hh mc b fi mo mi l mj mk">  &lt;!-- Add the following definition --&gt;<br/>  &lt;dependencies&gt;<br/>    &lt;dependency&gt;<br/>      &lt;groupId&gt;javax.xml.bind&lt;/groupId&gt;<br/>      &lt;artifactId&gt;jaxb-api&lt;/artifactId&gt;<br/>      &lt;version&gt;2.4.0-b180830.0359&lt;/version&gt;<br/>    &lt;/dependency&gt;<br/>    &lt;dependency&gt;<br/>      &lt;groupId&gt;com.sun.xml.bind&lt;/groupId&gt;<br/>      &lt;artifactId&gt;jaxb-impl&lt;/artifactId&gt;<br/>      &lt;version&gt;2.4.0-b180830.0438&lt;/version&gt;<br/>    &lt;/dependency&gt;<br/>    &lt;dependency&gt;<br/>      &lt;groupId&gt;com.sun.xml.bind&lt;/groupId&gt;<br/>      &lt;artifactId&gt;jaxb-core&lt;/artifactId&gt;<br/>      &lt;version&gt;2.3.0.1&lt;/version&gt;<br/>    &lt;/dependency&gt;<br/>    &lt;dependency&gt;<br/>      &lt;groupId&gt;javax.activation&lt;/groupId&gt;<br/>      &lt;artifactId&gt;activation&lt;/artifactId&gt;<br/>      &lt;version&gt;1.1.1&lt;/version&gt;<br/>    &lt;/dependency&gt;<br/>  &lt;/dependencies&gt;<br/>&lt;/plugin&gt;</span></pre><h1 id="0d1a" class="kh ki hh bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">创建履行代码</h1><p id="63d6" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">接下来，您需要为您的操作创建履行代码。使用以下命令创建源目录:</p><pre class="jx jy jz ka fd mb mc md me aw mf bi"><span id="d31b" class="mg ki hh mc b fi mh mi l mj mk">$ mkdir -p src/main/java/jp/eisbahn/actions/simpleaction</span></pre><p id="34af" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，在<code class="du ml mm mn mc b">simpleaction</code>目录中创建名为“SimpleApp.java”的实现文件，内容如下:</p><pre class="jx jy jz ka fd mb mc md me aw mf bi"><span id="4aef" class="mg ki hh mc b fi mh mi l mj mk">package jp.eisbahn.actions.simpleaction;</span><span id="6daf" class="mg ki hh mc b fi mo mi l mj mk">import com.google.actions.api.ActionRequest;<br/>import com.google.actions.api.ActionResponse;<br/>import com.google.actions.api.DialogflowApp;<br/>import com.google.actions.api.ForIntent;<br/>import com.google.actions.api.response.ResponseBuilder;</span><span id="76a0" class="mg ki hh mc b fi mo mi l mj mk">public class SimpleApp extends DialogflowApp {</span><span id="7a08" class="mg ki hh mc b fi mo mi l mj mk">    @ForIntent("Default Welcome Intent")<br/>    public ActionResponse welcome(ActionRequest request) {<br/>        ResponseBuilder builder = getResponseBuilder(request);<br/>        builder.add("Hello, Azure App Service!");<br/>        return builder.build();<br/>    }</span><span id="4649" class="mg ki hh mc b fi mo mi l mj mk">}</span></pre><p id="4160" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在上面的代码中，<code class="du ml mm mn mc b">SimpleApp</code>类扩展了<code class="du ml mm mn mc b">DialogflowApp</code>类。也就是说，该类可以处理来自Dialogflow代理的请求。并且，您可以使用<code class="du ml mm mn mc b">ForIntent</code>注释创建意图处理程序方法。</p><p id="1012" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第一个参数包含请求的信息。并且，您可以用<code class="du ml mm mn mc b">ResponseBuilder</code>类创建<code class="du ml mm mn mc b">ActionResponse</code>实例。</p><div class="jc jd ez fb je jf"><a href="https://actions-on-google.github.io/actions-on-google-java/com/google/actions/api/response/ResponseBuilder.html" rel="noopener  ugc nofollow" target="_blank"><div class="jg ab dw"><div class="jh ab ji cl cj jj"><h2 class="bd hi fi z dy jk ea eb jl ed ef hg bi translated">响应生成器</h2><div class="jm l"><h3 class="bd b fi z dy jk ea eb jl ed ef dx translated">构建器来组合来自动作webhook的响应。推荐的方法是从…获取ResponseBuilder实例</h3></div><div class="jn l"><p class="bd b fp z dy jk ea eb jl ed ef dx translated">google.github.io上的操作</p></div></div></div></a></div><p id="ae80" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过阅读上面的API参考，您可以知道如何构建响应。</p><h1 id="bf5e" class="kh ki hh bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">创建Servlet代码</h1><p id="ecfe" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">顺便说一下，<code class="du ml mm mn mc b">SimpleApp</code>类没有任何处理HTTP请求的能力。相反，您需要创建一个处理程序类来处理请求和响应。在本文中，创建一个Java Servlet代码来处理HTTP请求和响应。</p><p id="3265" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在<code class="du ml mm mn mc b">simpleaction</code>目录中创建名为“SimpleServlet.java”的实施文件，内容如下:</p><pre class="jx jy jz ka fd mb mc md me aw mf bi"><span id="1dcb" class="mg ki hh mc b fi mh mi l mj mk">package jp.eisbahn.actions.simpleaction;</span><span id="4a5c" class="mg ki hh mc b fi mo mi l mj mk">import com.google.actions.api.App;<br/>import javax.servlet.annotation.WebServlet;<br/>import javax.servlet.http.HttpServlet;<br/>import javax.servlet.http.HttpServletRequest;<br/>import javax.servlet.http.HttpServletResponse;<br/>import java.io.IOException;<br/>import java.util.Collections;<br/>import java.util.Map;<br/>import java.util.concurrent.ExecutionException;<br/>import java.util.stream.Collectors;</span><span id="8639" class="mg ki hh mc b fi mo mi l mj mk">@WebServlet(name = "SimpleServlet", urlPatterns = {"/"}, loadOnStartup = 1)<br/>public class SimpleServlet extends HttpServlet {</span><span id="37bd" class="mg ki hh mc b fi mo mi l mj mk">private App app = new SimpleApp();</span><span id="493f" class="mg ki hh mc b fi mo mi l mj mk">    @Override<br/>    protected void doPost(<br/>            HttpServletRequest req, HttpServletResponse resp)<br/>            throws IOException {<br/>        String requestBody =<br/>            req.getReader().lines().collect(Collectors.joining());<br/>        Map&lt;String, String&gt; headersMap =<br/>            Collections.list(req.getHeaderNames())<br/>                .stream()<br/>                .collect(Collectors.toMap(<br/>                    name -&gt; name,<br/>                    req::getHeader));<br/>        try {<br/>            String responseBody =<br/>                app.handleRequest(requestBody, headersMap).get();<br/>            resp.setContentType("application/json; charset=utf-8");<br/>            resp.getWriter().write(responseBody);<br/>        } catch (InterruptedException | ExecutionException e) {<br/>            e.printStackTrace();<br/>            resp.setStatus(<br/>                HttpServletResponse.SC_INTERNAL_SERVER_ERROR);<br/>            resp.getWriter().write(e.getMessage());<br/>        }<br/>    }</span><span id="dea5" class="mg ki hh mc b fi mo mi l mj mk">}</span></pre><p id="24e1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要调用<code class="du ml mm mn mc b">SimpleApp</code>实例，您需要以下信息:</p><ul class=""><li id="ffd6" class="lk ll hh ig b ih ii il im ip lm it ln ix lo jb lp lq lr ls bi translated">请求正文的字符串。</li><li id="e1f0" class="lk ll hh ig b ih lt il lu ip lv it lw ix lx jb lp lq lr ls bi translated">拥有所有请求头条目的<code class="du ml mm mn mc b">Map&lt;String, String&gt;</code>对象。</li></ul><p id="43b1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，用这些参数调用<code class="du ml mm mn mc b">SimpleApp</code>实例的<code class="du ml mm mn mc b">handleRequest()</code>方法。如果调用方法的结果是成功，则返回<code class="du ml mm mn mc b">CompletableFuture&lt;String&gt;</code>对象。这是针对JavaScript中的异步like Promise。在上面的代码中，通过调用<code class="du ml mm mn mc b">get()</code>方法来检索实际结果。</p><p id="513e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">结果是响应的字符串值，表示为JSON字符串。<code class="du ml mm mn mc b">SimpleServlet</code>发送带有通过调用<code class="du ml mm mn mc b">getWriter()</code>方法检索的Writer对象的响应字符串。</p><h1 id="06bc" class="kh ki hh bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">部署您的代码</h1><p id="6dee" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">干得好！你有所有必要的文件。现在，您可以将您的操作部署到Azure。</p><p id="fffb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">执行以下命令来部署您的操作:</p><pre class="jx jy jz ka fd mb mc md me aw mf bi"><span id="ed75" class="mg ki hh mc b fi mh mi l mj mk">$ mvn package azure-webapp:deploy</span></pre><p id="42ef" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您看到如下输出，则部署成功。</p><pre class="jx jy jz ka fd mb mc md me aw mf bi"><span id="eb0f" class="mg ki hh mc b fi mh mi l mj mk">[INFO] Scanning for projects...<br/>[INFO]<br/>[INFO] -----------&lt; jp.eisbahn.actions.simpleaction:simple-action &gt;------------<br/>[INFO] Building simple-action Maven Webapp 1.0-SNAPSHOT<br/>[INFO] --------------------------------[ war ]---------------------------------<br/>[INFO]<br/>...<br/>[INFO] Deploying the war file simple-action.war...<br/>[INFO] Successfully deployed the artifact to <a class="ae ly" href="https://yoichirosimpleaction.azurewebsites.net" rel="noopener ugc nofollow" target="_blank">https://&lt;APP_NAME&gt;.azurewebsites.net</a><br/>[INFO] ------------------------------------------------------------------------<br/>[INFO] BUILD SUCCESS<br/>[INFO] ------------------------------------------------------------------------<br/>[INFO] Total time:  25.064 s<br/>[INFO] Finished at: 2019-01-23T15:57:41+09:00<br/>[INFO] ------------------------------------------------------------------------</span></pre><p id="4fb1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以通过以下命令对其进行测试:</p><pre class="jx jy jz ka fd mb mc md me aw mf bi"><span id="5057" class="mg ki hh mc b fi mh mi l mj mk">$ curl -v -X POST -d "{}" https://&lt;APP_NAME&gt;.azurewebsites.net/</span></pre><p id="7e88" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您收到如下输出，就没问题了:</p><pre class="jx jy jz ka fd mb mc md me aw mf bi"><span id="4634" class="mg ki hh mc b fi mh mi l mj mk">&lt; HTTP/1.1 500  <br/>&lt; Content-Length: 55<br/>&lt; X-Powered-By: ASP.NET<br/>&lt; Set-Cookie: ARRAffinity=932c5351a290b46f876f6d4453f2bdc8625e8682cbfa134e04eb88e0677cb1fc;Path=/;HttpOnly;Domain=&lt;APP_NAME&gt;.azurewebsites.net<br/>&lt; Date: Wed, 23 Jan 2019 07:02:34 GMT<br/>&lt; <br/>* Connection #0 to host &lt;APP_NAME&gt;.azurewebsites.net left intact<br/>java.lang.Exception: Intent handler not found - INVALID%</span></pre><p id="e91b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Google Java/Kotlin客户端库上的操作返回了消息“未找到意图处理程序”。</p><p id="530f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">部署后，在您的Dialogflow代理上将该URL注册为fulfillment webhook URL。然后，在动作模拟器上调用您的动作。你应该得到回应“你好，Azure应用服务！”从谷歌助手。</p><h1 id="e403" class="kh ki hh bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">结论</h1><p id="a509" class="pw-post-body-paragraph ie if hh ig b ih lf ij ik il lg in io ip lh ir is it li iv iw ix lj iz ja jb ha bi translated">如果你是一名Java程序员，你可以用Google Java/Kotlin客户端库上的动作和你所熟悉的Java语言为Google Assistant构建你的动作。当你对谷歌助手的操作感兴趣时，如果这篇文章对你有用，我会很高兴。</p><p id="3d85" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，您可以从下面的GitHub库获得完整的代码集:</p><div class="jc jd ez fb je jf"><a href="https://github.com/yoichiro/simple-action-azure-java-maven" rel="noopener  ugc nofollow" target="_blank"><div class="jg ab dw"><div class="jh ab ji cl cj jj"><h2 class="bd hi fi z dy jk ea eb jl ed ef hg bi translated">洋一郎/简单-动作-azure-java-maven</h2><div class="jm l"><h3 class="bd b fi z dy jk ea eb jl ed ef dx translated">这是一个简单的项目，为部署到Azure应用服务的谷歌动作建立一个实现…</h3></div><div class="jn l"><p class="bd b fp z dy jk ea eb jl ed ef dx translated">github.com</p></div></div><div class="jo l"><div class="nc l jq jr js jo jt ju jf"/></div></div></a></div></div></div>    
</body>
</html>