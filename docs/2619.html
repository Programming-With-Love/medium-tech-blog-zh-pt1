<html>
<head>
<title>Build Basic Chatbot with Golang &amp; Telegram</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Golang &amp; Telegram构建基本聊天机器人</h1>
<blockquote>原文：<a href="https://medium.easyread.co/build-basic-chatbot-with-golang-telegram-48390fb2765a?source=collection_archive---------1-----------------------#2022-09-05">https://medium.easyread.co/build-basic-chatbot-with-golang-telegram-48390fb2765a?source=collection_archive---------1-----------------------#2022-09-05</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/0e1f880533780568d11cb7f955888a3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9ShdgSnuixqVzfpPZMw4qQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Chatbot with Golang &amp; telegram</figcaption></figure><h1 id="3f04" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">介绍</h1><p id="9f35" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">大家好！还是跟我分享一些软件工程领域中关于技术相关的经验，想法，或者看法。之前，我分享了如何使用Golang在Messenger上创建一个简单的聊天机器人，如果你感兴趣，请阅读这里。(<a class="ae lv" href="https://bismobaruno.medium.com/build-simple-chatbot-with-golang-messenger-f00f6299960" rel="noopener">https://bismobaruno . medium . com/build-simple-chatbot-with-golang-messenger-f00f 6299960</a>)</p><p id="6c77" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">在这篇文章中，我想分享我们如何使用另一个平台，在这种情况下，我们将尝试使用电报！当然还是用Golang做后端！</p><p id="c083" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">为了给我们应该做的事情提供一些背景，我们将处理以下几点:</p><ul class=""><li id="685d" class="mb mc in kz b la lw le lx li md lm me lq mf lu mg mh mi mj bi translated">拥有一个电报帐户或创建一个新帐户。</li><li id="d7f9" class="mb mc in kz b la mk le ml li mm lm mn lq mo lu mg mh mi mj bi translated">使用机器人父亲创建一个机器人。</li><li id="c9b6" class="mb mc in kz b la mk le ml li mm lm mn lq mo lu mg mh mi mj bi translated">在创建的Bot上配置webhook设置。</li><li id="e5d9" class="mb mc in kz b la mk le ml li mm lm mn lq mo lu mg mh mi mj bi translated">创建一个webhook服务器。</li></ul><h1 id="2d9e" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">建筑设计</h1><p id="7d18" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">为了接收终端用户发送给Telegram的消息，我们需要提供一个带有REST API的Webhook服务器。架构设计将如下图所示:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mp"><img src="../Images/bf9c2d1c397098e9e2cefa4f819e0e12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dMGwyf9fv9jYLfHCjbEG1Q.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Chatbot Architecture Design</figcaption></figure><h1 id="a9b0" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">电报帐户</h1><p id="76f4" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">基本要求是有电报帐号。要注册Telegram，请在Play Store / App Store上找到应用程序，或者打开此链接【https://telegram.org/apps T4】，然后根据我们使用的设备选择移动应用程序。</p><blockquote class="mu mv mw"><p id="a552" class="kx ky mx kz b la lw lc ld le lx lg lh my ly lk ll mz lz lo lp na ma ls lt lu ig bi translated">注意:要注册telegram，我们需要一个有效的电话号码。</p></blockquote><h1 id="d1ff" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">使用机器人父亲创建一个机器人</h1><p id="a320" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">完成帐户注册后，下一步是使用Bot父亲创建Bot。我们可以从手机应用程序中搜索机器人，或者打开这个链接<a class="ae lv" href="https://telegram.me/BotFather" rel="noopener ugc nofollow" target="_blank">https://telegram.me/BotFather</a>，然后在手机应用程序或网络上打开它。</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/8540dd923e0ccc3db727935320b3eb6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NzTJHyu6kGYc01RBuO3yIg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">BotFather Commands List</figcaption></figure><p id="3723" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">要知道什么命令列表，我们可以给机器人父亲发送<code class="fe nc nd ne nf b">/start</code>一条消息，并将回复一条类似上图的消息。</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/3add979a86e005628e14e27c0fb3a6bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-2lhy_fZp_DZleNuABTkzA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Successfully Created a Bot</figcaption></figure><p id="08b8" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">创建一个新的机器人非常简单。只需输入<code class="fe nc nd ne nf b">/newbot</code>然后输入机器人名称。仅供参考，机器人名称应以机器人结尾。成功创建后，机器人父亲将发送一条消息，其中包含可用于访问电报API的令牌。请确保将此令牌存储在安全的地方。</p><h1 id="d245" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">Webhook</h1><p id="b38c" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">在第一阶段，我们可以创建一个简单的Webhook来打印请求数据，以查看实际发送的数据。</p><p id="e4c7" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">因为我们将在本教程中使用Go，所以通过以下链接可以更好地理解Go:</p><div class="ng nh gp gr ni nj"><a href="https://go.dev/" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd io gy z fp no fr fs np fu fw im bi translated">Go编程语言</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">Go是一种开源编程语言，它使构建简单、可靠和高效的软件变得容易。</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">go.dev</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx jt nj"/></div></div></a></div><p id="3e68" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">那么，Go代码的例子可以是这样的:</p><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="8468" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">实际上，我们需要部署可以从Telegram平台接收Webhook事件的live Webhook。代码必须托管在公共HTTPS服务器上。但是我们可以在本地完成，并使用ngrok创建一个从公共URL到本地主机的隧道。要安装和使用ngrok，请参考以下链接:</p><div class="ng nh gp gr ni nj"><a href="https://ngrok.com/" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab fo"><div class="nl ab nm cl cj nn"><h2 class="bd io gy z fp no fr fs np fu fw im bi translated">ngrok -在线一行</h2><div class="nq l"><h3 class="bd b gy z fp no fr fs np fu fw dk translated">ngrok的优势就是你的竞争优势。借助全球网络加速和k8s式负载扩展您的服务…</h3></div><div class="nr l"><p class="bd b dl z fp no fr fs np fu fw dk translated">ngrok.com</p></div></div><div class="ns l"><div class="oa l nu nv nw ns nx jt nj"/></div></div></a></div><p id="7beb" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">首先，使用以下命令运行Webhook服务器:</p><pre class="mq mr ms mt gt ob nf oc od aw oe bi"><span id="ea43" class="of ka in nf b gy og oh l oi oj">go run .</span></pre><p id="1338" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">Webhook将在端口3000上运行。</p><pre class="mq mr ms mt gt ob nf oc od aw oe bi"><span id="5749" class="of ka in nf b gy og oh l oi oj">2022/09/05 17:53:20 http server listening at localhost:3000</span></pre><p id="d044" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">然后，启用隧道非常简单，只需运行以下命令:</p><pre class="mq mr ms mt gt ob nf oc od aw oe bi"><span id="4448" class="of ka in nf b gy og oh l oi oj">ngrok http 3000</span></pre><p id="81e1" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">如果ngrok成功地启用了隧道，输出将如下所示:</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ok"><img src="../Images/26ed1248a95787da90a5957c126aef2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mWIBlOx9MTx9tD6t8xa1FQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">ngrok Enabling Tunnel</figcaption></figure><p id="63f5" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">为了测试这个webhook，我们可以通过调用Telegram API在Bot设置中设置ngrok URL。下面是用于更新Webhook URL的curl:</p><pre class="mq mr ms mt gt ob nf oc od aw oe bi"><span id="86e0" class="of ka in nf b gy og oh l oi oj">curl --location --request POST 'https://api.telegram.org/bot${BOT_TOKEN}/SetWebhook' \</span><span id="3310" class="of ka in nf b gy ol oh l oi oj">--header 'Content-Type: application/x-www-form-urlencoded' \</span><span id="a4a2" class="of ka in nf b gy ol oh l oi oj">--data-urlencode 'url=https://3391-126-117-109-73.ngrok.io'</span></pre><p id="626e" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">请用我们在创建新机器人后获得的令牌更改<code class="fe nc nd ne nf b">${BOT_TOKEN}</code>。</p><p id="4095" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">如果Webhook设置成功，它应该返回以下JSON:</p><pre class="mq mr ms mt gt ob nf oc od aw oe bi"><span id="4c80" class="of ka in nf b gy og oh l oi oj">{<br/> "ok": true,<br/> "result": true,<br/> "description": "Webhook was set"<br/>}</span></pre><p id="0df7" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">下一步是搜索我们创建的机器人，只需点击<code class="fe nc nd ne nf b">START</code>按钮来触发消息。</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/bfc83803635d69f87026bf5616cb97b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZrSQg7bzS_X785nM_qn4TQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Start a conversation with the Bot</figcaption></figure><p id="64a9" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">如果控制台收到这种消息，这意味着Webhook配置设置正确，webhook代码正在工作！</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi om"><img src="../Images/aa36547ab711d87d76b9bb8a8c0c29f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-vc4q0d7BMUb-wMoAqACfg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Webhook successfully received a message</figcaption></figure><h1 id="7908" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">修改Webhook</h1><p id="1a01" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">要向特定用户发送消息，我们只需用令牌调用Telegram API，并指定用户id和消息。我们将修改代码，以便在发送任何内容时总是发送静态回复消息。最终的代码将如下所示(确保用真实的令牌替换常量<code class="fe nc nd ne nf b">ACCESS_TOKEN</code>):</p><figure class="mq mr ms mt gt jo"><div class="bz fp l di"><div class="ny nz l"/></div></figure><p id="6dc5" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">上面的代码只是一个简单的聊天机器人，它总是发送“自动回复🙌🏻“消息无论最终用户发送何种类型的消息(文本、贴纸、表情符号、gif、文件)。下面是最终代码的结果，发送消息后我们得到了回复！是的，起作用了！！</p><figure class="mq mr ms mt gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi on"><img src="../Images/1ea425ff3812a7570b48cb2ff0b5492f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J1JGzqIDbhgEcpQ4CZ1SDw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Webhook Sent Reply Message</figcaption></figure><h1 id="bb21" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">Webhook秘密令牌</h1><p id="7f9d" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">使用当前的实现，每个知道我们的Webhook URL的人都可以自由地访问它。为了确保这一点，Telegram在这里有了新的更新:【https://core.telegram.org/bots/api#june-20-2022 T4】</p><p id="ef52" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">将<em class="mx"> secret_token </em>作为可选参数，我们可以在<a class="ae lv" href="https://core.telegram.org/bots/api#setwebhook" rel="noopener ugc nofollow" target="_blank"> setWebhook </a>方法上选择是否设置。当我们配置密码时，我们可以通过查看<code class="fe nc nd ne nf b">X-Telegram-Bot-Api-Secret-Token</code>头来验证传入的请求。</p><h1 id="c7b0" class="jz ka in bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">关闭</h1><p id="740e" class="pw-post-body-paragraph kx ky in kz b la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu ig bi translated">为Telegram平台构建一个Chabot非常简单，因为从创建一个bot和配置Webhook URL开始并不需要花费太多精力。此外，没有限制我们创建机器人，所以我们可以很容易地测试我们的聊天机器人。</p><p id="024a" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">虽然这篇文章的范围仅限于回复消息，但有很多电报功能可用，所以我希望你能自己探索更多！</p><p id="c5de" class="pw-post-body-paragraph kx ky in kz b la lw lc ld le lx lg lh li ly lk ll lm lz lo lp lq ma ls lt lu ig bi translated">感谢您的阅读！希望这篇文章对你有用！！</p></div></div>    
</body>
</html>