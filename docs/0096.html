<html>
<head>
<title>What’s Next for Mobile at Airbnb</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Airbnb的下一步是什么</h1>
<blockquote>原文：<a href="https://medium.com/airbnb-engineering/whats-next-for-mobile-at-airbnb-5e71618576ab?source=collection_archive---------3-----------------------#2018-06-19">https://medium.com/airbnb-engineering/whats-next-for-mobile-at-airbnb-5e71618576ab?source=collection_archive---------3-----------------------#2018-06-19</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="988f" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">将最好的带回本土</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/b635a58392c771ec0e9397060df0a76d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_N3sz8fhNFU5tB5YTVfGHg.jpeg"/></div></div></figure><p id="782e" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><em class="ke">这是</em> <a class="ae kf" rel="noopener" href="/airbnb-engineering/react-native-at-airbnb-f95aa460be1c"> <em class="ke">系列博文</em> </a> <em class="ke">中的第五篇，在这篇博文中，我们概述了React Native的使用体验以及Airbnb的下一步移动应用。</em></p><h1 id="bd51" class="kg kh hh bd ki kj kk kl km kn ko kp kq in kr io ks iq kt ir ku it kv iu kw kx bi translated">激动人心的时刻即将到来</h1><p id="8bc9" class="pw-post-body-paragraph ji jj hh jk b jl ky ii jn jo kz il jq jr la jt ju jv lb jx jy jz lc kb kc kd ha bi translated">即使在试验React Native的同时，我们也继续在Native上加速努力。今天，我们有许多令人兴奋的项目正在生产或筹备中。其中一些项目的灵感来自我们使用React Native的经验和教训。</p><h2 id="590b" class="ld kh hh bd ki le lf lg km lh li lj kq jr lk ll ks jv lm ln ku jz lo lp kw lq bi translated">服务器驱动的渲染</h2><p id="7beb" class="pw-post-body-paragraph ji jj hh jk b jl ky ii jn jo kz il jq jr la jt ju jv lb jx jy jz lc kb kc kd ha bi translated">即使我们没有使用React Native，我们仍然看到了编写一次产品代码的价值。我们仍然严重依赖我们的通用设计语言系统(<a class="ae kf" href="https://airbnb.design/building-a-visual-language/" rel="noopener ugc nofollow" target="_blank"> DLS </a>)，许多屏幕在Android和iOS上看起来几乎一样。</p><p id="f4db" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">几个团队已经尝试并开始围绕强大的服务器驱动的渲染框架进行统一。通过这些框架，服务器向设备发送数据，描述要呈现的组件、屏幕配置和可能发生的动作。然后，每个移动平台解释这些数据，并使用DLS组件呈现本机屏幕甚至整个流程。</p><p id="567b" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">服务器驱动的大规模渲染带来了一系列挑战。这里有一些我们正在解决的问题:</p><ul class=""><li id="c340" class="lr ls hh jk b jl jm jo jp jr lt jv lu jz lv kd lw lx ly lz bi translated">安全地更新我们的组件定义，同时保持向后兼容性。</li><li id="61c1" class="lr ls hh jk b jl ma jo mb jr mc jv md jz me kd lw lx ly lz bi translated">跨平台共享组件的类型定义。</li><li id="2cd5" class="lr ls hh jk b jl ma jo mb jr mc jv md jz me kd lw lx ly lz bi translated">响应运行时的事件，如点击按钮或用户输入。</li><li id="4f1d" class="lr ls hh jk b jl ma jo mb jr mc jv md jz me kd lw lx ly lz bi translated">在多个JSON驱动的屏幕之间转换，同时保持内部状态。</li><li id="c35b" class="lr ls hh jk b jl ma jo mb jr mc jv md jz me kd lw lx ly lz bi translated">呈现在构建时没有现有实现的完全自定义的组件。我们正在为此试验<a class="ae kf" href="https://github.com/airbnb/Lona/" rel="noopener ugc nofollow" target="_blank"> Lona </a>格式。</li></ul><p id="5b2f" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">服务器驱动的渲染框架已经提供了巨大的价值，它允许我们通过无线方式即时试验和更新功能。</p><h2 id="6fc0" class="ld kh hh bd ki le lf lg km lh li lj kq jr lk ll ks jv lm ln ku jz lo lp kw lq bi translated">环氧成分</h2><p id="8371" class="pw-post-body-paragraph ji jj hh jk b jl ky ii jn jo kz il jq jr la jt ju jv lb jx jy jz lc kb kc kd ha bi translated">2016年，我们为Android开源了<a class="ae kf" href="https://github.com/airbnb/epoxy" rel="noopener ugc nofollow" target="_blank">环氧</a>。Epoxy是一个框架，支持简单的异构RecyclerViews、UICollectionViews和UITableViews。今天，大多数新屏幕使用环氧树脂。这样做可以让我们将每个屏幕分解成独立的组件，实现延迟渲染。今天，我们在Android和iOS上有环氧树脂。</p><p id="1bf5" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这是它在iOS上的样子:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="72bf" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在Android上，我们利用了用Kotlin 编写<a class="ae kf" href="https://kotlinlang.org/docs/reference/type-safe-builders.html" rel="noopener ugc nofollow" target="_blank">DSL的能力，使得实现组件变得容易编写并且类型安全:</a></p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mf mg l"/></div></figure><h2 id="022f" class="ld kh hh bd ki le lf lg km lh li lj kq jr lk ll ks jv lm ln ku jz lo lp kw lq bi translated">环氧树脂扩散</h2><p id="e870" class="pw-post-body-paragraph ji jj hh jk b jl ky ii jn jo kz il jq jr la jt ju jv lb jx jy jz lc kb kc kd ha bi translated">在React中，您从<a class="ae kf" href="https://reactjs.org/tutorial/tutorial.html#what-is-react" rel="noopener ugc nofollow" target="_blank"> render </a>返回一个组件列表。React性能的关键在于，这些组件只是您想要呈现的实际视图/HTML的数据模型表示。然后，组件树被区分，并且仅分派变更。我们为环氧树脂建立了类似的概念。在Epoxy中，你在<a class="ae kf" href="https://reactjs.org/tutorial/tutorial.html#what-is-react" rel="noopener ugc nofollow" target="_blank"> buildModels </a>中声明整个屏幕的模型。这与优雅的Kotlin DSL相结合，使得它在概念上与React非常相似，如下所示:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="6b67" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">每当您的数据发生变化时，您调用requestModelBuild()，它将使用分派的最佳RecyclerView调用重新呈现您的屏幕。</p><p id="68be" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在iOS上，它看起来像这样:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mf mg l"/></div></figure><h2 id="4a2b" class="ld kh hh bd ki le lf lg km lh li lj kq jr lk ll ks jv lm ln ku jz lo lp kw lq bi translated">新的Android产品框架(MvRx)</h2><p id="8ab7" class="pw-post-body-paragraph ji jj hh jk b jl ky ii jn jo kz il jq jr la jt ju jv lb jx jy jz lc kb kc kd ha bi translated">最近最令人兴奋的进展之一是我们正在开发的新框架，我们内部称之为MvRx。MvRx结合了Epoxy、<a class="ae kf" href="https://developer.android.com/jetpack/" rel="noopener ugc nofollow" target="_blank"> Jetpack </a>、<a class="ae kf" href="https://github.com/ReactiveX/RxJava" rel="noopener ugc nofollow" target="_blank"> RxJava </a>和Kotlin的最佳技术，并采用React的许多原则，使构建新屏幕比以往任何时候都更容易、更无缝。这是一个自以为是但灵活的框架，它是通过采用我们观察到的通用开发模式以及React的最佳部分开发的。它也是线程安全的，几乎所有的东西都在主线程之外运行，这使得滚动和动画看起来流畅流畅。</p><p id="2ed6" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">到目前为止，它已经在各种屏幕上工作，几乎消除了处理生命周期的需要。我们目前正在一系列Android产品上测试它，如果它继续成功，我们计划开源它。这是创建发出网络请求的功能屏幕所需的完整代码:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="5591" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">MvRx具有处理片段参数、跨进程重启的savedInstanceState持久性、TTI跟踪和许多其他特性的简单构造。</p><p id="5f08" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">我们也在为iOS开发一个类似的框架，目前处于早期测试阶段。</p><p id="a860" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">期待很快听到更多关于这方面的消息，但我们对迄今为止取得的进展感到兴奋。</p><h2 id="7e24" class="ld kh hh bd ki le lf lg km lh li lj kq jr lk ll ks jv lm ln ku jz lo lp kw lq bi translated">迭代速度</h2><p id="ea07" class="pw-post-body-paragraph ji jj hh jk b jl ky ii jn jo kz il jq jr la jt ju jv lb jx jy jz lc kb kc kd ha bi translated">当从React Native切换回Native时，有一点非常明显，那就是迭代速度。从一个可以在一两秒内可靠地测试您的更改的世界到一个可能要等待15分钟的世界是不可接受的。幸运的是，我们也能够在那里提供一些急需的救济。</p><p id="6cd9" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">我们在Android和iOS上建立了基础设施，使您能够只编译应用程序的一部分，包括一个启动器，可以依赖于特定的功能模块。</p><p id="1db1" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在Android上，这使用了<a class="ae kf" href="https://developer.android.com/studio/build/build-variants#product-flavors" rel="noopener ugc nofollow" target="_blank"> gradle产品口味</a>。我们的gradle模块看起来像这样:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mh"><img src="../Images/f16122287e661241f2bd139899130355.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KVrbsdwESyfbtKFeh2acXg.png"/></div></div></figure><p id="452b" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这种新层次的间接性使工程师能够在应用程序的一个薄片上进行构建和开发。这与<a class="ae kf" href="https://blog.jetbrains.com/idea/2017/06/intellij-idea-2017-2-eap-introduces-unloaded-modules/" rel="noopener ugc nofollow" target="_blank"> IntelliJ模块卸载</a>相结合，极大地提高了MacBook Pro的构建和IDE性能。</p><p id="f353" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">我们构建了脚本来创建新的测试风格，在短短几个月的时间里，我们已经创建了20多个。使用这些新风格的开发构建平均快2.5倍，耗时超过5分钟的构建百分比下降了15倍。</p><p id="60d7" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">作为参考，<a class="ae kf" href="https://gist.github.com/gpeal/d68e4fc1357ef9d126f25afd9ab4eee2" rel="noopener ugc nofollow" target="_blank">这是gradle snippet </a>用于动态生成具有根依赖模块的产品风格。</p><p id="3dd8" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">同样，在iOS上，我们的模块看起来像这样:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es mi"><img src="../Images/068f9618b25034f7b7731026553bddf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/format:webp/1*AVB7em_JCmj-JmjTCkLdQw.png"/></div></figure><p id="73e3" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">相同的系统导致构建速度提高3到8倍</p><h1 id="46f7" class="kg kh hh bd ki kj kk kl km kn ko kp kq in kr io ks iq kt ir ku it kv iu kw kx bi translated">结论</h1><p id="db3c" class="pw-post-body-paragraph ji jj hh jk b jl ky ii jn jo kz il jq jr la jt ju jv lb jx jy jz lc kb kc kd ha bi translated">在一家不害怕尝试新技术但努力保持质量、速度和开发人员体验的高标准的公司工作是令人兴奋的。说到底，React Native是发布特性的一个重要工具，它给了我们思考移动开发的新方法。如果这听起来像是你想参与的旅程，<a class="ae kf" href="https://www.airbnb.com/careers/departments/engineering" rel="noopener ugc nofollow" target="_blank">请告诉我们</a>！</p></div><div class="ab cl mj mk go ml" role="separator"><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo mp"/><span class="mm bw bk mn mo"/></div><div class="ha hb hc hd he"><p id="a114" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这是一系列博客文章的第五部分，重点介绍了我们在React Native的体验以及Airbnb的下一步移动应用。</p><ul class=""><li id="bf7c" class="lr ls hh jk b jl jm jo jp jr lt jv lu jz lv kd lw lx ly lz bi translated"><a class="ae kf" rel="noopener" href="/airbnb-engineering/react-native-at-airbnb-f95aa460be1c">第1部分:在Airbnb反应原生</a></li><li id="9d01" class="lr ls hh jk b jl ma jo mb jr mc jv md jz me kd lw lx ly lz bi translated"><a class="ae kf" rel="noopener" href="/airbnb-engineering/react-native-at-airbnb-the-technology-dafd0b43838">第二部分:技术</a></li><li id="13f5" class="lr ls hh jk b jl ma jo mb jr mc jv md jz me kd lw lx ly lz bi translated"><a class="ae kf" rel="noopener" href="/airbnb-engineering/building-a-cross-platform-mobile-team-3e1837b40a88">第3部分:建立跨平台移动团队</a></li><li id="5fa0" class="lr ls hh jk b jl ma jo mb jr mc jv md jz me kd lw lx ly lz bi translated"><a class="ae kf" rel="noopener" href="/airbnb-engineering/sunsetting-react-native-1868ba28e30a">第4部分:做出反应原生的决定</a></li><li id="e178" class="lr ls hh jk b jl ma jo mb jr mc jv md jz me kd lw lx ly lz bi translated"><a class="ae kf" rel="noopener" href="/airbnb-engineering/whats-next-for-mobile-at-airbnb-5e71618576ab"> <em class="ke">第五部分:移动的下一步</em> </a></li></ul></div></div>    
</body>
</html>