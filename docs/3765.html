<html>
<head>
<title>OWASP ZAP integration with Jenkins</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OWASP ZAP与Jenkins的集成</h1>
<blockquote>原文：<a href="https://medium.com/globant/owasp-zap-integration-with-jenkins-795d65991404?source=collection_archive---------0-----------------------#2021-10-13">https://medium.com/globant/owasp-zap-integration-with-jenkins-795d65991404?source=collection_archive---------0-----------------------#2021-10-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/b868e6126557b65895ae210533e471de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GquNoYKcrLxjNM8pyPxUgw.png"/></div></div></figure><h1 id="cdec" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">介绍</h1><p id="d774" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">对于开发应用程序，今天我们有不同的工具可以帮助我们实现构建一个安全的应用程序。它们可以根据功能进行分类，如SS(秘密搜索)、DAST(动态应用安全测试)、SAST(静态应用安全测试)、SCA(软件组合分析)等。</p><p id="0cf8" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">这些工具可以单独用于测试应用程序，但我们也可以将它们集成到编排工具中，这些工具现在用于编译、测试和部署我们的软件，自动化并促进我们应用程序的持续集成和持续交付/部署。</p><p id="c613" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">本文将重点描述如何将这些安全工具之一集成到编排管道中。我们说的是OWASP ZAP (Zed攻击代理)和Jenkins。</p><p id="bc2e" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">OWASP ZAP是我们作为DAST(动态应用程序安全测试)安全技术的一部分拥有的选项之一。它是一个免费的开源扫描器，在运行时对web应用程序/服务执行渗透测试，以检测漏洞。</p><p id="101b" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">虽然OWASP ZAP是一个可以手动和准时用于测试特定web应用程序的工具，但我们可以在一个持续集成管道中集成和自动化它，并利用这样做的优势。随着每个构建阶段的持续测试，它将允许我们更早地检测到漏洞。</p><p id="b1fe" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">另一方面，我们有Jenkins，它是一个持续集成服务器，免费、开源，是当今非常流行的工具。</p><p id="f7a9" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">在本文中，我们将讨论以下几点:<br/> <strong class="jp hi"> 1-需求:</strong>应该运行的测试本文的软件<br/><strong class="jp hi">2-OWASP ZAP的集成</strong>:将启用集成的基线脚本<br/><strong class="jp hi">3-Jenkins中的管道:</strong>您应该执行的配置<br/> <strong class="jp hi"> 4-结论:</strong>本文的结果！<br/> <strong class="jp hi"> 5-参考资料:</strong>如果你想了解更多这方面的信息</p><h1 id="998e" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">要求</h1><ol class=""><li id="77f5" class="kq kr hh jp b jq jr ju jv jy ks kc kt kg ku kk kv kw kx ky bi translated">你需要安装詹金斯。</li><li id="fc5a" class="kq kr hh jp b jq kz ju la jy lb kc lc kg ld kk kv kw kx ky bi translated">Docker应该安装在Jenkins机器上</li></ol><h1 id="c4f3" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">OWASP ZAP的集成</h1><h2 id="f953" class="le iq hh bd ir lf lg lh iv li lj lk iz jy ll lm jd kc ln lo jh kg lp lq jl lr bi translated">创建脚本</h2><p id="e6d3" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">在Jenkins中创建管道时，我们将使用下面的脚本。</p><pre class="ls lt lu lv fd lw lx ly lz aw ma bi"><span id="08b1" class="le iq hh lx b fi mb mc l md me">def scan_type<br/> def target<br/> pipeline {<br/>     agent any<br/>     parameters {<br/>         choice  choices: ["Baseline", "APIS", "Full"],<br/>                 description: 'Type of scan that is going to perform inside the container',<br/>                 name: 'SCAN_TYPE'<br/> <br/>         string defaultValue: "https://example.com",<br/>                 description: 'Target URL to scan',<br/>                 name: 'TARGET'<br/> <br/>         booleanParam defaultValue: true,<br/>                 description: 'Parameter to know if wanna generate report.',<br/>                 name: 'GENERATE_REPORT'<br/>     }<br/>     stages {<br/>         stage('Pipeline Info') {<br/>                 steps {<br/>                     script {<br/>                         echo "&lt;--Parameter Initialization--&gt;"<br/>                         echo """<br/>                         The current parameters are:<br/>                             Scan Type: ${params.SCAN_TYPE}<br/>                             Target: ${params.TARGET}<br/>                             Generate report: ${params.GENERATE_REPORT}<br/>                         """<br/>                     }<br/>                 }<br/>         }<br/> <br/>         stage('Setting up OWASP ZAP docker container') {<br/>             steps {<br/>                 script {<br/>                         echo "Pulling up last OWASP ZAP container --&gt; Start"<br/>                         sh 'docker pull owasp/zap2docker-stable'<br/>                         echo "Pulling up last VMS container --&gt; End"<br/>                         echo "Starting container --&gt; Start"<br/>                         sh """<br/>                         docker run -dt --name owasp \<br/>                         owasp/zap2docker-stable \<br/>                         /bin/bash<br/>                         """<br/>                 }<br/>             }<br/>         }<br/> <br/> <br/>         stage('Prepare wrk directory') {<br/>             when {<br/>                         environment name : 'GENERATE_REPORT', value: 'true'<br/>             }<br/>             steps {<br/>                 script {<br/>                         sh """<br/>                             docker exec owasp \<br/>                             mkdir /zap/wrk<br/>                         """<br/>                     }<br/>                 }<br/>         }<br/> <br/> <br/>         stage('Scanning target on owasp container') {<br/>             steps {<br/>                 script {<br/>                     scan_type = "${params.SCAN_TYPE}"<br/>                     echo "----&gt; scan_type: $scan_type"<br/>                     target = "${params.TARGET}"<br/>                     if(scan_type == "Baseline"){<br/>                         sh """<br/>                             docker exec owasp \<br/>                             zap-baseline.py \<br/>                             -t $target \<br/>                             -x report.xml \<br/>                             -I<br/>                         """<br/>                     }<br/>                     else if(scan_type == "APIS"){<br/>                         sh """<br/>                             docker exec owasp \<br/>                             zap-api-scan.py \<br/>                             -t $target \<br/>                             -x report.xml \<br/>                             -I<br/>                         """<br/>                     }<br/>                     else if(scan_type == "Full"){<br/>                         sh """<br/>                             docker exec owasp \<br/>                             zap-full-scan.py \<br/>                             -t $target \<br/>                             //-x report.xml<br/>                             -I<br/>                         """<br/>                         //-x report-$(date +%d-%b-%Y).xml<br/>                     }<br/>                     else{<br/>                         echo "Something went wrong..."<br/>                     }<br/>                 }<br/>             }<br/>         }<br/>         stage('Copy Report to Workspace'){<br/>             steps {<br/>                 script {<br/>                     sh '''<br/>                         docker cp owasp:/zap/wrk/report.xml ${WORKSPACE}/report.xml<br/>                     '''<br/>                 }<br/>             }<br/>         }<br/>     }<br/>     post {<br/>             always {<br/>                 echo "Removing container"<br/>                 sh '''<br/>                     docker stop owasp<br/>                     docker rm owasp<br/>                 '''<br/>             }<br/>         }<br/> }</span></pre><h2 id="03b9" class="le iq hh bd ir lf lg lh iv li lj lk iz jy ll lm jd kc ln lo jh kg lp lq jl lr bi translated">脚本内容</h2><p id="369f" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">这个脚本有两个重要的部分，为了更好地理解它，我们将对其进行简要的描述。</p><p id="0b67" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><strong class="jp hi">参数</strong></p><p id="819a" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">参数将是我们每次想要执行流水线时必须完成的数据。我们有三种类型:</p><p id="3344" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><em class="mf"> SCAN_TYPE: </em> <strong class="jp hi"> </strong>将要执行的扫描类型。</p><p id="bc91" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">OWASP ZAP提供三种不同的扫描类型。我们必须在每种情况下选择我们需要的:基线扫描、完全扫描或API扫描。</p><div class="mg mh ez fb mi mj"><a href="https://www.zaproxy.org/docs/docker/about/" rel="noopener  ugc nofollow" target="_blank"><div class="mk ab dw"><div class="ml ab mm cl cj mn"><h2 class="bd hi fi z dy mo ea eb mp ed ef hg bi translated">活力</h2><div class="mq l"><h3 class="bd b fi z dy mo ea eb mp ed ef dx translated">预装OWASP Zed攻击代理的Docker映像。稳定版:docker pull owasp/zap 2 docker-stable For…</h3></div><div class="mr l"><p class="bd b fp z dy mo ea eb mp ed ef dx translated">www.zaproxy.org</p></div></div></div></a></div><p id="ee70" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><em class="mf">目标:</em>我们要分析的网页或者API的URL。</p><p id="072c" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><em class="mf">GENERATE _ REPORT:</em><strong class="jp hi">T5】该选项选择我们是否要在执行结束时获取报告。</strong></p><p id="ecbd" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><strong class="jp hi">阶段</strong></p><p id="5515" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">下面是我们将纳入Jenkins管道的阶段:</p><p id="ae3b" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><em class="mf">管道信息:</em> <strong class="jp hi"> </strong>参数数据。</p><p id="18ec" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><em class="mf">设置OWASP ZAP docker容器:</em>从OWASP ZAP DOCKER映像中提取。</p><p id="6450" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">有不同类型的docker图像:稳定发布、最新每周发布、实时发布、裸发布。我们必须选择最适合我们需要的一个。这些图片可以在Docker Hub上找到:</p><div class="mg mh ez fb mi mj"><a href="https://hub.docker.com/u/owasp" rel="noopener  ugc nofollow" target="_blank"><div class="mk ab dw"><div class="ml ab mm cl cj mn"><h2 class="bd hi fi z dy mo ea eb mp ed ef hg bi translated">码头枢纽</h2><div class="mq l"><h3 class="bd b fi z dy mo ea eb mp ed ef dx translated">编辑描述</h3></div><div class="mr l"><p class="bd b fp z dy mo ea eb mp ed ef dx translated">hub.docker.com</p></div></div></div></a></div><p id="4f91" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><em class="mf">准备WRK目录:</em>该阶段将创建一个名为“wrk”的文件夹，当选择生成报告的选项时，该文件夹将保存结果。我们这样做是因为OWASP ZAP docker映像没有文件夹。</p><p id="09f6" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><em class="mf">OWASP容器上的扫描目标:</em> <strong class="jp hi"> </strong>是根据我们选择的扫描类型执行扫描。</p><p id="3db3" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><em class="mf">将报告复制到工作区:</em> <strong class="jp hi"> </strong>如果我们选择生成报告的选项，此阶段会将报告复制到我们在Jenkins中的存储库中。</p><h1 id="51f1" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">詹金斯的管道</h1><p id="b6c1" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">现在，我们必须完成以下步骤，在Jenkins中创建一个管道:</p><ol class=""><li id="95c1" class="kq kr hh jp b jq kl ju km jy ms kc mt kg mu kk kv kw kx ky bi translated">创建新管道</li></ol><p id="54b0" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">让我们勾选选项<em class="mf">“这个项目是参数化的”。</em></p><figure class="ls lt lu lv fd ii er es paragraph-image"><div class="er es mv"><img src="../Images/28ee9474e0ae73d2bc04ec3b2c04911c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*xm1Ml9QpsV4XydBbi69PNA.png"/></div></figure><p id="ca34" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">2.我们添加开头提到的脚本(复制并粘贴脚本)</p><figure class="ls lt lu lv fd ii er es paragraph-image"><div class="er es mv"><img src="../Images/c1ed449e8580d44b61aadc01a8256677.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*V910dGmI4tsa-R1H7q8zFA.png"/></div></figure><p id="79d6" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">3.我们通过选择“立即构建”来保存和执行。一旦“用参数构建”选项出现，我们就取消它。</p><figure class="ls lt lu lv fd ii er es paragraph-image"><div class="er es mw"><img src="../Images/57617bf9f222e43ffa96aee4592af6be.png" data-original-src="https://miro.medium.com/v2/resize:fit:442/format:webp/1*fMA6ezD6hL4xKxKrvthMnA.png"/></div></figure><p id="c0bf" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">4.选择“使用参数构建”，添加扫描选项并执行构建，直到完成。</p><figure class="ls lt lu lv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mx"><img src="../Images/2594708e7a55295a854ead237cc9f97f.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*wNJ6vx6zW3fCKmkSiFASAg.png"/></div></div></figure><p id="5f22" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">5.如果我们先前选择了生成报告的选项，那么在执行管道时，将会在工作区文件夹中找到该报告。</p><figure class="ls lt lu lv fd ii er es paragraph-image"><div class="er es mv"><img src="../Images/38aeddfe2e6d2d5b0ef3e4993bd6b9cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1138/format:webp/1*4CpRqCcRJ0oZeu4Qp28QUQ.png"/></div></figure><h1 id="0812" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">结论</h1><p id="3927" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">执行OWASP ZAP与Jenkins的集成既简单又免费。你可以从你的项目一开始就开始使用它，没有成本，并获得巨大的利益。您将更早地发现漏洞，并为您的客户提供更安全的应用程序。</p><p id="def2" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">请注意，您还可以用其他漏洞扫描来补充此工具。</p><h1 id="76fd" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">参考</h1><ol class=""><li id="382e" class="kq kr hh jp b jq jr ju jv jy ks kc kt kg ku kk kv kw kx ky bi translated"><a class="ae my" href="https://www.zaproxy.org/docs/" rel="noopener ugc nofollow" target="_blank">https://www.zaproxy.org/docs/</a></li><li id="0b21" class="kq kr hh jp b jq kz ju la jy lb kc lc kg ld kk kv kw kx ky bi translated"><a class="ae my" href="https://www.zaproxy.org/docs/docker/about/" rel="noopener ugc nofollow" target="_blank">https://www.zaproxy.org/docs/docker/about/</a></li><li id="6b2a" class="kq kr hh jp b jq kz ju la jy lb kc lc kg ld kk kv kw kx ky bi translated"><a class="ae my" href="https://www.jenkins.io/" rel="noopener ugc nofollow" target="_blank">https://www.jenkins.io/</a></li><li id="e8e6" class="kq kr hh jp b jq kz ju la jy lb kc lc kg ld kk kv kw kx ky bi translated"><a class="ae my" href="https://www.globant.com/studio/cybersecurity" rel="noopener ugc nofollow" target="_blank">https://www.globant.com/studio/cybersecurity</a></li></ol></div></div>    
</body>
</html>