<html>
<head>
<title>4 Ways to fix LetsEncrypt SSL Generation with Traefik in Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Kubernetes中用Traefik修复LetsEncrypt SSL生成的4种方法</h1>
<blockquote>原文：<a href="https://medium.com/quick-code/4-ways-to-fix-letsencrypt-ssl-generation-with-traefik-in-kubernetes-ec438127b765?source=collection_archive---------0-----------------------#2022-08-24">https://medium.com/quick-code/4-ways-to-fix-letsencrypt-ssl-generation-with-traefik-in-kubernetes-ec438127b765?source=collection_archive---------0-----------------------#2022-08-24</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/3a2723e1f411264dc04382aac6c04526.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qclI4qXDK_kUc-kphLeQ2Q.png"/></div></div></figure><p id="813e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在Kubernetes中使用Traefik作为负载平衡器和HTTP反向代理是一种展示您的微服务的好方法。Traefik还将使用letsencrypt生成SSL证书。</p><p id="7341" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">好吧，如果你把所有的配置都做对了:-)的话</p><p id="b917" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您得到一个<code class="du jn jo jp jq b">NET::ERR_CERT_AUTHORITY_INVALID</code>错误，这意味着traefik没有为您的域生成有效的证书:</p><figure class="js jt ju jv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es jr"><img src="../Images/efc25b1cc32a2e0815b6bf1ba0e3df22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NbaL2D43GYOWjW0Qf0fxyQ.png"/></div></div></figure><p id="6847" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这里有三个可能的问题，你可以仔细看看:</p><ol class=""><li id="7a43" class="jw jx hh ir b is it iw ix ja jy je jz ji ka jm kb kc kd ke bi translated">无主机()规则</li><li id="6f40" class="jw jx hh ir b is kf iw kg ja kh je ki ji kj jm kb kc kd ke bi translated">LetsEncrypt生产服务器</li><li id="00d3" class="jw jx hh ir b is kf iw kg ja kh je ki ji kj jm kb kc kd ke bi translated">让加密率限制</li><li id="8892" class="jw jx hh ir b is kf iw kg ja kh je ki ji kj jm kb kc kd ke bi translated">民航局记录</li></ol><h1 id="fa17" class="kk kl hh bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated"><strong class="ak">问题1:无主机()规则</strong></h1><p id="b288" class="pw-post-body-paragraph ip iq hh ir b is li iu iv iw lj iy iz ja lk jc jd je ll jg jh ji lm jk jl jm ha bi translated">当Traefik启动时，它将解析所有ingressroutes，并查找任何在<code class="du jn jo jp jq b">Host()</code>规则中指定的域。</p><p id="8df9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在<a class="ae ln" href="https://docs.traefik.io/routing/routers/#service" rel="noopener ugc nofollow" target="_blank"> traefik文档</a>中了解更多信息</p><figure class="js jt ju jv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lo"><img src="../Images/2c8404ff9533b890459181e6f6e43dc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O0AyYO1EgguBBUtTiOia9Q.png"/></div></div></figure><p id="bedd" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这是一个例子<strong class="ir hi">进入路线:</strong></p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="lp lq l"/></div></figure><h1 id="c634" class="kk kl hh bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated"><strong class="ak">问题2: LetsEncrypt生产服务器</strong></h1><p id="99a2" class="pw-post-body-paragraph ip iq hh ir b is li iu iv iw lj iy iz ja lk jc jd je ll jg jh ji lm jk jl jm ha bi translated">LetsEncrypt提供API端点来生成证书。登台环境将生成无效证书，因此请确保使用生产环境:</p><ul class=""><li id="cd33" class="jw jx hh ir b is it iw ix ja jy je jz ji ka jm lr kc kd ke bi translated">分期:<code class="du jn jo jp jq b">https://acme-staging-v02.api.letsencrypt.org/directory</code></li><li id="ba32" class="jw jx hh ir b is kf iw kg ja kh je ki ji kj jm lr kc kd ke bi translated">生产:<code class="du jn jo jp jq b">https://acme-v02.api.letsencrypt.org/directory</code></li></ul><figure class="js jt ju jv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ls"><img src="../Images/6375f700f13f67852384b527924c15de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*asHWE-VTBkt6iehZoZCjOQ.png"/></div></div></figure><p id="bac7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这是一个有效的Traefik <strong class="ir hi">部署</strong>:</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="lp lq l"/></div></figure><p id="b87e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">其他资源:</p><ul class=""><li id="8a4a" class="jw jx hh ir b is it iw ix ja jy je jz ji ka jm lr kc kd ke bi translated"><a class="ae ln" href="https://letsencrypt.org/docs/staging-environment/" rel="noopener ugc nofollow" target="_blank">https://letsencrypt.org/docs/staging-environment/</a></li><li id="a3ba" class="jw jx hh ir b is kf iw kg ja kh je ki ji kj jm lr kc kd ke bi translated"><a class="ae ln" href="https://community.letsencrypt.org/t/acme-v2-production-environment-wildcards/55578" rel="noopener ugc nofollow" target="_blank">https://community . lets encrypt . org/t/acme-v2-production-environment-通配符/55578 </a></li></ul><h1 id="0009" class="kk kl hh bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated"><strong class="ak">问题3:设置加密速率限制</strong></h1><p id="a170" class="pw-post-body-paragraph ip iq hh ir b is li iu iv iw lj iy iz ja lk jc jd je ll jg jh ji lm jk jl jm ha bi translated">LetsEncrypt有一些速率限制，以确保公平使用。如果你打错了</p><p id="a77e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><code class="du jn jo jp jq b">too many certificates already issued for exact set of domains</code></p><p id="4503" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">那么您的traefik容器可能会重新启动5次以上，因为每次重新启动都会导致证书更新。</p><p id="64dd" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">目前最重要的限制是:</p><ul class=""><li id="59d0" class="jw jx hh ir b is it iw ix ja jy je jz ji ka jm lr kc kd ke bi translated">每个注册域的证书(每周50个)—生成多达50个子域</li><li id="b4fd" class="jw jx hh ir b is kf iw kg ja kh je ki ji kj jm lr kc kd ke bi translated">重复证书(每周5份)—最多更新证书5次</li></ul><p id="0fbd" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">其他资源:</p><ul class=""><li id="954c" class="jw jx hh ir b is it iw ix ja jy je jz ji ka jm lr kc kd ke bi translated">【https://letsencrypt.org/docs/rate-limits/】</li></ul><h1 id="8831" class="kk kl hh bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated"><strong class="ak">问题4: CAA记录</strong></h1><p id="693d" class="pw-post-body-paragraph ip iq hh ir b is li iu iv iw lj iy iz ja lk jc jd je ll jg jh ji lm jk jl jm ha bi translated">您还可能会遇到这样的问题:由于“证书颁发机构授权”的问题，LetsEncrypt无法生成有效的证书。您的域托管商可能不支持CAA，有关更多详细信息，请参考以下文章:</p><ul class=""><li id="ae3a" class="jw jx hh ir b is it iw ix ja jy je jz ji ka jm lr kc kd ke bi translated"><a class="ae ln" href="https://www.the-cake-shop.de/traefik-2-0-docker-container-mit-lets-encrypt-nutzen" rel="noopener ugc nofollow" target="_blank">https://www . the-cake-shop . de/traefik-2-0-docker-container-MIT-lets-encrypt-nutzen</a></li><li id="24e2" class="jw jx hh ir b is kf iw kg ja kh je ki ji kj jm lr kc kd ke bi translated"><a class="ae ln" href="https://stackoverflow.com/questions/55261846/docker-setup-with-traefik-reverse-proxy-neterr-cert-authority-invalid-on-one" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/55261846/docker-setup-with-traefik-reverse-proxy-neterr-cert-authority-invalid-on-one</a></li></ul></div></div>    
</body>
</html>