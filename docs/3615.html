<html>
<head>
<title>Automate Remote Windows Host Services Using Ansible</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Ansible自动化远程Windows主机服务</h1>
<blockquote>原文：<a href="https://medium.com/globant/automate-remote-windows-host-services-using-ansible-8f4dc1a7a3f?source=collection_archive---------0-----------------------#2021-02-01">https://medium.com/globant/automate-remote-windows-host-services-using-ansible-8f4dc1a7a3f?source=collection_archive---------0-----------------------#2021-02-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="18eb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Ansible是一个非常简单的IT自动化引擎，可以自动化云供应、配置管理、应用程序部署、基础设施服务编排和许多其他需求。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/8d06998aa09d75639e9ac8f1ee7e51de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VyPXD94Xl_KMJaa-"/></div></div></figure><h1 id="d309" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">介绍</h1><p id="5290" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">这篇文章是关于使用Ansible管理远程Windows主机服务的。为了在工作中带来良好的实践，我们可以使用Ansible创建自动化，而不是手工操作。这解决了很多问题，比如在Windows环境中管理和执行核心功能。有多种工具可以做到这一点，但这里我们使用Ansible，因为它为服务的自动化提供了一个服务模块。</p><p id="3c8e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们从设置开始。</p><p id="2e4f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">先决条件<em class="kr">:</em>T3】</strong></p><p id="88e6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">1.安装了Ansible的Centos 8操作系统。</p><p id="de6f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.Windows 10远程主机。</p><h1 id="57b3" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">安装步骤:</h1><p id="8803" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">应在Centos上运行以下步骤:</p><p id="c9b0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="kr">第一步:</em> </strong>在Ansible控制节点上安装Python3。</p><pre class="jd je jf jg fd ks kt ku kv aw kw bi"><span id="1fc5" class="kx jp hh kt b fi ky kz l la lb">sudo dnf install python3</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lc"><img src="../Images/3e683400b60f431230a82b1e8980390b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kirgdFdmTfe5lZDA"/></div></div></figure><p id="7815" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="kr">第二步:</em> </strong>验证是否安装了python3。</p><pre class="jd je jf jg fd ks kt ku kv aw kw bi"><span id="3a51" class="kx jp hh kt b fi ky kz l la lb">python3 --version</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ld"><img src="../Images/12ac3eb9146c8b29ce184688a59df5b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lAhPvQeExflrxWSaLlSqGQ.png"/></div></div></figure><p id="3561" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="kr">第三步:</em> </strong>安装虚拟环境运行Ansible。</p><pre class="jd je jf jg fd ks kt ku kv aw kw bi"><span id="3ea6" class="kx jp hh kt b fi ky kz l la lb">sudo dnf install python3-virtualenv</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es le"><img src="../Images/f10cdd14d760ef36259f19e249c2b3f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*opBdzbGpvEXigK9F"/></div></div></figure><p id="aa0d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="kr">第四步:</em> </strong>创建虚拟工作空间环境</p><pre class="jd je jf jg fd ks kt ku kv aw kw bi"><span id="dd19" class="kx jp hh kt b fi ky kz l la lb">virtualenv env</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lf"><img src="../Images/d9fb19d0abafb020e85ce299b781de3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*1KqIQ4fMmu7B64Z0"/></div></div></figure><p id="926c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="kr">第五步:</em> </strong>激活虚拟环境</p><pre class="jd je jf jg fd ks kt ku kv aw kw bi"><span id="1be9" class="kx jp hh kt b fi ky kz l la lb">source env/bin/activate</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lg"><img src="../Images/7a96892372ae8d7546cd0622d1b36f28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Jp8X0ASl4f0R8qmO"/></div></div></figure><p id="016f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="kr">第六步:</em> </strong>安装Ansible</p><pre class="jd je jf jg fd ks kt ku kv aw kw bi"><span id="70db" class="kx jp hh kt b fi ky kz l la lb">pip install ansible</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lh"><img src="../Images/768b450a4d2e012ad25636cad68ea188.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*UEmbkP6E19gRFTsU"/></div></div></figure><p id="c8f5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="kr">第七步:</em> </strong>验证Ansible已安装。</p><pre class="jd je jf jg fd ks kt ku kv aw kw bi"><span id="464c" class="kx jp hh kt b fi ky kz l la lb">ansible --version</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es li"><img src="../Images/51bbb4e28ee5b3bedb0ec0ff42d4a318.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SEVDAJhl8hXFruvr"/></div></div></figure><p id="b360" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="kr">第八步:</em> </strong>打开默认的hosts文件，定义windows主机规范。</p><pre class="jd je jf jg fd ks kt ku kv aw kw bi"><span id="806f" class="kx jp hh kt b fi ky kz l la lb">vi /etc/ansible/hosts</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lj"><img src="../Images/69f6ad70fa8f1b1d1c810890782c3314.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xzFWY6wERGOCH_Uag33Y9g.png"/></div></div></figure><p id="376f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">注意</strong>:确保在指向Windows主机的文件中放置正确的凭证，这是为了避免连接问题。</p><p id="2008" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="kr">第九步:</em> </strong>安装Pywinrm</p><pre class="jd je jf jg fd ks kt ku kv aw kw bi"><span id="2cde" class="kx jp hh kt b fi ky kz l la lb">pip install pywinrm</span></pre><p id="7c74" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">注意</strong> : WinRM (Windows远程管理)是微软WS-Management的实现，这是一个基于SOAP的协议，用于管理设备和服务器。它可用于连接到远程Windows服务器并在其上运行命令。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lk"><img src="../Images/d9b0068f12ae7721f51fac76c7026c51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bI--aUN19qkXx-lf"/></div></div></figure><p id="194a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">应在Windows上运行以下步骤:</p><p id="2284" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="kr">步骤10: </em> </strong>使用下面的链接在远程Windows主机上下载WinRM脚本。</p><pre class="jd je jf jg fd ks kt ku kv aw kw bi"><span id="54e5" class="kx jp hh kt b fi ky kz l la lb"><a class="ae ll" href="https://raw.githubusercontent.com/ansible/ansible/devel/examples/scripts/ConfigureRemotingForAnsible.ps1" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/ansible/ansible/devel/examples/scripts/ConfigureRemotingForAnsible.ps1</a></span></pre><p id="bbd7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="kr">步骤11: </em> </strong>在远程Windows主机上运行WinRM脚本。</p><p id="633b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">若要在远程Windows主机上运行WinRM脚本，请以管理员身份打开Windows PowerShell。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/b786215e64810ff1bfe52e0cf0f98833.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6hFOts7dbyXQVuV-"/></div></div></figure><p id="0bba" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在切换回Centos。</p><p id="10e5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="kr">第十二步:</em> </strong>主机列表</p><pre class="jd je jf jg fd ks kt ku kv aw kw bi"><span id="9edb" class="kx jp hh kt b fi ky kz l la lb">ansible all --list-hosts</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lm"><img src="../Images/2559e63bb54a07ae9de1c8c4cea1f336.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3ekusRL8iC3WpMJ3M5-hQg.png"/></div></div></figure><p id="d140" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="kr">步骤13: </em> </strong>检查并测试远程Windows主机与Ansible控制节点之间的连接。</p><pre class="jd je jf jg fd ks kt ku kv aw kw bi"><span id="26e9" class="kx jp hh kt b fi ky kz l la lb">ansible webserver -m win_ping</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ln"><img src="../Images/0451018c2b56b4549795a09da0882ec7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rm6w6UOJf4orC-Pw5tXrnw.png"/></div></div></figure><p id="ed25" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="kr">步骤14: </em> </strong>创建一个剧本，并在剧本中创建一个任务，该任务将在远程主机上自动执行服务。在本行动手册中，我们使用Ansible win_service模块来启动和停止服务。</p><pre class="jd je jf jg fd ks kt ku kv aw kw bi"><span id="6ec8" class="kx jp hh kt b fi ky kz l la lb">touch service.yml</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lo"><img src="../Images/aeffeb162032643cb51dd3fab4f09c4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zmMeCRHfFNs8UT_8ZXd5fw.png"/></div></div></figure><p id="f17b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="kr">第十五步:</em> </strong>执行剧本。</p><pre class="jd je jf jg fd ks kt ku kv aw kw bi"><span id="0cfb" class="kx jp hh kt b fi ky kz l la lb">ansible-playbook service.yml</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lp"><img src="../Images/3ddff9e42ceeeae214f1c9017442bd7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mCEj8MqwBbRq6Lr4TR99wg.png"/></div></div></figure><p id="68f7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上面的输出显示剧本已经成功执行。这意味着我们现在可以使用Ansible行动手册自动化远程Windows主机服务。如果您遇到任何问题，请遵循以下故障排除链接。</p><p id="9821" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">故障排除链接:</strong></p><ul class=""><li id="58da" class="lq lr hh ig b ih ii il im ip ls it lt ix lu jb lv lw lx ly bi translated"><a class="ae ll" href="https://docs.ansible.com/ansible/latest/collections/ansible/windows/win_service_module.html" rel="noopener ugc nofollow" target="_blank">https://docs . ansi ble . com/ansi ble/latest/collections/ansi ble/windows/win _ service _ module . html</a></li><li id="d569" class="lq lr hh ig b ih lz il ma ip mb it mc ix md jb lv lw lx ly bi translated"><a class="ae ll" href="https://argonsys.com/microsoft-cloud/articles/configuring-ansible-manage-windows-servers-step-step/" rel="noopener ugc nofollow" target="_blank">https://argon sys . com/Microsoft-cloud/articles/configuring-ansi ble-manage-windows-servers-step-step/</a></li></ul><p id="b09c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">注意</strong>:如果您使用来自任何一家知名公共云供应商的本地机器或虚拟机，请确保您添加了下述<strong class="ig hi">入站规则</strong>以避免连接问题。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es me"><img src="../Images/d422f3f16b27a099d67c73ec6d69201a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ocdzk-isXv0xSsSt"/></div></div></figure><p id="ceb2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">结论:</strong></p><p id="a4f3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，本文总结了如何使用Ansible自动化远程Windows主机服务。当我们想要管理远程Windows主机的服务时，当手动更改的范围有限时，这种简单可行的自动化会产生奇迹。因此，如果您正在寻找云环境中的托管远程Windows主机，Ansible是一个理想的选择。</p></div></div>    
</body>
</html>