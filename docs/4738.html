<html>
<head>
<title>Rethinking Unit Test Assertions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">重新思考单元测试断言</h1>
<blockquote>原文：<a href="https://medium.com/javascript-scene/rethinking-unit-test-assertions-55f59358253f?source=collection_archive---------0-----------------------#2018-10-08">https://medium.com/javascript-scene/rethinking-unit-test-assertions-55f59358253f?source=collection_archive---------0-----------------------#2018-10-08</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/dc3db7739ffdad15ce682e7ac11c5a5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8HSjkuZT5pn-XbiDLWd1BA.jpeg"/></div></div></figure><p id="898d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">写得好的自动化测试在失败时总是充当好的错误报告，但是很少有开发人员花时间去考虑好的错误报告需要什么信息。</p><p id="3793" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">有<a class="ae jn" rel="noopener" href="/javascript-scene/what-every-unit-test-needs-f6cd34d9836d">每个单元测试必须回答的5个问题</a>。我之前已经详细描述过它们，所以这次我们只略读一下:</p><ol class=""><li id="ad47" class="jo jp hh ir b is it iw ix ja jq je jr ji js jm jt ju jv jw bi translated">被测试的单元是什么(模块、函数、类等等)？</li><li id="17af" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">它应该做什么？(散文描述)</li><li id="acc8" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">实际产量是多少？</li><li id="bdb1" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">预期产出是多少？</li><li id="e11c" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">你如何重现失败？</li></ol><p id="3d6d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">许多测试框架允许你忽略这些问题中的一个或多个，这导致错误报告不是很有用。</p><p id="b897" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">让我们用一个虚构的测试框架来看看这个例子，这个框架提供了常见的<code class="du kc kd ke kf b">pass()</code>和<code class="du kc kd ke kf b">fail()</code>断言:</p><pre class="kg kh ki kj fd kk kf kl km aw kn bi"><span id="6337" class="ko kp hh kf b fi kq kr l ks kt">describe('addEntity()', async ({ pass, fail }) =&gt; {<br/>  const myEntity  = { id: 'baz', foo: 'bar' };</span><span id="c860" class="ko kp hh kf b fi ku kr l ks kt">  try {<br/>    const response = await addEntity(myEntity);<br/>    const storedEntity = await getEntity(response.id);<br/>    pass('should add the new entity');<br/>  } catch(err) {<br/>    fail('failed to add and read entity', { myEntity, error });<br/>  }<br/>});</span></pre><p id="8f64" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们的方向是正确的，但是我们遗漏了一些信息。让我们试着用测试中的数据来回答5个问题:</p><ol class=""><li id="2082" class="jo jp hh ir b is it iw ix ja jq je jr ji js jm jt ju jv jw bi translated"><strong class="ir hi">被测单位是什么？</strong> <code class="du kc kd ke kf b">addEntity()</code></li><li id="e013" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">它应该做什么？</strong>T3】</li><li id="48fe" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">实际产量是多少？ <em class="kv">哎呀。我们不知道。我们没有向测试框架提供这些数据。</em></li><li id="e9c1" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">预期产出是多少？</strong> <em class="kv">又来了，我们不知道。我们在这里不测试返回值。相反，我们假设如果它不抛出，一切都按预期运行——但是如果它不抛出呢？如果函数返回值或解析承诺，我们应该测试结果值。</em></li><li id="0d9c" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">如何再现失败？</strong> <em class="kv">我们可以在测试设置中看到这一点，但我们可以更清楚地了解这一点。例如，最好有一个你输入的文字描述，让我们更好地理解测试用例的意图。</em></li></ol><p id="41ba" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我会给这个打2.5分。失败。这个测试没有完成它的工作。它显然没有回答每个单元测试必须回答的5个问题。</p><p id="60f5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">大多数测试框架的问题是，他们忙于让你通过他们“方便的”断言走捷径，以至于忘记了当测试失败时，测试的最大价值才被实现。</p><p id="b8fa" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在失败阶段，编写测试的便利性比阅读测试时找出错误的容易程度重要得多。</p><p id="a2bf" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在<a class="ae jn" rel="noopener" href="/javascript-scene/what-every-unit-test-needs-f6cd34d9836d">“每个单元测试必须回答的5个问题”</a>中，我写道:</p><blockquote class="kw"><p id="ad49" class="kx ky hh bd kz la lb lc ld le lf jm dx translated"><em class="lg"/><code class="du kc kd ke kf b"><em class="lg">equal()</em></code>是我最喜欢的论断。如果每个测试套件中唯一可用的断言是<em class="lg"> equal()，</em>那么世界上几乎所有的测试套件都会更好。”</p></blockquote><p id="145f" class="pw-post-body-paragraph ip iq hh ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated">在我写下那篇文章后的几年里，我更加坚信这一点。当测试框架忙于添加更“方便”的断言时，我写了一个薄薄的包装器，只暴露了一个深度相等的断言。换句话说，我采用了已经最小的磁带库，并且<em class="kv">移除了特性</em>以使测试体验更好。</p><p id="f14b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">根据RITEway测试原则，我将包装器库命名为“<a class="ae jn" href="https://github.com/ericelliott/riteway" rel="noopener ugc nofollow" target="_blank"> RITEway </a>”。测试应该是:</p><ul class=""><li id="ab8c" class="jo jp hh ir b is it iw ix ja jq je jr ji js jm lm ju jv jw bi translated">准备就绪</li><li id="14bd" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm lm ju jv jw bi translated"><strong class="ir hi"> I </strong>隔离(用于单元测试)或<strong class="ir hi"> I </strong>集成(用于功能和集成测试，测试应隔离，组件/模块应集成)</li><li id="69c1" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm lm ju jv jw bi translated"><strong class="ir hi">T</strong>h rough，和</li><li id="2167" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm lm ju jv jw bi translated">透明的</li></ul><p id="29c4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">RITEway迫使您编写可读的、隔离的和显式的测试，因为这是您使用API的唯一方式。它还使测试断言变得如此简单，以至于您想编写更多的测试断言，从而使测试变得更加彻底。</p><p id="b85b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这是RITEway<code class="du kc kd ke kf b">assert()</code>的签名:</p><pre class="kg kh ki kj fd kk kf kl km aw kn bi"><span id="ff25" class="ko kp hh kf b fi kq kr l ks kt">assert({<br/>  given: Any,<br/>  should: String,<br/>  actual: Any,<br/>  expected: Any<br/>}) =&gt; Void</span></pre><p id="9f5c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">断言必须在一个<code class="du kc kd ke kf b">describe()</code>块中，该块将被测单元的标签作为第一个参数。完整的测试如下所示:</p><pre class="kg kh ki kj fd kk kf kl km aw kn bi"><span id="d76a" class="ko kp hh kf b fi kq kr l ks kt">describe('sum()', async assert =&gt; {<br/>  assert({<br/>    given: 'no arguments',<br/>    should: 'return 0',<br/>    actual: sum(),<br/>    expected: 0<br/>  });<br/>});</span></pre><p id="c28c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这会产生以下内容:</p><pre class="kg kh ki kj fd kk kf kl km aw kn bi"><span id="145a" class="ko kp hh kf b fi kq kr l ks kt">TAP version 13<br/># sum()<br/>ok 1 Given no arguments: should return 0</span></pre><p id="63a5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">让我们再看看上面的2.5星测试，看看我们是否可以提高分数:</p><pre class="kg kh ki kj fd kk kf kl km aw kn bi"><span id="0694" class="ko kp hh kf b fi kq kr l ks kt">describe('addEntity()', async assert =&gt; {<br/>  const myEntity  = { id: 'baz', foo: 'bar' };<br/>  const given =  'an entity';<br/>  const should = 'read the same entity from the api';</span><span id="007d" class="ko kp hh kf b fi ku kr l ks kt">  try {<br/>    const response = await addEntity(myEntity);<br/>    const storedEntity = await getEntity(response.id);</span><span id="1d25" class="ko kp hh kf b fi ku kr l ks kt">    assert({<br/>      given,<br/>      should,<br/>      actual: storedEntity,<br/>      expected: myEntity<br/>    });<br/>  } catch(error) {<br/>    assert({<br/>      given,<br/>      should,<br/>      actual: error,<br/>      expected: myEntity<br/>    });<br/>  }<br/>});</span></pre><ol class=""><li id="8f2b" class="jo jp hh ir b is it iw ix ja jq je jr ji js jm jt ju jv jw bi translated"><strong class="ir hi">被测单位是什么？</strong>T3】</li><li id="29e9" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">它应该做什么？ <code class="du kc kd ke kf b">'given an entity: should read the same entity from the api'</code></li><li id="aa7d" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">实际产量是多少？ <code class="du kc kd ke kf b">{ id: 'baz', foo: 'bar' }</code></li><li id="9a11" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">预期产出是多少？</strong> <code class="du kc kd ke kf b">{ id: 'baz', foo: 'bar' }</code></li><li id="d691" class="jo jp hh ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated"><strong class="ir hi">你如何重现失败？现在，消息中更加明确地说明了重现测试的说明:提供了给定和应该的描述。</strong></li></ol><p id="9a32" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">不错！现在我们通过了测试。</p><h1 id="8ec6" class="ln kp hh bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">一个深度相等的断言真的足够了吗？</h1><p id="fb94" class="pw-post-body-paragraph ip iq hh ir b is mk iu iv iw ml iy iz ja mm jc jd je mn jg jh ji mo jk jl jm ha bi translated">一年半以来，我几乎每天都在几个大型制作项目中使用RITEway。它已经进化了一点。我们已经把接口<em class="kv">做得比原来更简单了</em>，但是我从来没有想要另一个断言，我们的测试套件是我整个职业生涯中见过的最简单、可读性最强的测试套件。</p><p id="56b7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我认为是时候与世界分享这一创新了。如果您想从<a class="ae jn" href="https://github.com/ericelliott/riteway" rel="noopener ugc nofollow" target="_blank"> RITEway </a>开始:</p><pre class="kg kh ki kj fd kk kf kl km aw kn bi"><span id="7be3" class="ko kp hh kf b fi kq kr l ks kt">npm install --save-dev riteway</span></pre><p id="9240" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">它将改变你对测试软件的看法。</p><p id="6e88" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">简而言之:</p><blockquote class="kw"><p id="f97d" class="kx ky hh bd kz la lb lc ld le lf jm dx translated">简单测试是更好的测试。</p></blockquote><p id="3073" class="pw-post-body-paragraph ip iq hh ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated"><em class="kv">附注:我在本文中一直使用“单元测试”这个术语，但那只是因为它比“自动化软件测试”或“单元测试、功能测试和集成测试”更容易输入，但我在本文中所说的关于单元测试的一切适用于我能想到的所有自动化软件测试。对于功能测试，我也更喜欢这些测试，而不是黄瓜/小黄瓜。</em></p><h1 id="98b5" class="ln kp hh bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">后续步骤</h1><p id="faf8" class="pw-post-body-paragraph ip iq hh ir b is mk iu iv iw ml iy iz ja mm jc jd je mn jg jh ji mo jk jl jm ha bi translated"><a class="ae jn" href="https://tddday.com/" rel="noopener ugc nofollow" target="_blank"> TDD日</a>是一个在线录制的网络研讨会，深入探讨了测试驱动开发、不同类型的测试及其作用、如何编写更多可测试的软件，以及<a class="ae jn" rel="noopener" href="/javascript-scene/tdd-changed-my-life-5af0ce099f80">TDD如何让我成为更好的开发人员</a>，以及它如何为你做同样的事情。这是一个伟大的大师班，帮助您或您的团队达到TDD实践的下一个水平，以5小时的视频内容和测试您的记忆的互动测验为特色。</p><p id="d76c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">更多关于测试驱动开发的视频课程可供EricElliottJS.com成员使用。如果你还不是会员，今天就注册吧。</p></div><div class="ab cl mp mq go mr" role="separator"><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu mv"/><span class="ms bw bk mt mu"/></div><div class="ha hb hc hd he"><p id="5e7e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> <em class="kv">艾里克·艾略特</em> </strong> <em class="kv">著有《书籍》、</em> <a class="ae jn" href="https://leanpub.com/composingsoftware" rel="noopener ugc nofollow" target="_blank"> <em class="kv">【排版软件】</em></a><em class="kv"/><a class="ae jn" href="http://pjabook.com" rel="noopener ugc nofollow" target="_blank"><em class="kv">【编程JavaScript应用】</em> </a> <em class="kv">。作为</em><a class="ae jn" href="https://ericelliottjs.com" rel="noopener ugc nofollow" target="_blank"><em class="kv">【EricElliottJS.com】</em></a><em class="kv">和</em><a class="ae jn" href="https://devanywhere.io" rel="noopener ugc nofollow" target="_blank"><em class="kv">devanywhere . io</em></a><em class="kv">的联合创始人，他教授开发者必备的软件开发技能。他为加密项目组建开发团队并提供建议，为Adobe Systems、</em> <strong class="ir hi"> <em class="kv">、Zumba Fitness、</em> </strong> <em class="kv"> </em> <strong class="ir hi"> <em class="kv">【华尔街日报、</em></strong><em class="kv"/><strong class="ir hi"><em class="kv">【ESPN、</em></strong><em class="kv"/><strong class="ir hi"><em class="kv">BBC、</em> </strong> <em class="kv">以及包括</em> <strong class="ir hi"> <em class="kv"> Usher、弗兰克·奥申、金属乐队在内的顶级录音</em></strong></p><p id="98ef" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">他和世界上最美丽的女人享受着与世隔绝的生活方式。</p></div></div>    
</body>
</html>