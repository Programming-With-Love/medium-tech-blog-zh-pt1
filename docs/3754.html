<html>
<head>
<title>GreenLetters with Rspec CLI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Rspec CLI的GreenLetters</h1>
<blockquote>原文：<a href="https://medium.com/globant/greenletters-with-rspec-cli-7c3291294f09?source=collection_archive---------0-----------------------#2021-09-20">https://medium.com/globant/greenletters-with-rspec-cli-7c3291294f09?source=collection_archive---------0-----------------------#2021-09-20</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="0fd9" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">拯救者绿信</h2></div><h2 id="d69a" class="iw ix hh bd iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">CLI RSpec变得简单</h2><p id="02e7" class="pw-post-body-paragraph ju jv hh jw b jx jy ii jz ka kb il kc jh kd ke kf jl kg kh ki jp kj kk kl km ha bi translated">你曾经尝试过为CLI应用程序编写ruby规范吗？</p><p id="06c2" class="pw-post-body-paragraph ju jv hh jw b jx kn ii jz ka ko il kc jh kp ke kf jl kq kh ki jp kr kk kl km ha bi translated">如果是的话，你可能已经熟悉了<code class="du ks kt ku kv b"><strong class="jw hi">Expect</strong></code> gem，这是编写CLI规范时最常用的。在使用Expect gem的过程中发现了不一致的结果，比如:<br/> 1。不一致的执行结果和覆盖率，也就是说，在连续的构建之后，结果是变化的。</p><p id="5446" class="pw-post-body-paragraph ju jv hh jw b jx kn ii jz ka ko il kc jh kp ke kf jl kq kh ki jp kr kk kl km ha bi translated">为了克服这些矛盾，我使用了Greenletters Gem。</p><h2 id="ab68" class="iw ix hh bd iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt bi translated">什么是绿信宝石？</h2><p id="61e5" class="pw-post-body-paragraph ju jv hh jw b jx jy ii jz ka kb il kc jh kd ke kf jl kg kh ki jp kj kk kl km ha bi translated"><code class="du ks kt ku kv b"><strong class="jw hi">Greenletters</strong></code>是一个控制台交互自动化库，主要用于编写小黄瓜自动化步骤的规范。我用它来编写CLI规范。我们将了解如何利用这个gem来编写CLI RSpec。</p><h1 id="3486" class="kw ix hh bd iy kx ky kz jc la lb lc jg in ld io jk iq le ir jo it lf iu js lg bi translated">建立创业板</h1><p id="3944" class="pw-post-body-paragraph ju jv hh jw b jx jy ii jz ka kb il kc jh kd ke kf jl kg kh ki jp kj kk kl km ha bi translated">让我们首先为新的gem创建文件结构。创建一个新目录。我们将创造<code class="du ks kt ku kv b">helloworld</code>宝石。<br/>要设置CLI，我们需要使用以下命令创建一个gem。</p><pre class="lh li lj lk fd ll kv lm ln aw lo bi"><span id="4895" class="iw ix hh kv b fi lp lq l lr ls">mkdir helloworld<br/>cd helloworld</span></pre><p id="ce8f" class="pw-post-body-paragraph ju jv hh jw b jx kn ii jz ka ko il kc jh kp ke kf jl kq kh ki jp kr kk kl km ha bi translated">我们的gem将包含一个<code class="du ks kt ku kv b">.gemspec</code>来指定gem的所有配置，<code class="du ks kt ku kv b">lib</code>文件夹将是源文件。：</p><pre class="lh li lj lk fd ll kv lm ln aw lo bi"><span id="7c49" class="iw ix hh kv b fi lp lq l lr ls">touch helloworld.gemspec<br/>mkdir lib<br/>touch lib/helloworld.rb<br/>mkdir bin</span></pre><p id="4530" class="pw-post-body-paragraph ju jv hh jw b jx kn ii jz ka ko il kc jh kp ke kf jl kq kh ki jp kr kk kl km ha bi translated">文件结构将如下所示:</p><pre class="lh li lj lk fd ll kv lm ln aw lo bi"><span id="fb55" class="iw ix hh kv b fi lp lq l lr ls">helloworld<br/>|-- helloworld.gemspec<br/>|-- bin<br/>    |-- helloworld<br/>|-- lib<br/>    |-- helloworld.rb<br/>|-- spec<br/>    |-- spec_helper.rb<br/>    |-- helloworld_spec.rb</span></pre><p id="6ebd" class="pw-post-body-paragraph ju jv hh jw b jx kn ii jz ka ko il kc jh kp ke kf jl kq kh ki jp kr kk kl km ha bi translated">让我们编辑<code class="du ks kt ku kv b">helloworld.gemspec</code>并添加关于我们的宝石的信息。用你自己的宝石特有的信息更新这个。</p><pre class="lh li lj lk fd ll kv lm ln aw lo bi"><span id="15ce" class="iw ix hh kv b fi lp lq l lr ls">Gem<strong class="kv hi">::</strong>Specification.<strong class="kv hi">new</strong> <strong class="kv hi">do</strong> <strong class="kv hi">|</strong>s<strong class="kv hi">|</strong><br/>  s.<strong class="kv hi">name</strong>      <strong class="kv hi">=</strong> 'helloworld'<br/>  s.<strong class="kv hi">version</strong>   <strong class="kv hi">=</strong> '0.0.0'<br/>  s.<strong class="kv hi">platform</strong>  <strong class="kv hi">=</strong> Gem<strong class="kv hi">::</strong>Platform<strong class="kv hi">::</strong>RUBY<br/>  s.<strong class="kv hi">summary</strong>   <strong class="kv hi">=</strong> 'HelloWorld gem'<br/>  s.<strong class="kv hi">description</strong> <strong class="kv hi">=</strong> "Helloworld in showing Ruby CLI Spec!"<br/>  s.<strong class="kv hi">authors</strong>   <strong class="kv hi">=</strong> ['Kajal Mohite']<br/>  s.<strong class="kv hi">email</strong>     <strong class="kv hi">=</strong> ['test@gmail.com']<br/>  s.<strong class="kv hi">homepage</strong>  <strong class="kv hi">=</strong> 'http://rubygems.org/gems/helloworld'<br/>  s.<strong class="kv hi">license</strong>   <strong class="kv hi">=</strong> 'MIT'<br/>  s.<strong class="kv hi">files</strong>     <strong class="kv hi">=</strong> Dir.<strong class="kv hi">glob</strong>("{lib,bin}/**/*") <em class="lt"># This includes all files under the lib directory recursively, so we don't have to add each one individually.</em><br/>  s.<strong class="kv hi">require_path</strong> <strong class="kv hi">=</strong> 'lib'<br/>  s.<strong class="kv hi">executables</strong> = ['helloworld']</span><span id="1c03" class="iw ix hh kv b fi lu lq l lr ls"><strong class="kv hi">end</strong></span></pre><p id="97d4" class="pw-post-body-paragraph ju jv hh jw b jx kn ii jz ka ko il kc jh kp ke kf jl kq kh ki jp kr kk kl km ha bi translated">Gem配置已经完成，现在让我们添加基本的ruby代码并进行测试。为了实现这一点，让我们编辑<code class="du ks kt ku kv b">lib/helloworld.rb</code>:</p><pre class="lh li lj lk fd ll kv lm ln aw lo bi"><span id="b79c" class="iw ix hh kv b fi lp lq l lr ls"><strong class="kv hi">module</strong> HelloWorld<br/>  <strong class="kv hi">def</strong> <strong class="kv hi">self.hello_world</strong><br/>    "Good morning world!"<br/>  <strong class="kv hi">end</strong><br/><strong class="kv hi">end</strong></span></pre><p id="1b48" class="pw-post-body-paragraph ju jv hh jw b jx kn ii jz ka ko il kc jh kp ke kf jl kq kh ki jp kr kk kl km ha bi translated">Bin文件夹<code class="du ks kt ku kv b"><strong class="jw hi">bin/helloworld</strong></code>:</p><pre class="lh li lj lk fd ll kv lm ln aw lo bi"><span id="63a8" class="iw ix hh kv b fi lp lq l lr ls">#!/usr/bin/env ruby</span><span id="4fc8" class="iw ix hh kv b fi lu lq l lr ls">require 'helloworld'</span><span id="d483" class="iw ix hh kv b fi lu lq l lr ls">puts HelloWorld::hello_world</span></pre><p id="22a8" class="pw-post-body-paragraph ju jv hh jw b jx kn ii jz ka ko il kc jh kp ke kf jl kq kh ki jp kr kk kl km ha bi translated">太好了。我们已经准备好了。让我们现在构建和测试。</p><h1 id="b1a8" class="kw ix hh bd iy kx ky kz jc la lb lc jg in ld io jk iq le ir jo it lf iu js lg bi translated">构建和测试</h1><p id="17a8" class="pw-post-body-paragraph ju jv hh jw b jx jy ii jz ka kb il kc jh kd ke kf jl kg kh ki jp kj kk kl km ha bi translated">要打包所有内容，请传递<code class="du ks kt ku kv b">.gemspec</code>文件作为输入:</p><pre class="lh li lj lk fd ll kv lm ln aw lo bi"><span id="8a0a" class="iw ix hh kv b fi lp lq l lr ls">gem build helloworld.gemspec</span></pre><p id="a516" class="pw-post-body-paragraph ju jv hh jw b jx kn ii jz ka ko il kc jh kp ke kf jl kq kh ki jp kr kk kl km ha bi translated">成功执行后，您将看到以下内容:</p><pre class="lh li lj lk fd ll kv lm ln aw lo bi"><span id="2d64" class="iw ix hh kv b fi lp lq l lr ls">gem build helloworld.gemspec<br/>Successfully built RubyGem<br/>Name: helloworld<br/>Version: 0.0.0<br/>File: helloworld-0.0.0.gem</span><span id="16f6" class="iw ix hh kv b fi lu lq l lr ls">Version: 0.0.0</span><span id="956b" class="iw ix hh kv b fi lu lq l lr ls">File: helloworld-0.0.0.gem</span></pre><p id="af61" class="pw-post-body-paragraph ju jv hh jw b jx kn ii jz ka ko il kc jh kp ke kf jl kq kh ki jp kr kk kl km ha bi translated">让我们安装它，并从我们的代码中访问它。</p><pre class="lh li lj lk fd ll kv lm ln aw lo bi"><span id="ede3" class="iw ix hh kv b fi lp lq l lr ls">gem install helloworld-0.0.0.gem</span></pre><h1 id="354a" class="kw ix hh bd iy kx ky kz jc la lb lc jg in ld io jk iq le ir jo it lf iu js lg bi translated">Spec_helper.rb</h1><p id="d859" class="pw-post-body-paragraph ju jv hh jw b jx jy ii jz ka kb il kc jh kd ke kf jl kg kh ki jp kj kk kl km ha bi translated">现在在spec_helper.rb中配置RSpec:<br/>在spec_helper.rb中设置RSpec配置</p><pre class="lh li lj lk fd ll kv lm ln aw lo bi"><span id="f09f" class="iw ix hh kv b fi lp lq l lr ls">require 'helloworld'</span><span id="9f67" class="iw ix hh kv b fi lu lq l lr ls">RSpec.configure do |config|</span><span id="7ce6" class="iw ix hh kv b fi lu lq l lr ls">  config.disable_monkey_patching!</span><span id="1a78" class="iw ix hh kv b fi lu lq l lr ls">    config.expect_with :rspec do |c|</span><span id="a409" class="iw ix hh kv b fi lu lq l lr ls">      c.syntax = :expect</span><span id="e397" class="iw ix hh kv b fi lu lq l lr ls">    end</span><span id="2a3d" class="iw ix hh kv b fi lu lq l lr ls">    config.mock_with :rspec do |c|</span><span id="590f" class="iw ix hh kv b fi lu lq l lr ls">      c.syntax = %i[expect should]</span><span id="72a4" class="iw ix hh kv b fi lu lq l lr ls">    end</span><span id="4ada" class="iw ix hh kv b fi lu lq l lr ls">end</span></pre><p id="e833" class="pw-post-body-paragraph ju jv hh jw b jx kn ii jz ka ko il kc jh kp ke kf jl kq kh ki jp kr kk kl km ha bi translated">让我们在<strong class="jw hi"> helloworld_spec.rb </strong>中编写应用相关的spec</p><pre class="lh li lj lk fd ll kv lm ln aw lo bi"><span id="8a03" class="iw ix hh kv b fi lp lq l lr ls">require 'greenletters'</span><span id="9e63" class="iw ix hh kv b fi lu lq l lr ls">require 'spec_helper'</span><span id="b5e4" class="iw ix hh kv b fi lu lq l lr ls">RSpec.describe HelloWorld do</span><span id="71b8" class="iw ix hh kv b fi lu lq l lr ls">  describe '#start: with default config Y' do</span><span id="c472" class="iw ix hh kv b fi lu lq l lr ls">    adv = Greenletters::Process.new('helloworld', timeout: 20, transcript: $stdout)</span><span id="7cff" class="iw ix hh kv b fi lu lq l lr ls">    adv.start!</span><span id="0b2d" class="iw ix hh kv b fi lu lq l lr ls">      it 'should display loading statement' do</span><span id="e18e" class="iw ix hh kv b fi lu lq l lr ls">        adv.wait_for(:output, /Good morning world!/)</span><span id="b181" class="iw ix hh kv b fi lu lq l lr ls">      end</span><span id="b68d" class="iw ix hh kv b fi lu lq l lr ls">   end</span><span id="027d" class="iw ix hh kv b fi lu lq l lr ls">end</span></pre><h1 id="ec6e" class="kw ix hh bd iy kx ky kz jc la lb lc jg in ld io jk iq le ir jo it lf iu js lg bi translated">规格执行</h1><p id="1934" class="pw-post-body-paragraph ju jv hh jw b jx jy ii jz ka kb il kc jh kd ke kf jl kg kh ki jp kj kk kl km ha bi translated">执行规范的命令是<code class="du ks kt ku kv b">rspec spec-file-path</code>它将执行文件中写入的所有测试用例并显示结果。</p><pre class="lh li lj lk fd ll kv lm ln aw lo bi"><span id="8df9" class="iw ix hh kv b fi lp lq l lr ls"><strong class="kv hi">$ </strong>rspec spec/helloworld_spec.rb</span><span id="b96e" class="iw ix hh kv b fi lu lq l lr ls">Good morning world!</span><span id="71a9" class="iw ix hh kv b fi lu lq l lr ls">.</span><span id="5570" class="iw ix hh kv b fi lu lq l lr ls">Finished in 0.68765 seconds (files took 0.3343 seconds to load)</span><span id="2b56" class="iw ix hh kv b fi lu lq l lr ls">1 example, 0 failures</span></pre><p id="3a52" class="pw-post-body-paragraph ju jv hh jw b jx kn ii jz ka ko il kc jh kp ke kf jl kq kh ki jp kr kk kl km ha bi translated">完美！</p><p id="df58" class="pw-post-body-paragraph ju jv hh jw b jx kn ii jz ka ko il kc jh kp ke kf jl kq kh ki jp kr kk kl km ha bi translated">这样，我们可以创建任何CLI应用程序，并使用GreenLetters gem的ease语法对其进行测试。</p><h1 id="21e9" class="kw ix hh bd iy kx ky kz jc la lb lc jg in ld io jk iq le ir jo it lf iu js lg bi translated">参考</h1><p id="50eb" class="pw-post-body-paragraph ju jv hh jw b jx jy ii jz ka kb il kc jh kd ke kf jl kg kh ki jp kj kk kl km ha bi translated"><a class="ae lv" href="https://stackoverflow.com/questions/7142978/is-there-an-expect-equivalent-gem-for-ruby" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/7142978/is-there-a-a-expect-equivalent-gem-for-ruby</a></p><p id="240d" class="pw-post-body-paragraph ju jv hh jw b jx kn ii jz ka ko il kc jh kp ke kf jl kq kh ki jp kr kk kl km ha bi translated"><a class="ae lv" href="https://avdi.codes/greenletters-painless-automation-and-testing-for-command-line-applications/" rel="noopener ugc nofollow" target="_blank">https://avdi . codes/green letters-无痛自动化和测试命令行应用程序/ </a></p><p id="c86f" class="pw-post-body-paragraph ju jv hh jw b jx kn ii jz ka ko il kc jh kp ke kf jl kq kh ki jp kr kk kl km ha bi translated"><a class="ae lv" href="https://github.com/avdi/greenletters" rel="noopener ugc nofollow" target="_blank">https://github.com/avdi/greenletters</a></p></div></div>    
</body>
</html>