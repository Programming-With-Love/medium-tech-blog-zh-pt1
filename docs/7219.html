<html>
<head>
<title>Text for your sales reports using Twilio Functions and Square</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Twilio函数和Square为您的销售报告添加文本</h1>
<blockquote>原文：<a href="https://medium.com/square-corner-blog/text-for-your-sales-using-twilio-functions-and-square-e30d6537b720?source=collection_archive---------6-----------------------#2017-06-09">https://medium.com/square-corner-blog/text-for-your-sales-using-twilio-functions-and-square-e30d6537b720?source=collection_archive---------6-----------------------#2017-06-09</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="6ef4" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated"><strong class="ak"> Square的开发者团队刚刚从</strong><a class="ae iw" href="https://www.twilio.com/signal" rel="noopener ugc nofollow" target="_blank"><strong class="ak">SIGNAL 2017</strong></a><strong class="ak">回来，在那里我们做了一个Twilio和Square APIs的混搭。</strong></h2></div><blockquote class="ix"><p id="4e56" class="iy iz hh bd ja jb jc jd je jf jg jh dx translated">注意，我们已经行动了！如果您想继续了解Square的最新技术内容，请访问我们的新家<a class="ae iw" href="https://developer.squareup.com/blog" rel="noopener ugc nofollow" target="_blank">https://developer.squareup.com/blog</a></p></blockquote><h2 id="937c" class="ji jj hh bd jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">这个想法</h2><p id="cc99" class="pw-post-body-paragraph kg kh hh ki b kj kk ii kl km kn il ko jt kp kq kr jx ks kt ku kb kv kw kx jh ha bi translated">在为你的企业(或许多企业)构建应用程序时，通知是体验的一个重要层面。Twilio有许多产品可以让你将通信和消息添加到你的应用程序中，但我们尝试了新发布的<a class="ae iw" href="https://www.twilio.com/blog/2017/05/introducing-twilio-functions.html" rel="noopener ugc nofollow" target="_blank"> Twilio Functions </a>来建立一种体验，在不增加现有应用程序复杂性的情况下增加额外的价值。</p><p id="2d21" class="pw-post-body-paragraph kg kh hh ki b kj ky ii kl km kz il ko jt la kq kr jx lb kt ku kb lc kw kx jh ha bi translated">基本想法是发送一条简单的文本消息，并接收当天的最新销售情况。你可以很容易地修改它，通过文本来检查你的库存，或者甚至让客户发短信询问你的业务信息。</p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es ld"><img src="../Images/d4a4a0d52cdd7ab4779bc242e6f74216.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DIxXWVH29up8ASw0SIREVQ.png"/></div></div><figcaption class="lp lq et er es lr ls bd b be z dx">A basic Web Sequence Diagram of what we wanted to build</figcaption></figure><h2 id="426b" class="ji jj hh bd jk jl lt jn jo jp lu jr js jt lv jv jw jx lw jz ka kb lx kd ke kf bi translated">设置</h2><p id="3199" class="pw-post-body-paragraph kg kh hh ki b kj kk ii kl km kn il ko jt kp kq kr jx ks kt ku kb kv kw kx jh ha bi translated">对于这个演示，除了我的Square帐户，我还创建了一个<a class="ae iw" href="https://www.twilio.com/try-twilio" rel="noopener ugc nofollow" target="_blank"> Twilio帐户</a>——免费试用完全满足了我的需求。我还必须在我的Twilio账户中设置一个<a class="ae iw" href="https://www.twilio.com/console/phone-numbers/getting-started" rel="noopener ugc nofollow" target="_blank">电话号码，当然还要在</a><a class="ae iw" href="https://connect.squareup.com/apps/" rel="noopener ugc nofollow" target="_blank"> Square开发者门户</a>中创建一个应用程序来访问我的个人访问令牌。</p><h2 id="60fb" class="ji jj hh bd jk jl lt jn jo jp lu jr js jt lv jv jw jx lw jz ka kb lx kd ke kf bi translated">什么是Twilio函数？</h2><p id="fdd0" class="pw-post-body-paragraph kg kh hh ki b kj kk ii kl km kn il ko jt kp kq kr jx ks kt ku kb kv kw kx jh ha bi translated">Twilio函数允许你把你的代码放在一个无服务器的环境中，为收到的信息、电话等自动运行。这样，您就不必担心服务器，而是可以专注于编写代码。</p><p id="e291" class="pw-post-body-paragraph kg kh hh ki b kj ky ii kl km kz il ko jt la kq kr jx lb kt ku kb lc kw kx jh ha bi translated">为了创建我们新的无服务器功能，我访问了Twilio控制台的<a class="ae iw" href="https://www.twilio.com/console/runtime/functions/manage" rel="noopener ugc nofollow" target="_blank">功能页面。在那里，我点击“创建一个函数”按钮，开始创建一个新函数。</a></p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es ly"><img src="../Images/539f364f66af61c74c638b42aec54b46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i58pxx5VOxpGvthRtatsPA.png"/></div></div></figure><p id="b42f" class="pw-post-body-paragraph kg kh hh ki b kj ky ii kl km kz il ko jt la kq kr jx lb kt ku kb lc kw kx jh ha bi translated">我为我的应用程序选择了“Hello SMS”模板。接下来，我回到我的Twilio控制台的<a class="ae iw" href="https://www.twilio.com/console/phone-numbers/incoming" rel="noopener ugc nofollow" target="_blank">电话号码部分，用我的功能分配我的电话号码来回复收到的信息。</a></p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es lz"><img src="../Images/e2bc3111cc8f314592bb3616c65af5dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J_G9A7rhFEpJmvHzxEBvtw.png"/></div></div></figure><p id="07b8" class="pw-post-body-paragraph kg kh hh ki b kj ky ii kl km kz il ko jt la kq kr jx lb kt ku kb lc kw kx jh ha bi translated">有了这些，我决定给我的函数一个测试消息:</p><figure class="le lf lg lh fd li er es paragraph-image"><div class="er es ma"><img src="../Images/a5388f055c1cb6c0370760a7a7345879.png" data-original-src="https://miro.medium.com/v2/resize:fit:868/format:webp/1*0EvQ87IczVeoku4gx1lWXw.png"/></div><figcaption class="lp lq et er es lr ls bd b be z dx">It’s alive!</figcaption></figure><p id="39b9" class="pw-post-body-paragraph kg kh hh ki b kj ky ii kl km kz il ko jt la kq kr jx lb kt ku kb lc kw kx jh ha bi translated">那很容易！然后，我添加了一些逻辑来从我的函数连接到<a class="ae iw" href="https://squareup.com/developers" rel="noopener ugc nofollow" target="_blank"> Square的API</a>，在导航回我的函数后，编写代码来查询List Transactions端点，对结果求和，并将消息返回给我。你可以在下面看到我的全部代码(一定要把URL中的<code class="du mb mc md me b">LLLLLLLL</code>替换成你的位置，把<code class="du mb mc md me b">sq0atp-XXX</code>替换成你来自Square开发者门户的个人访问令牌。</p><pre class="le lf lg lh fd mf me mg mh aw mi bi"><span id="ea0c" class="ji jj hh me b fi mj mk l ml mm">exports.handler = function(context, event, callback) {<br/>  //include the request library to make our API calls<br/>  var request = require("request");<br/>  <br/>  //set the end date of our reporting to right now<br/>  var end_time = new Date(Date.now()).toISOString();<br/>  //and the starting time to be 24h hours ago.<br/>  var begin_time = new Date();<br/>  begin_time.setDate(begin_time.getDate()-1);<br/>  begin_time = begin_time.toISOString();<br/>  <br/>  //The URL and authorization for accessing my transactions<br/>  var url = "<a class="ae iw" href="https://connect.squareup.com/v2/locations/75MBQ5SS3SKJK/transactions?begin_time=" rel="noopener ugc nofollow" target="_blank">https://connect.squareup.com/v2/locations/LLLLLLLL/transactions?begin_time=</a>"+begin_time+"&amp;end_time="+end_time<br/>  var options = {<br/>    url:url,<br/>    headers: {<br/>      'Authorization': 'Bearer sq0atp-XXXXXXXXXXX'<br/>    }<br/>  }<br/>  <br/>  //a callback for handling the API response<br/>  request(options, function(error, response, body) {<br/>    total = 0;<br/> body = JSON.parse(body);<br/>    //loop through all the returned transactions and tenders to sum the total<br/>    for (var i = body.transactions.length - 1; i &gt;= 0; i--) {<br/>      for (var j = body.transactions[i].tenders.length -1; i &gt;= 0; i--){<br/>        total+= body.transactions[i].tenders[j].amount_money.amount<br/>      }<br/>    }<br/>    //create a new message response<br/>   let twiml = new Twilio.twiml.MessagingResponse();<br/>    //add the total to the message<br/> twiml.message("You have made $"+total/100+" in sales today");<br/> callback(null, twiml);<br/>  });<br/>};</span></pre><p id="dbba" class="pw-post-body-paragraph kg kh hh ki b kj ky ii kl km kz il ko jt la kq kr jx lb kt ku kb lc kw kx jh ha bi translated">现在，当我发送Twilio号码时，我的代码将执行调用Square的API并获取我所有销售额的总和:</p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mn"><img src="../Images/5423dfa8af5ee0f515f5dfde5b5e55a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k8GDbKqrvsS-Wse_xg3Ndg.png"/></div></div><figcaption class="lp lq et er es lr ls bd b be z dx">Success! Now, anytime I text my Twilio number, it’ll return daily sales.</figcaption></figure><p id="c59c" class="pw-post-body-paragraph kg kh hh ki b kj ky ii kl km kz il ko jt la kq kr jx lb kt ku kb lc kw kx jh ha bi translated">如需进一步阅读，请查看Twilio的<a class="ae iw" href="https://www.twilio.com/blog/2017/05/introducing-twilio-functions.html" rel="noopener ugc nofollow" target="_blank">博客帖子，宣布Twilio的功能</a>，或<a class="ae iw" href="https://docs.connect.squareup.com/" rel="noopener ugc nofollow" target="_blank"> Square的文档</a>。让我们知道你如何修改我们所做的，以及如何在你的Square应用中使用Twilio功能。</p></div></div>    
</body>
</html>