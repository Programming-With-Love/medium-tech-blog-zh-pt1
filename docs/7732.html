<html>
<head>
<title>Midway: Walmart’s mocking journey…</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">中途:沃尔玛的嘲讽之旅…</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/midway-walmarts-mocking-journey-84c34fcc4593?source=collection_archive---------5-----------------------#2018-10-04">https://medium.com/walmartglobaltech/midway-walmarts-mocking-journey-84c34fcc4593?source=collection_archive---------5-----------------------#2018-10-04</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/cc48ed377464335e27d944fb1a835175.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FuZ_-PSy48mcIRRgS4lmPQ.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx"><a class="ae it" href="https://anothersideofsandiegotours.com/wp-content/uploads/2015/02/USS-Midway-Sunset-Reflection.jpg" rel="noopener ugc nofollow" target="_blank">https://anothersideofsandiegotours.com/wp-content/uploads/2015/02/USS-Midway-Sunset-Reflection.jpg</a></figcaption></figure><p id="29ec" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">大多数应用程序依赖于一个或多个后端服务。为了成功的测试执行和快速的开发，所有依赖的后端服务都应该是100%可靠的。然而，让服务跟上开发和测试的一致数据非常具有挑战性，这使得针对非生产服务的测试/开发效率低下且耗时。</p><p id="e092" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在沃尔玛，数百个工程团队面临着同样的挑战，因为沃尔玛规模的依赖关系树非常庞大，对于一个端到端的功能流，可能很容易涉及100多个团队，从而导致开发缓慢、测试执行缓慢并影响测试可靠性，特别是在由于依赖服务间歇性超时、不可用等导致应用程序测试结果出现假阴性的情况下。，因为调试和评估根本原因变得非常具有挑战性和耗时，因为这些问题不容易重现。</p><h1 id="a7ce" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">前进的道路…</h1><p id="d291" class="pw-post-body-paragraph iu iv hh iw b ix kq iz ja jb kr jd je jf ks jh ji jj kt jl jm jn ku jp jq jr ha bi translated">为了保持整个沃尔玛的测试自动化速度，通过减少假阴性来建立对测试结果的信心是很重要的，这使得我们非常明显地需要一个模拟解决方案，它可以通过消除对后端服务的测试和开发依赖来满足沃尔玛的需求，并且可以在沃尔玛规模上运行。</p><p id="d3b6" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">回到2015年，在我们的头脑风暴会议和可用工具的初步评估期间，我们非常清楚地知道，工具的<strong class="iw hi"> <em class="kv"> DNA </em> </strong>应该具有以下内容:</p><ul class=""><li id="29ad" class="kw kx hh iw b ix iy jb jc jf ky jj kz jn la jr lb lc ld le bi translated"><strong class="iw hi">简单的设置</strong> : <em class="kv">第一次使用的用户应该能够设置一个模拟服务器，并且应该能够在10分钟内模拟至少两个APIs这将加速应用程序的采用，团队也不必为他们的日常工作感到学习一个新的复杂工具的负担。</em></li><li id="0bfa" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><strong class="iw hi"> Library not a server </strong> : <em class="kv">该解决方案应该提供一种模拟REST APIss的方式，而无需集中托管，这样就可以根据个人或团队的需要，在本地或CI/CD中启动和停止REST API，以进行开发和/或测试，从而消除任何网络依赖性，并且可以在任何地方工作。</em></li><li id="c9ee" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><strong class="iw hi">大规模并行</strong> : <em class="kv">能够并行运行测试用例(沃尔玛仅前端每天就运行超过300，000+测试用例)，节省时间和资源。</em></li><li id="55ef" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><strong class="iw hi">解耦:</strong> <em class="kv">不与用户代码耦合——开发或测试代码应该独立于mock实现，这样集成mock服务器就不需要对现有的设置或过程进行彻底检查。</em></li><li id="c2dd" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><strong class="iw hi">多平台</strong> : <em class="kv">解决方案应该能够支持Web、mWeb、本地和服务开发和测试。</em></li><li id="f070" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><strong class="iw hi">文档</strong> : <em class="kv">获得一个被数百个团队采用的工具意味着大量的支持时间，因此文档应该是顶级的，这样我们就可以花更多的时间在特性开发上，而不是支持上。</em></li></ul><h1 id="677e" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">解决方案</strong></h1><figure class="ll lm ln lo fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lk"><img src="../Images/962abca3e721414592aafd0a1bb0ab47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*baIrK0-miM3lGNpdnruJSQ.jpeg"/></div></div></figure><p id="61aa" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">以中途岛号命名的<a class="ae it" href="http://testarmada.io" rel="noopener ugc nofollow" target="_blank">测试舰队的</a>开源模拟舰队<a class="ae it" href="https://www.npmjs.com/package/testarmada-midway" rel="noopener ugc nofollow" target="_blank">中途岛</a>提供了一套强大的工具来大规模解决上述挑战。支持的一些功能包括:</p><ul class=""><li id="327e" class="kw kx hh iw b ix iy jb jc jf ky jj kz jn la jr lb lc ld le bi translated"><strong class="iw hi"> UI界面</strong> : <em class="kv">用于人工测试/调试的模拟服务UI。</em></li><li id="90a9" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><strong class="iw hi">拖放响应</strong> : <em class="kv">通过将响应文件放入文件夹，根据路由路径自动响应一个JSON文件。</em></li><li id="8d6c" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><strong class="iw hi">变体</strong> : <em class="kv">切换到REST API的不同数据集。</em></li><li id="81fc" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><strong class="iw hi">测试重用</strong> : <em class="kv">针对模拟或实时服务执行相同的测试用例。</em></li><li id="d419" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><strong class="iw hi"> Swagger集成</strong> : <em class="kv">使用Swagger定义的web服务的自动模拟创建器。</em></li><li id="1de0" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><strong class="iw hi">公共实用程序</strong> : <em class="kv">公共实用程序方法是作为mocking服务的一部分提供的，它允许更快的测试开发。</em></li><li id="f0b3" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><strong class="iw hi">模仿来自容器</strong> : <em class="kv">模仿来自特定目录的数据响应，与Rest APIs无关</em></li><li id="8cdd" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><strong class="iw hi">并行会话</strong> : <em class="kv">支持并行进程的单实例模拟服务器。</em></li><li id="1c70" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><strong class="iw hi">共享模拟数据</strong> : <em class="kv">允许从多个Git存储库中获取模拟数据和路径——允许团队共享他们的模拟响应。</em></li><li id="a3a2" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><strong class="iw hi">模拟数据的动态转置(JSON) </strong> : <em class="kv">动态修改响应的能力。</em></li><li id="b867" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><strong class="iw hi">支持所有文件类型</strong> : <em class="kv">自动评估响应文件扩展名和mime类型</em></li><li id="2622" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><strong class="iw hi">平台无关模仿</strong> : <em class="kv">模仿任何服务，不管它是用什么语言编写的。</em></li><li id="d192" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><strong class="iw hi">服务器状态</strong> : <em class="kv">模拟服务器状态的能力。</em></li><li id="c560" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><strong class="iw hi">手动测试</strong> : <em class="kv">针对模拟服务手动运行测试的能力</em></li><li id="8fa6" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated"><strong class="iw hi">服务故障</strong> : <em class="kv">团队可以确定性地模拟服务故障。</em></li></ul><p id="5dc4" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">三年前，当我们开始的时候，没有多少开源模拟工具可以满足我们的需求，然而，从那时起，模拟功能测试自动化和开发<em class="kv">(不是单元测试用例)</em>已经获得了很大的动力。其他一些值得注意的开源嘲讽工具是<a class="ae it" href="https://netflix.github.io/pollyjs/#/" rel="noopener ugc nofollow" target="_blank"> Polly。JS </a>，<a class="ae it" href="https://sinonjs.org/" rel="noopener ugc nofollow" target="_blank">兴农。JS </a>、<a class="ae it" href="https://mimic.js.org/" rel="noopener ugc nofollow" target="_blank">模仿</a>等。每个解决一个或多个不同的用例。</p><h1 id="ca7f" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">案例分析</strong></h1><blockquote class="lp lq lr"><p id="9b21" class="iu iv kv iw b ix iy iz ja jb jc jd je ls jg jh ji lt jk jl jm lu jo jp jq jr ha bi translated"><em class="hh">销售点手册/自动化测试用例及软件开发。</em></p></blockquote><p id="51f0" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="kv">挑战</em>:</p><ul class=""><li id="b1c3" class="kw kx hh iw b ix iy jb jc jf ky jj kz jn la jr lb lc ld le bi translated">外部服务中断对开发的影响为<strong class="iw hi"> <em class="kv"> 10小时/周</em> </strong></li><li id="bb85" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">测试的外部服务中断影响为<strong class="iw hi"> <em class="kv"> 12小时/周</em> </strong></li><li id="4287" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">外部服务变更影响事件每周<strong class="iw hi"> 2起</strong></li><li id="a24c" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">20%时的测试片状剥落为<strong class="iw hi"/></li><li id="29f1" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">阴性测试场景为<strong class="iw hi"> <em class="kv">零。</em>T29】</strong></li></ul><p id="0183" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="kv">中途冲击:</em></p><ul class=""><li id="8bae" class="kw kx hh iw b ix iy jb jc jf ky jj kz jn la jr lb lc ld le bi translated">外部服务中断对开发的影响减少到<strong class="iw hi"> <em class="kv"> 0小时/周</em> </strong></li><li id="b47c" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">测试的外部服务中断影响减少到<strong class="iw hi"> <em class="kv"> 0小时/周</em> </strong></li><li id="3f3b" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">外部服务变更影响减少到每周<strong class="iw hi"> 0次</strong></li><li id="02de" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">测试碎片减少到<strong class="iw hi"> <em class="kv"> 5% </em> </strong> <em class="kv">(一旦所有服务都被嘲笑，预计将减少到0%)</em></li><li id="139c" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">在概念验证的第一周，添加了<strong class="iw hi"><em class="kv">【10+】</em></strong>负面测试场景<strong class="iw hi"> <em class="kv">。</em>T55】</strong></li></ul></div><div class="ab cl lv lw go lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="ha hb hc hd he"><blockquote class="lp lq lr"><p id="d0ca" class="iu iv kv iw b ix iy iz ja jb jc jd je ls jg jh ji lt jk jl jm lu jo jp jq jr ha bi translated">Walmart.com前端的自动测试周期。</p></blockquote><p id="62f6" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="kv">挑战</em>:</p><ul class=""><li id="6d4e" class="kw kx hh iw b ix iy jb jc jf ky jj kz jn la jr lb lc ld le bi translated">完整的测试周期太长，在某些情况下需要几天才能完成。</li><li id="941c" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">由于测试周期较长，PR和主验证是在有限的浏览器上进行的。</li><li id="bc5a" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">由于启动多个应用程序和模拟服务器导致的CPU限制，只有32个测试用例可以并行运行，导致需要更多硬件来执行测试— <strong class="iw hi"> <em class="kv">使用4台服务器，每台服务器执行400个测试用例需要25分钟以上。</em> </strong></li></ul><p id="8b50" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="kv">中途撞击:</em></p><ul class=""><li id="70e4" class="kw kx hh iw b ix iy jb jc jf ky jj kz jn la jr lb lc ld le bi translated">单个团队的测试执行时间减少了40%到60%。</li><li id="8cef" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">由于测试执行速度的提高，PR和Master verify可以在所有顶级浏览器上运行。</li><li id="dc42" class="kw kx hh iw b ix lf jb lg jf lh jj li jn lj jr lb lc ld le bi translated">可以并行运行120多个测试案例，将硬件成本降低了近10倍<strong class="iw hi"><em class="kv">—用1台服务器执行400个测试案例花费了不到10分钟的时间。</em> </strong></li></ul><p id="34e7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在沃尔玛，所有前端测试自动化团队都使用Midway来模仿他们测试自动化的后端服务。使用Midway作为模拟解决方案可以加快测试执行，减少假阴性，帮助优化资源使用，从而降低成本，提高整体效率。在不到一年的时间里，中途已经嘲讽了超过<strong class="iw hi"> <em class="kv"> 185+百万</em> </strong>的REST APIs。</p><p id="4d56" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> <em class="kv">敬请关注未来博客对架构和特性的深入解释。与此同时，请随意浏览中途的</em> </strong> <a class="ae it" href="http://testarmada.io/documentation/Mocking/rWeb/JAVASCRIPT/Introduction" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hi"> <em class="kv">文档</em> </strong> </a> <strong class="iw hi"> <em class="kv">或者尝试从</em> </strong> <a class="ae it" href="https://www.npmjs.com/package/testarmada-midway" rel="noopener ugc nofollow" target="_blank"> <strong class="iw hi"> <em class="kv">这里</em> </strong> </a> <strong class="iw hi"> <em class="kv">下载。</em> </strong></p></div></div>    
</body>
</html>