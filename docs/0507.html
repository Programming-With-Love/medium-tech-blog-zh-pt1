<html>
<head>
<title>What’s new in Android Studio System Trace</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android Studio系统跟踪的新功能</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/whats-new-in-android-studio-system-trace-5841465c5935?source=collection_archive---------7-----------------------#2020-06-17">https://medium.com/androiddevelopers/whats-new-in-android-studio-system-trace-5841465c5935?source=collection_archive---------7-----------------------#2020-06-17</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/636d8236ec2cb3a09ce22b2a9caad86d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p2rZxbCDY6uHMp1s2Nr-ww.png"/></div></div></figure><div class=""/><p id="b328" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在Android Studio 4.0中，我们彻底检查了<a class="ae jn" href="https://developer.android.com/studio/profile/cpu-profiler" rel="noopener ugc nofollow" target="_blank"> CPU Profiler </a> UI，以提供更直观的记录工作流程。我们继续根据您的反馈进行改进，并在4.1中添加了更多功能。</p><p id="0c71" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在本文中，我们将重点介绍Android Studio中<a class="ae jn" href="https://developer.android.com/topic/performance/tracing" rel="noopener ugc nofollow" target="_blank">系统跟踪</a>的新增功能，这是一种不常用但功能强大的CPU记录配置。与Java方法或C/C++函数跟踪不同，系统跟踪收集设备活动(如CPU内核调度)和Android系统进程(如SurfaceFlinger)。此外，您可以通过调用应用程序中的<a class="ae jn" href="https://developer.android.com/reference/android/os/Trace" rel="noopener ugc nofollow" target="_blank"> Trace </a> API，使用<a class="ae jn" href="https://developer.android.com/topic/performance/tracing/custom-events" rel="noopener ugc nofollow" target="_blank">自定义事件</a>来检测您的代码。这样，您的自定义事件将与系统事件一起收集。当您调查诸如UI抖动或高功耗等性能问题时，所有这些数据的组合都可以派上用场。</p></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><h1 id="11d3" class="jv jw hs bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">一次所有线程</h1><p id="16d1" class="pw-post-body-paragraph ip iq hs ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">CPU记录现在与主分析器时间线分开，以便于分析。在这个专用视图中，跟踪数据被组织在<strong class="ir ht"> Profiler </strong>窗口左侧的部分中。</p><figure class="kz la lb lc fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ky"><img src="../Images/2fac72f8151c76e7352233e9750e23a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uY4U8r9IXQh4si1k"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx"><em class="lh">System Trace in Android Studio 4.1 Beta 1</em></figcaption></figure><p id="dea7" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您可以上下移动部分来重新组织列表，或者通过简单的拖放来重新组织部分中的单个项目。</p><p id="c8fa" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们从您那里了解到，选择每个线程来查看其调用图(或系统跟踪的跟踪事件)很麻烦，因此我们将所有线程活动合并到一个视图中，同时显示线程状态和调用图。默认情况下，我们根据线程的繁忙程度对它们进行排序，但是您可以拖放任何一个线程来重新排序。</p><figure class="kz la lb lc fd hj er es paragraph-image"><div class="er es li"><img src="../Images/99c56e0372e24779d6a3ea2bd5ce128b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/1*cSkqgJ6QwrSAqtlvz2NJmg.gif"/></div><figcaption class="ld le et er es lf lg bd b be z dx">Drag and drop a thread to change the list order</figcaption></figure><p id="ef15" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您也可以通过单击三角形图标或双击线程名称来折叠或展开每个线程。请注意，对于Java方法跟踪或C/C++函数跟踪，由于深度调用堆栈，我们默认情况下会折叠所有线程，以便您可以提前浏览所有线程数据。</p><figure class="kz la lb lc fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lj"><img src="../Images/be08694ca31bc753607419ab21bf6328.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QI_g59Lrx60OIfVO"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx"><em class="lh">C/C++ Function Trace showing threads collapsed by default</em></figcaption></figure><p id="b934" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">对于系统跟踪，跟踪事件现在有唯一的颜色，以便于区分。</p><figure class="kz la lb lc fd hj er es paragraph-image"><div class="er es lk"><img src="../Images/8f094ea6150499f343f49ecc4fa3c457.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/0*C468-RsVeFHtDaf2"/></div><figcaption class="ld le et er es lf lg bd b be z dx">System Trace events are color-coded by name</figcaption></figure><h1 id="65e8" class="jv jw hs bd jx jy ll ka kb kc lm ke kf kg ln ki kj kk lo km kn ko lp kq kr ks bi translated">更直观的导航</h1><p id="c076" class="pw-post-body-paragraph ip iq hs ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">新的跟踪用户界面有一个改进的时间轴导航方案。我们用主从视图替换了旧的水平滚动条。</p><p id="b303" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在顶部，您可以看到一个时间线，它只映射到跟踪的持续时间，而不是整个分析会话。使用范围选择器，您可以快速缩小到特定的时间范围，下面的部分将显示详细数据。</p><figure class="kz la lb lc fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lq"><img src="../Images/06a153b483f6356bb9efdb5eca3e62c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*98cydvvJ5kWoWLzG"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx">Use range selector to focus on a small slice of the timeline</figcaption></figure><p id="5f39" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">从那里，您可以执行更精确的导航操作。</p><ul class=""><li id="c5e5" class="lr ls hs ir b is it iw ix ja lt je lu ji lv jm lw lx ly lz bi translated">使用Ctrl(或Mac上的Cmd鼠标滚轮放大/缩小；</li><li id="fddc" class="lr ls hs ir b is ma iw mb ja mc je md ji me jm lw lx ly lz bi translated">按住空格键的同时左右拖动鼠标来平移视图；</li><li id="c43b" class="lr ls hs ir b is ma iw mb ja mc je md ji me jm lw lx ly lz bi translated">使用“WASD”键缩放和平移视图，就像Chrome中的传统SysTrace UI一样(chrome://tracing)。</li></ul><p id="f327" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">从Android Studio 4.1 Canary 9开始，你可以在<strong class="ir ht">线程</strong>部分拖动鼠标来执行框选择。“框选”允许您精确选择一个矩形区域，您可以通过点击右上角的<strong class="ir ht">缩放到选区</strong>按钮(“M”键)来放大该区域。您甚至可以跨多个线程进行选择。当您将相似的线程拖放到彼此旁边并一次检查所有线程时，这很有用。例如，您可能想要对游戏中常见的多个工作线程执行分析。</p><figure class="kz la lb lc fd hj er es paragraph-image"><div class="er es li"><img src="../Images/10e882850f011ee48a4c5f1128b100e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*RVHreih05jyGnPU5"/></div><figcaption class="ld le et er es lf lg bd b be z dx"><em class="lh">Box selection combined w/ drag-and-drop &amp; zooming</em></figcaption></figure><h1 id="f034" class="jv jw hs bd jx jy ll ka kb kc lm ke kf kg ln ki kj kk lo km kn ko lp kq kr ks bi translated">分析面板</h1><p id="a1d3" class="pw-post-body-paragraph ip iq hs ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">说到分析，我们想在<strong class="ir ht"> Profiler </strong>窗口的右栏突出显示Android Studio 4.0中引入的新<strong class="ir ht">分析面板</strong>。</p><p id="f436" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这里，您可以找到基于您的选择从记录的跟踪中导出的分析数据。当您从左栏中选择线程、堆栈帧或跟踪事件时，分析面板将显示特定于您的选择的信息。例如，当选择一个线程时，会显示它的线程状态，以及其他有用的信息。</p><p id="d3df" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们希望这个分析面板对您有用，所以我们一直在探索显示有用分析数据的方法。除了CPU Profiler中已经存在的<a class="ae jn" href="https://developer.android.com/studio/profile/cpu-profiler#top_down_bottom_up" rel="noopener ugc nofollow" target="_blank">自上而下</a>、<a class="ae jn" href="https://developer.android.com/studio/profile/cpu-profiler#flame_chart" rel="noopener ugc nofollow" target="_blank">火焰图</a>和<a class="ae jn" href="https://developer.android.com/studio/profile/cpu-profiler#top_down_bottom_up" rel="noopener ugc nofollow" target="_blank">自下而上</a>图形，我们还在Android Studio 4.1 Canary 10中添加了一个<strong class="ir ht">摘要</strong>选项卡，用于线程状态分布、跟踪事件统计等内容。例如，我们经常希望找到更多关于重复出现的跟踪事件的信息。摘要选项卡显示基本统计数据(计数、最小值、最大值等。)以及所选跟踪事件的最长运行次数。您甚至可以通过从表中选择一行来导航到另一个事件。</p><figure class="kz la lb lc fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mf"><img src="../Images/dea58852796a5652c97d6d814d7b781f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*C7kK8DoF2sRKrc1L"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx"><em class="lh">Statistics and longest running occurrences of a trace event</em></figcaption></figure><h1 id="066b" class="jv jw hs bd jx jy ll ka kb kc lm ke kf kg ln ki kj kk lo km kn ko lp kq kr ks bi translated">稳定性和性能改进</h1><p id="6805" class="pw-post-body-paragraph ip iq hs ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">最后但同样重要的是，我们一直在提高CPU记录的稳定性和性能。</p><ul class=""><li id="c4c2" class="lr ls hs ir b is it iw ix ja lt je lu ji lv jm lw lx ly lz bi translated">我们修复了几个可能导致录制失败的错误。</li><li id="3b77" class="lr ls hs ir b is ma iw mb ja mc je md ji me jm lw lx ly lz bi translated">我们利用Android最新的工具技术，在Android API level 28和更高版本上使用Perfetto作为后端构建了系统跟踪。</li><li id="949b" class="lr ls hs ir b is ma iw mb ja mc je md ji me jm lw lx ly lz bi translated">我们还优化了分析器代码，以显著降低解析记录的跟踪时的内存消耗(高达80%)，允许您打开和分析更长的跟踪。请记住，您可以增加Android Studio的最大堆大小,这对很长的跟踪很有帮助。</li></ul></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><p id="97a3" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">下载最新的Android Studio 4.1 <a class="ae jn" href="https://developer.android.com/studio/preview" rel="noopener ugc nofollow" target="_blank">预览版</a>来试用这些功能。一如既往，我们感谢您的<a class="ae jn" href="http://issuetracker.google.com/issues/new?component=192722&amp;template=842923" rel="noopener ugc nofollow" target="_blank">反馈</a>。</p></div></div>    
</body>
</html>