<html>
<head>
<title>Handle Casting Conversion Errors: 12 Things Developers Will Love About Oracle Database 12c Release 2 Part 8</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">处理转换错误:开发人员喜欢的关于Oracle Database 12c第2版第8部分的12件事</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/handle-casting-conversion-errors-12-things-developers-will-love-about-oracle-database-12c-release-e461566a8246?source=collection_archive---------2-----------------------#2016-11-10">https://medium.com/oracledevs/handle-casting-conversion-errors-12-things-developers-will-love-about-oracle-database-12c-release-e461566a8246?source=collection_archive---------2-----------------------#2016-11-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="23d7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有时，您会希望将一个值转换为不同的数据类型。如果您的值与所需的类型不兼容，这可能会带来问题。</p><p id="00d3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以使用我们之前讨论过的<a class="ae jc" rel="noopener" href="/oracledevs/verify-data-type-conversions-12-things-developers-will-love-about-oracle-database-12c-release-2-ad90c97de0e5"> validate_conversion函数</a>来解决这个问题。但是还有另一种方法。Cast现在有一个“转换错误时默认”条款。</p><p id="d685" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这指定了如果Oracle无法将表达式转换为您想要的类型，它将返回哪个值。例如，假设您试图将varchar2列转换为日期。但它恰好包含值“不是日期”。你会得到一个严重的错误:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="69cb" class="jm jn hh ji b fi jo jp l jq jr">select cast ( 'not a date' as date ) <br/>from   dual; </span><span id="26d5" class="jm jn hh ji b fi js jp l jq jr">ORA-01858: a non-numeric character was found where a numeric was expected</span></pre><p id="81d1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用新的子句，您可以告诉Oracle返回一个“神奇的日期”,而不是抛出一个异常。例如:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="1369" class="jm jn hh ji b fi jo jp l jq jr">select cast ( <br/>         'not a date' as date <br/>         default date'0001-01-01' on conversion error <br/>       ) dt <br/>from  dual; </span><span id="2424" class="jm jn hh ji b fi js jp l jq jr">DT <br/>-------------------- <br/>01-JAN-0001 00:00:00</span></pre><p id="84f0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，您可以在代码中添加对这个神奇值的检查。</p><p id="448d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请注意，默认值必须与要转换的数据类型相匹配。所以如果你要转换日期，你不能返回一个字符串:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="aaf5" class="jm jn hh ji b fi jo jp l jq jr">select cast ( <br/>         '01012010' as date <br/>         default 'not a date' on conversion error <br/>       ) dt <br/>from   dual; </span><span id="3ca1" class="jm jn hh ji b fi js jp l jq jr">ORA-01858: a non-numeric character was found where a numeric was expected</span></pre><p id="8323" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">与validate_conversion一样，cast使用您的NLS设置作为默认格式。如果要覆盖这些，请将格式作为参数传递:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="af0d" class="jm jn hh ji b fi jo jp l jq jr">select cast ( <br/>         '01012010' as date <br/>         default '01010001' on conversion error, <br/>         'ddmmyyyy' <br/>       ) dt <br/>from   dual; </span><span id="9503" class="jm jn hh ji b fi js jp l jq jr">DT <br/>-------------------- <br/>01-JAN-2010 00:00:00</span></pre><p id="0c94" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这太棒了。但是乍一看，它似乎是有限的。毕竟你多久用一次cast？如果你和我一样，答案是“很少”。</p><p id="84d9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但是事情远不止如此！</p><p id="869b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">转换错误条款也适用于其他转换函数。比如:</p><ul class=""><li id="5de5" class="jt ju hh ig b ih ii il im ip jv it jw ix jx jb jy jz ka kb bi translated">截止日期()</li><li id="7ff1" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">收件人号码()</li><li id="f9ca" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">to_yminterval()</li><li id="cd1c" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">等等。</li></ul><p id="8574" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这才叫<em class="kh">真的</em>有用！这些都是你一直在使用的功能。</p><p id="26ed" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，您可以像这样编写数据类型转换:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="058e" class="jm jn hh ji b fi jo jp l jq jr">select to_date( <br/>         'not a date' <br/>         default '01010001' on conversion error, <br/>         'ddmmyyyy' <br/>       ) dt <br/>from dual; </span><span id="eb26" class="jm jn hh ji b fi js jp l jq jr">DT <br/>-------------------- <br/>01-JAN-0001 00:00:00</span></pre><p id="38d8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将这与validate_conversion结合起来，可以更容易地将表达式转换成新数据类型<em class="kh">。</em></p></div><div class="ab cl ki kj go kk" role="separator"><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn ko"/><span class="kl bw bk km kn"/></div><div class="ha hb hc hd he"><p id="d6f9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="kh">全文原载于2016年11月10日</em><a class="ae jc" href="https://blogs.oracle.com/sql/12-things-developers-will-love-about-oracle-database-12c-release-2" rel="noopener ugc nofollow" target="_blank"><em class="kh">blogs.oracle.com</em></a><em class="kh">。</em></p></div></div>    
</body>
</html>