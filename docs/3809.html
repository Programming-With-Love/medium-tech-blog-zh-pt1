<html>
<head>
<title>Touch ID and Face ID Authentication using Flutter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Flutter的触控ID和Face ID认证</h1>
<blockquote>原文：<a href="https://medium.com/globant/touch-id-and-face-id-authentication-using-flutter-382b85509548?source=collection_archive---------0-----------------------#2022-01-07">https://medium.com/globant/touch-id-and-face-id-authentication-using-flutter-382b85509548?source=collection_archive---------0-----------------------#2022-01-07</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/d05f613c2c66f571c40ccce4c4501911.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YI-Y2Wa583YXPjd6"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo by <a class="ae it" href="https://unsplash.com/@plhnk?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Paul Hanaoka</a> on <a class="ae it" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="25e5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为什么我们需要touchID或FaceID认证？</p><p id="c97e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果您不采取必要的预防措施来防止您的信息受到威胁，黑客可以很容易地访问您手机上的信息。预防措施，如在手机上保留密码或触控ID/Face ID。</p><p id="90ad" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这个flutter教程中，我将解释如何使用<strong class="iw hi"> local_auth </strong>插件添加触控ID和Face ID认证功能来创建安全的flutter应用程序。</p></div><div class="ab cl js jt go ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="ha hb hc hd he"><p id="6959" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi jz translated">他的flutter插件提供了简单的方法来认证使用触控ID或Face ID的用户。</p><p id="22c1" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">首先，我们需要在pubspec.yaml文件中添加最新版本的<a class="ae it" href="https://pub.dev/packages/local_auth" rel="noopener ugc nofollow" target="_blank"> <em class="ki"> local_auth </em> </a>插件，如下所示，并获取flutter项目中的依赖项。</p><figure class="kj kk kl km fd ii"><div class="bz dy l di"><div class="kn ko l"/></div></figure><p id="d4a9" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在你的flutter项目<em class="ki">中创建<em class="ki">biometric _ authentic ation . dart</em>文件<em class="ki"> </em>。</em>现在将local_auth框架导入到您的文件中，如下所示:</p><pre class="kj kk kl km fd kp kq kr ks aw kt bi"><span id="c1d6" class="ku kv hh kq b fi kw kx l ky kz">import 'package:flutter/material.dart';<br/>import 'package:local_auth/local_auth.dart';<br/>import 'package:flutter/services.dart';<br/>import 'package:local_auth/error_codes.dart' as local_auth_error;</span></pre><p id="017f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这里的<em class="ki"> services.dart </em>用于平台服务在认证时捕获平台异常。这用于指示平台插件中的平台交互失败。</p><p id="ea02" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi jz translated"><span class="l ka kb kc bm kd ke kf kg kh di">L</span>local _ auth插件中的ocalAuthenticationError类提供了PlatformException抛出的各种异常代码。比如，</p><ol class=""><li id="026e" class="la lb hh iw b ix iy jb jc jf lc jj ld jn le jr lf lg lh li bi translated">PasscodeNotSet</li><li id="3473" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr lf lg lh li bi translated">未注册</li><li id="e105" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr lf lg lh li bi translated">不可用</li><li id="8f5b" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr lf lg lh li bi translated">其他操作系统</li><li id="8f03" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr lf lg lh li bi translated">LockedOut</li><li id="bf5b" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr lf lg lh li bi translated">PermanentlyLockedOut。</li></ol><p id="efcf" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在创建<strong class="iw hi">biometric authentic ation</strong>作为有状态小部件，并添加如下方法:</p><pre class="kj kk kl km fd kp kq kr ks aw kt bi"><span id="90c7" class="ku kv hh kq b fi kw kx l ky kz">Future&lt;void&gt; authenticateUser() async {<br/>  bool isAuthorized = false;<br/>  try {<br/>    isAuthorized = await _localAuthentication.authenticate(<br/>      localizedReason: "Please authenticate to see account balance",<br/>      useErrorDialogs: true,<br/>      stickyAuth: false,<br/>    );<br/>  } on PlatformException catch (exception) {<br/>    if (exception.code == local_auth_error.notAvailable ||<br/>        exception.code == local_auth_error.passcodeNotSet ||<br/>        exception.code == local_auth_error.notEnrolled) {<br/>      // Handle this exception here.<br/>    }<br/>  }<br/><br/>  if (!mounted) return;<br/><br/>  setState(() {<br/>    _isUserAuthorized = isAuthorized;<br/>  });<br/>}</span></pre><p id="ea42" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们了解一下上述方法中使用的各种参数。</p><p id="6b38" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> authenticate() </strong>根据设备上可用的生物特征对用户进行身份验证的方法。此方法返回一个【未来】持有<em class="ki">真</em>，如果用户成功认证，则<em class="ki">假</em>否则。</p><p id="6618" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> localizedReason </strong>用于向用户显示消息，而<em class="ki">则提示</em>进行验证并说明原因。因为这是方法中的一个必需参数，所以在调用authenticate()方法时必须传递这个参数。</p><p id="c109" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> useErrorDialogs </strong>如果通过为<em class="ki">‘真’</em>表示系统将尝试处理用户在认证时遇到的可修复问题。对于本教程，我使用系统提供的提示消息进行身份验证。</p><p id="a97d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">对于自定义提示消息，您需要使用<em class="ki">' useErrorDialogs = false '</em>调用此API，并在对话框中使用<em class="ki">【AndroidAuthStrings】</em>和<em class="ki">【ioauthstrings】</em>提供您自己的消息。例如，要显示特定于iOS的自定义提示信息，您可以使用IOSAuthMessages，如下所示:</p><pre class="kj kk kl km fd kp kq kr ks aw kt bi"><span id="876c" class="ku kv hh kq b fi kw kx l ky kz"><strong class="kq hi">import</strong> 'package:local_auth/auth_strings.dart';<br/><br/><strong class="kq hi">const</strong> iosStrings = <strong class="kq hi">const</strong> IOSAuthMessages(<br/>    cancelButton: 'cancel',<br/>    goToSettingsButton: 'settings',<br/>    goToSettingsDescription: 'Please enable Touch ID.',<br/>    lockOut: 'Please reenable your Touch ID');<br/><strong class="kq hi">await</strong> localAuth.authenticate(<br/>    localizedReason: 'Please authenticate to show account balance',<br/>    useErrorDialogs: <strong class="kq hi">false</strong>,<br/>    iOSAuthStrings: iosStrings);</span></pre><p id="2775" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> stickyAuth </strong>在应用程序因为任何原因进入后台时使用，比如用户在认证过程中接到电话。出于安全原因，身份验证必须在此时停止。如果stickyAuth设置为<em class="ki">真</em>，当应用恢复时，认证恢复。如果设置为false(默认值)，则一旦应用程序暂停，就会向Dart发回一条失败消息，由客户端应用程序决定是重新启动身份验证还是执行其他操作。这里，我们使用了stickyAuth <strong class="iw hi"> </strong>的默认值，即本教程中的false。</p></div><div class="ab cl js jt go ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="ha hb hc hd he"><p id="2ef6" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在在<em class="ki">biometric _ authentic ation . dart</em>中添加以下代码:</p><figure class="kj kk kl km fd ii"><div class="bz dy l di"><div class="kn ko l"/></div></figure><p id="ee28" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，让我们了解iOS和Android平台的集成步骤。</p></div><div class="ab cl js jt go ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="ha hb hc hd he"><blockquote class="lo lp lq"><p id="f8eb" class="iu iv ki iw b ix iy iz ja jb jc jd je lr jg jh ji ls jk jl jm lt jo jp jq jr ha bi translated">iOS的集成步骤:</p></blockquote><p id="3ff4" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了同时支持TouchId和FaceId，将以下项目添加到<em class="ki"> info.plist </em>文件中:</p><figure class="kj kk kl km fd ii"><div class="bz dy l di"><div class="kn ko l"/></div></figure><p id="f46e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">要启用触控ID/Face ID -点击您的模拟器，然后点击顶部菜单栏<em class="ki"> </em>中的功能- &gt;触控ID/Face ID - &gt;注册，如下所示:</p><figure class="kj kk kl km fd ii er es paragraph-image"><div class="er es lu"><img src="../Images/2d4dcbf5201d4a79fc80525bef94ee32.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*alAJ6WKRqjvxefxUUPtv4g.png"/></div></figure><p id="afc9" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在触控ID的子菜单中，有以下3个选项:</p><figure class="kj kk kl km fd ii er es paragraph-image"><div class="er es lv"><img src="../Images/820d9bf585627f7484af6fdc98ba3288.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*z8JQJ5yMzgVvzK052-fUIA.png"/></div></figure><ol class=""><li id="b29f" class="la lb hh iw b ix iy jb jc jf lc jj ld jn le jr lf lg lh li bi translated"><strong class="iw hi">已注册</strong> —启用触控ID或Face ID功能</li><li id="40f5" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr lf lg lh li bi translated"><strong class="iw hi">匹配触摸</strong> —认证成功</li><li id="7ac8" class="la lb hh iw b ix lj jb lk jf ll jj lm jn ln jr lf lg lh li bi translated"><strong class="iw hi">触摸不匹配</strong> —认证失败</li></ol></div><div class="ab cl js jt go ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="ha hb hc hd he"><blockquote class="lo lp lq"><p id="0882" class="iu iv ki iw b ix iy iz ja jb jc jd je lr jg jh ji ls jk jl jm lt jo jp jq jr ha bi translated">Android的集成步骤:</p></blockquote><p id="8545" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">步骤1 </strong>:我们需要在Android manifest文件中添加以下权限。</p><figure class="kj kk kl km fd ii"><div class="bz dy l di"><div class="kn ko l"/></div></figure><p id="e5f3" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">步骤2: </strong> local_auth插件需要使用FragmentActivity。这可以通过切换到使用<code class="du lw lx ly kq b">FlutterFragmentActivity</code>而不是<code class="du lw lx ly kq b">FlutterActivity</code>来实现。为此，我们需要如下更新<em class="ki"> MainActivity.kt </em>文件。</p><figure class="kj kk kl km fd ii"><div class="bz dy l di"><div class="kn ko l"/></div></figure><p id="842f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了运行这段代码，你需要将你的项目转换成AndroidX。</p><p id="6470" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在仿真器中启用<em class="ki">指纹</em>:</p><p id="e880" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">运行你的Android模拟器，进入设置-&gt; <strong class="iw hi">安全&amp; </strong>位置- &gt;指纹。如果您已经设置了PIN，请在模拟器上输入它。如果你还没有设置你的PIN，Android模拟器会提示你添加它。单击添加指纹。</p><div class="kj kk kl km fd ab cb"><figure class="lz ii ma mb mc md me paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><img src="../Images/204d9d29011675c11e6740968757bc68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*0e5AC8WAr87MvBetf4ehcw.png"/></div></figure><figure class="lz ii ma mb mc md me paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><img src="../Images/4808aed238dca4bd90357a70ce91e22f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*fAkRd7XIs87gqtI32667bg.png"/></div></figure></div></div><div class="ab cl js jt go ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="ha hb hc hd he"><h2 id="8ba7" class="ku kv hh bd mf mg mh mi mj mk ml mm mn jf mo mp mq jj mr ms mt jn mu mv mw mx bi translated">这就是本教程的内容，如果对你有帮助，请<strong class="ak">👏或者和别人分享这个故事。感谢您的阅读。编码快乐！🚀</strong></h2></div></div>    
</body>
</html>