<html>
<head>
<title>APIs for Reporting in OCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OCI申报用API</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/apis-for-reporting-in-oci-5fac2dc2791f?source=collection_archive---------0-----------------------#2021-06-15">https://medium.com/oracledevs/apis-for-reporting-in-oci-5fac2dc2791f?source=collection_archive---------0-----------------------#2021-06-15</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/ac1382f8db26ddfa3bf6c90230e1c876.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*eyu1lJyh2q7qFS6Fa934zg.png"/></div></figure><p id="1203" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">Oracle云通过API进行了全面的设置。</p><p id="fafa" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">最简单的情况可能是确定客户端时钟偏差:</p><pre class="jj jk jl jm fd jn jo jp jq aw jr bi"><span id="73be" class="js jt hh jo b fi ju jv l jw jx">$ curl -s --head <a class="ae jy" href="https://iaas.ap-sydney-1.oraclecloud.com" rel="noopener ugc nofollow" target="_blank">https://iaas.ap-sydney-1.oraclecloud.com</a> | grep Date</span></pre><figure class="jj jk jl jm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es jz"><img src="../Images/5fa4c422fef1eaccb1a0dc3c25e8af3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TSP1AhSSQIqbAgLR2THI9w.png"/></div></div></figure><p id="7bcf" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">但是在本文中，我们将研究更高级的报告方法。</p><p id="f7ee" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">可以从Oracle云获得成本分析报告，将检查三种方法:</p><p id="c58d" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">— OCI控制台</p><p id="3810" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">— OCI命令行工具</p><p id="36df" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">—Python API</p><p id="e3f5" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">所有方法都可以在Oracle自由层中使用。</p></div><div class="ab cl ke kf go kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="ha hb hc hd he"><h1 id="476c" class="kl jt hh bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">来自OCI控制台的报告</h1><p id="4197" class="pw-post-body-paragraph il im hh in b io li iq ir is lj iu iv iw lk iy iz ja ll jc jd je lm jg jh ji ha bi translated">您可以从控制台获得成本分析的概述。</p><p id="931d" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">从“显示”下拉菜单中选择“成本”选项。</p><figure class="jj jk jl jm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es ln"><img src="../Images/72cb4fd8eb9495bc7e940a1052f54dff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*elQn75Zq5j9n8pWkypM8Cw.png"/></div></div></figure><p id="1e05" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">该报告分为两个部分—图形和表格:</p><figure class="jj jk jl jm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es lo"><img src="../Images/992927bdacc0821f89732acf19722c4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WqUB8Wq2kduAizF1rfQC_g.png"/></div></div></figure><p id="c8e2" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">计算出的金额明细在表格中逐项列出。</p><p id="5f2f" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">计算的金额也以当地货币指定。例如新加坡元。</p><figure class="jj jk jl jm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es lp"><img src="../Images/d68d165d8f049efa9452d3d465f64637.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oobOgzIVmCJsK3PvKfdFqw.png"/></div></div></figure><p id="e5be" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">对于计算的数量，从“显示”下拉菜单中选择“使用”选项。</p><figure class="jj jk jl jm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es lq"><img src="../Images/d121167fa42f55618d784cabee1525f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ib3KmO6kdldQwETAqNBvyg.png"/></div></div></figure><p id="6791" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">您将得到一个类似如下的表格:</p><figure class="jj jk jl jm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es lr"><img src="../Images/cf21ea16be029cb4b06c5357969ac953.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DVspLQb5ZMKfmWhPiqR6kg.png"/></div></div></figure><p id="c1d8" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">所以从控制台获得这些信息很好。</p><p id="8648" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">但是，从OCI命令行获取此信息可能更方便。</p></div><div class="ab cl ke kf go kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="ha hb hc hd he"><h1 id="97e6" class="kl jt hh bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">从命令行报告</h1><p id="cee9" class="pw-post-body-paragraph il im hh in b io li iq ir is lj iu iv iw lk iy iz ja ll jc jd je lm jg jh ji ha bi translated">对于Linux工作站(如Fedora)，安装OCI命令行工具如下:</p><pre class="jj jk jl jm fd jn jo jp jq aw jr bi"><span id="f7b1" class="js jt hh jo b fi ju jv l jw jx">bash -c "$(curl -L <a class="ae jy" href="https://raw.githubusercontent.com/oracle/oci-cli/master/scripts/install/install.sh" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/oracle/oci-cli/master/scripts/install/install.sh</a>)"</span></pre><p id="a204" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">你会收到一些选项提示，但你可以直接“输入”它们。</p><p id="445d" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">安装完成后，您可以在工作目录中激活Python虚拟环境:</p><pre class="jj jk jl jm fd jn jo jp jq aw jr bi"><span id="0b88" class="js jt hh jo b fi ju jv l jw jx">$ source activate</span></pre><p id="81af" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">然后测试oci:</p><pre class="jj jk jl jm fd jn jo jp jq aw jr bi"><span id="5a57" class="js jt hh jo b fi ju jv l jw jx">oci iam compartment list -c <!-- -->ocid1.tenancy.oc1..&lt;tenantID&gt;</span></pre><p id="bf97" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如果您的工作站时间不同，您可能会收到以下警告。</p><blockquote class="ls lt lu"><p id="dfb2" class="il im lv in b io ip iq ir is it iu iv lw ix iy iz lx jb jc jd ly jf jg jh ji ha bi translated">警告:您的计算机时间:2021–06–11t 08:37:19.308803+00:00与服务器时间:2021–06–11t 08:54:45+00:00相差超过5分钟。这可能会导致连接到服务的身份验证错误。</p></blockquote><p id="3341" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">否则，您将得到以下输出，这也证明oci命令行工具正在工作。</p><figure class="jj jk jl jm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es lz"><img src="../Images/2bfd686e2f7cf54d7d6dddc35cd8c4fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*_N4d5_ECrbNoWyiWTXKrTA.png"/></div></div></figure><p id="2b56" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">要停止使用CLI，请在终端中运行以下命令。</p><pre class="jj jk jl jm fd jn jo jp jq aw jr bi"><span id="5ff7" class="js jt hh jo b fi ju jv l jw jx">$ deactivate</span></pre><h2 id="99c7" class="js jt hh bd km ma mb mc kq md me mf ku iw mg mh ky ja mi mj lc je mk ml lg mm bi translated"><strong class="ak">来自OCI命令行的成本分析</strong></h2><p id="47e2" class="pw-post-body-paragraph il im hh in b io li iq ir is lj iu iv iw lk iy iz ja ll jc jd je lm jg jh ji ha bi translated">从过滤器开始。过滤器需要采用JSON格式。</p><pre class="jj jk jl jm fd jn jo jp jq aw jr bi"><span id="b463" class="js jt hh jo b fi ju jv l jw jx">{<br/>  "tenantId": "ocid1.tenancy.oc1..&lt;tenantID&gt;",<br/>  "timeUsageStarted": "2020-12-01T17:00:00.000000-07:00",<br/>  "timeUsageEnded": "2020-12-29T00:00:00Z",<br/>  "granularity": "DAILY",<br/>  "groupBy": [],<br/>  "compartmentDepth": null,<br/>  "filter": null,<br/>  "nextPageToken": "string"<br/>}</span></pre><p id="797a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">将JSON放在一个名为simplerequestsummerzedusagesdetails . JSON的文件中</p><p id="64b7" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">然后使用OCI进行如下查询:</p><pre class="jj jk jl jm fd jn jo jp jq aw jr bi"><span id="1f49" class="js jt hh jo b fi ju jv l jw jx">oci raw-request --http-method POST --target-uri https://usageapi.ap-sydney-1.oci.oraclecloud.com/20200107/usage <br/>--request-body file://~/oci-python-sdk/examples/SimpleRequestSummarizedUsagesDetails.json <br/>--config-file ~/.oci/config</span></pre><p id="654c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">您将得到一个长输出，如下所示:</p><figure class="jj jk jl jm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es mn"><img src="../Images/834971834647495b331879010f3777da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N4f_kLD7_aiKCAXve3TkuA.png"/></div></div></figure><p id="4bd8" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">然而，从Python中获取同样的信息会更方便。</p></div><div class="ab cl ke kf go kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="ha hb hc hd he"><h1 id="c8c1" class="kl jt hh bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">来自Python的报告</h1><p id="f745" class="pw-post-body-paragraph il im hh in b io li iq ir is lj iu iv iw lk iy iz ja ll jc jd je lm jg jh ji ha bi translated">官方Python安装文档在这里:</p><div class="mo mp ez fb mq mr"><a href="https://docs.oracle.com/en-us/iaas/tools/python/2.38.3/installation.html" rel="noopener  ugc nofollow" target="_blank"><div class="ms ab dw"><div class="mt ab mu cl cj mv"><h2 class="bd hi fi z dy mw ea eb mx ed ef hg bi translated">安装— oci 2.39.1文档</h2><div class="my l"><h3 class="bd b fi z dy mw ea eb mx ed ef dx translated">Oracle建议您使用virtualenv在虚拟环境中运行SDK。这允许您隔离…</h3></div><div class="mz l"><p class="bd b fp z dy mw ea eb mx ed ef dx translated">docs.oracle.com</p></div></div></div></a></div><p id="e12c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">首先从Github克隆OCI Python SDK，如下所示:</p><pre class="jj jk jl jm fd jn jo jp jq aw jr bi"><span id="5d49" class="js jt hh jo b fi ju jv l jw jx">$ git clone <a class="ae jy" href="mailto:git@github.com" rel="noopener ugc nofollow" target="_blank">git@github.com</a>:oracle/oci-python-sdk.git</span></pre><figure class="jj jk jl jm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es na"><img src="../Images/00b1265be4543a169b4925d870a686d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r6AAKjKEU0V825fE9BxCjQ.png"/></div></div></figure><p id="1827" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">然后激活Python虚拟环境:</p><pre class="jj jk jl jm fd jn jo jp jq aw jr bi"><span id="c6a5" class="js jt hh jo b fi ju jv l jw jx">$ cd oci-python-sdk<br/>$ python3 -m venv .<br/>$ source ./bin/activate</span></pre><p id="eef8" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">然后安装OCI软件包。</p><pre class="jj jk jl jm fd jn jo jp jq aw jr bi"><span id="045d" class="js jt hh jo b fi ju jv l jw jx">$ pip install oci</span></pre><figure class="jj jk jl jm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es nb"><img src="../Images/9989cb87f8bee80275aefa05ad502fd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o_dCFYXtRhebhYI5wziqRQ.png"/></div></div></figure><p id="ca7b" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">对于身份验证，您还需要设置。oci目录，并确保私钥在~/中。oci/config文件。</p><p id="e6a2" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">现在一切都安装好了，在python3中做一个快速测试</p><pre class="jj jk jl jm fd jn jo jp jq aw jr bi"><span id="b98b" class="js jt hh jo b fi ju jv l jw jx">$ python3</span></pre><p id="1d6f" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">输入以下命令:</p><pre class="jj jk jl jm fd jn jo jp jq aw jr bi"><span id="7034" class="js jt hh jo b fi ju jv l jw jx">&gt;&gt;&gt; import oci<br/>&gt;&gt;&gt; config = oci.config.from_file("~/.oci/config", "DEFAULT")<br/>&gt;&gt;&gt; identity = oci.identity.IdentityClient(config)<br/>&gt;&gt;&gt; user = identity.get_user(config["user"]).data<br/>&gt;&gt;&gt; print(user)</span></pre><p id="b548" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">您应该会得到类似如下的输出:</p><figure class="jj jk jl jm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es nc"><img src="../Images/d39201dbcefc4f33f29dd686ba785a3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j-cXe-8G8HyZ_3ID5r4_EQ.png"/></div></div></figure><h2 id="acc1" class="js jt hh bd km ma mb mc kq md me mf ku iw mg mh ky ja mi mj lc je mk ml lg mm bi translated">使用Python进行成本分析</h2><p id="190e" class="pw-post-body-paragraph il im hh in b io li iq ir is lj iu iv iw lk iy iz ja ll jc jd je lm jg jh ji ha bi translated">下载使用报告的基本脚本在以下文档中定义:</p><div class="mo mp ez fb mq mr"><a href="https://docs.oracle.com/en-us/iaas/Content/Billing/Tasks/accessingusagereports.htm" rel="noopener  ugc nofollow" target="_blank"><div class="ms ab dw"><div class="mt ab mu cl cj mv"><h2 class="bd hi fi z dy mw ea eb mx ed ef hg bi translated">访问成本和使用报表</h2><div class="my l"><h3 class="bd b fi z dy mw ea eb mx ed ef dx translated">成本和使用报告是每天生成并存储在对象存储中的逗号分隔值(CSV)文件…</h3></div><div class="mz l"><p class="bd b fp z dy mw ea eb mx ed ef dx translated">docs.oracle.com</p></div></div></div></a></div><p id="869f" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">下面还列出了该脚本:</p><pre class="jj jk jl jm fd jn jo jp jq aw jr bi"><span id="1b77" class="js jt hh jo b fi ju jv l jw jx">import oci<br/>import os<br/>				<br/># This script downloads all of the cost, usage, (or both) reports for a tenancy (specified in the config file).<br/>#<br/># Pre-requisites: Create an IAM policy to endorse users in your tenancy to read cost reports from the OCI tenancy.<br/>#<br/># Example policy:<br/># define tenancy reporting as ocid1.tenancy.oc1..aaaaaaaaned4fkpkisbwjlr56u7cj63lf3wffbilvqknstgtvzub7vhqkggq<br/># endorse group group_name to read objects in tenancy reporting<br/>#<br/># Note - The only value you need to change is the group name. Do not change the OCID in the first statement.<br/>				<br/>reporting_namespace = 'bling'<br/>				<br/># Download all usage and cost files. You can comment out based on the specific need:<br/>prefix_file = ""                     #  For cost and usage files<br/># prefix_file = "reports/cost-csv"   #  For cost<br/># prefix_file = "reports/usage-csv"  #  For usage<br/>				<br/># Update these values<br/>destintation_path = 'downloaded_reports'<br/>				<br/># Make a directory to receive reports<br/>if not os.path.exists(destintation_path):<br/>    os.mkdir(destintation_path)<br/>				<br/># Get the list of reports<br/>config = oci.config.from_file(oci.config.DEFAULT_LOCATION, oci.config.DEFAULT_PROFILE)<br/>reporting_bucket = config['tenancy']<br/>object_storage = oci.object_storage.ObjectStorageClient(config)<br/>report_bucket_objects = object_storage.list_objects(reporting_namespace, reporting_bucket, prefix=prefix_file)<br/>				<br/>for o in report_bucket_objects.data.objects:<br/>    print('Found file ' + o.name)<br/>    object_details = object_storage.get_object(reporting_namespace, reporting_bucket, o.name)<br/>    filename = o.name.rsplit('/', 1)[-1]<br/>				<br/>    with open(destintation_path + '/' + filename, 'wb') as f:<br/>        for chunk in object_details.data.raw.stream(1024 * 1024, decode_content=False):<br/>            f.write(chunk)<br/>				<br/>    print('----&gt; File ' + o.name + ' Downloaded')</span></pre><p id="8541" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">将脚本保存在~/oci-python-sdk/examples/中。</p><p id="22a8" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">运行该脚本，所有报告都将保存到~/OCI-python-SDK/examples/downloaded _ reports目录中。</p><p id="ed81" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">然后解压缩并检查任何报告，使用:</p><pre class="jj jk jl jm fd jn jo jp jq aw jr bi"><span id="2466" class="js jt hh jo b fi ju jv l jw jx">$ gunzip 0001000000428365.csv.gz<br/>$ less 0001000000428365.csv.gz</span></pre><h2 id="8903" class="js jt hh bd km ma mb mc kq md me mf ku iw mg mh ky ja mi mj lc je mk ml lg mm bi translated">使用Python和请求进行成本分析</h2><p id="1536" class="pw-post-body-paragraph il im hh in b io li iq ir is lj iu iv iw lk iy iz ja ll jc jd je lm jg jh ji ha bi translated">对于Python，可以使用本地的urllib.request模块作为HTTP客户端来查询API。</p><p id="e32a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><a class="ae jy" href="https://docs.python.org/3/library/urllib.request.html#module-urllib.request" rel="noopener ugc nofollow" target="_blank">https://docs . python . org/3/library/urllib . request . html # module-urllib . request</a></p><p id="6aef" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">但是，对于更高级别的HTTP客户端接口，建议使用Requests包。</p><div class="mo mp ez fb mq mr"><a href="https://docs.python-requests.org/en/master/" rel="noopener  ugc nofollow" target="_blank"><div class="ms ab dw"><div class="mt ab mu cl cj mv"><h2 class="bd hi fi z dy mw ea eb mx ed ef hg bi translated">请求:HTTP for Humans请求2.25.1文档</h2><div class="my l"><h3 class="bd b fi z dy mw ea eb mx ed ef dx translated">版本2.25.1 .(安装)Requests是一个优雅而简单的Python HTTP库，是为人类而构建的…</h3></div><div class="mz l"><p class="bd b fp z dy mw ea eb mx ed ef dx translated">docs.python-requests.org</p></div></div></div></a></div><blockquote class="ls lt lu"><p id="fbbf" class="il im lv in b io ip iq ir is it iu iv lw ix iy iz lx jb jc jd ly jf jg jh ji ha bi translated"><strong class="in hi"> Requests </strong>是一个优雅而简单的Python HTTP库，为人类而建。</p></blockquote><p id="2418" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">请求库也用于Github中OCI Python SDK的官方示例:</p><p id="33ab" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><a class="ae jy" href="https://github.com/oracle/oci-python-sdk/blob/master/examples/healthchecks_example.py" rel="noopener ugc nofollow" target="_blank">https://github . com/Oracle/OCI-python-SDK/blob/master/examples/</a></p><p id="e252" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">作为脚本运行或交互运行。</p><pre class="jj jk jl jm fd jn jo jp jq aw jr bi"><span id="8ae6" class="js jt hh jo b fi ju jv l jw jx">import requests<br/>from oci.config import from_file<br/>from oci.signer import Signer<br/><br/>config = from_file()<br/>auth = Signer(<br/>tenancy=config['tenancy'],<br/>user=config['user'],<br/>fingerprint=config['fingerprint'],<br/>private_key_file_location=config['key_file'],<br/>pass_phrase=config['pass_phrase']<br/>)<br/><br/>endpoint = 'https://usageapi.ap-sydney-1.oci.oraclecloud.com/20200107/usage'</span><span id="f872" class="js jt hh jo b fi nd jv l jw jx">body = {<br/>  'tenantId': '<!-- -->ocid1.tenancy.oc1..aaaaaaaayjcxmo3mjpcu37iecerrlm5fdnreegpa3awvzvursmeyabyawvwq'<!-- -->,<br/>  'timeUsageStarted': '2020-12-01T00:00:00Z',<br/>  'timeUsageEnded': '2020-12-29T00:00:00Z',<br/>  'granularity': 'DAILY'<br/>}<br/><br/>response = requests.post(endpoint, json=body, auth=auth)<br/>response.raise_for_status()</span></pre><p id="3ee4" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">为Post请求添加超时，这是防止客户端无限期挂起的最佳做法。</p><pre class="jj jk jl jm fd jn jo jp jq aw jr bi"><span id="b52f" class="js jt hh jo b fi ju jv l jw jx">response = requests.post(endpoint, json=body, auth=auth<strong class="jo hi">,</strong> timeout=5<strong class="jo hi">)</strong></span></pre><p id="f1fb" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">然后以JSON格式显示输出，不进行文本格式化:</p><pre class="jj jk jl jm fd jn jo jp jq aw jr bi"><span id="8288" class="js jt hh jo b fi ju jv l jw jx">print(response.json())</span></pre><figure class="jj jk jl jm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ka kb di kc bf kd"><div class="er es ne"><img src="../Images/74ac7827765c360e410b06ff9fb7f171.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XVLrlfYCF5yx_0Mvf3Heaw.png"/></div></div></figure><p id="9b8a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">但是要以易读的文本格式显示JSON中的输出，请使用以下代码:</p><pre class="jj jk jl jm fd jn jo jp jq aw jr bi"><span id="f686" class="js jt hh jo b fi ju jv l jw jx">print(response.text)</span></pre><figure class="jj jk jl jm fd ii er es paragraph-image"><div class="er es nf"><img src="../Images/2dc9b5e18b66a7a2dcc815eee16a3e4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1230/format:webp/1*-OjuHIPAsB8Cv8Vm6F4yfw.png"/></div></figure><p id="6b4e" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">使用Oracle云，有许多选项可以报告成本分析。</p></div><div class="ab cl ke kf go kg" role="separator"><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj kk"/><span class="kh bw bk ki kj"/></div><div class="ha hb hc hd he"><p id="dde6" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><em class="lv"> Paul Guerin是一名专注于Oracle数据库的国际顾问。此外，他还出席了一些世界领先的甲骨文会议，包括甲骨文2013年世界开放大会。自2015年以来，他的工作一直是IOUG最佳实践技巧小册子以及AUSOUG、Oracle Technology Network、Quest和Oracle Developers (Medium)出版物的主题。2019年，他被授予My Oracle支持社区最有价值贡献者。他是一名DBA OCP，并将继续参与Oracle ACE计划。</em></p></div></div>    
</body>
</html>