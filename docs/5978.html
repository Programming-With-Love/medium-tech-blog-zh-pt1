<html>
<head>
<title>Secure Oracle Integration Cloud (OIC) using OCI WAF (Web Application Firewall)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用OCI WAF (Web应用防火墙)保护Oracle集成云(OIC)</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/secure-oracle-integration-cloud-oic-using-oci-waf-web-application-firewall-46436de48ecb?source=collection_archive---------0-----------------------#2022-10-12">https://medium.com/oracledevs/secure-oracle-integration-cloud-oic-using-oci-waf-web-application-firewall-46436de48ecb?source=collection_archive---------0-----------------------#2022-10-12</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/61a9fd35b244be5fc4c1696cca31aa32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FMQTXQRNYSAEPBQbs1u9LQ.png"/></div></div></figure><p id="ad64" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">对于一些客户来说，保护面向公众的集成平台(如OIC)有点困难。OIC产品团队最近添加了一个IP白名单特性，限制从特定IP地址(或VCN CIDR块)对实例的访问。</p><p id="4fdf" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">尽管如此，这个特性对一些客户来说还不够，因为他们希望围绕一个OIC实例添加更多的网络安全规则(更多信息请参考<a class="ae jn" href="https://docs.oracle.com/en-us/iaas/Content/WAF/Concepts/overview.htm" rel="noopener ugc nofollow" target="_blank"> OCI WAF文档</a>)。</p><p id="e160" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">OCI WAF支持两种类型的实施点，如负载平衡器或web应用程序域名(边缘实施)。在本文中，我将使用一个负载平衡器实施点。</p><p id="e13c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">注意:</strong>如果您还没有注册，那么<a class="ae jn" href="https://signup.cloud.oracle.com/?language=en" rel="noopener ugc nofollow" target="_blank">现在就可以注册甲骨文云自由层账户</a>。如果你对如何开始学习OCI感兴趣，注册是第一步，没有必要跟着这篇文章走。</p><h1 id="d3d3" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">体系结构</h1><p id="9821" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">这是该解决方案的高级架构:</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kr"><img src="../Images/e339048803698d054e46cda55df3ced1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5kNuIf6CTtq5lmRzgZTISw.png"/></div></div></figure><p id="0469" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这些是实施该体系结构的高级步骤:</p><ul class=""><li id="dfb5" class="kw kx hh ir b is it iw ix ja ky je kz ji la jm lb lc ld le bi translated">为OIC实例配置虚拟URL(例如oic.aaa.bbb)。</li><li id="c589" class="kw kx hh ir b is lf iw lg ja lh je li ji lj jm lb lc ld le bi translated">在公共子网中配置公共负载平衡器，并使用OIC公共IP和端口443配置后端集。此外，使用OIC主机名(oic.aaa.bbb)配置端口443上的侦听器。</li><li id="09a7" class="kw kx hh ir b is lf iw lg ja lh je li ji lj jm lb lc ld le bi translated">在DNS服务器中为负载平衡器的公共IP地址上的OIC DNS名称(oic.aaa.bbb)创建一个记录。</li><li id="8619" class="kw kx hh ir b is lf iw lg ja lh je li ji lj jm lb lc ld le bi translated">配置WAF策略，并将在前面步骤中配置的负载平衡器设置为防火墙实施点。</li><li id="8384" class="kw kx hh ir b is lf iw lg ja lh je li ji lj jm lb lc ld le bi translated">为OIC实例创建网络访问规则，以便只接受来自负载平衡器实例的流量。</li></ul><h1 id="3e56" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">实施步骤</h1><p id="2d34" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated"><strong class="ir hi"> 1。供应OIC实例</strong></p><p id="5b78" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在我们的第一步中，您应该在您选择的OCI地区提供一个OIC实例。只需导航到OCI控制台，选择“Developer Services”下的“Integration ”,并在您选择的隔离专区下创建一个新的集成实例。</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lk"><img src="../Images/403909046808f4520dab34b383f6d559.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EpA1hIWUz65QSm5IgCDa0A.png"/></div></div></figure><p id="4ac3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">注意:您也可以使用terraform来提供OIC实例。请参考<a class="ae jn" href="https://registry.terraform.io/providers/oracle/oci/latest/docs/resources/integration_integration_instance" rel="noopener ugc nofollow" target="_blank">集成资源提供者</a>文档。</p><p id="ea61" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> 2。为OIC实例创建自定义URL</strong></p><p id="1430" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为您的实例选择自定义主机名，并在DNS服务器上注册它。然后为您的主机名创建SSL证书，并使用证书颁发机构(CA)进行签名(或者使用自签名证书进行测试)。</p><p id="ad9c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最后，您应该创建一个OCI保险库来存储使用以下格式的证书(作为OCI秘密)</p><pre class="ks kt ku kv fd ll lm ln lo aw lp bi"><span id="bfe4" class="lq jp hh lm b fi lr ls l lt lu">{<br/>  "key": "-----BEGIN PRIVATE KEY-----\n…..-----END PRIVATE KEY-----\n",<br/>  "cert": "-----BEGIN CERTIFICATE-----\n….-----END CERTIFICATE-----\n",<br/>  "intermediates": [<br/>    "-----BEGIN CERTIFICATE-----\n….-----END CERTIFICATE-----\n",<br/>    "-----BEGIN CERTIFICATE-----\n….-----END CERTIFICATE-----\n"<br/>  ],<br/>  "passphrase": "&lt;private key password if encrypted key is provided&gt;"<br/>}</span></pre><p id="256c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您可以关注<a class="ae jn" href="https://docs.oracle.com/en/cloud/paas/integration-cloud/oracle-integration-oci/configure-custom-endpoint-instance.html" rel="noopener ugc nofollow" target="_blank"> OCI文档</a>了解更多信息。</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lv"><img src="../Images/efb53e85607031b933423ffa3c1e4ace.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WCl7MOme-anJVewTl0eguA.png"/></div></div></figure><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lw"><img src="../Images/a5958a9a2c09229ff0537ca97cfc3873.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kLhJODGWB407cNlJlZscpA.png"/></div></div></figure><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lx"><img src="../Images/880d8946d47e7cfa169ec89b0cef297a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nmvrs6owVswerj6M3Bivhw.png"/></div></div></figure><p id="c10d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> 3。创建OCI证书</strong></p><p id="3775" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">创建一个OCI证书，导入在上一步中生成的证书，并使用该证书创建一个CA包(我们将在提供负载平衡器时使用这两个证书)。</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ly"><img src="../Images/b433b064f24e332b58b76e4731649ef9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7T9Y-y3XpVg05vHhIV8E8w.png"/></div></div></figure><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lz"><img src="../Images/cc753153c14523ca7512860e80975285.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uvH2QdPxBGxhrSzBLwjFDw.png"/></div></div></figure><p id="a09d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> 4。提供网络资源</strong></p><p id="fe6d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要实施此解决方案，我们需要提供以下网络资源:</p><ul class=""><li id="ee9b" class="kw kx hh ir b is it iw ix ja ky je kz ji la jm lb lc ld le bi translated">VCN</li><li id="45e4" class="kw kx hh ir b is lf iw lg ja lh je li ji lj jm lb lc ld le bi translated">公共子网</li><li id="8f2c" class="kw kx hh ir b is lf iw lg ja lh je li ji lj jm lb lc ld le bi translated">互联网网关</li><li id="a63c" class="kw kx hh ir b is lf iw lg ja lh je li ji lj jm lb lc ld le bi translated">NAT网关</li><li id="3fa4" class="kw kx hh ir b is lf iw lg ja lh je li ji lj jm lb lc ld le bi translated">路由表并使用以下两条规则连接到公共子网:1-将0.0.0.0/0流量路由到互联网网关2-将OIC实例的公共IP地址路由到NAT网关(如果不创建此规则，负载平衡器将无法通过互联网网关与OIC实例通信)。</li></ul><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ma"><img src="../Images/6b6b1fc65fc8595a9f08bede3a29c076.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*az6n3OorVOCPiZx4Wwo-7g.png"/></div></div></figure><ul class=""><li id="04d7" class="kw kx hh ir b is it iw ix ja ky je kz ji la jm lb lc ld le bi translated">安全列表并连接到公共子网，以接受来自公共互联网(0.0.0.0/0)的端口443上的流量，以及CIDR块0.0.0.0/0上所有协议的出口规则</li></ul><p id="2af7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> 5。提供OCI负载平衡器</strong></p><p id="1995" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">按照以下规格设置公共OCI负载平衡器:</p><ul class=""><li id="4878" class="kw kx hh ir b is it iw ix ja ky je kz ji la jm lb lc ld le bi translated">端口443上的侦听器。</li><li id="3a03" class="kw kx hh ir b is lf iw lg ja lh je li ji lj jm lb lc ld le bi translated">将OCI证书附在监听器上。</li><li id="d84a" class="kw kx hh ir b is lf iw lg ja lh je li ji lj jm lb lc ld le bi translated">为OIC自定义DNS创建主机名，并将其附加到侦听器。</li><li id="3d97" class="kw kx hh ir b is lf iw lg ja lh je li ji lj jm lb lc ld le bi translated">在端口443上为OIC公共IP地址创建后端集，并使用OCI CA捆绑包为此后端集启用SSL。</li></ul><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mb"><img src="../Images/36d545b942f3ad3db4baeb5509c8ff1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cTQwm0tOCUtqBdw9pjS1Hw.png"/></div></div></figure><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mc"><img src="../Images/db15d2ace81626112d334498afdda31d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*haq5VLFo595ffU3nquqxqA.png"/></div></div></figure><p id="b92f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> 6。供应晶圆政策</strong></p><p id="f474" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">调配WAF策略，并添加在步骤5中调配的负载平衡器作为WAF策略中的实施点。</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es md"><img src="../Images/1e86100c643fa2663c8d595ee8157353.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*95BlFAC-YuBUINDVZESsCA.png"/></div></div></figure><p id="e2b8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您可以创建自己的访问控制、保护控制等。WAF政策的规则。</p><p id="7c33" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> 7。更新DNS </strong></p><p id="6fd0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在DNS服务器中创建一个记录，将OIC自定义DNS映射到公共负载平衡器IP地址(您应该删除之前为OIC自定义DNS创建的到OIC主机名的CNAME)。</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es me"><img src="../Images/bbdbc37bac6193f92f2d03b102d88112.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4jkjS6bvaPIbu0WJ15xCsw.png"/></div></div></figure><p id="70be" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> 8。创建对OIC实例的网络访问</strong></p><p id="bfb8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在OIC实例中创建网络访问策略，以便只接受来自NAT网关公共IP地址的请求。使用此策略，用户不能再使用OIC默认URL。</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mf"><img src="../Images/c8df234cda808c3ce7a4b38e892ab7c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KHHj6RpUPO_6YBQPHwELSg.png"/></div></div></figure><p id="7720" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您可以在NAT网关详细信息中找到NAT网关公共IP地址。</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mg"><img src="../Images/5ce054e29fbdb6d854a13112e852c63e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o4qOwgzOID5QQhat3bahOA.png"/></div></div></figure><h1 id="decf" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">结论</h1><p id="0f29" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">通过本文，您使用WAF策略保护OIC实例免受攻击者的攻击。</p><p id="c66f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">加入对话！</p><p id="86c8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你对Oracle开发人员在他们的自然环境中发生的事情感到好奇，就来参加我们的公共休闲频道吧！我们不介意成为你的鱼缸🐠</p><h1 id="c8ae" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">参考</h1><p id="5a60" class="pw-post-body-paragraph ip iq hh ir b is km iu iv iw kn iy iz ja ko jc jd je kp jg jh ji kq jk jl jm ha bi translated">OIC自定义URL:<a class="ae jn" href="https://docs.oracle.com/en/cloud/paas/integration-cloud/oracle-integration-oci/configure-custom-endpoint-instance.html" rel="noopener ugc nofollow" target="_blank">https://docs . Oracle . com/en/cloud/PAAs/integration-cloud/Oracle-integration-OCI/configure-Custom-endpoint-instance . html</a></p><p id="977f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">OCI证书服务:<a class="ae jn" href="https://docs.oracle.com/en-us/iaas/Content/certificates/overview.htm" rel="noopener ugc nofollow" target="_blank">https://docs . Oracle . com/en-us/iaas/Content/certificates/overview . htm</a></p><p id="5fff" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">OCI负载均衡器:<a class="ae jn" href="https://docs.oracle.com/en-us/iaas/Content/certificates/overview.htm" rel="noopener ugc nofollow" target="_blank">https://docs . Oracle . com/en-us/iaas/Content/certificates/overview . htm</a></p><p id="aa23" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">OCI WAF:<a class="ae jn" href="https://docs.oracle.com/en-us/iaas/Content/WAF/Concepts/overview.htm" rel="noopener ugc nofollow" target="_blank">https://docs . Oracle . com/en-us/iaas/Content/WAF/Concepts/overview . htm</a></p></div></div>    
</body>
</html>