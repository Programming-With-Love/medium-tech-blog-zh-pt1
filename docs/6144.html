<html>
<head>
<title>The Case Against Kotlin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">针对科特林的案子</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/the-case-against-kotlin-2c574cb87953?source=collection_archive---------0-----------------------#2017-07-28">https://medium.com/pinterest-engineering/the-case-against-kotlin-2c574cb87953?source=collection_archive---------0-----------------------#2017-07-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="5b07" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Ryan Cooke | Android工程师，核心体验</p><p id="c360" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在你的应用中开始使用Kotlin是一个重大决定。现在，科特林可能正接近炒作周期中的“膨胀预期的顶峰”。你可以找到无数关于科特林优点的高质量的<a class="ae jc" rel="noopener" href="/@Pinterest_Engineering/kotlin-for-grumpy-java-developers-8e90875cb6ab">博客</a>、<a class="ae jc" href="http://talkingkotlin.com/kotlin-at-pinterest-with-christina-lee/" rel="noopener ugc nofollow" target="_blank">播客</a>和<a class="ae jc" href="https://www.youtube.com/watch?v=fPzxfeDJDzY" rel="noopener ugc nofollow" target="_blank">视频</a>。对于这篇文章，我们假设你理解它的好处。在这里，我们将深入探讨Android开发者在Kotlin上可能面临的挑战，并提供解决方案。采用任何新语言都要考虑实际成本，Kotlin并不适合每个团队。我们希望这篇文章对认真权衡Kotlin的成本/收益的团队有用。</p><p id="a1cb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jd">(*虽然这篇文章着眼于采用Kotlin的一些挑战，但我们在Pinterest上热情地使用Kotlin。查看我们的</em> <a class="ae jc" rel="noopener" href="/@Pinterest_Engineering/kotlin-for-grumpy-java-developers-8e90875cb6ab"> <em class="jd">有用提示</em> </a> <em class="jd">来完成从Java的过渡，并继续关注我们在Kotlin上的其他帖子。)</em></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/dc0f24f94726b16a03780fc82739caf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Hqv9H9TlhXPBiM3v."/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">Kotlin on the Hype Curve</figcaption></figure><h2 id="1b3f" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ip kf kg kh it ki kj kk ix kl km kn ko bi translated"><strong class="ak">问题:学习曲线</strong></h2><p id="69d5" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">客观地说，科特林语并不是一种流行语言。它最近才成为50种最流行的编程语言之一。如果你打算在你的代码库中使用Kotlin，你需要教会你团队中的几乎每个开发人员如何使用它。也需要维护。即使它不再流行，你也需要继续培训开发人员(他们可能对学习Kotlin不感兴趣)。</p><p id="8fc9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以说一下学习曲线。您将失去一些开发人员的学习速度，并且您的入职过程可能会变慢。我们发现，对于一个Java开发人员来说，通常需要大约一周的时间在Kotlin中积极工作才能感到舒适。开发人员需要很好地学习Kotlin，以便自信地阅读这种语言。虽然一些开发人员会自学，但是团队仍然需要为每个人留出培训时间来提高速度。新开发人员需要学习Kotlin，一次性的培训是不够的。此外，受过培训但很少接触Kotlin的当前开发人员，如果他们转到需要Kotlin的代码部分，可能需要复习。这意味着入职速度较慢，您可能会损失一些速度。</p><p id="1bd7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">重要的是要明白，最初的一周都是为了适应Kotlin，仍然会有很多学习要做。即使是最有经验的Kotlin开发人员仍然在学习一些技巧和方法来做得更好，这是整个团队都需要学习的。如果您的团队没有Kotlin专家，那么您需要认识到，对于确定最佳实践，没有与<a class="ae jc" href="https://www.amazon.com/Effective-Java-2nd-Joshua-Bloch/dp/0321356683" rel="noopener ugc nofollow" target="_blank"> <em class="jd">有效的Java </em> </a> <em class="jd"> </em>等同的标准。如果您决定自己打造最佳实践，这可能会非常耗时且棘手，但对于解决类似问题来说，有必要采用一致的方法。</p><h2 id="4a73" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ip kf kg kh it ki kj kk ix kl km kn ko bi translated"><strong class="ak">解决方案:学习曲线</strong></h2><p id="6391" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">第一个解决办法就是保持警惕。将Kotlin添加到您的代码库是在赌Kotlin的长寿和持续增长。如果这个赌注是正确的，那么维护代码和学习通常会变得不那么具有挑战性。如果赌错了，那么科特林将是科技债。谷歌的官方支持是Kotlin继续存在的有力证据，但这种支持不会永远持续下去。</p><p id="998a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有很多学习Kotlin的资源，比如Koans和伟大的书籍。我们发现最有效的是一个Kotlin倡导者，指导和鼓励他们的直属团队。</p><p id="b1f3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">开发者速度对我来说是Kotlin最初的卖点。当我意识到很少有开发人员真正看到开发速度的提高时，我有一种“这有什么意义”的感觉。我预计当团队需要Kotlin经验并拥有专门的Kotlin专家时，以及当稳定性不再是一个问题时，开发人员的速度将会提高。但是我们还没有到那一步。</p><h2 id="2753" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ip kf kg kh it ki kj kk ix kl km kn ko bi translated"><strong class="ak">问题:构建时间</strong></h2><p id="810e" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">科特林会让你的建造时间变得更糟。我们有相当可观的渐进构建时间，增量构建时间略多于30秒，干净构建时间大约为75秒。Kotlin占了我们干净构建时间的25%和增量构建时间的40%。</p><h2 id="73bd" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ip kf kg kh it ki kj kk ix kl km kn ko bi translated"><strong class="ak">解决方案:构建时间</strong></h2><p id="4866" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">处理好它。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ku"><img src="../Images/a5fc5dd1e9044d99a7a02602d2b3eaeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:730/0*p8mhVdHuUL03Tdzz."/></div></figure><p id="0ddf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">更有用的是，我们测试了一个辅助项目的构建时间，比较了Kotlin前后的构建时间。我们发现大部分构建时间损失来自于转换一个Kotlin文件。对于干净的构建，随着我们将更多的文件转换到Kotlin，我们继续看到构建变慢(但是额外的减速不是很大)。</p><p id="28bb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">好消息是，除了最初添加的Kotlin之外，无论转换了多少文件，增量和无更改构建时间都保持不变。通过转换一个文件，您可以很好地了解构建时间。我们使用<a class="ae jc" href="https://github.com/gradle/gradle-profiler" rel="noopener ugc nofollow" target="_blank"> Gradle-Profiler </a>进行分析，这为我们提供了准确、客观的构建时间预测。</p><h2 id="df5d" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ip kf kg kh it ki kj kk ix kl km kn ko bi translated"><strong class="ak">问题:开发稳定性</strong></h2><p id="a65d" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">在我们的团队中，不喜欢Kotlin的人不喜欢它，不是因为lambdas让他们害怕，或者因为他们宁愿等着看应用程序是否崩溃，以找出正确的空处理，甚至是因为<code class="du kv kw kx ky b">var</code>和<code class="du kv kw kx ky b">val</code>看起来相似。非Kotlin开发人员不喜欢它的最简单的原因是当有一个问题阻止他们写代码和生产时。</p><p id="0fd8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这种情况在我们身上发生过很多次，也很容易发生在你身上。例如，我们遇到了增量构建对一些开发人员不起作用的问题。我们遇到过其他问题，比如改变分支总是需要一个干净的构建。我们有构建随机失败的情况，因为<code class="du kv kw kx ky b">kapt</code> (Kotlin注释处理器工具)有时会出现内存不足的错误。此外，Kotlin不能很好地与<a class="ae jc" href="https://developer.android.com/studio/preview/kotlin-issues.html" rel="noopener ugc nofollow" target="_blank">即时应用</a>配合，我们已经看到当Kotlin插件启用时Android Studio崩溃的增加。发展方面，就在你觉得一切都稳定的时候，另一个问题就可能冒出来了。</p><p id="f82e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因为Kotlin和<code class="du kv kw kx ky b">kapt</code>是大多数开发人员不熟悉的工具，这可能会导致大量时间浪费在转移注意力上，而这实际上并不是Kotlin的错。例如，我们会看到一个问题，比如开发人员遗漏了一个导入语句，构建失败，显示出许多<code class="du kv kw kx ky b">kapt</code>错误。由于不熟悉Kotlin，开发人员立即认为是Kotlin导致了这个问题，并浪费时间去研究什么是简单的修复。这种“怪异”加上实际的稳定性问题意味着损失了大量的维护时间。</p><h2 id="d351" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ip kf kg kh it ki kj kk ix kl km kn ko bi translated"><strong class="ak">解决方案:开发稳定性</strong></h2><p id="0c4c" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">最好的解决办法是把一切稳定下来，然后谨慎升级。Kotlin、Gradle、Android Studio和其他一切都将达到一种状态，它们可以很好地协同工作，但这通常需要几个版本。如果你想使用最新的Android Studio或类似的东西，这是很困难的。如果你决定积极地升级，你可以对你遇到的问题提出错误，团队会非常积极地解决任何问题。如果你不想处理bug，那就耐心升级，坚持稳定的版本。</p><h2 id="6311" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ip kf kg kh it ki kj kk ix kl km kn ko bi translated"><strong class="ak">问题:静态分析</strong></h2><p id="32c6" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">Java是一种成熟的语言，有许多很棒的静态分析工具，可以提醒您注意问题。这意味着人类评审者不需要检查代码是否遵循规则和约定。现有的工具如FindBugs、PMD、易错、检查样式和Lint都很棒。开发人员通常希望避免做导致问题的事情，但是我们意识到期望每个人都记住每件事，告诉新员工并检查每个代码审查中的这些小问题是不可持续的。毕竟，我们不是机器，这就是为什么我们给机器规则，如果我们错过了最佳实践或陷入困境，我们的构建就会失败。没有静态分析工具，开发人员犯错误的空间会更大。</p><h2 id="851f" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ip kf kg kh it ki kj kk ix kl km kn ko bi translated"><strong class="ak">解决方案:静态分析</strong></h2><p id="d8b2" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">这是一个观望的问题。我的理解是Lint规则和检查应该在Android Studio 3.0上的Kotlin中工作。例如，我们最近在Canary Android Studio版本中测试了“移除所有未使用的资源”检查，该检查移除了Kotlin正在使用的资源，所以工具还没有完全到位。如果你是一个真正的英雄，你可以加入这项事业，开始研究你自己的静态分析器或兼容性方法。</p><p id="d164" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了(在某种程度上)平衡静态分析的缺乏，像空处理这样的主要Kotlin特性减少了代码审查人员和开发人员需要考虑的潜在问题。</p><h2 id="fcd8" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ip kf kg kh it ki kj kk ix kl km kn ko bi translated"><strong class="ak">问题:可逆性</strong></h2><p id="8e5f" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">可逆性是一种轻松撤销改变或决定的能力。科特林是不可逆的。虽然将Java文件转换成Kotlin很容易，但是将Kotlin转换成Java的最佳方法是查看Kotlin字节码，进行反编译，然后修复异常。您也可以简单地重写该文件。反编译不会产生符合团队代码质量标准的代码。如果是的话，你可能要重新评估你的命名期望。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kz"><img src="../Images/a1261219c0f5a6973ae7377f74e8f5d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IeeXBS5mwiHQNGuF."/></div></div><figcaption class="jq jr et er es js jt bd b be z dx">Decompiled data class. Not production quality Java.</figcaption></figure><p id="8730" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们看一个可能发生的例子。假设你有五个工程师想要学习和评估Kotlin，每个人转换五个文件，然后再添加五个文件。现在有50个Kotlin文件，甚至在你决定这种语言适合你之前。如果您决定不使用Kotlin，您将花费大量时间繁琐地将文件转换回来，尤其是如果转换后的文件变化太大，版本控制变得无用。如果您使用Anko或另一个类似的Kotlin库，甚至是更高级的Kotlin功能，这又是一层复杂的回归。</p><p id="8d27" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">沿着这条路，如果Kotlin开始引起一个问题，你将不得不解决这个问题，不管它有多困难或阻碍发展。从代码库中删除Kotlin不是一个选项。</p><h2 id="aa4a" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ip kf kg kh it ki kj kk ix kl km kn ko bi translated"><strong class="ak">解决方案:可逆性</strong></h2><p id="1e59" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">评估Kotlin时，可逆性是必须牢记在心的。这很容易添加，但你应该确保你没有使用Kotlin只是因为它太难删除。当评估一项新技术时，更改相当简单/可重写的代码，例如测试代码，总是一个好的起点。如果您开始转换应用程序文件，转换井单元测试文件。单元测试会让你有信心对文件进行重大修改，同时仍然知道你没有破坏任何东西。它们也使得改回Java变得更加容易。除此之外，要意识到撤销决定有多困难。</p><h2 id="75b0" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ip kf kg kh it ki kj kk ix kl km kn ko bi translated"><strong class="ak">结论</strong></h2><p id="cada" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">学习曲线、构建时间、开发稳定性和静态分析都会变得更好。谷歌正式支持这种语言，这是情况将迅速好转的迹象。如果你想等到他们更好，这并不疯狂。将Kotlin添加到您的代码库永远不会太晚，但删除它可能会太晚。</p><p id="8a4f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们在Pinterest上使用Kotlin，但我们这样做是因为我们知道并经历了这种语言的成长之痛。这篇文章有目的地关注你应该考虑的风险，但是这些问题中的许多将会随着时间的推移变得不那么沉重。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es la"><img src="../Images/c2e708437034ef3a06c845ca00e483ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:290/format:webp/1*VS-SIyipZqIIfQYxAvva3A.png"/></div></figure><p id="98e1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请分享我们可能忽略的注意事项，或在评论中提出反驳。如果你想了解更多关于Kotlin的信息，请给我们发邮件！如果你在三藩市，我们会定期在我们的办公室举办<a class="ae jc" href="https://www.eventbrite.com/e/android-knit-tickets-36444264777" rel="noopener ugc nofollow" target="_blank"> Android编织午餐</a>，在那里城市里的团队谈论Android。我们很乐意招待你！</p><p id="414d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">还有，我们正在<a class="ae jc" href="https://careers.pinterest.com/careers/details/android-engineer_san-francisco_3879" rel="noopener ugc nofollow" target="_blank">招聘</a>！</p></div></div>    
</body>
</html>