# 鲁比，RVM 和邦德勒揭秘

> 原文：<https://medium.com/capital-one-tech/ruby-rvm-and-bundler-demystified-9f3f946230f1?source=collection_archive---------4----------------------->

## RVM 和邦德勒如何改进 Ruby 工程

![](img/dac98aa7fe92ab0806200d4870eeb251.png)

开发 Ruby 应用程序可能很简单，但是当您开始处理需要多种语言版本/不同依赖项的多个项目时，这很快就会变得非常复杂。作为一名 Ruby 工程师，一次只开发一个应用程序，或者完全独立完成一个项目是不现实的。确保在跨机器和开发人员的一致环境中开发应用程序成为成功的必要条件。此外，这里描述的环境一致性、语言版本和依赖性管理模式也适用于其他语言，只是使用了不同的工具。

无论您是在本地、在云中还是在容器中工作，在实现一致性之前，都需要理解 Ruby 开发环境的活动部分。这篇文章介绍了一些使一致、灵活的 Ruby 开发成为可能的概念。

# 与鲁比、RVM 和邦德勒一起步入正轨

![](img/c910305ae95aae71186927c82ae2edc2.png)

为了更好地理解 Ruby 开发环境，可以把 Ruby 应用程序想象成一辆火车机车。像任何火车机车一样，它需要可以行驶的轨道(Ruby 运行时)，某种形式的能量位(Ruby gems，应用程序依赖)，当然，还有一个工程师(你)！

一切都很容易开始。火车可以在预先铺设的轨道上运行(默认系统 Ruby 运行时),这些轨道可以从类似第三轨道的东西向火车提供能量位(通过在遇到任何应用依赖时安装它们，例如“sudo gem install foo”)。

![](img/f2afab2e0e1e0dce28617d84230eb0b9.png)

现在，让我们向系统添加一个额外的列车。这似乎很容易，我们可以让它沿着和我们第一辆火车相同的轨道运行，从而使用相同的能源。但是，当这列新火车需要在比第一列火车更新或更旧的轨道(不同的 Ruby 版本)上运行时，会发生什么呢？

如果您试图改造一辆旧火车以适应新的轨道，或者如果最新的轨道比旧轨道工作得更好或具有更好的功能，就会发生这种情况。有时一个新的能量位甚至可能需要新的轨道！此外，能量位也被绑定到这些不同的轨道上。

进入 [RVM](http://rvm.io) ，ruby 版本管理器。这个漂亮的命令行实用程序允许工程师在设计每列火车时通过简单地切换轨道来使用多条轨道。现在火车可以安全地行驶在合适的轨道上。但是能源呢？如果这种新列车需要不同的能量位，或者更糟糕的是，类似但不完全相同的位(不同的应用依赖版本)，会发生什么？RVM 提供了一个[【宝石组】](http://rvm.io/gemsets)的概念，允许工程师切换或共享第三根铁轨。RVM 使得移除轨道变得容易，并且可以保持所有轨道彼此之间或者与预先安装的系统轨道之间的安全。

![](img/2abd13e144c664036df35753d3164270.png)

所以这太棒了！工程师(您)现在可以使用每个轨道的第三轨道(默认 gemset)或备用第三轨道(gemset)提供的能源，在不同的轨道(Ruby 版本)上驱动两个或多个列车(应用程序)。所有这些都没有火车相撞或污染彼此的能源(例如“rvm 使用 2.4.1@newtracks”)。

然而，能量位已经通过“宝石安装”一次一个地添加到每个第三轨道，因为每个列车都需要它。当遇到依赖项时，手动安装依赖项会使试验新的能源位、测试不同的轨道或招募额外的工程师变得繁琐和困难。机车还可能无意中损坏共享轨道或第三轨，导致其他机车无法运行！那么，如何才能让列车在异地可靠运行呢？我们如何确保能源需求易于沟通？要是有一种方法可以宣布每列火车需要多少能量比特就好了…

![](img/ea64f7da4d6761928e2228d221ba5222.png)

进入[捆扎机](https://bundler.io)，为列车的机车储能。Bundler 安装并跟踪应用程序所需的确切应用程序依赖项和版本。通过 Bundler，列车本身使用清单文件(Gemfile)声明其特定的能量要求。工程师可以使用清单文件来确保火车在任何轨道上平稳运行，并且能量位是从火车本身而不是从轨道传递的。这种能源车还确保只有*这列*的能源位可供*这列*使用。

现在我们已经安全到达车站了。火车在正确的轨道上运行，使用隔离和正确声明的能量位，使升级、废弃、创新和与其他工程师交流变得更简单！一旦完成了跟踪，只需一个命令就可以完全删除它们。这里介绍的工具有一些替代方案和额外的优势，请在后面的附录中找到这些详细信息。

有希望的是，Ruby 环境的活动部分现在已经被理解了，允许以灵活和一致的方式进行应用程序开发。将这里描述的环境一致性、语言版本和依赖性管理模式也应用到任何新语言的开发中！

![](img/10746b62bf842c41794df4f434e9dd2e.png)

## 附录 A: Ruby 管理工具备选方案

除了 RVM，还有其他的选择(例如, [rbenv](https://github.com/rbenv/rbenv) 和 [chruby](https://github.com/postmodern/chruby) )，这取决于个人开发者或团队。每种方法都有优点和缺点，但它们都试图解决同一个基本挑战。

## 附录 B:额外的 Ruby 管理工具优势

Ruby 管理器还提供了其他一些优势:

*   Ruby 运行时和 gems 安装在“用户空间”中，不需要“sudo”来安装 gems。
*   让系统 Ruby 处于原始状态(当与规程一起使用时)。
*   一些可以被配置成基本上不可见和自动的(附录 E)。

## 附录 C:附加捆绑优势

Bundler 还提供了一些额外的意外收获。

*   更好的运行时性能。Bundler 只向您的应用程序公开指定的 gem，而不管安装了多少 gem，从而允许更快的文件系统扫描和 gem 加载。
*   Gemfile.lock 文件确保您测试的内容与使用“捆绑安装”的其他系统的内容一致。这需要一个有意识的“捆绑包更新”,并致力于寻找和使用所需 gem 的新版本。
*   您可以使用 Bundler 在您的机车内输送能量，或使用它来加强外部提供的能源的管理。

## 附录 D:关于 RVM &邦德勒的更多信息

*   安装 http://rvm.io/rvm/install[RVM](http://rvm.io/rvm/install)
*   捆绑器安装为宝石`宝石安装捆绑器';或者使用 RVM 配置使其自动发生。
*   [更多细节](http://engineering.appfolio.com/appfolio-engineering/2017/2/27/ruby-rubygems-and-bundler)

## 附录 E:配置 RVM 的不可见性

*   将 [rvm 指令添加到您的项目](http://rvm.io/workflow/projects)——使用 Gemfile 注释方法将所有东西放在一起。
*   创建一个。用户主目录中的 rvmrc 配置文件:

```
rvm_install_on_use_flag=1 # Install a missing Ruby version when accessed rvm_project_rvmrc_default=1 # Use files in the project to determine ruby version and gemsetrvm_autoinstall_bundler_flag=1 # Install bundler automatically in each ruby/gemsetrvm_gemset_create_on_use_flag=1 # Create missing gemsets when accessed
```

*声明:以上观点仅代表作者个人观点。除非本帖中另有说明，否则 Capital One 不属于所提及的任何公司，也不被其认可。使用或展示的所有商标和其他知识产权都是其各自所有者的所有权。本文为 2018 首都一。*