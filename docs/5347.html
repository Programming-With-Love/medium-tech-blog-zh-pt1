<html>
<head>
<title>Sizing your Event Hub (Apache Kafka) Cluster on Oracle Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Oracle云上调整您的活动中心(Apache Kafka)集群</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/sizingeventhubcluster-dbb639e42094?source=collection_archive---------0-----------------------#2017-11-17">https://medium.com/oracledevs/sizingeventhubcluster-dbb639e42094?source=collection_archive---------0-----------------------#2017-11-17</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/821da8d28bc383eee91937fb393e18c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jyd7n2LPYgxPG3qV-xafEg.png"/></div></div></figure><p id="63d2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这篇博文的目的是提供一个关于如何在Oracle Cloud上调整您的Event Hub云服务集群的高级指南。选择确切的集群大小和配置会因您的用例和需求而有很大差异，因此关于此主题的帖子(一语双关)只能旨在提供决策过程的大致方向。</p><p id="4ceb" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">本文从两个方面解释了集群的规模:</p><ul class=""><li id="9b3b" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm js jt ju jv bi translated">针对吞吐量调整规模</li><li id="f0c9" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">存储规模</li></ul></div><div class="ab cl kb kc go kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="ha hb hc hd he"><h1 id="09de" class="ki kj hh bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated"><strong class="ak">确定吞吐量</strong></h1><blockquote class="lg lh li"><p id="fe48" class="ip iq lj ir b is it iu iv iw ix iy iz lk jb jc jd ll jf jg jh lm jj jk jl jm ha bi translated">生产者/消费者吞吐量</p></blockquote><p id="ae7f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在尝试确定事件中心集群的规模之前，要问的问题是生产者和消费者的预期吞吐量是多少。您的系统吞吐量将与您最薄弱的环节一样快。</p><p id="f182" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">生产者的生产速度是多少？，生成的消息的大小是多少？在给定消息大小的情况下，有多少消费者会从主题/分区中消费，他们能够以什么样的速度处理每条消息。</p><blockquote class="lg lh li"><p id="9d4b" class="ip iq lj ir b is it iu iv iw ix iy iz lk jb jc jd ll jf jg jh lm jj jk jl jm ha bi translated">经纪人(和动物园管理员)的数量</p></blockquote><p id="39ee" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">增加代理数量和跨代理配置复制是一种机制，不仅可以实现并行性和更高的吞吐量，还可以实现高可用性。在Event Hub上运行开发和测试时，HA可能不是一个因素，在这种情况下，可能不需要部署多个代理。但是，强烈建议部署多个代理(3+)。</p><p id="f371" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">ZooKeeper在代理集群管理中起着至关重要的作用——跟踪哪些代理正在离开集群，哪些新代理正在加入，领导者选举和配置管理。这使得有必要确保Zookeeper也部署在HA集群中。</p><p id="37b3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">调整Zookeeper集群大小的建议是使用1个实例用于开发/测试环境，3个实例用于计划1个节点故障，5个实例用于计划2个节点故障。</p><blockquote class="lg lh li"><p id="267b" class="ip iq lj ir b is it iu iv iw ix iy iz lk jb jc jd ll jf jg jh lm jj jk jl jm ha bi translated">您的经纪人的CPU形状</p></blockquote><p id="79ea" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在撰写本文时，Oracle Cloud for EventHub Cloud Service for CPU Shapes上的可用选项有:</p><p id="b40c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">OC1m — 1个OCPU，15 GB内存</p><p id="3a18" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">OC2m — 2个OCPU，30 GB内存</p><p id="ba2b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">OC3m — 4个OCPU，60GB内存</p><p id="65fd" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">OC4m — 8个OCPU，120 GB内存</p><p id="78d9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">OCPU提供的CPU容量相当于启用超线程技术的英特尔至强处理器的一个物理内核。每个OCPU对应两个硬件执行线程，称为vcpu。</p><p id="8289" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这是一个基准吞吐量示例:</p><figure class="lo lp lq lr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ln"><img src="../Images/ff99a593693df90b571242f154adf230.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rf4oxd0ava2ZWqfg-pyc-w.jpeg"/></div></div></figure><p id="89b9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> <em class="lj">配置</em> </strong>:</p><ul class=""><li id="005c" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm js jt ju jv bi translated">生产者/消费者:10/10</li><li id="0e4d" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">主题:10</li><li id="0860" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">分区:每个主题10个，</li><li id="dc52" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">复制因子:3</li><li id="08bc" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">代理节点:5 (OC3m)</li><li id="b95e" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">动物园管理员:3人(OC1m)</li><li id="2cc2" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">无压缩</li><li id="3e6c" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">acks = 1</li></ul><p id="1b6c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">注意:这个吞吐量是通过Kafka本地API实现的。已知REST API吞吐量要小得多，大约是原生Kafka API吞吐量的1/4。该测试在Oracle云中的虚拟机中由生产者和消费者运行，虚拟机之间的延迟最小。</p><blockquote class="lg lh li"><p id="9599" class="ip iq lj ir b is it iu iv iw ix iy iz lk jb jc jd ll jf jg jh lm jj jk jl jm ha bi translated">主题和分区的规模</p></blockquote><p id="06ee" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">选择#分区的决定取决于期望的吞吐量和您的生产者/消费者生态系统可以支持的并行度。一般来说，增加给定主题的分区数量会线性增加吞吐量——然而，吞吐量瓶颈最终可能是生产者的生产速度或消费者的消费速度。</p><p id="ae91" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Kafka用户使用并在一些Kafka博客中发表的简单数学如下:</p><p id="190d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">假设期望的吞吐量是“t”。最大生产者吞吐量是“p”，最大消费者吞吐量是“c”。</p><p id="cd61" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">分区数量=最大值(t/p，t/c)。</p><p id="aa13" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">经常使用的一个经验法则是至少拥有与最大消费者组中的消费者数量一样多的分区。</p></div><div class="ab cl kb kc go kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="ha hb hc hd he"><h1 id="5efd" class="ki kj hh bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated"><strong class="ak">存储规模</strong></h1><p id="edd9" class="pw-post-body-paragraph ip iq hh ir b is ls iu iv iw lt iy iz ja lu jc jd je lv jg jh ji lw jk jl jm ha bi translated">在代理上调整存储规模时要考虑的因素:</p><ol class=""><li id="36ae" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm lx jt ju jv bi translated">主题数量，每个主题的分区数量</li><li id="d76c" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm lx jt ju jv bi translated">期望复制因子</li><li id="adb5" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm lx jt ju jv bi translated">邮件大小</li><li id="5114" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm lx jt ju jv bi translated">保存期</li><li id="6435" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm lx jt ju jv bi translated">预期从事件中心代理发布和使用消息的速率</li></ol><p id="bb1d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">根据上述因素，您可以粗略计算出Event Hub集群上每个代理所需的存储容量。</p></div><div class="ab cl kb kc go kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="ha hb hc hd he"><h1 id="3b51" class="ki kj hh bd kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf bi translated">摘要</h1><p id="0eda" class="pw-post-body-paragraph ip iq hh ir b is ls iu iv iw lt iy iz ja lu jc jd je lv jg jh ji lw jk jl jm ha bi translated"><strong class="ir hi">总之，上面的帖子提供了一个粗略的指导方针，告诉人们应该如何确定他们的活动中心集群的规模。</strong></p><p id="4d8a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">通过设置警报阈值来监控集群的CPU、内存和存储，可以帮助您从小规模开始，并随着时间的推移了解集群的性能和趋势。当您的系统准备好增长时，可以根据您的需求对您的集群进行微调。托管扩展是事件中心云服务(托管Kafka)将提供的价值的一部分。</strong></p></div></div>    
</body>
</html>