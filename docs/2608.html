<html>
<head>
<title>Event-Driven with PubSub and Golang</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过PubSub和Golang实现事件驱动</h1>
<blockquote>原文：<a href="https://medium.easyread.co/event-driven-with-pubsub-and-golang-3924a4bba8a9?source=collection_archive---------0-----------------------#2022-03-24">https://medium.easyread.co/event-driven-with-pubsub-and-golang-3924a4bba8a9?source=collection_archive---------0-----------------------#2022-03-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/8ae27e579c670e8a21d7933a934c1cb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fJWpuE2Wed8RnLE1HYmMAw.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://www.pexels.com/photo/information-sign-on-paper-317356/" rel="noopener ugc nofollow" target="_blank">pexels</a></figcaption></figure><h1 id="df4f" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">介绍</h1><p id="5b78" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">大家好！还是跟我分享一些与软件工程领域技术相关的经验、想法或者看法吧。在这篇文章中，我想分享如何用Pubsub和Golang 创建一个<strong class="la io">事件驱动的！</strong></p><p id="001b" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">但是…事件驱动的定义是什么？</p><p id="1437" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">基本上，与API驱动的请求同步实时运行不同，事件驱动将基于事件异步运行，并且在请求中会有延迟。还在迷茫？让我们在<strong class="la io">用例</strong>部分举个例子。</p><blockquote class="mb mc md"><p id="8af9" class="ky kz me la b lb lw ld le lf lx lh li mf ly ll lm mg lz lp lq mh ma lt lu lv ig bi translated">对于细节，也许<a class="ae jz" href="https://en.wikipedia.org/wiki/Event-driven_architecture" rel="noopener ugc nofollow" target="_blank">维基百科</a>的事件驱动架构定义可以给出更多的上下文。</p></blockquote><h1 id="ae93" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">用例</h1><p id="09d1" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">在第一种情况下，我们来谈谈API驱动的架构。例如，我们有一个应用程序，它需要调用一个API。API需要在多个服务上发送一个请求。该数据流将同步运行，这意味着响应时间将根据每个服务的响应时间累计。</p><p id="c0a5" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">优点是我们可以轻松地进行跟踪，数据流清晰，响应会实时返回。但是，使用这种体系结构，响应时间可能不会很快(取决于每个服务)。此外，还存在难以扩展的可能性，例如添加新服务，并且可能会影响服务之间的当前关系。</p><p id="014e" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">下面的数据流将有助于理解API驱动的工作原理:</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mi"><img src="../Images/407176d781afceb2956c6b5e77b8972f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iMyxbMhGZ0QXsuh7Is9RAA.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">API-Driven Architecture Data-Flow</figcaption></figure><p id="8fc1" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">接下来，用事件驱动架构，API和服务之间会有一个事件的区别。API将发布一个事件，每个服务将从事件中获取数据，这可以异步运行。</p><p id="d827" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">优点将与API驱动架构的缺点相反，例如响应时间可以更快、更容易地添加新服务，而不会破坏其他服务。然而，使用这种体系结构，数据流可能不清楚，并且请求可能会有延迟。</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mn"><img src="../Images/fd68d6ff4e2ecf3f9ee9e58c3af279fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PtYsPSoaoPOGcSu66bcdRQ.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Event-Driven Architecture Data-Flow</figcaption></figure><h1 id="ca1d" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">PubSub模型</h1><p id="4421" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">因为我们将在这个例子中使用PubSub，所以最好看一下PubSub架构设计。从<a class="ae jz" href="https://cloud.google.com/solutions/event-driven-architecture-pubsub" rel="noopener ugc nofollow" target="_blank">官方文档</a>关于事件驱动架构的发布/订阅，这里是架构图，也描述了消息队列模型和发布/订阅模型之间的区别:</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/a2a7c693aa5de1aa53ad5e003cd27c1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/format:webp/1*2B9qelBXejoChhvK0zQQbg.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Event-driven architecture with Pub/Sub by Official Documentation</figcaption></figure><blockquote class="mb mc md"><p id="3b7c" class="ky kz me la b lb lw ld le lf lx lh li mf ly ll lm mg lz lp lq mh ma lt lu lv ig bi translated">在上图中，消息队列模型与发布/订阅事件流模型进行了比较。在消息队列模型中，发布者将消息推送到一个队列中，每个订阅者都可以在该队列中监听特定的队列。在使用发布/订阅的事件流模型中，发布者将消息推送到多个订阅者可以收听的主题。这些模型之间的差异将在以下章节中介绍。</p></blockquote><h1 id="a472" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">配置服务帐户</h1><p id="ecfe" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">在实现代码之前，我们需要做一些配置，比如生成服务帐户，在GCP控制台中创建PubSub主题+订阅者。</p><ol class=""><li id="b955" class="mp mq in la b lb lw lf lx lj mr ln ms lr mt lv mu mv mw mx bi translated">从IAM &amp; Admin菜单转到服务帐户。</li></ol><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi my"><img src="../Images/4640136df77327c6b291bb54211de8de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wcC91EJC4pl5Nlnd-dcCMg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Go to the Service Accounts submenu</figcaption></figure><p id="d3ab" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">2.创建新的服务帐户。</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mz"><img src="../Images/7e8425ddc350963974e12aa10d6f1710.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iImkn4gmFpxGbpEXp6VwFQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Create a new Service Account</figcaption></figure><p id="b0e5" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">3.填写服务帐户名称，修改服务帐户ID(如果需要)，然后继续下一步。</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/61188c6876ee39d30cfe2037333b1cfe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GKMVWoJ8VgH4in-O2yyHrA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Service Account Name &amp; ID</figcaption></figure><p id="f355" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">4.因为我们将只使用PubSub服务，所以该角色也只用于访问PubSub。然后点击继续进入下一步，完成设置。</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/311be8d09475810ce9fd1512b27a1890.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Zq7d76cCwg8Su4E-bJ1OA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Grant Roles to Service Account</figcaption></figure><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nc"><img src="../Images/92f58e80e79893a2d263c479493c7fa2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P_6L1vb3HSKkZgMV_eMlpA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Go to the next step</figcaption></figure><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nb"><img src="../Images/7bf15228ee9cc4afc635193d5fccbdb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q_O9wQnslKvl_5Ql0KxDiw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Finish the setup</figcaption></figure><p id="42d0" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">5.下一步是导出私钥。从操作(省略号)菜单转到管理密钥。</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/690fcf8bc0190a360ca3aac3379831f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zdGixzY19mxNBTiA11JMjw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Manage Keys</figcaption></figure><p id="f222" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">6.创建一个JSON类型的新键，下载它。将密钥保存在安全的地方。</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nd"><img src="../Images/99602283364bc18ca696cd45ec980ddf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f0X-MPfIT9G87uJ5sSY2QA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Create a new Private Key</figcaption></figure><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/b3db54abede8e26fbd8364f6db7385fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1DQXav-BIh-cQFtjf7fULw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Create Private Key JSON</figcaption></figure><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mz"><img src="../Images/8c22bd5754aefb2a2434bdd0c3f469f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yF7qT972VuVE1UotTmYWIw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Private Key Downloaded</figcaption></figure><h1 id="79ba" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">配置发布订阅</h1><p id="9c4b" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">完成服务操作后，下一个配置是PubSub配置。</p><ol class=""><li id="f931" class="mp mq in la b lb lw lf lx lj mr ln ms lr mt lv mu mv mw mx bi translated">转到发布/订阅菜单下的主题子菜单。</li></ol><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ne"><img src="../Images/410b0240f694a59e610f1a9b70f4200a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PlyFYgTBGHNwNaIcIWCK6A.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Go to Topics submenu</figcaption></figure><p id="43ae" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">2.创建一个新的主题ID，我们给它一个简单的名字，比如<code class="fe nf ng nh ni b">medium</code>。创建主题ID后，将自动创建名为<code class="fe nf ng nh ni b">medium-sub</code>的订阅ID。</p><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi na"><img src="../Images/4e72557066d682ac6d6a79a53f91da7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8pcJinESTRrGbFY2WSbcaA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Create a new Topic ID</figcaption></figure><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nj"><img src="../Images/a24f7c935f2959d65cc4aa739e628d1f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tZTVulSDShBHrT-4BRkbJw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Subscription ID automatically created</figcaption></figure><h1 id="d967" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">代码实现</h1><p id="0c9d" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">配置完服务帐户和Pubsub topic+subscriber之后，就该编码了！</p><p id="072a" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">完整的代码可以在我的知识库中找到:</p><div class="nk nl gp gr nm nn"><a href="https://github.com/moemoe89/go-pubsub" rel="noopener  ugc nofollow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd io gy z fp ns fr fs nt fu fw im bi translated">GitHub - moemoe89/go-pubsub:我的媒体文章的存储库</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">这个存储库是为我写的关于PubSub和Golang消息传递的文章准备的。替换(service_account.json)[…</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">github.com</p></div></div><div class="nw l"><div class="nx l ny nz oa nw ob jt nn"/></div></div></a></div><p id="3560" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">基本上，publisher的代码是从官方文档中复制过来的<a class="ae jz" href="https://cloud.google.com/pubsub/docs/publisher#go_1" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/pubsub/docs/publisher#go_1</a></p><p id="80e0" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">在对HTTP服务器做了一些修改后，发布者的最终代码将如下所示:</p><figure class="mj mk ml mm gt jo"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="d3e8" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">发布者代码的重要部分是</p><pre class="mj mk ml mm gt oe ni of og aw oh bi"><span id="9dee" class="oi kb in ni b gy oj ok l ol om">pubsub.NewClient(ctx, projectID)</span></pre><p id="e221" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">和</p><pre class="mj mk ml mm gt oe ni of og aw oh bi"><span id="86e5" class="oi kb in ni b gy oj ok l ol om">t.Publish(ctx, &amp;pubsub.Message{<br/>...</span><span id="263e" class="oi kb in ni b gy on ok l ol om">})</span></pre><p id="449a" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">这两个代码都将打开到PubSub的客户端连接并发布消息。</p><p id="2842" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">发布者的代码也从官方文档中复制了这个链接<a class="ae jz" href="https://cloud.google.com/pubsub/docs/pull#go" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/pubsub/docs/pull#go</a></p><p id="9e76" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">实时订阅的最终代码如下:</p><figure class="mj mk ml mm gt jo"><div class="bz fp l di"><div class="oc od l"/></div></figure><p id="dab3" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">对于订阅者来说，重要的代码是相同的，首先是获取到PubSub的客户端连接:</p><pre class="mj mk ml mm gt oe ni of og aw oh bi"><span id="f97e" class="oi kb in ni b gy oj ok l ol om">pubsub.NewClient(ctx, projectID)</span></pre><p id="c98d" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">并且用于接收消息和进行Ack动作。Act action表示对于该订户，消息将被确认，而不会重新传递。</p><pre class="mj mk ml mm gt oe ni of og aw oh bi"><span id="2ed5" class="oi kb in ni b gy oj ok l ol om">sub.Receive(ctx, <strong class="ni io">func</strong>(_ context.Context, msg *pubsub.Message) {<br/>...</span><span id="c74d" class="oi kb in ni b gy on ok l ol om">msg.Ack()<br/>})</span></pre><h1 id="ed2c" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">测试</h1><p id="8ac2" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">接下来是测试部分，我们将运行发布者和订阅者，然后发布一条新消息，以检查消息是否被成功接收。</p><p id="ebde" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">参考我的资源库，复制并粘贴服务账户的私钥到项目的根目录，重命名为<code class="fe nf ng nh ni b">service_account.json</code></p><p id="42b1" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">然后配置存储密钥路径的环境变量:</p><pre class="mj mk ml mm gt oe ni of og aw oh bi"><span id="8f3c" class="oi kb in ni b gy oj ok l ol om">export GOOGLE_APPLICATION_CREDENTIALS=/path/service_account.json</span></pre><p id="05e2" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">使用以下命令运行发布者和使用者:</p><pre class="mj mk ml mm gt oe ni of og aw oh bi"><span id="3dc9" class="oi kb in ni b gy oj ok l ol om">go run ./cmd/publisher/main.go<br/>2022/03/24 11:50:09 server is starting at :8080...</span><span id="673c" class="oi kb in ni b gy on ok l ol om">go run ./cmd/subscriber/main.go<br/>2022/03/24 11:50:35 subscriber is starting...</span></pre><p id="49fb" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">通过在web浏览器上或通过curl打开端点<a class="ae jz" href="http://localhost:8080/publish" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/publish</a>来触发发布消息端点:</p><pre class="mj mk ml mm gt oe ni of og aw oh bi"><span id="0d79" class="oi kb in ni b gy oj ok l ol om">curl --location --request GET 'http://localhost:8080/publish'</span></pre><p id="34ae" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">成功发布消息后，应该会得到响应:</p><pre class="mj mk ml mm gt oe ni of og aw oh bi"><span id="7fc1" class="oi kb in ni b gy oj ok l ol om">{<br/> "message": "published message with custom attributes; msg id: 3923499137405184"<br/>}</span></pre><p id="40f2" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">并且应该接收订户:</p><pre class="mj mk ml mm gt oe ni of og aw oh bi"><span id="06f7" class="oi kb in ni b gy oj ok l ol om">2022/03/24 11:52:47 got data: "Hello world!"<br/>2022/03/24 11:52:47 got attribute: map["origin":"golang" "username":"gcp"]</span></pre><figure class="mj mk ml mm gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oo"><img src="../Images/afb8310c02df5413e6c8e21ba1e6402a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g1Sr4GISrNEdv50K6yJkZw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Publisher and Subscriber running and received a message</figcaption></figure><p id="bf7b" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">耶！！PubSub可以工作，如果我们想添加更多的订阅者，只需通过Pub/Sub GCP控制台向主题添加一个新的订阅id，并使用不同的<code class="fe nf ng nh ni b">subID</code>运行另一个订阅者服务</p><h1 id="b67c" class="ka kb in bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">关闭</h1><p id="5b83" class="pw-post-body-paragraph ky kz in la b lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv ig bi translated">通过这个实验，用发布/订阅实现事件驱动架构并不困难。发布/订阅已经提供了系统，我们只需要配置主题、订阅和我们需要的其他配置。</p><p id="92ff" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">如果我们不想自己管理事件系统；部署、维护、扩展等，选择发布/订阅是一个不错的选择。</p><p id="3296" class="pw-post-body-paragraph ky kz in la b lb lw ld le lf lx lh li lj ly ll lm ln lz lp lq lr ma lt lu lv ig bi translated">谢谢大家！希望这篇文章对你有用！</p></div></div>    
</body>
</html>