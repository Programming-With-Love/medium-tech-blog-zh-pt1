# Kotlin 带来更少的崩溃和更高的稳定性

> 原文：<https://medium.com/androiddevelopers/fewer-crashes-and-more-stability-with-kotlin-b606c6a6ac04?source=collection_archive---------0----------------------->

![](img/b78f51acb7b15e1662365b71268b0e73.png)

用户希望对你的应用有一个无缝的体验。崩溃会导致差评、卸载的增加，甚至损害你的品牌认知。从与社区的交流中，我们知道采用 Kotlin 的主要原因之一是更安全的代码。在这篇文章中，我将分享 Kotlin 改善我们合作伙伴代码稳定性的一些方法，但我们也会看看一些 Google Play 商店统计的结果，看看使用 Kotlin 和崩溃数量之间是否有相关性(剧透:有！).

# 应用质量

你的应用程序的质量不仅仅影响你的用户体验。有几个其他因素会受到大量崩溃的影响:

*   **应用可发现性** — Google Play store 的推荐由人工监管和算法计算混合而成，其中质量是最大的考虑因素之一。
*   **品牌** —你的产品性能会影响你的评分和评论，进而影响品牌认知。
*   **更高数量的(参与)用户** —有机流量和品牌认知度的提高可以带来更好的用户获取和保留，这也会影响参与度和更低的漏斗指标。

> 用 Kotlin 构建的应用崩溃的可能性要低 20%。

科特林在其中扮演了什么角色？我们查看了 Google Play 上排名前 1000 的应用程序，发现使用 Kotlin 的应用程序比不使用 kot Lin 的应用程序每用户崩溃次数少 20%。

这方面的一个例子来自 Swiggy 的工程团队，他们 74%的代码是用 Kotlin 编写的——自从将新功能开发转移到 Kotlin 后，他们看到崩溃减少了 50%。

# 避免 null pointer 异常

Google Play 崩溃的头号原因是`NullPointerException`s。2018 年，Google Home 团队开始在 Kotlin 中编写所有新功能，并在一年内看到空指针崩溃下降了 [33%。](https://android-developers.googleblog.com/2020/07/Google-home-reduces-crashes.html)

> Google Home 的 NullPointerExceptions 下降了 33%

为了避免`NullPointerException` s，您需要确保您正在处理的对象引用在调用它们的方法或试图访问它们的成员之前是非空的。在 Kotlin 中，可空性是类型系统的一部分。例如，一个变量需要从一开始就声明为可空或不可空。通过使可空性成为类型系统的一部分，你不必依赖于你的记忆和代码库的知识，或者编译时警告(如果你用`@Nullable`注释你的字段/参数),而是强制可空性，所以你将得到编译时错误，而不仅仅是警告。有关处理可空性的方法，请查看本页。

# 避免常见问题

我们开发人员在没有意识到的情况下引入了很多问题，其中很多问题可能非常微妙，很难调查。以下是使用 Kotlin 时可以避免的一些问题。

## `hashCode()`和等于()

如果两个对象相等，那么它们的 hashcode 应该是相同的——但是，当新的属性被添加到类中时，经常会忘记实现其中一个方法或者更新它们。当处理角色只是保存数据的类时，使用 Kotlin [数据类](https://kotlinlang.org/docs/reference/data-classes.html)。带有数据类`**hashCode()**` **和** `**equals()**` **是由编译器**为你生成的，因此当你改变类的属性时会自动更新。

# 结构平等与参照平等

两个对象在结构上是相等的(具有相等的内容)还是在引用上是相等的(它们的指针是相同的)？在 Java 编程语言中，对于原语，您总是会使用`==`，因此，一个常见的错误是对对象也调用`==`(参考等式)，当您实际上想要检查它们是否在结构上相等时(通过调用`equals()`来检查)。首先， **Kotlin 没有原始类型**，它使用像`Int`或`String`这样的类；这意味着你不再需要区分对象和基本类型，因为所有的东西都是一个对象。其次，Kotlin 定义了`==`用于结构等式，而`===`用于参考等式，因此**不需要检查参考等式，而**则不需要。

# 如果……如果……如果……如果……还不够

使用 enums 时，您通常需要确保覆盖所有可能的情况。这导致了使用`switch`或一系列`if else`的情况。当您修改您的枚举以添加新的值时，您必须手动检查您正在使用枚举的每个代码段，并确保您正在处理新的情况。但这很容易出错。在 Kotlin 中，如果您使用`when`作为表达式，您可以**依赖编译器**来实现:如果您没有覆盖所有可能的分支，您将会得到一个编译器错误。

# 结论

应用程序的稳定性对用户和品牌都很重要。开始使用 Kotlin 来降低崩溃率，让您的用户满意，并通过保持较高的应用评级来保持在保留和购买方面的领先地位。

阅读更多关于您如何通过 Kotlin 构建更好的应用程序的信息，并通过阅读我们的[案例研究](https://developer.android.com/kotlin/stories)了解开发人员如何从 Kotlin 中受益。要使用世界上最受欢迎的语言之一 kot Lin 迈出第一步，请查看我们的[入门页面](https://developer.android.com/kotlin/first)。