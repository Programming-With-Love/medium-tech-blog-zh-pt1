<html>
<head>
<title>Prototyping with React VR</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用React VR制作原型</h1>
<blockquote>原文：<a href="https://medium.com/airbnb-engineering/prototyping-with-react-vr-4d5ab91b6f5a?source=collection_archive---------0-----------------------#2017-08-02">https://medium.com/airbnb-engineering/prototyping-with-react-vr-4d5ab91b6f5a?source=collection_archive---------0-----------------------#2017-08-02</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="2584" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">React在Web和Native上的悠久历史导致了在虚拟空间中非常自然的探索。我们很乐意告诉你！</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/f4aee3b1a6e8d7e212a9ed0321d61075.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nljKQji7aig0L4ouQiAi2g.jpeg"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Next time you are in Beijing, come visit us!</figcaption></figure><p id="2f60" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">在Airbnb，自2014年以来，我们一直在使用<a class="ae ki" href="https://github.com/facebook/react" rel="noopener ugc nofollow" target="_blank"> React </a>为我们的网站构建用户界面。React从根本上改变了我们构建UI的方法，我们一直是开源社区的积极贡献者，参与的项目有<a class="ae ki" href="http://airbnb.io/projects/enzyme/" rel="noopener ugc nofollow" target="_blank">酵素</a>、<a class="ae ki" href="http://airbnb.io/projects/hypernova/" rel="noopener ugc nofollow" target="_blank"> Hypernova </a>、<a class="ae ki" href="http://airbnb.io/react-sketchapp/" rel="noopener ugc nofollow" target="_blank"> react-sketchapp </a>、<a class="ae ki" href="http://airbnb.io/projects/react-with-styles/" rel="noopener ugc nofollow" target="_blank"> react-with-styles </a>、<a class="ae ki" href="http://airbnb.io/projects/react-dates/" rel="noopener ugc nofollow" target="_blank"> react-dates </a>和<a class="ae ki" href="https://github.com/airbnb/react-native-maps" rel="noopener ugc nofollow" target="_blank"> react-native-maps </a>。</p><p id="59af" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated"><a class="ae ki" href="https://facebook.github.io/react-vr/" rel="noopener ugc nofollow" target="_blank"> React VR </a>提供了一个独特的机会，利用我们的专业知识来快速测试和重复我们一直在尝试的许多VR想法。为了做到这一点，我们在Airbnb Samara的虚拟现实实验室召集了一个由React和虚拟现实专家组成的小组，看看在F8 React虚拟现实发布前的3周内我们能完成什么。以下是React VR的技术概述，以及React、React Native和React VR之间的相似之处。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="kj kk l"/></div><figcaption class="ji jj et er es jk jl bd b be z dx">The video of our React VR prototyping experience, shown on stage at Facebook’s F8 conference</figcaption></figure><h2 id="5d0b" class="kl km hh bd kn ko kp kq kr ks kt ku kv jv kw kx ky jz kz la lb kd lc ld le lf bi translated"><strong class="ak">为什么做出反应</strong></h2><p id="a74f" class="pw-post-body-paragraph jm jn hh jo b jp lg ii jr js lh il ju jv li jx jy jz lj kb kc kd lk kf kg kh ha bi translated">React最大的创新之一是，它使开发人员能够将一个系统(如web或移动应用程序的UI)描述为一组声明性组件。这种声明性方法的强大之处在于，UI的描述与其实现是分离的，允许作者构建定制的“呈现器”，这些“呈现器”不仅面向web浏览器，还面向更多平台，例如<a class="ae ki" href="https://github.com/iamdustan/react-hardware" rel="noopener ugc nofollow" target="_blank">硬件</a>、<a class="ae ki" href="https://github.com/Yomguithereal/react-blessed" rel="noopener ugc nofollow" target="_blank">终端应用</a>、<a class="ae ki" href="https://formidable.com/blog/2016/08/22/make-dope-beats-with-reactjs/" rel="noopener ugc nofollow" target="_blank">音乐合成器</a>和<a class="ae ki" href="http://airbnb.io/react-sketchapp/" rel="noopener ugc nofollow" target="_blank"> Sketch.app </a>。</p><blockquote class="ll lm ln"><p id="8a7a" class="jm jn lo jo b jp jq ii jr js jt il ju lp jw jx jy lq ka kb kc lr ke kf kg kh ha bi translated">React as范型非常适合包装底层平台API的复杂性，并为使用它们的开发人员提供一致和流畅的工具。</p><p id="38ab" class="jm jn lo jo b jp jq ii jr js jt il ju lp jw jx jy lq ka kb kc lr ke kf kg kh ha bi translated">乔恩·戈尔德，《用代码绘画》<a class="ae ki" href="http://airbnb.design/painting-with-code/" rel="noopener ugc nofollow" target="_blank">http://airbnb.design/painting-with-code</a></p></blockquote><h2 id="8312" class="kl km hh bd kn ko kp kq kr ks kt ku kv jv kw kx ky jz kz la lb kd lc ld le lf bi translated"><strong class="ak">引擎盖下的反应原生</strong></h2><p id="3558" class="pw-post-body-paragraph jm jn hh jo b jp lg ii jr js lh il ju jv li jx jy jz lj kb kc kd lk kf kg kh ha bi translated">因为React VR是建立在React Native之上的，所以我们先来看看它在引擎盖下是如何工作的。<a class="ae ki" href="https://github.com/facebook/react-native" rel="noopener ugc nofollow" target="_blank"> React Native </a>建立在一个渲染器上，该渲染器控制iOS和Android上的原生UI。React应用程序代码在移动设备的后台线程中的JavaScript虚拟机中运行，让主线程自由地呈现原生UI。React Native为app的原生层和JavaScript层提供了沟通的桥梁。当应用程序中的React组件被呈现时，React本机呈现器将所有需要发生的UI更改序列化为基于JSON的格式，并通过桥异步发送该有效负载。本机层接收并反序列化这个有效负载，相应地更新本机UI。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ls"><img src="../Images/9b5c4b6cfb37e8a9c97bb47480aa73c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*E-c0mBtxYrcZJuA5."/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx"><em class="lt">Diagram 1: React Native architecture.</em></figcaption></figure><p id="aefb" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">在过去的一年里，Airbnb在React Native上进行了大量投资，因为我们认识到跨平台共享知识、工程师和代码的力量。11月，我们推出了新的<a class="ae ki" href="https://www.airbnb.com/experiences" rel="noopener ugc nofollow" target="_blank">体验</a>平台，它主要是在我们的iOS和Android应用程序上用React Native编写的，我们组建了一个全职的React Native基础架构团队来继续这项投资。</p><blockquote class="ll lm ln"><p id="272b" class="jm jn lo jo b jp jq ii jr js jt il ju lp jw jx jy lq ka kb kc lr ke kf kg kh ha bi translated">学一次，随处写。</p><p id="15f9" class="jm jn lo jo b jp jq ii jr js jt il ju lp jw jx jy lq ka kb kc lr ke kf kg kh ha bi translated">Tom Occhino，<a class="ae ki" href="https://code.facebook.com/posts/1014532261909640/react-native-bringing-modern-web-techniques-to-mobile/" rel="noopener ugc nofollow" target="_blank"> React Native:将现代网络技术引入手机</a></p></blockquote><h2 id="31a6" class="kl km hh bd kn ko kp kq kr ks kt ku kv jv kw kx ky jz kz la lb kd lc ld le lf bi translated"><strong class="ak"> React VR基于React Native </strong></h2><p id="0151" class="pw-post-body-paragraph jm jn hh jo b jp lg ii jr js lh il ju jv li jx jy jz lj kb kc kd lk kf kg kh ha bi translated">React VR的架构反映了React Native的架构，React应用程序代码在后台线程中运行——在本例中，是Web浏览器中的一个<a class="ae ki" href="https://developer.mozilla.org/en-US/docs/Web/API/Web_Workers_API" rel="noopener ugc nofollow" target="_blank"> Web Worker </a>。当应用程序的React组件被渲染时，React VR利用React本机桥来序列化任何必要的UI更改，并将它们传递给主线程，在这种情况下，主线程是浏览器的主JavaScript运行时。在这里，React VR利用Oculus的一个名为<a class="ae ki" href="https://www.npmjs.com/package/ovrui" rel="noopener ugc nofollow" target="_blank"> OVRUI </a>的库，将待定UI更新的有效载荷翻译成<a class="ae ki" href="https://threejs.org/" rel="noopener ugc nofollow" target="_blank"> Three.js </a>命令，使用WebGL渲染一个3D场景。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ls"><img src="../Images/49335e2ba02af422db31221c6afa586a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RYyG7tsfMKTcTSom."/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx"><em class="lt">Diagram 2: React VR is built directly on top of React Native</em></figcaption></figure><p id="2c91" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">最后，React VR利用WebVR的新<code class="du lu lv lw lx b">navigator.getVRDisplays()</code> API将3D场景发送到用户的头戴显示器，如Oculus Rift、HTC Vive或三星Gear VR。由Mozilla倡导的新标准WebVR ，在最近的主流浏览器版本中都得到了支持。查看<a class="ae ki" href="https://webvr.info/" rel="noopener ugc nofollow" target="_blank"> webvr.info </a>了解浏览器支持的最新信息。</p><p id="ad6f" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">因为React VR实现了许多与React原生实现相同的公共API，所以我们可以访问同样庞大的模式、库和工具生态系统。任何开发过React或React原生应用程序的开发人员都会对此感到熟悉。我们能够快速建立并运行一个虚拟现实原型；很快，我们搭建了一个基本的React应用程序，设置了Redux，并开始使用我们的生产JSON API获取样本数据。</p><p id="4559" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">通过热模块重新加载和Chrome Dev工具调试，我们可以像React web和React Native development一样快速地进行迭代，这允许我们向众所周知的墙扔一堆UI想法，看看什么会坚持下来。</p><blockquote class="ll lm ln"><p id="f391" class="jm jn lo jo b jp jq ii jr js jt il ju lp jw jx jy lq ka kb kc lr ke kf kg kh ha bi translated">使用React (JavaScript)已经证明是VR应用开发的一个比我预期的更大的胜利——UI dev比Unity快几倍。</p><p id="fe8c" class="jm jn lo jo b jp jq ii jr js jt il ju lp jw jx jy lq ka kb kc lr ke kf kg kh ha bi translated">约翰·卡马克，Oculus首席技术官，也是《雷神之锤》的原创者。</p></blockquote><h2 id="1093" class="kl km hh bd kn ko kp kq kr ks kt ku kv jv kw kx ky jz kz la lb kd lc ld le lf bi translated"><strong class="ak">虚拟现实中的Flexbox</strong></h2><p id="09b6" class="pw-post-body-paragraph jm jn hh jo b jp lg ii jr js lh il ju jv li jx jy jz lj kb kc kd lk kf kg kh ha bi translated">React VR继承了React Native基于flexbox的布局和样式引擎，并进行了一些调整，允许在3维空间中进行变换。</p><p id="61cf" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">Flexbox对React Native的支持由<a class="ae ki" href="https://facebook.github.io/yoga/" rel="noopener ugc nofollow" target="_blank"> Yoga </a>提供，这是一个由脸书创建的跨平台布局引擎，通过将flexbox指令转换为布局度量来简化移动开发。因为是用C写的，Yoga (née css-layout)可以原生嵌入Objective-C和Java移动应用。React VR也使用Yoga进行flexbox布局。“但是怎么做呢？”你问“是用C写的！”React VR团队已经通过使用<a class="ae ki" href="https://github.com/kripken/emscripten" rel="noopener ugc nofollow" target="_blank"> Emscripten </a>将Yoga C代码交叉编译成JavaScript实现了这一点。多酷啊。</p><p id="76b1" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">这是React VR的一个强大功能:开发者可以跨web、React Native和VR使用相同的样式和布局系统，这为跨这些平台直接共享布局样式打开了大门。</p><h2 id="6050" class="kl km hh bd kn ko kp kq kr ks kt ku kv jv kw kx ky jz kz la lb kd lc ld le lf bi translated"><strong class="ak">共享原语</strong></h2><p id="129f" class="pw-post-body-paragraph jm jn hh jo b jp lg ii jr js lh il ju jv li jx jy jz lj kb kc kd lk kf kg kh ha bi translated">与React Native一样，React VR提供了一组用于构建UI的基本原语— <code class="du lu lv lw lx b">&lt;View&gt;</code>、<code class="du lu lv lw lx b">&lt;Text&gt;</code>、<code class="du lu lv lw lx b">&lt;Image&gt;</code>、<code class="du lu lv lw lx b">Stylesheet</code>—此外还添加了自己的VR专用原语，如<code class="du lu lv lw lx b">&lt;Pano&gt;</code>、<code class="du lu lv lw lx b">&lt;Box&gt;</code>等。这使得我们可以将一些现有的React本地组件放入VR中，在2D表面上进行渲染。</p><p id="e606" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">这是非常令人兴奋的，因为我们已经在<code class="du lu lv lw lx b">react-primitives</code>上构建了我们的<a class="ae ki" href="https://airbnb.design/building-a-visual-language/" rel="noopener ugc nofollow" target="_blank"> UI组件系统</a>，这是一个我们开发的库，通过提供基本的<code class="du lu lv lw lx b">&lt;View&gt;</code>、<code class="du lu lv lw lx b">&lt;Text&gt;</code>、<code class="du lu lv lw lx b">&lt;Image&gt;</code>等来跨平台共享React组件。各种平台的原语，包括web、native和Sketch.app(通过我们的<a class="ae ki" href="https://airbnb.design/painting-with-code/" rel="noopener ugc nofollow" target="_blank"> react-sketchapp </a>项目)。</p><p id="b769" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">这意味着我们可以在VR中直接使用按钮、行、图标等，保持Airbnb设计语言的一致性，而不必从头开始重写。</p><p id="e66a" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">查看我们的工程师Leland Richardson在React Europe上的演讲，更深入地了解下面的<code class="du lu lv lw lx b">react-primitives</code>的前景。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="kj kk l"/></div><figcaption class="ji jj et er es jk jl bd b be z dx">Airbnb engineer Leland Richardson’s talk at React Europe: “React as a Platform: A path towards a truly cross-platform UI”</figcaption></figure><p id="f109" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated"><strong class="jo hi">&lt;&gt;/</strong></p><p id="b9b4" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">可以想象，将2D内容放在3D空间的平面上通常达不到最佳的观看体验。目前，许多VR应用程序通过将2D UI渲染到观众面前弯曲的圆柱形平面上来解决这一问题，给它一种“2.5D”的感觉。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ly"><img src="../Images/3cdd97781b0da7325253d8b7e140e006.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*86iyel6sGA-WPRe12-A8JA.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">A screenshot of Oculus home captured in Gear VR, showing of its use of a cylindrical layer for displaying 2D content for a “2.5D” feel</figcaption></figure><p id="a0b2" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">React VR为此提供了<code class="du lu lv lw lx b">&lt;CylindricalLayer&gt;</code>组件，我们发现它可以有效地在我们的应用程序中显示菜单和其他交互式内容，并且是将我们UI库中现有的2D React组件集成到VR环境中的最佳方式。</p></div><div class="ab cl lz ma go mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ha hb hc hd he"><p id="8931" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">由于能够利用我们现有的React知识、工具和UI组件系统，我们几乎可以立即在React VR中提高工作效率。再加上热模块重新加载的魔力，这使我们能够调整三维空间中对象的方向，并接收沉浸在虚拟现实环境中的人的即时反馈，我们设法制作了大量低逼真度的原型，与用户一起测试它们，并迅速了解我们的想法在虚拟现实中哪些可行，哪些不可行。</p><p id="6cb1" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">这种广泛的实验对于首次涉足虚拟现实开发的人来说是必要的——我们一次又一次地发现，UX的想法在纸上听起来很好，但一旦戴上虚拟现实耳机，可能会感觉很奇怪，而且许多在2D工作得很好的UI隐喻并不能很好地转化为3D。我们3周冲刺的主要收获之一是，我们必须开始发展对UX虚拟现实最佳实践的新理解，我们只能在有限的程度上依靠现有的网络和移动学习。幸运的是，有研究人员正在打造这些新的道路，比如VR 的<a class="ae ki" href="https://www.uxofvr.com/" rel="noopener ugc nofollow" target="_blank"> UX背后的人们，我们可以从他们的辛勤工作中学习。</a></p><p id="1cfe" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">还需要注意的是，React VR、WebVR和VR硬件都是新生技术。在前沿工作所固有的不稳定性会使开发过程变得令人沮丧和坎坷。另一方面，生态系统的发展速度令人难以置信，尤其是React VR在我们使用预发布版本进行原型开发的三个月内迅速成熟。</p><p id="d7a8" class="pw-post-body-paragraph jm jn hh jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">最后，我们要感谢在这次探索中支持我们的脸书和Oculus团队，我们很高兴能够为推动该平台向前发展做出贡献。我们迫不及待地想看看商店里有什么！</p></div></div>    
</body>
</html>