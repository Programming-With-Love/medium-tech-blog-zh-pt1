<html>
<head>
<title>Set up Analytics on an Angular app via Google Tag Manager</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过谷歌标签管理器在Angular应用程序上设置分析</h1>
<blockquote>原文：<a href="https://medium.com/quick-code/set-up-analytics-on-an-angular-app-via-google-tag-manager-5c5b31e6f41?source=collection_archive---------0-----------------------#2019-02-21">https://medium.com/quick-code/set-up-analytics-on-an-angular-app-via-google-tag-manager-5c5b31e6f41?source=collection_archive---------0-----------------------#2019-02-21</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="df2c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我最近需要在Angular应用程序上安装谷歌标签管理器(GTM)、数据层和通用分析。</p><p id="d688" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jc">在寻找Angular的GTM或分析插件时，我发现可用的几个选项中有</em> <strong class="ig hi"> <em class="jc">在触发点击事件</em> </strong> <em class="jc">，以及</em> <strong class="ig hi"> <em class="jc">无一在设置一组适当的数据层变量</em> </strong> <em class="jc">以附加到页面视图中。</em></p><p id="8b7f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jc">最后，事实证明</em> <strong class="ig hi"> <em class="jc">的设置相当容易</em></strong><em class="jc"/><strong class="ig hi"><em class="jc">根本不需要插件</em> </strong> <em class="jc">。我在这里分享我的经验。</em></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/4038d30bae9fc9e4aa44e65b989a3862.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cHQTFw1Up2ZxGkvvU7IR5g.png"/></div></div></figure><blockquote class="jp jq jr"><p id="cfc9" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">GTM = Google Tag Manager = Web应用程序，用于管理几个不同的“标签”(您在网站中加载的外部脚本)。</p><p id="cfee" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">数据层=在GTM中存储和使用变量的主要工具</p><p id="db80" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">通用分析=谷歌分析的最新版本，通常也简称为UA或GA</p></blockquote><p id="57f4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本文中，我将假设您已经基本掌握了上述概念。</p></div><div class="ab cl jv jw go jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="ha hb hc hd he"><h1 id="8371" class="kc kd hh bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated"><strong class="ak">什么是数据层变量(以及为什么您应该努力设置它们)</strong></h1><p id="6818" class="pw-post-body-paragraph ie if hh ig b ih la ij ik il lb in io ip lc ir is it ld iv iw ix le iz ja jb ha bi translated">嗯，从技术上来说，GTM的<strong class="ig hi">数据层</strong>只不过是一个大罐子，你可以在里面存储标签所需的信息。</p><p id="93ba" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你必须在调用GTM的脚本之前设置它:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="690b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，当您需要与GTM共享任何内容时，只需将对象推送到它那里:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="d406" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你将数据层初始化为一个空数组的原因是<strong class="ig hi">当GTM脚本仍在加载的时候，你可以继续向它推送东西</strong>:当GTM响应时，它会(1)将window.dataLayer转换为一个对象，(2)执行你向它推送的东西的堆栈。</p><blockquote class="jp jq jr"><p id="cb03" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">数据层在分析中最有用的应用是<strong class="ig hi">将自定义维度推送给它</strong>。使用自定义维度，您可以使用一组变量来定位页面视图，这些变量<strong class="ig hi">描述了页面视图发生的环境</strong></p></blockquote><p id="356e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">例如，假设用户正在查看新闻网站中的页面，并且该页面被标记为属于特定的新闻类别，比如体育。</p><p id="8136" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果，<strong class="ig hi">在触发页面视图</strong>之前，您将包含该页面类别的变量推送到数据层，那么您将能够在GTM中读取该变量，并在Universal Analytics中将它作为<strong class="ig hi">自定义维度</strong>进行传递。使用这样的自定义维度，您可以过滤用户在该类别的页面中引发的任何事件。</p><p id="7b0e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你能看出这有什么好处吗？</p><blockquote class="jp jq jr"><p id="8114" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">您触发的每个事件<strong class="ig hi">都会自动绑定到一组附加信息</strong>，您可以使用这些信息在您的报告上应用过滤器</p></blockquote><ol class=""><li id="0ace" class="lh li hh ig b ih ii il im ip lj it lk ix ll jb lm ln lo lp bi translated">您将变量推送到数据层</li><li id="ed8a" class="lh li hh ig b ih lq il lr ip ls it lt ix lu jb lm ln lo lp bi translated">它作为一个<strong class="ig hi">变量被读取并存储在GTM </strong>中</li><li id="e88e" class="lh li hh ig b ih lq il lr ip ls it lt ix lu jb lm ln lo lp bi translated">它作为<strong class="ig hi">自定义维度</strong>附加到页面浏览量中</li><li id="0a5a" class="lh li hh ig b ih lq il lr ip ls it lt ix lu jb lm ln lo lp bi translated">现在，您可以使用来过滤报告，而不是向每个事件附加详细且容易出错的信息</li></ol><p id="3838" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当你触发事件时，预先设置<strong class="ig hi">一组适当的数据层变量<strong class="ig hi">可以节省你大量的时间(和代码)</strong></strong></p></div><div class="ab cl jv jw go jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="ha hb hc hd he"><h1 id="d4f5" class="kc kd hh bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">为什么在GTM中设置事件比在代码中设置事件更好</h1><p id="1ffa" class="pw-post-body-paragraph ie if hh ig b ih la ij ik il lb in io ip lc ir is it ld iv iw ix le iz ja jb ha bi translated">简而言之:因为你从代码中移除了不属于那里的复杂性。</p><blockquote class="jp jq jr"><p id="5ef3" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">GTM有一个由<strong class="ig hi">变量</strong>、<strong class="ig hi">触发器</strong>和<strong class="ig hi">标签</strong>组成的<strong class="ig hi">完美组织的</strong>系统，为什么要在代码中创建它的副本呢？</p></blockquote><p id="bd93" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">还有，</p><blockquote class="jp jq jr"><p id="ce3d" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">非开发人员可以很容易地对GTM<strong class="ig hi">进行测试和修改，它甚至<strong class="ig hi">拥有自己的版本控制系统</strong>(你可以真正地测试、部署和回滚不同版本的GTM代码，而不必麻烦前端开发人员去做)。</strong></p></blockquote><p id="274c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您所需要做的就是确保需要在GTM中以某种方式跟踪的元素(可点击的元素，或者您想要度量可见性的元素，等等)。)用适当的HTML类标记，任何附加信息都存储在数据中:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="07f0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦你做了这些，你作为前端开发人员的工作就完成了。现在，GTM管理器负责设置一个在点击该类时触发的触发器，以及一个由该触发器激活的通用分析标签。</p></div><div class="ab cl jv jw go jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="ha hb hc hd he"><h1 id="d904" class="kc kd hh bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">GTM +角度实施的优先级</h1><ul class=""><li id="3163" class="lh li hh ig b ih la il lb ip lv it lw ix lx jb ly ln lo lp bi translated">设置一组适当的自定义维度，将它们存储在数据层中，并确保它们正确地附加到每个页面视图。</li><li id="e0e5" class="lh li hh ig b ih lq il lr ip ls it lt ix lu jb ly ln lo lp bi translated">然后，用一组可以被GTM触发器拾取的类来标记可跟踪的HTML元素。</li></ul><p id="2059" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这与我发现的所有Angular的GTM插件所做的正好相反:他们专注于创建许多跟踪事件的实用程序，并且有一个非常简单的页面视图实现，根本没有自定义维度。</p><p id="c204" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可能会反对GTM中定义的一组触发类型无法跟踪的事件:虽然这肯定是可能的，但是如果您做得正确，您想要跟踪的大多数事件都可以跟踪到点击或滚动跟踪(这两种情况都可以通过GTM触发器进行管理)。谁知道GTM的人会推出什么新的跟踪工具。</p><blockquote class="lz"><p id="002a" class="ma mb hh bd mc md me mf mg mh mi jb dx translated">您的目标应该是保持事情简单，尽可能将事件跟踪委托给GTM</p></blockquote></div><div class="ab cl jv jw go jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="ha hb hc hd he"><h1 id="472e" class="kc kd hh bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">定义您的自定义维度集，并将其安全地存储在数据层中</h1><p id="1588" class="pw-post-body-paragraph ie if hh ig b ih la ij ik il lb in io ip lc ir is it ld iv iw ix le iz ja jb ha bi translated">让我们定义一个我们希望一致地推送到数据层的自定义维度的示例列表(在现实生活中，它们可能不止三个):</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="8038" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们的目标是在每个页面视图之前将这些变量推送到数据层<strong class="ig hi">(这样GTM就能够拾取它们并将其作为自定义维度附加)。</strong></p><p id="5205" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了实现通用分析，这些变量需要</p><ol class=""><li id="0787" class="lh li hh ig b ih ii il im ip lj it lk ix ll jb lm ln lo lp bi translated">在GTM中被定义为一个<strong class="ig hi">数据层变量</strong></li><li id="56c9" class="lh li hh ig b ih lq il lr ip ls it lt ix lu jb lm ln lo lp bi translated">在GTM中，<strong class="ig hi">作为自定义维度</strong>附加到所有通用分析页面视图标签</li></ol><p id="a7ac" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这些都是在GTM中完成的，这是一件非常标准的事情。</p><blockquote class="jp jq jr"><p id="5c93" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">至此，我将把这些变量称为“<strong class="ig hi">数据层自定义维度</strong>”，以区别于其他用于不同目的的常规数据层变量。</p></blockquote></div><div class="ab cl jv jw go jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="ha hb hc hd he"><p id="4674" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在谈到这一切的角度实现之前，我还有最后一句话:</p><blockquote class="lz"><p id="d7df" class="ma mb hh bd mc md me mf mg mh mi jb dx translated">每当您想要更新您在数据层中定义的定制维度时，您需要替换所有的维度，甚至是那些空的维度。</p></blockquote><p id="082e" class="pw-post-body-paragraph ie if hh ig b ih mj ij ik il mk in io ip ml ir is it mm iv iw ix mn iz ja jb ha bi translated">如果你不这样做，并在数据层推送中留下空的定制尺寸，<strong class="ig hi"> GTM将记住这些变量的先前值</strong>。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lf lg l"/></div></figure></div><div class="ab cl jv jw go jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="ha hb hc hd he"><h1 id="6772" class="kc kd hh bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">数据层自定义维度的角度抽象</h1><p id="fc56" class="pw-post-body-paragraph ie if hh ig b ih la ij ik il lb in io ip lc ir is it ld iv iw ix le iz ja jb ha bi translated">让我们写下我们需要满足的具体要求:</p><ol class=""><li id="ecd1" class="lh li hh ig b ih ii il im ip lj it lk ix ll jb lm ln lo lp bi translated">确保我们总是在触发页面浏览量之前将自定义维度推送到数据层<strong class="ig hi"/></li><li id="14cb" class="lh li hh ig b ih lq il lr ip ls it lt ix lu jb lm ln lo lp bi translated">确保每次<strong class="ig hi">都推送整套尺寸</strong>，即使它们是空的</li></ol><p id="8931" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">TypeScript可以帮助我们实现(2):让我们定义一个类型，如果我们缺少任何维度，它将引发编译错误。</p><p id="34d9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，我们需要一个包含白名单的enum:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="1deb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，我们使用这个枚举创建一个类型，迫使我们每次都推每个维度:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="0fd9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，我们创建一个服务<strong class="ig hi">，它的具体职责是将定制维度推送到数据层</strong>，确保</p><ol class=""><li id="ae85" class="lh li hh ig b ih ii il im ip lj it lk ix ll jb lm ln lo lp bi translated">无论我们需要推送什么尺寸，<strong class="ig hi"> <em class="jc">我们集合中缺少的尺寸也被推送(值=未定义)</em> </strong></li><li id="9f48" class="lh li hh ig b ih lq il lr ip ls it lt ix lu jb lm ln lo lp bi translated">有一些维度在每次推送时不断发送可能是有用的:例如，如果访问用户登录，则一个布尔值为真，您可以使用它来衡量订阅和未订阅用户之间的行为差异。</li></ol><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="b597" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在第21行，向有效载荷添加了一个维度:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="e0bd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里定义的优先级是</p><ol class=""><li id="f3a7" class="lh li hh ig b ih ii il im ip lj it lk ix ll jb lm ln lo lp bi translated">如果适用，使用传递给方法的<strong class="ig hi">尺寸</strong></li><li id="7c82" class="lh li hh ig b ih lq il lr ip ls it lt ix lu jb lm ln lo lp bi translated">如果该方法接收的有效载荷中未定义自定义维度，<strong class="ig hi">则使用每次推送时必须发送的预定义维度集</strong></li><li id="6585" class="lh li hh ig b ih lq il lr ip ls it lt ix lu jb lm ln lo lp bi translated">如果<strong class="ig hi">尺寸在两个有效载荷</strong>中都不存在，则传递值“未定义”。</li></ol><p id="4e70" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，在第26行，先前构建的一组数据层定制维度被<strong class="ig hi">推送到window.dataLayer </strong>:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="f23e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">此服务的方法的使用顺序如下:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lf lg l"/></div></figure></div><div class="ab cl jv jw go jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="ha hb hc hd he"><h1 id="7b8c" class="kc kd hh bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">普适分析的角度抽象</h1><p id="031c" class="pw-post-body-paragraph ie if hh ig b ih la ij ik il lb in io ip lc ir is it ld iv iw ix le iz ja jb ha bi translated">现在，我们有了一个服务，它牢固地包装了我们需要存储在数据层中的自定义维度。让我们在另一个服务中使用它，该服务抽象了与分析相关的操作:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="830a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该服务不做任何特殊的事情:它使用刚刚定义的<em class="jc">dataLayerCustomDimensionsService</em>，作为数据层定制维度的抽象。当调用“页面视图”时，它将传递的变量存储在<em class="jc">dataLayerCustomDimensionsService</em>中，并触发它(这意味着维度实际上被推送到数据层)，然后触发页面视图。</p><p id="618c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">不出所料，<strong class="ig hi">页面视图是通过对数据层的另一次推送</strong>实现的:在GTM中，您通常会设置一个监听该事件的触发器，并将其附加到一个Universal Analytics页面视图标签上(如前所述，传递所有的数据层定制维度)。</p><p id="c1d8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请注意我是如何添加覆盖发送给GTM的页面视图url的可能性的:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="50df" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当您希望使用页面视图来跟踪与导航无关的用户操作时，这很有用:在一些有趣的情况下，发送一个“特殊”的页面视图，允许向Universal Analytics传递更多的信息，这些信息不会通过常规事件传递(例如，您可以使用这种方法来实现增强的电子商务漏斗)。角度编程初学者可以从<a class="ae mo" href="https://blog.coursesity.com/best-angular-js-tutorials/" rel="noopener ugc nofollow" target="_blank">最佳角度教程</a>中受益。</p></div><div class="ab cl jv jw go jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="ha hb hc hd he"><p id="2127" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">我们需要如何以及在哪里调用我们新的分析服务的action pageView()。</strong></p><p id="420a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">答案很简单:</p><blockquote class="jp jq jr"><p id="d737" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">您可以在任何时候调用analytics service . pageview()<strong class="ig hi"/>，只要您可以获得(1) <strong class="ig hi">用户导航到的URL</strong>和(2)您需要将作为自定义维度推送到数据层的所有<strong class="ig hi">信息</strong></p></blockquote><p id="da56" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要满足第一个条件，在你的app中监听“router.events”就够了，组件:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="a8e3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jc">(显然，如果你正在进行一个大型项目，你更希望在一个单独的模块中完成这项工作，而不是用太多的代码让你的应用组件过载)。</em></p><p id="25a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第二个条件呢？嗯，这取决于你的应用程序的业务逻辑，以及你想在通用分析中跟踪什么:如果你推的唯一维度依赖于url，你可以直接使用上面的router.events解决方案。</p><p id="81d4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">相反，如果像我一样，<strong class="ig hi">您的维度只有在路由数据被解析器</strong>获取之后才知道，那么您应该从您连接到路由器的组件的ngOnInit回调内部发送页面视图:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lf lg l"/></div></figure></div><div class="ab cl jv jw go jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="ha hb hc hd he"><p id="0d6c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为什么在上面的AnalyticsService和DataLayerCustomDimensionService中，我以如此分散的方式定义方法？我的意思是，先保存一组维度，然后在服务上调用“trigger”来推送这样的维度，等等。我们不能一起一口气做所有的事情吗？ </p><p id="6a1e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">同样，答案很简单:</p><blockquote class="jp jq jr"><p id="2709" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">在实施分析的过程中，你通常会在应用响应的不同阶段获取不同类型的信息:你越是细分为更小的步骤，你就越有可能拥有未来可能需要的灵活性</p></blockquote><p id="5119" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">实际上，在我们的分析服务中，我们甚至可以将事情分解得更细一些，甚至得到<strong class="ig hi">更多面向未来的东西</strong>:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="91d1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在第一次，天真的GTM +分析实现，它可能足以触发自定义维度的变化和页面视图总是在同一时刻。</p><blockquote class="jp jq jr"><p id="991b" class="ie if jc ig b ih ii ij ik il im in io js iq ir is jt iu iv iw ju iy iz ja jb ha bi translated">但是，<strong class="ig hi">随着应用程序的增长</strong>，我们可能希望在不同于实际页面视图的时刻推送数据层维度<strong class="ig hi">。</strong></p></blockquote><p id="f19a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">或者，我们甚至可能决定进行优化，在不更新数据层维度的情况下触发多次页面查看。这就是为什么在analyticsService中分离这两个操作是有用的。</p><p id="997b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae mo" href="https://blog.coursesity.com/best-vuejs-tutorials/" rel="noopener ugc nofollow" target="_blank"> VueJS </a>是一个轻量级、干净、数据驱动的反应式前端视图模型，它可以帮助您立即启动并运行您的应用程序。</p></div><div class="ab cl jv jw go jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="ha hb hc hd he"><h1 id="144f" class="kc kd hh bd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz bi translated">将所有东西捆绑在一起，完成实现</h1><p id="90e3" class="pw-post-body-paragraph ie if hh ig b ih la ij ik il lb in io ip lc ir is it ld iv iw ix le iz ja jb ha bi translated">为了让事情顺利进行，我们遗漏了什么？</p><p id="3ada" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们需要添加GTM初始化脚本，这应该在“index.html”中完成，在你的应用程序的&lt; head &gt; tag 中尽可能向上:正如已经提到的，就在window.dataLayer的第一个定义下面。</p><p id="7729" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">理论上，如果你只是想使用GTM进行分析，<strong class="ig hi">你也可以在你的app.component中从Angular code </strong>初始化它，或者在你的CoreModule的初始化中初始化它(如果你有一个的话):因为用户在应用加载之前根本不能进行交互，所以之前没有什么可跟踪的。所以，如果你只使用GTM进行分析，我实际上建议这样做，因为这是一个更干净、更可控的解决方案。</p><p id="2dde" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但是，如果除了分析之外，您还将GTM用于标签，那么从HTML中调用它并尽快加载它肯定会更好。</p><p id="0334" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">事件跟踪呢？这似乎是那些开发了少量GTM-Angular扩展的人最担心的事情:但是正如我所说的，实际上，<strong class="ig hi">最好和最干净的解决方案</strong>只是用HTML类标记你想要跟踪的元素，而<strong class="ig hi">完成GTM </strong>的所有繁重工作。</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="cc9d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对了，记得做一个好的前端开发者:在一个锚点上添加click event + GTM类(<a>标签)。如果您跟踪非锚点上的点击，或者跟踪包含锚点和其他内容的div上的点击，那么您可能会在GTM中得到意想不到的副作用(例如，点击不总是触发)</a></p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="lf lg l"/></div></figure><p id="dea4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">随着Angular、typescript和所有其他花哨的javascript框架的出现，我发现许多后端开发人员开始在不知道自己在做什么的情况下将手伸向前端。HTML markdown仍然有它的重要性，甚至在一个现代的单页应用程序中:尊重HTML，一切都会更干净。</p></div></div>    
</body>
</html>