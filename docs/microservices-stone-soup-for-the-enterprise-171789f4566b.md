# 微服务:企业的石头汤

> 原文：<https://medium.com/capital-one-tech/microservices-stone-soup-for-the-enterprise-171789f4566b?source=collection_archive---------0----------------------->

## ***微服务是你技术转型的起点，而不是终点。***

![](img/489032758797054650dc637c311f82b6.png)

# 背景:拿破仑战争期间的欧洲

从前，一个士兵从战场上回来。回家的路程很长，在路上他来到了一个村庄。这个村庄被战争弄得伤痕累累；每个人都挤在家里，不愿意出去帮助邻居。走了一整天后，士兵饿了，他到镇上的每家每户要一些食物。但是没有人给他东西吃。

当士兵来到最后一所房子时，他没有要食物，而是告诉他们他只需要一壶水。他说他有一块神奇的石头，用一壶水，他可以用它来做石头汤，这是世界上最美味的汤。他们疑惑地看着他，但给了他一个罐子和一些水。士兵走到村子的中心，生了一堆火，把锅和水放在上面，然后把他的魔石放进锅里。村民们慢慢地离开他们的房子，聚集在士兵的周围，等着看他的魔法石是如何工作的。

过了一会儿，士兵说:“石头汤是世界上最美味的汤，但你知道是什么使石头汤更美味吗？几根胡萝卜。”一个村民回到家里，拿了一些胡萝卜，放进锅里。

过了一会儿，士兵说:“胡萝卜石头汤真好，又有营养，但是你知道石头汤里有什么好吃的吗？几个土豆。”一个村民回到家里，拿了一些土豆，放进锅里。

![](img/28db5959a2a0740a4ffa9b00a5aa793b.png)

当锅继续煮的时候，士兵说:“胡萝卜和土豆真的很合我的口味，但是石头汤确实得益于一些肉。”一个村民回到他的房子，收集了一些鸡，并把它放入锅里。

然后士兵说:“石头汤里的魔法石真是世界上最好的调味品。但一些额外的香料不会有坏处。”几个村民回家带回了香料和草药。士兵把它们放进了锅里。

然后一个村民问士兵，“你认为其他蔬菜会使石头汤更好吗？”士兵说:“绝对可以！”而村里的每个人都回到了自己的家里，带了自己能带的东西，加到了锅里。

汤喝完后，镇上的每个人都和士兵一起吃饭，他们吃着，笑着，分享着。每个人都认为石头汤是最好的汤。

# 背景:平淡无奇的办公楼，但肯定不是你的

从前，有一家公司。这家公司的软件有问题。代码如此难以理解，部署如此复杂，错误如此难以追踪，以至于什么都没有发布。他们的客户很不高兴，公司的每个团队每天都在为所有的问题责备其他的团队。

于是有一天，CEO 雇了一个顾问来公司。顾问去了每个团队，试图找出哪里出了问题。但是每个团队都害怕顾问，害怕他会告诉首席执行官，他们是一切都无法正常工作的原因。他们假装很有帮助，但是给顾问的信息越少越好，然后让他走了。

在与所有团队一起度过一段时间后，顾问发布了他的报告。它说，“如果你使用微服务，你所有的问题都可以解决！”团队对此表示怀疑，但一个团队同意开始将整体应用程序分解成一组微服务。

![](img/0717de125df7a518c691b59e787b559c.png)

顾问说，“拆分一个单一的应用程序很好，但是你知道是什么让微服务变得更好吗？自动化单元测试。单元测试让微服务工作得非常好。”所以团队写了一些单元测试来验证他们的微服务。

然后顾问说，“你知道，自动化单元测试和微服务真的很棒，但是[持续集成](https://www.capitalone.com/tech/software-engineering/realigning-devops-practices-to-support-microservices/)，这真的是微服务的秘密。”另一个团队很好奇，所以他们建立了一个 CI 服务器，以便在代码签入源代码控制时自动构建代码。

然后顾问说，“持续集成很棒，但真正让微服务嗡嗡作响的是[代码质量指标](/capital-one-tech/improve-java-code-with-unit-tests-and-jacoco-b342643736ed)。”然后另一个团队建立了一个服务器来报告代码质量，人们开始使用这些反馈来发现他们代码中的问题。

然后顾问说，“哇，代码质量度量正是微服务所需要的，但是在代码中添加一些[运行时监控支持](/capital-one-tech/code-walked-out-of-a-spaghetti-bar-2dcc1750789a)会让微服务真正发光。”运营团队建立了一个监控服务，开发人员将监控服务集成到代码中。

然后顾问说，“现在我们有了运行时监控支持，我们的微服务将会是最好的。但是，当[部署实现自动化](/capital-one-tech/factory-for-factories-79ef77704d26)时，微服务会真正受益。”团队用脚本和基础设施代码取代了所有半文档化的手动部署步骤。

然后其中一个团队的经理过来对顾问说，“我一直在研究微服务，有人说[容器](/capital-one-tech/lets-talk-containers-1697851b9ed6)对微服务有好处。他们说得对吗？”而咨询师说:“绝对可以！”因此，团队构建了在容器内部运行的代码。

另一个团队领导说，“部署到[云提供商](https://aws.amazon.com/campaigns/cloud-transformation/capital-one/)并使用自动扩展和负载平衡怎么样？这对微服务有帮助吗？”顾问只是点点头，他们就开始着手从他们自己的数据中心移植到云上。

最终，公司完全改变了他们的流程，自动化了他们代码的测试、构建和部署。产品再次发货，客户很高兴。每个人都认为微服务是最好的架构。

# 寓意

您可以尝试通过提议更多的自动化和跨团队协作来直接改进您的组织。但是如果你从魔法石开始，事情会变得更容易，不要感到惊讶。改变是困难的。一起工作是困难的。有时候，人们需要一些额外的动力来一起工作，做正确的事情。如果这需要一点技巧，没关系。

我不是第一个认识到石头汤的故事和企业发展有相似之处的人；安德鲁·亨特和迪夫·托马斯参考了《务实的程序员[*的介绍中的故事。他们说，开始一个项目并展示成功会鼓励其他人加入并建立在成功的基础上。这是真的，但有时对技术的好奇心足以让人们做出贡献。*](https://www.amazon.com/Pragmatic-Programmer-Journeyman-Master/dp/020161622X)

在您的组织中引入微服务绝对没有错。但是你需要意识到，微服务只是一块石头——改进的技术和组织程序才是关键的成分。如果你把一个大的应用程序分解成许多小的部分，并且不采取必要的步骤来创建一个更灵活的技术组织，你最终会得到一个像煮熟的石头一样吸引人的东西。

[![](img/a9f346eff65776bdedf685617e2c446d.png)](https://medium.com/capital-one-tech/microservices/home)

*披露声明:这些观点是作者的观点。除非本帖中另有说明，否则 Capital One 不属于所提及的任何公司，也不被其认可。使用或展示的所有商标和其他知识产权都是其各自所有者的所有权。本文为 2019 首都一。*