<html>
<head>
<title>Real-time analytics at Pinterest</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Pinterest的实时分析</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/real-time-analytics-at-pinterest-1ef11fdb1099?source=collection_archive---------0-----------------------#2015-02-18">https://medium.com/pinterest-engineering/real-time-analytics-at-pinterest-1ef11fdb1099?source=collection_archive---------0-----------------------#2015-02-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="ba22" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Krishna Gade | Pinterest工程经理，数据</p><p id="c362" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">随着本周数千人聚集在湾区参加<a class="ae jc" href="http://strataconf.com/big-data-conference-ca-2015/public/content/home" rel="noopener ugc nofollow" target="_blank"> Strata + Hadoop World </a>，我们希望分享数据驱动的决策是如何融入我们公司DNA的。最近，我们构建了一个实时数据管道，使用Spark Streaming 将数据导入<a class="ae jc" href="http://www.memsql.com/releases/memsql-and-pinterest-showcase-operationalizing-spark/" rel="noopener ugc nofollow" target="_blank"> MemSQL，还构建了一个高度可扩展的基础设施，实时收集、存储和处理用户参与数据，同时解决挑战，帮助我们实现:</a></p><ul class=""><li id="f3b8" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated">更高性能的事件记录</li><li id="853e" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">可靠的日志传输和存储</li><li id="77b1" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">更快地对实时数据执行查询</li></ul><p id="f8b6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们深入了解一下。</p><h2 id="c320" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated"><strong class="ak">更高性能的事件记录</strong></h2><p id="229a" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">我们开发了一个名为<a class="ae jc" href="http://www.slideshare.net/DiscoverPinterest/singer-pinterests-logging-infrastructure" rel="noopener ugc nofollow" target="_blank"> Singer </a>的高性能日志代理，它部署在我们所有的应用服务器上，用于收集事件日志并将它们发送到一个集中的存储库。应用程序将其事件日志写入本地磁盘，Singer从本地磁盘收集并解析这些日志文件，然后将它们发送到中央日志存储库。Singer使用至少一次交付语义构建，与Kafka配合良好，Kafka充当我们的日志传输系统。</p><h2 id="2fdc" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated"><strong class="ak">可靠的原木运输和储存</strong></h2><p id="7b9f" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated"><a class="ae jc" href="https://kafka.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache Kafka </a>，一个高吞吐量的消息总线，构成了我们的日志传输层。我们选择Kafka是因为它具有许多可取的特性，包括支持大容量事件流、可复制的持久性和至少一次交付的低延迟。一旦事件日志被发送到Kafka，来自Storm、Spark和其他定制日志阅读器的各种消费者就可以实时处理这些事件。其中一个消费者是名为<a class="ae jc" href="https://engineering.pinterest.com/post/84276775924/introducing-pinterest-secor" rel="noopener ugc nofollow" target="_blank"> Secor </a>的日志持久性服务，它可靠地将这些事件写入亚马逊S3。<a class="ae jc" href="https://github.com/pinterest/secor" rel="noopener ugc nofollow" target="_blank"> Secor </a>最初是为了保存我们的货币化渠道产生的日志而构建的，在这种情况下，0-数据丢失非常关键。它从Kafka读取事件日志，并将其写入S3，克服了其脆弱的最终一致性模型。此后，我们的自助式大数据平台将数据从S3加载到许多不同的Hadoop集群中进行批处理。</p><h2 id="a57b" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated"><strong class="ak"> Spark + MemSQL集成</strong></h2><p id="254a" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">虽然Kafka允许实时消费事件，但它不是一个供人类就实时数据提问的好界面。我们希望能够在实时事件到达时运行SQL查询。由于<a class="ae jc" href="http://www.memsql.com/" rel="noopener ugc nofollow" target="_blank"> MemSQL </a>正是为此而构建的，我们构建了一个实时数据管道，使用<a class="ae jc" href="https://spark.apache.org/streaming/" rel="noopener ugc nofollow" target="_blank"> Spark Streaming </a>将数据接收到MemSQL中。该管道正处于原型阶段，我们将继续与MemSQL团队合作生产它。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div class="er es kr"><img src="../Images/3e7477e54ab30365e680243f9adf209e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/0*poFcMBPvfwPCA3td.png"/></div></figure><p id="91ec" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">图1显示了我们到目前为止描述的实时分析平台的元素。几个月来，我们一直在制作《歌手-&gt;卡夫卡-&gt;塞科-&gt; S3》系列电影。目前，我们正在通过构建一个原型来评估Spark -&gt; MemSQL集成，在这个原型中，我们将Pin参与数据输入到Kafka主题中。Kafka中的数据由Spark流作业消耗。</p><p id="5a08" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这项工作中，每个Pin都被过滤，然后通过添加地理位置和Pin类别信息来丰富。然后使用<a class="ae jc" href="https://github.com/memsql/memsql-spark-connector" rel="noopener ugc nofollow" target="_blank"> MemSQL的spark连接器</a>将丰富的数据持久化到MemSQL，并提供查询服务。这个原型的目标是测试MemSQL是否能够让我们的分析师使用熟悉的SQL来探索实时数据并获得有趣的见解。</p><p id="0796" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在我们继续评估MemSQL的同时，我们将于2月19日星期四在圣何塞会议中心与MemSQL团队一起在<a class="ae jc" href="http://strataconf.com/big-data-conference-ca-2015/public/content/home" rel="noopener ugc nofollow" target="_blank"> Strata + Hadoop World 2015 </a>上展示它的演示。请到MemSQL展位1015访问我们，了解更多详情。</p><h2 id="18cb" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated"><strong class="ak">使用Spark &amp; MemSQL </strong>构建的演示</h2><figure class="ks kt ku kv fd kw er es paragraph-image"><div class="er es kr"><img src="../Images/3793e58686839039d387ef32bf0a145d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*EKeIolfh1H-NrG9b.gif"/></div></figure><p id="8332" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="kz"> Krishna Gade是数据团队的工程经理。</em></p><p id="1767" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="kz">获取Pinterest工程新闻和更新，关注我们的工程</em><a class="ae jc" href="https://www.pinterest.com/engineering/" rel="noopener ugc nofollow" target="_blank"><em class="kz">Pinterest</em></a><em class="kz">，</em> <a class="ae jc" href="https://www.facebook.com/pinterestengineering" rel="noopener ugc nofollow" target="_blank"> <em class="kz">脸书</em> </a> <em class="kz">和</em> <a class="ae jc" href="https://twitter.com/PinterestEng" rel="noopener ugc nofollow" target="_blank"> <em class="kz">推特</em> </a> <em class="kz">。有兴趣加入团队吗？查看我们的</em> <a class="ae jc" href="https://about.pinterest.com/en/careers/engineering-product" rel="noopener ugc nofollow" target="_blank"> <em class="kz">招聘网站</em> </a> <em class="kz">。</em></p></div></div>    
</body>
</html>