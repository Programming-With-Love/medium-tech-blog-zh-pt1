<html>
<head>
<title>Cloud Camera — Simulating a Source</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">云相机-模拟源</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/cloud-camera-simulating-a-source-4e710299606a?source=collection_archive---------7-----------------------#2022-02-03">https://medium.com/oracledevs/cloud-camera-simulating-a-source-4e710299606a?source=collection_archive---------7-----------------------#2022-02-03</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/f40d486df4abdeffad9ea2680d91e4a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*XSSfBmPqBwpX37qkBhOLnw.jpeg"/></div></figure><p id="00bd" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这里发生了一点有趣的事情，计划中的几个即将到来的项目都依赖于接收和处理摄像头馈送的“东西”。当我们谈论相机时，我们主要关注的是通常与Raspberry Pis和其他嵌入式平台一起使用的真正便宜的低功耗相机。相机本身不一定是我们今天在许多智能手机上熟悉的高清数百万像素的奇迹，因为低成本和低功耗是选择相机的一些主要因素。</p><p id="e9b0" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">不管用什么样的摄像机，我们都需要获取视频，并用它做一些事情。我们将把它发送到一个OCI环境中，在那里我们可以分析它、保存它、查看它，等等。跟着我们，你也能做到！；)</p><h1 id="b972" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">硬件问题</h1><p id="7aec" class="pw-post-body-paragraph il im hh in b io ki iq ir is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji ha bi translated">如果你在过去的一年半时间里一直生活在岩石下，那么全球供应链是相当混乱的。这意味着获得一些基本的电子元件，如<a class="ae kn" href="https://www.raspberrypi.com/products/raspberry-pi-4-model-b/" rel="noopener ugc nofollow" target="_blank"> Raspberry Pi 4 Model B </a>(至少一个8GB RAM)是一项艰巨的任务(除非你想从利用这种情况的人那里支付过高的价格)。大多数供应商和零售商只是缺货。最近有没有试过买一台最新的游戏机？是啊……那你全都知道了！这让我开始关注非Pi平台(比如ESP32，我的同事<a class="ae kn" href="https://chrisbensen.medium.com/" rel="noopener">克里斯·本森</a>推荐我看一看)。</p><h1 id="c46a" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">软件是答案</h1><p id="efaf" class="pw-post-body-paragraph il im hh in b io ki iq ir is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji ha bi translated">在此期间，我不想因为没有硬件而耽误事情。我们中有几个人的项目从根本上依赖于接收(和处理)视频源的核心能力。</p><p id="7cf3" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">当然，有硬件当然很好，但是我决定需要一个软件解决方案，这样云(OCI)解决方案就可以被精心制作。这篇文章有点意识流，讲述了我所做的一些决定，以及我如何着手模拟一个源(使用软件)。</p><h1 id="8641" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">决定决定决定</h1><p id="0005" class="pw-post-body-paragraph il im hh in b io ki iq ir is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji ha bi translated">必须做出一些根本性的决定，主要是:</p><p id="7e57" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">网络协议</p><p id="487f" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">编码类型</p><p id="7636" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">让我们更详细地看一下每一项。</p><h1 id="4871" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">网络协议</h1><p id="ca83" class="pw-post-body-paragraph il im hh in b io ki iq ir is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji ha bi translated">TCP是用于许多应用的主要传输层(OSI模型中的第4层)协议。TCP是一个面向连接的协议，并且内置了一些<a class="ae kn" href="https://en.wikipedia.org/wiki/TCP_congestion_control" rel="noopener ugc nofollow" target="_blank">拥塞管理功能</a>。对于许多场景来说，这些都是有益的，有助于应用程序以高效的方式运行。对于其他用例，这是有害的。视频流就是这种情况。</p><p id="a940" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">UDP是无连接的，不会像TCP那样“喋喋不休”。UDP更像是一种“打了就跑”的协议，允许应用程序尽可能快地发送数据报，而无需进一步考虑。拥堵？UDP不关心…它甚至不知道这件事！损失？同样，UDP对此一无所知。这有好有坏。纵观整个互联网，拥塞可能是一个因素。延迟是另一个通配符。是啊，这应该很有趣！</p><p id="ca97" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">做出了推进联合民主党的决定。如果/当拥塞/丢失发生时，我们必须处理它，流中可能会有间隙。这比使用TCP更好，因为这几乎肯定会对数据流产生负面影响(拥塞管理和回退本身很可能是一个反复出现的主题，这是不可取的)。</p><h1 id="a39b" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">编码</h1><p id="b1ca" class="pw-post-body-paragraph il im hh in b io ki iq ir is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji ha bi translated">有几种不同类型的编码可供使用。典型的权衡包括带宽与质量，以及对编码/解码/代码转换操作的CPU的影响。<a class="ae kn" href="https://en.wikipedia.org/wiki/Advanced_Video_Coding" rel="noopener ugc nofollow" target="_blank"> H.264 </a>是一个非常通用的编码标准。幸运的是，一些常见的平台(如<a class="ae kn" href="https://www.raspberrypi.com/documentation/accessories/camera.html#libcamera-vid" rel="noopener ugc nofollow" target="_blank"> Raspberry Pi相机</a>工具)支持H.264，以及其他一些编解码器(如motion JPEG、YUV420等。).由于H.264的广泛采用，以及较低的带宽要求(由于它提供的良好压缩), H.264被选为这个项目的首选编解码器！</p><h1 id="2c99" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">回到软件</h1><p id="27ef" class="pw-post-body-paragraph il im hh in b io ki iq ir is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji ha bi translated">有不同的工具(如<a class="ae kn" href="https://ffmpeg.org/ffmpeg.html" rel="noopener ugc nofollow" target="_blank"> ffmpeg </a>)可以让你流式传输视频。<a class="ae kn" href="https://www.videolan.org/vlc/" rel="noopener ugc nofollow" target="_blank"> VLC </a>提供了一个GUI，也提供了很好的跨平台支持。为了让源和接收者都非常容易，我选择使用VLC。好的方面是，不管H.264流是来自VLC、Pi相机还是任何其他兼容的源，因为我们使用的是H.264，所以用任何其他设备/软件替换该源应该很容易。</p><h1 id="5804" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">准备好云环境</h1><p id="a597" class="pw-post-body-paragraph il im hh in b io ki iq ir is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji ha bi translated">使用位于<a class="ae kn" href="https://github.com/oracle-devrel/terraform-oci-cloud-camera" rel="noopener ugc nofollow" target="_blank">https://github.com/oracle-devrel/terraform-oci-cloud-camera</a>的Terraform项目，将环境部署到OCI。遵循项目自述文件中的说明(使用OCI资源管理器、Terraform CLI、OCI云壳等。)在您的OCI租赁中部署OCI环境。</p><h1 id="a76e" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated"><em class="ko">获得一个OCI永远免费账户</em></h1><p id="2ef4" class="pw-post-body-paragraph il im hh in b io ki iq ir is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji ha bi translated">如果你今天还没有OCI帐户，<a class="ae kn" href="https://www.oracle.com/cloud/free/#always-free?source=:ex:tb:::::WWMK220126P00008&amp;SC=:ex:tb:::::WWMK220126P00008&amp;pcode=WWMK220126P00008" rel="noopener ugc nofollow" target="_blank">在这里</a>注册一个<a class="ae kn" href="https://www.oracle.com/cloud/free/#always-free?source=:ex:tb:::::WWMK220126P00008&amp;SC=:ex:tb:::::WWMK220126P00008&amp;pcode=WWMK220126P00008" rel="noopener ugc nofollow" target="_blank">的</a>。使用一个永远免费的帐户，你不用花一分钱，但可以跟着一起加入乐趣！如果你想快速浏览一下如何做到这一点，请查看<a class="ae kn" rel="noopener" href="/oracledevs/create-an-oracle-always-free-cloud-account-bc6aa82c1397">克里斯的教程</a>。</p><h1 id="0e6d" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">测试它</h1><p id="633e" class="pw-post-body-paragraph il im hh in b io ki iq ir is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji ha bi translated">虽然任何mp4文件都可以使用，但我用<a class="ae kn" href="https://peach.blender.org/download/" rel="noopener ugc nofollow" target="_blank">大巴克兔子</a>进行了测试(使用你喜欢的)。</p><h1 id="8444" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">设置信号源</h1><p id="4b5e" class="pw-post-body-paragraph il im hh in b io ki iq ir is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji ha bi translated">我在源码上启动了VLC，然后进入<em class="jj">文件</em> &gt; <em class="jj">转换/流</em>。在对话框中，我将大兔兔mp4文件拖放到<em class="jj">将媒体放在这里</em>区域。在<em class="jj">选择配置文件</em>下，选择<em class="jj">视频— H.264 + MP3 (MP4) </em>。最后，我点击了<em class="jj">选择目的地</em>区域中的<em class="jj">流</em>按钮。</p><figure class="kp kq kr ks fd ii er es paragraph-image"><div class="er es ie"><img src="../Images/9d9de9021e9ac949497ec152ec0b16ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*wXVKm5rQ_EAlkWNHrF1hYQ.png"/></div></figure><p id="848d" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">然后点击<em class="jj">设置流… </em>按钮:</p><figure class="kp kq kr ks fd ii er es paragraph-image"><div class="er es ie"><img src="../Images/3569722368606afa37f720a526791a7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*E2pyEHUFwP7wHIpPPGXkUg.png"/></div></figure><p id="d9ca" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">选择<em class="jj"> UDP </em>作为类型，输入<em class="jj"> 8100 </em>作为端口(至少这是我选择使用的端口)，并输入您的OCI实例的公共IP地址(这显示为Terraform apply操作的输出):</p><figure class="kp kq kr ks fd ii er es paragraph-image"><div class="er es ie"><img src="../Images/d696797c42637faf333c930069f656cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*FPkHKrNqrvoGpS6tO9gNHg.png"/></div></figure><p id="561b" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">最后点击<em class="jj">应用</em>(关闭对话框)，然后点击<em class="jj">流</em>按钮开始流。</p><h1 id="3cd9" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">在OCI观看视频</h1><p id="5857" class="pw-post-body-paragraph il im hh in b io ki iq ir is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji ha bi translated">连接到OCI计算实例的GUI。您需要通过SSH会话将VNC隧道连接到OCI计算实例。这对你来说可能不一样，但我基本上是这么做的:</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="b92c" class="ky jl hh ku b fi kz la l lb lc">$ ssh -i &lt;path_to_ssh_private_key&gt; -L 5901:localhost:5901 opc@&lt;oci_instance_public_ip&gt;</span></pre><p id="5c6f" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这建立了一个SSH会话，tcp/5901通过该会话建立隧道。这(tcp/5901)恰好是我们的VNC服务器正在监听的，允许我们使用VNC客户端并连接到<em class="jj"> vnc://localhost:5901 </em>。您需要输入您的VNC密码，然后您应该连接并准备继续。</p><p id="607f" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">不考虑VNC连接，让我们在OCI实例上启动VLC(在VNC会话中)，然后转到<em class="jj">媒体</em> &gt; <em class="jj">开放网络流……</em>。在对话框中，打开<em class="jj"> udp://@:8100 </em>。点击<em class="jj">显示更多选项</em>复选框，将<em class="jj"> :demux=h264 </em>添加到<em class="jj">编辑选项</em>文本框中。</p><figure class="kp kq kr ks fd ii er es paragraph-image"><div class="er es ie"><img src="../Images/24b980824b61c0d5fc39c3a8c051e8da.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*86zrFMV9P7pO4BH3qFs6rg.png"/></div></figure><p id="0270" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">点击<em class="jj">播放</em>按钮，观看视频！</p><h1 id="b1ea" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">结论</h1><p id="0301" class="pw-post-body-paragraph il im hh in b io ki iq ir is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji ha bi translated">不要对滞后(延迟)感到震惊和敬畏。这相当糟糕(至少在我的测试中)。部分原因是地理因素(物理距离和由此产生的延迟)以及我试图通过VNC会议观看视频的事实(这可能会引入相当大的延迟)。不太理想，但肯定表明我们的流正在到达OCI实例！</p><p id="1fc3" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">现在，如果我能得到一些硬件！:)不管怎样，在这一点上，我们已经准备好从一个真实的摄像机接收一个流…这是另一个故事，另一个时间。</p></div></div>    
</body>
</html>