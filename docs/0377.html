<html>
<head>
<title>Making the UAMP sample an instant app</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让UAMP样本成为即时应用</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/making-the-uamp-sample-an-instant-app-30c3f0a050af?source=collection_archive---------5-----------------------#2018-12-14">https://medium.com/androiddevelopers/making-the-uamp-sample-an-instant-app-30c3f0a050af?source=collection_archive---------5-----------------------#2018-12-14</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="e2d2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从Android Studio 3.3开始，IDE将为即时应用程序提供工具支持。(在撰写本文时，Android Studio 3.3作为<a class="ae jc" href="https://developer.android.com/studio/preview" rel="noopener ugc nofollow" target="_blank">预览版</a>推出。)在这篇博文中，我们将讲述<a class="ae jc" href="https://github.com/googlesamples/android-UniversalMusicPlayer/commit/fc569696dd5dcaf7a8e1fa6bdeea82b30cf5f9d9" rel="noopener ugc nofollow" target="_blank">将</a><a class="ae jc" href="https://github.com/googlesamples/android-UniversalMusicPlayer" rel="noopener ugc nofollow" target="_blank">通用Android音乐播放器</a> (UAMP)样本转换为即时应用的步骤。对于第一次听说即时应用的人来说，可以看看Android开发者峰会的<a class="ae jc" href="https://www.youtube.com/watch?v=L9J2e5PYXNg" rel="noopener ugc nofollow" target="_blank">会议，或者</a><a class="ae jc" href="https://developer.android.com/topic/google-play-instant/" rel="noopener ugc nofollow" target="_blank">阅读之前发布的关于这个主题的文档</a>。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/57f674e4e865a5aa312a8c5bc71f87ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*c_CwU7uNVestpB4t"/></div></figure><h1 id="45c2" class="jl jm hh bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">要求</h1><p id="81a5" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">要在不使用命令行的情况下构建和部署即时应用，我们至少需要Android Studio 3.3。非常重要的是<strong class="ig hi">也要更新Android Gradle插件以匹配Android Studio的版本。例如，在撰写本文时，Android Studio是3.3版本的RC1——所以我们使用了下面的Gradle插件版本:<code class="du ko kp kq kr b">com.android.tools.build:gradle:3.3.0-rc01</code>。</strong></p><h1 id="9d55" class="jl jm hh bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">更新清单</h1><p id="0b30" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">在清单的应用程序标签中，我们需要添加<code class="du ko kp kq kr b">&lt;dist:module dist:instant=”true” /&gt;</code>。我们可能会看到一个错误，说明“名称空间‘dist’未绑定”，在这种情况下，我们需要将<code class="du ko kp kq kr b">xmlns:dist=”<a class="ae jc" href="http://schemas.android.com/apk/distribution" rel="noopener ugc nofollow" target="_blank">http://schemas.android.com/apk/distribution</a>"</code>添加到根清单标签中。或者，我们可以按照Android Studio的提示自动为我们解决错误。</p><p id="3b83" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们还可以添加意图过滤器来处理与我们的应用程序相关联的URL的视图意图，尽管这不是触发即时应用程序启动的唯一方式。对于UAMP，更新版本的清单如下所示:</p><pre class="je jf jg jh fd ks kr kt ku aw kv bi"><span id="0450" class="kw jm hh kr b fi kx ky l kz la">&lt;application ...&gt;</span><span id="4eef" class="kw jm hh kr b fi lb ky l kz la">    &lt;!-- Enable instant app support --&gt;<br/>    &lt;dist:module dist:instant="true" /&gt;</span><span id="9438" class="kw jm hh kr b fi lb ky l kz la">&lt;activity android:name=".MainActivity"&gt;<br/>        &lt;intent-filter&gt;<br/>            &lt;action android:name="android.intent.action.MAIN" /&gt;<br/>            &lt;category android:name="android.intent.category.LAUNCHER" /&gt;<br/>        &lt;/intent-filter&gt;</span><span id="c3ed" class="kw jm hh kr b fi lb ky l kz la">&lt;!-- App links for http --&gt;<br/>        &lt;intent-filter android:autoVerify="true"&gt;<br/>            &lt;action android:name="android.intent.action.VIEW" /&gt;<br/>            &lt;category android:name="android.intent.category.DEFAULT" /&gt;<br/>            &lt;category android:name="android.intent.category.BROWSABLE" /&gt;<br/>            &lt;data<br/>                android:scheme="http"<br/>                android:host="example.android.com"<br/>                android:pathPattern="/uamp" /&gt;<br/>        &lt;/intent-filter&gt;</span><span id="63e5" class="kw jm hh kr b fi lb ky l kz la">&lt;!-- App links for https --&gt;<br/>        &lt;intent-filter android:autoVerify="true"&gt;<br/>            &lt;action android:name="android.intent.action.VIEW" /&gt;<br/>            &lt;category android:name="android.intent.category.DEFAULT" /&gt;<br/>            &lt;category android:name="android.intent.category.BROWSABLE" /&gt;<br/>            &lt;data<br/>                android:scheme="https"<br/>                android:host="example.android.com"<br/>                android:pathPattern="/uamp" /&gt;<br/>        &lt;/intent-filter&gt;<br/>    &lt;/activity&gt;<br/>&lt;/application&gt;</span></pre><h1 id="5f96" class="jl jm hh bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">构建和部署即时启用的捆绑包</h1><p id="7b5d" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">我们可以遵循<a class="ae jc" href="https://developer.android.com/topic/google-play-instant/getting-started/instant-enabled-app-bundle" rel="noopener ugc nofollow" target="_blank"> Google Play即时文档</a>中解释的过程，但是我们可以在Android Studio中更改运行配置。要启用部署为即时应用程序，我们可以选中<strong class="ig hi">部署为即时应用程序</strong>复选框，如下图所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es lc"><img src="../Images/43aad707f845efbdbd6c8cb219c954c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bCe1OhjN7ZVbv2eC"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx">Enable app deployment as an instant app using the Android Studio UI</figcaption></figure><p id="175c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，剩下要做的就是点击Android Studio中非常令人满意的<strong class="ig hi">运行</strong>按钮，如果前面的所有步骤都正确完成，就可以看到即时应用程序被自动部署和启动了！</p><p id="e237" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这一步之后，我们将不会看到我们的应用程序列在启动器的任何地方。要找到它，我们必须进入<strong class="ig hi">设置&gt;应用</strong>，这里列出了已部署的即时应用:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es ll"><img src="../Images/17af52c62a8a009a75614dcc40221298.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YnFwtzi2bG-cSPuZ"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx">Instant app info under Settings &gt; Apps</figcaption></figure><h1 id="14f3" class="jl jm hh bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">启动即时应用程序</h1><p id="19d3" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">Android将以多种方式触发即时应用的推出。在与Play Store相关的机制之外，启动即时应用程序通常是通过向清单中定义为意图过滤器的URL之一发送ACTION_VIEW来完成的。对于UAMP，运行以下ADB命令会触发我们的应用程序:</p><pre class="je jf jg jh fd ks kr kt ku aw kv bi"><span id="4a76" class="kw jm hh kr b fi kx ky l kz la">adb shell am start -a android.intent.action.VIEW "<a class="ae jc" href="https://example.android.com/uamp" rel="noopener ugc nofollow" target="_blank">https://example.android.com/uamp</a>"</span></pre><p id="b6cd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然而，Android也会建议从任何其他从URL触发ACTION_VIEW的应用程序启动我们的应用程序，这基本上是除了web浏览器之外的每个应用程序:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="er es lm"><img src="../Images/306067518b82e63530ba34c8b84c7ceb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LMIwDW_RUMO6PtKc"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx">UAMP is launched when the <strong class="bd jn">Open</strong> button is pressed</figcaption></figure><p id="e200" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有关应用程序链接的更多信息，请参见该主题的<a class="ae jc" href="https://developer.android.com/training/app-links/instant-app-links" rel="noopener ugc nofollow" target="_blank">相关文档</a>，包括如何<a class="ae jc" href="https://developer.android.com/training/app-links/verify-site-associations" rel="noopener ugc nofollow" target="_blank">验证您的应用程序处理的链接</a>的所有权。</p><h1 id="b073" class="jl jm hh bd jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki bi translated">已知问题</h1><p id="40b2" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">对于运行API级别28的设备(或仿真器)，当我们清除<strong class="ig hi">部署为即时应用</strong>复选框并尝试再次部署时，会出现以下错误:</p><pre class="je jf jg jh fd ks kr kt ku aw kv bi"><span id="b09d" class="kw jm hh kr b fi kx ky l kz la">Error while executing: am start -n “com.example.android.uamp.next/com.example.android.uamp.MainActivity” -a android.intent.action.MAIN -c android.intent.category.LAUNCHER</span><span id="0cbd" class="kw jm hh kr b fi lb ky l kz la">Starting: Intent { act=android.intent.action.MAIN cat=[android.intent.category.LAUNCHER] cmp=com.example.android.uamp.next/com.example.android.uamp.MainActivity }</span><span id="f9d5" class="kw jm hh kr b fi lb ky l kz la">Error type 3</span><span id="e3cd" class="kw jm hh kr b fi lb ky l kz la">Error: Activity class {com.example.android.uamp.next/com.example.android.uamp.MainActivity} does not exist.</span><span id="2ba7" class="kw jm hh kr b fi lb ky l kz la">Error while Launching activity</span></pre><p id="9002" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">解决方案是从设备上删除即时应用程序，要么从设备或模拟器上的<strong class="ig hi">设置&gt;应用程序</strong>菜单中删除，要么从Android Studio终端标签中运行<code class="du ko kp kq kr b">./gradlew uninstallAll</code>。</p></div></div>    
</body>
</html>