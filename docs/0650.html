<html>
<head>
<title>Updating your widget for Android 12</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为Android 12更新您的widget</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/updating-your-widget-for-android-12-92e7de87424c?source=collection_archive---------1-----------------------#2021-07-22">https://medium.com/androiddevelopers/updating-your-widget-for-android-12-92e7de87424c?source=collection_archive---------1-----------------------#2021-07-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/e69f6f2ced24dad4dae2d02652ee040c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TVdM3xU44wzY4T_vvbp-jQ.png"/></div></div></figure><div class=""/><p id="db2d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">长期以来，微件一直是Android核心体验的一部分，许多应用程序有效地使用微件来增加用户参与度。用户喜欢小工具，因为它能够在不启动应用程序的情况下使用应用程序功能，并定制他们设备的主屏幕。</p><p id="a03f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Android 12对现有的widget APIs进行了更新，并修改了widget的设计，以符合“<a class="ae jn" href="https://material.io/blog/announcing-material-you" rel="noopener ugc nofollow" target="_blank"> Material You </a>”设计语言。这些变化允许您构建更好看的小部件，这些小部件使用设备主题颜色和圆角，同时增强搜索和放置小部件的可发现性和视觉效果。</p><figure class="jp jq jr js fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es jo"><img src="../Images/3238be6518fdaf107e74b7373f2fbe02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fpYlDrpwu1Jko0gx"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx">Before changes (Android 11) vs. after changes with light and dark theme (Android 12)</figcaption></figure><p id="517b" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这个迷你系列文章中，我们将看看如何为Android 12更新您的小部件。在这一部分，我们将看到一些简单的变化，这将使您的小工具在运行Android 12的设备上看起来很棒，同时也提供了在旧版本Android上的一致体验。在第二部分中，我们将看看新的API，它们将使您的小部件更加个性化，响应更快，并提供更多的交互性。</p><h1 id="b009" class="jx jy hs bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">视觉变化</h1><p id="9cec" class="pw-post-body-paragraph ip iq hs ir b is kv iu iv iw kw iy iz ja kx jc jd je ky jg jh ji kz jk jl jm ha bi translated">毫无疑问，风格和设计的变化是用户最容易看到的。更新视觉元素，如颜色和圆角半径，可立即呈现更清新的外观。要开始实施这些更改，我们建议创建一个自定义主题。</p><h2 id="30e7" class="la jy hs bd jz lb lc ld kd le lf lg kh ja lh li kl je lj lk kp ji ll lm kt ln bi translated">添加动态颜色</h2><p id="6fe4" class="pw-post-body-paragraph ip iq hs ir b is kv iu iv iw kw iy iz ja kx jc jd je ky jg jh ji kz jk jl jm ha bi translated"><a class="ae jn" href="https://www.youtube.com/watch?v=rLKtIGY2Mgc" rel="noopener ugc nofollow" target="_blank"> Material You </a>旨在提供更加个性化的用户体验。在Android 12中，动态颜色可以让您的小部件与其他小部件和系统更加一致。小部件可以使用系统的默认主题<code class="du lo lp lq lr b">Theme.DeviceDefault.DayNight</code>，并在小部件的UI元素上使用主题颜色属性。</p><p id="8062" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为此，您需要为低于31的版本从父级<code class="du lo lp lq lr b">DeviceDefault</code>创建一个自定义主题。</p><pre class="jp jq jr js fd ls lr lt lu aw lv bi"><span id="42e7" class="la jy hs lr b fi lw lx l ly lz"><a class="ae jn" href="https://github.com/android/user-interface-samples/blob/main/AppWidget/app/src/main/res/values/themes.xml" rel="noopener ugc nofollow" target="_blank"><em class="ma">values/themes.xml</em></a><em class="ma"><br/></em>&lt;!-- Copyright 2019 Google LLC.<br/>SPDX-License-Identifier: Apache-2.0 --&gt;</span><span id="deaa" class="la jy hs lr b fi mb lx l ly lz">&lt;style name="Theme.AppWidget.AppWidgetContainer" <br/>    parent="@android:style/Theme.DeviceDefault" /&gt;</span></pre><p id="6b4c" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">对于版本31，使用父主题<code class="du lo lp lq lr b">DeviceDefault.DayNight</code>创建一个自定义主题。</p><pre class="jp jq jr js fd ls lr lt lu aw lv bi"><span id="b4dd" class="la jy hs lr b fi lw lx l ly lz"><a class="ae jn" href="https://github.com/android/user-interface-samples/blob/main/AppWidget/app/src/main/res/values-v31/themes.xml" rel="noopener ugc nofollow" target="_blank"><em class="ma">values-v31/themes.xml</em></a><em class="ma"><br/></em>&lt;!-- Copyright 2019 Google LLC.<br/>SPDX-License-Identifier: Apache-2.0 --&gt;</span><span id="7e7e" class="la jy hs lr b fi mb lx l ly lz">&lt;style name="Theme.AppWidget.AppWidgetContainer"  <br/>    parent="@android:style/Theme.DeviceDefault.DayNight" /&gt;</span></pre><blockquote class="mc md me"><p id="d92d" class="ip iq ma ir b is it iu iv iw ix iy iz mf jb jc jd mg jf jg jh mh jj jk jl jm ha bi translated">或者，如果你的应用程序使用材料组件，你可以使用<code class="du lo lp lq lr b">Theme.MaterialComponents.DayNight</code>而不是<code class="du lo lp lq lr b">Theme.DeviceDefault</code>作为基本主题。</p></blockquote><p id="b3c5" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要让您的小部件动态采用系统颜色，请将该主题分配给您的小部件，并在其他视图上使用主题颜色属性。</p><pre class="jp jq jr js fd ls lr lt lu aw lv bi"><span id="4728" class="la jy hs lr b fi lw lx l ly lz"><a class="ae jn" href="https://github.com/android/user-interface-samples/blob/main/AppWidget/app/src/main/res/layout/widget_checkbox_list_title_region.xml" rel="noopener ugc nofollow" target="_blank"><em class="ma">layout/widget_checkbox_list_title_region.xml</em></a><em class="ma"><br/></em>&lt;!-- Copyright 2019 Google LLC.<br/>SPDX-License-Identifier: Apache-2.0 --&gt;</span><span id="e926" class="la jy hs lr b fi mb lx l ly lz">...<br/>&lt;TextView android:id="@+id/checkbox_list_title"<br/>    android:layout_width="0dp"<br/>    android:layout_height="wrap_content"     <br/>    android:layout_gravity="center_vertical" <br/>    android:layout_marginStart="8dp" <br/>    android:layout_weight="1" <br/>    android:text="@string/grocery_list" <br/>    android:textColor="<strong class="lr ht">?android:attr/textColorPrimary</strong>" /&gt;</span><span id="46f5" class="la jy hs lr b fi mb lx l ly lz">&lt;ImageButton<br/>    android:layout_width="@dimen/widget_element_min_length"<br/>    android:layout_height="@dimen/widget_element_min_length"<br/>    android:background="?android:attr/selectableItemBackground"<br/>    android:clickable="true"<br/>    android:contentDescription="@string/add_button_grocery_list_content_description"<br/>    android:src="@drawable/ic_add_24"<br/>    android:tint="<strong class="lr ht">?android:attr/colorAccent</strong>" /&gt;</span><span id="821b" class="la jy hs lr b fi mb lx l ly lz"><strong class="lr ht">...</strong></span></pre><figure class="jp jq jr js fd hj er es paragraph-image"><div class="ab fe cl mi"><img src="../Images/0da2e4a2264ea34d5ddb21640e08bb27.png" data-original-src="https://miro.medium.com/v2/0*OLheXzW3PC5rDYCN"/></div><figcaption class="jt ju et er es jv jw bd b be z dx">Static colors vs. dynamic colors in light/dark theme</figcaption></figure><h2 id="def8" class="la jy hs bd jz lb lc ld kd le lf lg kh ja lh li kl je lj lk kp ji ll lm kt ln bi translated">圆角</h2><p id="b8d9" class="pw-post-body-paragraph ip iq hs ir b is kv iu iv iw kw iy iz ja kx jc jd je ky jg jh ji kz jk jl jm ha bi translated">从Android 12开始，圆角自动应用于小部件。这意味着小部件的内容可能会被应用的角遮罩剪掉。为了避免这种情况，并为其他小部件和系统提供更一致的外观和用户体验，您可以使用<code class="du lo lp lq lr b"><a class="ae jn" href="https://developer.android.com/reference/android/R.dimen#system_app_widget_background_radius" rel="noopener ugc nofollow" target="_blank">system_app_widget_background_radius</a></code>为小部件的轮廓添加圆角，使用<code class="du lo lp lq lr b"><a class="ae jn" href="https://developer.android.com/reference/android/R.dimen#system_app_widget_inner_radius" rel="noopener ugc nofollow" target="_blank">system_app_widget_inner_radius</a></code>为小部件内的视图添加圆角。这个值应该比<code class="du lo lp lq lr b">system_app_widget_background_radius</code>小8dp。</p><p id="5d5f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这样做的时候，请记住，如果您的小部件在其角落附近有内容，这些内容可能会被裁剪。要解决这个问题，您需要添加足够的填充，以避免小部件的内容与圆角发生冲突。</p><pre class="jp jq jr js fd ls lr lt lu aw lv bi"><span id="2ade" class="la jy hs lr b fi lw lx l ly lz"><a class="ae jn" href="https://github.com/android/user-interface-samples/blob/main/AppWidget/app/src/main/res/values/attrs.xml" rel="noopener ugc nofollow" target="_blank"><em class="ma">values/attrs.xml</em></a><em class="ma"><br/></em>&lt;!-- Copyright 2019 Google LLC.<br/>SPDX-License-Identifier: Apache-2.0 --&gt;</span><span id="f4eb" class="la jy hs lr b fi mb lx l ly lz">&lt;declare-styleable name="AppWidgetAttrs"&gt;<br/>    &lt;attr name="<strong class="lr ht">appWidgetPadding</strong>" format="dimension" /&gt;    <br/>    &lt;attr name="<strong class="lr ht">appWidgetInnerRadius</strong>" format="dimension" /&gt;<br/>    &lt;attr name="<strong class="lr ht">appWidgetRadius</strong>" format="dimension" /&gt;<br/>&lt;/declare-styleable&gt;</span><span id="30c6" class="la jy hs lr b fi mb lx l ly lz"><a class="ae jn" href="https://github.com/android/user-interface-samples/blob/main/AppWidget/app/src/main/res/values/themes.xml" rel="noopener ugc nofollow" target="_blank"><em class="ma">values/themes.xml</em></a><em class="ma"><br/></em>&lt;!-- Copyright 2019 Google LLC.<br/>SPDX-License-Identifier: Apache-2.0 --&gt;</span><span id="19d6" class="la jy hs lr b fi mb lx l ly lz">&lt;style name="Theme.AppWidget.AppWidgetContainerParent" <br/>    parent="@android:style/Theme.DeviceDefault"&gt;</span><span id="c8de" class="la jy hs lr b fi mb lx l ly lz">    &lt;!-- Radius of the outer bound of widgets to make the rounded   <br/>        corners --&gt;<br/>    &lt;item name="<strong class="lr ht">appWidgetRadius</strong>"&gt;<strong class="lr ht">16dp</strong>&lt;/item&gt;<br/>    &lt;!-- Radius of the inner view's bound of widgets to make the rounded corners. It needs to be 8dp or less than the value of appWidgetRadius --&gt;<br/>    &lt;item name="<strong class="lr ht">appWidgetInnerRadius</strong>"&gt;<strong class="lr ht">8dp</strong>&lt;/item&gt;<br/>&lt;/style&gt;</span><span id="16f4" class="la jy hs lr b fi mb lx l ly lz">&lt;style name="Theme.AppWidget.AppWidgetContainer" <br/>    parent="Theme.AppWidget.AppWidgetContainerParent"&gt;</span><span id="756b" class="la jy hs lr b fi mb lx l ly lz">    &lt;!-- Apply padding to avoid the content of the widget colliding with the rounded corners --&gt;<br/>    &lt;item name="<strong class="lr ht">appWidgetPadding</strong>"&gt;<strong class="lr ht">16dp</strong>&lt;/item&gt;<br/>&lt;/style&gt;</span><span id="7033" class="la jy hs lr b fi mb lx l ly lz"><a class="ae jn" href="https://github.com/android/user-interface-samples/blob/main/AppWidget/app/src/main/res/values-v31/themes.xml" rel="noopener ugc nofollow" target="_blank"><em class="ma">values-v31/themes.xml</em></a><em class="ma"><br/></em>&lt;!-- Copyright 2019 Google LLC.<br/>SPDX-License-Identifier: Apache-2.0 --&gt;</span><span id="ca2c" class="la jy hs lr b fi mb lx l ly lz">&lt;style name="Theme.AppWidget.AppWidgetContainerParent" <br/>    parent="@android:style/Theme.DeviceDefault.DayNight"&gt; <br/>    &lt;item name="<strong class="lr ht">appWidgetRadius</strong>"&gt;<br/>        @android:dimen/<strong class="lr ht">system_app_widget_background_radius</strong>&lt;/item&gt;      <br/>    &lt;item name="<strong class="lr ht">appWidgetInnerRadius</strong>"&gt;<br/>        @android:dimen/<strong class="lr ht">system_app_widget_inner_radius</strong>&lt;/item&gt;<br/>&lt;/style&gt;</span><span id="704c" class="la jy hs lr b fi mb lx l ly lz"><a class="ae jn" href="https://github.com/android/user-interface-samples/blob/main/AppWidget/app/src/main/res/values/styles.xml" rel="noopener ugc nofollow" target="_blank"><em class="ma">values/styles.xml</em></a><em class="ma"><br/></em>&lt;!-- Copyright 2019 Google LLC.<br/>SPDX-License-Identifier: Apache-2.0 --&gt;</span><span id="3c94" class="la jy hs lr b fi mb lx l ly lz">&lt;style name="Widget.AppWidget.AppWidget.Container" <br/>    parent="android:Widget"&gt;<br/>    &lt;item name="android:id"&gt;@android:id/background&lt;/item&gt;<br/>    &lt;item name="android:background"&gt;<br/>        ?android:attr/colorBackground&lt;/item&gt;<br/>&lt;/style&gt;</span></pre><blockquote class="mc md me"><p id="c3ad" class="ip iq ma ir b is it iu iv iw ix iy iz mf jb jc jd mg jf jg jh mh jj jk jl jm ha bi translated">如果你的<code class="du lo lp lq lr b">minTargetSDK</code>低于版本21，你需要提供版本21的样式，因为drawables中使用的<code class="du lo lp lq lr b">android:attr/colorBackground </code>需要API等级21。</p></blockquote><p id="e084" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在您已经创建了一个主题，您可以在小部件的布局上设置样式。</p><pre class="jp jq jr js fd ls lr lt lu aw lv bi"><span id="dc36" class="la jy hs lr b fi lw lx l ly lz"><a class="ae jn" href="https://github.com/android/user-interface-samples/blob/main/AppWidget/app/src/main/res/layout/widget_grocery_list.xml" rel="noopener ugc nofollow" target="_blank"><em class="ma">layout/widget_grocery_list.xml</em></a><em class="ma"><br/></em>&lt;!-- Copyright 2019 Google LLC.<br/>SPDX-License-Identifier: Apache-2.0 --&gt;</span><span id="53a5" class="la jy hs lr b fi mb lx l ly lz">&lt;LinearLayout<br/>    <strong class="lr ht">style="@style/Widget.AppWidget.AppWidget.Container"</strong>&gt;<br/>    ...<br/>&lt;/LinearLayout&gt;</span></pre><figure class="jp jq jr js fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mj"><img src="../Images/0626fc5a1d7e82e66aedbd41efc20f24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*t8ZZu_Nsw1V2I1lD"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx">Before vs. automatic corner masking vs. rounded corners and applied padding</figcaption></figure><h2 id="2f87" class="la jy hs bd jz lb lc ld kd le lf lg kh ja lh li kl je lj lk kp ji ll lm kt ln bi translated">过渡</h2><p id="da95" class="pw-post-body-paragraph ip iq hs ir b is kv iu iv iw kw iy iz ja kx jc jd je ky jg jh ji kz jk jl jm ha bi translated">当一个应用程序从一个小部件启动时，Android 12提供了改进的过渡。这种过渡由系统自动处理，不会在旧版本的Android上显示。要实现这一点，您需要在小部件布局的根元素上指定一个<code class="du lo lp lq lr b">id</code>，并将其值设置为<code class="du lo lp lq lr b">android:id/background</code>。</p><pre class="jp jq jr js fd ls lr lt lu aw lv bi"><span id="cd5f" class="la jy hs lr b fi lw lx l ly lz">&lt;LinearLayout<br/>    <strong class="lr ht">android:id="@android:id/background"</strong>&gt;<br/>    ...<br/>&lt;/LinearLayout&gt;</span></pre><figure class="jp jq jr js fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mk"><img src="../Images/ca6808b7d28482c5e9cf7a3c9717057a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ybgnQrfrJ2DBsPOP"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx">Transition in slow motion</figcaption></figure><p id="5faa" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您的小部件使用<a class="ae jn" href="https://developer.android.com/about/versions/12/behavior-changes-12?hl=ca#notification-trampolines" rel="noopener ugc nofollow" target="_blank">广播蹦床</a>，这意味着您的小部件在用户点击时创建一个<code class="du lo lp lq lr b">PendingIntent</code>来启动来自广播接收器或服务的活动，则该动画将不会被使用。</p><h1 id="2ae9" class="jx jy hs bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">新的小部件选择器改进</h1><h2 id="d1aa" class="la jy hs bd jz lb lc ld kd le lf lg kh ja lh li kl je lj lk kp ji ll lm kt ln bi translated">试映</h2><p id="b5ad" class="pw-post-body-paragraph ip iq hs ir b is kv iu iv iw kw iy iz ja kx jc jd je ky jg jh ji kz jk jl jm ha bi translated">Android 12有一个新的改进的小工具选择器。新的小部件选择器使用XML布局来动态创建小部件的缩放预览，而不是使用静态的可绘制资源。</p><p id="d80b" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您的小部件不包含动态元素，如<code class="du lo lp lq lr b">ListView</code>或<code class="du lo lp lq lr b">GridView</code>，您可以简单地使用小部件的布局进行预览。</p><p id="45bc" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要做到这一点，您需要将默认值直接设置为原始布局。</p><pre class="jp jq jr js fd ls lr lt lu aw lv bi"><span id="dedd" class="la jy hs lr b fi lw lx l ly lz">&lt;!-- Copyright 2019 Google LLC.<br/>SPDX-License-Identifier: Apache-2.0 --&gt;</span><span id="830c" class="la jy hs lr b fi mb lx l ly lz">&lt;TextView<br/>    style="@style/Widget.AppWidget.Checkbox"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="wrap_content"<br/>    android:text="<strong class="lr ht">@string/widget_title_preview</strong>" /&gt;</span><span id="dfca" class="la jy hs lr b fi mb lx l ly lz">&lt;TextView<br/>    style="@style/Widget.AppWidget.Checkbox"<br/>    android:layout_width="match_parent"<br/>    android:layout_height="wrap_content"<br/>    android:text="<strong class="lr ht">@string/widget_subject_preview</strong>" /&gt;</span></pre><p id="9182" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在布局上设置默认值可能会导致在应用真实值之前显示假占位符值的轻微延迟。为了防止这种情况，您也可以为预览创建一个单独的布局文件，并应用自定义预览主题。</p><pre class="jp jq jr js fd ls lr lt lu aw lv bi"><span id="15c9" class="la jy hs lr b fi lw lx l ly lz">&lt;!-- Copyright 2019 Google LLC.<br/>SPDX-License-Identifier: Apache-2.0 --&gt;</span><span id="16a3" class="la jy hs lr b fi mb lx l ly lz">&lt;resources&gt;<br/>    &lt;!-- Declare attributes --&gt;<br/>    &lt;attr name="<strong class="lr ht">widgetTitlePreview</strong>" format="string" /&gt;<br/>    &lt;attr name="<strong class="lr ht">widgetSubjectPreview</strong>" format="string" /&gt;</span><span id="d17c" class="la jy hs lr b fi mb lx l ly lz">    &lt;!-- Declare styles --&gt;<br/>    &lt;style name="Theme.MyApp.Widget" <br/>        parent="@style/Theme.DeviceDefault.DayNight.AppWidget"&gt;<br/>        &lt;item name="<strong class="lr ht">widgetTitlePreview</strong>"&gt;&lt;/item&gt;<br/>        &lt;item name="<strong class="lr ht">widgetSubjectPreview</strong>"&gt;&lt;/item&gt;<br/>    &lt;/style&gt;</span><span id="c1de" class="la jy hs lr b fi mb lx l ly lz">    &lt;style name="<strong class="lr ht">Theme.MyApp.Widget.Preview</strong>"&gt;<br/>        &lt;item name="<strong class="lr ht">widgetTitlePreview</strong>"&gt;Preview Title&lt;/item&gt;<br/>        &lt;item name="<strong class="lr ht">widgetSubjectPreview</strong>"&gt;Preview Subject&lt;/item&gt;<br/>    &lt;/style&gt;<br/>&lt;/resources&gt;</span></pre><p id="5a14" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">一旦有了预览主题，您就可以将它应用到布局中的预览项目。</p><pre class="jp jq jr js fd ls lr lt lu aw lv bi"><span id="dd1b" class="la jy hs lr b fi lw lx l ly lz"><em class="ma">layout/my_widget_preview.xml<br/></em>&lt;!-- Copyright 2019 Google LLC.<br/>SPDX-License-Identifier: Apache-2.0 --&gt;</span><span id="bbfd" class="la jy hs lr b fi mb lx l ly lz">&lt;LinearLayout ...&gt;<br/>    &lt;include layout="@layout/widget_header"<br/>         android:theme=”<strong class="lr ht">@style/Theme.MyApp.Widget.Preview</strong>” /&gt;&lt;/LinearLayout&gt;</span><span id="928d" class="la jy hs lr b fi mb lx l ly lz"><em class="ma">layout/my_widget_actual.xml</em></span><span id="3b3c" class="la jy hs lr b fi mb lx l ly lz">&lt;LinearLayout ...&gt;<br/>    &lt;include layout="@layout/widget_header"<br/>        android:theme=”<strong class="lr ht">@style/Theme.MyApp.Widget</strong>” /&gt;<br/>&lt;/LinearLayout&gt;</span></pre><p id="8118" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最后，您需要设置小部件的布局，以指定为<code class="du lo lp lq lr b">appwidget-provider</code>的<code class="du lo lp lq lr b">previewLayout</code>属性。</p><pre class="jp jq jr js fd ls lr lt lu aw lv bi"><span id="535d" class="la jy hs lr b fi lw lx l ly lz"><a class="ae jn" href="https://github.com/android/user-interface-samples/blob/main/AppWidget/app/src/main/res/xml/app_widget_info_checkbox_list.xml" rel="noopener ugc nofollow" target="_blank">xml/<em class="ma">app_widget_info_checkbox_list.xml</em></a><em class="ma"><br/></em>&lt;!-- Copyright 2019 Google LLC.<br/>SPDX-License-Identifier: Apache-2.0 --&gt;</span><span id="e716" class="la jy hs lr b fi mb lx l ly lz">&lt;appwidget-provider<br/>    <strong class="lr ht">android:previewLayout="@layout/widget_grocery_list"<br/>    </strong>... <br/>/&gt;</span></pre><figure class="jp jq jr js fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ml"><img src="../Images/e20803d362485f1b85826703032583bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-KfRVBM3VgqQ7A691iojEQ.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx">Static preview vs. scaled preview</figcaption></figure><p id="dee4" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">对于显示在<code class="du lo lp lq lr b">ListView</code>、<code class="du lo lp lq lr b">GridView</code>或<code class="du lo lp lq lr b">Stack</code>中的多个项目，无法直接在布局上设置默认值。在这种情况下，您可以为小部件预览创建另一个布局，并在该布局中设置多个硬编码项目。</p><p id="2952" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这样做时，最好不要复制整个布局，而是使用<code class="du lo lp lq lr b">&lt;include&gt;</code>标签来重用使用默认值的布局部分。您可以将这个新布局设置为<code class="du lo lp lq lr b">appwidget-provider</code>的<code class="du lo lp lq lr b">previewLayout</code>属性。</p><h2 id="9d86" class="la jy hs bd jz lb lc ld kd le lf lg kh ja lh li kl je lj lk kp ji ll lm kt ln bi translated">描述</h2><p id="55d3" class="pw-post-body-paragraph ip iq hs ir b is kv iu iv iw kw iy iz ja kx jc jd je ky jg jh ji kz jk jl jm ha bi translated">您还可以设置<code class="du lo lp lq lr b">description</code>属性来提供要在小部件选择器中显示的描述。虽然这是可选的，但是提供描述可以帮助用户更好地理解您的小部件可以做什么。</p><pre class="jp jq jr js fd ls lr lt lu aw lv bi"><span id="94db" class="la jy hs lr b fi lw lx l ly lz"><em class="ma">app_widget_info_checkbox_list.xml</em><strong class="lr ht"><em class="ma"><br/></em></strong>&lt;!-- Copyright 2019 Google LLC.<br/>SPDX-License-Identifier: Apache-2.0 --&gt;</span><span id="182f" class="la jy hs lr b fi mb lx l ly lz">&lt;appwidget-provider<br/>   <strong class="lr ht">android:description</strong>="<strong class="lr ht">@string/app_widget_grocery_list_description</strong>"<br/>   ... <br/>/&gt;</span></pre><figure class="jp jq jr js fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mm"><img src="../Images/73478c48e24c7f9ed198ead5487ca047.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*WJ0rNM5vSACK4pYEC2lc_A.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx">Widget description</figcaption></figure><h1 id="1769" class="jx jy hs bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">摘要</h1><p id="c417" class="pw-post-body-paragraph ip iq hs ir b is kv iu iv iw kw iy iz ja kx jc jd je ky jg jh ji kz jk jl jm ha bi translated">这并不太难，是吗？在这篇文章中，你看到了如何更新你的小部件的设计，并在小部件选择器中提供更好的用户体验。开始为Android 12更新你的小工具，这些都是非常容易的，你的用户会立即注意到视觉上的不同。</p><p id="a4cd" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">但是，这还不是全部。在下一篇文章中，我们将看看新的API，它们将使您的小部件更加个性化，响应更快，并提供更多的交互性。</p></div></div>    
</body>
</html>