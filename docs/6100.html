<html>
<head>
<title>Building a country and language detection pipeline</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建国家和语言检测管道</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/building-a-country-and-language-detection-pipeline-594041081643?source=collection_archive---------2-----------------------#2016-08-26">https://medium.com/pinterest-engineering/building-a-country-and-language-detection-pipeline-594041081643?source=collection_archive---------2-----------------------#2016-08-26</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="08ac" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">贾雪峰| Pinterest工程师，内容</p><p id="3e3b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">保存到Pinterest的Pin不仅仅是一张图片。保存的750亿个pin中的每一个都是一个可视的书签，有几十个信号，比如它起源的网站，以及它起源的国家和语言。由于超过一半的pinner都在美国以外，我们非常依赖语言和国家检测来帮助pinner发现和参与当地的想法。在这里，我们将分享我们如何在Pinterest上检测和使用语言和国家信号——在搜索、主页订阅、相关pin和主题中——以改善Pinners的体验并推动国际参与。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/066b9d7e412092b7fae2e99758bb0ac0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pzH0CFH_6Na4zKOd.png"/></div></div></figure><h2 id="6fab" class="jo jp hh bd jq jr js jt ju jv jw jx jy ip jz ka kb it kc kd ke ix kf kg kh ki bi translated">检测链接的语言和国家</h2><p id="bbcd" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">我们将一个URL的国家定义为网站的主要受众。类似地，我们将URL的语言定义为该页面的主要语言。我们可以通过多种方法来检测链接的语言和国家，并根据它们的精确度来衡量它们。</p><h2 id="decd" class="jo jp hh bd jq jr js jt ju jv jw jx jy ip jz ka kb it kc kd ke ix kf kg kh ki bi translated">用于语言检测的白名单</h2><p id="442f" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">我们在巴西、日本、法国、德国和英国的当地团队利用他们的专业知识来洞察哪些领域或链接可能在他们各自的国家流行。我们与他们合作，为每个国家编制最受欢迎的域名白名单，以帮助我们更快地检测语言。这些白名单通常非常准确，但需要大量的人工筛选和验证，这使得这种方法难以扩展。</p><h2 id="1d10" class="jo jp hh bd jq jr js jt ju jv jw jx jy ip jz ka kb it kc kd ke ix kf kg kh ki bi translated">携带区域信号的URL</h2><p id="efa2" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">链接的ccTLD、子目录和子域也可以提供关于登陆页面的国家和语言的有用信息。这不是最好的覆盖范围，因为许多链接可能不包含这些信息，但对于我们可以从URL解析ccTLD、子目录或子域的情况，这种方法通常工作得很好。</p><h2 id="4b9a" class="jo jp hh bd jq jr js jt ju jv jw jx jy ip jz ka kb it kc kd ke ix kf kg kh ki bi translated">平纳交战信号</h2><p id="da19" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">虽然我们在确定网站的语言和国家时会努力优化客观信号，但有时非客观信号也会产生有用的信息。例如，我们可以识别某个链接是否被来自特定国家或语言的Pin用户交互最多，并推断Pin的国家和语言。</p><p id="a18a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们考虑的两个主观信号是，当用户从网站上保存Pin或点击Pin进入其登录页面时。由于这些都是主观信号，它们没有恒星的准确率，但仍然有助于我们对许多网址进行分类，否则我们几乎没有信息。</p><h2 id="614c" class="jo jp hh bd jq jr js jt ju jv jw jx jy ip jz ka kb it kc kd ke ix kf kg kh ki bi translated">HTML内容</h2><p id="c319" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">只要能够正确解析，页面的实际HTML包含大量信息。我们内部的HTML解析器从登录页面获取原始HTML，并提取各种元数据，如HTML语言标签、描述、标题和标题。然后，我们可以将该文本传递到我们内部的文本处理库中，尝试检测页面的语言。几乎所有的网页都包含一些HTML，所以这种方法给了我们相当高的精确度和覆盖率。</p><h2 id="c582" class="jo jp hh bd jq jr js jt ju jv jw jx jy ip jz ka kb it kc kd ke ix kf kg kh ki bi translated">聚类推理</h2><p id="9f88" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">即使一个页面本身提供给我们的有用信息非常少，我们仍然可以确定该页面的语言或国家。我们可以进行聚类推断，这是一种类似于<a class="ae ko" href="https://en.wikipedia.org/wiki/K-nearest_neighbors_algorithm" rel="noopener ugc nofollow" target="_blank">k-最近邻算法</a>的方法。如果我们可以将共享相同域或路径的其他链接的语言或国家分类为未分类链接，并且如果这些分类链接的语言或国家基本一致，那么我们可以假设我们一无所知的链接使用该语言或来自该国家。</p><h2 id="f2c5" class="jo jp hh bd jq jr js jt ju jv jw jx jy ip jz ka kb it kc kd ke ix kf kg kh ki bi translated">IP地理定位</h2><p id="a0f7" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">网页的IP地址也包含关于链接的潜在国家的有用信息。我们使用第三方IP地理位置查找服务<a class="ae ko" href="https://www.maxmind.com/en/home" rel="noopener ugc nofollow" target="_blank"> MaxMind </a>来确定链接的IP地址所在的地区或国家。每个网站都有一个IP地址，但网站几乎可以托管在任何地方。因此，这种方法有100%的覆盖率，但准确性较低，所以当我们不能使用任何其他方法对链接进行分类时，它可以作为一种总括方法。</p><h2 id="f6eb" class="jo jp hh bd jq jr js jt ju jv jw jx jy ip jz ka kb it kc kd ke ix kf kg kh ki bi translated">测量质量</h2><p id="cdaf" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">在语言和国家检测方面，最直接的成功衡量标准是我们的准确率和召回率。精度很容易计算。我们所要做的就是从我们想了解更多的每个国家的链接中抽取一个样本，并找出我们正确的部分。我们一般是通过亚马逊Mechanical Turk或者CrowdFlower进行人工评估来做到这一点的。</p><p id="c58d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">召回率更难衡量，因为国际链接的比例远低于美国网站。我们的解决方案是首先估计来自我们找到的语言或国家的链接的数量，方法是将标记链接的总数乘以该语言或国家的精确率。然后，我们通过抽取所有其他链接的样本并运行人工评估来估计我们错过的链接的百分比。将这个百分比乘以未标记链接的数量，我们就可以估计出我们错过了多少链接。给定我们找到的链接的数量和我们错过的链接的数量，计算召回率可以通过一个简单的等式来完成。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es kp"><img src="../Images/d964bb442939ed0d1112fdf1915c2223.png" data-original-src="https://miro.medium.com/v2/resize:fit:556/format:webp/0*g22y2_ZQY4ACdBIa.png"/></div></figure><h2 id="4685" class="jo jp hh bd jq jr js jt ju jv jw jx jy ip jz ka kb it kc kd ke ix kf kg kh ki bi translated">经验教训</h2><p id="ed10" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">当试图建立一个强大的语言和国家检测管道时，我们发现最佳方法是使用许多不同的技术，从机器学习到文本处理，以及各种各样的客观和主观信号。所有这些方面加在一起比任何一个单独的元素都要好得多。通过这些不同的方法，我们实现了高水平的精确度和召回率，并在推动本地参与或国际增长方面发挥了关键作用。</p><h2 id="96b4" class="jo jp hh bd jq jr js jt ju jv jw jx jy ip jz ka kb it kc kd ke ix kf kg kh ki bi translated">展望未来</h2><p id="3a90" class="pw-post-body-paragraph ie if hh ig b ih kj ij ik il kk in io ip kl ir is it km iv iw ix kn iz ja jb ha bi translated">要改善我们的国家和语言检测渠道，还有很多工作要做，包括将语言和国家检测扩展到所有国家和语言。其他关注领域可能包括将本地实体检测添加到我们的HTML解析器中，以根据公共信息(如“联系我”页面的地址，或页面上可能出现的货币和地标)来识别网页的来源国。我们还可以添加对多语言网站的支持，以及那些检测用户语言或国家的网站，并将它们重定向到页面的适当版本。如果这些问题中有任何一个听起来很有趣，那么<a class="ae ko" href="https://careers.pinterest.com/careers/engineering" rel="noopener ugc nofollow" target="_blank">加入我们</a>！</p><p id="b356" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="kq">鸣谢:感谢徐快、Anna Markowska和John Milinovich对登录页面国家和语言检测流程的指导和宝贵贡献。</em></p></div></div>    
</body>
</html>