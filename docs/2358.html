<html>
<head>
<title>Men-dockerize Aplikasi Golang</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Men-dockerize Aplikasi Golang</h1>
<blockquote>åŽŸæ–‡ï¼š<a href="https://medium.easyread.co/men-dockerize-aplikasi-golang-9c32959c657e?source=collection_archive---------0-----------------------#2018-12-24">https://medium.easyread.co/men-dockerize-aplikasi-golang-9c32959c657e?source=collection_archive---------0-----------------------#2018-12-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="d1b0" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">Part 5 dari Project <a class="ae kc" href="https://medium.com/easyread/christmas-tale-of-sofware-engineer-project-kube-xmas-9167ebca70d2" rel="noopener"> Kube-Xmas Series </a></h2></div><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi kd"><img src="../Images/f9099ed4d7187f07435e465378b57e79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*sP5X-wXDfN74MkbA"/></div></div><figcaption class="kp kq gj gh gi kr ks bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@vidarnm?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Vidar Nordli-Mathisen</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="5a0f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Haloooo lagi dan lagi ðŸ˜Ž. Masih dibagian dari series ini.</p><p id="8e41" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> Prerequisite: </strong></p><ul class=""><li id="4d91" class="lp lq in kv b kw kx kz la lc lr lg ls lk lt lo lu lv lw lx bi translated">Understand how docker works theoretically</li><li id="ce18" class="lp lq in kv b kw ly kz lz lc ma lg mb lk mc lo lu lv lw lx bi translated">Previous series</li></ul><p id="fc31" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="md"> Nah </em> diseri ini, saya akan fokus di implementasi <em class="md"> source code </em> API. Jika sebelumnya, saya fokus di <em class="md"> mock server </em> , maka kali ini saya fokus di real implementasi dari API berdasarkan OpenAPI 3 <em class="md"> specification </em> yang sudah saya buat sebelumnya.</p><p id="1b09" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="md"> Nah </em> , API mock sudah jalan, maka idealnya <em class="md"> frontend </em> juga sudah mengerjakan aplikasi <em class="md"> frontend </em> berdasarkan spesifikasi API yang telah kita buat. Kalau dalam dunia kerja, saat kita sudah berani memberi <em class="md"> mock server </em> , maka kita sudah komitmen akan menyelesaikan real API nya heheÂ :D</p><p id="02aa" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Singkat cerita, semisal saya sudah menyelesaikan aplikasinya di Golang. Nah, sementara ketika mau deploy aplikasinya dikubernetes. Bagaimana caranya?</p><p id="46b0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Udah jelas sih, pake docker :D. Nah di artikel kali ini, saya menulis langkah mudah untuk mendockerize aplikasi golang saya, agar nantinya bisa dideploy ke Cluster kubernetes yang telah dibuat sebelumnya: Kube-Xmas.</p><h2 id="3f4e" class="me mf in bd mg mh mi dn mj mk ml dp mm lc mn mo mp lg mq mr ms lk mt mu mv mw bi translated">Dockerfile</h2><p id="0226" class="pw-post-body-paragraph kt ku in kv b kw mx jo ky kz my jr lb lc mz le lf lg na li lj lk nb lm ln lo ig bi translated">Hal pertama sebelum mendockerize, adalah kita harus mengerti penggunaan <em class="md"> Dockerfile </em> . Saya akan jelaskan singkat saja, untuk penjelasan lebih lengkap dapat dilihat di documentasi resmi <em class="md"> docker </em> .</p><p id="3301" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="md"> Dockerfile </em> ini berperan sebagai <em class="md"> script </em> intruksi yang akan digunakan oleh <em class="md"> docker command </em> untuk membuat <em class="md"> image-docker </em> kita, yang nantinya bisa dirun di <em class="md"> Kubernetes </em> atau di lokal kita.</p><p id="9643" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Perintah-perintahnya cukup explicit, seperti <code class="fe nc nd ne nf b">COPY</code> , <code class="fe nc nd ne nf b">WORKDIR</code> , <code class="fe nc nd ne nf b">RUN</code> , <code class="fe nc nd ne nf b">EXPOSE</code> , dsb.</p><pre class="ke kf kg kh gt ng nf nh ni aw nj bi"><span id="8088" class="me mf in nf b gy nk nl l nm nn">FROM alpine:latest</span><span id="1f01" class="me mf in nf b gy no nl l nm nn">RUN apk update &amp;&amp; apk upgrade &amp;&amp; \<br/>    apk --no-cache --update add ca-certificates tzdata &amp;&amp; \<br/>    mkdir /app</span><span id="a783" class="me mf in nf b gy no nl l nm nn">WORKDIR /app</span><span id="fc0b" class="me mf in nf b gy no nl l nm nn">EXPOSE 9090</span><span id="42f4" class="me mf in nf b gy no nl l nm nn">COPY engine /app</span><span id="b5b3" class="me mf in nf b gy no nl l nm nn">CMD /app/engine</span></pre><p id="48ed" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Berikut diatas adalah contoh simplenya. Jika menggunakan <em class="md"> dockerfile </em> diatas, tentu pertama kita lakukan adalah membuild aplikasi kita lalu menjalankan <em class="md"> docker </em> -filenya.</p></div><div class="ab cl np nq hr nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ig ih ii ij ik"><p id="db6f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe nc nd ne nf b">FROM</code> : Menyatakan base imagenya. Saya menggunakan <em class="md"> alpine </em> . Linux dengan size terkecil di dunia (10MB). <br/> <code class="fe nc nd ne nf b">RUN</code> : Saya menjalankan <em class="md"> command </em> diterminal <em class="md"> container </em> saya tersebut ketika dibuild <br/> <code class="fe nc nd ne nf b">WORKDIR</code> : Menyatakan <em class="md"> working directory </em> kita didalam <em class="md"> container </em> . <br/> <code class="fe nc nd ne nf b">EXPOSE</code> : Menyatakan <em class="md"> port </em> yang <em class="md"> diexpose </em> oleh <em class="md"> container </em> kita <br/> <code class="fe nc nd ne nf b">COPY</code> : Menyatakan membuat salinan file <em class="md"> engine </em> dari laptop kita ke folder <code class="fe nc nd ne nf b">/app</code> di container. <br/> <code class="fe nc nd ne nf b">CMD /app/engine</code> : Menyatakan <em class="md"> command </em> yang akan diakses ketika menjalankan <em class="md"> container </em> kita.</p></div><div class="ab cl np nq hr nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ig ih ii ij ik"><p id="865f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="md"> Nah </em> jika dilihat kembali dengan seksama, <em class="md"> Dockerfile </em> diatas mengharuskan kita untuk membuild <em class="md"> binary engine </em> dulu sebelum di <em class="md"> dockerize </em> . Sehingga untuk men-dokerizenya, kita akan build dulu aplikasi golang tersebut. Lalu menambahkannya kedalam image. Dan image ini yang akan dijalankan oleh Kubernetes.</p><pre class="ke kf kg kh gt ng nf nh ni aw nj bi"><span id="2e78" class="me mf in nf b gy nk nl l nm nn">$ go build -o engine main.go<br/>$ docker build . -t bxcodec/tweetor</span></pre><p id="2369" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Sampai disini, seharusnya kita sudah berhasil membuat docker-image yang isinya adalah aplikasi kita.</p><p id="e2c9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Selanjutnya adalah menambahkannya ke docker-registry. Untuk kasus ini, saya pakai docker hub.</p><pre class="ke kf kg kh gt ng nf nh ni aw nj bi"><span id="4618" class="me mf in nf b gy nk nl l nm nn">$ docker login<br/># ikuti prosess loginnya<br/>$ docker push bxcodec/tweetor</span><span id="2300" class="me mf in nf b gy no nl l nm nn">make docker-push<br/>The push refers to repository [docker.io/bxcodec/tweetor]<br/>eb083155cb06: Layer already exists<br/>2ccc1a87678c: Layer already exists<br/>df64d3292fd6: Layer already exists</span></pre><p id="3a5c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Dan jika kita pergi ke docker-hub saya <a class="ae kc" href="https://hub.docker.com/u/bxcodec" rel="noopener ugc nofollow" target="_blank"> https://hub.docker.com/u/bxcodec </a> , kita akan melihat image yang telah saya push.</p><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi nw"><img src="../Images/9912aa956e6dda273e23ea4e85b00948.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CCMhxWvISYL97gWfzYoQDg.png"/></div></div></figure><h2 id="a6a2" class="me mf in bd mg mh mi dn mj mk ml dp mm lc mn mo mp lg mq mr ms lk mt mu mv mw bi translated">Multi Stages Build Dockerfile</h2><p id="e872" class="pw-post-body-paragraph kt ku in kv b kw mx jo ky kz my jr lb lc mz le lf lg na li lj lk nb lm ln lo ig bi translated">Kelemahan metode yang seperti yang saya lakukan diatas adalah, kita harus hati-hati ketika berurusan dengan os. Jika saya <em class="md"> build </em> di lokal saya (mac OS) maka ketika aplikasi tersebut di <em class="md"> dockerize </em> , tidak akan bisa dieksekusi. Karena docker container-imagenya menggunakan base OS alpine.</p><p id="05ad" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Untuk mengatasi ini, docker memiliki fitur dengan istilah <em class="md"> multi-stage build. </em> Sehingga, agar tidak ada kesalahan OS, kita dapat membuat builder dari OS yang sama dengan base image dari aplikasi kita.</p><pre class="ke kf kg kh gt ng nf nh ni aw nj bi"><span id="ce48" class="me mf in nf b gy nk nl l nm nn">## Builder<br/>FROM golang:1.10-alpine3.7 as builder</span><span id="20a2" class="me mf in nf b gy no nl l nm nn">RUN apk update &amp;&amp; apk upgrade &amp;&amp; \<br/>    apk --no-cache --update add git make &amp;&amp; \<br/>    go get -u github.com/golang/dep/cmd/dep</span><span id="5301" class="me mf in nf b gy no nl l nm nn">WORKDIR /go/src/github.com/bxcodec/tweetor</span><span id="68d8" class="me mf in nf b gy no nl l nm nn">COPY . .</span><span id="d8e8" class="me mf in nf b gy no nl l nm nn">RUN dep ensure -v &amp;&amp; go build -o engine app/main.go</span><span id="4239" class="me mf in nf b gy no nl l nm nn">## Distribution</span><span id="7141" class="me mf in nf b gy no nl l nm nn">FROM alpine:latest</span><span id="53af" class="me mf in nf b gy no nl l nm nn">RUN apk update &amp;&amp; apk upgrade &amp;&amp; \<br/>    apk --no-cache --update add ca-certificates tzdata &amp;&amp; \<br/>    mkdir /app &amp;&amp; mkdir tweetor</span><span id="1746" class="me mf in nf b gy no nl l nm nn">WORKDIR /tweetor</span><span id="930a" class="me mf in nf b gy no nl l nm nn">EXPOSE 9090</span><span id="f80a" class="me mf in nf b gy no nl l nm nn">COPY --from=builder /go/src/github.com/bxcodec/tweetor/engine /app</span><span id="6a73" class="me mf in nf b gy no nl l nm nn">CMD /app/engine</span></pre><p id="da69" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Dengan konsep ini, kita akan membuat satu <em class="md"> docker image </em> sebagai builder. Lalu hasil <em class="md"> build </em> tersebut kita <em class="md"> copy </em> ke <em class="md"> docker image </em> baru yang isinya hanya aplikasi kita.</p><pre class="ke kf kg kh gt ng nf nh ni aw nj bi"><span id="bb40" class="me mf in nf b gy nk nl l nm nn">COPY --from=builder /go/src/github.com/bxcodec/tweetor/engine /app</span></pre><p id="c65a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><code class="fe nc nd ne nf b">/go/src/github.com/bxcodec/tweetor/engine</code> : Folder hasil build dari image <code class="fe nc nd ne nf b">builder</code> yang kita copy ke folder <code class="fe nc nd ne nf b">/app</code> di container baru.</p><p id="6236" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Sehingga didalam container yang baru, hanya satu aplikasi dan base image saja dan sizenya pun kecil.</p><p id="0079" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Dengan ini kita tidak perlu build dilocal lagi, karena sudah dilakukan didalam container terpisah.</p><pre class="ke kf kg kh gt ng nf nh ni aw nj bi"><span id="0981" class="me mf in nf b gy nk nl l nm nn">$ docker build . -t bxcodec/tweetor:latest</span></pre><p id="80c5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Dan selanjutnya push kembali ke docker-registry</p><pre class="ke kf kg kh gt ng nf nh ni aw nj bi"><span id="06ff" class="me mf in nf b gy nk nl l nm nn">$ docker push bxcodec/tweetor</span></pre><p id="0f86" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Done!!!</p><p id="af4d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Yaay!! Sampai disini saja untuk urusan dockerize aplikasi Golang yang sudah saya buat sebagai implementasi real dari Open API yang saya buat. Selanjutnya adalah membuat environment development dengan docker-compose.</p><p id="f0a7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Jadi bocoran, next part adalah, bagaimana saya membuat environment development saya tetap sama terserah OS yang saya pakai apa aja (Linux, MacOS).</p><h2 id="19a6" class="me mf in bd mg mh mi dn mj mk ml dp mm lc mn mo mp lg mq mr ms lk mt mu mv mw bi translated">Next</h2><ul class=""><li id="9445" class="lp lq in kv b kw mx kz my lc nx lg ny lk nz lo lu lv lw lx bi translated"><a class="ae kc" href="https://medium.com/bxcodec/membuat-development-environtment-aplikasi-golang-dengan-docker-compose-4e96542c19ea" rel="noopener"> <strong class="kv io"> Membuat Development Environtment Aplikasi Golang dengan Docker Compose </strong> </a></li></ul><h2 id="f561" class="me mf in bd mg mh mi dn mj mk ml dp mm lc mn mo mp lg mq mr ms lk mt mu mv mw bi translated">Prev</h2><ul class=""><li id="e9b6" class="lp lq in kv b kw mx kz my lc nx lg ny lk nz lo lu lv lw lx bi translated"><a class="ae kc" href="https://medium.com/easyread/membuat-mock-server-dengan-openapi-3-di-kubernetes-b9963ed2ac40" rel="noopener"> <strong class="kv io"> Membuat Mock Server dengan OpenAPI 3 di Kubernetes </strong> </a></li></ul><figure class="ke kf kg kh gt ki"><div class="bz fp l di"><div class="oa ob l"/></div></figure></div></div>    
</body>
</html>