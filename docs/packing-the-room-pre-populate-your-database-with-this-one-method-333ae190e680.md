# æ”¶æ‹¾æˆ¿é—´:ç”¨è¿™ç§æ–¹æ³•é¢„å…ˆå¡«å……ä½ çš„æ•°æ®åº“

> åŸæ–‡ï¼š<https://medium.com/androiddevelopers/packing-the-room-pre-populate-your-database-with-this-one-method-333ae190e680?source=collection_archive---------0----------------------->

![](img/04f4f85f42a4ee4e632d17907429b3c0.png)

Illustration by [Virginia Poltrack](http://twitter.com/vpoltrack)

å‡è®¾æ‚¨æƒ³è¦ç”¨æ‰“åŒ…åœ¨ APK ä¸­æˆ–ä»æœåŠ¡å™¨ä¸‹è½½çš„æ•°æ®é¢„å¡«å……æ•°æ®åº“ã€‚æ— è®ºæ‚¨æ˜¯æƒ³ä½¿ç”¨ SQLite è¿˜æ˜¯ Room æ¥å®Œæˆè¿™é¡¹å·¥ä½œï¼Œéƒ½æœ‰å‡ ä»¶äº‹æƒ…éœ€è¦å¤„ç†:æ‰“å¼€æ•°æ®åº“ã€éªŒè¯æ¨¡å¼ã€é”å®šæ•°æ®åº“æ–‡ä»¶å¹¶å¤„ç†çº¿ç¨‹åŒæ­¥ã€å¤åˆ¶æ‰€æœ‰å†…å®¹å¹¶å…³é—­æ•°æ®åº“ã€‚

ä» Room 2.2(ç›®å‰åœ¨ alpha ä¸­)å¼€å§‹ï¼Œæ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ¥é¢„å¡«å……æ‚¨çš„æ•°æ®åº“:`[RoomDatabase.Builder](https://developer.android.com/reference/android/arch/persistence/room/RoomDatabase.Builder)#createFromAsset()`æˆ–`createFromFile()`ï¼Œè¿™å–å†³äºæ‚¨é¢„æ‰“åŒ…çš„æ•°æ®åº“çš„ä½ç½®ã€‚è¯·ç»§ç»­é˜…è¯»ï¼Œäº†è§£å¦‚ä½•ä½¿ç”¨è¿™äº›æ–¹æ³•ã€ä½¿ç”¨é¢„æ‰“åŒ…æ•°æ®åº“çš„ä¸€äº›æŠ€å·§ä»¥åŠæ¶‰åŠè¿ç§»æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚

# `createFromAsset()`

å¦‚æœä½ çš„é¢„æ‰“åŒ…æ•°æ®åº“æ˜¯ä½ çš„åº”ç”¨ç¨‹åºçš„`assets/`æ–‡ä»¶å¤¹çš„ä¸€éƒ¨åˆ†ï¼Œä½¿ç”¨`createFromAsset()`ä¼ é€’èµ„äº§çš„è·¯å¾„ä½œä¸ºå‚æ•°ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„æ•°æ®åº“ä½äº:`assets/database/myapp.db`ï¼Œæ‚¨å°†é€šè¿‡`â€œdatabase/myapp.dbâ€`:

```
Room.databaseBuilder(appContext, TestDatabase.class, â€œSample.dbâ€)
    .createFromAsset(â€œdatabase/myapp.dbâ€)
    .build()
```

# createFromFile()

å¦‚æœæ‚¨çš„æ•°æ®åº“ä¸åœ¨`assets/`æ–‡ä»¶å¤¹ä¸­ï¼Œä¾‹å¦‚æ‚¨ä»æœåŠ¡å™¨ä¸‹è½½å¹¶ä¿å­˜åˆ°ç£ç›˜ï¼Œä½¿ç”¨`createFromFile()`å¹¶ä¼ é€’`File`ã€‚

```
Room.databaseBuilder(appContext, TestDatabase.class, â€œSample.dbâ€)
    .createFromFile(File(â€œmypathâ€))
    .build()
```

> ğŸš«åœ¨å†…å­˜ä¸­ï¼Œæ•°æ®åº“ä¸æ”¯æŒé€šè¿‡`createFromAsset`æˆ–`createFromFile`é¢„å¡«å……æ•°æ®åº“ï¼Œå¦‚æœä½ å°è¯•è¿™æ ·åšçš„è¯`RoomDatabase.build()`æ–¹æ³•å°†æŠ›å‡ºä¸€ä¸ª`IllegalArgumentException`ã€‚

# æ–‡ä»¶æƒé™

Room ä¸ä¼šæ‰“å¼€æ‚¨æä¾›çš„æ•°æ®åº“ï¼Œè€Œæ˜¯å¤åˆ¶å®ƒã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯`File`ï¼Œè¯·ç¡®ä¿æ‚¨æœ‰è¯»å–æƒé™ï¼Œä»¥ä¾¿ Room å¯ä»¥å¤åˆ¶å®ƒã€‚

# æ•°æ®åº“éªŒè¯

å½“ä»ä¸€ä¸ªç‰ˆæœ¬è¿ç§»åˆ°å¦ä¸€ä¸ªç‰ˆæœ¬æ—¶ï¼ŒRoom ç¡®ä¿æ•°æ®åº“çš„æœ‰æ•ˆæ€§ï¼Œå› æ­¤å½“ä»èµ„äº§æˆ–æ–‡ä»¶åˆ›å»ºæ•°æ®åº“æ—¶ï¼Œå®ƒåº”ç”¨ç›¸åŒçš„æœ‰æ•ˆæ€§æ£€æŸ¥ã€‚å°±åƒè¿™æ ·ï¼Œå®ƒç¡®ä¿äº†æ‚¨æ­£åœ¨å¤åˆ¶æ•°æ®çš„æ•°æ®åº“çš„æ¨¡å¼åŒ¹é…ã€‚

> ğŸ’¡Room å…è®¸é€šè¿‡`@Database`æ³¨é‡Šä¸­çš„`[exportSchema](https://developer.android.com/reference/android/arch/persistence/room/Database#exportschema)`å‚æ•°å¯¼å‡ºæ•°æ®åº“æ¨¡å¼ã€‚å› æ­¤ï¼Œå½“æ‚¨åˆ›å»ºé¢„æ‰“åŒ…çš„æ•°æ®åº“æ—¶ï¼Œè¯·ä½¿ç”¨å…¶ä¸­å®šä¹‰çš„æ¨¡å¼ã€‚

# æ•°æ®åº“è¿ç§»

ä¸€èˆ¬æ¥è¯´ï¼Œå½“æ•°æ®åº“æ¨¡å¼æ”¹å˜æ—¶ï¼Œåœ¨`@RoomDatabase`æ³¨é‡Šä¸­å¢åŠ æ•°æ®åº“ç‰ˆæœ¬ï¼Œæˆ–è€…å®ç°è¿ç§»æˆ–è€…[å¯ç”¨ç ´åæ€§è¿ç§»](https://developer.android.com/training/data-storage/room/migrating-db-versions#handle-missing-migrations)ã€‚Room ä¼šæŸ¥çœ‹è®¾å¤‡ä¸Šå·²å®‰è£…çš„ç‰ˆæœ¬å’Œåº”ç”¨ç¨‹åºä¸­å®šä¹‰çš„æœ€æ–°ç‰ˆæœ¬ã€‚

ä¾‹å¦‚ï¼Œå‡è®¾è®¾å¤‡ä¸Šçš„æ•°æ®åº“ç‰ˆæœ¬ä¸º 2ï¼Œè€Œæ‚¨çš„åº”ç”¨ç¨‹åºçš„æ•°æ®åº“ç‰ˆæœ¬(åœ¨`@RoomDatabase`ä¸­å®šä¹‰)ä¸º 4ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹å½“é¢„æ‰“åŒ…çš„æ•°æ®åº“ä¹ŸåŠ å…¥åˆ°ç»„åˆä¸­æ—¶ï¼Œåœ¨ä¸åŒçš„åœºæ™¯ä¸­ä¼šå‘ç”Ÿä»€ä¹ˆ:

**1ã€‚ç ´åæ€§è¿ç§»**å·²å¯ç”¨ï¼Œå¹¶ä¸”**é¢„æ‰“åŒ…æ•°æ®åº“**çš„**ç‰ˆæœ¬æ¯”æ‚¨çš„åº”ç”¨ç¨‹åºä¸­å®šä¹‰çš„**ç‰ˆæœ¬æ—§ï¼Œåˆ™æ•°æ®åº“è¢«ä¸¢å¼ƒï¼Œæ•°æ®ä¸ä¼šè¢«å¤åˆ¶ã€‚

ç¤ºä¾‹:å¦‚æœé¢„æ‰“åŒ…çš„æ•°æ®åº“ç‰ˆæœ¬ä¸º 3ï¼Œå¹¶ä¸”å¯ç”¨äº†ç ´åæ€§è¿ç§»ï¼Œåˆ™è¯¥æ•°æ®åº“å°†è¢«åˆ é™¤ï¼Œå¹¶ä¸”ä¸ä¼šå¤åˆ¶æ•°æ®ã€‚

**2ã€‚ç ´åæ€§è¿ç§»**å·²å¯ç”¨ï¼Œå¹¶ä¸”**é¢„æ‰“åŒ…æ•°æ®åº“**çš„**ç‰ˆæœ¬**ä¸æ‚¨çš„åº”ç”¨ç¨‹åºä¸­å®šä¹‰çš„ç‰ˆæœ¬ç›¸åŒï¼Œç„¶ååˆ é™¤æ•°æ®åº“ï¼Œå¹¶ä»é¢„æ‰“åŒ…æ•°æ®åº“ä¸­å¤åˆ¶æ•°æ®ã€‚

ç¤ºä¾‹:å¦‚æœé¢„æ‰“åŒ…çš„æ•°æ®åº“æ˜¯ç‰ˆæœ¬ 4ï¼Œå¦‚åº”ç”¨ç¨‹åºçš„æ•°æ®åº“ç‰ˆæœ¬ï¼Œå¹¶ä¸”å¯ç”¨äº†ç ´åæ€§è¿ç§»ï¼Œåˆ™è¯¥æ•°æ®åº“å°†è¢«åˆ é™¤ï¼Œæ•°æ®å°†ä»é¢„æ‰“åŒ…çš„æ•°æ®åº“ä¸­å¤åˆ¶ã€‚

**3ã€‚å®æ–½äº†è¿ç§»**ï¼Œå¹¶ä¸”**é¢„æ‰“åŒ…æ•°æ®åº“çš„ç‰ˆæœ¬**æ¯”æ‚¨çš„`@RoomDatabase`æ³¨é‡Šä¸­çš„ç‰ˆæœ¬æ—§ï¼Œé‚£ä¹ˆ Room å°†å¤åˆ¶æ•°æ®å¹¶è¿è¡Œè¿ç§»ã€‚

ç¤ºä¾‹:å¦‚æœé¢„æ‰“åŒ…çš„æ•°æ®åº“æ˜¯ç‰ˆæœ¬ 3ï¼Œå¹¶ä¸”æ‚¨å®æ–½äº†ä»¥ä¸‹è¿ç§»:ä»ç‰ˆæœ¬ 2 åˆ°ç‰ˆæœ¬ 3 å’Œä»ç‰ˆæœ¬ 3 åˆ°ç‰ˆæœ¬ 4ï¼Œé‚£ä¹ˆå°†è¿è¡Œä»ç‰ˆæœ¬ 2 åˆ°ç‰ˆæœ¬ 3 çš„è¿ç§»ï¼Œå°†å¤åˆ¶æ•°æ®åº“ï¼Œç„¶åè¿è¡Œä»ç‰ˆæœ¬ 3 åˆ°ç‰ˆæœ¬ 4 çš„è¿ç§»ã€‚

> ğŸ’¡ä½œä¸ºä¸€ä¸ªæœ€ä½³å®è·µï¼Œç¡®ä¿é¢„æ‰“åŒ…çš„æ•°æ®åº“æ˜¯ä¸åœ¨`@RoomDatabase`æ³¨é‡Šä¸­å£°æ˜çš„æœ€æ–°ç‰ˆæœ¬ç›¸åŒçš„ç‰ˆæœ¬ã€‚è¿™æ ·ï¼Œæ‚¨å¯ä»¥é¿å…å¤„ç†è¿ç§»æ¡ˆä¾‹ã€‚
> 
> ğŸ“–åœ¨è¿™ç¯‡åšæ–‡çš„[ä¸­é˜…è¯»æ›´å¤šå…³äºå®¤å†…è¿ç§»çš„ä¿¡æ¯ï¼Œåœ¨è¿™é‡Œ](/androiddevelopers/testing-room-migrations-be93cdb0d975)é˜…è¯»æ›´å¤šå…³äºæµ‹è¯•è¿ç§»çš„ä¿¡æ¯[ã€‚](/androiddevelopers/understanding-migrations-with-room-f01e04b07929)

ç°åœ¨ï¼Œæ‚¨å¯ä»¥é€šè¿‡åº”ç”¨ç¨‹åºä¸­çš„æ•°æ®æˆ–æ–‡ä»¶è½»æ¾å¡«å……æˆ¿é—´æ•°æ®åº“ã€‚Room ä¿æŠ¤æ‚¨æ•°æ®çš„å®Œæ•´æ€§ï¼Œå¹¶åœ¨å¿…è¦æ—¶å¸®åŠ©æ‚¨æ‰§è¡Œè¿ç§»ã€‚è¯·åœ¨ä¸‹é¢çš„è¯„è®ºä¸­å‘Šè¯‰æˆ‘ä»¬æ‚¨å¦‚ä½•åœ¨åº”ç”¨ä¸­ä½¿ç”¨é¢„æ‰“åŒ…çš„æ•°æ®åº“ï¼

æ„Ÿè°¢[ä¸¹å°¼å°”Â·åœ£åœ°äºšå“¥](https://medium.com/u/78430ce91f3a?source=post_page-----333ae190e680--------------------------------)ã€[å°¼å…‹Â·å¸ƒå½»](https://medium.com/u/22c02a30ae04?source=post_page-----333ae190e680--------------------------------)å’Œ[ä½•å¡Â·é˜¿å°”å¡é›·å¡](https://medium.com/u/e0a4c9469bb5?source=post_page-----333ae190e680--------------------------------)ï¼ğŸ’š