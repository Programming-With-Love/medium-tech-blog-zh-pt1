<html>
<head>
<title>Extracting Colors from an Image Using the Palette API Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用调色板API Android从图像中提取颜色</h1>
<blockquote>原文：<a href="https://blog.kotlin-academy.com/extracting-colors-from-an-image-using-the-palette-api-android-ac319aaadac6?source=collection_archive---------0-----------------------#2022-11-02">https://blog.kotlin-academy.com/extracting-colors-from-an-image-using-the-palette-api-android-ac319aaadac6?source=collection_archive---------0-----------------------#2022-11-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><figure class="gl gn jo jp jq jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi jn"><img src="../Images/65f2b1c1fec47fe1a831e1149f46b4e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kq1ID3EfUafkTqxt"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Photo by <a class="ae kc" href="https://unsplash.com/@aznbokchoy?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Lucas Kapla</a> on <a class="ae kc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="cff3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从图像中提取颜色并不是什么新鲜事，但是如果你注意到一些媒体播放器根据当前播放的媒体项目的插图来改变它们的主题(工具栏、工具栏标题文本颜色、状态栏颜色和其他属性),那么从图像中提取颜色在主题应用中被广泛使用。这是怎么做到的或者怎么做到的？</p><h2 id="a3eb" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">创建Android项目并添加依赖项</h2><p id="479c" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">为此，我们将首先打开Android Studio IDE，并创建一个从Material2或Material3扩展而来的新Android项目。接下来要做的是在你的应用级<em class="lz"> build.gradle </em>文件中添加组件面板API依赖，如下所示；</p><pre class="ma mb mc md gt me mf mg mh aw mi bi"><span id="986e" class="lb lc iq mf b gy mj mk l ml mm">implementation "androidx.palette:palette-ktx:1.0.0"</span></pre><p id="d650" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们要做的下一件事是在我们的<em class="lz"> activity_main.xml </em>文件中添加6个工具栏和一个FAB，它将用于从用户的图库中挑选图像。下面是<em class="lz"> activity_main.xml. </em>的代码</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="a81a" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">activity_main.xml文件有6个<em class="lz"> MaterialToolbars </em>，一个<em class="lz"> FAB，</em>和一个<em class="lz"> ImageView。</em>当点击FAB时，我们将从图库中选择一幅图像，并使用所选图像设置ImageView的位图，我们将进一步从位图创建所谓的调色板。我们将使用调色板的不同样本来设置各种材料工具栏的背景颜色。</p><h2 id="4095" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">样本</h2><p id="764d" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">样本代表从图像调色板生成的颜色样本。样本有三个我们感兴趣的重要属性:样本的<em class="lz"> RGB </em>值、<em class="lz">标题文本颜色、</em>和<em class="lz">正文文本颜色</em>。这三个属性有我们将使用的getter方法。</p><p id="7431" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们感兴趣的颜色配置文件(样本)有六种，它们包括<em class="lz">鲜明</em>、<em class="lz">亮鲜明</em>、<em class="lz">暗鲜明</em>、<em class="lz">柔和</em>、<em class="lz">亮柔和、</em>和<em class="lz">暗柔和</em>样本。我们的每个工具栏的背景将被设置为一种特定的颜色，标题将是名称加上背景颜色的十六进制值，标题颜色将是样本的标题颜色。</p><h2 id="e907" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">从位图生成调色板</h2><p id="b290" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">我们将从编写从图像位图生成调色板的函数开始，我们将提取我们感兴趣的六个颜色配置文件(假设它们都存在)。这是使用<em class="lz"> Palette.from(位图位图)完成的。generate() </em>同步生成调色板。</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="955d" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">上面的代码解释了它自己，因为我们只是设置每个工具栏的背景并改变它们的标题。颜色的整数值是使用样本获得的。扩展函数<em class="lz"> Int.hextString() </em>简单地返回Int颜色的十六进制值。</p><h2 id="efa9" class="lb lc iq bd ld le lf dn lg lh li dp lj ko lk ll lm ks ln lo lp kw lq lr ls lt bi translated">实现从图库中选择图像</h2><p id="9693" class="pw-post-body-paragraph kd ke iq kf b kg lu ki kj kk lv km kn ko lw kq kr ks lx ku kv kw ly ky kz la ij bi translated">为了从图库中选择图像，我们将使用ActivityResult APIs并注册一个启动器，当FAB被单击时启动它。下面是源代码</p><figure class="ma mb mc md gt jr"><div class="bz fp l di"><div class="mn mo l"/></div></figure><p id="77d3" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我们将调用<code class="fe mp mq mr mf b">onCreate</code>中的<code class="fe mp mq mr mf b">registerImagePicker</code>函数，并从输入流中创建一个位图。然后我们使用位图来调用函数<code class="fe mp mq mr mf b">createPalette</code>，这样就完成了。调用的结果如下所示。我们需要调用<code class="fe mp mq mr mf b">contentLaunch.launch("image/*")</code>来从图库中获取图片。这里，当点击浮动操作按钮时，调用完成。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><div role="button" tabindex="0" class="js jt di ju bf jv"><div class="gh gi ms"><img src="../Images/13d996d9830fd75f43078ee697e0388c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZRrkQpTWZOnX6m5VsGYaMw.png"/></div></div><figcaption class="jy jz gj gh gi ka kb bd b be z dk">Screenshot of Pixel 4XL with chosen image from gallery</figcaption></figure><p id="b837" class="pw-post-body-paragraph kd ke iq kf b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">从所选的图片来看，主色调是蓝色，这就是为什么鲜艳的颜色是蓝色。标题的颜色是从函数调用<code class="fe mp mq mr mf b">Swatch.getTitleTextColor()</code>中得到的标题文本颜色。选择不同的图像，各种颜色会相应地改变，但请注意，不能保证这些颜色在图像中都可用。这就是我们在对样本进行各种调用之前检查可空性的原因。</p><figure class="ma mb mc md gt jr gh gi paragraph-image"><a href="https://kotlin-academy.us17.list-manage.com/subscribe?u=5d3a48e1893758cb5be5c2919&amp;id=d2ba84960a"><div class="gh gi mt"><img src="../Images/68557afd7e8ae2a75dec26b78d8ec016.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XxZ6inD12UP7rnbt-2PJZw.png"/></div></a></figure></div></div>    
</body>
</html>