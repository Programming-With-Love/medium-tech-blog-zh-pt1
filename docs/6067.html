<html>
<head>
<title>Skyline: ETL-as-a-Service</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Skyline: ETL即服务</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/skyline-etl-as-a-service-a441efdeeb90?source=collection_archive---------0-----------------------#2015-10-02">https://medium.com/pinterest-engineering/skyline-etl-as-a-service-a441efdeeb90?source=collection_archive---------0-----------------------#2015-10-02</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="1d58" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">叶茂|发现网站Pinterest工程师</p><p id="8fbc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">数据在Pinterest发挥了重要作用，既能为Pinner带来新产品体验，又能洞察Pinner的行为。我们一直在想办法减少将数据转化为可操作见解的摩擦。我们的数据用户(主要是分析师、产品经理、工程师和数据科学家)经常问的一个问题是，“我如何构建一个报告仪表板来每天跟踪xyz指标？”。随着访问数据的员工数量、数据量和查询数量的增加，扩展和支持新出现的需求成为一大挑战。为了解决这个问题，我们建立了一个名为Skyline的新数据平台。</p><p id="5389" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在Skyline诞生之前，数据用户依赖数据工程师来:</p><ul class=""><li id="8269" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">找到要查询的正确的表</li><li id="d619" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">将查询生产为提取、转换和加载(<a class="ae jq" href="https://en.wikipedia.org/wiki/Extract,_transform,_load" rel="noopener ugc nofollow" target="_blank"> ETL </a>)</li><li id="f89d" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">回填给定ETL作业的历史数据(例如，过去一年的数据)，因为数据用户通常希望跟踪一整年的指标</li></ul><p id="42cb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Skyline解决了上述要求，并支持三种核心用例:</p><ol class=""><li id="3333" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jr ji jj jk bi translated">用于创建和安排处理这些数据的工作流/作业的自助用户界面</li><li id="bddc" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jr ji jj jk bi translated">Pinterest仓库中数据的可视化探索</li><li id="ca9d" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jr ji jj jk bi translated">能够理解数据的谱系(即数据依赖性)</li></ol><h2 id="31b1" class="js jt hh bd ju jv jw jx jy jz ka kb kc ip kd ke kf it kg kh ki ix kj kk kl km bi translated">自助ETL</h2><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es kn"><img src="../Images/075ff5c2372bbbad57a5556b46ef9920.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*oyihh71V00nrzp4I.png"/></div></div></figure><p id="4f53" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们构建了一个自助式ETL管理器来简化作业创建和调度。使用此工具，数据用户可以使用简单的SQL查询创建和安排数据作业，自己完成以下任务:</p><ul class=""><li id="0bd6" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">将数据从配置单元移至红移</li><li id="afc7" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">构建<a class="ae jq" href="https://engineering.pinterest.com/blog/building-pinalytics-pinterest%E2%80%99s-data-analytics-engine" rel="noopener ugc nofollow" target="_blank"> Pinalytics </a> (Pinterest的数据分析引擎)报告</li><li id="f4c2" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">按需回填历史数据</li></ul><p id="ae25" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">由于简单的设计和易用性，ETL Manager很快被数据分析师和产品经理所采用。超过40%的Pinalytics报告是使用Skyline创建的。</p><h2 id="353c" class="js jt hh bd ju jv jw jx jy jz ka kb kc ip kd ke kf it kg kh ki ix kj kk kl km bi translated">数据探索</h2><p id="77b1" class="pw-post-body-paragraph ie if hh ig b ih kz ij ik il la in io ip lb ir is it lc iv iw ix ld iz ja jb ha bi translated">除了提供自助式ETL，我们知道用户想要探索存在于Pinterest仓库(亚马逊S3)中的数据。我们构建了一个名为Skyline Data Warehouse的功能，它提供了我们仓库中核心数据集的目录视图，并且每天自动更新。Skyline数据仓库提供了关于数据表的以下信息:</p><ul class=""><li id="e2b3" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">哪个工作流/作业生成了数据</li><li id="7bd7" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">负责人(即可以联系并提出问题的个人或团队)</li><li id="3ec0" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">表是否是最新的</li><li id="9892" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">列名和类型</li><li id="8bff" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">其他细节，如字节大小、估计的行数、表分区和样本行</li><li id="0b8c" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">数据用户的意见和注释</li></ul><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es le"><img src="../Images/d20d7e62ea61a89c060bf5b181e8beee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Xf3yKje_mQrJ_Kx3.png"/></div></div></figure><h2 id="f5d1" class="js jt hh bd ju jv jw jx jy jz ka kb kc ip kd ke kf it kg kh ki ix kj kk kl km bi translated">可视化数据谱系</h2><p id="ce1f" class="pw-post-body-paragraph ie if hh ig b ih kz ij ik il la in io ip lb ir is it lc iv iw ix ld iz ja jb ha bi translated">在我们的规模下，我们运行数千个数据作业，每个作业都有相互依赖关系。以前，如果一个作业在生产中中断，用户很难找到所有受影响的下游表。为了简化这一过程，我们构建了一个自动沿袭检测系统，该系统可以监控和检测所有数据作业，并帮助:</p><ul class=""><li id="4ef2" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">了解一个表是如何从其他表派生出来的(在MySQL、Hive、HBase、Redis和Redshift中)</li><li id="50b1" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">弄清楚Pinalytics报告是如何生成的</li><li id="27c6" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">快速浏览表格的所有者/作业/工作流信息</li></ul><figure class="ko kp kq kr fd ks er es paragraph-image"><div role="button" tabindex="0" class="kt ku di kv bf kw"><div class="er es lf"><img src="../Images/cebbac156a2f5e7defd33e6bc03a0ca4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JDvfcL-2Q8_IbzsU.png"/></div></div></figure><h2 id="6173" class="js jt hh bd ju jv jw jx jy jz ka kb kc ip kd ke kf it kg kh ki ix kj kk kl km bi translated">体系结构</h2><figure class="ko kp kq kr fd ks er es paragraph-image"><div class="er es lg"><img src="../Images/11ea999d86203b2953b12c1871e2d71f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/0*ufDlx1h5iXc8hp_r.png"/></div></figure><p id="d5e2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Skyline具有以下组件:</p><ul class=""><li id="1617" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">Skyline UI :我们在Flask框架上构建了web应用程序。前端使用React.js库创建用户界面组件，如简单的交互式可视化，SQLAlchemy与后端数据库进行交互。</li><li id="bc4b" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated"><strong class="ig hi">节俭服务和数据库</strong>:作业的输入/输出信息是实现Skyline数据仓库、数据沿袭和ETL管理器特性的基本知识。所有的数据都存储在一个MySQL数据库中，我们构建了一个节俭的服务器，客户端可以与之交互来读写这些数据。因为数据量不是很大，并且因为我们需要做许多连接操作来获得数据血统关系，所以我们使用MySQL作为持久存储，而不是其他选择，如HBase。</li><li id="b6bb" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated"><strong class="ig hi"> ETL驱动</strong> : ETL驱动是我们构建的一个Python库，用于解析ETL工作流/作业，通过Skyline ETL manager创建。在解析之后，ETL驱动程序将作业转换为令牌，这些令牌由<a class="ae jq" href="https://engineering.pinterest.com/blog/pinball-building-workflow-management" rel="noopener ugc nofollow" target="_blank"> Pinball </a>(我们的工作流管理系统)识别，稍后它会调度这些作业进行处理。</li><li id="da27" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated"><strong class="ig hi"> ETL查询/作业解析器</strong>:为了自动检测作业的输入和输出，我们构建了一对解析器:</li></ul><ol class=""><li id="9907" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jr ji jj jk bi translated">查询解析器，它自动检测所有查询的输入/输出表</li><li id="e705" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jr ji jj jk bi translated">Hadoop配置解析器，自动检测给定Hadoop作业的输入/输出S3文件路径。</li></ol><p id="12ad" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">每当用户在Skyline上创建一个新的ETL作业时，它的输入/输出信息将被自动提取、存储，并通过Skyline UI方便地浏览。</p><h2 id="93e5" class="js jt hh bd ju jv jw jx jy jz ka kb kc ip kd ke kf it kg kh ki ix kj kk kl km bi translated">路标</h2><p id="2f89" class="pw-post-body-paragraph ie if hh ig b ih kz ij ik il la in io ip lb ir is it lc iv iw ix ld iz ja jb ha bi translated">我们希望很快开源Skyline。在中期，我们考虑通过实施以下功能来扩展Skyline:</p><ul class=""><li id="0b8f" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">在Hive、Redshift和Presto等各种后端上运行特定查询的能力</li><li id="d817" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">搜索任何数据相关信息的能力(例如，用户查询、评论、列信息、样本数据)</li><li id="6d7d" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">支持优先ETL工作流/作业调度</li></ul><p id="7529" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你对Skyline这样的数据基础设施项目感兴趣，<a class="ae jq" href="https://careers.pinterest.com/careers/engineering/san-francisco" rel="noopener ugc nofollow" target="_blank">加入我们的团队</a>！</p><p id="abbd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="lh">鸣谢:Skyline是由叶茂、、祁一年和Julia Oh以及数据工程团队的其他成员共同创建的。在开发阶段，我们从业务分析团队和整个公司的其他数据用户那里获得了许多有用的反馈。</em></p></div></div>    
</body>
</html>