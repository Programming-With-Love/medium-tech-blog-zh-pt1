<html>
<head>
<title>JSON manipulation in Java 9 JShell</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Java 9 JShell中的JSON操作</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/json-manipulation-in-java-9-jshell-bab78f1e26a8?source=collection_archive---------0-----------------------#2017-10-12">https://medium.com/oracledevs/json-manipulation-in-java-9-jshell-bab78f1e26a8?source=collection_archive---------0-----------------------#2017-10-12</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="afb4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本文中，我将展示我们如何在JShell中处理基于JSON的数据——用于分析、探索、清理和处理，就像我们在Python中所做的一样。JShell是Java 9中引入的新命令行工具。它提供了一种交互式REPL(读取-评估-打印循环)体验，在这里我们可以一个接一个地执行Java命令，一路在会话中创建变量，处理数据，以一种快速、愉快的方式尝试编程结构。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jc"><img src="../Images/98a0e3badc1aa3731c7d16102cfab921.png" data-original-src="https://miro.medium.com/v2/resize:fit:644/format:webp/1*dl8T-o8Hdhmgg0KPxzbaLQ.png"/></div></figure><p id="9025" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我使用一个JSON文档，其中包含甲骨文全球大会2017大会所有会议的条目(<a class="ae jk" href="https://raw.githubusercontent.com/lucasjellema/scrape-oow17/master/oow2017-sessions-catalog.json" rel="noopener ugc nofollow" target="_blank">https://raw . githubusercontent . com/lucasjellema/scrape-oow 17/master/oow 2017-sessions-catalog . JSON</a>)</p><p id="4ba8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">JDK的Java 9 SE规范不包含用于处理JSON的JSON-P API和库。为了在JShell中使用JSON-P，我们需要添加库——我们首先需要找到并下载这些库。</p><p id="bdfc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我使用了一种有点迂回的方式来获得所需的jar文件(但是它以一种非常直接的方式工作):</p><p id="be4b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">1.创建一个依赖于JSON-P的pom.xml文件</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jl"><img src="../Images/e33dd3de819ab46d136d1e553231bbf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FwTvE5cuC5aP3jmj."/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jq"><img src="../Images/2c5a83ca6b609313c86685667f85231d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1036/0*WL1u0ie9cmujvvDv."/></div></figure><p id="df95" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.那就跑</p><blockquote class="jr js jt"><p id="ccfa" class="ie if ju ig b ih ii ij ik il im in io jv iq ir is jw iu iv iw jx iy iz ja jb ha bi translated"><em class="hh"> mvn安装依赖:复制依赖</em></p></blockquote><p id="128b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如本文所述:<a class="ae jk" href="https://technology.amis.nl/2017/02/09/download-all-directly-and-indirectly-required-jar-files-using-maven-install-dependencycopy-dependencies/" rel="noopener ugc nofollow" target="_blank">https://technology . amis . nl/2017/02/09/download-all-directly-and-ind间接-required-jar-files-using-maven-install-dependency copy-dependencies/</a></p><p id="e879" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这将把相关的JAR文件下载到子目录target/dependencies中</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jl"><img src="../Images/0c5e4e3820be6db6a80c0374d182399c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DyvtXTFrGHYipUWY."/></div></div></figure><p id="601d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3.将JAR文件复制到一个目录中——可以从运行JShell的Docker容器中访问该目录——对我来说，该目录是本地lib目录，由vagger和Docker映射到运行JShell的Docker容器中的/var/www/lib。</p><p id="8dd5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">4.在运行JShell的容器中:</p><p id="5b4d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当从HTTP URL资源中检索JSON文档时，使用以下语句启动JShell，使新的httpclient模块可用:</p><blockquote class="jr js jt"><p id="6f12" class="ie if ju ig b ih ii ij ik il im in io jv iq ir is jw iu iv iw jx iy iz ja jb ha bi translated"><em class="hh">jshell–添加模块jdk.incubator.httpclient </em></p></blockquote><p id="1169" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">5.从jshell内部更新类路径</p><p id="03f3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要在JShell中处理JSON——使用JSON-P——我们需要设置类路径，以包含使用Maven下载的两个jar文件。</p><blockquote class="jr js jt"><p id="fd2a" class="ie if ju ig b ih ii ij ik il im in io jv iq ir is jw iu iv iw jx iy iz ja jb ha bi translated"><em class="hh">/env–class-path/var/www/lib/javax . JSON-1.1 . jar:/var/www/lib/javax . JSON-API-1.1 . jar</em></p></blockquote><p id="e4c0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后导入JSON-P中的类</p><blockquote class="jr js jt"><p id="c4bb" class="ie if ju ig b ih ii ij ik il im in io jv iq ir is jw iu iv iw jx iy iz ja jb ha bi translated"><em class="hh">导入javax . JSON . *；</em></p></blockquote><p id="980e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果我们需要从URL资源中检索JSON数据，我们还应该</p><blockquote class="jr js jt"><p id="aedc" class="ie if ju ig b ih ii ij ik il im in io jv iq ir is jw iu iv iw jx iy iz ja jb ha bi translated"><em class="hh">导入JDK . incubator . http . *；</em></p></blockquote><p id="35eb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">6.我已经在文件系统中提供了JSON文档。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jy"><img src="../Images/15eba66bd99429d8cfbbe46f0530717a.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/0*oERUD2NdxTzXc2s6."/></div></figure><p id="1a6b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">可以通过以下方式访问它:</p><blockquote class="jr js jt"><p id="560a" class="ie if ju ig b ih ii ij ik il im in io jv iq ir is jw iu iv iw jx iy iz ja jb ha bi translated"><em class="hh">InputStream input = new file InputStream("/var/www/oow 2017-sessions-catalog . JSON ")；</em></p></blockquote><p id="e8a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">7.将文件中的数据解析到JSON文档中，获取根对象并检索会话数组:</p><blockquote class="jr js jt"><p id="443d" class="ie if ju ig b ih ii ij ik il im in io jv iq ir is jw iu iv iw jx iy iz ja jb ha bi translated"><em class="hh">JSON reader JSON reader = JSON . create reader(input)</em></p><p id="a8ed" class="ie if ju ig b ih ii ij ik il im in io jv iq ir is jw iu iv iw jx iy iz ja jb ha bi translated"><em class="hh">JSON object root JSON = JSON reader . read object()；</em></p><p id="cc0a" class="ie if ju ig b ih ii ij ik il im in io jv iq ir is jw iu iv iw jx iy iz ja jb ha bi translated"><em class="hh">JSON array sessions = root JSON . getjson array(" sessions ")；</em></p></blockquote><p id="33e7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">8.使用流过滤标题中包含术语SQL的会话，并将它们的标题打印到系统输出中:</p><blockquote class="jr js jt"><p id="80b0" class="ie if ju ig b ih ii ij ik il im in io jv iq ir is jw iu iv iw jx iy iz ja jb ha bi translated"><em class="hh"> sessions.stream()。map( p - &gt; (JsonObject)p)。filter(s-&gt;s . getstring(" title ")。包含(" SQL "))。forEach(s-&gt;{ system . out . println(s . getstring(" title "))；}) </em></p></blockquote><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="jm jn di jo bf jp"><div class="er es jl"><img src="../Images/d5e342d821ff7c0a28d8f571731fbe73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*CaDwy60o_47Z4LhD."/></div></div></figure><p id="757b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">另一个例子是:显示所有演示文稿的列表，这些演示文稿的幻灯片可通过下载URL下载:</p><blockquote class="jr js jt"><p id="9ea4" class="ie if ju ig b ih ii ij ik il im in io jv iq ir is jw iu iv iw jx iy iz ja jb ha bi translated">sessions.stream()</p><p id="6f48" class="ie if ju ig b ih ii ij ik il im in io jv iq ir is jw iu iv iw jx iy iz ja jb ha bi translated">。map(p--&gt;(JSON object)p)</p><p id="ce91" class="ie if ju ig b ih ii ij ik il im in io jv iq ir is jw iu iv iw jx iy iz ja jb ha bi translated">。filter(s-&gt; s . contains key(" files ")&amp; &amp;！s.isNull("files") &amp;&amp;！(s.getJsonArray("files ")。isEmpty()))</p><p id="0cb3" class="ie if ju ig b ih ii ij ik il im in io jv iq ir is jw iu iv iw jx iy iz ja jb ha bi translated">。forEach(s--&gt; { system . out . println(s . getstring(" title ")+" URL:"+s . getjsonarray(" files ")。getJsonObject(0)。getString(" URL "))；})</p></blockquote><h1 id="88b5" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">奖励:做HTTP请求</h1><p id="f4c8" class="pw-post-body-paragraph ie if hh ig b ih kx ij ik il ky in io ip kz ir is it la iv iw ix lb iz ja jb ha bi translated">顺便提一下，jshell中执行HTTP请求的一些步骤:</p><blockquote class="jr js jt"><p id="a6ec" class="ie if ju ig b ih ii ij ik il im in io jv iq ir is jw iu iv iw jx iy iz ja jb ha bi translated">jshell &gt; http client client = http client . newhttpclient()；<br/>client = =&gt;JDK . incubator . http . httpclientimpl @ 4d 339552</p><p id="2561" class="ie if ju ig b ih ii ij ik il im in io jv iq ir is jw iu iv iw jx iy iz ja jb ha bi translated">jshell &gt; http request = http request . new builder(uri . create("<a class="ae jk" href="http://www.google.com/%22)).GET().build();" rel="noopener ugc nofollow" target="_blank">http://www . Google . com "))。获取()。build()；</a> <br/>请求= =&gt;<a class="ae jk" href="http://www.google.com/" rel="noopener ugc nofollow" target="_blank">http://www.google.com</a>得到</p><p id="0c67" class="ie if ju ig b ih ii ij ik il im in io jv iq ir is jw iu iv iw jx iy iz ja jb ha bi translated">jshell &gt; HttpResponse response = client . send(请求，HttpResponse。body handler . asstring())<br/>response = =&gt;JDK . incubator . http . httpresponseimpl @ 147 ed 70 f</p><p id="3d9d" class="ie if ju ig b ih ii ij ik il im in io jv iq ir is jw iu iv iw jx iy iz ja jb ha bi translated">jshell &gt; system . out . println(response . body())<meta http-equiv="”content-type”" content="”text/html;charset=utf-8″"/><title>302已移动</title>   <h1> 302已移动</h1>文档已移动</p><p id="76fa" class="ie if ju ig b ih ii ij ik il im in io jv iq ir is jw iu iv iw jx iy iz ja jb ha bi translated"><a href="”&lt;a" class="ae jk" rel="noopener ugc nofollow" target="_blank">http://www.google.nl/?gfe_rd=cr&amp;amp；DCR = 0&amp;amp；ei = s 2xewcbpfpah 4g th 6 lb ag "</a>&gt;此处&lt; /A &gt;。</p><p id="0e50" class="ie if ju ig b ih ii ij ik il im in io jv iq ir is jw iu iv iw jx iy iz ja jb ha bi translated"/></blockquote></div><div class="ab cl lc ld go le" role="separator"><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh li"/><span class="lf bw bk lg lh"/></div><div class="ha hb hc hd he"><p id="6b70" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="ju">原载于2017年10月12日</em><a class="ae jk" href="https://technology.amis.nl/2017/10/12/json-manipulation-in-java-9-jshell/" rel="noopener ugc nofollow" target="_blank"><em class="ju">technology . amis . nl</em></a><em class="ju">。</em></p></div></div>    
</body>
</html>