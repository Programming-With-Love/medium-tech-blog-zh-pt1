<html>
<head>
<title>Understanding your build with the Build Analyzer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用构建分析器了解您的构建</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/understanding-your-build-with-the-build-analyzer-5c15688ec72e?source=collection_archive---------2-----------------------#2020-07-29">https://medium.com/androiddevelopers/understanding-your-build-with-the-build-analyzer-5c15688ec72e?source=collection_archive---------2-----------------------#2020-07-29</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/92b1103f992730e9a66b91943c46896f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z_nA_OfuLIjggC78IM8ejg.png"/></div></div></figure><div class=""/><p id="4379" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">作为Android开发工具团队的成员，我和我的队友每天都来开发工具，旨在使Android成为最好的移动开发平台。有时，这意味着构建帮助你编写应用程序的工具。在其他时候，这意味着构建工具来帮助你<em class="jn">回到</em>编写你的应用程序。</p><p id="bb75" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们知道冗长的构建会浪费时间，打断开发流程，并最终产生大量的挫折。Android Studio用户平均每周构建他们的项目65次，所以即使10秒钟的速度变慢也会花费每个开发人员一年大约9个小时的时间。然而，正如我们在之前的文章<a class="ae jo" rel="noopener" href="/androiddevelopers/improving-build-speed-in-android-studio-3e1425274837">中提到的，在Android Studio </a>中提高构建速度，大约60%的Android开发人员不分析他们的构建。再加上不断增长的项目复杂性，这已经导致所有Android Studio项目的构建持续时间不断增加，生产力损失巨大。</p><p id="f5a2" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了解决这个问题，我们创建了Build Analyzer，这是一个工具，旨在帮助所有开发人员了解是什么决定了他们的构建持续时间，以及如何将其最小化。</p><h1 id="7ebe" class="jp jq hs bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">利用构建分析器</h1><p id="ff82" class="pw-post-body-paragraph ip iq hs ir b is kn iu iv iw ko iy iz ja kp jc jd je kq jg jh ji kr jk jl jm ha bi translated">每次您构建应用程序时，Android Studio都会生成一个构建分析器报告。要查看报告，请确保执行以下操作:</p><ol class=""><li id="9471" class="ks kt hs ir b is it iw ix ja ku je kv ji kw jm kx ky kz la bi translated">升级Android Gradle插件，使其版本高于或等于4.0.0</li><li id="134f" class="ks kt hs ir b is lb iw lc ja ld je le ji lf jm kx ky kz la bi translated">构建或重新构建您的项目</li><li id="76bf" class="ks kt hs ir b is lb iw lc ja ld je le ji lf jm kx ky kz la bi translated">通过从菜单栏中选择“视图”&gt;“工具窗口”&gt;“构建”,然后单击“构建分析器”选项卡，导航到构建分析器</li></ol><figure class="lg lh li lj fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/6a72ab524571ee18320385fbaabcdf2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OHzPlX1if59fvmBjNGYs_Q.png"/></div></div></figure><p id="bd3c" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">出于本文的目的，我们将浏览一份构建分析器报告，该报告是在运行由谷歌开发的开源教育应用程序<a class="ae jo" href="https://github.com/google/santa-tracker-android" rel="noopener ugc nofollow" target="_blank">圣诞老人追踪应用程序</a>的干净构建时生成的。</p><p id="c72b" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">打开构建分析器会将您带到<em class="jn">概述</em>页面。<em class="jn">概述</em>页面提供了一些基本信息和链接，可以跳转到详细信息。一眼就可以看出，这个构建的持续时间主要由任务执行决定，而不是由配置决定。</p><figure class="lg lh li lj fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/4481ea135a287cece2caae37edc9bc1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iE2M_jDHqeW0pYCA"/></div></div></figure><p id="a53a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要了解更多信息，让我们深入研究构建分析器提供的两个数据集，<em class="jn">任务</em>和<em class="jn">警告</em>，方法是使用<em class="jn"> Common views下的链接进入此构建</em>或左上角的组合框，当前显示为“Overview”。</p><p id="2860" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">任务</strong></p><p id="3542" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这些任务，或者由于输入/输出依赖，或者由于并行性限制，决定了观察到的构建持续时间。不包括并行运行且不影响观察到的构建持续时间的任务。当我构建应用程序时，看着这个可以让我知道哪里是最重要的。</p><figure class="lg lh li lj fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/6a72ab524571ee18320385fbaabcdf2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OHzPlX1if59fvmBjNGYs_Q.png"/></div></div></figure><p id="27b5" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在平面列表中查看时，任务按其来源进行颜色编码。源自<em class="jn">项目定制</em>的任务在您的项目中本地定义，并且最容易修改。标记为来自<em class="jn"> Android/Java/Kotlin插件</em>的任务来自核心插件，由<em class="jn">其他二进制插件</em>添加的任务可能来自你团队中某人创作的二进制插件或来自第三方二进制插件。</p><figure class="lg lh li lj fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/de5f068df2461972d9a6ebd0083b23f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ca7DJjJWpp-uc8MuRYOhmg.png"/></div></div></figure><p id="4a05" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">默认情况下，任务显示在一个平面列表中，但是可以通过添加它们的插件使用<em class="jn">分组插件</em>控件<em class="jn">进行分组。</em>分组为项目中的每个插件添加一个节点，并修改可视化以显示插件，而不是单个任务。</p><p id="81a0" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这里，分组允许我观察到我构建的大部分持续时间是由于核心插件的任务执行，比如Kotlin和Android Gradle插件。这并不奇怪，尤其是在执行一个像圣诞老人跟踪者这样的项目时。执行增量构建通常会导致花费在核心插件任务执行上的时间减少，并且会暴露其他插件的影响。</p><p id="113c" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这个插件视图在比较添加或升级插件前后的构建时间时特别有用，这将允许您权衡任何更改对构建持续时间的影响。无论何时做出改变都要小心，这是防止不断增加的构建持续时间侵蚀您的生产力的最好方法之一。还值得注意的是，由于增量执行和其他约束，构建持续时间会有所不同，所以最好比较几个构建。</p><p id="4ce8" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">警告</strong></p><p id="06a0" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这里，您可以看到该版本生成的所有警告。这包括为<em class="jn">没有</em>确定该构建持续时间的任务生成的警告。</p><figure class="lg lh li lj fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lk"><img src="../Images/f195071e0fc360ad09a3999855aa819f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K0cbeFGyBDqnz5CAx6SIJQ.png"/></div></div></figure><p id="7e49" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">每个警告都包含生成原因的解释、解决方法的建议，以及生成该警告的任务的详细信息(如果适用)。如果警告不是由您团队中的某个人生成的，您可以使用<em class="jn">生成报告</em>功能向原始任务或插件作者解释这个问题。</p><p id="dcfa" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如上图所示，在上面讨论的Santa Tracker项目上使用构建分析器时，我们生成了一个<em class="jn">任务设置</em>警告。此问题似乎是由于输出目录冲突造成的，因此我们可以通过更改generateExtraResources或mergeDebugResources任务的输出目录来解决此问题。mergeDebugResources任务来自基础android插件，不能在本地编辑，而generateExtraResources任务是我的团队创作的<em class="jn">项目定制</em>。因此，我将编辑generateExtraResources任务。</p><figure class="lg lh li lj fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/71192a51c611feffb5c628bc4d34786a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zny9J_P50AwHcYTKzBfGYg.png"/></div></div></figure><p id="ec77" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">再次注意，上面的报告是由一个干净的构建生成的。由增量构建生成的报告不太一致，但可能更好地代表了您通常的开发工作流程，所以请确保您将构建分析器用于干净的和增量的构建。要了解更多关于构建分析器的功能，请阅读<a class="ae jo" href="https://developer.android.com/studio/build/build-analyzer" rel="noopener ugc nofollow" target="_blank">构建性能故障排除</a>。</p><h1 id="b1c1" class="jp jq hs bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">构建分析器的工作原理</h1><p id="0729" class="pw-post-body-paragraph ip iq hs ir b is kn iu iv iw ko iy iz ja kp jc jd je kq jg jh ji kr jk jl jm ha bi translated">每次你使用Android Studio构建你的项目时，构建分析器使用<a class="ae jo" href="https://docs.gradle.org/current/userguide/third_party_integration.html#embedding" rel="noopener ugc nofollow" target="_blank"> Gradle工具API </a>和<a class="ae jo" href="https://developer.android.com/studio/releases/gradle-plugin" rel="noopener ugc nofollow" target="_blank"> Android Gradle插件</a>来本地收集数据。工具API用于附加一个<a class="ae jo" href="https://docs.gradle.org/5.1/release-notes.html#tooling-api:-enhanced/additional-progress-events" rel="noopener ugc nofollow" target="_blank"> ProgressListener </a>，它提供关于项目配置、任务执行、注释处理器等等的信息。Android Gradle插件提供了任务名到任务类名的映射和任务配置等附加信息。</p><p id="4237" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">当您的构建完成时，构建分析器通过一套分析器运行这些信息，每个分析器寻找并报告一个特定的问题。例如，一个分析器检查被配置为在每个构建上运行的任务。这些任务妨碍了在增量构建期间节省时间，并且会严重影响构建速度。</p><p id="3a40" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这个分析器如何找到总是运行的任务？当自上次构建以来没有输入或输出发生变化时，Gradle任务是最新的。当一个任务是最新的，Gradle跳过运行任务，并重用任务的旧输出，而不是浪费时间重新创建它们。如果没有声明任务输入和输出，任务将永远不会是最新的。该分析器使用由Gradle工具API提供的任务输出信息，并识别所有未声明任何输出的任务，或者特别将最新设置覆盖为始终为假的任务。在这样做的过程中，它标识了所有永远不会更新并且将一直运行的任务。通过自动完成这项工作，我们希望帮助您快速解决这个问题，并开始充分利用增量构建。</p><p id="62a4" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">除了识别始终运行的任务的分析器之外，目前还有两个额外的分析器。一个识别非增量的<a class="ae jo" href="https://docs.gradle.org/4.10.1/userguide/java_plugin.html#sec:incremental_annotation_processing" rel="noopener ugc nofollow" target="_blank">注释处理器，另一个识别覆盖彼此输出的任务。在未来，我们计划继续发布分析器，帮助您快速找到常见问题并了解Gradle最佳实践。</a></p><h1 id="91a2" class="jp jq hs bd jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km bi translated">后续步骤</h1><p id="751e" class="pw-post-body-paragraph ip iq hs ir b is kn iu iv iw ko iy iz ja kp jc jd je kq jg jh ji kr jk jl jm ha bi translated">如果构建分析器为第三方插件的一部分任务报告了一个警告，那么考虑对最初的插件作者提出一个bug。这些问题可能不会立即得到解决，但会改善整个生态系统。如果您认为构建分析器本身有问题，请通过我们的<a class="ae jo" href="https://issuetracker.google.com/components/192708#basic" rel="noopener ugc nofollow" target="_blank">问题追踪器</a>告诉我们。</p><p id="e588" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你有兴趣进一步调查你的建造，尝试使用<a class="ae jo" href="https://guides.gradle.org/creating-build-scans/" rel="noopener ugc nofollow" target="_blank">梯度扫描</a>获得更多信息。使用Gradle的<a class="ae jo" href="https://docs.gradle.org/current/userguide/build_cache.html" rel="noopener ugc nofollow" target="_blank">构建缓存</a>也可以减少你构建的持续时间。</p><p id="fa7b" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">随着这个工具的成熟，我们希望扩展我们的分析器套件，以识别更多的警告。我们也很高兴了解人们如何使用该工具，并将相应地对导航、可视化和其他组件进行改进。如果您有任何反馈，请告诉我们，尤其是关于您在自己的构建中发现的、我们的分析器没有发现的问题。</p></div></div>    
</body>
</html>