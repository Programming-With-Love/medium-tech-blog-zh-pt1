<html>
<head>
<title>Today I Learned: Beware with pointer in Golang!!!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä»Šå¤©æˆ‘å­¦åˆ°äº†:å°å¿ƒæˆˆå…°è¯­çš„æ•™é­ï¼ï¼ï¼</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.easyread.co/today-i-learned-beware-with-pointer-in-golang-7764f2060a93?source=collection_archive---------4-----------------------#2018-08-09">https://medium.easyread.co/today-i-learned-beware-with-pointer-in-golang-7764f2060a93?source=collection_archive---------4-----------------------#2018-08-09</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="dd73" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">ä»Šå¤©åœ¨Golangä¸­è‡ªå®šä¹‰JSONç¼–ç»„æ—¶çš„é”™è¯¯</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/425eb7ab9083ea3aaaeea2821501deb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BXubFQ9P5SvJr2Ob-8e9dw.png"/></div></div></figure><p id="7fd6" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">æ‰€ä»¥ï¼Œä»Šå¤©çš„bugå’Œè¦å­¦ä¹ çš„ä¸€è¯¾æ˜¯å…³äºé/æŒ‡é’ˆæ¥æ”¶å™¨å‡½æ•°ï¼Œå®ƒå‘ç”Ÿåœ¨æˆ‘ä¸ºæˆ‘çš„structåšå®šåˆ¶ç¼–ç»„JSONçš„æ—¶å€™ã€‚æˆ‘è¢«å›°äº†å‡ ä¸ªå°æ—¶æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚<br/>åœºæ™¯æ˜¯ï¼Œæˆ‘æœ‰ä¸€ä¸ªç»“æ„ï¼Œæ¯”å¦‚è¯´ä¸€ä¸ª<code class="fe lk ll lm ln b">ClassRoom</code>ç»“æ„ï¼Œè€Œ<code class="fe lk ll lm ln b">ClassRoom</code>æœ‰å¾ˆå¤šå­¦ç”Ÿã€‚æ¯ä¸€ä¸ªå­¦ç”Ÿéƒ½æŒ‰ç…§ä»–ä»¬çš„åˆ†æ•°æˆ–è€…åˆ«çš„ä»€ä¹ˆæ’åä¸Šå‡ï¼Œä¸ç®¡å®ƒæ˜¯ä»€ä¹ˆï¼Œ:Dï¼Œè¿™åªæ˜¯ä¸€ä¸ªä¾‹å­æ¥æè¿°æˆ‘ä»¬çœŸå®çš„æ¡ˆä¾‹ç»“æ„ã€‚ç±»ä¼¼ï¼Œåªæ˜¯åç§°ä¸åŒã€‚</p><pre class="kd ke kf kg gt lo ln lp lq aw lr bi"><span id="645a" class="ls lt in ln b gy lu lv l lw lx">type ClassRoom struct {<br/> Name     string          `json:"name"`<br/> Students map[int]Student `json:"students"`<br/>}<br/>type Students struct {<br/> Name string `json:"name"`<br/> Age  int    `json:"age"`<br/>}</span></pre><p id="c8ad" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">å¯¹äºè¿™ä¸ªç»“æ„ï¼Œå¦‚æœæˆ‘ä»¬å°†å®ƒç¼–ç»„åˆ°JSONï¼Œç»“æœå°†å¦‚ä¸‹æ‰€ç¤º:</p><pre class="kd ke kf kg gt lo ln lp lq aw lr bi"><span id="e720" class="ls lt in ln b gy lu lv l lw lx">{<br/>  "name": "D3TI2-Classmate",<br/>  "students": {<br/>    "1": {<br/>      "name": "Iman Tumorang",<br/>      "age": 17<br/>    },<br/>    "2": {<br/>      "name": "Christin Tumorang",<br/>      "age": 18<br/>    },<br/>    "3": {<br/>      "name": "Idola Manurung",<br/>      "age": 18<br/>    }<br/>  }<br/>}</span></pre><p id="e9af" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">ä½†æ˜¯å¯¹äºAPIçš„è¦æ±‚ï¼Œæˆ‘ä»¬å¸Œæœ›JSONç»“æœæ²¡æœ‰å­¦ç”Ÿçš„æ’åã€‚æˆ‘ä»¬åªæƒ³çœ‹èµ·æ¥åƒè¿™æ ·:</p><pre class="kd ke kf kg gt lo ln lp lq aw lr bi"><span id="b9b2" class="ls lt in ln b gy lu lv l lw lx">{<br/>  "name": "D3TI2-Classmate",<br/>  "students": [<br/>    {<br/>      "name": "Iman Tumorang",<br/>      "age": 17<br/>    },<br/>    {<br/>      "name": "Christin Tumorang",<br/>      "age": 18<br/>    },<br/>    {<br/>      "name": "Idola Manurung",<br/>      "age": 18<br/>    }<br/>  ]<br/>}</span></pre><p id="74ee" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">å—¯ï¼Œæ ¹æ®æˆ‘çš„ç»éªŒï¼Œåœ¨Golangåšè¿™ä»¶äº‹æ˜¯å¾ˆå®¹æ˜“çš„ã€‚æˆ‘ä»¬åªæ˜¯åˆ›å»ºä¸€ä¸ªä»¥<code class="fe lk ll lm ln b">ClassRoom</code>ä¸ºæ¥æ”¶è€…çš„å‡½æ•°ï¼Œå…¶åç§°ä¸<code class="fe lk ll lm ln b"><a class="ae ly" href="https://golang.org/src/encoding/json/encode.go?s=8333:8392#L211" rel="noopener ugc nofollow" target="_blank">Marshaler</a></code>æ¥å£ä¸­çš„å‡½æ•°åç§°ç›¸åŒ</p><pre class="kd ke kf kg gt lo ln lp lq aw lr bi"><span id="e7dd" class="ls lt in ln b gy lu lv l lw lx">func (s ClassRoom) <strong class="ln io">MarshalJSON</strong>() ([]byte, error) {<br/> arrStudent := []Student{}<br/> arrKey := []int{}<br/> for k, _ := range s.Students {<br/>  arrKey = append(arrKey, k)<br/> }<br/> sort.Ints(arrKey)</span><span id="09fa" class="ls lt in ln b gy lz lv l lw lx">for _, pos := range arrKey {<br/>  arrStudent = append(arrStudent, s.Students[pos])<br/> }<br/> return json.Marshal(struct {<br/>  Name     string    `json:"name"`<br/>  Students []Student `json:"students"`<br/> }{<br/>  Name:     s.Name,<br/>  Students: arrStudent,<br/> })<br/>}</span></pre><p id="e672" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">å°±è¿™ä¹ˆç®€å•ã€‚ä½†æ˜¯å½“æˆ‘è¯•ç€æµ‹è¯•å®ƒçš„æ—¶å€™ã€‚JSONç»“æœä¸åƒæˆ‘ä»¬é¢„æœŸçš„é‚£æ ·æ­£ç¡®ã€‚æˆ‘åœ¨è¿™ä¸ªé—®é¢˜ä¸Šè¢«å¡ä½äº†å‡ ä¸ªå°æ—¶ï¼Œ:Dï¼Œæˆ‘çœŸå‚»ğŸ˜…</p><h1 id="d687" class="ma lt in bd mb mc md me mf mg mh mi mj jt mk ju ml jw mm jx mn jz mo ka mp mq bi translated"><strong class="ak">å‘å¸ƒ</strong></h1><p id="fb82" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">åœ¨ä»£ç ä¿®å¤ä¹‹å‰ï¼Œä»£ç æ›´åƒä¸‹é¢è¿™æ ·ã€‚å¦‚æœæˆ‘ä»¬çœ‹åˆ°è¿™é‡Œï¼Œå®ƒå°±åƒè¿™é‡Œæ²¡æœ‰ä»»ä½•é—®é¢˜ã€‚ä½†ç»“æœæ˜¯é”™è¯¯çš„ã€‚</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="mw mx l"/></div></figure><h1 id="e699" class="ma lt in bd mb mc md me mf mg mh mi mj jt mk ju ml jw mm jx mn jz mo ka mp mq bi translated">å›ºå®š</h1><p id="fd06" class="pw-post-body-paragraph ko kp in kq b kr mr jo kt ku ms jr kw kx mt kz la lb mu ld le lf mv lh li lj ig bi translated">åœ¨åŒå€¦äº†å¯»æ‰¾è§£å†³æ–¹æ¡ˆä¹‹åï¼Œå½“æˆ‘å¶ç„¶ç”¨ä¸€ä¸ªæŒ‡é’ˆå¯¹è±¡è°ƒç”¨JSON marshallæ—¶ï¼Œæˆ‘å‘ç°äº†è¿™ä¸ªé—®é¢˜ã€‚</p><pre class="kd ke kf kg gt lo ln lp lq aw lr bi"><span id="8a30" class="ls lt in ln b gy lu lv l lw lx">sample := <strong class="ln io">&amp;</strong>ClassRoom{ // <em class="my">See the ampersand symbol</em> "<strong class="ln io">&amp;</strong>"<br/>  Name:     "D3TI2-Classmate",<br/>  Students: students,<br/> }<br/>_,_= json.Marshal(sample)</span></pre><p id="04c9" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">è¿™å°±æ˜¯é—®é¢˜æ‰€åœ¨ã€‚åœ¨æˆ‘çš„è‡ªå®šä¹‰MarshalJSONä¸­ï¼Œæˆ‘è®©æ¥æ”¶å™¨æ˜¯ä¸€ä¸ªæŒ‡é’ˆã€‚å› æ­¤ï¼Œå¦‚æœæˆ‘è¯•å›¾å°é€ä¸€ä¸ªéæŒ‡é’ˆå¯¹è±¡ï¼Œæˆ‘çš„è‡ªå®šä¹‰MarshalJSONå°†ä¸ä¼šè¢«è°ƒç”¨ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘å°é€ä¸€ä¸ªéæŒ‡é’ˆå¯¹è±¡ï¼Œå®ƒå°†æˆåŠŸå°é€ã€‚</p><p id="a408" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">æ€»ç»“ä¸€ä¸‹:<br/>å¦‚æœæˆ‘ç”¨ä¸€ä¸ª<strong class="kq io">æŒ‡é’ˆ</strong>æ¥æ”¶å™¨æ¥å®šåˆ¶MarshalJSON</p><pre class="kd ke kf kg gt lo ln lp lq aw lr bi"><span id="75a3" class="ls lt in ln b gy lu lv l lw lx">func (s <strong class="ln io">*</strong>ClassRoom)MarshalJSON() ([]byte, error){<br/>  // Other codes<br/>}</span></pre><p id="13c1" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">ç„¶åå½“æˆ‘æƒ³å°é€å¯¹è±¡æ—¶ï¼Œæˆ‘å¿…é¡»å°†ä¸€ä¸ª<strong class="kq io">æŒ‡é’ˆ</strong>å¯¹è±¡ä¼ é€’ç»™<code class="fe lk ll lm ln b">json.Marhsal</code></p><pre class="kd ke kf kg gt lo ln lp lq aw lr bi"><span id="8d16" class="ls lt in ln b gy lu lv l lw lx">sample := <strong class="ln io">&amp;</strong>ClassRoom{ // <em class="my">See the ampersand symbol</em> "<strong class="ln io">&amp;</strong>"<br/>  Name:     "D3TI2-Classmate",<br/>  Students: students,<br/> }<br/>_,_= json.Marshal(sample)</span></pre><p id="9d02" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">å¯¹äº<strong class="kq io">éæŒ‡é’ˆ(å€¼)</strong>æ¥æ”¶å™¨ä¹Ÿæ˜¯å¦‚æ­¤ã€‚</p><p id="a8de" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">å¦‚æœæˆ‘ç”¨ä¸€ä¸ª<strong class="kq io">éæŒ‡é’ˆ(å€¼)</strong>æ¥æ”¶å™¨æ¥å®šåˆ¶MarshalJSON</p><pre class="kd ke kf kg gt lo ln lp lq aw lr bi"><span id="0b69" class="ls lt in ln b gy lu lv l lw lx">func (s ClassRoom)MarshalJSON() ([]byte, error){<br/>  // Other codes<br/>}</span></pre><p id="5a79" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">ç„¶åå½“æˆ‘æƒ³è¦å°é€å¯¹è±¡æ—¶ï¼Œæˆ‘å¿…é¡»ä¼ é€’ä¸€ä¸ª<strong class="kq io">éæŒ‡é’ˆ(å€¼)</strong>å¯¹è±¡ç»™<code class="fe lk ll lm ln b">json.Marhsal</code></p><pre class="kd ke kf kg gt lo ln lp lq aw lr bi"><span id="3326" class="ls lt in ln b gy lu lv l lw lx">sample := ClassRoom{ // <em class="my">Without the ampersand symbol</em> "<strong class="ln io">&amp;</strong>"<br/>  Name:     "D3TI2-Classmate",<br/>  Students: students,<br/> }<br/>_,_= json.Marshal(sample)</span></pre></div><div class="ab cl mz na hr nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ig ih ii ij ik"><p id="27a9" class="pw-post-body-paragraph ko kp in kq b kr ks jo kt ku kv jr kw kx ky kz la lb lc ld le lf lg lh li lj ig bi translated">å—¯ï¼Œè¿™å¯¹æˆ‘æ¥è¯´æ˜¯ä¸€ä¸ªéå¸¸æ„šè ¢çš„é—®é¢˜ï¼Œå› ä¸ºå®ƒçœŸçš„è®©æˆ‘æ„¤æ€’äº†å‡ ä¸ªå°æ—¶ã€‚è¿™è®©æˆ‘åœ¨å†³å®šä½¿ç”¨<strong class="kq io">æŒ‡é’ˆ</strong>è¿˜æ˜¯<strong class="kq io">éæŒ‡é’ˆ</strong>æ¥æ”¶å™¨æ—¶æ›´åŠ è°¨æ…ã€‚</p></div></div>    
</body>
</html>