<html>
<head>
<title>Upgrading Ruby on Rails</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">升级Ruby on Rails</h1>
<blockquote>原文：<a href="https://medium.com/quick-code/upgrading-ruby-on-rails-8773e43c45ef?source=collection_archive---------0-----------------------#2019-12-27">https://medium.com/quick-code/upgrading-ruby-on-rails-8773e43c45ef?source=collection_archive---------0-----------------------#2019-12-27</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="c076" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">本指南提供了将应用程序升级到较新版本的Ruby on Rails时需要遵循的步骤。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jc"><img src="../Images/18065ffca2e2059d48ad34133fcdd9f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/0*NW-caLjD0kx4k-w7"/></div></figure><h1 id="05f3" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">1一般建议</h1><p id="32a7" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">在尝试升级现有应用程序之前，您应该确保您有一个好的升级理由。您需要平衡几个因素:对新特性的需求、寻找旧代码支持的难度增加，以及您可用的时间和技能，等等。</p><h2 id="d3b5" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">1.1测试覆盖率</h2><p id="b7a6" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">确保您的应用程序在升级后仍然工作的最好方法是在开始升级之前进行充分的测试。如果你没有测试你的应用程序的自动化测试，你将需要花费时间手工测试所有已经改变的部分。在Rails升级的情况下，这将意味着应用程序中的每一项功能。帮你自己一个忙，确保你的测试覆盖率是好的<em class="lb">在</em>你开始升级之前。</p><h2 id="2840" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">1.2升级过程</h2><p id="e6c9" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">当更改Rails版本时，最好慢慢来，一次一个次要版本，以便充分利用弃用警告。Rails版本号的格式是Major.Minor.Patch。允许主版本和次版本对公共API进行更改，因此这可能会导致应用程序出错。补丁版本只包含bug修复，不改变任何公共API。更多信息请访问<a class="ae lc" href="https://onlineitguru.com/ruby-on-rails-online-training-placement.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi"> Ruby On Rails在线培训</strong> </a></p><p id="aafb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">该过程应该如下进行:</strong></p><ol class=""><li id="4953" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb li lj lk ll bi translated">编写测试并确保它们通过。</li><li id="2a67" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">在您的当前版本之后，移动到最新的补丁版本。</li><li id="bb71" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">修复测试和不推荐使用的功能。</li><li id="e3c0" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">移动到下一个次要版本的最新补丁版本。</li></ol><p id="6128" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">重复这个过程，直到达到目标Rails版本。每次移动版本时，您都需要在<code class="du lr ls lt lu b">Gemfile</code>(可能还有其他gem版本)中更改Rails版本号并运行<code class="du lr ls lt lu b">bundle update</code>。然后运行下面提到的更新任务来更新配置文件，然后运行您的测试。</p><p id="5fbd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以在这里找到所有已发布Rails版本的列表。</p><h2 id="b66e" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">1.3 Ruby版本</h2><p id="8cfc" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">Rails通常与最新发布的Ruby版本保持一致:</p><ul class=""><li id="7135" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb lv lj lk ll bi translated">Rails 6需要Ruby 2.5.0或更新版本。</li><li id="434a" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 5需要Ruby 2.2.2或更新版本。</li><li id="947b" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 4偏好Ruby 2.0，需要1.9.3或更新版本。</li><li id="9b45" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 3.2.x是最后一个支持Ruby 1.8.7的分支。</li><li id="9ab0" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 3及以上版本需要Ruby 1.8.7或更高版本。对所有以前的Ruby版本的支持已经被正式取消了。你应该尽早升级。</li></ul><p id="7cd3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Ruby 1.8.7 p248和p249有编组错误，导致Rails崩溃。自1 . 8 . 7–2010.02发布以来，Ruby Enterprise Edition已经修复了这些问题。在1.9版本方面，Ruby 1.9.1不可用，因为它完全存在缺陷，所以如果你想使用1.9.x版本，可以直接跳到1.9.3版本。</p><h2 id="7764" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">1.4更新任务</h2><p id="e130" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">Rails提供了<code class="du lr ls lt lu b">app:update</code>命令(4.2及更早版本中的<code class="du lr ls lt lu b">rake rails:update</code>)。在<code class="du lr ls lt lu b">Gemfile</code>中更新Rails版本后，运行这个命令。这将帮助您在交互式会话中创建新文件和更改旧文件。</p><p id="4c14" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">$ rails app:update</code></p><p id="d420" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">identical config/boot.rb</code></p><p id="9b47" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">exist config</code></p><p id="aa02" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">conflict config/routes.rb</code></p><p id="b731" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">Overwrite /myapp/config/routes.rb? (enter "h" for help) [Ynaqdh]</code></p><p id="b50b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">force config/routes.rb</code></p><p id="99d0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">conflict config/application.rb</code></p><p id="bfee" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">Overwrite /myapp/config/application.rb? (enter "h" for help) [Ynaqdh]</code></p><p id="2a4d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">force config/application.rb</code></p><p id="7cc7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">conflict config/environment.rb</code></p><p id="13b0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">...</code></p><p id="d778" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">不要忘了检查差异，看看是否有任何意想不到的变化。</p><h2 id="351e" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">1.5配置框架默认值</h2><p id="8139" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">新的Rails版本可能与以前的版本有不同的配置默认值。然而，在执行了上述步骤之后，您的应用程序仍然会使用<em class="lb">以前的</em> Rails版本的默认配置运行。这是因为<code class="du lr ls lt lu b">config/application.rb</code>中的<code class="du lr ls lt lu b">config.load_defaults</code>的值尚未更改。</p><p id="c155" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了允许您逐个升级到新的默认值，更新任务创建了一个文件<code class="du lr ls lt lu b">config/initializers/new_framework_defaults.rb</code>。一旦您的应用程序准备好使用新的默认值运行，您就可以删除这个文件并翻转<code class="du lr ls lt lu b">config.load_defaults</code>值。</p><h1 id="7bb6" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">2从Rails 5.2升级到Rails 6.0</h1><p id="0a0f" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">有关Rails 6.0更改的更多信息，请参见发行说明。</p><h2 id="f5f9" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">2.1使用Webpacker</h2><p id="7dfd" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">Webpacker是Rails 6的默认JavaScript编译器。但如果是升级app，默认不激活。如果您想使用Webpacker，那么将它包含在您的Gemfile中并安装它:</p><p id="eac7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">gem <em class="lb">"webpacker"</em></code></p><p id="2291" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">bin/rails webpacker:install</code></p><h2 id="9517" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">2.2强制SSL</h2><p id="5904" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">控制器上的<code class="du lr ls lt lu b">force_ssl</code>方法已经被弃用，并将在Rails 6.1中被移除。我们鼓励您在整个应用程序中启用<code class="du lr ls lt lu b">config.force_ssl</code>来实施HTTPS连接。如果您需要免除某些端点的重定向，您可以使用<code class="du lr ls lt lu b">config.ssl_options</code>来配置该行为。</p><h2 id="ee82" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">2.3签名或加密cookie中的目的现已嵌入cookie中</h2><p id="0966" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">为了提高安全性，Rails将目的信息嵌入到加密或签名的cookies值中。Rails可以阻止试图复制cookie的签名/加密值并将其用作另一个cookie的值的攻击。</p><p id="8de8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这种新嵌入信息使得这些cookies与6.0之前的Rails版本不兼容。</p><p id="88ba" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您要求您的cookies由Rails 5.2和更早版本读取，或者您仍在验证您的6.0部署并希望能够回滚，请将<code class="du lr ls lt lu b">Rails.application.config.action_dispatch.use_cookies_with_metadata</code>设置为<code class="du lr ls lt lu b">false</code>。</p><h2 id="401a" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">2.4所有npm包都已被移到<code class="du lr ls lt lu b">@rails</code>范围</h2><p id="18f3" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">如果您之前通过npm/yarn加载了任何一个<code class="du lr ls lt lu b">actioncable</code>、<code class="du lr ls lt lu b">activestorage</code>或<code class="du lr ls lt lu b">rails-ujs</code>包，那么您必须更新这些依赖项的名称，然后才能将它们升级到<code class="du lr ls lt lu b">6.0.0</code>:</p><p id="67cb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">actioncable → @rails/actioncable</code></p><p id="8223" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">activestorage → @rails/activestorage</code></p><p id="d8f4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">rails-ujs → @rails/ujs</code></p><h2 id="caa0" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">2.5 Action Cable JavaScript API变化</h2><p id="d9ab" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">Action Cable JavaScript包已经从CoffeeScript转换到ES2015，我们现在在npm发行版中发布源代码。</p><p id="9083" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">此版本包括对Action Cable JavaScript API可选部分的一些突破性更改:</p><ul class=""><li id="6012" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb lv lj lk ll bi translated">WebSocket适配器和logger适配器的配置已从<code class="du lr ls lt lu b">ActionCable</code>的属性移至<code class="du lr ls lt lu b">ActionCable.adapters</code>的属性。如果您正在配置这些适配器，您将需要进行以下更改:</li></ul><p id="a8e5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">- ActionCable.WebSocket = MyWebSocket</code></p><p id="4598" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">+ ActionCable.adapters.WebSocket = MyWebSocket</code></p><p id="e3ed" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">- ActionCable.logger = myLogger</code></p><p id="0a9c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">+ ActionCable.adapters.logger = myLogger</code></p><ul class=""><li id="121f" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb lv lj lk ll bi translated"><code class="du lr ls lt lu b">ActionCable.startDebugging()</code>和<code class="du lr ls lt lu b">ActionCable.stopDebugging()</code>方法已被移除，并替换为属性<code class="du lr ls lt lu b">ActionCable.logger.enabled</code>。如果您正在使用这些方法，您将需要进行这些更改:</li></ul><p id="b9e8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">- ActionCable.startDebugging()</code></p><p id="c3b4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">+ ActionCable.logger.enabled = true</code></p><p id="f2bc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">- ActionCable.stopDebugging()</code></p><p id="7b84" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">+ ActionCable.logger.enabled = false</code></p><div class="lw lx ez fb ly lz"><a href="https://onlineitguru.com/interviewquestions/ruby-on-rails-interview-questions" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hi fi z dy me ea eb mf ed ef hg bi translated">Ruby on Rails面试问答- 2019 | OnlineITGuru</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">你是正确的地方，如果你正在寻找Ruby on Rails面试问题和答案，获得更多的信心来破解…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">onlineitguru.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn ji lz"/></div></div></a></div><h2 id="1b21" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">2.6 <code class="du lr ls lt lu b">ActionDispatch::Response#content_type</code>现在原样返回内容类型头。</h2><p id="7864" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">以前，<code class="du lr ls lt lu b">ActionDispatch::Response#content_type</code>返回值不包含字符集部分。此行为更改为返回包含字符集部分的内容类型头。</p><p id="18f2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你想要的只是MIME类型，请使用<code class="du lr ls lt lu b">ActionDispatch::Response#media_type</code>来代替。</p><p id="5114" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">之前:</strong></p><p id="41fb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">resp = ActionDispatch::Response.new(200, <em class="lb">"Content-Type"</em></code> <code class="du lr ls lt lu b">=&gt; <em class="lb">"text/csv; header=present; charset=utf-16"</em>)</code></p><p id="cc19" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">resp.content_type #=&gt; "text/csv; header=present"</code></p><p id="dcd9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">之后:</strong></p><p id="2524" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">resp = ActionDispatch::Response.new(200, <em class="lb">"Content-Type"</em></code>T11】</p><p id="89db" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">resp.content_type #=&gt; "text/csv; header=present; charset=utf-16"</code></p><p id="99cc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">resp.media_type #=&gt; "text/csv"</code></p><h2 id="47cd" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">2.7自动装载</h2><p id="f9c8" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">Rails 6的默认配置</p><p id="15e8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># config/application.rb</code></p><p id="4dfb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.load_defaults <em class="lb">"6.0"</em></code></p><p id="d554" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">启用CRuby上的<code class="du lr ls lt lu b">zeitwerk</code>自动装载模式。在这种模式下，自动加载、重新加载和快速加载由Zeitwerk管理。</p><p id="4190" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 2.7.1公共API </strong></p><p id="a091" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一般来说，应用程序不需要直接使用Zeitwerk的API。Rails根据现有的契约进行设置:<code class="du lr ls lt lu b">config.autoload_paths</code>、<code class="du lr ls lt lu b">config.cache_classes</code>等。</p><p id="8c02" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">虽然应用程序应该坚持使用这个接口，但是实际的Zeitwerk loader对象可以像</p><p id="cbd7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">Rails.autoloaders.main</code></p><p id="553a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">例如，如果您需要预加载STI或配置一个定制的偏转器，这可能会很方便。</p><p id="f275" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 2.7.2项目结构</strong></p><p id="6907" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果正在升级的应用程序自动加载正确，项目结构应该已经基本兼容。</p><p id="50dc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然而，<code class="du lr ls lt lu b">classic</code>模式从丢失的常量名(<code class="du lr ls lt lu b">underscore</code>)推断文件名，而<code class="du lr ls lt lu b">zeitwerk</code>模式从文件名(<code class="du lr ls lt lu b">camelize</code>)推断常量名。这些助手并不总是彼此相反，尤其是在涉及到首字母缩写词的情况下。比如<code class="du lr ls lt lu b">"FOO".underscore</code>是<code class="du lr ls lt lu b">"foo"</code>，但是<code class="du lr ls lt lu b">"foo".camelize</code>是<code class="du lr ls lt lu b">"Foo"</code>，不是<code class="du lr ls lt lu b">"FOO"</code>。</p><p id="ec1a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">兼容性可以通过</strong> <code class="du lr ls lt lu b"><strong class="ig hi">zeitwerk:check</strong></code> <strong class="ig hi">任务进行检查:</strong></p><p id="28d3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">$ bin/rails zeitwerk:check</code></p><p id="a42d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">Hold on, I am eager loading the application.</code></p><p id="3dc1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">All is good!</code></p><p id="70ef" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 2.7.3需求_依赖</strong></p><p id="2077" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所有已知的<code class="du lr ls lt lu b">require_dependency</code>用例都已经被删除，你应该grep这个项目并删除它们。</p><p id="5eee" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您的应用程序有STI，请查看指南自动加载和重新加载常量(Zeitwerk模式)中的STI部分。</p><p id="54aa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 2.7.4类和模块定义中的限定名</strong></p><p id="5c65" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，您可以在类和模块定义中可靠地使用常量路径:</p><p id="6113" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Autoloading in this class' body matches Ruby semantics now.</code></p><p id="ed30" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code> <code class="du lr ls lt lu b">Admin::UsersController &lt; ApplicationController</code></p><p id="5d0c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># ...</code></p><p id="512d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="0acf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">需要注意的一个问题是，根据执行的顺序，传统的自动加载程序有时能够自动加载<code class="du lr ls lt lu b">Foo::Wadus</code></p><p id="01b9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code> <code class="du lr ls lt lu b">Foo::Bar</code></p><p id="af08" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">Wadus</code></p><p id="828b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="1694" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这不符合Ruby语义，因为<code class="du lr ls lt lu b">Foo</code>不在嵌套中，在<code class="du lr ls lt lu b">zeitwerk</code>模式下根本无法工作。如果您发现这种情况，您可以使用限定名<code class="du lr ls lt lu b">Foo::Wadus</code>:</p><p id="9b6e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code> <code class="du lr ls lt lu b">Foo::Bar</code></p><p id="b2fc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">Foo::Wadus</code></p><p id="6d1d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="829f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">或添加</strong> <code class="du lr ls lt lu b"><strong class="ig hi">Foo</strong></code> <strong class="ig hi">到嵌套:</strong></p><p id="02c0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">module</code> <code class="du lr ls lt lu b">Foo</code></p><p id="2116" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code> <code class="du lr ls lt lu b">Bar</code></p><p id="c013" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">Wadus</code></p><p id="1c8e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="5666" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="ff88" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 2.7.5关注点</strong></p><p id="fb49" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以从标准结构中自动加载和快速加载，如</p><p id="a9f0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">app/models</code></p><p id="0433" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">app/models/concerns</code></p><p id="216a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这种情况下，<code class="du lr ls lt lu b">app/models/concerns</code>被认为是一个根目录(因为它属于自动加载路径)，它作为名称空间被忽略。所以，<code class="du lr ls lt lu b">app/models/concerns/foo.rb</code>应该定义<code class="du lr ls lt lu b">Foo</code>，而不是<code class="du lr ls lt lu b">Concerns::Foo</code>。</p><p id="a254" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">作为实现的副作用，<code class="du lr ls lt lu b">Concerns::</code>名称空间与经典的自动加载器一起工作，但这并不是真正想要的行为。使用<code class="du lr ls lt lu b">Concerns::</code>的应用程序需要重命名这些类和模块，以便能够在<code class="du lr ls lt lu b">zeitwerk</code>模式下运行。</p><p id="2c6b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 2.7.6自动加载路径</strong>中有 <code class="du lr ls lt lu b"><strong class="ig hi">app</strong></code> <strong class="ig hi"/></p><p id="8ab1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一些项目希望用类似于<code class="du lr ls lt lu b">app/api/base.rb</code>的东西来定义<code class="du lr ls lt lu b">API::Base</code>，并在<code class="du lr ls lt lu b">classic</code>模式下将<code class="du lr ls lt lu b">app</code>添加到自动加载路径中来完成。由于Rails会自动将<code class="du lr ls lt lu b">app</code>的所有子目录添加到自动加载路径中，所以我们会遇到另一种情况，即存在嵌套的根目录，这样安装程序就不再工作了。类似的原理我们在上面用<code class="du lr ls lt lu b">concerns</code>解释过。</p><p id="fc6f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您想保留这个结构，您需要从初始化器的自动加载路径中删除子目录:</p><p id="9742" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">ActiveSupport::Dependencies.autoload_paths.delete(<em class="lb">"#{Rails.root}/app/api"</em>)</code></p><p id="dddd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 2.7.7自动加载的常量和显式名称空间</strong></p><p id="d910" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果在文件中定义了名称空间，如<code class="du lr ls lt lu b">Hotel</code>所示:</p><p id="e25e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">app/models/hotel.rb # Defines Hotel.</code></p><p id="d0f0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">app/models/hotel/pricing.rb # Defines Hotel::Pricing.</code></p><p id="3e58" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">必须使用<code class="du lr ls lt lu b">class</code>或<code class="du lr ls lt lu b">module</code>关键字设置<code class="du lr ls lt lu b">Hotel</code>常量。例如:</p><p id="92d3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code>T29】</p><p id="79ca" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="617f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">很好。</p><p id="f77e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">替代品，如</p><p id="8fc9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">Hotel = Class.new</code></p><p id="4c65" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">或者</p><p id="c37f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">Hotel = Struct.new</code></p><p id="2db2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">不行，像<code class="du lr ls lt lu b">Hotel::Pricing</code>这样的子对象是找不到的。</p><p id="32dc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">此限制仅适用于显式命名空间。没有定义名称空间的类和模块可以使用这些习惯用法来定义。</p><p id="df57" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 2.7.8一个文件，一个常量(在同一顶层)</strong></p><p id="064b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在<code class="du lr ls lt lu b">classic</code>模式中，你可以在同一个顶层定义几个常量，并重新加载它们。例如，鉴于</p><p id="b0ef" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># app/models/foo.rb</code></p><p id="6fa2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code> <code class="du lr ls lt lu b">Foo</code></p><p id="a752" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="a34c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code> <code class="du lr ls lt lu b">Bar</code></p><p id="9d16" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="be50" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">虽然<code class="du lr ls lt lu b">Bar</code>无法自动加载，但自动加载<code class="du lr ls lt lu b">Foo</code>也会将<code class="du lr ls lt lu b">Bar</code>标记为自动加载。在<code class="du lr ls lt lu b">zeitwerk</code>模式下不是这样，你需要将<code class="du lr ls lt lu b">Bar</code>移动到它自己的文件<code class="du lr ls lt lu b">bar.rb</code>中。一个文件，一个常量。</p><p id="2399" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这仅影响与上例相同的顶级常量。内部类和模块都可以。例如，考虑</p><p id="d6fd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># app/models/foo.rb</code></p><p id="9455" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code> <code class="du lr ls lt lu b">Foo</code></p><p id="2432" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code>T19】</p><p id="dcf4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="53ed" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="4c8d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果应用程序重新加载<code class="du lr ls lt lu b">Foo</code>，它也会重新加载<code class="du lr ls lt lu b">Foo::InnerClass</code>。</p><p id="3493" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.7.9弹簧与<code class="du lr ls lt lu b">test</code>环境</p><p id="c097" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果发生变化，Spring会重新加载应用程序代码。在<code class="du lr ls lt lu b">test</code>环境中，您需要启用重新加载来工作:</p><p id="5915" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># config/environments/test.rb</code></p><p id="0c08" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.cache_classes = false</code></p><p id="a2cc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">否则，您会得到以下错误:</p><p id="e54b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">reloading is disabled because config.cache_classes is true</code></p><p id="7518" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">启动快照</p><p id="2300" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> Bootsnap版本至少应为1.4.2。</strong></p><p id="a511" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">除此之外，如果运行Ruby 2.5，Bootsnap需要禁用iseq缓存，因为解释器中有一个bug。在这种情况下，请确保至少依赖于Bootsnap 1.4.4。</p><p id="5685" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">2 . 7 . 11</strong>T29】</p><p id="004e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">新的配置点</p><p id="bcc7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.add_autoload_paths_to_load_path</code></p><p id="5886" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">默认情况下，<code class="du lr ls lt lu b">true</code>是为了向后兼容，但是允许你选择不添加自动加载路径到<code class="du lr ls lt lu b">$LOAD_PATH</code>。</p><p id="d882" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这在大多数应用程序中是有意义的，因为你不应该在<code class="du lr ls lt lu b">app/models</code>中需要一个文件，例如，Zeitwerk只在内部使用绝对文件名。</p><p id="0487" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过选择退出，您可以优化<code class="du lr ls lt lu b">$LOAD_PATH</code>查找(检查更少的目录)，并节省Bootsnap工作和内存消耗，因为它不需要为这些目录构建索引。</p><p id="8754" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 2.7.12线程安全</strong></p><p id="94da" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在经典模式下，持续的自动加载并不是线程安全的，尽管Rails有锁，比如在启用自动加载时使web请求线程安全，这在<code class="du lr ls lt lu b">development</code>模式下很常见。</p><p id="91e5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在<code class="du lr ls lt lu b">zeitwerk</code>模式下，持续自动加载是线程安全的。例如，你现在可以自动加载由<code class="du lr ls lt lu b">runner</code>命令执行的多线程脚本。</p><p id="e641" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">2 . 7 . 13 Globs in config . autoload _ paths</strong></p><p id="5caf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">小心以下配置</p><p id="46b8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.autoload_paths += Dir[<em class="lb">"#{config.root}/lib/**/"</em>]</code></p><p id="183c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.autoload_paths</code>的每个元素都应该代表顶级名称空间(<code class="du lr ls lt lu b">Object</code>)，因此它们不能嵌套(除了上面解释的<code class="du lr ls lt lu b">concerns</code>目录)。</p><p id="b273" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要解决这个问题，只需删除通配符:</p><p id="4bb4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.autoload_paths &lt;&lt; <em class="lb">"#{config.root}/lib"</em></code></p><p id="171f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 2.7.14热切加载和自动加载一致</strong></p><p id="18b2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在<code class="du lr ls lt lu b">classic</code>模式下，如果<code class="du lr ls lt lu b">app/models/foo.rb</code>定义了<code class="du lr ls lt lu b">Bar</code>，你将无法自动加载该文件，但是急切加载将会工作，因为它会盲目地递归加载文件。这可能是一个错误的来源，如果您测试的东西第一次急切加载，执行可能会失败以后自动加载。</p><p id="da1c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在<code class="du lr ls lt lu b">zeitwerk</code>模式下，两种加载模式是一致的，它们在相同的文件中失败和出错。</p><p id="4c90" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 2.7.15如何在Rails 6中使用经典自动加载器</strong></p><p id="2bac" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过这样设置<code class="du lr ls lt lu b">config.autoloader</code>，应用程序可以加载Rails 6默认值，并且仍然使用经典的自动加载程序:</p><p id="d460" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># config/application.rb</code></p><p id="a824" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.load_defaults <em class="lb">"6.0"</em></code></p><p id="4b46" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.autoloader = <strong class="ig hi">:classic</strong></code></p><p id="6ab5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在Rails 6应用程序中使用经典自动加载器时，出于线程安全考虑，建议在开发环境中将web服务器和后台处理器的并发级别设置为1。</p><div class="lw lx ez fb ly lz"><a href="https://onlineitguru.com/blog/ruby-vs-python" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hi fi z dy me ea eb mf ed ef hg bi translated">Ruby Vs Python |和Python的区别| OnlineITGuru</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">Ruby是灵活的，它赋予程序员权力。有了Ruby on rails，我们可以设计许多漂亮的网站…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">onlineitguru.com</p></div></div><div class="mi l"><div class="mo l mk ml mm mi mn ji lz"/></div></div></a></div><h2 id="e094" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">2.8主动存储分配行为变化</h2><p id="f04a" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">在Rails 5.2中，分配给用附加的新文件<code class="du lr ls lt lu b">has_many_attached</code>声明的附件集合:</p><p id="7d1b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code> <code class="du lr ls lt lu b">User &lt; ApplicationRecord</code></p><p id="eaf2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">has_many_attached <strong class="ig hi">:highlights</strong></code></p><p id="35f3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="2d7d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">user.highlights.attach(filename: <em class="lb">"funky.jpg"</em>, ...)</code></p><p id="6a67" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">user.higlights.count # =&gt; 1</code></p><p id="c460" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">blob = ActiveStorage::Blob.create_after_upload!(filename: <em class="lb">"town.jpg"</em>, ...)</code></p><p id="04b1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">user.update!(highlights: [ blob ])</code></p><p id="bf43" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">user.highlights.count # =&gt; 2</code></p><p id="5696" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">user.highlights.first.filename # =&gt; "funky.jpg"</code></p><p id="e9bc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">user.highlights.second.filename # =&gt; "town.jpg"</code></p><p id="9dde" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于Rails 6.0的默认配置，分配给附件集合会替换现有文件，而不是附加到它们。这与分配给集合关联时的活动记录行为相匹配:</p><p id="6f75" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">user.highlights.attach(filename: <em class="lb">"funky.jpg"</em>, ...)</code></p><p id="f03e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">user.highlights.count # =&gt; 1</code></p><p id="bd81" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">blob = ActiveStorage::Blob.create_after_upload!(filename: <em class="lb">"town.jpg"</em>, ...)</code></p><p id="5578" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">user.update!(highlights: [ blob ])</code></p><p id="cf53" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">user.highlights.count # =&gt; 1</code></p><p id="a90f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">user.highlights.first.filename # =&gt; "town.jpg"</code></p><p id="7cdb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">#attach</code>可用于在不删除现有附件的情况下添加新附件:</p><p id="c54d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">blob = ActiveStorage::Blob.create_after_upload!(filename: <em class="lb">"town.jpg"</em>, ...)</code></p><p id="fcf1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">user.highlights.attach(blob)</code></p><p id="6257" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">user.highlights.count # =&gt; 2</code></p><p id="7c65" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">user.highlights.first.filename # =&gt; "funky.jpg"</code></p><p id="65b4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">user.highlights.second.filename # =&gt; "town.jpg"</code></p><p id="e862" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过将<code class="du lr ls lt lu b">config.active_storage.replace_on_assign_to_many</code>设置为<code class="du lr ls lt lu b">true</code>来选择新的默认行为。在Rails 6.1中，旧的行为将被弃用，并在后续版本中被移除。</p><h1 id="455d" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">3从Rails 5.1升级到Rails 5.2</h1><p id="5a65" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">有关Rails 5.2变更的更多信息，请参见发行说明。</p><h2 id="0cc9" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">3.1启动快照</h2><p id="33c2" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">Rails 5.2在新生成的app的Gemfile中增加了bootsnap gem。<code class="du lr ls lt lu b">app:update</code>命令在<code class="du lr ls lt lu b">boot.rb</code>中设置它。如果你想使用它，那么把它添加到Gemfile中，否则把<code class="du lr ls lt lu b">boot.rb</code>改成不使用bootsnap。</p><h2 id="42f4" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">3.2签名或加密cookie中的到期现在嵌入在cookie值中</h2><p id="7167" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">为了提高安全性，Rails现在还在加密或签名的cookies值中嵌入到期信息。</p><p id="4771" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这种新嵌入信息使得这些cookies与5.2之前的Rails版本不兼容。</p><p id="f656" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您需要5.1及更早版本读取您的cookies，或者您仍在验证您的5.2部署，并希望允许您回滚，请将<code class="du lr ls lt lu b">Rails.application.config.action_dispatch.use_authenticated_cookie_encryption</code>设置为<code class="du lr ls lt lu b">false</code>。</p><h1 id="e763" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">4从Rails 5.0升级到Rails 5.1</h1><p id="f060" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">有关Rails 5.1变更的更多信息，请参见发行说明。</p><h2 id="9942" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">4.1顶级<code class="du lr ls lt lu b">HashWithIndifferentAccess</code>已被弃用</h2><p id="bd6a" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">如果您的应用程序使用顶级的<code class="du lr ls lt lu b">HashWithIndifferentAccess</code>类，您应该慢慢地将代码改为使用<code class="du lr ls lt lu b">ActiveSupport::HashWithIndifferentAccess</code>。</p><p id="1ed3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">它只是不推荐使用的，这意味着您的代码目前不会中断，也不会显示不推荐使用的警告，但是将来会移除该常量。</p><p id="88c4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">此外，如果您有包含这种对象的转储的非常旧的YAML文档，您可能需要再次加载和转储它们，以确保它们引用正确的常数，并且加载它们在将来不会中断。</p><h2 id="89cf" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">4.2 <code class="du lr ls lt lu b">application.secrets</code>现在加载所有按键作为符号</h2><p id="8f4c" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">如果您的应用程序在<code class="du lr ls lt lu b">config/secrets.yml</code>中存储了嵌套配置，那么现在所有的键都作为符号加载，所以使用字符串的访问应该被改变。</p><p id="4942" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">来自:</strong></p><p id="04f8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">Rails.application.secrets[<strong class="ig hi">:smtp_settings</strong>][<em class="lb">"address"</em>]</code></p><p id="fbe1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">至:</strong></p><p id="02b3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">Rails.application.secrets[<strong class="ig hi">:smtp_settings</strong>][<strong class="ig hi">:address</strong>]</code></p><h2 id="62eb" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">4.3删除了对<code class="du lr ls lt lu b">render</code>中<code class="du lr ls lt lu b">:text</code>和<code class="du lr ls lt lu b">:nothing</code>的不推荐支持</h2><p id="ac92" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">如果您的视图正在使用<code class="du lr ls lt lu b">render :text</code>，它们将不再工作。呈现MIME类型为<code class="du lr ls lt lu b">text/plain</code>的文本的新方法是使用<code class="du lr ls lt lu b">render :plain</code>。</p><p id="5407" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">类似地，<code class="du lr ls lt lu b">render :nothing</code>也被删除，您应该使用<code class="du lr ls lt lu b">head</code>方法来发送只包含头的响应。例如，<code class="du lr ls lt lu b">head :ok</code>发送了一个200的响应，但没有要渲染的正文。</p><h1 id="7bed" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">5从Rails 4.2升级到Rails 5.0</h1><p id="fe0f" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">有关Rails 5.0更改的更多信息，请参见发行说明。</p><h2 id="a837" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">需要5.1 Ruby 2.2.2+版本</h2><p id="d8bb" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">从Ruby on Rails 5.0开始，Ruby 2.2.2+是唯一受支持的Ruby版本。在继续之前，请确保您使用的是Ruby 2.2.2或更高版本。</p><h2 id="708a" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">5.2活动记录模型现在默认从ApplicationRecord继承</h2><p id="760d" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">在Rails 4.2中，活动记录模型继承自<code class="du lr ls lt lu b">ActiveRecord::Base</code>。在Rails 5.0中，所有模型都继承了<code class="du lr ls lt lu b">ApplicationRecord</code>。</p><p id="48ca" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">ApplicationRecord</code>是所有应用模型的新超类，类似于应用控制器子类<code class="du lr ls lt lu b">ApplicationController</code>而不是<code class="du lr ls lt lu b">ActionController::Base</code>。这为应用程序提供了配置应用程序范围内模型行为的单一位置。</p><p id="9cb8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当从Rails 4.2升级到Rails 5.0时，需要在<code class="du lr ls lt lu b">app/models/</code>中创建一个<code class="du lr ls lt lu b">application_record.rb</code>文件，并添加以下内容:</p><p id="be76" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class ApplicationRecord &lt; ActiveRecord::Base</code></p><p id="c054" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">self.abstract_class = true</code></p><p id="d304" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="a900" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后确保你所有的模型都继承它。</p><h2 id="4ec0" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">5.3通过<code class="du lr ls lt lu b">throw(:abort)</code>停止回调链</h2><p id="a1d1" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">在Rails 4.2中，当一个‘before’回调在活动记录和活动模型中返回<code class="du lr ls lt lu b">false</code>时，整个回调链就会暂停。换句话说，不执行连续的“before”回调，也不执行包装在回调中的操作。</p><p id="8135" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在Rails 5.0中，在活动记录或活动模型回调中返回<code class="du lr ls lt lu b">false</code>不会有暂停回调链的副作用。相反，回调链必须通过调用<code class="du lr ls lt lu b">throw(:abort)</code>显式停止。</p><p id="74e6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当您从Rails 4.2升级到Rails 5.0时，在这种回调中返回<code class="du lr ls lt lu b">false</code>仍然会暂停回调链，但是您会收到一个关于这个即将到来的变化的反对警告。</p><p id="34a4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">准备就绪后，您可以选择新的行为，并通过将以下配置添加到您的<code class="du lr ls lt lu b">config/application.rb</code>中来删除不赞成警告:</p><p id="d236" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">ActiveSupport.halt_callback_chains_on_return_false = false</code></p><p id="2543" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请注意，此选项不会影响活动支持回调，因为它们不会在返回任何值时暂停链。</p><h2 id="422a" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">5.4 ActiveJob现在默认从ApplicationJob继承</h2><p id="1e0b" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">在Rails 4.2中，活动作业继承自<code class="du lr ls lt lu b">ActiveJob::Base</code>。在Rails 5.0中，这种行为已经改变为现在从<code class="du lr ls lt lu b">ApplicationJob</code>继承。</p><p id="8994" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当从Rails 4.2升级到Rails 5.0时，需要在<code class="du lr ls lt lu b">app/jobs/</code>中创建一个<code class="du lr ls lt lu b">application_job.rb</code>文件，并添加以下内容:</p><p id="17b2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class ApplicationJob &lt; ActiveJob::Base</code></p><p id="5bb8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="f5a4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后确保您的所有作业类都继承自它。</p><h2 id="fe59" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">5.5轨道控制器测试</h2><p id="b7b6" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">5.5.1提取一些辅助方法到<code class="du lr ls lt lu b">rails-controller-testing</code></p><p id="b940" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">assigns</code>和<code class="du lr ls lt lu b">assert_template</code>已经被提取到<code class="du lr ls lt lu b">rails-controller-testing</code>宝石中。要在控制器测试中继续使用这些方法，请将<code class="du lr ls lt lu b">gem 'rails-controller-testing'</code>添加到<code class="du lr ls lt lu b">Gemfile</code>中。</p><p id="1350" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您使用Rspec进行测试，请参阅gem文档中要求的额外配置。</p><p id="f73b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">5.5.2上传文件时的新行为</p><p id="8569" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您在测试中使用<code class="du lr ls lt lu b">ActionDispatch::Http::UploadedFile</code>来上传文件，您将需要改为使用类似的<code class="du lr ls lt lu b">Rack::Test::UploadedFile</code>类。</p><h2 id="1867" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">5.6在生产环境中引导后，自动加载被禁用</h2><p id="ae19" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">默认情况下，在生产环境中引导后，自动加载现已禁用。</p><p id="0343" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">急切地加载应用程序是引导过程的一部分，所以顶级常量很好，仍然是自动加载的，不需要它们的文件。</p><p id="da69" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">更深层次的常量只在运行时执行，就像常规的方法体一样，也很好，因为定义它们的文件在启动时就已经被加载了。</p><p id="21a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于大多数应用程序来说，这种改变不需要任何操作。但是在极少数情况下，您的应用程序在生产模式下运行时需要自动加载，请将<code class="du lr ls lt lu b">Rails.application.config.enable_dependency_loading</code>设置为true。</p><h2 id="0754" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">5.7 XML序列化</h2><p id="a870" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated"><code class="du lr ls lt lu b">ActiveModel::Serializers::Xml</code>已经从导轨上提取到<code class="du lr ls lt lu b">activemodel-serializers-xml</code>宝石上。要继续在您的应用程序中使用XML序列化，请将<code class="du lr ls lt lu b">gem 'activemodel-serializers-xml'</code>添加到您的<code class="du lr ls lt lu b">Gemfile</code>中。</p><h2 id="a696" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">5.8删除了对传统<code class="du lr ls lt lu b">mysql</code>数据库适配器的支持</h2><p id="cd5b" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">Rails 5取消了对传统数据库适配器<code class="du lr ls lt lu b">mysql</code>的支持。大多数用户应该可以使用<code class="du lr ls lt lu b">mysql2</code>来代替。当我们找到人来维护它时，它将被转换成一个单独的宝石。</p><h2 id="9323" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">5.9删除了对调试器的支持</h2><p id="18bb" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated"><code class="du lr ls lt lu b">debugger</code>不被Rails 5所要求的Ruby 2.2支持。用<code class="du lr ls lt lu b">byebug</code>代替。</p><h2 id="2536" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">5.10使用<code class="du lr ls lt lu b">rails</code>运行任务和测试</h2><p id="cd67" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">Rails 5增加了通过<code class="du lr ls lt lu b">bin/rails</code>而不是rake运行任务和测试的能力。一般来说，这些变化是与rake并行的，但有些是一起移植过来的。由于<code class="du lr ls lt lu b">rails</code>命令已经寻找并运行了<code class="du lr ls lt lu b">bin/rails</code>，我们建议您在“bin/rails”上使用较短的<code class="du lr ls lt lu b">rails</code>。</p><p id="bec2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要使用新的测试运行器，只需输入<code class="du lr ls lt lu b">rails test</code>。</p><p id="73cc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">rake dev:cache</code>现在是<code class="du lr ls lt lu b">rails dev:cache</code>。</p><p id="a28c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在您的应用程序目录中运行<code class="du lr ls lt lu b">rails</code>,查看可用的命令列表。</p><h2 id="bf5c" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">5.11 <code class="du lr ls lt lu b">ActionController::Parameters</code>不再继承<code class="du lr ls lt lu b">HashWithIndifferentAccess</code></h2><p id="51c8" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">在你的应用程序中调用<code class="du lr ls lt lu b">params</code>现在将返回一个对象而不是一个散列。如果您的参数已经被允许，那么您就不需要做任何更改。如果你正在使用<code class="du lr ls lt lu b">map</code>和其他依赖于能够读取散列的方法，而不管<code class="du lr ls lt lu b">permitted?</code>如何，你将需要升级你的应用程序以首先允许，然后转换成散列。</p><p id="c2cd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">params.permit([:proceed_to, :return_to]).to_h</code></p><h2 id="bc10" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">5.12 <code class="du lr ls lt lu b">protect_from_forgery</code>现在默认为<code class="du lr ls lt lu b">prepend: false</code></h2><p id="6081" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated"><code class="du lr ls lt lu b">protect_from_forgery</code>默认为<code class="du lr ls lt lu b">prepend: false</code>，这意味着它将被插入到你在应用程序中调用它的回调链中。如果您希望<code class="du lr ls lt lu b">protect_from_forgery</code>总是首先运行，那么您应该将您的应用程序改为使用<code class="du lr ls lt lu b">protect_from_forgery prepend: true</code>。</p><div class="lw lx ez fb ly lz"><a href="https://onlineitguru.com/blog/why-upgrade-your-application-to-ruby-on-rails-5-2" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hi fi z dy me ea eb mf ed ef hg bi translated">为什么要将您的应用程序升级到ruby on rails 5.2 | OnlineITGuru</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">Ruby On Rails是一个服务器端的web应用程序框架。它是用Ruby语言写的。Rail是一个模型视图…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">onlineitguru.com</p></div></div><div class="mi l"><div class="mp l mk ml mm mi mn ji lz"/></div></div></a></div><h2 id="f7b4" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">5.13默认模板处理程序现在是原始的</h2><p id="022b" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">扩展名中没有模板处理程序的文件将使用raw处理程序呈现。以前，Rails会使用ERB模板处理程序来呈现文件。</p><p id="3ee1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您不希望通过raw处理程序处理您的文件，您应该为您的文件添加一个可以被适当的模板处理程序解析的扩展名。</p><h2 id="fc03" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">5.14为模板依赖项添加了通配符匹配</h2><p id="aa13" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">现在，您可以对模板依赖项使用通配符匹配。例如，如果您这样定义模板:</p><p id="a956" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">&lt;%</code> <code class="du lr ls lt lu b"># Template Dependency: recordings/threads/events/subscribers_changed %&gt;</code></p><p id="5e10" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">&lt;%</code>T3】</p><p id="f3b8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">&lt;%</code> <code class="du lr ls lt lu b"># Template Dependency: recordings/threads/events/uncompleted %&gt;</code></p><p id="fd79" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，您只需使用通配符调用依赖项一次。</p><p id="3de2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">&lt;%</code> <code class="du lr ls lt lu b"># Template Dependency: recordings/threads/events/* %&gt;</code></p><h2 id="952d" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">5.15 <code class="du lr ls lt lu b">ActionView::Helpers::RecordTagHelper</code>移动到外部宝石(记录_标签_助手)</h2><p id="6410" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated"><code class="du lr ls lt lu b">content_tag_for</code>和<code class="du lr ls lt lu b">div_for</code>已被删除，只使用<code class="du lr ls lt lu b">content_tag</code>。要继续使用旧方法，请将<code class="du lr ls lt lu b">record_tag_helper</code>宝石添加到您的<code class="du lr ls lt lu b">Gemfile</code>中:</p><p id="03f4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">gem <em class="lb">'record_tag_helper'</em>, <em class="lb">'~&gt; 1.0'</em></code></p><h2 id="7f7d" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">5.16移除对<code class="du lr ls lt lu b">protected_attributes</code>宝石的支撑</h2><p id="7a83" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">导轨5不再支持<code class="du lr ls lt lu b">protected_attributes</code>宝石。</p><h2 id="0b89" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">5.17移除对<code class="du lr ls lt lu b">activerecord-deprecated_finders</code>宝石的支撑</h2><p id="776a" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">导轨5不再支持<code class="du lr ls lt lu b">activerecord-deprecated_finders</code>宝石。</p><h2 id="282a" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">5.18 <code class="du lr ls lt lu b">ActiveSupport::TestCase</code>默认测试顺序现在是随机的</h2><p id="6857" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">当在您的应用程序中运行测试时，默认的顺序是<code class="du lr ls lt lu b">:random</code>而不是<code class="du lr ls lt lu b">:sorted</code>。使用以下配置选项将其设置回<code class="du lr ls lt lu b">:sorted</code>。</p><p id="0a1c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># config/environments/test.rb</code></p><p id="f10b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">Rails.application.configure do</code></p><p id="6d45" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.active_support.test_order = <strong class="ig hi">:sorted</strong></code></p><p id="2120" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><h2 id="1828" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">5.19 <code class="du lr ls lt lu b">ActionController::Live</code>变成了<code class="du lr ls lt lu b">Concern</code></h2><p id="d62a" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">如果您将<code class="du lr ls lt lu b">ActionController::Live</code>包含在控制器中的另一个模块中，那么您也应该用<code class="du lr ls lt lu b">ActiveSupport::Concern</code>来扩展该模块。或者，一旦包含了<code class="du lr ls lt lu b">StreamingSupport</code>，你可以使用<code class="du lr ls lt lu b">self.included</code>钩子将<code class="du lr ls lt lu b">ActionController::Live</code>直接包含到控制器中。</p><p id="9027" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这意味着，如果您的应用程序过去有自己的流模块，以下代码将在生产模式下中断:</p><p id="1f9b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># This is a work-around for streamed controllers performing authentication with Warden/Devise.</code></p><p id="f6fd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># See https://github.com/plataformatec/devise/issues/2332</code></p><p id="7113" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Authenticating in the router is another solution as suggested in that issue</code></p><p id="bb6f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code>T9】</p><p id="1efc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">include ActionController::Live # this won't work in production for Rails 5</code></p><p id="67f3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># extend ActiveSupport::Concern # unless you uncomment this line.</code></p><p id="6f16" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">def</code>T13】</p><p id="d2fb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">super(name)</code></p><p id="24d4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">rescue</code> <code class="du lr ls lt lu b">ArgumentError =&gt; e</code></p><p id="671c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">if</code> <code class="du lr ls lt lu b">e.message == <em class="lb">'uncaught throw :warden'</em></code></p><p id="6b52" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">throw</code> <code class="du lr ls lt lu b"><strong class="ig hi">:warden</strong></code></p><p id="4f9e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">else</code></p><p id="07b5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">raise</code> <code class="du lr ls lt lu b">e</code></p><p id="5142" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="247e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="4bdc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><h2 id="8d51" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">5.20新的框架默认值</h2><p id="bdac" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated"><strong class="ig hi"> 5.20.1活动记录</strong> <code class="du lr ls lt lu b"><strong class="ig hi">belongs_to</strong></code> <strong class="ig hi">默认为必填选项</strong></p><p id="e7ca" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果关联不存在，默认情况下会触发验证错误。</p><p id="c692" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这可以通过<code class="du lr ls lt lu b">optional: true</code>关闭。</p><p id="e981" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">此默认值将在新应用程序中自动配置。如果现有的应用程序想要添加这个功能，它将需要在初始化打开。</p><p id="e8be" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.active_record.belongs_to_required_by_default = true</code></p><p id="994f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 5.20.2每张CSRF代币</strong></p><p id="a5ab" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Rails 5现在支持基于表单的CSRF令牌，以减轻JavaScript创建的表单的代码注入攻击。打开此选项后，应用程序中的每个窗体都将拥有自己的CSRF令牌，该令牌特定于该窗体的操作和方法。</p><p id="d81a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.action_controller.per_form_csrf_tokens = true</code></p><p id="e947" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 5.20.3带原产地检查的防伪保护</strong></p><p id="f6bc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，您可以配置您的应用程序来检查HTTP <code class="du lr ls lt lu b">Origin</code>头是否应该根据站点的来源进行检查，作为额外的CSRF防御。将配置中的以下内容设置为true:</p><p id="2323" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.action_controller.forgery_protection_origin_check = true</code></p><p id="89d7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 5.20.4允许配置动作邮件队列名称</strong></p><p id="e2b2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">默认的邮件队列名称是<code class="du lr ls lt lu b">mailers</code>。此配置选项允许您全局更改队列名称。在您的配置中设置以下内容:</p><p id="0c63" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.action_mailer.deliver_later_queue_name = :new_queue_name</code></p><p id="ab3b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 5.20.5支持动作邮件视图中的片段缓存</strong></p><p id="2cc9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在您的配置中设置<code class="du lr ls lt lu b">config.action_mailer.perform_caching</code>来决定您的动作邮件视图是否应该支持缓存。</p><p id="3d25" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.action_mailer.perform_caching = true</code></p><p id="9305" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 5.20.6配置</strong>的输出<code class="du lr ls lt lu b">db:structure:dump</code></p><p id="5f42" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您使用的是<code class="du lr ls lt lu b">schema_search_path</code>或其他PostgreSQL扩展，您可以控制如何转储模式。设置为<code class="du lr ls lt lu b">:all</code>以生成所有转储，或者设置为<code class="du lr ls lt lu b">:schema_search_path</code>以从模式搜索路径生成。</p><p id="0e1b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.active_record.dump_schemas = :all</code></p><p id="77bf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 5.20.7配置SSL选项以启用带有子域的HSTS</strong></p><p id="533c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在配置中设置以下内容，以便在使用子域时启用HSTS:</p><p id="9d2e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.ssl_options = { hsts: { subdomains: true } }</code></p><p id="a742" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 5.20.8保存接收方的时区</strong></p><p id="5467" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用Ruby 2.4时，可以在调用<code class="du lr ls lt lu b">to_time</code>时保留接收者的时区。</p><p id="36bf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">ActiveSupport.to_time_preserves_timezone = false</code></p><h2 id="34a9" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">5.21 JSON/JSONB序列化的变化</h2><p id="0706" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">在Rails 5.0中，JSON/JSONB属性的序列化和反序列化方式发生了变化。现在，如果您设置一个等于<code class="du lr ls lt lu b">String</code>的列，活动记录将不再把该字符串转换成<code class="du lr ls lt lu b">Hash</code>，而是只返回该字符串。这不仅限于与模型交互的代码，还会影响到<code class="du lr ls lt lu b">db/schema.rb</code>中的<code class="du lr ls lt lu b">:default</code>列设置。建议您不要将列设置为等于一个<code class="du lr ls lt lu b">String</code>，而是传递一个<code class="du lr ls lt lu b">Hash</code>，它将自动与JSON字符串相互转换。</p><h1 id="1f99" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">6从Rails 4.1升级到Rails 4.2</h1><h2 id="72b2" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">6.1 Web控制台</h2><p id="a7ae" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">首先，将<code class="du lr ls lt lu b">gem 'web-console', '~&gt; 2.0'</code>添加到<code class="du lr ls lt lu b">Gemfile</code>中的<code class="du lr ls lt lu b">:development</code>组，并运行<code class="du lr ls lt lu b">bundle install</code>(升级Rails时不会包含它)。一旦安装完毕，您可以简单地将一个对控制台助手的引用(即<code class="du lr ls lt lu b">&lt;%= console %&gt;</code>)拖放到任何您想要启用它的视图中。您在开发环境中查看的任何错误页面上也会提供一个控制台。</p><h2 id="6089" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">6.2响应者</h2><p id="9d30" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated"><code class="du lr ls lt lu b">respond_with</code>和类级<code class="du lr ls lt lu b">respond_to</code>方法已经提取到<code class="du lr ls lt lu b">responders</code>宝石中。要使用它们，只需将<code class="du lr ls lt lu b">gem 'responders', '~&gt; 2.0'</code>添加到您的<code class="du lr ls lt lu b">Gemfile</code>中。如果没有将<code class="du lr ls lt lu b">responders</code> gem包含在您的依赖项中，对<code class="du lr ls lt lu b">respond_with</code>和<code class="du lr ls lt lu b">respond_to</code>(再次在类级别)的调用将不再有效:</p><p id="f208" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># app/controllers/users_controller.rb</code></p><p id="92d7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code> <code class="du lr ls lt lu b">UsersController &lt; ApplicationController</code></p><p id="0186" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">respond_to <strong class="ig hi">:html</strong>, <strong class="ig hi">:json</strong></code></p><p id="d440" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">def</code>T24】</p><p id="92c5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"><strong class="ig hi">@user</strong></code> <code class="du lr ls lt lu b">= User.find(params[<strong class="ig hi">:id</strong>])</code></p><p id="8a62" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">respond_with <strong class="ig hi">@user</strong></code></p><p id="0684" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="3d79" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="d3d5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">实例级</strong> <code class="du lr ls lt lu b"><strong class="ig hi">respond_to</strong></code> <strong class="ig hi">不受影响，不需要额外的宝石:</strong></p><p id="6809" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># app/controllers/users_controller.rb</code></p><p id="ff76" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code> <code class="du lr ls lt lu b">UsersController &lt; ApplicationController</code></p><p id="163a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">def</code> <code class="du lr ls lt lu b">show</code></p><p id="c76d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"><strong class="ig hi">@user</strong></code> <code class="du lr ls lt lu b">= User.find(params[<strong class="ig hi">:id</strong>])</code></p><p id="7ec4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">respond_to do</code> <code class="du lr ls lt lu b">|format|</code></p><p id="b32e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">format.html</code></p><p id="2c30" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">format.json { render json: <strong class="ig hi">@user</strong></code>T11】</p><p id="396c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="7af3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="ebfa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><h2 id="f170" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">6.3事务回调中的错误处理</h2><p id="94ae" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">目前，活动记录抑制在<code class="du lr ls lt lu b">after_rollback</code>或<code class="du lr ls lt lu b">after_commit</code>回调中出现的错误，并仅将其打印到日志中。在下一个版本中，这些错误将不再被抑制。相反，错误将像在其他活动记录回调中一样正常传播。</p><p id="4c6a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当您定义一个<code class="du lr ls lt lu b">after_rollback</code>或<code class="du lr ls lt lu b">after_commit</code>回调时，您将收到一个关于这个即将到来的变化的反对警告。当您准备好时，您可以选择新的行为，并通过向您的<code class="du lr ls lt lu b">config/application.rb</code>添加以下配置来移除不赞成警告:</p><p id="209f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.active_record.raise_in_transactional_callbacks = true</code></p><h2 id="7e77" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">6.4测试用例的排序</h2><p id="f2bb" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">在Rails 5.0中，默认情况下，测试用例将随机执行。预见到这一变化，Rails 4.2引入了一个新的配置选项<code class="du lr ls lt lu b">active_support.test_order</code>，用于显式指定测试顺序。这允许您通过将选项设置为<code class="du lr ls lt lu b">:sorted</code>来锁定当前行为，或者通过将选项设置为<code class="du lr ls lt lu b">:random</code>来选择未来行为。</p><p id="d07a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果不指定该选项的值，将发出不推荐使用的警告。为了避免这种情况，请将以下代码行添加到您的测试环境中:</p><p id="a909" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># config/environments/test.rb</code></p><p id="701e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">Rails.application.configure do</code></p><p id="9e56" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.active_support.test_order = <strong class="ig hi">:sorted</strong></code> <code class="du lr ls lt lu b"># or `:random` if you prefer</code></p><p id="7bd4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><h2 id="1f9d" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">6.5序列化属性</h2><p id="4386" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">当使用自定义编码器(例如<code class="du lr ls lt lu b">serialize :metadata, JSON</code>)时，将<code class="du lr ls lt lu b">nil</code>赋给一个序列化属性会将其作为<code class="du lr ls lt lu b">NULL</code>保存到数据库中，而不是通过编码器传递<code class="du lr ls lt lu b">nil</code>值(例如当使用<code class="du lr ls lt lu b">JSON</code>编码器时为<code class="du lr ls lt lu b">"null"</code>)。</p><h2 id="1121" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">6.6生产日志级别</h2><p id="285f" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">在Rails 5中，生产环境的默认日志级别将改为<code class="du lr ls lt lu b">:debug</code>(从<code class="du lr ls lt lu b">:info</code>)。为了保留当前的缺省值，将下面一行添加到您的<code class="du lr ls lt lu b">production.rb</code>中:</p><p id="bd7d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Set to `:info` to match the current default, or set to `:debug` to opt-into</code></p><p id="e5d5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># the future default.</code></p><p id="f68b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.log_level = <strong class="ig hi">:info</strong></code></p><div class="lw lx ez fb ly lz"><a href="https://onlineitguru.com/blog/project-with-ruby-on-rails" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hi fi z dy me ea eb mf ed ef hg bi translated">使用Ruby on Rails的项目| Ruby on Rails博客| OnlineITGuru</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">特别是，你想为你的项目选择什么类型的语言。许多因素，例如，框架的价格，多少…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">onlineitguru.com</p></div></div><div class="mi l"><div class="mq l mk ml mm mi mn ji lz"/></div></div></a></div><h2 id="c5f9" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">6.7导轨模板中的<code class="du lr ls lt lu b">after_bundle</code></h2><p id="125b" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">如果您有一个在版本控制中添加所有文件的Rails模板，它将无法添加生成的binstubs，因为它在Bundler:</p><p id="94cc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># template.rb</code></p><p id="2dde" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">generate(<strong class="ig hi">:scaffold</strong>, <em class="lb">"person name:string"</em>)</code></p><p id="b019" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">route <em class="lb">"root to: 'people#index'"</em></code></p><p id="4dc3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">rake(<em class="lb">"db:migrate"</em>)</code></p><p id="3883" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">git <strong class="ig hi">:init</strong></code></p><p id="8881" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">git add: <em class="lb">"."</em></code></p><p id="9249" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">git commit: %Q{ -m <em class="lb">'Initial commit'</em></code> <code class="du lr ls lt lu b">}</code></p><p id="ade5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，您可以将<code class="du lr ls lt lu b">git</code>调用封装在一个<code class="du lr ls lt lu b">after_bundle</code>块中。它将在生成binstubs后运行。</p><p id="a642" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># template.rb</code></p><p id="9a8b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">generate(<strong class="ig hi">:scaffold</strong>, <em class="lb">"person name:string"</em>)</code></p><p id="e4ef" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">route <em class="lb">"root to: 'people#index'"</em></code></p><p id="a84f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">rake(<em class="lb">"db:migrate"</em>)</code></p><p id="d1b7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">after_bundle do</code></p><p id="f150" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">git <strong class="ig hi">:init</strong></code></p><p id="1838" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">git add: <em class="lb">"."</em></code></p><p id="5780" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">git commit: %Q{ -m <em class="lb">'Initial commit'</em></code> <code class="du lr ls lt lu b">}</code></p><p id="cff0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><h2 id="3128" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">6.8 Rails HTML杀毒软件</h2><p id="f076" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">在你的应用程序中有一个净化HTML片段的新选择。古老的html-scanner方法现在正被官方弃用，取而代之的是<code class="du lr ls lt lu b">Rails HTML Sanitizer</code>。</p><p id="2e25" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这意味着方法<code class="du lr ls lt lu b">sanitize</code>、<code class="du lr ls lt lu b">sanitize_css</code>、<code class="du lr ls lt lu b">strip_tags</code>和<code class="du lr ls lt lu b">strip_links</code>得到了新实现的支持。</p><p id="c767" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这种新型消毒剂内部使用丝瓜。丝瓜反过来使用Nokogiri，它包装了用C和Java编写的XML解析器，所以无论运行哪个Ruby版本，清理都应该更快。</p><p id="8a22" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">新版本更新了<code class="du lr ls lt lu b">sanitize</code>，所以可以用一个<code class="du lr ls lt lu b">Loofah::Scrubber</code>进行强大的刷洗。在这里看一些洗涤器的例子。</p><p id="695e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">还增加了两个新的洗涤器:<code class="du lr ls lt lu b">PermitScrubber</code>和<code class="du lr ls lt lu b">TargetScrubber</code>。有关更多信息，请阅读gem的自述文件。</p><p id="00f4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">PermitScrubber</code>和<code class="du lr ls lt lu b">TargetScrubber</code>的文档解释了如何完全控制何时以及如何去除元素。</p><p id="157e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您的应用程序需要使用旧的杀毒器实现，请在您的<code class="du lr ls lt lu b">Gemfile</code>中包含<code class="du lr ls lt lu b">rails-deprecated_sanitizer</code>:</p><p id="85f1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">gem <em class="lb">'rails-deprecated_sanitizer'</em></code></p><h2 id="21e5" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">6.9 Rails DOM测试</h2><p id="a969" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated"><code class="du lr ls lt lu b">TagAssertions</code>模块(包含像<code class="du lr ls lt lu b">assert_tag</code>这样的方法)已经被弃用，取而代之的是来自<code class="du lr ls lt lu b">SelectorAssertions</code>模块的<code class="du lr ls lt lu b">assert_select</code>方法，该模块已经被提取到rails-dom-testing gem中。</p><h2 id="6675" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">6.10掩蔽的真实性令牌</h2><p id="54fa" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">为了减少SSL攻击，<code class="du lr ls lt lu b">form_authenticity_token</code>现在被屏蔽了，因此它随每个请求而变化。因此，通过取消屏蔽然后解密来验证令牌。因此，任何验证来自依赖静态会话CSRF令牌的非rails表单的请求的策略都必须考虑到这一点。</p><h2 id="ac44" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">6.11行动邮件</h2><p id="35c1" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">以前，在mailer类上调用mailer方法会导致直接执行相应的实例方法。随着活动工单和<code class="du lr ls lt lu b">#deliver_later</code>的引入，这种情况不再存在。在Rails 4.2中，实例方法的调用被推迟，直到调用了<code class="du lr ls lt lu b">deliver_now</code>或<code class="du lr ls lt lu b">deliver_later</code>。例如:</p><p id="2909" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code> <code class="du lr ls lt lu b">Notifier &lt; ActionMailer::Base</code></p><p id="b3d7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">def</code> <code class="du lr ls lt lu b">notify(user, ...)</code></p><p id="198f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">puts <em class="lb">"Called"</em></code></p><p id="f42f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">mail(to: user.email, ...)</code></p><p id="abc4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="9c51" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="8eaa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">mail = Notifier.notify(user, ...) # Notifier#notify is not yet called at this point</code></p><p id="7dbc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">mail = mail.deliver_now # Prints "Called"</code></p><p id="dcad" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于大多数应用程序来说，这不会导致任何明显的差异。但是，如果您需要同步执行一些非邮件程序方法，并且您以前依赖于同步代理行为，您应该直接将它们定义为邮件程序类的类方法:</p><p id="2dc3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code>T9】</p><p id="40a6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">def</code>T11】</p><p id="3bf3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">users.each</code>T13】</p><p id="5ac4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="230f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><h2 id="b677" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">6.12外键支持</h2><p id="374a" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">迁移DSL已经扩展到支持外键定义。如果你一直使用外国人宝石，你可能要考虑删除它。注意，Rails的外键支持是外国人的子集。这意味着不是每个外国人的定义都可以被它的Rails迁移DSL对应物完全取代。</p><p id="3d8a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">迁移程序如下:</strong></p><ol class=""><li id="fa1d" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb li lj lk ll bi translated">从<code class="du lr ls lt lu b">Gemfile</code>上拆下<code class="du lr ls lt lu b">gem "foreigner"</code>。</li><li id="6cf1" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">运行<code class="du lr ls lt lu b">bundle install</code>。</li><li id="6036" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">运行<code class="du lr ls lt lu b">bin/rake db:schema:dump</code>。</li><li id="d336" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">确保<code class="du lr ls lt lu b">db/schema.rb</code>包含每个外键定义和必要的选项。</li></ol><h1 id="47f5" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">7从Rails 4.0升级到Rails 4.1</h1><h2 id="13e8" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">7.1远程<code class="du lr ls lt lu b">&lt;script&gt;</code>标签的CSRF保护</h2><p id="d7f5" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">或者，“我的测试失败了！！！?"或者“我的<code class="du lr ls lt lu b">&lt;script&gt;</code>小工具坏了！!"</p><p id="1675" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">跨站点请求伪造(CSRF)保护现在也包括带有JavaScript响应的GET请求。这可以防止第三方站点远程引用带有<code class="du lr ls lt lu b">&lt;script&gt;</code>标签的JavaScript来提取敏感数据。</p><p id="bf64" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这意味着您的功能和集成测试使用</p><p id="59d1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">get <strong class="ig hi">:index</strong>, format: <strong class="ig hi">:js</strong></code></p><p id="c499" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">会触发CSRF保护。转到</p><p id="7c76" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">xhr <strong class="ig hi">:get</strong>, <strong class="ig hi">:index</strong>, format: <strong class="ig hi">:js</strong></code></p><p id="1e19" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">显式测试一个<code class="du lr ls lt lu b">XmlHttpRequest</code>。</p><p id="5441" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">默认情况下，您自己的<code class="du lr ls lt lu b">&lt;script&gt;</code>标签也被视为跨源标签并被阻止。如果你真的想从<code class="du lr ls lt lu b">&lt;script&gt;</code>标签加载JavaScript，你现在必须显式跳过对这些动作的CSRF保护。</p><h2 id="0a16" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">7.2弹簧</h2><p id="fd93" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">如果您想使用Spring作为您的应用程序预加载器，您需要:</p><ol class=""><li id="28cd" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb li lj lk ll bi translated">将<code class="du lr ls lt lu b">gem 'spring', group: :development</code>添加到你的<code class="du lr ls lt lu b">Gemfile</code>中。</li><li id="065e" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">使用<code class="du lr ls lt lu b">bundle install</code>安装弹簧。</li><li id="6d0d" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">用<code class="du lr ls lt lu b">bundle exec spring binstub --all</code>激活你的binstubs。</li></ol><p id="5d01" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">默认情况下，用户定义的rake任务将在<code class="du lr ls lt lu b">development</code>环境中运行。如果你想让它们在其他环境下运行，请参考Spring README上的<a class="ae lc" href="https://onlineitguru.com/spring-boot-training.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi"> Spring Boot在线培训</strong> </a></p><h2 id="9448" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">7.3 <code class="du lr ls lt lu b">config/secrets.yml</code></h2><p id="7850" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">如果您想使用新的<code class="du lr ls lt lu b">secrets.yml</code>约定来存储您的应用程序的秘密，您需要:</p><ol class=""><li id="6573" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb li lj lk ll bi translated">在您的<code class="du lr ls lt lu b">config</code>文件夹中创建一个<code class="du lr ls lt lu b">secrets.yml</code>文件，内容如下:</li><li id="17c5" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated"><code class="du lr ls lt lu b">development:</code></li><li id="1465" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated"><code class="du lr ls lt lu b">secret_key_base:</code></li><li id="2281" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated"><code class="du lr ls lt lu b">test:</code></li><li id="a3b6" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated"><code class="du lr ls lt lu b">secret_key_base:</code></li><li id="5c01" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated"><code class="du lr ls lt lu b">production:</code></li><li id="37a7" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated"><code class="du lr ls lt lu b">secret_key_base: &lt;%= ENV["SECRET_KEY_BASE"] %&gt;</code></li><li id="326c" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">使用现有的<code class="du lr ls lt lu b">secret_token.rb</code>初始化器中的<code class="du lr ls lt lu b">secret_key_base</code>来为在生产模式下运行Rails应用程序的用户设置SECRET_KEY_BASE环境变量。或者，您可以简单地将现有的<code class="du lr ls lt lu b">secret_key_base</code>从<code class="du lr ls lt lu b">secret_token.rb</code>初始化器复制到<code class="du lr ls lt lu b">production</code>部分下的<code class="du lr ls lt lu b">secrets.yml</code>，替换为'&lt;% = ENV[" SECRET _ KEY _ BASE "]%【T33 '。</li><li id="b4cb" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">移除<code class="du lr ls lt lu b">secret_token.rb</code>初始化器。</li><li id="af62" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">使用<code class="du lr ls lt lu b">rake secret</code>为<code class="du lr ls lt lu b">development</code>和<code class="du lr ls lt lu b">test</code>部分生成新的密钥。</li><li id="061f" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">重新启动服务器。</li></ol><h2 id="48d6" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">7.4对测试助手的更改</h2><p id="57fd" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">如果您的测试助手包含对<code class="du lr ls lt lu b">ActiveRecord::Migration.check_pending!</code>的调用，这可以被移除。现在，当您<code class="du lr ls lt lu b">require 'rails/test_help'</code>时，检查会自动完成，尽管在您的助手中留下这一行不会有任何危害。</p><h2 id="76b7" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">7.5 Cookies序列化程序</h2><p id="689f" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">在Rails 4.1之前创建的应用程序使用<code class="du lr ls lt lu b">Marshal</code>将cookie值序列化到签名和加密的cookie jars中。如果您想在您的应用程序中使用新的基于<code class="du lr ls lt lu b">JSON</code>的格式，您可以添加一个包含以下内容的初始化文件:</p><p id="b379" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">Rails.application.config.action_dispatch.cookies_serializer = <strong class="ig hi">:hybrid</strong></code></p><p id="fac8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这将透明地将您现有的<code class="du lr ls lt lu b">Marshal</code>序列化cookies迁移到新的基于<code class="du lr ls lt lu b">JSON</code>的格式中。</p><p id="33f6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当使用<code class="du lr ls lt lu b">:json</code>或<code class="du lr ls lt lu b">:hybrid</code>序列化器时，应该注意不是所有的Ruby对象都可以被序列化为JSON。例如，<code class="du lr ls lt lu b">Date</code>和<code class="du lr ls lt lu b">Time</code>对象将被序列化为字符串，而<code class="du lr ls lt lu b">Hash</code> es将把它们的键字符串化。</p><p id="7c9d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code>T13】</p><p id="8140" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">def</code>T15】</p><p id="f18a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">cookies.encrypted[<strong class="ig hi">:expiration_date</strong>] = Date.tomorrow # =&gt; Thu, 20 Mar 2014</code></p><p id="bd9d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">redirect_to action: <em class="lb">'read_cookie'</em></code></p><p id="b23f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="afd8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">def</code> <code class="du lr ls lt lu b">read_cookie</code></p><p id="7dff" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">cookies.encrypted[<strong class="ig hi">:expiration_date</strong>] # =&gt; "2014-03-20"</code></p><p id="b8bb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="7e49" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="b009" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">建议您只在cookies中存储简单的数据(字符串和数字)。如果必须存储复杂的对象，那么在后续请求中读取值时，需要手动处理转换。</p><p id="1f9e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您使用cookie会话存储，这也适用于<code class="du lr ls lt lu b">session</code>和<code class="du lr ls lt lu b">flash</code>散列。</p><h2 id="dca6" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">7.6闪存结构变化</h2><p id="3112" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">Flash消息键被规范化为字符串。仍然可以使用符号或字符串来访问它们。在闪存中循环总是会产生字符串密钥:</p><p id="c816" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">flash[<em class="lb">"string"</em>] = <em class="lb">"a string"</em></code></p><p id="a391" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">flash[<strong class="ig hi">:symbol</strong>] = <em class="lb">"a symbol"</em></code></p><p id="f7d8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Rails &lt; 4.1</code></p><p id="d783" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">flash.keys # =&gt; ["string", :symbol]</code></p><p id="6fcb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Rails &gt;= 4.1</code></p><p id="0352" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">flash.keys # =&gt; ["string", "symbol"]</code></p><p id="7208" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">确保将Flash消息键与字符串进行比较。</p><div class="lw lx ez fb ly lz"><a href="https://onlineitguru.com/blog/the-history-of-ruby-on-rails-controller" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hi fi z dy me ea eb mf ed ef hg bi translated">Ruby On Rails控制器的历史</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">控制器负责内部动作和外部请求。它正在拥有。一个值得关注的选项…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">onlineitguru.com</p></div></div><div class="mi l"><div class="mr l mk ml mm mi mn ji lz"/></div></div></a></div><h2 id="7f83" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">7.7 JSON处理的变化</h2><p id="e55a" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">Rails 4.1中有一些与JSON处理相关的重大变化。</p><p id="e04e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 7.7.1多JSON移除</strong></p><p id="bf8d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">MultiJSON已经走到了生命的尽头，已经从Rails中移除。</p><p id="659f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您的应用程序当前直接依赖于MultiJSON，您有几个选择:</p><ol class=""><li id="cf19" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb li lj lk ll bi translated">将“multi_json”添加到您的<code class="du lr ls lt lu b">Gemfile</code>中。请注意，这在将来可能会停止工作</li><li id="4fe8" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">使用<code class="du lr ls lt lu b">obj.to_json</code>和<code class="du lr ls lt lu b">JSON.parse(str)</code>从MultiJSON迁移。</li></ol><p id="b7a2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">不要简单地用<code class="du lr ls lt lu b">JSON.dump</code>和<code class="du lr ls lt lu b">JSON.load</code>替换<code class="du lr ls lt lu b">MultiJson.dump</code>和<code class="du lr ls lt lu b">MultiJson.load</code>。这些JSON gem APIs是用来序列化和反序列化任意Ruby对象的，通常是不安全的。</p><p id="2a72" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 7.7.2 JSON gem兼容性</strong></p><p id="c0a4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">历史上，Rails与JSON gem有一些兼容性问题。在Rails应用程序中使用<code class="du lr ls lt lu b">JSON.generate</code>和<code class="du lr ls lt lu b">JSON.dump</code>可能会产生意想不到的错误。</p><p id="8e88" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Rails 4.1通过将自己的编码器从JSON gem中分离出来，解决了这些问题。JSON gem APIs将照常运行，但是它们不能访问任何Rails特有的特性。例如:</p><p id="0cd2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code> <code class="du lr ls lt lu b">FooBar</code></p><p id="282c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">def</code> <code class="du lr ls lt lu b">as_json(options = nil)</code></p><p id="6745" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">{ foo: <em class="lb">'bar'</em></code> <code class="du lr ls lt lu b">}</code></p><p id="e96a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="c706" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="94fd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">&gt;&gt; FooBar.new.to_json # =&gt; "{\"foo\":\"bar\"}"</code></p><p id="716e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">&gt;&gt; JSON.generate(FooBar.new, quirks_mode: true) # =&gt; "\"#&lt;FooBar:0x007fa80a481610&gt;\""</code></p><p id="2e89" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 7.7.3新的JSON编码器</strong></p><p id="5863" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Rails 4.1中的JSON编码器已经被重写，以利用JSON gem。对于大多数应用程序来说，这应该是一个透明的变化。但是，作为重写的一部分，编码器中删除了以下功能:</p><ol class=""><li id="ac68" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb li lj lk ll bi translated">循环数据结构检测</li><li id="3cd1" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated"><code class="du lr ls lt lu b">encode_json</code>挂钩支架</li><li id="75ac" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated">将<code class="du lr ls lt lu b">BigDecimal</code>对象编码为数字而不是字符串的选项</li></ol><p id="6bf5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您的应用程序依赖于这些特性中的一个，您可以通过将<code class="du lr ls lt lu b">activesupport-json_encoder</code> gem添加到您的<code class="du lr ls lt lu b">Gemfile</code>中来恢复它们。</p><p id="70a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 7.7.4时间对象的JSON表示</strong></p><p id="1073" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">#as_json</code>对于有时间成分的对象(<code class="du lr ls lt lu b">Time</code>、<code class="du lr ls lt lu b">DateTime</code>、<code class="du lr ls lt lu b">ActiveSupport::TimeWithZone</code>)，现在默认返回毫秒精度。如果您需要保留没有毫秒精度的旧行为，请在初始化器中设置以下内容:</p><p id="5281" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">ActiveSupport::JSON::Encoding.time_precision = 0</code></p><h2 id="0507" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">7.8在内联回调块中使用<code class="du lr ls lt lu b">return</code></h2><p id="d474" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">以前，Rails允许内联回调块以这种方式使用<code class="du lr ls lt lu b">return</code>:</p><p id="09f5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code>T11】</p><p id="4d35" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">before_save { return</code> <code class="du lr ls lt lu b">false</code> <code class="du lr ls lt lu b">} # BAD</code></p><p id="f550" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="5420" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这种行为从未得到有意的支持。由于<code class="du lr ls lt lu b">ActiveSupport::Callbacks</code>内部的变化，这在Rails 4.1中不再允许。在内联回调块中使用<code class="du lr ls lt lu b">return</code>语句会导致在执行回调时引发<code class="du lr ls lt lu b">LocalJumpError</code>。</p><p id="3b44" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用<code class="du lr ls lt lu b">return</code>的内联回调块可以被重构以评估返回值:</p><p id="498d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code> <code class="du lr ls lt lu b">ReadOnlyModel &lt; ActiveRecord::Base</code></p><p id="cf6b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">before_save { false</code> <code class="du lr ls lt lu b">} # GOOD</code></p><p id="6a10" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="b919" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">或者，如果首选<code class="du lr ls lt lu b">return</code>，建议明确定义一种方法:</p><p id="56bf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code> <code class="du lr ls lt lu b">ReadOnlyModel &lt; ActiveRecord::Base</code></p><p id="a98d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">before_save <strong class="ig hi">:before_save_callback</strong></code>T29】</p><p id="be63" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">private</code></p><p id="ce19" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">def</code> <code class="du lr ls lt lu b">before_save_callback</code></p><p id="eeb9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">return</code> <code class="du lr ls lt lu b">false</code></p><p id="9af9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="8c7e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="5927" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这一改变适用于Rails中使用回调的大多数地方，包括活动记录和活动模型回调，以及动作控制器中的过滤器(例如<code class="du lr ls lt lu b">before_action</code>)。</p><h2 id="87a2" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">7.9活动记录装置中定义的方法</h2><p id="3321" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">Rails 4.1在单独的上下文中评估每个fixture的ERB，因此在fixture中定义的helper方法在其他fixture中不可用。</p><p id="211f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在多个fixtures中使用的Helper方法应该在新引入的<code class="du lr ls lt lu b">ActiveRecord::FixtureSet.context_class</code>中的模块上定义，在<code class="du lr ls lt lu b">test_helper.rb</code>中。</p><p id="4c3f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">module</code> <code class="du lr ls lt lu b">FixtureFileHelpers</code></p><p id="2857" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">def</code> <code class="du lr ls lt lu b">file_sha(path)</code></p><p id="7f3a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">Digest::SHA2.hexdigest(File.read(Rails.root.join(<em class="lb">'test/fixtures'</em>, path)))</code></p><p id="b00b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="6e79" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="7b6a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">ActiveRecord::FixtureSet.context_class.include FixtureFileHelpers</code></p><h2 id="ccc5" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">7.10 I18n强制实施可用的区域设置</h2><p id="b871" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">Rails 4.1现在默认I18n选项<code class="du lr ls lt lu b">enforce_available_locales</code>到<code class="du lr ls lt lu b">true</code>。这意味着它将确保传递给它的所有语言环境都必须在<code class="du lr ls lt lu b">available_locales</code>列表中声明。</p><p id="54e8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要禁用它(并允许I18n接受<em class="lb">任何</em> locale选项),向您的应用程序添加以下配置:</p><p id="769c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.i18n.enforce_available_locales = false</code></p><p id="cbd8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请注意，这个选项是作为一种安全措施添加的，以确保用户输入不能用作区域设置信息，除非它是预先已知的。因此，建议不要禁用此选项，除非您有很强的理由这样做。</p><h2 id="a297" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">7.11在关系上调用的赋值函数方法</h2><p id="a423" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated"><code class="du lr ls lt lu b">Relation</code>不再有像<code class="du lr ls lt lu b">#map!</code>和<code class="du lr ls lt lu b">#delete_if</code>这样的变异方法。在使用这些方法之前，通过调用<code class="du lr ls lt lu b">#to_a</code>转换为<code class="du lr ls lt lu b">Array</code>。</p><p id="2c53" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">它旨在防止在直接调用<code class="du lr ls lt lu b">Relation</code>上的mutator方法的代码中出现奇怪的错误和混乱。</p><p id="a097" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Instead of this</code></p><p id="4a75" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">Author.where(name: <em class="lb">'Hank Moody'</em>).compact!</code></p><p id="277c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Now you have to do this</code></p><p id="a676" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">authors = Author.where(name: <em class="lb">'Hank Moody'</em>).to_a</code></p><p id="d618" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">authors.compact!</code></p><h2 id="64af" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">7.12默认范围的变更</h2><p id="3bd4" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">默认范围不再被连锁条件覆盖。</p><p id="4827" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在以前的版本中，当您在模型中定义一个<code class="du lr ls lt lu b">default_scope</code>时，它会被同一字段中的链式条件覆盖。现在它像任何其他作用域一样被合并。</p><p id="0f17" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">之前:</strong></p><p id="8ba4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code> <code class="du lr ls lt lu b">User &lt; ActiveRecord::Base</code></p><p id="ae0f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">default_scope { where state: <em class="lb">'pending'</em></code> <code class="du lr ls lt lu b">}</code></p><p id="94c2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">scope <strong class="ig hi">:active</strong>, -&gt; { where state: <em class="lb">'active'</em></code> <code class="du lr ls lt lu b">}</code></p><p id="9e87" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">scope <strong class="ig hi">:inactive</strong>, -&gt; { where state: <em class="lb">'inactive'</em></code> <code class="du lr ls lt lu b">}</code></p><p id="51f4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="871b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">User.all</code></p><p id="7380" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># SELECT "users".* FROM "users" WHERE "users"."state" = 'pending'</code></p><p id="1b5c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">User.active</code></p><p id="b9ea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># SELECT "users".* FROM "users" WHERE "users"."state" = 'active'</code></p><p id="262d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">User.where(state: <em class="lb">'inactive'</em>)</code></p><p id="6e94" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># SELECT "users".* FROM "users" WHERE "users"."state" = 'inactive'</code></p><p id="7091" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">之后:</strong></p><p id="c208" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code> <code class="du lr ls lt lu b">User &lt; ActiveRecord::Base</code></p><p id="afe5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">default_scope { where state: <em class="lb">'pending'</em></code>T19】</p><p id="c7a5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">scope <strong class="ig hi">:active</strong>, -&gt; { where state: <em class="lb">'active'</em></code> <code class="du lr ls lt lu b">}</code></p><p id="4fcd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">scope <strong class="ig hi">:inactive</strong>, -&gt; { where state: <em class="lb">'inactive'</em></code> <code class="du lr ls lt lu b">}</code></p><p id="6a70" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="2acd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">User.all</code></p><p id="651c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># SELECT "users".* FROM "users" WHERE "users"."state" = 'pending'</code></p><p id="63cc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">User.active</code></p><p id="1e2e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># SELECT "users".* FROM "users" WHERE "users"."state" = 'pending' AND "users"."state" = 'active'</code></p><p id="c019" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">User.where(state: <em class="lb">'inactive'</em>)</code></p><p id="0585" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># SELECT "users".* FROM "users" WHERE "users"."state" = 'pending' AND "users"."state" = 'inactive'</code></p><p id="5069" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要获得之前的行为，需要使用<code class="du lr ls lt lu b">unscoped</code>、<code class="du lr ls lt lu b">unscope</code>、<code class="du lr ls lt lu b">rewhere</code>或<code class="du lr ls lt lu b">except</code>明确移除<code class="du lr ls lt lu b">default_scope</code>条件。</p><p id="2ec9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code> <code class="du lr ls lt lu b">User &lt; ActiveRecord::Base</code></p><p id="e375" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">default_scope { where state: <em class="lb">'pending'</em></code>T3】</p><p id="a7e6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">scope <strong class="ig hi">:active</strong>, -&gt; { unscope(where: <strong class="ig hi">:state</strong>).where(state: <em class="lb">'active'</em>) }</code></p><p id="d3c0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">scope <strong class="ig hi">:inactive</strong>, -&gt; { rewhere state: <em class="lb">'inactive'</em></code> <code class="du lr ls lt lu b">}</code></p><p id="e250" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="38b1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">User.all</code></p><p id="4d4f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># SELECT "users".* FROM "users" WHERE "users"."state" = 'pending'</code></p><p id="bdb2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">User.active</code></p><p id="a5fd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># SELECT "users".* FROM "users" WHERE "users"."state" = 'active'</code></p><p id="5614" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">User.inactive</code></p><p id="0ed5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># SELECT "users".* FROM "users" WHERE "users"."state" = 'inactive'</code></p><h2 id="e296" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">7.13从字符串呈现内容</h2><p id="5779" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">Rails 4.1为<code class="du lr ls lt lu b">render</code>引入了<code class="du lr ls lt lu b">:plain</code>、<code class="du lr ls lt lu b">:html</code>和<code class="du lr ls lt lu b">:body</code>选项。这些选项现在是呈现基于字符串的内容的首选方式，因为它允许您指定希望响应以哪种内容类型发送。</p><ul class=""><li id="d1a2" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb lv lj lk ll bi translated"><code class="du lr ls lt lu b">render :plain</code>会将内容类型设置为<code class="du lr ls lt lu b">text/plain</code></li><li id="2df3" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated"><code class="du lr ls lt lu b">render :html</code>会将内容类型设置为<code class="du lr ls lt lu b">text/html</code></li><li id="3d5e" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated"><code class="du lr ls lt lu b">render :body</code>将<em class="lb">而不是</em>设置内容类型头。</li></ul><p id="668c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从安全的角度来看，如果你不希望在你的响应体中有任何标记，你应该使用<code class="du lr ls lt lu b">render :plain</code>,因为大多数浏览器会在你的响应中避开不安全的内容。</p><p id="1ea5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在未来的版本中，我们将不再使用<code class="du lr ls lt lu b">render :text</code>。所以请开始使用更精确的<code class="du lr ls lt lu b">:plain</code>、<code class="du lr ls lt lu b">:html</code>和<code class="du lr ls lt lu b">:body</code>选项。使用<code class="du lr ls lt lu b">render :text</code>可能会带来安全风险，因为内容是作为<code class="du lr ls lt lu b">text/html</code>发送的。</p><h2 id="fb80" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">7.14 PostgreSQL json和hstore数据类型</h2><p id="acab" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">Rails 4.1将把<code class="du lr ls lt lu b">json</code>和<code class="du lr ls lt lu b">hstore</code>列映射到一个字符串键红宝石<code class="du lr ls lt lu b">Hash</code>。在早期版本中，使用了一个<code class="du lr ls lt lu b">HashWithIndifferentAccess</code>。这意味着不再支持符号访问。基于<code class="du lr ls lt lu b">json</code>或<code class="du lr ls lt lu b">hstore</code>列顶部的<code class="du lr ls lt lu b">store_accessors</code>也是这种情况。确保一致地使用字符串键。</p><h2 id="557d" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">7.15】的显式块使用</h2><p id="065c" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">Rails 4.1现在希望在调用<code class="du lr ls lt lu b">ActiveSupport::Callbacks.set_callback</code>时传递一个显式块。这一变化源于4.1版本对<code class="du lr ls lt lu b">ActiveSupport::Callbacks</code>的大量重写。</p><p id="ab88" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Previously in Rails 4.0</code></p><p id="76ce" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">set_callback <strong class="ig hi">:save</strong>, <strong class="ig hi">:around</strong>, -&gt;(r, &amp;block) { stuff; result = block.call; stuff }</code></p><p id="8878" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Now in Rails 4.1</code></p><p id="1aa6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">set_callback <strong class="ig hi">:save</strong>, <strong class="ig hi">:around</strong>, -&gt;(r, block) { stuff; result = block.call; stuff }</code></p><h1 id="07c8" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">8从Rails 3.2升级到Rails 4.0</h1><p id="0479" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">如果您的应用程序当前使用的是早于3.2.x的任何版本的Rails，那么您应该先升级到Rails 3.2，然后再尝试升级到Rails 4.0。</p><p id="1086" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以下更改旨在将您的应用程序升级到Rails 4.0。</p><h2 id="cc56" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">8.1 HTTP补丁</h2><p id="8364" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">当在<code class="du lr ls lt lu b">config/routes.rb</code>中声明RESTful资源时，Rails 4现在使用<code class="du lr ls lt lu b">PATCH</code>作为更新的主要HTTP动词。仍然使用<code class="du lr ls lt lu b">update</code>动作，并且<code class="du lr ls lt lu b">PUT</code>请求也将继续被路由到<code class="du lr ls lt lu b">update</code>动作。因此，如果您只使用标准的RESTful路由，则不需要做任何更改:</p><p id="a07f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">resources <strong class="ig hi">:users</strong></code></p><p id="d11e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">&lt;%=</code> <code class="du lr ls lt lu b">form_for <strong class="ig hi">@user</strong></code> <code class="du lr ls lt lu b">do</code> <code class="du lr ls lt lu b">|f| %&gt;</code></p><p id="3029" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code>T25】</p><p id="b6ed" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">def</code> <code class="du lr ls lt lu b">update</code></p><p id="bd46" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># No change needed; PATCH will be preferred, and PUT will still work.</code></p><p id="494f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="1b8c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="a012" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但是，如果您使用<code class="du lr ls lt lu b">form_for</code>来更新资源，并使用<code class="du lr ls lt lu b">PUT</code> HTTP方法来定制路由，那么您将需要做出一个改变:</p><p id="aed5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">resources <strong class="ig hi">:users</strong>, do</code></p><p id="88ae" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">put <strong class="ig hi">:update_name</strong>, on: <strong class="ig hi">:member</strong></code></p><p id="4aa5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="936b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">&lt;%=</code><code class="du lr ls lt lu b">form_for [ <strong class="ig hi">:update_name</strong>, <strong class="ig hi">@user</strong></code><code class="du lr ls lt lu b">] do</code>T8】</p><p id="eaea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">class</code> <code class="du lr ls lt lu b">UsersController &lt; ApplicationController</code></p><p id="035c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">def</code>T12】</p><p id="8c2d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Change needed; form_for will try to use a non-existent PATCH route.</code></p><p id="c613" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="a75f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="c2e1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果动作没有在公共API中使用，并且您可以随意更改HTTP方法，您可以更新您的路由以使用<code class="du lr ls lt lu b">patch</code>而不是<code class="du lr ls lt lu b">put</code>:</p><p id="1992" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">PUT</code>对Rails 4中<code class="du lr ls lt lu b">/users/:id</code>的请求被路由到<code class="du lr ls lt lu b">update</code>，就像今天一样。所以，如果你有一个API来获得真正的PUT请求，它就会工作。路由器还将<code class="du lr ls lt lu b">PATCH</code>请求路由到<code class="du lr ls lt lu b">/users/:id</code>到<code class="du lr ls lt lu b">update</code>动作。</p><p id="ab45" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">resources <strong class="ig hi">:users</strong></code>T25】</p><p id="9225" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">patch <strong class="ig hi">:update_name</strong>, on: <strong class="ig hi">:member</strong></code></p><p id="e666" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="c626" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果动作正在公共API中使用，并且您不能更改为正在使用的HTTP方法，您可以更新您的表单以使用<code class="du lr ls lt lu b">PUT</code>方法:</p><p id="456a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">&lt;%=</code>T30<code class="du lr ls lt lu b">], method: <strong class="ig hi">:put</strong></code>T32】T33】</p><p id="6179" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 8.1.1关于媒体类型的说明</strong></p><p id="f402" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">PATCH</code>动词的勘误表规定,<code class="du lr ls lt lu b">PATCH</code>应使用“diff”媒体类型。JSON补丁就是这样一种格式。虽然Rails本身并不支持JSON补丁，但是添加支持还是很容易的:</p><p id="1dc9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># in your controller</code></p><p id="815e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">def update</code></p><p id="bb56" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">respond_to do |format|</code></p><p id="0664" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">format.json do</code></p><p id="57c5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># perform a partial update</code></p><p id="5a4b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">@article.update params[:article]</code></p><p id="9371" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="0d2b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">format.json_patch do</code></p><p id="69a4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># perform sophisticated change</code></p><p id="8aa8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="1f91" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="8867" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="9631" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># In config/initializers/json_patch.rb:</code></p><p id="78bf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">Mime::Type.register 'application/json-patch+json', :json_patch</code></p><div class="lw lx ez fb ly lz"><a href="https://onlineitguru.com/blog/best-gems-for-ruby-on-rails" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hi fi z dy me ea eb mf ed ef hg bi translated">Ruby on Rails最佳宝石| Ruby on Rails博客</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">如果有人想创建现代应用程序。现在让我们来解释一下，Ruby on Rails的最佳宝石。Ruby on Rails…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">onlineitguru.com</p></div></div><div class="mi l"><div class="ms l mk ml mm mi mn ji lz"/></div></div></a></div><p id="d0f6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">由于JSON Patch最近才成为RFC，所以还没有很多优秀的Ruby库。Aaron Patterson的hana就是这样一个瑰宝，但是它并不完全支持规范中最后的一些变化。</p><h2 id="20d6" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">8.2 Gemfile</h2><p id="12a7" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">Rails 4.0从<code class="du lr ls lt lu b">Gemfile</code>中移除了<code class="du lr ls lt lu b">assets</code>组。升级时，您需要从您的<code class="du lr ls lt lu b">Gemfile</code>中删除该行。您还应该更新您的应用程序文件(在<code class="du lr ls lt lu b">config/application.rb</code>):</p><p id="20a6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Require the gems listed in Gemfile, including any gems</code></p><p id="8105" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># you've limited to :test, :development, or :production.</code></p><p id="c857" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">Bundler.require(*Rails.groups)</code></p><h2 id="c01a" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">8.3供应商/插件</h2><p id="5d5d" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">Rails 4.0不再支持从<code class="du lr ls lt lu b">vendor/plugins</code>加载插件。你必须替换任何插件，把它们提取到gems并添加到你的<code class="du lr ls lt lu b">Gemfile</code>中。如果你选择不把它们变成宝石，你可以把它们移到，比如说，<code class="du lr ls lt lu b">lib/my_plugin/*</code>中，并在<code class="du lr ls lt lu b">config/initializers/my_plugin.rb</code>中添加一个合适的初始化器。</p><h2 id="d9e7" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">8.4活动记录</h2><ul class=""><li id="aaf1" class="ld le hh ig b ih ki il kj ip mt it mu ix mv jb lv lj lk ll bi translated">由于关联的一些不一致性，Rails 4.0已经从活动记录中删除了身份映射。如果您已经在您的应用程序中手动启用了它，您将不得不删除以下不再有效的配置:<code class="du lr ls lt lu b">config.active_record.identity_map</code>。</li><li id="c6e2" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">集合关联中的<code class="du lr ls lt lu b">delete</code>方法现在可以接收<code class="du lr ls lt lu b">Integer</code>或<code class="du lr ls lt lu b">String</code>参数作为记录id，除了记录之外，非常类似于<code class="du lr ls lt lu b">destroy</code>方法。先前它提出了<code class="du lr ls lt lu b">ActiveRecord::AssociationTypeMismatch</code>这样的论点。从Rails 4.0开始，在删除记录之前，会自动尝试查找与给定id匹配的记录。</li><li id="d435" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">在Rails 4.0中，当列或表被重命名时，相关的索引也被重命名。如果您有重命名索引的迁移，则不再需要它们。</li><li id="8113" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 4.0仅将<code class="du lr ls lt lu b">serialized_attributes</code>和<code class="du lr ls lt lu b">attr_readonly</code>改为类方法。你不应该使用实例方法，因为它现在已经过时了。您应该将它们改为使用类方法，例如<code class="du lr ls lt lu b">self.serialized_attributes</code>到<code class="du lr ls lt lu b">self.class.serialized_attributes</code>。</li><li id="26fa" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">当使用默认的编码器时，将<code class="du lr ls lt lu b">nil</code>赋给一个序列化的属性会将它作为<code class="du lr ls lt lu b">NULL</code>保存到数据库中，而不是通过YAML ( <code class="du lr ls lt lu b">"--- \n...\n"</code>)传递<code class="du lr ls lt lu b">nil</code>值。</li><li id="3661" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 4.0移除了<code class="du lr ls lt lu b">attr_accessible</code>和<code class="du lr ls lt lu b">attr_protected</code>特性，支持强参数。您可以使用受保护的属性gem来顺利升级。</li><li id="d39c" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">如果您没有使用受保护的属性，您可以移除任何与此gem相关的选项，如<code class="du lr ls lt lu b">whitelist_attributes</code>或<code class="du lr ls lt lu b">mass_assignment_sanitizer</code>选项。</li><li id="2b47" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 4.0要求作用域使用可调用的对象，比如Proc或lambda:</li></ul><p id="6cf6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">scope <strong class="ig hi">:active</strong>, where(active: true)</code></p><p id="679a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># becomes</code></p><p id="686c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">scope <strong class="ig hi">:active</strong>, -&gt; { where active: true</code> <code class="du lr ls lt lu b">}</code></p><ul class=""><li id="89f1" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb lv lj lk ll bi translated">Rails 4.0已经弃用了<code class="du lr ls lt lu b">ActiveRecord::Fixtures</code>而支持<code class="du lr ls lt lu b">ActiveRecord::FixtureSet</code>。</li><li id="b486" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 4.0已经弃用了<code class="du lr ls lt lu b">ActiveRecord::TestCase</code>而支持<code class="du lr ls lt lu b">ActiveSupport::TestCase</code>。</li><li id="01dc" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 4.0已经摒弃了旧式的基于哈希的finder API。这意味着以前接受“查找选项”的方法不再接受。例如，<code class="du lr ls lt lu b">Book.find(:all, conditions: { name: '1984' })</code>已被弃用，取而代之的是<code class="du lr ls lt lu b">Book.where(name: '1984')</code></li><li id="6565" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">除了<code class="du lr ls lt lu b">find_by_...</code>和<code class="du lr ls lt lu b">find_by_...!</code>之外的所有动态方法都被否决。以下是你应对这些变化的方法:</li><li id="bb6e" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated"><code class="du lr ls lt lu b">find_all_by_...</code>变成了<code class="du lr ls lt lu b">where(...)</code>。</li><li id="4ab4" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated"><code class="du lr ls lt lu b">find_last_by_...</code>变成了<code class="du lr ls lt lu b">where(...).last</code>。</li><li id="be01" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated"><code class="du lr ls lt lu b">scoped_by_...</code>变成了<code class="du lr ls lt lu b">where(...)</code>。</li><li id="7a46" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated"><code class="du lr ls lt lu b">find_or_initialize_by_...</code>变成了<code class="du lr ls lt lu b">find_or_initialize_by(...)</code>。</li><li id="07b7" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated"><code class="du lr ls lt lu b">find_or_create_by_...</code>变成了<code class="du lr ls lt lu b">find_or_create_by(...)</code>。</li><li id="f43b" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">注意<code class="du lr ls lt lu b">where(...)</code>返回一个关系，而不是像旧的查找器那样返回一个数组。如果你需要一个<code class="du lr ls lt lu b">Array</code>，使用<code class="du lr ls lt lu b">where(...).to_a</code>。</li><li id="e57d" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">这些等效的方法可能不会执行与前面的实现相同的SQL。</li><li id="41f0" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">要重新启用旧的查找器，可以使用active record-deprecated _ finders gem。</li><li id="a59a" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 4.0已经更改为<code class="du lr ls lt lu b">has_and_belongs_to_many</code>关系的默认连接表，去掉了第二个表名的公共前缀。具有共同前缀的模型之间的任何现有的<code class="du lr ls lt lu b">has_and_belongs_to_many</code>关系必须用<code class="du lr ls lt lu b">join_table</code>选项指定。例如:</li></ul><p id="6cc4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">CatalogCategory &lt; ActiveRecord::Base</code></p><p id="554f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">has_and_belongs_to_many <strong class="ig hi">:catalog_products</strong>, join_table: <em class="lb">'catalog_categories_catalog_products'</em></code></p><p id="782e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="d0b1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">CatalogProduct &lt; ActiveRecord::Base</code></p><p id="85b3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">has_and_belongs_to_many <strong class="ig hi">:catalog_categories</strong>, join_table: <em class="lb">'catalog_categories_catalog_products'</em></code></p><p id="fb40" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><ul class=""><li id="7384" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb lv lj lk ll bi translated">注意前缀也考虑了范围，所以<code class="du lr ls lt lu b">Catalog::Category</code>和<code class="du lr ls lt lu b">Catalog::Product</code>或者<code class="du lr ls lt lu b">Catalog::Category</code>和<code class="du lr ls lt lu b">CatalogProduct</code>之间的关系需要类似地更新。</li></ul><h2 id="1f7a" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">8.5活动资源</h2><p id="5305" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">Rails 4.0将活动资源提取到自己的gem中。如果你仍然需要这个特性，你可以在你的<code class="du lr ls lt lu b">Gemfile</code>中添加活动的资源宝石。</p><h2 id="732f" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">8.6活动模型</h2><ul class=""><li id="7a89" class="ld le hh ig b ih ki il kj ip mt it mu ix mv jb lv lj lk ll bi translated">Rails 4.0改变了错误与<code class="du lr ls lt lu b">ActiveModel::Validations::ConfirmationValidator</code>的关联方式。现在，当确认验证失败时，错误将被附加到<code class="du lr ls lt lu b">:#{attribute}_confirmation</code>而不是<code class="du lr ls lt lu b">attribute</code>。</li><li id="4c72" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 4.0已经把<code class="du lr ls lt lu b">ActiveModel::Serializers::JSON.include_root_in_json</code>默认值改成了<code class="du lr ls lt lu b">false</code>。现在，活动模型序列化程序和活动记录对象具有相同的默认行为。这意味着您可以在<code class="du lr ls lt lu b">config/initializers/wrap_parameters.rb</code>文件中注释或删除以下选项:</li></ul><p id="ef36" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Disable root element in JSON by default.</code></p><p id="7678" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># ActiveSupport.on_load(:active_record) do</code></p><p id="c824" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># self.include_root_in_json = false</code></p><p id="420d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># end</code></p><h2 id="954a" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">8.7行动包</h2><ul class=""><li id="1a21" class="ld le hh ig b ih ki il kj ip mt it mu ix mv jb lv lj lk ll bi translated">Rails 4.0引入了<code class="du lr ls lt lu b">ActiveSupport::KeyGenerator</code>，并以此为基础生成和验证签名的cookies(以及其他内容)。如果您保留现有的<code class="du lr ls lt lu b">secret_token</code>并添加新的<code class="du lr ls lt lu b">secret_key_base</code>，那么用Rails 3.x生成的现有签名cookies将被透明地升级。</li></ul><p id="1f0b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># config/initializers/secret_token.rb</code></p><p id="e7a5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">Myapp::Application.config.secret_token = <em class="lb">'existing secret token'</em></code></p><p id="220e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">Myapp::Application.config.secret_key_base = <em class="lb">'new secret key base'</em></code></p><p id="d453" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请注意，您应该等到Rails 4.x上有了100%的用户群，并且有理由确信您不需要回滚到Rails 3.x时再设置<code class="du lr ls lt lu b">secret_key_base</code>，这是因为基于Rails 4.x中的新<code class="du lr ls lt lu b">secret_key_base</code>签名的cookies与Rails 3.x并不向后兼容，您可以保留现有的<code class="du lr ls lt lu b">secret_token</code>，不设置新的<code class="du lr ls lt lu b">secret_key_base</code>，并忽略弃用警告，直到您有理由确信您的升级已经完成。</p><p id="5416" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您依赖外部应用程序或JavaScript来读取您的Rails应用程序的签名会话cookie(或一般的签名cookie ),那么您不应该设置<code class="du lr ls lt lu b">secret_key_base</code>,直到您解除了这些顾虑。</p><ul class=""><li id="8b78" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb lv lj lk ll bi translated">如果设置了<code class="du lr ls lt lu b">secret_key_base</code>，Rails 4.0会对基于cookie的会话内容进行加密。Rails 3.x对基于cookie的会话内容进行了签名，但没有加密。签名的cookies是“安全的”,因为它们被验证是由您的应用程序生成的，并且是防篡改的。但是，最终用户可以查看这些内容，对内容进行加密消除了这种警告/顾虑，而不会显著降低性能。</li></ul><p id="e21d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请阅读Pull Request #9978，了解有关移动到加密会话cookies的详细信息。</p><ul class=""><li id="d002" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb lv lj lk ll bi translated">Rails 4.0去掉了<code class="du lr ls lt lu b">ActionController::Base.asset_path</code>选项。使用资产管道功能。</li><li id="16a6" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 4.0已经弃用了<code class="du lr ls lt lu b">ActionController::Base.page_cache_extension</code>选项。用<code class="du lr ls lt lu b">ActionController::Base.default_static_extension</code>代替。</li><li id="d204" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 4.0已经从Action Pack中移除了动作和页面缓存。你需要添加<code class="du lr ls lt lu b">actionpack-action_caching</code>宝石以便在你的控制器中使用<code class="du lr ls lt lu b">caches_action</code>和<code class="du lr ls lt lu b">actionpack-page_caching</code>来使用<code class="du lr ls lt lu b">caches_page</code>。</li><li id="c0b5" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 4.0移除了XML参数解析器。如果您需要此功能，您将需要添加<code class="du lr ls lt lu b">actionpack-xml_parser</code>宝石。</li><li id="ff91" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 4.0使用返回nil的符号或过程来改变默认的<code class="du lr ls lt lu b">layout</code>查找集。要获得“无布局”行为，请返回false而不是nil。</li><li id="6098" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 4.0将默认的memcached客户端从<code class="du lr ls lt lu b">memcache-client</code>改为<code class="du lr ls lt lu b">dalli</code>。要升级，只需将<code class="du lr ls lt lu b">gem 'dalli'</code>添加到您的<code class="du lr ls lt lu b">Gemfile</code>中。</li><li id="e166" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 4.0反对控制器中的<code class="du lr ls lt lu b">dom_id</code>和<code class="du lr ls lt lu b">dom_class</code>方法(在视图中它们很好)。您需要在需要此功能的控制器中包含<code class="du lr ls lt lu b">ActionView::RecordIdentifier</code>模块。</li><li id="f94e" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 4.0不支持<code class="du lr ls lt lu b">link_to</code>助手的<code class="du lr ls lt lu b">:confirm</code>选项。你应该依靠一个数据属性(例如<code class="du lr ls lt lu b">data: { confirm: 'Are you sure?' }</code>)。这种贬低也关系到基于这个的帮手(比如<code class="du lr ls lt lu b">link_to_if</code>或者<code class="du lr ls lt lu b">link_to_unless</code>)。</li></ul><div class="lw lx ez fb ly lz"><a href="https://onlineitguru.com/blog/role-of-cucumber-in-ruby-on-rails" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hi fi z dy me ea eb mf ed ef hg bi translated">Cucumber在Ruby on Rails中的作用| Ruby On Rails博客| OnlineITGuru</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">我希望你们这些人看了标题后认为作者疯了。如果你这样想，那你就错了。此外…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">onlineitguru.com</p></div></div><div class="mi l"><div class="mw l mk ml mm mi mn ji lz"/></div></div></a></div><ul class=""><li id="d3a7" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb lv lj lk ll bi translated">Rails 4.0改变了<code class="du lr ls lt lu b">assert_generates</code>、<code class="du lr ls lt lu b">assert_recognizes</code>和<code class="du lr ls lt lu b">assert_routing</code>的工作方式。现在所有这些断言都提出了<code class="du lr ls lt lu b">Assertion</code>而不是<code class="du lr ls lt lu b">ActionController::RoutingError</code>。</li><li id="499c" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">如果定义了冲突的命名路由，Rails 4.0会引发一个<code class="du lr ls lt lu b">ArgumentError</code>。这可以由显式定义的命名路由或由<code class="du lr ls lt lu b">resources</code>方法触发。这里有两个与名为<code class="du lr ls lt lu b">example_path</code>的路由冲突的例子:</li></ul><p id="134d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">get <em class="lb">'one'</em></code>T9】</p><p id="a9a8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">get <em class="lb">'two'</em></code>T11】</p><p id="5ca8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">resources <strong class="ig hi">:examples</strong></code></p><p id="b541" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">get <em class="lb">'clashing/:id'</em></code> <code class="du lr ls lt lu b">=&gt; <em class="lb">'test#example'</em>, as: <strong class="ig hi">:example</strong></code></p><p id="dd9e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在第一种情况下，您可以简单地避免对多个路由使用相同的名称。在第二种情况下，您可以使用<code class="du lr ls lt lu b">resources</code>方法提供的<code class="du lr ls lt lu b">only</code>或<code class="du lr ls lt lu b">except</code>选项来限制创建的路径，详见路径指南。</p><ul class=""><li id="9eb7" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb lv lj lk ll bi translated">Rails 4.0还改变了unicode字符路线的绘制方式。现在可以直接画unicode字符路线了。如果您已经绘制了这样的路线，您必须更改它们，例如:</li></ul><p id="22f2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">get Rack::Utils.escape(<em class="lb">'こんにちは'</em>), controller: <em class="lb">'welcome'</em>, action: <em class="lb">'index'</em></code></p><p id="60fb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">成为</p><p id="eb6e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">get <em class="lb">'こんにちは'</em>, controller: <em class="lb">'welcome'</em>, action: <em class="lb">'index'</em></code></p><ul class=""><li id="f3a1" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb lv lj lk ll bi translated">Rails 4.0要求使用<code class="du lr ls lt lu b">match</code>的路由必须指定请求方法。例如:</li></ul><p id="4287" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Rails 3.x</code></p><p id="7e18" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">match <em class="lb">'/'</em></code> <code class="du lr ls lt lu b">=&gt; <em class="lb">'root#index'</em></code></p><p id="4392" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># becomes</code></p><p id="6815" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">match <em class="lb">'/'</em></code> <code class="du lr ls lt lu b">=&gt; <em class="lb">'root#index'</em>, via: <strong class="ig hi">:get</strong></code></p><p id="e662" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># or</code></p><p id="d473" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">get <em class="lb">'/'</em></code>T29】</p><ul class=""><li id="e9bd" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb lv lj lk ll bi translated">Rails 4.0移除了<code class="du lr ls lt lu b">ActionDispatch::BestStandardsSupport</code>中间件，<code class="du lr ls lt lu b">&lt;!DOCTYPE html&gt;</code>已经按照https://msdn . Microsoft . com/en-us/library/jj 676915(v = vs . 85)触发了标准模式。aspx和ChromeFrame头被移到了<code class="du lr ls lt lu b">config.action_dispatch.default_headers</code>。</li></ul><p id="895e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请记住，您还必须从应用程序代码中删除对中间件的任何引用，例如:</p><p id="6a58" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Raise exception</code></p><p id="bdfa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.middleware.insert_before(Rack::Lock, ActionDispatch::BestStandardsSupport)</code></p><p id="07c0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">此外，检查<code class="du lr ls lt lu b">config.action_dispatch.best_standards_support</code>的环境设置，如果有，将其删除。</p><ul class=""><li id="0d4b" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb lv lj lk ll bi translated">Rails 4.0允许通过设置<code class="du lr ls lt lu b">config.action_dispatch.default_headers</code>来配置HTTP头。默认值如下:</li></ul><p id="4fe0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.action_dispatch.default_headers = {</code></p><p id="9a3a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"><em class="lb">'X-Frame-Options'</em></code>T9】</p><p id="abfd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"><em class="lb">'X-XSS-Protection'</em></code>T11】</p><p id="63ff" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">}</code></p><p id="c6f8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请注意，如果您的应用程序依赖于在<code class="du lr ls lt lu b">&lt;frame&gt;</code>或<code class="du lr ls lt lu b">&lt;iframe&gt;</code>中加载某些页面，那么您可能需要显式地将<code class="du lr ls lt lu b">X-Frame-Options</code>设置为<code class="du lr ls lt lu b">ALLOW-FROM ...</code>或<code class="du lr ls lt lu b">ALLOWALL</code>。</p><ul class=""><li id="2591" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb lv lj lk ll bi translated">在Rails 4.0中，预编译资产不再自动从<code class="du lr ls lt lu b">vendor/assets</code>和<code class="du lr ls lt lu b">lib/assets</code>复制非JS/CSS资产。Rails应用程序和引擎开发人员应该将这些资产放入<code class="du lr ls lt lu b">app/assets</code>或配置<code class="du lr ls lt lu b">config.assets.precompile</code>。</li><li id="f993" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">在Rails 4.0中，当动作不处理请求格式时，<code class="du lr ls lt lu b">ActionController::UnknownFormat</code>被引发。默认情况下，通过响应406不可接受来处理异常，但是您现在可以覆盖它。在Rails 3中，总是返回不可接受的406。没有覆盖。</li><li id="fbbf" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">在Rails 4.0中，当<code class="du lr ls lt lu b">ParamsParser</code>无法解析请求参数时，会引发一个通用的<code class="du lr ls lt lu b">ActionDispatch::ParamsParser::ParseError</code>异常。例如，您可能想要拯救这个异常，而不是低级别的<code class="du lr ls lt lu b">MultiJson::DecodeError</code>。</li><li id="a9c9" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">在Rails 4.0中，当引擎被安装在一个由URL前缀提供服务的应用程序上时，<code class="du lr ls lt lu b">SCRIPT_NAME</code>被正确地嵌套。您不再需要设置<code class="du lr ls lt lu b">default_url_options[:script_name]</code>来解决被覆盖的URL前缀。</li><li id="bba4" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 4.0弃用了<code class="du lr ls lt lu b">ActionController::Integration</code>而支持<code class="du lr ls lt lu b">ActionDispatch::Integration</code>。</li><li id="cf09" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 4.0弃用了<code class="du lr ls lt lu b">ActionController::IntegrationTest</code>而支持<code class="du lr ls lt lu b">ActionDispatch::IntegrationTest</code>。</li><li id="7bb1" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 4.0弃用了<code class="du lr ls lt lu b">ActionController::PerformanceTest</code>而支持<code class="du lr ls lt lu b">ActionDispatch::PerformanceTest</code>。</li><li id="eb12" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 4.0弃用了<code class="du lr ls lt lu b">ActionController::AbstractRequest</code>，转而支持<code class="du lr ls lt lu b">ActionDispatch::Request</code>。</li><li id="a48a" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 4.0弃用了<code class="du lr ls lt lu b">ActionController::Request</code>而支持<code class="du lr ls lt lu b">ActionDispatch::Request</code>。</li><li id="d21d" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 4.0弃用了<code class="du lr ls lt lu b">ActionController::AbstractResponse</code>而支持<code class="du lr ls lt lu b">ActionDispatch::Response</code>。</li><li id="882d" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 4.0弃用了<code class="du lr ls lt lu b">ActionController::Response</code>而支持<code class="du lr ls lt lu b">ActionDispatch::Response</code>。</li><li id="e4f5" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated">Rails 4.0弃用了<code class="du lr ls lt lu b">ActionController::Routing</code>而支持<code class="du lr ls lt lu b">ActionDispatch::Routing</code>。</li></ul><h2 id="92ac" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">8.8积极支持</h2><p id="7383" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">Rails 4.0移除了<code class="du lr ls lt lu b">ERB::Util#json_escape</code>的别名<code class="du lr ls lt lu b">j</code>，因为<code class="du lr ls lt lu b">j</code>已经被用于<code class="du lr ls lt lu b">ActionView::Helpers::JavaScriptHelper#escape_javascript</code>。</p><p id="0f37" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">高速缓存</p><p id="ce04" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Rails 3.x和4.0之间的缓存方法发生了变化。您应该更改缓存命名空间并推出冷缓存。</p><h2 id="075c" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">8.9助手装载顺序</h2><p id="ed3b" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">在Rails 4.0中，来自多个目录的助手的加载顺序发生了变化。以前，它们被收集起来，然后按字母顺序排列。升级到Rails 4.0后，helpers将保留加载目录的顺序，并且在每个目录中只按字母顺序排序。除非您显式地使用<code class="du lr ls lt lu b">helpers_path</code>参数，否则这个变化只会影响从引擎加载助手的方式。如果您依赖订购，您应该检查升级后是否有正确的方法可用。如果您想改变发动机的装载顺序，您可以使用<code class="du lr ls lt lu b">config.railties_order=</code>方法。</p><h2 id="49bd" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">8.10主动记录观察器和动作控制器清扫器</h2><p id="6d15" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated"><code class="du lr ls lt lu b">ActiveRecord::Observer</code>和<code class="du lr ls lt lu b">ActionController::Caching::Sweeper</code>已经被提取到<code class="du lr ls lt lu b">rails-observers</code>宝石中。如果你需要这些功能，你将需要添加<code class="du lr ls lt lu b">rails-observers</code>宝石。</p><h2 id="713a" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">8.11链轮-轨道</h2><ul class=""><li id="ea5a" class="ld le hh ig b ih ki il kj ip mt it mu ix mv jb lv lj lk ll bi translated"><code class="du lr ls lt lu b">assets:precompile:primary</code>和<code class="du lr ls lt lu b">assets:precompile:all</code>已被删除。用<code class="du lr ls lt lu b">assets:precompile</code>代替。</li><li id="98e3" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb lv lj lk ll bi translated"><code class="du lr ls lt lu b">config.assets.compress</code>选项应改为<code class="du lr ls lt lu b">config.assets.js_compressor</code>，例如:</li></ul><p id="f685" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.assets.js_compressor = <strong class="ig hi">:uglifier</strong></code></p><h2 id="7aed" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">8.12不锈钢栏杆</h2><ul class=""><li id="8a7b" class="ld le hh ig b ih ki il kj ip mt it mu ix mv jb lv lj lk ll bi translated"><code class="du lr ls lt lu b">asset-url</code>带有两个参数，不推荐使用。比如:<code class="du lr ls lt lu b">asset-url("rails.png", image)</code>变成<code class="du lr ls lt lu b">asset-url("rails.png")</code>。</li></ul><h1 id="3deb" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">9从Rails 3.1升级到Rails 3.2</h1><p id="4ac3" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">如果您的应用程序当前使用的是早于3.1.x的任何版本的Rails，您应该在尝试更新到Rails 3.2之前升级到Rails 3.1。</p><p id="b374" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以下更改旨在将您的应用程序升级到最新的Rails 3.2 . x版本。</p><h2 id="cdf5" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">9.1 Gemfile</h2><p id="2a4c" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">对您的<code class="du lr ls lt lu b">Gemfile</code>进行以下更改。</p><p id="9dfd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">gem <em class="lb">'rails'</em>, <em class="lb">'3.2.21'</em></code></p><p id="db2c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">group <strong class="ig hi">:assets</strong></code> <code class="du lr ls lt lu b">do</code></p><p id="a72b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">gem <em class="lb">'sass-rails'</em>, <em class="lb">'~&gt; 3.2.6'</em></code></p><p id="6301" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">gem <em class="lb">'coffee-rails'</em>, <em class="lb">'~&gt; 3.2.2'</em></code></p><p id="3ad5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">gem <em class="lb">'uglifier'</em>, <em class="lb">'&gt;= 1.0.3'</em></code></p><p id="3c90" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><div class="lw lx ez fb ly lz"><a href="https://onlineitguru.com/blog/why-we-use-ruby-on-rails-for-web-applications" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hi fi z dy me ea eb mf ed ef hg bi translated">为什么我们在web应用中使用Ruby on Rails</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">Rails是Ruby的第一个web框架，Ruby编程语言设计用于rails web应用程序…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">onlineitguru.com</p></div></div><div class="mi l"><div class="mx l mk ml mm mi mn ji lz"/></div></div></a></div><h2 id="e322" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">9.2配置/环境/开发. rb</h2><p id="db5d" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">有几个新的配置设置应该添加到开发环境中:</p><p id="fa19" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Raise exception on mass assignment protection for Active Record models</code></p><p id="6871" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.active_record.mass_assignment_sanitizer = <strong class="ig hi">:strict</strong></code></p><p id="0581" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Log the query plan for queries taking more than this (works</code></p><p id="88bc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># with SQLite, MySQL, and PostgreSQL)</code></p><p id="e41b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.active_record.auto_explain_threshold_in_seconds = 0.5</code></p><h2 id="df8c" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">9.3配置/环境/测试. rb</h2><p id="50bf" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated"><code class="du lr ls lt lu b">mass_assignment_sanitizer</code>配置设置也应添加到<code class="du lr ls lt lu b">config/environments/test.rb</code>:</p><p id="47f8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Raise exception on mass assignment protection for Active Record models</code></p><p id="cd80" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.active_record.mass_assignment_sanitizer = <strong class="ig hi">:strict</strong></code></p><h2 id="f6e0" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">9.4供应商/插件</h2><p id="b785" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">Rails 3.2反对<code class="du lr ls lt lu b">vendor/plugins</code>，Rails 4.0将彻底移除它们。虽然这并不是Rails 3.2升级的必要部分，但是您可以通过将插件提取到gems并添加到您的<code class="du lr ls lt lu b">Gemfile</code>中来开始替换任何插件。如果你选择不把它们变成宝石，你可以把它们移到，比如说，<code class="du lr ls lt lu b">lib/my_plugin/*</code>中，并在<code class="du lr ls lt lu b">config/initializers/my_plugin.rb</code>中添加一个合适的初始化器。</p><h2 id="56a8" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">9.5活动记录</h2><p id="367c" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">选项<code class="du lr ls lt lu b">:dependent =&gt; :restrict</code>已从<code class="du lr ls lt lu b">belongs_to</code>中移除。如果您想防止在存在任何关联对象的情况下删除该对象，您可以设置<code class="du lr ls lt lu b">:dependent =&gt; :destroy</code>并在从任何关联对象的销毁回调中检查关联的存在之后返回<code class="du lr ls lt lu b">false</code>。</p><h1 id="5345" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">10从Rails 3.0升级到Rails 3.1</h1><p id="9757" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">如果您的应用程序当前使用的是早于3.0.x的任何版本的Rails，您应该在尝试更新到Rails 3.1之前升级到Rails 3.0。</p><p id="5030" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以下更改旨在将您的应用程序升级到Rails 3.1.12，这是Rails的最新3.1.x版本。</p><h2 id="fa33" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">10.1 Gemfile</h2><p id="4f3a" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">对您的<code class="du lr ls lt lu b">Gemfile</code>进行以下更改。</p><p id="d2a4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">gem <em class="lb">'rails'</em>, <em class="lb">'3.1.12'</em></code></p><p id="5fcc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">gem <em class="lb">'mysql2'</em></code></p><p id="0bff" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Needed for the new asset pipeline</code></p><p id="9650" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">group <strong class="ig hi">:assets</strong></code> <code class="du lr ls lt lu b">do</code></p><p id="26bb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">gem <em class="lb">'sass-rails'</em>, <em class="lb">'~&gt; 3.1.7'</em></code></p><p id="0e08" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">gem <em class="lb">'coffee-rails'</em>, <em class="lb">'~&gt; 3.1.1'</em></code></p><p id="ba4e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">gem <em class="lb">'uglifier'</em>, <em class="lb">'&gt;= 1.0.3'</em></code></p><p id="ff53" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="cf82" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># jQuery is the default JavaScript library in Rails 3.1</code></p><p id="f4c8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">gem <em class="lb">'jquery-rails'</em></code></p><h2 id="81c6" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">10.2配置/应用程序. rb</h2><p id="951d" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">资产管道需要增加以下内容:</p><p id="a6f1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.assets.enabled = true</code></p><p id="a4c3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.assets.version = <em class="lb">'1.0'</em></code></p><p id="9259" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您的应用程序对资源使用“/assets”路由，您可能希望更改用于资产的前缀以避免冲突:</p><p id="5a97" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Defaults to '/assets'</code></p><p id="22e7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.assets.prefix = <em class="lb">'/asset-files'</em></code></p><h2 id="6d37" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">10.3配置/环境/开发. rb</h2><p id="2c57" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">移除RJS设置<code class="du lr ls lt lu b">config.action_view.debug_rjs = true</code>。</p><p id="55b8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果启用了资产管道，请添加这些设置:</p><p id="aae1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Do not compress assets</code></p><p id="6e95" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.assets.compress = false</code></p><p id="89dc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Expands the lines which load the assets</code></p><p id="31f2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.assets.debug = true</code></p><h2 id="cb76" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">10.4配置/环境/生产. rb</h2><p id="3165" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">同样，下面的大部分变化是针对资产管道的。您可以在《资产管道指南》中了解更多相关信息。</p><p id="dcf6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Compress JavaScripts and CSS</code></p><p id="bda6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.assets.compress = true</code></p><p id="56b9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Don't fallback to assets pipeline if a precompiled asset is missed</code></p><p id="0090" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.assets.compile = false</code></p><p id="bf08" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Generate digests for assets URLs</code></p><p id="f59b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.assets.digest = true</code></p><p id="8c4a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Defaults to Rails.root.join("public/assets")</code></p><p id="fcb5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># config.assets.manifest = YOUR_PATH</code></p><p id="12db" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Precompile additional assets (application.js, application.css, and all non-JS/CSS are already added)</code></p><p id="e9eb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># config.assets.precompile += %w( admin.js admin.css )</code></p><p id="d8ab" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Force all access to the app over SSL, use Strict-Transport-Security, and use secure cookies.</code></p><p id="e40c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># config.force_ssl = true</code></p><h2 id="85fd" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">10.5配置/环境/测试. rb</h2><p id="21a7" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">您可以在测试环境中添加以下内容来帮助测试性能:</p><p id="2793" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Configure static asset server for tests with Cache-Control for performance</code></p><p id="b3b4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.public_file_server.enabled = true</code></p><p id="7c02" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">config.public_file_server.headers = {</code></p><p id="fbc8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"><em class="lb">'Cache-Control'</em></code> <code class="du lr ls lt lu b">=&gt; <em class="lb">'public, max-age=3600'</em></code></p><p id="6c31" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">}</code></p><h2 id="b3c0" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">10.6 config/initializer/wrap _ parameters . Rb</h2><p id="0991" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">如果您希望将参数包装到嵌套散列中，请添加包含以下内容的文件。在新的应用程序中，这是默认打开的。</p><p id="0317" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Be sure to restart your server when you modify this file.</code></p><p id="f0ee" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># This file contains settings for ActionController::ParamsWrapper which</code></p><p id="0502" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># is enabled by default.</code></p><p id="e845" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Enable parameter wrapping for JSON. You can disable this by setting :format to an empty array.</code></p><p id="b679" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">ActiveSupport.on_load(<strong class="ig hi">:action_controller</strong>) do</code></p><p id="f05e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">wrap_parameters format: [<strong class="ig hi">:json</strong>]</code></p><p id="1fc7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><p id="ba61" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># Disable root element in JSON by default.</code></p><p id="d09c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">ActiveSupport.on_load(<strong class="ig hi">:active_record</strong>) do</code></p><p id="ee15" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">self.include_root_in_json = false</code></p><p id="a691" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">end</code></p><h2 id="649d" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">10.7 config/initializer/session _ store . Rb</h2><p id="f554" class="pw-post-body-paragraph ie if hh ig b ih ki ij ik il kj in io ip kk ir is it kl iv iw ix km iz ja jb ha bi translated">您需要将会话密钥更改为新的密钥，或者删除所有会话:</p><p id="17d0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b"># in config/initializers/session_store.rb</code></p><p id="b1d0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">AppName::Application.config.session_store <strong class="ig hi">:cookie_store</strong>, key: <em class="lb">'SOMETHINGNEW'</em></code></p><p id="41bc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">或</strong></p><p id="499d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lr ls lt lu b">$ bin/rake db:sessions:clear</code></p><h2 id="56cf" class="kn jl hh bd jm ko kp kq jq kr ks kt ju ip ku kv jy it kw kx kc ix ky kz kg la bi translated">10.8视图中资产辅助对象引用中的Remove :cache和:concat选项</h2><ul class=""><li id="d596" class="ld le hh ig b ih ki il kj ip mt it mu ix mv jb lv lj lk ll bi translated">对于资产管道，不再使用:cache和:concat选项，请从视图中删除这些选项。</li></ul></div></div>    
</body>
</html>