<html>
<head>
<title>Query Rewards: Building a Recommendation Feedback Loop During Query Selection</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">查询奖励:在查询选择过程中构建推荐反馈环</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/query-rewards-building-a-recommendation-feedback-loop-during-query-selection-70b4d20e5ea0?source=collection_archive---------0-----------------------#2022-10-26">https://medium.com/pinterest-engineering/query-rewards-building-a-recommendation-feedback-loop-during-query-selection-70b4d20e5ea0?source=collection_archive---------0-----------------------#2022-10-26</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="b1b4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Bella Huang |软件工程师，首页候选生成；Raymond Hsu |工程师经理，首页候选人生成；Dylan Wang |工程师经理，家庭相关性</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/64dfa7dd08ec9c56bfa6feedaf2e3458.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QEg9t39UWT_-V60nrYsuBg.png"/></div></div></figure><p id="78fc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在Homefeed中，大约30%的推荐管脚来自基于管脚到管脚的检索。这意味着在检索阶段，我们使用一批查询pin来调用我们的检索系统以生成pin推荐。我们通常使用用户先前使用的pin，并且用户可能有数百个(或数千个！所以我们的一个关键问题是:我们如何从用户简档中选择正确的查询pin？</p><h1 id="8625" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">使用PinnerSAGE的用户特征概述</h1><p id="8b3a" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">在Pinterest，我们使用<a class="ae kr" rel="noopener" href="/pinterest-engineering/pinnersage-multi-modal-user-embedding-framework-for-recommendations-at-pinterest-bfd116b49475">个人信息</a>作为用户个人信息的主要来源。PinnerSAGE通过将附近的pin分组在一起，基于pin嵌入来生成用户参与的pin的聚类。每个集群代表用户的特定用例，并且通过从不同的集群中选择查询引脚来允许多样性。我们对作为查询源的PinnerSAGE集群进行采样。</p><h1 id="75e6" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">添加查询奖励前的Homefeed查询合成</h1><p id="3279" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">以前，我们根据集群中的原始动作计数对集群进行采样。然而，这种基本采样方法有几个缺点:</p><ul class=""><li id="e59d" class="ks kt hh ig b ih ii il im ip ku it kv ix kw jb kx ky kz la bi translated">如果没有新约定发生，查询选择是相对静态的。主要原因是我们在对聚类进行采样时只考虑了动作量。除非用户采取大量的新动作，否则采样分布大致保持不变。</li><li id="fcd3" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">没有反馈用于将来的查询选择。在每个集群抽样期间，我们不考虑最后一个请求的抽样结果中的下游约定。用户在上一次请求中可能有积极或消极的参与，但在下一次请求中不要考虑这一点。</li><li id="8401" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">除了时间戳，它无法区分相同的操作类型。例如，如果同一聚类中的动作都发生在大约同一时间，则每个动作的权重将是相同的。</li></ul><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lg"><img src="../Images/5b00b9f047079d7b31b26c16f198be7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IFOraTVkk17Ly648J3MnXQ.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx"><em class="ll">Figure 1. Previous query selection flow</em></figcaption></figure><h1 id="176b" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">添加查询奖励后的Homefeed查询组合</h1><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lm"><img src="../Images/9eccc0cdd0b8d2f414555ed0362ff448.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rpcq3WiLvDD68n6hp9vl6Q.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx"><em class="ll">Figure 2. Current query selection flow with query reward</em></figcaption></figure><p id="9070" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了解决前面方法的缺点，我们向查询选择层添加了一个新的组件，称为查询奖励。查询奖励由一个工作流组成，该工作流计算每个查询的参与率，我们存储和检索该参与率以供将来查询选择使用。因此，我们可以建立一个反馈回路，用下游参与来奖励查询。</p><p id="8c2f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里有一个查询奖励如何工作的例子。假设一个用户有两个PinnerSAGE集群:一个大集群与食谱相关，一个小集群与家具相关。我们最初向用户展示了许多食谱别针，但用户并不参与其中。查询奖励可以捕捉到食谱聚类具有许多印象但没有未来参与度。因此，以集群的参与率计算的未来回报将逐渐下降，我们将有更大的机会选择小型家具集群。如果我们向用户展示几个家具别针，他们使用它们，查询奖励将增加我们未来选择家具集群的可能性。因此，在查询奖励的帮助下，我们能够基于用户的参与度建立反馈环，并更好地选择候选生成的查询。</p><p id="98ba" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一些集群可能没有任何参与度(例如，空的查询奖励)。这可能是因为:</p><ul class=""><li id="4edb" class="ks kt hh ig b ih ii il im ip ku it kv ix kw jb kx ky kz la bi translated">该集群在很久以前就被占用了，所以它最近没有机会被选中</li><li id="73ce" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">集群对于用户来说是一个新的用例，所以我们在回报方面没有太多的记录</li></ul><p id="ab38" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当集群没有任何参与度时，我们会给它们一个平均权重，这样它们仍有机会向用户公开。在下一次运行查询奖励工作流后，我们将获得更多关于未暴露聚类的信息，并决定下次是否选择它们。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/64dfa7dd08ec9c56bfa6feedaf2e3458.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QEg9t39UWT_-V60nrYsuBg.png"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx"><em class="ll">Figure 3. Building a feedback loop based on Query Reward</em></figcaption></figure><h1 id="aa22" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">下一步/未来方向</h1><ul class=""><li id="f176" class="ks kt hh ig b ih km il kn ip ln it lo ix lp jb kx ky kz la bi translated">Pinterest作为一个带来灵感的平台，愿意尽我们所能给Pinners提供个性化的推荐。我们希望优先考虑用户的下游反馈，包括积极和消极的参与。在未来的迭代中，我们将考虑更多的参与类型，而不是repin来建立用户档案。</li><li id="2d1e" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">为了最大化Pinterest的使用效率，而不是建立离线查询奖励，我们希望转移到实时版本，以丰富在线请求中的分析信号。这将允许反馈回路更加响应迅速，潜在地在用户浏览时在相同的Homefeed会话中对用户做出响应。</li><li id="f8d1" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">除了基于pin的检索之外，我们可以很容易地对任何基于令牌的检索方法采用类似的方法。</li></ul><h1 id="5595" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">承认</h1><p id="a938" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">感谢通过讨论、评论和建议做出贡献的合作者:邓博文、桂新元、、顾能、周敏哲、何大方、吴、陈忠贤</p><p id="aae6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="lq">要在Pinterest了解更多工程知识，请查看我们的</em> <a class="ae kr" href="https://medium.com/pinterest-engineering" rel="noopener"> <em class="lq">工程博客</em> </a> <em class="lq">，并访问我们的</em><a class="ae kr" href="https://www.pinterestlabs.com?utm_source=medium&amp;utm_medium=blog-article-link&amp;utm_campaign=huang-hsu-wang-oct-25-2022" rel="noopener ugc nofollow" target="_blank"><em class="lq">Pinterest Labs</em></a><em class="lq">网站。要探索Pinterest的生活，请访问我们的</em> <a class="ae kr" href="https://www.pinterestcareers.com?utm_source=medium&amp;utm_medium=blog-article-link&amp;utm_campaign=huang-hsu-wang-oct-25-2022" rel="noopener ugc nofollow" target="_blank"> <em class="lq">职业</em> </a> <em class="lq">页面。</em></p></div></div>    
</body>
</html>