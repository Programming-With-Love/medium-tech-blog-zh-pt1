<html>
<head>
<title>How to implement Basic Authentication with cordova-plugin-oracle-idm-auth</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用cordova-plugin-oracle-idm-auth实现基本认证</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/how-to-implement-basic-authentication-with-cordova-plugin-oracle-idm-auth-69a74e581929?source=collection_archive---------0-----------------------#2017-12-06">https://medium.com/oracledevs/how-to-implement-basic-authentication-with-cordova-plugin-oracle-idm-auth-69a74e581929?source=collection_archive---------0-----------------------#2017-12-06</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="5c93" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们最近发布了<a class="ae jc" href="https://github.com/oracle/cordova-plugin-oracle-idm-auth" rel="noopener ugc nofollow" target="_blank">Cordova-plugin-Oracle-IDM-auth</a>Cordova插件，支持基本认证、OAUTH、Web SSO和OpenID Connect认证方法。</p><p id="127e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这篇文章中，我将演示如何在Oracle JavaScript Extension Toolkit(JET)混合移动应用程序中使用这个插件实现基本身份验证。您将能够在任何基于Cordova的应用程序中使用类似的JavaScript代码。</p><p id="0922" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了测试这个实现，您需要访问受基本身份验证保护的服务器资源。您可以通过在浏览器中输入资源的URL并验证是否提示您输入凭据来确认这是否正常工作。</p><p id="dd78" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们从搭建一个空白的JET应用程序开始。通常情况下，你的应用会基于一个更复杂的模板，如“navdrawer ”,但我们将使用默认的“空白”模板来保持简单:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="545f" class="jm jn hh ji b fi jo jp l jq jr">$ ojet create BasicAuthSample --hybrid</span></pre><p id="5c12" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">根据您在开发环境中安装的内容选择合适的移动平台，当应用程序搭建完成后，更改目录并添加插件:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="eb7d" class="jm jn hh ji b fi jo jp l jq jr">$ cd BasicAuthSample<br/>$ ojet add plugin cordova-plugin-oracle-idm-auth</span></pre><p id="f154" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，在您最喜欢的IDE中打开生成的源代码。</p><p id="528a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">此时，如果您打算部署到iOS设备，您必须确保您的应用程序的捆绑ID与您打算使用的任何预置描述文件相匹配。为此，编辑hybrid/config.xml第二行中的<em class="js"> id </em>属性。您还必须创建一个构建配置文件，如这里的<a class="ae jc" href="https://docs.oracle.com/middleware/jet410/jet/developer/GUID-DBA8BB97-1989-45B0-8C86-4897D5F302A9.htm#JETDG-GUID-102C9964-6293-446F-87FE-58480AF697C2" rel="noopener ugc nofollow" target="_blank">所述</a>。</p><p id="6f60" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，我们将创建一个简单的登录表单，它具有一些额外的特性，有助于说明正在发生的事情。将以下代码添加到src/index.html的<code class="du jt ju jv ji b">&lt;body&gt; </code>中:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="135e" class="jm jn hh ji b fi jo jp l jq jr">&lt;div id="mainContent" class="oj-hybrid-applayout-page"&gt;<br/>   &lt;div class="oj-applayout-content"&gt;<br/>     &lt;div role="main" class="oj-hybrid-applayout-content"&gt;<br/>       &lt;div class="oj-hybrid-padding"&gt;<br/>         &lt;div id="login-form" class="oj-form" style="margin-top:50px"&gt;<br/>           &lt;oj-label for="user" show-required&gt;Username&lt;/oj-label&gt;<br/>           &lt;oj-input-text id="user" required value="{{userName}}"&gt;&lt;/oj-input-text&gt;<br/>           &lt;oj-label for="pass" show-required&gt;Password&lt;/oj-label&gt;<br/>           &lt;oj-input-password id="pass" required value="{{password}}"&gt;&lt;/oj-input-password&gt;<br/>           &lt;div&gt;<br/>             &lt;oj-button id='loginBtn' disabled="[[loginBtnDisabled]]" on-click="[[login]]"&gt;Login&lt;/oj-button&gt;<br/>             &lt;oj-button id='logoutBtn' disabled="[[logoutBtnDisabled]]" on-click="[[logout]]"&gt;Logout&lt;/oj-button&gt;<br/>             &lt;oj-button id='accessBtn' disabled="[[logoutBtnDisabled]]" on-click="[[accessResource]]"&gt;Access&lt;/oj-button&gt;<br/>           &lt;/div&gt;<br/>           &lt;div&gt;<br/>             &lt;span data-bind="text: messages"&gt;&lt;/span&gt;<br/>           &lt;/div&gt;<br/>         &lt;/div&gt;<br/>       &lt;/div&gt;<br/>     &lt;/div&gt;<br/>   &lt;/div&gt;<br/> &lt;/div&gt;</span></pre><p id="5167" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，我们将通过以下方式在这些UI组件后面添加一些JavaScript:</p><ol class=""><li id="fdd2" class="jw jx hh ig b ih ii il im ip jy it jz ix ka jb kb kc kd ke bi translated">定义所需的喷射组件</li><li id="7bd8" class="jw jx hh ig b ih kf il kg ip kh it ki ix kj jb kb kc kd ke bi translated">添加视图模型</li><li id="85da" class="jw jx hh ig b ih kf il kg ip kh it ki ix kj jb kb kc kd ke bi translated">通过挖空将视图模型绑定到页面。</li></ol><p id="bb82" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">修改src/js/main.js中的“require”块，如下所示:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="ef03" class="jm jn hh ji b fi jo jp l jq jr">require(['ojs/ojcore', 'knockout', 'jquery', 'ojs/ojknockout', 'ojs/ojinputtext', 'ojs/ojlabel', 'ojs/ojbutton'],<br/>   function (oj, ko, $) {<br/>     $(function () {<br/>       function init() {<br/>         ko.applyBindings(new BasicAuthViewModel(), document.getElementById("mainContent"));<br/>       }</span><span id="f240" class="jm jn hh ji b fi kk jp l jq jr">function BasicAuthViewModel() {<br/>         var self = this;<br/>         self.userName = ko.observable();<br/>         self.password = ko.observable();<br/>         self.messages = ko.observable();<br/>         self.loginBtnDisabled = ko.observable(true);<br/>         self.logoutBtnDisabled = ko.observable(true);<br/>         self.login = function() {}<br/>         self.logout = function() {}<br/>         self.accessResource = function() {}<br/>       }</span><span id="e4b7" class="jm jn hh ji b fi kk jp l jq jr">// If running in a hybrid (e.g. Cordova) environment, we need to wait for the deviceready<br/>       // event before executing any code that might interact with Cordova APIs or plugins.<br/>       if ($(document.body).hasClass('oj-hybrid')) {<br/>         document.addEventListener('deviceready', init);<br/>       } else {<br/>         init();<br/>       }<br/>     });<br/>   }<br/> );</span></pre><p id="baba" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">此时，您可以通过使用ojet命令行将应用程序提供给连接的Android设备来测试这个简单的表单:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="3c69" class="jm jn hh ji b fi jo jp l jq jr">ojet serve android --device</span></pre><p id="eacc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你更喜欢Android模拟器，使用<code class="du jt ju jv ji b">--no-livereload</code>选项来避免CORS拒绝的可能性。为了服务于一个iOS模拟器，你需要启用密钥链访问，如这里的<a class="ae jc" href="https://developer.apple.com/library/content/documentation/IDEs/Conceptual/AppDistributionGuide/AddingCapabilities/AddingCapabilities.html" rel="noopener ugc nofollow" target="_blank">所述</a>。当服务于iOS设备时，您必须使用<code class="du jt ju jv ji b">--build-config</code>选项指定您之前创建的构建配置文件的位置。</p><p id="2bf9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在是时候添加基本的身份验证逻辑了，方法是:</p><ol class=""><li id="7429" class="jw jx hh ig b ih ii il im ip jy it jz ix ka jb kb kc kd ke bi translated">构建身份验证流属性</li><li id="fc2b" class="jw jx hh ig b ih kf il kg ip kh it ki ix kj jb kb kc kd ke bi translated">定义一些回调</li><li id="8082" class="jw jx hh ig b ih kf il kg ip kh it ki ix kj jb kb kc kd ke bi translated">初始化登录流程</li></ol><p id="c8ab" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将以下代码添加到src/js/main.js中的BasicAuthViewModel:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="55aa" class="jm jn hh ji b fi jo jp l jq jr">var authProps = cordova.plugins.IdmAuthFlows.newHttpBasicAuthPropertiesBuilder('appName', LOGIN_URL, LOGOUT_URL).offlineAuthAllowed(true).build();</span><span id="14a8" class="jm jn hh ji b fi kk jp l jq jr">var initiateLogin = function() {<br/>   // Initiate the login process<br/>   self.basicAuthFlow.login(challengeHandler).then(loginSuccess).catch(loginFailure);<br/> };</span><span id="6c8f" class="jm jn hh ji b fi kk jp l jq jr">var challengeFields, challengeProceedHandler;<br/> var challengeHandler = function(fields, proceed) {<br/>   challengeFields = fields;<br/>   challengeProceedHandler = proceed;<br/>   var err = fields[cordova.plugins.IdmAuthFlows.AuthChallenge.Error];<br/>   if (err) {<br/>     // Login failure that allows retry<br/>     self.messages('User login failure: ' + err[cordova.plugins.IdmAuthFlows.Error.ErrorCode] + '. Try again.');<br/>   }<br/>   self.loginBtnDisabled(false);<br/> };</span><span id="832e" class="jm jn hh ji b fi kk jp l jq jr">var loginSuccess = function() {<br/>   self.messages('User logged in successfully.');<br/>   self.logoutBtnDisabled(false);<br/>   self.loginBtnDisabled(true);<br/> };</span><span id="531b" class="jm jn hh ji b fi kk jp l jq jr">var loginFailure = function(err) {</span><span id="f570" class="jm jn hh ji b fi kk jp l jq jr">if (err[cordova.plugins.IdmAuthFlows.Error.ErrorSource] == cordova.plugins.IdmAuthFlows.ErrorSources.Plugin) {<br/>     // No further retries are possible at this stage.  Re-initiate login to keep the demo running.<br/>     self.messages('Login error: ' + err[cordova.plugins.IdmAuthFlows.Error.ErrorCode] + '. Restarting login...');<br/>     initiateLogin();</span><span id="53ec" class="jm jn hh ji b fi kk jp l jq jr">} else {</span><span id="7bc9" class="jm jn hh ji b fi kk jp l jq jr">self.messages('System error: ' + err[cordova.plugins.IdmAuthFlows.Error.TranslatedErrorMessage]);</span><span id="4ed5" class="jm jn hh ji b fi kk jp l jq jr">}<br/> };</span><span id="5b1a" class="jm jn hh ji b fi kk jp l jq jr">cordova.plugins.IdmAuthFlows.init(authProps).then(function(flow) {<br/>   self.messages('Authentication flow initialized.  Please enter credentials to login.');<br/>   self.basicAuthFlow = flow;<br/>   initiateLogin();<br/> }).catch(function(err) {<br/>   // Handle errors during init<br/>   self.messages('Error while initializing authentication flow: ' + err[cordova.plugins.IdmAuthFlows.Error.ErrorCode]);<br/> });</span></pre><p id="4e98" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在构建流属性时，必须指定基本身份验证服务器的LOGIN_URL和LOGOUT_URL。请注意，有必要将流的<em class="js"> offlineAuthAllowed </em>属性设置为true，以便能够检索将包含在后续REST web服务调用中的头。</p><p id="5864" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，向我们之前在src/js/main.js中创建的三个空函数添加一些逻辑:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="6f7f" class="jm jn hh ji b fi jo jp l jq jr">self.login = function() {<br/>   challengeFields[cordova.plugins.IdmAuthFlows.AuthChallenge.UserName] = self.userName();<br/>   challengeFields[cordova.plugins.IdmAuthFlows.AuthChallenge.Password] = self.password();<br/>   challengeProceedHandler(challengeFields);<br/>   self.messages('User credentials submitted for login...');<br/> };</span><span id="6163" class="jm jn hh ji b fi kk jp l jq jr">self.logout = function() {<br/>   self.basicAuthFlow.logout().then(function() {<br/>     self.messages('Logout success.');<br/>     self.logoutBtnDisabled(true);<br/>     self.loginBtnDisabled(false);<br/>     initiateLogin();<br/>   }).catch(function() {<br/>   self.messages('Error while logging out.');<br/>   });<br/> };</span><span id="ad0c" class="jm jn hh ji b fi kk jp l jq jr">self.accessResource = function() {<br/>   self.basicAuthFlow.getHeaders().then(function(headers) {<br/>     self.messages('Accessing secured resource with headers: ' + JSON.stringify(headers));<br/>     var request = new XMLHttpRequest();<br/>     request.open('GET', SECURED_RESOURCE_URL);<br/>     for (var key in headers) {<br/>       if (headers.hasOwnProperty(key)) {<br/>         request.setRequestHeader(key, headers[key]);<br/>       }<br/>     }<br/>     request.onload = function() {<br/>       if (request.readyState == 4) {<br/>         self.messages('Result: ' + request.response);<br/>       }<br/>     };<br/>     request.send();<br/>   }).catch(function(err) {<br/>     self.messages('Error while getting headers: ' + err[cordova.plugins.IdmAuthFlows.Error.ErrorCode]);<br/>   });<br/> };</span></pre><p id="1e63" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在构建请求时，必须指定受保护资源的SECURED_RESOURCE_URL。</p><p id="7546" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过<code class="du jt ju jv ji b">ojet serve</code>重新部署应该会产生一个正常运行的应用程序，使用户能够通过基本身份验证登录来访问您的安全资源。</p><p id="b36b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">应用程序的当前状态显示在页面底部，包括错误代码。由应用程序开发人员提供错误代码的(翻译的)字符串，这在<a class="ae jc" href="https://github.com/oracle/cordova-plugin-oracle-idm-auth/blob/master/docs/error-codes.md" rel="noopener ugc nofollow" target="_blank">插件文档</a>中有描述。</p><p id="0681" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">成功登录后，点击<em class="js">访问</em>按钮应显示成功响应，应用程序已使用基本认证访问安全资源。</p><p id="5e3a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我希望这篇博文有助于理解使用<a class="ae jc" href="https://github.com/oracle/cordova-plugin-oracle-idm-auth" rel="noopener ugc nofollow" target="_blank">Cordova-plugin-Oracle-IDM-auth</a>插件实现基本认证。请继续关注将来描述如何使用该插件实现WebSSO、OAuth和OpenID Connect的帖子。</p><p id="8c38" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">非常感谢插件的首席开发人员Anand Nath在这篇文章中对技术细节的帮助。</p></div></div>    
</body>
</html>