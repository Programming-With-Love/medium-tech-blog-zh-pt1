<html>
<head>
<title>Resilient Web Application in the real world</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">现实世界中的弹性Web应用程序</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/resilient-web-application-in-the-real-world-2a2d2ca0922a?source=collection_archive---------3-----------------------#2020-03-24">https://medium.com/walmartglobaltech/resilient-web-application-in-the-real-world-2a2d2ca0922a?source=collection_archive---------3-----------------------#2020-03-24</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="22d0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jc">“没有什么是完全可靠的。任何事情都有失败的时候！”</em></p><p id="3246" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这篇博客中，我将谈论<em class="jc">需要做什么</em>来使你的面向客户的网络应用<strong class="ig hi"> <em class="jc">有弹性</em> </strong>。这些都是基于我为世界顶级零售商构建高度可伸缩的电子商务应用程序的经验。</p><p id="7ad7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jc">弹性</em>是系统以可接受的方式继续服务于传入请求的能力，即使它的一个或多个组件或依赖系统不起作用。</p><p id="0b43" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在一个微服务的世界里，仅仅因为其中一个微服务出现故障，就很容易遇到级联故障。此外，随着公共云的出现，您对资源的控制越来越少，失败比平常更常见。例如，假设<em class="jc">服务A </em>依赖于<em class="jc">服务B </em>而<em class="jc">服务B </em>依赖于<em class="jc">服务C </em>。如果<em class="jc">服务C </em>出现故障，则<em class="jc">服务A </em>和<em class="jc">服务B </em>均不可用。因此，为您的微服务设计弹性变得非常重要。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/8d11c46c6cf44cd05069fcd1b71bbd65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sykf6OdWkG0jmdcTqmkxTA.png"/></div></div></figure><p id="3233" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">弹性设计应该与应用程序设计一起完成，而不应该是事后的想法。在此阶段，与您的依赖团队、DevOps团队和企业架构师密切合作。</p><p id="861e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">弹性应该在三个层次上设计:</p><ol class=""><li id="5b59" class="jp jq hh ig b ih ii il im ip jr it js ix jt jb ju jv jw jx bi translated">基础设施:</li></ol><p id="d264" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">设计在多个区域部署服务器:<br/> <em class="jc">这有助于确保即使一个区域出现故障，您也能够提供流量服务。例如，在EastUS、CentralUS和WestUS地区设立办事处会有所帮助。您可以利用公共云来构建这种设置。</em></p><p id="6b7f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在区域内设计一套备份服务器:<br/> <em class="jc">除了在多个区域部署服务器之外，计划在区域内部署多台服务器。这确保了在少数服务器出现故障的情况下，您不会将流量一直发送到一个遥远的区域。例如，每个地区有两个Kubernetes集群就很好。</em></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jy"><img src="../Images/fa70aa430aed5f5a12de4835ebb4a848.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jrUF99PW_3AD1egsaWW3yQ.png"/></div></div></figure><p id="8b79" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">确保每个资源都是分布式的:<br/> <em class="jc">无论是数据库、缓存、负载平衡器还是KeyVault，都要确保请求处理中的每个资源都基于冗余架构。</em></p><p id="79b9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">尽可能激活自动扩展:<br/> <em class="jc">大多数云提供商在服务器、数据库等方面提供自动扩展功能。启用这些功能，这样您的应用程序就可以在没有手动干预的情况下处理激增的负载。</em></p><p id="7398" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.<strong class="ig hi">应用</strong>:</p><p id="075a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">无状态微服务:<br/> <em class="jc">使用</em> <strong class="ig hi"> <em class="jc">无状态</em> </strong> <em class="jc">微服务，每个请求可以发送到任何健康的服务器实例，从而保护应用程序免受实例重启和故障的影响。</em></p><p id="d725" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有备用资源:看看你是否能使用备用资源满足请求。如果数据库没有响应，应用程序可以使用缓存服务请求吗？如果您不能调用某个服务，是否可以将它发送到消息队列中，稍后再进行处理？</p><p id="2331" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">健康探测器:<br/> <em class="jc">配置一个深度健康探测器，用于检查所有必须依赖的组件。例如，健康探测应该触及应用程序的服务端点，该端点与数据库和高度依赖的服务进行交互。</em></p><p id="1d39" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3.<strong class="ig hi">军种间通信</strong>:</p><p id="3fb0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">超时:<br/> <em class="jc">确保在您拨打服务电话时配置了适当的超时。应该仔细选择超时值，因为太小的值可能导致太多的超时，太高的值可能导致等待浪费时间。</em></p><p id="4043" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">重试次数:<br/> <em class="jc">确保进行重试，因为您拨打的服务电话可能会因网络故障而失败。但是也不要重试太多次。对超时时间长的服务重试多次会使您的服务非常慢。在实现重试时，确保您调用的服务是等幂的。</em></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jz"><img src="../Images/9faf72f74995eb1571a2a1a00ccf7d98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VY93QsRgC1G1YC8r1WrQoQ.png"/></div></div></figure><p id="aeb2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">回退:<br/> <em class="jc">确保在服务调用失败或超时时定义回退。这些回退可以是从缓存中取值、选择默认值或内部逻辑来计算近似值。</em></p><p id="821f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">避免:<br/> <em class="jc">避免服务呼叫失败的最佳方法是避免服务呼叫。看看是否可以利用缓存，是否可以重用以前调用的值，等等。确保设置TTL，以避免陈旧数据造成的影响。如果相关服务知道下一次更新的计划时间，这些TTL值可以由它们提供，或者您可以根据您对数据易变率的了解来选择它。</em></p><p id="59ba" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">设计模式和工具:<br/> <em class="jc">实现电路断路器、隔板等设计模式，使用Resilience4J等工具或服务网格的弹性特性实现超时、重试、回退和连接池。</em></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ka"><img src="../Images/40581af9444ae1b124b1d4c5bdd66e88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hAPyIRI3JbJbwShusawcNw.png"/></div></div></figure><p id="7f04" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">测试你的弹性</strong></p><p id="0075" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用在线弹性工具测试你的弹性设计。您可以将此作为部署管道的一部分，或者通过进行测试和监控应用程序可用性的演练来完成。</p><p id="2a12" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，在大多数情况下，设计弹性是一个迭代过程。在生产中监控您的应用程序，并调整配置，如重试、超时、缓存TTLs等，直到您认为它是最佳的。</p><p id="7af6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这篇文章中，我主要讨论了让你的应用程序具有弹性需要“做什么”。如果你有兴趣知道“如何”去做，请写下你的回答，我很乐意分享我的想法。</p></div></div>    
</body>
</html>