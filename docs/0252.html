<html>
<head>
<title>#SmallerAPK, Part 6: Image optimization, Zopfli &amp; WebP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">#SmallerAPK，第6部分:图像优化，Zopfli &amp; WebP</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/smallerapk-part-6-image-optimization-zopfli-webp-4c462955647d?source=collection_archive---------6-----------------------#2016-02-19">https://medium.com/androiddevelopers/smallerapk-part-6-image-optimization-zopfli-webp-4c462955647d?source=collection_archive---------6-----------------------#2016-02-19</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/16742a27007b85054b45771a39fbd376.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6OvLVi-G5Ldze7Novm7M0w.jpeg"/></div></div></figure><div class=""/><p id="5ba0" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">每个app在某个点上必然包含图片资源，哪怕只是几个图标。图像对应用程序大小的贡献有两种方式。首先，我们在APK把它们包装成资源和资产。其次，应用程序在运行时从服务器下载图像，并通常为这些图像保留一个磁盘缓存，以便更快地访问。请记住，我在这一章中提到的任何优化也可以应用在服务器端，为您节省设备上的磁盘空间和网络带宽。</p><p id="76a0" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">首先，一些基础知识。两种最流行的图像压缩格式是JPEG和PNG。何时使用的快速提醒:</p><p id="6170" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht"> JPEG </strong> —照片、背景。不支持透明。大小和质量随选择的压缩级别而变化很大，所以如果你坚持使用JPEG，尝试用它来降低文件大小。</p><p id="50c1" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht"> PNG </strong> —标志、图形、图标、艺术线条；基本上任何有鲜明边缘和对比的东西。支持透明。具有大面积连续颜色的图像压缩效果较好，渐变和摄影图像往往会生成较大的文件。</p><h1 id="2de9" class="jn jo hs bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">WebP</h1><p id="a31e" class="pw-post-body-paragraph ip iq hs ir b is kl iu iv iw km iy iz ja kn jc jd je ko jg jh ji kp jk jl jm ha bi translated">还有一种你可能想为你的Android应用考虑的格式，那就是<a class="ae kq" href="https://developers.google.com/speed/webp/" rel="noopener ugc nofollow" target="_blank"> WebP </a>(发音为“weppy”)。它倾向于产生更小(平均30%)的文件大小，适合在您的应用程序中替换JPEG和PNG，因为它可以处理各种图像数据。</p><p id="dd6b" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">当然，也有一些负面影响。Android 4.0+ 设备上<a class="ae kq" href="http://developer.android.com/guide/appendix/media-formats.html#core" rel="noopener ugc nofollow" target="_blank">保证有损WebP支持(适合替换大部分JPEGs和部分png)。从Android 4.2.1+ </a>开始支持更新的WebP特性(透明、无损、适合png)。</p><blockquote class="kr ks kt"><p id="1524" class="ip iq ku ir b is it iu iv iw ix iy iz kv jb jc jd kw jf jg jh kx jj jk jl jm ha bi translated"><strong class="ir ht">注意</strong> : WebP图像在运行时解压缩也需要更多的CPU处理能力，这可能意味着加载时间稍长。</p><p id="6ffe" class="ip iq ku ir b is it iu iv iw ix iy iz kv jb jc jd kw jf jg jh kx jj jk jl jm ha bi translated"><strong class="ir ht">注2 </strong>:您不能将WebP用于应用程序启动器图标。</p></blockquote><h1 id="8b7c" class="jn jo hs bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">Zopfli压缩的PNGs</h1><p id="194f" class="pw-post-body-paragraph ip iq hs ir b is kl iu iv iw km iy iz ja kn jc jd je ko jg jh ji kp jk jl jm ha bi translated">如果您还没有准备好采用WebP，那么在优化png时，您可能还想探索另一条途径。作为Android构建系统的一部分，cruncher已经做了一些常见的优化，如丢弃图像中的元数据，尽可能将调色板转换为8位，但如果我们用Zopfli预优化png，我们可以做得更好。</p><p id="d4bf" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Zopfli是谷歌的工程师创造的一种压缩算法。它兼容流行的用于压缩ZIP文件的DEFLATE规范，以及…你猜对了，PNGs中的图像数据流！</p><p id="d89a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Zopfli压缩数据可以通过标准的ZIP(或PNG)阅读器读取，因此不需要修改代码。你可以使用一些现有的工具(AdvPNG，<a class="ae kq" href="https://github.com/google/zopfli" rel="noopener ugc nofollow" target="_blank"> ZopfliPNG </a>)来帮助你<em class="ku"> zopflify </em>构建之前的图像(你只需要为每个图像文件做一次)。</p><p id="2afe" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">不幸的是，目前Android工具还没有自动支持这种优化。此外，<strong class="ir ht">在2.2 </strong>之前的Android Gradle插件版本上，您必须通过在您的版本中添加以下代码行来禁用内置的图像处理器。</p><h2 id="f6db" class="ky jo hs bd jp kz la lb jt lc ld le jx ja lf lg kb je lh li kf ji lj lk kj ll bi translated">build.gradle</h2><pre class="lm ln lo lp fd lq lr ls lt aw lu bi"><span id="1c74" class="ky jo hs lr b fi lv lw l lx ly">android {<br/>    ...<br/>    aaptOptions {<br/>        cruncherEnabled = false<br/>    }<br/>}</span></pre><p id="f4c3" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这是必要的，因为AAPT工具不会检查它生成的文件是否小于源文件，这可能会抵消zopfli优化图像节省的一些空间。</p><blockquote class="kr ks kt"><p id="8609" class="ip iq ku ir b is it iu iv iw ix iy iz kv jb jc jd kw jf jg jh kx jj jk jl jm ha bi translated">注意:cruncher仍然会处理9补丁映像，因为它们在构建时需要特殊处理</p></blockquote></div><div class="ab cl lz ma go mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ha hb hc hd he"><p id="0fe9" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">将你的图标缩小到第七部分的一小部分:图像优化，形状和矢量图</p></div></div>    
</body>
</html>