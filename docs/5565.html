<html>
<head>
<title>Invoke Oracle Functions via REST</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过REST调用Oracle函数</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/invoke-oracle-functions-via-rest-6fa8b257e262?source=collection_archive---------0-----------------------#2019-02-08">https://medium.com/oracledevs/invoke-oracle-functions-via-rest-6fa8b257e262?source=collection_archive---------0-----------------------#2019-02-08</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/5af5acf65c2cad3824158e961265b274.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NZU1cYdL78ZO9kGI6y2_uQ.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Green Line (Image © Ralf Mueller)</figcaption></figure><p id="ca05" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">这篇文章涵盖了通过<a class="ae jr" href="https://docs.cloud.oracle.com/iaas/Content/API/Concepts/signingrequests.htm#Bash" rel="noopener ugc nofollow" target="_blank"> oci-curl </a>调用部署在Oracle Functions上的函数，oci-curl 是Oracle云基础设施(oci)提供的bash脚本，它支持OCI RESTful服务的请求签名。</p><blockquote class="js jt ju"><p id="14da" class="it iu jv iv b iw ix iy iz ja jb jc jd jw jf jg jh jx jj jk jl jy jn jo jp jq ha bi translated">在撰写本文时，Oracle Functions的可用性有限，尚未发布。因此，在UI屏幕截图下方，fn CLI命令和函数API仍会发生变化。</p></blockquote><h1 id="2400" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">设置</h1><p id="9fad" class="pw-post-body-paragraph it iu hh iv b iw kx iy iz ja ky jc jd je kz jg jh ji la jk jl jm lb jo jp jq ha bi lc translated"><span class="l ld le lf bm lg lh li lj lk di"> L </span> ets从部署到Oracle函数的一个简单函数开始。<a class="ae jr" href="https://blogs.oracle.com/developers/announcing-oracle-functions-v2" rel="noopener ugc nofollow" target="_blank">甲骨文功能</a>在西雅图<a class="ae jr" href="https://events.linuxfoundation.org/events/kubecon-cloudnativecon-north-america-2018/" rel="noopener ugc nofollow" target="_blank"> KubeCon 2018 </a>大会上公布。下面的屏幕截图显示了部署到Oracle Functions的应用程序</p><figure class="lm ln lo lp fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ll"><img src="../Images/4539d9a977f0bc9f7dd0dbe70115f540.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gMoUZxY_0x9lW4NnabjyiQ.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">ccs_weather_app Application in Oracle Functions console</figcaption></figure><p id="b2ef" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">以及为该应用程序部署的一个功能</p><figure class="lm ln lo lp fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lq"><img src="../Images/452863c4ba9ac5a5fd141fb848c5ebf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-06R2RpBgJeD99pHodDRmQ.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">ccs_weather_gmail Function</figcaption></figure><p id="67ef" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">通过<strong class="iv hi"> fn </strong>命令行调用该函数很容易，如下所示</p><pre class="lm ln lo lp fd lr ls lt lu aw lv bi"><span id="ceff" class="lw ka hh ls b fi lx ly l lz ma">&gt; cat payload.json | fn invoke ccs_weather_app ccs_weather_gmail</span></pre><p id="c6be" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">其中函数的输入负载在文件payload.json中给出</p><h1 id="46fa" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">经由OCI旋度的休止调用</h1><h2 id="cf82" class="lw ka hh bd kb mb mc md kf me mf mg kj je mh mi kn ji mj mk kr jm ml mm kv mn bi translated">检查功能</h2><p id="07e5" class="pw-post-body-paragraph it iu hh iv b iw kx iy iz ja ky jc jd je kz jg jh ji la jk jl jm lb jo jp jq ha bi translated">那么，如果我们想通过其公开的REST端点来调用这个函数呢？首先，我们可以检查函数以获得更多的细节</p><pre class="lm ln lo lp fd lr ls lt lu aw lv bi"><span id="7a81" class="lw ka hh ls b fi lx ly l lz ma">&gt; fn inspect f ccs_weather_app ccs_weather_gmail</span></pre><p id="fc24" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">这可能会返回类似这样的结果(下面显示的OCID是无效的，所以尝试一下没有意义，它不会工作)</p><figure class="lm ln lo lp fd ii"><div class="bz dy l di"><div class="mo mp l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Result of fn inspect</figcaption></figure><p id="6392" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">这里重要的信息是注释<strong class="iv hi">fnproject.io/fn/invokeEndpoint</strong>，它表示REST调用的目标URL。</p><h2 id="1ba7" class="lw ka hh bd kb mb mc md kf me mf mg kj je mh mi kn ji mj mk kr jm ml mm kv mn bi translated">列出触发器</h2><p id="d840" class="pw-post-body-paragraph it iu hh iv b iw kx iy iz ja ky jc jd je kz jg jh ji la jk jl jm lb jo jp jq ha bi translated">每个函数都公开一个或多个触发器。在撰写本文时，HTTP触发器可以在函数初始化时创建。函数的触发器显示在函数控制台中，如上图所示。也可以使用以下命令从fn CLI中检索</p><pre class="lm ln lo lp fd lr ls lt lu aw lv bi"><span id="8dd2" class="lw ka hh ls b fi lx ly l lz ma">fn list t ccs_weather_app ccs_weather_gmail</span></pre><p id="804a" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">在我们的示例中，它打印出类似于</p><pre class="lm ln lo lp fd lr ls lt lu aw lv bi"><span id="ca3b" class="lw ka hh ls b fi lx ly l lz ma">NAME    ID      TYPE        SOURCE                       ENDPOINT</span><span id="ace8" class="lw ka hh ls b fi mq ly l lz ma">ccs_weather_gmail-trigger ocid1.fntrig.oc1.phx.XXXwqovtgjwgxpktsfbdq http /ccs_weather_gmail-trigger https://bo6ce5xeefq.us-phoenix-1.functions.oci.oraclecloud.com/t/ccs_weather_gmail-trigger</span></pre><p id="7ff4" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">两个端点，即所谓的<em class="jv">调用端点</em>和<em class="jv"> HTTP </em> <em class="jv">触发器</em>的端点都可以用于REST调用，如下一章所示。请注意，在Oracle Functions的未来版本中，将会添加其他类型的触发器(HTTP除外)。理解这一点很重要，只有HTTP类型的触发器端点可以通过REST调用。</p><h2 id="4f3c" class="lw ka hh bd kb mb mc md kf me mf mg kj je mh mi kn ji mj mk kr jm ml mm kv mn bi translated">设置oci-curl</h2><p id="b4cc" class="pw-post-body-paragraph it iu hh iv b iw kx iy iz ja ky jc jd je kz jg jh ji la jk jl jm lb jo jp jq ha bi translated">bash实用程序oci-curl可以从<a class="ae jr" href="https://docs.cloud.oracle.com/iaas/Content/Resources/Assets/signing_sample_bash.txt" rel="noopener ugc nofollow" target="_blank">https://docs . cloud . Oracle . com/iaas/Content/Resources/Assets/signing _ sample _ bash . txt</a>下载</p><p id="876a" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">它是一个bash脚本，用于基于Unix的系统，其他脚本用PowerShell、perl、Python等实现。也可从<a class="ae jr" href="https://docs.cloud.oracle.com/iaas/Content/API/Concepts/signingrequests.htm" rel="noopener ugc nofollow" target="_blank">请求签名</a>文档中获得。</p><p id="7278" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi lc translated"><span class="l ld le lf bm lg lh li lj lk di"> U </span>用户应该在他们想要使用oci-curl的终端中获取脚本，如下所示</p><pre class="lm ln lo lp fd lr ls lt lu aw lv bi"><span id="0268" class="lw ka hh ls b fi lx ly l lz ma">&gt; source oci-curl</span></pre><p id="3a6e" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">然而，我认为将脚本添加到路径中并使其可执行要简单得多。为此，请添加以下行作为脚本的第一行</p><pre class="lm ln lo lp fd lr ls lt lu aw lv bi"><span id="f835" class="lw ka hh ls b fi lx ly l lz ma">#!/bin/bash</span></pre><p id="6fd2" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">然后在脚本的最后一行添加下面一行</p><pre class="lm ln lo lp fd lr ls lt lu aw lv bi"><span id="0365" class="lw ka hh ls b fi lx ly l lz ma">oci-curl $1 $2 $3 $4</span></pre><p id="35f0" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">脚本本身必须针对用户租用进行修改和调整。必须根据您的用户和租户在脚本中设置以下四个变量</p><pre class="lm ln lo lp fd lr ls lt lu aw lv bi"><span id="0026" class="lw ka hh ls b fi lx ly l lz ma">local tenancyId="ocid1.tenancy.oc1..XX55gth7ioc2gbpbvqo5ecoa";<br/>local authUserId="ocid1.user.oc1..XXXX53zsuna775rdcnxcaxxhsddu6ha";<br/>local keyFingerprint="76:..:3b:10:57";<br/>local privateKeyPath="/Users/someuser/.oci/oci_api_key.pem";</span></pre><p id="861d" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">可以从OCI控制台检索关于tenancyId、authUserId、keyFingerprint的信息。有关用户凭证、指纹等的更多信息。您可能需要检查以下文档</p><ul class=""><li id="15b0" class="mr ms hh iv b iw ix ja jb je mt ji mu jm mv jq mw mx my mz bi translated"><a class="ae jr" href="https://docs.cloud.oracle.com/iaas/Content/API/Concepts/apisigningkey.htmhttps://docs.cloud.oracle.com/iaas/Content/API/Concepts/apisigningkey.htm" rel="noopener ugc nofollow" target="_blank">所需的密钥和ocid</a></li><li id="5aa8" class="mr ms hh iv b iw na ja nb je nc ji nd jm ne jq mw mx my mz bi translated"><a class="ae jr" href="https://docs.cloud.oracle.com/iaas/Content/API/Concepts/sdkconfig.htm" rel="noopener ugc nofollow" target="_blank"> SDK和CLI配置文件</a></li></ul><h1 id="541e" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">Oracle函数REST端点的调用</h1><p id="10d4" class="pw-post-body-paragraph it iu hh iv b iw kx iy iz ja ky jc jd je kz jg jh ji la jk jl jm lb jo jp jq ha bi translated">现在oci-curl脚本已经针对您的用户和租户进行了调整，您可以通过调用Oracle函数<em class="jv">调用端点</em></p><pre class="lm ln lo lp fd lr ls lt lu aw lv bi"><span id="d7c8" class="lw ka hh ls b fi lx ly l lz ma">&gt; oci-curl XXXXXX.us-phoenix-1.functions.oci.oraclecloud.com \<br/>           post ./payload.json \ "<a class="ae jr" href="https://bo6ce5xeefq.us-phoenix-1.functions.oci.oraclecloud.com/invoke/ocid1.fnfunc.oc1.phx.aaaaaaaaaajw2n6c2fbjfix3k5xyhrtu7kn2tjmkzrvjg3ibyfbkpnhey7lq" rel="noopener ugc nofollow" target="_blank">/invoke/ocid1.fnfunc.oc1.phx.aaaaaaaaXXXXXXXXXXXXXXn2tjmkzrvjg3ibyfbkpnhey7lq</a>"</span></pre><p id="bd00" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">其中payload.json包含函数的输入。</p><p id="b4ef" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">作为替代，您可以通过函数的<em class="jv"> HTTP触发端点</em>来调用函数</p><pre class="lm ln lo lp fd lr ls lt lu aw lv bi"><span id="668c" class="lw ka hh ls b fi lx ly l lz ma">&gt; oci-curl XXXXXX.us-phoenix-1.functions.oci.oraclecloud.com \<br/>           post ./payload.json \<br/>           "/t/ccs_weather_gmail-trigger"</span></pre><p id="9570" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">小文章到此结束，感谢一路看完。我可能会更新这篇文章，举例说明如何从Java调用Oracle函数，继续关注。</p></div></div>    
</body>
</html>