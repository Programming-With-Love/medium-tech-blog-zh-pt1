<html>
<head>
<title>Building a simple audio app in Android (Part 3/3)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Android中构建一个简单的音频应用程序(第3/3部分)</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/building-a-simple-audio-app-in-android-part-3-3-ead4a0e10673?source=collection_archive---------3-----------------------#2017-08-22">https://medium.com/androiddevelopers/building-a-simple-audio-app-in-android-part-3-3-ead4a0e10673?source=collection_archive---------3-----------------------#2017-08-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="caba" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">与搜索栏同步</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/1391c0629e8d0926ef82ca2f50204131.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DzqbZ6ZHIi5RXrJLmazy_A.png"/></div></div></figure><h1 id="0cf9" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">介绍</h1><p id="49f4" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">本系列文章的目标是通过创建一个名为“简单的MediaPlayer”的非常基本的音频播放应用程序，让您开始使用Android <code class="du kw kx ky kz b">MediaPlayer</code> API。这是3部分系列的最后一部分，包括:</p><ol class=""><li id="7c62" class="la lb hh kc b kd lc kg ld kj le kn lf kr lg kv lh li lj lk bi translated"><a class="ae ll" rel="noopener" href="/@nazmul/building-a-simple-audio-app-in-android-part-1-3-c14d1a66e0f1"> MediaPlayer简介</a></li><li id="c8dc" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lh li lj lk bi translated"><a class="ae ll" rel="noopener" href="/@nazmul/building-a-simple-audio-app-in-android-part-2-3-a514f6224b83">构建应用</a></li><li id="edcc" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lh li lj lk bi translated"><strong class="kc hi">与SeekBar </strong>同步(<em class="lr">本文</em>)</li></ol><h1 id="4c4d" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">第3/3部分—与搜索栏同步</h1><p id="295e" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">本文将涵盖以下内容:</p><ul class=""><li id="37e5" class="la lb hh kc b kd lc kg ld kj le kn lf kr lg kv ls li lj lk bi translated">如何用<code class="du kw kx ky kz b">SeekBar</code>同步音频播放位置和持续时间。</li><li id="7374" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv ls li lj lk bi translated">如何在播放过程中使用<code class="du kw kx ky kz b">SeekBar</code>跳转到音频中的不同时间位置。</li></ul><h1 id="6cf3" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">app长什么样，源代码在哪里？</h1><p id="c655" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">请查看<a class="ae ll" rel="noopener" href="/@nazmul/introduction-to-mediaplayer-part-2-3-a514f6224b83">系列的第2部分</a>以查看应用程序的运行情况，并在<a class="ae ll" href="https://github.com/googlesamples/android-SimpleMediaPlayer" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获取源代码。</p><div class="lt lu ez fb lv lw"><a href="https://github.com/googlesamples/android-SimpleMediaPlayer" rel="noopener  ugc nofollow" target="_blank"><div class="lx ab dw"><div class="ly ab lz cl cj ma"><h2 class="bd hi fi z dy mb ea eb mc ed ef hg bi translated">Google samples/Android-简单媒体播放器</h2><div class="md l"><h3 class="bd b fi z dy mb ea eb mc ed ef dx translated">在GitHub上创建一个帐户，为android-SimpleMediaPlayer开发做出贡献。</h3></div><div class="me l"><p class="bd b fp z dy mb ea eb mc ed ef dx translated">github.com</p></div></div><div class="mf l"><div class="mg l mh mi mj mf mk jg lw"/></div></div></a></div><h1 id="e41c" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">与搜索栏同步</h1><p id="797a" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">该应用的用户界面也有一个<code class="du kw kx ky kz b"><a class="ae ll" href="https://developer.android.com/reference/android/widget/SeekBar.html" rel="noopener ugc nofollow" target="_blank">SeekBar</a></code>。这做了两件事:</p><ol class=""><li id="8aa7" class="la lb hh kc b kd lc kg ld kj le kn lf kr lg kv lh li lj lk bi translated">它在媒体播放过程中向用户提供视觉反馈(通过在音频播放时向前移动<code class="du kw kx ky kz b">SeekBar</code>中的搓擦器)。</li><li id="8f0e" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lh li lj lk bi translated">允许用户通过触摸和拖动搓擦器跳到媒体中的任何特定时间位置。这最终会调用<code class="du kw kx ky kz b">MediaPlayer</code>中的<code class="du kw kx ky kz b">seekTo()</code>来改变其音频播放位置。</li></ol><h1 id="1034" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">1.Scrubber更新UI以反映播放位置— PlaybackInfoListener接口</h1><p id="382e" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">为了让<code class="du kw kx ky kz b"><a class="ae ll" href="https://github.com/googlesamples/android-SimpleMediaPlayer/blob/53fbbbafc9ab14d51041fc52ced2a6926484c274/app/src/main/java/com/example/android/mediaplayersample/MediaPlayerHolder.java" rel="noopener ugc nofollow" target="_blank">MediaPlayerHolder</a></code>向UI(在<code class="du kw kx ky kz b"><a class="ae ll" href="https://github.com/googlesamples/android-SimpleMediaPlayer/blob/53fbbbafc9ab14d51041fc52ced2a6926484c274/app/src/main/java/com/example/android/mediaplayersample/MainActivity.java" rel="noopener ugc nofollow" target="_blank">MainActivity</a></code>中)提供回放位置正在进行的更新，使用了<code class="du kw kx ky kz b"><a class="ae ll" href="https://github.com/googlesamples/android-SimpleMediaPlayer/blob/53fbbbafc9ab14d51041fc52ced2a6926484c274/app/src/main/java/com/example/android/mediaplayersample/PlaybackInfoListener.java" rel="noopener ugc nofollow" target="_blank">PlaybackInfoListener</a></code>接口。<code class="du kw kx ky kz b">MainActivity</code>实现这个回调。它允许<code class="du kw kx ky kz b">MediaPlayerHolder</code>和<code class="du kw kx ky kz b">MainActivity</code>去耦。</p><ol class=""><li id="ba98" class="la lb hh kc b kd lc kg ld kj le kn lf kr lg kv lh li lj lk bi translated"><code class="du kw kx ky kz b">MediaPlayerHolder</code>报告它的进度和持续时间，而不关心UI如何显示这些信息。</li><li id="5152" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lh li lj lk bi translated"><code class="du kw kx ky kz b">MediaPlayerHolder</code>还报告其当前状态(可以是<code class="du kw kx ky kz b">PLAYING</code>、<code class="du kw kx ky kz b">PAUSED</code>、<code class="du kw kx ky kz b">RESET</code>、<code class="du kw kx ky kz b">COMPLETED</code>)。</li><li id="7ea3" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lh li lj lk bi translated"><code class="du kw kx ky kz b">MainActivity</code>负责通过<code class="du kw kx ky kz b">SeekBar</code>在UI中显示持续时间和进度。</li></ol><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="ml mm l"/></div></figure><h1 id="ddce" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">1.1.设置搜索栏最大值以匹配播放持续时间</h1><p id="c796" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated"><code class="du kw kx ky kz b">SeekBar</code>用于显示沿水平线的数值范围。为了配置<code class="du kw kx ky kz b">SeekBar</code>(也就是<code class="du kw kx ky kz b">MainActivity</code>)，我们需要告诉它它的最大值应该是多少。在我们简单的应用程序中，我们将设置音轨持续时间的最大值，以毫秒为单位。在<code class="du kw kx ky kz b">MediaPlayer</code>被创建并且MP3文件被加载后，这在<code class="du kw kx ky kz b">MediaPlayerHolder</code>中发生如下。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="ml mm l"/></div></figure><h1 id="c8aa" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">1.2.随着音频回放的进行，提供视觉反馈</h1><p id="8f06" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">随着音频播放的进行，<code class="du kw kx ky kz b">SeekBar’s</code> <code class="du kw kx ky kz b">setProgress(time)</code>方法必须根据播放过程中经过的时间来调用。没有可以连接到<code class="du kw kx ky kz b">MediaPlayer</code>的监听器来获取这些信息，所以我们必须投票。有两种轮询策略——使用<code class="du kw kx ky kz b">Handler</code>或<code class="du kw kx ky kz b">Executor</code>。这个应用程序使用了一个<code class="du kw kx ky kz b">Executor</code>，因为它使代码更容易阅读。</p><p id="1f11" class="pw-post-body-paragraph ka kb hh kc b kd lc ii kf kg ld il ki kj mn kl km kn mo kp kq kr mp kt ku kv ha bi translated">An <code class="du kw kx ky kz b"><a class="ae ll" href="https://docs.oracle.com/javase/7/docs/api/java/util/concurrent/Executors.html#newSingleThreadScheduledExecutor()" rel="noopener ugc nofollow" target="_blank">SingleThreadScheduledExecutor</a></code>每500 ms调度一个<code class="du kw kx ky kz b">Runnable</code>执行(<code class="du kw kx ky kz b">PLAYBACK_POSITION_REFRESH_INTERVAL_MS</code>)。这意味着在这个规则的时间间隔执行这个任务，用当前位置<code class="du kw kx ky kz b">MediaPlayer</code>位置绘制用户界面。您可以尝试将其更改为不同的数字，并按下<code class="du kw kx ky kz b">PLAY</code>按钮，看看这如何改变UI行为。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="ml mm l"/></div></figure><h1 id="674f" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">2.用户移动洗涤器-播放器适配器界面</h1><p id="ab9e" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">为了改变播放位置，您可以使用<code class="du kw kx ky kz b">PlayerAdapter</code>界面。<code class="du kw kx ky kz b">MediaPlayerHolder</code>实现了这个接口，下面是它的部分外观。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="ml mm l"/></div></figure><h1 id="ada6" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">2.1.使用seekTo跳转到媒体中的任何位置</h1><p id="aac1" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">当应用程序播放音频时，如果用户在<code class="du kw kx ky kz b">SeekBar</code>(在<code class="du kw kx ky kz b">MainActivity</code>)中拖动搓擦器，会发生两件事:</p><ol class=""><li id="71d4" class="la lb hh kc b kd lc kg ld kj le kn lf kr lg kv lh li lj lk bi translated">必须终止正在运行以提供回放进度更新的<code class="du kw kx ky kz b">Executor</code>。否则，它会移动擦洗器，并在用户试图自己移动擦洗器时与用户发生冲突。</li><li id="8712" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lh li lj lk bi translated">一旦用户完成拖动洗涤器，必须使用<code class="du kw kx ky kz b">seekTo()</code>将位置报告给<code class="du kw kx ky kz b">MediaPlayer</code>。</li></ol><p id="f809" class="pw-post-body-paragraph ka kb hh kc b kd lc ii kf kg ld il ki kj mn kl km kn mo kp kq kr mp kt ku kv ha bi translated">处理这两种情况的方法在<code class="du kw kx ky kz b">PlayerAdapter</code>接口中提供，由<code class="du kw kx ky kz b">MediaPlayerHolder</code>实现。</p><p id="6f0f" class="pw-post-body-paragraph ka kb hh kc b kd lc ii kf kg ld il ki kj mn kl km kn mo kp kq kr mp kt ku kv ha bi translated">下面是来自<code class="du kw kx ky kz b">MainActivity</code>的代码，其中处理了用户移动擦洗器的情况。注意:<code class="du kw kx ky kz b">mPlayerAdapter</code>属于<code class="du kw kx ky kz b">PlayerAdapter</code>类型，是由<code class="du kw kx ky kz b">MediaPlayerHolder</code>实现的接口。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="ml mm l"/></div></figure><h1 id="2201" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">状态机</h1><p id="9536" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated"><code class="du kw kx ky kz b">MediaPlayer</code>有一个复杂的状态机。不需要完全理解就可以入门。要更深入地集成到<code class="du kw kx ky kz b">MediaPlayer’s</code>功能中，请参考developers.android.com的<a class="ae ll" href="https://developer.android.com/reference/android/media/MediaPlayer.html#StateDiagram" rel="noopener ugc nofollow" target="_blank">上的状态机图。</a></p><h1 id="b802" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">Android媒体资源</h1><ul class=""><li id="b6fe" class="la lb hh kc b kd ke kg kh kj mq kn mr kr ms kv ls li lj lk bi translated"><a class="ae ll" rel="noopener" href="/google-developers/understanding-mediasession-part-1-3-e4d2725f18e4">了解MediaSession </a></li><li id="32ea" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv ls li lj lk bi translated"><a class="ae ll" href="https://developer.android.com/guide/topics/media-apps/media-apps-overview.html" rel="noopener ugc nofollow" target="_blank"> Android媒体API指南——媒体应用概述</a></li><li id="cdc8" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv ls li lj lk bi translated"><a class="ae ll" href="https://developer.android.com/guide/topics/media-apps/working-with-a-media-session.html" rel="noopener ugc nofollow" target="_blank"> Android媒体API指南—使用媒体会话</a></li></ul></div></div>    
</body>
</html>