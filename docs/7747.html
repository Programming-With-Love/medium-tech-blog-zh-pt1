<html>
<head>
<title>Scaling secure tunnels for browser testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为浏览器测试扩展安全通道</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/scaling-secure-tunnels-for-browser-testing-9673c71505d?source=collection_archive---------6-----------------------#2018-12-14">https://medium.com/walmartglobaltech/scaling-secure-tunnels-for-browser-testing-9673c71505d?source=collection_archive---------6-----------------------#2018-12-14</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/c041ac2b3929f266be18196895e009dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hpvo6dSV3eijPm53N091KA.jpeg"/></div></div></figure><p id="1f3a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">测试对沃尔玛成功的电子商务业务至关重要。全世界有数百个开发团队在编写代码，所有这些代码在投入生产之前都需要测试。但是，试图支持每一个浏览器和设备版本进行测试本身就是一项艰巨的任务。</p><p id="abe2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们通过一家名为Sauce Labs的供应商实现了这一目标。您给他们一个带有浏览器和版本的selenium脚本，他们将在指定的浏览器上执行测试。大多数情况下，这些测试会将服务调用返回到我们的内部网络，这会导致新的问题。我们不能向公众开放我们所有的测试API。</p><p id="9139" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Sauce Labs拥有Sauce Connect隧道，允许我们创建一个安全的网络连接！</p><blockquote class="jn jo jp"><p id="88d1" class="ip iq jq ir b is it iu iv iw ix iy iz jr jb jc jd js jf jg jh jt jj jk jl jm ha bi translated">Sauce Connect是一个代理服务器，它在运行浏览器测试的Sauce Labs虚拟机和您想要测试的位于本地机器上或公司防火墙后的应用程序或网站之间建立安全连接</p></blockquote><p id="3a55" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们设置了多个DMZ箱来处理来自Sauce Connect隧道的入站流量。</p><figure class="jv jw jx jy fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ju"><img src="../Images/87832471c58cfdb8486cc943ebd33827.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3A4R7Vxn3eEn-tkZeNWCbg.png"/></div></div></figure><p id="54c2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">虽然这听起来像是完美的设置，但是仍然需要做一些准备工作来确保可伸缩性和可用性。我们还遇到了以下两个问题:</p><ol class=""><li id="4ae8" class="jz ka hh ir b is it iw ix ja kb je kc ji kd jm ke kf kg kh bi translated">在没有通知的情况下，Sauce Connect隧道将变得无响应</li><li id="33b6" class="jz ka hh ir b is ki iw kj ja kk je kl ji km jm ke kf kg kh bi translated">Suace Labs建议每24小时重启一次每个Sauce Connect隧道</li></ol><h1 id="09ea" class="kn ko hh bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated"><strong class="ak"> <em class="ll">介绍瞭望者&amp;渡鸦！</em>T3】</strong></h1><ul class=""><li id="1a55" class="jz ka hh ir b is lm iw ln ja lo je lp ji lq jm lr kf kg kh bi translated">Raven是一个在DMZ中启动Sauce Connect隧道的应用程序</li><li id="7ad5" class="jz ka hh ir b is ki iw kj ja kk je kl ji km jm lr kf kg kh bi translated">Lookout是一个监控渡鸦健康状况的应用程序</li></ul><figure class="jv jw jx jy fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ls"><img src="../Images/0156deb0c60406144b2926f490268d18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c-Q5AN5sSTN2dhZqf5-tEA.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx">Lookout — Raven — Orchestrator Architecture</figcaption></figure><p id="6345" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">渡鸦的唯一目的是启动和停止Sauce Connect隧道。健康检查逻辑被推给lookout应用程序，因为Sauce Labs对经过身份验证的请求进行速率限制。</p><blockquote class="jn jo jp"><p id="1ce2" class="ip iq jq ir b is it iu iv iw ix iy iz jr jb jc jd js jf jg jh jt jj jk jl jm ha bi translated">对于经过身份验证的请求，这些限制是针对单个用户帐户的</p></blockquote><p id="2012" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">限制是3。如果我们有3只以上的渡鸦拥有相同的隧道凭证，我们将限制自己检查隧道的状态。</p><p id="1186" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">相反，我们将这个逻辑推到Lookout应用程序上。将为共享相同隧道id的Ravens集群部署单个Lookout应用程序。这允许我们检查具有相同凭证的隧道id集合的状态。一旦Lookout获得活动隧道的列表，它就将这些隧道写入文件。在这一点上，我们可以让我们所有的乌鸦检查文件，看看他们是否仍然是活跃的隧道。如果它们不在活动列表中，它们将自行终止。</p><p id="7e15" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们所有的Ravens和Lookout应用程序都由一个配置文件和进程管理程序控制，我们称之为Orchestrator。</p><figure class="jv jw jx jy fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lx"><img src="../Images/4e641b13451d14e5fba605eb544c7a33.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*aO1UxRLBazhwFQ5Pm1TfeA.gif"/></div></div></figure><p id="d12c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Orchestrator解决了以下问题:</p><ul class=""><li id="79b5" class="jz ka hh ir b is it iw ix ja kb je kc ji kd jm lr kf kg kh bi translated">可用性要求，方法是让流程管理器在Raven自行终止时重启它</li><li id="b025" class="jz ka hh ir b is ki iw kj ja kk je kl ji km jm lr kf kg kh bi translated">部署到多台DMZ机器的要求</li><li id="f8a3" class="jz ka hh ir b is ki iw kj ja kk je kl ji km jm lr kf kg kh bi translated">可扩展性要求，允许我们在不影响其他运行隧道的情况下添加/删除/重启隧道</li></ul><p id="2098" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="jq">这些应用的影响</em></p><figure class="jv jw jx jy fd ii er es paragraph-image"><div class="er es ly"><img src="../Images/36ed0a3ce1169b2485008e8dee801b8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*ssyf3Ih0hUsVzmGQ8b_b9Q.jpeg"/></div></figure><ul class=""><li id="4705" class="jz ka hh ir b is it iw ix ja kb je kc ji kd jm lr kf kg kh bi translated">自Lookout和Raven实施以来，无响应隧道的手动重启为零(以前需要手动重启约每周4次)</li><li id="c2c9" class="jz ka hh ir b is ki iw kj ja kk je kl ji km jm lr kf kg kh bi translated">由于隧道中断，没有报告客户测试案例问题(以前每周收到约1个客户问题)</li><li id="705d" class="jz ka hh ir b is ki iw kj ja kk je kl ji km jm lr kf kg kh bi translated">启动新隧道时，对现有隧道或运行测试案例没有影响</li></ul><p id="443d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="jq">结论</em></p><p id="f680" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">确保代码在多种浏览器和版本上进行测试，对于任何一家有网站的公司来说都是非常重要的。有这么多不同版本的浏览器，建立正确的基础设施来处理这是一项伟大的事业。充分利用现有的工具，让它们为你带来好处。</p></div></div>    
</body>
</html>