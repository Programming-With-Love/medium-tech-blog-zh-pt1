<html>
<head>
<title>UnifiedSet — The Memory Saver</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">UnifiedSet —内存节约器</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/unifiedset-the-memory-saver-25b830745959?source=collection_archive---------1-----------------------#2018-05-29">https://medium.com/oracledevs/unifiedset-the-memory-saver-25b830745959?source=collection_archive---------1-----------------------#2018-05-29</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/10094d9ac5e444a73a03a10e394e7f82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d1FllHC2H0SXv7CK-aV_iQ.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx"><a class="ae it" href="https://www.eclipse.org/collections/" rel="noopener ugc nofollow" target="_blank">https://www.eclipse.org/collections/</a></figcaption></figure><p id="4f2e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在我之前的博客中，我解释了Eclipse集合<a class="ae it" rel="noopener" href="/oracledevs/unifiedmap-how-it-works-48af0b80cb37"> UnifiedMap如何工作</a>。在这篇博客中，我们将看到<a class="ae it" href="https://github.com/eclipse/eclipse-collections" rel="noopener ugc nofollow" target="_blank"> Eclipse Collections </a>中的UnifiedSet是如何工作的。</p><p id="f4c2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">统一设置</strong></p><p id="0a9b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">UnifiedSet是Eclipse集合的集合实现，它的实现与JDK散列集非常不同。UnifiedSet基于类似于UnifiedMap的原理。</p><p id="4946" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">JDK java.util.HashSet由java.util.HashMap支持。支持HashMap具有与支持映射中的对象相关联的虚拟值:<code class="du js jt ju jv b">HashMap&lt;E,Object&gt; map</code>，<code class="du js jt ju jv b">Object <strong class="iw hi"><em class="jw">PRESENT </em></strong>= new Object()<br/></code>这种设计导致HashSet继承了HashMap的行为。HashMap由一个条目对象表支持。条目实现有<code class="du js jt ju jv b">hashcode, key, value, next</code>作为成员，HashMap本质上缓存了键的hashcode。此外，由于这个伪值，HashSet最终会使用比所需更多的内存。</p><figure class="jy jz ka kb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es jx"><img src="../Images/c46c670499f50a9b1e6f7b255dfd06d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8zvhbs6kYpwaiaXilgAk9Q.png"/></div></div></figure><p id="19c7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">另一方面，UnifiedSet是作为一个集合实现的，即它没有任何“虚拟”空值对象，它不受条目对象表的支持。<br/> UnifiedSet由扁平数组支持。每个对象占用后备数组中的一个槽。通过创建一个更精简的实现，扁平数组只存储所需的对象。将对象放在展平的数组中也可以提高迭代的性能。主数组中的冲突通过放置一个名为<code class="du js jt ju jv b">ChainedBucket</code>的特殊对象来处理。<code class="du js jt ju jv b">ChainedBucket</code>是另一个存储碰撞元素的数组。</p><p id="ee35" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">像UnifiedSet中的<code class="du js jt ju jv b">contains</code>这样的查找模式使用标准的<a class="ae it" href="https://github.com/eclipse/eclipse-collections/blob/master/eclipse-collections/src/main/java/org/eclipse/collections/impl/set/mutable/UnifiedSet.java#L214" rel="noopener ugc nofollow" target="_blank"> hashcode索引算法</a>来查找元素的位置。如果索引处的元素是<em class="jw">而不是</em>一个链接的Bucket，那么简单地检查元素的存在。如果索引处的元素是ChainedBucket，则线性评估后备数组以找到所需的元素。</p><p id="6b4e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因为UnifiedSet不缓存hashcode，所以对于每次查找，都需要计算hashcode。因此，UnifiedSet的性能直接依赖于UnifiedSet中对象的hashcode实现。</p><p id="f5a0" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下面是JDK 1.8 HashSet和Eclipse集合9.2.0 UnifiedSet之间的一些内存和性能比较。</p><p id="f0f2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">内存占用(数字越低越好)</strong></p><figure class="jy jz ka kb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kc"><img src="../Images/ab0700b337b767e2967d914f2cdcc1e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RaeZSBkFJLxtRfUtQlk99Q.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Memory Comparison HashSet&lt;Integer&gt; vs UnifiedSet&lt;Integer&gt;</figcaption></figure><figure class="jy jz ka kb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kd"><img src="../Images/29e0b81ddc1a8b5b30b287119e564d7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a0VLNvKWyegOTQNervYqTw.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Memory Comparison HashSet&lt;String&gt; vs UnifiedSet&lt;String&gt;</figcaption></figure><p id="d0c1" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">性能测试(数字越高越好)</strong></p><figure class="jy jz ka kb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ke"><img src="../Images/fd3d4333456edee9b967b7063852f696.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BehsghFNKuNuW8tQp1RfYw.png"/></div></div></figure><figure class="jy jz ka kb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kf"><img src="../Images/0a544fb5336a0da427ffe250c52c4091.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hdat9QVech7L_4M-bizY4w.png"/></div></div></figure><figure class="jy jz ka kb fd ii er es paragraph-image"><div class="er es kg"><img src="../Images/ee69556468b5e5ed4ecdf896b3224cde.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/1*wO1-XOa3W-mmux86fFTVDQ.png"/></div></figure><p id="958b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">内存测试和性能测试的源代码可以在<a class="ae it" href="https://github.com/nikhilnanivadekar/MemoryPerformanceTest" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。</p><p id="a890" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">总结:</strong></p><ol class=""><li id="0251" class="kh ki hh iw b ix iy jb jc jf kj jj kk jn kl jr km kn ko kp bi translated">与JDK散列集相比，Eclipse集合UnifiedSet的内存占用要少75%。</li><li id="d48d" class="kh ki hh iw b ix kq jb kr jf ks jj kt jn ku jr km kn ko kp bi translated">对于add()操作，JDK哈希集的性能比Eclipse集合UnifiedSet稍好。</li><li id="3035" class="kh ki hh iw b ix kq jb kr jf ks jj kt jn ku jr km kn ko kp bi translated">对于contains()操作，JDK哈希集和Eclipse集合UnifiedSet的性能是相似的。</li><li id="611a" class="kh ki hh iw b ix kq jb kr jf ks jj kt jn ku jr km kn ko kp bi translated">对于forEach()操作，Eclipse集合UnifiedSet比JDK散列集执行得更好。</li></ol><p id="0a9c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> Eclipse集合资源:</strong> <br/> <a class="ae it" href="https://github.com/eclipse/eclipse-collections" rel="noopener ugc nofollow" target="_blank"> Eclipse集合</a>自带<a class="ae it" href="https://www.eclipse.org/collections/javadoc/9.0.0/org/eclipse/collections/impl/list/mutable/FastList.html" rel="noopener ugc nofollow" target="_blank">列表</a>、<a class="ae it" href="https://www.eclipse.org/collections/javadoc/9.0.0/org/eclipse/collections/impl/set/mutable/UnifiedSet.html" rel="noopener ugc nofollow" target="_blank">集合</a>和<a class="ae it" href="https://www.eclipse.org/collections/javadoc/9.0.0/org/eclipse/collections/impl/map/mutable/UnifiedMap.html" rel="noopener ugc nofollow" target="_blank">映射</a>的实现。它还拥有额外的数据结构，如<a class="ae it" href="https://www.eclipse.org/collections/javadoc/9.0.0/org/eclipse/collections/api/multimap/Multimap.html" rel="noopener ugc nofollow" target="_blank">多重映射</a>、<a class="ae it" href="https://www.eclipse.org/collections/javadoc/9.0.0/org/eclipse/collections/api/bag/Bag.html" rel="noopener ugc nofollow" target="_blank">包</a>和一个完整的原始集合层次结构。我们的每一个集合都有一个丰富的API用于通常需要的迭代模式。</p><ol class=""><li id="c3a4" class="kh ki hh iw b ix iy jb jc jf kj jj kk jn kl jr km kn ko kp bi translated"><a class="ae it" href="https://www.eclipse.org/collections/" rel="noopener ugc nofollow" target="_blank">网站</a></li><li id="49a6" class="kh ki hh iw b ix kq jb kr jf ks jj kt jn ku jr km kn ko kp bi translated"><a class="ae it" href="https://github.com/eclipse/eclipse-collections" rel="noopener ugc nofollow" target="_blank">GitHub上的源代码</a></li><li id="9496" class="kh ki hh iw b ix kq jb kr jf ks jj kt jn ku jr km kn ko kp bi translated"><a class="ae it" href="https://github.com/eclipse/eclipse-collections/blob/master/CONTRIBUTING.md" rel="noopener ugc nofollow" target="_blank">投稿指南</a></li><li id="9f41" class="kh ki hh iw b ix kq jb kr jf ks jj kt jn ku jr km kn ko kp bi translated"><a class="ae it" href="https://github.com/eclipse/eclipse-collections/blob/master/docs/guide.md#eclipse-collections-reference-guide" rel="noopener ugc nofollow" target="_blank">参考指南</a></li></ol><p id="0bac" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="jw">表示支持</em> <a class="ae it" href="https://github.com/eclipse/eclipse-collections/stargazers" rel="noopener ugc nofollow" target="_blank"> <em class="jw">星美上GitHub </em> </a> <em class="jw">。</em></p></div></div>    
</body>
</html>