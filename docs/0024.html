<html>
<head>
<title>Mastering the tvOS Focus Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">掌握tvOS焦点引擎</h1>
<blockquote>原文：<a href="https://medium.com/airbnb-engineering/mastering-the-tvos-focus-engine-f8a13b371083?source=collection_archive---------0-----------------------#2015-09-11">https://medium.com/airbnb-engineering/mastering-the-tvos-focus-engine-f8a13b371083?source=collection_archive---------0-----------------------#2015-09-11</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/8088165c814aaf8e96d64ff760a43d0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rw0JisNrpREBgosdyyXCxQ.jpeg"/></div></div></figure><div class=""/><p id="ff4b" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">由迈克尔·巴赫德和亚当·米凯拉分别出演</p><p id="6c82" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">tvOS交互范例向开发者和设计者提出了独特的挑战。新的Apple TV将一个类似触控板的遥控器与一个没有传统光标的用户界面配对。因此，“焦点”是应用程序在用户导航时向用户提供视觉反馈的唯一方式。</p><p id="08e0" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您可以将焦点引擎视为用户和您闪亮的新tvOS应用程序之间的桥梁。尽管这位桥梁守护者并不指望你知道一只空载燕子的<a class="ae jp" href="https://youtu.be/cV0tCphFMr8?t=2m49s" rel="noopener ugc nofollow" target="_blank">空速</a>，但与focus engine成为朋友是构建一个感觉像是这个平台的应用程序的重要一步。</p><p id="f605" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">任何经验丰富的iOS工程师都会觉得在tvOS上使用UIKit很舒服——但不要让这些平台显著的相似性诱使你相信它们是相同的。苹果让你的iOS应用移植到tvOS变得很容易。但是如果你没有从一开始就考虑你的应用程序将如何与焦点引擎交互，当你接近终点线时，你会发现自己在打一场艰苦的战斗。</p><h1 id="2b69" class="jq jr hs bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">专注到底是什么意思？</h1><p id="ef32" class="pw-post-body-paragraph ip iq hs ir b is ko iu iv iw kp iy iz ja kq jc jd je kr jg jh ji ks jk jl jm ha bi translated">用户通过在屏幕上的项目之间移动焦点来导航tvOS应用。当一个项目被聚焦时，它的外观会被调整以突出屏幕上其他项目的外观。聚焦效应是tvOS公共化的关键。聚焦效果不仅向遥控者提供视觉反馈，也向跟随的旁观者提供视觉反馈。正是它们将这种本地电视体验与在大屏幕上播放你的iPad区分开来。</p><h1 id="8adb" class="jq jr hs bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">有什么可聚焦的？</h1><p id="60c5" class="pw-post-body-paragraph ip iq hs ir b is ko iu iv iw kp iy iz ja kq jc jd je kr jg jh ji ks jk jl jm ha bi translated">只有视图可以获得焦点，并且一次只能聚焦一个视图。考虑这些按钮:</p><figure class="ku kv kw kx fd hj er es paragraph-image"><div class="er es kt"><img src="../Images/223985ab2c3c8bde160d61a26bbb81d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1300/format:webp/0*W5XiEfM46vvFxz5S.png"/></div></figure><p id="eba5" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">按钮C当前处于焦点中。在遥控器上向左滑动将聚焦按钮b。向右滑动将聚焦按钮d。更积极地向左或向右滑动将分别聚焦按钮A或按钮E。值得注意的是，即使更激进的左击会导致按钮A最终获得焦点，按钮B也会在这个过程中瞬间获得(然后失去)焦点。</p><p id="80d9" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">一个特定的视图是否可聚焦是由一个新的实例方法决定的。</p><figure class="ku kv kw kx fd hj"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="bf40" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">苹果已经审计了它的公共框架，并为<em class="ky"> canBecomeFocused() </em>提供了明智的实现。只有UIKit附带的以下类是可聚焦的:</p><ul class=""><li id="1f57" class="lb lc hs ir b is it iw ix ja ld je le ji lf jm lg lh li lj bi translated"><em class="ky">ui按钮</em></li><li id="72c8" class="lb lc hs ir b is lk iw ll ja lm je ln ji lo jm lg lh li lj bi translated"><em class="ky"> UIControl </em></li><li id="1694" class="lb lc hs ir b is lk iw ll ja lm je ln ji lo jm lg lh li lj bi translated"><em class="ky"> UISegmentedControl </em></li><li id="50c3" class="lb lc hs ir b is lk iw ll ja lm je ln ji lo jm lg lh li lj bi translated"><em class="ky"> UITabBar </em></li><li id="a332" class="lb lc hs ir b is lk iw ll ja lm je ln ji lo jm lg lh li lj bi translated"><em class="ky"> UITextField </em></li><li id="2a82" class="lb lc hs ir b is lk iw ll ja lm je ln ji lo jm lg lh li lj bi translated"><em class="ky"> UISearchBar </em>(虽然<em class="ky"> UISearchBar </em>本身是不可聚焦的，但是它的内部文本字段是可聚焦的)</li></ul><p id="ff21" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="ky"> UICollectionViewCell </em>和<em class="ky"> UITableViewCell </em>是例外。单元格是否可聚焦由<em class="ky"> UICollectionView </em>或<em class="ky"> UITableView </em>委托决定:</p><ul class=""><li id="b516" class="lb lc hs ir b is it iw ix ja ld je le ji lf jm lg lh li lj bi translated"><em class="ky">集合视图(_:canFocusItemAtIndexPath:)</em></li><li id="6809" class="lb lc hs ir b is lk iw ll ja lm je ln ji lo jm lg lh li lj bi translated"><em class="ky">表格视图(_:canFocusRowAtIndexPath:) </em></li></ul><p id="0147" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">虽然<em class="ky"> UIImageView </em>本身是不可聚焦的，但它也是添加了<em class="ky">adjustimagewhancestorfocused</em>属性的特例。启用后，每当祖先获得焦点时，<em class="ky"> UIImageView </em>实例将显示聚焦效果。由于系统没有为<em class="ky"> UICollectionView </em>单元格提供默认的聚焦效果，这是一种为基于图像的集合视图注入活力的简单方法。你会看到苹果在整个系统用户界面和内置应用程序中广泛使用这种技术。</p><h1 id="e71c" class="jq jr hs bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">目前的焦点是什么？</h1><p id="eee4" class="pw-post-body-paragraph ip iq hs ir b is ko iu iv iw kp iy iz ja kq jc jd je kr jg jh ji ks jk jl jm ha bi translated">您可以询问任何视图它当前是否在焦点上。</p><figure class="ku kv kw kx fd hj"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="0b71" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您也可以要求屏幕显示当前聚焦的视图(如果存在)。</p><figure class="ku kv kw kx fd hj"><div class="bz dy l di"><div class="kz la l"/></div></figure><h1 id="c30b" class="jq jr hs bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">响应焦点更新</h1><p id="451d" class="pw-post-body-paragraph ip iq hs ir b is ko iu iv iw kp iy iz ja kq jc jd je kr jg jh ji ks jk jl jm ha bi translated">在tvOS中，所有参与focus系统的类都符合<em class="ky"> UIFocusEnvironment </em>协议。每个焦点环境对应于视图层次结构的一个特定分支，这意味着焦点环境可以嵌套。</p><p id="1e02" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">ui focus environment API允许开发人员和焦点引擎之间就如何在视图层次结构的特定分支内更新焦点进行双向对话。UIView、UIViewController和UIPresentationController符合开箱即用的UIFocusEnvironment。</p><p id="acad" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">覆盖<em class="ky">shouldUpdateFocusInContext(_:)</em>提供了一个在应用焦点更新之前检查它的机会。<em class="ky"> UICollectionView </em>和<em class="ky"> UITableView </em>委托提供了此API的基于<em class="ky"> NSIndexPath </em>的版本，其中所提供的上下文包含上一个和下一个聚焦的索引路径，而不是视图本身。</p><ul class=""><li id="da32" class="lb lc hs ir b is it iw ix ja ld je le ji lf jm lg lh li lj bi translated"><em class="ky">集合视图(_:shouldUpdateFocusInContext:)</em></li><li id="5766" class="lb lc hs ir b is lk iw ll ja lm je ln ji lo jm lg lh li lj bi translated"><em class="ky">表视图(_:shouldUpdateFocusInContext:)</em></li></ul><p id="4ddb" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这里有一个玩具示例，展示了如何使用<em class="ky">UICollectionView</em>delegate方法在一个单元格被选中时禁用集合视图中的焦点更新。</p><figure class="ku kv kw kx fd hj"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="088f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">覆盖<em class="ky">diddupdatefocusincontext(_:withAnimationCoordinator:)</em>提供了响应焦点更新并参与相关动画的机会。给定两个相邻的按钮，下面是如何将当前处于焦点的按钮水平居中。</p><figure class="ku kv kw kx fd hj"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="c274" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">当焦点更新周期发生时，在接收焦点的视图、失去焦点的视图以及这两个视图的所有父焦点环境上调用每个方法。</p><h1 id="d9cd" class="jq jr hs bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">请求聚焦</h1><p id="605d" class="pw-post-body-paragraph ip iq hs ir b is ko iu iv iw kp iy iz ja kq jc jd je kr jg jh ji ks jk jl jm ha bi translated">焦点引擎将在适当的时候自动启动焦点更新，如应用程序启动或当当前聚焦的视图从视图层次结构中移除时。开发人员也可以请求focus更新，但是任何请求都必须通过focus引擎发出。因为只有focus引擎可以更新focus，所以focus引擎实际上扮演了桥梁守护者的角色。</p><p id="9514" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="ky"> UIFocusEnvironment </em>的<em class="ky"> setNeedsFocusUpdate() </em>和<em class="ky">updatefocusifneed()</em>与焦点引擎的交互方式与<em class="ky"> setNeedsLayout() </em>和<em class="ky">layoutifneed()</em>与布局引擎的交互方式非常相似。调用<em class="ky"> setNeedsFocusUpdate() </em>将记录您的请求并立即返回。焦点引擎将在下一个更新周期中重新计算焦点。调用<em class="ky">updatefocusifneed()</em>会立即强制焦点更新。</p><p id="c9e8" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">当一个更新周期开始时，焦点引擎向发起的焦点环境查询它的<em class="ky"> preferredFocusedView </em>。如果这个视图是非<em class="ky"> nil </em>并且是可聚焦的，那么focus引擎将试图通过focus responder链发出上述通知事件来为这个视图提供焦点。</p><p id="dab3" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">让我们看几个我创建的特别没用的<em class="ky"> AnimalsViewController </em>的例子。在每个例子中，<em class="ky">狗按钮</em>最初都有焦点。</p><figure class="ku kv kw kx fd hj"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="b9a8" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">焦点引擎将只接受由当前<em class="ky">包含</em>焦点的焦点环境发出的请求。因此，尽管<em class="ky"> catButton </em>的<em class="ky"> preferredFocusedView </em>是它自己，但是<em class="ky"> catButton </em>更新焦点的请求被忽略。</p><figure class="ku kv kw kx fd hj"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="40bf" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然而，当<em class="ky"> animalsViewController </em>请求焦点更新时，焦点将从<em class="ky"> dogButton </em>移动到<em class="ky"> catButton </em>，因为当前聚焦的视图(<em class="ky"> dogButton </em>)在由<em class="ky"> animalsViewController </em>焦点环境管理的视图层次结构的分支内。</p><figure class="ku kv kw kx fd hj"><div class="bz dy l di"><div class="kz la l"/></div></figure><p id="b657" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">当两个焦点环境同时请求焦点更新时，焦点引擎将遵从父环境。</p><figure class="ku kv kw kx fd hj"><div class="bz dy l di"><div class="kz la l"/></div></figure><h1 id="d2d2" class="jq jr hs bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">往前走！</h1><p id="b199" class="pw-post-body-paragraph ip iq hs ir b is ko iu iv iw kp iy iz ja kq jc jd je kr jg jh ji ks jk jl jm ha bi translated">有了这份focus engine初级读本，您就可以充分利用这个新平台了。focus系统和API是熟悉的和设计良好的，因此当您将应用程序带到电视上时，它很容易成为一种事后的想法。但是，你在这个平台上工作得越多，就越能清楚地看到，利用focus引擎的全部能力将标志着iOS端口和本地tvOS体验之间的差异。</p></div><div class="ab cl lp lq go lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ha hb hc hd he"><h2 id="5514" class="lw jr hs bd js lx ly lz jw ma mb mc ka ja md me ke je mf mg ki ji mh mi km mj bi translated">在<a class="ae jp" href="http://airbnb.io" rel="noopener ugc nofollow" target="_blank"> airbnb.io </a>查看我们所有的开源项目，并在Twitter上关注我们:<a class="ae jp" href="https://twitter.com/AirbnbEng" rel="noopener ugc nofollow" target="_blank">@ Airbnb eng</a>+<a class="ae jp" href="https://twitter.com/AirbnbData" rel="noopener ugc nofollow" target="_blank">@ Airbnb data</a></h2></div><div class="ab cl lp lq go lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="ha hb hc hd he"><p id="6589" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="ky">原载于2015年9月11日</em><a class="ae jp" href="http://nerds.airbnb.com/tvos-focus-engine/" rel="noopener ugc nofollow" target="_blank"><em class="ky">nerds.airbnb.com</em></a><em class="ky">。</em></p></div></div>    
</body>
</html>