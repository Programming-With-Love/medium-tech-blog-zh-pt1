<html>
<head>
<title>Deploying and monitoring a Redis cluster to Oracle Container Engine (OKE)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">部署和监控Redis集群到Oracle容器引擎(OKE)</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/deploying-and-monitoring-a-redis-cluster-to-oracle-container-engine-oke-5f210b91b800?source=collection_archive---------0-----------------------#2019-04-26">https://medium.com/oracledevs/deploying-and-monitoring-a-redis-cluster-to-oracle-container-engine-oke-5f210b91b800?source=collection_archive---------0-----------------------#2019-04-26</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="6760" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在<a class="ae jc" rel="noopener" href="/@lmukadam/extending-terraform-oke-with-a-helm-chart-a51ae0df29d4">之前的帖子</a>中，我们为<a class="ae jc" href="https://github.com/oracle-terraform-modules/terraform-oci-oke" rel="noopener ugc nofollow" target="_blank"> terraform-oci-oke </a>项目添加了一个简单的扩展，以便它使用<a class="ae jc" href="https://github.com/helm/charts/tree/master/stable/redis" rel="noopener ugc nofollow" target="_blank"> Redis helm chart </a>在Kubernetes上部署Redis集群。</p><p id="d028" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这篇文章中，我们将尝试一些更有雄心的东西:</p><ul class=""><li id="0921" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated">像前一篇文章中一样部署一个Redis集群</li><li id="954f" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">用普罗米修斯监控Redis集群</li><li id="73e3" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">使用Redis批量插入，用现有数据填充Redis集群</li><li id="9aa8" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">使用Grafana可视化体量插入过程</li></ul><p id="d3c9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了方便起见，我们将手动部署Prometheus和Redis。但是，如果您使用的是<a class="ae jc" href="https://github.com/oracle-terraform-modules/terraform-oci-oke" rel="noopener ugc nofollow" target="_blank"> terraform-oci-oke </a>模块(或者任何Kubernetes集群)，您可以通过使用helm提供程序获得相同的结果，如前一篇文章所述。</p><h2 id="2119" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated">体系结构</h2><p id="a22b" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">从概念上讲，这就是我们正在努力做的事情:</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es kr"><img src="../Images/39048a500064592b96a424235c58ba6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dqYTrPDmYjHdhIeL0m8a1Q.png"/></div></div></figure><h2 id="5f42" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated">部署普罗米修斯操作员</h2><p id="096c" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">为普罗米修斯创建一个名称空间:</p><pre class="ks kt ku kv fd ld le lf lg aw lh bi"><span id="6f4a" class="jr js hh le b fi li lj l lk ll">kubectl create namespace monitoring</span></pre><p id="ce2a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您使用的是terraform-oci-oke模块，并且已经配置了bastion主机，则helm已经为您安装并预配置好了。只需登录堡垒并部署普罗米修斯操作员:</p><pre class="ks kt ku kv fd ld le lf lg aw lh bi"><span id="204d" class="jr js hh le b fi li lj l lk ll">helm install --namespace monitoring \<br/>stable/prometheus-operator \<br/>--name prom-operator \<br/>--set kubeDns.enabled=true \<br/><strong class="le hi">--set prometheus.prometheusSpec.serviceMonitorSelectorNilUsesHelmValues=false</strong> \<br/>--set coreDns.enabled=false \<br/>--set kubeControllerManager.enabled=false \<br/>--set kubeEtcd.enabled=false \<br/>--set kubeScheduler.enabled=false</span></pre><p id="71ac" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将serviceMonitorSelectorNilUsesHelmValues设置为false可确保选择所有ServiceMonitors。</p><p id="5f5c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">获取一份吊舱列表并识别普罗米修斯吊舱:</p><pre class="ks kt ku kv fd ld le lf lg aw lh bi"><span id="20c7" class="jr js hh le b fi li lj l lk ll">kubectl -n monitoring get pods | grep prometheus</span><span id="20df" class="jr js hh le b fi lm lj l lk ll">alertmanager-prom-operator-prometheus-o-alertmanager-0   2/2     Running   0          18s                                                        <br/>prom-operator-prometheus-node-exporter-9xhzr             1/1     Running   0          24s                                                        <br/>prom-operator-prometheus-node-exporter-qtbvv             1/1     Running   0          24s                                                        <br/>prom-operator-prometheus-node-exporter-wjbfp             1/1     Running   0          24s                                                        <br/>prom-operator-prometheus-o-operator-79ff98787f-4t4k7     1/1     Running   0          23s                                                        <br/><strong class="le hi">prometheus-prom-operator-prometheus-o-prometheus-0</strong>       3/3     Running   1          11s</span></pre><p id="f547" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在另一个终端上，设置本地KUBECONFIG环境变量，并在本地运行kubectl port-forward来访问Prometheus表达式浏览器:</p><pre class="ks kt ku kv fd ld le lf lg aw lh bi"><span id="68e6" class="jr js hh le b fi li lj l lk ll">export KUBECONFIG=generated/kubeconfig</span><span id="2320" class="jr js hh le b fi lm lj l lk ll">kubectl -n monitoring port-forward prometheus-prom-operator-prometheus-o-prometheus-0 9090:9090</span></pre><p id="2537" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">打开浏览器并访问Prometheus Expression浏览器，以验证http://localhost:9090/targets上的目标</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es ln"><img src="../Images/3837653ebbdc71f7c4e500f3908868f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z6USSxBUXGK8z34q66cwDQ.png"/></div></div><figcaption class="lo lp et er es lq lr bd b be z dx">Prometheus targets</figcaption></figure><p id="74d2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，我们要验证Grafana是否已经正确配置，并且已经将Prometheus作为数据源。获取pod列表并识别Grafana pods:</p><pre class="ks kt ku kv fd ld le lf lg aw lh bi"><span id="372d" class="jr js hh le b fi li lj l lk ll">kubectl -n monitoring get pods | grep grafana</span><span id="bd64" class="jr js hh le b fi lm lj l lk ll">prom-operator-grafana-77cdf86d94-m8pv5 2/2     Running   0          57s</span></pre><p id="c580" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本地运行kubectl port-forward来访问Grafana:</p><pre class="ks kt ku kv fd ld le lf lg aw lh bi"><span id="0fb8" class="jr js hh le b fi li lj l lk ll">kubectl -n monitoring port-forward prom-operator-grafana-77cdf86d94-m8pv5 3000:3000</span></pre><p id="d343" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过将浏览器指向http://localhost:3000来访问Grafana</p><p id="5aa7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用admin/prom-operator登录(默认用户名和密码，如果您没有更改它们)。您应该能够看到默认的Kubernetes仪表板。</p><h2 id="f2c5" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated">部署Redis集群</h2><p id="ac84" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">为redis创建命名空间:</p><pre class="ks kt ku kv fd ld le lf lg aw lh bi"><span id="c1a8" class="jr js hh le b fi li lj l lk ll">kubectl create namespace redis </span></pre><p id="53c5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用helm部署Redis集群:</p><pre class="ks kt ku kv fd ld le lf lg aw lh bi"><span id="c79a" class="jr js hh le b fi li lj l lk ll">helm install --namespace redis \<br/>stable/redis \<br/>--name redis \<br/>--set cluster.enabled=true \<br/>--set cluster.slaveCount=3 \<br/>--set master.persistence.size=50Gi \<br/>--set slave.persistence.size=50Gi \<br/>--set metrics.enabled=true \<br/>--set metrics.serviceMonitor.enabled=true \<br/>--set metrics.serviceMonitor.namespace=monitoring</span></pre><p id="a63d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">再次访问Prometheus表达式浏览器，并验证Redis现在是否列为目标之一:</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es ls"><img src="../Images/bcd6a0699b6e810682cd99e77ffd670d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PPqqqPWTYQElsAy0Popktg.png"/></div></div><figcaption class="lo lp et er es lq lr bd b be z dx">Prometheus now with Redis target</figcaption></figure><h2 id="16e9" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated">为Grafana导入Redis仪表板</h2><p id="07d9" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">如上所述再次登录Grafana，点击左侧菜单中的“+”图标，导入仪表板，并在Grafana.com仪表板字段中输入仪表板id 2751:</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es lt"><img src="../Images/a81686259db64a1faa930c52066448eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hogc9ADW3EocBTGIHHKGHw.png"/></div></div></figure><p id="2452" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">加载仪表板后，选择Prometheus数据源:</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es lt"><img src="../Images/f28dedc16d67cccea3d604440979e76b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gfT7gfkLNIMOrbP6_QundQ.png"/></div></div></figure><p id="f326" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后点击导入。现在，Grafana中应该有一个正常工作的Redis仪表板:</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es lt"><img src="../Images/b805e195e8a6341f9cbfc3f0ebbb9f0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a8uao798iGmPmu9ky9n5DQ.png"/></div></div></figure><h2 id="b1ef" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated">将数据批量插入Redis</h2><p id="7be1" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">现在让我们将数据<a class="ae jc" href="https://redis.io/topics/mass-insert" rel="noopener ugc nofollow" target="_blank">批量插入</a>到Redis中。我发现这个<a class="ae jc" href="http://blog.mostafazh.me/2015/07/21/fastest-way-to-import-big-csv-to-redis/" rel="noopener ugc nofollow" target="_blank">整洁的宝石</a>加载一个csv到redis。</p><p id="7092" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">给定以下格式的csv文件:</p><pre class="ks kt ku kv fd ld le lf lg aw lh bi"><span id="485b" class="jr js hh le b fi li lj l lk ll">id, first name, age, gender, nickname, salary<br/>1, John Smith, 40, Male, John, 10000<br/>2, Marco Polo, 43, Male, Marco, 10000<br/>….<br/>1999999, Tom Cruse, 50, Male, Tom, 10001</span></pre><p id="3025" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">可以使用以下命令将其导入Redis:</p><pre class="ks kt ku kv fd ld le lf lg aw lh bi"><span id="1bdc" class="jr js hh le b fi li lj l lk ll">awk -F, 'NR &gt; 1{ print "SET", "\"employee_"$1"\"", "\""$0"\"" }' file.csv | redis-cli --pipe</span></pre><p id="d8eb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，我们必须生成数据集。我们将使用<a class="ae jc" href="https://github.com/lk-geimfari/mimesis" rel="noopener ugc nofollow" target="_blank">模拟</a>包:</p><pre class="ks kt ku kv fd ld le lf lg aw lh bi"><span id="af51" class="jr js hh le b fi li lj l lk ll">pip install mimesis</span></pre><p id="c4f0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们将稍微修改一下模式，这样我们就可以利用mimesis提供的任何东西，通过Python创建一个csv文件:</p><pre class="ks kt ku kv fd ld le lf lg aw lh bi"><span id="7be0" class="jr js hh le b fi li lj l lk ll">import csv</span><span id="9995" class="jr js hh le b fi lm lj l lk ll">from mimesis import Person</span><span id="8b4c" class="jr js hh le b fi lm lj l lk ll">from mimesis.enums import Gender</span><span id="2e31" class="jr js hh le b fi lm lj l lk ll">en = Person('en')</span><span id="ae96" class="jr js hh le b fi lm lj l lk ll">with open('file.csv',mode='w') as csv_file:</span><span id="3652" class="jr js hh le b fi lm lj l lk ll">field_names = ['id', 'full name', 'age', 'gender', 'username', 'weight']</span><span id="f8c6" class="jr js hh le b fi lm lj l lk ll">writer = csv.DictWriter(csv_file, fieldnames=field_names)</span><span id="5f0c" class="jr js hh le b fi lm lj l lk ll">writer.writeheader()</span><span id="7de0" class="jr js hh le b fi lm lj l lk ll">for n in range(100000):</span><span id="11cd" class="jr js hh le b fi lm lj l lk ll">writer.writerow({'id': str(n), 'first name': en.full_name(), 'age': str(en.age()), 'gender': en.gender(), 'username':en.username(), 'weight':str(en.weight())})</span></pre><p id="4d8f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">运行python脚本来生成数据:</p><pre class="ks kt ku kv fd ld le lf lg aw lh bi"><span id="9863" class="jr js hh le b fi li lj l lk ll">python names.py</span></pre><p id="f78a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这将在当前目录下创建一个file.csv文件。您可以<a class="ae jc" href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-persistent-volume-storage/" rel="noopener ugc nofollow" target="_blank">配置一个PersistentVolume </a>来存储和加载数据，但是出于本练习的目的，我们将通过在bastion中安装redis来做一个快速破解:</p><pre class="ks kt ku kv fd ld le lf lg aw lh bi"><span id="445b" class="jr js hh le b fi li lj l lk ll">sudo yum install redis -y</span></pre><p id="f6de" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这将允许我们从生成/上传file.csv的堡垒中使用redis-cli。</p><p id="6631" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在bastion上，获取Redis pods列表:</p><pre class="ks kt ku kv fd ld le lf lg aw lh bi"><span id="74d3" class="jr js hh le b fi li lj l lk ll">kubectl -n redis get pods</span><span id="33b0" class="jr js hh le b fi lm lj l lk ll">NAME                             READY   STATUS    RESTARTS   AGE                                                                                <br/>redis-master-0                   1/1     Running   0          156m                                                                               <br/>redis-metrics-794db76ff7-xmd2q   1/1     Running   0          156m                                                                               <br/>redis-slave-7fd8b55f7-25w8d      1/1     Running   1          156m                                                                               <br/>redis-slave-7fd8b55f7-hvhmc      1/1     Running   1          156m                                                                               <br/>redis-slave-7fd8b55f7-mjq8q      1/1     Running   1          156m</span></pre><p id="f57e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">并使用端口转发到，以便您可以使用redis-cli访问它:</p><pre class="ks kt ku kv fd ld le lf lg aw lh bi"><span id="9231" class="jr js hh le b fi li lj l lk ll">k -n redis port-forward redis-master-0 6379:6379<br/>Forwarding from 127.0.0.1:6379 -&gt; 6379</span></pre><p id="8dca" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">打开一个新的终端，登录到bastion并获得Redis密码:</p><pre class="ks kt ku kv fd ld le lf lg aw lh bi"><span id="6420" class="jr js hh le b fi li lj l lk ll">export REDIS_PASSWORD=$(kubectl get secret --namespace redis redis -o jsonpath="{.data.redis-password}" | base64 --decode)</span></pre><p id="792c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">做一个快速测试，看看您能否连接到Redis:</p><pre class="ks kt ku kv fd ld le lf lg aw lh bi"><span id="9313" class="jr js hh le b fi li lj l lk ll">redis-cli -a $REDIS_PASSWORD</span><span id="accb" class="jr js hh le b fi lm lj l lk ll">127.0.0.1:6379&gt; ping                                                                                                                                                        <br/>PONG                                                                                                                                                                        <br/>127.0.0.1:6379&gt;</span></pre><p id="07b5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在我们导入csv之前，通过打开第三个终端并在本地运行kubectl port-forward <em class="lu">，如上所述访问Grafana (http://localhost:3000)。</em>浏览Redis仪表板，并将刷新频率设置为每5秒钟一次:</p><pre class="ks kt ku kv fd ld le lf lg aw lh bi"><span id="c06b" class="jr js hh le b fi li lj l lk ll">kubectl -n monitoring port-forward prom-operator-grafana-77cdf86d94-m8pv5 3000:3000</span></pre><p id="3629" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在导入csv文件，如下所示:</p><pre class="ks kt ku kv fd ld le lf lg aw lh bi"><span id="44d1" class="jr js hh le b fi li lj l lk ll">awk -F, 'NR &gt; 1{ print "SET", "\"employee_"$1"\"", "\""$0"\"" }' file.csv | redis-cli -a $REDIS_PASSWORD --pipe</span><span id="e502" class="jr js hh le b fi lm lj l lk ll">All data transferred. Waiting for the last reply...                                                                                                                   <br/>Last reply received from server.                                                                                                                                      <br/>errors: 0, replies: 1000000</span></pre><p id="59da" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">并观看Grafana的Redis仪表板。您可以看到网络IO、数据库中的项目数量以及使用的内存量的快速增长。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es lt"><img src="../Images/f344f52d8f346dd645faff44bfbf4551.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XYZNNKiOMqSENqeFhQzDzw.png"/></div></div><figcaption class="lo lp et er es lq lr bd b be z dx">Redis Dashboard after mass insertion</figcaption></figure><p id="a600" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">虽然我们使用cli手动安装了Prometheus Operator和Redis集群，但您也可以使用Terraform helm provider来实现。当您在Redis上启用监控时，您需要确保创建了相关的CRD。当您按照上面的顺序手动操作时，这已经为您完成了。</p><p id="3048" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但是，当您使用Terraform进行配置时，您需要按如下方式明确设置顺序:</p><pre class="ks kt ku kv fd ld le lf lg aw lh bi"><span id="23d5" class="jr js hh le b fi li lj l lk ll">resource "helm_release" "prometheus-operator" {<br/>  ...<br/>  ...<br/>  ...</span><span id="26d2" class="jr js hh le b fi lm lj l lk ll">}</span><span id="aa60" class="jr js hh le b fi lm lj l lk ll">resource "helm_release" "redis" {</span><span id="8302" class="jr js hh le b fi lm lj l lk ll">  depends_on = ["helm_release.prometheus-operator"]<br/>  ...<br/>  ...<br/>  ...</span><span id="0c72" class="jr js hh le b fi lm lj l lk ll">}</span></pre><p id="f9f3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过执行上述操作，您可以确保首先创建prometheus-operator版本以及redis版本需要的必要CRD(例如Alertmanager、prometheus、PrometheusRule、ServiceMonitor ),以便Prometheus能够监视Redis集群。</p></div></div>    
</body>
</html>