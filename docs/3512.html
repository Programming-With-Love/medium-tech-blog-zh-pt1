<html>
<head>
<title>Hey Browser — What’s your priority?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">嘿，浏览器——你优先考虑什么？</h1>
<blockquote>原文：<a href="https://medium.com/globant/hey-browser-whats-your-priority-1fbe5db71d23?source=collection_archive---------3-----------------------#2020-10-01">https://medium.com/globant/hey-browser-whats-your-priority-1fbe5db71d23?source=collection_archive---------3-----------------------#2020-10-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="3178" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">浏览器资源优先化——它如何提高web性能？</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/e75221e209b393db827f1f8a07e25bcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QjGETaoOA1hX_-9jbESLtw.png"/></div></div></figure><p id="9789" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">网站性能——对于你参与的每个项目来说，这难道不是一件大事吗？原因很简单——用户想在一瞬间得到所有东西。一个网站的表现会影响转化率(<em class="jo">一个网站的转化率是采取想要的行动的用户的百分比，转化率与网站产生的收入多少直接相关</em>)。下面是几个例子，说明性能的提高是如何与转化率联系在一起的。<a class="ae jp" href="https://www.cloudflare.com/en-ca/learning/performance/why-site-speed-matters/" rel="noopener ugc nofollow" target="_blank">来源</a></p><ul class=""><li id="965e" class="jq jr hh ig b ih ii il im ip js it jt ix ju jb jv jw jx jy bi translated">Mobify发现，将主页的加载时间减少100毫秒会导致基于会话的转化率上升1.11%</li><li id="1bdc" class="jq jr hh ig b ih jz il ka ip kb it kc ix kd jb jv jw jx jy bi translated">在将页面加载时间减少一半后，零售商自动测试的销售额增加了12-13%</li><li id="0457" class="jq jr hh ig b ih jz il ka ip kb it kc ix kd jb jv jw jx jy bi translated">沃尔玛发现，将页面加载时间缩短一秒，转化率就会提高2%</li></ul><p id="fdd8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，大量的钱被花在提高网站的性能上，以获得更高的转化率。</p><p id="fa4d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然而，如果有一些小技巧可以提高你的网站性能而不需要花费任何东西呢？浏览器为开发人员提供了一些便利，让他们能够更好地控制资源加载的方式和时间。</p><h1 id="e9c9" class="ke kf hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">浏览器资源优先级-交易！</h1><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/f6ebb0000ca73c7ea2e524a8a03ccecc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OQuPib3t-znAyVJHw35K5w.png"/></div></div><figcaption class="lc ld et er es le lf bd b be z dx">Browser resource prioritization</figcaption></figure><p id="e290" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当web服务器将请求的HTML返回给浏览器时，浏览器有自己的试探法，负责最佳猜测哪些资源是重要的，以便首先加载它们。例如，CSS将总是在脚本或图像之前被加载。然而，你有办法影响浏览器的决策。</p><p id="c2ed" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这些被称为<strong class="ig hi"> <em class="jo">资源提示</em> </strong>。以下是我们将在本文中探索的资源提示。</p><ul class=""><li id="05b1" class="jq jr hh ig b ih ii il im ip js it jt ix ju jb jv jw jx jy bi translated"><strong class="ig hi">预载</strong></li><li id="2151" class="jq jr hh ig b ih jz il ka ip kb it kc ix kd jb jv jw jx jy bi translated"><strong class="ig hi">预取</strong></li><li id="e7a0" class="jq jr hh ig b ih jz il ka ip kb it kc ix kd jb jv jw jx jy bi translated"><strong class="ig hi">预连接</strong></li></ul><p id="4683" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所有这些资源提示都使用HTML中<strong class="ig hi"> link </strong>元素的<strong class="ig hi"> rel </strong>属性。所以我们来详细探究一下。</p><h1 id="84ba" class="ke kf hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated"><strong class="ak">预载</strong></h1><p id="9890" class="pw-post-body-paragraph ie if hh ig b ih lg ij ik il lh in io ip li ir is it lj iv iw ix lk iz ja jb ha bi translated">Preload是一个声明性的fetch指令。这个优先级提示允许您强制浏览器请求某个资源，而不阻塞窗口的onload事件。这是一种让浏览器知道某个资源肯定很快就会被需要的方式。</p><p id="7911" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Preload可确保使用此优先级提示指定的资源更早可用，并且不太可能阻塞页面的呈现，最终提高性能。</p><p id="fb9a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是如何工作的？</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ll lm l"/></div></figure><pre class="jd je jf jg fd ln lo lp lq aw lr bi"><span id="df2f" class="ls kf hh lo b fi lt lu l lv lw">&lt;link rel="preload" href="myStyles.css" as="style"&gt;</span></pre><p id="1cf5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们看看上面使用的属性，</p><ul class=""><li id="fb40" class="jq jr hh ig b ih ii il im ip js it jt ix ju jb jv jw jx jy bi translated"><strong class="ig hi"> rel </strong>属性赋予预加载到<strong class="ig hi">链接</strong>指令的权力。</li><li id="5580" class="jq jr hh ig b ih jz il ka ip kb it kc ix kd jb jv jw jx jy bi translated">我们在<strong class="ig hi"> href </strong>属性中指定资源目的地。</li><li id="8358" class="jq jr hh ig b ih jz il ka ip kb it kc ix kd jb jv jw jx jy bi translated"><strong class="ig hi">作为</strong>用于指定资源类型。</li></ul><p id="9d34" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> as </strong>一个属性有多个可用值，如音频、字体、图像、脚本、视频、工作者、轨道、脚本、嵌入。</p><p id="e92f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">什么时候应该使用预载？</p><p id="67ce" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Preload告诉浏览器尽快下载并缓存资源(如脚本或样式表)。当您在加载页面后几秒钟就需要该资源，并希望加快速度时，这很有帮助。浏览器对下载的资源不起作用。以下是它可能有所帮助的场景。</p><ul class=""><li id="881a" class="jq jr hh ig b ih ii il im ip js it jt ix ju jb jv jw jx jy bi translated">字体的早期加载</li><li id="7520" class="jq jr hh ig b ih jz il ka ip kb it kc ix kd jb jv jw jx jy bi translated">不执行的动态加载</li><li id="1e5b" class="jq jr hh ig b ih jz il ka ip kb it kc ix kd jb jv jw jx jy bi translated">响应加载</li></ul><p id="e15b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用预加载时，我们需要注意哪些事项？</p><ul class=""><li id="f171" class="jq jr hh ig b ih ii il im ip js it jt ix ju jb jv jw jx jy bi translated"><strong class="ig hi"> &lt; link &gt; </strong>元素可以接受一个<strong class="ig hi"> type </strong>属性，该属性包含元素指向的资源的MIME类型。这在预加载资源时特别有用——浏览器将使用type属性值来确定它是否支持该资源，如果支持，则只下载它，如果不支持，则忽略它。</li><li id="c8b9" class="jq jr hh ig b ih jz il ka ip kb it kc ix kd jb jv jw jx jy bi translated">确保您最终使用的是通过PRELOAD加载的资源。否则，您的浏览器将开始抛出如下错误，</li></ul><pre class="jd je jf jg fd ln lo lp lq aw lr bi"><span id="e365" class="ls kf hh lo b fi lt lu l lv lw"><em class="jo">The resource </em><a class="ae jp" href="https://pl.%2A%2A%2A.com/wp-includes/%E2%80%A6(.css" rel="noopener ugc nofollow" target="_blank"><em class="jo">https://***.com/…(.css</em></a><em class="jo">, .js) was preloaded using link preload but not used within a few seconds from the window’s load event. Please make sure it has an appropriate ‘as’ value and it is preloaded intentionally.</em></span></pre><h1 id="b779" class="ke kf hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">预取</h1><pre class="jd je jf jg fd ln lo lp lq aw lr bi"><span id="e889" class="ls kf hh lo b fi lt lu l lv lw">&lt;link rel="prefetch" href="MyImage.jpeg" as="image"&gt;</span></pre><p id="b9d1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当您能够确定用户稍后可能会导航到的资源时，您可以使用预取浏览器提示来提前加载页面。这种技术依赖于在后台获取资源，并让浏览器缓存甚至服务工作器缓存来持久化请求。这样，当导航发生时，对该资源的网络请求被绕过。</p><p id="c2a4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">PREFETCH告诉浏览器它可以在后台获取一个页面，这样它就可以在被请求时运行。这里有点棘手，因为你必须预测你认为用户下一步会导航到哪里。如果你的预测是正确的，下一页可能会加载得很快。它出错了，你浪费了时间和资源去下载一些根本不需要的东西。如果用户使用的是计量连接，比如一个有限的移动电话计划，这实际上可能会花费他们的钱。</p><p id="5fa5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当预取发生时，浏览器进行DNS查找并建立服务器连接。然后它更进一步，请求并下载文件。现在，它停在这一点上。这些文件不会被解析或执行。他们只是被要求并保持随时可用。</p><p id="1e2e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可能会认为预取有点像将文件添加到浏览器的缓存中。当用户点击链接时，不需要去服务器下载，文件可以从内存中取出来，使用起来更快。</p><p id="9c34" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但是，什么时候应该使用它呢？</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lx lm l"/></div></figure><p id="a87b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当你对用户在你的网站上的导航有一定把握时，你应该使用它。此外，如果你认为加速导航会积极影响你的用户体验。这应该与可能获取不使用的资源而浪费资源的风险进行权衡。</p><h1 id="750a" class="ke kf hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated">预连接</h1><pre class="jd je jf jg fd ln lo lp lq aw lr bi"><span id="f679" class="ls kf hh lo b fi lt lu l lv lw">&lt;link rel="preconnect" href="https://my.sample.com"&gt;</span></pre><p id="00fc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为什么要预连接？</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="ly lm l"/></div></figure><p id="595c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">DNS预取的第一步是<em class="jo">将</em>预连接到服务器。建立与服务器的连接并托管资源需要几个步骤:</p><ul class=""><li id="5d31" class="jq jr hh ig b ih ii il im ip js it jt ix ju jb jv jw jx jy bi translated"><strong class="ig hi"> DNS查找</strong></li><li id="ebe5" class="jq jr hh ig b ih jz il ka ip kb it kc ix kd jb jv jw jx jy bi translated"><strong class="ig hi"> TCP握手</strong></li><li id="603b" class="jq jr hh ig b ih jz il ka ip kb it kc ix kd jb jv jw jx jy bi translated"><strong class="ig hi">HTTPS站点的TLS协商</strong></li></ul><p id="d7bb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这通常在每台服务器上发生一次，并且会占用大量宝贵的时间，尤其是在服务器距离浏览器非常远并且网络延迟非常高的情况下。预先连接到服务器可以确保当浏览器到达需要资源的页面部分时，与该服务器建立连接的缓慢工作已经开始，并且线路已经打开并准备就绪。</p><p id="f613" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">好吧！那么，什么时候应该使用预连接呢？</p><p id="0f4a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jp" href="https://caniuse.com/?search=preconnect" rel="noopener ugc nofollow" target="_blank">浏览器支持非常好</a>如果浏览器不支持PRECONNECT也没有什么坏处——体验不会有任何改变。当您确定将使用某个资源，并且希望提前做好准备时，可以考虑使用PRECONNECT。</p><p id="157f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">与预取中的情况一样，注意不要预连接，也不要使用该连接。这将会降低你的页面速度，并占用你所连接的服务器上的少量资源。</p><h1 id="e3ce" class="ke kf hh bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb bi translated"><strong class="ak">关闭思路</strong></h1><p id="1f60" class="pw-post-body-paragraph ie if hh ig b ih lg ij ik il lh in io ip li ir is it lj iv iw ix lk iz ja jb ha bi translated">重要的是要记住这些提示仅仅是这些；浏览器优化性能的<strong class="ig hi">方法提示</strong>。它们不是命令。浏览器接受这些建议，并使用其最佳判断来决定如何响应。</p><p id="0a98" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这可能意味着在繁忙或过载的设备上，浏览器根本不会尝试响应提示。</p><p id="70ea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但是，还有一个与资源提示相关的风险。由于代码是隐蔽的，不会被发现，所以页面很容易在将来改变，而不更新可能变得不相关的资源提示。</p><p id="5793" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以，明智地使用它们吧！</p></div></div>    
</body>
</html>