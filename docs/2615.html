<html>
<head>
<title>Fixing empty main from ReadBuildInfo on Golang 1.18</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Golang 1.18上修复ReadBuildInfo中的空main</h1>
<blockquote>原文：<a href="https://medium.easyread.co/fixing-empty-main-from-readbuildinfo-on-golang-1-18-ed8d1d671c5d?source=collection_archive---------3-----------------------#2022-08-10">https://medium.easyread.co/fixing-empty-main-from-readbuildinfo-on-golang-1-18-ed8d1d671c5d?source=collection_archive---------3-----------------------#2022-08-10</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/745a7c3fbac73cae9a88ca995c261de7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XwnCe6sFIa3_gK8qa80-wA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Image by wikipedia.org</figcaption></figure><p id="d3e8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">大家好！再次与我分享一些经验，尽管或者关于软件工程领域相关技术的看法。今天，我将分享我在Golang版本上从ReadBuildInfo()读取一些数据时解决一个问题的经验。</p><p id="ea4b" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">那么，问题是什么？先说我为什么用这个功能的背景。情况是我想读取一些项目的模块名。</p><p id="36cd" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">带有go模块名<code class="fe kx ky kz la b">example/readbuildinfo</code>的代码如下所示:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="b3fb" class="lj lk in la b gy ll lm l ln lo"><strong class="la io">package </strong>main<br/><br/><strong class="la io">import </strong>(<br/>   <strong class="la io">"encoding/json"<br/>   "log"<br/>   "runtime/debug"<br/></strong>)<br/><br/><strong class="la io">func </strong>main() {<br/>   info, ok := debug.ReadBuildInfo()<br/>   <strong class="la io">if </strong>!ok {<br/>      log.Fatalf(<strong class="la io">"failed to get build info\n"</strong>)<br/>   }<br/><br/>   b, err := json.MarshalIndent(info, <strong class="la io">""</strong>, <strong class="la io">"\t"</strong>)<br/>   <strong class="la io">if </strong>err != nil {<br/>      log.Fatalf(<strong class="la io">"failed to marshall: %s\n"</strong>, err)<br/>   }<br/><br/>   log.Println(string(b))<br/>}</span></pre><p id="8dcc" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">如果我们运行<code class="fe kx ky kz la b">go run main.go</code>，那么它将返回:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="1bb7" class="lj lk in la b gy ll lm l ln lo">{<br/> "Path": "command-line-arguments",<br/> "Main": {<br/>  "Path": "example/readbuildinfo",<br/>  "Version": "(devel)",<br/>  "Sum": "",<br/>  "Replace": null<br/> },<br/> "Deps": null<br/>}</span></pre><p id="01c0" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">是的，在Main下，我们可以在Path字段中获得模块名，所以没有问题！</p><p id="eccc" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">但是，在对另一个项目做了同样的事情后，它并不顺利。查了下有什么区别，貌似是因为Golang版本的原因。早期的项目用的是1.16版本，进展不顺利的项目用的是1.18。这是使用1.18的项目的输出:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="8e4c" class="lj lk in la b gy ll lm l ln lo">{<br/> "GoVersion": "go1.18.5",<br/> "Path": "command-line-arguments",<br/> "Main": {<br/>  "Path": "",<br/>  "Version": "",<br/>  "Sum": "",<br/>  "Replace": null<br/> },<br/> "Deps": null,<br/> "Settings": [{<br/>   "Key": "-compiler",<br/>   "Value": "gc"<br/>  },<br/>  {<br/>   "Key": "CGO_ENABLED",<br/>   "Value": "1"<br/>  },<br/>  {<br/>   "Key": "CGO_CFLAGS",<br/>   "Value": ""<br/>  },<br/>  {<br/>   "Key": "CGO_CPPFLAGS",<br/>   "Value": ""<br/>  },<br/>  {<br/>   "Key": "CGO_CXXFLAGS",<br/>   "Value": ""<br/>  },<br/>  {<br/>   "Key": "CGO_LDFLAGS",<br/>   "Value": ""<br/>  },<br/>  {<br/>   "Key": "GOARCH",<br/>   "Value": "arm64"<br/>  },<br/>  {<br/>   "Key": "GOOS",<br/>   "Value": "linux"<br/>  }<br/> ]<br/>}</span></pre><p id="d9cd" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">有点跑题了；为了方便地切换Go版本，我们可以使用Docker来运行这个简单的脚本。以下是Dockerfile文件的示例:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="41b2" class="lj lk in la b gy ll lm l ln lo"><strong class="la io">FROM </strong>golang:1.18<br/><br/><strong class="la io">WORKDIR /</strong>go<strong class="la io">/</strong>src<strong class="la io">/</strong>app<br/><strong class="la io">ADD </strong>. <strong class="la io">/</strong>go<strong class="la io">/</strong>src<strong class="la io">/</strong>app<br/><br/><strong class="la io">CMD </strong>[<strong class="la io">"go"</strong>,<strong class="la io">"run"</strong>,<strong class="la io">"main.go"</strong>]</span></pre><p id="1b08" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">这是构建它的命令:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="37fc" class="lj lk in la b gy ll lm l ln lo">docker build -t readbuildinfo .</span></pre><p id="4b99" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">对于运行镜像可以使用这个命令:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="91fa" class="lj lk in la b gy ll lm l ln lo">docker run readbuildinfo</span></pre><p id="efa8" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">回到主话题:然后在寻找解决方案后发现了这个问题<a class="ae lp" href="https://github.com/golang/go/issues/51831#issuecomment-1074188363" rel="noopener ugc nofollow" target="_blank">https://github . com/golang/go/issues/51831 # issue comment-1074188363</a></p><p id="d023" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">接下来，当使用特定文件和仅使用点(.)</p><p id="3bb2" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">将运行命令从:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="6c1c" class="lj lk in la b gy ll lm l ln lo">go run main.go</span></pre><p id="620e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">收件人:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="96fa" class="lj lk in la b gy ll lm l ln lo">go run .</span></pre><p id="641e" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">然后它显示:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="db0b" class="lj lk in la b gy ll lm l ln lo">{<br/> "GoVersion": "go1.18.5",<br/> "Path": "example/readbuildinfo",<br/> "Main": {<br/>  "Path": "example/readbuildinfo",<br/>  "Version": "(devel)",<br/>  "Sum": "",<br/>  "Replace": null<br/> },<br/> "Deps": null,<br/> "Settings": [{<br/>   "Key": "-compiler",<br/>   "Value": "gc"<br/>  },<br/>  {<br/>   "Key": "CGO_ENABLED",<br/>   "Value": "1"<br/>  },<br/>  {<br/>   "Key": "CGO_CFLAGS",<br/>   "Value": ""<br/>  },<br/>  {<br/>   "Key": "CGO_CPPFLAGS",<br/>   "Value": ""<br/>  },<br/>  {<br/>   "Key": "CGO_CXXFLAGS",<br/>   "Value": ""<br/>  },<br/>  {<br/>   "Key": "CGO_LDFLAGS",<br/>   "Value": ""<br/>  },<br/>  {<br/>   "Key": "GOARCH",<br/>   "Value": "arm64"<br/>  },<br/>  {<br/>   "Key": "GOOS",<br/>   "Value": "linux"<br/>  }<br/> ]<br/>}</span></pre><p id="ca29" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">耶！它起作用了！！对于docker文件，只需更改这一行:</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="0353" class="lj lk in la b gy ll lm l ln lo"><strong class="la io">CMD </strong>[<strong class="la io">"go"</strong>,<strong class="la io">"run"</strong>,<strong class="la io">"main.go"</strong>]</span></pre><p id="85a4" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">到</p><pre class="lb lc ld le gt lf la lg lh aw li bi"><span id="6f00" class="lj lk in la b gy ll lm l ln lo"><strong class="la io">CMD </strong>[<strong class="la io">"go"</strong>,<strong class="la io">"run"</strong>,<strong class="la io">"."</strong>]</span></pre><blockquote class="lq lr ls"><p id="8e1d" class="jz ka lt kb b kc kd ke kf kg kh ki kj lu kl km kn lv kp kq kr lw kt ku kv kw ig bi translated">实际上我也试着检查了1.19版本，但是1.19的行为在1.18版本中保持不变。</p></blockquote><p id="e00a" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">希望你喜欢它，如果这篇文章对你有用，我很高兴！</p><p id="35bc" class="pw-post-body-paragraph jz ka in kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw ig bi translated">谢谢大家！</p></div></div>    
</body>
</html>