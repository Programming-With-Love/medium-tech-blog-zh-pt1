<html>
<head>
<title>Build Oracle Graph on Docker (Part 2/2, version 22.3)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Docker上构建Oracle图形(第2/2部分，版本22.3)</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/build-oracle-graph-on-docker-part-2-2-407827b0b93?source=collection_archive---------0-----------------------#2021-12-14">https://medium.com/oracledevs/build-oracle-graph-on-docker-part-2-2-407827b0b93?source=collection_archive---------0-----------------------#2021-12-14</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/5763fceca5bc7aa9f1b867cbd1345308.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AKA5fGMBXU8jHYgljlpMDw.jpeg"/></div></div></figure><p id="72d7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">(该程序已在版本22.3.0中测试过。<strong class="ir hi">更新版本请见</strong> <a class="ae jn" href="https://ryotayamanaka.medium.com/14209d23574e" rel="noopener"> <strong class="ir hi">本文</strong> </a> <strong class="ir hi">。</strong>)</p><p id="1c0f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在<a class="ae jn" rel="noopener" href="/oracledevs/build-oracle-graph-on-docker-part-1-2-5fcacaca430e">第1部分</a>中，我解释了如何在容器上运行Oracle数据库，并将其用作图形数据库。仅在这个环境中就有各种各样的方法来使用它，比如将表数据转换成图形，创建视图，甚至将它与JSON结合起来，我将在以后介绍。</p><p id="f5e0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然而，本文将只关注解释为Graph Server构建和添加容器的过程。在下面的架构图中，我们已经构建了2层部署，现在我们将添加3层部署。</p><figure class="jp jq jr js fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es jo"><img src="../Images/93eb35e930e990a72c756d8b9348201c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GZLOqIeqmM8CvH-M-l3fFw.png"/></div></div></figure><p id="23dc" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">构建图形服务器</strong></p><p id="1cad" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">从这个站点下载包含Graph Server和Graph Viz的RPM包。当您选择下面的软件包时，将要求您同意许可并使用您的Oracle帐户登录。</p><ul class=""><li id="0fb8" class="jt ju hh ir b is it iw ix ja jv je jw ji jx jm jy jz ka kb bi translated">Oracle图形服务器</li></ul><p id="6a69" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">另外，从<a class="ae jn" href="https://www.oracle.com/java/technologies/downloads/#java11" rel="noopener ugc nofollow" target="_blank">这个网站</a>下载JDK 11。个人或开发使用无需支付许可费。</p><ul class=""><li id="90b5" class="jt ju hh ir b is it iw ix ja jv je jw ji jx jm jy jz ka kb bi translated">Linux - x64 RPM软件包</li></ul><p id="9529" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">将这些RPM包和您接下来将创建的Dockerfile文件放在同一个目录中。</p><ul class=""><li id="c23d" class="jt ju hh ir b is it iw ix ja jv je jw ji jx jm jy jz ka kb bi translated">oracle-graph-22.3.0.x86_64.rpm</li><li id="3ac1" class="jt ju hh ir b is kc iw kd ja ke je kf ji kg jm jy jz ka kb bi translated">甲骨文-图形-客户端-22.3.0.zip</li><li id="5a1b" class="jt ju hh ir b is kc iw kd ja ke je kf ji kg jm jy jz ka kb bi translated">jdk-11.x.xx_linux-x64_bin.rpm</li></ul><pre class="jp jq jr js fd kh ki kj bn kk kl bi"><span id="4276" class="km kn hh ki b be ko kp l kq kr">vi Dockerfile</span></pre><p id="37f3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这是一个示例Dockerfile文件。</p><pre class="jp jq jr js fd kh ki kj bn kk kl bi"><span id="e472" class="km kn hh ki b be ko kp l kq kr">FROM oraclelinux:7<br/>ARG VERSION_JDK<br/>ARG VERSION_GSC<br/>COPY ./jdk-${VERSION_JDK}_linux-x64_bin.rpm /tmp<br/>COPY ./oracle-graph-${VERSION_GSC}.x86_64.rpm /tmp<br/>COPY ./oracle-graph-client-${VERSION_GSC}.zip /tmp<br/>RUN yum install -y unzip numactl vim python3 python3-devel gcc openssl \<br/> &amp;&amp; yum clean all \<br/> &amp;&amp; rm -rf /var/cache/yum/* \<br/> &amp;&amp; rpm -ivh /tmp/jdk-${VERSION_JDK}_linux-x64_bin.rpm \<br/> &amp;&amp; rpm -ivh /tmp/oracle-graph-${VERSION_GSC}.x86_64.rpm<br/>ENV JAVA_HOME=/usr/java/jdk-${VERSION_JDK}<br/>ENV PATH=$PATH:/opt/oracle/graph/bin<br/>ENV SSL_CERT_FILE=/etc/oracle/graph/ca_certificate.pem<br/>RUN keytool -alias pgx -import -trustcacerts \<br/>    -keystore $JAVA_HOME/lib/security/cacerts -storepass changeit \<br/>    -file /etc/oracle/graph/ca_certificate.pem -noprompt \<br/> &amp;&amp; pip3 install wheel \<br/> &amp;&amp; pip3 install /tmp/oracle-graph-client-${VERSION_GSC}.zip<br/>EXPOSE 7007<br/>WORKDIR /opt/oracle/graph/bin<br/>CMD ["sh", "/opt/oracle/graph/pgx/bin/start-server"]</span></pre><p id="94bb" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">构建映像，用适当的版本号替换JDK版本<code class="du ks kt ku ki b">&lt;version_of_JDK&gt;</code>，比如<code class="du ks kt ku ki b">11.0.16</code>。</p><pre class="jp jq jr js fd kh ki kj bn kk kl bi"><span id="8c65" class="km kn hh ki b be ko kp l kv kr">docker build . \<br/>-f Dockerfile-graph-server \<br/>--tag graph-server:22.3.0 \<br/>--build-arg VERSION_GSC=22.3.0 \<br/>--build-arg VERSION_JDK=&lt;version_of_JDK&gt;</span></pre><p id="ead7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">一旦构建了映像，就创建一个容器。此时，日志将显示错误消息，因为数据库连接的JDBC URL尚未配置。</p><pre class="jp jq jr js fd kh ki kj bn kk kl bi"><span id="f058" class="km kn hh ki b be ko kp l kq kr">docker run \<br/>--name graph-server \<br/>--publish 7007:7007 \<br/>graph-server:22.3.0</span></pre><p id="3226" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">从新控制台连接到容器并编辑JDBC URL。</p><pre class="jp jq jr js fd kh ki kj bn kk kl bi"><span id="0299" class="km kn hh ki b be ko kp l kq kr">$ docker exec -it graph-server /bin/bash<br/># vi /etc/oracle/graph/pgx.conf</span></pre><p id="cedd" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><code class="du ks kt ku ki b">pgx.conf</code>:</p><pre class="jp jq jr js fd kh ki kj bn kk kl bi"><span id="8325" class="km kn hh ki b be ko kp l kq kr">"jdbc_url": "jdbc:oracle:thin:@host.docker.internal:1521/xepdb1",</span></pre><p id="baee" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">回到主机并重新启动图形服务器容器。请确认这次日志没有显示任何错误消息。</p><pre class="jp jq jr js fd kh ki kj bn kk kl bi"><span id="4f48" class="km kn hh ki b be ko kp l kq kr"># exit<br/>$ docker restart graph-server<br/>$ docker logs -f graph-server<br/>...<br/>INFO: Starting ProtocolHandler ["https-jsse-nio-7007"]</span></pre><p id="ec8a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">登录图形即</strong></p><p id="a976" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，您可以从web浏览器登录图形可视化。</p><ul class=""><li id="0b6c" class="jt ju hh ir b is it iw ix ja jv je jw ji jx jm jy jz ka kb bi translated"><a class="ae jn" href="https://localhost:7007/ui/" rel="noopener ugc nofollow" target="_blank">https://localhost:7007/ui/</a></li></ul><p id="8b76" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">由于自签名证书，您将看到一条安全警告。所以你必须继续:</p><ul class=""><li id="75ad" class="jt ju hh ir b is it iw ix ja jv je jw ji jx jm jy jz ka kb bi translated">Chrome:在屏幕上输入“thisisunsafe”</li><li id="029a" class="jt ju hh ir b is kc iw kd ja ke je kf ji kg jm jy jz ka kb bi translated">火狐:高级&gt;接受风险并继续</li></ul><p id="7975" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">以您之前创建的数据库用户身份登录。</p><pre class="jp jq jr js fd kh ki kj bn kk kl bi"><span id="fab2" class="km kn hh ki b be ko kp l kq kr">- User: graphuser<br/>- Password: Welcome1 (if you set it as described in Part1)<br/>- Advanced Options:<br/>  - Database<br/>  - jdbc:oracle:thin:@host.docker.internal:1521/xepdb1</span></pre><p id="4357" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了可视化前一篇文章中创建的图<code class="du ks kt ku ki b">GRAPH1</code>,执行下面的PGQL查询。</p><pre class="jp jq jr js fd kh ki kj bn kk kl bi"><span id="f876" class="km kn hh ki b be ko kp l kq kr">SELECT v1.name, v2.brand, e.since<br/>FROM MATCH (v1)-[e]-&gt;(v2)<br/>LIMIT 100</span></pre><p id="b05b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您可以右键单击节点或边来查看其属性值。</p><figure class="jp jq jr js fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kw"><img src="../Images/4bec4ecf7677054cb9936107d5cc9201.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3KZoXE7LNFGwqOM3o5463w.jpeg"/></div></div></figure><p id="c525" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们现在已经为Oracle Graph创建了一个环境。让我们使用这个环境来讨论图形数据库的各种用例，我将在以后的文章中介绍这些用例。</p></div><div class="ab cl kx ky go kz" role="separator"><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc ld"/><span class="la bw bk lb lc"/></div><div class="ha hb hc hd he"><p id="7449" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">请从以下网址了解更多关于Oracle Graph 的信息:</p><ul class=""><li id="fd37" class="jt ju hh ir b is it iw ix ja jv je jw ji jx jm jy jz ka kb bi translated"><a class="ae jn" rel="noopener" href="/tag/oracle-graph">中</a> (=所有带有Oracle Graph标签的文章)</li><li id="5997" class="jt ju hh ir b is kc iw kd ja ke je kf ji kg jm jy jz ka kb bi translated"><a class="ae jn" href="https://stackoverflow.com/questions/tagged/oracle-graph" rel="noopener ugc nofollow" target="_blank">堆栈溢出</a> (=带oracle-graph标签的问题)</li><li id="fed5" class="jt ju hh ir b is kc iw kd ja ke je kf ji kg jm jy jz ka kb bi translated"><a class="ae jn" href="https://join.slack.com/t/andouc/shared_invite/zt-1a2hmiz6f-vLlblcQyv0t9FMraMMP5uQ" rel="noopener ugc nofollow" target="_blank"> Slack AnDOUC </a> (=邀请链接，请访问#graph)</li><li id="e074" class="jt ju hh ir b is kc iw kd ja ke je kf ji kg jm jy jz ka kb bi translated"><a class="ae jn" href="https://join.slack.com/t/oracledevrel/shared_invite/zt-1nwqm6cdi-cxr~JN9YOtmBh3sarhOZvg" rel="noopener ugc nofollow" target="_blank"> Slack OracleDevRel </a> (=邀请链接，请访问#oracle-db-graph)</li></ul></div></div>    
</body>
</html>