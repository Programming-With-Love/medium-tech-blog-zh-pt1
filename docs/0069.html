<html>
<head>
<title>Rearchitecting Airbnb’s Frontend</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">重新构建Airbnb的前端</h1>
<blockquote>原文：<a href="https://medium.com/airbnb-engineering/rearchitecting-airbnbs-frontend-5e213efc24d2?source=collection_archive---------0-----------------------#2017-05-15">https://medium.com/airbnb-engineering/rearchitecting-airbnbs-frontend-5e213efc24d2?source=collection_archive---------0-----------------------#2017-05-15</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="c875" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">概述:我们最近重新考虑了我们在Airbnb的代码库的JavaScript方面的架构。本文将研究(1)促成这些变化的产品驱动因素，(2)我们为摆脱传统Rails解决方案而采取的步骤，以及(3)新堆栈的一些关键支柱。<em class="jc">奖金:我们来谈谈下一步吧！</em></p></div><div class="ab cl jd je go jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="ha hb hc hd he"><p id="bbd4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Airbnb每天的搜索量超过7500万次，这使得搜索页面成为我们流量最高的页面。近十年来，工程师们对Rails提供页面的方式进行了改进、增强和优化。</p><p id="017f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最近，我们进入了Homes以外的垂直市场，推出了Experiences and Places 。作为将这些新产品引入网络的一部分，我们花时间重新思考了搜索体验本身。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es jl"><img src="../Images/99dec49b15b83aa422c5aa216100faf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*VMRwDmHVeYC3YnJhhtKn4Q.gif"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx">Transitioning between routes for a broad search</figcaption></figure><p id="3ab6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">与其从我们在www.airbnb.com T4的登陆页面导航到搜索结果页面，再到单个列表，再到预订流程，我们希望用户体验是灵活的，随着用户探索和缩小搜索范围，可以调整他们的体验。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es kb"><img src="../Images/9e338b8d6c693ed051d4b210fc563fdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*epBwi0kxrcW5a6Wv-T4rSg.gif"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx">Designs exploring search from three states: New User, Returning User, and Marketing Marquee</figcaption></figure><p id="cdf6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在标签间导航并与列表互动应该感觉奢华而轻松。事实上，今天没有什么能阻止我们在中小型屏幕上提供与本地应用程序相当的体验。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es kc"><img src="../Images/021115133b30cc0980ca6327a6f92860.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*y_gKoEDVvBvJpGq7hfcr_g.gif"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx">Future concept for navigating between tabs, considering async-loaded of content</figcaption></figure><p id="6f7c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了获得这种类型的经验，我们需要打破传统的逐页方法，最终我们对前端代码进行了基本的重组。</p><p id="0fe5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="kd ke ge" href="https://medium.com/u/41a8b1601c59?source=post_page-----5e213efc24d2--------------------------------" rel="noopener" target="_blank"> Leland Richardson </a> <a class="ae jk" href="https://www.youtube.com/watch?v=tWitQoPgs8w" rel="noopener ugc nofollow" target="_blank">最近在React Conf上谈到了在现有的高流量本机应用程序</a>的“棕地”中的React Native。本文将研究我们是如何在类似的约束条件下，但在web上进行戏剧性的升级的。如果你发现自己处在一个相似的地方，希望你会发现它很有用！</p><h1 id="2458" class="kf kg hh bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">挣脱铁轨</h1><p id="21a7" class="pw-post-body-paragraph ie if hh ig b ih ld ij ik il le in io ip lf ir is it lg iv iw ix lh iz ja jb ha bi translated">在为我们路线图上的所有有趣的<a class="ae jk" href="https://developers.google.com/web/progressive-web-apps/" rel="noopener ugc nofollow" target="_blank">渐进式Web应用</a>工作而大放异彩之前，我们需要与Rails分离(或者至少是我们在Airbnb使用Rails提供独立页面的方式)。</p><p id="c75b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">不幸的是，就在几个月前，我们的搜索页面包含了一些非常旧的代码…比如,<em class="jc">指环王</em>，危险时刻触摸。有趣的事实:我曾经用一个简单的React组件替换了一个由Rails presenter支持的小的<a class="ae jk" href="http://handlebarsjs.com/" rel="noopener ugc nofollow" target="_blank">手柄</a>模板，突然页面上完全独立的部分出现了问题——甚至在我们的API响应中也是如此！结果是，演示者改变了backing Rails模型，该模型多年来一直影响着所有下游数据，甚至在UI没有呈现的时候也是如此。</p><p id="af2c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">简而言之，我们在这个项目中就像印第安纳·琼斯把神像换成了一袋沙子，神庙立即开始坍塌，我们从一块巨石上逃跑。</p><h2 id="ed9f" class="li kg hh bd kh lj lk ll kl lm ln lo kp ip lp lq kt it lr ls kx ix lt lu lb lv bi translated">步骤1:对齐API数据</h2><p id="ad51" class="pw-post-body-paragraph ie if hh ig b ih ld ij ik il le in io ip lf ir is it lg iv iw ix lh iz ja jb ha bi translated">当Rails对页面进行服务器呈现时，您可以随心所欲地向服务器呈现的React组件发送数据。控制器、助手和演示者可以生成任何形状的数据，甚至当您迁移页面的各个部分以做出反应时，每个组件都可以使用它所需要的任何数据。</p><p id="a825" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但是，一旦您努力在客户端呈现路由，您就需要能够以预先确定的形式动态地请求所需的数据。将来，我们可能会用类似于<a class="ae jk" href="http://graphql.org/" rel="noopener ugc nofollow" target="_blank"> GraphQL </a>的东西来解决这个问题，但是让我们暂时把它放在一边，因为当这个重构发生的时候，它不是一个选项。相反，我们选择与API的“v2”保持一致，并且我们需要所有的组件来开始使用这种规范的数据形式。</p><p id="6777" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您发现自己在类似的水域中有一个大型应用程序，您可能会像我们一样发现，规划现有服务器端数据管道的迁移是容易的部分。只需遍历Rails呈现React组件的任何地方，并确保数据输入是API形状。您可以进一步验证是否符合在客户端上用作React属性类型的API V2形状。</p><p id="91d2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对我们来说，棘手的是与所有与客人预订流程互动的团队合作:我们的商务旅行、增长和度假租赁团队；我们针对中国和印度市场的团队、灾难恢复……这样的例子不胜枚举，我们需要对所有这些人进行再教育，即使在技术上可以将数据直接传递给正在渲染的组件(“是的，我知道这只是一个实验，但是……”)<em class="jc">所有数据</em>都需要通过API。</p><h2 id="d4f5" class="li kg hh bd kh lj lk ll kl lm ln lo kp ip lp lq kt it lr ls kx ix lt lu lb lv bi translated">第二步:非API数据:配置，实验，短语，L10n，I18n…</h2><p id="124d" class="pw-post-body-paragraph ie if hh ig b ih ld ij ik il le in io ip lf ir is it lg iv iw ix lh iz ja jb ha bi translated">从我们认为的API数据中有一个单独的数据类别，它包括应用程序配置、用户特定的实验任务、国际化、本地化和类似的问题。多年来，Airbnb已经建立了一些令人难以置信的工具来支持所有这些功能，但将它们交付给前端的机制有点欠成熟(或者在建立时可能已经完全成熟，在地面开始移动之前！).</p><p id="40ff" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们使用<a class="ae jk" href="https://www.npmjs.com/package/hypernova" rel="noopener ugc nofollow" target="_blank"> Hypernova </a>对React进行服务器渲染，但是在我们深入进行这种重构之前，React组件中的实验交付是否会在服务器渲染期间爆炸，或者客户端上可用的字符串翻译是否会在服务器上可靠地可用，这还有点模糊。关键的是，如果服务器和客户端输出不匹配，页面不仅会刷新差异，还会在加载后重新呈现整个页面，这对性能非常不利。</p><p id="1cf9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">更糟糕的是，我们在很久以前就编写了一些神奇的Rails函数，例如<code class="du lw lx ly lz b">add_bootstrap_data(key, value)</code>，表面上可以在Rails中的任何地方调用这些函数，以便通过<code class="du lw lx ly lz b">BootstrapData.get(key)</code>在客户端上全局提供数据(不过，同样，对于Hypernova来说不一定如此)。对于一个小团队来说，开始是一个有用的工具，但对于一个大的应用程序和团队来说，却成了不可追踪的魔法的来源。“数据清洗”犯罪变得越来越棘手，因为每个团队都拥有不同的页面或功能，因此每个团队都开发了不同的机制来加载配置，每个机制都适合他们独特的需求。</p><p id="44ea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">很明显，这已经被打破了，所以我们集中在引导非API数据的规范机制上，我们开始将所有应用/页面迁移到Rails和React/Hypernova之间的这个移交。</p><figure class="jm jn jo jp fd jq"><div class="bz dy l di"><div class="ma mb l"/></div><figcaption class="jx jy et er es jz ka bd b be z dx">A canonical higher order component for bootstrapping non-API data</figcaption></figure><p id="1d27" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这个高阶元件有两个非常重要的作用:</p><ol class=""><li id="d266" class="mc md hh ig b ih ii il im ip me it mf ix mg jb mh mi mj mk bi translated">它以普通的旧JavaScript对象的形式接收引导数据的规范形式，并为服务器渲染和客户端渲染同样正确地初始化所有支持工具。</li><li id="45f0" class="mc md hh ig b ih ml il mm ip mn it mo ix mp jb mh mi mj mk bi translated">它吞掉了除了<code class="du lw lx ly lz b">bootstrapData</code>之外的所有东西，这是另一个简单的对象，我们希望<code class="du lw lx ly lz b">&lt;App&gt;</code>加载到Redux中，供孩子们在需要时使用(代替<code class="du lw lx ly lz b">BootstrapData.get</code>)。</li></ol><p id="9b3a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在一个简单的例子中，我们取消了<code class="du lw lx ly lz b">add_bootstrap_data</code>，并防止工程师将任意键传递给顶级React组件。shire恢复了秩序，不久我们就可以在客户端动态导航到路线，并在没有Rails支持的情况下呈现复杂的内容(双关语)。</p><h1 id="88c6" class="kf kg hh bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">给前端充电</h1><p id="f87f" class="pw-post-body-paragraph ie if hh ig b ih ld ij ik il le in io ip lf ir is it lg iv iw ix lh iz ja jb ha bi translated">手头的服务器改造，我们现在把目光转向客户端。</p><h2 id="f359" class="li kg hh bd kh lj lk ll kl lm ln lo kp ip lp lq kt it lr ls kx ix lt lu lb lv bi translated">懒惰加载的单页应用程序</h2><p id="60dd" class="pw-post-body-paragraph ie if hh ig b ih ld ij ik il le in io ip lf ir is it lg iv iw ix lh iz ja jb ha bi translated">朋友们，在初始化时使用可怕的加载微调器的怪物单页应用程序(SPA)的日子已经一去不复返了。当我们提出用React Router进行客户端路由的想法时，这种可怕的加载旋转器是许多人提出的异议。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es mq"><img src="../Images/b9e0938517755030652b1f89da0e4a08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O2fK16vfyWaDT-IR61drPw.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx">Lazy loading of route bundles in the Chrome Timeline</figcaption></figure><p id="2c32" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但是如果你看上面，你会看到<a class="ae jk" href="https://webpack.github.io/docs/code-splitting.html" rel="noopener ugc nofollow" target="_blank">代码分割</a>和<a class="ae jk" href="https://webpack.js.org/guides/lazy-load-react/" rel="noopener ugc nofollow" target="_blank">延迟加载</a>包的影响。本质上，我们通过服务器呈现页面，并提供使其在浏览器中交互所需的最低限度的JavaScript，然后当浏览器空闲时，我们开始主动下载其余的内容。</p><p id="1170" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在铁路方面，我们有一个控制器用于通过SPA交付的所有路线。每个动作只负责(1)发出客户端在客户端导航上发出的任何API请求，然后(2)将数据和配置一起引导到Hypernova。我们从每个动作数千行Ruby代码(在控制器、助手和演示者之间)减少到大约20–30行。耶切。</p><p id="9485" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但是明显不同的不仅仅是代码…</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div role="button" tabindex="0" class="jr js di jt bf ju"><div class="er es mr"><img src="../Images/7c3299bcc32650c7278b6d6bbc627361.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*EpKNHdS4Xzl9fRdGekUgEA.gif"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx">Side-by-side comparison fetching Homes for Tokyo: Legacy page load vs client-side routing (4–5x difference)</figcaption></figure><p id="f013" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">…现在路线之间的转换非常流畅，步长变化也快了(大约5倍)，我们可以开始制作本文开头的动画了。</p><h2 id="8802" class="li kg hh bd kh lj lk ll kl lm ln lo kp ip lp lq kt it lr ls kx ix lt lu lb lv bi translated">异步组件</h2><p id="e320" class="pw-post-body-paragraph ie if hh ig b ih ld ij ik il le in io ip lf ir is it lg iv iw ix lh iz ja jb ha bi translated">在React之前，我们会一次呈现整个页面，这种做法一直延续到React早期。但是我们使用一个类似于<a class="ae jk" rel="noopener" href="/@thejameskyle/react-loadable-2674c59de178"> this </a>的AsyncComponent作为挂载后加载组件层次结构的一种方式。</p><figure class="jm jn jo jp fd jq"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="813f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这对于最初不可见的重元素特别有用，比如模态和面板。我们的明确目标是精确地提供最初呈现页面可见部分所需的JavaScript，并使其具有交互性，而不是多一行。这也意味着，举例来说，如果团队想在一个不使用D3的页面上的模态中使用D3，他们可以独立于页面的其余部分来衡量下载该库作为其模态代码的一部分的“成本”。</p><p id="3bd5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最重要的是，它非常简单，可以在任何需要的地方使用:</p><figure class="jm jn jo jp fd jq"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="beb3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这里，我们可以简单地将地图的同步版本替换为异步版本，这在小断点上特别有用，在小断点上，地图通过用户与按钮的交互来显示。由于这些用户大多使用手机，让他们在担心谷歌地图之前进行互动会大大加快页面加载时间。</p><p id="0453" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">另外，请注意<code class="du lw lx ly lz b">scheduleAsyncLoad()</code>实用程序，它在用户交互之前请求包。由于地图使用如此频繁，我们不需要等待用户交互来请求它。相反，我们可以在您到达住宅搜索路线时将其排队。如果用户在下载之前请求它，他们会看到一个合理的<code class="du lw lx ly lz b">&lt;Loader /&gt;</code>，直到组件可用。没问题。</p><p id="d2c0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这种方法的最后一个好处是<code class="du lw lx ly lz b">HomesSearch_Map</code>成为浏览器可以缓存的命名包。当我们分解更大的基于路线的包时，应用程序缓慢变化的部分在更新中保持不变，进一步节省了JavaScript下载时间。</p><h2 id="3075" class="li kg hh bd kh lj lk ll kl lm ln lo kp ip lp lq kt it lr ls kx ix lt lu lb lv bi translated">将易访问性融入我们的设计语言</h2><p id="32f5" class="pw-post-body-paragraph ie if hh ig b ih ld ij ik il le in io ip lf ir is it lg iv iw ix lh iz ja jb ha bi translated">毫无疑问，这需要一个专门的职位，但我们已经开始构建我们的内部组件库，将可访问性作为一个硬约束。在接下来的几个月里，我们将替换所有与屏幕阅读器兼容的访客流UI。</p><figure class="jm jn jo jp fd jq"><div class="bz dy l di"><div class="ma mb l"/></div><figcaption class="jx jy et er es jz ka bd b be z dx">An example of building accessibility into our product through our design language system</figcaption></figure><p id="5dd8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">UI足够丰富，以至于我们希望使用<code class="du lw lx ly lz b">aria-describedby</code>将复选框不仅与标题关联，还与副标题关联。要实现这一点，需要在DOM中有一个惟一的标识符，这意味着强制一个必需的ID作为任何调用父节点都需要提供的属性。这些是UI可以施加的硬约束类型，以确保如果在产品中使用了某个组件，那么该组件是以内置的可访问性交付的。</p><p id="0ce3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上面的代码还演示了我们的响应工具HideAt和ShowAt，它们允许我们显著地改变用户在不同屏幕尺寸下的体验，而不必使用CSS隐藏和显示。这导致页面更加精简。</p><h2 id="da93" class="li kg hh bd kh lj lk ll kl lm ln lo kp ip lp lq kt it lr ls kx ix lt lu lb lv bi translated">对国家进行外科手术和哲学思考</h2><p id="b966" class="pw-post-body-paragraph ie if hh ig b ih ld ij ik il le in io ip lf ir is it lg iv iw ix lh iz ja jb ha bi translated">如果不涉及如何处理应用程序状态的争论，任何一篇前端文章都是不完整的。</p><p id="a62d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们对所有API数据和“全局”使用Redux，比如认证状态和实验配置。我个人喜欢异步的<a class="ae jk" href="https://github.com/lelandrichardson/redux-pack" rel="noopener ugc nofollow" target="_blank"> redux-pack </a>。您的里程可能会有所不同。</p><p id="15e4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然而，考虑到页面的复杂性——尤其是在搜索方面——使用Redux进行表单元素之类的低级用户交互是行不通的。我们发现，无论我们如何优化，Redux循环都会让输入感觉响应不足。</p><figure class="jm jn jo jp fd jq er es paragraph-image"><div class="er es ms"><img src="../Images/7bd8585fa5f8f2bfa920f2f5cc6a46de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1338/format:webp/1*12LgecpKz8HA2e2evkYacw.png"/></div><figcaption class="jx jy et er es jz ka bd b be z dx">Our Room Type Filter (code featured above)</figcaption></figure><p id="9503" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，我们对用户所做的一切都使用组件本地状态，直到它触发路由更改或网络交互，我们没有遇到任何问题。</p><p id="f066" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">同时，我喜欢Redux容器组件的感觉，我们发现即使有本地状态，我们也可以构建可以共享的高阶组件。我们的过滤器就是一个很好的例子。搜索底特律的<a class="ae jk" href="https://www.airbnb.com/s/Detroit--MI--United-States/homes" rel="noopener ugc nofollow" target="_blank">住宅，你会在页面上发现几个不同的面板，每个都独立运行，可以修改你的搜索。跨越各种断点，实际上有几十个组件需要知道当前应用的搜索过滤器以及如何更新它们，无论是在用户交互期间暂时还是一旦被用户正式接受。</a></p><figure class="jm jn jo jp fd jq"><div class="bz dy l di"><div class="ma mb l"/></div></figure><p id="dde3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里我们有一个巧妙的技巧。需要与过滤器交互的每个组件都可以用这个HOC封装，这样就完成了。它甚至带有道具类型。每个组件从Redux连接到<em class="jc"> responseFilters </em>(与当前显示的结果相关联的那些)，但是保持本地stagedFilters对象可用于修改。</p><p id="1e12" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过这种方式处理状态，与价格滑块的交互对页面的其余部分没有影响，因此性能非常好。但是所有的过滤器面板都是用相同的函数签名实现的，所以开发很简单。</p><h1 id="5fb8" class="kf kg hh bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">下一步是什么？</h1><p id="dc3a" class="pw-post-body-paragraph ie if hh ig b ih ld ij ik il le in io ip lf ir is it lg iv iw ix lh iz ja jb ha bi translated">现在，让前端跟上现在的大部分工作已经完成，我们可以把注意力转向未来。</p><ul class=""><li id="5830" class="mc md hh ig b ih ii il im ip me it mf ix mg jb mt mi mj mk bi translated"><a class="ae jk" href="https://www.ampproject.org/" rel="noopener ugc nofollow" target="_blank"> AMP </a>核心预订流程中所有页面的版本将导致从移动网络上的谷歌搜索到交互的亚秒(在某些情况下)<em class="jc">时间</em>，而实现这一点所需的许多变化将推动移动网络和桌面网络上P50/P90/P95冷加载时间的显著改善。</li><li id="c2f7" class="mc md hh ig b ih ml il mm ip mn it mo ix mp jb mt mi mj mk bi translated"><a class="ae jk" href="https://developers.google.com/web/progressive-web-apps/" rel="noopener ugc nofollow" target="_blank"> PWA </a>功能将为回头客带来亚秒(在某些情况下)<em class="jc">的交互时间</em>，并将打开离线优先功能的大门，这对连接不稳定的用户非常重要。</li><li id="48e9" class="mc md hh ig b ih ml il mm ip mn it mo ix mp jb mt mi mj mk bi translated">对遗留技术/框架的最后一击将会把捆绑包的大小减半。不是华而不实的工作，而是最后把jQuery、Alt、Bootstrap、下划线，以及所有外部CSS请求都扒出来(它们阻挡渲染，97%的规则都没用！)不仅会简化我们发布的代码，还会简化新员工在成长过程中需要学习的内容。</li><li id="ca3d" class="mc md hh ig b ih ml il mm ip mn it mo ix mp jb mt mi mj mk bi translated">最后，约曼的工作是手动跟踪渲染瓶颈，异步加载初始渲染时不可见的代码，避免不必要的重新渲染，并降低重新渲染的成本。这些改进是笨拙的应用程序和运转良好的机器之间的区别。</li></ul><p id="366c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下次我们追踪这些机会时请继续收听。由于如此多的胜利将产生直接的数量影响，我们将在后续的帖子中尝试捕捉一些具体的胜利。</p></div><div class="ab cl jd je go jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="ha hb hc hd he"><p id="9e19" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jc">当然，如果你喜欢阅读这篇文章，并认为这是一个有趣的挑战，我们一直在寻找有才华、有好奇心的人加入</em><a class="ae jk" href="https://www.airbnb.com/careers/departments/engineering" rel="noopener ugc nofollow" target="_blank"><em class="jc"/></a><em class="jc">团队。或者，如果你只是想谈谈工作，随时在twitter上联系我</em><a class="ae jk" href="https://twitter.com/AdamRNeary" rel="noopener ugc nofollow" target="_blank"><em class="jc">@ adamrneary</em></a></p></div><div class="ab cl jd je go jf" role="separator"><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji jj"/><span class="jg bw bk jh ji"/></div><div class="ha hb hc hd he"><p id="bd52" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，巨大的道具给<a class="ae jk" href="https://twitter.com/therealsalih" rel="noopener ugc nofollow" target="_blank">萨利赫·阿卜杜勒·卡里姆</a>和<a class="ae jk" href="https://twitter.com/hugoahlberg" rel="noopener ugc nofollow" target="_blank">雨果·阿尔贝里</a>，他们是那些让我目不转睛的面部融化动画背后的经验设计师。许多工程师因在这项工作中发挥的作用而值得称赞，这份名单长得难以形容，但肯定包括尼克·索伦蒂诺、<a class="kd ke ge" href="https://medium.com/u/e52389684329?source=post_page-----5e213efc24d2--------------------------------" rel="noopener" target="_blank">乔·伦乔尼</a>、<a class="kd ke ge" href="https://medium.com/u/5fe7db9fe60f?source=post_page-----5e213efc24d2--------------------------------" rel="noopener" target="_blank">迈克尔·兰道</a>、张海晨、沃克·亨德森和尼科·莫斯乔普洛斯。</p></div></div>    
</body>
</html>