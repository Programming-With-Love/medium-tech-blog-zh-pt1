# 了解和控制 Oracle Commerce Cloud 中搜索结果的顺序

> 原文：<https://medium.com/oracledevs/understanding-and-controlling-the-order-of-search-results-in-oracle-commerce-cloud-813359864c0d?source=collection_archive---------1----------------------->

在 Oracle Commerce Cloud 中，我们让经销商和合作伙伴在很大程度上控制和影响搜索结果的处理和返回。然而，有一些相互关联的概念可能会引起混淆。

本文试图帮助您理解搜索结果是如何排序的，以及进一步控制结果的提示和技巧。

# 匹配与相关性排名

当购物者提交关键字搜索时，首先会尝试匹配一组记录(在本例中是产品记录)。许多配置决定了哪组产品匹配搜索词。

**搜索界面**

搜索界面是被搜索的字段的集合。开箱即用，只有几个字段被添加到名为“All”的搜索界面中。这些通常包括产品显示名称和类别。

搜索界面在 OCC 管理中的搜索->可搜索字段排名下配置。“添加字段”下拉框中有一个字段列表，这些字段支持关键字搜索，但不是搜索界面的一部分。

虽然此屏幕的标题是“可搜索字段排名”，但了解搜索给定搜索界面中的所有字段是很重要的。例如，它不会尝试匹配 product.description，如果找不到匹配项，则继续搜索 product.category，它会在所有字段中搜索匹配项。

应该注意将哪些字段添加到搜索界面中。长描述可能很吸引人，但是如果你有非常长的描述，这可能会产生无用的结果。添加数字字段(如价格或评级)主要是浪费时间，因为没有购物者会搜索像“$19.98”这样的文字字符串。(相反，他们会根据价格导航或过滤)。

(接下来，我们将讨论该屏幕的“排名”和“跨字段匹配”方面)

**词库**

Oracle Commerce Cloud 附带了一个内置词库，其中包含许多不同语言的常用词。例如，它将处理“衬衫”==“衬衫”。然而，它只处理基本的公共语言同义词。它不会包含“iphone”= =“iphone”或“tv = = hdtv = = hdtvs = = lcd tvs”等专用值。

跟单商可以配置额外的同义词库条目。当购物者执行关键字搜索时，同义词将被考虑，并将增加返回的匹配产品的数量。

**匹配结论**

因此，搜索界面和词库是商家控制返回目录中哪些产品的两种主要方式。但是这种配置并不能决定结果的排序。这就是相关性排名的由来。

# 相关性排名

相关性排名是将一组匹配产品按某种顺序排列的过程。让我们做一个简单的例子。假设我们的目录有 10，000 种产品。一名购物者搜索“高清电视”。关键字搜索处理(使用搜索界面和同义词库)匹配 10，000 个中的 400 个。现在轮到相关性排名订购这 400 种“hdtv”产品了。

截至 18D (18.6)版本，订购考虑了以下内容:

1.  Boost and bury:这允许商家选择特定的产品或导航状态，以推到结果列表的最顶端或最底端。
2.  相关性排名模块:该模块检查一组搜索结果，并试图找出哪些与购物者的搜索词最相关
3.  动态监管:在本文([https://medium . com/Oracle devs/Dynamic-Curation-of-product-listings-with-Oracle-commerce-cloud-3a6de 6f 01450](/oracledevs/dynamic-curation-of-product-listings-with-oracle-commerce-cloud-3a6de6f01450))中详细讨论过，动态监管允许您根据产品属性(如查看次数、是否在售、是否有货等)进一步影响相关结果。
4.  静态排名:这是当上述返回平局时的最终排序结果。例如，如果两种不同的产品完全匹配购物者的搜索词，静态排名会对它们进行排序(可能基于价格降序、字母顺序或其他)。

**助推并掩埋**

增强和隐藏功能使跟单商能够对结果进行微调控制。例如，也许有一款令人兴奋的新 HDTV 正在销售，商家想把这个结果放在第一位。增强和隐藏功能允许他们这样做。

它还允许将产品隐藏到列表的末尾。也许产品目录中有一件印有高清电视图片的 t 恤，产品描述中出现了“高清电视”。经销商希望首先展示真正的高清电视，而不是这件 t 恤。你可以把这件 t 恤埋到列表的最后。

我们希望商家不要觉得有必要对每个搜索词都使用 boost/bury。在接下来的两节中，我们将讨论动态监管和相关性排名，在这两个配置选项之间，希望您可以自然地获得良好的搜索结果，并仅在特殊情况下使用 boost/bury。

**关联度排名模块**

相关性排名模块将对大部分结果进行排序。这些模块使用不同的排名来计算每个匹配产品的数值分数。它可以考虑以下标准:

*   "搜索词是出现在同一个字段中，还是跨字段？"
*   "搜索词是否与某个字段完全匹配？"
*   术语是在高排名字段(如产品名称)中匹配，还是在低排名字段(如详细描述)中匹配
*   "这个记录是匹配购物者的所有条件，还是只匹配其中的一个子集？"

Oracle Commerce Search 附带了许多可以通过 REST 配置的相关性排名模块。有关此主题的完整文档可在[https://docs . Oracle . com/CD/e 97801 _ 02/cloud . 18d/extending cc/html/s 4324 understandhowrelevancerankingmod 01 . html](https://docs.oracle.com/cd/E97801_02/Cloud.18D/ExtendingCC/html/s4324understandhowrelevancerankingmod01.html)上查看

**了解可搜索字段排名**

还记得 OCC 管理界面的标题是“可搜索字段排名”吗？这个特定的名称是有原因的:两个相关性排序模块(如果您使用称为“considerFieldRanks”的高级配置，还有几个其他模块)称为 [Maxfield](https://docs.oracle.com/cd/E97801_02/Cloud.18D/ExtendingCC/html/s4324maxfieldmodule01.html) 和 [Field](https://docs.oracle.com/cd/E97801_02/Cloud.18D/ExtendingCC/html/s4324maxfieldmodule01.html) ，它们将根据术语出现在哪个字段来对记录进行排序。可搜索字段排名中的字段顺序是 Maxfield 和 Field 将使用的顺序。因此，如果您的“所有”搜索界面有产品名称、简短描述、类别和详细描述(按此顺序)，Maxfield 和 field 会将产品名称中的匹配项排在详细描述中的匹配项之前。

还记得“可搜索字段排名”中有一个选择器用于跨字段匹配吗？这与字段重新排名模块结合使用。这允许将跨字段匹配排在单个字段内的匹配之前。

考虑一个购物者搜索“lcd sony TV”，我们的搜索界面有四个字段(产品名称、简短描述、类别和详细描述)。即使这 3 个术语分布在名称、描述和类别中，我们仍然会认为这比所有 3 个术语都出现在长描述中更相关。在这种情况下，我们将把“跨字段匹配”选择器移到长描述的正上方。

**动态固化**

动态监管允许商家基于与购物者输入的搜索词无关的字段来影响搜索结果集。例如，销售人员可能希望将非在售产品推到列表的后面，或者希望突出新产品。

然而，值得注意的是，配置的开箱即用的动态监管是作为相关性排名模块的一部分包括在内的。这意味着，只有在相关性排名开始对结果进行排序之后，动态监管才会生效。它本质上只是另一个相关性排名模块，因此，它不能像 boost/bury 那样覆盖相关性。因此，动态固化的影响可能相当微妙。

我们举个例子:假设我们搜索了“索尼 1080p 液晶高清电视”，有 10 个搜索结果。第一个结果可能是品牌=索尼 HDTV，所有 4 个搜索词都出现在产品名称中。可能第十个结果是一台 Vizio 1080p 液晶高清电视。它匹配了大部分搜索词(但不是全部)。无论如何，使用动态监管是没有办法将 Vizio 电视推到索尼电视之前的(因为索尼电视是更相关的结果)。

但是，假设结果 1 到 8 都是索尼电视，并且它们都通过相关性排名模块以相同的分数匹配这些术语。这就是动态监管可以影响结果的地方:零售商可能会把新的、非销售的电视推到前面。Vizio 仍将排在第十位，但第一个搜索结果将是未上市的最新索尼高清电视。

如果一个商人希望 Vizio 成为第一个结果，他们必须使用 Boost/bury 来实现。

**静态排名**

因此，在这一点上，匹配产品的列表已经通过了提升/掩埋、相关性排名模块和动态监管。如果有产品已经经历了所有这一切，仍然有相同的相关性得分，静态排名将决定最后的排序。

Oracle Commerce Cloud 附带了一个默认的静态排名规则，该规则将按照产品的显示名称以升序对产品进行排序。

# **通过 REST 控制关联度排名**

搜索界面，词库，升压/掩埋和动态监管都可以在 OCC 管理通过尼斯用户界面工具控制。

但是，配置相关性排名模块和静态排名只能通过 REST 进行配置。此外，大约从 18C 开始，配置位置发生了变化(变得有点复杂)。

由于提升/掩埋、动态监管、相关性排序和静态排序都可以彼此独立地配置，所以它们中的每一个都有一系列独立的 REST 端点。

**通过 REST 改变默认相关性排名**

相关性排名在/GS admin/v1/cloud/content/system/ranking rules/defaultStandardSearch 配置

首先，对该端点执行 GET。开箱后，它配置了(自 18D 起)nterms、maxfield 和 exact 模块。

对那个 JSON 进行修改，然后放到同一个端点。

**通过 REST 改变默认静态排名**

静态排名在/GS admin/v1/cloud/content/system/ranking rules/defaultStandardStatic 配置

同样，首先执行 GET 来检索当前的 JSON。进行修改，并将其放回同一个端点。

现成的配置在 product.displayName 和 sku.listingOptionIndex 上有一个静态排序(实际上，由于没有两个产品有完全相同的显示名称，sku.listingOptionIndex 上的静态排序可能什么也不做)。您可能希望用自定义的静态排序替换那些现有的字符串。

**了解规则的文件夹结构**

如果对/GS admin/v1/cloud/content/system/ranking rules/执行 GET，您会看到一系列文件夹，例如:

*   违约混合
*   defaultMerchBoostBury
*   defaultRecsBoost
*   defaultStandardSearch:默认重新排名(如上所述)
*   defaultStandardStatic:默认静态排序(前面已经介绍过)

在大多数情况下，除了配置 relrank 或 static 之外，不应该接触/content/system。例外可能是“defaultMerchBlend”。您可能希望创建一个应用于搜索结果的默认动态监管规则，但不希望它出现在 OCC 管理中的动态监管工具下(这样商家就不能篡改和破坏它)。

随着跟单商创建动态监管或提升/掩埋规则，这些规则将在略有不同的位置创建:

/GS admin/v1/cloud/content/ranking rules

为您创建了一个名为“默认”的现成规则。该规则对于配置适用于所有搜索的默认动态监管规则非常有用(除非您创建了特定于位置的规则)。

# 确定为什么结果以这种方式排序

您执行关键字搜索，结果按相关性排序。但是你很好奇:你所看到的一系列产品到底是如何被订购的呢？

搜索索引提供了这方面的元数据。这两个选项称为 WhyRank 和 WhyMatch。此信息仅在您的预览店面中可用(因为计算起来可能很昂贵，我们不想减慢购物者正在使用的真实店面的速度)。

WhyRank 和 WhyMatch 已经在 18C 左右开始的所有预览版店面中默认打开。该信息在 JSON 响应中从/ccstoreui/v1/search 端点返回，并且针对每个产品返回。

在我的本地应用程序中，我通过执行 GET /ccstoreui/v1/search？Ntt =电影

在第一个产品记录上，我有这样的 WhyMatch:

```
“DGraph.WhyMatch”: [
 “[{\”fields\”:[\”product.category@locale:en\”], \”terms\”:[ {\”term\”:\”movie\”, \”expansions\”:[ {\”type\”: \”Substring/Phrase\”}]}]},{\”fields\”:[\”product.displayName@locale:en\”], \”terms\”:[ {\”term\”:\”movie\”, \”expansions\”:[ {\”type\”: \”Substring/Phrase\”}]}]}]”
```

…这是给 WhyRank 的

```
"DGraph.WhyRank": [
 "[ { \"nterms\" : { \"evaluationTime\" : \"0.0009765625\",   \"stratumRank\" : \"100\", \"stratumDesc\" : \"Matched 1 of 1 terms\" }}, 
       { \"maxfield\" : { \"evaluationTime\" : \"0.0009765625\", \"stratumRank\" : \"3\", \"stratumDesc\" : \"field match\", \"rankedField\" : \"product.displayName@locale:en\" }}, 
       { \"exact\" : { \"evaluationTime\" : \"0.011962890625\", \"stratumRank\" : \"2\", \"stratumDesc\" : \"subphrase match\", \"rankedField\" : \"product.category@locale:en\" }}, 
       { \"static\" : { \"sortedBy\" : [{\"fieldName\":\"product.displayName@locale:en\",\"fieldType\":\"String\",\"directionCompared\":\"ascending\"}] }}, 
       { \"static\" : { \"sortedBy\" : [{\"fieldName\":\"sku.listingOptionIndex\",\"fieldType\":\"Int\",\"directionCompared\":\"ascending\"}] }} ]"
              ],
```

好吧，这不是非常用户友好。但是在 JSON-within-JSON 中，对于 WhyMatch，我们看到它匹配的字段(product.category 和 product.displayName)。我们看到@locale:en 与我们搜索的语言相匹配。

对于 WhyRank 信息，它甚至更不方便用户使用。尽管如此，还是有一些有用的信息。我们看到它与 n term 的“1 of 1 terms”相匹配。用于排名的字段是“产品.显示名称”。确切地说，它只找到了一个子短语匹配(这意味着 product.displayName 和 product.category 都没有 100%精确的“电影”值，只是我们对“电影”的搜索匹配了一个子短语。例如，类别名称可能是“恐怖电影”)。

如果你收集一些产品的信息，你会发现不同之处。也许第二个产品在一个排名较低的字段上匹配。

# **搜索调谐和地毯泡效应**

当配置相关性排名或动态监管时，最好从重要的搜索词列表开始，这些搜索词代表各种搜索风格。

例如，您的列表可能包括购物者根据类别名称、产品或品牌名称执行的搜索。一些搜索应该有多个搜索词(如我们的“索尼 1080p 液晶高清电视”示例)，而其他搜索可能只有一个词(“高清电视”)。

在开始搜索调优之前，使用该术语列表进行搜索，并给它们一个个人评分。更改相关性排名或默认动态监管规则后，重新测试每个搜索项。

有时会发生的情况是，你改进了一组搜索，却错误地破坏了其他搜索。这就是我所说的地毯泡沫效应。如果你的起居室里有一块地毯，并且形成了一个气泡，你可能就在这里修理它，但是你只是把它移到了那里，你的情况并没有好转。

所以不要孤立地测试搜索调优变化。此外(在你和我之间，所以嘘嘘)，当心首席执行官效应。当首席执行官或首席技术官或首席信息官打电话给你说“嘿，我刚刚搜索了 X，它看起来像垃圾！尽快解决这个问题！”您可能会进行修改来修复该搜索，但却无意中破坏了实际购物者正在执行的其他搜索。相反，将这些术语添加到上面的搜索术语列表中。在为你的 CEO 修改时，也要重新评估其他条款。

最后，谨防过度使用 Boost 和 Bury。如果您发现自己配置了数百个 boost/bury 规则，这可能意味着您的默认相关性排名模块需要改进。或者它可能意味着添加(或删除！)字段。你的目标应该是开发一个良好的相关性排名配置，涵盖大多数搜索。Boost/bury 应该根据具体情况使用，而不是对购物者输入的每个关键词都使用。

# 结论

我给了你很多信息。如果要我总结你应该做什么，那就是:

1.  收集反映客户搜索行为的重要搜索词列表
2.  修改“全部”搜索界面以包括相关字段。开箱即用的配置是不够的。
3.  修改默认相关性排序策略和静态排序。你的目标应该是让几乎所有的搜索词都有好的搜索结果。(但可能不是全部)
4.  定义默认的动态监管规则
5.  添加特定于业务的同义词库条目
6.  测试并重新测试您的搜索配置。在任何大的变化(产品类型、搜索界面等的变化)之后，重新测试你的搜索词列表。
7.  视情况使用 boost/bury 来改善搜索结果，或者确保您的热门搜索有很好的结果来提高转化率