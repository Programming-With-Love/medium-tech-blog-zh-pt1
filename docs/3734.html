<html>
<head>
<title>Drupal 8: Invalidate views cache (custom cache tags)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Drupal 8:无效视图缓存(自定义缓存标签)</h1>
<blockquote>原文：<a href="https://medium.com/globant/drupal-8-invalidate-views-cache-custom-cache-tags-38ccdaee90d7?source=collection_archive---------0-----------------------#2021-08-25">https://medium.com/globant/drupal-8-invalidate-views-cache-custom-cache-tags-38ccdaee90d7?source=collection_archive---------0-----------------------#2021-08-25</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="cc88" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">问题</h1><p id="cef4" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">我们的网站有一个活动列表页面，显示即将举行的活动。该页面是使用Drupal视图创建的。</p><p id="9777" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">该视图有一个筛选器，显示开始日期大于或等于当前日期的所有事件。</p><p id="8f9d" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">在某些情况下，过去的事件会出现在当前事件列表页面上。</p><p id="113d" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">发生这种情况是因为输出由于一些模块如动态页面缓存、内部页面缓存等而被缓存。</p><h1 id="b958" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">解决办法</h1><p id="84a4" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">我们在<a class="ae kf" href="https://www.drupal.org/project/views_custom_cache_tag" rel="noopener ugc nofollow" target="_blank"> <em class="kg">视图自定义缓存标签</em> </a>模块的帮助下，通过在服务器上设置一个cron作业，解决了这个问题。</p><h1 id="4044" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">步伐</h1><p id="a418" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated"><strong class="je hi">安装模块</strong></p><p id="bccf" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">下载并安装<a class="ae kf" href="https://www.drupal.org/project/views_custom_cache_tag" rel="noopener ugc nofollow" target="_blank">https://www.drupal.org/project/views_custom_cache_tag</a>模块。</p><p id="970e" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">配置视图</strong></p><ul class=""><li id="80b4" class="kh ki hh je b jf ka jj kb jn kj jr kk jv kl jz km kn ko kp bi translated">编辑有问题的视图</li><li id="69d3" class="kh ki hh je b jf kq jj kr jn ks jr kt jv ku jz km kn ko kp bi translated">转到视图的“高级”部分，它位于最右侧</li><li id="841d" class="kh ki hh je b jf kq jj kr jn ks jr kt jv ku jz km kn ko kp bi translated">从缓存部分选择“基于自定义标记”选项</li></ul><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es kv"><img src="../Images/7ec44ca40e4af7cea2cd91bbe33880ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*G5PpOLzKqxYWJ1wWSWGFIg.png"/></div></div></figure><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lh"><img src="../Images/7b7f01daa513a15492d92e8e73d39fd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2fCIXqflRZZOk6V5AFkPlg.png"/></div></div></figure><ul class=""><li id="b0c2" class="kh ki hh je b jf ka jj kb jn kj jr kk jv kl jz km kn ko kp bi translated">在下一步(缓存选项)中，添加将在cron运行时失效的缓存标记</li></ul><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es li"><img src="../Images/15a96e37966369a3fd2a7cfd71f92f46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IOHj3xPJHPWn6m9FzWAHvg.png"/></div></div></figure><ul class=""><li id="f49b" class="kh ki hh je b jf ka jj kb jn kj jr kk jv kl jz km kn ko kp bi translated">保存视图</li></ul><p id="1168" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">写钩cron </strong></p><p id="78f0" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">编写一个如下所示的钩子cron:</p><pre class="kw kx ky kz fd lj lk ll lm aw ln bi"><span id="acd9" class="lo if hh lk b fi lp lq l lr ls">/**<br/>  * Implements hook_cron().<br/>*/<br/>function MODULENAME_cron() {<br/>  \Drupal\Core\Cache\Cache::invalidateTags(['my_events_page']);<br/>}</span></pre><p id="2d59" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">“my_events_page”是我们在视图中声明的缓存标记。</p><p id="f511" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">根据项目需求，让cron作业每天或每隔几小时运行一次。</p><p id="9354" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">在每次cron运行时，带有提到的自定义缓存标记的视图的缓存将被清除。</p><h1 id="d6bc" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">结论</h1><p id="46df" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">为了网站更好的性能，我们通常会在各种Drupal模块的帮助下缓存大部分页面。但是对于一些页面，如事件，我们希望在每个特定时间后清除页面缓存，以便在页面上显示最相关的数据/节点。</p></div></div>    
</body>
</html>