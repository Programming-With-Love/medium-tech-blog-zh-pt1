<html>
<head>
<title>Using an OpenLayers map to select countries in an Oracle JET application</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Oracle JET应用程序中使用OpenLayers地图选择国家/地区</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/using-an-openlayers-map-to-select-countries-in-an-oracle-jet-application-ce56822b4e03?source=collection_archive---------0-----------------------#2018-01-02">https://medium.com/oracledevs/using-an-openlayers-map-to-select-countries-in-an-oracle-jet-application-ce56822b4e03?source=collection_archive---------0-----------------------#2018-01-02</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="c917" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在最近的一篇文章中，我讨论了如何在Oracle JET应用程序中使用开源的geo、GIS和地图库OpenLayers。那篇文章展示了在标准Oracle JET复选框集组件中选择的国家是如何在世界地图上表示的。在本文中，我们将此向前推进了一步——或者实际上是几个步骤。通过在地图上添加交互性，我们允许用户在世界地图上选择一个国家，并将这一选择通知JET组件。同步是双向的:如果用户在JET输入文本组件中键入一个国家的名称，这个国家将在世界地图上突出显示。请注意，该地图具有完整的缩放和平移功能。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/4e2b26cbeeadbc0d7725a9fbd6151678.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*W1B-uQAHfzUgnbXi."/></div></div></figure><p id="8ccd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Gif演示了地图是如何突出显示法国的。接下来，用户在输入文本组件中键入Chile，当更改完成时，地图被同步:Chile被突出显示。然后用户将鼠标悬停在摩洛哥——信息DIV元素显示了这一事实。尚未做出选择。然后用户鼠标点击摩洛哥。在地图上选择国家，JET输入文本组件与国家的名称同步。随后，对印度进行同样的操作:悬停，然后选择。注意:地图可以轻松支持多国选择；我必须显式关闭该选项(默认行为是允许它)。</p><p id="e933" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我在实施此功能时面临的挑战是:</p><ul class=""><li id="9300" class="jp jq hh ig b ih ii il im ip jr it js ix jt jb ju jv jw jx bi translated">添加带有国家(要素)的矢量图层</li><li id="158c" class="jp jq hh ig b ih jy il jz ip ka it kb ix kc jb ju jv jw jx bi translated">当鼠标悬停在国家上方时高亮显示该国家</li><li id="52f8" class="jp jq hh ig b ih jy il jz ip ka it kb ix kc jb ju jv jw jx bi translated">添加<em class="kd">选择交互</em>以允许用户选择国家</li><li id="3443" class="jp jq hh ig b ih jy il jz ip ka it kb ix kc jb ju jv jw jx bi translated">将<em class="kd">地图</em>中的国家选择事件传达给“常规”JET组件</li><li id="92ff" class="jp jq hh ig b ih jy il jz ip ka it kb ix kc jb ju jv jw jx bi translated">将地图与在JET组件中键入的国家/地区名称同步</li></ul><p id="81b5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">步骤(假设先执行本文中<a class="ae jc" href="https://technology.amis.nl/2018/01/01/embedding-openlayers-in-oracle-jet-for-advanced-maps-and-gis-style-user-interfaces/" rel="noopener ugc nofollow" target="_blank">的步骤):</a></p><ol class=""><li id="4723" class="jp jq hh ig b ih ii il im ip jr it js ix jt jb ke jv jw jx bi translated">用输入文本、信息DIV和地图容器(DIV)创建mapArea.html</li><li id="b182" class="jp jq hh ig b ih jy il jz ip ka it kb ix kc jb ke jv jw jx bi translated">为mapArea模块创建mapArea.js</li><li id="71ce" class="jp jq hh ig b ih jy il jz ip ka it kb ix kc jb ke jv jw jx bi translated">向index.html添加一个带有mapArea模块数据绑定的div</li><li id="b630" class="jp jq hh ig b ih jy il jz ip ka it kb ix kc jb ke jv jw jx bi translated">下载GEOJSON格式的文件，其中包含世界各国的注释geo-json几何</li><li id="6610" class="jp jq hh ig b ih jy il jz ip ka it kb ix kc jb ke jv jw jx bi translated">使用两个图层初始化地图-栅格OSM世界地图和矢量国家形状</li><li id="821f" class="jp jq hh ig b ih jy il jz ip ka it kb ix kc jb ke jv jw jx bi translated">添加覆盖以突出显示悬停的国家</li><li id="dacc" class="jp jq hh ig b ih jy il jz ip ka it kb ix kc jb ke jv jw jx bi translated">添加选择交互—允许选择国家/地区—对所选国家/地区应用粗体样式</li><li id="d310" class="jp jq hh ig b ih jy il jz ip ka it kb ix kc jb ke jv jw jx bi translated">从国家选择中更新JET组件</li><li id="88d7" class="jp jq hh ig b ih jy il jz ip ka it kb ix kc jb ke jv jw jx bi translated">根据JET组件中的值[更改]在地图上设置国家选择</li></ol><p id="34e0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里是用来实现这个的代码:<a class="ae jc" href="https://github.com/lucasjellema/jet-and-openlayers" rel="noopener ugc nofollow" target="_blank">https://github.com/lucasjellema/jet-and-openlayers</a>。</p><h1 id="f693" class="kf kg hh bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">用输入文本、信息DIV和地图容器(DIV)创建mapArea.html</h1><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="a2aa" class="li kg hh le b fi lj lk l ll lm">&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/openlayers/4.6.4/ol-debug.css" /&gt; <br/>&lt;h2&gt;Select Country on Map&lt;/h2&gt; <br/>&lt;div id="componentDemoContent" style="width: 1px; min-width: 100%;"&gt; &lt;div id="div1"&gt; <br/>&lt;oj-label for="text-input"&gt;Country&lt;/oj-label&gt; <br/>&lt;oj-input-text id="text-input" value="{{selectedCountry}}" on-value-changed="[[countryChangedListener]]"&gt;&lt;/oj-input-text&gt; <br/>&lt;/div&gt; <br/>&lt;/div&gt; &lt;div id="info"&gt;&lt;/div&gt; &lt;div id="map2" class="map"&gt;&lt;/div&gt;</span></pre><h1 id="d113" class="kf kg hh bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">为mapArea模块创建ViewModel mapArea.js</h1><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="d962" class="li kg hh le b fi lj lk l ll lm">define( ['ojs/ojcore', 'knockout', 'jquery', 'ol', 'ojs/ojknockout', 'ojs/ojinputtext', 'ojs/ojlabel'], function (oj, ko, $, ol) { 'use strict'; <br/>function MapAreaViewModel() { <br/>var self = this; <br/>self.selectedCountry = ko.observable("France"); self.countryChangedListener = function(event) { } ... <br/>} <br/>return new MapAreaViewModel(); } );</span></pre><h1 id="60c4" class="kf kg hh bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">向index.html添加一个带有mapArea模块数据绑定的DIV</h1><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="9d09" class="li kg hh le b fi lj lk l ll lm">...&lt;/header&gt; <br/>&lt;div role="main" class="oj-web-applayout-max-width oj-web-applayout-content"&gt; <br/>&lt;div data-bind="ojModule:'mapArea'" /&gt; <br/>&lt;/div&gt; <br/>&lt;footer class="oj-web-applayout-footer" role="contentinfo"&gt; ...</span></pre><h1 id="5af7" class="kf kg hh bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">下载GEOJSON格式的文件，其中包含世界各国的注释geo-json几何</h1><p id="34b2" class="pw-post-body-paragraph ie if hh ig b ih ln ij ik il lo in io ip lp ir is it lq iv iw ix lr iz ja jb ha bi translated">我从GitHub:【https://github.com/johan/world.geo.json】T2下载了一个包含国家数据的GEOJSON文件，并将该文件放在我的JET应用程序的目录src\js\viewModels中:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/a065a5cb07776d7efd7538fec5fb3cc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DvfMDtYPy5QKdq0B."/></div></div></figure><h1 id="a7d3" class="kf kg hh bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">使用两个图层初始化地图-栅格OSM世界地图和矢量国家形状</h1><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="6009" class="li kg hh le b fi lj lk l ll lm">function MapAreaViewModel() { <br/>var self = this; <br/>self.selectedCountry = ko.observable("France"); self.countryChangedListener = function(event) { // self.selectInteraction.getFeatures().clear(); // self.setSelectedCountry(self.selectedCountry()) } </span><span id="23f8" class="li kg hh le b fi ls lk l ll lm">$(document).ready ( <br/>// when the document is fully loaded and the DOM has been initialized <br/>// then instantiate the map <br/>function () { initMap(); }) </span><span id="34a1" class="li kg hh le b fi ls lk l ll lm">function initMap() { <br/>var style = new ol.style.Style({ fill: new ol.style.Fill({ color: 'rgba(255, 255, 255, 0.6)' }), stroke: new ol.style.Stroke({ color: '#319FD3', width: 1 }), text: new ol.style.Text() });</span><span id="43d1" class="li kg hh le b fi ls lk l ll lm">self.countriesVector = new ol.source.Vector({ url: 'js/viewModels/countries.geo.json', format: new ol.format.GeoJSON() }); </span><span id="6356" class="li kg hh le b fi ls lk l ll lm">self.map2 = new ol.Map({ layers: [ new ol.layer.Vector({ id: "countries", renderMode: 'image', source: self.countriesVector, style: function (feature) { style.getText().setText(feature.get('name')); return style; } }) , new ol.layer.Tile({ id: "world", source: new ol.source.OSM() }) ], target: 'map2', view: new ol.View({ center: [0, 0], zoom: 2 }) }); </span><span id="4262" class="li kg hh le b fi ls lk l ll lm">}//initMap</span></pre><h1 id="f035" class="kf kg hh bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">添加覆盖以突出显示悬停的国家</h1><p id="ee11" class="pw-post-body-paragraph ie if hh ig b ih ln ij ik il lo in io ip lp ir is it lq iv iw ix lr iz ja jb ha bi translated">注意:这段代码被添加到initMap函数中:</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="0ec2" class="li kg hh le b fi lj lk l ll lm">// layer to hold (and highlight) currently selected feature(s) var featureOverlay = new ol.layer.Vector({ source: new ol.source.Vector(), map: self.map2, style: new ol.style.Style({ stroke: new ol.style.Stroke({ color: '#f00', width: 1 }), fill: new ol.style.Fill({ color: 'rgba(255,0,0,0.1)' }) }) }); </span><span id="38ef" class="li kg hh le b fi ls lk l ll lm">var highlight; </span><span id="4946" class="li kg hh le b fi ls lk l ll lm">var displayFeatureInfo = function (pixel) { var feature = self.map2.forEachFeatureAtPixel(pixel, function (feature) { return feature; }); </span><span id="82bd" class="li kg hh le b fi ls lk l ll lm">var info = document.getElementById('info'); <br/>if (feature) { <br/>info.innerHTML = feature.getId() + ': ' + feature.get('name'); <br/>} <br/>else { <br/>info.innerHTML = '&amp;nbsp;'; <br/>} </span><span id="0268" class="li kg hh le b fi ls lk l ll lm">if (feature !== highlight) { <br/>  if (highlight) {   <br/>    featureOverlay.getSource().removeFeature(highlight); <br/>  } <br/>  if (feature) { <br/>    featureOverlay.getSource().addFeature(feature); <br/>  } <br/>  highlight = feature; <br/>} <br/>}; </span><span id="27ba" class="li kg hh le b fi ls lk l ll lm">self.map2.on('pointermove', function (evt) { <br/>  if (evt.dragging) { return; } <br/>  var pixel = self.map2.getEventPixel(evt.originalEvent);<br/>  displayFeatureInfo(pixel); <br/>});</span></pre><h1 id="3378" class="kf kg hh bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">添加选择交互—允许选择国家/地区—对所选国家/地区应用粗体样式</h1><p id="2584" class="pw-post-body-paragraph ie if hh ig b ih ln ij ik il lo in io ip lp ir is it lq iv iw ix lr iz ja jb ha bi translated">这段代码就是基于这个例子:<a class="ae jc" href="http://openlayers.org/en/latest/examples/select-features.html" rel="noopener ugc nofollow" target="_blank">http://openlayers . org/en/latest/examples/select-features . html</a>。</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="beb8" class="li kg hh le b fi lj lk l ll lm">// define the style to apply to selected countries var selectCountryStyle = new ol.style.Style({ stroke: new ol.style.Stroke({ color: '#ff0000', width: 2 }) , fill: new ol.style.Fill({ color: 'red' }) }); </span><span id="7003" class="li kg hh le b fi ls lk l ll lm">self.selectInteraction = new ol.interaction.Select({ condition: ol.events.condition.singleClick, toggleCondition: ol.events.condition.shiftKeyOnly, layers: function (layer) { return layer.get('id') == 'countries'; }, style: selectCountryStyle }); </span><span id="4dde" class="li kg hh le b fi ls lk l ll lm">// add an event handler to the interaction self.selectInteraction.on('select', function (e) { <br/>//to ensure only a single country can be selected at any given time<br/>// find the most recently selected feature, clear the set of selected features and add the selected the feature (as the only one)</span><span id="f145" class="li kg hh le b fi ls lk l ll lm">var f = self.selectInteraction.getFeatures() <br/>var selectedFeature = f.getArray()[f.getLength() - 1] self.selectInteraction.getFeatures().clear(); self.selectInteraction.getFeatures().push(selectedFeature); <br/>});</span></pre><p id="998e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">就在self.map2声明之后:</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="8c0d" class="li kg hh le b fi lj lk l ll lm">... self.map2.getInteractions().extend([self.selectInteraction]);</span></pre><h1 id="83d9" class="kf kg hh bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">从国家选择中更新JET组件</h1><p id="0675" class="pw-post-body-paragraph ie if hh ig b ih ln ij ik il lo in io ip lp ir is it lq iv iw ix lr iz ja jb ha bi translated">向selectInteraction的select事件处理程序的末尾添加:</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="7968" class="li kg hh le b fi lj lk l ll lm">var selectedCountry = { "code": selectedFeature.id_, "name": selectedFeature.values_.name }; <br/>// set name of selected country on Knock Out Observable<br/>self.selectedCountry(selectedCountry.name);</span></pre><p id="3630" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创造</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="ad95" class="li kg hh le b fi lj lk l ll lm">self.setSelectedCountry = function (country) { <br/>//programmatic selection of a feature <br/>var countryFeatures = self.countriesVector.getFeatures(); <br/>var c = self.countriesVector.getFeatures().filter(function (feature) { return feature.values_.name == country }); self.selectInteraction.getFeatures().push(c[0]); }</span></pre><h1 id="60d9" class="kf kg hh bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">根据JET组件中的值[更改]在地图上设置国家选择</h1><p id="73fe" class="pw-post-body-paragraph ie if hh ig b ih ln ij ik il lo in io ip lp ir is it lq iv iw ix lr iz ja jb ha bi translated">在输入文本组件中实现mapArea.html文件中引用的self . country changed listener l:</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="5f1c" class="li kg hh le b fi lj lk l ll lm">self.countryChangedListener = function(event) { self.selectInteraction.getFeatures().clear(); self.setSelectedCountry(self.selectedCountry()) <br/>}</span></pre><p id="b3ea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建以下监听器(用于在countriesVector中加载GeoJSON数据的结尾)；当加载准备就绪时，支持输入文本组件的selectedCountry可观察值中的当前国家值用于选择初始国家:</p><pre class="je jf jg jh fd ld le lf lg aw lh bi"><span id="fa26" class="li kg hh le b fi lj lk l ll lm">var listenerKey = self.countriesVector.on('change', function (e) { if (self.countriesVector.getState() == 'ready') { console.log("loading dione"); // and unregister the "change" listener ol.Observable.unByKey(listenerKey); self.setSelectedCountry(self.selectedCountry()) } <br/>});</span></pre><h1 id="b1fb" class="kf kg hh bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">参考</h1><p id="8024" class="pw-post-body-paragraph ie if hh ig b ih ln ij ik il lo in io ip lp ir is it lq iv iw ix lr iz ja jb ha bi translated">GitHub Repo的代码(JET应用):<a class="ae jc" href="https://github.com/lucasjellema/jet-and-openlayers" rel="noopener ugc nofollow" target="_blank">https://github.com/lucasjellema/jet-and-openlayers</a>。</p><p id="b4d2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">国家GeoJSON文件—<a class="ae jc" href="https://github.com/johan/world.geo.json" rel="noopener ugc nofollow" target="_blank">https://github.com/johan/world.geo.json</a></p><p id="d426" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">选择交互的打开层示例—<a class="ae jc" href="http://openlayers.org/en/latest/examples/select-features.html" rel="noopener ugc nofollow" target="_blank">http://open Layers . org/en/latest/examples/Select-features . html</a></p><p id="7cb1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">开放层API-Vector:<a class="ae jc" href="http://openlayers.org/en/latest/apidoc/ol.source.Vector.html" rel="noopener ugc nofollow" target="_blank">http://open Layers . org/en/latest/API doc/ol . source . Vector . html</a></p><p id="5ce1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">带有GEOJSON源的OpenLayers矢量事件监听器—<a class="ae jc" href="https://gis.stackexchange.com/questions/123149/layer-loadstart-loadend-events-in-openlayers-3/123302#123302" rel="noopener ugc nofollow" target="_blank">https://GIS . stack exchange . com/questions/123149/layer-loadstart-loadend-events-in-OpenLayers-3/123302 # 123302</a></p><p id="b5e4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">动画Gif制作者—【http://gifmaker.me/ T2】</p><p id="5626" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jc" href="https://www.safaribooksonline.com/library/view/openlayers-3/9781782162360/" rel="noopener ugc nofollow" target="_blank"> OpenLayers 3:初学者指南</a>作者Thomas Gratier埃里克·哈扎德；保罗·斯潘塞，帕克特出版社，2015年出版</p><p id="9a71" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">OpenLayers Book —处理选择事件—<a class="ae jc" href="http://openlayersbook.github.io/ch11-creating-web-map-apps/example-08.html" rel="noopener ugc nofollow" target="_blank">http://OpenLayers Book . github . io/ch11-creating-we B- map-apps/example-08 . html</a></p><p id="9a81" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="kd">原载于2018年1月2日</em><a class="ae jc" href="https://technology.amis.nl/2018/01/02/using-an-openlayers-map-to-select-countries-in-an-oracle-jet-application/" rel="noopener ugc nofollow" target="_blank"><em class="kd">technology . amis . nl</em></a><em class="kd">。</em></p></div></div>    
</body>
</html>