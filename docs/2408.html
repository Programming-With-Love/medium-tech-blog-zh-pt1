<html>
<head>
<title>Step by Step Introduction to Basic Concept of Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">逐步介绍Kubernetes的基本概念</h1>
<blockquote>原文：<a href="https://medium.easyread.co/step-by-step-introduction-to-basic-concept-of-kubernetes-e20383bdd118?source=collection_archive---------1-----------------------#2019-10-11">https://medium.easyread.co/step-by-step-introduction-to-basic-concept-of-kubernetes-e20383bdd118?source=collection_archive---------1-----------------------#2019-10-11</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="3072" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">通过在您的本地环境中创建Kubernetes集群来理解Kubernetes的概念</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/bb95df007787ade5ae3ef5c12e33a3fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jn2PU1kStM7aVoK_"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@stanleydai?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Stanley Dai</a> on <a class="ae ks" href="https://unsplash.com/@stanleydai?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="2fbb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">你听过Kubernetes吗？你一定对那个话题感兴趣。这就是你打开这篇文章的原因。这篇文章是关于Kubernetes的基本概念和如何使用它。最后，我们将使用在Minikube上运行的Kubernetes来运行docker容器。它不需要任何云付费账户。</p><h1 id="e025" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">什么是Kubernetes？</h1><p id="e9a5" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">Kubernetes是Google创建的一个开源平台/工具。这是用GO-Lang写的。所以目前Kubernetes是Apache 2.0许可下的一个开源项目。有时在业内，<a class="ae ks" href="http://www.java67.com/2019/03/5-free-devops-courses-to-learn-jenkins.html" rel="noopener ugc nofollow" target="_blank"> Kubernete </a> s也被称为“K8s”。使用Kubernetes，您可以跨私有、公共和混合云环境运行任何Linux容器。Kubernetes提供了一些边缘功能，如负载平衡器、服务发现和基于角色的访问控制(RBAC)。</p><h1 id="a794" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">我们为什么需要Kubernetes？</h1><p id="119f" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">答案是帮助我们管理容器。当我们使用具有许多容器的微服务模式运行生产环境时，我们需要确保许多事情。例如健康检查、版本控制、缩放和回滚机制。这将是非常令人沮丧的，以确保所有这些事情仍然是好的。Kubernetes为您提供了大规模部署容器所需的编排和管理功能。Kubernetes orchestration允许您构建跨多个容器的应用程序服务，在集群中调度这些容器，扩展这些容器，并管理这些容器的运行状况。简而言之，我可以说Kubernetes更像是一个拥有许多下属(容器)的经理。管理者做的是维护下属需要做的事情。</p><p id="8d79" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在使用Kubernetes之前，您需要准备好基础设施来部署新的微服务。我相信这花了你几天或几周的时间。如果没有Kubernetes，大型团队将不得不手动编写部署工作流的脚本。使用Kubernetes，您不需要手动创建部署脚本，这将减少在开发运维上花费的时间和资源。</p><p id="41cb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Kubernetes的主要特点:</p><ul class=""><li id="044f" class="mm mn in kv b kw kx kz la lc mo lg mp lk mq lo mr ms mt mu bi translated"><a class="ae ks" href="https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/" rel="noopener ugc nofollow" target="_blank">水平缩放</a></li><li id="91f0" class="mm mn in kv b kw mv kz mw lc mx lg my lk mz lo mr ms mt mu bi translated"><a class="ae ks" href="https://kubernetes.io/blog/2016/07/autoscaling-in-kubernetes/" rel="noopener ugc nofollow" target="_blank">自动缩放</a></li><li id="b318" class="mm mn in kv b kw mv kz mw lc mx lg my lk mz lo mr ms mt mu bi translated"><a class="ae ks" href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/" rel="noopener ugc nofollow" target="_blank">健康检查</a> &amp; <a class="ae ks" href="https://multinode-kubernetes-cluster.readthedocs.io/en/latest/14-k8s-selfhealing.html" rel="noopener ugc nofollow" target="_blank">自愈</a></li><li id="4afc" class="mm mn in kv b kw mv kz mw lc mx lg my lk mz lo mr ms mt mu bi translated"><a class="ae ks" href="https://kubernetes.io/docs/tasks/access-application-cluster/create-external-load-balancer/" rel="noopener ugc nofollow" target="_blank">负载平衡器</a></li><li id="160a" class="mm mn in kv b kw mv kz mw lc mx lg my lk mz lo mr ms mt mu bi translated"><a class="ae ks" href="https://kubernetes.io/docs/concepts/services-networking/service/" rel="noopener ugc nofollow" target="_blank">服务发现</a></li><li id="fe33" class="mm mn in kv b kw mv kz mw lc mx lg my lk mz lo mr ms mt mu bi translated">自动<a class="ae ks" href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#rolling-back-a-deployment" rel="noopener ugc nofollow" target="_blank">回滚</a> &amp; <a class="ae ks" href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#creating-a-deployment" rel="noopener ugc nofollow" target="_blank">回滚</a></li><li id="8400" class="mm mn in kv b kw mv kz mw lc mx lg my lk mz lo mr ms mt mu bi translated">金丝雀部署</li></ul><h1 id="a5ab" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">Kubernetes是如何工作的？</h1><p id="ea7b" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">当您通过阅读官方文档开始学习Kubernetes时，您可能会被大量术语弄得不知所措。有时我们需要概述来更好地理解概念。这里我向你展示了Kubernetes建筑的完整概观图。我希望这有所帮助。</p><p id="cb5f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">部署顺序:</strong></p><p id="3db1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">DevOps -&gt; API服务器-&gt;调度器-&gt;集群-&gt;节点-&gt; Kubelet -&gt;容器引擎-&gt;在Pod中生成容器</p><p id="b00b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">App用户请求顺序:</strong></p><p id="1d7e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">应用程序用户-&gt; Kube代理-&gt; Pod -&gt;容器(您的应用程序在此运行)</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi na"><img src="../Images/d9f69a0b88bdf15c4f98e735967d8ee3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K8gyaTrVGnBnLX1dLUDefQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Kubernetes Architecture Diagram</figcaption></figure><p id="5bce" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">正如你在图表中看到的，有很多术语你不理解。我一个一个解释。</p><h2 id="ab08" class="nb lq in bd lr nc nd dn lv ne nf dp lz lc ng nh mb lg ni nj md lk nk nl mf nm bi translated">掌握</h2><p id="4596" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">主设备是集群的控制元素。母版有3个部分:</p><ul class=""><li id="de8c" class="mm mn in kv b kw kx kz la lc mo lg mp lk mq lo mr ms mt mu bi translated"><strong class="kv io"> API服务器:</strong>通过RESTful接口提供Kubernetes功能并存储集群状态的应用程序。</li><li id="6c3e" class="mm mn in kv b kw mv kz mw lc mx lg my lk mz lo mr ms mt mu bi translated"><strong class="kv io">调度程序:</strong>调度程序监视API服务器是否有新的Pod请求。它与节点通信以创建新的pod，并在分配资源或施加约束时向节点分配工作。</li><li id="8373" class="mm mn in kv b kw mv kz mw lc mx lg my lk mz lo mr ms mt mu bi translated"><strong class="kv io">控制器管理器:</strong>运行<a class="ae ks" href="https://kubernetes.io/docs/concepts/architecture/controller/" rel="noopener ugc nofollow" target="_blank">控制器</a>的主机上的组件。包括节点控制器、端点控制器、名字空间控制器等。</li></ul><h2 id="aa2c" class="nb lq in bd lr nc nd dn lv ne nf dp lz lc ng nh mb lg ni nj md lk nk nl mf nm bi translated">从属(节点)</h2><p id="d9fe" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">这些机器执行要求的、分配的任务。Kubernetes大师控制他们。节点内有4个组件:</p><ul class=""><li id="68b7" class="mm mn in kv b kw kx kz la lc mo lg mp lk mq lo mr ms mt mu bi translated">Pod: 所有的容器都将在一个Pod中运行。pod将网络和存储从底层容器中抽象出来。你的应用将在此运行。</li><li id="13a7" class="mm mn in kv b kw mv kz mw lc mx lg my lk mz lo mr ms mt mu bi translated">Kubectl向集群注册节点，监视来自调度器的工作分配，实例化新的pod，向主节点报告。</li><li id="0d98" class="mm mn in kv b kw mv kz mw lc mx lg my lk mz lo mr ms mt mu bi translated"><strong class="kv io">容器引擎:</strong>负责管理容器，镜像拉取，停止容器，启动容器，销毁容器等。</li><li id="616a" class="mm mn in kv b kw mv kz mw lc mx lg my lk mz lo mr ms mt mu bi translated"><strong class="kv io"> Kube代理:</strong>负责将app用户请求转发到右侧pod。</li></ul><p id="9fe1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我不打算在这里描述详细的概念，因为这会导致一个无聊的局面。这篇文章应该更污更好玩。你可以阅读官方文档以获得更多详细信息。<a class="ae ks" href="https://kubernetes.io/docs/concepts/" rel="noopener ugc nofollow" target="_blank">点击这里</a>。</p><h1 id="56a4" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">与Docker和Kubernetes一起动手</h1><p id="019f" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">是时候把手弄脏了。在这一节中，我将使用Github上现有的docker项目，并将更多地关注Kubernetes。我们将使用Minikube。Minikube是一个让本地运行Kubernetes变得容易的工具。</p><ol class=""><li id="6ceb" class="mm mn in kv b kw kx kz la lc mo lg mp lk mq lo nn ms mt mu bi translated"><strong class="kv io">安装Minikube<br/></strong>试试这个<a class="ae ks" href="https://kubernetes.io/docs/tasks/tools/install-minikube/" rel="noopener ugc nofollow" target="_blank"> Minikube官方安装文档。</a></li><li id="1b41" class="mm mn in kv b kw mv kz mw lc mx lg my lk mz lo nn ms mt mu bi translated"><strong class="kv io">遵循下面的说明</strong></li></ol><p id="447d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">启动Minikube并创建一个集群</p><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="4536" class="nb lq in np b gy nt nu l nv nw">minikube start</span></pre><p id="b508" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在您的本地工作区中克隆此存储库</p><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="2d87" class="nb lq in np b gy nt nu l nv nw">git clone <a class="ae ks" href="https://github.com/contentful/the-example-app.nodejs.git" rel="noopener ugc nofollow" target="_blank">https://github.com/buildkite/nodejs-docker-example.git</a></span></pre><p id="7044" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">将您的Docker客户端指向您的MinikubeDocker守护进程</p><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="0b13" class="nb lq in np b gy nt nu l nv nw">eval $(minikube docker-env)</span></pre><p id="9d0f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">将您的目录移动到上面的克隆回购中。使用此命令创建一个Docker映像，并确保可以在本地运行。</p><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="1f0a" class="nb lq in np b gy nt nu l nv nw">cd the-example-app.nodejs<br/>docker build -t example-node-app .</span></pre><p id="c280" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">确保您已经成功创建了Docker映像。</p><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="dcc0" class="nb lq in np b gy nt nu l nv nw">docker images</span></pre><p id="6d4e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">让我们使用名为<code class="fe nx ny nz np b">example-node-app</code>的现有映像创建一个Kubernetes部署，这是一个简单的节点HTTP服务器，并在端口3000上公开它。<br/>创建一个文件，命名为<strong class="kv io">deployment-script . YAML .</strong></p><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="c5cd" class="nb lq in np b gy nt nu l nv nw">kind: Deployment</span><span id="faf5" class="nb lq in np b gy oa nu l nv nw">apiVersion: extensions/v1beta1</span><span id="647c" class="nb lq in np b gy oa nu l nv nw">metadata:</span><span id="596b" class="nb lq in np b gy oa nu l nv nw">  name: kubernetes-deployment</span><span id="ded0" class="nb lq in np b gy oa nu l nv nw">  namespace: default</span><span id="aa25" class="nb lq in np b gy oa nu l nv nw">  labels:</span><span id="9e86" class="nb lq in np b gy oa nu l nv nw">    app: node-app</span><span id="d9d4" class="nb lq in np b gy oa nu l nv nw">  spec:</span><span id="6374" class="nb lq in np b gy oa nu l nv nw">    replicas: 1</span><span id="cb51" class="nb lq in np b gy oa nu l nv nw">    selector:</span><span id="0561" class="nb lq in np b gy oa nu l nv nw">      matchLabels:</span><span id="d40d" class="nb lq in np b gy oa nu l nv nw">        app: node-app</span><span id="daa0" class="nb lq in np b gy oa nu l nv nw">    template:</span><span id="ca52" class="nb lq in np b gy oa nu l nv nw">      metadata:</span><span id="383d" class="nb lq in np b gy oa nu l nv nw">        labels:</span><span id="4875" class="nb lq in np b gy oa nu l nv nw">          app: node-app</span><span id="5af9" class="nb lq in np b gy oa nu l nv nw">      spec:</span><span id="5ec2" class="nb lq in np b gy oa nu l nv nw">        containers:</span><span id="809e" class="nb lq in np b gy oa nu l nv nw">          - name: node-app-container</span><span id="0e2f" class="nb lq in np b gy oa nu l nv nw">            image: example-node-app</span><span id="4457" class="nb lq in np b gy oa nu l nv nw">            resources: {}</span><span id="d806" class="nb lq in np b gy oa nu l nv nw">            imagePullPolicy: IfNotPresent</span><span id="5cf3" class="nb lq in np b gy oa nu l nv nw">        restartPolicy: Always</span><span id="e3f7" class="nb lq in np b gy oa nu l nv nw">        terminationGracePeriodSeconds: 30</span><span id="d0ef" class="nb lq in np b gy oa nu l nv nw">terminationGracePeriodSeconds: 30</span></pre><p id="31da" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">然后</p><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="d888" class="nb lq in np b gy nt nu l nv nw">kubectl apply -f deployment-script.yaml</span></pre><p id="3ffb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> node-app </strong> pod现已启动，您的<strong class="kv io"> node-app </strong>容器<strong class="kv io"> </strong>将在Pod内运行，但您必须等到Pod启动后才能通过公开的服务访问它。</p><p id="c8f7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">检查Pod是否启动并运行:</p><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="5e60" class="nb lq in np b gy nt nu l nv nw">kubectl get pod</span></pre><p id="82a5" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">pod已启动并运行:</p><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="7e8f" class="nb lq in np b gy nt nu l nv nw">NAME                              READY     STATUS    RESTARTS   AGE<br/>node-app-3383150820-vctvh         1/1       Running   0          13s</span></pre><p id="a8c1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">请不要高兴得太快。我们不会就此结束。你需要一个<strong class="kv io">服务代理</strong>来访问你的pod。我们将创建一个负载平衡器服务，使用<strong class="kv io"> targetPort: 3000 </strong>和<strong class="kv io">向用户公开端口8000 </strong>。</p><p id="9f72" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">用下面的文本创建一个名为<code class="fe nx ny nz np b">node-app-service.yaml</code>的文件。</p><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="7627" class="nb lq in np b gy nt nu l nv nw">kind: Service</span><span id="d49c" class="nb lq in np b gy oa nu l nv nw">apiVersion: v1</span><span id="a0c4" class="nb lq in np b gy oa nu l nv nw">metadata:</span><span id="915d" class="nb lq in np b gy oa nu l nv nw">  name: node-app-service</span><span id="430b" class="nb lq in np b gy oa nu l nv nw">  namespace: default</span><span id="e4c3" class="nb lq in np b gy oa nu l nv nw">  labels:</span><span id="0429" class="nb lq in np b gy oa nu l nv nw">    app: node-service</span><span id="cd3e" class="nb lq in np b gy oa nu l nv nw">spec:</span><span id="50cb" class="nb lq in np b gy oa nu l nv nw">  ports:</span><span id="4f48" class="nb lq in np b gy oa nu l nv nw">    - protocol: TCP</span><span id="a5a1" class="nb lq in np b gy oa nu l nv nw">      port: 8000</span><span id="b7fa" class="nb lq in np b gy oa nu l nv nw">      targetPort: 3000</span><span id="882f" class="nb lq in np b gy oa nu l nv nw">  selector:</span><span id="e326" class="nb lq in np b gy oa nu l nv nw">    app: node-app</span><span id="c077" class="nb lq in np b gy oa nu l nv nw">  type: LoadBalancer</span><span id="b11c" class="nb lq in np b gy oa nu l nv nw">  sessionAffinity: None</span><span id="1c65" class="nb lq in np b gy oa nu l nv nw">  externalTrafficPolicy: Cluster</span><span id="c19f" class="nb lq in np b gy oa nu l nv nw">status:</span><span id="3e64" class="nb lq in np b gy oa nu l nv nw">  loadBalancer: {}</span></pre><p id="396b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">执行:</p><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="06ea" class="nb lq in np b gy nt nu l nv nw">kubectl apply -f node-app-service.yaml</span></pre><p id="e149" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">要获取有关您的服务的信息:</p><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="6068" class="nb lq in np b gy nt nu l nv nw">kubectl get service</span></pre><p id="f004" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">将显示以下内容:</p><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="5c1c" class="nb lq in np b gy nt nu l nv nw">NAME             Type         EXTERNAL-IP  PORT(S)         AGE<br/>node-app-service LoadBalancer <strong class="np io">&lt;pending&gt;</strong>    8000:31386/TCP  36m</span></pre><p id="ec78" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">创建服务后，云基础设施需要时间来创建负载平衡器，并将其IP地址写入服务对象。那么，时间一直在流逝，为什么<strong class="kv io">外部IP </strong>仍然悬而未决？</p><p id="dece" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果Kubernetes在不支持<strong class="kv io">负载平衡器服务的环境中运行，</strong>负载平衡器<strong class="kv io">将不会被供应。</strong></p><p id="f0f6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在这种情况下，您需要一个可以附加到您的服务的IP。可以用<strong class="kv io"> Minikube IP </strong>。</p><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="68dc" class="nb lq in np b gy nt nu l nv nw">minikube ip</span></pre><p id="ce73" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">复制显示的Minikube IP并将其附加到您的外部IP服务。</p><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="60d9" class="nb lq in np b gy nt nu l nv nw">kubectl patch svc node-app-service  -p '{"spec": {"type": "LoadBalancer", "externalIPs":["YOUR_MINIKUBE_IP"]}}'</span></pre><p id="3af7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">显示有关服务的信息:</p><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="047f" class="nb lq in np b gy nt nu l nv nw">kubectl get service</span></pre><p id="ac3e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">结果:</p><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="bfe0" class="nb lq in np b gy nt nu l nv nw">NAME             Type         EXTERNAL-IP      PORT(S)         AGE<br/>node-app-service LoadBalancer 192.168.99.100   8000:31386/TCP  36m</span></pre><p id="b402" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">因此，您现在可以通过该IP地址或网络浏览器访问服务:</p><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="1a42" class="nb lq in np b gy nt nu l nv nw">curl 192.168.99.100:8000</span></pre><h1 id="25ce" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">奖金</h1><p id="9b9d" class="pw-post-body-paragraph kt ku in kv b kw mh jo ky kz mi jr lb lc mj le lf lg mk li lj lk ml lm ln lo ig bi translated">您需要一个交互式UI来显示您的Kubernetes集群？</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ob"><img src="../Images/5c4b05bfa44b8097a068450758894674.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MtvZpoS1NxNioWxP.png"/></div></div></figure><p id="2d9c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">默认情况下，不会部署仪表板UI。要部署它:</p><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="276c" class="nb lq in np b gy nt nu l nv nw">kubectl apply -f https://raw.githubusercontent.com/kubernetes/dashboard/v2.0.0-beta4/aio/deploy/recommended.yaml</span></pre><p id="eead" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">默认情况下，Kubernetes仪表板用户拥有有限的权限。在本节中，您将创建一个<code class="fe nx ny nz np b">eks-admin</code>服务帐户和集群角色绑定，您可以使用它以管理员级别的权限安全地连接到仪表板。</p><p id="4e79" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">用下面的文本创建一个名为<code class="fe nx ny nz np b">eks-admin-service-account.yaml</code>的文件。这个清单定义了一个名为<code class="fe nx ny nz np b">eks-admin</code>的服务帐户和集群角色绑定。</p><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="c746" class="nb lq in np b gy nt nu l nv nw">apiVersion: v1<br/>kind: ServiceAccount<br/>metadata:<br/>  name: eks-admin<br/>  namespace: kube-system<br/>---<br/>apiVersion: rbac.authorization.k8s.io/v1beta1<br/>kind: ClusterRoleBinding<br/>metadata:<br/>  name: eks-admin<br/>roleRef:<br/>  apiGroup: rbac.authorization.k8s.io<br/>  kind: ClusterRole<br/>  name: cluster-admin<br/>subjects:<br/>- kind: ServiceAccount<br/>  name: eks-admin<br/>  namespace: kube-system</span></pre><p id="9e58" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">将服务帐户和群集角色绑定应用到您的群集。</p><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="b1ae" class="nb lq in np b gy nt nu l nv nw"><strong class="np io">kubectl apply -f eks-admin-service-account.yaml</strong></span></pre><p id="71cd" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您需要一个用于<code class="fe nx ny nz np b">eks-admin</code>服务帐户的认证令牌。从输出中复制<code class="fe nx ny nz np b"><em class="oc">&lt;authentication_token&gt;</em></code>值。使用此令牌连接到仪表板。</p><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="a518" class="nb lq in np b gy nt nu l nv nw"><strong class="np io">kubectl -n kube-system describe secret $(kubectl -n kube-system get secret | grep eks-admin | awk '{print $1}')</strong></span></pre><p id="5275" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">输出</strong>:</p><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="16c5" class="nb lq in np b gy nt nu l nv nw">Name:         eks-admin-token-b5zv4<br/>Namespace:    kube-system<br/>Labels:       &lt;none&gt;<br/>Annotations:  kubernetes.io/service-account.name=eks-admin               kubernetes.io/service-account.uid=bcfe66ac-39be-11e8-97e8-026dce96b6e8<br/>Type:  kubernetes.io/service-account-token<br/>Data<br/>====<br/>ca.crt:     1025 bytes<br/>namespace:  11 bytes<br/>token:      <em class="oc">&lt;authentication_token&gt;</em></span></pre><p id="96a2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">您可以通过运行以下命令，使用kubectl命令行工具来访问仪表板:</p><pre class="kd ke kf kg gt no np nq nr aw ns bi"><span id="63f4" class="nb lq in np b gy nt nu l nv nw">kubectl proxy</span></pre><p id="3dda" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">可以访问<a class="ae ks" href="http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/#!/login" rel="noopener ugc nofollow" target="_blank">http://localhost:8001/API/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/#！/登录</a></p><p id="d116" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">选择<strong class="kv io">令牌</strong>，将上一条命令输出的<code class="fe nx ny nz np b"><em class="oc">&lt;authentication_token&gt;</em></code>粘贴到<strong class="kv io">令牌</strong>字段，选择<strong class="kv io">签到</strong>。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi od"><img src="../Images/910f6931de6194983e46482d2df35d79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/0*WjwXFhUbCnYbhUdN.png"/></div></figure><h1 id="4243" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">参考</h1><div class="oe of gp gr og oh"><a href="https://kubernetes.io/docs" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd io gy z fp om fr fs on fu fw im bi translated">Kubernetes文档</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">Kubernetes是一个开源容器编排引擎，用于自动部署、扩展和管理…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">kubernetes.io</p></div></div><div class="oq l"><div class="or l os ot ou oq ov km oh"/></div></div></a></div><div class="oe of gp gr og oh"><a href="https://docs.aws.amazon.com/eks/latest/userguide" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd io gy z fp om fr fs on fu fw im bi translated">亚马逊EKS</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">编辑描述</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">docs.aws.amazon.com</p></div></div></div></a></div><p id="20e6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">万岁，到此为止🤗</p><p id="9b1e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我希望你喜欢它。请在下面留下评论。如果你面临任何问题，留下你的评论，我会帮助你😉。</p><p id="afd2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我要感谢创建这个回购<a class="ae ks" href="https://github.com/contentful/the-example-app.nodejs" rel="noopener ugc nofollow" target="_blank">https://github.com/contentful/the-example-app.nodejs</a>的家伙，因为我可以在本文的示例应用程序中使用它。</p><h1 id="1255" class="lp lq in bd lr ls lt lu lv lw lx ly lz jt ma ju mb jw mc jx md jz me ka mf mg bi translated">下一篇文章再见！</h1></div><div class="ab cl ow ox hr oy" role="separator"><span class="oz bw bk pa pb pc"/><span class="oz bw bk pa pb pc"/><span class="oz bw bk pa pb"/></div><div class="ig ih ii ij ik"><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="pd pe l"/></div></figure></div></div>    
</body>
</html>