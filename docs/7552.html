<html>
<head>
<title>Creating and Configuring Virtual Network Gateway (Point-to-Site) Using Azure Certification Authentication</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Azure Certification身份验证创建和配置虚拟网络网关(点对点)</h1>
<blockquote>原文：<a href="https://medium.com/version-1/creating-and-configuring-virtual-network-gateway-point-to-site-using-azure-certification-7a5b61839e54?source=collection_archive---------0-----------------------#2022-05-26">https://medium.com/version-1/creating-and-configuring-virtual-network-gateway-point-to-site-using-azure-certification-7a5b61839e54?source=collection_archive---------0-----------------------#2022-05-26</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div class="er es hf"><img src="../Images/34d9ac6a31325075164f00d60ddd774e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1018/0*eHTGSHJhYCdofFPM"/></div></figure><div class=""/><figure class="ev ex im in io hj er es paragraph-image"><div role="button" tabindex="0" class="ip iq di ir bf is"><div class="er es il"><img src="../Images/d0d8e74ae0d19bfc1a1d766c26692195.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ojMVwXsrnla3xiNgquIcVg.png"/></div></div></figure><p id="065b" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">对于在云环境中运行的客户来说，确保与数据库资源的安全连接是一项重要要求和考虑事项。如今，客户希望从Azure内部/外部连接到他们的用于PostgreSQL  的<a class="ae jr" href="https://docs.microsoft.com/en-us/azure/postgresql/" rel="noopener ugc nofollow" target="_blank"> <strong class="iv hp"> Azure数据库，并且基于安全性和合规性要求，组织可以选择Azure数据库为PostgreSQL提供的选项之一。在本节中，我们将概述如何使用点对点网关从内部安全连接到PostgreSQL的Azure数据库的详细步骤。</strong></a></p><p id="d390" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">一个<a class="ae jr" href="https://docs.microsoft.com/en-us/azure/vpn-gateway/point-to-site-about" rel="noopener ugc nofollow" target="_blank"> <strong class="iv hp">点对点(P2S) </strong> </a> VPN网关连接让我们可以从一台单独的客户端计算机创建到虚拟网络的安全连接。P2S连接是通过从客户端计算机启动来建立的。这个解决方案对于想要从远程位置连接到Azure VNETs的远程工作者非常有用，比如从家里或会议上。</p><p id="73b1" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">点对点本机Azure证书身份验证连接使用以下项目，我们将在本练习中配置这些项目:</p><blockquote class="js jt ju"><p id="46a7" class="it iu jv iv b iw ix iy iz ja jb jc jd jw jf jg jh jx jj jk jl jy jn jo jp jq ha bi translated">*基于路由的VPN网关。</p><p id="8a53" class="it iu jv iv b iw ix iy iz ja jb jc jd jw jf jg jh jx jj jk jl jy jn jo jp jq ha bi translated">*公钥(。cer文件),它被上传到Azure。证书上传后，将被视为可信证书并用于身份验证。</p><p id="6c37" class="it iu jv iv b iw ix iy iz ja jb jc jd jw jf jg jh jx jj jk jl jy jn jo jp jq ha bi translated">*客户端证书由根证书生成。客户端证书安装在将连接到VNet的每台客户端计算机上。该证书用于客户端身份验证。</p><p id="bcf9" class="it iu jv iv b iw ix iy iz ja jb jc jd jw jf jg jh jx jj jk jl jy jn jo jp jq ha bi translated">*VPN客户端配置。VPN客户端是使用VPN客户端配置文件配置的。这些文件包含客户端连接到虚拟网络所需的信息。这些文件配置操作系统固有的现有VPN客户端。每个连接的客户端都必须使用配置文件中的设置进行配置。</p></blockquote><p id="3b59" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">虚拟网络网关使用一个称为网关子网的特定子网。网关子网是我们在配置虚拟网络时指定的虚拟网络IP地址范围的一部分。它包含虚拟网络网关资源和服务使用的IP地址。</p><p id="07ab" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">当我们创建网关子网时，我们指定子网包含的IP地址数量。所需的IP地址数量取决于我们想要创建的VPN网关配置。有些配置比其他配置需要更多的IP地址。Microsoft建议我们创建一个使用/27或/28的网关子网。</p><ol class=""><li id="1af4" class="jz ka ho iv b iw ix ja jb je kb ji kc jm kd jq ke kf kg kh bi translated">在<strong class="iv hp">搜索资源、服务和文档(G+/) </strong>中输入<strong class="iv hp">虚拟网关</strong>。在市场搜索结果中找到<strong class="iv hp">虚拟网关</strong>，选择它打开<strong class="iv hp">创建虚拟网关</strong>页面。</li></ol><figure class="ki kj kk kl fd hj er es paragraph-image"><div role="button" tabindex="0" class="ip iq di ir bf is"><div class="er es il"><img src="../Images/d7229f19998cc3c8be0d42387b7d0227.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wd-VjySorwpPNMkp6vhgzQ.png"/></div></div></figure><p id="8ec0" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">2.在<strong class="iv hp">基础</strong>选项卡上，填写<strong class="iv hp">项目详情</strong>和<strong class="iv hp">实例详情</strong>的值。</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div role="button" tabindex="0" class="ip iq di ir bf is"><div class="er es il"><img src="../Images/92cbebfac178a849b65ca1c80ac34514.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nt-B-xoKVXSbSJsTdYhJHA.png"/></div></div></figure><p id="8440" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">3.指定<strong class="iv hp">公共IP地址</strong>的值。这些设置指定与VPN网关关联的公共IP地址对象。创建VPN网关时，公共IP地址会动态分配给该对象。只有当网关被删除并重新创建时，公共IP地址才会改变。它不会随着我们VPN网关的大小调整、重置或其他内部维护/升级而改变。</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es km"><img src="../Images/69370cda2afe0dec251cd4dc232f192e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1150/format:webp/1*oaS3ZMU5tjdbTnPUFYDAbw.png"/></div></figure><p id="03c7" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">4.选择<strong class="iv hp">审查+创建</strong>运行验证。</p><p id="cd89" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">5.一旦验证通过，选择<strong class="iv hp">创建</strong>部署VPN网关。</p><p id="4cb3" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">6.<strong class="iv hp">使用Powershell生成和导出点对点证书。</strong></p><blockquote class="js jt ju"><p id="fa3e" class="it iu jv iv b iw ix iy iz ja jb jc jd jw jf jg jh jx jj jk jl jy jn jo jp jq ha bi translated">a)生成一个<strong class="iv hp">自签名的</strong>根证书。</p></blockquote><p id="aadb" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">I)从运行Windows 10或Windows Server 2016的计算机上，使用提升的权限打开Windows PowerShell控制台。</p><p id="c848" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">ii)使用以下脚本创建自签名根证书。以下脚本创建名为“P2SRootCert”的自签名根证书，该证书自动安装在“Certificates-Current User \ Personal \ Certificates”中。您可以通过打开<em class="jv"> certmgr.msc </em>或<em class="jv">管理用户证书</em>来查看证书。</p><p id="6c2a" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><em class="jv">$ cert = New-self signed certificate-Type Custom-key spec签名`</em></p><p id="313b" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><em class="jv">-Subject " CN = P2SRootCert "-KeyExportPolicy Exportable `</em></p><p id="3602" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><em class="jv">-hash algorithm sha 256-key length 2048 `</em></p><p id="93e6" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><em class="jv">-CertStoreLocation " Cert:\ CurrentUser \ My "-key usage property Sign-key usage CertSign</em></p><p id="34eb" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">iii)让PowerShell控制台保持打开状态，并继续执行后续步骤以生成客户端证书。</p><blockquote class="js jt ju"><p id="c8cc" class="it iu jv iv b iw ix iy iz ja jb jc jd jw jf jg jh jx jj jk jl jy jn jo jp jq ha bi translated">b)生成一个<strong class="iv hp">客户端证书</strong>。</p></blockquote><p id="383e" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">I)如果在创建自签名根证书后没有关闭PowerShell控制台，请使用以下命令。我们生成的客户端证书会自动安装在您计算机上的“证书—当前用户\个人\证书”中。</p><p id="c8ab" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">new-self signed certificate-Type Custom-DNS name p2s childcert-key spec签名</p><p id="ebbf" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><em class="jv">-Subject " CN = P2SChildCert "-KeyExportPolicy Exportable `</em></p><p id="ad75" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><em class="jv">-hash algorithm sha 256-key length 2048 `</em></p><p id="424f" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><em class="jv">-CertStoreLocation " Cert:\ CurrentUser \ My " `</em></p><p id="77c7" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><em class="jv">签名人$ cert-text extension @(" 2 . 5 . 29 . 37 = { text } 1 . 3 . 6 . 1 . 5 . 5 . 7 . 3 . 2 ")</em></p><blockquote class="js jt ju"><p id="5c9c" class="it iu jv iv b iw ix iy iz ja jb jc jd jw jf jg jh jx jj jk jl jy jn jo jp jq ha bi translated">c)导出<strong class="iv hp">根证书公钥</strong>(。cer)</p></blockquote><p id="a0b1" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">创建自签名根证书后，导出根证书公钥。cer文件(不是私钥)。我们稍后将把这个文件上传到Azure。以下步骤有助于导出。自签名根证书的cer文件:</p><p id="c857" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">I)要从证书中获取. cer文件，打开<strong class="iv hp">管理用户证书</strong>。找到自签名根证书，通常在“证书—当前用户\个人\证书”中，然后右键单击。点击<strong class="iv hp">所有任务</strong>，然后点击<strong class="iv hp">导出</strong>。这将打开<strong class="iv hp">证书导出向导</strong>。如果我们在当前用户\个人\证书下找不到证书，我们可能不小心打开了“证书—本地计算机”，而不是“证书—当前用户”)。如果我们想使用PowerShell在当前用户范围内打开证书管理器，我们在控制台窗口中键入<em class="jv"> certmgr </em>。</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es kn"><img src="../Images/d5efcb265e942d85671414e1f954fcd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1058/format:webp/1*aEPYcG4V0-2OYgbBT9yEaw.png"/></div></figure><p id="64aa" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">ii)在向导中，点击下一个的<strong class="iv hp">。</strong></p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es ko"><img src="../Images/52d2ff8e65ed9cf314072c69b3d6e620.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*qnLGfirOsfsYMPdKJuzQRw.png"/></div></figure><p id="4a9b" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">iii)选择<strong class="iv hp">否，不导出私钥</strong>，然后点击<strong class="iv hp">下一步</strong>。</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es kp"><img src="../Images/f3ae31fcca8d0e37dc8feb63c5342ad3.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/format:webp/1*7GcIJR-8zD1LU1pEStoEgQ.png"/></div></figure><p id="04a8" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">iv)在<strong class="iv hp">导出文件格式</strong>页面，选择<strong class="iv hp"> Base-64编码的X.509(。CER)。</strong>，然后点击<strong class="iv hp">下一步</strong>。</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es kq"><img src="../Images/6e8acfeae3f569120fd26b848444e805.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*hfmrj5PH334kXsuA2JtH6g.png"/></div></figure><p id="1ec1" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">v)在<strong class="iv hp">文件导出界面</strong>，<strong class="iv hp">浏览</strong>到我们想要导出证书的位置。对于<strong class="iv hp">文件名</strong>，命名证书文件。然后，点击下一个的<strong class="iv hp">。</strong></p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es kr"><img src="../Images/4b1f2c8c58e182c3bb4f046134249ff4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*WiT5ESz-OFf8BlAjLmQbpw.png"/></div></figure><p id="4e5e" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">vi)点击<strong class="iv hp">完成</strong>导出证书。</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es ks"><img src="../Images/0f462f1758c904100f2ed65095196c13.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/1*dX-5VZJVcjFi46NNxpSSpA.png"/></div></figure><p id="b984" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">vii)您的证书已成功导出。</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es kt"><img src="../Images/27b902df5372c9bc184fe7fcb7d5e0c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:346/format:webp/1*dOdVYxpLMsOJCTmBEN_kjA.png"/></div></figure><p id="7e9f" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">viii)导出的证书如下所示:</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es ku"><img src="../Images/9b46f9cb67ad29f558f10c92b2ed43be.png" data-original-src="https://miro.medium.com/v2/resize:fit:306/format:webp/1*LwNQnTftuqpTflKQS8zHAQ.png"/></div></figure><p id="31b7" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">ix)如果我们使用记事本打开导出的证书，我们会看到类似以下示例的内容。蓝色部分包含上传到Azure的信息。如果我们用记事本打开我们的证书，它看起来不像这样，通常这意味着我们没有使用Base-64编码的X.509导出它。CER)格式。此外，如果我们想使用不同的文本编辑器，请理解一些编辑器可能会在背景中引入非预期的格式。这可能会在将文本从该证书上载到Azure时产生问题。</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es kv"><img src="../Images/24b0f4905b38a39afc9cdecba2ca228e.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*86i6aGvbwQvl4FKiL4lspQ.png"/></div></figure><blockquote class="js jt ju"><p id="d75d" class="it iu jv iv b iw ix iy iz ja jb jc jd jw jf jg jh jx jj jk jl jy jn jo jp jq ha bi translated"><strong class="iv hp"> d) </strong>导出<strong class="iv hp">客户端证书。</strong></p></blockquote><p id="b81f" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">当我们生成客户端证书时，它会自动安装在我们用来生成它的计算机上。如果我们想在另一台客户端计算机上安装客户端证书，我们需要导出我们生成的客户端证书。</p><p id="5348" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">I)要导出客户端证书，请打开<strong class="iv hp">管理用户证书</strong>。默认情况下，我们生成的客户端证书位于“证书—当前用户\个人\证书”中。右键单击我们要导出的客户端证书，点击<strong class="iv hp">所有任务</strong>，然后点击<strong class="iv hp">导出</strong>，打开<strong class="iv hp">证书导出向导</strong>。</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es kw"><img src="../Images/c5c45b292b84196b750c26f5b5be8da9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*CR_tnupaYvCEM3zFSAVveQ.png"/></div></figure><p id="c5f9" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">ii)在证书导出向导中，单击下一步的<strong class="iv hp">继续。</strong></p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es kx"><img src="../Images/7ad7d3223d092e8cb154b43a22bb3a3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/format:webp/1*G-XGQhbds8xy_ZFKUJdx2w.png"/></div></figure><p id="07d1" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">iii)选择<strong class="iv hp">是，导出私钥</strong>，然后点击<strong class="iv hp">下一步</strong>。</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es ky"><img src="../Images/a5f3e80129b7fe42e24490f0a23abd87.png" data-original-src="https://miro.medium.com/v2/resize:fit:858/format:webp/1*kvn_cFDdrpQN7LK0EDeyyQ.png"/></div></figure><p id="8660" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">iv)在<strong class="iv hp">导出文件格式</strong>页面上，保留默认选择。确保<strong class="iv hp">包括认证路径中的所有证书，如果可能的话</strong>被选中。此设置还会导出成功进行客户端身份验证所需的根证书信息。没有它，客户端身份验证会失败，因为客户端没有受信任的根证书。然后，点击下一个的<strong class="iv hp">。</strong></p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es kz"><img src="../Images/a5e1fec69b2822c167ecf62427c7bac5.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*wL31aSip4CnOCiQ2MrUc4w.png"/></div></figure><p id="420f" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">v)在<strong class="iv hp">安全</strong>页面，我们必须保护私钥。如果我们选择使用密码，请确保记录或记住我们为此证书设置的密码。然后，点击下一个的<strong class="iv hp">。</strong></p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es la"><img src="../Images/7bc3c2eeda3105505e39347b8670e5e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:714/format:webp/1*6mpXa-3wEG_2WRnuWz53hg.png"/></div></figure><p id="7fdb" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">vi)在<strong class="iv hp">文件上的</strong>、<strong class="iv hp">浏览</strong>到我们要导出证书的位置。对于<strong class="iv hp">文件名</strong>，命名证书文件。然后，点击下一个的<strong class="iv hp">。</strong></p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es lb"><img src="../Images/c71cfa781d1f318e60e56608ba193345.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*VsZUMkTlVtpVA9cf4hc6pQ.png"/></div></figure><p id="e0dc" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">vii)点击<strong class="iv hp">完成</strong>导出证书。</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es kv"><img src="../Images/be4af6fa74694f1bfac89e556aafda34.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*MkX0SwuKeIElMXttOAzoyg.png"/></div></figure><p id="ee9c" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">7.添加<strong class="iv hp"> VPN客户端地址池。</strong></p><p id="8d34" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">客户端地址池是我们指定的一系列私有IP地址。通过点对点VPN连接的客户端会动态地从该范围接收一个IP地址。使用不与我们连接的本地位置或我们要连接的虚拟网络重叠的私有IP地址范围。如果我们配置了多个协议，而SSTP是其中一个协议，那么配置的地址池将在配置的协议之间平均分配。</p><p id="8e6a" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">I)创建虚拟网络网关后，导航至虚拟网络网关页面的<strong class="iv hp">设置</strong>部分。在<strong class="iv hp">设置</strong>中，选择<strong class="iv hp">点对点配置</strong>。选择<strong class="iv hp">立即配置</strong>打开配置页面。</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es lc"><img src="../Images/b17f90f05d3a7e9b8ccab08c5f6f654b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*M7m5PyqsLfoarU1oFhUVDA.png"/></div></figure><p id="b06e" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">ii)在<strong class="iv hp">点对点配置</strong>页面的<strong class="iv hp">地址池</strong>框中，添加我们要使用的私有IP地址范围。VPN客户端从我们指定的范围内动态接收IP地址。主动/被动配置最小子网掩码为29位，主动/主动配置最小子网掩码为28位。</p><p id="191e" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">iii)继续下一节，配置身份验证和隧道类型。</p><p id="53db" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">8.指定<strong class="iv hp">隧道</strong>类型和<strong class="iv hp">认证</strong>类型。</p><p id="3d0f" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">在本节中，我们指定隧道类型和身份验证类型。如果我们在点对点配置页面上没有看到隧道类型或验证类型，我们的网关使用的是基本SKU。基本SKU不支持IKEv2或RADIUS身份验证。如果我们想使用这些设置，我们需要删除并使用不同的网关SKU重新创建网关。</p><blockquote class="js jt ju"><p id="9d25" class="it iu jv iv b iw ix iy iz ja jb jc jd jw jf jg jh jx jj jk jl jy jn jo jp jq ha bi translated"><strong class="iv hp"> a)隧道式。</strong></p></blockquote><p id="7286" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">在<strong class="iv hp">点对点配置</strong>页面，选择<strong class="iv hp">隧道类型</strong>。选择隧道类型时，请注意以下事项:</p><p id="ab59" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">Android和Linux上的strongSwan客户端以及iOS和macOS上的本地IKEv2 VPN客户端将仅使用IKEv2隧道类型进行连接。</p><p id="2c66" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">ii) Windows客户端将首先尝试IKEv2，如果无法连接，他们将返回SSTP。</p><p id="8767" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">iii)我们可以使用OpenVPN客户端连接到OpenVPN隧道类型。</p><blockquote class="js jt ju"><p id="888d" class="it iu jv iv b iw ix iy iz ja jb jc jd jw jf jg jh jx jj jk jl jy jn jo jp jq ha bi translated"><strong class="iv hp"> b)认证类型。</strong></p></blockquote><p id="868d" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">对于<strong class="iv hp">认证类型</strong>，选择<strong class="iv hp"> Azure证书</strong>。</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div role="button" tabindex="0" class="ip iq di ir bf is"><div class="er es ld"><img src="../Images/c7da3c4716017681ffef3006bfbc3751.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nke5iNyxIutD7mgM62T6mQ.png"/></div></div></figure><p id="5543" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">9.上传<strong class="iv hp">根证书</strong>公钥信息</p><p id="3236" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">在本节中，我们将公共根证书数据上传到Azure。一旦上传了公共证书数据，Azure就可以使用它来认证已经安装了从受信任的根证书生成的客户端证书的客户端。</p><p id="6fc8" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">I)在<strong class="iv hp">根证书</strong>部分导航至我们的<strong class="iv hp">虚拟网络网关- &gt;点对点配置</strong>页面。仅当我们选择了<strong class="iv hp"> Azure certificate </strong>作为身份验证类型时，此部分才可见。</p><p id="2dca" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">ii)使用文本编辑器(如记事本)打开证书。复制证书数据时，请确保我们将文本复制为一个连续的行，没有回车或换行符。我们可能需要将文本编辑器中的视图修改为“显示符号/显示所有字符”,以查看回车和换行符。仅将以下部分作为一个连续行复制:</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es le"><img src="../Images/60e1228bea9da0605bf68b1f9c223947.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*fLotprKFRucN77MD6jwoqw.png"/></div></figure><p id="11b3" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">iii)在<strong class="iv hp">根证书</strong>部分，我们最多可以添加20个可信根证书。</p><p id="9b66" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">iv)将证书数据粘贴到<strong class="iv hp">公共证书数据</strong>字段。</p><p id="3af7" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">v) <strong class="iv hp">证书名称</strong>。</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div role="button" tabindex="0" class="ip iq di ir bf is"><div class="er es lf"><img src="../Images/25f551694e04fa6fcbe3e9939aa72d25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xZsm5Wc99dgdQEnZn14cEw.png"/></div></div></figure><p id="48fb" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">vi)选择页面顶部的<strong class="iv hp">保存</strong>保存所有配置设置。</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es lg"><img src="../Images/bb00e5d7a3f6dfc631f03269f5c55513.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*rrgqYZm5jiYlj_3wCi8sJQ.png"/></div></figure><p id="9d10" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">10.生成并安装用于证书认证的<strong class="iv hp"> VPN客户端配置文件</strong>配置文件。</p><p id="4d38" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">当我们使用点到点和证书身份验证连接到Azure VNet时，我们使用的是本地安装在我们所连接的操作系统上的VPN客户端。VPN客户端的所有必要配置设置都包含在VPN客户端配置zip文件中。zip文件中的设置有助于您轻松地为Windows、Mac IKEv2 VPN或Linux配置VPN客户端。</p><p id="c0a7" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">我们生成的VPN客户端配置文件特定于虚拟网络的P2S VPN网关配置。如果在我们生成文件后对点对点VPN配置有任何更改，例如对VPN协议类型或身份验证类型的更改，我们需要生成新的VPN客户端配置文件，并将新的配置应用到我们想要连接的所有VPN客户端。</p><blockquote class="js jt ju"><p id="93f4" class="it iu jv iv b iw ix iy iz ja jb jc jd jw jf jg jh jx jj jk jl jy jn jo jp jq ha bi translated"><strong class="iv hp"> a)使用Azure Portal生成文件。</strong></p></blockquote><p id="f912" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">I)在Azure门户中，导航到我们要连接的虚拟网络的虚拟网络网关。</p><p id="4434" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">ii)在虚拟网关页面，选择<strong class="iv hp">点对点配置</strong>，打开点对点配置页面。</p><p id="b5c3" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">iii)在点对点配置页面的顶部，选择<strong class="iv hp">下载VPN客户端</strong>。它不下载VPN客户端软件，而是生成用于配置VPN客户端的配置包。生成客户端配置包需要几分钟时间。在此期间，在数据包生成之前，我们可能看不到任何指示。</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es lh"><img src="../Images/fbb7be8bf6a920cf6644a8112ed3365b.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/1*Y-gfsBc8O5YsYFLHl4528w.png"/></div></figure><p id="a04f" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">iv)生成配置包后，我们的浏览器会显示一个可用的客户端配置zip文件。它的名字和我们的网关一样。解压缩文件以查看文件夹。</p><blockquote class="js jt ju"><p id="911d" class="it iu jv iv b iw ix iy iz ja jb jc jd jw jf jg jh jx jj jk jl jy jn jo jp jq ha bi translated"><strong class="iv hp"> b)安装配置文件。</strong></p></blockquote><p id="3671" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">I)选择与Windows计算机架构相对应的VPN客户端配置文件。对于64位处理器体系结构，请选择“VpnClientSetupAmd64”安装程序包。对于32位处理器体系结构，请选择“VpnClientSetupX86”安装程序包。</p><p id="e5c4" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">ii)双击软件包进行安装。如果我们看到一个SmartScreen弹出窗口，单击<strong class="iv hp">更多信息</strong>，然后<strong class="iv hp">继续运行</strong>。</p><p id="80f4" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">11.测试连接</p><p id="4736" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">I)要连接到我们的虚拟网络，在客户端计算机上，导航到VPN设置并找到我们创建的VPN连接。它和我们的虚拟网络同名。选择<strong class="iv hp">连接</strong>。可能会出现一条弹出消息，提示您使用证书。选择<strong class="iv hp">继续</strong>使用提升的权限。</p><p id="a483" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">ii)在<strong class="iv hp">连接</strong>状态页面，选择<strong class="iv hp">连接</strong>开始连接。如果我们看到一个<strong class="iv hp">选择证书</strong>屏幕，验证显示的客户端证书是我们想要用来连接的证书。如果不是，使用下拉箭头选择正确的证书，然后选择<strong class="iv hp">确定</strong>。</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es li"><img src="../Images/5adc88e307d349a74d99f885cbb509a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/format:webp/1*IQynAqvq-A7ahpidd4AX2Q.png"/></div></figure><p id="8299" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">iii)您的连接已建立。</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es lj"><img src="../Images/f767f5904da74d8a5ad4bc9ab7763663.png" data-original-src="https://miro.medium.com/v2/resize:fit:758/format:webp/1*ytoPeHdSVriLCwAiJZG-XA.png"/></div></figure><p id="fbd4" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><strong class="iv hp">这是一个四部分系列的第二部分，可以在下面查看:</strong></p><p id="f9e2" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><a class="ae jr" rel="noopener" href="/version-1/vnet-integratedpostgresql-integration-with-power-bi-app-12950039e687">第1部分—创建虚拟网络和PostgreSQL </a> <br/> <a class="ae jr" rel="noopener" href="/version-1/installing-odbc-driver-for-remote-connection-to-postgresql-db-9b8d496e50e4">第3部分—安装远程连接PostgreSQL DB的ODBC驱动程序</a> <br/> <a class="ae jr" rel="noopener" href="/version-1/configuring-of-data-gateway-in-power-bi-f7f95882f19">第4部分—在Power BI中配置数据网关</a></p><p id="ee1b" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">如果你对此感兴趣或有任何反馈，请在评论区告诉我。</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div role="button" tabindex="0" class="ip iq di ir bf is"><div class="er es lk"><img src="../Images/55508b206adf191ba33c3ee95399e634.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oCwj8UZknfuwZrdXbIV9Cw.jpeg"/></div></div></figure><p id="960c" class="pw-post-body-paragraph it iu ho iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><strong class="iv hp">关于作者:<br/> </strong> Raghavendra BN是一名DevOps工程师，目前在Version 1的Foundation的团队工作。关注版本1和Raghavendra BN，了解更多关于Microsoft Azure和Azure DevOps的博客。</p></div></div>    
</body>
</html>