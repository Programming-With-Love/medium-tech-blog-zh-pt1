<html>
<head>
<title>Pinterest Trends: Insights into unstructured data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Pinterest趋势:对非结构化数据的洞察</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/pinterest-trends-insights-into-unstructured-data-b4dbb2c8fb63?source=collection_archive---------3-----------------------#2016-04-01">https://medium.com/pinterest-engineering/pinterest-trends-insights-into-unstructured-data-b4dbb2c8fb63?source=collection_archive---------3-----------------------#2016-04-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="b690" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">斯蒂芬妮·罗杰斯|发现网站Pinterest工程师</p><p id="35b4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">品友们对什么话题感兴趣？他们什么时候最关注这些话题？他们如何参与这些话题？为了回答这些问题，我们构建了一个内部web服务，该服务将<a class="ae jc" href="https://en.wikipedia.org/wiki/Unstructured_data" rel="noopener ugc nofollow" target="_blank">非结构化</a>数据可视化，并帮助我们更好地理解及时的趋势，我们可以通过产品向Pinners重新展示这些趋势。该工具显示最受欢迎的大头针，以及在大头针和搜索中的关键字的时间序列趋势。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/ef0ffa3ee6722a0f24a0cb477dea7d5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1260/format:webp/0*rnWET5FHRFv1xLTK.png"/></div></figure><p id="6034" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该工具的一个用例是，它帮助我们了解Pinners对什么主题感兴趣，这种兴趣通常发生在什么时候，以及他们如何参与这些主题。具体到何时，我们随着时间的推移可视化关键词，以更容易地识别主题的季节性或趋势，但最强大的洞察力来自于通过顶级pin了解Pinner行为。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jl"><img src="../Images/17b238dd293c13f2a7fcfb5649c78107.png" data-original-src="https://miro.medium.com/v2/resize:fit:1146/format:webp/0*KRVSxu7eY4K3hbNQ.png"/></div></figure><p id="6431" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">例如，简单地搜索一个节日，比如“情人节”，我们可以看到在2月14日前两个月，人们的兴趣开始上升。但是对关键词的兴趣还不够；我们想确定何时应该开始推广不同类型的产品。我们看到男性品酒师在高峰开始时会看产品。这些人都是有远见的人，他们在寻找需要提前预订的礼物。大约在假期前2-3天，男性品酒师主要看DIY工艺品和烘焙食品，这些东西不需要太多时间，或者可以在前一天晚上在便利店买到。最后，在情人节那天，我们看到了很多关于孤独的幽默模因。我们能够在几秒钟内发现这些参与趋势。</p><p id="a1f9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">情人节前的男性时尚趋势</strong></p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jm"><img src="../Images/30f496abb7553955cef0000fb9f9306c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/0*8dnSGOb5pNkz_n1k.png"/></div></figure><p id="0993" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">【2015年1月—产品</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jm"><img src="../Images/766b36084be3b192740f11fee3a69152.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/0*h2x3zMPtvlr5D4MN.png"/></div></figure><p id="509a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">【2015年2月初— DIY &amp;烘焙食品</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jo"><img src="../Images/8acf45932989eeed0e88451d1019e54d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/format:webp/0*4qzR58qdEtFCsKTa.png"/></div></figure><p id="6f1c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jn">2015年2月14日——孤独的迷因</em></p><h2 id="a48f" class="jp jq hh bd jr js jt ju jv jw jx jy jz ip ka kb kc it kd ke kf ix kg kh ki kj bi translated">动机</h2><p id="ee03" class="pw-post-body-paragraph ie if hh ig b ih kk ij ik il kl in io ip km ir is it kn iv iw ix ko iz ja jb ha bi translated">任何关键字趋势解决方案的核心部分都是能够对属性执行全文搜索。虽然MapReduce对于查询围绕大头针的结构化内容很好，但在回答需要全文搜索的查询时却很慢。另一方面，ElasticSearch 提供了一个分布式的全文搜索引擎。</p><p id="448f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过使用ElasticSearch对pin周围的非结构化数据(如描述、标题和兴趣)进行索引，我们开发了一个工具，可以实时处理全文查询，并以用户友好的方式可视化趋势和相关pin。在较高层次上，该工具提供了针对引脚描述的关键字搜索和搜索查询，以:</p><ul class=""><li id="d0ec" class="kp kq hh ig b ih ii il im ip kr it ks ix kt jb ku kv kw kx bi translated">使用给定的关键字查找前N个大头针或搜索查询</li><li id="a6b2" class="kp kq hh ig b ih ky il kz ip la it lb ix lc jb ku kv kw kx bi translated">显示和比较时间序列趋势，包括每天的重复和搜索量</li></ul><p id="85f6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">此外，该工具还通过各种细分来过滤关键词量，包括位置、性别、兴趣、类别和时间。</p><h2 id="0191" class="jp jq hh bd jr js jt ju jv jw jx jy jz ip ka kb kc it kd ke kf ix kg kh ki kj bi translated">履行</h2><ol class=""><li id="30bb" class="kp kq hh ig b ih kk il kl ip ld it le ix lf jb lg kv kw kx bi translated"><strong class="ig hi">提取</strong>所有与引脚相关的文本</li><li id="12c9" class="kp kq hh ig b ih ky il kz ip la it lb ix lc jb lg kv kw kx bi translated"><strong class="ig hi">将</strong> Pin文本插入弹性搜索</li><li id="cf58" class="kp kq hh ig b ih ky il kz ip la it lb ix lc jb lg kv kw kx bi translated"><strong class="ig hi">索引</strong>文本数据(ElasticSearch为我们做这件事)</li><li id="2cfa" class="kp kq hh ig b ih ky il kz ip la it lb ix lc jb lg kv kw kx bi translated"><strong class="ig hi">构建</strong>服务来调用应用程序后端的ElasticSearch API</li><li id="e877" class="kp kq hh ig b ih ky il kz ip la it lb ix lc jb lg kv kw kx bi translated"><strong class="ig hi">使用Flask和ReactJS在应用前端可视化</strong>数据</li></ol><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lh"><img src="../Images/6033356919335e3eccfc4c4c7abd6ba6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/0*yIZ27XOTIsEYPHFT.png"/></div></figure><h2 id="bb62" class="jp jq hh bd jr js jt ju jv jw jx jy jz ip ka kb kc it kd ke kf ix kg kh ki kj bi translated">挑战</h2><p id="7189" class="pw-post-body-paragraph ie if hh ig b ih kk ij ik il kl in io ip km ir is it kn iv iw ix ko iz ja jb ha bi translated"><strong class="ig hi">数据收集</strong> <br/>收集与Pin相关的所有文本，包括描述、标题、标记的兴趣、类别和时间戳，以及Pinner人口统计数据，需要可扩展的复杂逻辑。我们使用一系列<a class="ae jc" href="https://hive.apache.org/" rel="noopener ugc nofollow" target="_blank"> Hive </a>和<a class="ae jc" href="https://www.cascading.org/" rel="noopener ugc nofollow" target="_blank">级联</a>作业(两者都是基于MapReduce的框架)每晚运行一个<a class="ae jc" href="https://engineering.pinterest.com/blog/open-sourcing-pinball" rel="noopener ugc nofollow" target="_blank"> Pinball </a>工作流，以提取前一天与pin相关的所有文本并将其转储到我们的ElasticSearch集群中，然后该集群对这些文本进行索引。</p><p id="726b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">设计</strong></p><p id="8b36" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一个主要的设计决策是使用每日索引(每天一个索引)，因为许多高容量的时间序列项目默认都是这样做的，包括<a class="ae jc" href="http://logstash.net/docs/1.4.0.beta1/tutorials/getting-started-with-logstash" rel="noopener ugc nofollow" target="_blank"> Logstash </a>。使用这些每日索引对我们整个系统的可伸缩性和性能有几个好处，包括:</p><ul class=""><li id="b4ad" class="kp kq hh ig b ih ii il im ip kr it ks ix kt jb ku kv kw kx bi translated">增加了指定时间范围的灵活性。</li><li id="5d11" class="kp kq hh ig b ih ky il kz ip la it lb ix lc jb ku kv kw kx bi translated">由于文档在各个节点之间分布良好，读取速度更快。</li><li id="8e95" class="kp kq hh ig b ih ky il kz ip la it lb ix lc jb ku kv kw kx bi translated">每个查询中涉及的索引数量最少，以避免相关的开销。</li><li id="1ba0" class="kp kq hh ig b ih ky il kz ip la it lb ix lc jb ku kv kw kx bi translated">通过并行调用进行大容量插入或大容量读取。</li><li id="c5fa" class="kp kq hh ig b ih ky il kz ip la it lb ix lc jb ku kv kw kx bi translated">失败后更容易恢复。</li><li id="7505" class="kp kq hh ig b ih ky il kz ip la it lb ix lc jb ku kv kw kx bi translated">更容易调整集群的属性(碎片数量、复制等。).较小的索引导致测试这些不可变属性的迭代更快。</li></ul><p id="dc9d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">可扩展性</strong></p><p id="d9a7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">尽管使用了大数据技术，但我们的工作流面临着各种可扩展性挑战。数据太多，无法运行简单的Hive查询，因此我们优化了Hive查询设置，切换到级联作业，并在实现选择上进行权衡。</p><p id="6c73" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">到目前为止，每天超过14GB的数据和大约两年的存储数据(总共大约10TB的数据)使我们的弹性搜索集群面临更大的可扩展性问题。我们不得不通过添加更多节点来不断扩展我们的集群。如今，我们有33个I 2.2 x大搜索节点和3个m 3.2 x大主节点。虽然不需要复制来防止数据丢失，因为ES不是主要的持久存储，但我们仍然决定使用1的复制因子(即所有数据有两个副本)来将读取负载分散到多台服务器上。</p><p id="474b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">性能</strong></p><p id="4211" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在启动我们的原型之后，我们看到了应用程序性能有很大的改进空间，尤其是随着用户数量的增长。我们从原始HTTP请求转换到了弹性搜索Python客户端，并优化了服务中的弹性搜索查询代码，从而使性能提高了2倍。我们还实现了服务器端和客户端缓存，以获得更频繁查询的即时结果的额外好处。所有这些优化的最终结果是为用户提供两秒钟的查询。</p><h2 id="d67c" class="jp jq hh bd jr js jt ju jv jw jx jy jz ip ka kb kc it kd ke kf ix kg kh ki kj bi translated">结果</h2><p id="69e3" class="pw-post-body-paragraph ie if hh ig b ih kk ij ik il kl in io ip km ir is it kn iv iw ix ko iz ja jb ha bi translated">这一创新工具取得了巨大成功。使用是普遍的内部获得Pinner见解，突出受欢迎的内容，甚至检测垃圾邮件。</p><p id="861e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您有兴趣研究像这样的大规模数据处理和分析挑战，<a class="ae jc" href="https://careers.pinterest.com/careers/details/data-engineer_san-francisco_15423" rel="noopener ugc nofollow" target="_blank">加入我们的团队</a>！</p><p id="f205" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jn">致谢:该项目是Pinterest内部多个团队的共同努力。各个团队提供了深刻的反馈和建议。主要工程贡献者包括</em> <a class="ae jc" href="https://www.pinterest.com/stogers/" rel="noopener ugc nofollow" target="_blank"> <em class="jn">斯蒂芬妮·罗杰斯</em> </a> <em class="jn">、</em> <a class="ae jc" href="https://www.pinterest.com/justinmpier/" rel="noopener ugc nofollow" target="_blank">、<em class="jn">贾斯汀·梅杰拉达-皮尔、</em>、</a>、<em class="jn">王春燕以及数据工程团队的其他成员。</em></p></div></div>    
</body>
</html>