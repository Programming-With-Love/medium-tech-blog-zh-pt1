# 将大型 ML 系统引入生产——第 2 部分

> 原文：<https://medium.com/walmartglobaltech/taking-big-ml-systems-to-productions-part-2-1653d7e8fa1f?source=collection_archive---------7----------------------->

在讨论的第[部分-1](/walmartlabs/taking-big-ml-systems-to-productions-part-1-c2d24b039bf) 中，讨论了解决方案的可扩展性和兼容性。在这一部分，将讨论解决方案的持久性、生产反馈、解决方案的适应性和成本效益。

# 溶液耐久性

![](img/6f2b0538c440f1f458714e795e834cbd.png)

Image Source : [Google Images](https://img.pngio.com/house-of-cards-house-of-cards-playing-free-png-images-clipart-house-of-cards-png-920_1292.png)

任何算法都会对它被训练的数据有一定的偏向。数据科学家试图通过对各种抵制和盲样进行严格测试来消除偏见。但是，这个测试都是在历史数据上进行的。即使是坚守者也增加了对过去的偏见，也就是说，如果未来的行为完全不同，模型将表现不佳。

模型性能可以通过使模型更一般化和稍微宽松(没有太多的过度拟合)来处理，但是系统必须对任何类型的数据容错，并且必须能够通知用户这些问题，例如，系统必须能够处理新的字段、字段中丢失的值太多、值太少。可能需要进行一些检查，以便与过去的数据/生产运行进行比较。

在智能预测中，当提供的数据太少(< 5 次观察)时，算法会优雅地退出，并在日志中提供此类信息。还有一个默认算法，它在所有情况下都运行，并生成预测，在最坏的情况下，预测会发送到下游系统。

尽管良好编码的算法适用于任何类型的数据，但重要的是要创建渠道，让开发人员/数据科学家了解系统状态的变化，例如数据的变化(一些度量，如数值字段的矩)、数据的新鲜度、数据质量(填充率和分布)以及模型性能(开发和验证)。这些度量标准与企业使用的不同。其中一些还可以以深入仪表板的形式呈现，以跟踪整个系统的重要方面。

解决方案的持久性还源于如何处理极限情况和最坏情况，例如工程和基础设施团队分别创建灾难恢复(DR)策略和业务连续性计划(BCP)。对于智能预测，已经创建了多个回退阶段——

*   默认算法——一个简单的状态空间模型，运行速度快，故障率非常低，已被创建为默认回退模型。在任何其他算法失败的情况下，预测默认为该模型
*   新项目模型—一个简单的新项目模型，最初用于预测新项目，也用于预测缺失项目(由于缺乏数据，数据科学方法会遗漏这些项目)
*   预测轮换—由于每周都会生成未来 52 周的预测，因此在所有其他策略失败的情况下，上周的预测会轮换一周

# 生产反馈

![](img/fa87ee332eff89ea82c77a99cc6baa46.png)

使用历史数据的回溯测试可以测试的内容是有限的，因为所有这些都将偏向于过去，而全新的未来趋势可能会丢失。必须有一种方法可以快速将实际生产系统的反馈提供给开发人员/数据科学家。这种反馈只能来自最终用户。

在生产系统中，结果调整形式的用户反馈不仅会改变下游反馈，还会作为数据科学家的反馈。在新冠肺炎爆发期间，由于没有来自数据的信号，智能预测系统无法衡量杂货项目的需求增长，但需求经理改写了预测，导致销售增加，反过来又是系统的反馈。对于智能预测，需求经理所做的更改会导致销售的变化并提供反馈。

除了这些间接反馈之外，还应该有一种机制可以让用户直接反馈系统性能，这些用户可以更快地看到系统性能的恶化。通常，任何与欺诈相关的系统都严重依赖于用户反馈，这些系统会追踪不断变化的欺诈者。在智能预测中，数据科学家以吉拉票的形式从最终用户那里获得反馈，并从这些票中识别一些趋势/主题，这有助于改进解决方案。在一个这样的案例中，需求经理的几份报告指出了长期(16-17 年)预测的问题

# 溶液适应性

![](img/1021a1f6c844e1a179684fde01cf6557.png)

Image Source : [Google Images](https://webstockreview.net/images/chameleon-clipart-transparent-background.png)

数据科学家团队一直致力于通过后端实验来改进解决方案。生产系统必须足够灵活以实现所有的变化。其中一些可能是较小的代码变化，然而一些可能是算法的完全变化，系统必须被设计来适应这些变化。

所编写的系统应该能够不仅在数据和结构方面，而且在算法和软件包方面纳入各种变化。在智能预测中，机器学习工程师已经建立了一个模型传播管道。它为数据科学家提供了使用自己选择的编程语言和工具来开发算法的灵活性，并且还可以轻松处理包的更改。这也提供了水平扩展解决方案的能力。

此外，在合并多个模型方面，有一个脚本编写，它可以采用任何数量的模型，只要它们的偏好顺序，它可以生成最终预测。它还可以处理各种组装技术，如线性堆叠。

该解决方案还必须足够灵活，以便在更大的地理范围内实施，并且在本地有重要的功能，该解决方案必须能够轻松地包括本地变量。智能预测模型以模块化方式编写，为所有地理区域生成一组核心功能，然后通过新脚本和各种配置文件可以生成任意数量的国家特定功能。

# 解决方案的成本效益

解决方案的这一方面经常被削弱，通常在业务部门的反对下，才由产品经理接手。如果解决方案节省的成本不超过其成本的“x”倍，并且该“x”通常应该大于 5，但总是大于 1，则该解决方案在商业场景中是不经济的。有一些研究项目确实忽略了成本效益方面，但这是一个单独的讨论，在这些情况下，生产就绪性也不起作用。解决方案有时需要修改以降低成本，即使存在对最优的补偿。

在 Smart Forecasting 中，编写了一个模块来在 GPU 上并行执行奇异值分解(SVD)和多个大型矩阵，这在生产环境中节省了一些时间，但是已经确定这个特定的 SVD 不是速率限制步骤。移动这一部分将需要额外的 GPU，并将增加解决方案的成本，这就是为什么只在 CPU 上执行 SVD

# 结束讨论

要使一个解决方案足够健壮，还有许多其他的事情需要考虑，比如与上游和下游系统的集成，系统的协调，这些都需要强大的工程和架构。

无论创建什么系统，都需要不断的改进，这需要大量的数据科学实验。请记住，实验比生产运行需要更多的计算能力，因此一个非常好的开发环境和基础设施也是成功的生产实现的需要之一。

数据科学系统的回归运行只是提供是否所有的集成都已就位，这对于保持系统的活力至关重要。对性能的真正测试要么是实时反馈，要么是对历史数据的回溯测试，必须对这些进行持续监控以发现问题。

像任何其他系统一样，这些 DS 解决方案也需要生产支持，不仅仅是在工程方面，还包括算法问题。

多名数据科学家的持续开发工作将导致数据科学流中的大量技术债务，这应使用生产力管理工具进行良好跟踪，例如，在智能预测中，由于实施时间限制，定价计算使用复杂的次优逻辑实施。它被跟踪为技术债务，后来以简化的方式实现。

最后，这些解决方案通常使用许多可以跨项目和团队重用的小组件来构建，并且必须构建这些组件来促进可重用性，例如，模型传播管道是通用模块，并且可以在任何机器学习管道中使用。