<html>
<head>
<title>Demystifying Python Logging</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">揭开Python日志记录的神秘面纱</h1>
<blockquote>原文：<a href="https://medium.com/globant/demystifying-python-logging-ba015ece202e?source=collection_archive---------0-----------------------#2020-11-16">https://medium.com/globant/demystifying-python-logging-ba015ece202e?source=collection_archive---------0-----------------------#2020-11-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="59a6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最重要的方面之一，同时也是我在python中发现的最弱的方面:处理日志。对我来说，看到程序充满了本质上服务于两个目的的印记似乎很奇怪:调试和作为执行中的进程或程序的出口。在一个项目中，出现了如何以有序和标准的方式处理日志的问题，当然，经过一些研究，我找到了一种方法来实现我想要的结果:通过控制台输出，同时写入磁盘，在一个我喜欢的程序输出文件中:仅使用<a class="ae jc" href="https://python.org/" rel="noopener ugc nofollow" target="_blank"> Python </a> <a class="ae jc" href="https://docs.python.org/2/library/logging.html" rel="noopener ugc nofollow" target="_blank">日志</a>库就足以实现我们代码结果的体面输出。</p><h1 id="535a" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">我们只使用了2个python的标准库模块。</h1><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="4470" class="kk je hh kg b fi kl km l kn ko">import time<br/>import logging</span></pre><h1 id="3d95" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">基本配置</h1><p id="d7fe" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">我们定义了基本配置，这是将用于写入磁盘的配置，请注意，我们使用了asctime、levelname(日志级别)和消息本身。我们还配置了默认的“级别”和输出文件的名称(可以有相对或绝对路径)</p><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="7669" class="kk je hh kg b fi kl km l kn ko">logging.basicConfig(format='%(asctime)s %(levelname)-8s %    (message)s',datefmt='%m/%d/%Y %I:%M:%S',<br/>                  filename='output.log',<br/>                  level=logging.DEBUG)</span></pre><h1 id="4676" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">安慰</h1><p id="f126" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">现在是控制台的配置:我们使用StreamHandler()和默认的INFO级别来代替basicConfig。使用完全相同的输出格式，也许你想使用不同的输出格式。您可以在文档中更好地看到<a class="ae jc" href="https://docs.python.org/2/library/logging.html" rel="noopener ugc nofollow" target="_blank">日志</a>是如何工作的。</p><p id="e116" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，我们将处理程序添加到日志记录中，以便两者同时发生。即写入磁盘并显示在控制台中。</p><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="1bc3" class="kk je hh kg b fi kl km l kn ko">console = logging.StreamHandler()<br/>console.setLevel(logging.INFO)formatter = logging.Formatter(<br/>    '%(asctime)s %(levelname)-8s: %(message)s')console.setFormatter(formatter)logging.getLogger('').addHandler(console)</span></pre><h1 id="f3c8" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">例子</h1><p id="7995" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">我将展示一些使用示例，注意，我们必须手动设置我们想要显示的日志级别，也就是说，库本身不能确定它是一个错误、信息还是什么。我们必须根据代码块的可能行为自己完成，注意:</p><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="f2b9" class="kk je hh kg b fi kl km l kn ko">a = 'a string'<br/>try:<br/>    b = a + 1<br/>except TypeError as e:<br/>    logging.error('OH! There has been an error: {}'.format(e))</span></pre><h1 id="39a6" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">啊！产量呢？</h1><p id="92ec" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">最后，这是我们新配置的日志的输出。</p><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="798e" class="kk je hh kg b fi kl km l kn ko">05/17/2018 10:41:44 INFO     Inicio de mi programa<br/>05/17/2018 10:41:46 WARNING  Una advertencia<br/>05/17/2018 10:41:46 ERROR    OH! Ha ocurrido un error: Can't convert 'int' object to str implicitly<br/>05/17/2018 10:41:46 CRITICAL Huston tenemos un problema! No podemos sumar strings y enteros<br/>05/17/2018 10:41:46 INFO     Fin de la diversion (por ahora)<br/>05/17/2018 10:42:56 INFO     Inicio de mi programa<br/>05/17/2018 10:42:58 WARNING  Una advertencia<br/>05/17/2018 10:42:58 ERROR    OH! Ha ocurrido un error: Can't convert 'int' object to str implicitly<br/>05/17/2018 10:42:58 CRITICAL Huston tenemos un problema! No podemos sumar strings y enteros<br/>05/17/2018 10:43:00 INFO     Fin de la diversion (por ahora)</span></pre><h1 id="a512" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">代码</h1><p id="740c" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">这是完整的代码:</p><pre class="kb kc kd ke fd kf kg kh ki aw kj bi"><span id="6cb4" class="kk je hh kg b fi kl km l kn ko"># Don't forget to import your modules<br/>import time<br/>import logging<br/># log basic conf<br/>logging.basicConfig(format='%(asctime)s %(levelname)-8s %(message)s',<br/>                    datefmt='%m/%d/%Y %I:%M:%S',<br/>                    filename='output.log',<br/>                    level=logging.DEBUG)<br/># Handler which writes INFO messages or higher to the sys.stderr<br/>console = logging.StreamHandler()<br/>console.setLevel(logging.INFO)<br/># set a format which is simpler for console use<br/>formatter = logging.Formatter(<br/>    '%(asctime)s %(levelname)-8s: %(message)s')<br/># tell the handler to use this format<br/>console.setFormatter(formatter)<br/># add the handler to the root logger<br/>logging.getLogger('').addHandler(console)</span><span id="6402" class="kk je hh kg b fi ku km l kn ko"># lets play<br/>logging.info('Starting the program')<br/># time delay to see better how time logging works<br/>time.sleep(2)<br/># lets test a warning<br/># Notice: we get to handle the severity of the logs<br/>logging.warn('Showing a warning')</span><span id="3b3e" class="kk je hh kg b fi ku km l kn ko">a = 'a string'<br/>try:<br/>    b = a + 1<br/>except TypeError as e:<br/>    # we can combine our own text with the system output<br/>    logging.error('OH! There has been an error: {}'.format(e))</span><span id="9fd2" class="kk je hh kg b fi ku km l kn ko"># keep testing this<br/>if isinstance(a, str):<br/>    logging.fatal(<br/>        'Huston we\'ve got a problem cannot sum strings to integers')</span><span id="cb5b" class="kk je hh kg b fi ku km l kn ko">time.sleep(2)<br/># end of the fun<br/>logging.info('End of the fun (by now)')</span></pre><h1 id="688b" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">结论</h1><p id="85a5" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">正如我在上面展示的python的日志库或模块，几行代码和一些使用规则可以改善你的脚本或程序。给你的代码输出一个专业的外观，同时将数据发送到屏幕或文件是非常容易的，就像每一个像样的软件所做的那样。从现在开始，停止使用print语句来完成这个任务，因为这不是它的主要目的，并利用日志记录的力量！</p></div></div>    
</body>
</html>