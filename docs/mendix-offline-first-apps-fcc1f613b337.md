# 不要让用户失望，拥抱制作离线第一应用

> 原文：<https://medium.com/mendix/mendix-offline-first-apps-fcc1f613b337?source=collection_archive---------6----------------------->

![](img/ae2be58e8abb5d57cc888190cfc5dfee.png)

在一个万物始终互联的世界里，我们为什么想要[离线应用](https://bit.ly/34KUW9y)？在这个世界上，当 WiFi、网络或 4G 连接丢失时，每个人都很恐慌，不知道该怎么办——无论连接状态如何，创建始终工作的应用程序变得更加重要。离线优先的方法是在设备上本地存储和处理数据，因此应用程序总是可以顺利工作，用户可以执行他们的任务。除了同步和更新之外，不需要任何连接。因此，它使一个人能够随时随地工作。

在这篇博客文章中，我们的 Mendix 专家和离线优先大师 Marcel Groeneweg 将详细介绍如何让您的离线优先应用程序获得成功。除此之外，Marcel 将讨论他预计(或知道)Mendix 8 在未来几个月将发布什么，以及这将如何实现 Mendix 中的离线优先功能。几个主题如同步问题、 [JavaScript 动作](https://bit.ly/3bn6zGA)和[纳米流](https://bit.ly/2xFi8Kv)将被解释以及如何正确使用它们。除此之外，Marcel 将分享他与几个客户一起使用离线优先功能的经验，并回顾他在 Mendix World 2019 期间与 Danny Roest(Mendix 产品经理)一起做的演示。

# 为什么离线优先应用？

## 连接受限或丢失

当一个人走进电梯或停车场，这些地方的互联网是有限的，他们希望他们的应用程序继续工作。在拥挤的区域，连接可能会受到限制，但在这里，人们也希望他的应用程序能够保持平稳工作。在线应用的问题在于，一旦失去连接，应用就会中断。离线优先应用程序将继续工作，并尽可能与后端同步。该应用程序不保持开放的网络连接。页面和数据不需要从后端检索。这不仅有利于用户在任何地方工作，还可以防止每次操作后都与服务器同步。因此，这也是一个巨大的性能改进，即使在快速的 Wi-Fi 网络上，应用程序的响应时间也大大提高了。

## 同步

为了保持服务器日期与应用程序数据同步，离线应用程序将在互联网连接可用时同步所有相关数据。目前，有两个级别的同步，下面将对每个级别进行更详细的描述。

## 自动同步

这是基本级别，也是 Mendix 7 的唯一选项。Mendix 模型查看导航配置文件，并识别通过离线导航配置文件访问的页面上使用的实体。还考虑了使用检索活动在纳流中检索的数据。当然，实体访问规则决定了用户将在设备上拥有哪些数据。

## 可配置同步

通常情况下，应用程序用户被允许访问比设备所需更多的数据，例如，去年的销售订单。Mendix 8 中一个令人兴奋的新选项是可以从 modeler 中非常容易地配置自定义同步选项，允许您限制存储在设备上的数据。请注意，实体访问规则仍然适用。同步可以通过导航配置文件进行配置。

对于那些希望同步的内容少于用户被授权的内容的实体，可以在实体上指定一个 XPath 约束。在本例中，我们只需要当前用户的帐户。已经在业务流程中“转移”并标记为仅在线的数据也不应再在设备上可用。

## 更多同步功能即将推出

除了指定 XPath 约束，还会有更多的同步特性:

调用一个微流，它不仅可以返回一个对象列表，还可以返回整个对象结构

在应用后端甚至其他系统上调用 REST 服务，这些功能将允许您处理更复杂的任务，举几个例子:

o 通过仅同步更改，在设备上维护主数据的同步副本

o 仅在请求时更新主数据，同时尽可能同步交易

# JavaScript 操作

从 Mendix 8 开始，您可以用与我们已经在微流中使用的 Java 动作相同的方式创建定制的 [JavaScript 动作](https://bit.ly/3bn6zGA)。这打开了设备环境，以访问设备特征或超越当前纳流功能的限制进行工作。此外，我们需要定制小部件的操作现在可以通过 nanoflow 来完成，比如拍照或检查我们是否有连接。Mendix 已经通过提供一系列 JS 动作做了很好的工作。我们甚至围绕这个主题举办了 MVP JS 动作黑客马拉松，这很棒，并且开发了许多新的 JavaScript 动作。

*请注意，如果您使用原生移动快速入门应用程序创建您的应用程序，您将已经拥有这些 JS 操作。然而，这些模块经常更新，所以请留意它们*

# 纳流共享

[Nanoflow Commons](https://bit.ly/3ewRsMo) 包含了一个很棒的函数集合，可以让你的开发者生活更轻松，一些例子:

显示来自纳流的确认对话框并等待结果

拨打电话号码

在设备上打开地图

获取当前位置

## 本地移动操作

[原生移动](https://bit.ly/2zbH90p)动作进一步扩展了列表，增加了在原生移动应用中使用的动作。一些例子:

从 nanoflow 拍摄照片或访问图片库。再也不需要自定义小部件了

检查网络连接

访问设备信息

各种通知功能

在你的应用图标上设置徽章号码

# 亚纳流呼叫

终于！Mendix 7 的主要负担之一是你不能重用纳流功能，调用亚纳流是不可能的。很多时候，这导致了大量的复制和巨大的纳米流。在 Mendix 8 中，可以将它们分成易于管理的块和可重用的功能

对 Offline-First 很好奇，想知道如何让它成功，点击下面的链接，查看完整的博文和图片(PDF)。

[](https://www.itvisors.nl/nl/nieuws/blog-offline-first/) [## 博客:先离线

### 在一个一切都时刻相连的世界里，我们为什么要离线应用呢？在这个世界里，每个人…

www.itvisors.nl](https://www.itvisors.nl/nl/nieuws/blog-offline-first/)