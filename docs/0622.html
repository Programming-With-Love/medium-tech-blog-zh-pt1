<html>
<head>
<title>Working with Package Visibility</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用包可见性</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/working-with-package-visibility-dc252829de2d?source=collection_archive---------3-----------------------#2021-04-01">https://medium.com/androiddevelopers/working-with-package-visibility-dc252829de2d?source=collection_archive---------3-----------------------#2021-04-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/4cd671fabcd8cbccbeb6ae73ea2af2f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n5pW2DYxV2CVczFxTMPcpQ.jpeg"/></div></div></figure><div class=""/><p id="db4b" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在Android中，我们正在进行更改，以增强用户隐私和平台安全性，为我们的用户提供更安全的体验。针对Android 11 (API级别30)或更高版本的应用程序将只能看到安装在设备上的应用程序的<a class="ae jn" href="https://developer.android.com/training/package-visibility/automatic" rel="noopener ugc nofollow" target="_blank">过滤列表。为了访问过滤列表之外的应用程序，应用程序将需要使用Android清单中的<code class="du jo jp jq jr b">&lt;queries&gt;</code>元素直接声明它们需要与之交互的应用程序。这篇博文将介绍如何适应这一特性的最佳实践。</a></p><h1 id="cbfd" class="js jt hs bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">查询并与应用程序交互:</h1><p id="3ee7" class="pw-post-body-paragraph ip iq hs ir b is kq iu iv iw kr iy iz ja ks jc jd je kt jg jh ji ku jk jl jm ha bi translated">有多种不同的方式来查询应用程序并与之交互:</p><ul class=""><li id="0848" class="kv kw hs ir b is it iw ix ja kx je ky ji kz jm la lb lc ld bi translated">如果您知道想要查询或与之交互的特定应用程序集，请将它们的<a class="ae jn" href="https://developer.android.com/training/package-visibility/declaring#package-name" rel="noopener ugc nofollow" target="_blank">包</a>名称包含在<code class="du jo jp jq jr b">&lt;queries&gt;</code>元素内的一组<code class="du jo jp jq jr b">&lt;package&gt;</code>元素中。</li></ul><figure class="le lf lg lh fd hj"><div class="bz dy l di"><div class="li lj l"/></div></figure><ul class=""><li id="600e" class="kv kw hs ir b is it iw ix ja kx je ky ji kz jm la lb lc ld bi translated">如果您的应用程序需要查询或与一组服务于特定目的的应用程序交互，但您可能不知道要包含的特定包名，您可以在您的<code class="du jo jp jq jr b">&lt;queries&gt;</code>元素中列出<a class="ae jn" href="https://developer.android.com/training/package-visibility/declaring#intent-filter-signature" rel="noopener ugc nofollow" target="_blank">意图过滤器签名</a>。然后你的应用程序可以发现具有匹配的<code class="du jo jp jq jr b">&lt;intent-filter&gt;</code>元素的应用程序。</li></ul><figure class="le lf lg lh fd hj"><div class="bz dy l di"><div class="li lj l"/></div></figure><ul class=""><li id="e2ec" class="kv kw hs ir b is it iw ix ja kx je ky ji kz jm la lb lc ld bi translated">如果您需要查询一个<a class="ae jn" href="https://developer.android.com/training/package-visibility/declaring#provider-authority" rel="noopener ugc nofollow" target="_blank">内容提供者</a>但是不知道具体的包名，您可以在一个<code class="du jo jp jq jr b">&lt;provider&gt;</code>元素中声明提供者权限。</li></ul><figure class="le lf lg lh fd hj"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="8466" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们通过只查询您需要交互的包来鼓励数据最小化。<code class="du jo jp jq jr b">QUERY_ALL_PACKAGES</code>或相当宽泛的<code class="du jo jp jq jr b">&lt;intent&gt;</code>元素应该只由需要这种级别信息的应用程序使用。我们的<a class="ae jn" href="https://support.google.com/googleplay/android-developer/answer/10446026" rel="noopener ugc nofollow" target="_blank">新包可见性政策</a>引入了新<code class="du jo jp jq jr b">QUERY_ALL_PACKAGES</code>权限的批准流程，该权限控制对设备上已安装应用的完整清单的访问。</p><h1 id="e927" class="js jt hs bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">活动标志:</h1><p id="6e4a" class="pw-post-body-paragraph ip iq hs ir b is kq iu iv iw kr iy iz ja ks jc jd je kt jg jh ji ku jk jl jm ha bi translated">大多数常见的用例根本不要求你的应用程序具有包可见性。对于很多场景，如果没有app可以打开这个意图，可以使用<code class="du jo jp jq jr b">startActivity()</code>并捕捉异常。</p><figure class="le lf lg lh fd hj"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="f2f6" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">虽然你可以在目标不可见的情况下启动任何活动，但你无法在启动之前查询该活动的可用性，也无法了解将启动哪个特定应用，因为这是一个<a class="ae jn" href="https://developer.android.com/guide/components/intents-filters#Types" rel="noopener ugc nofollow" target="_blank">隐含意图</a>。相反，如果问题没有解决，您将在启动时收到通知。如果你想更好地选择打开的内容，你可以使用标志。</p><p id="5855" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">使用标志的一个常见例子是<a class="ae jn" href="https://developer.chrome.com/docs/android/custom-tabs/overview/" rel="noopener ugc nofollow" target="_blank">自定义标签</a>，它允许开发者自定义浏览器的外观和感觉，并对web内容体验有更多的控制。如果可用，链接将在非浏览器应用程序中正确打开，但在高级情况下，当开发人员希望在使用自定义选项卡之前选择性地处理本机应用程序中的内容时，标记会有所帮助。简而言之，这个标志帮助开发人员确定是否有一个本地应用程序可以导航，并且从那里他们可以按照他们想要的方式处理它。</p><h2 id="fe86" class="lk jt hs bd ju ll lm ln jy lo lp lq kc ja lr ls kg je lt lu kk ji lv lw ko lx bi translated">标志_活动_要求_非浏览器</h2><p id="623b" class="pw-post-body-paragraph ip iq hs ir b is kq iu iv iw kr iy iz ja ks jc jd je kt jg jh ji ku jk jl jm ha bi translated">此标志仅在解析为非浏览器的结果时启动意图。如果不存在这样的结果，将抛出一个<code class="du jo jp jq jr b"><a class="ae jn" href="https://developer.android.com/reference/android/content/ActivityNotFoundException" rel="noopener ugc nofollow" target="_blank">ActivityNotFoundException</a></code>,然后你的应用程序可以在一个自定义标签中打开该URL。</p><figure class="le lf lg lh fd hj"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="7a24" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果一个意图包括这个标志，当调用将直接启动一个浏览器应用或者调用将向用户显示一个歧义消除对话框，其中唯一的选项是浏览器应用时，对<code class="du jo jp jq jr b">startActivity()</code>的调用导致抛出一个<code class="du jo jp jq jr b">ActivityNotFoundException</code>。要了解关于标志的更多信息，请参见<a class="ae jn" href="https://developer.android.com/training/basics/intents/package-visibility-use-cases#let-non-browser-apps-handle-urls" rel="noopener ugc nofollow" target="_blank">基于用例配置包可见性</a>。</p><h1 id="71bd" class="js jt hs bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">自定义共享表</h1><p id="dd26" class="pw-post-body-paragraph ip iq hs ir b is kq iu iv iw kr iy iz ja ks jc jd je kt jg jh ji ku jk jl jm ha bi translated">我们建议使用系统共享表，而不是自定义表。您可以自定义系统共享表，而无需应用可见性。更多信息请参考本文件。</p><h1 id="b3b4" class="js jt hs bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">调试包可见性</h1><p id="ed3c" class="pw-post-body-paragraph ip iq hs ir b is kq iu iv iw kr iy iz ja ks jc jd je kt jg jh ji ku jk jl jm ha bi translated">您可以很容易地检查您的清单，以查看所有查询包括在内。为此，请转到您的清单文件并选择“合并清单”。</p><figure class="le lf lg lh fd hj er es paragraph-image"><div class="er es ly"><img src="../Images/369e6763698adc0814ebadc1d9bf5641.png" data-original-src="https://miro.medium.com/v2/resize:fit:684/format:webp/1*EuEy6HDaoxCQVvrFqesn9g.png"/></div></figure><p id="7d5c" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您还可以启用包过滤的日志消息来查看默认可见性如何影响您的应用程序:</p><figure class="le lf lg lh fd hj"><div class="bz dy l di"><div class="li lj l"/></div></figure><h1 id="c79b" class="js jt hs bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">后续步骤:</h1><p id="9257" class="pw-post-body-paragraph ip iq hs ir b is kq iu iv iw kr iy iz ja ks jc jd je kt jg jh ji ku jk jl jm ha bi translated">有关包可见性的更多信息，请查看以下资源:</p><ul class=""><li id="a091" class="kv kw hs ir b is it iw ix ja kx je ky ji kz jm la lb lc ld bi translated"><a class="ae jn" href="https://developer.android.com/training/package-visibility" rel="noopener ugc nofollow" target="_blank">包装可见性—文档</a></li><li id="48a8" class="kv kw hs ir b is lz iw ma ja mb je mc ji md jm la lb lc ld bi translated"><a class="ae jn" rel="noopener" href="/androiddevelopers/package-visibility-in-android-11-cc857f221cd9">Android 11中的包可见性——博文</a></li></ul><h2 id="0bce" class="lk jt hs bd ju ll lm ln jy lo lp lq kc ja lr ls kg je lt lu kk ji lv lw ko lx bi translated">编码快乐！</h2></div></div>    
</body>
</html>