<html>
<head>
<title>EC by Example: CountBy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">EC示例:CountBy</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/ec-by-example-countby-a2d6411e95e1?source=collection_archive---------1-----------------------#2019-01-06">https://medium.com/oracledevs/ec-by-example-countby-a2d6411e95e1?source=collection_archive---------1-----------------------#2019-01-06</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="13cf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">学习如何在<a class="ae jg" href="https://github.com/eclipse/eclipse-collections" rel="noopener ugc nofollow" target="_blank"> Eclipse集合</a>中使用<code class="du jc jd je jf b">countBy</code>方法。</p><figure class="ji jj jk jl fd jm er es paragraph-image"><div role="button" tabindex="0" class="jn jo di jp bf jq"><div class="er es jh"><img src="../Images/e4ff24d2f4aa5a0694841bc6ad1de74c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OQCbBTIEwqJ4sDx7qxTaEw.png"/></div></div><figcaption class="jt ju et er es jv jw bd b be z dx">Count the fruit by color</figcaption></figure><h1 id="376b" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">CountBy</h1><p id="07f5" class="pw-post-body-paragraph ie if hh ig b ih kv ij ik il kw in io ip kx ir is it ky iv iw ix kz iz ja jb ha bi translated">方法<code class="du jc jd je jf b">countBy</code>返回Eclipse集合中的一个<code class="du jc jd je jf b"><a class="ae jg" rel="noopener" href="/oracledevs/bag-the-counter-2689e901aadb">Bag</a></code>。一个<code class="du jc jd je jf b">Bag</code>是一个无序的<code class="du jc jd je jf b">Collection</code>，它允许重复。Eclipse集合中的<code class="du jc jd je jf b"><a class="ae jg" href="https://www.eclipse.org/collections/javadoc/9.2.0/org/eclipse/collections/impl/bag/mutable/HashBag.html" rel="noopener ugc nofollow" target="_blank">HashBag</a></code>实现的内部结构是一个<code class="du jc jd je jf b"><a class="ae jg" href="https://www.eclipse.org/collections/javadoc/9.2.0/org/eclipse/collections/impl/map/mutable/primitive/ObjectIntHashMap.html" rel="noopener ugc nofollow" target="_blank">ObjectIntHashMap</a></code>。内部映射的关键字是项目，值是存储为int的计数。方法<code class="du jc jd je jf b"><a class="ae jg" href="https://www.eclipse.org/collections/javadoc/9.2.0/org/eclipse/collections/api/RichIterable.html#countBy-org.eclipse.collections.api.block.function.Function-" rel="noopener ugc nofollow" target="_blank">countBy</a></code>将一个<code class="du jc jd je jf b">Function</code>作为参数。</p><p id="0670" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面的代码将说明如何使用一个方法引用，根据颜色对一组<code class="du jc jd je jf b">Fruit</code>进行计数。我们将结果存储在一个名为<code class="du jc jd je jf b"><strong class="ig hi">COUNTS_BY_COLOR</strong></code> <strong class="ig hi">的变量中。</strong></p><pre class="ji jj jk jl fd la jf lb bn lc ld bi"><span id="0e17" class="le jy hh jf b be lf lg l lh li">public enum Fruit<br/>{<br/>    APPLE(Color.RED),<br/>    BANANA(Color.YELLOW),<br/>    CHERRY(Color.RED),<br/>    PEAR(Color.GREEN),<br/>    STRAWBERRY(Color.RED),<br/>    LEMON(Color.YELLOW),<br/>    KIWI(Color.GREEN);<br/><br/>    private final Color color;<br/><br/>    private static final ImmutableBag&lt;Color&gt; COUNTS_BY_COLOR =<br/>            Bags.immutable.with(Fruit.values())<br/>               .countBy(Fruit::getColor);<br/><br/>    Fruit(Color color)<br/>    {<br/>        this.color = color;<br/>    }<br/><br/>    public Color getColor()<br/>    {<br/>        return this.color;<br/>    }<br/><br/>    public static int getColorCount(Color color)<br/>    {<br/>        return COUNTS_BY_COLOR.occurrencesOf(color);<br/>    }<br/><br/>    public static boolean isTopColor(Color color)<br/>    {<br/>        return COUNTS_BY_COLOR.topOccurrences(1)<br/>                .anySatisfy(each -&gt; each.getOne() == color);<br/>    }<br/><br/>    public enum Color<br/>    {<br/>        RED, YELLOW, GREEN<br/>    }<br/>}</span></pre><p id="1437" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们有两个方法来查询创建的<code class="du jc jd je jf b">ImmutableBag</code>。它们用于以下测试。</p><pre class="ji jj jk jl fd la jf lb bn lc ld bi"><span id="8773" class="le jy hh jf b be lf lg l lh li">public class FruitTest<br/>{<br/>    @Test<br/>    public void redFruit()<br/>    {<br/>        Assertions.assertEquals(3, <br/>                Fruit.getColorCount(Fruit.Color.RED));<br/>        Assertions.assertTrue(<br/>                Fruit.isTopColor(Fruit.Color.RED));<br/>    }<br/><br/>    @Test<br/>    public void yellowFruit()<br/>    {<br/>        Assertions.assertEquals(2, <br/>                Fruit.getColorCount(Fruit.Color.YELLOW));<br/>        Assertions.assertFalse(<br/>                Fruit.isTopColor(Fruit.Color.YELLOW));<br/>    }<br/><br/>    @Test<br/>    public void greenFruit()<br/>    {<br/>        Assertions.assertEquals(2, <br/>                Fruit.getColorCount(Fruit.Color.GREEN));<br/>        Assertions.assertFalse(<br/>                Fruit.isTopColor(Fruit.Color.GREEN));<br/>    }<br/>}</span></pre><p id="870d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">更新日期:2023年1月</p><p id="94a4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">时隔四年，我重访了这个博客。我看到了下面的代码，并意识到这个例子是在实现<code class="du jc jd je jf b">containsBy</code>模式之前编写的。每当我看到<code class="du jc jd je jf b">anySatisfy</code>与<code class="du jc jd je jf b">equals</code>或身份检查一起使用时，我本能地知道可以使用名为<code class="du jc jd je jf b">contains</code>的更高级模式。在这种情况下，<code class="du jc jd je jf b">contains</code>不起作用的地方在于需要应用<code class="du jc jd je jf b">Function</code>来检查特定属性的包含性。在这种情况下，被测试的属性是<code class="du jc jd je jf b">ObjectIntPair.getOne()</code>。</p><pre class="ji jj jk jl fd la jf lb bn lc ld bi"><span id="6204" class="le jy hh jf b be lf lg l lh li">public static boolean isTopColor(Color color)<br/>{<br/>    return COUNTS_BY_COLOR.topOccurrences(1)<br/>            .anySatisfy(each -&gt; each.getOne() == color);<br/>}</span></pre><p id="33ed" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用<code class="du jc jd je jf b">containsBy</code>可将代码重写如下。</p><pre class="ji jj jk jl fd la jf lb bn lc ld bi"><span id="87a7" class="le jy hh jf b be lf lg l lh li">public static boolean isTopColor(Color color)<br/>{<br/>    return COUNTS_BY_COLOR.topOccurrences(1)<br/>            .containsBy(ObjectIntPair::getOne, color);<br/>}</span></pre><p id="131d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我在下面的博客中描述了<code class="du jc jd je jf b">containsBy</code>方法是如何发展而来的。</p><div class="lj lk ez fb ll lm"><a rel="noopener follow" target="_blank" href="/javarevisited/fusing-methods-for-productivity-c15c9eb2d666"><div class="ln ab dw"><div class="lo ab lp cl cj lq"><h2 class="bd hi fi z dy lr ea eb ls ed ef hg bi translated">提高生产率的融合方法</h2><div class="lt l"><h3 class="bd b fi z dy lr ea eb ls ed ef dx translated">当一个迭代模式如此普遍时，你给它一个名字。</h3></div><div class="lu l"><p class="bd b fp z dy lr ea eb ls ed ef dx translated">medium.com</p></div></div><div class="lv l"><div class="lw l lx ly lz lv ma jr lm"/></div></div></a></div><h1 id="c596" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">示例中涉及的API</h1><ol class=""><li id="b08c" class="mb mc hh ig b ih kv il kw ip md it me ix mf jb mg mh mi mj bi translated"><code class="du jc jd je jf b"><a class="ae jg" href="https://www.eclipse.org/collections/javadoc/9.2.0/org/eclipse/collections/api/bag/ImmutableBag.html#countBy-org.eclipse.collections.api.block.function.Function-" rel="noopener ugc nofollow" target="_blank">countBy</a></code> —按指定的<code class="du jc jd je jf b">Function</code>对<code class="du jc jd je jf b">Collection</code>元素进行计数，并返回一个<a class="ae jg" href="https://www.eclipse.org/collections/javadoc/9.2.0/org/eclipse/collections/api/bag/Bag.html" rel="noopener ugc nofollow" target="_blank">包</a>。</li><li id="19e2" class="mb mc hh ig b ih mk il ml ip mm it mn ix mo jb mg mh mi mj bi translated"><code class="du jc jd je jf b"><a class="ae jg" href="https://www.eclipse.org/collections/javadoc/9.2.0/org/eclipse/collections/impl/factory/Bags.html" rel="noopener ugc nofollow" target="_blank">Bags</a>.immutable.with</code> —用指定的可变参数元素创建一个<code class="du jc jd je jf b">ImmutableBag</code>。Eclipse集合中有<a class="ae jg" rel="noopener" href="/@donraab/as-a-matter-of-factory-part-1-mutable-75cc2c5d72d9">可变</a>和<a class="ae jg" rel="noopener" href="/@donraab/as-a-matter-of-factory-part-2-immutable-8cb72ff897ee">不可变</a> <code class="du jc jd je jf b">Collection</code>工厂。</li><li id="0357" class="mb mc hh ig b ih mk il ml ip mm it mn ix mo jb mg mh mi mj bi translated"><code class="du jc jd je jf b"><a class="ae jg" href="https://www.eclipse.org/collections/javadoc/9.2.0/org/eclipse/collections/api/bag/Bag.html#occurrencesOf-java.lang.Object-" rel="noopener ugc nofollow" target="_blank">occurrencesOf</a></code> —从<code class="du jc jd je jf b">Bag</code>返回特定项目的计数。</li><li id="8b02" class="mb mc hh ig b ih mk il ml ip mm it mn ix mo jb mg mh mi mj bi translated"><code class="du jc jd je jf b"><a class="ae jg" href="https://www.eclipse.org/collections/javadoc/9.2.0/org/eclipse/collections/api/bag/Bag.html#topOccurrences-int-" rel="noopener ugc nofollow" target="_blank">topOccurrences</a></code> —返回一个<code class="du jc jd je jf b">List</code>项目及其按出现次数降序排列的计数。</li></ol><p id="684d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">查看这个<a class="ae jg" href="http://eclipse.github.io/eclipse-collections-kata/api-design" rel="noopener ugc nofollow" target="_blank">演示</a>以了解关于Eclipse集合API的起源、设计和发展的更多信息。</p><p id="92f5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jg" href="https://github.com/eclipse/eclipse-collections" rel="noopener ugc nofollow" target="_blank"> <em class="mp">月食收藏</em> </a> <em class="mp">开作</em> <a class="ae jg" href="https://github.com/eclipse/eclipse-collections/blob/master/CONTRIBUTING.md" rel="noopener ugc nofollow" target="_blank"> <em class="mp">投稿</em> </a> <em class="mp">。如果你喜欢这个库，你可以在GitHub上让我们知道。</em></p></div></div>    
</body>
</html>