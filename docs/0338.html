<html>
<head>
<title>Android on Chrome OS — Implementing Drag &amp; Drop</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Chrome操作系统上的Android实现拖放</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/android-on-chrome-os-implementing-drag-drop-2cc2bdcdc621?source=collection_archive---------9-----------------------#2018-03-16">https://medium.com/androiddevelopers/android-on-chrome-os-implementing-drag-drop-2cc2bdcdc621?source=collection_archive---------9-----------------------#2018-03-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="9282" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">向您的Android应用程序添加拖放功能</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/39e8d40e389370d5bb51f7f62424f265.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gKtFb0wMy51vKrvM5Lz31g.png"/></div></div></figure><p id="7521" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">虽然<a class="ae ke" href="https://developer.android.com/guide/topics/ui/drag-drop.html" rel="noopener ugc nofollow" target="_blank">拖放</a>从Honeycomb 3.0开始就可以用于Android，但是越来越多的大屏幕Android设备(平板电脑、可折叠和Chrome OS)使得这项功能更加有用，也更加重要。</p><p id="a890" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这篇文章将向你展示如何通过创建一个可以从Chrome OS文件管理器接收文件的拖放目标来实现拖放。它还演示如何将TextView设置为可拖动项。</p><p id="d67d" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">完整示例的源代码可以在<a class="ae ke" href="https://github.com/android/user-interface-samples/tree/main/AndroidOnChromeOSDragAndDropDemo" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="8d0b" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">请注意:这里找到的所有代码都是根据<a class="ae ke" href="https://www.apache.org/licenses/LICENSE-2.0" rel="noopener ugc nofollow" target="_blank"> Apache 2.0许可证</a>授权的，并不是任何谷歌官方产品的一部分。</p><p id="bd0f" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">2021年10月21日更新:移除了不再需要的特殊Chrome OS MIME类型，并将代码片段转换为Kotlin。</p><h1 id="7fb8" class="kg kh hh bd ki kj kk kl km kn ko kp kq in kr io ks iq kt ir ku it kv iu kw kx bi translated">Chrome操作系统、平板电脑、可折叠和大屏幕注意事项</h1><ul class=""><li id="1c7f" class="ky kz hh jk b jl la jo lb jr lc jv ld jz le kd lf lg lh li bi translated">您必须通过<strong class="jk hi">requestDragAndDropPermissions</strong>请求权限，才能访问从应用程序外部拖入的项目</li><li id="0734" class="ky kz hh jk b jl lj jo lk jr ll jv lm jz ln kd lf lg lh li bi translated">您的可拖动项目必须有标志<strong class="jk hi">视图。<em class="kf"> DRAG_FLAG_GLOBAL </em> </strong>以便被拖出到其他应用程序</li></ul><h1 id="ba9b" class="kg kh hh bd ki kj kk kl km kn ko kp kq in kr io ks iq kt ir ku it kv iu kw kx bi translated">设置放置目标</h1><p id="1f5d" class="pw-post-body-paragraph ji jj hh jk b jl la ii jn jo lb il jq jr lo jt ju jv lp jx jy jz lq kb kc kd ha bi translated">先把<strong class="jk hi">这边的事情摆好</strong>再说。Android使用<strong class="jk hi"> DragListeners </strong>来设置目标以响应拖动事件。侦听器告诉系统它可以接收哪种类型的项目，提供视觉反馈，并处理成功的投放。</p><h2 id="8257" class="lr kh hh bd ki ls lt lu km lv lw lx kq jr ly lz ks jv ma mb ku jz mc md kw me bi translated">翁德拉格</h2><p id="a65e" class="pw-post-body-paragraph ji jj hh jk b jl la ii jn jo lb il jq jr lo jt ju jv lp jx jy jz lq kb kc kd ha bi translated">首先创建一个空的<a class="ae ke" href="https://developer.android.com/reference/android/view/View.OnDragListener.html" rel="noopener ugc nofollow" target="_blank"> OnDragListener </a>:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="fa1a" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">每当Android中发生拖动事件时，就会调用onDrag 。例如，如果一个用户开始从文件管理器中拖动一个文件，这就是你告诉你的用户界面视觉响应，并表明它可以接收文件。<strong class="jk hi"> onDrag </strong>还定义了当项目悬停在目标上方以及实际被放下时会发生什么。</p><p id="cf7b" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">查看官方文档，了解不同<a class="ae ke" href="https://developer.android.com/guide/topics/ui/drag-drop.html#AboutDragEvent" rel="noopener ugc nofollow" target="_blank">拖动事件</a>的完整描述，简短版本如下:</p><ul class=""><li id="cb62" class="ky kz hh jk b jl jm jo jp jr mh jv mi jz mj kd lf lg lh li bi translated"><strong class="jk hi">拖动任何一项都会触发动作_拖动_启动</strong>。您的目标应该过滤它可以接收的有效项目，并提供它是就绪目标的视觉指示。</li><li id="8bdd" class="ky kz hh jk b jl lj jo lk jr ll jv lm jz ln kd lf lg lh li bi translated"><strong class="jk hi">动作_拖动_进入</strong>和<strong class="jk hi">动作_拖动_退出</strong>在项目被拖动并进入/退出目标区域时触发。提供视觉反馈，让用户知道他们正在拖放区。</li><li id="d0d0" class="ky kz hh jk b jl lj jo lk jr ll jv lm jz ln kd lf lg lh li bi translated"><strong class="jk hi">动作_掉落</strong>在物品实际掉落时触发。在此处理项目。</li><li id="2a8b" class="ky kz hh jk b jl lj jo lk jr ll jv lm jz ln kd lf lg lh li bi translated"><strong class="jk hi">拖放成功或取消时，触发ACTION_DRAG_ENDED </strong>。将用户界面恢复到正常状态。</li></ul><p id="b40f" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">现在让我们充实一下每个<strong class="jk hi"> onDrag </strong>行动案例。</p><h2 id="bbf7" class="lr kh hh bd ki ls lt lu km lv lw lx kq jr ly lz ks jv ma mb ku jz mc md kw me bi translated">动作_拖动_开始</h2><p id="eca4" class="pw-post-body-paragraph ji jj hh jk b jl la ii jn jo lb il jq jr lo jt ju jv lp jx jy jz lq kb kc kd ha bi translated">每当开始拖动时，都会触发此事件。我们需要指出我们是否可以接收这个特定的项目(返回真)或不(返回假)，并在视觉上让用户知道我们是否可以。拖动事件将包含一个<strong class="jk hi"> ClipDescription </strong>，它包含关于被拖动项目的信息。</p><p id="e062" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在<strong class="jk hi"> ACTION_DRAG_STARTED </strong>中，我们检查项目的<strong class="jk hi"> MIME </strong>类型，以决定这个目标是否可以接收它。在这个例子中，我们允许纯文本和PNG图像，并通过将背景染成深绿色来表明目标是有效的。</p><blockquote class="mk ml mm"><p id="dc50" class="ji jj kf jk b jl jm ii jn jo jp il jq mn js jt ju mo jw jx jy mp ka kb kc kd ha bi translated">注意:在过去，从Chrome OS文件管理器中拖入的文件会有<strong class="jk hi">application/x-arc-uri-list</strong>MIME类型，现在不再是这样了。就像在其他Android设备上一样使用标准的MIME类型。</p></blockquote><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mf mg l"/></div></figure><h2 id="9f47" class="lr kh hh bd ki ls lt lu km lv lw lx kq jr ly lz ks jv ma mb ku jz mc md kw me bi translated">进入、退出和结束</h2><p id="4c9a" class="pw-post-body-paragraph ji jj hh jk b jl la ii jn jo lb il jq jr lo jt ju jv lp jx jy jz lq kb kc kd ha bi translated">这是视觉/触觉反馈逻辑的地方。在本例中，当项目悬停在目标区域上方时，我们会使绿色背景变亮，以指示用户可以成功放下它。最后，您希望将UI重置为正常的非拖放状态。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mf mg l"/></div></figure><h2 id="9791" class="lr kh hh bd ki ls lt lu km lv lw lx kq jr ly lz ks jv ma mb ku jz mc md kw me bi translated">动作_丢弃</h2><p id="83b0" class="pw-post-body-paragraph ji jj hh jk b jl la ii jn jo lb il jq jr lo jt ju jv lp jx jy jz lq kb kc kd ha bi translated">这是项目实际放到目标上时发生的事件。需要使用<strong class="jk hi"> ContentResolver </strong>来访问文件项。</p><p id="0284" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">注意:要从其他应用程序/窗口接收项目，你必须请求<strong class="jk hi">拖拽权限</strong>。这对于Android大屏手机、平板、可折叠、Chrome OS设备尤为重要。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mf mg l"/></div></figure><h2 id="f46f" class="lr kh hh bd ki ls lt lu km lv lw lx kq jr ly lz ks jv ma mb ku jz mc md kw me bi translated">目标范围</h2><p id="7ee8" class="pw-post-body-paragraph ji jj hh jk b jl la ii jn jo lb il jq jr lo jt ju jv lp jx jy jz lq kb kc kd ha bi translated">现在我们有了一个侦听器，我们需要将它附加到我们希望接收拖动事件的视图:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mf mg l"/></div></figure><h2 id="a652" class="lr kh hh bd ki ls lt lu km lv lw lx kq jr ly lz ks jv ma mb ku jz mc md kw me bi translated">测试一下</h2><p id="22a0" class="pw-post-body-paragraph ji jj hh jk b jl la ii jn jo lb il jq jr lo jt ju jv lp jx jy jz lq kb kc kd ha bi translated">现在你应该有一个工作的<strong class="jk hi">下降目标</strong>——在移动到这篇文章的<strong class="jk hi">拖动项目</strong>部分之前测试它。从文件管理器拖动一个文本文件或PNG文件到你的应用程序，你应该看到预期的视觉指示，并能够将项目拖放到目标区域。</p><h1 id="632b" class="kg kh hh bd ki kj kk kl km kn ko kp kq in kr io ks iq kt ir ku it kv iu kw kx bi translated">设置拖动项目</h1><p id="5835" class="pw-post-body-paragraph ji jj hh jk b jl la ii jn jo lb il jq jr lo jt ju jv lp jx jy jz lq kb kc kd ha bi translated">拖动过程通常由长按触发<strong class="jk hi">。要指示一个项目可以被拖动，添加一个<a class="ae ke" href="https://developer.android.com/reference/android/view/View.OnLongClickListener.html" rel="noopener ugc nofollow" target="_blank"> LongClickListener </a>，它为系统提供要传输的数据，并指示它是什么类型的数据。您还可以在这里设置项目被拖动时的外观。</strong></p><p id="2859" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">对于这个例子，我们有一个可以从TextView中拖出的纯文本项。内容设置为文本视图的文本内容，MIME类型设置为<strong class="jk hi"> ClipDescription。<em class="kf"> MIMETYPE_TEXT_PLAIN </em> </strong>。注意:您也可以使用<a class="ae ke" href="https://developer.android.com/reference/android/content/ClipData.html#newPlainText(java.lang.CharSequence,%20java.lang.CharSequence)" rel="noopener ugc nofollow" target="_blank"> <strong class="jk hi"> newPlainText </strong> </a>创建一个纯文本拖动项，但是我们在这里的做法更加透明，并且更容易扩展到其他数据类型。</p><p id="6484" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">对于被拖动文本的<strong class="jk hi">视觉方面</strong>，使用内置的<a class="ae ke" href="https://developer.android.com/reference/android/view/View.DragShadowBuilder.html" rel="noopener ugc nofollow" target="_blank">dragshaodbuilder</a>获得标准的半透明拖动外观。查看文档中的<a class="ae ke" href="https://developer.android.com/guide/topics/ui/drag-drop.html#StartDrag" rel="noopener ugc nofollow" target="_blank">开始拖动</a>以获得更复杂的示例。</p><p id="1fbf" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">最后，当实际的拖动开始时，设置<strong class="jk hi"> DRAG_FLAG_GLOBAL </strong>标志来表示这个项目可以被拖动到其他应用程序中。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mf mg l"/></div></figure><p id="059b" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">把这些放在一起，你就有了一个可以在Chrome OS上使用的拖放应用程序！</p><p id="4edb" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在GitHub 上获取演示应用<a class="ae ke" href="https://github.com/android/user-interface-samples/tree/main/AndroidOnChromeOSDragAndDropDemo" rel="noopener ugc nofollow" target="_blank">的完整源代码。</a></p><blockquote class="mk ml mm"><p id="f5f2" class="ji jj kf jk b jl jm ii jn jo jp il jq mn js jt ju mo jw jx jy mp ka kb kc kd ha bi translated">这里找到的所有代码都获得了Apache 2.0许可证的许可。这里没有任何谷歌官方产品的一部分。</p></blockquote></div></div>    
</body>
</html>