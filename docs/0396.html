<html>
<head>
<title>5 tips for using showInstallPrompt in your instant experience</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在即时体验中使用showInstallPrompt的5个技巧</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/5-tips-for-using-showinstallprompt-in-your-instant-experience-99d4681e0ae?source=collection_archive---------5-----------------------#2019-04-10">https://medium.com/androiddevelopers/5-tips-for-using-showinstallprompt-in-your-instant-experience-99d4681e0ae?source=collection_archive---------5-----------------------#2019-04-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/734454c53381a35651fc640a378fbf6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5eAOuRUKrRBXEJdI"/></div></div></figure><p id="3adf" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><a class="ae jn" href="https://developer.android.com/topic/google-play-instant" rel="noopener ugc nofollow" target="_blank"> Google Play Instant </a>允许您的用户在安装之前试用您的应用程序或游戏。无论是从Play Store还是从URL启动，即时体验都会将您的用户直接带入应用的原生体验。</p><p id="63d8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您的即时体验的目标之一可能是从您的应用程序的即时体验中驱动安装。通过确保正确使用最新的API和最佳实践，您可以更容易地实现这一点。</p><p id="75d5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">当用户决定安装你的应用或游戏时，<a class="ae jn" href="https://developers.google.com/android/reference/com/google/android/gms/instantapps/InstantApps.html#showInstallPrompt(android.app.Activity,%20android.content.Intent,%20int,%20java.lang.String)" rel="noopener ugc nofollow" target="_blank"> showInstallPrompt API </a>允许你在即时体验中提示安装。调用API后，应用内安装提示会出现在你的应用中。一旦用户同意安装，应用程序安装过程就开始了。完成后，安装的应用程序会自动启动。</p><figure class="jp jq jr js fd ii er es paragraph-image"><div class="er es jo"><img src="../Images/048f21b1e4772206486215600166e003.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/0*HaJS3sMgtdYB_TxA"/></div><figcaption class="jt ju et er es jv jw bd b be z dx"><em class="jx">This animation shows the installation flow when using showInstallPrompt</em></figcaption></figure><p id="c459" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在您的即时体验中实施showInstallPrompt时，以下详述的最佳实践将使您的用户尽可能平稳地从即时应用过渡到已安装的应用。</p><h1 id="a9d9" class="jy jz hh bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">1.确保您使用的是最新的showInstallPrompt API</h1><p id="3c26" class="pw-post-body-paragraph ip iq hh ir b is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji la jk jl jm ha bi translated">更新后的<a class="ae jn" href="https://developers.google.com/android/reference/com/google/android/gms/instantapps/InstantApps.html#showInstallPrompt(android.app.Activity,%20android.content.Intent,%20int,%20java.lang.String)" rel="noopener ugc nofollow" target="_blank"> showInstallPrompt API </a>于2018年6月推出，与传统API相比有一些关键优势。新的API显示了一个更小的安装提示，并通过添加postInstallIntent参数改进了到已安装应用程序的过渡，该参数指定了安装后要启动的活动。</p><h2 id="682d" class="lb jz hh bd ka lc ld le ke lf lg lh ki ja li lj km je lk ll kq ji lm ln ku lo bi translated"><strong class="ak">在您的即时体验中识别showInstallPrompt版本</strong></h2><p id="4834" class="pw-post-body-paragraph ip iq hh ir b is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji la jk jl jm ha bi translated">以前，传统API会启动一个更大的应用内安装提示。由于传统的showInstallPrompt不支持，现在调用它会启动您的Play Store列表。为了恢复应用内安装提示，您需要迁移到新的API。</p><p id="4f26" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您不确定您的即时体验是否调用了遗留API，您可以通过运行您的即时应用程序并选择install按钮来快速确定。如果您被带到Play Store列表，您使用的是传统API。如果你看到一个应用内覆盖，你使用的是最新的API。</p><p id="8f86" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">或者，您可以检查您的代码，看看您的方法调用是否包含postInstallIntent参数。如果它不包含postInstallIntent，那么您使用的是遗留API。下面是新的showInstallPrompt API的方法签名:</p><pre class="jp jq jr js fd lp lq lr ls aw lt bi"><span id="c4db" class="lb jz hh lq b fi lu lv l lw lx">public static boolean showInstallPrompt (Activity activity, <strong class="lq hi">Intent postInstallIntent</strong>, int requestCode, String referrer)</span></pre><p id="861f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><code class="du ly lz ma lq b">postInstallIntent</code>是应用程序安装后将启动的意图。它必须解析为已安装应用程序包中的活动，否则将不会被使用。</p><h2 id="8f2e" class="lb jz hh bd ka lc ld le ke lf lg lh ki ja li lj km je lk ll kq ji lm ln ku lo bi translated"><strong class="ak">迁移到新的showInstallPrompt </strong></h2><p id="a770" class="pw-post-body-paragraph ip iq hh ir b is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji la jk jl jm ha bi translated">要迁移到新的showInstallPrompt API，请按照下列步骤操作:</p><p id="b45f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">1.确保您在项目中使用最新的即时应用程序客户端库。更新build.gradle文件中的以下依赖项:</p><pre class="jp jq jr js fd lp lq lr ls aw lt bi"><span id="eaf0" class="lb jz hh lq b fi lu lv l lw lx">implementation 'com.google.android.gms:play-services-instantapps:16.0.1'</span></pre><p id="a3c6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">2.更新您的代码，使用带有postInstallIntent参数的新的<a class="ae jn" href="https://developers.google.com/android/reference/com/google/android/gms/instantapps/InstantApps.html#showInstallPrompt(android.app.Activity,%20android.content.Intent,%20int,%20java.lang.String)" rel="noopener ugc nofollow" target="_blank"> showInstallPrompt API </a>。</p><p id="2ed3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">3.将您的即时应用上传到<a class="ae jn" href="https://support.google.com/googleplay/android-developer/answer/3131213?hl=en" rel="noopener ugc nofollow" target="_blank">内部测试赛道</a>以验证安装按钮现在启动应用内安装提示覆盖。</p><p id="45ff" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您还可以使用新的showInstallPrompt API查看这个<a class="ae jn" href="https://github.com/googlesamples/android-instant-apps/tree/master/install-api" rel="noopener ugc nofollow" target="_blank">示例应用程序</a>，看看它是如何工作的。</p><h1 id="e9a0" class="jy jz hh bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">2.在您的即时游戏中预先注册</h1><p id="746d" class="pw-post-body-paragraph ip iq hh ir b is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji la jk jl jm ha bi translated">showInstallPrompt API不仅仅是为了安装！如果你的即时游戏支持<a class="ae jn" href="https://support.google.com/googleplay/android-developer/answer/9084187" rel="noopener ugc nofollow" target="_blank">预注册</a>，你可以使用相同的API提示预注册注册。</p><p id="4b87" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">当您的应用程序调用showInstallPrompt时，预注册的行为类似于安装期间出现的行为。会出现一个应用内覆盖图，对用户进行预注册。然后，用户将能够继续他们在即时游戏中停止的地方。预先注册的用户会在游戏发布时得到通知。</p><p id="271b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要启动预注册流，您可以调用showInstallPrompt，就像您要提示安装一样。</p><pre class="jp jq jr js fd lp lq lr ls aw lt bi"><span id="063a" class="lb jz hh lq b fi lu lv l lw lx"><em class="mb">// Prompt for pre-registration<br/></em>InstantApps.showInstallPrompt(activity, postInstallIntent, requestId, referrerId)</span></pre><p id="d83c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">注意:预注册完成后，<code class="du ly lz ma lq b">postInstallIntent</code>参数被忽略。</p><h1 id="4879" class="jy jz hh bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">3.将用户状态转换到已安装的应用程序</h1><p id="4eaf" class="pw-post-body-paragraph ip iq hh ir b is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji la jk jl jm ha bi translated">将用户的状态从即时体验转移到已安装的app中。用户应该能够从他们停止的地方重新开始。在即时体验中取得的任何成就或进步都应该延续到安装的应用程序或游戏中。</p><figure class="jp jq jr js fd ii er es paragraph-image"><div class="er es mc"><img src="../Images/44e452e2e05e499080d91b57d744a8e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/0*r7DBqy2P92QFwOPf"/></div></figure><p id="3e74" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">持久化用户状态的推荐方法是使用<a class="ae jn" href="https://developers.google.com/android/reference/com/google/android/gms/instantapps/PackageManagerCompat#getInstantAppCookie()" rel="noopener ugc nofollow" target="_blank"> Cookie API </a>在安装后迁移数据。Cookie API允许您在设备上存储少量信息，您的可安装应用程序可以访问这些信息。该API确保只有与您的即时应用程序具有相同包ID的应用程序才能访问cookie。</p><p id="029d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在您的即时应用程序中，您应该始终使用<a class="ae jn" href="https://developers.google.com/android/reference/com/google/android/gms/instantapps/PackageManagerCompat.html#setInstantAppCookie(byte[])" rel="noopener ugc nofollow" target="_blank"> PackageManagerCompat </a>来存储您的cookie数据。</p><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="md me l"/></div></figure><p id="8a99" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">用户安装好app后，你就可以访问数据了。</p><figure class="jp jq jr js fd ii"><div class="bz dy l di"><div class="md me l"/></div></figure><h1 id="3db0" class="jy jz hh bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">4.不要妨碍任务的完成</h1><p id="8af7" class="pw-post-body-paragraph ip iq hh ir b is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji la jk jl jm ha bi translated">用户在打开即时体验时，在完成他们想要完成的任务时，不应该被打断。避免在用户部分完成任务时要求他们安装你的应用。</p><p id="b3ba" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在用户完成其任务或想要使用您的即时应用程序中不可用的附加功能后，您可以调用showInstallPrompt。</p><figure class="jp jq jr js fd ii er es paragraph-image"><div class="er es mf"><img src="../Images/45515c9fa42b6eab641a8e2727ad9ecd.png" data-original-src="https://miro.medium.com/v2/resize:fit:444/format:webp/1*uovyCegQYpdiurkTpTL5lQ.png"/></div></figure><p id="449d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">例如，如果你通过在线产品广告引导用户获得即时体验，你的即时应用程序应该允许你的用户完成结账流程。购买完成后，您可以提示安装。避免要求用户在完成购买之前安装或注册。</p><h1 id="7acd" class="jy jz hh bd ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv bi translated">5.提供明确的安装提示</h1><p id="3f17" class="pw-post-body-paragraph ip iq hh ir b is kw iu iv iw kx iy iz ja ky jc jd je kz jg jh ji la jk jl jm ha bi translated">最后一个技巧看起来很明显，但是要确保你的即时体验有明确的安装提示。没有它们，用户可能会对如何安装你的应用程序感到困惑，或者可能不得不去Play Store安装。</p><p id="d5d0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">安装按钮应该调用showInstallPrompt来启动安装提示。</p><figure class="jp jq jr js fd ii er es paragraph-image"><div class="er es mg"><img src="../Images/ee932dd6ea59b52e09ccacc86fcd99c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:884/format:webp/1*nKfEwwU4dVp08ZUndHvuIA.png"/></div></figure><p id="241e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">使用<a class="ae jn" href="https://material.io/icons/#ic_get_app" rel="noopener ugc nofollow" target="_blank">材料设计“获取应用”图标</a>和标签“安装”作为安装按钮或“预注册”作为预注册按钮。</p><p id="e934" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">不要使用任何其他标签，如“获取应用程序”、“安装完整应用程序”或“升级”。不要使用横幅或其他类似广告的技术向用户展示安装提示。</p></div><div class="ab cl mh mi go mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ha hb hc hd he"><p id="91df" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您对在即时应用或游戏中实现showInstallPrompt API有其他问题，请在<a class="ae jn" href="https://stackoverflow.com/questions/tagged/android-instant-apps" rel="noopener ugc nofollow" target="_blank"> StackOverflow </a>上提出您的问题。了解更多关于Google Play Instant的信息，并查看我们的其他UX最佳实践。</p></div></div>    
</body>
</html>