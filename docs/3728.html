<html>
<head>
<title>One-click content export, staging and deployment strategy for Drupal 9 websites (with Version Control of Content!)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Drupal 9网站的一键式内容导出、暂存和部署策略(带有内容的版本控制！)</h1>
<blockquote>原文：<a href="https://medium.com/globant/one-click-content-export-staging-and-deployment-strategy-for-drupal-9-websites-with-version-c-c2adc43dd4a4?source=collection_archive---------1-----------------------#2021-08-24">https://medium.com/globant/one-click-content-export-staging-and-deployment-strategy-for-drupal-9-websites-with-version-c-c2adc43dd4a4?source=collection_archive---------1-----------------------#2021-08-24</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="cb9d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Drupal提供了一种通过代码管理配置的好方法。这样，您的配置是受版本控制的。然而，Drupal中的内容却不是这样(至少，开箱即用)。</p><p id="abe6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">内容直接保存在Drupal的数据库中。这意味着，当您想用Drupal预览您的开发或登台环境时，您需要从您的生产环境中提取一个数据库副本，并将其加载到您的开发或登台环境中。</p><p id="5363" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，内容不受版本控制。在将内容发布到生产环境之前，在较低的环境中预览内容是一项挑战。(您仍然可以在生产环境中将内容置于草稿状态，并在不发布的情况下进行预览。然而，由于多种原因，许多网站选择在将内容发送到生产环境之前(即使在未发布的状态下)，首先将内容放在暂存环境中。</p><p id="25f4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">促使一些网站先将内容放在较低的环境中，然后再将其投入生产的原因如下:</p><p id="d3d5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">在草稿模式下预览内容并不总是等同于“预览”已发布的内容。</strong></p><p id="52ec" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">由于草稿内容只能作为具有所需权限的经过身份验证的用户进行预览，因此它可能不会与发布后作为匿名用户查看时的样子完全相同。这是因为，作为一个登录用户，您经常会在Drupal页面上有块、工具栏之类的管理工具，并且屏幕空间可能与发布时不一样。</p><p id="d8e4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Workspaces是Drupal 9中的一个实验性核心模块，它可能会解决一些问题。</p><p id="b5c4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">意外出版的风险</strong></p><p id="a18c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一些网站不希望在生产环境中有内容，即使是未发布的内容。当偶然出版的成本非常高时，尤其如此。(例如:在预定发布时间前几秒发布上市公司的季度业绩，可能等同于内幕交易！)</p><p id="65bc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">复习容易</strong></p><p id="88c6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当来自多个部门的许多涉众参与审查过程时，将草稿内容放在只能通过公司的VPN访问的URL/域上更容易，而不需要所有涉众使用他们的Drupal凭证登录。</p><p id="29e8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">还有更多..</strong></p><p id="cc8d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们并没有深入探究为什么许多网站希望在将内容部署到生产环境之前，先在较低的环境中部署内容。但以上几个原因给你一个为什么的要领。</p><p id="de05" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，出于上述原因之一，或者出于不同的原因，您选择了一个内容部署策略，该策略要求首先在较低的(开发或登台)环境中发布内容。这就给如何将这些内容从较低的环境部署到生产环境带来了挑战。</p><p id="9441" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您不能将较低环境的数据库移至生产环境，因为这将覆盖生产环境中最近用户生成的任何内容。此外，在较低的环境中，您可能不希望将测试内容转移到生产环境中。</p><p id="e40e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这就是内容分级需求的来源。</p><p id="48da" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Drupal没有通用的内容分段解决方案。下面，我们将涉及一些可用的选项。以及我对这些解决方案的想法，我们将详细讨论一个我们认为很有价值的解决方案。</p><p id="91cd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是我们在研究一个项目时筛选的解决方案的一个小列表。所有可能解决方案的详细列表可在<a class="ae jc" href="https://www.drupal.org/docs/comparison-of-contributed-modules/comparison-of-content-deployment-modules" rel="noopener ugc nofollow" target="_blank">此处</a>获得。</p><p id="efea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">部署—内容暂存</strong></p><p id="4005" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">链接—【https://www.drupal.org/project/deploy T4】</p><p id="a11e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是我们寻找解决方案时出现的第一个问题。由于以下原因，我们没有进一步探讨本模块:</p><ul class=""><li id="33ca" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated"><a class="ae jc" href="https://www.drupal.org/project/deploy/issues/3221335" rel="noopener ugc nofollow" target="_blank"> Drupal 9兼容性</a>未解决。</li><li id="afba" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">过去两年没有发行。</li><li id="569f" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">内容不受版本控制。</li></ul><p id="8275" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 2。内容同步模块</strong> <br/>链接—<a class="ae jc" href="https://www.drupal.org/project/content_sync" rel="noopener ugc nofollow" target="_blank">https://www.drupal.org/project/content_sync</a></p><p id="faa6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这实际上可能是一个好的解决方案。和我们最后选的那个差不多。根据我对该模块的第一印象，我们没有进一步探讨这个问题</p><ul class=""><li id="0c97" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated">缺少最新版本和维护</li><li id="b466" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">每个项目页面似乎缺乏定义要选择的内容的能力。“仅选项”看起来要么是单个内容，要么是所有内容</li></ul><p id="81b3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 3。实体份额</strong></p><p id="927a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">链接—<a class="ae jc" href="https://www.drupal.org/project/entity_share" rel="noopener ugc nofollow" target="_blank">https://www.drupal.org/project/entity_share</a></p><p id="947c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这个模块看起来是真的！维护良好的项目页面和文档。最近的8.x/9.x版本。支持大多数<a class="ae jc" href="https://www.drupal.org/docs/8/modules/entity-share/supported-field-types" rel="noopener ugc nofollow" target="_blank">字段类型</a>。可能是适合大多数Drupal项目的解决方案。同样，我们跳过了它，因为我关注的标准之一是试图让内容也受到版本控制，而不仅仅是跨环境移动内容。另外，如果您对内容的版本控制不是很明确，这是一个很好的选择。</p><p id="81d1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 4。其他选项</strong></p><p id="76e5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">其他几个引起我注意的选项包括<a class="ae jc" href="https://www.drupal.org/project/cms_content_sync" rel="noopener ugc nofollow" target="_blank"> CMS内容同步</a>模块，需要付费的SAAS服务订阅、<a class="ae jc" href="https://www.acquia.com/products/drupal-cloud/content-hub" rel="noopener ugc nofollow" target="_blank"> Acquia内容中心</a>(需要订阅)、<a class="ae jc" href="https://www.drupal.org/project/entity_pilot" rel="noopener ugc nofollow" target="_blank">实体试点</a>(需要订阅)。<a class="ae jc" href="https://www.drupal.org/project/content_synchronizer" rel="noopener ugc nofollow" target="_blank">内容同步器</a>是另一种选择。从文档来看，设置、导入和导出过程看起来相当复杂。此外，导出选项看起来仅限于zip文件，这可能对版本控制没有帮助。</p><p id="7559" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 5。默认内容模块</strong></p><p id="c4aa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">链接—<a class="ae jc" href="https://www.drupal.org/project/default_content" rel="noopener ugc nofollow" target="_blank">https://www.drupal.org/project/default_content</a></p><p id="adf6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是我们碰巧为我们的实现选择的模块。该模块实际上旨在一次性推送可以打包到模块中的内容，以便在启用该模块时创建内容。在最新的稳定版本中，当您尝试重新启用模块以导入打包到模块中的更新内容时，模块会抛出异常。(因为具有相同UUID的内容在过去已经被导入)。</p><p id="8f38" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">但是，该模块可以进一步调整，以便在以后的运行中更新现有内容。使用本期的<a class="ae jc" href="https://www.drupal.org/project/default_content/issues/2698425#comment-14058752" rel="noopener ugc nofollow" target="_blank">补丁#145。</a></p><p id="1189" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在具有大量不同类型字段的内容类型上测试了该模块，包括图像和文件附件、段落(嵌套，参考其他段落)，并且它无缝地处理了导入和导出。</p><h1 id="61b7" class="jr js hh bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">工作流程</h1><p id="c80f" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">使用该模块的工作流程如下所示:</p><ul class=""><li id="5016" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated">创建一个保存内容的自定义模块，并将其签入您的代码库。</li><li id="9c36" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">内容可以在任何本地或云环境中更新</li><li id="7a17" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">使用drush命令将内容打包到模块中。</li></ul><blockquote class="ku kv kw"><p id="68d3" class="ie if kx ig b ih ii ij ik il im in io ky iq ir is kz iu iv iw la iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="hh"> drush dcer节点2—folder = modules/custom/cm1 _ install _ content/content</em></strong></p><p id="01e6" class="ie if kx ig b ih ii ij ik il im in io ky iq ir is kz iu iv iw la iy iz ja jb ha bi translated"><em class="hh"> 2是我们正在导出的节点的节点id。<br/>path表示模块的路径，直到里面的内容文件夹。</em></p></blockquote><ul class=""><li id="ebd8" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated">这将在模块的文件夹中创建所需的yml文件。请注意，内容的文件夹应该准确地命名为“content ”,因为这是模块中的导入程序所期望的。</li><li id="fb0d" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">请注意，当只导出一个节点时，模块会捆绑该节点的所有依赖项，如术语、段落、引用的节点、文件附件等，</li></ul><figure class="lc ld le lf fd lg er es paragraph-image"><div class="er es lb"><img src="../Images/3d6729945994b97d8fa87718fd841459.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/0*5EsYXR4GFSAorSf3"/></div></figure><ul class=""><li id="d5e6" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated">现在可以将该模块登记到您的存储库中。</li><li id="85d3" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">在任何其他环境中，您可以执行git pull，并使模块能够获取所有内容。</li><li id="ff70" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">可以使用Drush命令在任何环境中更新和重新导出内容，以更新模块的yml文件。</li><li id="e5be" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">在另一个需要导入更新内容的环境中，您可以启用该模块(如果是第一次)，或者运行下面的命令。</li></ul><blockquote class="ku kv kw"><p id="8ca5" class="ie if kx ig b ih ii ij ik il im in io ky iq ir is kz iu iv iw la iy iz ja jb ha bi translated"><strong class="ig hi"><em class="hh">drush dcim cm1 _ install _ content</em></strong></p></blockquote><ul class=""><li id="c9de" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated">请注意，dcim命令(以及更新现有内容的能力)不是稳定版本的一部分，您需要从问题分支@<a class="ae jc" href="https://git.drupalcode.org/issue/default_content-2698425" rel="noopener ugc nofollow" target="_blank">https://git.drupalcode.org/issue/default_content-2698425</a>派生模块，或者等待问题合并到模块的稳定版本中。</li></ul><p id="a99b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">此解决方案检查我们在内容转移解决方案中寻找的所有盒子-</p><ul class=""><li id="5189" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated">允许<strong class="ig hi">将内容</strong>从一个环境移动到另一个环境</li><li id="3d20" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">允许内容的<strong class="ig hi">版本控制</strong></li><li id="619d" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">支持<strong class="ig hi">大多数(如果不是全部)字段类型</strong>，包括开始的段落</li><li id="8dbb" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">支持<strong class="ig hi">平移</strong> ( <a class="ae jc" href="https://www.drupal.org/project/default_content/issues/3176839" rel="noopener ugc nofollow" target="_blank">警告</a>)</li><li id="67f5" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">支持<strong class="ig hi">内容的更新</strong>，而不仅仅是初始导入(<a class="ae jc" href="https://www.drupal.org/project/default_content/issues/2698425" rel="noopener ugc nofollow" target="_blank">工作正在进行中，将很快添加到稳定分支</a>)</li><li id="d273" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">递归选取所有需要的<strong class="ig hi">依赖内容</strong></li></ul><p id="58a8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">此外，按node-id逐个导出所有内容仍然是一项痛苦的任务。该模块允许在模块的info文件中定义一个UUIDs列表，因此它可以每次自动选择id并导出内容。但是，每次添加节点时都需要提交，这让我们不太舒服。</p><p id="d019" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，我们构建了一个视图批量操作动作，允许您将导出按钮添加到任何Drupal视图，这样您就可以使用视图上的过滤器选择您想要的内容，并点击导出按钮。我们将此作为contrib模块发布给所有@<a class="ae jc" href="https://www.drupal.org/project/export_action_for_default_content" rel="noopener ugc nofollow" target="_blank"><strong class="ig hi">https://www . Drupal . org/project/export _ action _ for _ default _ content</strong></a><strong class="ig hi">。</strong></p><p id="952c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">配置视图:</p><figure class="lc ld le lf fd lg er es paragraph-image"><div class="er es lj"><img src="../Images/b91d2efa27b2b61a0c564bed84b782d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1168/0*OAL6NrX5Mx1__8-m"/></div></figure><p id="ea26" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">显示自定义操作的视图:</p><figure class="lc ld le lf fd lg er es paragraph-image"><div class="er es lk"><img src="../Images/969ad9a50f48c290322c6748033921ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1012/0*R8kF0uMi_2lNOWzH"/></div></figure><figure class="lc ld le lf fd lg er es paragraph-image"><div class="er es ll"><img src="../Images/636c3b41dfb373009ae068718c084d9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:830/0*12L3__NyNzwgtjO0"/></div></figure><h1 id="a1f5" class="jr js hh bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">更新了内容管理工作流程，只需点击一下即可导出内容</h1><p id="7560" class="pw-post-body-paragraph ie if hh ig b ih kp ij ik il kq in io ip kr ir is it ks iv iw ix kt iz ja jb ha bi translated">通过以上设置，工作流程现在变得简单如:</p><ol class=""><li id="1aa4" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb lm jj jk jl bi translated">使用视图创建/更新内容并将内容从任何环境导出到模块。</li><li id="8096" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb lm jj jk jl bi translated">将模块代码推送到回购</li><li id="1528" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb lm jj jk jl bi translated">一旦部署了代码，只需在环境上运行<strong class="ig hi">drush dcim&lt;content module name&gt;</strong>命令</li><li id="b055" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb lm jj jk jl bi translated">然后嘣！，你有你所有的内容！</li></ol></div></div>    
</body>
</html>