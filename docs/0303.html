<html>
<head>
<title>Understanding MediaSession (Part 2/4)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">了解媒体会话(第2/4部分)</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/understanding-mediasession-part-2-4-ad291fd32d60?source=collection_archive---------4-----------------------#2017-09-03">https://medium.com/androiddevelopers/understanding-mediasession-part-2-4-ad291fd32d60?source=collection_archive---------4-----------------------#2017-09-03</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="8de2" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">理解复杂的媒体环境</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/e5224fc80505a3723aeff704e9b9057d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IccsY5nMfvpHI3gaER_WNg.png"/></div></div></figure><h1 id="46b3" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">介绍</h1><p id="bfcd" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">这一系列文章的目标是让你深入了解<code class="du kw kx ky kz b">MediaSession</code>，它有什么用途，什么时候用，什么时候不用。这是4部分系列的第二部分，包括:</p><ol class=""><li id="7c62" class="la lb hh kc b kd lc kg ld kj le kn lf kr lg kv lh li lj lk bi translated"><a class="ae ll" rel="noopener" href="/@nazmul/understanding-mediasession-part-1-3-e4d2725f18e4">media session适合我吗？</a></li><li id="c8dc" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lh li lj lk bi translated"><strong class="kc hi">理解复杂的媒体环境</strong> <em class="lr">(本文)</em></li><li id="edcc" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lh li lj lk bi translated"><a class="ae ll" rel="noopener" href="/@nazmul/understanding-mediasession-part-2-3-b4919583a82">简单用例如何使用</a></li><li id="240d" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lh li lj lk bi translated"><a class="ae ll" rel="noopener" href="/@nazmul/understanding-mediasession-part-4-4-dcc77c535f99">如何将它用于复杂的用例</a></li></ol><h1 id="a321" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">这是一个复杂的媒体环境</h1><p id="5131" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">如果你正在开发一个媒体播放应用程序，它可能会创建一个用户界面，并管理一个媒体播放器(例如，<code class="du kw kx ky kz b"><a class="ae ll" href="https://developer.android.com/guide/topics/media/mediaplayer.html" rel="noopener ugc nofollow" target="_blank">MediaPlayer</a></code>或<code class="du kw kx ky kz b"><a class="ae ll" href="https://google.github.io/ExoPlayer/guide.html" rel="noopener ugc nofollow" target="_blank">ExoPlayer</a></code>)。它还可能处理浏览媒体目录、队列和播放列表等。</p><p id="85f6" class="pw-post-body-paragraph ka kb hh kc b kd lc ii kf kg ld il ki kj ls kl km kn lt kp kq kr lu kt ku kv ha bi translated">媒体播放应用程序的用户也希望能够在应用程序本身的用户界面之外控制它。以下是他们期望的一些例子。</p><blockquote class="lv"><p id="d140" class="lw lx hh bd ly lz ma mb mc md me kv dx translated"><strong class="ak">用户希望能够通过告诉谷歌助手“</strong> <code class="du kw kx ky kz b"><strong class="ak">pause playback</strong></code> <strong class="ak">”来暂停你的应用程序中的播放，而无需与你的应用程序的UI进行交互。</strong></p><p id="2daf" class="lw lx hh bd ly lz ma mb mc md me kv dx translated">他们希望能够使用耳机上的媒体键来控制播放，而无需与用户界面交互。</p><p id="a324" class="lw lx hh bd ly lz ma mb mc md me kv dx translated">如果用户有Android Auto，那么当他们的手机与汽车连接时，他们希望看到他们想要播放的音乐目录。</p></blockquote><p id="6417" class="pw-post-body-paragraph ka kb hh kc b kd mf ii kf kg mg il ki kj mh kl km kn mi kp kq kr mj kt ku kv ha bi translated">我们将把应用程序之外控制媒体的“东西”称为“外部参与者”。这些<strong class="kc hi">外部参与者</strong>包括:Android TV、Android Wear、Android Auto、你耳机上的<a class="ae ll" href="https://developer.android.com/guide/topics/media-apps/mediabuttons.html" rel="noopener ugc nofollow" target="_blank">媒体按钮</a>、谷歌助手、锁屏控件，甚至<code class="du kw kx ky kz b">MediaStyle</code>通知。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mk"><img src="../Images/a375dd28134b34d510ca47bdc75aadee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qtp6x76wTN-3MKWbJ6CALA.png"/></div></div></figure><blockquote class="lv"><p id="79b4" class="lw lx hh bd ly lz ml mm mn mo mp kv dx translated">这些都可能导致应用程序内部的状态变化，需要有一种方法来响应这些变化。这就是MediaSession发挥作用的地方。</p></blockquote><h1 id="d2f5" class="ji jj hh bd jk jl jm jn jo jp jq jr js in mq io ju iq mr ir jw it ms iu jy jz bi translated">MediaSession是做什么的？</h1><p id="c740" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated"><code class="du kw kx ky kz b">MediaSession</code>做以下事情:</p><ul class=""><li id="d105" class="la lb hh kc b kd lc kg ld kj le kn lf kr lg kv mt li lj lk bi translated"><strong class="kc hi">播放控制— </strong>它提供了一个单一的界面来控制播放(例如:播放、暂停、停止、跳到下一个、播放以进行搜索)，您的应用程序的UI和外部参与者(例如:媒体按钮、谷歌助手)都可以使用该界面。起初这可能看起来令人困惑，但是如果你绕过<code class="du kw kx ky kz b">MediaSession</code>直接控制你的播放器，那么当外部参与者改变播放状态或加载不同的媒体时，你的应用程序的UI很容易与播放器和会话不同步。</li><li id="7ccc" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv mt li lj lk bi translated"><strong class="kc hi">状态同步</strong> —它向所有外部参与者和您的应用程序本身广播当前播放状态(播放、暂停、停止等)和媒体元数据(专辑封面、歌曲时长、歌曲标题等)。</li></ul><h1 id="80af" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">什么是MediaSession？</h1><p id="40bb" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated"><code class="du kw kx ky kz b">MediaSession</code>是一个中间件，允许外部参与者控制你的应用程序中的媒体播放器(在应用程序自己的UI之外)。它还允许你的应用程序向应用程序内外感兴趣的各方报告播放器状态的变化(加载了什么媒体，播放器当前是否暂停，或者正在播放，等等)。</p><h1 id="5eda" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">什么不是MediaSession？</h1><p id="edb2" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated"><code class="du kw kx ky kz b">MediaSession</code>不管理你应用的媒体播放器；你仍然需要创建一个媒体播放器，加载媒体，准备播放，实际控制播放，等等。该应用程序仍然需要处理音频焦点。它必须管理自己的用户界面，并与<code class="du kw kx ky kz b">MediaSession</code>集成。</p><p id="5bc3" class="pw-post-body-paragraph ka kb hh kc b kd lc ii kf kg ld il ki kj ls kl km kn lt kp kq kr lu kt ku kv ha bi translated">让我们举两个例子，一个用户在你的应用程序中通过按下一个媒体按钮来调用暂停动作，或者通过让谷歌助手暂停播放。假设发生这种情况时，音频已经在你的应用程序服务的背景中播放。无论哪种情况，非常相似的事情都会发生在你的应用程序中。</p><ol class=""><li id="57f4" class="la lb hh kc b kd lc kg ld kj le kn lf kr lg kv lh li lj lk bi translated">按下媒体暂停按钮会触发一个意图，你的应用程序会接收到这个意图。然后，<code class="du kw kx ky kz b">MediaSession</code>通过调用您提供给<code class="du kw kx ky kz b">MediaSession</code>的代码回调函数中的<code class="du kw kx ky kz b">onPause()</code>，将这个消息传输到您的应用程序。当谷歌助手被要求“暂停播放”时，也会发生非常类似的事情。两条路径都以<code class="du kw kx ky kz b">onPause()</code>方法结束，该方法由<code class="du kw kx ky kz b">MediaSession</code>调用到您的代码中。</li><li id="ef88" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lh li lj lk bi translated">此时，您负责在您的音乐服务中实现<code class="du kw kx ky kz b">onPause()</code>,连接到您的播放器并实际暂停其播放。一旦完成，你负责报告回放状态已经改变，通过用新的状态调用<code class="du kw kx ky kz b">setPlaybackState()</code>将此通知回<code class="du kw kx ky kz b">MediaSession</code>。</li><li id="e68f" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lh li lj lk bi translated">你的应用程序的UI应该连接到<code class="du kw kx ky kz b">MediaSession</code>，当这个回放状态改变时，你必须在你的UI代码中实现一个<code class="du kw kx ky kz b">onPlaybackStateChanged()</code>方法。在这里，您可以更新您的UI，以显示回放状态已经更改为暂停。</li></ol><p id="262f" class="pw-post-body-paragraph ka kb hh kc b kd lc ii kf kg ld il ki kj ls kl km kn lt kp kq kr lu kt ku kv ha bi translated">这是为了使用<code class="du kw kx ky kz b">MediaSession</code>你必须采取的一些高级步骤的简要概述。本系列的下一篇文章将针对简单的用例(例如:在前台播放视频的应用程序)更详细地介绍这一点。</p><div class="mu mv ez fb mw mx"><a rel="noopener follow" target="_blank" href="/@nazmul/understanding-mediasession-part-3-4-b4919583a82"><div class="my ab dw"><div class="mz ab na cl cj nb"><h2 class="bd hi fi z dy nc ea eb nd ed ef hg bi translated">了解媒体会话(第3/4部分)- Nazmul Idris (Naz) - Medium</h2><div class="ne l"><h3 class="bd b fi z dy nc ea eb nd ed ef dx translated">这一系列文章的目标是让您深入了解MediaSession，它的好处是什么，何时…</h3></div><div class="nf l"><p class="bd b fp z dy nc ea eb nd ed ef dx translated">medium.com</p></div></div><div class="ng l"><div class="nh l ni nj nk ng nl jg mx"/></div></div></a></div><h1 id="fd9e" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">Android媒体资源</h1><ul class=""><li id="1c93" class="la lb hh kc b kd ke kg kh kj nm kn nn kr no kv mt li lj lk bi translated"><a class="ae ll" href="https://developer.android.com/guide/topics/media-apps/media-apps-overview.html" rel="noopener ugc nofollow" target="_blank">媒体API指南—媒体应用概述</a></li><li id="3fea" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv mt li lj lk bi translated"><a class="ae ll" href="https://developer.android.com/guide/topics/media-apps/working-with-a-media-session.html" rel="noopener ugc nofollow" target="_blank">媒体API指南—使用媒体会话</a></li><li id="9a73" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv mt li lj lk bi translated"><a class="ae ll" rel="noopener" href="/google-developers/building-a-simple-audio-app-in-android-part-1-3-c14d1a66e0f1">使用MediaPlayer构建简单的音频播放应用</a></li><li id="4821" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv mt li lj lk bi translated"><a class="ae ll" href="https://github.com/googlesamples/android-MediaBrowserService" rel="noopener ugc nofollow" target="_blank">示例代码— MediaBrowserService </a></li><li id="4f1b" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv mt li lj lk bi translated"><a class="ae ll" href="https://github.com/googlesamples/android-media-controller" rel="noopener ugc nofollow" target="_blank">样本代码—媒体会话控制器测试</a></li></ul></div></div>    
</body>
</html>