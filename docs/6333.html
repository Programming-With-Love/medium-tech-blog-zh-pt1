<html>
<head>
<title>Pre-Submit UI Tests at Pinterest</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Pinterest预先提交用户界面测试</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/pre-submit-ui-tests-at-pinterest-556be1611be?source=collection_archive---------1-----------------------#2022-01-10">https://medium.com/pinterest-engineering/pre-submit-ui-tests-at-pinterest-556be1611be?source=collection_archive---------1-----------------------#2022-01-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="e52c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Mansfield Mark |移动测试工具领导、度量质量和测试工具</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/264feda79adc920fccd201c43b2621da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*pFV-KQt6xzXBcNPI"/></div></div></figure><h1 id="f15d" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">摘要</h1><p id="1f27" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">在我们努力<a class="ae kr" href="https://en.wikipedia.org/wiki/Shift-left_testing" rel="noopener ugc nofollow" target="_blank">左移</a>(其中测试执行得更早，或者在项目时间线上左移)的过程中，这篇博客涵盖了我们如何在每次提交我们的Android和iOS存储库之前开始运行一个大型的端到端UI测试套件。这个项目涉及UI测试、测试基础设施和开发人员生产力的仔细协调。</p><p id="ccc4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">发货后，我们能够</p><ul class=""><li id="705d" class="ks kt hh ig b ih ii il im ip ku it kv ix kw jb kx ky kz la bi translated">减少调查和故障解决时间</li><li id="9c5e" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">将我们的测试套件的通过率从&lt;50% to &gt;的90%提高</li><li id="0db0" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">让我们的UI测试平台支持更多团队的更多测试</li></ul><h1 id="cb92" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">代码变更生命周期</h1><p id="9a30" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">让我们将变更生命周期分为4个步骤:</p><ol class=""><li id="106d" class="ks kt hh ig b ih ii il im ip ku it kv ix kw jb lg ky kz la bi translated"><strong class="ig hi">代码评审</strong>:分享一个拉取请求，处理评论</li><li id="8d45" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb lg ky kz la bi translated"><strong class="ig hi">提交前检查</strong> : <strong class="ig hi"> </strong>示例:单元测试，linters，根据应用于某些基本提交的pull请求运行</li><li id="9c09" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb lg ky kz la bi translated"><strong class="ig hi">提交* </strong>:差异提交到主分支</li><li id="32c4" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb lg ky kz la bi translated"><strong class="ig hi">提交后检查</strong>:示例:集成测试，发布版本</li></ol><p id="9adc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">(*)有些组织除了简单的合并冲突检测之外，还在“提交”步骤中进行检查，例如优步的<a class="ae kr" href="https://eng.uber.com/research/keeping-master-green-at-scale/" rel="noopener ugc nofollow" target="_blank"> SubmitQueue </a>。虽然这超出了本文的范围，但是这些检查作为运行测试的地方是值得考虑的，尽管它们有自己的复杂性和权衡。</p><h1 id="183b" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">动机</h1><p id="48ff" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">随着我们UI测试套件的增长，我们发现维护测试非常困难。非关键路径上的故障往往得不到及时处理，造成不可持续的后果。例如:</p><ul class=""><li id="9644" class="ks kt hh ig b ih ii il im ip ku it kv ix kw jb kx ky kz la bi translated">修复测试的人通常不是处理失败代码的人</li><li id="45e1" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">修复测试的人经常是在几天后，在许多上下文切换之后才开始工作</li><li id="52b1" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">故障可能会相互叠加，使修复变得复杂，使问题变得模糊</li></ul><p id="2b00" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一个有很多失败测试的测试套件很快就会失去它的价值。测试用例要么由发布团队手工验证，要么被忽略。随着测试套件的恶化，越来越少的回归被捕获，任何未来在UI测试上的投资似乎都不值得。</p><p id="89b2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">UI测试缓慢、昂贵且不稳定。因此，它们通常在提交后步骤中运行。这使他们脱离了开发人员的关键路径，并避免了由于速度或不稳定性造成的延迟。</p><p id="7b24" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这篇文章记录了我们如何将UI测试套件转移到<strong class="ig hi">预提交</strong>中运行，而不是<strong class="ig hi">后提交</strong>。这一变化极大地降低了我们的测试维护成本，并且更好地保护了我们的发布。</p><h1 id="716d" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">挑战1——所有权</h1><p id="47ef" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">我们要求测试只有一个团队负责维护测试。</p><p id="8337" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所有者将:</p><ul class=""><li id="11e0" class="ks kt hh ig b ih ii il im ip ku it kv ix kw jb kx ky kz la bi translated">监控警报通道以响应他们的测试问题</li><li id="9f47" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">决定如何修复一个测试，什么时候更新它，什么时候可以删除它，等等。</li></ul><p id="ad32" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了确保问责，我们利用了<strong class="ig hi"/>沉默<strong class="ig hi"/>测试的能力，这意味着我们忽略他们的失败。每个沉默的测试必须在两周内由拥有的团队解决。</p><p id="11ab" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">沉默测试意味着有人决定这些失败可以被忽略。这个决定通常是明确的，比如一个明显过时的测试。否则，测试所有者应该对是否保持沉默拥有最终决定权。</p><p id="855f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">测试静音创建了一个生命周期，可实现:</p><ul class=""><li id="b761" class="ks kt hh ig b ih ii il im ip ku it kv ix kw jb kx ky kz la bi translated">快速缓解主分支上的故障，无需向前修复或回滚</li><li id="55ad" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">测试套件中要恢复的测试的确定性SLA</li></ul><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es lh"><img src="../Images/abd01858b270ea6e6ed312812485b313.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/0*O_uog2bKiyBsGzNF"/></div><figcaption class="li lj et er es lk ll bd b be z dx">Lifecycle of a problematic test</figcaption></figure><h1 id="cf49" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">挑战2 —平衡速度和成本</h1><p id="008f" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">我们对每个发布的差异进行测试。对我们来说，这意味着每次diff大约运行2.5次。我们还从主分支每小时运行一次测试，作为健康检查。在Pinterest，这意味着每周大约700次构建，每次构建300次测试。</p><p id="9758" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对代码提交关键路径的测试平均速度直接影响开发人员的速度。我们希望在合理的时间内(比如30分钟)保持测试套件的运行，而不会产生过多的成本。</p><h2 id="08ed" class="lm jp hh bd jq ln lo lp ju lq lr ls jy ip lt lu kc it lv lw kg ix lx ly kk lz bi translated">低垂的果实</h2><p id="2600" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">我们发现我们的速度可以通过一些简单的测试级修正来提高。</p><ul class=""><li id="9b8f" class="ks kt hh ig b ih ii il im ip ku it kv ix kw jb kx ky kz la bi translated">测试超时下限(5分钟)</li><li id="6afc" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">快速失败(例如，如果出现问题，没有无限期等待或无限滚动)</li><li id="fdc4" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">简化测试(例如，直接链接到被测试的页面，而不是导航到它)</li><li id="d9a3" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">跳过对静默测试的重试(它被忽略，我们不需要再次运行它)</li></ul><h2 id="e8d4" class="lm jp hh bd jq ln lo lp ju lq lr ls jy ip lt lu kc it lv lw kg ix lx ly kk lz bi translated">并行化</h2><p id="2792" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">并行运行测试对于提高速度至关重要。然而，在300个片段中运行300个测试通常非常昂贵。在并行化中，有许多工具可以用来平衡测试速度和成本。</p><p id="3b23" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">安卓</strong></p><p id="8df5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们通过名为<a class="ae kr" href="https://github.com/Flank/flank" rel="noopener ugc nofollow" target="_blank"> Flank </a>的分片工具在Firebase测试实验室上运行我们的Android测试。Flank支持一个名为“<a class="ae kr" href="https://flank.github.io/flank/smart_flank/" rel="noopener ugc nofollow" target="_blank"> Smart Flank </a>的特性，该特性将基于历史运行数据智能地对测试进行分片，以确保所有分片都有望同时完成。</p><p id="eaf4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> iOS </strong></p><p id="ee3d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们通过一个叫做<a class="ae kr" href="https://github.com/MobileNativeFoundation/bluepill" rel="noopener ugc nofollow" target="_blank"> bluepill </a>的工具在AWS EC2的macOS实例上运行我们的iOS测试。高度并行化会降低稳定性，因为模拟器会争夺系统资源，从而导致不可预测的网络不稳定和帧丢失。为了补偿我们受限的并行化，我们在bluepill之上构建了一个定制的调度器<a class="ae kr" href="https://github.com/rainnapper/bluepill/tree/mmark/pinpill" rel="noopener ugc nofollow" target="_blank"> pinpill </a>，以便在测试完成时更有效地利用可用的模拟器。</p><h1 id="f5bd" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">挑战3 —开发者体验</h1><p id="11fa" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">在提交后运行UI测试意味着许多开发人员在与UI测试及其结果交互方面经验不足。测试的碎片化也意味着你可能会遇到与你的领域完全不相关的测试。我们在开发人员使用UI测试的经验上进行投资，以最大限度地减少流失和挫折。</p><h2 id="7ebc" class="lm jp hh bd jq ln lo lp ju lq lr ls jy ip lt lu kc it lv lw kg ix lx ly kk lz bi translated">可调试性</h2><p id="8686" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">每个测试结果都应该有日志和视频记录。视频记录对于使UI测试更容易理解是至关重要的。</p><p id="3edb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">发现测试失败应该只需点击几下鼠标。在Pinterest，我们有一个工具可以收集一个构建的测试结果，并将它们全部显示在一个地方。测试结果与以下内容一起显示:</p><ul class=""><li id="ca54" class="ks kt hh ig b ih ii il im ip ku it kv ix kw jb kx ky kz la bi translated">测试工件的链接</li><li id="5eee" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">测试历史</li><li id="e037" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">测试所有权信息(松弛渠道、团队)</li><li id="9fec" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">按钮使测试静音</li></ul><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ma"><img src="../Images/c08300074e09784a0f32703426d145f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fGYImgPswBKonk4_"/></div></div><figcaption class="li lj et er es lk ll bd b be z dx">Screenshot of a test result summary page from Pinterest’s internal tool</figcaption></figure><h2 id="be20" class="lm jp hh bd jq ln lo lp ju lq lr ls jy ip lt lu kc it lv lw kg ix lx ly kk lz bi translated">支持和缓解</h2><p id="2c01" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated"><strong class="ig hi">知识</strong></p><p id="3947" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们的团队成员随叫随到，帮助工程师了解阻碍他们提交的UI测试失败。我们安排办公时间和预算时间来处理特殊问题。</p><p id="9bc2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">记录工程师将会遇到的所有关键场景，例如:</p><ul class=""><li id="538d" class="ks kt hh ig b ih ii il im ip ku it kv ix kw jb kx ky kz la bi translated">何时让测试静音</li><li id="41d0" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">如何调查故障和常见故障</li><li id="d36e" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">如何处理假阴性，确定下一步，并重复之前的测试。</li></ul><p id="fc3b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">结果缓存</strong></p><p id="bf5d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">不可避免地，工程师会在某个时候被错误地阻止。前面提到的“回收”机制让他们跳过不必要的重播。如果一个构建的测试失败了，并且这个测试被确定为一个假阴性，那么这个测试可以并且应该被沉默。在重新运行时，所有以前的失败现在都消失了，所以我们可以跳过整个测试运行。</p><p id="a40a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是保持团队对他们的测试负责的第二个目的。如果他们的测试突然出现片状剥落并阻碍了工程师，他们的测试将被停止，迫使他们调查原因。</p><h1 id="3a7a" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">挑战4——使主分支免受故障影响</h1><h2 id="062a" class="lm jp hh bd jq ln lo lp ju lq lr ls jy ip lt lu kc it lv lw kg ix lx ly kk lz bi translated">实验斜坡</h2><p id="f59e" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">我们的客户端A/B测试实验每30分钟拍摄一次快照，并合并到应用程序代码中。这在源代码控制中创建了一个密封的实验状态。</p><p id="abeb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过在这些更新之前运行测试，我们在实验上升和下降时“预提交”运行我们的测试。如果测试失败，我们建议阻塞实验斜坡。</p><p id="9f18" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这种模式应该应用于任何有中断风险的自动提交。</p><h2 id="1b98" class="lm jp hh bd jq ln lo lp ju lq lr ls jy ip lt lu kc it lv lw kg ix lx ly kk lz bi translated">稳定性实施者</h2><p id="bfc8" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">Stability Enforcer是一个工具，当测试显示出不稳定的迹象时，它会自动停止测试。例如，如果一个测试在过去的20次运行中变得&gt; 20%,它将被静音。如果它一直失败，它不会沉默。</p><p id="45ae" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这有助于减轻监控问题的负担，并防止过多的碎片到达开发人员手中。</p><h2 id="97af" class="lm jp hh bd jq ln lo lp ju lq lr ls jy ip lt lu kc it lv lw kg ix lx ly kk lz bi translated">监视</h2><p id="c82a" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">我们的随叫随到轮值会在工作时间监控主要分支机构的所有故障。这些失败并不总是与特定的提交相关联，所以提交前测试并不总是能够防止它们。常见的原因是API中断、服务器响应变化和工具故障。我们的团队帮助筛选或解决这些问题，以最大限度地降低阻碍开发人员的风险。</p><h1 id="dac5" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">韵律学</h1><p id="6e70" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">为了确保测试套件随着测试的变化和应用的发展而保持健康，必须跟踪和维护一些关键指标。</p><h2 id="bb04" class="lm jp hh bd jq ln lo lp ju lq lr ls jy ip lt lu kc it lv lw kg ix lx ly kk lz bi translated">主干通过率%</h2><p id="6d5b" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">这是一个核心指标，表明你多久会错误地阻止一个开发人员的变更。</p><p id="abea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们建议只在工作时间计算测试运行，以避免对隔夜或周末的失败进行过度索引，从而扭曲您的成功率。</p><p id="f8ed" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">除了测试稳定性之外，这还可以衡量您的流程对失败的响应效率。</p><h2 id="bee8" class="lm jp hh bd jq ln lo lp ju lq lr ls jy ip lt lu kc it lv lw kg ix lx ly kk lz bi translated">测试速度</h2><p id="1d2c" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">我们建议使用P90时间来确保开发人员有一致的体验，不会让他们等待构建完成。我们最初的目标是30分钟，端到端。我们认为投资越多，时间越短是可能的。</p><h2 id="2aeb" class="lm jp hh bd jq ln lo lp ju lq lr ls jy ip lt lu kc it lv lw kg ix lx ly kk lz bi translated">无声测试</h2><p id="5eb4" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">有了不稳定的测试套件，许多测试会变得沉默。你不应该让你的大部分测试保持沉默。大量的沉默测试可能意味着:</p><ul class=""><li id="f887" class="ks kt hh ig b ih ii il im ip ku it kv ix kw jb kx ky kz la bi translated">您的工程组织没有配备合适的工具或指南来编写稳定的测试。</li><li id="b5d0" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">团队没有满足其解决失败的SLA</li><li id="04ca" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">太少的人拥有太多的测试，他们无法跟上所有的测试</li></ul><h2 id="ba14" class="lm jp hh bd jq ln lo lp ju lq lr ls jy ip lt lu kc it lv lw kg ix lx ly kk lz bi translated">测试次数</h2><p id="31c0" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">随着应用程序复杂性的增加，测试套件也会增加。跟踪测试套件的规模将有助于您提前解决可伸缩性和可维护性的问题。</p><p id="d440" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">太多的UI测试通常不是一个好现象。UI测试是捕捉明显故障的最后一道防线。然而，与其他形式的测试不同，它们对于用户行为的每一种排列都太慢、太贵了。</p><h1 id="891e" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">加速</h1><p id="6346" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">从提交后切换到提交前对生产率和客户流失来说是一个很大的风险，应该小心处理。我们建议以下阶段:</p><h2 id="e17a" class="lm jp hh bd jq ln lo lp ju lq lr ls jy ip lt lu kc it lv lw kg ix lx ly kk lz bi translated">润色你的测试和过程</h2><p id="f452" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">花几周时间格外关注测试质量和可靠性。找到并解决您在测试运行中看到的每个问题。</p><p id="388a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">尽快运行您的流程来捕捉和解决故障。在切换到预提交之后，工作量会明显减少，并且会分配给其他团队，但是最初，您应该做一些跑腿的工作，以确保流程顺利进行。</p><p id="027d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">进行沟通，以确保拥有测试的团队在转向预提交后了解更严格的SLA。这让他们有机会提出问题、删除测试等。</p><h2 id="6e50" class="lm jp hh bd jq ln lo lp ju lq lr ls jy ip lt lu kc it lv lw kg ix lx ly kk lz bi translated">选择加入</h2><p id="61f8" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">与少数团队合作，并对这些团队成员提交的diffs运行预提交测试套件。</p><p id="4cea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">编写通知或文档，告知工程师他们的差异正在运行UI测试套件，并将其链接到相关资源。</p><p id="b833" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在继续之前，我们将选择加入阶段延长至所有差异的10–15%，为期2周。</p><h2 id="dd26" class="lm jp hh bd jq ln lo lp ju lq lr ls jy ip lt lu kc it lv lw kg ix lx ly kk lz bi translated">选择退出</h2><p id="7777" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">类似于强制提交，如果出了问题，建立一个绕过测试的机制。确保工程师了解这个机制以及何时使用它是合适的。现在，您可以翻转开关:对所有更改运行提交前测试，并关闭提交后运行。</p><p id="1225" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">既然故障是分阶段发生的，你就不知道主分支是否稳定。主分支上的故障需要紧急处理，因为它们表示剥落或破损。</p><h1 id="0540" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">结论</h1><p id="8b5e" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">在这一变化之前，我们努力保持测试套件的通过率在50%以上。这是一个不断追赶、发现问题、识别所有者和调试的游戏。现在，我们的通过率约为90%，且待命负担显著减轻。</p><p id="7610" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">展望未来，仍有许多工作要做。误报和测试速度慢是开发人员速度的一大风险。我们在考虑接下来的步骤:</p><ul class=""><li id="ccb1" class="ks kt hh ig b ih ii il im ip ku it kv ix kw jb kx ky kz la bi translated">根据更改的代码有选择地运行用户界面测试</li><li id="2373" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">模拟或控制API响应，以限制测试方差</li><li id="432d" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">处理测试失败日志，以检测基础架构级别的趋势和问题</li></ul><h1 id="1a1c" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">承认</h1><ul class=""><li id="5500" class="ks kt hh ig b ih km il kn ip mb it mc ix md jb kx ky kz la bi translated">Alice Yang，Doruk，Freddy，Jennifer Uvina，Joseph smols-Mantey，Matt Mo和Ryan Cooke:感谢你们为支持这个项目而建设Pinterest测试基础设施，并感谢你们就如何设计我们的流程进行了无数次讨论。</li><li id="277f" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">Sha Sha Chu和Garrett Moon:感谢他们支持将这一变化引入我们的Android和iOS团队，并让我们对良好的开发者体验负责。</li><li id="4f04" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated"><a class="ae kr" href="https://github.com/MobileNativeFoundation/bluepill" rel="noopener ugc nofollow" target="_blank">蓝丸</a>和<a class="ae kr" href="https://github.com/Flank/flank" rel="noopener ugc nofollow" target="_blank">的维护者在</a>的侧面构建使之成为可能的工具，并支持特性请求和bug。</li><li id="030f" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated"><a class="ae kr" href="https://firebase.community/" rel="noopener ugc nofollow" target="_blank"> Firebase社区slack </a>帮助调查和设计基础设施问题</li></ul><p id="86b7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="me">要在Pinterest了解更多工程知识，请查看我们的</em> <a class="ae kr" href="https://medium.com/pinterest-engineering" rel="noopener"> <em class="me">工程博客</em> </a> <em class="me">，并访问我们的</em><a class="ae kr" href="https://www.pinterestlabs.com/?utm_source=medium&amp;utm_medium=article-link&amp;utm_campaign=mark-january-10-2022" rel="noopener ugc nofollow" target="_blank"><em class="me">Pinterest Labs</em></a><em class="me">网站。要查看和申请空缺职位，请访问我们的</em> <a class="ae kr" href="https://www.pinterestcareers.com/?utm_source=medium&amp;utm_medium=article-link&amp;utm_campaign=mark-january-10-2022" rel="noopener ugc nofollow" target="_blank"> <em class="me">职业</em> </a> <em class="me">页面。</em></p></div></div>    
</body>
</html>