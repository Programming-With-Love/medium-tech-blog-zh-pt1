<html>
<head>
<title>Quick terminal-based DNS switching</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于终端的快速DNS切换</h1>
<blockquote>原文：<a href="https://medium.easyread.co/quick-terminal-based-dns-switching-4ffa407dfd38?source=collection_archive---------7-----------------------#2019-10-29">https://medium.easyread.co/quick-terminal-based-dns-switching-4ffa407dfd38?source=collection_archive---------7-----------------------#2019-10-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="42f8" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">切换DNS服务器设置以解决域名服务器阻塞和企业代理的快速指南</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/f9ff71827901a269eb2d56f08cf2c251.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z6GF1jXn4HN7SnQX175YBw.png"/></div></div></figure><h1 id="8271" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">动机</h1><p id="4464" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">我们中的大多数人，在生活中的某个时候，都至少为我们的计算机使用过定制的DNS服务器配置。无论是为了避免审查，更快的浏览，安全，还是绕过内容限制，我们都尝试过将我们的DNS服务器设置为一些公共DNS服务器，如谷歌的服务器(还记得8.8.8.8和8.8.4.4吗？).我自己也不例外，因为我一直使用<a class="ae mc" href="https://1.1.1.1/dns/" rel="noopener ugc nofollow" target="_blank">1.1.1.1</a>的隐私和速度。不幸的是，拥有定制的DNS域名服务器也会给那些在不同地方一直使用他们的电脑的人带来一些挫折。对于定制的DNS服务器，这就是你在试图阻止它们(连同VPN服务等)的网络上得到的结果。)</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi md"><img src="../Images/11d24aeb114b9a2b2baee6bc4b8a2ced.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*snJ_Xlfdi86okKvvxIcY2g.png"/></div></div></figure><p id="815a" class="pw-post-body-paragraph lg lh in li b lj me jo ll lm mf jr lo lp mg lr ls lt mh lv lw lx mi lz ma mb ig bi translated">自定义DNS服务器的另一个问题是，网络登录页面不会显示，因为默认DNS没有用于将我们重定向到本地网络登录页面。当然，删除配置会很容易，因为您(很可能)是设置它们的人，删除会有多难呢？但是如果我们再次需要这些备用DNS服务器呢？我个人觉得这种手动删除和添加它们的方式太麻烦了。因此，我将它们包装在一个bash函数中，该函数像所有懒惰的程序员一样为我完成这项工作。</p><h1 id="b957" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi">1.1.1.1</h1><p id="690d" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">在开始解释我在下一部分做了什么之前，我想对这个令人敬畏的项目大声欢呼，它是来自<a class="ae mc" href="https://www.cloudflare.com/" rel="noopener ugc nofollow" target="_blank"> Cloudflare </a>和<a class="ae mc" href="https://www.apnic.net/" rel="noopener ugc nofollow" target="_blank">APNIC</a>—<a class="ae mc" href="https://1.1.1.1/dns/" rel="noopener ugc nofollow" target="_blank">1.1.1.1</a>的联合努力。这是一项为互联网用户提供更快更安全的DNS的努力(它比谷歌公共DNS快两倍多🚀🚀🚀).但不仅仅如此，它还是一个隐私优先的DNS服务器。你认为只有像谷歌、脸书这样的公司会试图追踪你所有的在线活动吗(这些活动可以被令人敬畏的隐私卫士屏蔽掉)？你的ISP也会窃听你正在访问的任何网站，并出售这些数据以向你投放广告，你猜怎么着，他们是通过DNS解析器做到这一点的！</p><p id="d156" class="pw-post-body-paragraph lg lh in li b lj me jo ll lm mf jr lo lp mg lr ls lt mh lv lw lx mi lz ma mb ig bi translated">1.1.1.1以0美元的价格(是的，你没看错)保护你免受所有这些伤害。一个尊重你隐私的免费、快速、安全的DNS服务器——听起来好得令人难以置信，不是吗？但这是为了建设一个更好的互联网而做出的努力。你不必相信我的话，可以在<a class="ae mc" href="https://blog.cloudflare.com/announcing-1111/" rel="noopener ugc nofollow" target="_blank"> Cloudflare的</a>和<a class="ae mc" href="https://labs.apnic.net/?p=1127" rel="noopener ugc nofollow" target="_blank"> APNIC的</a>博客上了解更多。</p><h1 id="43ab" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">通过bash切换DNS名称服务器</h1><p id="61c7" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">正如我之前提到的，每当我在学校和家里的网络之间来回切换时，通过网络设置UI手动更新DNS配置对我来说太麻烦了。很自然，我会试着通过我的终端弄清楚怎么做。就在那时，我发现了macOS内置的这个非常棒的工具。使用<code class="fe mj mk ml mm b">networksetup</code>，更改我的DNS配置非常简单</p><pre class="kd ke kf kg gt mn mm mo mp aw mq bi"><span id="04bc" class="mr kp in mm b gy ms mt l mu mv"># Adding 1.1.1.1 to my nameservers<br/>networksetup -setdnsservers Wi-Fi 1.1.1.1<br/># Clear all my alternate nameservers<br/>networksetup -setdnsservers Wi-Fi empty</span></pre><p id="d8be" class="pw-post-body-paragraph lg lh in li b lj me jo ll lm mf jr lo lp mg lr ls lt mh lv lw lx mi lz ma mb ig bi translated">现在，我可以通过以下方式轻松地将我的DNS解析器配置为与1.1.1.1的说明相同</p><pre class="kd ke kf kg gt mn mm mo mp aw mq bi"><span id="bab2" class="mr kp in mm b gy ms mt l mu mv"># 4 nameservers - 2 IPv4 &amp; 2 IPv6<br/>networksetup -setdnsservers Wi-Fi 1.1.1.1 1.0.0.1 2606:4700:4700::1111 2606:4700:4700::1001</span></pre><p id="cb45" class="pw-post-body-paragraph lg lh in li b lj me jo ll lm mf jr lo lp mg lr ls lt mh lv lw lx mi lz ma mb ig bi translated">但是这也是相当长的输入时间，尽管我更喜欢这个而不是网络偏好用户界面。因此，我将它封装在一个bash函数中，达到了另一种程度的懒惰</p><pre class="kd ke kf kg gt mn mm mo mp aw mq bi"><span id="71a5" class="mr kp in mm b gy ms mt l mu mv">function dns1111() {<br/>    networksetup -setdnsservers Wi-Fi 1.1.1.1 1.0.0.1 2606:4700:4700::1111 2606:4700:4700::1001<br/>}</span></pre><p id="1ec5" class="pw-post-body-paragraph lg lh in li b lj me jo ll lm mf jr lo lp mg lr ls lt mh lv lw lx mi lz ma mb ig bi translated">这看起来很简洁，也很有效，但是请稍等。换回空的怎么样？这个bash函数的一个标志/参数可以很好地完成这项工作，但是我想尽可能地使用最少的努力，并节省自己记住备用DNS配置是否为空的精神负担。所以我对自己说:“为什么不检测当前状态并基于此切换DNS配置呢？就像一个文字开关按钮——你不需要告诉它你想要它是什么状态，只是与之前的状态相反。考虑到这一点，我为<code class="fe mj mk ml mm b">networksetup</code>找到了这个选项，它会告诉我当前的状态</p><pre class="kd ke kf kg gt mn mm mo mp aw mq bi"><span id="1014" class="mr kp in mm b gy ms mt l mu mv">networksetup -getdnsservers Wi-Fi</span></pre><p id="ccfb" class="pw-post-body-paragraph lg lh in li b lj me jo ll lm mf jr lo lp mg lr ls lt mh lv lw lx mi lz ma mb ig bi translated">它会列出我所有的备用DNS服务器，或者如果没有的话，打印出这个字符串<code class="fe mj mk ml mm b">There aren't any DNS Servers set on Wi-Fi</code>。现在我可以完成我的功能了，用一些很酷的表情符号来表示配置是刚刚被应用还是被删除</p><pre class="kd ke kf kg gt mn mm mo mp aw mq bi"><span id="04a6" class="mr kp in mm b gy ms mt l mu mv">function dns1111() {<br/>  if [[ $(networksetup -getdnsservers Wi-Fi) == "There aren't any DNS Servers set on Wi-Fi"* ]]; then<br/>    networksetup -setdnsservers Wi-Fi 1.1.1.1 1.0.0.1 2606:4700:4700::1111 2606:4700:4700::1001 &amp;&amp; echo 🚀 🚀 🚀<br/>  else<br/>    networksetup -setdnsservers Wi-Fi empty &amp;&amp; echo 🚦 🚦 🚦<br/>  fi<br/>}</span></pre><p id="eb5e" class="pw-post-body-paragraph lg lh in li b lj me jo ll lm mf jr lo lp mg lr ls lt mh lv lw lx mi lz ma mb ig bi translated">现在我可以很容易地在1.1.1.1和默认DNS配置之间来回切换，只需一个简短的命令<code class="fe mj mk ml mm b">dns1111</code></p><h1 id="5bf7" class="ko kp in bd kq kr ks kt ku kv kw kx ky jt kz ju la jw lb jx lc jz ld ka le lf bi translated">额外收获:基于Linux的机器</h1><p id="0425" class="pw-post-body-paragraph lg lh in li b lj lk jo ll lm ln jr lo lp lq lr ls lt lu lv lw lx ly lz ma mb ig bi translated">由于<code class="fe mj mk ml mm b">networksetup</code>在基于Linux的操作系统上不可用，我们需要使用一个不同的包来帮助处理名为<code class="fe mj mk ml mm b">dnsmasq</code>的DNS名称服务器。</p><p id="e59e" class="pw-post-body-paragraph lg lh in li b lj me jo ll lm mf jr lo lp mg lr ls lt mh lv lw lx mi lz ma mb ig bi translated">使用发行版的软件包管理器安装它</p><pre class="kd ke kf kg gt mn mm mo mp aw mq bi"><span id="bf31" class="mr kp in mm b gy ms mt l mu mv"># this is for Ubuntu<br/>sudo apt-get install dnsmasq</span></pre><p id="521d" class="pw-post-body-paragraph lg lh in li b lj me jo ll lm mf jr lo lp mg lr ls lt mh lv lw lx mi lz ma mb ig bi translated">安装包将附带一个配置文件<code class="fe mj mk ml mm b">/etc/dnsmasq.conf</code>，以便我们更新名称服务器。我在下面包含了我的实现。如果你有更好的方法，请不要犹豫，通过<a class="ae mc" href="mailto:hung.ngn.the@gmail.com" rel="noopener ugc nofollow" target="_blank">hung.ngn.the@gmail.com</a>联系我</p><pre class="kd ke kf kg gt mn mm mo mp aw mq bi"><span id="27fb" class="mr kp in mm b gy ms mt l mu mv">function dns1111() {<br/>  # detect existence of the backup file to see whether the config is in place<br/>  if [ -e /etc/dnsmasq.conf.bak ]]; then<br/>    sudo mv /etc/dnsmasq.conf.bak /etc/dnsmasq.conf &amp;&amp; echo 🚦 🚦 🚦<br/>  else<br/>    sudo cp /etc/dnsmasq.conf /etc/dnsmasq.conf.bak &amp;&amp; \<br/>    sudo echo "server=1.1.1.1<br/>server=1.0.0.1<br/>server=2606:4700:4700::1111<br/>server=2606:4700:4700::1001" &gt;&gt; /etc/dnsmasq.conf &amp;&amp; \<br/>    sudo service dnsmasq restart &amp;&amp; \<br/>    sudo service network-manager restart &amp;&amp; \<br/>    echo 🚀 🚀 🚀<br/>  fi<br/>}</span></pre><p id="0739" class="pw-post-body-paragraph lg lh in li b lj me jo ll lm mf jr lo lp mg lr ls lt mh lv lw lx mi lz ma mb ig bi translated">这篇文章最初发表在<a class="ae mc" href="https://thecodecousins.com/posts/dns-command/" rel="noopener ugc nofollow" target="_blank">the decodous</a>上。</p></div><div class="ab cl mw mx hr my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="ig ih ii ij ik"><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nd ne l"/></div></figure></div></div>    
</body>
</html>