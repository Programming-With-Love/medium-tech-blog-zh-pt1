<html>
<head>
<title>The Cloud and Kube are strong with OCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">云和Kube对OCI来说很强大</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/the-cloud-and-kube-are-strong-with-oci-f7c8a0fc83e5?source=collection_archive---------0-----------------------#2022-06-24">https://medium.com/oracledevs/the-cloud-and-kube-are-strong-with-oci-f7c8a0fc83e5?source=collection_archive---------0-----------------------#2022-06-24</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/b59c0794d02e12deb0f2aca64161e312.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jvw2GZRB_-cOViOL.jpg"/></div></div></figure><p id="3ab6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">甲骨文<a class="ae jn" href="https://www.oracle.com/news/announcement/q4fy22-earnings-release-2022-06-13/" rel="noopener ugc nofollow" target="_blank">第四季度财务结果出炉，云收入上升</a>。一整套<a class="ae jn" href="https://blogs.oracle.com/cloud-infrastructure/category/oci-product-news" rel="noopener ugc nofollow" target="_blank">新品最近发布</a>，尤其是<a class="ae jn" href="https://blogs.oracle.com/cloud-infrastructure/post/dedicated-regions-now-available-with-smaller-footprint-and-lower-price-point" rel="noopener ugc nofollow" target="_blank">更小的OCI专用区域，价位更低</a>。是啊，我们一直很忙。如果您错过了公告，您可以点播观看:</p><figure class="jo jp jq jr fd ii"><div class="bz dy l di"><div class="js jt l"/></div></figure><p id="19cf" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在所有这些兴奋中，很容易忘记OCI最近的云本地开发。别害怕，我会掩护你的。</p><h2 id="6014" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ja kf kg kh je ki kj kk ji kl km kn ko bi translated">支持将Oracle Linux 8用于工作节点</h2><p id="49e5" class="pw-post-body-paragraph ip iq hh ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">年初，我们为运行Kubernetes 1.20及更高版本的集群创建节点池时，增加了使用Oracle Linux 8的能力。Oracle Linux 8支持<a class="ae jn" href="https://www.nist.gov/standardsgov/compliance-faqs-federal-information-processing-standards-fips" rel="noopener ugc nofollow" target="_blank"> FIPS </a>，这是一套针对联邦计算机系统的标准和指南。不过，一般来说，Oracle Linux 8更精简，这意味着它的启动速度更快，因此您的节点池变得更快可用。</p><h2 id="dce1" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ja kf kg kh je ki kj kk ji kl km kn ko bi translated">支持为工作节点定制云初始化脚本</h2><p id="24a7" class="pw-post-body-paragraph ip iq hh ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">然后，我们添加了在您的节点池中定制云初始化脚本的功能。直到最近，您才能够将cloud-init用于普通的计算实例，但是您不能为工作节点定制底层的cloud-init脚本。他们在那里，但我们没有向你暴露他们。现在我们有了，您可以自定义节点池来满足您的需求。</p><p id="4f81" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您可以使用cloud-init脚本来配置额外的kubelet参数，配置SELinux策略，安装您的组织强制的防病毒和其他安全工具。重要的是，您还可以拥有特定于节点池的脚本。在<a class="ae jn" href="https://github.com/oracle-terraform-modules/terraform-oci-oke" rel="noopener ugc nofollow" target="_blank"> terraform-oci-oke </a> <a class="ae jn" href="https://registry.terraform.io/modules/oracle-terraform-modules/oke/oci/latest" rel="noopener ugc nofollow" target="_blank">模块</a>中，我们包含了<a class="ae jn" href="https://github.com/oracle-terraform-modules/terraform-oci-oke/blob/main/modules/oke/cloudinit/worker.template.sh" rel="noopener ugc nofollow" target="_blank">一个所有节点池通用的默认脚本</a>。它还允许您设置首选时区，如果您在节点池参数中设置了较高的启动卷，它也会自动进行配置。如果您有一个很大的节点池，那么连接到所有节点池并运行<a class="ae jn" href="https://docs.oracle.com/en-us/iaas/oracle-linux/oci-utils/index.htm#oci-growfs" rel="noopener ugc nofollow" target="_blank"> oci-growfs </a>来将引导卷扩展到其配置的大小并不有趣。相反，我们使用cloud-init来为您完成繁重的工作。</p><p id="aff5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您也可以覆盖默认的通用脚本:</p><pre class="jo jp jq jr fd ku kv kw kx aw ky bi"><span id="81a7" class="ju jv hh kv b fi kz la l lb lc">cloudinit_nodepool_common = "/tmp/commoncloudinit.sh"</span></pre><p id="e75a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">或者为每个节点池设置一个特定的脚本:</p><pre class="jo jp jq jr fd ku kv kw kx aw ky bi"><span id="6329" class="ju jv hh kv b fi kz la l lb lc">cloudinit_nodepool = {  <br/>  np1 = "/tmp/np1cloudinit.sh"<br/>  np3 = "/tmp/np3cloudinit.sh"<br/>}</span></pre><h2 id="60c3" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ja kf kg kh je ki kj kk ji kl km kn ko bi translated">存储增强</h2><p id="bf89" class="pw-post-body-paragraph ip iq hh ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">随后，我们对OKE进行了几项存储增强:</p><ul class=""><li id="ab4f" class="ld le hh ir b is it iw ix ja lf je lg ji lh jm li lj lk ll bi translated">添加由OCI块存储服务支持的工作节点引导卷和Kubernetes持久卷(PVs)的加密。这允许客户通过使用存储在OCI保险库中的密钥进行加密来满足他们的合规性和安全性标准。</li><li id="f1ea" class="ld le hh ir b is lm iw ln ja lo je lp ji lq jm li lj lk ll bi translated">增加由OCI文件存储服务(FSS)支持的永久卷(PVs)的官方支持。这是一个漫长的过程。Prasad的<a class="ae jn" href="https://blogs.oracle.com/cloud-infrastructure/post/using-file-storage-service-with-container-engine-for-kubernetes" rel="noopener ugc nofollow" target="_blank">博客文章</a>已经为我们服务了一段时间，但它需要为FSS手动创建一个存储类。新机制使用CSI，因此不需要定义新的存储类。您需要做的就是指定驱动程序。此外，您还可以使用它来加密FSS传输中的数据和静态数据。</li></ul><pre class="jo jp jq jr fd ku kv kw kx aw ky bi"><span id="405b" class="ju jv hh kv b fi kz la l lb lc">apiVersion: v1<br/>kind: PersistentVolume<br/>metadata:<br/>  name: fss-pv<br/>spec:<br/>  capacity:<br/>    storage: 50Gi<br/>  volumeMode: Filesystem<br/>  accessModes:<br/>    - ReadWriteMany<br/>  persistentVolumeReclaimPolicy: Retain<br/>  csi:<br/>    driver: fss.csi.oraclecloud.com<br/>    volumeHandle: ocid1.filesystem.oc1.iad.aaaa______j2xw:10.0.0.6:/FileSystem1</span></pre><h2 id="9048" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ja kf kg kh je ki kj kk ji kl km kn ko bi translated">OKE相关资源的标记</h2><p id="2072" class="pw-post-body-paragraph ip iq hh ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">当您使用OKE时，会使用和创建大量相关的OCI资源:计算实例、负载平衡器、块卷、节点池等。很难跟踪所有这些，更不用说理解它花费了你多少钱。我们现在添加了对标记的OKE支持，这意味着您现在可以标记集群使用和创建的资源。有了标签，您就可以在成本分析和预算中使用它们来创建OCI使用情况报告。</p><h2 id="4a98" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ja kf kg kh je ki kj kk ji kl km kn ko bi translated">支持容量预留</h2><p id="276c" class="pw-post-body-paragraph ip iq hh ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">我们还向OKE添加了<a class="ae jn" href="https://blogs.oracle.com/cloud-infrastructure/post/container-engine-kubernetes-capacity-reservations" rel="noopener ugc nofollow" target="_blank">容量预留支持</a>。这允许您保留虚拟机或裸机容量，以确保这些资源在您需要时可用。</p><p id="582a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">可以在节点池的基础上添加容量预留，因此您可以选择要预留的形状，尤其是当您在集群中运行混合工作负载时。</p><h2 id="6ce5" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ja kf kg kh je ki kj kk ji kl km kn ko bi translated">保护您工作负载的安全特性</h2><p id="c8af" class="pw-post-body-paragraph ip iq hh ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">我的同事Greg也<a class="ae jn" href="https://blogs.oracle.com/cloud-infrastructure/post/oke-nine-security-features" rel="noopener ugc nofollow" target="_blank">发布了9个安全特性</a>，你可以很容易地实现它们来改善你的OKE工作负载的安全状况。</p><h2 id="55c9" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ja kf kg kh je ki kj kk ji kl km kn ko bi translated">支持扩展数据块存储支持的PVs</h2><p id="b161" class="pw-post-body-paragraph ip iq hh ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">您现在还可以扩展由OCI数据块存储服务支持的PVs的大小。最重要的是，您可以在不停机的情况下完成这项工作。例如，假设您创建了一个100GB大小的PV:</p><pre class="jo jp jq jr fd ku kv kw kx aw ky bi"><span id="af1b" class="ju jv hh kv b fi kz la l lb lc">apiVersion: v1<br/>kind: PersistentVolumeClaim<br/>metadata:<br/> name: my-pvc<br/>spec:<br/> storageClassName: oci-bv<br/> resources:<br/>  requests:<br/>    storage: <strong class="kv hi">100Gi</strong><br/> volumeName: pvc-bv1</span></pre><p id="d582" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在你想把它的大小翻倍。您可以更改清单并再次应用它:</p><pre class="jo jp jq jr fd ku kv kw kx aw ky bi"><span id="58d5" class="ju jv hh kv b fi kz la l lb lc">apiVersion: v1<br/>kind: PersistentVolumeClaim<br/>metadata:<br/> name: my-pvc<br/>spec:<br/> storageClassName: oci-bv<br/> resources:<br/>  requests:<br/>    storage: <strong class="kv hi">200Gi</strong><br/> volumeName: pvc-bv1<!-- --> </span></pre><h2 id="9f85" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ja kf kg kh je ki kj kk ji kl km kn ko bi translated">支持网络负载平衡器</h2><p id="c07b" class="pw-post-body-paragraph ip iq hh ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">OCI <a class="ae jn" href="https://blogs.oracle.com/cloud-infrastructure/post/announcing-oracle-cloud-infrastructure-flexible-network-load-balancer" rel="noopener ugc nofollow" target="_blank">去年推出了灵活的网络负载平衡器</a>，这是一种非代理负载平衡器，可执行第3层和第4层(TCP、UDP/ICMP)负载的直通负载平衡。在NLB的支持下，你可以在OKE上公开需要UDP的服务，如VoIP、实时视频流、在线游戏和物联网等。</p><h2 id="d8dc" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ja kf kg kh je ki kj kk ji kl km kn ko bi translated">OCI集群API，又名卡波奇</h2><p id="0958" class="pw-post-body-paragraph ip iq hh ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">我们还开源了<a class="ae jn" href="https://oracle.github.io/cluster-api-provider-oci/" rel="noopener ugc nofollow" target="_blank"> CAPOCI </a>，一个用于OCI的<a class="ae jn" href="https://github.com/kubernetes-sigs/cluster-api" rel="noopener ugc nofollow" target="_blank">集群API </a>实现。Cluster API是Kubernetes的一个子项目，它提供API和工具来简化使用不同基础设施提供者的多个Kubernetes集群的供应、升级和管理。通过使用一个通用的API，Cluster API使得在许多基础设施提供商之间管理Kubernetes集群的生命周期的体验变得一致。</p><p id="1cec" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">集群API真的很酷。到目前为止，如果你想创建一个新的自我管理的Kubernetes集群，你必须使用Terraform或者新的闪亮的Pulumi OCI提供者T1，一些bash脚本。使用集群API，您可以在管理集群中运行CAPOCI，管理集群可以是任何符合Kubernetes的集群。使用管理集群，您可以提供一个自我管理的Kubernetes集群，而不必手动创建计算、脚本等。您可以在OKE上运行管理集群来创建自我管理的集群，或者如果您有更复杂的场景，例如混合/多云，也可以在其他基础设施提供商上创建Kubernetes集群。该项目目前正在<a class="ae jn" href="https://github.com/oracle/cluster-api-provider-oci" rel="noopener ugc nofollow" target="_blank"> GitHub/oracle </a>上开发和维护，但我们希望尽快将其转移到<a class="ae jn" href="https://github.com/kubernetes-sigs/" rel="noopener ugc nofollow" target="_blank"> kubernetes-sig </a>组织。</p><h2 id="e5b6" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ja kf kg kh je ki kj kk ji kl km kn ko bi translated">私有OKE集群的安全部署</h2><p id="af0b" class="pw-post-body-paragraph ip iq hh ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">众所周知，OKE既可以部署在公共集群中，也可以部署在私有集群中。公共集群的API服务器可以公开访问，而私有集群的API服务器只能在VCN内访问，或者只能访问VCN通过VPN、FastConnect或星型模型扩展到的网络。</p><p id="7c28" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">直到最近，如果您使用DevOps服务，您将需要使用公共集群，但这已经是过去的事情了。现在，您也可以将<a class="ae jn" href="https://blogs.oracle.com/cloud-infrastructure/post/oci-devops-secure-deployments-to-private-kubernetes-clusters" rel="noopener ugc nofollow" target="_blank"> DevOps与私有集群</a>一起使用。这意味着您的代码、构建和部署永远不必通过公共互联网，从而增强了部署过程的安全性。</p><h2 id="a756" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ja kf kg kh je ki kj kk ji kl km kn ko bi translated">OCI服务网</h2><figure class="jo jp jq jr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lr"><img src="../Images/b75fc7ed49ac78d7fef864f3cc017aa7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0ABHtAg9A62cSKo4.jpg"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">Source: National History Museum</figcaption></figure><p id="8bad" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">服务网正在经历某种寒武纪大爆发。CNCF自己就有5个，这还是在Istio被接受之前。最近，我们还<a class="ae jn" href="https://blogs.oracle.com/cloud-infrastructure/post/announcing-oci-service-mesh-general-availability" rel="noopener ugc nofollow" target="_blank">宣布了OCI服务网格</a>。它支持在OKE上运行的任何应用程序。我还没有尝试过，所以我不会再详细说明了。</p><h2 id="5e03" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ja kf kg kh je ki kj kk ji kl km kn ko bi translated">OKE的负载平衡器节点选择器</h2><p id="651d" class="pw-post-body-paragraph ip iq hh ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">就在几天前，我的同事Ajay <a class="ae jn" href="https://blogs.oracle.com/cloud-infrastructure/post/announcing-load-balancer-node-label-selector" rel="noopener ugc nofollow" target="_blank">做了一个更好的工作来解释它</a>和它的好处。</p><h2 id="7582" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ja kf kg kh je ki kj kk ji kl km kn ko bi translated">优化的工人图像</h2><p id="2c9c" class="pw-post-body-paragraph ip iq hh ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">这也是最近才发布的。在调配节点池时，您可以根据所需的CPU体系结构(x86_64、aarch64、x86_64/CUDA)选择Oracle Linux映像，或者选择基于自定义映像的映像。在幕后，Kubernetes包将从头开始安装，一旦这个过程完成，那么工人节点将加入集群。不幸的是，调配新的节点池也需要很长的时间，这令人恼火。</p><p id="d611" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">通过优化的工作映像，Kubernetes包被预安装。这意味着工作节点可以跳过Kubernetes安装，并在完成引导和Kubernetes进程启动后加入集群。这大大缩短了节点池资源调配时间。从<a class="ae jn" href="https://github.com/oracle-terraform-modules/terraform-oci-oke/releases/tag/v4.2.4" rel="noopener ugc nofollow" target="_blank"> 4.2.4版本</a>开始，我们已经在<a class="ae jn" href="https://github.com/oracle-terraform-modules/terraform-oci-oke" rel="noopener ugc nofollow" target="_blank"> terraform-oci-oke </a>模块中支持该功能。</p><h2 id="948c" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ja kf kg kh je ki kj kk ji kl km kn ko bi translated">块卷性能级别</h2><p id="8c2c" class="pw-post-body-paragraph ip iq hh ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">现在，您还可以控制块卷的性能级别。默认情况下，它们被配置为平衡级别(10个vpu)。通过使用这个特性，您可以配置运行在更高性能级别的PVC。首先，定义一个存储类。你会注意到它使用了CSI卷插件:</p><pre class="jo jp jq jr fd ku kv kw kx aw ky bi"><span id="3b64" class="ju jv hh kv b fi kz la l lb lc">apiVersion: storage.k8s.io/v1<br/>kind: StorageClass<br/>metadata:<br/>  name: oci-high<br/>provisioner: blockvolume.csi.oraclecloud.com<br/>parameters:<br/>  <strong class="kv hi">vpusPerGB: "20"</strong><br/>reclaimPolicy: Delete<br/>volumeBindingMode: WaitForFirstConsumer<br/>allowVolumeExpansion: true</span></pre><p id="e06e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">请注意，在参数部分，我们指定了更高的vpu(卷性能单位)。您可以指定高达<a class="ae jn" href="https://docs.oracle.com/en-us/iaas/Content/Block/Concepts/blockvolumeperformance.htm" rel="noopener ugc nofollow" target="_blank">高性能</a>的vpu，即20个。</p><p id="e247" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">创建新的存储类后，您可以创建新的PVC:</p><pre class="jo jp jq jr fd ku kv kw kx aw ky bi"><span id="9649" class="ju jv hh kv b fi kz la l lb lc">apiVersion: v1<br/>kind: PersistentVolumeClaim<br/>metadata:<br/>  name: oci-pvc-high<br/>spec:<br/>  <strong class="kv hi">storageClassName: oci-high</strong><br/>  accessModes:<br/>    - ReadWriteOnce<br/>  resources:<br/>    requests:<br/>      storage: 5Gi</span></pre><p id="3454" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">VPUs是一种通过增加IOPS/GB来提高数据块卷性能的方法。您也可以选择购买更少的vpu，这不仅会降低性能，还会降低成本。因此，这是一种权衡。通过增加配置vpu的能力，您现在可以根据您的应用需求和预算有意识地自己做出选择。</p><h2 id="75a6" class="ju jv hh bd jw jx jy jz ka kb kc kd ke ja kf kg kh je ki kj kk ji kl km kn ko bi translated">摘要</h2><p id="58d6" class="pw-post-body-paragraph ip iq hh ir b is kp iu iv iw kq iy iz ja kr jc jd je ks jg jh ji kt jk jl jm ha bi translated">这些是我们已经公开提供的功能。更多令人兴奋的事情即将到来，我们会尽快与您分享。</p><p id="cbd3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">同时，加入我们的公共休闲活动吧！</p></div></div>    
</body>
</html>