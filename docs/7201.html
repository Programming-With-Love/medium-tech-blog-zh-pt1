<html>
<head>
<title>How Square writes commit messages</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Square如何编写提交消息</h1>
<blockquote>原文：<a href="https://medium.com/square-corner-blog/how-square-writes-commit-messages-8e92fcbf77c9?source=collection_archive---------0-----------------------#2017-04-18">https://medium.com/square-corner-blog/how-square-writes-commit-messages-8e92fcbf77c9?source=collection_archive---------0-----------------------#2017-04-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="2405" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated"><em class="iw">解释变化。</em></h2></div><blockquote class="ix"><p id="3390" class="iy iz hh bd ja jb jc jd je jf jg jh dx translated">注意，我们已经行动了！如果您想继续了解Square的最新技术内容，请访问我们在https://developer.squareup.com/blog<a class="ae ji" href="https://developer.squareup.com/blog" rel="noopener ugc nofollow" target="_blank">的新家</a></p></blockquote><p id="0cef" class="pw-post-body-paragraph jj jk hh jl b jm jn ii jo jp jq il jr js jt ju jv jw jx jy jz ka kb kc kd jh ha bi translated">在Square，提交信息是我们交流的一种重要形式，所以写好它们是我们互相回馈时间的一种很好的方式。我们常常希望我们能早点做得更好。那些日子犯下的罪行仍然留在我们的历史中，其中许多仍然非常重要。</p><p id="c2ba" class="pw-post-body-paragraph jj jk hh jl b jm ke ii jo jp kf il jr js kg ju jv jw kh jy jz ka ki kc kd jh ha bi translated">我们已经收集了我们对如何投资于伟大的承诺信息的想法，这些信息不仅可以立即节省我们的时间，还可以在以后节省时间。我们在这里分享它们，希望对你的团队有所帮助。</p><h1 id="6497" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">TL；DR:伟大的提交消息解释了变化</h1><p id="3ec3" class="pw-post-body-paragraph jj jk hh jl b jm lb ii jo jp lc il jr js ld ju jv jw le jy jz ka lf kc kd jh ha bi translated">在Square，我们写了很多代码。在最好的情况下，我们的代码是不言自明的。当我们的编程语言不够有表现力时，代码中会有注释来解释代码做什么，或者更好地解释为什么它会做什么。如果一个开发人员检查了阿沙并查看了代码，她应该能够理解它是做什么的，以及为什么它以这种方式工作。</p><p id="7c3b" class="pw-post-body-paragraph jj jk hh jl b jm ke ii jo jp kf il jr js kg ju jv jw kh jy jz ka ki kc kd jh ha bi translated">提交消息与代码无关，它们与<em class="lg">变化本身</em>有关。这是一个经常被忽略的重要区别。</p><p id="8f03" class="pw-post-body-paragraph jj jk hh jl b jm ke ii jo jp kf il jr js kg ju jv jw kh jy jz ka ki kc kd jh ha bi translated">当我们提交时，我们将一些非常清晰、自描述的代码变成了一些非常清晰、自描述的代码。无论前代码和后代码有多清晰，它们之间都有一个上下文间隙。提交消息填补了这一空白。</p><h1 id="8875" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">提交消息有两种受众</h1><p id="5c17" class="pw-post-body-paragraph jj jk hh jl b jm lb ii jo jp lc il jr js ld ju jv jw le jy jz ka lf kc kd jh ha bi translated">考虑一下提交消息的读者。他们基本上分为两个阵营:评论家和考古学家。</p><p id="4ce5" class="pw-post-body-paragraph jj jk hh jl b jm ke ii jo jp kf il jr js kg ju jv jw kh jy jz ka ki kc kd jh ha bi translated">直接的受众可能是代码审查者，他们必须决定是否批准更改，以及代码中的实际更改是否正确反映了作者的意图。评审者需要变更本身的上下文来评估它，如果变更带有提供上下文的消息，那么对他们来说比他们必须从之前和之后进行推断要容易得多。</p><p id="7011" class="pw-post-body-paragraph jj jk hh jl b jm ke ii jo jp kf il jr js kg ju jv jw kh jy jz ka ki kc kd jh ha bi translated">从长远来看，受众可能是开发人员，他们试图修复软件中的问题，删除不再需要的代码，在现有代码的基础上构建，只是进行类似的更改，或者这些操作的某种组合。有时候，这只是一个开发人员试图理解一个过去的决定(通常是作者！).这是考古学，如果每次提交都有一个有用的注释来解释变化，那就简单多了。否则，考古学家只能试图从之前的代码和之后的代码中重建提交作者的思维过程——这通常是一项不可能的任务。</p><h1 id="aa73" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">真的，他们有三个观众</h1><p id="4437" class="pw-post-body-paragraph jj jk hh jl b jm lb ii jo jp lc il jr js ld ju jv jw le jy jz ka lf kc kd jh ha bi translated">我们伟大的承诺信息也有助于我们提升我们最好的工程师。它们提供了背景和细节，帮助我们评估工程师工作中的技术敏锐度。同样重要的是，我们最好的承诺信息显示了我们作为沟通者的技巧和同理心。写得清楚、有见地、有帮助的提交消息是一个清楚的标志，表明一个工程师正在以远见和对他人的考虑进行构建。技术能力的证明、对他人的同情以及有效的沟通都是在Square获得晋升的关键。</p><h1 id="3766" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">我们是如何做到的</h1><h2 id="ece0" class="lh kk hh bd kl li lj lk kp ll lm ln kt js lo lp kv jw lq lr kx ka ls lt kz lu bi translated">我们很明确</h2><p id="5e24" class="pw-post-body-paragraph jj jk hh jl b jm lb ii jo jp lc il jr js ld ju jv jw le jy jz ka lf kc kd jh ha bi translated">我们在修复一个bug吗？我们将简要解释预期的和实际的行为，以及这种变化是如何相关的。我们是在引入新功能吗？我们来总结一下。</p><p id="e193" class="pw-post-body-paragraph jj jk hh jl b jm ke ii jo jp kf il jr js kg ju jv jw kh jy jz ka ki kc kd jh ha bi translated">假设读者不知道我们为什么要做出改变是有帮助的。对许多读者来说，这是真的——即使是最小、最“明显”的变化。写下动机尤其重要。</p><h2 id="c1a5" class="lh kk hh bd kl li lj lk kp ll lm ln kt js lo lp kv jw lq lr kx ka ls lt kz lu bi translated">我们很准确</h2><p id="5e90" class="pw-post-body-paragraph jj jk hh jl b jm lb ii jo jp lc il jr js ld ju jv jw le jy jz ka lf kc kd jh ha bi translated">这似乎是不言而喻的，但是在响应评审或者迭代变更的过程中，很容易忽略提交消息的更新。为了防止不准确，我们作者和审稿人在合并前会仔细检查我们的邮件。</p><h2 id="d250" class="lh kk hh bd kl li lj lk kp ll lm ln kt js lo lp kv jw lq lr kx ka ls lt kz lu bi translated">我们解释为什么这种改变是安全的</h2><p id="d9e7" class="pw-post-body-paragraph jj jk hh jl b jm lb ii jo jp lc il jr js ld ju jv jw le jy jz ka lf kc kd jh ha bi translated">特别是当我们接触基础设施代码或做一些不寻常的事情时，记录下为什么我们正在做的事情是可以的是值得的。它让读者放心，并把我们的考虑和假设记录在案，以防以后出现问题。</p><h2 id="7439" class="lh kk hh bd kl li lj lk kp ll lm ln kt js lo lp kv jw lq lr kx ka ls lt kz lu bi translated">我们指向具有更多上下文的资源</h2><p id="3ccd" class="pw-post-body-paragraph jj jk hh jl b jm lb ii jo jp lc il jr js ld ju jv jw le jy jz ka lf kc kd jh ha bi translated">当然是吉拉。设计文档，谷歌组线程，适当的松弛线程。我们对变化的背景了解得越多，考古学家就越容易理解它。</p><p id="9c6a" class="pw-post-body-paragraph jj jk hh jl b jm ke ii jo jp kf il jr js kg ju jv jw kh jy jz ka ki kc kd jh ha bi translated">当然，简单地链接到一张吉拉门票或讨论线程并没有太大的帮助。为什么要让读者(他们甚至可能没有在浏览器中阅读)去别的地方了解所有的变化呢？他们可能不会在意，也可能会错过关键的细节。他们也未必能够！比如，从前我们用Github Enterprise。现在GitHub上所有的pr都丢失了。工具会随着时间的推移而变化，但是提交日志是永远不变的。</p><p id="6231" class="pw-post-body-paragraph jj jk hh jl b jm ke ii jo jp kf il jr js kg ju jv jw kh jy jz ka ki kc kd jh ha bi translated">吉拉和斯塔什有助于捕捉对话的背景，理解在我们决定改变时发生的来来回回。我们的提交消息捕获来回的最终结果，如果链接失效，它应该独立存在。</p><h2 id="1809" class="lh kk hh bd kl li lj lk kp ll lm ln kt js lo lp kv jw lq lr kx ka ls lt kz lu bi translated">我们知道媒介</h2><p id="44c0" class="pw-post-body-paragraph jj jk hh jl b jm lb ii jo jp lc il jr js ld ju jv jw le jy jz ka lf kc kd jh ha bi translated">我们的消息将在各种工具和环境中被读取pull request、IDEs、可能显示简短或完整消息的“git log”命令行等。关于用这种媒介写作，有一些重要的事情需要知道。</p><ol class=""><li id="fc12" class="lv lw hh jl b jm ke jp kf js lx jw ly ka lz jh ma mb mc md bi translated">提交消息有<em class="lg">个主题行</em>。大多数工具都会对git消息第一行的前50个字符进行特殊处理。在许多情况下，例如通读“git log”输出，这是读者无需采取额外步骤就能看到的唯一文本。尽一切努力用50个字符总结你的承诺。如果可能的话，在这里包括一个JIRA问题ID。</li><li id="70b0" class="lv lw hh jl b jm me jp mf js mg jw mh ka mi jh ma mb mc md bi translated">大多数工具希望在消息的主题和正文之间看到一个空行。</li><li id="ef05" class="lv lw hh jl b jm me jp mf js mg jw mh ka mi jh ma mb mc md bi translated">提交消息通常从命令行工具中读取，并且通常在它们的左边有git-log支线(“铁路”)。换行很有帮助，通常在72个字符左右(为“曲目”留出空间)，但肯定在78个以内。</li></ol><h2 id="d6a4" class="lh kk hh bd kl li lj lk kp ll lm ln kt js lo lp kv jw lq lr kx ka ls lt kz lu bi translated">我们没有穿过小溪</h2><p id="48fc" class="pw-post-body-paragraph jj jk hh jl b jm lb ii jo jp lc il jr js ld ju jv jw le jy jz ka lf kc kd jh ha bi translated">我们小心翼翼地为我们的信息选择正确的媒介。</p><ul class=""><li id="ae9b" class="lv lw hh jl b jm ke jp kf js lx jw ly ka lz jh mj mb mc md bi translated"><strong class="jl hi">架构和广泛的决策</strong>被写在<strong class="jl hi">设计文档</strong>中。</li><li id="1a51" class="lv lw hh jl b jm me jp mf js mg jw mh ka mi jh mj mb mc md bi translated">当解释<strong class="jl hi">某些代码做什么以及为什么</strong>、<strong class="jl hi">、</strong>时，我们写<strong class="jl hi">代码注释</strong>。</li><li id="b2bc" class="lv lw hh jl b jm me jp mf js mg jw mh ka mi jh mj mb mc md bi translated">对于代码中的<strong class="jl hi">变化，我们编写<strong class="jl hi">提交消息</strong>。(你就知道这个！)</strong></li><li id="767b" class="lv lw hh jl b jm me jp mf js mg jw mh ka mi jh mj mb mc md bi translated">对于<strong class="jl hi">审查者关心但考古学家不关心的任何事情</strong>，我们在拉取请求上写下<strong class="jl hi">注释。</strong></li><li id="a9e4" class="lv lw hh jl b jm me jp mf js mg jw mh ka mi jh mj mb mc md bi translated">最后，<strong class="jl hi">段子</strong>归入<strong class="jl hi">分支名称</strong>。</li></ul><p id="637e" class="pw-post-body-paragraph jj jk hh jl b jm ke ii jo jp kf il jr js kg ju jv jw kh jy jz ka ki kc kd jh ha bi translated">注意:我们鼓励在上面交叉引用！</p><h1 id="52d5" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">有时我们会弄错</h1><p id="ca1b" class="pw-post-body-paragraph jj jk hh jl b jm lb ii jo jp lc il jr js ld ju jv jw le jy jz ka lf kc kd jh ha bi translated">从上面你可以看出，一个好的提交信息需要很多思考，就像大多数事情一样，需要练习和互相帮助来养成习惯。这里有一些我们常犯的错误。</p><h2 id="9f12" class="lh kk hh bd kl li lj lk kp ll lm ln kt js lo lp kv jw lq lr kx ka ls lt kz lu bi translated">模糊的挥手</h2><p id="1632" class="pw-post-body-paragraph jj jk hh jl b jm lb ii jo jp lc il jr js ld ju jv jw le jy jz ka lf kc kd jh ha bi translated">我们有时会写下类似“修正<bug>”或“增加<functionality>”的信息。有时这些消息甚至没有描述错误或功能。这些只是提示和线索，实际上是留给读者去完成的练习。</functionality></bug></p><h2 id="4862" class="lh kk hh bd kl li lj lk kp ll lm ln kt js lo lp kv jw lq lr kx ka ls lt kz lu bi translated">解释代码</h2><p id="1ddc" class="pw-post-body-paragraph jj jk hh jl b jm lb ii jo jp lc il jr js ld ju jv jw le jy jz ka lf kc kd jh ha bi translated">描述新代码不同于解释变化。有时我们会试图通过描述新代码的机制来提供帮助，比如它应该如何运行。不过，代码注释更适合这种情况。有时我们试图解释高层次的设计或架构，这更好地存在于我们可以链接的设计文档中。在任何层面上，对代码的解释都比提交消息有更好的归宿。</p><h2 id="2e12" class="lh kk hh bd kl li lj lk kp ll lm ln kt js lo lp kv jw lq lr kx ka ls lt kz lu bi translated">将diff音译成英语</h2><p id="2fff" class="pw-post-body-paragraph jj jk hh jl b jm lb ii jo jp lc il jr js ld ju jv jw le jy jz ka lf kc kd jh ha bi translated">不幸的是，这个很常见。在匆忙中，我们将写一条消息，简明扼要地描述这一变化。“删除了foo”，或“将bar重命名为baz”。这至少是一个正确的想法，但是像这样的信息太字面了。他们缺乏读者所寻求的背景、动机和安全保证。</p><h1 id="4e23" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">例子</h1><h2 id="e6e1" class="lh kk hh bd kl li lj lk kp ll lm ln kt js lo lp kv jw lq lr kx ka ls lt kz lu bi translated">我的过失</h2><p id="2ed7" class="pw-post-body-paragraph jj jk hh jl b jm lb ii jo jp lc il jr js ld ju jv jw le jy jz ka lf kc kd jh ha bi translated">这是我写的一个非常无用的提交消息的例子。抱歉，队员们！</p><figure class="mk ml mm mn fd mo"><div class="bz dy l di"><div class="mp mq l"/></div></figure><p id="d647" class="pw-post-body-paragraph jj jk hh jl b jm ke ii jo jp kf il jr js kg ju jv jw kh jy jz ka ki kc kd jh ha bi translated">你可以看到它没有提供上下文，没有提供改变的动机，只是描述了代码。我不知道为什么我想把这个请求从POST改为GET。有窃听器吗？可能吧，但那是什么？是因为请求本身吗？我是不是在解决REST库中的一个bug <a class="ae ji" href="http://square.github.io/retrofit/" rel="noopener ugc nofollow" target="_blank">，这个bug现在可能已经被修复了？这种改变应该在某个时候恢复吗？POST到底出了什么问题，为什么我认为GET会更好？这么多问题！现在连我都不知道答案了。</a></p><h1 id="e36e" class="kj kk hh bd kl km kn ko kp kq kr ks kt in ku io kv iq kw ir kx it ky iu kz la bi translated">更好！</h1><p id="b746" class="pw-post-body-paragraph jj jk hh jl b jm lb ii jo jp lc il jr js ld ju jv jw le jy jz ka lf kc kd jh ha bi translated">我想我在这里做得更好:</p><figure class="mk ml mm mn fd mo"><div class="bz dy l di"><div class="mp mq l"/></div></figure><p id="1f3b" class="pw-post-body-paragraph jj jk hh jl b jm ke ii jo jp kf il jr js kg ju jv jw kh jy jz ka ki kc kd jh ha bi translated">这一次，我们有更多的答案。有一些历史，包括一个链接，指向问题是从哪里引入的，以便进一步阅读。我解释了我正在修复的bug，解释得足够详细，让读者能够理解(至少我理解，八个月后)。最后，在这个支持性的上下文中，我简要地解释了我所做的更改，以及为什么它会解决这个问题。这对我今天的帮助要大得多，也希望对别人。</p></div></div>    
</body>
</html>