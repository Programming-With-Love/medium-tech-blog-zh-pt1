<html>
<head>
<title>Monitoring sensor data in Oracle JET Mobile App over WebSocket (Part 1)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过WebSocket监控Oracle JET Mobile应用程序中的传感器数据(第1部分)</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/monitoring-sensor-data-in-jet-mobile-app-over-websockets-part-1-2-f7fa81d9774b?source=collection_archive---------0-----------------------#2017-08-29">https://medium.com/oracledevs/monitoring-sensor-data-in-jet-mobile-app-over-websockets-part-1-2-f7fa81d9774b?source=collection_archive---------0-----------------------#2017-08-29</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="ef37" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我正在制作如何将DHT22传感器数据显示到我的JET mobile应用程序的原型，希望分享我的发现。</p><p id="5759" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在第1部分中，我们将展示WebSocket服务器向客户机发送传感器值。在最后一部分，即第2部分，我们将从头开始开发一个展示传感器数据的JET移动应用程序。</p><p id="b6e2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> DHT22 </strong>是一种低成本传感器，由湿度和温度传感器组成。数据可以通过GPIO引脚读取，所以我用<strong class="ig hi"> ESP8266 NodeMCU </strong>连接。</p><p id="58c9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，在NodeMCU芯片上运行<strong class="ig hi"> WebSocket服务器</strong>来发送DHT22传感器数据，最后开发了Oracle JET Mobile应用程序，该应用程序使用<strong class="ig hi"> WebSocket客户端</strong> Javascript API来监控温度数据。</p><p id="9a05" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下图直观地展示了Oracle JET Mobile应用程序如何通过WebSocket与NodeMCU进行交互。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/25eb691577a439bc799e05552eaf8cdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KLQ2xwCHTK8M_-sjy_GvRQ.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">JET Mobile App communicating to ESP8266 NodeMCU</figcaption></figure><p id="3b0b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里的移动应用程序充当websocket客户端，与NodeMCU建立握手，其中安装了websocket服务器。一旦建立连接，客户端请求温度值，改变后的温度值显示在千分表— ojgauge，<a class="ae js" href="http://www.oracle.com/webfolder/technetwork/jet/jetCookbook.html?component=dialGauge&amp;demo=dialGaugeComponent" rel="noopener ugc nofollow" target="_blank"> <em class="jt"> oracle jet组件</em> </a>中。用户可以选择停止测量并断开连接。</p></div><div class="ab cl ju jv go jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="ha hb hc hd he"><p id="4a34" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">硬件设置入门— ESP8266 NodeMCU和DHT22传感器</strong></p><p id="2253" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本节中，我们将把DHT22连接到ESP8266 NodeMCU</p><ol class=""><li id="2466" class="kb kc hh ig b ih ii il im ip kd it ke ix kf jb kg kh ki kj bi translated">三根跳线</li><li id="d5f4" class="kb kc hh ig b ih kk il kl ip km it kn ix ko jb kg kh ki kj bi translated">DHT22</li><li id="5087" class="kb kc hh ig b ih kk il kl ip km it kn ix ko jb kg kh ki kj bi translated">ESP8266节点MCU</li><li id="20b4" class="kb kc hh ig b ih kk il kl ip km it kn ix ko jb kg kh ki kj bi translated">微型USB电缆</li></ol><p id="4786" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">接线</strong></p><p id="7273" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，我们用NodeMCU连接DHT22，如下所示:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kp"><img src="../Images/dbaaa825a9c714e68a6a26dc085ed608.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PUnH1_XIChnVbUgtrfZPug.jpeg"/></div></div></figure><p id="1992" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">设置和安装</strong></p><p id="5f3b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我使用Arduino IDE对NodeMCU编程，这是用DHT22启动和运行的最简单的方法。</p><p id="fd37" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">在NodeMCU上传WebSocket服务器的软件安装步骤:</strong></p><ol class=""><li id="fa00" class="kb kc hh ig b ih ii il im ip kd it ke ix kf jb kg kh ki kj bi translated">打开首选项窗口，在“附加Board Manager URLs”中键入以下地址:<a class="ae js" href="http://arduino.esp8266.com/stable/package_esp8266com_index.json" rel="noopener ugc nofollow" target="_blank">http://arduino . esp8266 . com/stable/package _ esp8266 com _ index . JSON</a></li><li id="8c58" class="kb kc hh ig b ih kk il kl ip km it kn ix ko jb kg kh ki kj bi translated">进入工具菜单，根据您使用的型号配置您的主板。<br/>板卡:NodeMCU <br/> CPU频率:80 MHz <br/>上传速度:115200</li></ol><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es kq"><img src="../Images/6362506833aae66419ac4afe5ea53cab.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/1*t0aIdMj_9TlpBH9W04of3Q.png"/></div></figure><ol class=""><li id="a80f" class="kb kc hh ig b ih ii il im ip kd it ke ix kf jb kg kh ki kj bi translated">将NodeMCU连接到计算机并配置端口。使用工具-端口选择设备连接的端口。</li><li id="da03" class="kb kc hh ig b ih kk il kl ip km it kn ix ko jb kg kh ki kj bi translated">安装附加库，草图-&gt;包含库-&gt;管理库为DHT22传感器和WebSocket服务器添加库</li></ol><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kr"><img src="../Images/e5d1e8834cd95c22c25fe73fe043c1c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JcNSP8UeoFnopQL7a-NGOg.png"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ks"><img src="../Images/520bb9f1a852266f24932a2ccb556679.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f_UmdWQHOmXqpGmjJio-xQ.png"/></div></div></figure><p id="af9f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">代码</strong></p><p id="c3cf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦你的机器设置好了，设备配置好了，下一步就是把服务器代码上传到NodeMCU，下面是代码</p><p id="24bd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">I)代码建立串行连接，向计算机发送调试信息</p><p id="2887" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ii)根据给定的SSID和密码连接到WIFI路由器</p><p id="eed4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">iii)连接Wifi后，启动WebSocket连接并连接到分配的IP</p><p id="eeb3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">iV)一旦建立了通道，在来自客户端的每个请求下，服务器发送回从DHT22传感器读取的温度值</p><pre class="jd je jf jg fd kt ku kv kw aw kx bi"><span id="c97c" class="ky kz hh ku b fi la lb l lc ld">#include &lt;Arduino.h&gt;</span><span id="47ed" class="ky kz hh ku b fi le lb l lc ld">#include &lt;ESP8266WiFi.h&gt;<br/>#include &lt;ESP8266WiFiMulti.h&gt;<br/>#include &lt;WebSocketsServer.h&gt;<br/>#include &lt;Hash.h&gt;</span><span id="0318" class="ky kz hh ku b fi le lb l lc ld">#include "DHT.h"</span><span id="ce98" class="ky kz hh ku b fi le lb l lc ld">#define DHTPIN D2     // what digital pin the DHT22 is conected to<br/>#define DHTTYPE DHT22   // there are multiple kinds of DHT sensors</span><span id="f10e" class="ky kz hh ku b fi le lb l lc ld">DHT dht(DHTPIN, DHTTYPE);<br/>const char* SSID     = <strong class="ku hi">"YOUR_WIFI_SSID"</strong>;<br/>const char* PASSWORD = <strong class="ku hi">"YOUR_WIFI_PASSWORD";</strong></span><span id="565b" class="ky kz hh ku b fi le lb l lc ld">ESP8266WiFiMulti WiFiMulti;</span><span id="68f9" class="ky kz hh ku b fi le lb l lc ld">WebSocketsServer webSocket = WebSocketsServer(81);</span><span id="ea61" class="ky kz hh ku b fi le lb l lc ld">void webSocketEvent(uint8_t num, WStype_t type, uint8_t * payload, size_t length) {<br/>    String t = String(dht.readTemperature());    <br/>    <br/>    switch(type) {<br/>        case WStype_DISCONNECTED:<br/>            break;<br/>        case WStype_CONNECTED:<br/>            {<br/>                IPAddress ip = webSocket.remoteIP(num);<br/>                Serial.printf("[%u] Connected from %d.%d.%d.%d url: %s\n", num, ip[0], ip[1], ip[2], ip[3], payload);<br/>            }<br/>            break;<br/>        case WStype_TEXT:<br/>         <br/>              t = String(dht.readTemperature());<br/>              webSocket.sendTXT(num, t);<br/>            <br/>            break;<br/>        case WStype_ERROR:<br/>            break;</span><span id="d6e5" class="ky kz hh ku b fi le lb l lc ld">default:<br/>            break;<br/>    }</span><span id="120a" class="ky kz hh ku b fi le lb l lc ld">}</span><span id="5a22" class="ky kz hh ku b fi le lb l lc ld">void <strong class="ku hi">setup</strong>() {<br/>    Serial.begin(115200);</span><span id="f67d" class="ky kz hh ku b fi le lb l lc ld">for(uint8_t t = 4; t &gt; 0; t--) {<br/>        delay(1000);<br/>    }</span><span id="88f9" class="ky kz hh ku b fi le lb l lc ld">WiFiMulti.addAP(SSID, PASSWORD);</span><span id="aaba" class="ky kz hh ku b fi le lb l lc ld">while(WiFiMulti.run() != WL_CONNECTED) {<br/>        delay(100);<br/>        Serial.println(".");<br/>    }<br/>  Serial.println("");<br/>  Serial.println("WiFi connected");  <br/>  Serial.println("IP address: ");<br/>  Serial.println(WiFi.localIP());</span><span id="07b6" class="ky kz hh ku b fi le lb l lc ld">webSocket.begin();<br/>    webSocket.onEvent(webSocketEvent);<br/>}</span><span id="1dd9" class="ky kz hh ku b fi le lb l lc ld">void <strong class="ku hi">loop</strong>() {<br/>    <br/>    webSocket.loop();<br/>}</span></pre><p id="806e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">上传并测试</strong></p><p id="3eb4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦代码编译成功，我们就上传代码并开始测试。转到工具-串行监视器，我们可以在这里查看日志</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lf"><img src="../Images/47e97655955a38ce8306aabbab1a5c5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cs_Ob1lslB9BkV1XSgqVXg.png"/></div></div></figure><p id="3384" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请注意分配给WebSocketserver的IP地址。我们现在可以用任何简单的WebSocket客户端测试这个服务器，比如<a class="ae js" href="https://chrome.google.com/webstore/detail/simple-websocket-client/pfdhoblngboilpfeibdedpjgfnlcodoo" rel="noopener ugc nofollow" target="_blank"> websocket客户端chrome扩展</a></p><p id="b06c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">输入WebSocket IP地址和端口(81)并发送一个请求包，如果一切设置正确，您将开始获得摄氏温度格式的室温！</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lg"><img src="../Images/e8ce9a0e33c3a77aa4aeb7cc128ec465.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eOXrHDUHHyrOpHQLxDia8Q.png"/></div></div></figure><p id="494d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，通过这一步，我们的WebSocket服务器就可以发送温度数据了。在下一篇博客中，我们将开发一个JET移动温度传感器应用程序。</p><blockquote class="lh li lj"><p id="bec9" class="ie if jt ig b ih ii ij ik il im in io lk iq ir is ll iu iv iw lm iy iz ja jb ha bi translated">本文表达的观点是我个人的观点，不一定代表甲骨文的观点。</p></blockquote></div></div>    
</body>
</html>