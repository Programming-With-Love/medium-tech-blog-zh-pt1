<html>
<head>
<title>Driving user growth with performance improvements</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过性能改进推动用户增长</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/driving-user-growth-with-performance-improvements-cfc50dafadd7?source=collection_archive---------0-----------------------#2017-03-03">https://medium.com/pinterest-engineering/driving-user-growth-with-performance-improvements-cfc50dafadd7?source=collection_archive---------0-----------------------#2017-03-03</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="99f6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">萨姆·梅德、瓦迪姆·安东诺夫和张信哲| Pinterest工程师，成长</p><p id="de66" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2015年初，Pinterest的工程师进行了一项实验，将移动网站主页的登录页面性能提高了60%，移动注册转化率提高了40%。然而，这个实验是一个不成熟的解决方案，它使用了很多快捷方式，比如提供预先呈现的HTML页面，而没有使用任何内部模板呈现引擎或公共资源(JS、CSS)。为了从这个实验中学习生产，整个前端引擎，所有的页面模板和公共元素都必须重写。这是一项巨大的工作，为了实现它，我们需要从构建健壮的度量标准开始，来跟踪我们在服务系统的所有部分的进展。在本帖中，我们将介绍我们如何提高Pinterest页面的性能，以及它如何导致2016年用户获取量的最大增长。</p><h1 id="b0c8" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">尺寸</h1><p id="4669" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">作为第一步，我们需要清楚地定义和实现我们想要改进的指标。2015年实验使用的原始指标是总页面加载时间(PLT)，它被定义为从用户键入URL或点击URL到整个页面被呈现的时间。就<a class="ae kf" href="https://www.w3.org/TR/navigation-timing/" rel="noopener ugc nofollow" target="_blank">浏览器导航计时API而言，【navigationStart和domComplete事件有所不同:</a></p><ul class=""><li id="0296" class="kg kh hh ig b ih ii il im ip ki it kj ix kk jb kl km kn ko bi translated">navigationStart事件由用户在浏览器导航栏中键入URL后单击链接或按enter键来启动。</li><li id="b663" class="kg kh hh ig b ih kp il kq ip kr it ks ix kt jb kl km kn ko bi translated">当页面上的所有处理完成并且所有资源(例如，图像、CSS、JS)下载完成时，将触发domComplete事件。用户将停止看到浏览器选项卡微调器旋转，并且页面上的附加逻辑(例如，onLoad javascript)将在之后执行。</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/8681e8e8875dc364247384a6c979d8d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3zRQo-xzr5RkGJz1."/></div></div><figcaption class="lg lh et er es li lj bd b be z dx">Copyright © 17 December 2012 <a class="ae kf" href="https://www.w3.org/TR/navigation-timing/" rel="noopener ugc nofollow" target="_blank">World Wide Web Consortium</a>, (MIT, ERCIM, Keio, Beihang)</figcaption></figure><p id="cc14" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这个指标是一个好的开始，但是有一个主要的缺点:它不能反映性能。这对用户来说很重要，因为页面的可见部分的加载速度要比整个页面快得多。</p><h2 id="5d93" class="lk jd hh bd je ll lm ln ji lo lp lq jm ip lr ls jq it lt lu ju ix lv lw jy lx bi translated"><strong class="ak">用户感知等待时间</strong></h2><p id="ac83" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">为了解决这个问题，我们引入了另一个指标——用户感知等待时间(UPWT)——它被定义为从用户键入URL或点击URL到用户可见的页面部分被呈现的时间。这是基于图像加载事件的自定义指标。我们跟踪哪些图像在屏幕上，以及它们何时完成加载。UPWT将从navigationStart事件开始，在domLoading和domComplete事件之间的某个位置结束:</p><ul class=""><li id="47e0" class="kg kh hh ig b ih ii il im ip ki it kj ix kk jb kl km kn ko bi translated">当浏览器接收到整个文档并开始呈现它时，触发domLoading事件。</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es ku"><img src="../Images/98cd672e12de38bd02d049df8ae7a093.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Jzbvjl35Qcy7ZULK."/></div></div><figcaption class="lg lh et er es li lj bd b be z dx">Copyright © 17 December 2012 <a class="ae kf" href="https://www.w3.org/TR/navigation-timing/" rel="noopener ugc nofollow" target="_blank">World Wide Web Consortium</a>, (MIT, ERCIM, Keio, Beihang)</figcaption></figure><p id="0a0b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">另一个好处是，可以将类似的指标引入到移动应用程序中，并以相同的方式进行测量。</p><p id="52a3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们已经将这两个指标(总体PLT和UPWT)以及一些额外的性能指标(例如服务器端性能和更详细的浏览器端性能)集成到关键的公司仪表板和我们的实验框架中。这使我们能够跟踪进展，并快速了解哪些改进会带来更大的收益。</p><p id="cfd1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">学习:建立正确的衡量标准来跟踪你的进步，并首先关注有重大影响的变化。</p><h1 id="c808" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">最佳化</h1><p id="64d4" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">优化机会可以分为三大类:前端、网络和后端。</p><h1 id="7bf3" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">前端</h1><h2 id="3944" class="lk jd hh bd je ll lm ln ji lo lp lq jm ip lr ls jq it lt lu ju ix lv lw jy lx bi translated"><strong class="ak">页面权重(CSS/JS/Images/HTML) </strong></h2><p id="160b" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">通过查看综合测试结果，我们很快意识到我们的页面需要大量的带宽来加载。这在一些网络基础设施较旧的国际市场中尤其成问题。为了解决这个问题，我们开始对我们加载的<em class="ly">和</em>内容进行更加细化。在过去，我们经常获取整个网站的CSS和JS。现在，我们只获取渲染文件夹上方内容所需的CSS和JS，然后在初始渲染完成后延迟加载其他资源。我们还查看了哪些图像被请求，着眼于它们是否真的需要，以及我们是否获取了最佳大小。这两项优化共同使显示页面所需的字节数减少了60%。</p><h2 id="edc8" class="lk jd hh bd je ll lm ln ji lo lp lq jm ip lr ls jq it lt lu ju ix lv lw jy lx bi translated">渲染(反应)</h2><p id="1f6a" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">我们对性能的关注与从一个自主开发的框架<a class="ae kf" rel="noopener" href="/@Pinterest_Engineering/how-we-switched-our-template-rendering-engine-to-react-a799a3d540b0#.fvsp43ajw">到<a class="ae kf" rel="noopener" href="/@Pinterest_Engineering/migrating-pinterest-profiles-to-react-479f4f7306aa#.r4ylsm3uc"> React </a>的站点范围</a>迁移相一致。我们的团队是Pinterest中React的早期采用者之一，我们从其渲染模型中实现了显著的性能提升。有了React框架，我们看到了巨大的收益，因为我们从一个不受控制的、任何东西都可以修改的DOM模型，转变为React的影子DOM，批量更新模型。</p><h2 id="cab0" class="lk jd hh bd je ll lm ln ji lo lp lq jm ip lr ls jq it lt lu ju ix lv lw jy lx bi translated">早期刷新/分块传输编码</h2><p id="8953" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">我们通过检查页面如何在服务器端呈现来优化客户端和服务器之间的路径。这消除了不必要的缓冲，确保浏览器尽早接收页面的部分，并可以在获取数据和服务器端呈现的同时开始获取框架级的JS和CSS资源。我们已经在利用分块传输编码在页面完成呈现时发送页面片段，但是对呈现页面的服务和最终用户之间的基础设施的审查发现，我们在几个步骤中缓冲响应，而不是传输响应。消除缓冲加快了浏览器获取字节的速度，并改善了页面加载时间。</p><h1 id="6607" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">运输</h1><p id="243d" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated"><strong class="ig hi"> CDN/DSA <br/> </strong>我们在交通基础设施方面取得了重大进展。我们在CDN设置中引入了多层缓存，支持IPv6，切换到更高的服务层(CDN ),并在全球范围内引入了SSL边缘终端(DSA)。</p><h1 id="663c" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">后端</h1><h2 id="a53b" class="lk jd hh bd je ll lm ln ji lo lp lq jm ip lr ls jq it lt lu ju ix lv lw jy lx bi translated">尽可能并行化</h2><p id="9e8d" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">呈现一个页面通常需要来自不同来源的多条不同的数据。对我们来说，这目前转化为多个API调用。这些调用之间有一个自然的数据依赖关系图，它规定了哪些调用可以并行进行，哪些调用由于这些数据依赖关系而需要按顺序进行。我们正在努力采用GraphQL，它将自动优化数据获取的并行化。与此同时，我们正在审查我们当前的调用图，以确保我们将不必要的顺序调用并行化。</p><h2 id="4172" class="lk jd hh bd je ll lm ln ji lo lp lq jm ip lr ls jq it lt lu ju ix lv lw jy lx bi translated">只归还需要的东西</h2><p id="b2b3" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">我们将我们请求的数据裁剪成UI所需要的。这既节省了网络开销，又消除了服务器端不必要的获取，因为额外的字段通常需要额外调用后端服务。</p><h2 id="5afa" class="lk jd hh bd je ll lm ln ji lo lp lq jm ip lr ls jq it lt lu ju ix lv lw jy lx bi translated">尽可能缓存</h2><p id="48b7" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">我们花了一些时间来扩展低基数页面类型的数据“边缘”缓存(即页面数量在几十万而不是几十亿的数量级)。缓存是我们将要进一步探索的一个领域，从在给定类型的页面太多而无法有效缓存的情况下只缓存“头”页面数据，到在后台触发缓存刷新。</p><h1 id="542f" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">通过性能改进实现增长收益最大化</h1><p id="e9d0" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">当为了性能而重写网页时，重要的是不要尝试新的设计。如果将一个更快、不同的设计页面与原始页面进行比较，就不可能知道转换变化是由于性能改进还是设计改进。构建完全相同的页面。此外，为了全面了解性能对web应用程序的影响，实验应该能够根据页面类型以及web与移动web来划分指标。不同的页面从性能提升中获得不同的转换和流量收益。对我们来说，汇总所有页面显示，整体转化率略有上升，但观察细分市场显示，桌面网络转化率上升了很多，而移动网络转化率实际上下降了，降低了平均转化率。我们调查了移动网站转化率下降的原因，发现了一些功能对等方面的问题。</p><p id="3a57" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了最大限度地提高页面的整体性能，即使是很小的转换功能也要重新实现，这一点非常重要。我们的原始页面有很多这样的功能，随着我们不断发现差异并修复它们，我们的转化率不断上升。这里的重要学习是根据页面类型和web/移动web对页面进行细分，以更好地了解收益来自哪里，并检测任何特定细分的问题。这些问题可能会被掩盖，当看整体合计转换率的变化。</p><h2 id="762b" class="lk jd hh bd je ll lm ln ji lo lp lq jm ip lr ls jq it lt lu ju ix lv lw jy lx bi translated"><strong class="ak">转换功能清单</strong></h2><ul class=""><li id="861d" class="kg kh hh ig b ih ka il kb ip lz it ma ix mb jb kl km kn ko bi translated">相同的追加销售机制</li><li id="18d5" class="kg kh hh ig b ih kp il kq ip kr it ks ix kt jb kl km kn ko bi translated">导航力学(弹出？新标签页？)</li><li id="9791" class="kg kh hh ig b ih kp il kq ip kr it ks ix kt jb kl km kn ko bi translated">注册和表单机制(字段验证消息，相同的字段和步骤)</li><li id="8575" class="kg kh hh ig b ih kp il kq ip kr it ks ix kt jb kl km kn ko bi translated">自动认证功能</li><li id="79c9" class="kg kh hh ig b ih kp il kq ip kr it ks ix kt jb kl km kn ko bi translated">移动网络和平板电脑应用程序应用程序追加销售</li><li id="43f9" class="kg kh hh ig b ih kp il kq ip kr it ks ix kt jb kl km kn ko bi translated">移动网页深度链接</li></ul><p id="9a3f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">关于性能重写的另一件重要事情是对每种页面类型进行SEO实验。关于SEO实验基础的更多信息，请查看我们之前的帖子，<a class="ae kf" rel="noopener" href="/@Pinterest_Engineering/demystifying-seo-with-experiments-a183b325cf4c#.90jqj3q8x">用实验揭开SEO的神秘面纱</a>。SEO实验表明，页面加载时间的改善是否真的会带来更多的搜索引擎流量，在我们的例子中，结果确实如此。如果你的页面是一个高流量的页面，那么很有可能你已经实现了一系列提高搜索引擎排名的功能。一个搜索引擎优化实验也将显示一些功能是否没有正确地重新实现。即使是像图像大小或使用的HTML标签这样的小细节也很重要，因此对所有页面类型进行监控非常重要。对我们来说，花了几个星期的时间来识别和修复差异，让我们的搜索引擎优化流量持平。</p><h2 id="0e8e" class="lk jd hh bd je ll lm ln ji lo lp lq jm ip lr ls jq it lt lu ju ix lv lw jy lx bi translated"><strong class="ak"> SEO功能清单</strong></h2><ul class=""><li id="d30e" class="kg kh hh ig b ih ka il kb ip lz it ma ix mb jb kl km kn ko bi translated">主要标签(如<h1>，hreflang，rel=canonical)</h1></li><li id="b43a" class="kg kh hh ig b ih kp il kq ip kr it ks ix kt jb kl km kn ko bi translated">相同的图像尺寸</li><li id="aaef" class="kg kh hh ig b ih kp il kq ip kr it ks ix kt jb kl km kn ko bi translated">描述性文本</li><li id="b59d" class="kg kh hh ig b ih kp il kq ip kr it ks ix kt jb kl km kn ko bi translated">第一页加载的内容量</li></ul><h2 id="18ee" class="lk jd hh bd je ll lm ln ji lo lp lq jm ip lr ls jq it lt lu ju ix lv lw jy lx bi translated"><strong class="ak">主要学习内容</strong></h2><ul class=""><li id="a31a" class="kg kh hh ig b ih ka il kb ip lz it ma ix mb jb kl km kn ko bi translated">构建一个几乎相同的页面，不要重新设计页面</li><li id="1fe4" class="kg kh hh ig b ih kp il kq ip kr it ks ix kt jb kl km kn ko bi translated">将实验划分为不同的页面类型，并划分web和移动web</li><li id="aa2f" class="kg kh hh ig b ih kp il kq ip kr it ks ix kt jb kl km kn ko bi translated">运行一个搜索引擎优化实验</li><li id="1cfe" class="kg kh hh ig b ih kp il kq ip kr it ks ix kt jb kl km kn ko bi translated">查看每个细分市场，看看是否有任何功能缺失，可能会降低转化率或SEO</li></ul><figure class="kv kw kx ky fd kz er es paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="er es mc"><img src="../Images/3ba77871672b82e98726710f15c0efd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*BdV1tIajPABC_KPs."/></div></div><figcaption class="lg lh et er es li lj bd b be z dx"><em class="md">Fixing a small conversion feature brought one conversion metric to par</em></figcaption></figure><h1 id="6f31" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">结果和未来</h1><p id="6413" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">为提高性能而重建页面的结果是Pinner等待时间减少了40 %, SEO流量增加了15 %,注册转化率增加了15%。因为流量和转换率的增长是成倍的，这是我们在网络和应用注册方面的巨大胜利。2016年，这是我们团队最大的用户获取胜利。此外，网速慢的Pinners获得了明显更好的体验。由于这个项目，该团队现在将性能作为新用户增长的最大机会之一。</p><h2 id="9db8" class="lk jd hh bd je ll lm ln ji lo lp lq jm ip lr ls jq it lt lu ju ix lv lw jy lx bi translated">参考</h2><p id="e156" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">其他Pinterest成长工程博客帖子:</p><p id="65dc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae kf" href="https://engineering.pinterest.com/blog/lessons-growth-engineering-how-we-doubled-sign-ups-pin-landing-pages" rel="noopener ugc nofollow" target="_blank">我们如何将Pin登录页面的注册人数翻倍</a></p><p id="231c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae kf" href="https://engineering.pinterest.com/blog/how-we-increased-active-pinners-one-simple-trick" rel="noopener ugc nofollow" target="_blank">我们如何用一个简单的技巧增加活跃Pinners】</a></p><p id="0a32" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae kf" href="https://engineering.pinterest.com/blog/how-acquire-mobile-users-through-growth-engineering" rel="noopener ugc nofollow" target="_blank">如何通过增长工程获取移动用户</a></p><p id="21c3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae kf" href="https://engineering.pinterest.com/blog/how-holdout-groups-drive-sustainable-growth" rel="noopener ugc nofollow" target="_blank">抵制集团如何推动可持续增长</a></p><p id="9e79" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae kf" href="https://engineering.pinterest.com/blog/demystifying-seo-experiments" rel="noopener ugc nofollow" target="_blank">用实验揭开SEO的神秘面纱</a></p></div></div>    
</body>
</html>