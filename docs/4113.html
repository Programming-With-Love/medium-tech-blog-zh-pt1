<html>
<head>
<title>Angular Universal For The Rest Of Us</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">对我们其他人来说是有角度的宇宙</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/angular-universal-for-the-rest-of-us-922ca8bac84?source=collection_archive---------2-----------------------#2016-11-30">https://medium.com/google-developer-experts/angular-universal-for-the-rest-of-us-922ca8bac84?source=collection_archive---------2-----------------------#2016-11-30</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/c4932cb7b88bec6c5accc8919d80fff3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iwbXNiXDmYgho42qrBIiNQ.png"/></div></div></figure><blockquote class="ip iq ir"><p id="2794" class="is it iu iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">本文已更新，以匹配Angular v4中引入的Angular Universal的重新设计。</p></blockquote><p id="7d74" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">你好，网络开发者，</p><p id="2665" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">让我猜猜:你已经在你的Web项目上工作了几个月，这很可能是一个Web应用程序，更确切地说，是一个“单页应用程序”。但是现在是时候将你的应用程序发布给数百万用户和搜索引擎了。没错。为了让你的应用程序成功，它必须被搜索引擎索引。所以现在你开始怀疑:<em class="iu">该死！我需要添加搜索引擎优化支持！</em></p></div><div class="ab cl ju jv go jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="ha hb hc hd he"><p id="92fc" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">在你的旅程中，你开始意识到这不是一件容易的事情。因为我们都知道为SPA的服务器端渲染支持建立一个完整的管道有多难。但是，嘿，你是一个开发者，你喜欢挑战，对不对？</p><p id="aac2" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">几天后(或几周后？)的尝试和错误，您设法添加了SEO支持。恭喜你！</p><p id="f05a" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">然而，您的用户开始抱怨应用程序的启动时间。老实说，6或10秒显示第一页并不是理想的体验。对吗？我们人类没有耐心。当我访问一个网站时，我需要它几乎立即向我展示我来找的东西；我可以等3秒，但绝对不能等10秒！生命太短暂了，不能等着用旋转器盯着一张空白的纸看10秒钟。</p><p id="f8d0" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">所以现在你还有一个问题要解决，而且这不是一个容易的问题。此外，你的其他用户——网络爬虫——报告说你的应用程序不是“社交媒体友好的”。这意味着，当用户在社交媒体上分享你的应用程序的链接时，你的应用程序生成的预览有点“破碎”:它显示一个空白的预览，或者在最好的情况下，只显示页面的一些部分。这是一个预期的结果，因为在一天结束时，社交媒体后端会生成一个截图，显示当它请求您的应用程序时所呈现的内容。</p><p id="6ffb" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">所以现在你有两个问题要解决。你还是喜欢挑战，对吧？然而，你的项目经理通常会告诉你，时间就是金钱，这些问题必须在昨天解决。？</p><p id="010a" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">如果我告诉你你可以避免这种问题呢？这些正是Angular Universal帮助您解决的任务。如果你用的是Angular，当然。</p><p id="76a6" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">耶！没错。由于官方的通用模块，Angular拥有对服务器端渲染的原生支持。</p><p id="c5ec" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">让我们看看通用，看看它是如何工作的。但最重要的是，如何通用可以帮助你船搜索引擎优化-即时渲染-社会媒体友好的角度应用。</p></div><div class="ab cl ju jv go jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="ha hb hc hd he"><h1 id="5160" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak">什么是普世？</strong></h1><p id="70d5" class="pw-post-body-paragraph is it hh iv b iw kz iy iz ja la jc jd jr lb jg jh js lc jk jl jt ld jo jp jq ha bi translated"><a class="ae le" href="http://universal.angular.io" rel="noopener ugc nofollow" target="_blank">官方网站</a>声明Universal是:<em class="iu">用于Angular应用的服务器端渲染</em>。然而，这是我如何定义角度宇宙的:</p><blockquote class="lf"><p id="83a6" class="lg lh hh bd li lj lk ll lm ln lo jq dx translated"><em class="lp">万能无头网</em>有角。</p></blockquote><p id="e233" class="pw-post-body-paragraph is it hh iv b iw lq iy iz ja lr jc jd jr ls jg jh js lt jk jl jt lu jo jp jq ha bi translated">运行Angular不再需要浏览器容器，也就是WebView。由于它不依赖于DOM，Angular可以在任何有JavaScript运行时的地方运行。</p><blockquote class="ip iq ir"><p id="506f" class="is it iu iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">我可耻地从保罗·金兰那里借用了“无头网络”这个术语。我强烈推荐阅读<a class="ae le" href="https://paul.kinlan.me/the-headless-web/" rel="noopener ugc nofollow" target="_blank">的博客文章</a>，他在文章中给出了他对未来网络的展望。</p></blockquote><h1 id="14fe" class="kb kc hh bd kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku lz kw kx ky bi translated"><strong class="ak">大局</strong></h1><p id="9723" class="pw-post-body-paragraph is it hh iv b iw kz iy iz ja la jc jd jr lb jg jh js lc jk jl jt ld jo jp jq ha bi translated">在使用Universal之前，我们先来看看整体架构。</p><figure class="mb mc md me fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ma"><img src="../Images/59e18db487993ea435fdce99a634cbd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NrMI3w4XyXY4oEDSonhyJw.png"/></div></div><figcaption class="mf mg et er es mh mi bd b be z dx">Angular Universal High Level Architecture</figcaption></figure><p id="dda7" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">这张图展示了Universal在浏览器之外运行典型的Angular Web应用程序的能力。显然，我们需要一个JavaScript运行时，这就是为什么我们默认支持Node.js(由V8引擎驱动)。然而，一些努力已经开始支持其他服务器端技术，如PHP、Java、Python、Go …我很高兴地说，Universal已经在。感谢史蒂夫的工作。</p><p id="5ed3" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">既然您的应用程序可以在浏览器之外进行解释——让我们以服务器为例——请求您的SPA的客户端将收到一个静态的完整呈现的请求路由/URL页面。这个页面包含了所有相关的资源，例如图片、样式表、字体…甚至是来自你的Angular服务的数据。</p><p id="be60" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">事实上，在呈现页面之前，Universal负责处理和获取所有需要的数据——这通常是通过Angular的Http服务获取的。Universal能够重新连接一些默认的Angular提供程序，这样它们就可以在目标平台上工作。还有更多。当客户端收到呈现的页面时，它也会收到原始的Angular应用程序——我们只帮助您的应用程序几乎立即加载。一旦加载完毕，Angular就会处理剩下的事情。</p><p id="3979" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">但是当有角度的bootstraps覆盖在呈现的页面上会发生什么呢？我们不会有什么国家问题吗？或者用户可能在看到呈现的页面后就想使用您的应用程序，这有意义吗？你将如何处理状态？Universal本身如何处理状态？</p><p id="394a" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">我们会保护你…</p><p id="5f9c" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">事实上，Universal附带了Preboot.js库，其唯一的作用是确保两种状态同步。</p><p id="a833" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">Preboot.js在引擎盖下做的是简单而智能地记录Angular bootstraps之前发生的事件；并在Angular完成加载后播放它们。很简单，不是吗？</p><h1 id="92df" class="kb kc hh bd kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku lz kw kx ky bi translated">渲染器</h1><p id="acb0" class="pw-post-body-paragraph is it hh iv b iw kz iy iz ja la jc jd jr lb jg jh js lc jk jl jt ld jo jp jq ha bi translated">由于Angular的渲染抽象，通用成为可能。事实上，当您编写应用程序代码时，Angular的编译器会将该逻辑解析到AST中——我们在这里实际上是在简化事情。然后，这个AST被Angular的呈现层使用，它使用一个与DOM无关的抽象呈现器。Angular允许您使用不同的渲染器。默认情况下，Angular提供了DOMRenderer，因此您的应用程序可以在浏览器中呈现，这可能是95%的用例。</p><p id="a328" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">这就是环球公司的用武之地。Universal为所有主流技术和构建工具提供了一堆<em class="iu">预呈现器</em>。</p><h1 id="df0d" class="kb kc hh bd kd ke lv kg kh ki lw kk kl km lx ko kp kq ly ks kt ku lz kw kx ky bi translated">依赖注入和提供者</h1><p id="46cc" class="pw-post-body-paragraph is it hh iv b iw kz iy iz ja la jc jd jr lb jg jh js lc jk jl jt ld jo jp jq ha bi translated">Angular的另一个亮点是其DI系统。Angular实际上是实现这种设计模式的唯一前端框架，这种设计模式允许轻松完成如此多的伟大任务(参见<a class="ae le" href="https://en.wikipedia.org/wiki/Inversion_of_control" rel="noopener ugc nofollow" target="_blank"> IOC </a>)。由于DI，你可以在运行时交换两个不同的实现，这在测试中经常使用。</p><p id="387a" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">在Universal中，我们利用这个DI系统，为您提供许多特定于目标平台的服务。对于Node，我们提供了一个定制的<strong class="iv hi"> ServerModule </strong>，它实现了Node的特定于服务器的API，比如请求，而不是浏览器的XHR。Universal还附带了一个特定于Node的自定义渲染器，当然，我们为您提供了一堆<em class="iu">预渲染器——我们称之为</em>——例如针对您的Node后端技术的Express渲染器或Webpack渲染器。对于其他非JavaScript技术，比如。NetCore或Java，你也应该期待其他的<em class="iu">预呈现器</em>。</p></div><div class="ab cl ju jv go jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="ha hb hc hd he"><h1 id="aa92" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">你好世界</h1><p id="01bf" class="pw-post-body-paragraph is it hh iv b iw kz iy iz ja la jc jd jr lb jg jh js lc jk jl jt ld jo jp jq ha bi translated">好消息是，通用应用程序与经典的角度应用程序没有什么不同。通常你的应用程序逻辑保持不变。当然，如果你严格遵循Angular的<a class="ae le" href="https://angular.io/styleguide" rel="noopener ugc nofollow" target="_blank">指南和最佳实践</a>，这将是真的。我建议您遵循的最重要的最佳实践之一是:</p><figure class="mb mc md me fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mj"><img src="../Images/2e9727073b0a541d8a2671470de43e3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rwylwy95h2H08WTKQ8IhTw.png"/></div></div></figure><blockquote class="lf"><p id="20ee" class="lg lh hh bd li lj mk ml mm mn mo jq dx translated">只要有可能，请在直接接触DOM之前三思。每次想要与浏览器的DOM交互时，请确保使用角度渲染器或渲染抽象。</p></blockquote><p id="d2c3" class="pw-post-body-paragraph is it hh iv b iw lq iy iz ja lr jc jd jr ls jg jh js lt jk jl jt lu jo jp jq ha bi translated">你需要提供的唯一额外的东西是第二个引导配置。目标平台或后端的配置，例如节点。网络…</p><p id="d391" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">以下是Universal推荐的引导结构:</p><figure class="mb mc md me fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ma"><img src="../Images/e675842c33ce94b20caa9a2f68745b44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-7qL6QFBgJME8fqPDWauCA.png"/></div></div><figcaption class="mf mg et er es mh mi bd b be z dx">Angular Universal Application Structure</figcaption></figure><p id="c4d6" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">让我们解释一下每个文件的作用…</p><p id="8fe8" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated"><strong class="iv hi">应用组件</strong></p><p id="e354" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">这个组件和所有其他的Angular API/特性，如组件模板、指令、服务、管道等保持不变。没什么特别的:</p><pre class="mb mc md me fd mp mq mr ms aw mt bi"><span id="080c" class="mu kc hh mq b fi mv mw l mx my">import { Component } from '@angular/core';</span><span id="6f01" class="mu kc hh mq b fi mz mw l mx my">@Component({<br/>  selector: 'app-root',<br/>  templateUrl: './app.component.html',<br/>  styleUrls: ['./app.component.css']<br/>})<br/>export class AppComponent {<br/>  title = 'app works!';<br/>}</span></pre><p id="6646" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated"><strong class="iv hi"> browser.module.ts </strong></p><p id="a354" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">在本模块中，您应该将所有特定内容放在浏览器环境中:</p><pre class="mb mc md me fd mp mq mr ms aw mt bi"><span id="fd7b" class="mu kc hh mq b fi mv mw l mx my">import { NgModule } from '@angular/core';<br/><strong class="mq hi">import { BrowserModule } from '@angular/platform-browser';</strong><br/>import { AppComponent } from './index';</span><span id="1318" class="mu kc hh mq b fi mz mw l mx my">@NgModule({<br/>  bootstrap: [ AppComponent ],<br/>  declarations: [ AppComponent ],<br/>  imports: [<br/>    <strong class="mq hi">BrowserModule.withServerTransition({appId: 'some-app-id'}),</strong><br/>    ...<br/>  ]<br/>})<br/>export class AppBrowserModule {}</span></pre><p id="7920" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">请注意，您需要使用<a class="ae le" href="https://angular.io/docs/js/latest/api/platform-browser/index/BrowserModule-class.html#!#withServerTransition-anchor" rel="noopener ugc nofollow" target="_blank"> <strong class="iv hi">和</strong> </a>方法初始化<strong class="iv hi">浏览器模块</strong>。这将确保基于浏览器的应用程序将从服务器呈现的应用程序过渡。</p><p id="011b" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated"><strong class="iv hi"> server.module.ts </strong></p><p id="6b35" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">本模块专门针对您的服务器环境。<a class="ae le" href="https://angular.io/docs/js/latest/api/platform-server/index/ServerModule-class.html" rel="noopener ugc nofollow" target="_blank"> <strong class="iv hi"> ServerModule </strong> </a>从<strong class="iv hi">@ angular/platform-server</strong>包中提供了一组提供者。</p><pre class="mb mc md me fd mp mq mr ms aw mt bi"><span id="bae6" class="mu kc hh mq b fi mv mw l mx my">import { NgModule } from '@angular/core';<br/><strong class="mq hi">import { ServerModule } from '@angular/platform-server';<br/>import { AppComponent, AppBrowserModule } from './browser.module';</strong></span><span id="738d" class="mu kc hh mq b fi mz mw l mx my">@NgModule({<br/>  bootstrap: [ AppComponent ],<br/>  declarations: [ AppComponent ],<br/>  imports: [<br/>    <strong class="mq hi">ServerModule,<br/>    AppBrowserModule,<br/></strong>    ...<br/>  ]<br/>})<br/>export class AppServerModule {}</span></pre><blockquote class="ip iq ir"><p id="4c5b" class="is it iu iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">在AppServerModule中，您应该导入<strong class="iv hi"> ServerModule </strong>和<strong class="iv hi"> AppBrowserModule </strong>，以便它们共享同一个<strong class="iv hi"> appId，</strong>AppBrowserModule使用的转换Id。</p></blockquote><p id="2f9f" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated"><strong class="iv hi"> client.ts </strong></p><p id="c5d5" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">这个文件负责在客户端引导您的应用程序。这里没有什么新的，只是通常的引导过程(在<a class="ae le" href="https://slides.com/wassimchegham/demystifying-ahead-of-time-compilation-in-angular-2-aot-jit" rel="noopener ugc nofollow" target="_blank"> AOT模式</a>):</p><pre class="mb mc md me fd mp mq mr ms aw mt bi"><span id="83e7" class="mu kc hh mq b fi mv mw l mx my">import { platformBrowser } from '@angular/platform-browser';<br/>import { AppModuleNgFactory } from './ngfactory/src/app.ngfactory';<br/>import { enableProdMode } from '@angular/core';</span><span id="3427" class="mu kc hh mq b fi mz mw l mx my">enableProdMode();</span><span id="1e96" class="mu kc hh mq b fi mz mw l mx my">platformBrowser().bootstrapModuleFactory(AppModuleNgFactory);</span></pre><p id="d8e3" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated"><strong class="iv hi"> server.ts </strong></p><p id="de60" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">这个文件实际上是针对您的服务器/后端环境的。这里，我们的目标是Node.js，更准确地说是Express框架，负责处理所有客户端请求和呈现过程。为此，我们使用并注册了<strong class="iv hi"> ngExpressEngine </strong>(见下一段)，它代表了Express的角度通用渲染引擎:</p><pre class="mb mc md me fd mp mq mr ms aw mt bi"><span id="f19a" class="mu kc hh mq b fi mv mw l mx my"><strong class="mq hi">import { <br/>  platformServer, <br/>  renderModuleFactory<br/>} from '@angular/platform-server';</strong><br/><strong class="mq hi">import { <br/>  AppServerModuleNgFactory<br/>} from './ngfactory/src/app.server.ngfactory';</strong></span><span id="b6a9" class="mu kc hh mq b fi mz mw l mx my">import { enableProdMode } from '@angular/core';<br/>import { AppServerModule } from './server.module';</span><span id="482f" class="mu kc hh mq b fi mz mw l mx my">import * as express from 'express';<br/><strong class="mq hi">import {ngExpressEngine} from './express-engine';</strong><br/><br/>enableProdMode();<br/><br/>const app = express();<br/><br/><strong class="mq hi">app.engine('html', ngExpressEngine({<br/>  baseUrl: 'http://localhost:4200',<br/>  bootstrap: [AppServerModuleNgFactory]<br/>}));</strong><br/><br/>app.set('view engine', 'html');<br/>app.set('views', 'src')<br/><br/>app.get('/', (req, res) =&gt; {<br/>  res.render('index', {req});<br/>});<br/><br/>app.listen(8200,() =&gt; {<br/>  console.log('listening...')<br/>});</span></pre><p id="3379" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">为Express实现一个简单的渲染器应该是一件容易的事情:</p><pre class="mb mc md me fd mp mq mr ms aw mt bi"><span id="2873" class="mu kc hh mq b fi mv mw l mx my">const fs = require('fs');<br/>const path = require('path');<br/><strong class="mq hi">import {renderModuleFactory} from '@angular/platform-server';</strong><br/><br/>export function ngExpressEngine(setupOptions){<br/>  return function(filePath, options, callback){</span><span id="0682" class="mu kc hh mq b fi mz mw l mx my">    <strong class="mq hi">renderModuleFactory(setupOptions.bootstrap[0], {<br/>      document: fs.readFileSync(filePath).toString(),<br/>      url: options.req.url<br/>    })</strong><br/>    .then(string =&gt; {<br/>      callback(null, string);<br/>    });</span><span id="03e7" class="mu kc hh mq b fi mz mw l mx my">  }<br/>}</span></pre><p id="48e9" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">这里唯一重要的部分是<strong class="iv hi"> renderModuleFactory </strong>方法。这个方法基本上是将Angular应用程序引导到从文档解析的虚拟DOM树中，并将结果DOM状态序列化为字符串，然后传递给Express engine API。</p><p id="262e" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">当然，您可以为这个呈现器添加一些缓存机制，以避免每次请求时都从磁盘读取。这里有一个<em class="iu">幼稚</em>的例子:</p><pre class="mb mc md me fd mp mq mr ms aw mt bi"><span id="4fa3" class="mu kc hh mq b fi mv mw l mx my">const fs = require('fs');<br/>const path = require('path');<br/>import {renderModuleFactory} from '@angular/platform-server';</span><span id="ac0e" class="mu kc hh mq b fi mz mw l mx my"><strong class="mq hi">const cache = new Map();</strong></span><span id="cadc" class="mu kc hh mq b fi mz mw l mx my">export function ngExpressEngine(setupOptions){<br/>  return function(filePath, options, callback){</span><span id="610e" class="mu kc hh mq b fi mz mw l mx my">    <strong class="mq hi">if (!cache.has(filePath)){<br/>      const content  = fs.readFileSync(filePath).toString();<br/>      cache.set(filePath, content);<br/>    }</strong></span><span id="f3ba" class="mu kc hh mq b fi mz mw l mx my">    renderModuleFactory(setupOptions.bootstrap[0], {<br/>      document: <strong class="mq hi">cache.get(filePath)</strong>,<br/>      url: options.req.url<br/>    })<br/>    .then(string =&gt; {<br/>      callback(null, string);<br/>    });</span><span id="7761" class="mu kc hh mq b fi mz mw l mx my">  }<br/>}</span></pre></div><div class="ab cl ju jv go jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="ha hb hc hd he"><p id="bba8" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">因为您完全控制了服务器呈现的内容，所以您可以轻松地添加任何您想要的SEO支持。我们可以想象使用<strong class="iv hi">@ angular/platform-browser</strong>提供的<strong class="iv hi"> Meta </strong>和<strong class="iv hi"> Title </strong>:</p><pre class="mb mc md me fd mp mq mr ms aw mt bi"><span id="9f3a" class="mu kc hh mq b fi mv mw l mx my">import { Component } from '@angular/core';<br/><strong class="mq hi">import { Meta, Title } from "@angular/platform-browser";</strong></span><span id="8a3c" class="mu kc hh mq b fi mz mw l mx my">@Component({<br/>  selector: 'home-view',<br/>  template: `&lt;h3&gt;Home View&lt;/h3&gt;`<br/>})</span><span id="7d1c" class="mu kc hh mq b fi mz mw l mx my">export class HomeView {<br/>  constructor(<strong class="mq hi">seo: Meta, title: Title</strong>) {<br/>    <strong class="mq hi">title.setTitle('Current Title Page');</strong><br/>    <strong class="mq hi">seo.addTags([<br/>      {name: 'author', content: 'Wassim Chegham'},<br/>      {name: 'keywords', content: 'angular,universal,iot,omega2+'},<br/>      {<br/>        name: 'description', <br/>        content: 'Angular Universal running on Omega2+'<br/>      }<br/>    ]);</strong><br/>  }<br/>}</span></pre><figure class="mb mc md me fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es na"><img src="../Images/2b35b6794fb5d02a1587c371dbaa4a47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mpwwiqKRHMnyFCq43OA9VQ.png"/></div></div><figcaption class="mf mg et er es mh mi bd b be z dx">Meta and Title built-in services in action</figcaption></figure><p id="ffa4" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">你还可以添加任何其他的<a class="ae le" href="https://moz.com/blog/meta-data-templates-123" rel="noopener ugc nofollow" target="_blank">社交媒体标签</a>甚至<a class="ae le" href="http://ogp.me/" rel="noopener ugc nofollow" target="_blank">开放图标签</a>。</p><p id="bad7" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">当然，该信息可以来自任何数据源，例如API，并存储在模型中，例如:</p><pre class="mb mc md me fd mp mq mr ms aw mt bi"><span id="1bdd" class="mu kc hh mq b fi mv mw l mx my">// SEO model<br/>export class SEO {<br/>    public title: string = '';<br/>    public canonical: string = '';<br/>    public robots: string = '';<br/>    public description: string = '';<br/>    public keywords: string = '';<br/>}</span></pre><p id="d0cd" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">所以现在，你可能想知道:<em class="iu">哦！好家伙，那是许多样板文件！嗯，我们会帮你的。让我们来谈谈工具…</em></p></div><div class="ab cl ju jv go jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="ha hb hc hd he"><h1 id="a860" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">工具作业</h1><p id="0dee" class="pw-post-body-paragraph is it hh iv b iw kz iy iz ja la jc jd jr lb jg jh js lc jk jl jt ld jo jp jq ha bi translated">Angular Universal CLI支持目前是Angular CLI的一个分支<a class="ae le" href="https://github.com/devCrossNet/angular-cli" rel="noopener ugc nofollow" target="_blank">这里是</a>，但有望很快集成到常规CLI中..但在那之前，你可以通过使用官方的<a class="ae le" href="https://github.com/angular/universal-starter" rel="noopener ugc nofollow" target="_blank"> Angular Universal Starter </a>，快速轻松地开始使用Angular Universal，它是由我的好友<a class="ae le" rel="noopener" href="/@gdi2290"> PatrickJs </a>创建的。如果你是. Net开发者，请查看我的兄弟Mark Pieszak的另一个入门教程。</p></div><div class="ab cl ju jv go jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="ha hb hc hd he"><h1 id="22e0" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">就是这样</h1><p id="8fa8" class="pw-post-body-paragraph is it hh iv b iw kz iy iz ja la jc jd jr lb jg jh js lc jk jl jt ld jo jp jq ha bi translated">亲爱的Web开发人员，您现在已经有了开始使用Angular Universal的所有必要信息，并使您的下一个Angular应用程序更具性能和SEO友好，等等…</p><p id="ee7a" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">不要忘了给杰夫·惠普利和帕特里克·琼斯以及所有环球项目的贡献者T21一个大大的欢呼，感谢他们制作了角形环球摇滚！</p><blockquote class="ip iq ir"><p id="d882" class="is it iu iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">编辑:别误会，Universal不仅仅是服务器端渲染或者SEO。当您需要在浏览器之外运行应用程序时，它为您提供了更多的功能。我们将在另一篇博文中讨论这个问题。</p></blockquote></div><div class="ab cl ju jv go jw" role="separator"><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz ka"/><span class="jx bw bk jy jz"/></div><div class="ha hb hc hd he"><p id="8169" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated"><em class="iu">关注</em><a class="ae le" href="https://twitter.com/manekinekko" rel="noopener ugc nofollow" target="_blank"><em class="iu">@ manekinekko</em></a><em class="iu">了解更多关于web平台的信息。</em></p></div></div>    
</body>
</html>