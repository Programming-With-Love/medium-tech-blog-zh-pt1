<html>
<head>
<title>iOS Test Automation @WalmartLabs</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">iOS测试自动化@WalmartLabs</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/ios-test-automation-walmartlabs-d8668d85a27?source=collection_archive---------3-----------------------#2017-02-10">https://medium.com/walmartglobaltech/ios-test-automation-walmartlabs-d8668d85a27?source=collection_archive---------3-----------------------#2017-02-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/7c62b418796e15d791a343a098157c67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HAjCNjicWo11YsDZh3fBYw.jpeg"/></div></div></figure><div class=""/><p id="7f00" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在文章中，<a class="ae jn" rel="noopener" href="/walmartlabs/elements-of-successful-massive-scale-automated-testing-f071c17f2907#.y4qn9hf9q"> <em class="jo">成功大规模自动化测试的要素</em> </a>，UI自动化测试在总体上已经被概括为<strong class="ir ht"> <em class="jo">只是普通的</em> </strong>，而对于移动来说更是如此<strong class="ir ht"><em class="jo"/></strong>。</p><p id="ab3f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然而，这篇文章也展示了WalmartLabs的测试自动化过程策略:<strong class="ir ht">大规模并行</strong>、<strong class="ir ht">早期测试</strong>和<strong class="ir ht">确定性行为。</strong>在本文中，我们将进一步了解沃尔玛iOS测试自动化如何努力实现这三个基本功能，并作为一个<strong class="ir ht">快速反馈系统</strong>提供给开发人员。</p><h2 id="d286" class="jp jq hs bd jr js jt ju jv jw jx jy jz ja ka kb kc je kd ke kf ji kg kh ki kj bi translated">大局</h2><p id="1f26" class="pw-post-body-paragraph ip iq hs ir b is kk iu iv iw kl iy iz ja km jc jd je kn jg jh ji ko jk jl jm ha bi translated">沃尔玛的iOS应用程序被模块化为不同的组件:搜索和浏览、购物车、药房、商店等。，由不同的团队开发，采用不同的技术堆栈。这里我们将以<a class="ae jn" rel="noopener" href="/walmartlabs/react-native-at-walmartlabs-cdd140589560#.q1yzcqyoh"> <strong class="ir ht"> React Native </strong> </a>中编写的Cart组件为例。</p><p id="2082" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们在WalmartLabs内提供的iOS自动化测试解决方案基于<a class="ae jn" href="http://appium.io" rel="noopener ugc nofollow" target="_blank"> <strong class="ir ht"> Appium </strong> </a>及其Javascript客户端。测试用例用Node.js编写，用<a class="ae jn" href="http://mochajs.org" rel="noopener ugc nofollow" target="_blank"> Mocha </a>运行。我们选择Javascript绑定解决方案不仅是因为Cart组件中的React本地技术堆栈选择，而且我们还希望与Node.js中的Web前端自动化测试解决方案保持一致，并利用由<a class="ae jn" href="http://testarmada.io/" rel="noopener ugc nofollow" target="_blank"> TestArmada </a>提供的工具链，我们将在下面看到。</p><p id="13cc" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">对于测试执行，我们使用基于云的平台，这样我们就可以免除所有虚拟机和不同版本的iOS模拟器的维护。</p><h2 id="1937" class="jp jq hs bd jr js jt ju jv jw jx jy jz ja ka kb kc je kd ke kf ji kg kh ki kj bi translated">从慢到平行</h2><p id="1a41" class="pw-post-body-paragraph ip iq hs ir b is kk iu iv iw kl iy iz ja km jc jd je kn jg jh ji ko jk jl jm ha bi translated">乍一看，串行运行移动自动化测试与并行运行相比如何？</p><figure class="kq kr ks kt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es kp"><img src="../Images/43ee40272440dc328ffe4f04d4b63a89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SbWc7OsaDXZCg_nOLFpN2g.jpeg"/></div></div></figure><p id="c49d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">让我们仔细看看React Native Cart团队的当前CI作业构建日志示例:</p><figure class="kq kr ks kt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ku"><img src="../Images/43561db0f060dc7ec1afa8d2d2f898cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2oC7NGVI9DEXa6UkGudg_g.jpeg"/></div></div><figcaption class="kv kw et er es kx ky bd b be z dx">CI Job build log</figcaption></figure><p id="da2e" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">此CI构建中有6个步骤由拉请求触发:</p><ol class=""><li id="1aec" class="kz la hs ir b is it iw ix ja lb je lc ji ld jm le lf lg lh bi translated">npm软件包安装</li><li id="0fd3" class="kz la hs ir b is li iw lj ja lk je ll ji lm jm le lf lg lh bi translated">代码林挺</li><li id="7cef" class="kz la hs ir b is li iw lj ja lk je ll ji lm jm le lf lg lh bi translated">单元测试</li><li id="5d55" class="kz la hs ir b is li iw lj ja lk je ll ji lm jm le lf lg lh bi translated">创建React本机包</li><li id="77b9" class="kz la hs ir b is li iw lj ja lk je ll ji lm jm le lf lg lh bi translated">将其复制到应用程序中</li></ol><p id="0ed7" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最后一步是在Sauce Labs的虚拟机 中远程并行执行<strong class="ir ht"> <em class="jo">所有84个UI自动化测试，包括:</em></strong></p><ul class=""><li id="3e7a" class="kz la hs ir b is it iw ix ja lb je lc ji ld jm ln lf lg lh bi translated">压缩应用程序包，并将其上传到远程云</li><li id="f196" class="kz la hs ir b is li iw lj ja lk je ll ji lm jm ln lf lg lh bi translated">等待云中的虚拟机启动，并启动指定iOS版本的模拟器</li><li id="42a5" class="kz la hs ir b is li iw lj ja lk je ll ji lm jm ln lf lg lh bi translated">将上传的包安装到模拟器</li><li id="c588" class="kz la hs ir b is li iw lj ja lk je ll ji lm jm ln lf lg lh bi translated">在3次自动失败重试的同时开始测试执行</li></ul><p id="5136" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">需要多长时间？在<strong class="ir ht">麦哲伦</strong>的帮助下，按照<strong class="ir ht"> 10分钟</strong>的顺序:</p><figure class="kq kr ks kt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lo"><img src="../Images/b45bd5a451f72b6a91c4852720c175cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MlFi-hj8i7tlqB8k8C-DkA.png"/></div></div><figcaption class="kv kw et er es kx ky bd b be z dx">Test result analytics dashboard</figcaption></figure><p id="aa82" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Magellan旋转84个并行的工人(进程)，这使得所有的测试用例同时运行。随着开发人员继续添加更多的测试覆盖，我们密切监控测试结果分析仪表板(这是与Magellan集成的另一个TestArmarda工具，名为<a class="ae jn" href="https://github.com/TestArmada/bloop" rel="noopener ugc nofollow" target="_blank"> <strong class="ir ht"> Bloop </strong> </a>),并及时调整Magellan并行工作人员数量和CI结构。</p><h2 id="9f61" class="jp jq hs bd jr js jt ju jv jw jx jy jz ja ka kb kc je kd ke kf ji kg kh ki kj bi translated">从古怪到确定的行为</h2><p id="eb31" class="pw-post-body-paragraph ip iq hs ir b is kk iu iv iw kl iy iz ja km jc jd je kn jg jh ji ko jk jl jm ha bi translated">这可能是移动世界中最棘手的部分。尤其是对于与如此多不同种类的后端服务交互的应用程序。精心设计的确定性测试场景是不够的。自动重试也不理想或不够。服务剥落仍然像一个幽灵，它将继续困扰测试，除非你用<strong class="ir ht">嘲弄</strong>来消除它们。</p><p id="2107" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们使用<strong class="ir ht"> Shifu </strong>，一个WalmartLabs自己开发的模仿解决方案来实现这一点。简单地说，它用预先记录的虚拟数据启动一个模拟服务器来代替真正的服务。棘手的部分在于两个部分:</p><ul class=""><li id="b27a" class="kz la hs ir b is it iw ix ja lb je lc ji ld jm ln lf lg lh bi translated">请记住，我们使用麦哲伦并行执行所有测试。对于不同的测试用例，如何并行地将不同的响应路由到同一个后端服务URL？例如，测试A需要购物车中有6种不同的商品，而测试B需要空购物车。他们同时点击get cart后端服务，但显然他们需要接收不同的模拟响应来填充购物车。目前，我们在不同的端口为每个测试启动一个Shifu模拟服务器。幸运的是Magellan有这样一个<a class="ae jn" href="https://github.com/TestArmada/magellan#features" rel="noopener ugc nofollow" target="_blank">网络端口管理特性</a>来帮助轻松地为每个并行进程分配mock端口。</li><li id="4935" class="kz la hs ir b is li iw lj ja lk je ll ji lm jm ln lf lg lh bi translated">如何告诉移动应用程序使用分配的端口而不是真实的服务来访问模拟服务器？在simulator中启动应用程序时，我们可以传入进程参数。例如:<code class="du lp lq lr ls b">-mockingUrl=localhost:13000</code>，它从<a class="ae jn" href="https://developer.apple.com/reference/foundation/userdefaults" rel="noopener ugc nofollow" target="_blank"> NSUserDefaults类</a>保存到一个对象中，在这里我们告诉应用程序使用这个值，而不是真正的服务来调用特定的后端服务。</li></ul><blockquote class="lt lu lv"><p id="1e9f" class="ip iq jo ir b is it iu iv iw ix iy iz lw jb jc jd lx jf jg jh ly jj jk jl jm ha bi translated"><em class="hs">我们将深入探讨</em>系列<em class="hs">在沃尔玛实验室使用的嘲笑技巧。敬请关注。</em></p></blockquote><h2 id="2c4a" class="jp jq hs bd jr js jt ju jv jw jx jy jz ja ka kb kc je kd ke kf ji kg kh ki kj bi translated"><strong class="ak">从混沌到早期测试</strong></h2><figure class="kq kr ks kt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lz"><img src="../Images/e7ba438d85c2421e447eebd29d10d636.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2oHIbqfx5YqWXCtR1i6vBQ.jpeg"/></div></div><figcaption class="kv kw et er es kx ky bd b be z dx">CI build sample screenshot</figcaption></figure><p id="b522" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">React Native Cart团队已经对每一个拉请求进行了UI自动化测试，这为开发人员提供了非常早期的反馈以及<strong class="ir ht">信心</strong>。另外，所有的测试都是由开发人员自己编写的，他们对测试覆盖范围有完全的控制权，并且能够非常迅速地对测试失败做出反应。</p><h2 id="5904" class="jp jq hs bd jr js jt ju jv jw jx jy jz ja ka kb kc je kd ke kf ji kg kh ki kj bi translated">测试结果反馈</h2><p id="14f8" class="pw-post-body-paragraph ip iq hs ir b is kk iu iv iw kl iy iz ja km jc jd je kn jg jh ji ko jk jl jm ha bi translated">为了向开发人员展示测试结果，我们使用了TestArmada提供的另一个开源工具<a class="ae jn" href="https://github.com/TestArmada/admiral" rel="noopener ugc nofollow" target="_blank"><strong class="ir ht">Admiral</strong></a>dashboard。</p><p id="c2c4" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">下面的屏幕截图是React本机购物车项目的概述页面。它显示了每个PR验证的测试结果的大图:</p><figure class="kq kr ks kt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ma"><img src="../Images/db1121f8b45907679b026c5ceab2e7ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tcxgtxd_ahgNF5u_SRM5uA.png"/></div></div><figcaption class="kv kw et er es kx ky bd b be z dx">PR test result overview page</figcaption></figure><p id="9806" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您点击概览页面中的任何PR链接，您将会找到这个PR验证的所有测试案例结果:</p><figure class="kq kr ks kt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mb"><img src="../Images/67462a60cd46df536d9c26b64a371aa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xEYOB8EsYKW8Asy4gAv3Vg.png"/></div></div><figcaption class="kv kw et er es kx ky bd b be z dx">Test result details page</figcaption></figure><p id="c0f5" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">此外，如果您单击任何一个测试结果，您将看到该测试运行的详细信息，包括CI环境信息。由于Admiral能够嵌入Sauce Labs测试结果链接，因此可以看到Appium命令和日志等信息，甚至可以看到单个UI测试的截屏回放:</p><figure class="kq kr ks kt fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mc"><img src="../Images/e24cedd0ff851150ecff5c723f451665.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NIYEzWGkFfJFuSkWUGTpVg.jpeg"/></div></div><figcaption class="kv kw et er es kx ky bd b be z dx">Single test result page</figcaption></figure><p id="7b5a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">正如我们所看到的，Admiral仪表板为每个需要不同级别测试结果信息的人提供了一个多功能的地方。对于任何测试失败，所有的调试信息都包括在内。大多数人直接去看回放，看看测试实际是怎么失败的。</p><h2 id="e0c3" class="jp jq hs bd jr js jt ju jv jw jx jy jz ja ka kb kc je kd ke kf ji kg kh ki kj bi translated">摘要</h2><p id="7724" class="pw-post-body-paragraph ip iq hs ir b is kk iu iv iw kl iy iz ja km jc jd je kn jg jh ji ko jk jl jm ha bi translated">在WalmartLabs，iOS自动化UI测试:</p><ul class=""><li id="564f" class="kz la hs ir b is it iw ix ja lb je lc ji ld jm ln lf lg lh bi translated">使用<strong class="ir ht"> Magellan </strong>和基于云的解决方案实现大规模并行。</li><li id="5635" class="kz la hs ir b is li iw lj ja lk je ll ji lm jm ln lf lg lh bi translated">使用<strong class="ir ht">师傅</strong>嘲讽实现确定性行为。</li><li id="ec1f" class="kz la hs ir b is li iw lj ja lk je ll ji lm jm ln lf lg lh bi translated">它被提升为<strong class="ir ht">拉请求拦截器</strong>，以提供早期测试结果反馈。</li><li id="cdb5" class="kz la hs ir b is li iw lj ja lk je ll ji lm jm ln lf lg lh bi translated">测试结果和所有相关信息显示在<strong class="ir ht">上将</strong>仪表板上。</li><li id="9ffa" class="kz la hs ir b is li iw lj ja lk je ll ji lm jm ln lf lg lh bi translated">可以从分析仪表板<strong class="ir ht"> Bloop </strong>中分析测试用例执行统计数据，以进一步提高效率。</li></ul><h2 id="da1e" class="jp jq hs bd jr js jt ju jv jw jx jy jz ja ka kb kc je kd ke kf ji kg kh ki kj bi translated">下一步是什么</h2><p id="4ae9" class="pw-post-body-paragraph ip iq hs ir b is kk iu iv iw kl iy iz ja km jc jd je kn jg jh ji ko jk jl jm ha bi translated">对于React Native团队来说，不应该有任何阻碍来采用相同的Appium测试来测试Android UI。我们正在研究在Sauce Labs模拟器中远程并行运行Android自动化测试和iOS测试。</p><p id="4cd6" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们相信，通过改进的UI元素定位器策略，仍然有从每次测试运行中挤出时间的空间。</p><p id="cbe5" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们希望鼓励其他移动应用租户也采用同样的方法。</p><p id="0d3c" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们正在将同样的策略应用到即将到来的真实设备群测试中。</p></div></div>    
</body>
</html>