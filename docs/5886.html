<html>
<head>
<title>Stream a Pi Camera to Oracle Cloud Part Deux</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Pi摄像机流式传输到Oracle Cloud Part Deux</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/stream-a-pi-camera-to-oracle-cloud-part-ii-7ded4258b117?source=collection_archive---------1-----------------------#2022-03-04">https://medium.com/oracledevs/stream-a-pi-camera-to-oracle-cloud-part-ii-7ded4258b117?source=collection_archive---------1-----------------------#2022-03-04</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="a053" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">克里斯本森</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/11840ee70ce509588e955e0083cbeb72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_hbi6A97Cx96yDysH3ZXsw.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Photo by Photography Maghradze PH from Pexels</figcaption></figure><p id="3913" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你愿意，你可以在GitHub <a class="ae jc" href="https://github.com/chrisbensen/chris-blogs/blob/main/HowTo/PiCamera2/PiCamera2.md" rel="noopener ugc nofollow" target="_blank">这里</a>阅读这篇博文。</p><p id="f0de" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上一次在<a class="ae jc" href="https://chrisbensen.medium.com/stream-a-pi-camera-to-oracle-cloud-6328653c60af" rel="noopener">将一台Pi摄像机流式传输到Oracle Cloud </a>第一部分中，我向您展示了如何使用新的Pi摄像机系统将一台覆盆子Pi摄像机和一台V2 Pi摄像机流式传输到Oracle Cloud。该条按逐步的方向加以简化。我也解释了很多问题的Pi相机系统面临的，因为有很多问题，我没有看到他们概述在一个地方。最后，当我们将软件、硬件、操作系统和bug中的所有这些排列相加时，情况就会变得非常复杂。我希望您在本系列文章之后能够提供一些已经过测试和验证的示例，以便您可以将它们用于自己的项目。</p><p id="ea34" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们来看看传统的Pi相机。这是一个传统，但仍然有效(就目前而言)。但重要的是，我在撰写本文时解释了一些差异:</p><ul class=""><li id="fd05" class="jt ju hh ig b ih ii il im ip jv it jw ix jx jb jy jz ka kb bi translated">传统相机目前(巴斯特和靶心)的工作原理是Pi零，Pi 3和Pi 4。</li><li id="7221" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">我还没有测试过Pi零。</li><li id="c2a1" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">使用新的相机系统无法启动从Pi到外部服务器的流。</li><li id="1ece" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">新的相机系统无法从Python或OpenCV访问。</li><li id="7936" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">我没有测试所有Pi上的所有排列或组合。</li><li id="684d" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">我有更好的运气与运动-JPEG时，流整个整个堆栈(Pi -&gt;网络服务器-&gt;网络浏览器)。</li><li id="42d8" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated">在未来的文章中，我希望有一个完整的堆栈H264的例子。</li></ul><h2 id="b688" class="kh ki hh bd kj kk kl km kn ko kp kq kr ip ks kt ku it kv kw kx ix ky kz la lb bi translated">证明文件</h2><p id="b0f6" class="pw-post-body-paragraph ie if hh ig b ih lc ij ik il ld in io ip le ir is it lf iv iw ix lg iz ja jb ha bi translated">以下是我能找到的最好的相机文档:</p><ul class=""><li id="6671" class="jt ju hh ig b ih ii il im ip jv it jw ix jx jb jy jz ka kb bi translated"><a class="ae jc" href="https://buildmedia.readthedocs.org/media/pdf/picamera/latest/picamera.pdf" rel="noopener ugc nofollow" target="_blank">最新Pi相机文档</a></li><li id="3e15" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated"><a class="ae jc" href="https://picamera.readthedocs.io/en/release-1.10/api_camera.html" rel="noopener ugc nofollow" target="_blank">相机API </a></li><li id="ecef" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb jy jz ka kb bi translated"><a class="ae jc" href="https://www.codeinsideout.com/blog/pi/stream-picamera-mjpeg/" rel="noopener ugc nofollow" target="_blank">流运动-jpg</a></li></ul><h2 id="233b" class="kh ki hh bd kj kk kl km kn ko kp kq kr ip ks kt ku it kv kw kx ix ky kz la lb bi translated">先决条件</h2><ol class=""><li id="662a" class="jt ju hh ig b ih lc il ld ip lh it li ix lj jb lk jz ka kb bi translated">你有一个OCI账户。</li><li id="b961" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb lk jz ka kb bi translated">您已经创建了一个<a class="ae jc" href="https://chrisbensen.medium.com/create-an-oci-compute-instance-493d10e2e6a6" rel="noopener">计算实例</a>。</li><li id="fb42" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb lk jz ka kb bi translated">您已将计算机上的<a class="ae jc" href="https://chrisbensen.medium.com/white-list-your-ip-address-to-security-connect-to-an-oci-compute-instance-4fb99958f0d9" rel="noopener">ssh</a>锁定为仅适用于您的计算机。</li><li id="ac6d" class="jt ju hh ig b ih kc il kd ip ke it kf ix kg jb lk jz ka kb bi translated">您已经将<a class="ae jc" rel="noopener" href="/@chrisbensen/create-a-simple-python-web-server-on-oci-1d3634a1d7c2"> Compute实例设置为web服务器</a>。</li></ol><p id="a7fd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">点击了解更多关于<a class="ae jc" href="https://docs.oracle.com/en-us/iaas/Content/Compute/home.htm?source=:ex:tb:::::RC_WWMK220210P00062:Medium_CBensen&amp;SC=:ex:tb:::::RC_WWMK220210P00062:Medium_CBensen&amp;pcode=WWMK220210P00062" rel="noopener ugc nofollow" target="_blank">计算</a>和其他<a class="ae jc" href="https://docs.oracle.com/en-us/iaas/Content/GSG/Concepts/baremetalintro.htm?source=:ex:tb:::::RC_WWMK220210P00062:Medium_CBensen&amp;SC=:ex:tb:::::RC_WWMK220210P00062:Medium_CBensen&amp;pcode=WWMK220210P00062" rel="noopener ugc nofollow" target="_blank">甲骨文云文档</a> <a class="ae jc" href="https://docs.oracle.com/en-us/iaas/Content/GSG/Concepts/baremetalintro.htm?source=:ex:tb:::::RC_WWMK220210P00062:Medium_CBensen&amp;SC=:ex:tb:::::RC_WWMK220210P00062:Medium_CBensen&amp;pcode=WWMK220210P00062" rel="noopener ugc nofollow" target="_blank">。要获得交互式支持和社区，请查看甲骨文面向开发者的公共</a><a class="ae jc" href="https://oracledevrel.slack.com/join/shared_invite/zt-uffjmwh3-ksmv2ii9YxSkc6IpbokL1g#/shared-invite/email" rel="noopener ugc nofollow" target="_blank"> Slack频道</a>。</p><h2 id="1edc" class="kh ki hh bd kj kk kl km kn ko kp kq kr ip ks kt ku it kv kw kx ix ky kz la lb bi translated">将Pi摄像机流式传输到Oracle Cloud并从Web服务器提供服务的示例</h2><p id="87a6" class="pw-post-body-paragraph ie if hh ig b ih lc ij ik il ld in io ip le ir is it lf iv iw ix lg iz ja jb ha bi translated">我在互联网上找到的少数几个实际可行的例子之一是这个<a class="ae jc" href="http://picamera.readthedocs.io/en/latest/recipes2.html#web-streaming" rel="noopener ugc nofollow" target="_blank">例子</a>。它在Pi上有一个网络服务器，只要在你网络上的任何一台计算机上访问这个网络服务器，你就可以看到摄像机看到的东西。我举了这个例子，并把它分成两部分:一个运行在Pi上的Python应用程序，它把视频从摄像机传输到一个IP地址。服务器接收该流并托管一个web服务器。由于web服务器托管在Oracle Cloud上，您拥有一个公共IP地址，因此在世界任何地方都可以看到您的Pi摄像机！</p><p id="6f4a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要开始，你需要上述先决条件。</p><p id="3003" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意，这个例子只是一个例子。它不处理所有错误情况或重新连接情况。一旦服务器或客户端终止，都必须重新启动。这很不幸，但是通过不添加所有的代码，您可以看到实现这一点所需的核心代码。</p><h2 id="d014" class="kh ki hh bd kj kk kl km kn ko kp kq kr ip ks kt ku it kv kw kx ix ky kz la lb bi translated">云设置</h2><p id="1103" class="pw-post-body-paragraph ie if hh ig b ih lc ij ik il ld in io ip le ir is it lf iv iw ix lg iz ja jb ha bi translated">1.此时，您有一个为web服务器公开端口80的计算实例。我们还需要打开端口8100来接收摄像机流。按照步骤<a class="ae jc" rel="noopener" href="/@chrisbensen/create-a-simple-python-web-server-on-oci-1d3634a1d7c2">将端口<code class="du ll lm ln lo b">8100</code>添加到安全列表:</a></p><p id="b615" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.然后运行以下命令打开端口8100:</p><p id="2425" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du ll lm ln lo b">sudo firewall-cmd — permanent — zone=public — add-port=8100/tcp<br/> sudo firewall-cmd — permanent — zone=public — add-port=8100/udp<br/> sudo firewall-cmd — reload</code></p><p id="1671" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3.将` ` vidserver.py `'复制到您的计算实例:</p><p id="36e7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du ll lm ln lo b">scp vidserver.py pi@&lt;PI IP Address&gt;:/home/pi</code></p><p id="6224" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">4.运行视频网络服务器:</p><p id="a951" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du ll lm ln lo b">sudo python3 vidserver.py</code></p><p id="bed6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">web服务器将一直等待，直到流被连接。</p><p id="9a82" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jc" href="https://github.com/chrisbensen/chris-blogs/blob/main/HowTo/PiCamera2/files/vidserver.py" rel="noopener ugc nofollow" target="_blank"> camserver.py </a>:</p><pre class="je jf jg jh fd lp lo lq lr aw ls bi"><span id="a8c8" class="kh ki hh lo b fi lt lu l lv lw">import logging<br/>import socketserver<br/>from http import server<br/>import socket<br/>import struct</span><span id="a3bf" class="kh ki hh lo b fi lx lu l lv lw">PAGE=”””\<br/>&lt;html&gt;<br/>&lt;head&gt;<br/>&lt;title&gt;Raspberry Pi — Surveillance Camera&lt;/title&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>&lt;center&gt;&lt;h1&gt;Raspberry Pi — Surveillance Camera&lt;/h1&gt;&lt;/center&gt;<br/>&lt;center&gt;&lt;img src=”stream.mjpg” width=”640" height=”480"&gt;&lt;/center&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;<br/>“””</span><span id="0de7" class="kh ki hh lo b fi lx lu l lv lw">serverSocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br/>serverSocket.bind((“”, 8100))<br/>serverSocket.listen()</span><span id="3bc2" class="kh ki hh lo b fi lx lu l lv lw">(clientConnected, clientAddress) = serverSocket.accept()<br/>print(“Accepted a connection request from %s:%s”%(clientAddress[0], clientAddress[1]))</span><span id="0e25" class="kh ki hh lo b fi lx lu l lv lw">def receiveMessage(connection):<br/> result = None<br/> # Message: [4 byte message length][variable message]<br/> lengthOfStruct = internalReceiveMessage(connection, 4)</span><span id="2454" class="kh ki hh lo b fi lx lu l lv lw">if lengthOfStruct:<br/> messageLength = struct.unpack(‘&gt;I’, lengthOfStruct)[0]<br/> result = internalReceiveMessage(connection, messageLength)</span><span id="f296" class="kh ki hh lo b fi lx lu l lv lw">return result</span><span id="8193" class="kh ki hh lo b fi lx lu l lv lw">def internalReceiveMessage(connection, length):<br/> # Internal function to receive a specific length number of bytes.<br/> # Returns the received data or returns None if EOF is encountered.<br/> result = bytearray()</span><span id="24b7" class="kh ki hh lo b fi lx lu l lv lw">while len(result) &lt; length:<br/> packet = connection.recv(length — len(result))</span><span id="8e89" class="kh ki hh lo b fi lx lu l lv lw">if not packet:<br/> result = None<br/> break</span><span id="1d02" class="kh ki hh lo b fi lx lu l lv lw">result.extend(packet)</span><span id="37e2" class="kh ki hh lo b fi lx lu l lv lw">return result</span><span id="dca4" class="kh ki hh lo b fi lx lu l lv lw">class StreamingHandler(server.BaseHTTPRequestHandler):<br/> def do_GET(self):<br/> if self.path == ‘/’:<br/> self.send_response(301)<br/> self.send_header(‘Location’, ‘/index.html’)<br/> self.end_headers()<br/> elif self.path == ‘/index.html’:<br/> content = PAGE.encode(‘utf-8’)<br/> self.send_response(200)<br/> self.send_header(‘Content-Type’, ‘text/html’)<br/> self.send_header(‘Content-Length’, len(content))<br/> self.end_headers()<br/> self.wfile.write(content)<br/> elif self.path == ‘/stream.mjpg’:<br/> self.send_response(200)<br/> self.send_header(‘Age’, 0)<br/> self.send_header(‘Cache-Control’, ‘no-cache, private’)<br/> self.send_header(‘Pragma’, ‘no-cache’)<br/> self.send_header(‘Content-Type’, ‘multipart/x-mixed-replace; boundary=FRAME’)<br/> self.end_headers()<br/> try:<br/> while True:<br/> frame = receiveMessage(clientConnected)<br/> self.wfile.write(b’ — FRAME\r\n’)<br/> self.send_header(‘Content-Type’, ‘image/jpeg’)<br/> self.send_header(‘Content-Length’, len(frame))<br/> self.end_headers()<br/> self.wfile.write(frame)<br/> self.wfile.write(b’\r\n’)<br/> except Exception as e:<br/> logging.warning(<br/> ‘Removed streaming client %s: %s’,<br/> self.client_address, str(e))<br/> else:<br/> self.send_error(404)<br/> self.end_headers()</span><span id="71ca" class="kh ki hh lo b fi lx lu l lv lw">class StreamingServer(socketserver.ThreadingMixIn, server.HTTPServer):<br/> allow_reuse_address = True<br/> daemon_threads = True</span><span id="236f" class="kh ki hh lo b fi lx lu l lv lw">try:<br/> address = (‘’, 80)<br/> server = StreamingServer(address, StreamingHandler)<br/> server.serve_forever()<br/> print(“starting”)<br/>finally:<br/> print(“shutdown”))<br/></span></pre><h2 id="faf7" class="kh ki hh bd kj kk kl km kn ko kp kq kr ip ks kt ku it kv kw kx ix ky kz la lb bi translated">Rasbperry Pi设置</h2><p id="f9ac" class="pw-post-body-paragraph ie if hh ig b ih lc ij ik il ld in io ip le ir is it lf iv iw ix lg iz ja jb ha bi translated">1.用你最喜欢的操作系统设置SD卡。以下是如何<a class="ae jc" href="https://geraldonit.com/2019/03/18/how-to-install-oracle-linux-on-raspberry-pi/" rel="noopener ugc nofollow" target="_blank">安装Oracle Linux </a>的方法，但树莓Pi操作系统非常容易安装<a class="ae jc" href="https://www.raspberrypi.com/software/" rel="noopener ugc nofollow" target="_blank">树莓Pi成像仪</a>。无论你决定使用哪种操作系统，它们都可以工作，并且有理由使用每种操作系统。</p><p id="f134" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请注意，操作系统选择和您的Raspberry Pi版本之间存在一些差异，有些可以，有些不行。我会尽我所能记录下这种情况，但是我没有一个完整的列表。下面是我整理的一个列表，可以帮助你理清这些选择。</p><p id="616a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">1.当我启动一个Pi时，我做的第一件事是重命名一个音频文件。当Pi第一次启动时，如果你有音频连接，你会得到一个恼人的“安装屏幕阅读器按下控制alt空格”:</p><p id="9ac9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du ll lm ln lo b">sudo mv /usr/share/piwiz/srprompt.wav /usr/share/piwiz/srprompt.wav.old</code></p><p id="30a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.更新操作系统:</p><p id="6479" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du ll lm ln lo b">sudo apt-get update -y &amp;&amp; sudo apt-get upgrade -y</code></p><p id="2de5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3.打开SPI、I2C和传统摄像机:</p><p id="4630" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du ll lm ln lo b">sudo raspi-config</code></p><p id="9c78" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">注意</strong> : <em class="ly">牛眼在raspi-config工具的GUI版本中没有这个选项。</em></p><p id="9295" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">4.重新启动以使所有更改生效:</p><p id="6d74" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du ll lm ln lo b">sudo reboot</code></p><p id="79f7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">5.为运动MPEG设置摄像机。运行命令:</p><p id="72b6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du ll lm ln lo b">sudo pico /boot/config.txt</code></p><p id="726d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在文件的底部，确保删除了所有名为:<code class="du ll lm ln lo b">dtoverlay=</code>的行。</p><p id="bdf9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">注意</strong> : <em class="ly">我见过需要在config.txt中放置</em> <code class="du ll lm ln lo b"><em class="ly">dtoverlay=imx219</em></code> <em class="ly">的例子，但根据我的实验，情况并非如此。我用V2相机做了这些测试。</em></p><p id="96d9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">5.将sendvid.py复制到您的Pi:</p><p id="0ee1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du ll lm ln lo b">scp sendvid.py pi@&lt;PI IP Address&gt;:/home/pi</code></p><p id="8e0d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jc" href="https://github.com/chrisbensen/chris-blogs/blob/main/HowTo/PiCamera2/files/sendvid.py" rel="noopener ugc nofollow" target="_blank"> sendvid.py </a>:</p><pre class="je jf jg jh fd lp lo lq lr aw ls bi"><span id="9664" class="kh ki hh lo b fi lt lu l lv lw"> import io<br/> import picamera<br/> import socket<br/> from threading import Condition<br/> import argparse<br/> import time<br/> import struct</span><span id="d3d2" class="kh ki hh lo b fi lx lu l lv lw">parser = argparse.ArgumentParser(description=”stream video.”)<br/> parser.add_argument(“ip”, type=str)<br/> parser.add_argument(“port”, type=int)<br/> args = parser.parse_args()</span><span id="2f6f" class="kh ki hh lo b fi lx lu l lv lw">address = (args.ip, args.port)<br/> clientSocket = None</span><span id="d93b" class="kh ki hh lo b fi lx lu l lv lw">while True:<br/> try:<br/> clientSocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)<br/> clientSocket.connect(address)<br/> break<br/> except socket.error:<br/> print(“Connection Failed, Retrying..”)<br/> time.sleep(1)</span><span id="7e6f" class="kh ki hh lo b fi lx lu l lv lw">print(“connected”)</span><span id="953f" class="kh ki hh lo b fi lx lu l lv lw">def sendMessage(connection, message):<br/> # Message: [4 byte message length][variable message]<br/> lmessage = struct.pack(‘&gt;I’, len(message)) + message<br/> connection.sendall(lmessage)</span><span id="9637" class="kh ki hh lo b fi lx lu l lv lw">class StreamingOutput(object):<br/> def __init__(self):<br/> self.buffer = io.BytesIO()</span><span id="8f74" class="kh ki hh lo b fi lx lu l lv lw">def write(self, buf):<br/> if buf.startswith(b’\xff\xd8'):<br/> self.buffer.truncate()<br/> sendMessage(clientSocket, self.buffer.getvalue())<br/> self.buffer.seek(0)<br/> return self.buffer.write(buf)</span><span id="98ad" class="kh ki hh lo b fi lx lu l lv lw">with picamera.PiCamera(resolution=’640x480', framerate=24) as camera:<br/> output = StreamingOutput()<br/> camera.start_recording(output, format=’mjpeg’)<br/> print(“camera”)</span><span id="d441" class="kh ki hh lo b fi lx lu l lv lw">try:<br/> camera.wait_recording(6)<br/> print(“done”)<br/> finally:<br/> camera.stop_recording()<br/> clientSocket.close()<br/></span></pre><p id="e32e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">6.一旦Pi上有了“sendvid.py ”,运行它:</p><p id="3c1d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du ll lm ln lo b">sudo python3 sendvid.py &lt;IpAddress&gt; 8100</code></p><h2 id="0eae" class="kh ki hh bd kj kk kl km kn ko kp kq kr ip ks kt ku it kv kw kx ix ky kz la lb bi translated">观看视频</h2><p id="b253" class="pw-post-body-paragraph ie if hh ig b ih lc ij ik il ld in io ip le ir is it lf iv iw ix lg iz ja jb ha bi translated">1.打开网络浏览器，输入你的公共IP地址，观看你的相机！</p><p id="8515" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您有任何问题或需要交互式支持和社区，请查看甲骨文面向开发者的公共<a class="ae jc" href="https://bit.ly/devrel_slack" rel="noopener ugc nofollow" target="_blank"> Slack频道</a>。</p></div></div>    
</body>
</html>