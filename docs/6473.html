<html>
<head>
<title>Token Based Authentication for Django Rest Framework</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Django Rest框架基于令牌的认证</h1>
<blockquote>原文：<a href="https://medium.com/quick-code/token-based-authentication-for-django-rest-framework-44586a9a56fb?source=collection_archive---------0-----------------------#2018-05-25">https://medium.com/quick-code/token-based-authentication-for-django-rest-framework-44586a9a56fb?source=collection_archive---------0-----------------------#2018-05-25</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/a3c54670448180fcff10dafb0b24baf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AxcUfXTlHRDSZ4wQvIXKIQ.jpeg"/></div></div></figure><p id="9c0d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Django是基于python的流行的web开发框架，有一个很大的社区，目前被很多顶级网站使用。Django Rest Framework是Django用来开发rest api的最流行的python包之一，它使得从身份验证到响应等一切事情变得非常简单。目前使用的一些认证是:-</p><ol class=""><li id="de6c" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm js jt ju jv bi translated">基本认证</li><li id="ac0a" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">令牌身份验证</li><li id="2244" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">会话身份验证</li><li id="2735" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">远程用户认证</li></ol><p id="a92e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这些都是由drf(django rest framework)提供的，除了oauth之外，基于oauth2的认证是由社区在其他python包的帮助下提供的。并且它们可以很容易地在生产环境中使用。所以，让我们从Django中基于主要目标令牌的认证开始。</p><p id="2d74" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们要遵循这些步骤</p><ol class=""><li id="29cf" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm js jt ju jv bi translated">安装Django</li><li id="c575" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">制作Django项目</li><li id="67b7" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">安装Django Rest框架</li><li id="6c43" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">设置登录功能和api路径</li><li id="f27c" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">测试登录api路由</li><li id="85d4" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">使用令牌访问经过身份验证的Api</li></ol><h1 id="b8ec" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">安装Django</h1><p id="ac8f" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">确保你的pc上安装了python 3，pip，virtualenv(Django 2.0版本已经去掉了对python 2.x版本的支持)。如果您已经在系统上安装了django，那么您可以跳过这些步骤，直到创建项目。</p><p id="432b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">创建一个项目文件夹，并从文件夹内的终端运行命令</p><figure class="le lf lg lh fd ii"><div class="bz dy l di"><div class="li lj l"/></div></figure><blockquote class="lk ll lm"><p id="82d0" class="ip iq ln ir b is it iu iv iw ix iy iz lo jb jc jd lp jf jg jh lq jj jk jl jm ha bi translated">Virtualenv为python包提供了虚拟环境，因此它不会损害你的全局包版本</p></blockquote><p id="7f1d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然后激活虚拟</p><figure class="le lf lg lh fd ii"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="3f44" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果它被激活，您将看到(venv)写在命令的开头。现在安装Django</p><figure class="le lf lg lh fd ii"><div class="bz dy l di"><div class="li lj l"/></div></figure><h1 id="565f" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">制作姜戈项目</h1><p id="af56" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">现在我们已经在我们的virtualenv中安装了django的最新版本，现在在同一个文件夹中创建一个项目</p><figure class="le lf lg lh fd ii"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="c9d2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">将创建一个myproject文件夹，其中包含一个manage.py文件和一个包含settings.py的myproject文件夹，settings . py包含项目的所有设置。</p><h1 id="bf56" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">安装Django-rest-framework</h1><p id="4617" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">现在我们将安装django rest框架。Django rest framework是一个构建在Django之上的库，用于制作rest api。你可以使用django的自定义函数来创建api，但是你会错过一些安全异常或者一些状态或者基础问题。Django rest框架已经考虑了这些问题。所以使用前不用担心。此外，它还包含我们将要实现的基于令牌的身份验证。学习Django 很容易，它可以帮助你快速构建web应用程序。</p><blockquote class="lk ll lm"><p id="feee" class="ip iq ln ir b is it iu iv iw ix iy iz lo jb jc jd lp jf jg jh lq jj jk jl jm ha bi translated">在http://www.django-rest-framework.org/的<a class="ae lr" href="http://www.django-rest-framework.org/" rel="noopener ugc nofollow" target="_blank">获取更多关于django-rest-framework的信息</a></p></blockquote><p id="78e2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">安装django rest框架</p><figure class="le lf lg lh fd ii"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="bd97" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为rest框架和基于令牌的身份验证更新settings.py文件</p><figure class="le lf lg lh fd ii"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="2332" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们在已安装的应用程序中添加了两个东西rest_framework和rest_framework.authtoken</p><p id="3fd4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">也请在settings.py文件中为rest_framework做如下配置</p><figure class="le lf lg lh fd ii"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="7bba" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">该配置旨在更改rest框架的默认身份验证和权限类。我们已经非常接近我们的最终目标了。</p><h1 id="69c0" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">设置登录功能和api路径</h1><p id="a6e0" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">现在我们编写登录函数，它返回与用户相关联的令牌，并使用。</p><p id="118b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在myproject文件夹中创建一个views.py</p><figure class="le lf lg lh fd ii"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="5cd1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这里，我们创建了一个登录函数，它处理POST请求并获取用户名和密码作为参数，然后验证它们是否正确，如果正确则返回令牌，否则返回not found响应。</p><p id="39da" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在在urls.py中创建相同的api路由</p><figure class="le lf lg lh fd ii"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="cafc" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">用我们的函数映射/API/登录路径。</p><p id="914f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，是测试登录api的时候了。但在此之前运行迁移</p><figure class="le lf lg lh fd ii"><div class="bz dy l di"><div class="li lj l"/></div></figure><h1 id="14ab" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak">测试登录api路径</strong></h1><p id="3f47" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">在测试登录api路径之前，我们必须创建一个用户，您可以使用管理面板或命令行来创建用户，我更喜欢使用命令行。</p><figure class="le lf lg lh fd ii"><div class="bz dy l di"><div class="li lj l"/></div></figure><figure class="le lf lg lh fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ls"><img src="../Images/3181ffe3dcf0c531b02541e160022b68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*3DtpV80fhcRNXRRSQWDB_Q.gif"/></div></div></figure><p id="fe95" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在使用runserver运行python应用程序，让我们使用postman测试api。Postman是测试rest api的非常好的工具。你可以在这里下载<a class="ae lr" href="https://chrome.google.com/webstore/detail/postman/fhbjgbiflinjbdggehcddcbncdddomop?hl=en" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="a7a0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">让我们看看如何在postman中测试api</p><figure class="le lf lg lh fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lt"><img src="../Images/c3c1b0865022565c74a388d4656c3f64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*jH53UW8Y3P9Cd2nZMdcWCw.gif"/></div></div></figure><p id="9d0e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们在响应中获取auth令牌，这个令牌在头中用于调用经过身份验证的api。让我们制作一个经过身份验证的示例api，然后尝试使用令牌访问该api。在views.py文件中添加以下内容</p><figure class="le lf lg lh fd ii"><div class="bz dy l di"><div class="li lj l"/></div></figure><p id="3ed9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在urls.py中添加相同的路由</p><figure class="le lf lg lh fd ii"><div class="bz dy l di"><div class="li lj l"/></div></figure><h1 id="261e" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">使用令牌访问经过身份验证的Api</h1><p id="524d" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">现在，我们尝试在没有或有令牌的情况下访问示例api，并首先在没有令牌的情况下查看响应</p><figure class="le lf lg lh fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lu"><img src="../Images/a20620322c0c7e04eff72acb8896249f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vp8Bq9zkSz1m7Ntk410YSQ.png"/></div></div></figure><p id="731e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们被阻止了，现在让我们使用授权令牌</p><figure class="le lf lg lh fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lu"><img src="../Images/7bf82fa799137645048b077666c15064.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d_BLYVAO4i94u0vehgazuA.png"/></div></div></figure><p id="4d0c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">耶，它的工作，我们能够访问认证的api。</p><p id="6993" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">因此，您最终学会了如何在Django中实现基于令牌的认证。</p><p id="fc40" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">请参考<a class="ae lr" href="https://github.com/ShubhamBansal1997/token-authentication-django" rel="noopener ugc nofollow" target="_blank"><strong class="ir hi">https://github . com/shubhambansal 1997/token-authentic ation-django</strong></a>查看代码。如果你发现任何错误，请在评论中提出。</p><p id="be5e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">❤制造</p><p id="338e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">小费不胜感激！💰 😉</strong></p><p id="4415" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">我的比特币地址</strong>:BC 1 qysxlz 0 p 9 nlcyndeysqltdhelwpdhurglgxz 96 x</p><p id="4ca1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">我的以太坊地址</strong>:0x 42 c98 e 296 b 27228d 9 ee 84 e 519 be c8 E0 d 09 CAD 30</p></div></div>    
</body>
</html>