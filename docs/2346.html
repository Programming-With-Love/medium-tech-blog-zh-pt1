<html>
<head>
<title>Vue as Event Bus — Life is Happier</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Vue作为活动巴士——生活更快乐</h1>
<blockquote>原文：<a href="https://medium.easyread.co/vue-as-event-bus-life-is-happier-7a04fe5231e1?source=collection_archive---------1-----------------------#2018-11-08">https://medium.easyread.co/vue-as-event-bus-life-is-happier-7a04fe5231e1?source=collection_archive---------1-----------------------#2018-11-08</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/582f3cbf73da28fa08685d04b2019846.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*m2VdP0HC3Icv8GZ4"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">“photo of yellow bus park on parking lot” by <a class="ae jz" href="https://unsplash.com/@corbycarr?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Damian Carr</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="ce98" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在我之前的<a class="ae jz" href="https://hackernoon.com/messaging-system-hands-on-7dda1afded37" rel="noopener ugc nofollow" target="_blank">文章</a>中，我写了我如何在微服务架构上实现一个消息系统，并且我使用了<a class="ae jz" href="https://www.rabbitmq.com/" rel="noopener ugc nofollow" target="_blank"> RabbitMQ </a>作为消息代理。消息传递系统的主要概念是发布-订阅模式。简单地说，在发布-订阅模式中，有发布消息的服务，也有订阅消息的服务。消息可以是事件、对象或其他类型。</p><p id="3d7d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然而，发布-订阅模式不仅在后端实现。在前端，像web应用和移动应用一样，我们也可以实现发布-订阅模式。如果在后端世界，消息通过服务发送到服务，而在前端世界，消息通过组件发送到组件。</p><p id="c2c6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在后端世界中，我们可以使用RabbitMQ、Apache Kafka和Google PubSub作为消息代理，但是我们可以使用什么作为前端世界的消息代理呢？有许多图书馆可供我们使用。如果我们想要实现发布——订阅Android应用程序，我们可以使用<a class="ae jz" href="https://github.com/greenrobot/EventBus" rel="noopener ugc nofollow" target="_blank"> EventBus </a>,对于iOS应用程序，我们可以使用<a class="ae jz" href="https://github.com/cesarferreira/SwiftEventBus" rel="noopener ugc nofollow" target="_blank"> SwiftEventBus </a>。那么Vue JS app可以用什么呢？</p><h1 id="d720" class="ky kz in bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">Vue JS就够了——让我展示给你看</h1><p id="84b3" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">在我们跳到代码之前，最好先了解问题陈述。这是问题陈述。</p><blockquote class="mb"><p id="c9af" class="mc md in bd me mf mg mh mi mj mk kx dk translated">我有两个组件。我将把数据从一个组件传递到另一个组件。接收器应显示接收到的数据。</p></blockquote><p id="1412" class="pw-post-body-paragraph ka kb in kc b kd ml kf kg kh mm kj kk kl mn kn ko kp mo kr ks kt mp kv kw kx ig bi translated">我觉得问题陈述够清楚了。所以让我们写代码，看看Vue作为一个消息代理。</p><h2 id="7035" class="mq kz in bd la mr ms dn le mt mu dp li kl mv mw lm kp mx my lq kt mz na lu nb bi translated">创建新的Vue应用</h2><p id="2971" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">要创建新的Vue CLI应用程序，请运行以下命令。确保您已经安装了Vue CLI。</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="1344" class="mq kz in nh b gy nl nm l nn no">// Install Vue CLI, if you not installed it yet<br/>$ <!-- -->npm install -g @vue/cli</span><span id="b40f" class="mq kz in nh b gy np nm l nn no">// Create Vue App<br/>$ vue init webpack &lt;project-name&gt;</span><span id="1634" class="mq kz in nh b gy np nm l nn no">// Start the project<br/>$ npm run dev</span></pre><h2 id="2b40" class="mq kz in bd la mr ms dn le mt mu dp li kl mv mw lm kp mx my lq kt mz na lu nb bi translated">创建组件</h2><p id="320f" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">现在我将创建两个组件。其中一个是发布者，另一个是订阅者。发布者的组件名为<code class="fe nq nr ns nh b">Leftside.vue</code>，订阅者的组件名为<code class="fe nq nr ns nh b">Rightside.vue</code>。</p><p id="72d5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这里的代码为<code class="fe nq nr ns nh b">Leftside.vue</code></p><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="ccac" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这里是<code class="fe nq nr ns nh b">Rightside.vue</code>的代码</p><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="4a69" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后我需要用这些组件在我的<code class="fe nq nr ns nh b">Helloword.vue,</code>上生成文件。</p><figure class="nc nd ne nf gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nv"><img src="../Images/3129a29fd2f9dcee1e3f968d0bd76967.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ry163m9K3kB2A_UhVWFL0A.png"/></div></div></figure><p id="2014" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下一步是创建Vue实例作为事件总线。现在，在您的<code class="fe nq nr ns nh b">/src</code>目录下创建一个新文件，命名为<code class="fe nq nr ns nh b">eventBus.js</code>。js非常简单，我们只需要两行代码😃</p><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="7da4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">接下来我们将在组件中使用这个<code class="fe nq nr ns nh b">eventBus.js</code>。看看下面更新的代码</p><p id="8b15" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下面是更新后的<code class="fe nq nr ns nh b">Leftside.vue</code>。</p><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="ddde" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">这里是更新后的<code class="fe nq nr ns nh b">Rightside.vue</code>。</p><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="nt nu l"/></div></figure><p id="4c30" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你可以在代码中看到，在每个组件中我都导入了<code class="fe nq nr ns nh b">eventBus.js</code>。用作消息代理的<code class="fe nq nr ns nh b">EventBus</code>对象。</p><h2 id="3558" class="mq kz in bd la mr ms dn le mt mu dp li kl mv mw lm kp mx my lq kt mz na lu nb bi translated">出版</h2><p id="8c88" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">在<code class="fe nq nr ns nh b">Leftside.vue</code>里，你可以看看</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="54d5" class="mq kz in nh b gy nl nm l nn no">EventBus.$emit(‘DATA_PUBLISHED’, payload) </span></pre><p id="1630" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe nq nr ns nh b">emit()</code>方法用于发布消息。它接收两个参数。第一个是事件名称，第二个是要传递的数据。</p><h2 id="e190" class="mq kz in bd la mr ms dn le mt mu dp li kl mv mw lm kp mx my lq kt mz na lu nb bi translated">订阅</h2><p id="d23d" class="pw-post-body-paragraph ka kb in kc b kd lw kf kg kh lx kj kk kl ly kn ko kp lz kr ks kt ma kv kw kx ig bi translated">在<code class="fe nq nr ns nh b">Rightside.vue</code>中，你可以看看</p><pre class="nc nd ne nf gt ng nh ni nj aw nk bi"><span id="6304" class="mq kz in nh b gy nl nm l nn no">EventBus.$on('DATA_PUBLISHED', (payload) =&gt; {<br/>  this.updateData(payload)<br/>})</span></pre><p id="5fd5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe nq nr ns nh b">on()</code>方法用于监听在<code class="fe nq nr ns nh b">EventBus.</code>上接收两个参数的事件。第一个是事件名，第二个是回调方法。</p><p id="30b6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><code class="fe nq nr ns nh b">DATA_PUBLISHED</code>是用于标识发布者发布和订阅者订阅哪个事件的事件名称。当我们使用RabbitMQ时，它与主题名称相同。就这么简单😄</p><p id="7f0e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">实际上，我们还可以使用另外两种方法，分别是<code class="fe nq nr ns nh b">off()</code>和<code class="fe nq nr ns nh b">once().</code>。其中<code class="fe nq nr ns nh b">off()</code>用于删除订阅的事件，而<code class="fe nq nr ns nh b">once()</code>用于订阅一个事件，但只触发一次。订阅者触发后，订阅将被删除。更多细节，你可以查看官方文档<a class="ae jz" href="https://vuejs.org/v2/api/#Instance-Methods-Events" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="939f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我用Vue作为事件总线做的另一件很酷的事情是触发另一个组件通过从服务获取数据来重新加载它的数据。我不需要重新加载所有页面来更新数据，这将由组件本身来完成。</p></div><div class="ab cl nw nx hr ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ig ih ii ij ik"><p id="25d8" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">事实上，在我们的日常项目中，我们还可以使用其他的沟通模式。我自己也仍在学习其他模式，并寻找可以实现发布-订阅模式的地方。如果你知道我可以在哪里实现它，请随时通过<code class="fe nq nr ns nh b">ecojuntak@gmail.com.</code>联系我，哦，你可以在我的知识库中找到完整的代码。</p><div class="od oe gp gr of og"><a href="https://github.com/ecojuntak/vue-event-bus" rel="noopener  ugc nofollow" target="_blank"><div class="oh ab fo"><div class="oi ab oj cl cj ok"><h2 class="bd io gy z fp ol fr fs om fu fw im bi translated">ecojuntak/vue-事件-总线</h2><div class="on l"><h3 class="bd b gy z fp ol fr fs om fu fw dk translated">通过在GitHub上创建帐户，为ecojuntak/vue-event-bus开发做出贡献。</h3></div><div class="oo l"><p class="bd b dl z fp ol fr fs om fu fw dk translated">github.com</p></div></div><div class="op l"><div class="oq l or os ot op ou jt og"/></div></div></a></div><p id="f097" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">下一篇文章再见，希望你会喜欢。</p><p id="7959" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">卡皮·霍丁！😎 💻 ☕️</p></div><div class="ab cl nw nx hr ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ig ih ii ij ik"><figure class="nc nd ne nf gt jo"><div class="bz fp l di"><div class="ov nu l"/></div></figure></div></div>    
</body>
</html>