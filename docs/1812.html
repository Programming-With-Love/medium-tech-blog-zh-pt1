<html>
<head>
<title>Automate Application Monitoring with Slack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用Slack实现应用监控自动化</h1>
<blockquote>原文：<a href="https://medium.com/capital-one-tech/automate-application-monitoring-with-slack-9e4e498652a3?source=collection_archive---------0-----------------------#2021-09-08">https://medium.com/capital-one-tech/automate-application-monitoring-with-slack-9e4e498652a3?source=collection_archive---------0-----------------------#2021-09-08</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="908d" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">使用Python、Apache Airflow和AWS Elasticsearch构建预警Slack机器人的教程</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/a05857943d7ad2a3fe8b9cf0a4f95483.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6jUsdTXoqmkxJqGD.jpg"/></div></div></figure><p id="8084" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">应用程序监控在维护强大的应用程序和确保客户获得积极、不间断的体验方面发挥着关键作用。虽然应用程序监控有许多不同的形式和规模，但一些策略被证明比其他策略更有效。Slack bot是一个很好的工具，团队可以使用它来监控应用程序的健康、性能和可用性。毕竟，开发人员和团队的其他成员白天在哪里总是活跃和登录的呢？懈怠。</p><p id="e9c6" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">工作场所文化的这个方面使得Slack成为发送应用程序监控警报的完美候选。Slack已经吸引了开发团队的注意力。可以利用这一事实来发送关于团队应用程序的智能的、有意义的警报，可以快速有效地对其采取行动。在这篇博文中，我将讲述如何创建一个Slack bot的基础知识，它将使用Python、Apache Airflow和Elasticsearch来监控您的应用程序。</p><h1 id="1391" class="ke kf hh bd kg kh ki kj kk kl km kn ko in kp io kq iq kr ir ks it kt iu ku kv bi translated">我作为TDP在Capital One工作的经验</h1><p id="34a4" class="pw-post-body-paragraph ji jj hh jk b jl kw ii jn jo kx il jq jr ky jt ju jv kz jx jy jz la kb kc kd ha bi translated">我是第一资本公司的高级助理软件工程师，在技术开发项目中工作。技术发展计划(也称为TDP)是一项为期两年的轮换计划，面向计算机科学专业的应届毕业生。作为该计划的一部分，员工被嵌入到全职敏捷开发团队中，在整个企业中从事各种项目。<a class="ae lb" href="https://www.capitalonecareers.com/a-day-in-the-life-of-a-technology-development-program-associate-cul-101" rel="noopener ugc nofollow" target="_blank">TDP员工的一天</a>可能包括参加团队的每日例会、实施新的应用功能、在午餐时间参加高管演讲活动，然后在一天结束前将该功能部署到生产中！在该计划的第一年结束时，员工轮换到一个新的团队，以便掌握新的技能，扩大他们的专业网络，并使用新技术。许多TDP还选择超越他们的日常职责，参与招聘工作或导师计划，如<a class="ae lb" href="https://coders.capitalone.com/" rel="noopener ugc nofollow" target="_blank">程序员</a>，这是一个旨在激励下一代技术人员的Capital One计划。在TDP的两年经历中，我利用了一个叫做TDP委员会的<a class="ae lb" href="https://www.capitalonecareers.com/how-a-tech-internship-prepared-carlton-to-lead-cul-cdev" rel="noopener ugc nofollow" target="_blank">领导机会。TDP委员会是由TDP领导者共同选举产生的委员会，其任务是为1000多名成员组织网络和参与活动。</a></p><p id="258a" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">我目前的团队开发并维护了一个web应用程序，领导层使用该应用程序来查看有关每天为我们的员工提供动力的技术的指标。在这个使用Python、Angular、Apache Airflow和AWS构建的web应用程序上，用户可以找到关于硬件合规性、漏洞发现和内部软件应用程序使用数据的指标。我的团队还使用Slack bot来监控我们的应用程序。当我们的Elasticsearch数据库中的数据丢失时，我们的Slack bot就会被触发，并向我们团队的Slack频道发送一条消息。此警报消息指示缺少哪些数据集，以及来自哪个区域或环境。我还开发了这个Slack bot的增强版，它可以计算我们的弹性搜索指数每天变化的百分比。如果与30天平均值相比，某个特定索引的大小增长或收缩超过设定的阈值，就会发送这些警报。这向我们的团队表明，可能存在数据重复问题或部分数据删除问题。这些警报使我们的开发团队能够在客户受到影响之前调查并修复数据问题。</p><h1 id="f476" class="ke kf hh bd kg kh ki kj kk kl km kn ko in kp io kq iq kr ir ks it kt iu ku kv bi translated">了解不同类型的应用程序监控</h1><p id="097a" class="pw-post-body-paragraph ji jj hh jk b jl kw ii jn jo kx il jq jr ky jt ju jv kz jx jy jz la kb kc kd ha bi translated">在进入警报Slack bot的技术实现步骤之前，我们必须了解不同类型的应用程序监控是什么，以及它们为什么如此重要。</p><p id="945c" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">归根结底，作为工程师，我们的工作是为我们的用户提供出色的用户体验。这包括直观的用户界面、全面的用户体验以及快速且高度可用的应用程序，这意味着停机时间和延迟非常短。让我们以一个允许用户查看账户信息的银行web应用程序为例。开发团队可能有兴趣监控该应用程序的各个方面，以确保它在一致的基础上为客户交付价值。这些应用程序监控类别可能包括:</p><ul class=""><li id="e1fa" class="lc ld hh jk b jl jm jo jp jr le jv lf jz lg kd lh li lj lk bi translated"><strong class="jk hi">正常运行时间和停机时间</strong>e——开发团队可能会监控应用程序的正常运行时间和停机时间，这是指银行网站运行的频率。</li><li id="94d2" class="lc ld hh jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated"><strong class="jk hi">性能</strong> —开发团队可能会监控应用程序的性能，这指的是用户关于其帐户的请求被返回的速度。</li><li id="672d" class="lc ld hh jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated"><strong class="jk hi">缺失数据</strong>答——开发团队可能会监控应用程序中缺失的数据，这些数据是指已经丢失、删除或损坏的客户帐户数据。</li><li id="fa05" class="lc ld hh jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated"><strong class="jk hi">一般日志</strong> —开发团队可能会监控来自应用程序的一般日志，这涉及到对所有用户活动的跟踪。</li><li id="8df9" class="lc ld hh jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated"><strong class="jk hi">异常活动</strong> —开发团队可能会监控应用程序上的异常帐户活动，这可能是安全漏洞的迹象。</li></ul><p id="888c" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">所有这些都是开发团队想要监控的应用程序的一些最常见方面的例子。如果不检查应用程序的这些方面，结果可能是灾难性的。继续以银行web应用程序为例，下面是一些可能出错的地方:</p><ul class=""><li id="f391" class="lc ld hh jk b jl jm jo jp jr le jv lf jz lg kd lh li lj lk bi translated"><strong class="jk hi">正常运行时间和停机时间</strong> —如果银行应用程序停机时间过长，客户将无法访问其账户，也无法进行转账或查看余额。</li><li id="07ee" class="lc ld hh jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated"><strong class="jk hi">性能</strong> —如果银行应用程序太慢，客户可能会感到沮丧，银行的客户服务热线可能会不堪重负。更糟糕的是，顾客可能会把生意转移到别处。</li><li id="b636" class="lc ld hh jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated"><strong class="jk hi">丢失数据</strong> —如果客户发现其银行账户中的数据丢失，这可能会对银行产生严重影响，如果这是一个普遍问题，银行的品牌可能会受到严重损害。</li><li id="717c" class="lc ld hh jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated"><strong class="jk hi">一般日志</strong> —如果在使用银行应用程序时没有正确保存用户行为的日志，这可能会带来法律和道德风险。虽然银行希望出于审计目的保留日志，但他们也必须牢记消费者隐私。</li><li id="c86b" class="lc ld hh jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated"><strong class="jk hi">异常活动</strong> —如果银行应用程序没有适当的机制来监控和检测恶意活动，那么这种活动可能会在银行的监管下发生。</li></ul><p id="d453" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">显然，应用程序监控是构建和维护健壮应用程序的一个绝对重要的方面。在本教程中，我们将揭示如何设置一个Slack bot来监视应用程序，并在检测到丢失数据时发送警告消息。</p><h1 id="8b6b" class="ke kf hh bd kg kh ki kj kk kl km kn ko in kp io kq iq kr ir ks it kt iu ku kv bi translated">使用Apache Airflow和Python构建Slack bot的教程</h1><p id="c7cf" class="pw-post-body-paragraph ji jj hh jk b jl kw ii jn jo kx il jq jr ky jt ju jv kz jx jy jz la kb kc kd ha bi translated">我的团队为我们的web应用程序使用了一个技术栈，包括Apache Airflow、Python、Angular和Elasticsearch。当然，所有这些都被部署到Amazon Web Services(也称为AWS)中，以便具有高度可伸缩性、可用性和弹性。虽然Capital One是一家银行，但我们的运营方式很像一家科技公司，并且已经<a class="ae lb" href="https://aws.amazon.com/solutions/case-studies/capital-one/" rel="noopener ugc nofollow" target="_blank">退出了我们所有的数据中心</a>，全力投入云计算和AWS，</p><p id="d119" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><a class="ae lb" href="https://airflow.apache.org/" rel="noopener ugc nofollow" target="_blank"> Apache Airflow </a>是一个开源的工作流管理平台，我们使用它来定义批处理过程，以提取、转换和加载数据到Elasticsearch集群中。<a class="ae lb" href="https://www.elastic.co/elasticsearch/" rel="noopener ugc nofollow" target="_blank"> Elasticsearch </a>是一个NoSQL数据库，使用了一个被称为指数的概念，这是Elasticsearch中最大的数据单位。索引是文档(JSON对象)的逻辑分区，可以比作关系数据库中的数据库。Airflow提出了一个被称为DAG的概念，或<a class="ae lb" href="http://airflow.apache.org/docs/apache-airflow/1.10.12/concepts.html#:~:text=In%20Airflow%2C%20a%20DAG%20%E2%80%93%20or,and%20their%20dependencies)%20as%20code." rel="noopener ugc nofollow" target="_blank">有向非循环图</a>，它本质上是一个工作流或您想要运行的任务的集合，它在Python脚本中定义。我们的团队有许多Dag全天运行，从不同的来源提取数据，将这些数据转换成适当的格式，然后加载到Elasticsearch中，以便我们的web应用程序可以使用这些数据。有时，这些Dag或工作流会因各种原因而失败。对此，我们的团队开发了一个DAG来检查Elasticsearch中所有不同数据索引的存在。如果数据丢失，就会触发警报，使用Slack bot向我们团队的Slack通道发送消息。</p><p id="95d6" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">现在让我们深入研究使用Apache Airflow和Python创建Slack bot的步骤，以便在Elasticsearch数据库中的数据丢失时发送警报。本教程假设您已经设置并部署了Apache Airflow的一个实例，现在准备开始开发新的Dag。</p><h2 id="bc2d" class="lq kf hh bd kg lr ls lt kk lu lv lw ko jr lx ly kq jv lz ma ks jz mb mc ku md bi translated">步骤1 —文件结构</h2><p id="a3d0" class="pw-post-body-paragraph ji jj hh jk b jl kw ii jn jo kx il jq jr ky jt ju jv kz jx jy jz la kb kc kd ha bi translated">对于这个例子，下面是我们的目录结构的样子。我们有一个名为<code class="du me mf mg mh b">send_slack_alert.py</code>的文件，其中包含向Slack发送警报消息的代码和业务逻辑。文件<code class="du me mf mg mh b">slack_alert_dag.py</code>包含管道定义的代码。<code class="du me mf mg mh b">slack_alert_dag.py</code>将最终被解释为Apache Airflow用户界面上的DAG，<code class="du me mf mg mh b">send_slack_alert.py</code>将是在工作流中执行的代码。</p><pre class="ix iy iz ja fd mi mh mj mk aw ml bi"><span id="7108" class="lq kf hh mh b fi mm mn l mo mp">.<br/>├── Slack Bot Project<br/>└── src<br/>    ├── send_slack_alert.py<br/>    └── slack_alert_dag.py</span></pre><h2 id="02c8" class="lq kf hh bd kg lr ls lt kk lu lv lw ko jr lx ly kq jv lz ma ks jz mb mc ku md bi translated">步骤2 —设置DAG</h2><pre class="ix iy iz ja fd mi mh mj mk aw ml bi"><span id="22bc" class="lq kf hh mh b fi mm mn l mo mp">"""Airflow DAG to run the missing index Slack alert process."""<br/>from datetime import datetime<br/>from datetime import timedelta<br/><br/>from airflow import DAG<br/>from airflow.models import Variable<br/>from airflow.operators.bash import BashOperator<br/><br/>script_dir = Variable.get("script_dir")<br/><br/>default_args = {<br/>    "retries": 1,<br/>    "start_date": datetime(2020, 1, 19),<br/>    "retry_delay": timedelta(minutes=5),<br/>}<br/><br/># 4:00 PM EST<br/>schedule = "0 20 * * *"<br/><br/>dag = DAG(<br/>    "slack_alert_example",<br/>    default_args=default_args,<br/>    catchup=False,<br/>    schedule_interval=schedule,<br/>)<br/><br/>slack_alert = """<br/>    python {{ params.script_dir }}/send_slack_alert.py<br/>"""<br/><br/>t1 = BashOperator(<br/>    task_id="slack_alert",<br/>    bash_command=slack_alert,<br/>    dag=dag,<br/>    params={<br/>        "script_dir": script_dir,<br/>    },<br/>)</span></pre><p id="e351" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在<code class="du me mf mg mh b">slack_alert_dag.py</code>文件中，有包含我们DAG的管道定义的代码。该代码定义了我们的DAG的结构和行为，它将最终在工作流程中发出我们的Slack警报。</p><ul class=""><li id="6b9f" class="lc ld hh jk b jl jm jo jp jr le jv lf jz lg kd lh li lj lk bi translated">首先，我们声明一个变量<code class="du me mf mg mh b">script_dir</code>,它包含Apache Airflow部署后脚本的目录。<a class="ae lb" href="https://airflow.apache.org/docs/apache-airflow/stable/howto/variable.html" rel="noopener ugc nofollow" target="_blank">气流变量</a>是一种在气流中存储和检索元数据的通用方法，可以使用用户界面、代码或命令行界面进行更新。</li><li id="97ee" class="lc ld hh jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated">第二，我已经为DAG声明了一些参数，例如它应该重试多少次，DAG应该何时开始，以及DAG应该在重试之间等待多长时间。这些参数被分配给<code class="du me mf mg mh b">default_args</code>变量。</li><li id="1a5b" class="lc ld hh jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated">第三，我为DAG声明了<code class="du me mf mg mh b">schedule</code>,并将其赋给调度变量。我希望DAG每天在美国东部时间下午4:00运行。时间以<a class="ae lb" href="https://en.wikipedia.org/wiki/Cron" rel="noopener ugc nofollow" target="_blank"> cron符号</a>表示，并基于格林威治标准时间(GMT)。</li><li id="6627" class="lc ld hh jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated">第四，我定义了DAG的一些特征，比如它的名称、调度和默认参数，并将其分配给<code class="du me mf mg mh b">dag</code>变量。</li><li id="b6eb" class="lc ld hh jk b jl ll jo lm jr ln jv lo jz lp kd lh li lj lk bi translated">第五，<code class="du me mf mg mh b">t1</code>是指将在此工作流中执行的第一个任务。当DAG运行时，它将运行由slack_alert变量定义的bash脚本，该脚本将运行我们的Python代码来发送来自Elasticsearch的任何缺失数据的slack警报。</li></ul><h2 id="0502" class="lq kf hh bd kg lr ls lt kk lu lv lw ko jr lx ly kq jv lz ma ks jz mb mc ku md bi translated">步骤3 —编写发送时差警报的代码</h2><pre class="ix iy iz ja fd mi mh mj mk aw ml bi"><span id="efa8" class="lq kf hh mh b fi mm mn l mo mp">def main():<br/>    generate_missing_index_alerts()<br/><br/><br/>if __name__ == "__main__":<br/>    main()</span></pre><p id="012c" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">既然我们已经编写了定义将在Apache Airflow中运行的DAG的代码，现在我们必须编写实际发送Slack警报的代码，以用于应用程序监控。这是我们的主函数，程序的入口点。当DAG工作流启动时，将执行这段Python代码。程序的主要功能调用<code class="du me mf mg mh b">generate_missing_index_alerts() </code>，它包含程序的业务逻辑。</p><pre class="ix iy iz ja fd mi mh mj mk aw ml bi"><span id="5348" class="lq kf hh mh b fi mm mn l mo mp">def generate_missing_index_alerts():<br/>    """<br/>    Generates Slack alerts for missing Elasticsearch indices.<br/>    """<br/>    indices_to_check = [<br/>        "accounts_index",<br/>        "users_index",<br/>        "employees_index"<br/>    ]<br/>    elasticsearch_url = 'https://my-elasticsearch-url.us-east-1.es.amazonaws.com/_cat/indices?s=index'<br/><br/>    # Query Elasticsearch URL for string of all indices that exist.<br/>    elasticsearch_indices = str(urlopen(elasticsearch_url).read())<br/><br/>    # Generate a list of any indices which are missing from Elasticsearch.<br/>    missing_indices = generate_missing_indices(indices_to_check, elasticsearch_indices)<br/><br/>    # If there are missing indices in the Elasticsearch instance.<br/>    if missing_indices:<br/>        alert_message = f"Alert! The following indices are missing from Elasticsearch:\n"<br/>        # For each missing index.<br/>        for missing_index in missing_indices:<br/>            # Add the index name to the alert message.<br/>            alert_message += f"`{missing_index}`\n"<br/><br/>        # Send the alert message to Slack.<br/>        send_slack_alert(alert_message)</span></pre><p id="08a0" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><code class="du me mf mg mh b">generate_missing_index_alerts()</code>函数是我们程序的核心，用来发出松弛警报。首先，代码查询我们的Elasticsearch实例的URL来检索所有可用的索引，并将这些数据赋给<code class="du me mf mg mh b">elasticsearch_indices</code>变量。接下来，调用<code class="du me mf mg mh b">generate_missing_indices()</code>函数，该函数将返回我们的Elasticsearch实例中缺失的索引列表。</p><p id="59bd" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">我们将在<code class="du me mf mg mh b">generate_missing_indices()</code>函数中传递三个要检查的索引列表:</p><ol class=""><li id="a239" class="lc ld hh jk b jl jm jo jp jr le jv lf jz lg kd mq li lj lk bi translated"><code class="du me mf mg mh b">accounts_index</code></li><li id="c35f" class="lc ld hh jk b jl ll jo lm jr ln jv lo jz lp kd mq li lj lk bi translated"><code class="du me mf mg mh b">users_index</code></li><li id="df72" class="lc ld hh jk b jl ll jo lm jr ln jv lo jz lp kd mq li lj lk bi translated"><code class="du me mf mg mh b">employees_index</code></li></ol><p id="249c" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这是我们的Elasticsearch实例中应该存在的三个样本索引。一旦我们从Elasticsearch实例中收集到所有缺失指数的列表，我们就可以发出一个Slack警报！</p><pre class="ix iy iz ja fd mi mh mj mk aw ml bi"><span id="7e2d" class="lq kf hh mh b fi mm mn l mo mp">def generate_missing_indices(indices_list: list, elasticsearch_indices: str) -&gt; list:<br/>    """<br/>    Returns list of indices which are missing from Elasticsearch.<br/><br/>    :param indices_list: List of indices to check for existence.<br/>    :param elasticsearch_indices: String of all existing Elasticsearch indices.<br/>    :return: List of missing indices from Elasticsearch.<br/>    """<br/>    list_of_missing_indicies = []<br/><br/>    # For each index that should exist.<br/>    for index in indices_list:<br/>        # If the index does not exist in Elasticsearch.<br/>        if index not in elasticsearch_indices:<br/>            # Add this index to the list of missing indices.<br/>            list_of_missing_indicies.append(index)<br/><br/>    return list_of_missing_indicies</span></pre><p id="509f" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这里我们可以看到<code class="du me mf mg mh b">generate_missing_indices()</code>函数的代码，它从我们的Elasticsearch实例中生成一个缺失索引列表。给定我们期望存在的索引列表和当前存在的索引列表，该函数将返回所有缺失索引的列表。一旦我们有了缺失弹性搜索指数的列表，我们就可以向他们发出警告信息。</p><pre class="ix iy iz ja fd mi mh mj mk aw ml bi"><span id="c5d0" class="lq kf hh mh b fi mm mn l mo mp">def send_slack_alert(message: str):<br/>    """<br/>    Sends alert messages to Slack for any missing Elasticsearch indices.<br/><br/>    :param message: Message to be sent to Slack channel.<br/>    """<br/><br/>    slack_message = {<br/>        "channel": "#my_teams_channel",<br/>        "username": "My Slack Bot",<br/>        "text": message<br/>    }<br/><br/>    # Messages sent to this webhook will be sent to the Slack channel<br/>    # which has been configured.<br/>    slack_webhook = "https://hooks.slack.com/services/my-webhook"<br/><br/>    # Send a POST request to the Slack webhook, which will send the message<br/>    # to the configured Slack channel.<br/>    requests.post(<br/>        slack_webhook, json.dumps(slack_message).encode("utf-8")<br/>    )</span></pre><p id="4389" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在这里，我们可以看到最终发出松弛警报的代码。给定要发送的消息，该函数使用requests Python库向Slack webhook发送HTTP POST请求。可以在Slack仪表板上配置Slack webhook。当消息发布到这个webhook URL时，Slack会将消息发布到您选择的已经配置的Slack频道。</p><h2 id="8095" class="lq kf hh bd kg lr ls lt kk lu lv lw ko jr lx ly kq jv lz ma ks jz mb mc ku md bi translated">步骤4 —测试应用程序监控警报是否已发送！</h2><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mr"><img src="../Images/db1585470c077fe422cbbff24a8810d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1T1OKEsH61YcIADCQqHSnw.png"/></div></div></figure><p id="0d8e" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">现在我们已经实现了所有的代码，我们可以看到Slack bot已经发送了一条Slack警报消息！在我们的例子中，Elasticsearch中似乎缺少了<code class="du me mf mg mh b">accounts_index</code>索引。多亏了我们的Slack bot，我们才能够在客户受到影响之前发现并修复这个问题。</p><h1 id="e874" class="ke kf hh bd kg kh ki kj kk kl km kn ko in kp io kq iq kr ir ks it kt iu ku kv bi translated">结论</h1><p id="e1bb" class="pw-post-body-paragraph ji jj hh jk b jl kw ii jn jo kx il jq jr ky jt ju jv kz jx jy jz la kb kc kd ha bi translated">正如我所描述的，应用程序监控在维护一个健壮的应用程序中起着关键的作用。敏捷开发团队可能会对应用程序的许多方面感兴趣。这些包括监控停机时间、性能、丢失数据、一般日志和异常活动。如果应用程序的这些方面中的任何一个不受监控，那么该应用程序的最终用户就会陷入混乱。因此，开发团队必须将系统放置在适当的位置，以便尽早并经常对这些项目发出警报。实现这一点的一个很好的策略是创建一个Slack bot，它向团队的Slack通道发送关于应用程序的监控警报。团队成员在一天中与同事交流时已经进入了松弛状态。通过将智能的、可操作的和信息丰富的应用程序监控警报交织到现有的空闲通道中，开发团队可以及时地采取行动。在本教程中，我解释了如何使用Python、Apache Airflow和Elasticsearch建立一个这样的应用程序来监控Slack bot。然而，我列出的原则几乎可以应用于任何技术堆栈或应用程序。企业环境中开发团队的责任在不断增加。对团队来说，将尽可能多的自动化措施落实到位是有利的。通过设置一个全天24小时监控应用程序的Slack bot，开发团队能够节省时间并处理真正有趣的任务。但是，一旦发出警报的Slack bot检测到有关应用程序的异常，开发团队可以立即得到通知，并立即采取行动解决问题。</p></div><div class="ab cl ms mt go mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ha hb hc hd he"><p id="85fd" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><em class="mz">披露声明:2021资本一。观点是作者个人的观点。除非本帖中另有说明，否则Capital One不隶属于所提及的任何公司，也不被这些公司认可。使用或展示的所有商标和其他知识产权是其各自所有者的财产。</em></p><p id="3004" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><em class="mz">最初发表于</em><a class="ae lb" href="https://www.capitalone.com/tech/software-engineering/how-to-automate-application-monitoring-slack-bots/" rel="noopener ugc nofollow" target="_blank">T5【https://www.capitalone.com】</a><em class="mz">。</em></p></div></div>    
</body>
</html>