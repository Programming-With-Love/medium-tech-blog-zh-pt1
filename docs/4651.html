<html>
<head>
<title>Master the JavaScript Interview: What is a Pure Function?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">掌握JavaScript面试:什么是纯函数？</h1>
<blockquote>原文：<a href="https://medium.com/javascript-scene/master-the-javascript-interview-what-is-a-pure-function-d1c076bec976?source=collection_archive---------0-----------------------#2016-03-26">https://medium.com/javascript-scene/master-the-javascript-interview-what-is-a-pure-function-d1c076bec976?source=collection_archive---------0-----------------------#2016-03-26</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/82fd66bc123b608ee333e16fc4349a47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gF8oCkYNvktBbAAG-nxYrg.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Image: Pure — carnagenyc (CC-BY-NC 2.0)</figcaption></figure><p id="fae5" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">纯函数对于各种目的都是必不可少的，包括函数式编程、可靠并发和React+Redux应用。但是“纯函数”是什么意思呢？</p><p id="baac" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">一个<strong class="iv hi">纯函数</strong>是这样一个函数:</p><ul class=""><li id="0244" class="jr js hh iv b iw ix ja jb je jt ji ju jm jv jq jw jx jy jz bi translated">给定相同的输入，总是返回相同的输出。</li><li id="92a4" class="jr js hh iv b iw ka ja kb je kc ji kd jm ke jq jw jx jy jz bi translated">不会产生副作用。</li></ul><p id="f1d1" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">我们将通过<a class="ae kf" href="http://ericelliottjs.com/product/lifetime-access-pass/" rel="noopener ugc nofollow" target="_blank">“跟随Eric Elliott学习JavaScript”</a>的一堂免费课来回答这个问题:</p><figure class="kg kh ki kj fd ii"><div class="bz dy l di"><div class="kk kl l"/></div></figure><p id="70f2" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">在我们讨论什么是纯函数之前，最好仔细研究一下函数。可能有一种不同的方式来看待它们，这将使函数式编程更容易理解。</p><h2 id="c9b0" class="km kn hh bd ko kp kq kr ks kt ku kv kw je kx ky kz ji la lb lc jm ld le lf lg bi translated">什么是函数？</h2><p id="79ff" class="pw-post-body-paragraph it iu hh iv b iw lh iy iz ja li jc jd je lj jg jh ji lk jk jl jm ll jo jp jq ha bi translated">一个<strong class="iv hi">函数</strong>是一个过程，它接受一些输入，称为<strong class="iv hi">自变量</strong>，并产生一些输出，称为<strong class="iv hi">返回值</strong>。功能可用于以下目的:</p><ul class=""><li id="2b73" class="jr js hh iv b iw ix ja jb je jt ji ju jm jv jq jw jx jy jz bi translated"><strong class="iv hi">映射:</strong>根据给定的输入产生一些输出。函数<strong class="iv hi">将</strong>输入值映射到输出值。</li><li id="7efa" class="jr js hh iv b iw ka ja kb je kc ji kd jm ke jq jw jx jy jz bi translated"><strong class="iv hi">程序:</strong>可以调用一个函数来执行一系列步骤。该序列称为程序，这种方式的编程称为<strong class="iv hi">程序编程</strong>。</li><li id="e02d" class="jr js hh iv b iw ka ja kb je kc ji kd jm ke jq jw jx jy jz bi translated"><strong class="iv hi"> I/O: </strong>一些功能用于与系统的其他部分通信，如屏幕、存储器、系统日志或网络。</li></ul><h2 id="a77b" class="km kn hh bd ko kp kq kr ks kt ku kv kw je kx ky kz ji la lb lc jm ld le lf lg bi translated">绘图</h2><p id="1f55" class="pw-post-body-paragraph it iu hh iv b iw lh iy iz ja li jc jd je lj jg jh ji lk jk jl jm ll jo jp jq ha bi translated">纯函数都是关于映射的。函数将输入参数映射到返回值，这意味着对于每组输入，都存在一个输出。一个函数将接受输入并返回相应的输出。</p><p id="39eb" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><em class="lm"> `Math.max()` </em>以数字为参数，返回最大的数字:</p><pre class="kg kh ki kj fd ln lo lp lq aw lr bi"><span id="8cba" class="km kn hh lo b fi ls lt l lu lv">Math.max(2, 8, 5); // 8</span></pre><p id="d539" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">在本例中，2、8和5是<em class="lm">参数</em>。它们是传递给函数的值。</p><p id="3b80" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><em class="lm"> `Math.max()` </em>是一个接受任意数量的参数并返回最大参数值的函数。在这种情况下，我们传入的最大数字是8，这是返回的数字。</p><p id="1888" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">函数在计算和数学中非常重要。它们帮助我们以有用的方式处理数据。优秀的程序员给函数起描述性的名字，这样当我们看到代码的时候，我们就能看到函数的名字并理解函数的作用。</p><p id="eace" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">数学也有函数，它们的工作方式很像JavaScript中的函数。你可能在代数中见过函数。它们看起来像这样:</p><p id="2b48" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><em class="lm">f</em>(<em class="lm">x</em>)= 2<em class="lm">x</em></p><p id="af1f" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">这意味着我们声明了一个函数f，它有一个参数x，然后把x乘以2。</p><p id="4ba8" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">要使用这个函数，我们只需为x提供一个值:</p><p id="10c2" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><em class="lm"> f </em> (2)</p><p id="85c8" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">在代数中，这和写作的意思完全一样:</p><p id="308c" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi">4</p><p id="a028" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">所以任何你看到<em class="lm"> f </em> (2)的地方都可以代入4。</p><p id="2027" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">现在让我们将该函数转换成JavaScript:</p><pre class="kg kh ki kj fd ln lo lp lq aw lr bi"><span id="a931" class="km kn hh lo b fi ls lt l lu lv">const double = x =&gt; x * 2;</span></pre><p id="dc0e" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">您可以使用<em class="lm"> `console.log()` </em>检查函数的输出:</p><pre class="kg kh ki kj fd ln lo lp lq aw lr bi"><span id="361f" class="km kn hh lo b fi ls lt l lu lv">console.log( double(5) ); // 10</span></pre><p id="06eb" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">记得我说过在数学函数中，你可以用<em class="lm"> `4` </em>代替<em class="lm"> `f(2)` </em>？在这种情况下，JavaScript引擎用答案<em class="lm"> `10` </em>替换<em class="lm"> `double(5)` </em>。</p><h2 id="8171" class="km kn hh bd ko kp kq kr ks kt ku kv kw je kx ky kz ji la lb lc jm ld le lf lg bi translated">纯函数</h2><p id="28d4" class="pw-post-body-paragraph it iu hh iv b iw lh iy iz ja li jc jd je lj jg jh ji lk jk jl jm ll jo jp jq ha bi translated">一个<strong class="iv hi">纯函数</strong>是这样一个函数:</p><ul class=""><li id="f3d2" class="jr js hh iv b iw ix ja jb je jt ji ju jm jv jq jw jx jy jz bi translated">给定相同的输入，将总是返回相同的输出。</li><li id="dfca" class="jr js hh iv b iw ka ja kb je kc ji kd jm ke jq jw jx jy jz bi translated">不会产生副作用。</li></ul><p id="487c" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">So，<em class="lm">` console . log(double(5))；`</em>同<em class="lm">` console . log(10)；`</em></p><p id="79fb" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">这是真的，因为<em class="lm"> `double()` </em>是一个纯函数，但是如果<em class="lm"> `double()` </em>有副作用，比如将值保存到磁盘或记录到控制台，你不能简单地将<em class="lm"> `double(5)` </em>替换为10而不改变其含义。</p><p id="0ab5" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">如果你想要引用透明，你需要使用纯函数。</p><blockquote class="lw"><p id="8629" class="lx ly hh bd lz ma mb mc md me mf jq dx translated">一个函数不纯的确凿证据是，如果不使用它的返回值调用它是有意义的。对于纯函数，那是一个noop。</p></blockquote><p id="2d7e" class="pw-post-body-paragraph it iu hh iv b iw mg iy iz ja mh jc jd je mi jg jh ji mj jk jl jm mk jo jp jq ha bi translated">我建议你偏爱纯函数。也就是说，如果使用纯函数来实现一个程序需求是可行的，那么你应该优先使用它们。纯函数接受一些输入，并基于该输入返回一些输出。它们是程序中最简单的可重用代码块。也许计算机科学中最重要的设计原则是KISS(保持简单，笨蛋)。我更喜欢简单明了。纯函数以最好的方式变得愚蠢而简单。</p><p id="495d" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">纯函数有许多有益的性质，并且形成了<strong class="iv hi">函数式编程</strong>的基础。纯函数完全独立于外部状态，因此，它们不受与共享可变状态有关的整类错误的影响。它们的独立性也使它们成为跨多个CPU和整个分布式计算集群进行并行处理的绝佳候选，这使得它们对于许多类型的科学和资源密集型计算任务来说是必不可少的。</p><p id="6ede" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">纯函数也非常独立——易于在代码中移动、重构和重组，使您的程序更加灵活，更能适应未来的变化。</p><h2 id="3d2e" class="km kn hh bd ko kp kq kr ks kt ku kv kw je kx ky kz ji la lb lc jm ld le lf lg bi translated">共享状态的问题是</h2><p id="5c44" class="pw-post-body-paragraph it iu hh iv b iw lh iy iz ja li jc jd je lj jg jh ji lk jk jl jm ll jo jp jq ha bi translated">几年前，我开发了一个应用程序，允许用户在数据库中搜索音乐艺术家，并将艺术家的音乐播放列表加载到网络播放器中。这大约是Google Instant登陆的时间，当你输入搜索查询时，它会显示即时搜索结果。AJAX驱动的自动完成突然风靡一时。</p><p id="ffa7" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">唯一的问题是用户输入的速度经常比API自动完成搜索响应返回的速度快，这导致了一些奇怪的错误。这将触发竞争条件，新的建议将被过时的建议所取代。</p><p id="cc5f" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">为什么会这样？因为每个AJAX成功处理程序都有权直接更新显示给用户的建议列表。最慢的AJAX请求总是通过盲目替换结果来赢得用户的注意，即使那些被替换的结果可能是更新的。</p><p id="99f5" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">为了解决这个问题，我创建了一个建议管理器——管理查询建议状态的单一数据源。它知道当前有一个挂起的AJAX请求，当用户输入新内容时，挂起的AJAX请求会在新请求发出之前被取消，因此每次只有一个响应处理程序能够触发UI状态更新。</p><p id="74b2" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">任何种类的异步操作或并发都可能导致类似的竞争情况。如果输出依赖于不可控事件的序列(如网络、设备延迟、用户输入、随机性等)，就会发生竞争情况。事实上，如果你使用共享状态，并且该状态依赖于根据不确定因素而变化的序列，对于所有意图和目的，输出是不可能预测的，这意味着不可能正确地测试或完全理解。正如Martin oder sky(Scala的创始人)所说:</p><blockquote class="ml mm mn"><p id="c93b" class="it iu lm iv b iw ix iy iz ja jb jc jd mo jf jg jh mp jj jk jl mq jn jo jp jq ha bi translated"><em class="hh">不确定性=并行处理+可变状态</em></p></blockquote><p id="68bc" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">程序确定性通常是计算中的一个理想属性。也许您认为自己没问题，因为JS在单线程中运行，因此不受并行处理问题的影响，但是正如AJAX示例所展示的，单线程JS引擎并不意味着没有并发性。相反，JavaScript中有很多并发的来源。API I/O、事件监听器、web workers、iframes和超时都可能在程序中引入不确定性。将这一点与共享状态结合起来，你就有了解决bug的方法。</p><p id="2e3f" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">纯函数可以帮助你避免这些错误。</p><h2 id="6d14" class="km kn hh bd ko kp kq kr ks kt ku kv kw je kx ky kz ji la lb lc jm ld le lf lg bi translated">给定相同的输入，总是返回相同的输出</h2><p id="4688" class="pw-post-body-paragraph it iu hh iv b iw lh iy iz ja li jc jd je lj jg jh ji lk jk jl jm ll jo jp jq ha bi translated">使用我们的<em class="lm"> `double()` </em>函数，您可以用结果替换函数调用，并且程序将表示相同的内容— <em class="lm"> `double(5)` </em>将始终表示与您的程序中的<em class="lm"> `10` </em>相同的内容，无论上下文如何，无论您调用它多少次或何时。</p><p id="0ad7" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">但是你不能说所有的功能都是一样的。有些函数依赖于传递的参数以外的信息来产生结果。</p><p id="742e" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">考虑这个例子:</p><pre class="kg kh ki kj fd ln lo lp lq aw lr bi"><span id="62bf" class="km kn hh lo b fi ls lt l lu lv">Math.random(); // =&gt; 0.4011148700956255<br/>Math.random(); // =&gt; 0.8533405303023756<br/>Math.random(); // =&gt; 0.3550692005082965</span></pre><p id="c41c" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">即使我们没有向任何函数调用传递任何参数，它们都产生了不同的输出，这意味着<em class="lm"> `Math.random()` </em>是<strong class="iv hi">而不是纯粹的</strong>。</p><p id="a2e4" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><em class="lm"> `Math.random()` </em>每次运行它时都会产生一个介于0和1之间的新随机数，所以很明显，你不能在不改变程序含义的情况下用0.4011148700956255来替换它。</p><p id="a8b4" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">那每次都会产生相同的结果。当我们向计算机请求一个随机数时，通常意味着我们想要一个与上次不同的结果。一对骰子每一面都印着相同的数字有什么意义？</p><p id="455f" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">有时我们不得不向计算机询问当前时间。我们不会深入时间函数如何工作的细节。现在，只需复制以下代码:</p><pre class="kg kh ki kj fd ln lo lp lq aw lr bi"><span id="65a0" class="km kn hh lo b fi ls lt l lu lv">const time = () =&gt; new Date().toLocaleTimeString();</span><span id="9c4c" class="km kn hh lo b fi mr lt l lu lv">time(); // =&gt; "5:15:45 PM"</span></pre><p id="e9c0" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">如果用当前时间替换<em class="lm"> `time()` </em>函数调用会发生什么？</p><p id="ddc2" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">它总是说是同一个时间:函数调用被替换的时间。换句话说，它每天只能产生一次正确的输出，而且只有在函数被替换的时候运行程序。</p><p id="240f" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">所以很明显，<em class="lm"> `time()` </em>并不像我们的<em class="lm"> `double()` </em>函数。</p><p id="03d9" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">一个函数只有在给定相同的输入，它总是产生相同的输出时才是纯的。您可能还记得代数课上的这条规则:相同的输入值总是映射到相同的输出值。但是，许多输入值可能映射到同一个输出值。比如下面的函数<strong class="iv hi">就是纯</strong>:</p><pre class="kg kh ki kj fd ln lo lp lq aw lr bi"><span id="fe5b" class="km kn hh lo b fi ls lt l lu lv">const highpass = (cutoff, value) =&gt; value &gt;= cutoff;</span></pre><p id="3f57" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">相同的输入值将始终映射到相同的输出值:</p><pre class="kg kh ki kj fd ln lo lp lq aw lr bi"><span id="7c76" class="km kn hh lo b fi ls lt l lu lv">highpass(5, 5); // =&gt; true<br/>highpass(5, 5); // =&gt; true<br/>highpass(5, 5); // =&gt; true</span></pre><p id="a728" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">许多输入值可能映射到同一个输出值:</p><pre class="kg kh ki kj fd ln lo lp lq aw lr bi"><span id="4e85" class="km kn hh lo b fi ls lt l lu lv">highpass(5, 123); // true<br/>highpass(5, 6);   // true<br/>highpass(5, 18);  // true</span><span id="33da" class="km kn hh lo b fi mr lt l lu lv">highpass(5, 1);   // false<br/>highpass(5, 3);   // false<br/>highpass(5, 4);   // false</span></pre><p id="f475" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">一个纯函数不能依赖于任何外部可变状态，因为它不再是确定性的或透明的。</p><h1 id="4f73" class="ms kn hh bd ko mt mu mv ks mw mx my kw mz na nb kz nc nd ne lc nf ng nh lf ni bi translated">纯函数不会产生副作用</h1><p id="133f" class="pw-post-body-paragraph it iu hh iv b iw lh iy iz ja li jc jd je lj jg jh ji lk jk jl jm ll jo jp jq ha bi translated">一个纯粹的功能不会产生副作用，这意味着它不能改变任何外部状态。</p><h1 id="1f41" class="ms kn hh bd ko mt mu mv ks mw mx my kw mz na nb kz nc nd ne lc nf ng nh lf ni bi translated">不变</h1><p id="5c1c" class="pw-post-body-paragraph it iu hh iv b iw lh iy iz ja li jc jd je lj jg jh ji lk jk jl jm ll jo jp jq ha bi translated">JavaScript的对象参数是引用，这意味着如果一个函数要改变一个对象或数组参数的属性，这将改变该函数外部可访问的状态。纯函数不能改变外部状态。</p><p id="dbd3" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">考虑一下这个突变，<strong class="iv hi">不纯</strong> <em class="lm"> `addToCart()` </em>函数:</p><figure class="kg kh ki kj fd ii"><div class="bz dy l di"><div class="nj kl l"/></div></figure><p id="9b7f" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">它通过传入一个购物车、要添加到购物车中的商品以及商品数量来工作。然后，该函数返回相同的购物车，其中添加了商品。</p><p id="0127" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">问题是，我们只是改变了一些共享状态。其他函数可能依赖于cart对象状态，这是调用该函数之前的状态，现在我们已经改变了共享状态，我们必须担心如果我们改变调用函数的顺序，会对程序逻辑产生什么影响。重构代码可能会导致错误出现，这可能会破坏订单，并导致客户不满。</p><p id="e3d0" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">现在考虑这个版本:</p><figure class="kg kh ki kj fd ii"><div class="bz dy l di"><div class="nj kl l"/></div></figure><p id="812c" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">在这个例子中，我们有一个嵌套在对象中的数组，这就是为什么我要进行深度克隆。这是比你通常要处理的更复杂的状态。对于大多数事情，你可以把它分解成更小的块。</p><p id="7148" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">例如，Redux允许您编写reducer，而不是处理每个reducer中的整个应用程序状态。结果是，每次您想更新应用程序状态的一小部分时，您不必创建整个应用程序状态的深度克隆。相反，您可以使用非破坏性数组方法，或<em class="lm"> `Object.assign()` </em>来更新应用程序状态的一小部分。</p><p id="3ef4" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">轮到你了。<a class="ae kf" href="http://codepen.io/ericelliott/pen/MyojLq?editors=0010" rel="noopener ugc nofollow" target="_blank">叉这支笔</a>，把不纯的函数改成纯函数。在不改变测试的情况下通过单元测试。</p><figure class="kg kh ki kj fd ii"><div class="bz dy l di"><div class="nk kl l"/></div></figure><h2 id="f08e" class="km kn hh bd ko kp kq kr ks kt ku kv kw je kx ky kz ji la lb lc jm ld le lf lg bi translated">探索该系列</h2><ul class=""><li id="b3c2" class="jr js hh iv b iw lh ja li je nl ji nm jm nn jq jw jx jy jz bi translated"><a class="ae kf" rel="noopener" href="/javascript-scene/master-the-javascript-interview-what-is-a-closure-b2f0d2152b36#.ecfskj935">什么是闭包？</a></li><li id="a716" class="jr js hh iv b iw ka ja kb je kc ji kd jm ke jq jw jx jy jz bi translated"><a class="ae kf" rel="noopener" href="/javascript-scene/master-the-javascript-interview-what-s-the-difference-between-class-prototypal-inheritance-e4cd0a7562e9#.h96dymht1">类和原型继承有什么区别？</a></li><li id="5846" class="jr js hh iv b iw ka ja kb je kc ji kd jm ke jq jw jx jy jz bi translated"><a class="ae kf" rel="noopener" href="/javascript-scene/master-the-javascript-interview-what-is-a-pure-function-d1c076bec976#.4256pjcfq">什么是纯函数？</a></li><li id="9469" class="jr js hh iv b iw ka ja kb je kc ji kd jm ke jq jw jx jy jz bi translated"><a class="ae kf" rel="noopener" href="/javascript-scene/master-the-javascript-interview-what-is-function-composition-20dfb109a1a0#.i84zm53fb">什么是函数构成？</a></li><li id="e45a" class="jr js hh iv b iw ka ja kb je kc ji kd jm ke jq jw jx jy jz bi translated"><a class="ae kf" rel="noopener" href="/javascript-scene/master-the-javascript-interview-what-is-functional-programming-7f218c68b3a0#.jddz30xy3">什么是函数式编程？</a></li><li id="415f" class="jr js hh iv b iw ka ja kb je kc ji kd jm ke jq jw jx jy jz bi translated"><a class="ae kf" rel="noopener" href="/javascript-scene/master-the-javascript-interview-what-is-a-promise-27fc71e77261#.aa7ubggsy">什么是承诺？</a></li><li id="dfb9" class="jr js hh iv b iw ka ja kb je kc ji kd jm ke jq jw jx jy jz bi translated"><a class="ae kf" rel="noopener" href="/javascript-scene/master-the-javascript-interview-soft-skills-a8a5fb02c466">软技能</a></li></ul><blockquote class="ml mm mn"><p id="4b9e" class="it iu lm iv b iw ix iy iz ja jb jc jd mo jf jg jh mp jj jk jl mq jn jo jp jq ha bi translated">这篇帖子被收录在《作曲软件》一书中。<a class="ae kf" href="https://leanpub.com/composingsoftware" rel="noopener ugc nofollow" target="_blank"> <em class="hh"> <br/>买书</em> </a> <em class="hh"> | </em> <a class="ae kf" rel="noopener" href="/javascript-scene/composing-software-the-book-f31c77fc3ddc"> <em class="hh">索引</em></a><em class="hh">|</em><a class="ae kf" rel="noopener" href="/javascript-scene/why-learn-functional-programming-in-javascript-composing-software-ea13afc7a257"><em class="hh">&lt;上一张</em> </a> <em class="hh"> | </em> <a class="ae kf" rel="noopener" href="/javascript-scene/master-the-javascript-interview-what-is-functional-programming-7f218c68b3a0"> <em class="hh">下一张&gt; </em> </a></p></blockquote></div><div class="ab cl no np go nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ha hb hc hd he"><h1 id="5e7e" class="ms kn hh bd ko mt nv mv ks mw nw my kw mz nx nb kz nc ny ne lc nf nz nh lf ni bi translated">在EricElliottJS.com了解更多信息</h1><p id="d76c" class="pw-post-body-paragraph it iu hh iv b iw lh iy iz ja li jc jd je lj jg jh ji lk jk jl jm ll jo jp jq ha bi translated">EricElliottJS.com会员可以参加互动代码挑战视频课程。如果你还不是会员，今天就注册吧。</p></div><div class="ab cl no np go nq" role="separator"><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt nu"/><span class="nr bw bk ns nt"/></div><div class="ha hb hc hd he"><p id="9911" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><strong class="iv hi"> <em class="lm">埃里克·艾略特</em> </strong> <em class="lm">是一位科技产品和平台顾问，《T5】 <a class="ae kf" href="https://leanpub.com/composingsoftware" rel="noopener ugc nofollow" target="_blank"> <em class="lm">【作曲软件】</em></a><em class="lm"/><a class="ae kf" href="https://ericelliottjs.com" rel="noopener ugc nofollow" target="_blank"><em class="lm">【EricElliottJS.com】</em></a><em class="lm"/><a class="ae kf" href="https://devanywhere.io" rel="noopener ugc nofollow" target="_blank"><em class="lm">devanywhere . io</em></a><em class="lm">的联合创始人，以及dev团队导师。他曾为Adobe Systems、</em> <strong class="iv hi"> <em class="lm">、Zumba Fitness、</em> </strong> <em class="lm"> </em> <strong class="iv hi"> <em class="lm">【华尔街日报、</em></strong><em class="lm"/><strong class="iv hi"><em class="lm">【ESPN、</em></strong><em class="lm"/><strong class="iv hi"><em class="lm">【BBC】</em></strong><em class="lm">等顶级录音艺人和包括</em> <strong class="iv hi"> <em class="lm"> Usher、【Metallica】</em></strong></em></p><p id="61a2" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">他和世界上最美丽的女人享受着与世隔绝的生活方式。</p></div></div>    
</body>
</html>