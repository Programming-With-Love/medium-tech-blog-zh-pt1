<html>
<head>
<title>Write Once, Run Everywhere Tests on Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">编写一次，在Android上到处运行测试</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/write-once-run-everywhere-tests-on-android-88adb2ba20c5?source=collection_archive---------2-----------------------#2018-11-01">https://medium.com/androiddevelopers/write-once-run-everywhere-tests-on-android-88adb2ba20c5?source=collection_archive---------2-----------------------#2018-11-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/b042bcf8205e597154427ae7bafe8644.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xNQHxXBX-1RQCPM3LYa3wA.png"/></div></div></figure><p id="d2f1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在今年的谷歌I/O大会上，我们推出了AndroidX测试，这是<a class="ae jn" href="https://developer.android.com/jetpack/" rel="noopener ugc nofollow" target="_blank"> Jetpack </a>的一部分。今天我们很高兴地宣布<a class="ae jn" href="https://developer.android.com/training/testing/release-notes" rel="noopener ugc nofollow" target="_blank"> v1.0.0 </a>最终版和Robolectric v4.0一起发布。作为1.0.0版的一部分，所有的AndroidX测试现在都是<a class="ae jn" href="https://github.com/android/android-test" rel="noopener ugc nofollow" target="_blank">开源</a>。</p><p id="488e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">AndroidX Test提供跨测试环境的通用测试API，包括仪器和机器人测试。它包括现有的Android JUnit 4支持、Espresso view交互库和几个新的关键测试API。这些API可用于真实和虚拟设备上的仪器测试。从Robolectric 4.0开始，它们也可以用于本地JVM测试。</p><p id="cec5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">考虑下面的用例，我们启动登录屏幕，输入有效的用户名和密码，并确保我们被带到主屏幕。</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="9e0e" class="jx jy hh jt b fi jz ka l kb kc">@RunWith(AndroidJUnit4::class)<br/>class LoginActivityTest {</span><span id="3aee" class="jx jy hh jt b fi kd ka l kb kc">  @Test fun successfulLogin() {<br/>    // GIVEN<br/>    val scenario = <br/>        ActivityScenario.launch(LoginActivity::class.java)</span><span id="8a85" class="jx jy hh jt b fi kd ka l kb kc">    // WHEN<br/>    onView(withId(R.id.user_name)).perform(typeText(“test_user”))<br/>    onView(withId(R.id.password))<br/>        .perform(typeText(“correct_password”))<br/>    onView(withId(R.id.button)).perform(click())</span><span id="62b7" class="jx jy hh jt b fi kd ka l kb kc">    // THEN<br/>    assertThat(getIntents().first())<br/>        .hasComponentClass(HomeActivity::class.java)<br/> }<br/>}</span></pre><p id="1e40" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">让我们逐步完成测试:</p><ol class=""><li id="e9b9" class="ke kf hh ir b is it iw ix ja kg je kh ji ki jm kj kk kl km bi translated">我们使用新的<a class="ae jn" href="https://developer.android.com/reference/androidx/test/core/app/ActivityScenario" rel="noopener ugc nofollow" target="_blank"> ActivityScenario </a> API来启动LoginActivity。这将创建活动，并使其进入恢复状态，在此状态下，用户可以看到该活动并准备好输入。练习Scenario处理与系统的所有同步，并为您应该测试的常见场景提供支持，例如您的应用程序如何处理被系统销毁和重新创建的情况。</li><li id="176c" class="ke kf hh ir b is kn iw ko ja kp je kq ji kr jm kj kk kl km bi translated">我们使用Espresso view交互库在两个文本字段中输入文本，然后单击UI中的一个按钮。与ActivityScenario类似，Espresso为您处理多线程和同步，并提供一个可读且流畅的API来编写测试。</li><li id="807b" class="ke kf hh ir b is kn iw ko ja kp je kq ji kr jm kj kk kl km bi translated">我们使用新的<a class="ae jn" href="https://developer.android.com/reference/androidx/test/espresso/intent/Intents.html#getIntents()" rel="noopener ugc nofollow" target="_blank">intents . getintents()</a>Espresso API，该API返回捕获的意图列表。然后，我们使用IntentSubject.assertThat()来验证捕获的意图，这是新的Android真理扩展的一部分。Android Truth扩展提供了一个富于表现力和可读性的API来验证基本Android框架对象的状态。</li></ol><p id="c289" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这个测试可以在使用Robolectric或任何物理或虚拟设备的本地JVM上运行。</p><p id="0f04" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要在Android设备上运行它，请将它放在您的“androidTest”源根目录中，并附带以下依赖项:</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="e7be" class="jx jy hh jt b fi jz ka l kb kc">androidTestImplementation(“androidx.test:runner:1.1.0”)<br/>androidTestImplementation(“androidx.test.ext:junit:1.0.0”)<br/>androidTestImplementation(“androidx.test.espresso:espresso-intents:3.1.0”)<br/>androidTestImplementation(“androidx.test.espresso:espresso-core:3.1.0”)<br/>androidTestImplementation(“androidx.test.ext:truth:1.0.0”)</span></pre><p id="13f1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在物理或虚拟设备上运行让您确信您的代码可以正确地与Android系统交互。然而，随着测试用例数量的增加，您开始牺牲测试执行时间。您可能决定只在真实设备上运行一些较大的测试，而在模拟器上运行大量较小的单元测试，比如Robolectric，它可以在本地JVM上更快地运行测试。</p><p id="0f9e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要使用Robolectric simulator在本地JVM上运行测试，请将测试放在“test”源根目录中，并将以下行添加到gradle.build中:</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="5651" class="jx jy hh jt b fi jz ka l kb kc">testImplementation(“androidx.test:runner:1.1.0”)<br/>testImplementation(“androidx.test.ext:junit:1.0.0”)<br/>testImplementation(“androidx.test.espresso:espresso-intents:3.1.0”)<br/>testImplementation(“androidx.test.espresso:espresso-core:3.1.0”)<br/>testImplementation(“androidx.test.ext:truth:1.0.0”)<br/>testImplementation (“org.robolectric:robolectric:4.0”)</span><span id="bffd" class="jx jy hh jt b fi kd ka l kb kc">android {<br/>    testOptions.unitTests.includeAndroidResources = true<br/>}</span></pre><p id="bf4d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">模拟器和仪器之间测试API的统一打开了许多令人兴奋的可能性！我们也在Google I/O上宣布的Project Nitrogen将允许您在运行时环境之间无缝地移动测试。这意味着您将能够测试针对新的AndroidX测试API编写的测试，并在本地JVM、真实或虚拟设备，甚至是基于云的测试平台(如Firebase Test Lab)上运行它们。这将为开发人员提供获得快速、准确、可行的应用质量反馈的机会，我们对此感到非常兴奋。</p><p id="6465" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最后，我们很高兴地宣布，所有AndroidX组件都是完全开源的，我们期待着您的贡献。</p><h1 id="af49" class="ks jy hh bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">阅读更多</h1><p id="f190" class="pw-post-body-paragraph ip iq hh ir b is lp iu iv iw lq iy iz ja lr jc jd je ls jg jh ji lt jk jl jm ha bi translated">文档:【https://developer.android.com/testing T2】</p><p id="7ee8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">发行说明:</p><ul class=""><li id="fea8" class="ke kf hh ir b is it iw ix ja kg je kh ji ki jm lu kk kl km bi translated">AndroidX测试:<a class="ae jn" href="https://developer.android.com/training/testing/release-notes" rel="noopener ugc nofollow" target="_blank">https://developer . Android . com/training/testing/release-notes</a></li><li id="a0f1" class="ke kf hh ir b is kn iw ko ja kp je kq ji kr jm lu kk kl km bi translated">https://github.com/robolectric/robolectric/releases/</li></ul><p id="a88c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">https://github.com/robolectric/robolectric</p><p id="0471" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">安卓系统测试:<a class="ae jn" href="https://github.com/android/android-test" rel="noopener ugc nofollow" target="_blank">https://github.com/android/android-test</a></p></div></div>    
</body>
</html>