<html>
<head>
<title>Firebase Realtime Database — Flutter💙💛</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Firebase实时数据库——颤振💙💛</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/firebase-realtime-database-c627631f877e?source=collection_archive---------0-----------------------#2022-05-07">https://medium.com/google-developer-experts/firebase-realtime-database-c627631f877e?source=collection_archive---------0-----------------------#2022-05-07</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="ac88" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在我们的应用程序中，我们总是需要使用数据库。有许多提供数据库使用的服务提供商。Firebase就是其中之一，它为我们提供实时数据库。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/00a4fceb5fb31a9406bf509193db1a0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9lPUPMBTSj9J5wQPV3Uwjg.png"/></div></div></figure></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><p id="ee82" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Firebase实时数据库是<strong class="ig hi">，一个云托管的NoSQL数据库，让你以JSON格式在你的用户之间实时存储和同步数据</strong>。</p><p id="5448" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从实时数据库开始，我们有以下步骤:</p><ul class=""><li id="d899" class="jv jw hh ig b ih ii il im ip jx it jy ix jz jb ka kb kc kd bi translated">从Firebase控制台启用实时数据库</li><li id="cc7d" class="jv jw hh ig b ih ke il kf ip kg it kh ix ki jb ka kb kc kd bi translated">编写后端代码来处理实时数据库的读写</li><li id="0476" class="jv jw hh ig b ih ke il kf ip kg it kh ix ki jb ka kb kc kd bi translated">从用户界面调用函数来读写数据。</li></ul><p id="6bbd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以，让我们开始吧！</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="kj kk l"/></div></figure></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><h2 id="89d8" class="kl km hh bd kn ko kp kq kr ks kt ku kv ip kw kx ky it kz la lb ix lc ld le lf bi translated">步骤1:从Firebase控制台启用实时数据库</h2><p id="de62" class="pw-post-body-paragraph ie if hh ig b ih lg ij ik il lh in io ip li ir is it lj iv iw ix lk iz ja jb ha bi translated">进入你的<a class="ae ll" href="https://console.firebase.google.com/" rel="noopener ugc nofollow" target="_blank"> Firebase控制台</a>，从右边面板进入实时数据库。您将看到一个欢迎屏幕，上面有一个<code class="du lm ln lo lp b">Create Database</code>按钮。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lq"><img src="../Images/16d5e68bfbf42bc4f971052436123ccd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s9h-uHa4UbgVm6lu-3G3hA.png"/></div></div></figure><p id="7990" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">单击该按钮后，您将看到一个弹出窗口，可以选择区域以及是否要在测试或锁定模式下创建数据库。您可以根据自己的需求进行选择。</p><p id="2d42" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建数据库后，您将进入数据库页面。</p></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><p id="729a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们实际上是在继续我们在<a class="ae ll" href="https://abhishekdoshi26.medium.com/firebase-authentication-flutter-80e8f00338ac" rel="noopener"> Firebase认证</a>和<a class="ae ll" rel="noopener" href="/google-developer-experts/firestore-database-flutter-38c9a0cc77c7"> Firebase Firestore </a>文章中创建的应用程序。请随意查看，这是一个简单的登录/注册应用程序，我们需要一些用户信息。所以………是时候采取行动了！</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="kj kk l"/></div></figure></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><h2 id="cb61" class="kl km hh bd kn ko kp kq kr ks kt ku kv ip kw kx ky it kz la lb ix lc ld le lf bi translated">步骤2:后端代码</h2><p id="21d0" class="pw-post-body-paragraph ie if hh ig b ih lg ij ik il lh in io ip li ir is it lj iv iw ix lk iz ja jb ha bi translated">所以下一步是创建我们的英雄后端文件，它将处理实时数据库的读写。在开始使用实时数据库之前，我们必须创建一个方法来获取auth包中的当前user-id。</p><pre class="jd je jf jg fd lr lp ls lt aw lu bi"><span id="74ed" class="kl km hh lp b fi lv lw l lx ly">String getCurrentUserId() {<br/>    return _firebaseAuth.currentUser?.uid ?? '';<br/>  }</span></pre><p id="434d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在我们开始后端代码之前，让我们看看数据库是如何存储数据的。众所周知，Firestore数据库以集合文档格式存储数据，实时数据库稍有不同。它以<a class="ae ll" href="https://en.wikipedia.org/wiki/JSON" rel="noopener ugc nofollow" target="_blank"> JSON格式</a>存储数据，这使得我们在处理大量数据时变得非常容易，因为JSON是处理大量数据的最佳格式。因此，当我们想从我们的应用程序发送数据时，我们必须在数据结构<code class="du lm ln lo lp b">Map</code>中发送，用<code class="du lm ln lo lp b">String</code>作为键的数据类型，并且<code class="du lm ln lo lp b">value</code>的数据类型可以是动态的。这就是我们必须使用userID而不是email作为密钥的原因，因为email会包含特殊字符，而我们在世界上任何地方都没有见过特殊字符或email作为JSON的密钥🤯！</p><p id="f13a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，让我们为实时数据库创建一个单独的包，或者简单地创建一个文件来存储代码(然而，根据您的方便程度，包方法有利于使您的应用程序可伸缩)。您必须在您的<code class="du lm ln lo lp b">pubspec.yaml</code>文件中添加<code class="du lm ln lo lp b"><a class="ae ll" href="https://pub.dev/packages/firebase_database" rel="noopener ugc nofollow" target="_blank">firebase_database</a></code>包。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lz kk l"/></div></figure><p id="773c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在上面的代码中，对于write方法，我们从用户(从调用该函数的父函数)获取userId和数据。然后，我们创建实时数据库的实例(也称为FirebaseDatabase)。现在，如您所见，在创建实例的过程中，我们已经将<code class="du lm ln lo lp b">user/$userId</code>传递给了<code class="du lm ln lo lp b">ref</code>方法。因此，如果数据库不包含带有这个userID的JSON条目，它将创建一个，如果它已经存在，它将使用那个记录。然后我们简单地使用包中可用的<code class="du lm ln lo lp b">set</code>方法。</p><p id="1144" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于read方法，我们首先以同样的方式创建实例，然后使用<code class="du lm ln lo lp b">get</code>方法获取所提供用户的记录。现在，如果数据存在，我们用快照值创建一个映射(因为数据可以作为对象使用)，然后这里我们只返回用户名。</p></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><h2 id="1c9b" class="kl km hh bd kn ko kp kq kr ks kt ku kv ip kw kx ky it kz la lb ix lc ld le lf bi translated">步骤3:从UI调用函数</h2><p id="e90a" class="pw-post-body-paragraph ie if hh ig b ih lg ij ik il lh in io ip li ir is it lj iv iw ix lk iz ja jb ha bi translated">一旦数据库代码准备好了，就可以从我们的UI中使用这些函数了。所以我们的计划是在创建新帐户时调用<code class="du lm ln lo lp b">write</code>函数，在用户登录时调用<code class="du lm ln lo lp b">read</code>函数。简单！</p><p id="8cfe" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，在创建帐户时，我们使用以下代码片段:</p><pre class="jd je jf jg fd lr lp ls lt aw lu bi"><span id="6740" class="kl km hh lp b fi lv lw l lx ly">RealtimeDatabase.write(<br/>        userId: _authService.getCurrentUserId(),<br/>        data: {<br/>          'name': event.name,<br/>          'email': event.email,<br/>        },<br/>      );</span></pre><p id="471f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">正如我们之前使用bloc一样，我们只是从event类中获取名称和事件，并从我们在<code class="du lm ln lo lp b">authService</code>中创建的函数中获取userId。</p><p id="884a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，为了读取数据，我们调用read函数:</p><pre class="jd je jf jg fd lr lp ls lt aw lu bi"><span id="9117" class="kl km hh lp b fi lv lw l lx ly">final _name =<br/>          await RealtimeDatabase.read(userId: _authService.getCurrentUserId());</span></pre><p id="f1f7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里我们只是传递来自<code class="du lm ln lo lp b">authService</code>的用户标识</p></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><h2 id="fb2e" class="kl km hh bd kn ko kp kq kr ks kt ku kv ip kw kx ky it kz la lb ix lc ld le lf bi translated">让我们看看它在数据库中的样子</h2><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ma"><img src="../Images/e509392a9275112bfd1db5d5b75f7838.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ms46MMYHqR7V4GHAbNJ9ow.png"/></div></div></figure><p id="1293" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这里你可以看到，我们在树的根部有<code class="du lm ln lo lp b">users</code>,在里面，我们有一个带有用户id的用户，每个用户id有两个字段，电子邮件和姓名。</p></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><p id="5687" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本文中，我们看到了如何读写实时数据库中的数据。然而，我们可以使用许多其他方法来处理数据。请随意用官方文件<a class="ae ll" href="https://firebase.google.com/docs/database/flutter/read-and-write" rel="noopener ugc nofollow" target="_blank">检查它们。</a></p><p id="8b8b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">简单不是吗？我希望你从这篇文章中学到了一些新的东西！</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="mb kk l"/></div></figure></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><h2 id="b879" class="kl km hh bd kn ko kp kq kr ks kt ku kv ip kw kx ky it kz la lb ix lc ld le lf bi translated">希望你喜欢这篇文章！</h2><p id="6602" class="pw-post-body-paragraph ie if hh ig b ih lg ij ik il lh in io ip li ir is it lj iv iw ix lk iz ja jb ha bi translated">你可以通过克隆GitHub库来尝试一下！</p><p id="7c43" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">疑惑？随时留言<a class="ae ll" href="https://linktr.ee/abhishekdoshi26" rel="noopener ugc nofollow" target="_blank"> @AbhishekDoshi26 </a></p><figure class="jd je jf jg fd jh er es paragraph-image"><a href="https://www.buymeacoffee.com/abhishekdoshi26"><div class="er es mc"><img src="../Images/b087f76a48b4b718836c94f0b1a579e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/0*61fi0Fnrezoplo8_.png"/></div></a></figure></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><blockquote class="md"><p id="e323" class="me mf hh bd mg mh mi mj mk ml mm jb dx translated"><em class="mn">不要停止，直到你呼吸！💙<br/> - Abhishek Doshi </em></p></blockquote></div></div>    
</body>
</html>