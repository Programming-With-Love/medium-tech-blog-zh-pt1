<html>
<head>
<title>Kotlin/Native iOS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">科特林/原生iOS</h1>
<blockquote>原文：<a href="https://medium.com/quick-code/kotlin-native-ios-e6480299e02f?source=collection_archive---------0-----------------------#2018-12-28">https://medium.com/quick-code/kotlin-native-ios-e6480299e02f?source=collection_archive---------0-----------------------#2018-12-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="108b" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">1.用Gradle在Android Studio上配置K/N项目</h2></div><h1 id="6736" class="iw ix hh bd iy iz ja jb jc jd je jf jg in jh io ji iq jj ir jk it jl iu jm jn bi translated">最新更新🎉</h1><ul class=""><li id="3548" class="jo jp hh jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf bi translated">2019年3月1日</li><li id="ecb3" class="jo jp hh jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated">科特林</li><li id="283b" class="jo jp hh jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated">Gradle 5.1.1</li><li id="388f" class="jo jp hh jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated">Android Studio 3.3</li></ul><h1 id="9086" class="iw ix hh bd iy iz ja jb jc jd je jf jg in jh io ji iq jj ir jk it jl iu jm jn bi translated">项目配置</h1><p id="a462" class="pw-post-body-paragraph kl km hh jq b jr js ii kn jt ju il ko jv kp kq kr jx ks kt ku jz kv kw kx kb ha bi translated">首先从在Android Studio，ver 3.3上配置K/N项目开始。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es ky"><img src="../Images/cda96ef97154e50b5a6a3a07e43b4047.png" data-original-src="https://miro.medium.com/v2/resize:fit:1352/format:webp/1*co7xsvJWejRHZM7Hz8zBRw.png"/></div></figure><p id="8323" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">点击<code class="du ll lm ln lo b">Start a new Android Studio project</code>，选择<code class="du ll lm ln lo b">Empty Acticity</code>。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lp"><img src="../Images/49bc28df2f3cd66a0b02b39b1a7d2199.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ivDWhcUUdh_Z8Z1d8aLafg.png"/></div></div></figure><p id="ec92" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">接下来，输入</p><ul class=""><li id="24ff" class="jo jp hh jq b jr lg jt lh jv lu jx lv jz lw kb kc kd ke kf bi translated">申请名称，此处为<code class="du ll lm ln lo b">KotlinNativeiOS</code></li><li id="aac4" class="jo jp hh jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated">包名</li><li id="d659" class="jo jp hh jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated">保存位置</li><li id="ded5" class="jo jp hh jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated">语言<code class="du ll lm ln lo b">Kotlin</code></li><li id="fcb0" class="jo jp hh jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated">最低API级别，这里是API 28，但任何东西都可以。</li></ul><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es lp"><img src="../Images/1d2081e41c52dbcbd6a2ea96f95777a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gPD4cUVHJxo56mYn91exSA.png"/></div></div></figure><p id="0598" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">完成以上设置。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es lx"><img src="../Images/0dfacf6fc7db428b3d4072fa01f83bf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*KjPbIBsxJuZr7fbs7GfFUg.png"/></div></figure><p id="012f" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated"><code class="du ll lm ln lo b">KotlinNativeiOS</code>项目将自动打开，并执行梯度同步。之后，你会在左边的栏中看到上面的图片。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es ly"><img src="../Images/b37bcf062cab522ef2fa330ff2cc5dbd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1364/format:webp/1*OGwcpLnbkBkhrIVg3wQvMg.png"/></div></figure><p id="db01" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">要设置目录，将此<code class="du ll lm ln lo b">Android</code>选项卡切换到<code class="du ll lm ln lo b">Project</code>选项卡。</p><p id="703a" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">有一些目录和文件。比如，</p><ul class=""><li id="982a" class="jo jp hh jq b jr lg jt lh jv lu jx lv jz lw kb kc kd ke kf bi translated"><strong class="jq hi">。格雷尔/ </strong></li><li id="642d" class="jo jp hh jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated"><strong class="jq hi">。想法/ </strong></li><li id="6faf" class="jo jp hh jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated"><strong class="jq hi"> app/ </strong></li><li id="2952" class="jo jp hh jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated"><strong class="jq hi">格雷尔/ </strong></li><li id="84c5" class="jo jp hh jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated"><strong class="jq hi"> build.gradle </strong></li><li id="b9c0" class="jo jp hh jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated">等等..</li></ul><p id="c1bc" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">让我们看看一些文件。</p><p id="8d18" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">在<code class="du ll lm ln lo b">build.gradle</code>中，<code class="du ll lm ln lo b">ext.kotlin_version = '1.3.20'</code>写成了<code class="du ll lm ln lo b">buildscript</code>。这表明我们显然在使用Kotlin版本1.3.20。现在，kot Lin 1 . 3 . 21版本已经推出。我们使用它，所以如果需要的话替换变量。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es lz"><img src="../Images/1a94e6e851816191079c7cad44d90716.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/1*gWxC9C8BES_x4kceVxyswQ.png"/></div></figure><p id="5f6d" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">在<code class="du ll lm ln lo b">gradle/wrapper/gradle-wrapper.properties</code>中，<code class="du ll lm ln lo b">distributionUrl</code>被定义。在我的情况下，<code class="du ll lm ln lo b">gradle-4.10-1-all.zip</code>被设定。我改成下面的。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es ma"><img src="../Images/2808f783d7a1915591284a3b89f73ed2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DpGmCfheyLi1toF9air4CQ.png"/></div></div></figure><p id="1985" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">然后，<code class="du ll lm ln lo b">Sync Now</code>按钮出现在顶部。点击它，gradle sync将开始。</p><h1 id="dff3" class="iw ix hh bd iy iz ja jb jc jd je jf jg in jh io ji iq jj ir jk it jl iu jm jn bi translated">创建共享模块</h1><p id="8e59" class="pw-post-body-paragraph kl km hh jq b jr js ii kn jt ju il ko jv kp kq kr jx ks kt ku jz kv kw kx kb ha bi translated">本节的目标是从Kotlin代码中创建一个iOS框架。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mb"><img src="../Images/63b9e047cb2dc39f709c2df9d0ddaf16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5qEYX4fScI5f_1Plg18oIw.png"/></div></div></figure><p id="74cd" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">右键单击KotlinNativeiOS目录。并选择新建-&gt;目录。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mc"><img src="../Images/e933dce09d575b63793f21d062bf3192.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Zmao_LRYEGfpRz7a8dbpbw.png"/></div></div></figure><p id="2264" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">输入<code class="du ll lm ln lo b">sharedNative</code>(或者任何你喜欢的名字)。该目录将成为共享模块。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es md"><img src="../Images/0d83468a560ea34bcb0a4d31bb6d7d49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XKrCVOwR-ygBW_5Kw1SU6Q.png"/></div></div></figure><p id="3d21" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">用同样的方法，创建<code class="du ll lm ln lo b">sharedNative/src/commonMain/kotlin</code>目录。</p><p id="8beb" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">并在<code class="du ll lm ln lo b">kotlin</code>目录下创建<code class="du ll lm ln lo b">common.kt</code>文件。我们在这里定义<code class="du ll lm ln lo b">helloWorld</code>功能如下。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es me"><img src="../Images/4ca6c9ee7ad0227eba1633646f504767.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QFi3-PienQMtglZO8BTw3g.png"/></div></div></figure><pre class="kz la lb lc fd mf lo mg mh aw mi bi"><span id="5269" class="mj ix hh lo b fi mk ml l mm mn">package org.kotlin.mpp.mobile</span><span id="49cb" class="mj ix hh lo b fi mo ml l mm mn">fun helloWorld() {<br/>    println("Hello World!")<br/>}</span></pre><p id="4766" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated"><strong class="jq hi">我们想从Swift </strong>调用这个函数。让我们更新一下剧本。</p><p id="c118" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">首先，我们需要将新项目添加到<code class="du ll lm ln lo b">settings.gradle</code>中，只需在末尾添加下面一行。</p><pre class="kz la lb lc fd mf lo mg mh aw mi bi"><span id="b72b" class="mj ix hh lo b fi mk ml l mm mn">include ':sharedNative'</span></pre><p id="8e02" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">接下来，创建<code class="du ll lm ln lo b">sharedNative/build.gradle</code>。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mp"><img src="../Images/830fbf62ca034263b666a421512a73f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1p-AhKgaofKTVfgbLXaXeQ.png"/></div></div></figure><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mq"><img src="../Images/429c10e97983338a6b157d6a1f61539e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Na7N3BDrYACX-AQuhmJHJg.png"/></div></div></figure><p id="2ab6" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">之后，写下面的代码。</p><pre class="kz la lb lc fd mf lo mg mh aw mi bi"><span id="1542" class="mj ix hh lo b fi mk ml l mm mn">apply plugin: 'kotlin-multiplatform'</span><span id="57f7" class="mj ix hh lo b fi mo ml l mm mn">buildscript {<br/>    ext.ios_framework_name = 'KotlinShared'<br/>}</span><span id="8894" class="mj ix hh lo b fi mo ml l mm mn">kotlin {<br/>    targets {<br/>        fromPreset(presets.iosX64, 'ios') {<br/>            binaries {<br/>                framework("$ios_framework_name") {<br/>                    embedBitcode('disable')<br/>                }<br/>            }<br/>        }<br/>    }<br/>    sourceSets {<br/>        commonMain.dependencies {<br/>            implementation 'org.jetbrains.kotlin:kotlin-stdlib-common'<br/>        }<br/>    }<br/>}</span></pre><p id="dd82" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">这是一个使用kotlin多平台的gradle脚本。预置是<code class="du ll lm ln lo b">iosX64</code>，对于ios模拟器，在这里。如果您想要为ios设备构建，请将此预设更改为<code class="du ll lm ln lo b">iosArm64</code>。定义以下变量可能会有所帮助。</p><pre class="kz la lb lc fd mf lo mg mh aw mi bi"><span id="c020" class="mj ix hh lo b fi mk ml l mm mn">final def iosTarget = System.getenv('SDK_NAME')?.startsWith("iphoneos") \<br/>                              ? presets.iosArm64 : presets.iosX64</span></pre><p id="2f60" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">但是，没关系。用presets.iosX64前进，这里需要<code class="du ll lm ln lo b">Sync Now</code>。</p><p id="9a3e" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">我们将创建框架。</p><p id="6af6" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">打开终端，转到KotlinNativeiOS根目录，或者使用Android Studio的终端。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mr"><img src="../Images/636de77ccc029f81510c8f6511e63094.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LZYZbV2kFpdC5cMbpstNNw.png"/></div></div></figure><p id="6f1c" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">我们在这里。接下来，运行以下命令。</p><pre class="kz la lb lc fd mf lo mg mh aw mi bi"><span id="67b4" class="mj ix hh lo b fi mk ml l mm mn">./gradlew :sharedNative:build</span></pre><p id="af16" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">gradlew命令可以运行<code class="du ll lm ln lo b">:Module</code>的<code class="du ll lm ln lo b">:task</code>。以上将执行构建共享的本地模块。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es ms"><img src="../Images/5f090e04b20b9b3158e9226f367167bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/format:webp/1*nqsLcu1JAVEaEqyL3QOZnw.png"/></div></figure><p id="c3c7" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">我们在<code class="du ll lm ln lo b">sharedNative/build/bin/ios</code>目录中找到了<strong class="jq hi">调试</strong>和<strong class="jq hi">发布</strong>目录。每个里面都有<code class="du ll lm ln lo b">.framework</code>。创建了框架🎉。</p><pre class="kz la lb lc fd mf lo mg mh aw mi bi"><span id="aaca" class="mj ix hh lo b fi mk ml l mm mn">ext.ios_framework_name = 'KotlinShared'</span></pre><p id="5373" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">我们在build.gradle中定义了一个上面的变量，并将其设置为<code class="du ll lm ln lo b">framework("$ios_framework_name")</code>。没有它默认的名字是<code class="du ll lm ln lo b">main.framework</code>。</p><p id="ec04" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">你看。同一目录中的dSYM。Crashlytics或其他服务使用此调试符号文件来标记崩溃日志。但是它只在调试时出现。对于发布，<a class="ae mt" href="https://github.com/JetBrains/kotlin-native/issues/2422" rel="noopener ugc nofollow" target="_blank">本期</a>报道。</p><p id="e272" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">你还需要一块积木。这是将框架打包到Xcode的任务。你的Xcode项目直接引用上述调试或发布目录中的框架并不好，因为它有构建配置<code class="du ll lm ln lo b">DEBUG</code>或<code class="du ll lm ln lo b">RELEASE</code>。框架引用应该根据它进行更改。</p><p id="96c4" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">接下来的任务就是为了这个。在<code class="du ll lm ln lo b">sharedNative/build.gradle</code>中定义该任务。</p><figure class="kz la lb lc fd ld"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="542a" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">同理，<code class="du ll lm ln lo b">Sync Now</code>也运行这个任务。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es mw"><img src="../Images/f2e8bc5d612dee90e25e7512a26d8612.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5CeGMm9Xpq9ocePclugT1A.png"/></div></div></figure><p id="dde2" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">或者，点击此按钮进行<code class="du ll lm ln lo b">Gradle Sync</code>。</p><pre class="kz la lb lc fd mf lo mg mh aw mi bi"><span id="6bde" class="mj ix hh lo b fi mk ml l mm mn">./gradlew :sharedNative:packForXcode</span></pre><p id="3904" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">该命令执行上面定义的<code class="du ll lm ln lo b">sharedNative</code>模块的<code class="du ll lm ln lo b">packForXcode</code>任务。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es mx"><img src="../Images/eb71766c920c5fd16871459c3c95820c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*VUCJZYZzhcdhJ9gpTfG99A.png"/></div></figure><p id="c532" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">最后，<code class="du ll lm ln lo b">xcode-frameworks</code>目录和框架出现。Xcode会引用这个框架。<a class="ae mt" href="https://blog.coursesity.com/best-kotlin-tutorials/" rel="noopener ugc nofollow" target="_blank"> Kotlin教程</a>是Android初学者了解更多Kotlin的好方法。</p><h1 id="9561" class="iw ix hh bd iy iz ja jb jc jd je jf jg in jh io ji iq jj ir jk it jl iu jm jn bi translated">Xcode中的Hello World</h1><p id="f3b4" class="pw-post-body-paragraph kl km hh jq b jr js ii kn jt ju il ko jv kp kq kr jx ks kt ku jz kv kw kx kb ha bi translated">在本节中，我们调用sharedNative framework的helloWorld()函数。但是，这并不困难。简单来说，它只是框架的一个功能。它是否是从这里的科特林生成的并不重要。</p><p id="2836" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">所以，我想介绍一些小技巧。</p><ul class=""><li id="28b2" class="jo jp hh jq b jr lg jt lh jv lu jx lv jz lw kb kc kd ke kf bi translated">相对路径适用于Xcode项目中的<code class="du ll lm ln lo b">xcode-frameworks</code>。</li><li id="0e76" class="jo jp hh jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated"><code class="du ll lm ln lo b">packForXcode</code>在<em class="my">构建阶段的<code class="du ll lm ln lo b">Compile Sources</code>之前。</em></li></ul><h2 id="0351" class="mj ix hh bd iy mz na nb jc nc nd ne jg jv nf ng ji jx nh ni jk jz nj nk jm nl bi translated">相对路径</h2><p id="beec" class="pw-post-body-paragraph kl km hh jq b jr js ii kn jt ju il ko jv kp kq kr jx ks kt ku jz kv kw kx kb ha bi translated">首先，用这个配置创建<code class="du ll lm ln lo b">KotlinNativeiOS/ios</code>目录和Xcode项目。</p><ul class=""><li id="c982" class="jo jp hh jq b jr lg jt lh jv lu jx lv jz lw kb kc kd ke kf bi translated">单一视图应用程序</li><li id="3fb0" class="jo jp hh jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated">产品名称:SampleiOS</li><li id="566b" class="jo jp hh jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated">语言:Swift</li></ul><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es nm"><img src="../Images/b2414bd742243d58f5146b2d4b1008d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*cKv-6AOGUPM4nhXtW-5N3A.png"/></div></figure><p id="11fc" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">和上面一样，<code class="du ll lm ln lo b">.xcodeproj</code>路径是相对于共享目录(其中的框架)的。路径是<code class="du ll lm ln lo b">$SRCROOT/../../sharedNative</code>。使用相对路径，我们可以用环境变量配置Xcode设置。</p><p id="ea1e" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">K/N生成动态框架，所以嵌入到二进制中。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es nn"><img src="../Images/de82d9ec2277718e2fa3131bd49049cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qmqMwbbdWZ2Lp1mQYWrTEg.png"/></div></div></figure><p id="a8f9" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">移动到Xcode项目的<code class="du ll lm ln lo b">General</code>标签。在<code class="du ll lm ln lo b">Embedded Binaries</code>部分，点击<code class="du ll lm ln lo b">+</code>并点击<code class="du ll lm ln lo b">Add Other...</code>。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es no"><img src="../Images/d886dcb9f2d23dd52acc48cf6caae9c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OOMFJdwYwAeWrS3msa2PTQ.png"/></div></div></figure><p id="4350" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">在<code class="du ll lm ln lo b">xcode-frameworks</code>目录中选择框架。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es np"><img src="../Images/919434553660def12e3c9ae63f969abb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nGAqsxjIXk7bzknwlW_oLw.png"/></div></div></figure><p id="925e" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">创建参考。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es nq"><img src="../Images/634c5713f4ea1af4002cfcbfe081265c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qrQ36-9phHBCtRb6Jxp5DA.png"/></div></div></figure><p id="3600" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">完成嵌入。</p><p id="7e83" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">现在我们需要将这个路径添加到<code class="du ll lm ln lo b">Framework Search Path</code>中。在这里，我使用xcconfig文件。右击SampleiOS组并选择<code class="du ll lm ln lo b">Configuration Settings File</code></p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es nr"><img src="../Images/3176236464e1b525ba7023d45e3ab07b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VyyknSucxvhzt4LokBwfLQ.png"/></div></div></figure><p id="6d0b" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated"><code class="du ll lm ln lo b">Config.xcconfig</code>被创建。设置路径。</p><pre class="kz la lb lc fd mf lo mg mh aw mi bi"><span id="7a5b" class="mj ix hh lo b fi mk ml l mm mn">FRAMEWORK_SEARCH_PATHS = $(inherited) $SRCROOT/../../sharedNative/build/xcode-frameworks</span></pre><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es ns"><img src="../Images/8033afb54e2d1ab2a86893753fdc111a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RyZG_-HnxfOWzMDwJ3nxvw.png"/></div></div></figure><p id="80d3" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">告诉您的项目使用哪个配置文件。如果您已经在构建设置中直接设置了框架搜索路径，将其替换为<strong class="jq hi"> $(继承)</strong>将反映xcconfig文件的设置。</p><p id="d7b0" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">现在我们可以使用共享的本地框架。在ViewController.swift中，</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es nt"><img src="../Images/9f1401142bcc508ea49a5a0a079e0159.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fG1TG0_Jp85XmNi0gAy80A.png"/></div></div></figure><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es nu"><img src="../Images/afb0f00611255dcc191fdbd57bc2cefa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3cFmgwsUeDAnVg1MhooFSw.png"/></div></div></figure><p id="4c1c" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi">🎉 🎉 🎉</p><h2 id="9ce1" class="mj ix hh bd iy mz na nb jc nc nd ne jg jv nf ng ji jx nh ni jk jz nj nk jm nl bi translated"><code class="du ll lm ln lo b">packForXcode</code>在构建阶段的<code class="du ll lm ln lo b">Compile Sources</code>之前</h2><p id="5974" class="pw-post-body-paragraph kl km hh jq b jr js ii kn jt ju il ko jv kp kq kr jx ks kt ku jz kv kw kx kb ha bi translated">正如我上面提到的，<code class="du ll lm ln lo b">packForXcode</code>是一个渐变的任务，将框架转换成一个适当配置的框架，<code class="du ll lm ln lo b">DEBUG</code>或<code class="du ll lm ln lo b">RELEASE</code>。</p><p id="2d8d" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">它应该在编译源代码之前运行。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es nv"><img src="../Images/55f8b4af7467eb8ee4571e90b7e79ff8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kPPycIBunWwu1uq9b7XPVw.png"/></div></div></figure><p id="9b9b" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">在构建阶段，添加新的运行脚本阶段。它是作为运行脚本生成的。我把它改名为<strong class="jq hi">科特林/原生</strong>。脚本如下。</p><pre class="kz la lb lc fd mf lo mg mh aw mi bi"><span id="71f4" class="mj ix hh lo b fi mk ml l mm mn">cd $SRCROOT/../../sharedNative/build/xcode-frameworks</span><span id="2a67" class="mj ix hh lo b fi mo ml l mm mn">./gradlew :sharedNative:packForXCode -PXCODE_CONFIGURATION=${CONFIGURATION}</span></pre><p id="65e7" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated"><strong class="jq hi">拖动将前一阶段移动到编译源阶段</strong>。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lq lr di ls bf lt"><div class="er es nw"><img src="../Images/feecd954bc4ef7413ed4d6ae6271a1ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W35q43zvTAMYkxuSMTIX_w.png"/></div></div><figcaption class="nx ny et er es nz oa bd b be z dx">Kotlin/Native Run Script Phase</figcaption></figure><p id="8a07" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">检查您是否可以成功构建。</p><h2 id="8624" class="mj ix hh bd iy mz na nb jc nc nd ne jg jv nf ng ji jx nh ni jk jz nj nk jm nl bi translated">摘要</h2><p id="421e" class="pw-post-body-paragraph kl km hh jq b jr js ii kn jt ju il ko jv kp kq kr jx ks kt ku jz kv kw kx kb ha bi translated">我解释了如何配置Kotlin/Native项目，由Android Studio设置，由Gradle构建，在Xcode中使用框架。</p><p id="d7a0" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">现在，你可以把Kotlin代码转换成Swift(严格的Objective-C)。所以尝试你想做的任何事情，比如使用协程。</p><p id="6799" class="pw-post-body-paragraph kl km hh jq b jr lg ii kn jt lh il ko jv li kq kr jx lj kt ku jz lk kw kx kb ha bi translated">我有其他文章主要集中在实际使用。</p><ul class=""><li id="019f" class="jo jp hh jq b jr lg jt lh jv lu jx lv jz lw kb kc kd ke kf bi translated"><a class="ae mt" rel="noopener" href="/@yuyaHorita/kotlin-native-ios-8ad0a45a9b46"> <strong class="jq hi">创建简单框架，描述一些K/N特性。</strong> </a></li><li id="02b2" class="jo jp hh jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated"><a class="ae mt" rel="noopener" href="/@yuyaHorita/kotlin-native-ios-a1a73d7390fe"> <strong class="jq hi">【协程与K/N的不变性】</strong> </a></li><li id="a849" class="jo jp hh jq b jr kg jt kh jv ki jx kj jz kk kb kc kd ke kf bi translated"><strong class="jq hi">K/N+反应式编程+架构示例。(<em class="my">即将推出</em> ) </strong></li></ul></div></div>    
</body>
</html>