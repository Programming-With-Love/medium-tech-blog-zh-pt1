<html>
<head>
<title>Men-deploy Aplikasi Golang ke Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Men-deploy Aplikasi Golang ke Kubernetes</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.easyread.co/men-deploy-aplikasi-golang-ke-kubernetes-6c91c67f35b5?source=collection_archive---------5-----------------------#2018-12-24">https://medium.easyread.co/men-deploy-aplikasi-golang-ke-kubernetes-6c91c67f35b5?source=collection_archive---------5-----------------------#2018-12-24</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="b462" class="pw-subtitle-paragraph jl im in bd b jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc dk translated">Final Chapter dari Project <a class="ae kd" href="https://medium.com/easyread/christmas-tale-of-sofware-engineer-project-kube-xmas-9167ebca70d2" rel="noopener"> Kube-Xmas Series </a></h2></div><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="gh gi ke"><img src="../Images/903cd539e1650ad2d55d8f11f35c85fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5MJMZpsYyY5wCCXK"/></div></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk">Photo by <a class="ae kd" href="https://unsplash.com/@benwhitephotography?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Ben White</a> on <a class="ae kd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="fcb9" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Haloo guys, sepertinya saya sudah mulai kelelahan, pinggang saya sudah panas, dan sakit :D, sudah 2 hari berjalan dari tanggal 23 kemarin saya menulis, saya berhenti ketika jam makan dan jam tidur saja :D.</p><p id="4005" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Hari ini, ditanggal 24 Desember 2018 sore, mejelang malam natal, saya berencana menyelesaikan ini semua, dan menjadikannya seperti kado Natal saya kepada seluruh teman-engineer hehe :D <em class="lq"> *Gaya gw ya bapa, sok bet ğŸ¤¦â€â™‚ï¸ğŸ™„ </em></p><p id="b45b" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">So, tahap terakhir dari series ini adalah mendeploynya ke Kubernetes Cluster yang telah saya buat.</p><p id="8f55" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Baiklah, sebelum melangkah jauh, akan ada beberapa jenis konfigurasi yang ada dalam deployment ke kubernetes ini, khususnya yang saya gunakan.</p><p id="5053" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated"><strong class="kw io"> â€” Deployment </strong></p><pre class="kf kg kh ki gt lr ls lt lu aw lv bi"><span id="c3af" class="lw lx in ls b gy ly lz l ma mb">kind: <strong class="ls io">Deployment</strong><br/>apiVersion: apps/v1<br/>metadata:<br/>   name: redis<br/>   namespace: staging<br/>spec:<br/># dsb etc etc</span></pre><p id="2114" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Jika anda melihat konfigurasi seperti ini, maka ini adalah konfigurasi untuk membuat deployment object di kubernetes cluster. Tugasnya jika telah di apply ke kubernetes adalah, membuat pods berdasarkan specs deployment yang kita buat.</p><p id="364d" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Setelah apply ini, kita dapat mengecheck apakah berhasil di apply dengan command :</p><pre class="kf kg kh ki gt lr ls lt lu aw lv bi"><span id="6f7e" class="lw lx in ls b gy ly lz l ma mb">$ kubectl get deployments -n namespace</span></pre><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/84be20189c0fd400cd6e09200bf9153c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1016/format:webp/1*Eh95DuZ2q8ZMR89vHfZOgA.png"/></div></figure><p id="e5ae" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated"><strong class="kw io"> â€” Service </strong></p><pre class="kf kg kh ki gt lr ls lt lu aw lv bi"><span id="b053" class="lw lx in ls b gy ly lz l ma mb">kind: <strong class="ls io">Service</strong><br/>apiVersion: v1<br/>metadata:<br/>  name: redis<br/>  namespace: staging<br/>spec:<br/># dsb etc etc</span></pre><p id="4e10" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Nah, jika melihat konfigurasi seperti ini, maka ini merupakan konfigurasi untuk membuat service didalam cluster kubernetes. Tugasnya adalah membuat portal service agar dapat terkoneksi ke-suatu pods sehingga pods dapat diakses baik internal atau external. Jenisnya ada beberapa seperti <code class="fe md me mf ls b">NodePort</code> , <code class="fe md me mf ls b">ClusterIP</code> , <code class="fe md me mf ls b">LoadBalancer</code> . Jelasnya dapat kamu cari-tahu di documentasi resmi kubernetes.</p><p id="6083" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Untuk melihat service yang berjalan, kamu dapat melakukan command berikut:</p><pre class="kf kg kh ki gt lr ls lt lu aw lv bi"><span id="74cc" class="lw lx in ls b gy ly lz l ma mb">$ kubectl get services -n namespace</span></pre><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/7755a9d5c11ed36877f3d61e442acfdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1286/format:webp/1*T88mLjlJF2jteaJ9kfUjJw.png"/></div></figure><p id="92e4" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">â€” <strong class="kw io"> HorizontalPodAutoscaler </strong></p><pre class="kf kg kh ki gt lr ls lt lu aw lv bi"><span id="ed09" class="lw lx in ls b gy ly lz l ma mb">apiVersion: autoscaling/v2beta1<br/>kind: <strong class="ls io">HorizontalPodAutoscaler</strong><br/>metadata:<br/>  name: tweetor<br/>  namespace: staging<br/>spec:<br/># etc etc</span></pre><p id="a2aa" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Selanjutnya adalah HorizontalPodAutoscaler, ini seperti fitur yang ada dalam kubernetes. Tugasnya adalah membuat semacam auto-scaling (horizontal scale), dengan mengatur suatu kondisi, misal (CPU usage 70%) maka service ini akan membuat replica pods untuk menerima request baru.</p><p id="2d56" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated"><strong class="kw io"> â€” Ingress </strong></p><p id="1463" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Untuk ingress, sudah saya jelaskan di part sebelumnya. Formatnya di konfigurasi akan seperti berikut:</p><pre class="kf kg kh ki gt lr ls lt lu aw lv bi"><span id="89d0" class="lw lx in ls b gy ly lz l ma mb">apiVersion: extensions/v1beta1<br/>kind: Ingress<br/>metadata:<br/>  name: mock-tweet<br/>  namespace: staging<br/>  annotations:<br/>    kubernetes.io/ingress.class: nginx<br/>spec:<br/>  rules: <br/>  - host: mock.tweet.tweetor.xyz<br/>    http:<br/>      paths:<br/>        - path: /<br/>          backend:<br/>          serviceName: mock-tweet<br/>          servicePort: 8000</span></pre><p id="995b" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Tugasnya konfig ini adalah mendaftarkan pods kita ke ingress (agar dapat diaksess dari luar cluster). Jelasnya sudah saya utarakan di artikel sebelumnya <a class="ae kd" href="https://medium.com/10f2c9c0be16" rel="noopener"> disini </a> .</p><h2 id="0132" class="lw lx in bd mh mi mj dn mk ml mm dp mn ld mo mp mq lh mr ms mt ll mu mv mw mx bi translated">Deploy Redis Pod</h2><p id="bae7" class="pw-post-body-paragraph ku kv in kw b kx my jp kz la mz js lc ld na lf lg lh nb lj lk ll nc ln lo lp ig bi translated">Karena aplikasi tweetor ini bergantung pada Redis, maka pertama saya akan me-deploy redis ke cluter kubernetes saya.</p><p id="53f9" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated"><strong class="kw io"> Perhatian!! <br/> </strong> Sangat tidak di-anjurkan untuk deploy Database ke dalam cluster kubernetes. Karena setiap container yang dideploy di kubernetes sifatnya stateless (tidak menyimpan state), dan bisa dimatikan kapan aja.</p><p id="0730" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Untuk database sebaiknya di delploy di server yang terpisah (VPS). Namun karena saya menggunakan redis, dan juga untuk kebutuhan belajar, saya pun men-deploy redis dicluster kubernetes dalam satu pod.</p><p id="9028" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Karena redis ini akan diakses dalam satu cluster, jadi tidak perlu menambahkan ingress, yang saya lakukannya hanya menambahkan deployment nya ke dalam kubernetes cluster</p><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="8f8c" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Tidak perlu ribet, langsung apply saja config diatas.</p><pre class="kf kg kh ki gt lr ls lt lu aw lv bi"><span id="5e43" class="lw lx in ls b gy ly lz l ma mb">$ kubectl apply -f redis-deployment.yaml</span></pre><p id="bbf9" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Dan check hasilnya apakah berhasil</p><pre class="kf kg kh ki gt lr ls lt lu aw lv bi"><span id="1a01" class="lw lx in ls b gy ly lz l ma mb">$ kubectl get pods -n staging</span></pre><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/5d3edacaaf275d6f28a9b874a0226b2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1038/format:webp/1*_d8MtMUlzHerumQNYVzsDw.png"/></div></figure><p id="5545" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Jika sudah berhasil, seharusnya sudah dapat digunakan.</p><h2 id="512d" class="lw lx in bd mh mi mj dn mk ml mm dp mn ld mo mp mq lh mr ms mt ll mu mv mw mx bi translated">Deploy Tweetor API</h2><p id="ace2" class="pw-post-body-paragraph ku kv in kw b kx my jp kz la mz js lc ld na lf lg lh nb lj lk ll nc ln lo lp ig bi translated">Selanjutnya adalah deploy tweetor API kita, saya sudah buatkan deployment yamlnya berikut:</p><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="3db3" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Apply saja:</p><pre class="kf kg kh ki gt lr ls lt lu aw lv bi"><span id="fa4c" class="lw lx in ls b gy ly lz l ma mb">$ kubectl apply -f tweetor-deployments.yaml</span></pre><p id="b6ef" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Pastikan dia aktif</p><pre class="kf kg kh ki gt lr ls lt lu aw lv bi"><span id="e09b" class="lw lx in ls b gy ly lz l ma mb">$ kubectl get pods -n staging</span></pre><p id="4364" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Selanjutnya adalah menambahkan Ingress konfig yang juga sudah saya buat berikut:</p><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="nd ne l"/></div></figure><p id="15d3" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Apply ingressnya:</p><pre class="kf kg kh ki gt lr ls lt lu aw lv bi"><span id="a5dc" class="lw lx in ls b gy ly lz l ma mb">$ kubectl apply -f tweetor-ingress.yaml</span></pre><p id="8079" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Check registered IP nya:</p><pre class="kf kg kh ki gt lr ls lt lu aw lv bi"><span id="23b8" class="lw lx in ls b gy ly lz l ma mb">$ kubectl get ingress -n staging</span></pre><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/ad9b506025daa88706311fcdb393a65d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*Bc6W4152xxX9hR0-myCMYg.png"/></div></figure><p id="d3ad" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Selanjutnya menambahkaan IP addressnya: <code class="fe md me mf ls b">35.240.157.49</code> ke DNS kita, kenapa bisa sama denga IP mock-tweet? Karena IP ini adalah IP ingress NGINX yang sudah kita configurasi sebelumnya. Nah, selanjutnya tugas si NGINX yang me-forward semua request by domain-name.</p><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/71b5a57097d2b317ff74d95b141015a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*fTxi3dLxBujktAZ1KLxVgA.png"/></div></figure><p id="448f" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Tunggu beberapa menit sembari me-ngecheck degan <code class="fe md me mf ls b">dig tweet.tweetor.xyz</code></p><figure class="kf kg kh ki gt kj gh gi paragraph-image"><div role="button" tabindex="0" class="kk kl di km bf kn"><div class="gh gi ni"><img src="../Images/fdc5f3709df47b4853b808abe92732a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V7yjNdt0Fh7-U2HI9wZtmg.png"/></div></div></figure><p id="fb57" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Nah setelah selesai, seharusnya API kita sudah bisa diakses dan digunakan baik lewat postman atau lewat curl.</p><pre class="kf kg kh ki gt lr ls lt lu aw lv bi"><span id="48fe" class="lw lx in ls b gy ly lz l ma mb">$ curl tweet.tweetor.xyz/tweets<br/>[]</span></pre></div><div class="ab cl nj nk hr nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ig ih ii ij ik"><p id="9e00" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Sampai disini, semua sudah selesai. Saya mohon maaf atas kegabutan ini, tapi saya cukup senang karena cukup productive di malam natal kali ini.</p><p id="2da2" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">*Aplikasi mungkin tidak bisa jalan dengan benar, banyak kesalahan logic mungkin, kalau sempat akan saya perbaikin. Sepertinya sudah waktunya tidur, saya cukup lelah mengerjakan semua ini dalam 2 hari :D.</p><p id="6b7e" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated"><strong class="kw io"> Project repository dan konfigurasi dapat diunduh di </strong> <a class="ae kd" href="https://github.com/bxcodec/tweetor" rel="noopener ugc nofollow" target="_blank"> <strong class="kw io"> github.com/bxcodec/tweetor </strong> </a> .</p><p id="c359" class="pw-post-body-paragraph ku kv in kw b kx ky jp kz la lb js lc ld le lf lg lh li lj lk ll lm ln lo lp ig bi translated">Beberapa hal mungkin belum terlalu rapih, akan saya update seiring dengan waktu. Dan english version is coming soon :D</p><h2 id="cb2b" class="lw lx in bd mh mi mj dn mk ml mm dp mn ld mo mp mq lh mr ms mt ll mu mv mw mx bi translated">Previous chapter</h2><ul class=""><li id="5a06" class="nq nr in kw b kx my la mz ld ns lh nt ll nu lp nv nw nx ny bi translated"><a class="ae kd" href="https://medium.com/easyread/membuat-makefile-untuk-aplikasi-golang-5c2d19122b13" rel="noopener"> <strong class="kw io"> Membuat Makefile untuk Aplikasi Golang </strong> </a></li></ul><h1 id="a25e" class="nz lx in bd mh oa ob oc mk od oe of mn ju og jv mq jx oh jy mt ka oi kb mw oj bi translated">Merry Christmas Everyone!!!!</h1></div><div class="ab cl nj nk hr nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="ig ih ii ij ik"><figure class="kf kg kh ki gt kj"><div class="bz fp l di"><div class="ok ne l"/></div></figure></div></div>    
</body>
</html>