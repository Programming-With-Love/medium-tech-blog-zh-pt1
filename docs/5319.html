<html>
<head>
<title>Automatic List Partitioning: 12 Things Developers Will Love About Oracle Database 12c Release 2 Part 10</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">自动列表分区:开发人员会喜欢的12件事Oracle Database 12c第2版第10部分</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/automatic-list-partitioning-12-things-developers-will-love-about-oracle-database-12c-release-2-278804c3b555?source=collection_archive---------0-----------------------#2017-10-11">https://medium.com/oracledevs/automatic-list-partitioning-12-things-developers-will-love-about-oracle-database-12c-release-2-278804c3b555?source=collection_archive---------0-----------------------#2017-10-11</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="e4e4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当您有一个包含一组特定值的列并希望将其划分到单独的分区中时，列表分区非常有用。州、国家和货币都是很好的例子。</p><p id="58f7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">像这样的参考数据很少改变。但是他们确实会改变。比如2011年诞生的南苏丹。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jc"><img src="../Images/c913a1e8b31b72ac2dac28b744e04100.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*2R66bj9Dhe4TZDJh.png"/></div></figure><p id="1af7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您按国家列出分区数据，您需要保持分区是最新的。尤其是如果你让顾客提供他们自己的价值观。否则，您可能会遇到令人尴尬的错误，例如:</p><pre class="jd je jf jg fd jk jl jm jn aw jo bi"><span id="95a1" class="jp jq hh jl b fi jr js l jt ju">SQL Error: ORA-14400: inserted partition key does not map to any partition</span></pre><p id="b0f2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这当然会发生在凌晨2点。这是激怒随叫随到的DBA的好方法！</p><p id="8550" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了避免这种情况，您可以创建一个默认分区。任何新的值都会加入其中。这防止了插入引发异常。但是所有新值都进入默认分区。随着时间的推移，这将填满所有的新值。</p><p id="cbb6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以你需要一个常规的维护任务来根据需要分割数值。</p><p id="3297" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">12.2通过自动列表分区解决了这个问题。每次插入新值时，Oracle数据库都会动态创建新分区！</p><p id="3373" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要使用它，只需将automatic关键字放在分区列之后:</p><pre class="jd je jf jg fd jk jl jm jn aw jo bi"><span id="227a" class="jp jq hh jl b fi jr js l jt ju">create table orders ( <br/>  customer_id integer not null, <br/>  order_datetime date not null, <br/>  country_iso_code varchar2(2) not null <br/>) partition by list (country_iso_code) automatic ( <br/>  partition pUS values ('US'), <br/>  partition pGB values ('GB'), <br/>  partition pDE values ('DE'), <br/>  partition pFR values ('FR'), <br/>  partition pIT values ('IT') <br/>); </span><span id="5f9a" class="jp jq hh jl b fi jv js l jt ju">insert into orders values (1, sysdate, 'ZA'); </span><span id="5be2" class="jp jq hh jl b fi jv js l jt ju">select partition_name <br/>from   user_tab_partitions <br/>where  table_name = 'ORDERS'; </span><span id="fee7" class="jp jq hh jl b fi jv js l jt ju">PARTITION_NAME <br/>-------------- <br/>PDE <br/>PFR <br/>PGB <br/>PIT <br/>PUS <br/>SYS_P1386</span></pre><p id="fb84" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意，新分区将有一个系统生成的名称。所以你可能想把它们改成有意义的名字。您可以通过以下方式实现这一点:</p><pre class="jd je jf jg fd jk jl jm jn aw jo bi"><span id="d870" class="jp jq hh jl b fi jr js l jt ju">alter table orders rename partition SYS_P1386 to pZA;</span></pre><p id="6183" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要注意。默认分区和自动列表分区是互斥的选项:</p><pre class="jd je jf jg fd jk jl jm jn aw jo bi"><span id="8033" class="jp jq hh jl b fi jr js l jt ju">create table orders ( <br/>   customer_id integer not null, <br/>   order_datetime date not null, <br/>   country_iso_code varchar2(2) not null <br/>) partition by list (country_iso_code) automatic ( <br/>  partition pUS values ('US'), <br/>  partition pGB values ('GB'), <br/>  partition pDE values ('DE'), <br/>  partition pFR values ('FR'), <br/>  partition pIT values ('IT'), <br/>  partition pDEF values (default) <br/>); </span><span id="a61e" class="jp jq hh jl b fi jv js l jt ju">SQL Error: ORA-14851: DEFAULT [sub]partition cannot be specified for AUTOLIST [sub]partitioned objects.</span></pre><p id="d4e6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">仔细想想也说得通。但是如果您想将默认的列表分区迁移到自动分区，您需要经历一个过程。首先将所有内容从默认分区中分离出来，然后删除它:</p><pre class="jd je jf jg fd jk jl jm jn aw jo bi"><span id="619f" class="jp jq hh jl b fi jr js l jt ju">create table orders ( <br/>  customer_id integer not null, <br/>  order_datetime date not null, <br/>  country_iso_code varchar2(2) not null <br/>) partition by list (country_iso_code) ( <br/>  partition pUS values ('US'), <br/>  partition pGB values ('GB'), <br/>  partition pDE values ('DE'), <br/>  partition pFR values ('FR'), <br/>  partition pIT values ('IT'),   <br/>  partition pDEF values (default) <br/>); </span><span id="6e97" class="jp jq hh jl b fi jv js l jt ju">insert into orders values (1, sysdate, 'ZA'); <br/>insert into orders values (2, sysdate, 'JP'); </span><span id="8b14" class="jp jq hh jl b fi jv js l jt ju">alter table orders split partition pDEF into ( <br/>  partition pZA values ('ZA'), <br/>  partition pJP values ('JP'), <br/>  partition pDEF <br/>); <br/>alter table orders drop partition pDEF; <br/>alter table orders set partitioning automatic;</span></pre><p id="a9b5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请注意，这确实会留下一段没有默认分区的短暂时间。自动分区还没有准备好。因此，您可能需要暂停一会儿来做这件事！</p></div><div class="ab cl jw jx go jy" role="separator"><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb kc"/><span class="jz bw bk ka kb"/></div><div class="ha hb hc hd he"><p id="14b2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="kd">全文原载于2016年11月10日</em><a class="ae ke" href="https://blogs.oracle.com/sql/12-things-developers-will-love-about-oracle-database-12c-release-2" rel="noopener ugc nofollow" target="_blank"><em class="kd">【blogs.oracle.com】</em></a><em class="kd">。</em></p></div></div>    
</body>
</html>