<html>
<head>
<title>Enforcing Best Practices on Android with Lint</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Lint在Android上实施最佳实践</h1>
<blockquote>原文：<a href="https://medium.com/capital-one-tech/enforcing-best-practices-on-android-with-lint-f9931cd23b28?source=collection_archive---------5-----------------------#2019-10-07">https://medium.com/capital-one-tech/enforcing-best-practices-on-android-with-lint-f9931cd23b28?source=collection_archive---------5-----------------------#2019-10-07</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="cebe" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">通过构建时实施推动开发人员开发更好的代码</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/4151705b49acff197843d7923432d568.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eW_z766rYZRH8RyROgl1zg.jpeg"/></div></div></figure><p id="d49d" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">似乎每年Android最佳实践的前景都会发生巨大的变化，我们的代码也趋向于跟随这种趋势。然而，每次改变都会留下大量代码，你可能会称之为<em class="ke">“旧的做事方式”</em>，或者更糟糕的是，<em class="ke">“</em><strong class="jk hi"><em class="ke">糟糕的</em> </strong> <em class="ke">做事方式。”毫无疑问，在某些情况下，继续用老方法做事的诱惑会出现；作为人类，我们倾向于选择阻力最小的道路，坚持我们已经知道的东西，而不是学习新的东西。</em></p><p id="48e4" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">那么我们如何鼓励开发者以正确的方式做事呢？至少，我们如何<strong class="jk hi"> <em class="ke">防止</em> </strong>开发者以错误的方式做事？您可能会建议简单地废弃我们不再使用的组件或类，这使得在IDE中使用它没有吸引力。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es kf"><img src="../Images/3a6cef26e71c725ab0444eb6f7b385ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Ni7dg3z-C6ieSYNgc1inQ.png"/></div></div></figure><p id="5da9" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这种方法的问题在于它不是由编译器强制执行的。如果我不在乎它用起来难看，如果我的代码评审员也不在乎(或者如果他们只是错过了评审中的反对意见)，那么新的和不良的代码将被交付到产品中。即使有一种方法可以禁止这种行为，我也只想阻止被否决的代码在新的T21代码中使用，而不是旧的代码。你可以在这里看到关于为什么这不是一个好主意的讨论。</p><p id="c1c4" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><a class="ae kg" href="https://developer.android.com/studio/write/lint" rel="noopener ugc nofollow" target="_blank"> Android Lint </a>帮助我们解决了上述所有这些令人头疼的问题，因为它配备了扫描您的代码并针对您的代码报告自定义错误(或警告)的能力，同时还能够升级、降级、忽略和基准<strong class="jk hi">针对您的代码报告的问题。</strong></p><p id="1000" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">为了更清楚地理解这一点，我们将举一个简单的例子，这个例子的灵感来自我在Capital One为我们的Android旗舰应用程序代码库编写的一条规则。这条规则禁止在<code class="du kh ki kj kk b">AndroidManifest.xml</code>中的<code class="du kh ki kj kk b">activity</code>元素上使用<code class="du kh ki kj kk b"><a class="ae kg" href="https://developer.android.com/guide/topics/manifest/activity-element#config" rel="noopener ugc nofollow" target="_blank">configChanges</a></code>属性。为什么？这个属性可能会被错误地使用，以避免处理活动中的配置更改，这可能会导致糟糕的用户体验。因为事后修复这个问题通常是很重要的，所以我们希望在团队解决这些问题之前，防止将来再出现这种情况，同时保留现有的使用。</p><p id="04bd" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">值得注意的是，这个用例在没有lint的情况下比上面介绍的用例更难解决，因为我们不拥有<code class="du kh ki kj kk b">android:configChanges</code>属性，所以不支持弃用。</p></div><div class="ab cl kl km go kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ha hb hc hd he"><h2 id="c193" class="ks kt hh bd ku kv kw kx ky kz la lb lc jr ld le lf jv lg lh li jz lj lk ll lm bi translated">编写规则:阻止ActivityRestart</h2><p id="bd3b" class="pw-post-body-paragraph ji jj hh jk b jl ln ii jn jo lo il jq jr lp jt ju jv lq jx jy jz lr kb kc kd ha bi translated"><em class="ke">意图:不鼓励使用</em> <code class="du kh ki kj kk b">AndroidManifest.xml</code> <em class="ke">中的</em> <code class="du kh ki kj kk b">android:configChanges</code> <em class="ke">属性，并强制开发者以“正确”的方式处理配置变更。</em></p><p id="62df" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><strong class="jk hi"> <em class="ke">有一个Github存储库，可以在这里找到</em></strong><a class="ae kg" href="https://github.com/btrautmann/android-lint-blog" rel="noopener ugc nofollow" target="_blank"><strong class="jk hi"><em class="ke"/></strong></a><strong class="jk hi"><em class="ke">，它包含了我们将在下面编写的规则的所有代码。</em> </strong></p><p id="b75e" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">为了设置场景，下面是我们希望禁止的代码:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ls"><img src="../Images/7a7747c00d310c1d6f474351964947c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*917kUDTQzU7ConAcLx67RA.png"/></div></div></figure><p id="8b50" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">当开发人员向清单中添加具有该属性的类时，我们会向他们显示一个错误，并解释为什么不鼓励这种做法，以及他们应该做些什么来解决这个问题。</p><p id="165e" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">让我们从将下面的依赖项添加到一个新的java库模块开始(不过我们将使用<a class="ae kg" href="https://kotlinlang.org/" rel="noopener ugc nofollow" target="_blank"> Kotlin </a>🎉)所以我们可以使用lint APIs。请注意关于lint依赖项版本的注释。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lt"><img src="../Images/c54a5283aa9df9a7240001a718072c27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p05Eo7qJMiApVenLws_VRA.png"/></div></div></figure><p id="62e5" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">为了编写lint规则，我们需要编写一些代码:</p><ul class=""><li id="19d7" class="lu lv hh jk b jl jm jo jp jr lw jv lx jz ly kd lz ma mb mc bi translated"><strong class="jk hi">检测器:</strong>这就是“检查”违反我们规则的地方。lint扫描项目时会调用<code class="du kh ki kj kk b">Detector</code>中的方法。我们称我们的为<code class="du kh ki kj kk b">PreventingActivityRestartDetector</code>。</li><li id="7515" class="lu lv hh jk b jl md jo me jr mf jv mg jz mh kd lz ma mb mc bi translated">这是我们要检查的<code class="du kh ki kj kk b">Issue</code>。在我们的例子中，我们的<code class="du kh ki kj kk b">Issue</code>将被称为<code class="du kh ki kj kk b">PreventingActivityRestart</code>，并在使用<code class="du kh ki kj kk b">android:configChanges</code>属性的<code class="du kh ki kj kk b">AndroidManifest.xml</code>中的<code class="du kh ki kj kk b">activity</code>元素上被报告。</li><li id="cab1" class="lu lv hh jk b jl md jo me jr mf jv mg jz mh kd lz ma mb mc bi translated"><strong class="jk hi"> IssueRegistry </strong>:这个类为lint提供了我们想要扫描项目的<code class="du kh ki kj kk b">Issue</code>。在这个例子中，我们将把<code class="du kh ki kj kk b">PreventingActivityRestart</code> <code class="du kh ki kj kk b">Issue</code>添加到<code class="du kh ki kj kk b">IssueRegistry</code>中，告诉lint我们想要检查是否违反了那个<code class="du kh ki kj kk b">Issue</code>。</li></ul><p id="22cb" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">首先，让我们编写负责报告那个<code class="du kh ki kj kk b">Issue</code>的<code class="du kh ki kj kk b">Detector</code>。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mi"><img src="../Images/70f37c08c4239fb44590ec160ad179fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ReCHntHNZ5rBl6G5T0gbTQ.png"/></div></div></figure><p id="66a8" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">我们的<code class="du kh ki kj kk b">PreventingActivityRestartDetector</code>从<code class="du kh ki kj kk b">Detector</code>扩展而来，这样我们可以将它传递给lint，并在清单被扫描时得到通知(如何发生将在下面描述)。它还实现了<code class="du kh ki kj kk b">XmlScanner</code>，这是一个包含我们需要覆盖的方法的接口，以使我们的<code class="du kh ki kj kk b">Detector</code>能够处理XML文件。我们从中扩展的<code class="du kh ki kj kk b">Detector</code>类是<code class="du kh ki kj kk b">abstract</code>，包含了我们将被<code class="du kh ki kj kk b">XmlScanner</code>强制实现的功能。因为我们扩展了<code class="du kh ki kj kk b">Detector</code>，所以我们可以通过实现适当的方法来挑选我们感兴趣的代码片段。</p><p id="c179" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在这种情况下，我们对访问XML元素<code class="du kh ki kj kk b">activity</code>感兴趣，所以我们从<code class="du kh ki kj kk b">getApplicableElements()</code>返回它。当发现具有该名称的<code class="du kh ki kj kk b">element</code>时，我们希望得到通知，这样我们就可以做些什么，所以我们覆盖了<code class="du kh ki kj kk b">visitElement()</code>。在该方法中，我们将决定是否要报告<code class="du kh ki kj kk b">Issue</code>(定义如下)。在这种情况下，我们总是会这样做，但是在更复杂的规则中，如果周围的来源根据您的业务逻辑表明您不应该这样做，您可以决定不这样做。</p><p id="820d" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">接下来，让我们写出我们要报告的<code class="du kh ki kj kk b">Issue</code>:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mj"><img src="../Images/617b0fbae2c6c7a5940dc19b961bb603.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oVtHebph349_W7DmiiBDnQ.png"/></div></div></figure><p id="2120" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><code class="du kh ki kj kk b">Issue</code>上的大多数字段都是不言自明的。在大多数情况下，只要看一下字段类型的源代码，就可以澄清您可能有的任何问题。</p><p id="e6bf" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">也就是说，我不爱的领域之一是<code class="du kh ki kj kk b">Priority</code>。范围是1-10，这就留下了一个非常宽的任意取值范围。这个字段实际上只在处理lint基线时使用(您可以生成一个文件来告诉lint忽略现有的问题，这对从头开始很有用)，所以问自己的最好问题是:<em class="ke">“当我有时间清理现有的问题时，这个</em> <code class="du kh ki kj kk b">Issue</code> <em class="ke">有多重要？”</em></p><p id="c11a" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">正确处理的一个关键字段是<code class="du kh ki kj kk b">Implementation</code>字段，因为它包含<code class="du kh ki kj kk b">Detector</code>的<code class="du kh ki kj kk b">Class</code>和<code class="du kh ki kj kk b">Scope</code>。lint使用那个<code class="du kh ki kj kk b">Scope</code>将你的<code class="du kh ki kj kk b">Detector</code>应用到你的项目中的某些类型的文件，如果你做得不对，你的<code class="du kh ki kj kk b">Detector</code>上的<code class="du kh ki kj kk b">visitX()</code>方法将永远不会被调用。如果您在调试测试时看到这种行为，请仔细检查您的<code class="du kh ki kj kk b">Scope</code>！对于我们的自定义规则，我们使用<code class="du kh ki kj kk b">Scope.MANIFEST_SCOPE</code>，根据<code class="du kh ki kj kk b">Scope</code>源代码，它是一个:</p><blockquote class="mk ml mm"><p id="ba85" class="ji jj ke jk b jl jm ii jn jo jp il jq mn js jt ju mo jw jx jy mp ka kb kc kd ha bi translated"><em class="hh">用于仅受清单影响的探测器的范围设置</em></p></blockquote><p id="8b6c" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">换句话说，使用这个<code class="du kh ki kj kk b">Scope</code>确保我们的<code class="du kh ki kj kk b">Detector</code>能够访问项目中的<code class="du kh ki kj kk b">manifest</code>文件。</p><p id="8e5e" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">既然已经定义了<code class="du kh ki kj kk b">Issue</code>，我们可以在<code class="du kh ki kj kk b">visitElement()</code>中报告它</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mq"><img src="../Images/aefd5b44509d74f16fea60d191e76850.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i1V8cuw1upIVNUUHb1u8fg.png"/></div></div></figure><p id="283c" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">您可能注意到<code class="du kh ki kj kk b">report()</code>方法接受了一个<code class="du kh ki kj kk b">message</code>，我选择简单地重用了<code class="du kh ki kj kk b">Issue</code>的简要描述字段。在查看了与<a class="ae kg" href="http://www.androiddocs.com/tools/building/plugin-for-gradle.html" rel="noopener ugc nofollow" target="_blank"> Android Gradle插件</a>一起发布的内置规则的源代码后，似乎这个<code class="du kh ki kj kk b">message</code>字段是一个很好的地方，可以传达特定于您所报告的违规实例的信息。当<code class="du kh ki kj kk b">Issue</code>可以以多种方式出现时，这很有帮助。</p><p id="e82c" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">我们的<code class="du kh ki kj kk b">Issue</code>非常简单，所以我选择重复使用我们的通用消息。</p><p id="afb7" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">最后，我们把我们的<code class="du kh ki kj kk b">Issue</code>加到一个<code class="du kh ki kj kk b">IssueRegistry</code>上。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mr"><img src="../Images/89ad8cd891836c17d669190ec0c44b8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MMIoMfvKMlVaoC4KXT1QFA.png"/></div></div></figure><p id="1c5f" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><code class="du kh ki kj kk b">IssueRegistry</code>是lint将获取我们的自定义规则的地方。我们不会在代码中使用这个类，但是在下面的<code class="du kh ki kj kk b">build.gradle</code>中定义<code class="du kh ki kj kk b">jar</code>任务时，我们会使用这个类的限定路径。</p><p id="9fcb" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">通过在这里覆盖<code class="du kh ki kj kk b">api</code> <code class="du kh ki kj kk b">val</code>并返回<code class="du kh ki kj kk b">CURRENT_API</code>，我们表明我们的规则已经在当前的lint API上测试过了。</p><p id="4592" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在我们确信我们的规则有效之前，我们需要测试它。测试lint规则完全按照您想象的方式进行。我们编写违反规则的代码，并断言我们期望lint报告的警告。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ms"><img src="../Images/dda8bd246ed2cc5af1bd14e85229939f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nw4Pb7X1TYd8inv3W6bjaQ.png"/></div></div><figcaption class="mt mu et er es mv mw bd b be z dx">Pro tip: Use the indented() method on your TestFile for syntax highlighting.</figcaption></figure><p id="d614" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">为了确保lint规则的可靠性，我们还需要确保测试负面和边缘情况。</p></div><div class="ab cl kl km go kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ha hb hc hd he"><h2 id="4fdc" class="ks kt hh bd ku kv kw kx ky kz la lb lc jr ld le lf jv lg lh li jz lj lk ll lm bi translated">发布规则</h2><p id="fa85" class="pw-post-body-paragraph ji jj hh jk b jl ln ii jn jo lo il jq jr lp jt ju jv lq jx jy jz lr kb kc kd ha bi translated">为了让我们的新规则成为lint分析的一部分，我们需要将它发布到lint.jar，在运行<code class="du kh ki kj kk b">lint</code>任务时使用它。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mx"><img src="../Images/9d14fca918a7494b35aa2e906becba2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aFgiVeHeLRi__6p67pmwCQ.png"/></div></div></figure><p id="bca1" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><em class="ke">注意，这只是lint规则模块</em> <code class="du kh ki kj kk b">build.gradle</code> <em class="ke">的一个片段，其余的</em> <code class="du kh ki kj kk b">build.gradle</code> <em class="ke">都在上面链接的Github资源库中。</em></p></div><div class="ab cl kl km go kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ha hb hc hd he"><h2 id="c31d" class="ks kt hh bd ku kv kw kx ky kz la lb lc jr ld le lf jv lg lh li jz lj lk ll lm bi translated">导入规则</h2><p id="e3b9" class="pw-post-body-paragraph ji jj hh jk b jl ln ii jn jo lo il jq jr lp jt ju jv lq jx jy jz lr kb kc kd ha bi translated">我们的规则现在起作用了(我们确信这一点，因为我们进行了测试！)，所以还是让它进入项目吧。有几种方法可以做到这一点，但我建议将lint规则放在一个模块中，与代码库中的其他模块放在一起。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es my"><img src="../Images/84177a0e05d599438a1893b8d8e6877f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*AkLHLlJVHino0uQ0XiJfmw.png"/></div><figcaption class="mt mu et er es mv mw bd b be z dx"><em class="mz">Project structure with lint rules in their own module</em></figcaption></figure><p id="bbf3" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">有了这个设置，我们可以简单地构建lint规则模块，并使用<code class="du kh ki kj kk b">lintChecks</code>配置来指示我们希望在哪里应用规则。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es na"><img src="../Images/130c955478cb5018407cda6819801035.png" data-original-src="https://miro.medium.com/v2/resize:fit:1040/format:webp/1*CvZRhR3X7ZuJo95Rx-vAPQ.png"/></div></figure><p id="0955" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">为了确保我们的新规则被实际使用，我们可以运行<code class="du kh ki kj kk b">./gradlew -q app:dependencies --configuration lintChecks</code>并确保<code class="du kh ki kj kk b">lintChecks</code>配置包含我们的定制lint规则。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es nb"><img src="../Images/ce3419ad363307de01ea4faa79933954.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BnENn5KNKuataS5fpqRC7w.png"/></div></div></figure><p id="8df8" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这表明lint正在使用我们的项目来分析声明该配置的模块。为了更直观地证明我们编写的规则正在通过<code class="du kh ki kj kk b">IssueRegistry</code>发布，我们可以使用像<a class="ae kg" href="https://github.com/java-decompiler/jd-gui" rel="noopener ugc nofollow" target="_blank"> JD-GUI </a>这样的工具反编译在<code class="du kh ki kj kk b">/app/build/intermediates/lint_jar/global/prepareLintJar</code>找到的lint.jar。我们应该看到我们的<code class="du kh ki kj kk b">IssueRegistry</code>包含了我们添加的规则。</p><h2 id="1ee1" class="ks kt hh bd ku kv kw kx ky kz la lb lc jr ld le lf jv lg lh li jz lj lk ll lm bi translated">实施最佳实践</h2><p id="dfa4" class="pw-post-body-paragraph ji jj hh jk b jl ln ii jn jo lo il jq jr lp jt ju jv lq jx jy jz lr kb kc kd ha bi translated">既然我们的规则已经被编写、发布和导入，我们需要修复所有违反规则<strong class="jk hi">或</strong>的情况，为规则创建一个基线。Lint将忽略基线中的违规，直到我们有时间解决它们。这很容易通过在我们的<code class="du kh ki kj kk b">build.gradle</code>的<code class="du kh ki kj kk b">lintOptions</code>块中定义一个基线文件来完成。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es nc"><img src="../Images/233cacb5a97b8647f4c504efdb91bb95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*BUy4Vr4lkdObC45sWK-qXw.png"/></div></figure><p id="8b40" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">下一次lint运行时，它将为我们创建这个基线文件，并且该次运行的所有违规都将被放入该文件中。</p><p id="ca27" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><em class="ke">注意基线的创建将导致一个失败的构建，以确保基线不是意外创建的(否则您将会无意中忽略违规)。</em></p><p id="291e" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">创建基线后，lint将使用该文件来避免报告基线化的<code class="du kh ki kj kk b">Issue</code>。如果我们<em class="ke">仅</em>想要基线化我们的定制规则，我们可以在创建基线之前将<code class="du kh ki kj kk b">check "PreventingActivityRestart"</code>添加到<code class="du kh ki kj kk b">lintOptions</code>块中。Lint将只寻找那个特定的<code class="du kh ki kj kk b">Issue</code>，并将违反它的情况放入基线中。但是我们需要记住在创建初始基线后删除那一行，否则lint只会检查那个<code class="du kh ki kj kk b">Issue</code>。</p><p id="0e80" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">希望这篇文章能给你信心，让你开始自己的定制lint规则之旅，走向更卫生的代码！</p></div><div class="ab cl kl km go kn" role="separator"><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq kr"/><span class="ko bw bk kp kq"/></div><div class="ha hb hc hd he"><p id="47ce" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><em class="ke">披露声明:2019首创一。观点是作者个人的观点。除非本帖中另有说明，否则Capital One不隶属于所提及的任何公司，也不被这些公司认可。使用或展示的所有商标和其他知识产权是其各自所有者的财产。</em></p></div></div>    
</body>
</html>