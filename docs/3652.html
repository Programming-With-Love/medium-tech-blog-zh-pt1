<html>
<head>
<title>Best Practice for Exception Handling In SpringBoot</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SpringBoot中异常处理的最佳实践</h1>
<blockquote>原文：<a href="https://medium.com/globant/best-practice-for-exception-handling-in-springboot-540484db8a1a?source=collection_archive---------0-----------------------#2021-04-12">https://medium.com/globant/best-practice-for-exception-handling-in-springboot-540484db8a1a?source=collection_archive---------0-----------------------#2021-04-12</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="3711" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">每当我们想到在代码的任何级别处理异常时，我们都会在代码中到处写try catch块，然后过了几天，当我们试图检查我们的代码时，我们发现大部分代码都充满了处理异常。这降低了我们代码的可读性，也复制了许多我们可以很容易避免的日志消息。在这里，我们将尝试学习Spring Boot提供的强大功能，以避免这些重复，并提高代码的可读性，同时处理我们的应用程序中的异常。</p><h1 id="f6fb" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">概观</h1><p id="35ec" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">众所周知，异常处理是SpringBoot Rest APIs中最重要和最关键的事情，它帮助我们对代码执行有条件和无条件的检查，并以适当的方式处理任何类型的异常。除了它的好处之外，它也使代码变得复杂，使得未知用户不容易阅读代码。</p><p id="cd04" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，我们需要有一个公共场所，在那里我们可以管理和处理各种异常，并根据异常类型为API响应发送相应的错误代码。</p><p id="77a9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这篇博客中，我们将尝试了解一种简单的方法，这种方法可以使我们的代码在处理SpringBoot提供的异常时具有更好的格式。</p><h1 id="dbd8" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">描述</h1><p id="52ea" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">SpringBoot在包org . spring framework . web . bind . annotation下提供了一个名为@ControllerAdvice的非常强大的注释，这个注释让我们可以在应用程序的中心位置轻松处理各种异常。我们不需要分别在每个方法或类中捕获任何异常，相反，您可以从方法中抛出异常，然后它将在由@ControllerAdvice注释的中央异常处理程序类中被捕获。任何用@ControllerAdvice注释的类都将成为负责处理异常的controller-advice类。在这个类中，我们使用作为@ExceptionHandler、@ModelAttribute、@InitBinder提供的注释。</p><p id="e359" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">@ControllerAdvice是@Component注释的专门化，它允许在一个全局处理组件中处理整个应用程序的异常。它可以被看作是由用@RequestMapping和类似方法注释的方法抛出的异常的拦截器。</p><p id="dbfa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ResponseEntityExceptionHandler是@ControllerAdvice类的一个方便的基类，这些类希望通过@ExceptionHandler方法提供跨所有@RequestMapping方法的集中异常处理。它提供了处理内部Spring MVC异常的方法。它返回ResponseEntity，而DefaultHandlerExceptionResolver返回ModelAndView。</p><p id="4bb3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">用@ExceptionHandler注释的异常处理方法将捕获由声明的类抛出的异常，每当遇到相关的类型异常时，我们可以执行各种操作。我们可以捕捉各种异常，并根据需要处理的异常抛出各种http状态代码。下面的例子说明了我们如何捕捉各种异常并相应地发送相应的http状态代码。</p><p id="5574" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">@ exception handler(value = { datanotfoundexception . class })</p><p id="844f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">public response entity<responsedto>&gt; dataNotFoundException(InValidDataException ex){</responsedto></p><p id="f1dd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">response dto<object>response = new response dto<object>(http status。BAD_REQUEST，常量STATUS_FAIL，ex.getLocalizedMessage()，false)；</object></object></p><p id="382d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">logger . error(" Data not found exception:"，ex)；</p><p id="2ec3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">返回新的ResponseEntity <responsedto> &gt;(response，HttpStatus。BAD _ REQUEST)；</responsedto></p><p id="4ef6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi">}</p><p id="155f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">@ exception handler(value = { network exception . class })</p><p id="58df" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">公共响应实体<responsedto>网络异常(Exception ex) {</responsedto></p><p id="2fb7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">response dto<object>response = new response dto<object>(http status。内部服务器错误，常量。STATUS_FAIL，ex.getLocalizedMessage()，false)；</object></object></p><p id="0692" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">LOGGER.error("网络异常: "，ex)；</p><p id="7091" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">返回新的ResponseEntity <responsedto> &gt;(response，HttpStatus。内部_服务器_错误)；</responsedto></p><p id="cb79" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi">}</p><p id="630f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">@ControllerAdvice构造函数带有一些特殊的参数，允许您只扫描应用程序的相关部分，并只处理那些由构造函数中提到的相应类引发的异常。默认情况下，它会扫描并处理应用程序中的所有类。下面是一些类型，我们可以用它们来限制特定的类来处理异常。</p><p id="8271" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">1)注释——用提到的注释进行注释的控制器将得到@ControllerAdvice注释类的帮助，并且有资格作为这些类的例外</p><p id="53cb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">例如，@ControllerAdvice(annotations = rest controller . class)—这里由@ controller advice注释的异常助手将捕获由@RestController注释类抛出的所有异常。</p><p id="3699" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2)基础包—通过指定我们要扫描的包并处理这些包的异常。</p><p id="9ea7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">例如@ controller advice(base packages = " org . example . controllers ")—这将只扫描调用提到的包并处理相同的异常。</p><p id="3b34" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3) assignableTypes —该参数将确保扫描和处理来自所提到的类的异常</p><p id="b2ff" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">例如@ controller advice(assignable types = { controller interface . class，</p><p id="0b34" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">AbstractController.class})</p><h1 id="2d48" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">在使用@ControllerAdvice之前</h1><p id="122f" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">在下面的代码片段中，我们看到有许多重复的行，控制器代码也不容易阅读，因为每个API中有多个try和catch块。</p><p id="e9fa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae kf" href="http://twitter.com/RestController" rel="noopener ugc nofollow" target="_blank">@ rest controller</a><br/><a class="ae kf" href="http://twitter.com/RequestMapping" rel="noopener ugc nofollow" target="_blank">@ request mapping</a>(path = "/employees ")<br/>公共类EmployeeController {</p><p id="5dec" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">private static final Logger Logger = Logger factory . get Logger(employee controller . class)；<br/> <br/>私人雇员道；<br/><br/><a class="ae kf" href="http://twitter.com/GetMapping" rel="noopener ugc nofollow" target="_blank">@ get mapping</a>(path = "/{ employeeId } "，produces = " application/JSON ")<br/>public response entity&lt;Employee&gt;get employees(<a class="ae kf" href="http://twitter.com/PathVariable" rel="noopener ugc nofollow" target="_blank">@ path variable</a>Long employeeId){<br/>response entity&lt;Employee&gt;response = null；<br/>try {<br/>if(null = = employeeId | | position Id . equals(0L)){<br/>throw new InvalidInputException("员工Id无效")；<br/>}<br/>employee = employee Dao . getemployeedetails(employeeId)；<br/>响应=新响应实体&lt;员工&gt;(员工，HttpStatus。OK)；<br/>}<br/>catch(InvalidInputException e){<br/>logger . error("无效输入:"，e . getmessage())；<br/>响应=新响应实体&lt;员工&gt;(员工，HttpStatus。BAD _ REQUEST)；<br/>}<br/>catch(Business Exception e){<br/>logger . error(" Business Exception:"，e . getmessage())；<br/>响应=新响应实体&lt;员工&gt;(员工，HttpStatus。内部_服务器_错误)；<br/> } <br/> catch(异常e) { <br/> Logger.error("系统错误:"，e . getmessage())；<br/>response = new response entity&lt;员工&gt;(员工，HttpStatus。内部_服务器_错误)；<br/> } <br/>返回响应；<br/> }</p><p id="9075" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi">}</p><p id="ec43" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">使用@ControllerAdvice后</strong></p><p id="fde8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面的代码片段使代码易于阅读，也减少了重复的行。</p><p id="7631" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae kf" href="http://twitter.com/RestController" rel="noopener ugc nofollow" target="_blank">@ rest controller</a><br/><a class="ae kf" href="http://twitter.com/RequestMapping" rel="noopener ugc nofollow" target="_blank">@ request mapping</a>(path = "/employees ")<br/>公共类EmployeeController {</p><p id="97d2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">private static final Logger Logger = Logger factory . get Logger(employee controller . class)；</p><p id="76d4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae kf" href="http://twitter.com/GetMapping" rel="noopener ugc nofollow" target="_blank">@ get mapping</a>(path = "/{ employeeId } "，produces = " application/JSON ")<br/>public response entity&lt;Employee&gt;get employees(<a class="ae kf" href="http://twitter.com/PathVariable" rel="noopener ugc nofollow" target="_blank">@ path variable</a>Long employeeId){<br/>if(null = = employeeId | | position Id . equals(0L)){<br/>抛出新的InvalidInputException("员工Id无效")；<br/>}<br/>Employee Employee = Employee Dao . getemployeedetails(employeeId)；<br/>返回新的ResponseEntity &lt;员工&gt;(员工，HttpStatus。OK)；；<br/> }</p><p id="1a96" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi">}</p><h1 id="b4bb" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">结论</h1><p id="2f93" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">通过阅读上面的例子，我们将能够发现使用@ControllerAdvice将解决我们在维护代码质量方面的许多问题，并且它将增加代码的可读性。这将有助于每个人在应用程序的公共位置调试所有错误。使用这种方法，我们还可以很容易地针对任何类型的错误更新记录器，并保持错误消息的一致性。</p></div></div>    
</body>
</html>