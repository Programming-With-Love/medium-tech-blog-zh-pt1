<html>
<head>
<title>Learning to use and abuse Mutability</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">学习使用和滥用可变性</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/learning-to-use-and-abuse-mutability-b4c71576299?source=collection_archive---------0-----------------------#2017-01-30">https://medium.com/google-developer-experts/learning-to-use-and-abuse-mutability-b4c71576299?source=collection_archive---------0-----------------------#2017-01-30</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/01dc3e9e0931feb8b8c6d3a0a96a79d4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sATSRAvqzDPhQr46Fda56w.jpeg"/></div></div></figure><div class=""/><p id="63ca" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我是一个老Java人，我从来没有分配我的许多思想去思考可变性的哲学。与其他语言不同，Java无法精确控制哪些是可变的，哪些是不可变的。我从来没有想到Java对象有这个特性。相反，我总是称它们为<em class="jn">“没有setter的Java类”</em>。<em class="jn">“一旦设置了值就不能修改的Java类”</em>。在一个近乎科学的世界里，这是一个非常不科学的措辞。可变性是命令式语言的默认设置，我们只是不太考虑它。缺乏意识，我们的思维惯性地工作在我们所学的范式上。</p><figure class="jp jq jr js fd hj er es paragraph-image"><div class="er es jo"><img src="../Images/1244d0344de42aa6f7fde6ea25b0f30e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*vqMIv93v28QsBFzEKaqipA.jpeg"/></div></figure><p id="60d5" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在我的职业生涯中，我看到许多语言可以区分类的可变性。这很酷，但是因为我从来没怎么用过它(我大部分时间都在安卓和J2EE上工作),所以我放弃了它。这不在我的势力范围之内。</p><p id="5786" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">一年前，我开始和科特林一起工作。它一直是我发展道路上的一盏明灯，我尽可能地使用它并倡导它(我也策划了<a class="ae jt" href="http://kotlinweekly.net" rel="noopener ugc nofollow" target="_blank">科特林周刊</a>，如果你想订阅每周一次的话)。如果你碰巧是为Android开发的，你很可能会用Java来做。Java的1.0版本<a class="ae jt" href="http://www.oracle.com/technetwork/java/javase/overview/javahistory-index-198355.html" rel="noopener ugc nofollow" target="_blank">发布于1995年</a>。没错，22年前。当时的世界是一个非常不同的地方，Java是为了应对当时的挑战而设计的。我们所知的智能手机并不存在。这两款手机都不像现在这样容易买到。Java发布的时候，Windows 95甚至还没有面向大众(没错，Java就是这么老)。易贝刚刚开始。</p><p id="a04f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我喜欢把IT世界比作股票市场。20世纪60年代，通用汽车是占主导地位的公司，没有人能与之竞争。美国政府甚至考虑强行将其拆分成小部分，以避免巨大的垄断。今天，通用汽车作为一个行尸走肉，多亏了巨额救助才得以生存。在20世纪90年代，没有人会对苹果公司下一毛钱的赌注。今天，苹果是全球最大的公司。</p><blockquote class="ju jv jw"><p id="c273" class="ip iq jn ir b is it iu iv iw ix iy iz jx jb jc jd jy jf jg jh jz jj jk jl jm ha bi translated">今天的星星是明天的残骸。今天的失败是明天激动人心的转变——J . l .柯林斯，<a class="ae jt" href="http://amzn.to/2kKBGB9" rel="noopener ugc nofollow" target="_blank">通往财富的简单道路</a></p></blockquote><p id="057f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Java经历了许多补丁和更新。我并不是在批评这种语言:我确实靠讲Java谋生——尽管我并不仅限于讲Java。但与此同时，新的明星正在崛起，在这里我想到了科特林。直截了当地说，Kotlin区分了可变集合和不可变集合。开箱即用。</p><p id="1388" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最近，我在<a class="ae jt" href="https://developers.google.com/experts/" rel="noopener ugc nofollow" target="_blank">谷歌专家</a>项目<a class="ka kb ge" href="https://medium.com/u/6ebfb5fe99f9?source=post_page-----b4c71576299--------------------------------" rel="noopener" target="_blank">的同事迈克·纳希莫维奇</a>在推特上写了以下内容:</p><figure class="jp jq jr js fd hj"><div class="bz dy l di"><div class="kc kd l"/></div></figure><p id="e972" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这也让我的大脑开始工作。我最近写了一篇博文，<a class="ae jt" rel="noopener" href="/google-developer-experts/on-properly-using-volatile-and-synchronized-702fc05faac2#.nitcvxkfz">“关于如何正确使用volatile和synchronized”</a>。我意识到线程和同步很难。哦，伙计，很多边缘案例，很多概念碰撞，太多抽象了。这个解决方案是一个开箱即用的解决方案。我有时使用它，我总是把它看作一个黑客。</p><p id="cb6e" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这篇介绍之后，让我们来探索Java中的可变性及其所有好处。为了更有效地解决这个问题，让我们提供以下定义作为公理:</p><blockquote class="ju jv jw"><p id="4da3" class="ip iq jn ir b is it iu iv iw ix iy iz jx jb jc jd jy jf jg jh jz jj jk jl jm ha bi translated">不可变类是一个一旦创建就不能改变状态的类。</p></blockquote><p id="a3b4" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">很简单。如果你在Java领域，现在你可以想出一些如何使一个类不可变的线索。</p><ul class=""><li id="b3d1" class="ke kf hs ir b is it iw ix ja kg je kh ji ki jm kj kk kl km bi translated">所有字段必须是私有的。这是OO编程范例的另一个公理。如果字段是私有的，则不能在外部更改。如果，作为奖励，也是最终的，你不能意外地改变它们。</li><li id="cb73" class="ke kf hs ir b is kn iw ko ja kp je kq ji kr jm kj kk kl km bi translated"><strong class="ir ht">不提供设定器</strong>。把这一点和前一点结合起来。如果字段是私有的，并且没有提供setter，那么这个类字段将始终保持不变。</li><li id="9619" class="ke kf hs ir b is kn iw ko ja kp je kq ji kr jm kj kk kl km bi translated"><strong class="ir ht">子类不应该覆盖方法</strong>。否则他们会欺骗我们的不变性。这很简单。只需将该类声明为最终类。</li></ul><p id="bbe4" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这个例子中检查它看起来像什么:</p><figure class="jp jq jr js fd hj"><div class="bz dy l di"><div class="ks kd l"/></div></figure><p id="6c1f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们已经讨论了理论部分。现在我们已经正式把知识写在纸上了。我们现在能用这个做什么？</p><h2 id="85e3" class="kt ku hs bd kv kw kx ky kz la lb lc ld ja le lf lg je lh li lj ji lk ll lm ln bi translated">好人</h2><ul class=""><li id="8682" class="ke kf hs ir b is lo iw lp ja lq je lr ji ls jm kj kk kl km bi translated">不可变对象可以让生活变得更容易。不可变对象是自动线程安全的，并且没有同步问题。哇，大pro！它们使得并发编程更加安全和简洁。你调试过并发编程问题吗？大多数错误是由于线程间共享状态造成的。想象一下只要扫一眼就能摆脱它。值得一试。</li><li id="978e" class="ke kf hs ir b is kn iw ko ja kp je kq ji kr jm kj kk kl km bi translated">不可变对象不需要复制构造函数或克隆的实现。为了简单起见。</li><li id="a210" class="ke kf hs ir b is kn iw ko ja kp je kq ji kr jm kj kk kl km bi translated">你听说过约书亚·布洛赫在《有效的Java》中创造的术语“失败原子性”吗？这意味着当一个不可变对象抛出任何异常时，它永远不会导致对象处于不确定状态。很大的荣誉。</li></ul><h2 id="55b7" class="kt ku hs bd kv kw kx ky kz la lb lc ld ja le lf lg je lh li lj ji lk ll lm ln bi translated">丑陋的</h2><ul class=""><li id="6686" class="ke kf hs ir b is lo iw lp ja lq je lr ji ls jm kj kk kl km bi translated">为了改变对象而复制它们会耗尽我们的资源，尤其是在处理复杂的数据结构时。此外，改变具有不同身份的对象也可以更直观。</li><li id="cda0" class="ke kf hs ir b is kn iw ko ja kp je kq ji kr jm kj kk kl km bi translated">我们对模型世界的感知是基于可变的对象。</li></ul><h1 id="678d" class="lt ku hs bd kv lu lv lw kz lx ly lz ld ma mb mc lg md me mf lj mg mh mi lm mj bi translated">我该怎么办？</h1><p id="a5c6" class="pw-post-body-paragraph ip iq hs ir b is lo iu iv iw lp iy iz ja mk jc jd je ml jg jh ji mm jk jl jm ha bi translated">我听说过“易变是万恶之源”。我喜欢有多种选择，不把任何事情当作教条。多种选择通常意味着你有更多的选择。</p><p id="9c72" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在《有效的Java》中，约书亚·布洛克写道:</p><blockquote class="ju jv jw"><p id="c2e2" class="ip iq jn ir b is it iu iv iw ix iy iz jx jb jc jd jy jf jg jh jz jj jk jl jm ha bi translated">“类应该是不可变的，除非有非常好的理由让它们可变。如果一个类不能成为不可变的，那么尽可能地限制它的可变性。”</p></blockquote><p id="248a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">不变性可以解决许多问题，使您的生活更加轻松，尤其是在并发环境中工作时。但是，如果您默认使用它，它可能会过度设计并使事情变得更加复杂。因此，了解您的战争，并应用更适合的解决方案。</p><p id="1825" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">感谢<a class="ae jt" href="https://twitter.com/xavierjurado" rel="noopener ugc nofollow" target="_blank">泽维尔·胡拉多</a>和<a class="ae jt" href="https://twitter.com/dggonzalez" rel="noopener ugc nofollow" target="_blank">戴维·冈萨雷斯</a>对文章的投入！</p><p id="b349" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我在我的<a class="ae jt" href="https://twitter.com/eenriquelopez" rel="noopener ugc nofollow" target="_blank">推特账户</a>中写下我对软件工程和生活的想法。如果你喜欢这篇文章或者它确实帮助了你，请分享它，喜欢它和/或留下评论。这是给业余作家加油的货币。</p></div></div>    
</body>
</html>