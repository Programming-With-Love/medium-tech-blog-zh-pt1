<html>
<head>
<title>Devops CI-CD Setup For Beginners</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">适用于初学者的Devops CI-CD设置</h1>
<blockquote>原文：<a href="https://medium.com/globant/devops-ci-cd-setup-for-beginners-b185fc981eed?source=collection_archive---------0-----------------------#2021-02-18">https://medium.com/globant/devops-ci-cd-setup-for-beginners-b185fc981eed?source=collection_archive---------0-----------------------#2021-02-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="5fdc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">本文讨论了在AWS中使用Terraform模块(IaaC)创建基础设施，在Jenkins(使用Publish-Over-SSH插件)和Ansible的帮助下构建和部署PHP应用程序。</p><p id="b75f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">本文涵盖了以下几点:</strong></p><ul class=""><li id="6efd" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">工具介绍。</li><li id="98be" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">地形安装。</li><li id="6c8f" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">先说编码部分。</li><li id="5679" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">PHP应用程序的开发CICD设置。</li><li id="0ff9" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">让我们开始演示吧！</li><li id="e182" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">常见问题及故障排除步骤。</li></ul><h1 id="47aa" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak">工具介绍:</strong></h1><p id="aea4" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">Terraform是一个基础设施，作为一个代码工具，有助于提供和管理基础设施。这个工具与云无关，支持一些著名的公共云供应商(AWS、GCP、Azure、OpenStack等。).在这里，我们将使用AWS作为云提供商。</p><p id="c906" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Jenkins是一个免费的开源自动化服务器。它有助于自动化与构建、测试和部署相关的软件开发部分，促进持续集成和持续交付。</p><p id="85b8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Ansible是一个开源工具，用于软件供应、配置管理和应用部署，以实现基础设施即代码(IaaC)。它运行在许多风格的unix/linux上，可以用来配置基于unix和基于windows的机器。</p><h1 id="7cb2" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak">地形安装:</strong></h1><ol class=""><li id="fe1c" class="jc jd hh ig b ih ko il kp ip kt it ku ix kv jb kw ji jj jk bi translated">从<a class="ae kx" href="https://www.terraform.io/downloads.html" rel="noopener ugc nofollow" target="_blank">https://www.terraform.io/downloads.html</a>下载Terraform(这里我们已经在C:\)上安装了windows 64位版本14.2)</li><li id="4afe" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb kw ji jj jk bi translated">为了从任何位置运行terraform脚本，请按如下方式设置路径变量:</li></ol><p id="6a15" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">转到控制面板-&gt;系统和安全-&gt;系统-&gt;高级系统设置，然后单击环境变量并编辑路径“c:\”，我们已经提取了我们的terraform设置。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es ky"><img src="../Images/750fec9b4dad63a05765343731b1bcb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/0*8QX3Oyi6wfeC_cEE"/></div></figure><p id="a36d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3.打开命令提示符类型<strong class="ig hi"> terraform —版本</strong>。</p><ul class=""><li id="2b82" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">Terraform模块:<strong class="ig hi"> </strong>我们可以创建模块，为多个账户重用代码。</li><li id="61f6" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">我们将为基础架构设置创建以下模块:</li></ul><p id="4594" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">-EC2: Jenkins服务器，Ansible，目标服务器。</p><p id="b1e9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">-OS: Ubuntu</p><p id="b3e8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">-RDS: MYSQL</p><p id="7533" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">本演示的文件结构:</strong></p><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es lg"><img src="../Images/deb284375d169f0bec6aa032ab2fb8d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:434/0*g0o4kqoMlXwiRjH0"/></div></figure><p id="7103" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">使用Terraform模块</strong>提供Jenkins、Ansible、Tomcat和RDS设置。</p><p id="325b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建实例模块的先决条件:</p><ol class=""><li id="9b81" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb kw ji jj jk bi translated">IAM概要文件:IAM概要文件充当EC2实例的IAM角色的容器。如果从控制台创建EC2，控制台将自动附加具有EC2角色的IAM配置文件，但是在通过CLI或API创建时，您需要将角色和实例配置文件作为单独的操作来创建。</li><li id="3716" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb kw ji jj jk bi translated">IAM角色:这是一个IAM身份，您可以在拥有特定权限的帐户中创建。</li><li id="bbba" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb kw ji jj jk bi translated">IAM策略:它定义了一个操作的权限，而不管您使用什么方法来执行操作。</li><li id="02e1" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb kw ji jj jk bi translated">安全组:它就像一个防火墙，定义了对EC2实例流量的允许/拒绝操作。</li><li id="220f" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb kw ji jj jk bi translated">AMI:它是启动EC2实例所需的预配置包，包括操作系统和所需的软件包等。</li><li id="adf6" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb kw ji jj jk bi translated">Userdata:当您在Amazon EC2中启动一个实例时，您可以选择将用户数据传递给该实例，该实例可用于执行常见的自动化配置任务，甚至在实例启动后运行脚本。</li><li id="d029" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb kw ji jj jk bi translated">Keyname:它是一组安全凭证，用于在连接到实例时证明您的身份。从控制台下载密钥，并作为变量传递。</li><li id="06db" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb kw ji jj jk bi translated">实例类型:要启动的实例的类型。对该字段的更新将触发EC2实例的停止/启动。</li></ol><h1 id="c6d7" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak">先说编码部分:</strong></h1><p id="1bdd" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated"><strong class="ig hi">→资源“aws_instance”创建一个aws_instance，terraform将其称为ansiserver。</strong></p><p id="2ca0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→将ami和密钥名作为变量传递，变量将在vars.tf中定义，实例类型将为t2.micro。</p><p id="0dd5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→在用户数据下传递外壳脚本文件位置。</p><p id="eb1c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→标记将创建一个名为ansible的实例，associate_public_ip = true是可选的，它将公共ip关联到EC2实例。</p><pre class="kz la lb lc fd lh li lj lk aw ll bi"><span id="b14a" class="lm jr hh li b fi ln lo l lp lq">resource “aws_instance” “ansiserver” {<br/> ami = “${var.ansi_ami_id}”<br/> instance_type = “t2.micro”<br/> key_name = “${var.keyname}”<br/> vpc_security_group_ids = [aws_security_group.ansiserver.id]<br/> iam_instance_profile = “${aws_iam_instance_profile.ansi_profile.id}”<br/> user_data = file(“C:/Users/Dell/Terraform/files/install_ansible.sh”)<br/> associate_public_ip_address = true<br/> tags = {<br/> Name = “ansible”<br/> }<br/>}</span></pre><p id="d6ca" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">→资源“aws_security_group”将创建一个名为“ansiserver”的安全组。</strong></p><p id="78fb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→vpc_id作为变量传递。</p><p id="5c02" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→创建AWS实例时，首先创建一个安全组，它将安全组id作为vpc_security_group_ids附加到上述实例。</p><pre class="kz la lb lc fd lh li lj lk aw ll bi"><span id="6659" class="lm jr hh li b fi ln lo l lp lq">resource “aws_security_group” “ansiserver” {<br/> name = “ansiserver”<br/> description = “Allow SSH and Jenkins inbound traffic”<br/> vpc_id = “${var.vpcid}”<br/> ingress {<br/> from_port = 22<br/> to_port = 22<br/> protocol = “tcp”<br/> cidr_blocks = [“0.0.0.0/0”]<br/> }<br/> ingress {<br/> from_port = 8080<br/> to_port = 8080<br/> protocol = “tcp”<br/> cidr_blocks = [“0.0.0.0/0”]<br/> }<br/> ingress {<br/> from_port = 0<br/> to_port = 0<br/> protocol = “-1”<br/> cidr_blocks = [“0.0.0.0/0”]<br/> }<br/> egress {<br/> from_port = 0<br/> to_port = 0<br/> protocol = “-1”<br/> cidr_blocks = [“0.0.0.0/0”]<br/> }<br/> }</span></pre><p id="3b38" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">→资源“aws_iam_role”将创建一个名为ansi_role的iam角色，它允许EC2实例使用sts代表用户承担角色来调用aws服务。</strong></p><p id="5bcb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→IAM角色策略附件顾名思义，将策略附加到ansi_role。</p><p id="ee57" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→Count是元参数，用于管理几个相似的对象，而无需写入单独的块。</p><p id="c2b7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→在本例中，我们将计算变量“策略arn”的长度，将AWS管理的策略附加到ansi_role。</p><p id="76ea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→Count.index是一个从0开始的独特索引号，因为我们在变量Count(参见下面的var.tf)中传递了两个index会将每个arn附加到我们的角色。</p><pre class="kz la lb lc fd lh li lj lk aw ll bi"><span id="dcc8" class="lm jr hh li b fi ln lo l lp lq">resource “aws_iam_role” “ansi_role” {<br/> name = “ansi_role”</span><span id="ccc3" class="lm jr hh li b fi lr lo l lp lq">assume_role_policy = &lt;&lt;EOF<br/>{<br/> “Version”: “2012–10–17”,<br/> “Statement”: [<br/> {<br/> “Action”: “sts:AssumeRole”,<br/> “Principal”: {<br/> “Service”: “ec2.amazonaws.com”<br/> },<br/> “Effect”: “Allow”,<br/> “Sid”: “”<br/> }<br/> ]<br/>}<br/>EOF<br/>}<br/>resource “aws_iam_role_policy_attachment” “role-attach” {<br/> role = aws_iam_role.ansi_role.name<br/> count = “${length(var.iam_policy_arn)}”<br/> policy_arn = “${var.iam_policy_arn[count.index]}”<br/>}<br/>resource “aws_iam_instance_profile” “ansi_profile”{<br/> name = “ansi_profile”<br/> role = “${aws_iam_role.ansi_role.name}”<br/>}</span></pre><p id="8308" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">最终代码可参考github账号:</strong></p><p id="5851" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae kx" href="https://github.com/vriksha-star/Terraform.git" rel="noopener ugc nofollow" target="_blank">https://github.com/vriksha-star/Terraform.git</a></p><p id="90f9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→同样，RDS、Jenkins、Target server等其他terraform模块的代码可在模块目录下的Github repos中找到。</p><p id="3627" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→用于创建Jenkins、Ansible和目标服务器的Shell脚本将位于Github帐户的files文件夹下。</p><p id="c0b0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是Dev文件夹下创建的main.tf的内容，terraform需要在这个文件夹下初始化:</p><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es ls"><img src="../Images/41d0201c8e9ac381e784c636bb592391.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/0*-BQoNzBiFx2emUdN"/></div></figure><p id="0b30" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">使用地形</strong></p><p id="61cb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→进入命令提示符，滚动到定义模块的主文件夹，执行<strong class="ig hi">地形初始化</strong>，将得到如下输出:</p><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es lt"><img src="../Images/12f91570a6d8e865056c1f0b317bbf1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/0*6B16W8Dwc5z_2k1_"/></div></figure><p id="c8d8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→在terraform init之后执行以下命令，如<br/> - terraform-plan(给出关于资源的蓝图)<br/> - terraform-apply(应用terraform配置并创建资源)</p><p id="be87" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→一旦terraform应用成功，它将在您的AWS帐户中创建Targetserver-1、Targetserver-2、ansible (controller)、Jenkins server和RDS database1，如下图所示。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es lu"><img src="../Images/4c2ace2417f6a72426a96d94d611aed7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6qsjhYMPr_B4y3Up"/></div></div></figure><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es lz"><img src="../Images/676fa7c8d67df212455dc129e8f95ffa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GEroVYdx2gVbsz4X"/></div></div></figure><h1 id="eb4f" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak">PHP应用程序的Devops CICD设置</strong></h1><p id="5072" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">→从这个<a class="ae kx" href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/CHAP_Tutorials.WebServerDB.CreateWebServer.html" rel="noopener ugc nofollow" target="_blank"> URL </a>使用AWS文档中的PHP应用程序，我在我的GitHub repo中保存了一份副本。</p><p id="7eed" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→登录Jenkins控制台。</p><p id="bad7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→Jenkins与Ansible之间的连接将使用ssh上的Publish-over-ssh来完成，在Jenkins上，转到可用的选项卡下的管理插件，添加<strong class="ig hi"> Publish-over-ssh </strong>插件，无需重启即可安装。</p><p id="413e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→稍后转到配置系统，并使用ssh-keygen从Ansible服务器添加私钥。</p><p id="cc37" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→将Jenkins的公钥添加到Ansible master上的授权文件中，然后检查连接。</p><p id="de6f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→如果这不起作用，添加的内容。在“配置系统”下将pem密钥作为私钥。</p><p id="e73a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">使用publish over ssh配置Ansible与Jenkins:</strong></p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es ma"><img src="../Images/bea53bc58f213032e6cd891ed7e92f8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YxDrTlOw6gTBY3Hz"/></div></div></figure><p id="f4fb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→可以通过将公钥从Ansible控制器复制到Ansible目标上的授权密钥来实现Ansible控制器和目标之间的连接。</p><p id="2675" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→在ansible controller机器上，创建名为inventory.txt的文件，添加目标机器的ip地址，并创建包含以下内容的pingtest.yaml行动手册。</p><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es mb"><img src="../Images/2c402ecb60d90ba57423686036c984ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/0*OLH6vWlKccmioHLS"/></div></figure><figure class="kz la lb lc fd ld er es paragraph-image"><div class="er es mc"><img src="../Images/42086bf63da63d0b3f9ebae68cefc9fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/0*rmNj93F3gIqOP-W1"/></div></figure><p id="7819" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">→编写剧本后，执行命令“<strong class="ig hi">ansi ble-playbook ping test . YAML-I inventory . txt</strong>”，输出如下:</p><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es md"><img src="../Images/f2f06601b0bb03a0b7b689f39bdf3b61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lf7pNwAxgDVsLFDn"/></div></div></figure><p id="d767" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">在可行控制器机器上创建可行剧本:</strong></p><ul class=""><li id="9d0d" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">已创建名为copyfile.yaml的文件</li></ul><pre class="kz la lb lc fd lh li lj lk aw ll bi"><span id="7132" class="lm jr hh li b fi ln lo l lp lq">name: Playbook to deploy app on target Server<br/>hosts: webserver<br/>become: yes<br/>become_user: root<br/>tasks:<br/>  - name: Creates directory<br/>    file:<br/>       path: /var/www/inc<br/>       state: directory<br/>       mode: 0777<br/>  - name: Creates file<br/>    file:<br/>       path: "/var/www/inc/dbinfo.inc"<br/>       state: touch<br/>  - name: Creates Content<br/>    copy:<br/>      content: |<br/>               &lt;?php<br/>               define('DB_SERVER', 'db_instance_endpoint');<br/>               define('DB_USERNAME', 'tutorial_user');<br/>               define('DB_PASSWORD', 'master password');<br/>               define('DB_DATABASE', 'sample');<br/>               ?&gt;<br/>   dest: /var/www/inc/dbinfo<br/>   mode: 0777<br/>  - name: Copy File to ansible target <br/>   copy:<br/>      src: /home/ubuntu/SamplePHP.php<br/>      dest: /var/www/html</span></pre><p id="1611" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">在Jenkins UI上执行以下步骤</strong>:</p><ul class=""><li id="df0e" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">在Jenkins上创建名为“PHP-test”的自由式项目。</li><li id="76f8" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">在SCM上提供您的GIT url:</li></ul><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es me"><img src="../Images/d7e3e79a774415e0cfb0c2314d42437a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*k_HTpW90HGcMhA8H"/></div></div></figure><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mf"><img src="../Images/27f44dc510e3a023444d29f58512cee5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*575wio-J2AxUK27l"/></div></div></figure><h1 id="ffbb" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">让我们运行演示</h1><ul class=""><li id="5252" class="jc jd hh ig b ih ko il kp ip kt it ku ix kv jb jh ji jj jk bi translated">触发Jenkins build，在浏览器上执行<a class="ae kx" href="http://server-public-ip/SamplePHP.php(your" rel="noopener ugc nofollow" target="_blank">http://ec2-public-IP/sample PHP . PHP(您的</a> php脚本名)，您将得到如下输出:</li></ul><figure class="kz la lb lc fd ld er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mg"><img src="../Images/74112b7e5c88e7b02b64cd3e9cc2430a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yFscTiklUDoEVqb1"/></div></div></figure><h1 id="211a" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak">常见问题及故障排除步骤:</strong></h1><ol class=""><li id="0624" class="jc jd hh ig b ih ko il kp ip kt it ku ix kv jb kw ji jj jk bi translated">在构建失败的情况下，检查copyfile.yaml是否是在Ansible控制器上创建的。</li><li id="c8a6" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb kw ji jj jk bi translated">检查构建状态，如果您在配置系统上遇到Jenkins构建检查测试连接不稳定的问题。</li><li id="d470" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb kw ji jj jk bi translated">更新RDS安全组上目标服务器的专用ip。</li><li id="a188" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb kw ji jj jk bi translated">如果您遇到mysql连接问题，请使用“telnet”RDS端点“3306”检查从目标到mysql的连接。</li><li id="e8a0" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb kw ji jj jk bi translated">如果您遇到数据库问题，请检查dbinfo.inc是否在目标机器上的“var/www/inc”上提供了正确的数据库详细信息。</li></ol><h1 id="dcde" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak">结论</strong></h1><p id="41f3" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">本文旨在分享对devops ci-cd实时场景的基本理解，以及使用Terraform、Jenkins和Ansible模块的自动化步骤，我们成功部署了一个以html为前端、php为后端、mysql db为数据库的应用程序。</p></div></div>    
</body>
</html>