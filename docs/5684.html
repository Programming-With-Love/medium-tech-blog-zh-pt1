<html>
<head>
<title>Using OCI Monitoring Healthchecks to Schedule execution of Serverless Functions on Oracle Cloud Infrastructure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用OCI监控运行状况检查来计划Oracle云基础架构上无服务器功能的执行</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/using-oci-monitoring-healthchecks-to-schedule-execution-of-serverless-functions-on-oracle-cloud-ef233f887a5?source=collection_archive---------4-----------------------#2020-01-08">https://medium.com/oracledevs/using-oci-monitoring-healthchecks-to-schedule-execution-of-serverless-functions-on-oracle-cloud-ef233f887a5?source=collection_archive---------4-----------------------#2020-01-08</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="e13c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">根据时间表执行调度作业是一项常见的需求。Oracle云基础架构上的作业通常使用云原生的、无服务器的功能来实施，这些功能可以通过API网关上的(公共)HTTP端点来公开。我最近发表了一篇文章，描述了如何使用IFTTT 来调度函数的执行。这很好。但是，有一种更好的方法，即在Oracle云基础架构上实现更细粒度、更易于监控和完全的云原生。</p><p id="5985" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用OCI监控服务，我们可以创建由定期ping或HTTP调用组成的健康检查。我们可以配置一个Healthcheck，定期调用公共API网关上的一个端点，并将一个函数作为其后端。通过这种方式，我们可以很容易地安排每X秒|分钟|小时|天执行一次功能。下图描述了这种设置。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/f015270b9b05495ac38d8e8b6361c077.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VMAvPvVBMQwPQCtk.png"/></div></div></figure><p id="3882" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下图中显示的hello函数是在以前的文章中创建的；它是在Node中实现的，不做任何有用的事情。对于我们想要安排执行的后端功能，没有任何要求。</p><p id="e37b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们经历的步骤:</p><ul class=""><li id="7035" class="jp jq hh ig b ih ii il im ip jr it js ix jt jb ju jv jw jx bi translated">在OCI监控中为我们要调度的函数定义API网关端点和路由的健康检查</li><li id="6719" class="jp jq hh ig b ih jy il jz ip ka it kb ix kc jb ju jv jw jx bi translated">(检查该功能现在是否定期触发)</li></ul><p id="326b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意:健康检查不允许我们将身体传递给功能；HTTP头<em class="kd">可以</em>指定。</p><p id="d3f8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要创建运行状况检查，请转到监控|运行状况检查:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es ke"><img src="../Images/d80ad523aa608274b1f21b8cdd8557c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/0*aUHsXjNyskbEZ9Se.png"/></div></figure><p id="d395" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">单击创建运行状况检查:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/011b82a7991482304d9d96bfffbac18a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fW6yQ0hSUzLujcmX.png"/></div></div></figure><p id="fa8c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">配置健康检查——使用API网关端点和APU网关上的[URL]路径来触发功能。指明检查运行状况的频率；这对应于触发该功能的频率。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kf"><img src="../Images/3230b36277ad958c4e5c68644c598781.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/0*fiMeUyC9preSGo__.png"/></div></figure><p id="4098" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里显示的运行状况检查每60秒触发一次；然后，它通过HTTPS对路径/fn/hello处的API网关端点进行GET调用(HEAD是另一个选项)——这导致了函数<em class="kd"> hello </em>。请求中不包含任何标头。</p><p id="c2cc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">保存新的运行状况检查配置。现在应该立即激活它。</p><p id="5a5e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">几分钟后，控制台显示运行状况检查的以下详细信息，这表明它已经(成功)执行:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kg"><img src="../Images/e86603271b525c2ba9d35d1fa8e81aba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1190/format:webp/0*O6NJSYffgscpuhQO.png"/></div></figure><p id="2030" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">45分钟后的详细指标让我们对函数调用的延迟有了一些了解。我认为峰值是由函数在一段时间后变冷引起的，在冷重启后调用会导致更长的响应时间。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kh"><img src="../Images/0c149433cb1ff36dd6b60620828aa857.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JXyMav1QekJ4UrHb.png"/></div></div></figure><p id="649c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我也许应该对此进行更详细的调查。</p><p id="1853" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在函数方面，我们可以在指标中看到函数定期执行，大约每分钟一次。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es ki"><img src="../Images/ddca732ce5743d1e57028bf0ca70c2d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OBe3trTXWcAEn72e.png"/></div></div></figure><p id="63e7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用健康检查——连同API网关——似乎是调度功能执行的一种相当优雅的方式。Oracle很可能在不久的将来将调度作为云原生功能提供，但在此之前，这似乎是一个可行的替代方案。</p></div><div class="ab cl kj kk go kl" role="separator"><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko kp"/><span class="km bw bk kn ko"/></div><div class="ha hb hc hd he"><p id="d540" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="kd">原载于2020年1月8日</em><a class="ae jc" href="https://technology.amis.nl/2020/01/08/using-oci-monitoring-healthchecks-to-schedule-execution-of-serverless-functions-on-oracle-cloud-infrastructure/" rel="noopener ugc nofollow" target="_blank"><em class="kd">https://technology . amis . nl</em></a><em class="kd">。</em></p></div></div>    
</body>
</html>