# åŸºäºç»ˆç«¯çš„å¿«é€Ÿ DNS åˆ‡æ¢

> åŸæ–‡ï¼š<https://medium.easyread.co/quick-terminal-based-dns-switching-4ffa407dfd38?source=collection_archive---------7----------------------->

## åˆ‡æ¢ DNS æœåŠ¡å™¨è®¾ç½®ä»¥è§£å†³åŸŸåæœåŠ¡å™¨é˜»å¡å’Œä¼ä¸šä»£ç†çš„å¿«é€ŸæŒ‡å—

![](img/f9ff71827901a269eb2d56f08cf2c251.png)

# åŠ¨æœº

æˆ‘ä»¬ä¸­çš„å¤§å¤šæ•°äººï¼Œåœ¨ç”Ÿæ´»ä¸­çš„æŸä¸ªæ—¶å€™ï¼Œéƒ½è‡³å°‘ä¸ºæˆ‘ä»¬çš„è®¡ç®—æœºä½¿ç”¨è¿‡å®šåˆ¶çš„ DNS æœåŠ¡å™¨é…ç½®ã€‚æ— è®ºæ˜¯ä¸ºäº†é¿å…å®¡æŸ¥ï¼Œæ›´å¿«çš„æµè§ˆï¼Œå®‰å…¨ï¼Œè¿˜æ˜¯ç»•è¿‡å†…å®¹é™åˆ¶ï¼Œæˆ‘ä»¬éƒ½å°è¯•è¿‡å°†æˆ‘ä»¬çš„ DNS æœåŠ¡å™¨è®¾ç½®ä¸ºä¸€äº›å…¬å…± DNS æœåŠ¡å™¨ï¼Œå¦‚è°·æ­Œçš„æœåŠ¡å™¨(è¿˜è®°å¾— 8.8.8.8 å’Œ 8.8.4.4 å—ï¼Ÿ).æˆ‘è‡ªå·±ä¹Ÿä¸ä¾‹å¤–ï¼Œå› ä¸ºæˆ‘ä¸€ç›´ä½¿ç”¨[1.1.1.1](https://1.1.1.1/dns/)çš„éšç§å’Œé€Ÿåº¦ã€‚ä¸å¹¸çš„æ˜¯ï¼Œæ‹¥æœ‰å®šåˆ¶çš„ DNS åŸŸåæœåŠ¡å™¨ä¹Ÿä¼šç»™é‚£äº›åœ¨ä¸åŒåœ°æ–¹ä¸€ç›´ä½¿ç”¨ä»–ä»¬çš„ç”µè„‘çš„äººå¸¦æ¥ä¸€äº›æŒ«æŠ˜ã€‚å¯¹äºå®šåˆ¶çš„ DNS æœåŠ¡å™¨ï¼Œè¿™å°±æ˜¯ä½ åœ¨è¯•å›¾é˜»æ­¢å®ƒä»¬(è¿åŒ VPN æœåŠ¡ç­‰)çš„ç½‘ç»œä¸Šå¾—åˆ°çš„ç»“æœã€‚)

![](img/11d24aeb114b9a2b2baee6bc4b8a2ced.png)

è‡ªå®šä¹‰ DNS æœåŠ¡å™¨çš„å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œç½‘ç»œç™»å½•é¡µé¢ä¸ä¼šæ˜¾ç¤ºï¼Œå› ä¸ºé»˜è®¤ DNS æ²¡æœ‰ç”¨äºå°†æˆ‘ä»¬é‡å®šå‘åˆ°æœ¬åœ°ç½‘ç»œç™»å½•é¡µé¢ã€‚å½“ç„¶ï¼Œåˆ é™¤é…ç½®ä¼šå¾ˆå®¹æ˜“ï¼Œå› ä¸ºæ‚¨(å¾ˆå¯èƒ½)æ˜¯è®¾ç½®å®ƒä»¬çš„äººï¼Œåˆ é™¤ä¼šæœ‰å¤šéš¾å‘¢ï¼Ÿä½†æ˜¯å¦‚æœæˆ‘ä»¬å†æ¬¡éœ€è¦è¿™äº›å¤‡ç”¨ DNS æœåŠ¡å™¨å‘¢ï¼Ÿæˆ‘ä¸ªäººè§‰å¾—è¿™ç§æ‰‹åŠ¨åˆ é™¤å’Œæ·»åŠ å®ƒä»¬çš„æ–¹å¼å¤ªéº»çƒ¦äº†ã€‚å› æ­¤ï¼Œæˆ‘å°†å®ƒä»¬åŒ…è£…åœ¨ä¸€ä¸ª bash å‡½æ•°ä¸­ï¼Œè¯¥å‡½æ•°åƒæ‰€æœ‰æ‡’æƒ°çš„ç¨‹åºå‘˜ä¸€æ ·ä¸ºæˆ‘å®Œæˆè¿™é¡¹å·¥ä½œã€‚

# 1.1.1.1

åœ¨å¼€å§‹è§£é‡Šæˆ‘åœ¨ä¸‹ä¸€éƒ¨åˆ†åšäº†ä»€ä¹ˆä¹‹å‰ï¼Œæˆ‘æƒ³å¯¹è¿™ä¸ªä»¤äººæ•¬ç•çš„é¡¹ç›®å¤§å£°æ¬¢å‘¼ï¼Œå®ƒæ˜¯æ¥è‡ª [Cloudflare](https://www.cloudflare.com/) å’Œ[APNIC](https://www.apnic.net/)â€”[1.1.1.1](https://1.1.1.1/dns/)çš„è”åˆåŠªåŠ›ã€‚è¿™æ˜¯ä¸€é¡¹ä¸ºäº’è”ç½‘ç”¨æˆ·æä¾›æ›´å¿«æ›´å®‰å…¨çš„ DNS çš„åŠªåŠ›(å®ƒæ¯”è°·æ­Œå…¬å…± DNS å¿«ä¸¤å€å¤šğŸš€ğŸš€ğŸš€).ä½†ä¸ä»…ä»…å¦‚æ­¤ï¼Œå®ƒè¿˜æ˜¯ä¸€ä¸ªéšç§ä¼˜å…ˆçš„ DNS æœåŠ¡å™¨ã€‚ä½ è®¤ä¸ºåªæœ‰åƒè°·æ­Œã€è„¸ä¹¦è¿™æ ·çš„å…¬å¸ä¼šè¯•å›¾è¿½è¸ªä½ æ‰€æœ‰çš„åœ¨çº¿æ´»åŠ¨å—(è¿™äº›æ´»åŠ¨å¯ä»¥è¢«ä»¤äººæ•¬ç•çš„éšç§å«å£«å±è”½æ‰)ï¼Ÿä½ çš„ ISP ä¹Ÿä¼šçªƒå¬ä½ æ­£åœ¨è®¿é—®çš„ä»»ä½•ç½‘ç«™ï¼Œå¹¶å‡ºå”®è¿™äº›æ•°æ®ä»¥å‘ä½ æŠ•æ”¾å¹¿å‘Šï¼Œä½ çŒœæ€ä¹ˆç€ï¼Œä»–ä»¬æ˜¯é€šè¿‡ DNS è§£æå™¨åšåˆ°è¿™ä¸€ç‚¹çš„ï¼

1.1.1.1 ä»¥ 0 ç¾å…ƒçš„ä»·æ ¼(æ˜¯çš„ï¼Œä½ æ²¡çœ‹é”™)ä¿æŠ¤ä½ å…å—æ‰€æœ‰è¿™äº›ä¼¤å®³ã€‚ä¸€ä¸ªå°Šé‡ä½ éšç§çš„å…è´¹ã€å¿«é€Ÿã€å®‰å…¨çš„ DNS æœåŠ¡å™¨â€”â€”å¬èµ·æ¥å¥½å¾—ä»¤äººéš¾ä»¥ç½®ä¿¡ï¼Œä¸æ˜¯å—ï¼Ÿä½†è¿™æ˜¯ä¸ºäº†å»ºè®¾ä¸€ä¸ªæ›´å¥½çš„äº’è”ç½‘è€Œåšå‡ºçš„åŠªåŠ›ã€‚ä½ ä¸å¿…ç›¸ä¿¡æˆ‘çš„è¯ï¼Œå¯ä»¥åœ¨ [Cloudflare çš„](https://blog.cloudflare.com/announcing-1111/)å’Œ [APNIC çš„](https://labs.apnic.net/?p=1127)åšå®¢ä¸Šäº†è§£æ›´å¤šã€‚

# é€šè¿‡ bash åˆ‡æ¢ DNS åç§°æœåŠ¡å™¨

æ­£å¦‚æˆ‘ä¹‹å‰æåˆ°çš„ï¼Œæ¯å½“æˆ‘åœ¨å­¦æ ¡å’Œå®¶é‡Œçš„ç½‘ç»œä¹‹é—´æ¥å›åˆ‡æ¢æ—¶ï¼Œé€šè¿‡ç½‘ç»œè®¾ç½® UI æ‰‹åŠ¨æ›´æ–° DNS é…ç½®å¯¹æˆ‘æ¥è¯´å¤ªéº»çƒ¦äº†ã€‚å¾ˆè‡ªç„¶ï¼Œæˆ‘ä¼šè¯•ç€é€šè¿‡æˆ‘çš„ç»ˆç«¯å¼„æ¸…æ¥šæ€ä¹ˆåšã€‚å°±åœ¨é‚£æ—¶ï¼Œæˆ‘å‘ç°äº† macOS å†…ç½®çš„è¿™ä¸ªéå¸¸æ£’çš„å·¥å…·ã€‚ä½¿ç”¨`networksetup`ï¼Œæ›´æ”¹æˆ‘çš„ DNS é…ç½®éå¸¸ç®€å•

```
# Adding 1.1.1.1 to my nameservers
networksetup -setdnsservers Wi-Fi 1.1.1.1
# Clear all my alternate nameservers
networksetup -setdnsservers Wi-Fi empty
```

ç°åœ¨ï¼Œæˆ‘å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è½»æ¾åœ°å°†æˆ‘çš„ DNS è§£æå™¨é…ç½®ä¸ºä¸ 1.1.1.1 çš„è¯´æ˜ç›¸åŒ

```
# 4 nameservers - 2 IPv4 & 2 IPv6
networksetup -setdnsservers Wi-Fi 1.1.1.1 1.0.0.1 2606:4700:4700::1111 2606:4700:4700::1001
```

ä½†æ˜¯è¿™ä¹Ÿæ˜¯ç›¸å½“é•¿çš„è¾“å…¥æ—¶é—´ï¼Œå°½ç®¡æˆ‘æ›´å–œæ¬¢è¿™ä¸ªè€Œä¸æ˜¯ç½‘ç»œåå¥½ç”¨æˆ·ç•Œé¢ã€‚å› æ­¤ï¼Œæˆ‘å°†å®ƒå°è£…åœ¨ä¸€ä¸ª bash å‡½æ•°ä¸­ï¼Œè¾¾åˆ°äº†å¦ä¸€ç§ç¨‹åº¦çš„æ‡’æƒ°

```
function dns1111() {
    networksetup -setdnsservers Wi-Fi 1.1.1.1 1.0.0.1 2606:4700:4700::1111 2606:4700:4700::1001
}
```

è¿™çœ‹èµ·æ¥å¾ˆç®€æ´ï¼Œä¹Ÿå¾ˆæœ‰æ•ˆï¼Œä½†æ˜¯è¯·ç¨ç­‰ã€‚æ¢å›ç©ºçš„æ€ä¹ˆæ ·ï¼Ÿè¿™ä¸ª bash å‡½æ•°çš„ä¸€ä¸ªæ ‡å¿—/å‚æ•°å¯ä»¥å¾ˆå¥½åœ°å®Œæˆè¿™é¡¹å·¥ä½œï¼Œä½†æ˜¯æˆ‘æƒ³å°½å¯èƒ½åœ°ä½¿ç”¨æœ€å°‘çš„åŠªåŠ›ï¼Œå¹¶èŠ‚çœè‡ªå·±è®°ä½å¤‡ç”¨ DNS é…ç½®æ˜¯å¦ä¸ºç©ºçš„ç²¾ç¥è´Ÿæ‹…ã€‚æ‰€ä»¥æˆ‘å¯¹è‡ªå·±è¯´:â€œä¸ºä»€ä¹ˆä¸æ£€æµ‹å½“å‰çŠ¶æ€å¹¶åŸºäºæ­¤åˆ‡æ¢ DNS é…ç½®å‘¢ï¼Ÿå°±åƒä¸€ä¸ªæ–‡å­—å¼€å…³æŒ‰é’®â€”â€”ä½ ä¸éœ€è¦å‘Šè¯‰å®ƒä½ æƒ³è¦å®ƒæ˜¯ä»€ä¹ˆçŠ¶æ€ï¼Œåªæ˜¯ä¸ä¹‹å‰çš„çŠ¶æ€ç›¸åã€‚è€ƒè™‘åˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä¸º`networksetup`æ‰¾åˆ°äº†è¿™ä¸ªé€‰é¡¹ï¼Œå®ƒä¼šå‘Šè¯‰æˆ‘å½“å‰çš„çŠ¶æ€

```
networksetup -getdnsservers Wi-Fi
```

å®ƒä¼šåˆ—å‡ºæˆ‘æ‰€æœ‰çš„å¤‡ç”¨ DNS æœåŠ¡å™¨ï¼Œæˆ–è€…å¦‚æœæ²¡æœ‰çš„è¯ï¼Œæ‰“å°å‡ºè¿™ä¸ªå­—ç¬¦ä¸²`There aren't any DNS Servers set on Wi-Fi`ã€‚ç°åœ¨æˆ‘å¯ä»¥å®Œæˆæˆ‘çš„åŠŸèƒ½äº†ï¼Œç”¨ä¸€äº›å¾ˆé…·çš„è¡¨æƒ…ç¬¦å·æ¥è¡¨ç¤ºé…ç½®æ˜¯åˆšåˆšè¢«åº”ç”¨è¿˜æ˜¯è¢«åˆ é™¤

```
function dns1111() {
  if [[ $(networksetup -getdnsservers Wi-Fi) == "There aren't any DNS Servers set on Wi-Fi"* ]]; then
    networksetup -setdnsservers Wi-Fi 1.1.1.1 1.0.0.1 2606:4700:4700::1111 2606:4700:4700::1001 && echo ğŸš€ ğŸš€ ğŸš€
  else
    networksetup -setdnsservers Wi-Fi empty && echo ğŸš¦ ğŸš¦ ğŸš¦
  fi
}
```

ç°åœ¨æˆ‘å¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨ 1.1.1.1 å’Œé»˜è®¤ DNS é…ç½®ä¹‹é—´æ¥å›åˆ‡æ¢ï¼Œåªéœ€ä¸€ä¸ªç®€çŸ­çš„å‘½ä»¤`dns1111`

# é¢å¤–æ”¶è·:åŸºäº Linux çš„æœºå™¨

ç”±äº`networksetup`åœ¨åŸºäº Linux çš„æ“ä½œç³»ç»Ÿä¸Šä¸å¯ç”¨ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ä¸ªä¸åŒçš„åŒ…æ¥å¸®åŠ©å¤„ç†åä¸º`dnsmasq`çš„ DNS åç§°æœåŠ¡å™¨ã€‚

ä½¿ç”¨å‘è¡Œç‰ˆçš„è½¯ä»¶åŒ…ç®¡ç†å™¨å®‰è£…å®ƒ

```
# this is for Ubuntu
sudo apt-get install dnsmasq
```

å®‰è£…åŒ…å°†é™„å¸¦ä¸€ä¸ªé…ç½®æ–‡ä»¶`/etc/dnsmasq.conf`ï¼Œä»¥ä¾¿æˆ‘ä»¬æ›´æ–°åç§°æœåŠ¡å™¨ã€‚æˆ‘åœ¨ä¸‹é¢åŒ…å«äº†æˆ‘çš„å®ç°ã€‚å¦‚æœä½ æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œè¯·ä¸è¦çŠ¹è±«ï¼Œé€šè¿‡[hung.ngn.the@gmail.com](mailto:hung.ngn.the@gmail.com)è”ç³»æˆ‘

```
function dns1111() {
  # detect existence of the backup file to see whether the config is in place
  if [ -e /etc/dnsmasq.conf.bak ]]; then
    sudo mv /etc/dnsmasq.conf.bak /etc/dnsmasq.conf && echo ğŸš¦ ğŸš¦ ğŸš¦
  else
    sudo cp /etc/dnsmasq.conf /etc/dnsmasq.conf.bak && \
    sudo echo "server=1.1.1.1
server=1.0.0.1
server=2606:4700:4700::1111
server=2606:4700:4700::1001" >> /etc/dnsmasq.conf && \
    sudo service dnsmasq restart && \
    sudo service network-manager restart && \
    echo ğŸš€ ğŸš€ ğŸš€
  fi
}
```

è¿™ç¯‡æ–‡ç« æœ€åˆå‘è¡¨åœ¨[the decodous](https://thecodecousins.com/posts/dns-command/)ä¸Šã€‚