# 4 个真实世界的场景，读起来像混沌工程实验

> 原文：<https://medium.com/capital-one-tech/4-real-world-scenarios-that-read-like-chaos-engineering-experiments-8dbf40c5f247?source=collection_archive---------6----------------------->

## 通过日常经验理解混沌工程

![](img/e38e97d6bb18b50935e0aaaed43b1b14.png)

(场景)

你爱你的妈妈，对吗？她是最棒的。她把你带到这个世界，给你换尿布，帮你做作业，教你做饭，打扫卫生，本质上是照顾好自己。她棒极了。她向你要了什么？不多。也许你可以偶尔打电话。很高兴收到你的来信。也许在母亲节给她买点好东西。你知道，为了表示你的关心。

*但是在这个场景中，你，很不幸，一直等到最后一分钟才给她那份完美的礼物。当然，现在发生了很多事，但是。变得更好。至少你给她找到了她想要的那条俗气的——我是说有品味的——项链。事实上，你已经获得了在线零售商库存中剩下的最后一个。你已经可以想象她打开盒子，自豪而高兴地看着你。这一次，*你*终于成了好兄弟。你把项链放进收银台，准备付款，然后…嘣！在线零售商的服务器崩溃。吐司。几个小时后才回来。当你终于能够重新登录时，项链不见了！现在你必须采用 B 计划，比如鲜花或水果篮。*

*叹息。*

*平心而论，事情本不必如此。当然，你可能是一个超额完成任务的人，几周前就把项链排好了，但出于同样的原因，这家在线零售商应该为母亲节流量的增加做好更充分的准备。*

(/场景)

## ***

[混沌工程](http://principlesofchaos.org/)实验本来是压力测试服务器处理一群等到最后一刻才给妈妈买礼物的孩子的能力的完美解决方案。

解释混沌工程的文章不在少数，所以我不会深入探究其起源。简而言之，**混沌工程允许你在一个软件系统上进行实验，看看它将如何应对各种故障和意外中断**，例如:

*   EC2 实例突然停止
*   意外的 CPU 或内存峰值
*   未知的网络延迟
*   ECS 容器被注销
*   Kubernetes 节点被删除

混沌工程实验是一种测试软件系统弹性的安全而实用的方法——它在保证足够的服务质量的同时容忍这些类型的故障的能力。

我认为展示一些技术实验并提供相应的真实世界场景会很有趣，而不是老一套无聊的混沌工程概述。

# **1。混沌工程实验—负载平衡器**

在技术领域，负载平衡器将传入的网络流量分布在一组后端服务器上。他们路由请求，以确保以最高的速度和效率处理它们。如果一台服务器出现故障，负载平衡器会进行调整，将流量路由和分发到其他服务器。

有了混沌工程，你可以测试你的负载平衡器的设置，看看他们是否是减少停机的最佳选择。您可以运行一个实验，从负载平衡器的目标组中注销一个目标，并观察会发生什么。交通仍然会被有效地路由和分配，还是会使系统崩溃，阻止我们拖延的主角给他的妈妈买一份及时的礼物？

在现实世界中，我喜欢把这个实验想象成超市收银台。你有收银员的标准队伍，10 件商品或更少的队伍，然后是自助结账台。但是，如果人们不遵守 10 件商品的限制，或者不把一周的食品杂货带进自助结账台，会发生什么呢？

混乱，就是这样。

![](img/51e9fd0ed62a7d81bd1021db9a39fe51.png)

您的负载平衡器就像一个值班经理，确保有足够多的寄存器启动并运行，提醒人们遵守 10 项限制规则，并将更长的线引导到其他寄存器，以平衡等待时间。如果它能正常工作，就不会有小孩躺在地板上，等着没完没了的排队。

# **2。混沌工程实验—安全组**

安全组本质上是虚拟防火墙。它们的规则控制允许到达实例的入站流量和允许离开实例的出站流量。它们通过确保您的资源只暴露给受信任的资源和 IP 地址来保护您的资源。“永远不要相信/永远验证”是管理良好的安全方法的核心原则。

一个很好的混沌工程实验是将安全组换成指定的负载平衡器。如果一个随机的安全组设置规则会发生什么？不可信的流量还会通过吗？鲁鲁。请记住，这些实验的全部目的是在问题变成生产问题之前发现问题。

在现实世界中，我把这个实验想象成机场的 TSA。代理人几乎总是很专业，彬彬有礼，尽力而为。但是，如果你把这些训练有素的专业人士和街上随便找的人换了，会发生什么呢？你可能最终坐在一名携带食肉宠物通过海关的乘客旁边。

![](img/d34ef810225360bac79affa5530e0c13.png)

photo created by subinpumsom — [www.freepik.com](http://www.freepik.com)

老虎可能现在很流行，但我不想在跨国飞行中坐在老虎旁边。他们从不尊重扶手礼仪。

一名训练有素的运输安全管理局特工不会让不符合其指导方针的动物登机，更别说顶级捕食者了。当您的混沌工程实验暴露出类似的安全组缺口时，您可以努力减少它们。保持冷静，确保你的安全小组也做好他们的工作。

# **3。混沌工程实验— CPU 尖峰信号**

有时你的本地机器会运行缓慢，就像你错过了早晨的一杯咖啡。延迟的原因有很多，但长时间的速度问题通常表明存在 CPU 峰值问题(即 CPU 占用率)。你有一个进程卡在了某个地方，它阻碍了其他程序的正常运行。也许你违背了自己的判断打开了那个钓鱼链接(我所在地区有魅力的单身人士想见我吗？！)，或者你无聊的孩子借了你的笔记本电脑，下载了他们能找到的所有游戏、节目和电影。不管发生了什么，你的机器正在加载。

你可以运行一个混沌工程实验来强制 CPU 峰值，看看在这种压力下本地机器上的不同应用程序运行得如何。你甚至可以定制扣球百分比来反映不同程度的扣球。这是测试系统弹性和找到处理量阈值的好方法。你可以在可接受的性能和认真考虑带你的机器去找巫医驱魔之间找到突破点。

我喜欢把 CPU 峰值实验看作是新的一个月的开始，届时将有 100 部新的节目和电影同时登陆你最喜欢的流媒体服务。你想把它们都看完，然后你会有点抓狂，因为有太多的选项可供选择。最好给索尔打电话。杀死伊芙！好地方！欧扎克！

Aaaaggggghhhhh！！！！！你能应付看电视的超负荷吗，或者你的盘子、衣服和未付账单会堆积到无法挽回的地步吗？

# **4。混沌工程实验-漏节点。**

好吧，所以引流淋巴结听起来有点恶心，但不要担心——你不必让皮肤科医生参与进来。所有这一切实际上意味着你正在从你在 Kubernetes 的节点驱逐豆荚。您在这里所做的是确保您的节点上不再有任何调度的 pod，并且任何当前活动的正在运行的 pod 都将被驱逐。

用 Kubernetes 的术语来说，pod 代表集群中节点上正在运行的流程。当不再需要它们时，您总是希望让它们优雅地终止——给你一个清理它们的机会。

你可以运行混沌工程实验来识别特定的或随机的节点。您还可以设置参数，比如您希望等待节点耗尽多少秒，或者应该影响多少随机节点。那么，如果您没有先清理干净节点就耗尽了，会发生什么呢？容器编排的斗争是真实的。

我觉得这个实验就像一个可怕的室友。你知道，就是那个总是拖欠房租(但出去喝酒从不迟到)，吃你的食物，堵你的厕所，从不洗碗的人。一开始她看起来很有趣，令人耳目一新，但现在她正在毁掉你的生活。

虽然你肯定已经准备好离开这个室友，但你希望以一种不会引发任何新问题的方式来做这件事。优雅的驱逐在这里意味着提供通知，并遵循所有的法律准则和最佳做法将某人赶出你的公寓。你的生活中不需要更多的戏剧。容器也是如此——耗尽节点，让容器和谐运行。

## ***

虽然我们这些天在日常生活中已经经历了足够多的混乱，但是在一个谨慎和受控的环境中给你的软件开发注入一些混乱是一个很好的实践。找出压力源和拐点在哪里，然后在它们变成生产事故之前努力减轻它们。你的妈妈会为你的主动和准备感到骄傲。这难道不是你给他们最好的礼物吗？不过，为了以防万一，也许明年可以早点拿到那条项链。

## 相关文章

*   [让你的应用混沌就绪的 5 个步骤](/capital-one-tech/5-steps-to-getting-your-app-chaos-ready-capital-one-a5b7b3cb8e09)
*   [持续混沌——将混沌工程引入 DevOps 实践](/capital-one-tech/continuous-chaos-introducing-chaos-engineering-into-devops-practices-75757e1cca6d)
*   [企业实施混沌工程的三点经验](/capital-one-tech/3-lessons-learned-from-implementing-chaos-engineering-at-enterprise-28eb3ffecc57)
*   [拥抱混沌……工程——混沌工程简介](/capital-one-tech/embrace-the-chaos-engineering-203fd6fc6ff7)

*披露声明:2020 资本一。观点是作者个人的观点。除非本帖中另有说明，否则 Capital One 不隶属于所提及的任何公司，也不被这些公司认可。使用或展示的所有商标和其他知识产权是其各自所有者的财产。*