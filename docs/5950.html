<html>
<head>
<title>OCI Logging on Oracle Cloud VMware Solution(OCVS) Virtual Machines</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OCI登录Oracle云VMware解决方案(OCVS)虚拟机</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/oci-logging-on-oracle-cloud-vmware-solution-ocvs-virtual-machines-81df68d5c642?source=collection_archive---------5-----------------------#2022-08-05">https://medium.com/oracledevs/oci-logging-on-oracle-cloud-vmware-solution-ocvs-virtual-machines-81df68d5c642?source=collection_archive---------5-----------------------#2022-08-05</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/41cdb1bcbd19420caf92deab593e1f04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cMX1FooRqUVFyLWD3GpMoQ.jpeg"/></div></div></figure><p id="5c54" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在本文档中，我们将定义为Oracle云VMware解决方案(OCVS)虚拟机启用Oracle云基础架构(OCI)日志记录所需的步骤。</p><p id="596d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">对这些OCI服务的一点介绍:</p><blockquote class="jn jo jp"><p id="4ea1" class="ip iq jq ir b is it iu iv iw ix iy iz jr jb jc jd js jf jg jh jt jj jk jl jm ha bi translated"><strong class="ir hi"> OCI日志记录:</strong>OCI日志记录服务为您租赁的所有日志提供了一个高度可扩展和完全可管理的单一界面。</p><p id="c5a9" class="ip iq jq ir b is it iu iv iw ix iy iz jr jb jc jd js jf jg jh jt jj jk jl jm ha bi translated"><strong class="ir hi"> OCVS: </strong> Oracle Cloud VMware解决方案允许您在Oracle Cloud Infrastructure中创建和管理VMware支持的软件定义的数据中心(SDDCs)。</p></blockquote><p id="be13" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">对于这个用例，我们将使用OCI日志记录的自定义日志功能。其工作方式如下所述:</p><ol class=""><li id="d1fb" class="ju jv hh ir b is it iw ix ja jw je jx ji jy jm jz ka kb kc bi translated">配置OCI身份和管理(IAM)用户、用户组和必需的策略。</li><li id="fd2d" class="ju jv hh ir b is kd iw ke ja kf je kg ji kh jm jz ka kb kc bi translated">配置从OCVS SDDC资源到甲骨文服务网络(OSN)的连接</li><li id="ca59" class="ju jv hh ir b is kd iw ke ja kf je kg ji kh jm jz ka kb kc bi translated">从OCI控制台定义代理配置，这为您提供了一种集中体验，让您可以轻松配置要在您的虚拟机群中接收的自定义日志。</li><li id="5d07" class="ju jv hh ir b is kd iw ke ja kf je kg ji kh jm jz ka kb kc bi translated">在所有OCVS虚拟机上安装统一监控代理。代理从您的应用或系统发出日志的本地目录中提取日志。</li></ol><p id="09d9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">尽管有一些文档可以实现这一点，但根据我的经验，还是有一些细微的变化。</p><figure class="kj kk kl km fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ki"><img src="../Images/49e5690207594049313327ce7557f903.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KWHRVckcRTbpZzEQSQEO0Q.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">Use Case Details</figcaption></figure></div><div class="ab cl kr ks go kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ha hb hc hd he"><h1 id="b45a" class="ky kz hh bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">配置OCI身份和管理(IAM)用户、用户组和必需的策略。</h1><p id="cd48" class="pw-post-body-paragraph ip iq hh ir b is lw iu iv iw lx iy iz ja ly jc jd je lz jg jh ji ma jk jl jm ha bi translated">统一监控代理使用/etc/unified-monitoring-agent/。oci/config对日志进行身份验证并将其接收到oci日志记录中。</p><p id="2c68" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我不会详细介绍<a class="ae mb" href="https://docs.oracle.com/en/cloud/paas/integration-cloud/oracle-integration-gov/create-oci-group-and-users-gov.html" rel="noopener ugc nofollow" target="_blank">如何创建用户和用户组</a>，但是需要的必要策略有:</p><blockquote class="jn jo jp"><p id="ef38" class="ip iq jq ir b is it iu iv iw ix iy iz jr jb jc jd js jf jg jh jt jj jk jl jm ha bi translated">允许组<user_group_name>在租用中使用日志内容<br/>允许组&lt; user_group_name &gt;在隔离专区&lt;隔离专区名称&gt;中使用日志内容</user_group_name></p></blockquote><h1 id="4aa5" class="ky kz hh bd la lb mc ld le lf md lh li lj me ll lm ln mf lp lq lr mg lt lu lv bi translated">配置从OCVS SDDC资源到甲骨文服务网络(OSN)的连接</h1><p id="1606" class="pw-post-body-paragraph ip iq hh ir b is lw iu iv iw lx iy iz ja ly jc jd je lz jg jh ji ma jk jl jm ha bi translated">此步骤帮助您使用服务网关配置从SDDC资源到Oracle服务网络(OSN)的连接。服务网关允许您的SDDC资源私下访问特定的Oracle服务，而不会将数据暴露给公共互联网。</p><p id="23fb" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">导航至<em class="jq"> OCI控制台- &gt;混合- &gt;软件定义的数据中心- &gt;配置与Oracle服务网络的连接</em></p><p id="f1e8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">下面是该工作流页面的注释，供您参考:</p><blockquote class="jn jo jp"><p id="6a42" class="ip iq jq ir b is it iu iv iw ix iy iz jr jb jc jd js jf jg jh jt jj jk jl jm ha bi translated"><em class="hh">该工作流程自动进入SDDC工作量CIDR。</em></p><p id="f40c" class="ip iq jq ir b is it iu iv iw ix iy iz jr jb jc jd js jf jg jh jt jj jk jl jm ha bi translated"><em class="hh">该工作流确定了从NSX Edge上行链路1 VLAN到Oracle服务网络的路由要求。如果没有连接到VCN的服务网关，工作流会帮助您创建一个。</em></p><p id="c233" class="ip iq jq ir b is it iu iv iw ix iy iz jr jb jc jd js jf jg jh jt jj jk jl jm ha bi translated"><em class="hh">最后，创建或更新任何缺失的路由表、规则或网络安全组(NSG)。</em></p></blockquote><p id="200d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">注:</strong></p><p id="1f0d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我不是VMware专家。根据我对SDDC工作负载的理解，CIDR是OCVS虚拟机的逻辑网络。虚拟机从这里获得它们的IP。NSX边缘上行链路1用于VMware SDDC和Oracle云基础架构之间的通信。启用服务网络工作流负责配置路由等。如上所述。</p><h1 id="21a0" class="ky kz hh bd la lb mc ld le lf md lh li lj me ll lm ln mf lp lq lr mg lt lu lv bi translated">从OCI控制台定义代理配置</h1><p id="9f9c" class="pw-post-body-paragraph ip iq hh ir b is lw iu iv iw lx iy iz ja ly jc jd je lz jg jh ji ma jk jl jm ha bi translated">此步骤支持集中管理代理配置。</p><blockquote class="jn jo jp"><p id="8857" class="ip iq jq ir b is it iu iv iw ix iy iz jr jb jc jd js jf jg jh jt jj jk jl jm ha bi translated"><em class="hh">导航至可观察性&amp;管理- &gt;记录- &gt;日志组:创建一个日志组名称(示例“ocvs-demo”)</em></p><p id="f9ed" class="ip iq jq ir b is it iu iv iw ix iy iz jr jb jc jd js jf jg jh jt jj jk jl jm ha bi translated"><em class="hh">导航到可观察性&amp;管理- &gt;日志- &gt;创建定制日志:创建一个日志名(例如“ocvs-demo-log”)并将其添加到上一步创建的日志组</em></p><p id="f901" class="ip iq jq ir b is it iu iv iw ix iy iz jr jb jc jd js jf jg jh jt jj jk jl jm ha bi translated"><em class="hh">导航到可观察性&amp;管理- &gt;记录- &gt;代理配置:创建一个代理配置(示例ocvs-demo-agent-config) </em></p></blockquote><blockquote class="mh"><p id="a82f" class="mi mj hh bd mk ml mm mn mo mp mq jm dx translated"><em class="mr">见下图并配置数值。</em></p></blockquote><figure class="mt mu mv mw mx ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ms"><img src="../Images/35bf369008fcbbed7f1cf65caa1c5520.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f8pcBxGBEF849dfRYzVAhA.png"/></div></div><figcaption class="kn ko et er es kp kq bd b be z dx">OCI Centralized Agent configuration</figcaption></figure><h1 id="d854" class="ky kz hh bd la lb mc ld le lf md lh li lj me ll lm ln mf lp lq lr mg lt lu lv bi translated">在所有OCVS虚拟机上安装统一监控代理</h1><p id="2230" class="pw-post-body-paragraph ip iq hh ir b is lw iu iv iw lx iy iz ja ly jc jd je lz jg jh ji ma jk jl jm ha bi translated">为了测试这一点，我使用vSphere client创建了一个RHEL 7虚拟机，然后按照以下步骤操作:</p><ol class=""><li id="bf04" class="ju jv hh ir b is it iw ix ja jw je jx ji jy jm jz ka kb kc bi translated">下载适合您的平台的RPM，并使用此处<a class="ae mb" href="https://docs.oracle.com/en-us/iaas/Content/Logging/Concepts/agent_management.htm#installing_the_agent__existing_instances_install" rel="noopener ugc nofollow" target="_blank">提到的说明</a>在OCVS虚拟机上安装。</li></ol><p id="0652" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">对于RHEL 7，我遵循以下步骤:</p><blockquote class="jn jo jp"><p id="c8ae" class="ip iq jq ir b is it iu iv iw ix iy iz jr jb jc jd js jf jg jh jt jj jk jl jm ha bi translated">wget<a class="ae mb" href="https://objectstorage.us-phoenix-1.oraclecloud.com/n/axmjwnk4dzjv/b/unified-monitoring-agent-ol-bucket/o/unified-monitoring-agent-ol-7-0.1.1.rpm" rel="noopener ugc nofollow" target="_blank">https://object storage . us-phoenix-1 . Oracle cloud . com/n/axmjwnk 4 dzjv/b/unified-monitoring-agent-ol-bucket/o/unified-monitoring-agent-ol-7-0 . 1 . 1 . rpm</a></p><p id="2e72" class="ip iq jq ir b is it iu iv iw ix iy iz jr jb jc jd js jf jg jh jt jj jk jl jm ha bi translated">sudo yum install-y unified-monitoring-agent-ol-7–0 . 1 . 1 . rpm</p></blockquote><p id="ff2a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">确保这些服务正在运行:</p><blockquote class="jn jo jp"><p id="f1b4" class="ip iq jq ir b is it iu iv iw ix iy iz jr jb jc jd js jf jg jh jt jj jk jl jm ha bi translated">systemctl状态统一监控代理服务</p><p id="76d6" class="ip iq jq ir b is it iu iv iw ix iy iz jr jb jc jd js jf jg jh jt jj jk jl jm ha bi translated">systemctl状态统一监控代理配置下载器服务</p><p id="00ec" class="ip iq jq ir b is it iu iv iw ix iy iz jr jb jc jd js jf jg jh jt jj jk jl jm ha bi translated">systemctl状态统一监控代理配置下载器定时器</p><p id="4755" class="ip iq jq ir b is it iu iv iw ix iy iz jr jb jc jd js jf jg jh jt jj jk jl jm ha bi translated">systemctl状态统一-监控-代理_重启程序.路径</p></blockquote><p id="71cf" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">查看每个服务的状态:Loaded和Active是合适的状态。更多细节请参考此<a class="ae mb" href="https://docs.oracle.com/en-us/iaas/Content/Logging/Reference/agent_troubleshooting.htm#agent_troubleshooting_linux__systemdunits" rel="noopener ugc nofollow" target="_blank">文件</a>。</p><p id="3183" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">2.为正在运行的实例配置用户API密钥。要生成用户API密钥，请遵循<a class="ae mb" href="https://docs.oracle.com/en-us/iaas/Content/API/Concepts/apisigningkey.htm#two" rel="noopener ugc nofollow" target="_blank">如何生成API签名密钥</a>中描述的说明。</p><ul class=""><li id="f1b0" class="ju jv hh ir b is it iw ix ja jw je jx ji jy jm my ka kb kc bi translated"><strong class="ir hi"> (Linux)步骤2a </strong>。放置了”。oci”目录及其在/etc/unified-monitoring-agent下的内容。</li><li id="4053" class="ju jv hh ir b is kd iw ke ja kf je kg ji kh jm my ka kb kc bi translated"><strong class="ir hi"> (Windows)步骤2a </strong>。对于Windows，有一些不同的步骤，因此请确保遵循适当的步骤。创造了”。oci "文件夹及其目录C:\oracle_unified_agent中的内容。</li></ul><p id="6cd6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">3.按照<a class="ae mb" href="https://docs.oracle.com/en-us/iaas/Content/Functions/Tasks/functionsconfigureocicli.htm#Create_a_Profile_in_the_Oracle_Cloud_Infrastructure_CLI_Configuration_File" rel="noopener ugc nofollow" target="_blank">在Oracle云基础设施CLI配置文件</a>中创建概要文件中描述的说明，在下一步中创建带有修改的配置文件。</p><p id="6ad3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">4.按照<a class="ae mb" href="https://docs.oracle.com/en-us/iaas/Content/Functions/Tasks/functionsconfigureocicli.htm#Create_a_Profile_in_the_Oracle_Cloud_Infrastructure_CLI_Configuration_File" rel="noopener ugc nofollow" target="_blank">中的步骤在Oracle云基础架构CLI配置文件</a>中创建配置文件后，确保将该部分的配置文件(<em class="jq"> &lt;配置文件名称&gt; </em>)命名为“UNIFIED_MONITORING_AGENT”。<br/>以下是统一监控代理用于服务身份验证的配置示例:</p><blockquote class="jn jo jp"><p id="4581" class="ip iq jq ir b is it iu iv iw ix iy iz jr jb jc jd js jf jg jh jt jj jk jl jm ha bi translated">[默认]</p><p id="0331" class="ip iq jq ir b is it iu iv iw ix iy iz jr jb jc jd js jf jg jh jt jj jk jl jm ha bi translated">[统一_监控_代理] <br/> user=ocid1.user.region..AAA…<br/>fingerprint =<em class="hh">&lt;cert fingerprint&gt;</em><br/>key _ file =/path/to/OCI folder/。OCI/private . PEM<br/>tenancy = ocid 1 . tenancy . region..AAA…<br/>region =<em class="hh">&lt;instances region&gt;</em><br/>pass _ phrase = " pashphrase 1234 "</p></blockquote><p id="631a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">注意:</strong>缺省配置文件也是需要的，否则你会遇到<strong class="ir hi">DefaultProfileDoesNotExistError</strong></p><p id="acf9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我建议在放置。oci配置文件夹在其位置/etc/unified-monitoring-agent/</p><blockquote class="jn jo jp"><p id="8d28" class="ip iq jq ir b is it iu iv iw ix iy iz jr jb jc jd js jf jg jh jt jj jk jl jm ha bi translated">systemctl重新启动统一监控代理服务</p></blockquote><p id="a3e9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">5.确保您可以到达记录摄取端点，请将所有端点<a class="ae mb" href="https://docs.oracle.com/en-us/iaas/api/#/en/logging-dataplane/20200831/" rel="noopener ugc nofollow" target="_blank">都转到此处</a>。我正在测试下面的东京地区端点。</p><pre class="kj kk kl km fd mz na nb bn nc nd bi"><span id="14ba" class="ne kz hh na b be nf ng l nh ni">$ nc -zv ingestion.logging.ap-tokyo-1.oci.oraclecloud.com 443</span></pre><p id="e0c9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">稍等片刻，您应该会看到下面的fluentd配置从我们在前面的步骤中创建的中央代理配置中下载。</p><figure class="kj kk kl km fd ii er es paragraph-image"><div class="er es nj"><img src="../Images/66afb7ffe58e5133d78b37e3c28eb6d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*7rKMCyIAY211-p0pmZi4qQ.png"/></div></figure><h1 id="5380" class="ky kz hh bd la lb mc ld le lf md lh li lj me ll lm ln mf lp lq lr mg lt lu lv bi translated">核实</h1><p id="4b4d" class="pw-post-body-paragraph ip iq hh ir b is lw iu iv iw lx iy iz ja ly jc jd je lz jg jh ji ma jk jl jm ha bi translated">登录<em class="jq"> OCI控制台- &gt;可观察性&amp;管理- &gt;日志记录-&gt;&lt;your _ log _ name&gt;</em>，应该会看到日志传过来。</p></div><div class="ab cl kr ks go kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ha hb hc hd he"><p id="a8c5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您还没有注册，现在就可以<a class="ae mb" href="https://signup.cloud.oracle.com/?language=en" rel="noopener ugc nofollow" target="_blank">注册Oracle云免费层帐户</a>。如果你对如何开始学习OCI感兴趣，注册是第一步，没有必要跟着这篇文章走。</p><p id="7803" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你对甲骨文开发人员的行为感到好奇，或者想问一个问题，<a class="ae mb" href="https://bit.ly/odevrel_slack" rel="noopener ugc nofollow" target="_blank">加入我们的公共Slack频道</a>！</p></div></div>    
</body>
</html>