<html>
<head>
<title>Experimenting with Jetpack Glance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">试用Jetpack Glance</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/experimenting-with-jetpack-glance-35fbffe520f4?source=collection_archive---------0-----------------------#2022-09-01">https://medium.com/androiddevelopers/experimenting-with-jetpack-glance-35fbffe520f4?source=collection_archive---------0-----------------------#2022-09-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="948e" class="pw-post-body-paragraph if ig hh ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc ha bi translated"><a class="ae jd" href="https://github.com/google/glance-experimental-tools" rel="noopener ugc nofollow" target="_blank">T3【https://github.com/google/glance-experimental-tools】T5</a></p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es jf"><img src="../Images/1f4fb795c656613465e5454b9d1647d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gfm9zG95iVoEX5Gu"/></div></div></figure><p id="0bdf" class="pw-post-body-paragraph if ig hh ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc ha bi translated">我们很高兴地宣布，新的<a class="ae jd" href="https://android-developers.googleblog.com/2021/12/announcing-jetpack-glance-alpha-for-app.html" rel="noopener ugc nofollow" target="_blank"> Jetpack Glance框架</a>已经<a class="ae jd" href="https://developer.android.com/jetpack/androidx/releases/glance#1.0.0-alpha04" rel="noopener ugc nofollow" target="_blank">达到alpha-04 </a>，它允许您使用类似Jetpack Compose的代码来构建应用程序小部件和穿戴磁贴。</p><p id="6270" class="pw-post-body-paragraph if ig hh ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc ha bi translated">此版本带来了新功能、突破性变化和新API:</p><figure class="jg jh ji jj fd jk"><div class="bz dy l di"><div class="jr js l"/></div></figure><p id="642b" class="pw-post-body-paragraph if ig hh ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc ha bi translated">我们还刚刚发布了一个独立的实验库<a class="ae jd" href="https://github.com/google/glance-experimental-tools" rel="noopener ugc nofollow" target="_blank"><strong class="ih hi"/></a>来为Jetpack Glance补充一些开发时通常需要但现在还没有的工具。</p><blockquote class="jt ju jv"><p id="cd9e" class="if ig je ih b ii ij ik il im in io ip jw ir is it jx iv iw ix jy iz ja jb jc ha bi translated"><strong class="ih hi">重要:</strong>该项目独立于<a class="ae jd" href="https://cs.android.com/androidx/platform/frameworks/support/+/androidx-main:glance/" rel="noopener ugc nofollow" target="_blank"> AndroidX Glance库</a>和开发。在将来,<code class="du jz ka kb kc b"><a class="ae jd" href="https://developer.android.com/reference/kotlin/androidx/glance/appwidget/GlanceRemoteViews" rel="noopener ugc nofollow" target="_blank"><em class="hh">GlanceRemoteViews</em></a></code> API和实验库中的任何特性可能会改变或变得过时(因此可能会被废弃)。</p></blockquote><h2 id="c993" class="kd ke hh bd kf kg kh ki kj kk kl km kn iq ko kp kq iu kr ks kt iy ku kv kw kx bi translated">为什么这些不能在AndroidX里？</h2><p id="b999" class="pw-post-body-paragraph if ig hh ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc ha bi translated">我们希望更自由地迭代、探索和试验一些新的API和工具，而不增加主API的开销并避免API承诺。此外，这些特性中的一些可能在AndroidX中不被允许。</p><p id="0952" class="pw-post-body-paragraph if ig hh ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc ha bi translated"><strong class="ih hi">注意:</strong>这个存储库遵循<a class="ae jd" href="https://github.com/google/accompanist" rel="noopener ugc nofollow" target="_blank">伴奏者</a>模式，但是范围要窄得多(在这里<a class="ae jd" rel="noopener" href="/androiddevelopers/jetpack-compose-accompanist-an-faq-b55117b02712">阅读更多信息</a></p><h1 id="497b" class="ld ke hh bd kf le lf lg kj lh li lj kn lk ll lm kq ln lo lp kt lq lr ls kw lt bi translated"><strong class="ak">扫视实验工具</strong></h1><p id="09b6" class="pw-post-body-paragraph if ig hh ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc ha bi translated">最初的想法是使用新的<strong class="ih hi">实验性的</strong> <code class="du jz ka kb kc b"><a class="ae jd" href="https://developer.android.com/reference/kotlin/androidx/glance/appwidget/GlanceRemoteViews" rel="noopener ugc nofollow" target="_blank">GlanceRemoteViews</a></code> API和Jetpack Compose一起启用新特性。让我们探索第一个可用的模块:</p><h2 id="741d" class="kd ke hh bd kf kg kh ki kj kk kl km kn iq ko kp kq iu kr ks kt iy ku kv kw kx bi translated"><a class="ae jd" href="https://github.com/google/glance-experimental-tools/tree/main/appwidget-host" rel="noopener ugc nofollow" target="_blank">T5】app widget主机可组合T7】</a></h2><p id="30b5" class="pw-post-body-paragraph if ig hh ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc ha bi translated">您可以使用<code class="du jz ka kb kc b">AppWidgetHost</code> composable在您的应用程序中托管和显示RemoteViews。这个模块和新的<code class="du jz ka kb kc b">GlanceRemoteViews</code> API一起，为其他模块提供了一个显示RemoteViews对象的简单API，与AppWidgets和Glance分离。</p><p id="eff6" class="pw-post-body-paragraph if ig hh ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc ha bi translated">让我们来看一个例子:</p><figure class="jg jh ji jj fd jk"><div class="bz dy l di"><div class="lu js l"/></div></figure><p id="1b18" class="pw-post-body-paragraph if ig hh ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc ha bi translated"><code class="du jz ka kb kc b">AppWidgetHostState</code>用给定的远程视图更新主机。在这里，我们可以使用新的<code class="du jz ka kb kc b">GlanceRemoteViews</code> API从一个可组合的函数中生成它们。</p><p id="db6a" class="pw-post-body-paragraph if ig hh ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc ha bi translated">点击阅读关于本模块<a class="ae jd" href="https://github.com/google/glance-experimental-tools/tree/main/appwidget-host" rel="noopener ugc nofollow" target="_blank">的更多信息。</a></p><blockquote class="jt ju jv"><p id="13c6" class="if ig je ih b ii ij ik il im in io ip jw ir is it jx iv iw ix jy iz ja jb jc ha bi translated"><strong class="ih hi">注意:</strong>你可以直接使用RemoteViews而不用Glance，因为这个模块不依赖于glance-appwidget。</p></blockquote><h2 id="8fa4" class="kd ke hh bd kf kg kh ki kj kk kl km kn iq ko kp kq iu kr ks kt iy ku kv kw kx bi translated"><a class="ae jd" href="https://github.com/google/glance-experimental-tools/tree/main/appwidget-preview" rel="noopener ugc nofollow" target="_blank"><strong class="ak">glance-app widget的查看器</strong> </a></h2><p id="c2fe" class="pw-post-body-paragraph if ig hh ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc ha bi translated">当谈到测试和调试AppWidgets时，一个主要的痛点是部署一次迭代所需的费力过程<strong class="ih hi"> : </strong></p><ol class=""><li id="fef7" class="lv lw hh ih b ii ij im in iq lx iu ly iy lz jc ma mb mc md bi translated">构建您的项目。😃</li><li id="6341" class="lv lw hh ih b ii me im mf iq mg iu mh iy mi jc ma mb mc md bi translated">启动应用程序。🙂</li><li id="0026" class="lv lw hh ih b ii me im mf iq mg iu mh iy mi jc ma mb mc md bi translated">关闭应用程序。😐</li><li id="2da8" class="lv lw hh ih b ii me im mf iq mg iu mh iy mi jc ma mb mc md bi translated">在启动器中移除和添加应用程序小部件😕(或<a class="ae jd" rel="noopener" href="/androiddevelopers/demystifying-jetpack-glance-for-app-widgets-8fbc7041955c#:~:text=%E2%80%9CHow%20can%20I%20apply%20changes%20faster%3F%E2%80%9D">使用此变通办法</a> ☹️)</li><li id="2f0b" class="lv lw hh ih b ii me im mf iq mg iu mh iy mi jc ma mb mc md bi translated">搞定了。🥵</li></ol><p id="8b9f" class="pw-post-body-paragraph if ig hh ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc ha bi translated">即使有变通方法，这个过程也相当耗时。由于还没有<strong class="ih hi">和</strong>Glance的预览版，在没有立即看到结果的情况下对组件进行修改可能会很棘手。</p><blockquote class="mj"><p id="5170" class="mk ml hh bd mm mn mo mp mq mr ms jc dx translated">…等一下，“实时编辑”和Glance一起工作？</p></blockquote><figure class="mu mv mw mx my jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es mt"><img src="../Images/ae30293955c47ed4ec46790a257b4b24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*6fWx6pjkd7JmsDlalmcScQ.gif"/></div></div><figcaption class="mz na et er es nb nc bd b be z dx">Code changes on the left, gets reflected in the device on the right</figcaption></figure><p id="10a8" class="pw-post-body-paragraph if ig hh ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc ha bi translated">没错:不再需要等待应用程序构建和启动。通过为您的调试版本扩展<code class="du jz ka kb kc b"><a class="ae jd" href="https://github.com/google/glance-experimental-tools/blob/main/appwidget-preview/src/main/java/com/google/android/glance/tools/preview/AppWidgetPreviewActivity.kt" rel="noopener ugc nofollow" target="_blank">GlancePreviewActivity</a></code>，您可以加速UI迭代。扩展活动在你自己的应用程序(而不是启动器)中显示你的应用程序的小部件，提供更快的预览，并支持Android Studio中的<a class="ae jd" href="https://developer.android.com/studio/run#apply-changes" rel="noopener ugc nofollow" target="_blank">应用更改</a>和<a class="ae jd" href="https://developer.android.com/jetpack/compose/tooling#live-edit" rel="noopener ugc nofollow" target="_blank">实时编辑</a>功能。</p><p id="6309" class="pw-post-body-paragraph if ig hh ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc ha bi translated">glance-appwidget查看器不依赖于<code class="du jz ka kb kc b"><a class="ae jd" href="https://developer.android.com/reference/android/appwidget/AppWidgetManager" rel="noopener ugc nofollow" target="_blank">AppWidgetManager</a></code>；而是直接使用<code class="du jz ka kb kc b">AppWidgetHostView</code>跳过<code class="du jz ka kb kc b">BroadcastReceiver</code>机制，在app的activity内部渲染<a class="ae jd" href="https://developer.android.com/reference/android/widget/RemoteViews" rel="noopener ugc nofollow" target="_blank"> RemoteViews </a>(有一些<a class="ae jd" href="https://github.com/google/glance-experimental-tools/tree/main/appwidget-preview#Limitations" rel="noopener ugc nofollow" target="_blank">限制</a>)。</p><p id="604d" class="pw-post-body-paragraph if ig hh ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc ha bi translated">使用这个查看器，结合Compose和<a class="ae jd" href="https://developer.android.com/jetpack/compose/tooling#live-edit" rel="noopener ugc nofollow" target="_blank"> Live Edit </a>，我们可以实现(在大多数情况下<a class="ae jd" href="https://developer.android.com/studio/run#limitations" rel="noopener ugc nofollow" target="_blank">)实时更新机制，几乎即时地在您的Glance组件中显示代码更改。</a></p><p id="b929" class="pw-post-body-paragraph if ig hh ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc ha bi translated">不仅如此，查看器活动还支持其他可用的开发工具，如<a class="ae jd" href="https://developer.android.com/jetpack/compose/tooling#layout-inspector" rel="noopener ugc nofollow" target="_blank">布局检查器</a>。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es jf"><img src="../Images/c99e67af7ef568ffb5bbe66dc89a92da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Xi7nJcDX9D2TWRzY"/></div></div><figcaption class="mz na et er es nb nc bd b be z dx">Inspecting a GlanceAppWidget with Layout-Inspector</figcaption></figure><p id="d960" class="pw-post-body-paragraph if ig hh ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc ha bi translated">此外，查看器活动还提供以下功能:</p><ul class=""><li id="6716" class="lv lw hh ih b ii ij im in iq lx iu ly iy lz jc nd mb mc md bi translated">🔀在不同的小工具之间切换</li><li id="5bb1" class="lv lw hh ih b ii me im mf iq mg iu mh iy mi jc nd mb mc md bi translated">🔎调整大小并反映小工具可用空间的变化(考虑<a class="ae jd" href="https://developer.android.com/reference/androidx/glance/appwidget/SizeMode" rel="noopener ugc nofollow" target="_blank">大小模式</a></li><li id="791f" class="lv lw hh ih b ii me im mf iq mg iu mh iy mi jc nd mb mc md bi translated">ℹ️突出显示丢失的<a class="ae jd" href="https://developer.android.com/develop/ui/views/appwidgets#AppWidgetProviderInfo" rel="noopener ugc nofollow" target="_blank"> appwidget元数据</a></li><li id="3042" class="lv lw hh ih b ii me im mf iq mg iu mh iy mi jc nd mb mc md bi translated">📌请求启动器<a class="ae jd" href="https://developer.android.com/guide/topics/appwidgets/configuration#pin" rel="noopener ugc nofollow" target="_blank">锁定</a>当前预览</li><li id="eb28" class="lv lw hh ih b ii me im mf iq mg iu mh iy mi jc nd mb mc md bi translated">当前预览的🖼️提取和分享(<a class="ae jd" href="https://developer.android.com/develop/ui/views/appwidgets#preview" rel="noopener ugc nofollow" target="_blank"> android:previewImage </a></li></ul><figure class="jg jh ji jj fd jk er es paragraph-image"><div class="er es ne"><img src="../Images/c65863295955f72b1c5e166e7a2ecd92.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/0*S0AoszvIuiMQkxeu"/></div></figure><p id="f652" class="pw-post-body-paragraph if ig hh ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc ha bi translated">在<a class="ae jd" href="https://github.com/google/glance-experimental-tools/tree/main/appwidget-preview#additional-features" rel="noopener ugc nofollow" target="_blank">附加功能部分</a>阅读更多信息，并检查项目的<a class="ae jd" href="https://github.com/google/glance-experimental-tools/tree/main/appwidget-preview#setup" rel="noopener ugc nofollow" target="_blank">设置部分</a>。</p><h2 id="1223" class="kd ke hh bd kf kg kh ki kj kk kl km kn iq ko kp kq iu kr ks kt iy ku kv kw kx bi translated">使用撰写@预览</h2><p id="1e98" class="pw-post-body-paragraph if ig hh ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc ha bi translated">查看器活动提供了有用的功能，但它需要额外的设置和材料依赖性。如果您只想使用Android Studio 中的<a class="ae jd" href="https://developer.android.com/jetpack/compose/tooling" rel="noopener ugc nofollow" target="_blank">内置预览机制显示GlanceAppWidgets的预览，也可以使用</a><a class="ae jd" href="https://developer.android.com/jetpack/compose/tooling" rel="noopener ugc nofollow" target="_blank">GlanceAppWidgetHostPreview</a>。</p><figure class="jg jh ji jj fd jk"><div class="bz dy l di"><div class="lu js l"/></div></figure><blockquote class="jt ju jv"><p id="bb79" class="if ig je ih b ii ij ik il im in io ip jw ir is it jx iv iw ix jy iz ja jb jc ha bi translated"><strong class="ih hi">注意:</strong>虽然预览会在Android Studio中呈现，但RemoteViews不会。您必须始终在设备中运行它。稍后将对此提供更好的支持。</p></blockquote><h2 id="7ded" class="kd ke hh bd kf kg kh ki kj kk kl km kn iq ko kp kq iu kr ks kt iy ku kv kw kx bi translated"><a class="ae jd" href="https://github.com/google/glance-experimental-tools/tree/main/appwidget-configuration" rel="noopener ugc nofollow" target="_blank"> <strong class="ak"> GlanceAppWidget配置可组合</strong> </a></h2><p id="696e" class="pw-post-body-paragraph if ig hh ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc ha bi translated">这个GlanceAppWidget配置可组合模块提供了一个自以为是的可组合模块，可以在您的应用程序小部件的<a class="ae jd" href="https://developer.android.com/guide/topics/appwidgets/configuration" rel="noopener ugc nofollow" target="_blank">配置</a>活动中使用。简而言之，它构建在<a class="ae jd" href="https://developer.android.com/reference/kotlin/androidx/compose/material3/package-summary#Scaffold(androidx.compose.ui.Modifier,kotlin.Function0,kotlin.Function0,kotlin.Function0,kotlin.Function0,androidx.compose.material3.FabPosition,androidx.compose.ui.graphics.Color,androidx.compose.ui.graphics.Color,kotlin.Function1)" rel="noopener ugc nofollow" target="_blank"> Material3 Scaffold </a>之上，为Glance显示和处理appwidget活动配置逻辑。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div class="er es nf"><img src="../Images/0d27ca6b234eb5f4bd2282ddc1d9773e.png" data-original-src="https://miro.medium.com/v2/resize:fit:662/1*hyhBg6g_aI-twGhZUQHiqQ.gif"/></div></figure><p id="d7e4" class="pw-post-body-paragraph if ig hh ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc ha bi translated">这种组合非常适合:</p><ul class=""><li id="2154" class="lv lw hh ih b ii ij im in iq lx iu ly iy lz jc nd mb mc md bi translated">使启动器和配置屏幕之间的转换更加平滑和一致(<a class="ae jd" href="https://material.io/blog/announcing-material-you" rel="noopener ugc nofollow" target="_blank"> Material You！</a>)</li><li id="3ff0" class="lv lw hh ih b ii me im mf iq mg iu mh iy mi jc nd mb mc md bi translated">显示appwidget的真实预览(保留大小)以帮助用户配置它</li><li id="f2bd" class="lv lw hh ih b ii me im mf iq mg iu mh iy mi jc nd mb mc md bi translated">使GlanceAppWidget能够反映状态更改，而无需实际应用它们</li></ul><p id="57ad" class="pw-post-body-paragraph if ig hh ih b ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc ha bi translated">查看本指南开始使用！</p><h1 id="4652" class="ld ke hh bd kf le lf lg kj lh li lj kn lk ll lm kq ln lo lp kt lq lr ls kw lt bi translated"><strong class="ak">下一步是什么？</strong></h1><p id="d94e" class="pw-post-body-paragraph if ig hh ih b ii ky ik il im kz io ip iq la is it iu lb iw ix iy lc ja jb jc ha bi translated">我们正在探索其他工具来帮助你用Glance构建更好的glanceables。同时，我们期待您的反馈。请使用GitHub<a class="ae jd" href="https://github.com/google/glance-experimental-tools/issues" rel="noopener ugc nofollow" target="_blank">报告问题或功能请求</a> (psst！非常欢迎投稿！).</p><div class="ng nh ez fb ni nj"><a href="https://github.com/google/glance-experimental-tools" rel="noopener  ugc nofollow" target="_blank"><div class="nk ab dw"><div class="nl ab nm cl cj nn"><h2 class="bd hi fi z dy no ea eb np ed ef hg bi translated">GitHub-Google/Glance-Experimental-Tools:Glance Experimental Tools旨在补充Jetpack…</h2><div class="nq l"><h3 class="bd b fi z dy no ea eb np ed ef dx translated">Glance实验工具旨在为Jetpack Glance补充开发人员通常需要的特性，但是…</h3></div><div class="nr l"><p class="bd b fp z dy no ea eb np ed ef dx translated">github.com</p></div></div><div class="ns l"><div class="nt l nu nv nw ns nx jp nj"/></div></div></a></div></div></div>    
</body>
</html>