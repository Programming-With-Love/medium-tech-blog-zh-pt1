<html>
<head>
<title>Build React Native IPA+APK using CLI (Simple CI/CD)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用CLI(简单CI/CD)构建React本机IPA+APK</h1>
<blockquote>原文：<a href="https://medium.easyread.co/build-react-native-ipa-apk-using-cli-simple-ci-cd-2b8303d079e0?source=collection_archive---------0-----------------------#2020-03-28">https://medium.easyread.co/build-react-native-ipa-apk-using-cli-simple-ci-cd-2b8303d079e0?source=collection_archive---------0-----------------------#2020-03-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="f147" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">了解在React Native上构建IPA+APK文件的基本CLI</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/5938d411c25beb6e5f81089c082f3982.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h6DfsUO7bKTydbeunuaDKA.jpeg"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="http://pexels.com/photo/person-holding-silver-iphone-7-887751/" rel="noopener ugc nofollow" target="_blank">pexels.com</a></figcaption></figure><p id="5d9e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">大家好！在这一部分，我想再次分享一些关于软件工程领域技术相关的经验或观点。这个故事此时会给你带来什么话题？如题，我们将讨论我在React Native中使用CLI为我们的移动应用程序构建IPA和APK的经验。</p><p id="8996" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这个想法是在我们开发稳定有组织的时候产生的。但是，QA团队和移动开发者之间存在冲突。在开发期间，QA希望每天两次或更多次获得新的IPA或APK。因为他们不想在期末将所有的任务挂起并一起测试。</p><p id="f1d0" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">他们害怕时间不够了。如果他们能经常做就更好了。然后，移动开发者反对QA的声明。他们说做这件事太浪费时间了。因为构建IPA和APK的MacBook已经相当旧了。对于每个单独的构建，构建IPA和APK可能需要大约1-2个小时。</p><p id="ea48" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">那么，解决这个问题的办法是什么呢？我们意识到有一款高端电脑支持快速构建IPA和APK。这台电脑没人用。而且很久以前，我们老板曾经说过，就用它来造吧！好了，是时候构建一些东西或工具了，这是实施CI/CD概念，可以很容易地将IPA和APK直接交付给QA团队。</p><p id="98dc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在与整个团队成员讨论后，我们决定采用以下流程:</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi lp"><img src="../Images/31c714b3bfcbfc9a92111869e864a7d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TArfow4j2ZsjV-uXMJWC3Q.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Picture 1. Our development of mobile application flow</figcaption></figure><p id="7409" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">等等，铁匠是什么？好的，让我从上面的流程图解释一下。基本上，铁匠只是我们工具的名字来做这个交付。灵感来自Ragnarok网游中的铁匠角色:)</p><p id="9921" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">那么我们的计划将是这样的:</p><ul class=""><li id="f409" class="lq lr in kv b kw kx kz la lc ls lg lt lk lu lo lv lw lx ly bi translated">铁匠会通过API定期检查我们的git库。</li><li id="391d" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">如果开发版本有任何更新，Blacksmith将获取最新的代码并开始构建IPA和APK。</li><li id="f2da" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">成功获取文件后，Blacksmith将使用Slack bot(也称为Blacksmith:)，通过API将这些文件发送到Slack通道。</li><li id="b2cb" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">最后，通知QA团队，铁匠机器人将提到QA团队成员，我们有一个新版本，然后准备你的工作！lol:)</li></ul><p id="58cc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">那么，我们如何做到这一点呢？我不会解释这个故事的所有技术方面。只关注CLI部分的建筑。因为它是所有事物中最重要的。如果我们能够解决这个问题，您就可以根据自己的需要轻松调节流量。</p><h2 id="ff94" class="me mf in bd mg mh mi dn mj mk ml dp mm lc mn mo mp lg mq mr ms lk mt mu mv mw bi translated"><strong class="ak">安卓</strong></h2><p id="7c8d" class="pw-post-body-paragraph kt ku in kv b kw mx jo ky kz my jr lb lc mz le lf lg na li lj lk nb lm ln lo ig bi translated">对于android来说，使用CLI构建APK并不难。确保您的项目已经准备好构建，没有任何错误(我们在Android和iOS上都使用React Native)。在我们的例子中，我们只需要这个命令:</p><pre class="kd ke kf kg gt nc nd ne nf aw ng bi"><span id="7099" class="me mf in nd b gy nh ni l nj nk"><strong class="nd io">$ cd [YOUR_RN_PROJECT]<br/>$ npm install<br/>$ cd android<br/>$ ./gradlew clean<br/>$ ./gradlew assembleRelease &amp;&amp; react-native run-android --variant=release</strong></span></pre><p id="2d69" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">成功构建APK后，您可以在以下位置找到该文件:</p><pre class="kd ke kf kg gt nc nd ne nf aw ng bi"><span id="1e14" class="me mf in nd b gy nh ni l nj nk"><strong class="nd io">[YOUR_RN_PROJECT]/android/app/build/outputs/apk/release/app-release.apk</strong></span></pre><h2 id="bbaf" class="me mf in bd mg mh mi dn mj mk ml dp mm lc mn mo mp lg mq mr ms lk mt mu mv mw bi translated">ios</h2><p id="2b77" class="pw-post-body-paragraph kt ku in kv b kw mx jo ky kz my jr lb lc mz le lf lg na li lj lk nb lm ln lo ig bi translated">我可以说，这部分有点难，因为我的背景不是移动开发者，尤其是iOS开发者。我们的移动开发者不太熟悉使用CLI制作IPA文件。通常，他们使用Xcode来做这件事。</p><p id="8350" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">还有，iOS和Android相比比较复杂。我们应该有一个苹果开发者帐户，证书，配置文件等。经过多次试错，问了一些iOS开发者朋友(谢谢<a class="nl nm ep" href="https://medium.com/u/d319382e99d8?source=post_page-----2b8303d079e0--------------------------------" rel="noopener" target="_blank"> Muhammad Alfiansyah </a>、<a class="nl nm ep" href="https://medium.com/u/bd9a987666c4?source=post_page-----2b8303d079e0--------------------------------" rel="noopener" target="_blank"> Riyan Pratama </a>、Nico、<a class="nl nm ep" href="https://medium.com/u/1226a917666a?source=post_page-----2b8303d079e0--------------------------------" rel="noopener" target="_blank"> Agita Firstawan </a>、<a class="nl nm ep" href="https://medium.com/u/4d0c45a7113d?source=post_page-----2b8303d079e0--------------------------------" rel="noopener" target="_blank"> Robby Widyahartono </a>、<a class="nl nm ep" href="https://medium.com/u/68609736c2a4?source=post_page-----2b8303d079e0--------------------------------" rel="noopener" target="_blank"> Reza Arifiansyah </a>)，终于可以拿到IPA了！</p><p id="8165" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">但是，与Android的行为不同，iOS应该先进行存档，然后将其导出为IPA文件。</p><blockquote class="nn no np"><p id="e507" class="kt ku nq kv b kw kx jo ky kz la jr lb nr ld le lf ns lh li lj nt ll lm ln lo ig bi translated">我们使用自动签名来建立这个，所以请确保您可以通过您的Xcode自动签名方法获得IPA文件</p></blockquote><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi nu"><img src="../Images/ad33b37798dafca4c1a549f27fad2e1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3XYhNHVql_HvxBe7r6ZMNA.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Picture 2. Automatically signing on Xcode</figcaption></figure><p id="c5f6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">该命令将在我们将项目导出为IPA文件之前对其进行归档。</p><pre class="kd ke kf kg gt nc nd ne nf aw ng bi"><span id="06d2" class="me mf in nd b gy nh ni l nj nk"><strong class="nd io">$ cd [YOUR_RN_PROJECT]<br/>$ npm install<br/>$ cd ios<br/>$ pod install<br/>$ xcodebuild clean archive -workspace [YOUR_RN_PROJECT]/ios/[YOUR_APP_NAME].xcworkspace -scheme [YOUR_APP_NAME] -archivePath [YOUR_ARCHIVE_PATH]/[YOUR_ARCHIVE_NAME].xcarchive | xcpretty</strong></span></pre><blockquote class="nn no np"><p id="7931" class="kt ku nq kv b kw kx jo ky kz la jr lb nr ld le lf ns lh li lj nt ll lm ln lo ig bi translated">注意！您必须有用于导出IPA的plist文件，并更改teamID字符串值</p></blockquote><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nv nw l"/></div></figure><p id="19d1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">成功归档项目后，我们可以用这个命令将其导出为IPA文件。</p><pre class="kd ke kf kg gt nc nd ne nf aw ng bi"><span id="9ca9" class="me mf in nd b gy nh ni l nj nk"><strong class="nd io">$ xcodebuild -exportArchive -archivePath [YOUR_ARCHIVE_PATH]/[YOUR_ARCHIVE_NAME].xcarchive -exportPath [YOUR_BUILD_PATH] -exportOptionsPlist [YOUR_EXPORT_PLIST_PATH]/[YOUR_EXPORT_PLIST_NAME].plist | xcpretty</strong></span></pre><p id="91f3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">如果没有错误，你可以在你的<code class="fe nx ny nz nd b"><strong class="kv io">[YOUR_BUILD_PATH]</strong></code>上找到你的IPA文件！！恭喜你！！</p><p id="cf2b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">最后，我们解决了这个流程的重要部分！正如你在图1中看到的，我们构建工具来确保系统运行良好。我们用Go for做了很多任务，例如:</p><ul class=""><li id="05e5" class="lq lr in kv b kw kx kz la lc ls lg lt lk lu lo lv lw lx ly bi translated">使用任务调度器定期检查git存储库。</li><li id="c3a1" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">运行包含所有命令的sh文件，从拉最新的代码。</li><li id="2c4c" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">更改配置(自动增加内部版本号)。</li><li id="c859" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">开始建设。</li><li id="1165" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">将IPA文件上传到Diawi(<a class="ae ks" href="https://www.diawi.com/" rel="noopener ugc nofollow" target="_blank">https://www.diawi.com/</a>)以便轻松分发应用程序。</li><li id="b21e" class="lq lr in kv b kw lz kz ma lc mb lg mc lk md lo lv lw lx ly bi translated">将文件发送到Slack并向QA团队提及(使用changelog)。</li></ul><p id="7e81" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">你可以用你擅长的任何编程语言来改变服务，比如Python，Javascript，Ruby，Java等等。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi oa"><img src="../Images/bf960d7adae4e7dad995b8e7471888c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UYOK4_qxsx6jloYvpirHCw.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Picture 3. Files sending to Slack and bot mentioned the QA team with changelog</figcaption></figure><p id="3ba8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io">注明</strong>！！</p><blockquote class="nn no np"><p id="fbfb" class="kt ku nq kv b kw kx jo ky kz la jr lb nr ld le lf ns lh li lj nt ll lm ln lo ig bi translated">对于IPA文件，我们使用diawi<a class="ae ks" href="https://www.diawi.com/" rel="noopener ugc nofollow" target="_blank">https://www.diawi.com/</a>安装到iPhone中。我们的分销方式是临时的，所以我们已经注册了所有UUID团队成员的手机</p></blockquote><p id="6860" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">也许，你有很多问题，你为什么不使用云？你为什么不用浪子试飞？答案是，我们的预算有限，所以使用云不是我们的选择。我们仍然可以通过使用我们的内部电脑来解决这个问题。</p><p id="941f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">关于浪子和试飞，我认为我们可以把它加入到我们的下一个计划中，浪子实际上很好，试飞会有很大帮助。但是，目前的解决方案可以解决我们的问题。因此，将该系统改为浪子和试飞并不是一个优先事项。</p><p id="a16b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">希望你喜欢它，我很高兴如果这篇文章对你有用！快乐大厦！</p><p id="3c8a" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">谢谢大家！</p></div></div>    
</body>
</html>