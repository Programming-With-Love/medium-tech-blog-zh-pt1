<html>
<head>
<title>Search Synonym (Same Meaning Word) with Elasticsearch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Elasticsearch搜索同义词(相同意思的单词)</h1>
<blockquote>原文：<a href="https://medium.easyread.co/search-synonym-same-meaning-word-with-elasticsearch-97675e1330a1?source=collection_archive---------1-----------------------#2020-11-17">https://medium.easyread.co/search-synonym-same-meaning-word-with-elasticsearch-97675e1330a1?source=collection_archive---------1-----------------------#2020-11-17</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="fc5a" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">不再有因为<em class="kc">俚语</em>和<em class="kc">本地语言</em>单词而产生的空结果</h2></div><p id="82e9" class="pw-post-body-paragraph kd ke in kf b kg kh jo ki kj kk jr kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">在我的工作场所，我们的应用程序有一个功能，可以从搜索框中搜索数据。它工作得非常好，直到我们检查数据，许多用户从搜索中得到空的结果。其中一个原因是他们输入了这个词的俚语或不同的语言版本，而我们并没有把这些储存在我们的数据库里。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="gh gi la"><img src="../Images/572767b84f04e0caebcb42dd1b1131fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*F6uayC2yYDoHke9v"/></div></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk">Photo by <a class="ae lq" href="https://unsplash.com/@markuswinkler?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Markus Winkler</a> on <a class="ae lq" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="e3c2" class="pw-post-body-paragraph kd ke in kf b kg kh jo ki kj kk jr kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">在我的国家印度尼西亚，有许多地方语言和俚语。例如<code class="fe lr ls lt lu b"><strong class="kf io">Bakso</strong></code>和<code class="fe lr ls lt lu b"><strong class="kf io">Baso</strong></code>意思相同，就是<code class="fe lr ls lt lu b"><strong class="kf io">Meatball</strong></code>。除了使用当地语言，我们的用户也开始使用英文关键词进行搜索，比如<code class="fe lr ls lt lu b"><strong class="kf io">apple</strong></code>，而不是<code class="fe lr ls lt lu b"><strong class="kf io">apel</strong></code>，尽管我们的应用是针对印度尼西亚人的。</p><p id="e208" class="pw-post-body-paragraph kd ke in kf b kg kh jo ki kj kk jr kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">有许多解决方案可以解决我们的问题，我缩小了解决方案的范围，使我们的代码能够检索带有同义词的单词。我知道对于非母语，我们可以通过某种本地化来解决，但我认为这有点过分，因为我们的用户只搜索一点非母语。</p><figure class="lb lc ld le gt lf gh gi paragraph-image"><div class="gh gi lv"><img src="../Images/28a53807fa3beefe97d7074585d34967.png" data-original-src="https://miro.medium.com/v2/resize:fit:480/format:webp/1*sgALqwRibgaR7ibBLQuSpw.png"/></div><figcaption class="lm ln gj gh gi lo lp bd b be z dk">elasticsearch logo.</figcaption></figure><p id="6c10" class="pw-post-body-paragraph kd ke in kf b kg kh jo ki kj kk jr kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">在我们的数据库中，我们使用<a class="ae lq" href="https://www.elastic.co/" rel="noopener ugc nofollow" target="_blank"> Elasticsearch </a>来索引数据，这样更容易搜索，幸运的是它有一个叫做<code class="fe lr ls lt lu b"><strong class="kf io">Synonym Token Filter</strong></code>的特性。我很高兴发现Elasticsearch原生支持这种功能，因为如果我们需要另一个数据库或应用程序来修复我们的空结果错误，这将更加困难。</p><p id="bdf5" class="pw-post-body-paragraph kd ke in kf b kg kh jo ki kj kk jr kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">我将告诉你我是如何实现这个特性的。要使它在我们的应用程序中工作，需要完成一些步骤，有:</p><h2 id="690f" class="lw lx in bd ly lz ma dn mb mc md dp me km mf mg mh kq mi mj mk ku ml mm mn mo bi translated">1.添加同义词过滤器</h2><p id="d9a5" class="pw-post-body-paragraph kd ke in kf b kg mp jo ki kj mq jr kl km mr ko kp kq ms ks kt ku mt kw kx ky ig bi translated">我们需要更新应用程序的当前索引，以包含一个新的<code class="fe lr ls lt lu b"><strong class="kf io">synonym</strong></code>过滤器。在现有的<code class="fe lr ls lt lu b"><strong class="kf io">filter</strong></code>键中添加一个新值:</p><figure class="lb lc ld le gt lf"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="8047" class="pw-post-body-paragraph kd ke in kf b kg kh jo ki kj kk jr kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">请注意有一个<code class="fe lr ls lt lu b"><strong class="kf io">synonym</strong></code>一个有3个键的对象，<code class="fe lr ls lt lu b"><strong class="kf io">type</strong></code>有<code class="fe lr ls lt lu b"><strong class="kf io">synonym</strong></code>值，<code class="fe lr ls lt lu b"><strong class="kf io">lenient</strong></code>有<code class="fe lr ls lt lu b"><strong class="kf io">true</strong></code>值，<code class="fe lr ls lt lu b"><strong class="kf io">synonyms</strong></code>有一个字符串数组作为它的值。</p><p id="1afc" class="pw-post-body-paragraph kd ke in kf b kg kh jo ki kj kk jr kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><strong class="kf io">类型<br/> </strong>我认为这是不言自明的，它告诉我们这个对象是同义词类型。</p><p id="f37a" class="pw-post-body-paragraph kd ke in kf b kg kh jo ki kj kk jr kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><strong class="kf io">宽松<br/> </strong>基于弹性搜索文档:</p><pre class="lb lc ld le gt mw lu mx my aw mz bi"><span id="9b80" class="lw lx in lu b gy na nb l nc nd">If <!-- -->true<!-- --> ignores exceptions while parsing the synonym configuration. It is important to note that only those synonym rules which cannot get parsed are ignored.</span></pre><p id="9b00" class="pw-post-body-paragraph kd ke in kf b kg kh jo ki kj kk jr kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">该键的默认值为false，因此我将其设置为true，以防止任何应用程序错误，即使同义词过滤器出错。</p><p id="14b4" class="pw-post-body-paragraph kd ke in kf b kg kh jo ki kj kk jr kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><strong class="kf io">同义词<br/> </strong>这是我们为词语配置其同义词的地方。弹性搜索支持两种格式，即Solr和WordNet，就我而言，我更喜欢使用Solr格式。</p><pre class="lb lc ld le gt mw lu mx my aw mz bi"><span id="213c" class="lw lx in lu b gy na nb l nc nd"># Blank lines and lines starting with pound are comments.<br/><br/># Explicit mappings match any token sequence on the LHS of "=&gt;"<br/># and replace with all alternatives on the RHS.  These types of mappings<br/># ignore the expand parameter in the schema.<br/># Examples:<br/>i-pod, i pod =&gt; ipod,<br/>sea biscuit, sea biscit =&gt; seabiscuit<br/><br/># Equivalent synonyms may be separated with commas and give<br/># no explicit mapping.  In this case the mapping behavior will<br/># be taken from the expand parameter in the schema.  This allows<br/># the same synonym file to be used in different synonym handling strategies.<br/># Examples:<br/>ipod, i-pod, i pod<br/>foozball , foosball<br/>universe , cosmos<br/>lol, laughing out loud<br/><br/># If expand==true, "ipod, i-pod, i pod" is equivalent<br/># to the explicit mapping:<br/>ipod, i-pod, i pod =&gt; ipod, i-pod, i pod<br/># If expand==false, "ipod, i-pod, i pod" is equivalent<br/># to the explicit mapping:<br/>ipod, i-pod, i pod =&gt; ipod<br/><br/># Multiple synonym mapping entries are merged.<br/>foo =&gt; foo bar<br/>foo =&gt; baz<br/># is equivalent to<br/>foo =&gt; foo bar, baz</span></pre><p id="ee0c" class="pw-post-body-paragraph kd ke in kf b kg kh jo ki kj kk jr kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">这些文字可以直接写入<code class="fe lr ls lt lu b"><strong class="kf io">synonyms</strong></code>键，但是如果列表太长，建议我们使用<code class="fe lr ls lt lu b"><strong class="kf io">synonyms_path</strong></code>键，并传递我们的<code class="fe lr ls lt lu b"><strong class="kf io">txt</strong></code> <strong class="kf io"> </strong>文件的位置。</p><pre class="lb lc ld le gt mw lu mx my aw mz bi"><span id="f043" class="lw lx in lu b gy na nb l nc nd">"filter" : {<br/>    "synonym" : {<br/>          "type" : "synonym",<br/>          "synonyms_path" : "analysis/synonym.txt"<br/>    }<br/>}</span></pre><p id="037a" class="pw-post-body-paragraph kd ke in kf b kg kh jo ki kj kk jr kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><strong class="kf io"> 2 .创建文档属性分析器</strong></p><p id="2594" class="pw-post-body-paragraph kd ke in kf b kg kh jo ki kj kk jr kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">在我们创建过滤器之后，我们需要创建一个使用过滤器的<code class="fe lr ls lt lu b"><strong class="kf io">analyzer</strong></code>。</p><figure class="lb lc ld le gt lf"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="7677" class="pw-post-body-paragraph kd ke in kf b kg kh jo ki kj kk jr kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><strong class="kf io"> 2a。将过滤器添加到现有分析仪中</strong></p><p id="4bd0" class="pw-post-body-paragraph kd ke in kf b kg kh jo ki kj kk jr kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">每个文档属性只有一个analyzer，如果我们的文档属性已经有了一个analyzer，您需要在里面添加<code class="fe lr ls lt lu b"><strong class="kf io">synonym</strong></code>过滤器。</p><figure class="lb lc ld le gt lf"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="49e3" class="pw-post-body-paragraph kd ke in kf b kg kh jo ki kj kk jr kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><strong class="kf io"> 3 .更新弹性搜索索引设置</strong></p><p id="d0a0" class="pw-post-body-paragraph kd ke in kf b kg kh jo ki kj kk jr kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">用PUT方法向您的弹力搜索主机请求<code class="fe lr ls lt lu b"><strong class="kf io">/application/_settings</strong></code>，并发送带有<code class="fe lr ls lt lu b"><strong class="kf io">synonym</strong></code>过滤、附加<code class="fe lr ls lt lu b"><strong class="kf io">analyzer</strong></code>过滤值的请求体。</p><figure class="lb lc ld le gt lf"><div class="bz fp l di"><div class="mu mv l"/></div></figure><p id="83d6" class="pw-post-body-paragraph kd ke in kf b kg kh jo ki kj kk jr kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated"><strong class="kf io"> 4 .完成！</strong></p><p id="1068" class="pw-post-body-paragraph kd ke in kf b kg kh jo ki kj kk jr kl km kn ko kp kq kr ks kt ku kv kw kx ky ig bi translated">现在，您可以搜索具有关键字同义词的项目！请注意，所有这些步骤都只是一个简单的例子，如果您想了解更多关于弹性搜索功能的细节，您可以直接阅读他们的官方<a class="ae lq" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/analysis-synonym-tokenfilter.html" rel="noopener ugc nofollow" target="_blank">文档</a>。快乐编码！🖖</p></div><div class="ab cl ne nf hr ng" role="separator"><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj nk"/><span class="nh bw bk ni nj"/></div><div class="ig ih ii ij ik"><h1 id="10e1" class="nl lx in bd ly nm nn no mb np nq nr me jt ns ju mh jw nt jx mk jz nu ka mn nv bi translated">参考</h1><ol class=""><li id="943f" class="nw nx in kf b kg mp kj mq km ny kq nz ku oa ky ob oc od oe bi translated"><a class="ae lq" href="https://www.thesaurus.com/browse/synonym" rel="noopener ugc nofollow" target="_blank">同义词的同义词| Thesaurus.com</a></li><li id="efbd" class="nw nx in kf b kg of kj og km oh kq oi ku oj ky ob oc od oe bi translated"><a class="ae lq" href="https://www.elastic.co/guide/en/elasticsearch/reference/6.8/analysis-synonym-tokenfilter.html" rel="noopener ugc nofollow" target="_blank">同义词标记过滤编辑</a></li></ol></div></div>    
</body>
</html>