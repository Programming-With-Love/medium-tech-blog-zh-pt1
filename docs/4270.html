<html>
<head>
<title>Create first GCP resource with Terraform</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用地形创建第一个GCP资源</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/create-first-gcp-resource-with-terraform-c46d0166f051?source=collection_archive---------2-----------------------#2020-01-02">https://medium.com/google-developer-experts/create-first-gcp-resource-with-terraform-c46d0166f051?source=collection_archive---------2-----------------------#2020-01-02</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="a604" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们在本帖中使用Terraform创建我们的第一个GCP资源。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/8ac74015446bb0ad6939056626d53c19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*AD7nfi3Jpzw0Yjui.jpg"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Photo by <a class="ae js" href="https://unsplash.com/@markusspiske" rel="noopener ugc nofollow" target="_blank">Markus Spiske</a> on <a class="ae js" href="https://unsplash.com/" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="2b76" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">目标</h1><p id="4d3a" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">使用Terraform创建一个Google云存储(GCS)桶。</p><h1 id="78d2" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">先决条件</h1><p id="2665" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">本帖假设如下:</p><ol class=""><li id="0039" class="kw kx hh ig b ih ii il im ip ky it kz ix la jb lb lc ld le bi translated">我们已经有一个GCP项目和一个GCS桶(我们将使用它来存储Terraform状态文件)创建。</li><li id="94d5" class="kw kx hh ig b ih lf il lg ip lh it li ix lj jb lb lc ld le bi translated">2.Google Cloud SDK ( <code class="du lk ll lm ln b">gcloud</code>)和<code class="du lk ll lm ln b">Terraform</code>安装在您的工作站上。如果没有，那么参考我之前的博客-<a class="ae js" href="https://pbhadani.com/posts/getting-started-with-terraform/" rel="noopener ugc nofollow" target="_blank">Terraform入门</a>和<a class="ae js" href="https://pbhadani.com/posts/getting-started-wth-google-cloud-sdk/" rel="noopener ugc nofollow" target="_blank">Google Cloud SDK入门</a>。</li></ol><h1 id="5dbc" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">用Terraform创建一个Google云存储(GCS)桶</h1><p id="431d" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated"><strong class="ig hi">步骤1: </strong>为Terraform项目创建一个unix目录。</p><pre class="jd je jf jg fd lo ln lp lq aw lr bi"><span id="3d0d" class="ls ju hh ln b fi lt lu l lv lw">mkdir ~/terraform-gcs-example<br/>cd ~/terraform-gcs-example</span></pre><p id="2b8e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">步骤2: </strong>创建定义GCS存储桶和提供商的Terraform配置文件。</p><pre class="jd je jf jg fd lo ln lp lq aw lr bi"><span id="1bd0" class="ls ju hh ln b fi lt lu l lv lw">vi bucket.tf</span></pre><p id="3942" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该文件包含以下内容</p><pre class="jd je jf jg fd lo ln lp lq aw lr bi"><span id="bd37" class="ls ju hh ln b fi lt lu l lv lw"># Specify the GCP Provider<br/>provider "google" {<br/>  project = var.project_id<br/>  region  = var.region<br/>}<br/><br/># Create a GCS Bucket<br/>resource "google_storage_bucket" "my_bucket" {<br/>  name     = var.bucket_name<br/>  location = var.region<br/>}</span></pre><p id="1535" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">第三步:</strong>定义Terraform变量。</p><pre class="jd je jf jg fd lo ln lp lq aw lr bi"><span id="1fd5" class="ls ju hh ln b fi lt lu l lv lw">vi variables.tf</span></pre><p id="17d0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该文件看起来像:</p><pre class="jd je jf jg fd lo ln lp lq aw lr bi"><span id="97eb" class="ls ju hh ln b fi lt lu l lv lw">variable "project_id" {<br/>  description = "Google Project ID."<br/>  type        = string<br/>}<br/><br/>variable "bucket_name" {<br/>  description = "GCS Bucket name. Value should be unique ."<br/>  type        = string<br/>}<br/><br/>variable "region" {<br/>  description = "Google Cloud region"<br/>  type        = string<br/>  default     = "europe-west2"<br/>}</span></pre><p id="3557" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">注意:</strong>我们正在为<code class="du lk ll lm ln b">region</code>定义一个<code class="du lk ll lm ln b">default</code>值。这意味着如果没有为此变量提供值，Terraform将使用<code class="du lk ll lm ln b">europe-west2</code>作为其值。</p><p id="e2ec" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">第四步:</strong>创建一个<code class="du lk ll lm ln b">tfvars</code>文件。</p><p id="5020" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lk ll lm ln b">vi terraform.tfvars</code></p><pre class="jd je jf jg fd lo ln lp lq aw lr bi"><span id="fee1" class="ls ju hh ln b fi lt lu l lv lw">project_id  = ""                  # Put your GCP Project ID.<br/>bucket_name = "my-bucket-48693"   # Put the desired GCS Bucket name.</span></pre><p id="92f4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">第五步:</strong>设置远程状态。</p><p id="0608" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lk ll lm ln b">vi backend.tf</code></p><pre class="jd je jf jg fd lo ln lp lq aw lr bi"><span id="c20f" class="ls ju hh ln b fi lt lu l lv lw">terraform {<br/>  backend "gcs" {<br/>    bucket = "my-tfstate-bucket"   # GCS bucket name to store terraform tfstate</span><span id="2167" class="ls ju hh ln b fi lx lu l lv lw">    prefix = "first-app"           # Update to desired prefix name. Prefix name should be unique for each Terraform project having same remote state bucket.<br/>    }<br/>}</span></pre><p id="5225" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">第六步:</strong>文件结构如下</p><pre class="jd je jf jg fd lo ln lp lq aw lr bi"><span id="ea49" class="ls ju hh ln b fi lt lu l lv lw">cntekio:~ terraform-gcs-example$ tree<br/>.<br/>├── backend.tf<br/>├── bucket.tf<br/>├── terraform.tfvars<br/>└── variables.tf<br/><br/>0 directories, 4 files</span></pre><p id="d006" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">第七步:</strong>现在，初始化terraform项目。</p><p id="d9bd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lk ll lm ln b">terraform init</code></p><p id="839a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">输出</strong></p><pre class="jd je jf jg fd lo ln lp lq aw lr bi"><span id="3010" class="ls ju hh ln b fi lt lu l lv lw">Initializing the backend...<br/><br/>Successfully configured the backend "gcs"! Terraform will automatically<br/>use this backend unless the backend configuration changes.<br/><br/>Initializing provider plugins...<br/>- Checking for available provider plugins...<br/>- Downloading plugin for provider "google" (hashicorp/google) 3.3.0...<br/><br/>The following providers do not have any version constraints in configuration,<br/>so the latest version was installed.<br/><br/>To prevent automatic upgrades to new major versions that may contain breaking<br/>changes, it is recommended to add version = "..." constraints to the<br/>corresponding provider blocks in configuration, with the constraint strings<br/>suggested below.<br/><br/>* provider.google: version = "~&gt; 3.3"<br/><br/>Terraform has been successfully initialized!<br/><br/>You may now begin working with Terraform. Try running "terraform plan" to see<br/>any changes that are required for your infrastructure. All Terraform commands<br/>should now work.<br/><br/>If you ever set or change modules or backend configuration for Terraform,<br/>rerun this command to reinitialize your working directory. If you forget, other<br/>commands will detect it and remind you to do so if necessary.</span></pre><p id="ecac" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">注意:</strong> <code class="du lk ll lm ln b">terraform init</code>下载所有需要的提供者和插件。</p><p id="7207" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">第八步:</strong>我们来看看执行计划。</p><p id="1315" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lk ll lm ln b">terraform plan --out 1.plan</code></p><p id="0303" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">输出</strong></p><pre class="jd je jf jg fd lo ln lp lq aw lr bi"><span id="4b82" class="ls ju hh ln b fi lt lu l lv lw">Refreshing Terraform state in-memory prior to plan...<br/>The refreshed state will be used to calculate this plan, but will not be<br/>persisted to local or remote state storage.<br/>------------------------------------------------------------------------<br/><br/>An execution plan has been generated and is shown below.<br/>Resource actions are indicated with the following symbols:<br/>  + create<br/><br/>Terraform will perform the following actions:<br/><br/>  # google_storage_bucket.my_bucket will be created<br/>  + resource "google_storage_bucket" "my_bucket" {<br/>      + bucket_policy_only = (known after apply)<br/>      + force_destroy      = false<br/>      + id                 = (known after apply)<br/>      + location           = "EUROPE-WEST2"<br/>      + name               = "my-bucket-48693"<br/>      + project            = (known after apply)<br/>      + self_link          = (known after apply)<br/>      + storage_class      = "STANDARD"<br/>      + url                = (known after apply)<br/>    }<br/><br/>Plan: 1 to add, 0 to change, 0 to destroy.<br/><br/>------------------------------------------------------------------------<br/><br/>This plan was saved to: 1.plan<br/><br/>To perform exactly these actions, run the following command to apply:<br/>    terraform apply "1.plan"</span></pre><p id="8ed5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">注意:</strong> <code class="du lk ll lm ln b">terraform plan</code>输出显示这段代码将创建一个GCS bucket。<code class="du lk ll lm ln b">--out 1.plan</code> flag告诉terraform将计划保存在文件中。</p><p id="3fab" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">第9步:</strong>执行计划看起来不错，那么我们继续前进，应用这个计划。</p><p id="f120" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lk ll lm ln b">terraform apply 1.plan</code></p><p id="0326" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">输出</strong></p><pre class="jd je jf jg fd lo ln lp lq aw lr bi"><span id="2fbe" class="ls ju hh ln b fi lt lu l lv lw">google_storage_bucket.my_bucket: Creating...<br/>google_storage_bucket.my_bucket: Creation complete after 3s [id=my-bucket-48693]<br/><br/>Apply complete! Resources: 1 added, 0 changed, 0 destroyed.</span></pre><p id="0607" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">第10步:</strong>一旦我们不再需要这个基础设施，我们就可以清理以降低成本。</p><p id="360e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du lk ll lm ln b">terraform destroy</code></p><p id="34fb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">输出</strong></p><pre class="jd je jf jg fd lo ln lp lq aw lr bi"><span id="a378" class="ls ju hh ln b fi lt lu l lv lw">google_storage_bucket.my_bucket: Refreshing state... [id=my-bucket-48693]<br/><br/>An execution plan has been generated and is shown below.<br/>Resource actions are indicated with the following symbols:<br/>  - destroy<br/><br/>Terraform will perform the following actions:<br/><br/>  # google_storage_bucket.my_bucket will be destroyed<br/>  - resource "google_storage_bucket" "my_bucket" {<br/>      - bucket_policy_only = false -&gt; null<br/>      - force_destroy      = false -&gt; null<br/>      - id                 = "my-bucket-48693" -&gt; null<br/>      - labels             = {} -&gt; null<br/>      - location           = "EUROPE-WEST2" -&gt; null<br/>      - name               = "my-bucket-48693" -&gt; null<br/>      - project            = "my-project-id" -&gt; null<br/>      - requester_pays     = false -&gt; null<br/>      - self_link          = "https://www.googleapis.com/storage/v1/b/my-bucket-48693" -&gt; null<br/>      - storage_class      = "STANDARD" -&gt; null<br/>      - url                = "gs://my-bucket-48693" -&gt; null<br/>    }<br/><br/>Plan: 0 to add, 0 to change, 1 to destroy.<br/><br/>Do you really want to destroy all resources?<br/>  Terraform will destroy all your managed infrastructure, as shown above.<br/>  There is no undo. Only 'yes' will be accepted to confirm.<br/><br/>  Enter a value: yes<br/><br/>google_storage_bucket.my_bucket: Destroying... [id=my-bucket-48693]<br/>google_storage_bucket.my_bucket: Destruction complete after 6s<br/><br/>Destroy complete! Resources: 1 destroyed.</span></pre><p id="5e54" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="ly">希望这篇博客能帮助你开始使用Terraform创建GCP资源</em></p><p id="577b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您对Terraform项目有反馈、问题或需要帮助，请通过<a class="ae js" href="https://linkedin.com/in/pradeepbhadani" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>或<a class="ae js" href="https://twitter.com/bhadanipradeep" rel="noopener ugc nofollow" target="_blank"> Twitter </a>联系我</p></div><div class="ab cl lz ma go mb" role="separator"><span class="mc bw bk md me mf"/><span class="mc bw bk md me mf"/><span class="mc bw bk md me"/></div><div class="ha hb hc hd he"><p id="47bf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="ly">最初发表于</em><a class="ae js" href="https://pbhadani.com/posts/first-gcp-resource-with-terraform/" rel="noopener ugc nofollow" target="_blank"><em class="ly">https://pbhadani.com</em></a></p></div></div>    
</body>
</html>