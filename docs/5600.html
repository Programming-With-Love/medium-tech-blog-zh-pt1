<html>
<head>
<title>Single File Source Code with Java 11</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Java 11的单文件源代码</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/single-file-source-code-with-java-11-74d1a4c3d31?source=collection_archive---------0-----------------------#2019-04-21">https://medium.com/oracledevs/single-file-source-code-with-java-11-74d1a4c3d31?source=collection_archive---------0-----------------------#2019-04-21</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/9c821358f4679e40afa55abfdf5a00a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hhQv7Zxf213kHmZcQcuWmQ.png"/></div></div></figure><p id="4d89" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Java 11的众多显著特性之一是能够直接运行Java源代码的单个文件，而无需先编译源代码。作为对JShell的补充，这个特性有助于学习Java和编写简单的实用程序和CLI。</p><p id="9283" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">假设您创建了一个HelloWorld.java文件，您猜对了，它打印“Hello World”:</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="50c8" class="jx jy hh jt b fi jz ka l kb kc">public class HelloWorld {<br/>    public static void main (String... args) {<br/>        System.<em class="kd">out</em>.println("Hello World");<br/>    }<br/>}</span></pre><p id="12d5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">安装了JDK 11后，您可以使用“java”启动程序运行该文件:</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="ee31" class="jx jy hh jt b fi jz ka l kb kc">java HelloWorld.java</span></pre><p id="5635" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">JDK 11中的“java”启动程序已更新为在4种模式下运行:</p><ul class=""><li id="b15a" class="ke kf hh ir b is it iw ix ja kg je kh ji ki jm kj kk kl km bi translated">启动一个类文件</li><li id="2541" class="ke kf hh ir b is kn iw ko ja kp je kq ji kr jm kj kk kl km bi translated">启动jar的主类</li><li id="b498" class="ke kf hh ir b is kn iw ko ja kp je kq ji kr jm kj kk kl km bi translated">启动模块的主类</li><li id="b40f" class="ke kf hh ir b is kn iw ko ja kp je kq ji kr jm kj kk kl km bi translated">启动在单个源文件中声明的类</li></ul><p id="f2c5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">当以下两个条件之一匹配时,“java”启动器识别单文件模式:</p><ul class=""><li id="0534" class="ke kf hh ir b is it iw ix ja kg je kh ji ki jm kj kk kl km bi translated">传递给它的第一项是带有“.”的类文件。java”扩展</li><li id="d90d" class="ke kf hh ir b is kn iw ko ja kp je kq ji kr jm kj kk kl km bi translated">指定了“--source”(读作破折号)选项</li></ul><h1 id="68ca" class="ks jy hh bd kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo bi translated">Shebang支持</h1><p id="f999" class="pw-post-body-paragraph ip iq hh ir b is lp iu iv iw lq iy iz ja lr jc jd je ls jg jh ji lt jk jl jm ha bi translated">如前所述，单文件模式对于创建小型实用程序很有用。Shebang ("#！")机制非常适合运行这样的单个文件实用程序。使用单个文件模式调用Java启动器的shebang文件应该以下列内容开始:</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="539e" class="jx jy hh jt b fi jz ka l kb kc">#!<!-- -->/path/to/java --source version</span></pre><p id="6bf0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">shebang行可以包含其他启动选项，比如添加额外的类路径jar。当然，文件应该被标记为可执行的。注意，当包含shebang行时，您的单个文件源代码名称不需要遵循Java类命名约定。例如，HelloWorld.java可以改名为“你好”。</p><blockquote class="lu lv lw"><p id="450e" class="ip iq kd ir b is it iu iv iw ix iy iz lx jb jc jd ly jf jg jh lz jj jk jl jm ha bi translated">Shebang支持不是Windows自带的</p></blockquote><p id="cffb" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">有了这些知识，让我们创建一个小程序，将Tomcat作为嵌入式(TED)服务器运行。下载<a class="ae jn" href="https://tomcat.apache.org/download-90.cgi" rel="noopener ugc nofollow" target="_blank">嵌入式tomcat zip </a>文件，并将所需的jar文件解压到一个“lib”文件夹中。接下来，创建一个名为“ted”的文件，并将其标记为可执行文件:</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="30d5" class="jx jy hh jt b fi jz ka l kb kc">touch ted &amp;&amp; \<br/>  chmod +x ted</span></pre><p id="48fb" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">将以下代码添加到文件中:</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="2413" class="jx jy hh jt b fi jz ka l kb kc">#!/usr/bin/java --class-path ./lib/* --source 11<br/><br/>import org.apache.catalina.Wrapper;<br/>import org.apache.catalina.startup.Tomcat;<br/><br/>import javax.servlet.http.HttpServlet;<br/>import javax.servlet.http.HttpServletRequest;<br/>import javax.servlet.http.HttpServletResponse;<br/>import java.io.File;<br/>import java.io.IOException;<br/><br/>public class TomcatEmbedded {<br/><br/>    private static final String EMPTY = "";<br/><br/>    public static void main(String... args)<br/>        throws Exception {<br/>        File baseFolder = new File(System.getProperty("user.dir"));<br/>        File appsFolder = new File(baseFolder, "apps");<br/><br/>        Tomcat tomcat = new Tomcat();<br/>        tomcat.setBaseDir(baseFolder.getAbsolutePath());<br/>        tomcat.setPort(8080);<br/>        tomcat.getHost().setAppBase(appsFolder.getAbsolutePath());<br/><br/>        // Call the connector to create the default connector.<br/>        tomcat.getConnector();<br/><br/>        tomcat.addWebapp(EMPTY, ".");<br/>        Wrapper wrapper = tomcat.addServlet(EMPTY, "hello", new HelloServlet());<br/>        wrapper.setLoadOnStartup(1);<br/>        wrapper.addMapping("/*");<br/><br/>        tomcat.start();<br/>        tomcat.getServer().await();<br/>    }<br/><br/>    private static class HelloServlet extends HttpServlet {<br/>        @Override<br/>        protected void doGet(HttpServletRequest req, HttpServletResponse resp)<br/>            throws IOException {<br/>            resp.setStatus(200);<br/>            var writer = resp.getWriter();<br/>            writer.write("Hello World");<br/>            writer.flush();<br/>            writer.close();<br/>        }<br/>    }<br/>}</span></pre><p id="b3ed" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">保存文件，并将文件作为常规可执行文件运行:</p><pre class="jo jp jq jr fd js jt ju jv aw jw bi"><span id="eba3" class="jx jy hh jt b fi jz ka l kb kc">./ted</span></pre><p id="fa68" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在浏览器中导航到<a class="ae jn" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank"> http://localhost:8080 </a>，查看实用程序的运行情况。诚然，“ted”在目前的情况下没什么用处，但你可以扩展它，构建一个小型的开发者“Dropbox”实用程序，在虚拟机之间共享文件。</p><p id="2f4e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">有了这个新的单文件源代码特性，用Java创建自包含实用程序的可能性是无穷无尽的。编码快乐！</p></div></div>    
</body>
</html>