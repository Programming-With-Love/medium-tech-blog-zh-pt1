<html>
<head>
<title>Adapting to ListAdapter</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">适应ListAdapter</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/adapting-to-listadapter-341da4218f5b?source=collection_archive---------0-----------------------#2020-12-09">https://medium.com/androiddevelopers/adapting-to-listadapter-341da4218f5b?source=collection_archive---------0-----------------------#2020-12-09</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/38a783b350f16546090f206941ac8454.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_xgVq18X8goX50q0wgqhFw.png"/></div></div></figure><div class=""/><p id="4c8e" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这是<a class="ae jn" href="https://medium.com/androiddevelopers/tagged/recycler-view-series" rel="noopener">系列文章</a>的第二篇，涵盖了创建和使用<code class="du jo jp jq jr b">RecyclerView</code>的基础知识。如果你已经对如何创建一个<code class="du jo jp jq jr b">RecyclerView</code>有了坚实的理解，那么继续吧。否则，考虑从<a class="ae jn" rel="noopener" href="/androiddevelopers/getting-to-know-recyclerview-ea14f8514e6">这篇帖子</a>开始。</p><p id="da14" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><code class="du jo jp jq jr b">RecyclerView</code>是高效显示数据项列表的好方法。对于显示静态数据列表来说，默认适配器工作得很好。然而，在大多数用例中，<code class="du jo jp jq jr b">RecyclerView</code>数据是动态的。以一个待办事项app为例:添加新的事项，删除已完成的事项。<code class="du jo jp jq jr b">notifyItemInserted()</code>可以在指定的索引处插入新的任务，但是删除项目时会出现问题。<code class="du jo jp jq jr b">notifyItemRemoved()</code>仅在您有想要移除的任务的位置时有用。可以编写代码来获取要删除的任务的位置，然后调用<code class="du jo jp jq jr b">notifyItemRemoved()</code>，但是这段代码可能会变得混乱。调用<code class="du jo jp jq jr b">notifyDataSetChanged()</code>是一个选项，但是它会重绘整个视图，甚至是未更改的部分，这是一个开销很大的操作。<code class="du jo jp jq jr b">ListAdapter</code>处理添加和删除，无需重绘整个视图，甚至可以动画显示这些更改。</p><p id="f363" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">使用<code class="du jo jp jq jr b">ListAdapter</code>的另一个好处是，当添加或删除一个项目时，它会附带动画。这为用户查看列表中的变化提供了一个很好的视觉提示。没有<code class="du jo jp jq jr b">ListAdapter</code>动画也是可能的，但是它们必须由开发者实现，并且不会有相同的性能，因为视图很可能需要随着动画一起重画。</p><figure class="jt ju jv jw fd hj er es paragraph-image"><div class="er es js"><img src="../Images/e254b5b88e1c3811b0944dd0ae80912d.png" data-original-src="https://miro.medium.com/v2/resize:fit:636/1*oVPV5SVW8T_kXA1XsoWhHg.gif"/></div><figcaption class="jx jy et er es jz ka bd b be z dx">Animation after adding an item.</figcaption></figure><h1 id="e1f1" class="kb kc hs bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">折中</h1><p id="53b0" class="pw-post-body-paragraph ip iq hs ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated"><code class="du jo jp jq jr b">DiffUtil</code>是使<code class="du jo jp jq jr b">ListAdapter</code>能够有效改变列表中项目的秘密成分。<code class="du jo jp jq jr b">DiffUtil</code>将新列表与旧列表进行比较，以确定添加、移动和删除了什么，并输出一个更新操作列表，将第一个列表有效地转换为第二个列表。</p><p id="e40d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了识别新数据，<code class="du jo jp jq jr b">DiffUtil</code>要求你覆盖<code class="du jo jp jq jr b">areItemsTheSame()</code>和<code class="du jo jp jq jr b">areContentsTheSame()</code>。<code class="du jo jp jq jr b">areItemsTheSame()</code>检查两个项目是否实际上是同一项目。<code class="du jo jp jq jr b">areContentsTheSame()</code>检查两个项目是否有相同的数据。</p><figure class="jt ju jv jw fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es le"><img src="../Images/d6610838b71eb3362171638a3f2e6bc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NRO2Sg2SJHbNOpl9"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx">Diagram showing how areItemsTheSame() compares items.</figcaption></figure><figure class="jt ju jv jw fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lf"><img src="../Images/89269741aeb98140fa145cb227c305ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qGBhZoS8bC8UbEYyeucwGw.png"/></div></div><figcaption class="jx jy et er es jz ka bd b be z dx">Diagram showing how areContentsTheSame() compares items.</figcaption></figure><p id="d6a2" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在<code class="du jo jp jq jr b">Adapter</code>类中添加一个覆盖<code class="du jo jp jq jr b">areItemsTheSame()</code>和<code class="du jo jp jq jr b">areContentsTheSame()</code>的<code class="du jo jp jq jr b">DiffUtil</code>对象。</p><figure class="jt ju jv jw fd hj"><div class="bz dy l di"><div class="lg lh l"/></div></figure><p id="b28a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">更新<code class="du jo jp jq jr b">Adapter</code>类以继承<code class="du jo jp jq jr b">ListAdapter</code>类而不是<code class="du jo jp jq jr b">RecyclerView.Adapter</code>。传入<code class="du jo jp jq jr b">DiffCallback</code>。</p><figure class="jt ju jv jw fd hj"><div class="bz dy l di"><div class="lg lh l"/></div></figure><h1 id="2f37" class="kb kc hs bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">更新列表</h1><p id="2237" class="pw-post-body-paragraph ip iq hs ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated"><code class="du jo jp jq jr b"><a class="ae jn" href="https://developer.android.com/reference/androidx/recyclerview/widget/ListAdapter" rel="noopener ugc nofollow" target="_blank">ListAdapter</a></code>使用名为<code class="du jo jp jq jr b"><a class="ae jn" href="https://developer.android.com/reference/androidx/recyclerview/widget/ListAdapter#submitList(java.util.List%3CT%3E)" rel="noopener ugc nofollow" target="_blank">submitList()</a></code>的方法获取数据，该方法提交一个与当前列表不同的列表并显示。这意味着您不再需要覆盖<code class="du jo jp jq jr b">getItemCount()</code>，因为<code class="du jo jp jq jr b">ListAdapter</code>管理列表。</p><p id="fff0" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在<code class="du jo jp jq jr b">Activity</code>类中，调用<code class="du jo jp jq jr b">Adapter</code>上的<code class="du jo jp jq jr b">submitList()</code>并传入数据列表。</p><figure class="jt ju jv jw fd hj"><div class="bz dy l di"><div class="lg lh l"/></div></figure><p id="c8da" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在<code class="du jo jp jq jr b">Adapter</code>类中，<code class="du jo jp jq jr b">onBindViewHolder()</code>现在可以使用<code class="du jo jp jq jr b"><a class="ae jn" href="https://developer.android.com/reference/androidx/recyclerview/widget/ListAdapter#getItem(int)" rel="noopener ugc nofollow" target="_blank">getItem()</a></code>从给定位置的数据列表中检索条目。</p><figure class="jt ju jv jw fd hj"><div class="bz dy l di"><div class="lg lh l"/></div></figure><p id="5b46" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">就是这样！把你的<code class="du jo jp jq jr b">RecyclerView</code>转换成使用<code class="du jo jp jq jr b">ListAdapter</code>只需要几步。现在，您的应用程序可以通过使用<code class="du jo jp jq jr b">ListAdapter</code>自动获得更好的性能和更好的用户体验，只更新那些已经更改的项目。</p><h1 id="452e" class="kb kc hs bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">后续步骤</h1><p id="7055" class="pw-post-body-paragraph ip iq hs ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">包括<code class="du jo jp jq jr b">ListAdapter</code>在内的完整代码示例可以在这里找到<a class="ae jn" href="https://github.com/android/views-widgets-samples/tree/main/RecyclerViewKotlin" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="c2c0" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">感谢您阅读我的<code class="du jo jp jq jr b"><a class="ae jn" href="https://medium.com/androiddevelopers/tagged/recycler-view-series" rel="noopener">RecyclerView</a></code> <a class="ae jn" href="https://medium.com/androiddevelopers/tagged/recycler-view-series" rel="noopener">系列</a>的第二部！请继续关注我写的更多<code class="du jo jp jq jr b">RecyclerView</code>特性。</p><p id="2887" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你想了解更多关于<code class="du jo jp jq jr b">ListAdapter</code>的信息，请查看文档。</p></div></div>    
</body>
</html>