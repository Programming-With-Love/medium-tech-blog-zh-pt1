<html>
<head>
<title>Install Spinnaker with Halyard on Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Kubernetes上安装带升降索的三角帆</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/install-spinnaker-with-halyard-on-kubernetes-88277bd61d59?source=collection_archive---------0-----------------------#2018-11-25">https://medium.com/oracledevs/install-spinnaker-with-halyard-on-kubernetes-88277bd61d59?source=collection_archive---------0-----------------------#2018-11-25</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/5271e6ab120444ae014df4c43bda30be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XxKZpRj5akUyNp4H5B2JXg.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">“Amante” 10 A 1983 Peterson designed Choate 48 sailboat photo D Ramey Logan</figcaption></figure><p id="2de5" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">本文将带您了解在Kubernetes上安装和设置一个<a class="ae jr" href="https://www.spinnaker.io/" rel="noopener ugc nofollow" target="_blank"> Spinnaker </a>实例的步骤，该实例位于一个企业<em class="js">代理</em>之后。我们将使用docker上的<a class="ae jr" href="https://www.spinnaker.io/setup/install/halyard/#install-halyard-on-docker" rel="noopener ugc nofollow" target="_blank">升降索</a>来管理我们的Spinnaker部署。</p><blockquote class="jt ju jv"><p id="999e" class="it iu js iv b iw ix iy iz ja jb jc jd jw jf jg jh jx jj jk jl jy jn jo jp jq ha bi translated">对于超级快速的安装，你可以使用Spinnaker的舵图<a class="ae jr" href="https://github.com/helm/charts/tree/master/stable/spinnaker" rel="noopener ugc nofollow" target="_blank">图</a></p></blockquote><h1 id="eb03" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">先决条件</h1><p id="c28f" class="pw-post-body-paragraph it iu hh iv b iw kx iy iz ja ky jc jd je kz jg jh ji la jk jl jm lb jo jp jq ha bi translated">在安装Spinnaker之前，请确保满足以下先决条件:</p><ul class=""><li id="40c7" class="lc ld hh iv b iw ix ja jb je le ji lf jm lg jq lh li lj lk bi translated">配置了代理的Docker 17.x(点击<a class="ae jr" rel="noopener" href="/oracledevs/install-docker-and-kubernetes-on-oracle-linux-behind-a-proxy-aa73a8977b6f">此处</a>进行OL设置)</li><li id="27fa" class="lc ld hh iv b iw ll ja lm je ln ji lo jm lp jq lh li lj lk bi translated">Kubernetes集群(点击<a class="ae jr" rel="noopener" href="/oracledevs/install-docker-and-kubernetes-on-oracle-linux-behind-a-proxy-aa73a8977b6f">此处</a>进行OL设置)</li><li id="ba88" class="lc ld hh iv b iw ll ja lm je ln ji lo jm lp jq lh li lj lk bi translated">启用RBAC的头盔(点击<a class="ae jr" href="https://docs.helm.sh/using_helm/#installing-helm" rel="noopener ugc nofollow" target="_blank">此处</a>进行通用设置)</li></ul><h1 id="d51a" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">在码头上安装升降索</h1><p id="a951" class="pw-post-body-paragraph it iu hh iv b iw kx iy iz ja ky jc jd je kz jg jh ji la jk jl jm lb jo jp jq ha bi translated">Halyard用于安装和管理Spinnaker部署。事实上，所有生产级Spinnaker部署都需要Halyard来正确配置和维护Spinnaker。让我们用Docker安装升降索。</p><p id="56fa" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">创建一个docker卷或创建一个主机目录来保存Halyard使用的持久数据。出于本文的目的，让我们创建一个主机目录并授予用户完全访问权限:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="82d3" class="lz ka hh lv b fi ma mb l mc md">mkdir halyard &amp;&amp; chmod 747 halyard</span></pre><p id="a289" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">Halyard需要与您的Kubernetes集群进行交互。所以我们将$KUBECONFIG文件传递给它。一种方法是将主机目录挂载到包含Kubernetes集群详细信息的容器中。让我们创建目录“k8s ”,复制$KUBECONFIG文件，并使它对Halyard容器中的用户可见。</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="3bf4" class="lz ka hh lv b fi ma mb l mc md">mkdir k8s &amp;&amp; cp $KUBECONFIG k8s/config &amp;&amp; chmod 755 k8s/config</span></pre><p id="1f44" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">下载和运行Halyard docker映像的时间:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="5b4f" class="lz ka hh lv b fi ma mb l mc md">docker run -p 8084:8084 -p 9000:9000 \<br/>    --name halyard -d \<br/>    -v /sandbox/halyard:/home/spinnaker/.hal \<br/>    -v /sandbox/k8s:/home/spinnaker/k8s \<br/>    -e http_proxy=http://&lt;proxy_host&gt;:&lt;proxy_port&gt; \<br/>    -e https_proxy=https://&lt;proxy_host&gt;:&lt;proxy_port&gt; \    <br/>    -e JAVA_OPTS="-Dhttps.proxyHost=&lt;proxy_host&gt; -Dhttps.proxyPort=&lt;proxy_port&gt;" \<br/>    -e KUBECONFIG=/home/spinnaker/k8s/config \<br/>    gcr.io/spinnaker-marketplace/halyard:stable</span></pre><p id="1557" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">确保用您的公司代理值替换“<proxy_host>”和“<proxy_port>”。</proxy_port></proxy_host></p><p id="1215" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">登录“halyard”容器，测试与Kubernetes集群的连接:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="d99d" class="lz ka hh lv b fi ma mb l mc md">docker exec -it halyard bash<br/>kubectl get pods -n spinnaker</span></pre><p id="0027" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">或者，如果您希望命令完成，请在升降索容器中运行以下命令:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="2aca" class="lz ka hh lv b fi ma mb l mc md">source &lt;(hal --print-bash-completion)</span></pre><h1 id="227c" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">将提供者设置为“Kubernetes”</h1><p id="f9da" class="pw-post-body-paragraph it iu hh iv b iw kx iy iz ja ky jc jd je kz jg jh ji la jk jl jm lb jo jp jq ha bi translated">在Spinnaker术语中，为了部署应用程序，我们使用到特定云平台的集成。我们必须配置Halyard并将云提供商设置为Kubernetes v2(基于清单),因为我们希望将Spinnaker部署到Kubernetes集群上:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="5f13" class="lz ka hh lv b fi ma mb l mc md">hal config provider kubernetes enable</span></pre><p id="e9b5" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">接下来，我们创建一个帐户。在Spinnaker中，帐户是一个命名的凭证，Spinnaker使用它来验证集成提供者——在我们的例子中是Kubernetes:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="feae" class="lz ka hh lv b fi ma mb l mc md">hal config provider kubernetes account add &lt;my_account&gt; \<br/>    --provider-version v2 \<br/>    --context $(kubectl config current-context)</span></pre><p id="e963" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">确保用您选择的帐户名称替换“<my_account>”。将帐户名保存在环境变量$ACCOUNT中。接下来，我们需要让升降索使用神器:</my_account></p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="9356" class="lz ka hh lv b fi ma mb l mc md">hal config features edit --artifacts true</span></pre><h1 id="1129" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">将部署类型设置为“分布式”</h1><p id="2dfb" class="pw-post-body-paragraph it iu hh iv b iw kx iy iz ja ky jc jd je kz jg jh ji la jk jl jm lb jo jp jq ha bi translated">Halyard支持多种类型的Spinnaker部署。让我们告诉Halyard，我们需要Spinnaker的分布式部署:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="c1a6" class="lz ka hh lv b fi ma mb l mc md">hal config deploy edit --type distributed --account-name $ACCOUNT</span></pre><h1 id="f903" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">将持久性存储设置为“Minio”</h1><p id="0e66" class="pw-post-body-paragraph it iu hh iv b iw kx iy iz ja ky jc jd je kz jg jh ji la jk jl jm lb jo jp jq ha bi translated">Spinnaker需要一个持久存储来保存连续的交付管道和其他配置。Halyard让您从多个存储提供商中进行选择。出于本文的目的，我们将使用“<a class="ae jr" href="https://www.minio.io/" rel="noopener ugc nofollow" target="_blank"> Minio </a>”。</p><p id="b5f9" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">让我们使用Helm安装一个简单的Minio实例。在能够访问Kubernetes集群和Helm的节点上，从Halyard docker容器外部运行该命令:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="e47b" class="lz ka hh lv b fi ma mb l mc md">helm install --namespace spinnaker --name minio --set accessKey=&lt;access_key&gt; --set secretKey=&lt;secret_key&gt; stable/minio</span></pre><p id="f229" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">确保用您选择的值替换“<access_key>和“<secret_key>”。</secret_key></access_key></p><blockquote class="jt ju jv"><p id="7383" class="it iu js iv b iw ix iy iz ja jb jc jd jw jf jg jh jx jj jk jl jy jn jo jp jq ha bi translated">如果您正在使用没有真正持久卷支持的本地k8s集群，您可以将“persistence.enabled=false”作为一个集合传递给前面的Helm命令。如标志所示，如果Minio关闭，您将丢失所做的更改。</p></blockquote><p id="903f" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">根据Spinnaker文档，Minio不支持版本控制对象。因此，让我们在升降索配置下禁用版本控制。回到Halyard docker容器，运行以下命令:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="a853" class="lz ka hh lv b fi ma mb l mc md">mkdir ~/.hal/default/profiles &amp;&amp; \<br/>  touch ~/.hal/default/profiles/front50-local.yml</span></pre><p id="800c" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">将以下内容添加到front50-local.yml文件中:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="6ed2" class="lz ka hh lv b fi ma mb l mc md">spinnaker.s3.versioning: false</span></pre><p id="3ea9" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">现在运行以下命令来配置存储提供程序:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="d6a6" class="lz ka hh lv b fi ma mb l mc md">echo $MINIO_SECRET_KEY | \<br/>     hal config storage s3 edit --endpoint http://minio:9000 \<br/>         --access-key-id $MINIO_ACCESS_KEY \<br/>         --secret-access-key</span></pre><p id="e5a1" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">确保将$MINIO_ACCESS_KEY和$MINIO_SECRET_KEY环境变量设置为安装MINIO时使用的<access_key>和<secret_key>值。</secret_key></access_key></p><p id="f15a" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">最后，让我们启用s3存储提供商:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="c7e6" class="lz ka hh lv b fi ma mb l mc md">hal config storage edit --type s3</span></pre><h1 id="6000" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">将版本设置为“最新”</h1><p id="aca1" class="pw-post-body-paragraph it iu hh iv b iw kx iy iz ja ky jc jd je kz jg jh ji la jk jl jm lb jo jp jq ha bi translated">您必须选择Spinnaker的特定版本并配置Halyard，以便它知道要部署哪个版本。您可以通过运行以下命令来查看可用版本:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="aa2b" class="lz ka hh lv b fi ma mb l mc md">hal version list</span></pre><p id="4da9" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">从列表中选择最新的版本号(或您想要部署的任何其他版本)并更新Halyard:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="f820" class="lz ka hh lv b fi ma mb l mc md">hal config version edit --version &lt;version&gt;</span></pre><h1 id="f51d" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">部署三角帆</h1><p id="fdce" class="pw-post-body-paragraph it iu hh iv b iw kx iy iz ja ky jc jd je kz jg jh ji la jk jl jm lb jo jp jq ha bi translated">此时，Halyard应该拥有部署Spinnaker实例所需的所有信息。让我们通过运行以下命令来部署Spinnaker:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="0b3c" class="lz ka hh lv b fi ma mb l mc md">hal deploy apply</span></pre><p id="b858" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">请注意，首次部署可能需要一段时间。</p><h1 id="6eca" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">使Spinnaker可达</h1><p id="930f" class="pw-post-body-paragraph it iu hh iv b iw kx iy iz ja ky jc jd je kz jg jh ji la jk jl jm lb jo jp jq ha bi translated">我们需要公开Spinnaker UI和网关服务，以便与Spinnaker仪表板交互并开始创建管道。当我们使用Halyard部署spinnaker时，在“Spinnaker”名称空间中创建了许多Kubernetes服务。默认情况下，这些服务在集群中公开(类型为“ClusterIP”)。让我们将面向Spinnaker的UI和API服务器的服务的服务类型更改为“NodePort ”,使它们对Kubernetes集群之外的最终用户可用。</p><p id="3cda" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">通过运行以下命令编辑“spin-deck”服务:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="fc6f" class="lz ka hh lv b fi ma mb l mc md">kubectl edit svc spin-deck -n spinnaker</span></pre><p id="0153" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">将类型更改为“NodePort ”,并选择性地指定您希望服务公开的端口。以下是服务定义的快照:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="6058" class="lz ka hh lv b fi ma mb l mc md">...<br/>spec:<br/>  type: NodePort<br/>  ports:<br/>  - port: 9000<br/>    protocol: TCP<br/>    targetPort: 9000<br/>    nodePort: 30900<br/>  selector:<br/>    app: spin<br/>    cluster: spin-deck<br/>  sessionAffinity: None  <br/>status:<br/>...</span></pre><p id="ffd3" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">接下来，通过运行以下命令编辑“spin-gate”服务:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="5666" class="lz ka hh lv b fi ma mb l mc md">kubectl edit svc spin-gate -n spinnaker</span></pre><p id="c85b" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">将类型更改为“NodePort ”,并选择性地指定希望API网关服务在哪个端口上公开。</p><blockquote class="jt ju jv"><p id="914b" class="it iu js iv b iw ix iy iz ja jb jc jd jw jf jg jh jx jj jk jl jy jn jo jp jq ha bi translated">请注意，Kubernetes服务可以通过多种方式公开。如果您想将Spinnaker公开到公共互联网上，可以使用负载平衡器或打开https的入口。您应该配置<a class="ae jr" href="https://www.spinnaker.io/setup/security/authentication/" rel="noopener ugc nofollow" target="_blank">认证</a>来锁定未授权用户的访问。</p></blockquote><p id="bcb6" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">将用于访问Spinnaker的节点主机名或其IP地址保存在环境变量$SPIN_HOST中。使用Halyard，配置UI和API服务器以接收传入的请求:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="3b23" class="lz ka hh lv b fi ma mb l mc md">hal config security ui edit \<br/>    --override-base-url "http://$SPIN_HOST:30900"<br/>hal config security api edit \<br/>    --override-base-url "http://$SPIN_HOST:30808"</span></pre><p id="1181" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">重新部署Spinnaker，以便它能够获得配置更改:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="89dc" class="lz ka hh lv b fi ma mb l mc md">hal deploy apply</span></pre><p id="ba8a" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">您可以通过“http://$SPIN_HOST:30900”访问Spinnaker UI</p><h1 id="b818" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">创建一个“hello-world”应用程序</h1><p id="b095" class="pw-post-body-paragraph it iu hh iv b iw kx iy iz ja ky jc jd je kz jg jh ji la jk jl jm lb jo jp jq ha bi translated">让我们带着Spinnaker兜一圈(双关语)。使用Spinnaker的UI，让我们创建一个“hello-world”应用程序。使用“操作”下拉菜单并单击“创建应用程序”:</p><figure class="lq lr ls lt fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es me"><img src="../Images/bf3255a1cbd37d42ec6a90c46f9b6585.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7clKkzYL39-LBPeOCtcB1A.png"/></div></div></figure><p id="7c63" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">创建应用程序后，导航到“管道”选项卡，然后单击“配置新管道”:</p><figure class="lq lr ls lt fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mf"><img src="../Images/a604a851d2c4c91efd73059189ea156f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e66LLnnRIK2QDN5ULq_KCA.png"/></div></div></figure><p id="8735" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">现在，向管道添加一个新阶段，以创建基于清单的部署:</p><figure class="lq lr ls lt fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mg"><img src="../Images/e95068392a02a262cd4fb15c14e8b49e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V46AH1514mW5_HQOnqZ32g.png"/></div></div></figure><p id="2273" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">在“清单配置”下，添加以下内容作为清单源文本:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="dcc8" class="lz ka hh lv b fi ma mb l mc md">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  labels:<br/>    app: hello-world<br/>  name: hello-world<br/>spec:<br/>  replicas: 1<br/>  selector:<br/>    matchLabels:<br/>      app: hello-world<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: hello-world<br/>    spec:<br/>      containers:<br/>        - image: '&lt;docker_repository&gt;:5000/helloworld:v1'<br/>          name: hello-world<br/>          ports:<br/>            - containerPort: 80</span></pre><p id="5b21" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">用Kubernetes集群可以使用的内部docker注册中心的名称替换“<docker_repository>”。</docker_repository></p><p id="54fa" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">让我们快速浏览一下，创建一个“hello world”docker图像。我们将创建一个基于“nginx”的映像，其中包含一个“index.html”文件，该文件包含:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="8508" class="lz ka hh lv b fi ma mb l mc md">&lt;h1&gt;Hello World&lt;/h1&gt;</span></pre><p id="659a" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">然后，我们将在保存上一步中的“index.html”文件的同一目录中创建相应的“Dockerfile ”:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="f1ac" class="lz ka hh lv b fi ma mb l mc md">FROM nginx:alpine<br/>COPY . /usr/share/nginx/html</span></pre><p id="4ed7" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">接下来，我们通过运行以下命令构建docker映像:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="687b" class="lz ka hh lv b fi ma mb l mc md">docker build -t &lt;docker_repository&gt;:5000/helloworld:v1 .</span></pre><p id="6718" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">确保将“<docker_repository>”替换为Kubernetes集群可用的内部docker注册中心的名称。将docker映像推送到“<docker_repository>”，使其对Kubernetes集群可用。</docker_repository></docker_repository></p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="e827" class="lz ka hh lv b fi ma mb l mc md">docker push &lt;docker_repository&gt;:5000/helloworld:v1</span></pre><p id="e4a6" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">回到Spinnaker UI，让我们手动运行“hello-world”管道。成功执行后，您可以深入到管道实例的详细信息:</p><figure class="lq lr ls lt fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mh"><img src="../Images/b87aff25f44ef2e9f846a3ec016b1b9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M2tCoK1h1rrSAtMRn230pQ.png"/></div></div></figure><p id="016c" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">为了快速测试我们的hello-world应用程序，我们可以在Spinnaker UI中创建一个基于清单的“负载平衡器”。单击“+”图标:</p><figure class="lq lr ls lt fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mi"><img src="../Images/117b41d90e617e62bd53825a7af5abf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2dYt941HgFjS6kI2kQg9-A.png"/></div></div></figure><p id="19ac" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">添加以下服务定义以创建负载平衡器:</p><pre class="lq lr ls lt fd lu lv lw lx aw ly bi"><span id="d635" class="lz ka hh lv b fi ma mb l mc md">kind: Service<br/>apiVersion: v1<br/>metadata:<br/>  name: hello-world<br/>spec:<br/>  type: NodePort<br/>  selector:<br/>    app: hello-world<br/>  ports:<br/>  - protocol: TCP<br/>    port: 80<br/>    targetPort: 80<br/>    nodePort: 31080</span></pre><p id="8997" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">一旦Spinnaker提供了负载平衡器，在浏览器中点击hello-world应用程序的URL“http://$ SPIN _ HOST:31080”。瞧啊。你看，“你好，世界”被渲染了。</p><h1 id="a17f" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">结论</h1><p id="178a" class="pw-post-body-paragraph it iu hh iv b iw kx iy iz ja ky jc jd je kz jg jh ji la jk jl jm lb jo jp jq ha bi translated">Spinnaker是一个高速度发布软件的多云连续交付平台。我们使用Halyard在Kubernetes集群上安装了Spinnaker，并部署了一个简单的hello-world管道。当然，就Spinnaker提供的功能而言，我们仅仅触及了皮毛。前往<a class="ae jr" href="https://www.spinnaker.io/guides/" rel="noopener ugc nofollow" target="_blank">指南</a>了解更多关于Spinnaker的信息。</p></div></div>    
</body>
</html>