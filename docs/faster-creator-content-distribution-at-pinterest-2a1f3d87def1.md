# Pinterest 上更快的创作者内容分发

> 原文：<https://medium.com/pinterest-engineering/faster-creator-content-distribution-at-pinterest-2a1f3d87def1?source=collection_archive---------3----------------------->

陆嘉怡|软件工程师，创作者发行

在 Pinterest，我们致力于为创作者建立最佳体验，以接触和激励新的受众，并让 Pinners 轻松发现对他们来说最好的想法。我们相信更多样化的 Pin 格式和高效的分发系统是我们成功的关键，这将构建一个健康的创作者内容市场。

例如，Story Pins 是一种新的 Pin 格式，它使创作者可以通过直接发布到平台来将他们的原创内容带到 Pinterest。Story Pins 使内容创作者能够通过视频、图像和文本创作并上传自己的创意到 Pinterest。

![](img/40f89902536349ae84105637f186a456.png)

随着越来越多的创作者内容进入 Pinterest，我们需要继续发展一个高效的分发系统，以最好地服务于创作者和 Pinners 的利益。为了实现这一目标，我们需要应对一系列独特的挑战。

首先，内容分发的及时性变得比以往任何时候都更加重要，以确保创作者分享后，新的 pin 立即显示给 Pinners。

受众的相关性对于发行效率也至关重要。例如，向对烹饪感兴趣的人以及可能感兴趣的人展示新鲜的食谱可以帮助我们更好地了解食谱的性能和质量。

为了满足这些需求，我们构建了一个新的、快速、实时的内容分发系统，以创作者为中心。

# 系统概况

实时创建者内容分发系统由三个主要组件组成:索引、检索和探索。

在索引阶段，索引作业由 Pin 创建和接合事件触发。一旦创建了 Pin，我们就将其转换为文档，并使用实时生成的内容信号将其编入我们的实时索引(即 [Manas](/pinterest-engineering/manas-a-high-performing-customized-search-system-cf189f6ca40f) )。

在检索阶段，我们根据各种用户信号从实时的 Manas 索引中找到匹配的文档。

在索引和检索的基础上，我们还构建了一个探索框架，根据实时性能和质量控制每个引脚的探索预算。

![](img/b2935791164f54bcbcf22ad262e75814.png)

*Figure 1.**Overview of creator content fast distribution system*

以上是实时创建者内容分发系统的概述。现在，让我们更详细地看一下每个组件。

# 详细设计

在本节中，我们将讨论我们的分发系统的更多设计细节，我们将关注三个最重要的组件:实时索引、候选检索和探索&预算控制。

## 实时索引:实现快速分发

我们需要解决的第一个问题是索引新的创建者 pin，以便它们可以在创建后几秒钟内被提供。作为一个主要由新鲜内容组成的索引，与 evergreen 内容相比，我们面临着参与信号较少的冷启动问题。因此，我们不得不更多地依赖实时内容信号(如文本注释、视觉嵌入等。)进行定位。此外，当我们改进发行版时，我们计划尝试不同的检索策略，对底层基础设施的改动最小。这意味着支持通过不同信号和配置进行索引/检索的统一索引和服务框架是非常优选的。因此，我们利用我们的内部搜索索引平台实施了一个新的实时索引基础架构，下面是系统架构的图示:

![](img/7d41eb76931d1b3873b74d46fd6c8792.png)

*Figure 2\. How real-time indexing works for fresh creator pins*

实时索引从收听 Pin 事件 kafka 主题开始。每次创建 Pin 时，Kafka 消息将被写入事件主题，并按顺序触发一系列操作:

1.  从事件中解析 Pin 数据，用附加信号(例如，板和用户信息)增强
2.  用 Pin 和图像数据计算实时内容信号(例如注释、兴趣、嵌入)；
3.  解析信号并为每个引脚建立文档；
4.  向实时索引 kafka 主题写入文档，然后 Manas 可以使用这些文档。

在参与事件(例如保存)时也将触发相同的过程，以便在有任何更新时刷新索引信号。

索引文档以前向索引行的形式出现，其中文档 ID(通常是图像签名，Pin 图像的 md5 散列)是密钥，后面是从信号属性到它们的值(令牌)的映射。例如:

![](img/d6ef73b03802fe054c18511fcd2e9a71.png)

在实时索引端，在使用索引 Kafka 主题的每个文档时，将启动一个后处理任务，将文档合并到一个倒排索引中。这个过程将包括构建一组发布列表，其中每个标记都是键，以及一个包含标记作为值的文档 id 列表。如下图所示:

![](img/24ff58f42512e7a662517680532163b3.png)

## 候选检索

候选人检索是我们从实时创建者内容索引中选择数百个 pin 的阶段。它由三个主要步骤组成:资源获取、查询合成和查询处理。在资源获取阶段，我们从各种服务获取相应的用户信号，然后我们在查询组合器中使用这些信号(例如，兴趣),并使用标记化的用户信号术语来组合 Manas 搜索查询。最后，我们将 Manas 查询发送到 Manas 索引，并解析响应以获取需要返回的 Pin IDs，以便进行下游排序/混合。

![](img/cc454a581b28303a1ae6c7d9d602972b.png)

*Figure 3\. How Creator Pin Retrieval Works*

对于新的创建者 Pin 分布，候选检索可以被认为是一个搜索问题，其中我们用不同的令牌类型为每个用户组成一个查询，并在用户和文档之间匹配令牌(即 Pin)。我们使用各种候选检索策略，例如匹配用户的兴趣、使用我们的嵌入式搜索，以及根据用户最近参与的创作者来查找 pin。

![](img/43b5a89b11fdf7d04cad7e2c4b417c7a.png)

*Figure 4\. Candidate retrieval strategies for creator content retrieval*

例如，一个对旅游内容感兴趣的用户访问 Pinterest。我们从用户信号服务中获取用户的兴趣(例如，我们获得“旅行照片”和“徒步旅行路线”)，并将兴趣令牌发送给 Manas。在这种情况下，Manas 将从“兴趣:旅行照片”和“兴趣:徒步旅行路线”的发布列表中返回文档。

![](img/8a4ec0c9c1f82ebe4e0c0df2eb2cae60.png)

类似地，我们也可以使用 pinner 的参与创建者来组成 manas 搜索查询，并从这些创建者中检索 pin，或者使用我们的 pinner 嵌入，通过在 pin 嵌入空间中寻找最近的 pin 邻居来检索候选。

## 勘探和预算控制

为了有效地分发新鲜的创作者内容，我们还建立了一个简单而有效的探索系统，用于为每个 Pin 分配探索预算，并根据 Pin 的实时表现和反馈动态调整探索决策。为了实现这种能力，Manas 索引中的每个 Pin 文档都有指示探索状态的标志，例如该 Pin 是否已经被有效地探索过。我们还有实时流程，可根据每个 Pin 的实时表现和反馈，随着 Pin 获得更多印象和参与，动态调整探索预算和决策。在检索时，我们使用探测标志来确定一个 Pin 文档是否被充分探测，并智能地检索它们。

![](img/9e53ab27b27943f7ea43fcae0364d8b8.png)

*Figure 5\. Creator content exploration and budget control system*

# 未来的工作和挑战

创作者内容分发是 Pinterest 的优先关注领域。它带来了许多独特的挑战，例如如何利用更准确的实时信号和更好的排名模型有效地锁定新鲜内容，如何分发创作者内容以帮助创作者在 Pinterest 上更有效地建立和发展受众，等等。借助新的实时分发系统，我们能够将新鲜创作者内容的端到端服务延迟从 24 小时以上缩短到几秒钟，并在创作者内容发布后立即分发 10 倍以上的内容。然而，这只是一个开始，我们正在积极改善我们的分销系统和产品，以帮助创作者在 Pinterest 上获得成功。如果你对构建下一代内容分发系统感兴趣，[加入我们](https://www.pinterestcareers.com/?repeat=w3tc)！

# 承认

非常感谢 Cosmin Negruseri、洪家成、张楠、罗凌志、、、Tamara Louie、谢海滨、Tim Koh、Michael Mi、、Stephanie DeWet 和 Yin 作出的巨大贡献！该项目是 Pinterest 多个团队的共同努力。感谢兴趣理解，个性化，内容质量，应用科学团队和其他家庭团队的不断帮助和支持！也感谢法律和企业沟通团队对发表这篇文章的支持！