<html>
<head>
<title>Implementing Pagination for fetching Instagram photos</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">实现获取Instagram照片的分页</h1>
<blockquote>原文：<a href="https://blog.kotlin-academy.com/implementing-pagination-for-fetching-instagram-photos-3c58453f15b4?source=collection_archive---------2-----------------------#2020-08-03">https://blog.kotlin-academy.com/implementing-pagination-for-fetching-instagram-photos-3c58453f15b4?source=collection_archive---------2-----------------------#2020-08-03</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="c06e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在开始本教程之前，我推荐你阅读一下Android中的<a class="ae ki" href="https://developer.android.com/topic/libraries/architecture/paging" rel="noopener ugc nofollow" target="_blank">分页库</a>。</p><p id="9342" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">这里，我们将使用MVVM模式实现从Instagram获取用户照片的分页。让我们现在开始。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ko kp l"/></div></figure><h2 id="3155" class="kq kr in bd ks kt ku dn kv kw kx dp ky jv kz la lb jz lc ld le kd lf lg lh li bi translated"><strong class="ak"> 1。配置</strong></h2><p id="e2b1" class="pw-post-body-paragraph jk jl in jm b jn lj jp jq jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh ig bi translated">要在我们的项目中配置分页，请使用</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lo kp l"/></div></figure><p id="4349" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><em class="lp">整合Instagram请遵循这些</em> <a class="ae ki" href="https://developers.facebook.com/docs/instagram-basic-display-api" rel="noopener ugc nofollow" target="_blank"> <em class="lp">步骤</em> </a> <em class="lp">。</em></p><p id="488f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">当您拥有Instagram所需的访问令牌时，请转到下一步。</p><h2 id="26d5" class="kq kr in bd ks kt ku dn kv kw kx dp ky jv kz la lb jz lc ld le kd lf lg lh li bi translated"><strong class="ak"> 2。设置网络通话</strong></h2><ul class=""><li id="9d60" class="lq lr in jm b jn lj jr lk jv ls jz lt kd lu kh lv lw lx ly bi translated">设置翻新客户端</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lo kp l"/></div></figure><ul class=""><li id="66a5" class="lq lr in jm b jn jo jr js jv lz jz ma kd mb kh lv lw lx ly bi translated">创建我们的媒体模型</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lo kp l"/></div></figure><h2 id="704d" class="kq kr in bd ks kt ku dn kv kw kx dp ky jv kz la lb jz lc ld le kd lf lg lh li bi translated"><strong class="ak"> 3。创建用于获取数据的存储库</strong></h2><p id="4444" class="pw-post-body-paragraph jk jl in jm b jn lj jp jq jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh ig bi translated">我们将只展示照片，因此我们需要:</p><p id="e2ac" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe mc md me mf b"><em class="lp">media_type</em></code> - &gt;过滤图片/相册</p><p id="767f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe mc md me mf b"><em class="lp">media_url</em></code> - &gt;从URL加载图片</p><p id="2e10" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe mc md me mf b"><em class="lp">children</em></code> - &gt;仅在转盘专辑的情况下使用。我们也将为子节点定义相同的字段</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lo kp l"/></div></figure><h2 id="5c5f" class="kq kr in bd ks kt ku dn kv kw kx dp ky jv kz la lb jz lc ld le kd lf lg lh li bi translated">4.创建数据源</h2><p id="0ef8" class="pw-post-body-paragraph jk jl in jm b jn lj jp jq jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh ig bi translated">有3种类型的<code class="fe mc md me mf b">Data source </code>可用。您可以根据自己的需要使用以下任何一种<code class="fe mc md me mf b">Data source</code>。</p><ul class=""><li id="d12c" class="lq lr in jm b jn jo jr js jv lz jz ma kd mb kh lv lw lx ly bi translated"><strong class="jm io"><em class="lp">itemckeyeddatasource</em></strong>-&gt;如果需要从上次提取的项目id中提取数据。</li><li id="49d2" class="lq lr in jm b jn mg jr mh jv mi jz mj kd mk kh lv lw lx ly bi translated"><strong class="jm io"><em class="lp">positional data source</em></strong>-&gt;如果需要从特定位置/页面取数据。</li><li id="79ab" class="lq lr in jm b jn mg jr mh jv mi jz mj kd mk kh lv lw lx ly bi translated"><strong class="jm io"><em class="lp">PageKeyedDataSource</em></strong>-&gt;如果加载的页面嵌入下一个/上一个键</li></ul><p id="566e" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们将使用<code class="fe mc md me mf b">PageKeyedDataSource</code>，因为我们从Graph API获得下一个/上一个指针作为响应。</p><p id="eeeb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">最初，我们将把<code class="fe mc md me mf b">next<em class="lp"> </em></code>光标作为空值传递给他们。然后适配器将加载数据，直到<code class="fe mc md me mf b"> params<em class="lp">.</em>key<em class="lp"> </em></code> <em class="lp">或下一个</em>为<code class="fe mc md me mf b">null</code>。</p><p id="c2cb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">在API响应中获取<code class="fe mc md me mf b"><em class="lp">InstagramMediaModel</em></code> <em class="lp"> </em>时，我们向回调对象提供数据以及上一个和下一个键。如果出错，我们只需传递一个空列表和下一个指针作为<code class="fe mc md me mf b">null</code>。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lo kp l"/></div></figure><p id="033a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><code class="fe mc md me mf b"><em class="lp">getFilteredList</em></code>方法过滤响应列表，并提供一个包含个人帖子和相册帖子中所有照片的列表。</p><h2 id="f62f" class="kq kr in bd ks kt ku dn kv kw kx dp ky jv kz la lb jz lc ld le kd lf lg lh li bi translated">5.创建数据源工厂</h2><p id="637c" class="pw-post-body-paragraph jk jl in jm b jn lj jp jq jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh ig bi translated">应用程序或库的数据加载系统可以实现这个接口来创建<code class="fe mc md me mf b">LiveData&lt;PagedList&gt;</code></p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lo kp l"/></div></figure><h2 id="7550" class="kq kr in bd ks kt ku dn kv kw kx dp ky jv kz la lb jz lc ld le kd lf lg lh li bi translated">6.正在创建列表适配器</h2><p id="ac9e" class="pw-post-body-paragraph jk jl in jm b jn lj jp jq jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh ig bi translated">一个简单的PagedListAdapter将照片项目放大到我们的布局中。PagedListAdapter在内部扩展RecyclerView.Adapter。它采用两个参数:</p><ul class=""><li id="1ec4" class="lq lr in jm b jn jo jr js jv lz jz ma kd mb kh lv lw lx ly bi translated"><em class="lp">数据</em> - &gt;列表的类型。这里，<em class="lp"> InstagramMediaModel。数据？</em>是我们的物品类型、</li><li id="e516" class="lq lr in jm b jn mg jr mh jv mi jz mj kd mk kh lv lw lx ly bi translated"><em class="lp"> ViewHolder。</em></li></ul><p id="1541" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们还提供了一个<strong class="jm io"> DiffUtil </strong>类。它是一个实用程序类，用于计算提供给适配器的新旧列表之间的差异，并输出更新操作以将旧列表转换为新列表。它使用一种有效的机制与回收器视图的更新进行通信。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lo kp l"/></div></figure><h2 id="4514" class="kq kr in bd ks kt ku dn kv kw kx dp ky jv kz la lb jz lc ld le kd lf lg lh li bi translated">7.创建视图模型</h2><p id="3aa7" class="pw-post-body-paragraph jk jl in jm b jn lj jp jq jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh ig bi translated">这个<strong class="jm io"> </strong> <em class="lp"> ViewModel </em>将用于创建分页列表。该PagedList将要求<em class="lp">instagramphotosdata source</em>加载所有照片列表，并保存照片项目。为了获取数据，它使用后台执行器。</p><p id="650d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了建立页面列表，我们使用:</p><ul class=""><li id="8dd7" class="lq lr in jm b jn jo jr js jv lz jz ma kd mb kh lv lw lx ly bi translated"><em class="lp">data source factory</em>-&gt;取数据表单，</li><li id="8c4a" class="lq lr in jm b jn mg jr mh jv mi jz mj kd mk kh lv lw lx ly bi translated">PagedList配置-&gt; paged list的配置，例如初始页面大小、首次初始化列表时加载项目的大小、启用/禁用占位符等。</li></ul><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lo kp l"/></div></figure><h2 id="3e22" class="kq kr in bd ks kt ku dn kv kw kx dp ky jv kz la lb jz lc ld le kd lf lg lh li bi translated">8.在活动中显示列表</h2><p id="19f6" class="pw-post-body-paragraph jk jl in jm b jn lj jp jq jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh ig bi translated">在我们的活动中初始化适配器。如果我们收到一个空列表，那么我们可以检查是否有错误。如果适配器之前没有保存任何列表，那么我们可以在视图上处理我们的错误情况(现在，我显示一个snackbar)，否则我们将列表提交给适配器，它将新列表附加到当前列表。</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="lo kp l"/></div></figure><p id="477f" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">仅此而已！现在，您可以在您的应用程序中尝试这样做。</p><p id="e3fd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">随时欢迎建议！编码快乐！</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ml"><img src="../Images/c36a1034e9e4fb2f28813f9dbed78796.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2F-tZzyY2CMF-Ib8rm1EcA.jpeg"/></div></div></figure></div><div class="ab cl ms mt hr mu" role="separator"><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx my"/><span class="mv bw bk mw mx"/></div><div class="ig ih ii ij ik"><h1 id="fa64" class="mz kr in bd ks na nb nc kv nd ne nf ky ng nh ni lb nj nk nl le nm nn no lh np bi translated">单击👏说“谢谢！”并帮助他人找到这篇文章。</h1><p id="684d" class="pw-post-body-paragraph jk jl in jm b jn lj jp jq jr lk jt ju jv ll jx jy jz lm kb kc kd ln kf kg kh ig bi translated">了解卡帕头最新的重大新闻。学院，<a class="ae ki" href="https://kotlin-academy.us17.list-manage.com/subscribe?u=5d3a48e1893758cb5be5c2919&amp;id=d2ba84960a" rel="noopener ugc nofollow" target="_blank">订阅时事通讯</a>，<a class="ae ki" href="https://twitter.com/ktdotacademy" rel="noopener ugc nofollow" target="_blank">观察Twitter </a>并在媒体上关注我们。</p><p id="09c9" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你需要一个科特林工作室，看看我们如何能帮助你:<a class="ae ki" href="https://www.kt.academy/" rel="noopener ugc nofollow" target="_blank"> kt.academy </a>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><a href="https://kotlin-academy.us17.list-manage.com/subscribe?u=5d3a48e1893758cb5be5c2919&amp;id=d2ba84960a"><div class="gh gi nq"><img src="../Images/3146970f03e44cb07afe660b0d43e045.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*54OqlYA4etu7wfpmMP5TKQ.png"/></div></a></figure></div></div>    
</body>
</html>