<html>
<head>
<title>Tabbable Field-by-Field Nanoflow Validations in Mendix</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Mendix中的表格式逐字段纳流验证</h1>
<blockquote>原文：<a href="https://medium.com/mendix/tabbable-field-by-field-nanoflow-validations-in-mendix-dfb0395a424d?source=collection_archive---------3-----------------------#2022-10-05">https://medium.com/mendix/tabbable-field-by-field-nanoflow-validations-in-mendix-dfb0395a424d?source=collection_archive---------3-----------------------#2022-10-05</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><div class=""><h2 id="33d7" class="pw-subtitle-paragraph ir ht hu bd b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ek translated">一种提高已验证表单UX的模式</h2></div><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff jj"><img src="../Images/cdff974f2050e3f516046a9a2c70484f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I7px9O8epXcfR-UfXN8VKA.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Tabbable Field-by-Field Nanoflow Validations in Mendix</figcaption></figure><h2 id="9b65" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">假设您正在填写一个长表单，在填写完一个字段后，您意外地按下了“enter”你认为UX会发生什么？您希望在所有未触及的字段上看到大量验证消息吗？或者你会期待一只更温柔的引导之手？</h2><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff kx"><img src="../Images/63c9f66bcc576c52792aeb4d260a0cd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*OfdWhTNAtqRVzP5toxKuvw.png"/></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">An example of bad UX — after a single “enter” the user gets feedback on the entire form</figcaption></figure><p id="ebb0" class="pw-post-body-paragraph ky kz hu bd b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated">这个博客将提供一种用户友好的验证表单的方式，它建立在我去年10月概述的专家验证模式之上。它允许您逐个字段地浏览表单，并使用纳流和微流进行验证。这需要一点深度，但它是非常容易维护的。这是它实际运行的样子:</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff lr"><img src="../Images/0a60fbda1086e2f51f5f7781d8d4e320.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*GDuO1quqZ1QdZ1N3jgrdkA.gif"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Tabbable, field-by-field nanoflow validations</figcaption></figure></div><div class="ab cl ls lt hb lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="hn ho hp hq hr"><h1 id="0c79" class="lz ka hu bd kb ma mb mc kf md me mf kj ja mg jb kn jd mh je kr jg mi jh kv mj dt translated">为什么要使用纳流验证？那不是不安全吗？</h1><p id="3d72" class="pw-post-body-paragraph ky kz hu bd b la mk iv lc ld ml iy lf kk mm lh li ko mn lk ll ks mo ln lo lp hn dt translated">在我们深入研究如何操作之前，你可能会想:为什么要使用纳流？答案是速度。首先也是最重要的一点，<strong class="bd mp">纳流运行在客户端</strong>中，这意味着浏览器或手机，而微流运行在Mendix服务器上。因此，Mendix服务器计算微流验证结果的压力可以通过使用nanoflows大大降低，特别是当预计许多用户同时触发验证时。基本思想是，我们首先在客户机内进行所有必要的检查，当表单完成并准备发送到Mendix服务器(微流)时，我们在处理或提交之前进行一次最终的微流检查。这最后的检查是非常重要的，因为我们应该始终小心从客户端接收的数据；假设，来自客户端的所有东西都是潜在不安全的。</p><p id="9bf1" class="pw-post-body-paragraph ky kz hu bd b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated">同时使用微流和纳流进行验证的一个缺点是会导致一些重复；纳流不能从微流中触发，这意味着我们在纳流中设置的相同验证检查也必须在微流中设置/复制。然而，通过坚持<a class="ae lq" rel="noopener" href="/mendix/expert-validations-in-mendix-10e1bdfc7bc0">专家验证</a>模式，增加的维护可以再次大大减少；<strong class="bd mp">可以为一家公司</strong>定义一组可重复使用的纳米流和微流验证 <strong class="bd mp">，可以跨多个实体/模块甚至应用程序使用。</strong></p><p id="2d7b" class="pw-post-body-paragraph ky kz hu bd b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated">根据经验，如果您的应用程序有一个大的用户群，并且预计会有多个并发验证，那么使用纳流验证和微流验证。类似地，如果您的应用程序是原生移动应用程序，那么使用纳流验证和微流是一个先决条件。</p></div><div class="ab cl ls lt hb lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="hn ho hp hq hr"><h1 id="7d10" class="lz ka hu bd kb ma mb mc kf md me mf kj ja mg jb kn jd mh je kr jg mi jh kv mj dt translated">跟踪字段有效性</h1><p id="1312" class="pw-post-body-paragraph ky kz hu bd b la mk iv lc ld ml iy lf kk mm lh li ko mn lk ll ks mo ln lo lp hn dt translated">构建可制表的、逐字段验证的关键问题之一是跟踪哪个字段已经被触及。理想情况下，只有用户访问过的字段才会收到验证消息。基于与<a class="ae lq" rel="noopener" href="/mendix/expert-validations-in-mendix-10e1bdfc7bc0">专家验证</a>文章中相同的想法，我们假设有一个名为“User”的实体，它有四个主要属性:<strong class="bd mp">、/名字、/Interfix、/姓氏和/电子邮件</strong>，所有这些都必须经过验证。我们将使用一个非持久的实体来临时存放用户提供的值，直到我们知道数据是有效的并准备好存储在$User中。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff mq"><img src="../Images/6bfc4772459d0a52c2a9f92c0ed8c118.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*hijRATrFr57a3aVYVadZaQ.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Persistable $User, with its non-persistable form helper</figcaption></figure><p id="87ab" class="pw-post-body-paragraph ky kz hu bd b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated">任何主要属性字段都可以被触摸(真/假)和有效(真/假)，导致四种可能的状态(2*2)。原则上，在用户输入/FirstName字段之前，它将是<strong class="bd mp"> touched = false </strong>，并且<strong class="bd mp"> valid = false </strong>。目前，我们还不想显示验证消息。在<strong class="bd mp">用户输入一个字段并离开</strong>后，该字段变为<strong class="bd mp"> touched = true </strong>，字段内容本身可能有效也可能无效。在后一种情况下，我们现在希望显示一条验证消息。当字段已经被<strong class="bd mp">触摸=真，并且valid =真</strong>时，我们也不想显示验证消息。这导致了三种可能的字段状态(0/1/2 ),我们将它们存储在为每个主属性保留的ValTracker属性中。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div class="fe ff mr"><img src="../Images/af41dae0f67adfe2d47d0bc2331ca53b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*LCaJoINUjLmQ5rQdny18XA.png"/></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Possible ValTracker states: 0 (untouched), 1 (invalid) or 2 (valid)</figcaption></figure><p id="9f3c" class="pw-post-body-paragraph ky kz hu bd b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated">我们现在有了一种方法来跟踪每个主要属性的状态，同样，我们可以决定何时显示验证消息。然而，有一个复杂的因素:属性会随着时间而变化。下表中的关键要点是第一行:</p><blockquote class="ms"><p id="7b1f" class="mt mu hu bd mv mw mx my mz na nb lp ek translated">当一个未被触摸的字段(0)被触摸并且无效(1)时，它现在应该得到一个验证消息；当它为空且未被触及时，它不应该(0)。如果它已经达到状态1或2，它将永远不会回到状态0。</p></blockquote><figure class="nd ne nf ng nh jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nc"><img src="../Images/13a815ad416af4919e109f53d3472e1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F6aX-GyM7uopMuz6bEFRIA.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Tracking states over time, where ValTrackerOld was the earlier state, and ValTrackerNew is the new state.</figcaption></figure><h1 id="8e2d" class="lz ka hu bd kb ma ni mc kf md nj mf kj ja nk jb kn jd nl je kr jg nm jh kv mj dt translated">实现可维护的ValTracking</h1><p id="688f" class="pw-post-body-paragraph ky kz hu bd b la mk iv lc ld ml iy lf kk mm lh li ko mn lk ll ks mo ln lo lp hn dt translated">我们的User_NP表单中的每个主属性字段都有一个<strong class="bd mp">On-Leave nano flow</strong>；每个场都有一个独特的纳流，它首先将相应场的ValTracker设置为1，表示该场已被触摸。随后，我们调用一个通用的Val_User_NP_FxF流，它在每个休假流中被重用。这就是休假流程的样子。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nn"><img src="../Images/3d867b1ccd7d28114dda36e5b0e904b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A7fll2uewik8V-PY60tK6A.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">The OnL_User_FirstName_Validate flow, which first sets /FirstNameValTracker to 1 (touched).</figcaption></figure><p id="8fbe" class="pw-post-body-paragraph ky kz hu bd b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated">如上图所示，<strong class="bd mp">四个主要属性字段</strong>中的每一个都有一个单独的On-Leave nanoflow，并且在其中设置了各自的ValTrackers。为了能够跟踪每个字段的触摸状态，这是必不可少的。随后更深的Val_User_NP流检查整个实体的一般有效性。在我们看这个流程之前，这是一个善意的提醒，提醒读者先看看<a class="ae lq" rel="noopener" href="/mendix/expert-validations-in-mendix-10e1bdfc7bc0">专家验证</a>模式，如果不熟悉的话，可能会感到困惑。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff no"><img src="../Images/decd38672ef469a52031abbfa3c5dbdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b24eoYGwI7lrqSUiloO5vw.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">VAL_User_NP_FxF_Expert_Nanoflow — first section that trims, and validates /FirstName</figcaption></figure><p id="81f5" class="pw-post-body-paragraph ky kz hu bd b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated">与专家模式一致，<strong class="bd mp">我们首先在所有主字符串属性</strong>上使用一个有效的trim()，它也初始化任何空字符串。然后，我们使用一个子流来验证/FirstName，将/FirstName属性中包含的原始字符串值传递给它。第二个VAL活动的结果是一个ValidationMessage，当它是一个空字符串“”时，意味着该字段是有效的，这意味着我们可以将/FirstNameValtracker设置为2(有效)。如果不是，流程继续设置/FirstNameValTracker的正确状态(0或1)。如果/FirstNameValTracker为0，并且现在存储在/FirstName中的值是空字符串“”，则/FirstNameValtracker被设置为未接触状态(0)，这意味着不会显示任何验证消息。在任何其他情况下，/FirstNameValtracker将获得无效(1)状态，这意味着将显示FirstNameValidationMessage。</p><p id="a246" class="pw-post-body-paragraph ky kz hu bd b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated">这里要记住的关键是，当磁场未被触及时，有可能进入向下的流动(0) 。在这种情况下，FirstNameValidationMessage将用“Required”填充，但是，由于存储在/FirstNameValTracker中的值为0，因此不会显示实际的验证消息。在建立了这个模式之后，只需要复制和粘贴就可以了；相同的模式可以用于所有后续的主属性/字段。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff np"><img src="../Images/7b1c0f526e8c7ce76320008e52f2037c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HzETIxKY3h_kflQcs4lCzg.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">VAL_User_NP_FxF_Expert_Nanoflow shown in its entirety</figcaption></figure><p id="0118" class="pw-post-body-paragraph ky kz hu bd b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated">剩下唯一要做的就是创建一个ACT_User_NP_ValidateAndSave流。这将调用处理经过验证的实体的微流。不要忘记给处理微流程添加一个适当的验证子微流程。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nq"><img src="../Images/bedf6652210803b47260c396c5ecb24b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T_XWV84LyjKBqtN7t25GQQ.png"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">ACT_User_NP_FxF_ValidateAndSave_V6 validates theuser and calls on a microflow to process it further</figcaption></figure></div><div class="ab cl ls lt hb lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="hn ho hp hq hr"><h1 id="ca9a" class="lz ka hu bd kb ma mb mc kf md me mf kj ja mg jb kn jd mh je kr jg mi jh kv mj dt translated">状态跟踪的美妙之处</h1><p id="30a2" class="pw-post-body-paragraph ky kz hu bd b la mk iv lc ld ml iy lf kk mm lh li ko mn lk ll ks mo ln lo lp hn dt translated">在本文中，我展示了如何建立快速、可维护且健壮的可制表的逐字段纳米流验证。这种模式最初可能会让人感觉有些不舒服，因为所有的状态跟踪在经典的Mendix验证中都不是标准的。然而，在实际表单中拥有跟踪状态属性的一个好处是，我们现在还可以在字段被正确填充时给用户积极的反馈。基于ValTracker，只需在字段中添加一些条件样式；例如，如果值为2，我们可以给字段一个绿色轮廓。这是一个交互的例子。</p><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff lr"><img src="../Images/8a7f2dcec1debb7a5f39a92fea68c7bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*k1PJhgD9mQhYFASlRtweEA.gif"/></div></div><figcaption class="jv jw fg fe ff jx jy bd b be z ek">Filling out the tabbable form and getting positive feedback as well.</figcaption></figure><p id="04d7" class="pw-post-body-paragraph ky kz hu bd b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated">如果你想尝试这种验证字段的方式，我准备了一个项目，可以从<a class="ae lq" href="https://marketplace.mendix.com/link/component/119733" rel="noopener ugc nofollow" target="_blank"> Mendix应用商店</a>下载。我期待听到您的批评性想法和建议，以使这些验证工作做得更好！</p></div><div class="ab cl ls lt hb lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="hn ho hp hq hr"><figure class="jk jl jm jn fq jo fe ff paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="fe ff nr"><img src="../Images/6de753ee228a92672a701b500f675010.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0X4HXTeXMg--bZTbA6G1pQ.jpeg"/></div></div></figure><p id="bdc4" class="pw-post-body-paragraph ky kz hu bd b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated"><em class="ns">#关于:Wouter Penris <br/> Wouter是凯捷的Mendix MVP和软件工程师，拥有教育(英语&amp;音乐)和音乐(爵士声乐&amp;钢琴)背景；多潜能者。作为一名教师，他花了数年时间完善尽可能简单易懂地指导学生的艺术，现在他非常喜欢使用同样的技能来构建具有直观和易于理解的用户体验的高科技产品。他是一个极具创造性的问题解决者，将研究、技术和美学融入实际的商业价值和建议中。</em></p><h2 id="d196" class="jz ka hu bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dt translated">阅读更多</h2><div class="nt nu fm fo nv nw"><a href="https://docs.mendix.com/howto/data-models/setting-up-data-validation/" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab ej"><div class="ny ab nz cl cj oa"><h2 class="bd hv fv z el ob eo ep oc er et ht dt translated">设置数据验证</h2><div class="od l"><h3 class="bd b fv z el ob eo ep oc er et ek translated">描述如何使用Studio Pro设置必需的和高级的数据验证。</h3></div><div class="oe l"><p class="bd b gc z el ob eo ep oc er et ek translated">docs.mendix.com</p></div></div></div></a></div><div class="nt nu fm fo nv nw"><a href="https://docs.mendix.com/howto/data-models/create-a-basic-data-layer/" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab ej"><div class="ny ab nz cl cj oa"><h2 class="bd hv fv z el ob eo ep oc er et ht dt translated">创建基本数据层</h2><div class="od l"><h3 class="bd b fv z el ob eo ep oc er et ek translated">描述如何创建实体和属性、添加枚举、创建关联以及配置删除…</h3></div><div class="oe l"><p class="bd b gc z el ob eo ep oc er et ek translated">docs.mendix.com</p></div></div></div></a></div><div class="nt nu fm fo nv nw"><a href="https://docs.mendix.com/howto/data-models/denormalize-data-to-improve-performance/" rel="noopener  ugc nofollow" target="_blank"><div class="nx ab ej"><div class="ny ab nz cl cj oa"><h2 class="bd hv fv z el ob eo ep oc er et ht dt translated">反规范化数据以提高性能</h2><div class="od l"><h3 class="bd b fv z el ob eo ep oc er et ek translated">描述如何在Studio Pro中反规范化数据并保持反规范化数据同步。</h3></div><div class="oe l"><p class="bd b gc z el ob eo ep oc er et ek translated">docs.mendix.com</p></div></div></div></a></div></div><div class="ab cl ls lt hb lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="hn ho hp hq hr"><p id="2349" class="pw-post-body-paragraph ky kz hu bd b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated"><em class="ns">来自发布者- </em></p><p id="13ea" class="pw-post-body-paragraph ky kz hu bd b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated"><em class="ns">如果你喜欢这篇文章，你可以在我们的</em> <a class="ae lq" href="https://medium.com/mendix" rel="noopener"> <em class="ns">媒体页面</em> </a> <em class="ns">找到更多类似的文章。对于精彩的视频和直播会话，您可以前往</em><a class="ae lq" href="https://www.mendix.com/live/" rel="noopener ugc nofollow" target="_blank"><em class="ns">MxLive</em></a><em class="ns">或我们的社区</em><a class="ae lq" href="https://www.youtube.com/c/MendixCommunity/community" rel="noopener ugc nofollow" target="_blank"><em class="ns">Youtube PAG</em></a><em class="ns">e .</em></p><p id="8d21" class="pw-post-body-paragraph ky kz hu bd b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated"><em class="ns">希望入门的创客，可以注册一个</em> <a class="ae lq" href="https://signup.mendix.com/link/signup/?source=direct" rel="noopener ugc nofollow" target="_blank"> <em class="ns">免费账号</em> </a> <em class="ns">，通过我们的</em> <a class="ae lq" href="https://academy.mendix.com/link/home" rel="noopener ugc nofollow" target="_blank"> <em class="ns">学苑</em> </a> <em class="ns">获得即时学习。</em></p><p id="023a" class="pw-post-body-paragraph ky kz hu bd b la lb iv lc ld le iy lf kk lg lh li ko lj lk ll ks lm ln lo lp hn dt translated"><em class="ns">有兴趣加入我们的社区吗？加入我们的</em> <a class="ae lq" href="https://join.slack.com/t/mendixcommunity/shared_invite/zt-hwhwkcxu-~59ywyjqHlUHXmrw5heqpQ" rel="noopener ugc nofollow" target="_blank"> <em class="ns">松弛社区频道</em> </a> <em class="ns">。</em></p></div></div>    
</body>
</html>