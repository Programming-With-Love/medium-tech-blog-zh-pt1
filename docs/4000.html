<html>
<head>
<title>Using WhatsApp Business API Cloud with AWS Lambda.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过AWS Lambda使用WhatsApp Business API Cloud。</h1>
<blockquote>原文：<a href="https://medium.com/globant/using-whatsapp-business-api-cloud-with-aws-lambda-f776b763048b?source=collection_archive---------0-----------------------#2022-10-05">https://medium.com/globant/using-whatsapp-business-api-cloud-with-aws-lambda-f776b763048b?source=collection_archive---------0-----------------------#2022-10-05</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/80c8e6963f1e73d54ebba51095253c6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cTbrLzpzxiCR_I2nrTZQHg.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx"><a class="ae it" href="https://wa.link/o94qok" rel="noopener ugc nofollow" target="_blank">Click here to test the final project.</a></figcaption></figure></div><div class="ab cl iu iv go iw" role="separator"><span class="ix bw bk iy iz ja"/><span class="ix bw bk iy iz ja"/><span class="ix bw bk iy iz"/></div><div class="ha hb hc hd he"><p id="524e" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">在这个机会中，我们将使用Meta在2022年5月19日发布的WhatsApp business API实现一个从西班牙语到英语的WhatsApp bot翻译器，该API允许所有在Meta拥有帐户的人通过友好的集成为开发者更容易、更快地发送WhatsApp消息。</p><p id="bce8" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">本文将回顾以下部分:</p><ol class=""><li id="f052" class="jz ka hh jd b je jf ji jj jm kb jq kc ju kd jy ke kf kg kh bi translated">在Meta developer的控制台中创建应用程序。</li><li id="930e" class="jz ka hh jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh bi translated">附上WhatsApp产品。</li><li id="473c" class="jz ka hh jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh bi translated">从元开发人员控制台发送测试消息。</li><li id="c8e2" class="jz ka hh jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh bi translated">构建webhook。</li><li id="779b" class="jz ka hh jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh bi translated">将webhook部署为lambda函数。</li><li id="4858" class="jz ka hh jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh bi translated">在Meta developer的控制台中将lambda函数URL配置为webhook。</li><li id="91a7" class="jz ka hh jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh bi translated">结论。</li></ol></div><div class="ab cl iu iv go iw" role="separator"><span class="ix bw bk iy iz ja"/><span class="ix bw bk iy iz ja"/><span class="ix bw bk iy iz"/></div><div class="ha hb hc hd he"><ol class=""><li id="05e1" class="jz ka hh jd b je jf ji jj jm kb jq kc ju kd jy ke kf kg kh bi translated"><strong class="jd hi">在元开发者控制台内部创建应用:</strong><a class="ae it" href="https://developers.facebook.com/docs/development/create-an-app/?locale=es_LA" rel="noopener ugc nofollow" target="_blank">https://developers . Facebook . com/docs/development/Create-an-app/？locale=es_LA </a>这个链接提供了在Meta developer的控制台中创建应用程序的所有必要信息。</li></ol><figure class="ko kp kq kr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kn"><img src="../Images/4e8516754c5fbb003f77d05e5bf8a80e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SlmmSAO5kPPQxwOD9e4K1A.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Example application panel in meta developers platform, Pruebas 2 was the app created to this exercise.</figcaption></figure><p id="f5e7" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated"><strong class="jd hi"> 2。附加WhatsApp产品:</strong>选择创建的应用程序并将其附加到WhatsApp选项，您应该在菜单中找到WhatsApp产品，然后单击入门按钮，如果一切正常，您应该会看到下一个类似的屏幕:</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ks"><img src="../Images/35559b16cc1a2ec12ac6b8bac677e1f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0k136bwh3q0Bb9vnxQcH0g.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">On the left you should see the WhatsApp module, select getting started.</figcaption></figure><p id="62ab" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated"><strong class="jd hi"> 3。从meta开发者的控制台发送测试消息:</strong>此时，我们将能够使用Meta的图形界面发送消息，发送WhatsApp默认模板消息来测试功能，Meta给我们一个测试号来发送消息，这个号有一些限制，但是对于测试环境来说已经足够了。</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kt"><img src="../Images/7b86533fda2bf718c55e88b0d81d82ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ns2UfIylBeOqkf1zswDJng.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">In this part, we can to send template message to test the functionality.</figcaption></figure><p id="d137" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated"><strong class="jd hi"> 4。构建webhook: </strong>为了这个目标，我们将使用lambda函数中的节点Js在Meta developer的控制台中设置webhook，这样，机器人收到的所有消息都将由该函数处理，记住目标是接收西班牙语消息，将它们翻译成英语，并将消息返回给用户。</p><p id="fd44" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">对于翻译模块，我们将使用由https://www.npmjs.com/package/translatte NPM提供的名为Translate <a class="ae it" href="https://www.npmjs.com/package/translatte" rel="noopener ugc nofollow" target="_blank">的免费库。</a></p><p id="9ed6" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">代码将作为公共存储库部署在GitHub中。</p><div class="ku kv ez fb kw kx"><a href="https://github.com/4l3j4ndr0/webhook-wahtsapp" rel="noopener  ugc nofollow" target="_blank"><div class="ky ab dw"><div class="kz ab la cl cj lb"><h2 class="bd hi fi z dy lc ea eb ld ed ef hg bi translated">GitHub-4 l3j 4 NDR 0/web hook-wahtsapp:这是WhatsApp webhook的一个例子。</h2><div class="le l"><p class="bd b fp z dy lc ea eb ld ed ef dx translated">github.com</p></div></div><div class="lf l"><div class="lg l lh li lj lf lk in kx"/></div></div></a></div><figure class="ko kp kq kr fd ii"><div class="bz dy l di"><div class="ll lm l"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Webhook functionality to response translate message.</figcaption></figure><p id="fe27" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated"><strong class="jd hi"> 5。将webhook部署为lambda函数:</strong>要部署上面共享的代码，我们需要克隆存储库，执行npm install命令，使用14或更高的节点版本非常重要，然后，当安装完依赖项后，我们将压缩文件(。zip)通过控制台上传到AWS lambda模块(您可以在下面找到说明)。</p><p id="65d3" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">要在AWS中部署lambda函数，我们必须导航到lambda函数模块选择函数部分，然后选择创建函数，在下一页中选择第一个选项(从头开始创作)，分配函数名称，对于运行时，我建议选择Node.js 14x，体系结构选择x86_64，在高级设置部分，选择启用函数URL，对于验证类型，选择无选项，然后选择“创建函数”选项。</p><p id="e761" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">现在，我们将添加一个额外的设置来授予webhook的正确操作，在常规设置部分，我们将更改执行的超时，我认为30秒足够了，然后在环境变量部分，我们需要添加2个变量:</p><ul class=""><li id="cb4d" class="jz ka hh jd b je jf ji jj jm kb jq kc ju kd jy ln kf kg kh bi translated">验证令牌=验证</li><li id="1fd3" class="jz ka hh jd b je ki ji kj jm kk jq kl ju km jy ln kf kg kh bi translated">WHATSAPP_TOKEN=这个值，我们可以从面向开发者的Meta控制台中获取。</li></ul><p id="28af" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">接下来，我们必须上传带有lambda函数的代码和库的zip文件，要实现这一点，我们必须选择代码部分，然后选择“上传自”，接下来选择。“zip选项”并从我们的机器中选择zip文件。</p><p id="730b" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">如果上面分享的说明令人困惑，我将添加描述这些步骤的截图。</p><p id="1f5d" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">5.1搜索lambda模块并进入。</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lo"><img src="../Images/440a82ea018e9ac17f6a817b74ad1ab9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1WyEP4CuznH8N6f54YirkA.png"/></div></div></figure><p id="c9c3" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">5.2.选择函数选项，然后选择创建函数。</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lp"><img src="../Images/18cb03c36567d50e9727404e3299d528.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*adM6Fw3nKJYCZxzjfLooOg.png"/></div></div></figure><p id="8b78" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">5.3.选择第一个选项(从头开始创作)，分配名称，选择运行时和架构。</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lq"><img src="../Images/5abad87f15064e151fc9f1348ccb84b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CUhTfWSq1PGBgyfxEdrsOA.png"/></div></div></figure><p id="fa48" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">5.4.在“高级设置”部分，选择“启用函数url ”,对于“验证类型”,选择“无”,最后选择“创建函数”选项。</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lr"><img src="../Images/715afa6b076e3f374edea9889e03dcc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nr841akAwHI1kwOhfHLMug.png"/></div></div></figure><p id="1405" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">5.5.添加额外配置创建lambda时，在常规配置的配置部分，将超时时间更改为30秒。</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ls"><img src="../Images/06ccee15c6019fbcd300d89781d0675a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3V8bcRBoJdgrHcuNdubMSw.png"/></div></div></figure><p id="8efb" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">5.6.在相同的设置部分，单击环境变量选项并添加变量。</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lo"><img src="../Images/4ead42cd3851d08b703c6ac0d75ac816.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rWppgGiQAk6UKeahotIaSw.png"/></div></div></figure><p id="0107" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated"><strong class="jd hi"> 6。将lambda函数URL配置为Meta developers console中的webhook:</strong>要结束项目并测试功能，我们只需在Meta developers console中将lambda函数设置为web hook，要实现它，我们将获取函数URL，并遵循下面的步骤。</p><p id="42e7" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">6.1在Meta developer的控制台中，选择“配置Webhooks”选项。</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lt"><img src="../Images/47f6173f84db238049d93849ac80b840.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YgRZEan6lAIEhQWLpScf0Q.png"/></div></div></figure><p id="c81a" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">6.2.在输入回调URL中，我们将添加lambda函数URL并添加'/webhook '端点，在验证令牌类型中写入' verify '，此文本将等于lambda函数中定义的环境变量。</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lu"><img src="../Images/eb1a736d10eea01ecc2e782524b558fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z4h0AlTgau1eqPLDETVGCA.png"/></div></div></figure><p id="3775" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">6.3.接下来，在webhook字段部分，选择管理选项并订阅选项消息。</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lv"><img src="../Images/acf640fd3fe46e7102c274c7c2438e34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pJ-WHWDL7v2gjvH-c8rxqw.png"/></div></div></figure><p id="c146" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">现在，我们的聊天机器人不仅可以发送消息，还可以监听用户消息，翻译文本并发送翻译后的响应，聊天机器人将能够与用户交互并快速发送响应。</p><figure class="ko kp kq kr fd ii er es paragraph-image"><div class="er es lw"><img src="../Images/9c13e24dbcbd033baca6d8d135fa1fe7.png" data-original-src="https://miro.medium.com/v2/resize:fit:952/format:webp/1*7L1CpJuCnodXl5nqXX4SsQ.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx"><a class="ae it" href="https://wa.link/o94qok" rel="noopener ugc nofollow" target="_blank">Example of interaction with the bot.</a></figcaption></figure><p id="babe" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated"><strong class="jd hi"> 7。结论:</strong></p><ul class=""><li id="149c" class="jz ka hh jd b je jf ji jj jm kb jq kc ju kd jy ln kf kg kh bi translated">随着对所有用户开放的关于API cloud的Meta的新发布，现在最容易创建WhatsApp聊天机器人，而无需提供商中介。</li><li id="07a0" class="jz ka hh jd b je ki ji kj jm kk jq kl ju km jy ln kf kg kh bi translated">我们可以使用AWS Lambda作为webhook，我们不需要创建任何网络基础设施，只需进行一点配置，我们就可以有一个端点来处理请求，就像本例中一样。</li><li id="cf07" class="jz ka hh jd b je ki ji kj jm kk jq kl ju km jy ln kf kg kh bi translated">Meta有免费层对话，您的WhatsApp商业帐户每月的前1000次对话是免费的。自由层对话可以由企业发起，也可以由用户发起。如果您没有使用每个月的1000次免费对话，剩余的对话不会延续到下个月。</li></ul><p id="323e" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">感谢你的阅读，我希望你喜欢。</p></div></div>    
</body>
</html>