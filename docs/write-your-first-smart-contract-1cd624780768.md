# 如何写你的第一份智能合同？

> 原文：<https://medium.com/edureka/write-your-first-smart-contract-1cd624780768?source=collection_archive---------4----------------------->

![](img/6482254236893529b16fa77313c26b96.png)

在本文中，您将学习如何构建您的第一个智能合同。我将使用 Remix IDE 开发和测试智能合同。

本智能合同开发教程涵盖以下主题:

*   构建您的第一份智能合同
*   智能合同的结构
*   杂注指令
*   合同声明
*   存储与合同相关的数据
*   引入变量
*   值类型
*   参考类型
*   向合同添加数据
*   定义构造函数
*   添加功能
*   获取功能
*   Setter 函数
*   部署智能合同
*   部署选项
*   与已部署的合同交互
*   结论

# 构建您的智能合同

作为这个博客系列的一部分，将开发一个简单的采购订单智能合同。随着本系列的进展以及 solidity 编程语言新概念的引入，采购订单智能合同将会发展和改进。

# 智能合同的结构

本质上，可靠智能合同是以下内容的集合

*   **数据**——维护合同的当前状态
*   **功能** —应用逻辑转换合同状态

可靠智能合约遵循标准结构。任何智能合约都以下面的语句开始

# 杂注指令

“pragma”关键字可用于启用某些编译器功能或检查。下面的语句定义了源文件(智能合约)不能用 0.4.0 之前的编译器和 0.6.0 之后的编译器版本进行编译。该声明确保在引入新的编译器版本时不会引入意外的行为。

```
pragma solidity >=0.4.0 <=0.6.0
```

# 合同声明

使用关键字“合同”来声明合同。这声明了一个名为“PurchaseOrder”的空协定。

```
contract PurchaseOrder{ }
```

# 存储与合同相关的数据

每一个合同或者一般来说每一个程序都可能需要存储一些数据。向程序添加数据为它提供了一定程度的灵活性。从程序中的硬编码值转移到用户提供的值是一个重要的特性。变量允许您存储数据、标记数据、检索数据和操作数据。

# 智能合同开发:引入变量

在固体中，变量有两种类型

1.  **值类型:**这些类型的变量通过值传递，也就是说，当它们被用作函数参数或在赋值中使用时，它们总是被复制。例如:整数、布尔地址等。
2.  **引用类型:**这些类型变量类型复杂，通过引用传递，这些变量不适合 256 位，必须小心管理，因为复制它们的开销很大。

## 将数据添加到智能合同

让我们给合同增加一些数据变量。对于每个采购订单，都必须有一定数量的产品与之相关联。让我们添加一个数据类型为整数或数字的变量 product_quantity。

我们现在引入的变量是一个无符号整数，用 uint256 表示，这里的 256 表示 256 位存储。

*   U —(意味着该类型只能表示正整数，不能表示正负整数)
*   INT —整数
*   大小为 256–256 位
*   可以分配给 uint256 的最小值是 0
*   uint256 可以分配的最大值是 2 ⁵⁶-1[一个非常大的数字]

产品数量只是一个正值，目前的假设是我们将迎合一个非常大的产品数量值。

声明的“product_quantity”变量是契约状态的一部分，因此被持久化或存储在契约空间中。目前，该变量的默认值为 0。

```
contract PurchaseOrder{ uint256 product_quantity; }
```

# 定义构造函数

部署协定时调用构造函数。构造函数用一些值初始化协定。在当前场景中，当部署合同时，产品数量设置为 100。也可以通过传递一个变量并使用传入的值初始化 product_quantity 来创建参数化的构造函数。

这里要注意的关键点是与构造函数相关联的访问修饰符“public”。Public 关键字指定任何人都可以访问这个函数，这不是一个受限制的函数。

```
constructor() public{ product_quantity = 100; }
```

# 添加功能

现在让我们添加一些功能来使我们程序具有交互性。功能是可以添加到程序中的受控能力。任何函数前面都有关键字 function。总的来说函数声明看起来是这样的"**函数<函数名> <访问修改后的> <状态赋值器> <返回值>** "。

## 获取功能

对于任何程序来说，最常见的需求之一是读取存储的值。在下面的合同中，我们将需要读取“product_quantity”值。为了提供这种能力，添加了 read 函数或 get 函数。在这个函数中，我们不对存储值进行任何操作，我们只是检索存储值。

现在让我们来分解我们的 get 函数(get_quantity)

![](img/1b7916d105f4cbe805b6a79c6a44f1c9.png)

```
function get_quantity() public view returns(uint256){ return product_quantity; }
```

# Setter 函数

读取数据是必要的，我们在上一节中已经完成了，但是大多数场景还需要写入/更新数据的能力。这种特定的功能是通过添加 setter 函数来提供的。该函数以输入参数的形式从用户处获取一个值。使用用户提供给函数的值，变量“产品数量”的值被写入/更新。

现在让我们分解我们的集合函数(update_quantity)

添加更新产品数量值的函数

![](img/87bd6ea4da4a23fbabdb4417f693a3ff.png)

```
function update_quantity(uint256 value) public { product_quantity = product_quantity + value; }
```

将所有这些放在一起，这就是整个合同的样子。

pragma solidity >=0.4.0 <=0.6.0;

合同采购订单{
uint 256 product _ quantity；//状态变量

/*用契约调用部署并初始化值*/
constructor()public {
product _ quantity = 100；
}

// Get 函数
函数 Get _ quantity()public view returns(uint 256){
return product _ quantity；
}

//设置函数
函数更新 _ 数量(uint256 值)公共{
产品 _ 数量=产品 _ 数量+值；
}
}

# 部署智能合同

是时候测试智能合约了。为了测试这个智能合约，我们将使用 [Remix Online IDE](http://remix.ethereum.org/) 。

Remix 是[以太坊智能合约](https://www.edureka.co/blog/ethereum-smart-contract-project)的在线游乐场。混音是完全基于浏览器的。Remix 为您提供了一个在线 IDE(集成开发环境)，您可以在其中编写您的智能合约。Remix 为你提供了一个在线可靠的编译能力。Remix IDE 中的智能合约可以使用特定的编译器版本无缝编译。

Remix 还提供了快速测试智能合约的能力。

Remix 提供了一个完整的工具集来开始智能合约的开发和智能合约的单元测试，而无需在本地机器上进行任何安装。这对于从可靠性开始非常有用，因为开发人员只需要专注于编写智能合同，而不是担心基础设施。

有了 Remix IDE，你只需要一个浏览器和一个互联网连接就可以开始智能合约开发了。智能合同创意的快速开发、测试和验证。

Remix 最近升级了他们的 UI。

![](img/b3e89de61ac77a66855ce6b4331ac160.png)

单击上图中突出显示的文件图标，文件资源管理器将打开。

1.  单击加号图标，可以创建一个新文件，将文件命名为 PurchaseOrder.sol
2.  这将创建一个名为 PurchaseOrder.sol 的空文件，单击并打开该文件。
3.  让我们把整个合同复制粘贴在采购订单上
4.  点击第二个图标，在文件图标下面的左侧菜单中，应该会出现 solidity 编译器选项。
5.  在编译器标签下，选择编译器版本。当前选择的版本是 0.5.8。
6.  选择编译器版本后，点击“编译 PurchaseOrder.sol”。这将编译智能合同。

![](img/f43deaa8bb95e6b4e0a352da1159b898.png)

7.智能合同编译成功后，单击“编译详细信息”按钮，应该会出现以下详细信息。编译后，可以获得两个关键信息

*   ABI —应用程序二进制接口。这是一个 json 文件，它详细描述了智能契约中公开的所有方法以及这些方法的元数据。这方面的更多内容将在随后的博客中讨论。
*   字节码——EVM(以太坊虚拟机)操作码，智能契约逻辑在编译时被转换成字节码。

8.为了测试智能合约，需要部署智能合约。要部署智能合同，请单击左侧菜单中编译图标下方的下一个图标。将出现以下屏幕。为了测试智能合约，需要部署智能合约。要部署智能合同，请单击左侧菜单中编译图标下方的下一个图标。将出现以下屏幕。

![](img/ad024318732142ab59dbfc37211fe479.png)

# 部署选项

部署屏幕提供了几个选项，让我们逐一查看。

*   环境:这可以被认为是一种选择，类似于选择从亚马逊、Flipkart、新蛋(所有这些都是在线零售商)购买笔记本电脑，你可以根据自己的需求选择从哪里购买。类似地，在 Remix 的情况下，我们可以选择在哪里部署智能合约并测试智能合约。环境标签旁边的下拉菜单提供了三个选项
*   JavaScript VM——本地以太坊单个节点在浏览器内存中启动，并提供 5 个可用于交易(部署、调用功能)的预先资助的测试帐户
*   注入的 Web3 提供—这依赖于元掩码。Metamask 就像一个经纪人或中间人，它允许 web 应用程序与智能合约进行交互。Metamask 提供了管理身份的功能，还可以对发送到以太网的交易进行签名。这个中间人或第三方帮助您确定智能合同将部署到的区块链网络。
*   Web3 Provider —如果您正在运行本地以太坊节点，并且 RPC 端点可用，则可以使用此选项。智能合约将被部署到本地以太坊节点。
*   帐户:此信息是根据所选的环境填充的。比如说。JavaScript VM 提供 5 个预先资助的测试账户。在 Web3 提供商和注入 Web3 的情况下，不提供预先资助的测试帐户。
*   气体限制:这定义了发起者愿意为任何交易花费的气体的最大数量。这是防止无限循环和在无限循环情况下耗尽账户所有资金的地方。
*   Value:部署智能合约时可能需要发送的值。这是一个可选值。

为了部署合同，选择 JavaScript VM 选项，从 accounts 下拉列表中选择第一个帐户，注意帐户的余额(100 ether)。

确保显示的智能合同名称为 PurchaseOrder，单击 deploy。将要发生的关键行动

1.  帐户余额从 100 以太变为 99.999999 以太，扣除的金额是部署智能合约的交易成本。
2.  在已部署的契约下，将出现一个新的智能契约磁贴，它还将提供新智能契约的地址，类似于(0x 692 a70 D2 e 424 a 56 D2 c6c 27 aa 97 D1 a 86395877 B3 a)
3.  在控制台窗口中会出现以下信息
    事务哈希——唯一标识合同部署
    事务成本
    合同地址

![](img/b885e2d3dea331d1d9ecdf9f4887b353.png)

# 与已部署的合同交互

1.  在已部署的合同下，有以下两种交互方法可用:update_quantity 和 get_quantity。
2.  这两种交互方法都是在“采购订单”契约中定义的公共方法。
3.  更新数量“update_quantity”方法需要一个输入参数，因此需要输入框。
4.  获取数量“get_quantity”方法检索 product_quantity 的值。
5.  让我们看看调用 get_quantity 时发生了什么，显示了返回值 100，这是在构造函数中初始化的。这不会导致交易发生
6.  让我们调用 update_quantity 并提供 30 作为输入。这导致交易发生

简而言之，任何导致对契约状态的写操作(即，改变契约变量)的操作都将导致事务。

![](img/dc188ebc80352d1f9f03cf8f6547f86c.png)

任何只是读取契约状态的操作都不会导致事务。

# 智能合同开发结论

有了这个，我们刚刚创建了我们的第一个智能合同，只是触及了坚实的表面。我们刚刚看到了测试智能合约从部署智能合约到启动交易的整个过程。

在下一篇博客中，这是智能合约开发系列的继续，我们将更深入地讨论可靠性基础，更深入地研究智能合约部署。

至此，我结束了这个*智能合同*开发博客。我希望你喜欢阅读这个博客，并发现它的信息量。

*如果您希望学习智能合约，在区块链领域建立职业生涯，并获得以太坊编程方面的专业知识，请在这里注册在线直播的* ***Edureka 区块链认证培训*** *，它将提供 24*7 支持，在整个学习期间为您提供指导。*

如果你想查看更多关于人工智能、DevOps、道德黑客等市场最热门技术的文章，那么你可以参考 [Edureka 的官方网站](https://www.edureka.co/blog/?utm_source=medium&utm_medium=content-link&utm_campaign=smart-contract-development)。

请留意本系列中解释区块链其他各方面的其他文章。

> *1。* [*以太坊教程*](/edureka/ethereum-tutorial-with-smart-contracts-db7f80175646)
> 
> *2。* [*以太坊专用网络*](/edureka/ethereum-private-network-tutorial-22ef4119e4c3)
> 
> *3。* [*什么是智能合约？*](/edureka/smart-contracts-301d39565b76)
> 
> *4。* [*坚实度教程*](/edureka/solidity-tutorial-ca49906bdd47)
> 
> *5。* [*松露以太坊教程*](/edureka/developing-ethereum-dapps-with-truffle-7533289c8b2)
> 
> *6。* [*最好的以太坊开发工具*](/edureka/ethereum-development-tools-7175503a1ac7)
> 
> *7。* [*超帐面料*](/edureka/hyperledger-fabric-184667460-edc184667460)
> 
> 8。 [*超凸 vs 以太坊*](/edureka/hyperledger-vs-ethereum-bdc868e10817)

*原载于 2019 年 7 月 15 日*[*https://www.edureka.co*](https://www.edureka.co/blog/smart-contract-development/)*。*