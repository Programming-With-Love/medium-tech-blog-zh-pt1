<html>
<head>
<title>Tracking app update sizes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">跟踪应用更新大小</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/tracking-app-update-sizes-1a1f57634f7b?source=collection_archive---------1-----------------------#2017-01-17">https://medium.com/androiddevelopers/tracking-app-update-sizes-1a1f57634f7b?source=collection_archive---------1-----------------------#2017-01-17</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/67194604b8e3b430f005b41c89a417d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*-_b0nJ0slwZeUeyJeTqxEA.png"/></div></figure><p id="161a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi">新增:</strong> <a class="ae jj" href="#d851" rel="noopener ugc nofollow"> <strong class="in hi">支持APK补丁大小估算器中的逐文件更新</strong> </a></p><p id="8a36" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在过去的一年里，减小APK的大小一直是一个热门话题。原因有很多:无论你是为了在昂贵和不可靠的网络上用功能较弱的设备接触用户而<a class="ae jj" href="https://developer.android.com/distribute/essentials/quality/billions/index.html" rel="noopener ugc nofollow" target="_blank">构建数十亿个</a>，还是你只是试图优化你的应用，每个人都受益于较小的APK大小、更快的下载和更短的安装时间。</p><p id="ea2c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">应用程序的大小会带来不同的成本:</p><ul class=""><li id="ec3a" class="jk jl hh in b io ip is it iw jm ja jn je jo ji jp jq jr js bi translated">您上传到Google Play的文件大小(原始APK大小)</li><li id="edcb" class="jk jl hh in b io jt is ju iw jv ja jw je jx ji jp jq jr js bi translated">初始下载大小</li><li id="3161" class="jk jl hh in b io jt is ju iw jv ja jw je jx ji jp jq jr js bi translated">设备上安装大小</li><li id="832d" class="jk jl hh in b io jt is ju iw jv ja jw je jx ji jp jq jr js bi translated">更新下载大小</li></ul><p id="ee37" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我们发布了许多指南来解释如何减少初始和设备上的APK大小，包括新的<a class="ae jj" href="https://developer.android.com/topic/performance/reduce-apk-size.html" rel="noopener ugc nofollow" target="_blank"> <strong class="in hi">文档页面</strong> </a>、<a class="ae jj" href="https://www.youtube.com/watch?v=xctGIB81D2w" rel="noopener ugc nofollow" target="_blank"> <strong class="in hi">我的I/O talk </strong> </a>和<a class="ae jj" rel="noopener" href="/google-developers/smallerapk-part-1-anatomy-of-an-apk-da83c25e7003#.eoelcetv3"> <strong class="in hi">文章</strong> </a>，它们解释了如何使用多APK等技术来优化资源、缩减代码和定制您的apk到用户设备的交付。</p><p id="9d5a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这一切都很好，但用户通常会在每台设备上安装一次你的应用程序，然后通过Play Store下载定期更新，这就是为什么优化应用程序更新大小同样重要。</p></div><div class="ab cl jy jz go ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ha hb hc hd he"><h1 id="50dc" class="kf kg hh bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">针对应用更新大小进行优化</h1><p id="2305" class="pw-post-body-paragraph il im hh in b io ld iq ir is le iu iv iw lf iy iz ja lg jc jd je lh jg jh ji ha bi translated">让应用程序更新变得更小的最大好处是，大部分更新都是自动进行的。感谢<a class="ae jj" href="https://android-developers.googleblog.com/2016/11/understanding-apk-packaging-in-android-studio-2-2.html" rel="noopener ugc nofollow" target="_blank"> <strong class="in hi">对Android Studio打包apk</strong></a>的方式进行了改进，以使后续版本尽可能彼此相似，Play Store可以计算更小的增量更新。此外，Play Store中引入的新算法，如<a class="ae jj" href="https://android-developers.googleblog.com/2016/12/saving-data-reducing-the-size-of-app-updates-by-65-percent.html" rel="noopener ugc nofollow" target="_blank"> <strong class="in hi">最近的逐文件修补</strong> </a>，有助于将应用更新大小平均减少65%。</p><blockquote class="li lj lk"><p id="8100" class="il im ll in b io ip iq ir is it iu iv lm ix iy iz ln jb jc jd lo jf jg jh ji ha bi translated">要记住的重要一点是不要干扰我们在Android Studio和Play中已有的机制。</p><p id="c2c6" class="il im ll in b io ip iq ir is it iu iv lm ix iy iz ln jb jc jd lo jf jg jh ji ha bi translated">如果你使用最新的(至少2.2+版本)Android Studio/Android Gradle插件来构建你的发布版APK，并且之后不做修改，你应该可以使用了。</p><p id="4c4c" class="il im ll in b io ip iq ir is it iu iv lm ix iy iz ln jb jc jd lo jf jg jh ji ha bi translated">不要使用自定义的ZIP编码器设置来压缩APK，也不要使用Zopfli 来再压缩你的APK，否则你会错过逐文件更新带来的巨大节省。</p></blockquote></div><div class="ab cl jy jz go ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ha hb hc hd he"><h1 id="6c44" class="kf kg hh bd kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc bi translated">跟踪APK和更新大小</h1><p id="df70" class="pw-post-body-paragraph il im hh in b io ld iq ir is le iu iv iw lf iy iz ja lg jc jd je lh jg jh ji ha bi translated">现在你知道为什么和如何做正确的事情，有没有一个简单的方法来跟踪你的APK大小？在这个过程中，你会对你的应用程序进行修改，修复错误，引入新功能，添加资源和库，这是很正常的。如何预测你的用户下一次更新会有多大？</p><figure class="lq lr ls lt fd ii er es paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="er es lp"><img src="../Images/a12a54ba47ca0e744791c384897119d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GshNDJ46bb9W9m9qPV63sQ.png"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx">Google Play showing update size</figcaption></figure><p id="f2d9" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我们用几种方式来表达这些信息。首先，这也是用户会看到的，Play Store <a class="ae jj" href="https://android-developers.googleblog.com/2016/07/improvements-for-smaller-app-downloads.html" rel="noopener ugc nofollow" target="_blank"> <strong class="in hi">在Android上的应用程序列表页面上显示下载大小</strong> </a>，这成为已经安装了你的应用程序的用户的更新大小。</p><h2 id="d851" class="mc kg hh bd kh md me mf kl mg mh mi kp iw mj mk kt ja ml mm kx je mn mo lb mp bi translated">APK斑块大小估计量</h2><p id="0292" class="pw-post-body-paragraph il im hh in b io ld iq ir is le iu iv iw lf iy iz ja lg jc jd je lh jg jh ji ha bi translated">对于开发者来说，能够在发布之前看到这个数字会更理想，这就是为什么我们开源了一个叫做<a class="ae jj" href="https://github.com/googlesamples/apk-patch-size-estimator" rel="noopener ugc nofollow" target="_blank"> <strong class="in hi"> APK补丁大小估计器</strong> </a>的工具。</p><p id="6968" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">它是一个命令行工具，因此您可以将它集成到您的持续集成服务器中并解析输出以包含在您的报告中，或者通过给它两个apk来手动调用它，如下所示:</p><pre class="lq lr ls lt fd mq mr ms mt aw mu bi"><span id="0db1" class="mc kg hh mr b fi mv mw l mx my">python apk_patch_size_estimator.py --old-file old.apk --new-file new.apk</span></pre><p id="a147" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">下面是一个输出示例:</p><pre class="lq lr ls lt fd mq mr ms mt aw mu bi"><span id="2efb" class="mc kg hh mr b fi mv mw l mx my">New APK size on disk: 18,271,850 bytes [17.4MB]</span><span id="9545" class="mc kg hh mr b fi mz mw l mx my">Estimated download size for new installs:<br/>   Full new APK (gzipped) size: 16,339,603 bytes [15.6MB]</span><span id="2443" class="mc kg hh mr b fi mz mw l mx my">Estimated download size for updates from the old APK, using Bsdiff:<br/>   Bsdiff patch (gzipped) size: 2,989,691 bytes [2.85MB]</span><span id="5f72" class="mc kg hh mr b fi mz mw l mx my">Estimated download size for updates from the old APK,<br/> using File-by-File:<br/>   File-by-File patch (gzipped) size: 1,912,751 bytes [1.82MB]</span></pre><p id="89e4" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">APK补丁大小估算器实现了Play Store使用的当前压缩和增量算法，并将为您提供新安装的初始APK下载大小(它不同于原始APK大小，因为Play Store可能会应用额外的压缩)和增量补丁下载大小的估算。<strong class="in hi">我们最近更新了工具，以支持新的逐文件更新</strong>，因此您也可以获得一个估计值。</p><p id="fd27" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">为什么是估计而不是确切的数字？Play Store一直在发展，我们经常测试新的压缩方法，这些方法可能会为我们的用户节省数据。我们的目标是让APK补丁大小估计器与任何新方法保持同步。</p></div><div class="ab cl jy jz go ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ha hb hc hd he"><p id="6abd" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">顺便说一下，值得一提的是，对于想要了解应用程序的哪些部分在版本之间变大(或变小)的开发人员来说，Android Studio中的APK分析器中还有一个交互式的<strong class="in hi"> </strong> <a class="ae jj" href="https://developer.android.com/studio/build/apk-analyzer.html#compare_apk_files" rel="noopener ugc nofollow" target="_blank"> <strong class="in hi">【比较】工具</strong> </a>。</p><figure class="lq lr ls lt fd ii er es paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="er es na"><img src="../Images/9fbb37630679b478aa0e5d9a0274b60d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2yKCVrQKFmlRI5EV."/></div></div></figure><p id="c39d" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在Android Studio 3.0中，我们已经更新了该工具，可以选择显示逐文件的更新大小。</p></div></div>    
</body>
</html>