<html>
<head>
<title>A first look at OCI Network Security Groups</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">OCI网络安全组织初探</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/a-first-look-at-oci-network-security-groups-7409b682c031?source=collection_archive---------4-----------------------#2019-07-11">https://medium.com/oracledevs/a-first-look-at-oci-network-security-groups-7409b682c031?source=collection_archive---------4-----------------------#2019-07-11</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="f6cf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">OCI平台提供商<code class="du jc jd je jf b">terraform-provider-oci v3.33.0</code>引入对<strong class="ig hi">网络安全组织</strong>的支持。在我看来，这是如何在您的平台配置中定义<a class="ae jg" href="https://www.oracle.com/cloud/what-is-iaas/" rel="noopener ugc nofollow" target="_blank"> IaaS </a>安全规则的游戏规则改变者。</p><div class="jh ji ez fb jj jk"><a href="https://docs.cloud.oracle.com/iaas/Content/Network/Concepts/networksecuritygroups.htm" rel="noopener  ugc nofollow" target="_blank"><div class="jl ab dw"><div class="jm ab jn cl cj jo"><h2 class="bd hi fi z dy jp ea eb jq ed ef hg bi translated">网络安全组</h2><div class="jr l"><h3 class="bd b fi z dy jp ea eb jq ed ef dx translated">了解如何使用网络安全组在数据包级别控制特定虚拟网卡组的流量。</h3></div><div class="js l"><p class="bd b fp z dy jp ea eb jq ed ef dx translated">docs.cloud.oracle.com</p></div></div><div class="jt l"><div class="ju l jv jw jx jt jy jz jk"/></div></div></a></div><p id="0324" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用当前的VCN安全列表，安全规则将应用于使用该安全列表的子网内的所有<strong class="ig hi"> <em class="ka">实例虚拟网卡。相比之下，网络安全组安全规则适用于整个VCN中定义的vNIC子集，而不管vNIC位于哪个子网。安全上下文与网络拓扑的这种分离允许更细粒度的安全控制。</em></strong></p><p id="69d7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="ka">对于即将使用</em> <strong class="ig hi"> <em class="ka"> Oracle云基础架构经典版、</em> </strong> <em class="ka">的用户来说，这有点类似于定义IP网络虚拟网卡集</em></p><p id="fdf3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们考虑几个可以使用新网络安全组的潜在使用案例:</p><p id="1d2b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">将数据库和应用层实例整合到一个子网中</strong>。一种常见的安全体系结构最佳实践是将数据库和应用程序层的访问分成单独的数据库和应用程序子网，并使用子网安全列表来控制两者之间允许的流量。通过网络安全组，数据库和应用程序实例可以部署在同一个<strong class="ig hi"><em class="ka"/></strong>子网中，同时维护不同的安全规则集。</p><p id="c24d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">跨子网的细粒度访问控制</strong>。即使应用程序架构在数据库和应用层之间保持网络隔离，网络安全组也可以确保只允许需要直接访问特定数据库实例的应用程序层实例的子集，防止不属于安全上下文的其他应用程序层实例访问数据库。</p><p id="c2cd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">跨所有子网的通用实例类型的单个安全组</strong>。如果您混合使用Windows和Linux服务器，您可以定义一个Windows特定的网络安全组，以支持对Windows特定端口(如WinRM)的访问，这些端口只能应用于Windows实例，而不管它们部署在哪个子网中。同一子网中(而不是安全组中)的任何Linux实例都不会启用Windows特定的端口访问。</p><p id="14a4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">将特定于应用的安全规则从基础设施中分离出来</strong>。使用网络安全组可以消除基线网络供应和应用程序资源供应之间的紧密耦合。模块，甚至单独的配置，可以在现有网络上覆盖应用特定的安全规则，而不需要修改基线网络安全列表和子网资源。</p><h1 id="bbd2" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated"><strong class="ak">使用Terraform配置网络安全组</strong></h1><p id="989d" class="pw-post-body-paragraph ie if hh ig b ih kz ij ik il la in io ip lb ir is it lc iv iw ix ld iz ja jb ha bi translated">使用新的网络安全组资源非常简单。我们从创建<code class="du jc jd je jf b"><a class="ae jg" href="https://www.terraform.io/docs/providers/oci/r/core_network_security_group.html" rel="noopener ugc nofollow" target="_blank"><strong class="ig hi">oci_core_network_security_group</strong></a></code>资源开始。</p><pre class="le lf lg lh fd li jf lj lk aw ll bi"><span id="f288" class="lm kc hh jf b fi ln lo l lp lq">resource "<strong class="jf hi">oci_core_network_security_group</strong>" "example" {<br/>  compartment_id = var.compartment_id<br/>  vcn_id         = oci_core_vcn.vcn1.id<br/>  display_name   = "Example Security Group"<br/>}</span></pre><p id="fb3b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们现在可以向安全组添加一个或多个安全规则。与VCN安全列表规则不同，每个网络安全组安全规则都被定义为单独的<code class="du jc jd je jf b"><a class="ae jg" href="https://www.terraform.io/docs/providers/oci/r/core_network_security_group_security_rule.html" rel="noopener ugc nofollow" target="_blank"><strong class="ig hi">oci_core_network_security_group_security_rule</strong></a></code> <strong class="ig hi"> </strong>资源。</p><pre class="le lf lg lh fd li jf lj lk aw ll bi"><span id="e087" class="lm kc hh jf b fi ln lo l lp lq">resource "<strong class="jf hi">oci_core_network_security_group_security_rule</strong>" "https" {<br/>  network_security_group_id = oci_core_network_security_group.example.id<br/><br/>  description = "HTTPS"<br/>  direction   = "INGRESS"<br/>  protocol    = 6<br/>  source_type = "CIDR_BLOCK"<br/>  source      = "0.0.0.0/0"</span><span id="256b" class="lm kc hh jf b fi lr lo l lp lq">  tcp_options {<br/>    destination_port_range {<br/>      min = 443<br/>      max = 443<br/>    }<br/>  }<br/>}</span></pre><p id="6a89" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">值得强调的是，除了为网络或服务CIDR设置规则<code class="du jc jd je jf b">source</code>(或出口规则<code class="du jc jd je jf b">destination</code>)之外，网络安全组安全规则还有一些独特的功能，允许规则控制同一VCN中两个独立网络安全组之间的流量，或规则自己的网络安全组控制同一组内vNICs之间的流量。</p><p id="858b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，我们通过在实例资源或辅助vNIC的vNIC附件资源的<code class="du jc jd je jf b">create_vnic_details</code>中添加<code class="du jc jd je jf b"><a class="ae jg" href="https://www.terraform.io/docs/providers/oci/r/core_instance.html#nsg_ids" rel="noopener ugc nofollow" target="_blank"><strong class="ig hi">nsg_ids</strong></a></code>属性，将网络安全组与实例的特定vNIC相关联。</p><pre class="le lf lg lh fd li jf lj lk aw ll bi"><span id="8b03" class="lm kc hh jf b fi ln lo l lp lq">resource "<strong class="jf hi">oci_core_instance</strong>" "instance1" {<br/>  availability_domain = local.availability_domain<br/>  compartment_id      = var.compartment_id<br/>  display_name        = "instance1"<br/>  ...</span><span id="01f1" class="lm kc hh jf b fi lr lo l lp lq"><strong class="jf hi">  create_vnic_details</strong> {<br/>    subnet_id        = oci_core_subnet.vcn1_subnet1.id<br/>    assign_public_ip = true<br/>    hostname_label   = "instance1"<br/>    <strong class="jf hi">nsg_ids</strong> = [<br/>      <strong class="jf hi">oci_core_network_security_group.example.id</strong><br/>    ]<br/>  }<br/>}</span></pre><p id="53d7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> <em class="ka">注意</em> </strong> <em class="ka">:根据所使用的基本操作系统，可能需要适当修改本地实例防火墙规则，以允许安全规则启用的接口/端口上的流量。</em></p><p id="07e9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">可以将新的网络安全组添加到现有接口，而无需强制重新配置实例。</p><h2 id="fd55" class="lm kc hh bd kd ls lt lu kh lv lw lx kl ip ly lz kp it ma mb kt ix mc md kx me bi translated">限制</h2><p id="c4c2" class="pw-post-body-paragraph ie if hh ig b ih kz ij ik il la in io ip lb ir is it lc iv iw ix ld iz ja jb ha bi translated">永远知道自己的极限。此处介绍了网络安全组资源的注意限制<a class="ae jg" href="https://docs.cloud.oracle.com/iaas/Content/Network/Concepts/securityrules.htm#limits" rel="noopener ugc nofollow" target="_blank">。总而言之:</a></p><ul class=""><li id="a611" class="mf mg hh ig b ih ii il im ip mh it mi ix mj jb mk ml mm mn bi translated">您可以在VCN定义多达<strong class="ig hi"> 1000 </strong>个网络安全组</li><li id="143d" class="mf mg hh ig b ih mo il mp ip mq it mr ix ms jb mk ml mm mn bi translated">您可以在一个网络安全组中定义多达<strong class="ig hi"> 120 </strong>条安全规则</li><li id="0aaa" class="mf mg hh ig b ih mo il mp ip mq it mr ix ms jb mk ml mm mn bi translated">单个虚拟网卡最多可以加入<strong class="ig hi"> 5个</strong>网络安全组</li></ul><h1 id="1d91" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">相关链接</h1><div class="jh ji ez fb jj jk"><a href="https://docs.cloud.oracle.com/iaas/Content/Network/Concepts/securityrules.htm" rel="noopener  ugc nofollow" target="_blank"><div class="jl ab dw"><div class="jm ab jn cl cj jo"><h2 class="bd hi fi z dy jp ea eb jq ed ef hg bi translated">安全规则</h2><div class="jr l"><h3 class="bd b fi z dy jp ea eb jq ed ef dx translated">了解如何使用安全规则在数据包级别控制VCN资源的流量。</h3></div><div class="js l"><p class="bd b fp z dy jp ea eb jq ed ef dx translated">docs.cloud.oracle.com</p></div></div><div class="jt l"><div class="mt l jv jw jx jt jy jz jk"/></div></div></a></div></div></div>    
</body>
</html>