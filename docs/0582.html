<html>
<head>
<title>Configuring your app for Play Feature Delivery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为播放功能交付配置您的应用</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/configuring-your-app-for-play-feature-delivery-f15a93856a0d?source=collection_archive---------7-----------------------#2020-11-10">https://medium.com/androiddevelopers/configuring-your-app-for-play-feature-delivery-f15a93856a0d?source=collection_archive---------7-----------------------#2020-11-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/78243efcf455993e6100439f3f7a559a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v7S7LKg4TlrMRlneeP224Q.jpeg"/></div></div></figure><div class=""/><blockquote class="ip iq ir"><p id="1393" class="is it iu iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><strong class="iv ht">本文以视频形式提供，并在帖子末尾有链接。</strong></p></blockquote><p id="b8a1" class="pw-post-body-paragraph is it hs iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated"><a class="ae ju" href="https://developer.android.com/platform/technology/app-bundle" rel="noopener ugc nofollow" target="_blank"> Android应用捆绑包</a>是在<a class="ae ju" href="http://d.android.com/mad" rel="noopener ugc nofollow" target="_blank">现代Android开发</a>世界中Android应用的发布格式。</p><p id="0027" class="pw-post-body-paragraph is it hs iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">与通用apk相比，使用它的应用程序在用户设备上平均节省了15 %的文件大小。您可以从这些节省和简化的版本中受益，而不必对您的应用程序代码进行任何更改，只需切换到Android应用程序捆绑包即可。</p><blockquote class="ip iq ir"><p id="4bd8" class="is it iu iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">要了解更多关于如何构建你的第一个Android应用捆绑包的信息，请阅读本系列的前一篇文章<a class="ae ju" rel="noopener" href="/androiddevelopers/building-your-first-app-bundle-bbcd228bf631">。</a></p></blockquote><p id="012b" class="pw-post-body-paragraph is it hs iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">但是你可以把事情掌握在你自己的手中，使用<a class="ae ju" href="https://developer.android.com/guide/app-bundle/play-feature-delivery" rel="noopener ugc nofollow" target="_blank"> Play Feature Delivery </a>进一步模块化和优化安装。</p><h1 id="6c19" class="jv jw hs bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">为什么要在意一个模块化的app，玩功能交付？</h1><p id="a23d" class="pw-post-body-paragraph is it hs iv b iw kt iy iz ja ku jc jd jr kv jg jh js kw jk jl jt kx jo jp jq ha bi translated">模块化的应用程序将在应用程序的不同部分之间建立清晰的界限。这在多个层面上都有好处。</p><p id="eb4f" class="pw-post-body-paragraph is it hs iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">在许多情况下，你只需要重新构建你的应用程序的一部分。这使得构建时间减少。随着构建时间的减少和模块间界限的清晰，工程速度可能会提高。</p><p id="f5a6" class="pw-post-body-paragraph is it hs iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">此外，在谷歌Play商店，我们已经看到</p><blockquote class="ky"><p id="f70c" class="kz la hs bd lb lc ld le lf lg lh jq dx translated"><strong class="ak">将应用程序的初始下载大小减少3 MB可以导致安装量增加约1 %。</strong></p></blockquote><p id="3589" class="pw-post-body-paragraph is it hs iv b iw li iy iz ja lj jc jd jr lk jg jh js ll jk jl jt lm jo jp jq ha bi translated">在本帖中，您将了解Android应用捆绑包的功能，这些功能支持Play功能交付。这些功能使你能够进一步缩小应用程序的大小。我还将向您介绍可以用来有条件地或按需交付特性的API，以及多种配置选项。</p><p id="9605" class="pw-post-body-paragraph is it hs iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">您可以使用Android Studio带您浏览“新模块”流程。但是，当您浏览流程时，我们将深入了解一下，您稍后可以如何更改配置。</p><h1 id="8111" class="jv jw hs bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">建立基线</h1><p id="87c0" class="pw-post-body-paragraph is it hs iv b iw kt iy iz ja ku jc jd jr kv jg jh js kw jk jl jt kx jo jp jq ha bi translated">当开始使用功能模块模块化应用程序时，你的基线是<strong class="iv ht">安装时间模块</strong>。在这里，你已经能够获得好处，如提高建造速度和工程速度。</p><p id="8083" class="pw-post-body-paragraph is it hs iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">安装时模块的基本配置如下所示:</p><figure class="ln lo lp lq fd hj"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="e22a" class="pw-post-body-paragraph is it hs iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">最重要的部分是发行版名称空间、<code class="du lt lu lv lw b">xmlns:dist="<a class="ae ju" href="http://schemas.android.com/apk/distribution" rel="noopener ugc nofollow" target="_blank">http://schemas.android.com/apk/distribution</a>"</code>和要设置为<code class="du lt lu lv lw b">install-time</code>的<code class="du lt lu lv lw b">delivery</code>配置属性。</p><p id="9b25" class="pw-post-body-paragraph is it hs iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">当请求初始安装时，这样配置的模块将被安装在设备上。</p><p id="1453" class="pw-post-body-paragraph is it hs iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">默认情况下，每个<code class="du lt lu lv lw b">install-time</code>模块将被融合到基本模块中，这使得它们<em class="iu">不可移除</em>。如果您希望以后能够删除一个安装时模块，您所要做的就是将<code class="du lt lu lv lw b">removable</code>属性的值设置为<code class="du lt lu lv lw b">true</code>。</p><p id="e88b" class="pw-post-body-paragraph is it hs iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">卸载模块对于教程、注册流程或其他具有较大内存占用量的模块非常有用，您希望这些模块在初始安装时可用，但一旦流程完成，这些模块可能就不再有用了。</p><p id="107d" class="pw-post-body-paragraph is it hs iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">我们提供了<a class="ae ju" href="https://developer.android.com/guide/playcore" rel="noopener ugc nofollow" target="_blank"> PlayCore API </a>来请求模块的安装和卸载，我将在这篇文章的后面介绍它。</p><h2 id="9ab7" class="lx jw hs bd jx ly lz ma kb mb mc md kf jr me mf kj js mg mh kn jt mi mj kr mk bi translated">Android Lollipop 5.0之前的设备注意事项</h2><p id="37d0" class="pw-post-body-paragraph is it hs iv b iw kt iy iz ja ku jc jd jr kv jg jh js kw jk jl jt kx jo jp jq ha bi translated">启用功能模块安装的机制要求设备运行Android Lollipop 5.0或更高版本。对于旧版本的Android，功能模块的内容可以放在基础apk中。要显式启用这一功能，您需要在模块标记内将fusing的include值设置为true。</p><pre class="ln lo lp lq fd ml lw mm mn aw mo bi"><span id="99e6" class="lx jw hs lw b fi mp mq l mr ms">&lt;dist:fusing dist:include=”true”&gt;</span></pre><h1 id="edf6" class="jv jw hs bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">有条件交货设置</h1><p id="dbe9" class="pw-post-body-paragraph is it hs iv b iw kt iy iz ja ku jc jd jr kv jg jh js kw jk jl jt kx jo jp jq ha bi translated">除了安装时间交付，有条件交付是请求功能模块的另一种方式。安装可能取决于设备的API级别、用户的国家或设备的功能。</p><p id="7aa1" class="pw-post-body-paragraph is it hs iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">这是一个完全配置的AndroidManifest的样子。</p><figure class="ln lo lp lq fd hj"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="3de9" class="pw-post-body-paragraph is it hs iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">并非所有这些条件都必须设置，也不太可能在一个模块中使用所有这些条件。让我们一步一步来看。</p><p id="045a" class="pw-post-body-paragraph is it hs iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">要设置有条件交付，请添加<code class="du lt lu lv lw b">dist:conditions</code>标签。</p><p id="a5cc" class="pw-post-body-paragraph is it hs iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">然后，您可以通过使用<code class="du lt lu lv lw b">min-api</code>和<code class="du lt lu lv lw b">max-api</code>来声明API级别的上限和下限。</p><p id="84eb" class="pw-post-body-paragraph is it hs iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">当您拥有特定API级别的特定模块时，这些是很有帮助的。</p><p id="fc08" class="pw-post-body-paragraph is it hs iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">此外，AndroidManifest中的每个<a class="ae ju" href="https://developer.android.com/guide/topics/manifest/uses-feature-element" rel="noopener ugc nofollow" target="_blank"> <em class="iu"> uses-feature </em>元素</a>都可以用作安装条件。使用<code class="du lt lu lv lw b">device-feature</code>属性，您可以确保只有当用户的设备具备使用某个功能的技术能力时，该功能才会交付给用户。</p><p id="6e96" class="pw-post-body-paragraph is it hs iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">虽然默认情况下，每个用户都可以在任何有应用程序的地方下载所有功能，但您可以选择仅在某些国家提供某些功能。这是本地化你的应用程序的好方法。<br/>为此，添加<code class="du lt lu lv lw b">user-countries</code>标签，然后添加给定国家的两个字母的国家代码。</p><p id="a7d3" class="pw-post-body-paragraph is it hs iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">当您希望某项功能<strong class="iv ht">在特定国家/地区</strong>不可用时，请确保设置<code class="du lt lu lv lw b">dist:exclude=”false”</code>。如果您希望某个特性<strong class="iv ht">仅在</strong>可用，则将该值设置为<code class="du lt lu lv lw b">true</code>。</p><h1 id="976e" class="jv jw hs bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">没有代码的模块</h1><p id="2743" class="pw-post-body-paragraph is it hs iv b iw kt iy iz ja ku jc jd jr kv jg jh js kw jk jl jt kx jo jp jq ha bi translated">有时，您所拥有的只是您想要交付给用户的大资产，例如TensorFlow模型。如果没有与特性模块相关联的代码，确保在模块的AndroidManifest文件中将<code class="du lt lu lv lw b">hasCode</code>设置为<code class="du lt lu lv lw b">false</code>。</p><pre class="ln lo lp lq fd ml lw mm mn aw mo bi"><span id="c797" class="lx jw hs lw b fi mp mq l mr ms">&lt;application android:hasCode="false" /&gt;</span></pre><p id="a0bb" class="pw-post-body-paragraph is it hs iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">这将让编译器知道<strong class="iv ht">不应该创建任何dex文件</strong>。</p><blockquote class="ky"><p id="0531" class="kz la hs bd lb lc ld le lf lg lh jq dx translated">当模块中没有代码时，忽略将hasCode设置为false将导致运行时异常。</p></blockquote><h1 id="7dee" class="jv jw hs bd jx jy jz ka kb kc kd ke kf kg mt ki kj kk mu km kn ko mv kq kr ks bi translated">按需配置</h1><p id="2d2a" class="pw-post-body-paragraph is it hs iv b iw kt iy iz ja ku jc jd jr kv jg jh js kw jk jl jt kx jo jp jq ha bi translated">要掌握准确的安装时间，您可以使用<em class="iu">按需安装</em>。这意味着，在应用程序下载并安装到用户设备上之后，您可以调用API来安装模块<em class="iu">。<br/>使用按需安装可节省初始下载时间和大小。</em></p><p id="ed3b" class="pw-post-body-paragraph is it hs iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">在AndroidManifest中，您必须将交付选项设置为<code class="du lt lu lv lw b">on-demand</code>。然后你可以使用<a class="ae ju" href="https://developer.android.com/guide/playcore" rel="noopener ugc nofollow" target="_blank"> PlayCore API </a>在你的应用流程中下载、安装和卸载模块。</p><p id="c411" class="pw-post-body-paragraph is it hs iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">我建议你看看GitHub 上的<a class="ae ju" href="https://github.com/android/app-bundle-samples/tree/main/PlayCoreKtx" rel="noopener ugc nofollow" target="_blank"> PlayCoreKtx示例，以及下面链接的视频，了解Play Feature Delivery的点播交付部分的详细介绍。</a></p><p id="7663" class="pw-post-body-paragraph is it hs iv b iw ix iy iz ja jb jc jd jr jf jg jh js jj jk jl jt jn jo jp jq ha bi translated">快乐模块化！</p><h1 id="b320" class="jv jw hs bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">这是这篇文章的视频版本</h1><figure class="ln lo lp lq fd hj"><div class="bz dy l di"><div class="mw ls l"/></div></figure></div></div>    
</body>
</html>