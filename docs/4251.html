<html>
<head>
<title>Exploring Android Jetpack: Preferences</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索Android Jetpack:首选项</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/exploring-android-jetpack-preferences-8bcb0b7bdd14?source=collection_archive---------0-----------------------#2019-07-13">https://medium.com/google-developer-experts/exploring-android-jetpack-preferences-8bcb0b7bdd14?source=collection_archive---------0-----------------------#2019-07-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/94e6db2460f58c17e248ed1a9de39613.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SkUAPtbpjlcTvW6BBzwQ2A.png"/></div></div></figure><p id="9abf" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">设置屏幕为我们的用户提供了一种方式来配置我们的应用程序，以他们希望它的外观，感觉和行为。除此之外，它还是我们提供外部信息链接的好地方，比如隐私政策、开源许可等等。虽然我们可以自己构建这些屏幕，但对于看起来如此简单的需求，通常会有许多样板文件。我们不仅需要创建用户界面，还需要创建用于从应用程序首选项文件中读取和写入值的逻辑。</p><p id="5a18" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">幸运的是，Android Jetpack拥有所谓的<a class="ae jn" href="https://developer.android.com/jetpack/androidx/releases/preference" rel="noopener ugc nofollow" target="_blank">偏好库</a>。这为我们提供了一种方法，用开发人员最少的工作来创建我们的应用程序首选项。使用Android jetpack中的这一首选项功能不仅可以帮助您节省开发时间，还意味着我们的设置屏幕将具有一致的材质外观，并与我们应用程序的其余部分相结合。</p><p id="32f2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">让我们深入了解一下首选项，这样我们就可以看到哪些是可用的，以及如何将它实现到我们的应用程序中。</p><p id="f19c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">注:</strong>首选项库的当前版本是<strong class="ir hi">androidx . preference:preference:1 . 1 . 0-rc01</strong>。</p></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><h1 id="6a01" class="jv jw hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">设置偏好设置屏幕</h1><p id="3980" class="pw-post-body-paragraph ip iq hh ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">为了构建一个首选项屏幕，我们有一个首选项层次结构。这个层次结构用于定义不同的首选项属性，可以为我们的应用程序设置这些属性。有两种方法可以定义这个层次结构，编程或者在XML中。我们将设置加载到相应组件(比如一个片段)的方式将取决于我们最初如何定义我们的层次结构。</p><figure class="kz la lb lc fd ii er es paragraph-image"><div class="er es ky"><img src="../Images/74ce82fa42134942e2d075dad2f141c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/0*tUq8ZBR0WV6ytnTk"/></div></figure><p id="a1e4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">让我们从构建这个设置层次结构开始。如果我们要通过XML资源创建我们的首选项，那么我们需要在我们应用程序的<strong class="ir hi"> res/xml </strong>目录中定义一个新的<strong class="ir hi"> PreferenceScreen </strong>资源。在此范围内，我们可以定义希望在此屏幕上显示的不同首选项。</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="b77c" class="li jw hh le b fi lj lk l ll lm">&lt;androidx.preference.PreferenceScreen<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"&gt;</span><span id="e4dd" class="li jw hh le b fi ln lk l ll lm">&lt;/androidx.preference.PreferenceScreen&gt;</span></pre><p id="def5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在本文中，我们需要定义希望在首选项屏幕中显示的不同设置。如果我们以编程方式创建首选项，那么直接进入我们将用于屏幕的组件(片段)。</p><p id="9af0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，有许多不同类型的设置可以使用，但我们将从其中最简单的开始，它是一个简单的文本项。</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="c8af" class="li jw hh le b fi lj lk l ll lm">&lt;Preference<br/>	android:key="preference_key"<br/>	android:title="@string/preference_title"<br/>	android:summary="@string/preference_summary" /&gt;</span></pre><p id="3a1c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您会注意到，我们为首选项定义了三个属性:</p><ul class=""><li id="1962" class="lo lp hh ir b is it iw ix ja lq je lr ji ls jm lt lu lv lw bi translated"><strong class="ir hi">键</strong>:该键用于引用保存的偏好值。该键将用于保存和检索我们的首选项值</li><li id="f379" class="lo lp hh ir b is lx iw ly ja lz je ma ji mb jm lt lu lv lw bi translated"><strong class="ir hi">标题</strong>:用于显示首选项的标题</li><li id="313b" class="lo lp hh ir b is lx iw ly ja lz je ma ji mb jm lt lu lv lw bi translated"><strong class="ir hi">摘要</strong>:用于显示在首选项上的描述</li></ul><p id="22b7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">当显示在屏幕上时，我们会看到类似这样的东西:</p><figure class="kz la lb lc fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mc"><img src="../Images/8a03ddfaa6231cd788b29b109f68fbbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eJlz2jwYV8hbW3lT"/></div></div></figure><p id="f942" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果我们以编程方式创建首选项，那么我们通过实例化首选项类的一个新实例来实现这一点:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="bbd4" class="li jw hh le b fi lj lk l ll lm">val simplePreference = Preference(context).apply {<br/>    key = "simple_preference"<br/>    title = "Some title"<br/>    summary = "Some summary"<br/>}</span></pre><p id="c8cf" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这里我们可以看到我们的偏好<strong class="ir hi">标题</strong>以“基本偏好”的形式显示，以及显示在其下方的相应的<strong class="ir hi">摘要</strong>，“这是一个摘要”。我们可以利用首选项上的<strong class="ir hi">图标</strong>属性来扩展上述内容，这允许我们使用一个可绘制的引用来在首选项的开头显示一个图标:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="2e13" class="li jw hh le b fi lj lk l ll lm">&lt;Preference<br/>    android:key="preference_key"<br/>    android:title="@string/preference_title"<br/>    android:summary="@string/preference_summary"<br/>    android:icon="@drawable/ic_menu_camera" /&gt;</span></pre><figure class="kz la lb lc fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mc"><img src="../Images/a1be2d283f34beae748f3a6fe690e1b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*02UNaPd-4n6zJ_i6"/></div></div></figure><p id="18b6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果我们以编程方式创建首选项，那么我们通过用首选项类实例设置icon属性来实现这一点:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="0894" class="li jw hh le b fi lj lk l ll lm">val iconPreference = Preference(context).apply {<br/>    icon = ContextCompat.getDrawable(context, <br/>                R.drawable.ic_menu_camera)<br/>}</span></pre><p id="baed" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在某些情况下，我们的偏好标题可能会扩展到不止一行。这可能是在我们的用户在一个更小的设备上的情况下，他们的文本大小已经通过系统属性被放大，甚至我们的偏好标题太长了！</p><figure class="kz la lb lc fd ii er es paragraph-image"><div class="er es md"><img src="../Images/91ff5c6bb806d9ceaf6352340ffbe6a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/0*IBB0YGKzTnYc-3wu"/></div></figure><p id="ece7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这种情况下，我们可能希望将我们的设置标题固定为一行——这可以通过使用<strong class="ir hi"> singleLineTitle </strong>属性来完成:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="ff58" class="li jw hh le b fi lj lk l ll lm">&lt;Preference<br/>    android:key="single_line_title"<br/>    android:title="@string/title_single_line_title_preference"<br/>    android:summary="@string/summary_single_line_title_preference"<br/>    app:singleLineTitle="true" /&gt;</span></pre><figure class="kz la lb lc fd ii er es paragraph-image"><div class="er es me"><img src="../Images/5852a0c4afa870735747966934610ca9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/0*6ceXPyi_6AD10nhW"/></div></figure><p id="53de" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果我们是以编程方式创建这个首选项，那么我们可以再次为我们的首选项类的实例分配这个属性:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="4dd1" class="li jw hh le b fi lj lk l ll lm">val singleLinePreference = Preference(context).apply {<br/>    ...<br/>    isSingleLineTitle = true<br/>}</span></pre></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><h1 id="6f0d" class="jv jw hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">Widget首选项</h1><p id="606e" class="pw-post-body-paragraph ip iq hh ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">除了简单的文本首选项，Preferences API还为我们提供了一组基于小部件的首选项，可用于配置我们的应用程序中的不同设置项。这些通常是设置屏幕的基础，允许用户切换和选择应用程序提供的不同设置选项。</p><figure class="kz la lb lc fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mf"><img src="../Images/20cb3660c6cb0073a77ba5ee81aedf4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*DZeDUzqRgaa2UIfe"/></div></div></figure></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><h1 id="3827" class="jv jw hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">复选框首选项</h1><p id="acda" class="pw-post-body-paragraph ip iq hh ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">在某些情况下，我们希望显示一个首选项，允许用户选中和取消选中某个首选项，为此我们将使用<strong class="ir hi">复选框首选项</strong>项:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="af9b" class="li jw hh le b fi lj lk l ll lm">&lt;CheckBoxPreference<br/>    android:key="checkbox"<br/>    android:title="@string/title_checkbox_preference"<br/>    android:summary="@string/summary_checkbox_preference"/&gt;</span></pre><p id="4560" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">正如您从上面看到的，与我们原来的首选项相比，没有额外的属性，不同之处在于首选项在布局的开始处显示了一个复选框。为该键获取的值将作为启用或禁用状态返回给我们。</p><figure class="kz la lb lc fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mc"><img src="../Images/72d96e040b8c7d39f0e5bb60292acd8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IWb-RKo8mizWt7Lg"/></div></div></figure><p id="dbf5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果我们以编程方式创建复选框，那么我们通过实例化CheckBoxPreference类的新实例来实现这一点:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="50ee" class="li jw hh le b fi lj lk l ll lm">val checkBoxPreference = CheckBoxPreference(context).<em class="mg">apply </em><strong class="le hi">{</strong><br/><em class="mg">    key </em>= "checkbox"<br/><em class="mg">    title </em>= "Checkbox"<br/><em class="mg">    summary </em>= "This one has a checkbox"<br/><strong class="le hi">}</strong></span></pre></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><h1 id="8d59" class="jv jw hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">切换偏好</h1><p id="0753" class="pw-post-body-paragraph ip iq hh ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">类似于复选框，我们有<strong class="ir hi">switchpreferencecompt</strong>项。同样，不需要额外的属性来配置开关设置项目的显示。与CheckBox项类似，为这个键获取的值将作为启用或禁用状态返回给我们。</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="d54d" class="li jw hh le b fi lj lk l ll lm">&lt;SwitchPreferenceCompat<br/>    android:key="switch"<br/>    android:title="@string/title_switch_preference"<br/>    android:summary="@string/summary_switch_preference"/&gt;</span></pre><figure class="kz la lb lc fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mh"><img src="../Images/2318fd224c73dfa8e43460a44cd16662.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*GRFC5D5Su64ecs7w"/></div></div></figure><p id="121c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果我们以编程方式创建开关，那么我们通过实例化SwitchPreferenceCompat类的新实例来实现这一点:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="1815" class="li jw hh le b fi lj lk l ll lm">val switchPreference = SwitchPreferenceCompat(context).<em class="mg">apply </em><strong class="le hi">{</strong><br/><em class="mg">    key </em>= "notifications"<br/><em class="mg">    title </em>= "Switch"<br/><em class="mg">    summary </em>= "This has a switch"<br/><strong class="le hi">}</strong></span></pre></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><h1 id="5c20" class="jv jw hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">下拉首选项</h1><p id="45d0" class="pw-post-body-paragraph ip iq hh ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">我们还可以访问所谓的<strong class="ir hi">drop down preference</strong>——这个首选项小部件允许我们显示可选项的下拉列表，供用户选择。</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="2735" class="li jw hh le b fi lj lk l ll lm">&lt;DropDownPreference<br/>    android:key="dropdown"<br/>    android:title="@string/title_dropdown_preference"<br/>    android:entries="@array/entries"<br/>    app:useSimpleSummaryProvider="true"<br/>    android:entryValues="@array/entry_values"/&gt;</span></pre><p id="1af6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">从上面可以看出，对于这个首选项小部件，我们需要一些额外的属性:</p><ul class=""><li id="6c13" class="lo lp hh ir b is it iw ix ja lq je lr ji ls jm lt lu lv lw bi translated"><strong class="ir hi">条目</strong>:这些是您希望显示的项目</li><li id="652b" class="lo lp hh ir b is lx iw ly ja lz je ma ji mb jm lt lu lv lw bi translated"><strong class="ir hi">useSimpleSummaryProvider</strong>—用于确定偏好摘要是否应该显示当前保存的项目</li><li id="8308" class="lo lp hh ir b is lx iw ly ja lz je ma ji mb jm lt lu lv lw bi translated"><strong class="ir hi"> entryValues </strong>:这些是用于可选条目的值。</li></ul><figure class="kz la lb lc fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mc"><img src="../Images/e797710261adc464917929e4817fd21a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8jxO-22Vnlr6Z7AW"/></div></div></figure><figure class="kz la lb lc fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mi"><img src="../Images/bf16088e6ab4d09728178c382cd03f9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*_y6QvQmdYXYHhCcJ"/></div></div></figure><p id="8e5c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在某些情况下，您可能希望为条目和entryValues提供相同的一组值。然而，拥有这些独立的属性为您提供了灵活性，当您需要您的值集与下拉列表本身中显示的值不同时。例如，显示的条目“条目1”实际上可能具有值“条目_1”。这对用户来说是不可见的，但更多的是作为一个内部值使用。</p><p id="020e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果我们以编程方式创建首选项，那么我们可以通过实例化DropDownPreference类的一个新实例来实现:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="a737" class="li jw hh le b fi lj lk l ll lm">val dropDownPreference = DropDownPreference(context).<em class="mg">apply </em><strong class="le hi">{</strong><br/><em class="mg">    key </em>= "drop_down"<br/><em class="mg">    title </em>= "Some title"<br/><em class="mg">    entries </em>= <em class="mg">arrayOf</em>("One", "Two", "Three")<br/><em class="mg">    entryValues </em>= <em class="mg">arrayOf</em>("1", "2", "3")<br/><strong class="le hi">}</strong></span></pre></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><h1 id="c1d4" class="jv jw hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">Seekbar首选项</h1><p id="ea24" class="pw-post-body-paragraph ip iq hh ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">我们的下一个小部件首选项是<strong class="ir hi"> SeekBarPreference </strong>，它允许我们的用户配置一个可查找的格式的设置，比如音量。</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="fb61" class="li jw hh le b fi lj lk l ll lm">&lt;SeekBarPreference<br/>    android:key="seekbar"<br/>    android:title="Seek bar!"<br/>    android:max="10"<br/>    android:defaultValue="5" /&gt;</span></pre><figure class="kz la lb lc fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mj"><img src="../Images/0e4315f498251e7622b5086318c95c13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*N7EDYmQlAQb3wtl2"/></div></div></figure><p id="dd09" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">对于seekbar，除了通常的键和标题之外，我们还可以设置一些其他属性。</p><ul class=""><li id="d572" class="lo lp hh ir b is it iw ix ja lq je lr ji ls jm lt lu lv lw bi translated"><strong class="ir hi">最大值</strong>:表示使用滚动条可以选择的最大值</li><li id="8a80" class="lo lp hh ir b is lx iw ly ja lz je ma ji mb jm lt lu lv lw bi translated"><strong class="ir hi"> defaultValue </strong>:表示未设置时/设置前seekbar上显示的默认值</li></ul><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="0e25" class="li jw hh le b fi lj lk l ll lm">val seekBarPreference = SeekBarPreference(context).apply {<br/>    key = "seekbar"<br/>    title = "Some title"<br/>    max = 10<br/>    setDefaultValue(5)<br/>}</span></pre></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><h1 id="02cb" class="jv jw hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">对话框首选项</h1><p id="79a0" class="pw-post-body-paragraph ip iq hh ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">首选项API为我们提供了设置项，这些设置项显示一个对话框，供用户输入首选项的一些数据。有三种类型的DialogPreference类可供我们使用——这是<strong class="ir hi"> EditTextPreference </strong>、<strong class="ir hi"> ListPreference </strong>和<strong class="ir hi">multiselectlist preference</strong>类:</p><figure class="kz la lb lc fd ii er es paragraph-image"><div class="er es mk"><img src="../Images/ca6c97355787ee66129663f5bb828b8f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/0*MDRZ1AOrNc9XK19s"/></div></figure><p id="b70e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">每个DialogPreference类都有一个属性集合，可以用来定制给定对话框显示的内容。</p><ul class=""><li id="40b8" class="lo lp hh ir b is it iw ix ja lq je lr ji ls jm lt lu lv lw bi translated"><strong class="ir hi">对话框标题</strong> —对话框显示的标题</li><li id="b5cc" class="lo lp hh ir b is lx iw ly ja lz je ma ji mb jm lt lu lv lw bi translated"><strong class="ir hi">对话框消息</strong> —对话框正文中使用的消息</li><li id="ca65" class="lo lp hh ir b is lx iw ly ja lz je ma ji mb jm lt lu lv lw bi translated"><strong class="ir hi">对话框</strong> —对话框中显示的图标</li><li id="8bc6" class="lo lp hh ir b is lx iw ly ja lz je ma ji mb jm lt lu lv lw bi translated"><strong class="ir hi"> dialogLayoutResource </strong> —用于对话框的自定义布局</li><li id="5317" class="lo lp hh ir b is lx iw ly ja lz je ma ji mb jm lt lu lv lw bi translated"><strong class="ir hi"> positiveButtonText </strong> —用于肯定按钮文本的字符串资源</li><li id="07b7" class="lo lp hh ir b is lx iw ly ja lz je ma ji mb jm lt lu lv lw bi translated"><strong class="ir hi"> negativeButtonText </strong> —用于负按钮文本的字符串资源</li></ul></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><h1 id="e1f0" class="jv jw hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">编辑文本首选项</h1><p id="dfd3" class="pw-post-body-paragraph ip iq hh ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">第一个是<strong class="ir hi"> EditTextPreference </strong>项——这允许我们的用户输入一些文本，保存为首选项的值。</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="3d37" class="li jw hh le b fi lj lk l ll lm">&lt;EditTextPreference<br/>    android:key="edittext"<br/>    android:title="Some input"<br/>    app:useSimpleSummaryProvider="true"<br/>    android:dialogTitle="This is the title"/&gt;</span></pre><p id="cabc" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">除了对话偏好项的公共属性之外，还有一个单独的属性可用于定制偏好项:</p><ul class=""><li id="ffd9" class="lo lp hh ir b is it iw ix ja lq je lr ji ls jm lt lu lv lw bi translated"><strong class="ir hi">useSimpleSummaryProvider</strong>—用于确定偏好摘要是否应该显示当前保存的项目</li></ul><p id="2d20" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">当选择该首选项时，将向用户显示一个对话框，输入要保存为首选项值的值。虽然不需要设置所有的DialogPreference属性，但是为这些属性提供的值允许您自定义对话框的外观。</p><figure class="kz la lb lc fd ii er es paragraph-image"><div class="er es ml"><img src="../Images/0819ea7a847635534d5a475ec070404d.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/0*RqCyt0bC89LsoekK"/></div></figure><p id="746b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果我们以编程方式创建我们的首选项，那么我们可以像这样创建一个EditTextPreference项:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="c3e5" class="li jw hh le b fi lj lk l ll lm">val editTextPreference = EditTextPreference(context).apply {<br/>    key = "edit_text"<br/>    title = "Some title"<br/>}</span></pre><p id="33a9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">一旦我们在类中定义了EditTextPreference，我们还可以使用<strong class="ir hi">setonbindittextlistener</strong>方法在其上设置一个绑定侦听器。这允许我们监听何时向用户显示编辑文本首选项的对话框(通过单击首选项)。</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="83b6" class="li jw hh le b fi lj lk l ll lm">editTextPreference.setOnBindEditTextListener {<br/>   ...<br/>}</span></pre></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><h1 id="0107" class="jv jw hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">列表首选项</h1><p id="00dd" class="pw-post-body-paragraph ip iq hh ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">接下来是ListPreference项——它向用户显示一个预定义的项列表，允许用户选择一个项作为首选项值。</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="136e" class="li jw hh le b fi lj lk l ll lm">&lt;ListPreference<br/>    android:key="list"<br/>    android:title="Some list"<br/>    app:useSimpleSummaryProvider="true"<br/>    android:entries="@array/list_preference_entries"<br/>    android:entryValues="@array/list_preference_entry_values" /&gt;</span></pre><figure class="kz la lb lc fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mc"><img src="../Images/97ffc181d1d0eaaa0bb300ba23997fa0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*bfKnIsjIdhSFRetL"/></div></div></figure><p id="7aef" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">对于列表首选项，有几个属性可用于配置列表:</p><ul class=""><li id="8db7" class="lo lp hh ir b is it iw ix ja lq je lr ji ls jm lt lu lv lw bi translated"><strong class="ir hi">条目</strong> —这些是您希望显示的项目</li><li id="9e6b" class="lo lp hh ir b is lx iw ly ja lz je ma ji mb jm lt lu lv lw bi translated"><strong class="ir hi">useSimpleSummaryProvider</strong>—用于确定首选项摘要是否应显示当前保存的项目</li><li id="a5d0" class="lo lp hh ir b is lx iw ly ja lz je ma ji mb jm lt lu lv lw bi translated"><strong class="ir hi"> entryValues </strong> —这些是用于可选条目的值。</li></ul><p id="7683" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果我们以编程的方式创建我们的首选项，那么我们可以像这样创建一个ListPreference项:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="2ab0" class="li jw hh le b fi lj lk l ll lm">val listPreference = ListPreference(context).apply {<br/>    key = "drop_down"<br/>    title = "Some title"<br/>    entries = arrayOf("One", "Two", "Three")<br/>    entryValues = arrayOf("1", "2", "3")<br/>}</span></pre><p id="4786" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最后，<strong class="ir hi">multiselectListPreference</strong>项的工作方式与list preference项类似。不同之处在于，用户可以选择多个列表值</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="40f3" class="li jw hh le b fi lj lk l ll lm">&lt;MultiSelectListPreference<br/>    android:key="multi_select_list"<br/>    android:title="Some multi select list"<br/>    android:summary="This is a summary"<br/>    android:entries="@array/list_preference_entries"<br/>    android:entryValues="@array/list_preference_entry_values"/&gt;</span></pre><figure class="kz la lb lc fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mc"><img src="../Images/40eb5c478d278ea7f790bf42de32e70c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lDfZG3optI_GzaOt"/></div></div></figure><ul class=""><li id="fa37" class="lo lp hh ir b is it iw ix ja lq je lr ji ls jm lt lu lv lw bi translated"><strong class="ir hi">对话框标题</strong> —显示在对话框上的标题</li><li id="70cf" class="lo lp hh ir b is lx iw ly ja lz je ma ji mb jm lt lu lv lw bi translated"><strong class="ir hi">条目</strong>:这些是您希望显示的项目</li><li id="731e" class="lo lp hh ir b is lx iw ly ja lz je ma ji mb jm lt lu lv lw bi translated"><strong class="ir hi">摘要</strong>:与设置一起显示的文本摘要</li><li id="807a" class="lo lp hh ir b is lx iw ly ja lz je ma ji mb jm lt lu lv lw bi translated"><strong class="ir hi">输入值</strong>:这些是用于可选输入的值。</li></ul><p id="d43e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">你会注意到这里的<strong class="ir hi">multiselectlist preference</strong>没有<strong class="ir hi">useSimpleSummaryProvider</strong>选项。相反，您必须利用<strong class="ir hi"> summary </strong>属性来提供一个与设置一起显示的摘要。</p><p id="3460" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">multiselectlist preference</strong>也可以以编程方式创建，如下所示:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="0816" class="li jw hh le b fi lj lk l ll lm">val multiSelectListPreference = MultiSelectListPreference(context).apply {<br/>    key = "multi_select_list"<br/>    title = "Some multi select list"<br/>    summary = "This is a summary"<br/>    entries = arrayOf("One", "Two", "Three")<br/>    entryValues = arrayOf("1", "2", "3")<br/>}</span></pre></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><h1 id="c401" class="jv jw hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">类别首选项</h1><p id="45da" class="pw-post-body-paragraph ip iq hh ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">更有可能的是，我们将会有偏好组——比如，偏好项目可以被分类到不同的组中。在这种情况下，将它们显示在各自的组中会有所帮助，以便为我们的用户进行分类——幸运的是，首选项API为我们提供了所谓的<strong class="ir hi">首选项类别</strong>，这使我们能够实现这一点。</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="e85b" class="li jw hh le b fi lj lk l ll lm">&lt;PreferenceCategory<br/>    android:title="Dialogs"&gt;</span><span id="fe1c" class="li jw hh le b fi ln lk l ll lm">&lt;/PreferenceCategory&gt;</span></pre><p id="5632" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">对于<strong class="ir hi">偏好类别</strong>，我们只需要定义一个标题，它将显示在我们分类设置的顶部。一旦我们在preferences XML文件中定义了这个<strong class="ir hi"> PreferenceCategory </strong>，我们只需要在其中播放相应的首选项。</p><figure class="kz la lb lc fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mc"><img src="../Images/4050b6714404ad53b5b57c3bf52ca7b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WLDZKrftvcQzq803"/></div></div></figure><p id="ec52" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">PreferenceCategory也可以通过编程方式创建，如下所示:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="215d" class="li jw hh le b fi lj lk l ll lm">val notificationCategory = PreferenceCategory(context).<em class="mg">apply </em><strong class="le hi">{</strong><br/><em class="mg">    key </em>= "notifications_category"<br/>    t<em class="mg">itle </em>= "Notifications"<br/><strong class="le hi">}</strong></span></pre></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><h1 id="b15b" class="jv jw hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">可扩展的首选项</h1><p id="d95a" class="pw-post-body-paragraph ip iq hh ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">在某些情况下，我们的应用程序中可能会显示一些部分设置的首选项集合，在这些情况下，我们可能希望允许我们的用户显示和隐藏这个集合。为此，我们可以利用<strong class="ir hi"> PreferenceCategory </strong>项，定义<strong class="ir hi">initialexpanddchildrencount</strong>属性。当这个属性被定义时，类别将在我们提供的初始计数之后折叠剩余的项目。如果在一个类别中有许多设置，那么这可以用于防止用户被显示的设置数量淹没</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="43ec" class="li jw hh le b fi lj lk l ll lm">&lt;PreferenceCategory<br/>    android:key="advanced"<br/>    android:title="Advanced stuff"<br/>    app:initialExpandedChildrenCount="1"&gt;</span><span id="885b" class="li jw hh le b fi ln lk l ll lm">&lt;/PreferenceCategory&gt;</span></pre><figure class="kz la lb lc fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mc"><img src="../Images/dc3aed19b5b017aceee53dee80a879c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rAmXdv6RBbc4JuMD"/></div></div></figure><p id="e16a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">因为我们在声明PreferenceCategory时使用了initialExpandedChildrenCount属性，所以只有第一项以展开状态显示。其余项目处于折叠状态，这意味着必须选择最后一个项目才能显示这些项目:</p><figure class="kz la lb lc fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mc"><img src="../Images/087d3aec1d382343dadf164c49befc40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*J_f5h5S8aCHroft6"/></div></div></figure><p id="dbf7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">此时，我们所有的首选项都展开了，并且对用户可见。当您可能有一组不是应用程序主要设置的首选项时，这种首选项配置非常有用——在这种情况下，可以折叠它们以避免屏幕膨胀和用户不知所措。</p><p id="8f61" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果我们以编程方式创建PreferenceCategory，那么我们仍然可以设置初始扩展计数属性:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="3d58" class="li jw hh le b fi lj lk l ll lm">val notificationCategory = PreferenceCategory(context).<em class="mg">apply </em><strong class="le hi">{</strong><br/><em class="mg">    key </em>= "notifications_category"<br/><em class="mg">    title </em>= "Notifications"<br/><em class="mg">    initialExpandedChildrenCount </em>= 1<br/>    addPreference(...)<br/>    addPreference(...)<br/>    addPreference(...)<br/><strong class="le hi">}</strong></span></pre></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><h1 id="8ee7" class="jv jw hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">显示我们的偏好</h1><p id="3b8c" class="pw-post-body-paragraph ip iq hh ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">为了在屏幕上向用户显示我们的偏好，我们需要创建一个新的<strong class="ir hi">PreferenceFragmentCompat</strong>类的实例。如果我们要从xml文件中创建我们的首选项，那么这将是一个非常简单的类。</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="f8bf" class="li jw hh le b fi lj lk l ll lm">class SettingsFragment : PreferenceFragmentCompat() {</span><span id="d372" class="li jw hh le b fi ln lk l ll lm">    override fun onCreatePreferences(savedInstanceState: Bundle?, rootKey: String?) {<br/>        setPreferencesFromResource(R.xml.<em class="mg">preferences</em>, rootKey)<br/>    }<br/>}</span></pre><p id="79b3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这个类中，您会注意到我们覆盖了一个onCreatePreferences方法——这是用来配置我们的首选项屏幕的。其中，我们利用setPreferencesFromResource方法来分配一个xml文件，该文件将用于配置我们的首选项。这里，我们定义的xml文件将被获取，它的内容将被用来构建在屏幕上显示给用户的首选项。</p><p id="80a7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这个片段中，您可能还希望以编程方式配置您的设置，而不是通过xml文件。在前面的部分中，我们概述了如何以编程方式创建设置项，所以让我们快速地看一下如何在我们的设置片段中应用这些设置项。我们首先利用PreferenceManager引用来创建一个首选项屏幕的实例。当通过xml创建时，所有这些配置都是为我们处理的，在编程首选项配置的情况下，我们需要自己设置这些东西。</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="1da9" class="li jw hh le b fi lj lk l ll lm">override fun onCreatePreferences(savedInstanceState: Bundle?, rootKey: String?) {</span><span id="6cb6" class="li jw hh le b fi ln lk l ll lm">    val context = preferenceManager.context<br/>    val screen = preferenceManager.createPreferenceScreen(context)<br/>    val notificationPreference = SwitchPreferenceCompat(context)<br/>    val feedbackPreference = Preference(context)</span><span id="ab10" class="li jw hh le b fi ln lk l ll lm">    screen.addPreference(notificationPreference)<br/>    screen.addPreference(feedbackPreference)<br/>    preferenceScreen = screen<br/>}</span></pre><p id="2d75" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这里，我们在首选项管理器实例上使用createPreferenceScreen()方法来实现这一点——这将返回一个首选项屏幕实例，我们将使用它来显示我们的设置。在向用户展示之前，我们需要添加设置项。该屏幕有一个addPreference()方法，它允许我们将每个设置项添加到屏幕上。在这里，我们需要为我们希望添加的任何设置项调用此方法—例如，我们在前面的部分中创建了它:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="3bba" class="li jw hh le b fi lj lk l ll lm">val notificationCategory = PreferenceCategory(context).apply <strong class="le hi">{</strong><br/>    key = "notifications_category"<br/>    title = "Notifications"<br/>    initialExpandedChildrenCount = 1<br/><strong class="le hi">}</strong></span></pre><p id="b0ee" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这里，我们将调用addPreference，传入我们的notificationCategory实例以将其添加到我们的首选项屏幕:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="5d61" class="li jw hh le b fi lj lk l ll lm">screen.addPreference(notificationPreference)</span></pre><p id="8000" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，我们已经为每个首选项完成了设置，我们可以通过将设置片段的preferenceScreen属性设置为我们之前创建的首选项屏幕的实例来结束设置</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="1cb2" class="li jw hh le b fi lj lk l ll lm">preferenceScreen = screen</span></pre><p id="996e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">此时，我们或者已经以编程方式添加了所有设置项，或者已经使用xml资源文件配置了首选项屏幕。现在我们有了我们的设置片段，我们需要将它显示给用户。为此，我们将创建一个活动来存放我们的片段，并设置我们的片段容器来显示我们的设置片段实例。</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="eb04" class="li jw hh le b fi lj lk l ll lm">class SettingsActivity : AppCompatActivity() {</span><span id="1dbd" class="li jw hh le b fi ln lk l ll lm">    override fun onCreate(savedInstanceState: Bundle?) {<br/>        super.onCreate(savedInstanceState)<br/>        setContentView(R.layout.<em class="mg">activity_settings</em>)</span><span id="fa47" class="li jw hh le b fi ln lk l ll lm">        <em class="mg">supportFragmentManager</em><br/>            .beginTransaction()<br/>            .replace(R.id.<em class="mg">settings_container</em>, SettingsFragment())<br/>            .commit()<br/>    }<br/>}</span></pre></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><h1 id="5aeb" class="jv jw hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">阅读偏好值</h1><p id="265f" class="pw-post-body-paragraph ip iq hh ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">在读取首选项值时，我们可以利用<a class="ae jn" href="https://developer.android.com/reference/androidx/preference/PreferenceManager#getDefaultSharedPreferences(android.content.Context)" rel="noopener ugc nofollow" target="_blank"> PreferenceManager </a>类来检索应用程序的默认共享首选项。在这里，我们可以通过使用在定义设置时分配给它的键来访问首选项值。</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="41c9" class="li jw hh le b fi lj lk l ll lm">val sharedPreferences =  <br/>    PreferenceManager.getDefaultSharedPreferences(activity_context)</span><span id="6c19" class="li jw hh le b fi ln lk l ll lm">val name = sharedPreferences.getString("signature", "")</span></pre><h1 id="e848" class="jv jw hh bd jx jy mm ka kb kc mn ke kf kg mo ki kj kk mp km kn ko mq kq kr ks bi translated">监听偏好更改事件</h1><p id="f756" class="pw-post-body-paragraph ip iq hh ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">我们可以使用<a class="ae jn" href="https://developer.android.com/reference/androidx/preference/Preference.OnPreferenceChangeListener.html" rel="noopener ugc nofollow" target="_blank">OnPreferenceChangeListener</a>在用户设置一个首选项值并准备持久化时接收回调。在这个回调函数中，我们需要返回一个布尔值，表明是否应该保存首选项值。</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="33bd" class="li jw hh le b fi lj lk l ll lm">override fun onPreferenceChange(<br/>    preference: Preference, <br/>    newValue: Any<br/>): Boolean {<br/>    return true<br/>}</span></pre><p id="742a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在我们监听这些事件之前，我们需要在所需的首选项上设置监听器:</p><pre class="kz la lb lc fd ld le lf lg aw lh bi"><span id="a5ad" class="li jw hh le b fi lj lk l ll lm">preference.onPreferenceChangeListener = this</span><span id="9140" class="li jw hh le b fi ln lk l ll lm">or</span><span id="f121" class="li jw hh le b fi ln lk l ll lm">preference.onPreferenceChangeListener = object :    <br/>    OnPreferenceChangeListener {<br/>...<br/>}</span></pre><p id="5e98" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们可以使用首选项库设置其他侦听器集合，在文档中阅读关于它们的更多信息<a class="ae jn" href="https://developer.android.com/reference/androidx/preference/package-summary.html" rel="noopener ugc nofollow" target="_blank">。</a></p></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><p id="dc93" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在本文中，我们学习了Preferences API中包含的不同组件，以及在创建我们自己的首选项屏幕时如何利用它们。虽然仍在alpha中，但Preference API的目标是在我们的应用程序中设置屏幕时，使开发过程更加简化。一旦首选项API处于稳定的位置，在我们的应用程序中为这种屏幕使用它似乎是显而易见的决定。</p><p id="91ba" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">你已经玩过Preference API了吗，或者你认为你的应用程序和团队会从它开始开发吗？请随时回复任何想法和/或问题</p><div class="mr ms ez fb mt mu"><a href="https://twitter.com/hitherejoe" rel="noopener  ugc nofollow" target="_blank"><div class="mv ab dw"><div class="mw ab mx cl cj my"><h2 class="bd hi fi z dy mz ea eb na ed ef hg bi translated">乔·伯奇(@hitherejoe) |推特</h2><div class="nb l"><h3 class="bd b fi z dy mz ea eb na ed ef dx translated">乔伯奇的最新推文(@hitherejoe)。Android Lead @Buffer。GDE为@Android、@actionsongoogle、@FlutterIO &amp;…</h3></div><div class="nc l"><p class="bd b fp z dy mz ea eb na ed ef dx translated">twitter.com</p></div></div><div class="nd l"><div class="ne l nf ng nh nd ni in mu"/></div></div></a></div></div></div>    
</body>
</html>