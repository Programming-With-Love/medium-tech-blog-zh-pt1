<html>
<head>
<title>A Better Way to Launch Activities on Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Android上开展活动的更好方式</h1>
<blockquote>原文：<a href="https://medium.com/capital-one-tech/a-better-way-to-launch-activities-on-android-8a1045181b16?source=collection_archive---------0-----------------------#2018-03-08">https://medium.com/capital-one-tech/a-better-way-to-launch-activities-on-android-8a1045181b16?source=collection_archive---------0-----------------------#2018-03-08</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="1301" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">单一责任+科特林！</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/58e9d9a78b26f369bf65478d105e67db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Me5882iiJl11JWCIUG9flA.png"/></div></div></figure><p id="9934" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">用<code class="du ke kf kg kh b">Intent</code>参数启动<code class="du ke kf kg kh b">Activity</code>对开发者来说不是一种友好的体验。主要的难点是:</p><ul class=""><li id="2b68" class="ki kj hh jk b jl jm jo jp jr kk jv kl jz km kd kn ko kp kq bi translated">论点连载:<code class="du ke kf kg kh b">intent.putExtra(key, value)</code></li><li id="b3ae" class="ki kj hh jk b jl kr jo ks jr kt jv ku jz kv kd kn ko kp kq bi translated">参数反序列化:<code class="du ke kf kg kh b">intent.getStringExtra(key)</code></li><li id="e3f8" class="ki kj hh jk b jl kr jo ks jr kt jv ku jz kv kd kn ko kp kq bi translated">类型安全性、可维护性和测试</li></ul><p id="2270" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">如果有更好的方法呢？像Android框架的许多问题一样，我们可以通过结合<strong class="jk hi">单一责任</strong>和依赖注入来解决这个问题。给定下面的场景，让我们创建一个理想的API来说明。</p><h2 id="40ac" class="kw kx hh bd ky kz la lb lc ld le lf lg jr lh li lj jv lk ll lm jz ln lo lp lq bi translated">方案</h2><p id="5625" class="pw-post-body-paragraph ji jj hh jk b jl lr ii jn jo ls il jq jr lt jt ju jv lu jx jy jz lv kb kc kd ha bi translated">构建一个API来启动一个显示以下信息的<code class="du ke kf kg kh b">MediumProfileActivity</code>:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lw"><img src="../Images/267fd772d2ff1035ff58f445313c6292.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eeHsK1RRVZ8Cu2Wt7pqGyw.png"/></div></div></figure><p id="dfec" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">呈现上面的用户界面需要三条信息:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lx"><img src="../Images/aebe5dfe86faa04f94e62397287e0c30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GzaTNyaJf06u8HSJRBcjmw.png"/></div></div></figure><h2 id="e70a" class="kw kx hh bd ky kz la lb lc ld le lf lg jr lh li lj jv lk ll lm jz ln lo lp lq bi translated">创建API</h2><p id="ec23" class="pw-post-body-paragraph ji jj hh jk b jl lr ii jn jo ls il jq jr lt jt ju jv lu jx jy jz lv kb kc kd ha bi translated">现在，让我们想象一个理想的、开发人员友好的API来序列化我们的参数并启动一个<code class="du ke kf kg kh b">MediumProfileActivity</code>。它可能看起来像这样:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ly"><img src="../Images/656898ee69c7d6b7d8e0ee2b83ab79db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d1DkKkSeSKP53zsYKI6lMw.png"/></div></div><figcaption class="lz ma et er es mb mc bd b be z dx">Serializing activity arguments and launching them</figcaption></figure><p id="c944" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在一个<code class="du ke kf kg kh b">MediumProfileActivity</code>中，我们将需要反序列化我们的参数以便以后访问它们。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ly"><img src="../Images/3717f88cfda4e747dc65d6d8f0e4ce13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pO7naXXdOyqUWKXZPFgzhg.png"/></div></div><figcaption class="lz ma et er es mb mc bd b be z dx">deserializing arguments from intent, and accessing them within our Activity</figcaption></figure><p id="9b7d" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">注意没有杂乱的<code class="du ke kf kg kh b">intent.putExtra(key, value)</code>或<code class="du ke kf kg kh b">intent.getStringExtra(key)</code>代码污染。Kotlin的<code class="du ke kf kg kh b">lazy</code>委托让这变得更加清晰。</p><p id="0f21" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">我们将使用一个<code class="du ke kf kg kh b">ActivityArgs</code>接口为我们所有的实现提供通用的功能。</p><p id="f299" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这使我们能够直接将<code class="du ke kf kg kh b">.launch()</code>转换成<code class="du ke kf kg kh b">Activity</code>，或者使用<code class="du ke kf kg kh b">args.intent()</code>来传递那个<code class="du ke kf kg kh b">Activity</code>的意图。</p><p id="4af1" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">灵活！</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es md"><img src="../Images/981048afb04c2763d5198b31fcfee675.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5IYzzzASR2xgrzqOvGv6Hg.png"/></div></div><figcaption class="lz ma et er es mb mc bd b be z dx">Interface to give common functionality to all our implementations.</figcaption></figure><p id="10e2" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">接下来，我们必须在一个<code class="du ke kf kg kh b">MediumProfileActivityArgs</code>中实现<code class="du ke kf kg kh b">ActivityArgs</code>。这将需要一个序列化策略(<code class="du ke kf kg kh b">intent.putExtra()</code>)和一个反序列化策略(<code class="du ke kf kg kh b">intent.getExtra()</code>)。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es me"><img src="../Images/51209501086bb6a34d42046baa45f101.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ppCcKe15uJdG9_AJl5uNDQ.png"/></div></div><figcaption class="lz ma et er es mb mc bd b be z dx">Kotlin data class that owns argument serialization and deserialization</figcaption></figure><p id="45b1" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">嘣！我们有一个易于维护的解决方案——有一个类处理<code class="du ke kf kg kh b">MediumProfileActivity</code>的序列化和反序列化参数。</p><h2 id="e40b" class="kw kx hh bd ky kz la lb lc ld le lf lg jr lh li lj jv lk ll lm jz ln lo lp lq bi translated">测试呢？</h2><p id="42e0" class="pw-post-body-paragraph ji jj hh jk b jl lr ii jn jo ls il jq jr lt jt ju jv lu jx jy jz lv kb kc kd ha bi translated">超级简单。四个步骤。</p><ol class=""><li id="57aa" class="ki kj hh jk b jl jm jo jp jr kk jv kl jz km kd mf ko kp kq bi translated">创建您的<code class="du ke kf kg kh b">MediumProfileActivityArgs</code>实例。</li><li id="1cad" class="ki kj hh jk b jl kr jo ks jr kt jv ku jz kv kd mf ko kp kq bi translated">将实例序列化为一个<code class="du ke kf kg kh b">Intent</code>。</li><li id="9c6b" class="ki kj hh jk b jl kr jo ks jr kt jv ku jz kv kd mf ko kp kq bi translated">反序列化那个<code class="du ke kf kg kh b">intent</code>。</li><li id="0962" class="ki kj hh jk b jl kr jo ks jr kt jv ku jz kv kd mf ko kp kq bi translated">验证反序列化的<code class="du ke kf kg kh b">Args</code>是否等于原始的<code class="du ke kf kg kh b">Args</code>。</li></ol><p id="a1be" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">请参见下面的示例:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mg"><img src="../Images/826334ce7799f1a04addd527e70a708b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s_DEUJmPz8u884iCycFPHA.png"/></div></div><figcaption class="lz ma et er es mb mc bd b be z dx">A kotlin data class allows easy assertions on equality</figcaption></figure><h2 id="648f" class="kw kx hh bd ky kz la lb lc ld le lf lg jr lh li lj jv lk ll lm jz ln lo lp lq bi translated">结论</h2><p id="e858" class="pw-post-body-paragraph ji jj hh jk b jl lr ii jn jo ls il jq jr lt jt ju jv lu jx jy jz lv kb kc kd ha bi translated">我坚信以上是比传统的<code class="du ke kf kg kh b">YourActivity.launch(param1, param2)</code>方法更好的启动<code class="du ke kf kg kh b">Activity</code>的方法，传统的<code class="du ke kf kg kh b">YourActivity.launch(param1, param2)</code>方法有三个缺点:</p><ol class=""><li id="cfae" class="ki kj hh jk b jl jm jo jp jr kk jv kl jz km kd mf ko kp kq bi translated"><strong class="jk hi">无反序列化</strong>。需要<code class="du ke kf kg kh b">onCreate()</code>中的额外代码来反序列化(<code class="du ke kf kg kh b">intent.getStringExtra()</code>)。</li><li id="8abf" class="ki kj hh jk b jl kr jo ks jr kt jv ku jz kv kd mf ko kp kq bi translated"><strong class="jk hi">不灵活</strong>。如果您想要一个<code class="du ke kf kg kh b">intent</code>实例呢？您需要添加一个重载方法— <code class="du ke kf kg kh b">YourActivity.intent(param1, param2)</code>。有了<code class="du ke kf kg kh b">ActivityArgs</code>，就叫<code class="du ke kf kg kh b">args.intent()</code>了。</li><li id="4665" class="ki kj hh jk b jl kr jo ks jr kt jv ku jz kv kd mf ko kp kq bi translated"><strong class="jk hi">更难测试</strong>。您必须启动一个活动来测试反序列化</li></ol><p id="6766" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">希望<code class="du ke kf kg kh b">ActivityArgs</code>提升你的开发体验！</p></div><div class="ab cl mh mi go mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ha hb hc hd he"><p id="0466" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><em class="mo">完整代码上</em><a class="ae mp" href="https://gist.github.com/ZakTaccardi/ca8bdbbc48d724f47d596072fb4b68d1" rel="noopener ugc nofollow" target="_blank"><em class="mo">GitHub</em></a><em class="mo">。在推特上关注我！</em><a class="ae mp" href="https://twitter.com/ZakTaccardi" rel="noopener ugc nofollow" target="_blank"><em class="mo">@ zaktacardi</em></a><em class="mo"><br/>在</em> <a class="ae mp" href="https://www.reddit.com/r/androiddev/comments/837dgg/a_better_way_to_launch_activities/" rel="noopener ugc nofollow" target="_blank"> <em class="mo"> reddit </em> </a>上捕捉对话</p></div><div class="ab cl mh mi go mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ha hb hc hd he"><p id="33d4" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><strong class="jk hi"> <em class="mo">披露声明:以上观点为作者个人观点。除非本帖中另有说明，否则Capital One不属于所提及的任何公司，也不被其认可。使用或展示的所有商标和其他知识产权都是其各自所有者的所有权。本文为2018首都一。</em> </strong></p></div></div>    
</body>
</html>