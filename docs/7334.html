<html>
<head>
<title>Building a photo booth for Droidcon NYC</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为纽约市的Droidcon建立一个照相亭</h1>
<blockquote>原文：<a href="https://medium.com/square-corner-blog/building-a-photo-booth-for-droidcon-nyc-870425f47b00?source=collection_archive---------3-----------------------#2018-09-07">https://medium.com/square-corner-blog/building-a-photo-booth-for-droidcon-nyc-870425f47b00?source=collection_archive---------3-----------------------#2018-09-07</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/360e3d5e992063bdfb91c667e8d6ec55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F62fAMooU3NaIMg7f-OCuQ.jpeg"/></div></div></figure><blockquote class="ip iq ir"><p id="98e7" class="is it iu iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">注意，我们已经行动了！如果您想继续了解Square的最新技术内容，请访问我们的新家<a class="ae jr" href="https://developer.squareup.com/blog" rel="noopener ugc nofollow" target="_blank">https://developer.squareup.com/blog</a></p></blockquote><p id="3a45" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">一个月前，我在Square的团队发布了<a class="ae jr" href="http://squ.re/reader-sdk" rel="noopener ugc nofollow" target="_blank">阅读器SDK </a>。我们有机会在纽约Droidcon展会上展示了一个演示。我们如何让支付变得更酷？</p><p id="77dc" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">我们开始建造SquickPic，一个有趣的Android照相亭:支付一美元💳，选择滤镜，微笑，快照！📸照相亭打印照片，并在推特上发布🐦(<a class="ae jr" href="https://twitter.com/squickpic" rel="noopener ugc nofollow" target="_blank"> @SquickPic </a>)。</p><figure class="jw jx jy jz fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es jv"><img src="../Images/92b9e325f242c6d76be1d7d7274fda93.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SrYLlta00EzQjQr2ni4eHw.jpeg"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx">Android engineers Christina, Mike, Zarah and John joined me in sporting an Oreo Nose Ring</figcaption></figure><p id="3070" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">我们决定开放源代码SquickPic(GitHub上的<a class="ae jr" href="https://github.com/square/squickpic" rel="noopener ugc nofollow" target="_blank">源代码</a>)。在这篇博客中，我们将讨论代码中最有趣的部分:</p><ul class=""><li id="724f" class="ke kf hh iv b iw ix ja jb js kg jt kh ju ki jq kj kk kl km bi translated">人脸检测</li><li id="838d" class="ke kf hh iv b iw kn ja ko js kp jt kq ju kr jq kj kk kl km bi translated">Kiosk体验</li><li id="ef78" class="ke kf hh iv b iw kn ja ko js kp jt kq ju kr jq kj kk kl km bi translated">接受付款</li><li id="2ea5" class="ke kf hh iv b iw kn ja ko js kp jt kq ju kr jq kj kk kl km bi translated">使用Google Cloud Print打印</li><li id="4cde" class="ke kf hh iv b iw kn ja ko js kp jt kq ju kr jq kj kk kl km bi translated">（小鸟）鸣叫🐦</li></ul><h1 id="d20d" class="ks kt hh bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">App流量</h1><figure class="jw jx jy jz fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lq"><img src="../Images/b3355bbf291fbdc6d25fedf693e45906.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sbyKWMLaTEeQhETFolALog.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx">Idle screen, waiting for a new customer</figcaption></figure><figure class="jw jx jy jz fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lq"><img src="../Images/62f30dfb7353a7e53c2e4faddb6f6d67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7NTdv28mjt4EqxvAQQKXAA.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx">💳Ready to take a card payment!</figcaption></figure><figure class="jw jx jy jz fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lq"><img src="../Images/d5fecf22a4928bb0bd62b5383622cbd8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EygCDwYij6IG9PIBL5YAhA.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx">Filter selection. Best filter is obviously LeakCanary 😅</figcaption></figure><figure class="jw jx jy jz fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lq"><img src="../Images/efab45e46bc783ade0f56964650ff97a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*646eMAPTpnQPOLcz4qY0lw.png"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx">🖨Ready to print!</figcaption></figure><h1 id="4585" class="ks kt hh bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">人脸检测</h1><p id="66e1" class="pw-post-body-paragraph is it hh iv b iw lr iy iz ja ls jc jd js lt jg jh jt lu jk jl ju lv jo jp jq ha bi translated">第一步是建立人脸检测。我们使用了Google <a class="ae jr" href="https://developers.google.com/vision/" rel="noopener ugc nofollow" target="_blank">移动视觉API </a>，并检查了<a class="ae jr" href="https://github.com/googlesamples/android-vision/tree/master/visionSamples/FaceTracker" rel="noopener ugc nofollow" target="_blank"> FaceTracker示例应用程序</a>。没有什么比复制粘贴和删除你不需要的东西更能快速获得工作代码了！</p><p id="9a52" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">最棘手的部分是弄清楚缩放和反转:人脸检测在相机位图上运行，并提供参考坐标。相机位图被放大到显示器，所以我们必须放大我们的过滤器:</p><figure class="jw jx jy jz fd ii"><div class="bz dy l di"><div class="lw lx l"/></div><figcaption class="ka kb et er es kc kd bd b be z dx">Drawing the Android Pie logo on people’s eyes</figcaption></figure><h1 id="a83b" class="ks kt hh bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">Kiosk体验</h1><p id="5569" class="pw-post-body-paragraph is it hh iv b iw lr iy iz ja ls jc jd js lt jg jh jt lu jk jl ju lv jo jp jq ha bi translated">photobooth设置在公共空间，因此我们使用<a class="ae jr" href="https://developer.android.com/reference/android/app/Activity#startLockTask()" rel="noopener ugc nofollow" target="_blank"> startLockTask() </a>锁定了photobooth应用程序上的平板电脑:</p><figure class="jw jx jy jz fd ii"><div class="bz dy l di"><div class="lw lx l"/></div></figure><p id="b651" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">我们还将相关活动设置为全屏:</p><figure class="jw jx jy jz fd ii"><div class="bz dy l di"><div class="lw lx l"/></div></figure><h1 id="16af" class="ks kt hh bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">接受付款</h1><p id="2575" class="pw-post-body-paragraph is it hh iv b iw lr iy iz ja ls jc jd js lt jg jh jt lu jk jl ju lv jo jp jq ha bi translated">这对我们来说是最重要的部分！也是最简单的，只有几行代码💪。</p><figure class="jw jx jy jz fd ii"><div class="bz dy l di"><div class="lw lx l"/></div><figcaption class="ka kb et er es kc kd bd b be z dx">Yes, the note field supports emojis 🕺</figcaption></figure><h1 id="7d50" class="ks kt hh bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">使用Google Cloud Print打印</h1><p id="17aa" class="pw-post-body-paragraph is it hh iv b iw lr iy iz ja ls jc jd js lt jg jh jt lu jk jl ju lv jo jp jq ha bi translated"><a class="ae jr" href="https://developer.android.com/reference/android/support/v4/print/PrintHelper" rel="noopener ugc nofollow" target="_blank"> PrinterHelper </a>通过显示系统用户界面来选择打印机、配置属性，然后发送打印作业，从而简化位图打印。这对于消费类设备来说很棒，但对于我们希望自动打印照片的照相亭来说就不那么好了。</p><p id="f9ca" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">我们买了一个<a class="ae jr" href="https://www.usa.canon.com/internet/portal/us/home/products/details/printers/mobile-compact-printer/cp1300-bkn" rel="noopener ugc nofollow" target="_blank"> Selphy CP1300 </a>并将其连接到<a class="ae jr" href="https://developers.google.com/cloud-print/docs/sendJobs" rel="noopener ugc nofollow" target="_blank">谷歌云打印</a>。不幸的是，云打印Android API也显示了一个UI，HTTP API文档遗漏了我们必须解决的细节。</p><p id="5fba" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">我们的第一步是获得OAuth令牌。我们使用<a class="ae jr" href="https://developer.android.com/training/id-auth/identify" rel="noopener ugc nofollow" target="_blank"> AccountManager </a>来请求OAuth令牌:</p><figure class="jw jx jy jz fd ii"><div class="bz dy l di"><div class="lw lx l"/></div></figure><p id="4973" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">接下来，我们定义了一个改进接口来列出打印机并发送打印作业:</p><figure class="jw jx jy jz fd ii"><div class="bz dy l di"><div class="lw lx l"/></div></figure><p id="575b" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">改型得到OkHttp的支持，因此我们设置了一个<a class="ae jr" href="https://github.com/square/okhttp/wiki/Interceptors" rel="noopener ugc nofollow" target="_blank"> OkHttp拦截器</a>来将云打印OAuth令牌添加到我们的请求中:</p><figure class="jw jx jy jz fd ii"><div class="bz dy l di"><div class="lw lx l"/></div></figure><p id="ab22" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">我们将位图转换成JPEG字节数组，并作为多部分消息发送:</p><figure class="jw jx jy jz fd ii"><div class="bz dy l di"><div class="lw lx l"/></div></figure><h1 id="c887" class="ks kt hh bd ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp bi translated">（小鸟）鸣叫🐦</h1><p id="b77e" class="pw-post-body-paragraph is it hh iv b iw lr iy iz ja ls jc jd js lt jg jh jt lu jk jl ju lv jo jp jq ha bi translated">我们设置了<a class="ae jr" href="https://docs.fabric.io/android/twitter/twitter-core.html" rel="noopener ugc nofollow" target="_blank"> Twitter核心</a>，并使用TwitterLoginButton通过Twitter应用程序进行身份验证。在推特上发布图片需要先上传，然后将其作为媒体附加到状态更新:</p><figure class="jw jx jy jz fd ii"><div class="bz dy l di"><div class="lw lx l"/></div><figcaption class="ka kb et er es kc kd bd b be z dx">Twitter still call tweeting a “status updat‍e”</figcaption></figure><p id="67af" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">就是这样！我们非常开心地建造了这个，并和纽约Droidcon的参加者一起自拍。不要犹豫，在GitHub 上查看<a class="ae jr" href="https://github.com/square/squickpic" rel="noopener ugc nofollow" target="_blank">源！</a></p><figure class="jw jx jy jz fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ly"><img src="../Images/9a0b45fd6bb6c9161b2f971842948022.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MNq2kGDd_t2hZSZlKOdPjg.jpeg"/></div></div><figcaption class="ka kb et er es kc kd bd b be z dx">SquickPic at Droidcon NYC</figcaption></figure></div></div>    
</body>
</html>