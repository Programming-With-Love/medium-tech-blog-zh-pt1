<html>
<head>
<title>LXD Bits and Tips</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">LXD小贴士</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/lxd-bits-and-tips-558933d544f2?source=collection_archive---------4-----------------------#2016-08-22">https://medium.com/walmartglobaltech/lxd-bits-and-tips-558933d544f2?source=collection_archive---------4-----------------------#2016-08-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/bfad4fcee922709ce633ff3cd8aa2f2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Jjuua5iN3ISoXrUWuoRgQ.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Credit: <a class="ae it" href="https://pixabay.com/en/users/PeteLinforth-202249/" rel="noopener ugc nofollow" target="_blank">PeteLinforth / 2994 images</a></figcaption></figure><p id="9ea9" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你是第一次去LXD(谁不是呢？)，用法和交互跟LXC有点不一样。除了命令行差异之外，要实现充分的故障排除和实例管理，还有很多东西需要学习。</p><h1 id="b1c3" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">重要目录</h1><h2 id="d63f" class="kq jt hh bd ju kr ks kt jy ku kv kw kc jf kx ky kg jj kz la kk jn lb lc ko ld bi translated">/var/log/lxd</h2><p id="1b1e" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">这显然是一个重要的目录。从表面上看，它不需要太多的解释，但是应该注意的是，这里有一些有趣的花絮。虽然<strong class="iw hi"> /var/log/lxd/lxd.log </strong>涵盖了lxd守护进程本身的操作，但是每个实例都有子目录。特别是，<strong class="iw hi"> lxc.conf </strong>可以提供关于容器如何配置的有用见解。</p><h2 id="15f4" class="kq jt hh bd ju kr ks kt jy ku kv kw kc jf kx ky kg jj kz la kk jn lb lc ko ld bi translated">/var/lib/lxd</h2><p id="cfaf" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">这个目录存放了许多重要的文件。</p><p id="1aae" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> lxd.db </strong>:一个SQLite数据库。这可能包含lxd配置变量，也可能包含关于实例的信息。</p><p id="4196" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">containers/&lt;instance&gt;/root fs</strong>:这是一个实例的根文件系统。</p><p id="6593" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">图像</strong>:保存图像和相关的清单数据。</p><p id="27bc" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi">安全</strong>:表观轮廓和一些其他数据。</p><p id="0e33" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">还有一些其他目录和文件或多或少也是不言自明的。</p><h1 id="df4f" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">重要命令</h1><p id="a113" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">运行<strong class="iw hi"> lxc help </strong>将向您显示大多数命令。这里列出了一些特别有用的命令。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="7369" class="kq jt hh lo b fi ls lt l lu lv"><strong class="lo hi">lxc config show &lt;instance&gt; --expanded</strong></span></pre><p id="e533" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这显示了关于实例的导入配置数据，这些数据在其他地方不容易获得。最重要的是，配置的cgroup变量会影响实例资源的可用性。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="6694" class="kq jt hh lo b fi ls lt l lu lv"><strong class="lo hi">lxc exec &lt;instance&gt; sh</strong></span></pre><p id="9985" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果您熟悉lxc-attach命令，那么这对于lxd实例是不存在的。复制该功能的最佳方式是执行sh。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="b7bb" class="kq jt hh lo b fi ls lt l lu lv"><strong class="lo hi">lxc file &lt;command&gt; &lt;instance&gt;</strong></span></pre><p id="2ec7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">直接推/拉/编辑实例上的文件。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="109e" class="kq jt hh lo b fi ls lt l lu lv"><strong class="lo hi">lxc image …</strong></span></pre><p id="fe6b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">图像处理。在LXD添加你自己的图片比在LXC容易得多；不需要在一个晦涩的目录中手动编辑复杂的bash脚本来从默认位置以外的地方获取图像。您可以创建自己的tarball ( <strong class="iw hi">教程即将推出！</strong>)上传到LXD，轻松创建新实例。您可以使用<strong class="iw hi"> lxc帮助图像</strong>了解更多命令用法信息。</p><h1 id="dd9d" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">命名空间</h1><p id="2478" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">在幕后，LXD和LXC使用网络名称空间来隔离租户网络。有时候，出于某种原因，您可能需要直接与名称空间进行交互。</p><p id="9fee" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果您熟悉命令<strong class="iw hi"> ip netns exec </strong>，那么这一节将对您有用。默认情况下，网络名称空间在由LXC/LXD创建时没有给出名称。至少iproute2命令不能用<strong class="iw hi"> ip netns列表</strong>识别这个名字。然而，通过运行<strong class="iw hi"> ip netns list-id </strong>，您可以看到各种网络名称空间确实在使用中(如果您有实例在运行的话)。您可以用以下方式标记/命名这些现有的名称空间:</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="423c" class="kq jt hh lo b fi ls lt l lu lv">pid=$(lxc info instance-0000000d | grep Pid | awk ‘{print $2}’)<br/>mkdir -p /var/run/netns<br/>ln -sf /proc/$pid/ns/net /var/run/netns/$pid</span></pre><p id="b40d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">上面的代码块改编自这里:<a class="ae it" href="https://gist.github.com/niedbalski/ea84a2dd7a7a5b50cda0" rel="noopener ugc nofollow" target="_blank"> netns-lxc </a></p><h1 id="84f3" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">请分享…</h1><p id="356e" class="pw-post-body-paragraph iu iv hh iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">如果你有任何其他有用的命令/关于LXD用法的见解，我很乐意听到它们！</p></div></div>    
</body>
</html>