<html>
<head>
<title>Execute Powershell Script in Remote Machine using C#</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用C#在远程机器上执行Powershell脚本</h1>
<blockquote>原文：<a href="https://medium.com/quick-code/execute-powershell-script-in-remote-machine-using-c-38cef87b796a?source=collection_archive---------2-----------------------#2021-05-09">https://medium.com/quick-code/execute-powershell-script-in-remote-machine-using-c-38cef87b796a?source=collection_archive---------2-----------------------#2021-05-09</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/51bab6bb2c69e806801e9cb34b5a7925.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*o-LGjYDWT8CvEMfL"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo by <a class="ae it" href="https://unsplash.com/@ort?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Bram Van Oost</a> on <a class="ae it" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3e49" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">当在解释器中运行脚本时，您可以通过使用<a class="ae it" href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.core/invoke-command?view=powershell-7.1" rel="noopener ugc nofollow" target="_blank"> Invoke-Command </a>参数在远程机器中运行PowerShell脚本。但是为了在C#中实现类似的功能，我们使用了来自System.Management.Automation.dll的叫做<a class="ae it" href="https://docs.microsoft.com/en-us/dotnet/api/system.management.automation.runspaces.runspace?view=powershellsdk-7.0.0" rel="noopener ugc nofollow" target="_blank"> RunSpace </a>的东西。</p><figure class="js jt ju jv fd ii"><div class="bz dy l di"><div class="jw jx l"/></div></figure><p id="796d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">首先，我们需要使用凭据创建WSManConnectionInfo对象来连接到远程机器。我们刚刚创建的connectionInfo对象应该在创建运行空间时作为参数发送。通过runspace。Open()创建一个到远程机器的新连接。</p><p id="4f2b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在上面的要点中，正在运行的脚本实际上存在于正在执行c#代码的机器中。为了在远程机器上运行ps脚本，我们可以使用</p><pre class="js jt ju jv fd jy jz ka kb aw kc bi"><span id="7929" class="kd ke hh jz b fi kf kg l kh ki">ps.AddScript(scriptLocation);</span></pre><p id="4ec1" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们可以使用</p><pre class="js jt ju jv fd jy jz ka kb aw kc bi"><span id="95ec" class="kd ke hh jz b fi kf kg l kh ki">ps.AddArgument(@"Argument1");</span></pre><p id="8728" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了运行脚本，需要引用系统。管理。必须增加自动化。</p></div></div>    
</body>
</html>