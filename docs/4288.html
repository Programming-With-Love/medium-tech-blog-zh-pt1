<html>
<head>
<title>Listening to Fragments… from the outside</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">听着片段…从外面</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/listening-to-fragments-from-the-outside-e80b28fbfeb?source=collection_archive---------4-----------------------#2020-04-01">https://medium.com/google-developer-experts/listening-to-fragments-from-the-outside-e80b28fbfeb?source=collection_archive---------4-----------------------#2020-04-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/9bc9e96063df1443e647860eae18327b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4p4tEKVa6JQzBaprtF5j1A.jpeg"/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx">Foto di <a class="ae hu" href="https://www.pexels.com/it-it/@adrien-olichon-1257089?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Adrien Olichon</a> da <a class="ae hu" href="https://www.pexels.com/it-it/foto/bicchiere-cristallo-distrutto-in-frantumi-2663255/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Pexels</a></figcaption></figure><div class=""/><p id="6963" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">大多数Android开发者在他们的职业生涯中至少与<code class="du js jt ju jv b">Application.ActivityLifecycleCallbacks</code>打过一次交道，但是你知道同样的事情也可以用<code class="du js jt ju jv b">Fragments</code>来做吗？</p><h2 id="250d" class="jw jx hx bd jy jz ka kb kc kd ke kf kg jf kh ki kj jj kk kl km jn kn ko kp kq bi translated">为什么的原因</h2><p id="9d53" class="pw-post-body-paragraph iu iv hx iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">让我们后退一步。通常，您不需要从外部了解一个<code class="du js jt ju jv b">Fragment</code>的生命周期:例如，您可能需要监听多个<code class="du js jt ju jv b">Fragment</code>实例，而不需要改变每个实例的代码。</p><p id="d95b" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">假设你正在开发一个SDK，你需要对每个被创建的<code class="du js jt ju jv b">Fragment</code>做出反应。你可以要求你的用户注册他们的每一个类，或者你可以创建一个必须扩展的基类，但是这并不总是可能的。下面几段我们就把自己放在这种情况下吧。</p><h2 id="b4cb" class="jw jx hx bd jy jz ka kb kc kd ke kf kg jf kh ki kj jj kk kl km jn kn ko kp kq bi translated">它是如何工作的？</h2><p id="63e7" class="pw-post-body-paragraph iu iv hx iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">撇开具体的生命周期事件不谈，在<code class="du js jt ju jv b">FragmentLifecycleCallbacks</code>和它的对应产品<code class="du js jt ju jv b">Activity</code>之间有很多相似之处。第一个是，即使它们实际上都被声明为<code class="du js jt ju jv b">abstract classes</code>，前者带有<strong class="iw hy">默认的无操作实现</strong>，而后者没有。</p><p id="5fa0" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">当然，这与每种情况下可以发送的事件数量有关。另一个区别是<code class="du js jt ju jv b">FragmentLifecycleCallbacks</code>必须连接到<code class="du js jt ju jv b">FragmentManager</code>上，而<code class="du js jt ju jv b">ActivityLifecycleCallbaks</code>通常连接到<code class="du js jt ju jv b">Application</code>上。当然，这是一个逻辑上的区别，因为它们都绑定到将启动<code class="du js jt ju jv b">Fragment</code>或<code class="du js jt ju jv b">Activity</code>的组件。</p><h2 id="0203" class="jw jx hx bd jy jz ka kb kc kd ke kf kg jf kh ki kj jj kk kl km jn kn ko kp kq bi translated">该结构</h2><p id="a352" class="pw-post-body-paragraph iu iv hx iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">正如我们在上一段中提到的，<code class="du js jt ju jv b">FragmentLifecycleCallbacks</code>提供了广泛的回调，覆盖了<code class="du js jt ju jv b">Fragment</code>的整个生命周期，但是您可以只覆盖您的案例中需要的方法。</p><p id="fe11" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在示例中，我们只对几个函数感兴趣，只是为了测试功能:</p><figure class="kw kx ky kz fd hj"><div class="bz dy l di"><div class="la lb l"/></div></figure><p id="8cf9" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">既然我们已经创建了监听的主入口点，我们需要将对象附加到<code class="du js jt ju jv b">FragmentManager</code>:我们可以用一个接受2个参数的API调用来完成。第一个是听众，而第二个是一个叫做<code class="du js jt ju jv b">recursive</code>的<code class="du js jt ju jv b">Boolean</code>。当后者被设置为<code class="du js jt ju jv b">true</code>时，同一个监听器被连接到每个<code class="du js jt ju jv b">childFragmentManager</code>，这样层次结构中的每个<code class="du js jt ju jv b">Fragment</code>都可以触发事件。侦听器可以很容易地连接，只需一行代码:</p><figure class="kw kx ky kz fd hj"><div class="bz dy l di"><div class="la lb l"/></div></figure><h2 id="e8b4" class="jw jx hx bd jy jz ka kb kc kd ke kf kg jf kh ki kj jj kk kl km jn kn ko kp kq bi translated">结论</h2><p id="9b40" class="pw-post-body-paragraph iu iv hx iw b ix kr iz ja jb ks jd je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">虽然大多数人可能不熟悉这个API，但在您的职业生涯中可能会有需要监听<code class="du js jt ju jv b">Fragment</code>实例及其生命周期的情况，这些函数会派上用场。</p><p id="a7a2" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你想试试这个功能，你可以在Github 上的一个<a class="ae hu" href="https://github.com/tiwiz/AndroidXSharedTest/tree/master/app/src/main/java/net/orgiu/tests/fragmentslifecycle" rel="noopener ugc nofollow" target="_blank">游乐场项目中找到它。</a></p><p id="5b27" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="lc">感谢</em><a class="ae hu" href="https://twitter.com/rotxed" rel="noopener ugc nofollow" target="_blank"><em class="lc">Sebastiano Gottardo</em></a><em class="lc"/><a class="ae hu" href="https://twitter.com/johnson_cor" rel="noopener ugc nofollow" target="_blank"><em class="lc">克里·约翰逊</em> </a> <em class="lc">和</em><a class="ae hu" href="https://twitter.com/OmarMiatello" rel="noopener ugc nofollow" target="_blank"><em class="lc">Omar Miatello</em></a><em class="lc">对本帖进行校对。</em></p></div></div>    
</body>
</html>