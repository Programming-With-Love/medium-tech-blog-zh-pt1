<html>
<head>
<title>Deploy Go App to Google Kubernetes Engine (GKE)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Go应用程序部署到Google Kubernetes引擎(GKE)</h1>
<blockquote>原文：<a href="https://medium.easyread.co/deploy-go-app-to-google-kubernetes-engine-gke-b56ca15f1865?source=collection_archive---------0-----------------------#2020-05-12">https://medium.easyread.co/deploy-go-app-to-google-kubernetes-engine-gke-b56ca15f1865?source=collection_archive---------0-----------------------#2020-05-12</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/1b5a779c399d84363aedbe2be04c29db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BeymlJVIa9lEC6QJ_ktiJg.jpeg"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="http://pexels.com/photo/person-typing-on-computer-keyboard-2058128/" rel="noopener ugc nofollow" target="_blank">pexels.com</a></figcaption></figure><p id="b0c5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">大家好！与我一次又一次地分享一些经验，尽管还是关于软件工程领域相关技术的看法。今天，我将分享关于Devops的事情，即如何部署您的应用程序到谷歌Kubernetes引擎(GKE)。在这个例子中，我们将使用Go编程语言。</p><p id="05b6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为什么是Kubernetes？什么是Kubernetes？你可以在Kubernetes的官方页面<a class="ae jz" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank">https://kubernetes.io/</a>上了解更多信息</p><blockquote class="ky kz la"><p id="4bc2" class="ka kb lb kc b kd ke kf kg kh ki kj kk lc km kn ko ld kq kr ks le ku kv kw kx ig bi translated"><strong class="kc io">TL</strong>；<strong class="kc io">博士</strong></p><p id="8445" class="ka kb lb kc b kd ke kf kg kh ki kj kk lc km kn ko ld kq kr ks le ku kv kw kx ig bi translated">Kubernetes是一个开源的容器编排系统，用于自动化应用程序部署、伸缩和管理。</p><p id="f5ee" class="ka kb lb kc b kd ke kf kg kh ki kj kk lc km kn ko ld kq kr ks le ku kv kw kx ig bi translated">Kubernetes很容易管理一吨集装箱的例子码头工人</p></blockquote><p id="4439" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">好的，因为Kubernetes (K8s)所做的是管理容器，所以我们将在这个例子中使用Docker。因为它很受欢迎，而且与Kubernetes配合得很好。如果你不熟悉Docker，也许你可以阅读这篇官方文章:</p><blockquote class="ky kz la"><p id="f529" class="ka kb lb kc b kd ke kf kg kh ki kj kk lc km kn ko ld kq kr ks le ku kv kw kx ig bi translated"><a class="ae jz" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"><em class="in">https://www.docker.com/</em></a><em class="in"><br/></em><a class="ae jz" href="https://www.docker.com/why-docker" rel="noopener ugc nofollow" target="_blank"><em class="in">https://www.docker.com/why-docker</em></a></p></blockquote><h1 id="d794" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">1.设置图像</h1><p id="da28" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">在前面的故事中，我们使用Docker Hub作为存储图像容器的仓库。但是，Docker Hub是一个公共存储库。如果我们想把它保存为私人图像呢？然后，我们可以使用谷歌容器注册表来存储我们的图像。让我们试着建造它！</p><p id="b96a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">首先，我们需要一个简单的应用程序。当我们ping它时，这个应用程序将打印我们的主机名。接下来，创建main.go文件，在本地机器中包含以下代码:</p><figure class="mi mj mk ml gt jo"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="e984" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们还需要Dockerfile来构建包含以下代码的图像:</p><figure class="mi mj mk ml gt jo"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="8af2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用此命令构建映像。</p><pre class="mi mj mk ml gt mo mp mq mr aw ms bi"><span id="cebe" class="mt lg in mp b gy mu mv l mw mx">docker build -t go-hostname .</span></pre><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi my"><img src="../Images/6c145b8fa6d896823d3663f4b86d535d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BZ3C5FWNFToAdSvODEWzaw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 1 Build Docker Image</figcaption></figure><p id="e4ef" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">检查我们创建的图像。</p><pre class="mi mj mk ml gt mo mp mq mr aw ms bi"><span id="75cd" class="mt lg in mp b gy mu mv l mw mx">docker images</span></pre><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi mz"><img src="../Images/97640f13845e337a8006a09f6ea79b09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Elu0s2ICFbQQr61MSfbI0Q.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 2 Check Docker Images</figcaption></figure><p id="9b4f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">用谷歌容器注册格式标记图像。</p><ul class=""><li id="14ff" class="na nb in kc b kd ke kh ki kl nc kp nd kt ne kx nf ng nh ni bi translated"><strong class="kc io"> gcr.io </strong>是一个主机名，有几个主机名像us.gcr.io、eu.gcr.io和asia.gcr.io</li><li id="9178" class="na nb in kc b kd nj kh nk kl nl kp nm kt nn kx nf ng nh ni bi translated"><strong class="kc io"> go-app-275713 </strong>是我们的<strong class="kc io">项目ID </strong>。我们可以在仪表板上找到价值。</li><li id="8868" class="na nb in kc b kd nj kh nk kl nl kp nm kt nn kx nf ng nh ni bi translated"><strong class="kc io"> go-hostname </strong>是我们的映像名称</li></ul><pre class="mi mj mk ml gt mo mp mq mr aw ms bi"><span id="9fed" class="mt lg in mp b gy mu mv l mw mx">docker tag go-hostname gcr.io/go-app-275713/go-hostname</span></pre><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/f927306af5f7e31f9cb2f945a4442281.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NU2qpDKeWvriVz5kuYWaYg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 3 Copy Google Project ID</figcaption></figure><p id="4cb1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">检查我们创建的标签。我们应该有新的形象。</p><pre class="mi mj mk ml gt mo mp mq mr aw ms bi"><span id="1005" class="mt lg in mp b gy mu mv l mw mx">docker images</span></pre><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi np"><img src="../Images/65462a805587b51bbd58e2512374653a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q74w-mctq4YVKSfPUQjo8w.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 4 Check Docker Tag Image</figcaption></figure><p id="5942" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们将使用glcloud命令轻松连接到Google云服务。关于如何安装gcloud命令的细节，请看这个链接<a class="ae jz" href="https://cloud.google.com/sdk/install" rel="noopener ugc nofollow" target="_blank">https://cloud.google.com/sdk/install</a>，因为它依赖于我们的操作系统。</p><p id="674d" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在本例中，我使用的是macOS，步骤如下所示</p><p id="6de1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用curl下载gcloud sdk。</p><pre class="mi mj mk ml gt mo mp mq mr aw ms bi"><span id="a590" class="mt lg in mp b gy mu mv l mw mx">curl <a class="ae jz" href="https://sdk.cloud.google.com" rel="noopener ugc nofollow" target="_blank">https://sdk.cloud.google.com</a> | bash</span></pre><p id="9044" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用exec重新启动Shell。</p><pre class="mi mj mk ml gt mo mp mq mr aw ms bi"><span id="9c71" class="mt lg in mp b gy mu mv l mw mx">exec -l $SHELL</span></pre><p id="1b7f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">运行gcloud init并完成安装(您会问几个关于google帐户、云项目、计算引擎区域的问题) :</p><pre class="mi mj mk ml gt mo mp mq mr aw ms bi"><span id="f2f2" class="mt lg in mp b gy mu mv l mw mx">gcloud init</span></pre><p id="ea35" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">然后，使用gcloud命令将图像推送到Google容器注册表中。</p><pre class="mi mj mk ml gt mo mp mq mr aw ms bi"><span id="1f82" class="mt lg in mp b gy mu mv l mw mx">gcloud docker -- push gcr.io/go-app-275713/go-hostname</span></pre><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi np"><img src="../Images/e4b1a831ef3e6a2fe6f87c62a26ec730.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2TjZc8wHHWb660ZGp8m_zw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 5 Push Docker Image</figcaption></figure><p id="0105" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在<strong class="kc io">容器注册表</strong>菜单下的<strong class="kc io">图像</strong>子菜单上检查推送的图像。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi no"><img src="../Images/d3e39d8830cafd946796fcd1fe74194e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n0fnwTGMg_0ze1T-2tAyag.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 6 Go To Container Registry Images</figcaption></figure><p id="b79b" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们的图像应该存在于<strong class="kc io">资料库中。</strong></p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nq"><img src="../Images/823e98951363c1f9dd67e40c1a9964bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3PeIlyKAdLE6GZVp7-WFNA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 7 Image Already Stored</figcaption></figure><h1 id="3981" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">2.设置集群</h1><p id="6040" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">回到GCP控制台。打开边栏菜单。点击<strong class="kc io"> Kubernetes引擎</strong>菜单下的<strong class="kc io">集群</strong>子菜单，进入<strong class="kc io">集群</strong>页面，然后创建一个新的集群。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nr"><img src="../Images/d829c2b31cb23f683b0af5c7a6930977.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yrDURiIBqmEt9xGV3nNXlQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 8 Go to Kubernetes Engine Clusters</figcaption></figure><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nq"><img src="../Images/ec68e06b816de7e9aa20606e9948225a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F2LH5_EnVncyVv8Qh9RNxw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 9 Go to Create Cluster</figcaption></figure><p id="a73c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">大多数情况下，我们将使用默认配置，只需更改<strong class="kc io">机器类型</strong>以降低成本:)接下来，单击<strong class="kc io">创建</strong>按钮以创建集群，并等待该过程完成。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ns"><img src="../Images/1401ee0245820c2f0b1e4fa2448c6943.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3qk3EB7kDDIZsQmwwKoRMQ.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 10.1 Cluster Configuration</figcaption></figure><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nt"><img src="../Images/d6e586f446ab84680595dc4255547d55.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a4X6jxOMq1E4aN3905sHdg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 10.2 Cluster Configuration</figcaption></figure><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nu"><img src="../Images/3ed05c5a31019f53e2cc4f50423926dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*834Jlr9zc4tT7RTSZgAAGA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 11 Cluster Created</figcaption></figure><h1 id="ad0d" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">3.配置集群</h1><p id="b2b7" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">是时候让我们的集群发挥作用了。请记住，在创建群集时，我们为群集配置了3个节点。因此，我们的聚类图将如下所示。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/6cbfc9c41759a92e99a38e0d9506622c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*zmUL7vUMnrMzl_kPX8QUvw.png"/></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 12 Kubernetes Cluster Diagram</figcaption></figure><p id="617e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">来自云的流量将作为入站流量进入入口。并且入口将服务于来自节点的对请求的响应。每个节点有3个单元。我将尝试用简短的描述来解释上述术语:</p><ul class=""><li id="0355" class="na nb in kc b kd ke kh ki kl nc kp nd kt ne kx nf ng nh ni bi translated"><strong class="kc io">云</strong>:用户的流量来自云区。我们将有几个请求进入我们的Kubernetes集群。</li><li id="0769" class="na nb in kc b kd nj kh nk kl nl kp nm kt nn kx nf ng nh ni bi translated"><strong class="kc io">入口</strong>:我们的Kubernetes集群是孤立的。为了从外部访问，我们需要一个网关作为负载平衡器，将请求转发到节点。</li><li id="2e5e" class="na nb in kc b kd nj kh nk kl nl kp nm kt nn kx nf ng nh ni bi translated"><strong class="kc io">节点</strong>:在GKE，节点将成为一个虚拟机实例。因此，当我们创建3个节点时，我们将有3个虚拟机实例。我们的吊舱将在节点内运行。</li><li id="2ad5" class="na nb in kc b kd nj kh nk kl nl kp nm kt nn kx nf ng nh ni bi translated"><strong class="kc io"> Pod </strong>:我们所有的容器将被一组容器(或者只是单个容器，取决于我们的应用程序)放入Pod。</li></ul><p id="5ad6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们需要几个文件来配置集群。我们的项目目录应该是这样的。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nw"><img src="../Images/4ce86bd3ae6906e1b2fa528309ff62e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2DLMGeyWTeVQaHSZGwDC_A.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 13 Project Directory</figcaption></figure><p id="3d27" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">创建用于管理pod的部署yaml文件。我们将对pod使用3个复制。</p><figure class="mi mj mk ml gt jo"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="01b5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为expose pod创建服务yam文件。因此，流量可以通过服务路由到pod。</p><figure class="mi mj mk ml gt jo"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="1fd6" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">为负载平衡器创建入口yaml文件。来自外部的流量将由负载平衡器处理，并将转发给服务。</p><figure class="mi mj mk ml gt jo"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="c7ee" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">返回群集页面，然后单击连接按钮。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nt"><img src="../Images/3484700979a8c7a398705eb8e805bff9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UDyePxlGK1Bhv-x6rg_n1A.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 14 Guide Connect to Cluster</figcaption></figure><p id="2e0c" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">GKE有几个选项，如运行在云壳或本地运行。我们将选择本地运行。只需复制configure kubectl命令并粘贴到我们的终端上。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nt"><img src="../Images/ca9f9c7626b5be86c8e8a7a014721033.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NRmequ59RU2c0BSOPfiwkw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 15 Configure Kubectl Command</figcaption></figure><p id="6f60" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">运行这个命令，就会为我们的集群生成kubeconfig。</p><pre class="mi mj mk ml gt mo mp mq mr aw ms bi"><span id="6b98" class="mt lg in mp b gy mu mv l mw mx">gcloud container clusters get-credentials cluster-1 --zone us-central1-c --project go-app-275713</span></pre><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nx"><img src="../Images/25bc32ecac2313b342ee8b8465c79a6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4SOnVO85aAhqtSkpxz580A.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 16 Fetching Kubeconfig</figcaption></figure><p id="08f9" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">检查节点。根据之前的配置，我们将获得3个节点。确保<strong class="kc io">状态</strong>为<strong class="kc io">就绪</strong>。</p><pre class="mi mj mk ml gt mo mp mq mr aw ms bi"><span id="0b1a" class="mt lg in mp b gy mu mv l mw mx">kubectl get node</span></pre><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ny"><img src="../Images/6ab2a9a8d3ce4eeab838607de147854f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nhu4tQL7rBRpq-iVCfwWPA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 17 Get Nodes</figcaption></figure><p id="159a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">应用(创建/更新)部署。</p><pre class="mi mj mk ml gt mo mp mq mr aw ms bi"><span id="1854" class="mt lg in mp b gy mu mv l mw mx">kubectl apply -f deployment.yaml</span></pre><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ny"><img src="../Images/d234d9640ab5050f7a3e1eb88894cb14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ye_2AMdBZIg2FgYUVYeveA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 18 Apply Deployment</figcaption></figure><p id="19ae" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">检查部署状态。还要确保3个豆荚准备好<strong class="kc io"/>。</p><pre class="mi mj mk ml gt mo mp mq mr aw ms bi"><span id="716f" class="mt lg in mp b gy mu mv l mw mx">kubectl get deployment</span></pre><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nz"><img src="../Images/c13c93aa2f8957531b6ef3355f717899.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f3OFg5TyryqoAnAUiH6POg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 19 Check Deployment</figcaption></figure><p id="3919" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">检查pod的状态。吊舱的<strong class="kc io">状态</strong>应为<strong class="kc io">运行</strong>。</p><pre class="mi mj mk ml gt mo mp mq mr aw ms bi"><span id="7339" class="mt lg in mp b gy mu mv l mw mx">kubectl get pod</span></pre><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ny"><img src="../Images/74e343b267963dff9b954de15d34cff4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*__D_RnRJYukN8PnGh_lKIA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 20 Check Pods</figcaption></figure><p id="f181" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">应用(创建/更新)服务。</p><pre class="mi mj mk ml gt mo mp mq mr aw ms bi"><span id="c25c" class="mt lg in mp b gy mu mv l mw mx">kubectl apply -f service.yaml</span></pre><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oa"><img src="../Images/1232c6c12738a47b14885ea2b4e8a07c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Prfq13htFNA6KbIsKCU_A.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 21 Apply Service</figcaption></figure><p id="f70a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">检查服务状态。</p><pre class="mi mj mk ml gt mo mp mq mr aw ms bi"><span id="144f" class="mt lg in mp b gy mu mv l mw mx">kubectl get service</span></pre><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ob"><img src="../Images/2c51608c8da418b9e5d936ec1a083ce7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Za3ZT95_sSOUtfS_xkXgVw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 22 Check Services</figcaption></figure><p id="6ffc" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">应用(创建/更新)入口。</p><pre class="mi mj mk ml gt mo mp mq mr aw ms bi"><span id="38f6" class="mt lg in mp b gy mu mv l mw mx">kubectl apply -f ingress.yaml</span></pre><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oc"><img src="../Images/96bf16345a8aecbcf285558737eef31a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7q1FWp5rSQHC44ymYMzEJA.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 23 Apply Ingress</figcaption></figure><p id="ad9a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">使用以下命令查找入口负载平衡器的公共IP。我们将从命令输出中找到公共IP。</p><pre class="mi mj mk ml gt mo mp mq mr aw ms bi"><span id="2d1a" class="mt lg in mp b gy mu mv l mw mx">kubectl get ingress go-hostname-ingress --output yaml</span></pre><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oa"><img src="../Images/31c9707421bb7ce4b85912e6425c1284.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kF34De-1z_UuPhraikK7qg.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 24 Check Ingress</figcaption></figure><p id="4bef" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">不错，似乎我们的Kubernetes集群配置已经完成。让我们转到测试部分。</p><h1 id="9446" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">4.测试</h1><p id="52d3" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">打开web浏览器，尝试使用公共IP地址访问负载平衡器入口。我们需要几分钟时间让负载平衡器准备好为Kubernetes集群服务。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi od"><img src="../Images/f80777dffe8b7339d7da4a21a20f046d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KoTDKip8l-9tMbqG20Mdxw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 25 Testing Kubernetes Ingress</figcaption></figure><p id="5a74" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">或者我们可以用curl来测试连接。</p><pre class="mi mj mk ml gt mo mp mq mr aw ms bi"><span id="3f7a" class="mt lg in mp b gy mu mv l mw mx">for ((i=1;i&lt;=10;i++)); do curl -s <a class="ae jz" href="http://35.241.26.86" rel="noopener ugc nofollow" target="_blank">http://35.241.26.86</a> ; done | sort | uniq</span></pre><figure class="mi mj mk ml gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oc"><img src="../Images/a51fccd74d72048d43da826ce23bfc3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zFakNYpbMCPsysihnErBQw.png"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Picture 26 Testing Kubernetes Ingress by CURL</figcaption></figure><p id="1793" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Yuuuhuuu，是作品！现在我们可以访问使用Google Kubernetes引擎部署的Go应用程序了！</p><p id="de67" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果你想看Kubernetes配置的例子，你可以访问我的github库:</p><div class="oe of gp gr og oh"><a href="https://github.com/moemoe89/go-kubernetes-t3" rel="noopener  ugc nofollow" target="_blank"><div class="oi ab fo"><div class="oj ab ok cl cj ol"><h2 class="bd io gy z fp om fr fs on fu fw im bi translated">moemoe89/go-kubernetes-t3</h2><div class="oo l"><h3 class="bd b gy z fp om fr fs on fu fw dk translated">这个项目为实践Kubernetes为实践pod，找到一个在pod知识库实现的例子。对于…</h3></div><div class="op l"><p class="bd b dl z fp om fr fs on fu fw dk translated">github.com</p></div></div><div class="oq l"><div class="or l os ot ou oq ov jt oh"/></div></div></a></div><p id="07a4" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">希望你喜欢它，我很高兴如果这篇文章对你有用！部署愉快！</p><p id="8946" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">谢谢大家！</p></div></div>    
</body>
</html>