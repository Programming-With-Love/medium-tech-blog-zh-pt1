<html>
<head>
<title>Converting your Android App to Jetpack</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将您的Android应用程序转换为Jetpack</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/converting-your-android-app-to-jetpack-85aecfce34d3?source=collection_archive---------0-----------------------#2018-11-27">https://medium.com/google-developer-experts/converting-your-android-app-to-jetpack-85aecfce34d3?source=collection_archive---------0-----------------------#2018-11-27</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="aea9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Google已经将他们的支持库重新命名为Jetpack(又名AndroidX)。开发人员需要对此进行修改。</p><p id="5df9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">本文将解释这意味着什么，以及如何开始转换您的项目以使用新的组件。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jc"><img src="../Images/2722be69685366bceb6524177bce1e75.png" data-original-src="https://miro.medium.com/v2/resize:fit:600/format:webp/1*OFJKA8dRYZSb-Kprx-VReg.png"/></div><figcaption class="jk jl et er es jm jn bd b be z dx">Jetpack to the future</figcaption></figure><h1 id="536c" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">什么是Jetpack？</h1><p id="62ab" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">Android Jetpack是一套库、工具和架构指南，旨在简化Android应用的构建。它旨在提供通用的基础设施代码，以便开发人员可以专注于编写使应用程序独一无二的东西。</p><p id="4683" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是一项大规模的工作，旨在改善开发人员的体验，并将有用的工具和框架收集到一个有凝聚力的单元中。</p><p id="2463" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这句来自<a class="ae kr" href="https://twitter.com/alanviverette" rel="noopener ugc nofollow" target="_blank"> Alan Viverette </a> (Android框架团队)的话是一个很好的总结:</p><blockquote class="ks"><p id="d6a6" class="kt ku hh bd kv kw kx ky kz la lb jb dx translated">“Jetpack是一项旨在改善开发人员体验的更大规模的努力，但AndroidX构成了技术基础。从技术角度来看，它仍然是您在“支持库和体系结构组件”下看到的那些库。”</p></blockquote><h1 id="3265" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz lc kb kc kd ld kf kg kh le kj kk kl bi translated">为什么？</h1><p id="4a98" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">为什么谷歌要经历所有这些麻烦(并给开发者制造所有这些麻烦)？</p><ul class=""><li id="4620" class="lf lg hh ig b ih ii il im ip lh it li ix lj jb lk ll lm ln bi translated">创建一个一致的名称空间(<em class="lo"> androidx)。* </em>)为支持库</li><li id="53d5" class="lf lg hh ig b ih lp il lq ip lr it ls ix lt jb lk ll lm ln bi translated">更好地支持工件的<a class="ae kr" href="https://semver.org/" rel="noopener ugc nofollow" target="_blank">语义版本</a>(从1.0.0开始)。这使得它们可以独立更新。</li><li id="c12d" class="lf lg hh ig b ih lp il lq ip lr it ls ix lt jb lk ll lm ln bi translated">创建一个通用的保护伞来开发下的所有支持组件。</li></ul><p id="c3a1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">值得一提的是，当前版本的AppCompat(v28.x)是最终版本。这段代码的下一个版本将专门使用Jetpack。开发人员必须意识到这一点，并尽早进行转换。</p><p id="3ec0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Alan Viverette的这段话很好地总结了这一点:</p><blockquote class="ks"><p id="d734" class="kt ku hh bd kv kw kx ky kz la lb jb dx translated">“不会有29.0.0，所以Android Q APIs只会在AndroidX中”</p></blockquote><h1 id="aefb" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz lc kb kc kd ld kf kg kh le kj kk kl bi translated">喷气背包里有什么？</h1><p id="e653" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">答案是:一切。</p><p id="687d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Jetpack是我们一直在使用的许多现有库(如AppCompat、Permissions、Notifications或Transitions)和近年来引入的新架构组件(如LiveData、Room、WorkManager或ViewModel)的集合。</p><p id="09e6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">开发人员可以期待从AppCompat获得同样的好处，包括向后兼容性和不依赖于制造商操作系统更新的发布周期。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es lu"><img src="../Images/ca0299c6b004e55adc22eba7ec3b11a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jqDYNqVXgbn8zfC1v6qunQ.png"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx">Jetpack Components</figcaption></figure><h1 id="984e" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">你必须现在升级吗？能否只更新部分代码？</h1><p id="f5ea" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">今天不一定要更新，但是近期某个时候一定要更新。</p><p id="9692" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当前版本的AppCompat (v28.x)与AndroidX (v1.x)完全相同。事实上，AppCompat库是通过改变maven坐标和AndroidX代码库的包名而由机器生成的。</p><p id="6027" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">例如，旧的坐标和包是:</p><pre class="jd je jf jg fd lz ma mb mc aw md bi"><span id="356a" class="me jp hh ma b fi mf mg l mh mi">implementation<em class="lo"> “</em><strong class="ma hi">com.android.support:appcompat-v7:<em class="lo">28.0.0</em></strong><em class="lo">"</em><br/>import <strong class="ma hi">android.support.v4</strong>.widget.DrawerLayout</span></pre><p id="5264" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在是:</p><pre class="jd je jf jg fd lz ma mb mc aw md bi"><span id="3875" class="me jp hh ma b fi mf mg l mh mi">implementation <strong class="ma hi">'androidx.appcompat:appcompat:1.0.2'</strong><br/>import<strong class="ma hi"> androidx.drawerlayout.</strong>widget.DrawerLayout</span></pre><p id="b1b7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">需要注意的是，不能在同一个项目中混合使用AppCompat和Jetpack。如果要升级，您必须转换所有内容以使用Jetpack。</p><h1 id="18e7" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">第一步—将您的应用升级到最新的支持库</h1><p id="8cbb" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">当您准备好更新到Jetpack时，请确保您的应用程序已升级到Gradle和AppCompat的最新版本。这将确保重构仅仅是<em class="lo">改变包名，而不是<em class="lo">与库更新相关的更大问题</em>。</em></p><p id="5130" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">更新你的项目是非常重要的，它会暴露出你前进过程中遇到的任何问题，比如对旧版本库的长期依赖。如果您无法更新到最新版本，则需要先解决这些问题，然后才能继续。</p><p id="2e28" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">不要忘记查看:<a class="ae kr" href="https://maven.google.com" rel="noopener ugc nofollow" target="_blank">https://maven.google.com</a>最新的Gradle依赖信息。</p><h1 id="22ac" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">使用重构工具更新您的项目</h1><p id="63e7" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">一旦您升级了您的项目，您将使用Android Studio (AS)实用程序来进行重构。</p><p id="ff28" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从菜单中运行:<em class="lo">Refactor \ Refactor to Android x:</em></p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mj"><img src="../Images/cd19d86235fcf3106949fca0483749a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*geyQI-VjQ8KCOk9uFw74iA.png"/></div><figcaption class="jk jl et er es jm jn bd b be z dx">Android Studio AndroidX refactor tool</figcaption></figure><p id="ce8e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该工具将扫描您的应用，并显示必要更改的预览:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mk"><img src="../Images/8f91f155f1dc1c3f81f7f5af8563a729.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3W7e5p9xQTnACbN8qw_R3w.png"/></div></div></figure><p id="91b2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您对更改感到满意，请选择“Do Refactor”按钮，转换工具将执行以下三项操作:</p><ul class=""><li id="55fd" class="lf lg hh ig b ih ii il im ip lh it li ix lj jb lk ll lm ln bi translated">更新您的导入以反映新的包名:</li></ul><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es ml"><img src="../Images/0974ab1fd261a1f6c4dbc66f8f75a9c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B1-nWakyH4JtiUYZzQsCLg.png"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx">Only the package names changed, everything else is exactly the same</figcaption></figure><ul class=""><li id="65bc" class="lf lg hh ig b ih ii il im ip lh it li ix lj jb lk ll lm ln bi translated">更新您的依赖关系的梯度坐标</li></ul><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="lv lw di lx bf ly"><div class="er es mm"><img src="../Images/c7fa01245c3260ca1667af8dea2c1932.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O-bGy-pnnowcGUYT21EEPQ.png"/></div></div><figcaption class="jk jl et er es jm jn bd b be z dx">Note: I replaced “compile” with “implementation” manually, the tool didn’t do that part</figcaption></figure><ul class=""><li id="edb4" class="lf lg hh ig b ih ii il im ip lh it li ix lj jb lk ll lm ln bi translated">向您的<em class="lo"> gradle.properties </em>文件添加2个标志。第一个标志告诉Android插件使用<em class="lo"> AndroidX </em>包，而不是<em class="lo"> AppCompat </em>，第二个标志将启用<em class="lo"> Jetifier </em>，这是一个帮助使用外部库的工具(详见下一节):</li></ul><pre class="jd je jf jg fd lz ma mb mc aw md bi"><span id="7c47" class="me jp hh ma b fi mf mg l mh mi"><strong class="ma hi">android.useAndroidX</strong>=<strong class="ma hi">true<br/>android.enableJetifier</strong>=<strong class="ma hi">true</strong></span></pre><p id="52cc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一般来说，这些变化应该只局限于这三个方面，但是根据我的经验，我已经看到refactor工具还做了其他的变化。在我的例子中，工具添加了代码来解释Kotlin的可空性(它添加了一些<em class="lo">！！在我的源代码中)，但可能会有其他变化。密切监视该工具所做的所有更改，并确保您对它们感到满意，这确实是一个好主意。</em></p><h1 id="ce6f" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">喷射器</h1><p id="a67b" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">AS refactor工具只对项目中的源代码进行更改。它不会对库或外部依赖项进行任何更改。</p><p id="3660" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为此，谷歌创建了一个名为<em class="lo"> Jetifier </em>的工具，旨在自动转换传递依赖关系，以便在构建时使用AndroidX库。如果我们没有这个工具，我们将需要等待每一个第三方库更新，然后才能使用它(并推迟我们的更新，直到它准备好)。</p><p id="e414" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">除了使用gradle标志启用这个工具之外，没有多少关于使用它的知识，因为这是一个自动化的过程，不需要任何配置。</p><p id="7db5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">谷歌最近宣布了一个运行Jetifier的独立选项。你甚至可以运行一个“反向模式”来“去jetify化”代码(这对调试非常有用)。</p><h1 id="e982" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">你可能遇到的问题</h1><p id="179a" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">您可能会发现需要更新的第三方库。例如，有人发现当前版本的SqlDelight需要旧版本的Room持久性库。他们要求更新，Square已经提供了库的更新版本。如果您发现了一个问题，越早向开发人员请求更新越好。Room的最新版本(v2.1)已经需要AndroidX，这可能会导致许多人升级。在撰写本文时，脸书SDK还没有更新，这可能会成为许多人的障碍。</p><p id="bca2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将您的项目更新到AppCompat的最新版本可能并不容易。您可能在代码中找到了以前错误的解决方法，或者遇到了需要大量返工的升级。提前计划好这项工作。</p><p id="335a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Jetifier不修改源文件，所以在使用文档时这可能会令人困惑。</p><p id="7aa0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你不能通过模块Jetify，所以这是你代码库上的一个“全有或全无”的操作。这可能需要阻止正在进行的开发，直到这个问题得到解决——否则您可能会遇到巨大的合并噩梦。</p><p id="eca3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">映射工具可能会将<em class="lo"> alpha </em>依赖项插入到您的代码中(例如添加了ConstraintLayout alpha)。</p><p id="160e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Android Studio可能不知道Jetifier和显示错误(红色曲线)。执行无效缓存并重启应该可以解决这个问题。</p><p id="b745" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Jetifier不修改生成的代码，这可能需要额外的返工。</p><p id="2375" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一些替换名称没有正确映射(这些似乎主要来自<em class="lo">设计</em>库)。重构工具不适用于这些情况，您的代码将无法编译。要解决这些问题，您需要手动解决导入问题。希望随着时间的推移，随着工具的成熟和重构工具中的错误被修复，这些问题将被最小化。</p><p id="ab4d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">有用提示</strong>:<br/>Jetpack的标准命名约定是将包名复制到Maven坐标中。在Jetpack中，包将<em class="lo">总是</em>匹配groupid。</p><p id="68bb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">例如，如果您知道包名是`<strong class="ig hi"> androidx.webkit </strong>`,那么依赖项将映射到:`<strong class="ig hi"><em class="lo">androidx . WebKit</em></strong>:WebKit:version `。</p><h1 id="2840" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">摘要</h1><p id="e1d5" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">提前计划迁移到Jetpack所需的更改，这是继续前进所必需的。升级最困难的部分可能是将您的项目更新到最新的依赖项。</p><p id="bdd3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">可能有第三方库尚未更新。尽早发现这些问题并要求开发人员对其进行更新是非常重要的。</p><h1 id="5bc5" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">资源</h1><p id="33f8" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">旧类名到新类名的完整映射，如果你有自动化重构的问题，或者需要找出一个具体的变化，这是很有用的。</p><p id="b0ae" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">丹·卢的伟大的<a class="ae kr" href="https://blog.danlew.net/2018/11/14/the-reality-of-migrating-to-androidx/" rel="noopener ugc nofollow" target="_blank">文章</a>，强调了他重构项目的经历(和遇到的问题)。</p><p id="a2ec" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">来自Android开发者的Jetpack <a class="ae kr" href="https://android-developers.googleblog.com/2018/05/google-io-2018-whats-new-in-android.html" rel="noopener ugc nofollow" target="_blank">博客文章</a>介绍。</p><p id="2d56" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">感谢<a class="mn mo ge" href="https://medium.com/u/eb4fea6f1f11?source=post_page-----85aecfce34d3--------------------------------" rel="noopener" target="_blank">埃利奥特·米切尔</a>的校对和启发！</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mp"><img src="../Images/50e42145a9df6dbc5dd7eb00dd61132e.png" data-original-src="https://miro.medium.com/v2/resize:fit:2/0*AEDw8ri2tACFgbZe.gif"/></div></figure></div></div>    
</body>
</html>