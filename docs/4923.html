<html>
<head>
<title>Avoid cascading if-else in Kotlin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Kotlin中避免级联if-else</h1>
<blockquote>原文：<a href="https://blog.kotlin-academy.com/why-to-avoid-if-else-if-in-kotlin-d2bc57ebb53e?source=collection_archive---------0-----------------------#2020-09-19">https://blog.kotlin-academy.com/why-to-avoid-if-else-if-in-kotlin-d2bc57ebb53e?source=collection_archive---------0-----------------------#2020-09-19</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><p id="94ca" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">Kotlin <a class="ae ki" href="https://kotlinlang.org/docs/reference/coding-conventions.html#if-versus-when" rel="noopener ugc nofollow" target="_blank">编码约定</a>表示我们应该倾向于用<code class="fe kj kk kl km b">if</code>表示二进制，用<code class="fe kj kk kl km b">when</code>表示三个或更多选项。</p><ol class=""><li id="b47d" class="kn ko in jm b jn jo jr js jv kp jz kq kd kr kh ks kt ku kv bi translated">为什么？</li><li id="19a9" class="kn ko in jm b jn kw jr kx jv ky jz kz kd la kh ks kt ku kv bi translated">为什么在三个或更多选项中，<code class="fe kj kk kl km b">when</code>是首选？</li><li id="d86a" class="kn ko in jm b jn kw jr kx jv ky jz kz kd la kh ks kt ku kv bi translated">为什么IntelliJ IDEA/Android studio用“Cascade if应该替换为when”来警告我们？</li></ol><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi lb"><img src="../Images/ace288600f95770325c2e097e62ce1fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iScihjadkBCTDMLxbzd02Q.jpeg"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">If-else hell</figcaption></figure><h1 id="477c" class="lr ls in bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">理解Kotlin和Java if-else</h1><ul class=""><li id="48ee" class="kn ko in jm b jn mp jr mq jv mr jz ms kd mt kh mu kt ku kv bi translated">让我们举一个级联if的例子。</li><li id="fc45" class="kn ko in jm b jn kw jr kx jv ky jz kz kd la kh mu kt ku kv bi translated">让我们检查反编译的字节码。</li><li id="7f64" class="kn ko in jm b jn kw jr kx jv ky jz kz kd la kh mu kt ku kv bi translated">我们先来了解一下为什么首选<code class="fe kj kk kl km b">when</code>。</li><li id="4cba" class="kn ko in jm b jn kw jr kx jv ky jz kz kd la kh mu kt ku kv bi translated">让我们一起来解决一个难题。</li></ul><h1 id="055a" class="lr ls in bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">级联If</h1><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi mv"><img src="../Images/759142aedacf8bf7b224aa7fda7ea88a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*86g52md_HFALXfAPRmye3Q.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Kotlin version</figcaption></figure><p id="e21d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">对于上面的代码，IDE抛出一个甜蜜的警告，自动“用<code class="fe kj kk kl km b">when</code>替换<code class="fe kj kk kl km b">if</code>”。在我们盲目使用它之前，让我们更深入地挖掘。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi mv"><img src="../Images/2802d49ab57d6c1233a96efedcc6ac05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eAGyCsxFkhqfMOArxRwZ2g.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Decompiled version</figcaption></figure><p id="8c58" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">反编译后的代码显示Kotlin在Java中编译成普通的<code class="fe kj kk kl km b">if-else</code>。一切看起来都很好。</p><p id="bc2d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">更换If - &gt;当</strong> <br/>让我们使用Intellij/Android studio的建议，并在使用<code class="fe kj kk kl km b">when</code>时检查引擎盖下有什么。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi mw"><img src="../Images/b1d9ba3b103c88001eb93f9c5fbb386e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eSxYbdFoX4KsacVDYYz-OA.png"/></div></div></figure><p id="4704" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果是二进制的，编译器将<code class="fe kj kk kl km b">when</code>转换为<code class="fe kj kk kl km b">if-else</code>，如果有两个以上的选项，则转换为<code class="fe kj kk kl km b">switch</code>(常量情况)。</p><h2 id="7c03" class="mx ls in bd lt my mz dn lx na nb dp mb jv nc nd mf jz ne nf mj kd ng nh mn ni bi translated">Java中为什么要使用if-else上的switch？</h2><ul class=""><li id="f39f" class="kn ko in jm b jn mp jr mq jv mr jz ms kd mt kh mu kt ku kv bi translated"><strong class="jm io">多路分支:</strong> Switch语句将被编译，编译器将检查每个case常量(在Switch中所有的case都是常量)。检查之后，它将创建一个“跳转表”，用于根据表达式值选择执行路径。因此，与if-else序列相比，switch语句对于一大组值将运行得更快。<br/> Switch运行得更快，因为编译器知道所有的case常量都是相同的类型，它只是比较表达式是否相等。if-else就不是这种情况了。</li><li id="a6e1" class="kn ko in jm b jn kw jr kx jv ky jz kz kd la kh mu kt ku kv bi translated">速度:考虑到事例的数量，switch语句可能比级联if语句更快。小于5的开关箱可能不会更快，所以如果开关箱大于5，最好选择开关箱。多于五项的开关使用查找表或哈希列表。这使得理想情况下可能具有相同的访问时间。另一方面，if-else序列需要更多的时间，因为它必须线性地评估每个条件。</li></ul><h1 id="d1c6" class="lr ls in bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">当表达在科特林</h1><p id="c465" class="pw-post-body-paragraph jk jl in jm b jn mp jp jq jr mq jt ju jv nj jx jy jz nk kb kc kd nl kf kg kh ig bi translated">Kotlin中的<code class="fe kj kk kl km b"><a class="ae ki" href="https://kotlinlang.org/docs/reference/control-flow.html#when-expression" rel="noopener ugc nofollow" target="_blank">when</a></code> <a class="ae ki" href="https://kotlinlang.org/docs/reference/control-flow.html#when-expression" rel="noopener ugc nofollow" target="_blank">表达式</a>根据其常量或任意表达式的条件替换为<code class="fe kj kk kl km b">if-else</code>的<code class="fe kj kk kl km b">switch</code>语句或序列。如果所有条件都是常数，并且有2个以上的条件，那么它将被编译成一个<code class="fe kj kk kl km b">switch</code>。在其他任何情况下，它都是引擎盖下的<code class="fe kj kk kl km b">if-else</code>。</p><h1 id="43c1" class="lr ls in bd lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo bi translated">恒定情况场景</h1><p id="1afc" class="pw-post-body-paragraph jk jl in jm b jn mp jp jq jr mq jt ju jv nj jx jy jz nk kb kc kd nl kf kg kh ig bi translated">尽管switch只在较大的选项组中表现良好，但Kotlin仍然将when转换为两个以上选项的表达式的开关。</p><p id="59e5" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">为什么</strong>是科特林转换成<code class="fe kj kk kl km b">switch</code>？为了理解这一点，我们需要了解科特林的<code class="fe kj kk kl km b">if-else</code>是如何工作的。</p></div><div class="ab cl nm nn hr no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ig ih ii ij ik"><h1 id="e23f" class="lr ls in bd lt lu nt lw lx ly nu ma mb mc nv me mf mg nw mi mj mk nx mm mn mo bi translated">如果在科特林</h1><p id="04d0" class="pw-post-body-paragraph jk jl in jm b jn mp jp jq jr mq jt ju jv nj jx jy jz nk kb kc kd nl kf kg kh ig bi translated"><code class="fe kj kk kl km b">If-else</code>是一个<strong class="jm io">表达式</strong>，也是Kotlin中的一个语句，即它返回一个值，也可以作为一个语句使用。<br/> <em class="ny">在繁体Java中</em> <code class="fe kj kk kl km b"><em class="ny">if-else</em></code> <em class="ny">是一种说法。</em></p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi mv"><img src="../Images/e34d73946ffb0649dd50972f448da676.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GEfsMPoZvA6yMJvern_fmw.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Java if-else vs Kotlin if-else</figcaption></figure><p id="67fb" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">为了更多地了解if条件是如何工作的，我们还可以看看它的语法。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi mv"><img src="../Images/3a6e518abc5478a754372c16d043a98c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*it3yGm4BlXZN8LKxtXFc9Q.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">Grammar for If in Kotlin</figcaption></figure><p id="e793" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果你理解了<code class="fe kj kk kl km b">if</code>的语法，那么你就会明白有一个微妙的问题会让Java开发人员感到困惑。让我们用一个谜题来探究一下。</p></div><div class="ab cl nm nn hr no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ig ih ii ij ik"><h1 id="49fb" class="lr ls in bd lt lu nt lw lx ly nu ma mb mc nv me mf mg nw mi mj mk nx mm mn mo bi translated">谜题</h1><p id="26ae" class="pw-post-body-paragraph jk jl in jm b jn mp jp jq jr mq jt ju jv nj jx jy jz nk kb kc kd nl kf kg kh ig bi translated">Kotlin开发人员想出警告规则来避免级联<code class="fe kj kk kl km b">if-else</code>可能有很多原因。这个难题显示了避免的原因之一，尤其是在常量的情况下。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi mv"><img src="../Images/506de201fb9cfa93bd0ce8b781c29b22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qc5YIu_3RurcgMBAbf2tIg.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">invoking fun cascadingIfElse()</figcaption></figure><p id="dbfa" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果我们调用它，上面的打印结果会是什么？<br/>1)0<br/>2)1<br/>3)-1<br/>4)不会编译<br/> 5)不会打印<br/> 6)运行时异常</p><p id="069d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi">?</p><p id="a5b8" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi">?</p><p id="f384" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi">?</p><p id="c7f4" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi">?</p><p id="225a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi">?</p><p id="fcaf" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi">?</p><p id="59cd" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi">?</p><p id="1b4d" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi">?</p><p id="243a" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi">?</p><p id="4b06" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated"><strong class="jm io">它不会打印任何东西… <br/> </strong>因为<strong class="jm io"> If-Else </strong>是单个表达式，而<strong class="jm io"> let </strong>在最后一个表达式上被调用。</p><p id="77fc" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">该代码可以解读为:</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi mv"><img src="../Images/354ded949a889704e4e54bda439b212e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iKqv5pw0C1rJz1O_ifX5GA.png"/></div></div></figure><p id="0880" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">我们很容易被这样的谜题弄糊涂，所以多了解一些Kotlin编译器策略对有效使用Kotlin总是有好处的。</p></div><div class="ab cl nm nn hr no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ig ih ii ij ik"><h1 id="225c" class="lr ls in bd lt lu nt lw lx ly nu ma mb mc nv me mf mg nw mi mj mk nx mm mn mo bi translated">最佳实践</h1><p id="36d7" class="pw-post-body-paragraph jk jl in jm b jn mp jp jq jr mq jt ju jv nj jx jy jz nk kb kc kd nl kf kg kh ig bi translated">花一些时间在代码的IDE警告上。IDE试图教你一些东西。保持好奇，调查为什么会出现警告，并进行更多探索。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="gh gi nz"><img src="../Images/10e0eaedecc158708c9bf7bd53780ac9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QVs3WuozSxUfWHo2e-CscA.png"/></div></div><figcaption class="ln lo gj gh gi lp lq bd b be z dk">IDE warning</figcaption></figure></div><div class="ab cl nm nn hr no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ig ih ii ij ik"><h1 id="de1c" class="lr ls in bd lt lu nt lw lx ly nu ma mb mc nv me mf mg nw mi mj mk nx mm mn mo bi translated">TL；博士:</h1><ul class=""><li id="7984" class="kn ko in jm b jn mp jr mq jv mr jz ms kd mt kh mu kt ku kv bi translated"><code class="fe kj kk kl km b">If else</code>是<strong class="jm io">一个表达式。</strong></li><li id="b1f1" class="kn ko in jm b jn kw jr kx jv ky jz kz kd la kh mu kt ku kv bi translated">级联<strong class="jm io"> if-else </strong>会导致代码中出现地雷。</li><li id="d00a" class="kn ko in jm b jn kw jr kx jv ky jz kz kd la kh mu kt ku kv bi translated">Kotlin <strong class="jm io"> when </strong>被有效地编译成一个<strong class="jm io"> if-else </strong>或<strong class="jm io">开关，Java中的</strong>，这取决于条件的数量及其状态(常量或任意)。</li><li id="a42e" class="kn ko in jm b jn kw jr kx jv ky jz kz kd la kh mu kt ku kv bi translated">级联if-else上的作用域函数如果没有正确封装，总是一个代码矿。</li><li id="4d7a" class="kn ko in jm b jn kw jr kx jv ky jz kz kd la kh mu kt ku kv bi translated">永远不要忽略IDE警告——永远不要。</li></ul></div><div class="ab cl nm nn hr no" role="separator"><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr ns"/><span class="np bw bk nq nr"/></div><div class="ig ih ii ij ik"><h1 id="670b" class="lr ls in bd lt lu nt lw lx ly nu ma mb mc nv me mf mg nw mi mj mk nx mm mn mo bi translated">点击👏说“谢谢！”并帮助他人找到这篇文章。</h1><p id="42c3" class="pw-post-body-paragraph jk jl in jm b jn mp jp jq jr mq jt ju jv nj jx jy jz nk kb kc kd nl kf kg kh ig bi translated">了解卡帕头最新的重大新闻。学院，<a class="ae ki" href="https://kotlin-academy.us17.list-manage.com/subscribe?u=5d3a48e1893758cb5be5c2919&amp;id=d2ba84960a" rel="noopener ugc nofollow" target="_blank">订阅时事通讯</a>，<a class="ae ki" href="https://twitter.com/ktdotacademy" rel="noopener ugc nofollow" target="_blank">观察Twitter </a>并在Medium上关注我们。</p><p id="e64c" class="pw-post-body-paragraph jk jl in jm b jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ig bi translated">如果您需要Kotlin工作室，请查看我们如何帮助您:<a class="ae ki" href="https://kt.academy/" rel="noopener ugc nofollow" target="_blank"> kt.academy </a>。</p><figure class="lc ld le lf gt lg gh gi paragraph-image"><a href="https://kotlin-academy.us17.list-manage.com/subscribe?u=5d3a48e1893758cb5be5c2919&amp;id=d2ba84960a"><div class="gh gi oa"><img src="../Images/3146970f03e44cb07afe660b0d43e045.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*54OqlYA4etu7wfpmMP5TKQ.png"/></div></a></figure></div></div>    
</body>
</html>