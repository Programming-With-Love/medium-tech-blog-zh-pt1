<html>
<head>
<title>Calculations in AWS QuickSight</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS QuickSight中的计算</h1>
<blockquote>原文：<a href="https://medium.com/version-1/calculations-in-aws-quicksight-ba95a4fafcda?source=collection_archive---------0-----------------------#2022-09-27">https://medium.com/version-1/calculations-in-aws-quicksight-ba95a4fafcda?source=collection_archive---------0-----------------------#2022-09-27</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/bd22706a0aaedf535275f414ee2b6c99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qerK_RdzNI-yG_Qn"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Image from Inesdi Digital Business School</figcaption></figure><p id="1b75" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">在构建可视化效果时，理解计算是如何定义的、计算结果是如何显示的，以及在应用一些过滤器或与其余数据交互时，计算结果将如何反应，这一点非常重要。这将有助于我们构建更好的可视化，并以最佳方式获得数据的价值。</p><p id="1a83" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">在QuickSight中，可以在分析图层或数据集图层中定义计算。<br/>当在分析层中定义时，计算总是在分析/仪表板负载上进行评估。<br/>如果推送到数据集层，将预先计算行级别的计算并存储结果(即，如果数据集处于<a class="ae jr" href="https://docs.aws.amazon.com/quicksight/latest/user/managing-spice-capacity.html" rel="noopener ugc nofollow" target="_blank"> SPICE </a>模式)。<br/>将聚合计算推送到数据集层有助于集中存储计算，使其可供所有数据集用户随时使用。但是，这不会产生任何额外的性能优势，因为聚合计算总是在使用它的可视化环境中进行评估。</p><p id="039d" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">理解滤波器、计算和聚合的<a class="ae jr" href="https://docs.aws.amazon.com/quicksight/latest/user/order-of-evaluation-quicksight.html" rel="noopener ugc nofollow" target="_blank">评估顺序</a>非常重要。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es js"><img src="../Images/e99038c5da579bf12158a853f9f3b15d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/format:webp/1*VGKBB8JZaIWfIlYjQk4Yow.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Evaluation order QuickSight</figcaption></figure><p id="25d0" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">我们将通过一些例子进一步探讨这个顺序。我们将使用包含订单信息的销售数据集。我们将重点关注细分市场、行业、销售和利润领域，我们将构建一些指标来说明这些示例。</p><p id="5fe8" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">我们将使用可在所有维度上汇总或聚合的附加度量，以及不可在所有维度上汇总或聚合的非附加度量。</p></div><div class="ab cl jx jy go jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="ha hb hc hd he"><p id="c463" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">成本是销售额减去利润，它是一个附加的衡量标准。我们将为成本创建两个计算字段(行和聚合)并比较结果。</p><pre class="jt ju jv jw fd ke kf kg kh aw ki bi"><span id="97fc" class="kj kk hh kf b fi kl km l kn ko">Row Cost: {Sales}-{Profit}<br/>Aggregate Cost: sum({Sales})-sum({Profit})</span></pre><p id="49d3" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">我们将创建一个表(行与合计计算)来比较这些计算，添加字段细分、利润、销售、行成本和合计成本。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div class="er es kp"><img src="../Images/0d8edbbbfadb618916b5054fd2878878.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*n3qtjYPMyocMuuqniH5XGw.png"/></div></figure><p id="f34e" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">由于成本是相加的，行和合计级别的计算给出了相同的结果。在这种情况下，使用行级版本并将其包含在数据集层中，以便在SPICE数据集刷新时提前完成行级计算。</p><p id="f606" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">利润率是利润除以销售额，它是一个非加性指标。我们将为利润率创建两个计算字段(行和合计)，将它们添加到前面的表中，并比较结果。这将有助于清楚地理解这种计算是如何工作的。</p><pre class="jt ju jv jw fd ke kf kg kh aw ki bi"><span id="4b5e" class="kj kk hh kf b fi kl km l kn ko">Row Profit Margin (Incorrect): {Profit}/{Sales}<br/>Aggregate Profit Margin: sum({Profit})/sum({Sales})</span></pre><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kq"><img src="../Images/5885d01ed2ed4d872b4f4103ef93f639.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fZ5PbW3ijfT8dvFwJ1KUyg.png"/></div></div></figure><p id="31c9" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">行利润率是数据行级别的计算。此后，它就像一个常规的聚合测量一样被汇总，因此在细分字段级别和总体级别最终是不正确的。我们可以看到，针对现场井计算的聚合模式是SUM。正确的版本是获得每个细分市场的利润和销售额之和，然后进行除法运算。对于合计行，它使用总利润和总销售额。因此，我们得到了预期的结果。请注意，对于此计算，聚合模式是CUSTOM。因此，使用汇总衡量标准构建非累加性KPI的计算。</p></div><div class="ab cl jx jy go jz" role="separator"><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc kd"/><span class="ka bw bk kb kc"/></div><div class="ha hb hc hd he"><p id="b52c" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">我们现在将创建一些<a class="ae jr" href="https://docs.aws.amazon.com/quicksight/latest/user/level-aware-calculations.html" rel="noopener ugc nofollow" target="_blank">级别感知聚合计算</a>。</p><pre class="jt ju jv jw fd ke kf kg kh aw ki bi"><span id="5355" class="kj kk hh kf b fi kl km l kn ko">Overall Sales [PRE_FILTER]: sumOver(Sales,[],PRE_FILTER)<br/>Overall Sales [PRE_AGG]: sumOver(Sales,[],PRE_AGG)<br/>Overall Sales [POST_AGG_FILTER]: sumOver(sum(Sales),[],POST_AGG_FILTER)</span></pre><p id="0c88" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">我们将创建一个表(级别感知聚合),将它们添加到行业和销售字段中。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kr"><img src="../Images/9ad96e29fcfc5551681c52b01b9cc52d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KmfFCnSMxjh_lgO8sZcMaw.png"/></div></div></figure><p id="e69f" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">此时，所有三个计算字段都显示了整个数据集的总销售额(即，与此视图中的总销售额列的值相同)。</p><p id="de95" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">我们将为行业字段添加一个过滤器，并取消选择杂项值。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ks"><img src="../Images/a2a5b274c6390045d5f611c0b0d0e0d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1To3t7TzmWbY41MU2xNmlw.png"/></div></div></figure><p id="3035" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">我们可以看到PRE_FILTER值保持不变(因为它们在分析过滤器之前得到评估)，而PRE_AGG、POST_AGG_FILTER和Sales列的表total下降到一个新值，不包括Misc类别。</p><p id="eae2" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">我们现在将为“行业”字段添加一个顶部/底部过滤器，以仅显示销售额最高的5个行业。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kt"><img src="../Images/e412395f57d4f79b41db2b7007854a7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oBTBWuyYtKv-h3NGA5XA8Q.png"/></div></div></figure><p id="361a" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">我们可以看到PRE_FILTER值和PRE_AGG值与它们之前的值保持不变(因为它们在Top/Bottom筛选器之前被评估),而POST_AGG_FILTER和table total for Sales列下降到新值，只包括前5个行业的销售额。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ku"><img src="../Images/c569f061e3d075a15e10f3a51a5a5e6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kcgdlmbz6RSfbvQqlAisCg.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo by <a class="ae jr" href="https://unsplash.com/@homajob?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Scott Graham</a> on <a class="ae jr" href="https://unsplash.com/s/photos/spreadsheet?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="4178" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">为累加性度量构建计算时，请在数据集层中使用行级度量，而为非累加性度量构建计算时，请使用聚合度量。</p><p id="67b0" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">理解AWS QuickSight 中的<a class="ae jr" href="https://docs.aws.amazon.com/quicksight/latest/user/order-of-evaluation-quicksight.html" rel="noopener ugc nofollow" target="_blank">评估顺序也很重要，过滤器将如何与我们的数据交互，以及我们希望在每种情况下显示什么信息，这样我们就能够用高质量的信息构建可理解的仪表板。</a></p><p id="62e1" class="pw-post-body-paragraph it iu hh iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated"><em class="kv">来源:AWS </em></p><h1 id="3432" class="kw kk hh bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">关于作者:</h1><p id="3092" class="pw-post-body-paragraph it iu hh iv b iw lt iy iz ja lu jc jd je lv jg jh ji lw jk jl jm lx jo jp jq ha bi translated">大卫·赫南德兹是Version 1的高级数据工程师。</p></div></div>    
</body>
</html>