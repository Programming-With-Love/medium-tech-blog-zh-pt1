<html>
<head>
<title>Introduction to drone.io CI/CD platform Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">drone.io CI/CDå¹³å°ç®€ä»‹ç¬¬2éƒ¨åˆ†</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/globant/introduction-to-drone-io-ci-cd-platform-part-2-fa9fdc6a3659?source=collection_archive---------0-----------------------#2022-06-01">https://medium.com/globant/introduction-to-drone-io-ci-cd-platform-part-2-fa9fdc6a3659?source=collection_archive---------0-----------------------#2022-06-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/81ca5064f77861a2a89d92d9e54f8d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3ZWm4YKJR0zh_RPZ"/></div></div></figure><h1 id="1895" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">ä»‹ç»</h1><p id="db05" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">è¿™æ˜¯æˆ‘å‡ å‘¨å‰å†™çš„å…³äºDrone.ioçš„æ–‡ç« çš„ç¬¬äºŒéƒ¨åˆ†ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<a class="ae kl" href="https://helm.sh/" rel="noopener ugc nofollow" target="_blank"> Helm charts </a>åœ¨Kubernetesé›†ç¾¤ä¸Šéƒ¨ç½²æ— äººæœºï¼Œå¹¶ä½¿ç”¨æ— äººæœºåœ¨è¯¥é›†ç¾¤ä¸Šæ„å»ºå’Œéƒ¨ç½²ä¸€ä¸ªç¤ºä¾‹åº”ç”¨ç¨‹åºã€‚</p><p id="8d21" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">åƒåœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ä¸€æ ·ï¼Œæˆ‘ä»¬å°†ä»…å‡ºäºæµ‹è¯•ç›®çš„è¿›è¡Œæœ¬åœ°æ— äººæœºéƒ¨ç½²ï¼Œéœ€è¦ä¸ºæ­£ç¡®çš„ç”Ÿäº§å®‰è£…é…ç½®è®¸å¤šå…¶ä»–å…ƒç´ ï¼Œå¦‚httpsã€å·é…ç½®ã€æœºå¯†å¤„ç†ã€æƒé™ã€è´Ÿè½½å¹³è¡¡å™¨æˆ–å…¥å£æ§åˆ¶å™¨ç­‰ã€‚è¿™äº›è¯é¢˜å°†åœ¨ä»¥åçš„æ–‡ç« ä¸­è®¨è®ºã€‚</p><p id="32e0" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">å¯¹äºæœ¬å®éªŒå®¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<a class="ae kl" href="https://minikube.sigs.k8s.io/docs/" rel="noopener ugc nofollow" target="_blank"> minikube </a>ä½œä¸ºKubernetesé›†ç¾¤ï¼Œä»¥éµå¾ªæœ¬å®éªŒå®¤çš„æŒ‡ç¤ºï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨ä»»ä½•å…¶ä»–Kuberneteså¼•æ“ã€‚è¦å†æ¬¡è®¿é—®æ— äººæœºç•Œé¢ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<a class="ae kl" href="https://ngrok.com/" rel="noopener ugc nofollow" target="_blank"> ngrok </a>ï¼Œè¯·å‚è€ƒ<a class="ae kl" rel="noopener" href="/globant/introduction-to-drone-io-ci-cd-platform-1d43f8bc1728">ä¹‹å‰çš„å¸–å­</a>äº†è§£å¦‚ä½•è®¾ç½®å®ƒã€‚</p><p id="dc38" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">æœ¬æ–‡å°†å›é¡¾ä»¥ä¸‹éƒ¨åˆ†:</p><ul class=""><li id="24de" class="kr ks hh jp b jq km ju kn jy kt kc ku kg kv kk kw kx ky kz bi translated">ä½“ç³»ç»“æ„</li><li id="7e11" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">Kuberneteséƒ¨ç½²</li><li id="3f05" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">è¿›å…¥æ— äººæœºç•Œé¢</li><li id="ae79" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">éƒ¨ç½²ç¤ºä¾‹åº”ç”¨ç¨‹åº</li><li id="e778" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">ç»“è®º</li></ul><h1 id="8e8d" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">ä½“ç³»ç»“æ„</h1><p id="e008" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æ— äººæœºæ¶æ„ç»„ä»¶:</p><ul class=""><li id="8bd7" class="kr ks hh jp b jq km ju kn jy kt kc ku kg kv kk kw kx ky kz bi translated">æ— äººæœºæœåŠ¡å™¨</li><li id="cd60" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">æ— äººæœºç‰¹å·¥(ç§°ä¸ºå¥”è·‘è€…)</li><li id="6bb9" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">æ— äººæœºç®¡é“é…ç½®æ–‡ä»¶(åœ¨æ¯ä¸ªgitå­˜å‚¨åº“ä¸Š)</li><li id="efea" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">ä¸€ä¸ªSCMå­˜å‚¨åº“ï¼Œç”±Droneæä¾›åº”ç”¨ç¨‹åº</li></ul><p id="8346" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">è¿™æ˜¯å‰ä¸€ç¯‡æ–‡ç« ä¸­æè¿°æ‰€æœ‰ç»„ä»¶ä¹‹é—´äº¤äº’çš„æ¶æ„å›¾:</p><figure class="lg lh li lj fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lf"><img src="../Images/4a8d7dcc608e129f3595f16d34d4f4e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jp3D3q6WK-ptFgVIGhRL9w.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx">Drone.io architecture diagram</figcaption></figure><p id="e8de" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">ç°åœ¨è®©æˆ‘ä»¬çœ‹çœ‹è¿™äº›ç»„ä»¶æ˜¯å¦‚ä½•èå…¥Kubernetesé›†ç¾¤çš„:</p><figure class="lg lh li lj fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lo"><img src="../Images/57c48dc37825de6e6645556eee55b255.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xIaEAuF_-72X_SMRl6PXIQ.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx">Drone.io Kubernetes deployment diagram</figcaption></figure><p id="1f90" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">åœ¨Kubernetesé›†ç¾¤ä¸­ï¼ŒæœåŠ¡å™¨å’Œè¿è¡Œå™¨å°†ä½œä¸ºç”±<a class="ae kl" href="https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/" rel="noopener ugc nofollow" target="_blank"> <em class="lp"> ReplicaSet </em> </a>æ§åˆ¶å¹¶ç”±<a class="ae kl" href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" rel="noopener ugc nofollow" target="_blank"> <em class="lp"> Deployment </em> </a>èµ„æºéƒ¨ç½²çš„podè¿è¡Œï¼Œè¿™ä¸ºæ— äººæœºå®‰è£…æä¾›äº†é«˜å¯ç”¨æ€§å’Œå¯ä¼¸ç¼©æ€§ã€‚é¶æ ‡ç®¡é“å°†åœ¨ä»»ä½•é›†ç¾¤èŠ‚ç‚¹ä¸­å¯ç”¨çš„ä»»ä½•è¿è¡Œç¨‹åºå•å…ƒä¸­æ‰§è¡Œã€‚podå¯ä»¥æ ¹æ®åœ¨æœåŠ¡å™¨å’Œè¿è¡Œç¨‹åºä¸­æ‰§è¡Œçš„æ„å»ºè´Ÿè½½é€æ­¥å‡çº§ã€‚</p><h1 id="b0be" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">Kuberneteséƒ¨ç½²</h1><h1 id="dff7" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">å…ˆå†³æ¡ä»¶</h1><ul class=""><li id="a8f5" class="kr ks hh jp b jq jr ju jv jy lq kc lr kg ls kk kw kx ky kz bi translated">åƒ<a class="ae kl" href="https://minikube.sigs.k8s.io/" rel="noopener ugc nofollow" target="_blank"> minikube </a>è¿™æ ·çš„Kubernetesæ˜Ÿå›¢ã€‚</li><li id="904f" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">æŒèˆµåŒ…ç»ç†ã€‚</li><li id="d8c3" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">Kubernetes CLIï¼Œ<a class="ae kl" href="https://kubernetes.io/docs/reference/kubectl/kubectl/" rel="noopener ugc nofollow" target="_blank"> kubectl </a>å‘½ä»¤</li><li id="610b" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">æŒ‡å‘æ— äººæœºæœåŠ¡å™¨çš„å¯å…¬å¼€è®¿é—®çš„ä¸»æœºåã€‚å› ä¸ºæœ¬å®éªŒæ˜¯æœ¬åœ°å®‰è£…ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å†æ¬¡ä½¿ç”¨ngrokæ¥è·å–å…¬å…±ä¸»æœºåã€‚</li><li id="787c" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">SCMå¹³å°OAuth IDå’Œä»¤ç‰Œã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨GitHubï¼Œè¯·å‚è€ƒä¸Šä¸€ç¯‡æ–‡ç« æ¥é˜…è¯»å¦‚ä½•è®¾ç½®å®ƒï¼Œæˆ–è€…å‚è€ƒ<a class="ae kl" href="https://docs.drone.io/server/overview/" rel="noopener ugc nofollow" target="_blank">å®˜æ–¹æ–‡æ¡£</a>æ¥äº†è§£å¦‚ä½•è®¾ç½®å…¶ä»–SCMå¹³å°ã€‚</li><li id="79da" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">æœåŠ¡å™¨å’Œè·‘æ­¥è€…ä¹‹é—´é€šä¿¡çš„ç§˜å¯†ã€‚è¿™åªæ˜¯ä¸€ä¸²æ–‡æœ¬ï¼Œå°†ç”¨ä½œå®ƒä»¬ä¹‹é—´çš„å¯†ç ã€‚</li><li id="5a1e" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">GitHubå’ŒDocker Hubå¸æˆ·ã€‚</li></ul><p id="c3b7" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹åœ¨å¼€å§‹åœ¨Kuberneteséƒ¨ç½²æ— äººæœºä¹‹å‰æ‚¨éœ€è¦åšçš„äº‹æƒ…:</p><ul class=""><li id="aa3c" class="kr ks hh jp b jq km ju kn jy kt kc ku kg kv kk kw kx ky kz bi translated">è¿è¡Œngrok:</li></ul><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="b321" class="ly iq hh lu b fi lz ma l mb mc">$ ngrok http 80</span></pre><ul class=""><li id="4247" class="kr ks hh jp b jq km ju kn jy kt kc ku kg kv kk kw kx ky kz bi translated">åˆ›å»ºä¸€ä¸ªGitHub OAuthåº”ç”¨ç¨‹åº(æˆ–è€…æ›´æ–°ç°æœ‰çš„åº”ç”¨ç¨‹åºï¼Œå¦‚æœæ‚¨å·²ç»å®Œæˆäº†ä¸Šä¸€ç¯‡æ–‡ç« ä¸­çš„å®éªŒ)ï¼ŒæŒ‰ç…§ä¸Šä¸€ç¯‡æ–‡ç« ä¸­çš„è¯´æ˜è¿›è¡Œé…ç½®ï¼Œä½¿ç”¨ä¸Šä¸€æ­¥ä¸­çš„ngrok URLã€‚</li></ul><p id="6372" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">ç°åœ¨æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½å¼€å§‹è¿™ä¸ªå®éªŒäº†ï¼</p><h1 id="df3a" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">å®‰è£…minikube</h1><p id="3b2c" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">Minikubeå®‰è£…ç›¸å½“ç®€å•ï¼Œæˆ‘ä»¬ä½¿ç”¨Linuxä½œä¸ºè¿™ä¸ªå®éªŒå®¤çš„å¹³å°ï¼Œå¦‚æœä½ ä½¿ç”¨ä»»ä½•å…¶ä»–å¹³å°ï¼Œè¯·å‚è€ƒminikube <a class="ae kl" href="https://minikube.sigs.k8s.io/docs/start/" rel="noopener ugc nofollow" target="_blank">å®‰è£…è¯´æ˜</a>ã€‚é¦–å…ˆï¼Œä¸‹è½½minikubeäºŒè¿›åˆ¶æ–‡ä»¶å¹¶å®‰è£…ã€‚ä»ç»ˆç«¯è¿è¡Œ:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="5a9c" class="ly iq hh lu b fi lz ma l mb mc">$ curl -LO <a class="ae kl" href="https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64" rel="noopener ugc nofollow" target="_blank">https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64</a></span><span id="6428" class="ly iq hh lu b fi md ma l mb mc">sudo install minikube-linux-amd64 /usr/local/bin/minikube</span></pre><p id="c01d" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">å®Œæˆè¿™äº›ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥å¯åŠ¨ä¸€ä¸ªminikubeæœ¬åœ°é›†ç¾¤äº†ã€‚ä»¥érootç”¨æˆ·èº«ä»½ä»ç»ˆç«¯è¿è¡Œ:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="920e" class="ly iq hh lu b fi lz ma l mb mc">$ minikube start</span></pre><p id="cfa6" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">ç­‰å¾…å‡ åˆ†é’Ÿï¼Œminikubeå°†ä¸ºä¸»èŠ‚ç‚¹å’Œå·¥ä½œèŠ‚ç‚¹å¯åŠ¨ä¸€ä¸ªè™šæ‹Ÿæœºå™¨ã€‚minikubeé›†ç¾¤å®Œæˆå¯åŠ¨åï¼Œé€šè¿‡è¿è¡Œ<em class="lp"> kubectl </em>å‘½ä»¤å¯¹å…¶è¿›è¡Œæµ‹è¯•ã€‚å¯ä»¥<a class="ae kl" href="https://kubernetes.io/docs/tasks/tools/" rel="noopener ugc nofollow" target="_blank">å®‰è£…<em class="lp"> kubectl </em> </a>ï¼Œæˆ–è€…ä½¿ç”¨minikubeæ ¹æ®å½“å‰minikube Kubernetesç‰ˆæœ¬å®‰è£…:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="f022" class="ly iq hh lu b fi lz ma l mb mc">$ minikube kubectl â€” get po -A</span></pre><p id="d0de" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">ä¸ºäº†ä¾¿äºä½¿ç”¨ï¼Œå°†å…¶ä½œä¸ºshellè„šæœ¬çš„åˆ«åæ·»åŠ ï¼Œå°†ä»¥ä¸‹è¡Œæ·»åŠ åˆ°shellçš„é…ç½®æ–‡ä»¶ä¸­:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="8700" class="ly iq hh lu b fi lz ma l mb mc">alias kubectl=â€minikube kubectl --â€œ</span></pre><p id="7b4d" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨kubectlæ¥è®¿é—®é›†ç¾¤ã€‚ä¾‹å¦‚ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹é›†ç¾¤èŠ‚ç‚¹:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="1620" class="ly iq hh lu b fi lz ma l mb mc">$ kubectl get nodes<br/>NAME     STATUS ROLES                AGE VERSION</span><span id="5bf0" class="ly iq hh lu b fi md ma l mb mc">minikube Ready  control-plane,master 29d v1.21.2</span></pre><p id="cc52" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">å¦‚æœæ‚¨çœ‹ä¸åˆ°ç±»ä¼¼çš„è¾“å‡ºæˆ–ä»»ä½•ç±»å‹çš„é”™è¯¯ï¼Œæ‚¨åº”è¯¥éµå¾ª<a class="ae kl" href="https://minikube.sigs.k8s.io/docs/handbook/troubleshooting/" rel="noopener ugc nofollow" target="_blank">æ•…éšœæ’é™¤</a>æ–‡æ¡£ã€‚</p><h1 id="918a" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">å®‰è£…èˆµ</h1><p id="7dd7" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">å¤´ç›”å®‰è£…å°±åƒminikubeä¸€æ ·ç®€å•ã€‚æœ‰é€‚ç”¨äºä¸åŒæ“ä½œç³»ç»Ÿçš„è½¯ä»¶åŒ…ï¼Œä½†è¦å®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼Œè¯·ä¸‹è½½å®˜æ–¹å®‰è£…è„šæœ¬å¹¶è¿è¡Œå®ƒ:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="abb6" class="ly iq hh lu b fi lz ma l mb mc">$ curl -fsSL -o get_helm.sh <a class="ae kl" href="https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3</a><br/>$ chmod 700 get_helm.sh<br/>$ ./get_helm.sh</span></pre><p id="b874" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">æµ‹è¯•èˆµå®‰è£…æ˜¯å¦æ­£ç¡®:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="628a" class="ly iq hh lu b fi lz ma l mb mc">$ helm version<br/>version.BuildInfo{Version:â€v3.8.2", GitCommit:â€6e3701edea09e5d55a8ca2aae03a68917630e91bâ€, GitTreeState:â€cleanâ€, GoVersion:â€go1.17.5"}</span></pre><p id="729a" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">æˆ‘ä»¬ç°åœ¨å‡†å¤‡åœ¨minikubeé›†ç¾¤ä¸Šå®‰è£…æ— äººæœºã€‚</p><h1 id="2fbc" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">ä½¿ç”¨Helmå®‰è£…æœåŠ¡å™¨å’Œè½¬è½®</h1><p id="7b52" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">åœ¨Kubernetesä¸Šå®‰è£…æ— äººæœºåŒ…æ‹¬å®‰è£…ä¸¤ä¸ªç»„ä»¶:æœåŠ¡å™¨å’Œè¿è¡Œå™¨ã€‚é¦–å…ˆè¦åšçš„æ˜¯æ·»åŠ å®˜æ–¹æ— äººæœºå¤´ç›”åº“:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="e300" class="ly iq hh lu b fi lz ma l mb mc">$ helm repo add drone <a class="ae kl" href="https://charts.drone.io" rel="noopener ugc nofollow" target="_blank">https://charts.drone.io</a><br/>â€œdroneâ€ has been added to your repositories</span><span id="0dca" class="ly iq hh lu b fi md ma l mb mc">$ helm repo update<br/>Hang tight while we grab the latest from your chart repositoriesâ€¦â€¦Successfully got an update from the â€œdroneâ€ chart repository</span><span id="68ab" class="ly iq hh lu b fi md ma l mb mc">Update Complete. âˆHappy Helming!âˆ</span></pre><p id="5195" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">æ·»åŠ Helmå­˜å‚¨åº“åï¼Œä¸‹ä¸€æ­¥æ˜¯åˆ›å»ºä¸€ä¸ªåç§°ç©ºé—´ï¼Œåœ¨å…¶ä¸­éƒ¨ç½²æ— äººæœºç»„ä»¶:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="3b0c" class="ly iq hh lu b fi lz ma l mb mc">$ kubectl create ns drone<br/>namespace/drone created</span></pre><h1 id="cc0c" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">å®‰è£…æœåŠ¡å™¨</h1><p id="4f63" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">å®‰è£…helmå›¾è¡¨æ—¶ï¼Œå¿…é¡»å‘Helmå‘½ä»¤æä¾›ä¸€ä¸ªyamlæ–‡ä»¶ï¼Œå…¶ä¸­åŒ…å«æ­£åœ¨éƒ¨ç½²çš„åº”ç”¨ç¨‹åºçš„å®šåˆ¶ã€‚è¿™äº›æ–‡ä»¶åŒ…å«äº†æˆ‘ä»¬åœ¨æ— äººæœºç®€ä»‹çš„ç¬¬ä¸€éƒ¨åˆ†ä¸­æåˆ°çš„ç›¸åŒé…ç½®å‚æ•°ï¼Œä½†æ˜¯æ˜¯yamlæ ¼å¼ï¼ŒåŠ ä¸Šä»»ä½•ç‰¹å®šäºKubernetesçš„é…ç½®é€‰é¡¹ã€‚æœ‰å…³è¿™äº›å€¼çš„è§£é‡Šï¼Œè¯·å‚è€ƒè¯¥æ–‡ç« ã€‚è¿™æ˜¯æœåŠ¡å™¨çš„<em class="lp"> values.yaml </em>æ–‡ä»¶:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="b7f4" class="ly iq hh lu b fi lz ma l mb mc">env:</span><span id="dfa5" class="ly iq hh lu b fi md ma l mb mc">  DRONE_SERVER_HOST: xxxxxxxxxx.ngrok.io<br/>  DRONE_SERVER_PROTO: http<br/>  DRONE_RPC_SECRET: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx<br/>  DRONE_GITHUB_CLIENT_ID: xxxxxxxxxxxxxxxxxxxx<br/>  DRONE_GITHUB_CLIENT_SECRET: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx<br/>  DRONE_TLS_AUTOCERT: false<br/>  DRONE_USER_CREATE: username:githubuser,admin:true</span><span id="dd1b" class="ly iq hh lu b fi md ma l mb mc">  # Optional, needed in case to debug<br/>  DRONE_LOGS_DEBUG: true<br/>  DRONE_LOGS_TRACE: true</span></pre><p id="e724" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">ç¼–è¾‘å€¼æ–‡ä»¶åï¼Œç”¨æ‚¨è‡ªå·±çš„å€¼æ›¿æ¢å®ƒä»¬ï¼Œå¹¶ç»§ç»­å®‰è£…æœåŠ¡å™¨:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="eeac" class="ly iq hh lu b fi lz ma l mb mc">$ helm install â€” namespace drone drone drone/drone -f drone-server-values.yaml<br/>NAME: drone<br/>LAST DEPLOYED: Thu May 26 14:15:22 2022<br/>NAMESPACE: drone<br/>STATUS: deployed<br/>REVISION: 1<br/>TEST SUITE: None</span><span id="cdc4" class="ly iq hh lu b fi md ma l mb mc">NOTES:<br/>1. Get the application URL by running these commands:<br/>export POD_NAME=$(kubectl get pods â€” namespace drone -l â€œapp.kubernetes.io/name=drone,app.kubernetes.io/instance=droneâ€ -o jsonpath=â€{.items[0].metadata.name}â€)<br/>export CONTAINER_PORT=$(kubectl get pod â€” namespace drone $POD_NAME -o jsonpath=â€{.spec.containers[0].ports[0].containerPort}â€)<br/>echo â€œVisit <a class="ae kl" href="http://127.0.0.1:8080" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8080</a> to use your applicationâ€<br/>kubectl â€” namespace drone port-forward $POD_NAME 8080:$CONTAINER_PORT</span></pre><h1 id="48a7" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">å®‰è£…è½¬è½®</h1><p id="8da9" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">åŒç†ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºè·‘è€…å‡†å¤‡å¥½helm <em class="lp"> values.yaml </em>æ–‡ä»¶:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="aa39" class="ly iq hh lu b fi lz ma l mb mc">rbac:<br/>  buildNamespaces:<br/>    - drone</span><span id="b0ac" class="ly iq hh lu b fi md ma l mb mc">Env:<br/>  # This secret has to be the same configured on the serverDRONE_RPC_SECRET: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx<br/>  DRONE_NAMESPACE_DEFAULT: drone<br/>  # This is the drone server hostname internal to kubernetes, not the external hostname<br/>  DRONE_RPC_HOST: drone<br/>  DRONE_RPC_PROTO: http<br/>  DRONE_RUNNER_NAME: â€œDrone_kube_runner_1â€<br/>  DRONE_DEBUG: true<br/>  DRONE_TRACE: true</span></pre><p id="2bc5" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">ç¼–è¾‘å€¼æ–‡ä»¶åï¼Œç»§ç»­å®‰è£…æµé“:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="8615" class="ly iq hh lu b fi lz ma l mb mc">$ helm install â€” namespace drone drone-runner-kube drone/drone-runner-kube -f drone-runner-kube-values.yaml</span><span id="b8da" class="ly iq hh lu b fi md ma l mb mc">NAME: drone-runner-kube<br/>LAST DEPLOYED: Thu May 26 14:16:34 2022<br/>NAMESPACE: drone<br/>STATUS: deployed<br/>REVISION: 1<br/>TEST SUITE: None</span></pre><h1 id="41c3" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">éªŒè¯å®‰è£…</h1><p id="3d82" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">è¦éªŒè¯å®‰è£…æ˜¯å¦æˆåŠŸï¼Œè¯·æ£€æŸ¥éƒ¨ç½²çš„èµ„æºï¼Œæ‰€æœ‰èµ„æºéƒ½åº”å¤„äº<em class="lp">è¿è¡Œ</em>çŠ¶æ€:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="24d2" class="ly iq hh lu b fi lz ma l mb mc">$ kubectl get all -n drone</span><span id="9f1f" class="ly iq hh lu b fi md ma l mb mc">NAME                                  READY STATUS RESTARTS AGE<br/>pod/drone-586c4d64bf-46qt9             1/1  Running 0      2m26s<br/>pod/drone-runner-kube-7f79d87b75-fffn5 1/1  Running 0      75s</span><span id="1871" class="ly iq hh lu b fi md ma l mb mc">NAME                      TYPE      CLUSTER-IP EXTERNAL-IP PORT(S) AGE<br/>service/drone             ClusterIP 10.101.218.16 &lt;none&gt;   80/TCP 2m26s<br/>service/drone-runner-kube ClusterIP 10.111.102.5 &lt;none&gt;    3000/TCP 75s</span><span id="d795" class="ly iq hh lu b fi md ma l mb mc">NAME                              READY UP-TO-DATE AVAILABLE AGE<br/>deployment.apps/drone             1/1   1          1         2m26s<br/>deployment.apps/drone-runner-kube 1/1   1          1         75s</span><span id="124b" class="ly iq hh lu b fi md ma l mb mc">NAME                                         DESIRED CURRENT READY AGE<br/>replicaset.apps/drone-586c4d64bf             1       1       1  2m26s<br/>replicaset.apps/drone-runner-kube-7f79d87b75 1       1       1    75s</span></pre><p id="bed9" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">å¦‚æœæ²¡æœ‰ï¼Œåˆ™æ£€æŸ¥podsæ—¥å¿—:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="ac90" class="ly iq hh lu b fi lz ma l mb mc">$ kubectl â€” namespace drone logs \<br/>-l â€˜app.kubernetes.io/name=droneâ€™ \<br/>-l â€˜app.kubernetes.io/component=serverâ€™</span></pre><p id="2038" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">å¦‚æœæœåŠ¡å™¨æˆåŠŸå¯åŠ¨ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°å¦‚ä¸‹æ¶ˆæ¯:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="0a31" class="ly iq hh lu b fi lz ma l mb mc">time=â€2020â€“05â€“26T13:49:03Zâ€ level=info msg=â€starting the serverâ€ addr=â€:3000"</span></pre><p id="00c4" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">å¯¹äºè·‘æ­¥è€…ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°è¿™æ ·çš„æ¶ˆæ¯:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="2164" class="ly iq hh lu b fi lz ma l mb mc">time=â€2022â€“05â€“26T14:05:05Zâ€ level=info msg=â€successfully pinged the remote serverâ€<br/>time=â€2022â€“05â€“26T14:05:05Zâ€ level=info msg=â€polling the remote serverâ€ capacity=100 endpoint=â€http://drone" kind=pipeline type=kubernetes</span></pre><p id="994d" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">å¦‚æœå…¶ä¸­ä»»ä½•ä¸€ä¸ªæœ‰é”™è¯¯ï¼Œè¯·åœ¨Droneçš„<a class="ae kl" href="http://discourse.drone.io/" rel="noopener ugc nofollow" target="_blank">å¯¹è¯æœåŠ¡å™¨</a>ä¸Šå¯»æ±‚å¸®åŠ©ã€‚</p><h1 id="65dc" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">è¿›å…¥æ— äººæœºç•Œé¢</h1><p id="13eb" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">è¦è®¿é—®æ— äººæœºæ¥å£ï¼Œæˆ‘ä»¬éœ€è¦å…¬å¼€éƒ¨ç½²æœåŠ¡å™¨æ—¶åˆ›å»ºçš„KubernetesæœåŠ¡ã€‚æœ‰è®¸å¤šæ–¹æ³•å¯ä»¥å°†KubernetesæœåŠ¡å…¬å¼€ç»™å¤–ç•Œï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬ä½¿ç”¨minikubeå’Œngrokæ¥æä¾›å¯¹é›†ç¾¤çš„å¤–éƒ¨è®¿é—®ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨kubectlçš„port-forwardé€‰é¡¹å°†æ— äººæœºæ¥å£å…¬å¼€ç»™ngrokè½¬å‘è¯·æ±‚çš„ç«¯å£ã€‚ä»»ä½•å…¶ä»–æ–¹æ³•ï¼Œå¦‚<em class="lp">è´Ÿè½½å¹³è¡¡å™¨</em>ã€<em class="lp">å¤–éƒ¨åç§°</em>æˆ–<em class="lp">å…¥å£æ§åˆ¶å™¨</em>ä¸åœ¨æœ¬æ•™ç¨‹çš„èŒƒå›´ä¹‹å†…ã€‚è¦å°†æ— äººæœºæœåŠ¡è½¬å‘åˆ°ç«¯å£80ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="0c9a" class="ly iq hh lu b fi lz ma l mb mc">$ sudo kubectl â€” namespace drone port-forward svc/drone 80:80<br/>Password:</span><span id="7656" class="ly iq hh lu b fi md ma l mb mc">Forwarding from 127.0.0.1:80 -&gt; 80<br/>Forwarding from [::1]:80 -&gt; 80</span></pre><p id="9461" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">æˆ‘ä»¬éœ€è¦ä½¿ç”¨sudoï¼Œå› ä¸ºæˆ‘ä»¬ç»‘å®šåˆ°ä¸€ä¸ªä½äº1024çš„ç«¯å£ã€‚ç°åœ¨è®¿é—®<a class="ae kl" href="http://localhost" rel="noopener ugc nofollow" target="_blank"> http://localhost </a>ï¼Œæ‚¨å°†çœ‹åˆ°æˆ‘ä»¬åœ¨ä¸Šä¸€ç¯‡æ–‡ç« ä¸­çœ‹åˆ°çš„ç›¸åŒç•Œé¢:</p><figure class="lg lh li lj fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/b41f2af9d7278cca88395c67b8c1a114.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*U6ZRpw54mYXEIhnN"/></div></div></figure><h1 id="7399" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">éƒ¨ç½²ç¤ºä¾‹åº”ç”¨ç¨‹åº</h1><p id="e7f7" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">æ—¢ç„¶æ— äººæœºæœåŠ¡å™¨å’Œrunnerå·²ç»éƒ¨ç½²åœ¨Kubernetesé›†ç¾¤ä¸Šï¼Œæˆ‘ä»¬å°†éƒ¨ç½²ä¸€ä¸ªç¤ºä¾‹åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬å°†ä½¿ç”¨Kubernetesæ–‡æ¡£ä¸­çš„ä¸€ä¸ªç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œå³<a class="ae kl" href="https://kubernetes.io/docs/tutorials/stateless-application/guestbook/" rel="noopener ugc nofollow" target="_blank">æ¼”ç¤ºç•™è¨€ç°¿</a>ã€‚æ— äººæœºç®¡é“å°†æ„å»ºå›¾åƒï¼Œå°†å…¶æ¨é€åˆ°docker hubï¼Œå¹¶éƒ¨ç½²åœ¨minikube Kubernetesé›†ç¾¤ä¸­ã€‚</p><p id="e46e" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">å¯¹äºKubernetesé›†ç¾¤ä¸­çš„åº”ç”¨ç¨‹åºéƒ¨ç½²ï¼Œæœ‰å„ç§æ— äººæœºæ’ä»¶ï¼Œæˆ‘ä»¬å°†<a class="ae kl" href="https://plugins.drone.io/plugins/plugin-kube" rel="noopener ugc nofollow" target="_blank">ä½¿ç”¨æ¥è‡ª<a class="ae kl" href="https://plugins.drone.io/" rel="noopener ugc nofollow" target="_blank">æ’ä»¶å¸‚åœº</a>çš„ä¸€ä¸ª</a>ã€‚è¿™æ˜¯ç¤ºä¾‹åº”ç”¨ç¨‹åºçš„<a class="ae kl" href="https://github.com/juanluisbaptiste/kubernetes-engine-samples" rel="noopener ugc nofollow" target="_blank"> my fork </a>ä¸­çš„<a class="ae kl" href="https://github.com/juanluisbaptiste/kubernetes-engine-samples/blob/main/.drone.yml" rel="noopener ugc nofollow" target="_blank"> <em class="lp"> .drone.yml </em> </a>ç®¡é“æ–‡ä»¶:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="24d0" class="ly iq hh lu b fi lz ma l mb mc">---<br/>kind: pipeline<br/>type: kubernetes<br/>name: guestbook-demo</span><span id="7fcd" class="ly iq hh lu b fi md ma l mb mc">steps:<br/>  - name: docker<br/>    image: plugins/docker<br/>    settings:<br/>      repo: juanluisbaptiste/guestbook-demo<br/>      dockerfile: guestbook/php-redis/Dockerfile<br/>      context: guestbook/php-redis<br/>      username:<br/>        from_secret: docker_username<br/>      password:<br/>        from_secret: docker_password<br/>      tags:<br/>        - latest<br/>  - name: Deploy demo guestbook redis follower service<br/>    image: danielgormly/drone-plugin-kube:0.2.0<br/>    settings:<br/>      build_number: ${DRONE_BUILD_NUMBER}<br/>      template: guestbook/redis-follower-service.yaml<br/>      ca:<br/>        from_secret: k8s_crt<br/>      server:<br/>        from_secret: k8s_server<br/>      token:<br/>        from_secret: k8s_token<br/>  - name: Deploy demo guest book redis follower deployment<br/>    image: danielgormly/drone-plugin-kube:0.2.0<br/>    settings:<br/>      build_number: ${DRONE_BUILD_NUMBER}<br/>      template: guestbook/redis-follower-deployment.yaml<br/>      ca:<br/>        from_secret: k8s_crt<br/>      server:<br/>        from_secret: k8s_server<br/>      token:<br/>        from_secret: k8s_token<br/>  - name: Deploy demo guestbook redis leader service<br/>    image: danielgormly/drone-plugin-kube:0.2.0<br/>    settings:<br/>      build_number: ${DRONE_BUILD_NUMBER}<br/>      template: guestbook/redis-leader-service.yaml<br/>      ca:<br/>        from_secret: k8s_crt<br/>      server:<br/>        from_secret: k8s_server<br/>      token:<br/>        from_secret: k8s_token<br/>  - name: Deploy demo guest book redis leader deployment<br/>    image: danielgormly/drone-plugin-kube:0.2.0<br/>    settings:<br/>      build_number: ${DRONE_BUILD_NUMBER}<br/>      template: guestbook/redis-leader-deployment.yaml<br/>      ca:<br/>        from_secret: k8s_crt<br/>      server:<br/>        from_secret: k8s_server<br/>      token:<br/>        from_secret: k8s_token<br/>  - name: Deploy demo guestbook frontend service<br/>    image: danielgormly/drone-plugin-kube:0.2.0<br/>    settings:<br/>      build_number: ${DRONE_BUILD_NUMBER}<br/>      template: guestbook/frontend-service.yaml<br/>      ca:<br/>        from_secret: k8s_crt<br/>      server:<br/>        from_secret: k8s_server<br/>      token:<br/>        from_secret: k8s_token<br/>  - name: Deploy demo guest book frontend deployment<br/>    image: danielgormly/drone-plugin-kube:0.2.0<br/>    settings:<br/>      build_number: ${DRONE_BUILD_NUMBER}<br/>      template: guestbook/frontend-deployment.yaml<br/>      ca:<br/>        from_secret: k8s_crt<br/>      server:<br/>        from_secret: k8s_server<br/>      token:<br/>        from_secret: k8s_token</span></pre><p id="7c9c" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">ç®¡é“å°†æ„å»ºç•™è¨€ç°¿PHPå‰ç«¯ï¼Œå¹¶å°†å…¶æ¨é€åˆ°docker hubã€‚ç„¶åï¼Œå®ƒå°†ä¸ºåº”ç”¨ç¨‹åºåˆ›å»ºä¸€ä¸ªKubernetesåç§°ç©ºé—´ï¼Œå¹¶éƒ¨ç½²åˆšåˆšæ„å»ºçš„æ˜ åƒä»¥åŠä¸€ç»„Redis leaderå’Œfolloweræ•°æ®åº“ã€‚ä¸å¹¸çš„æ˜¯ï¼ŒKubernetesæ’ä»¶è¿˜å¤„äºå¼€å‘çš„æ—©æœŸé˜¶æ®µï¼Œç›®å‰å®ƒè¿˜ä¸æ”¯æŒå®šä¹‰å¤šä¸ªèµ„æºçš„æ¸…å•çš„éƒ¨ç½²ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸ºæ¯ä¸ªèµ„æºä½¿ç”¨ä¸€ä¸ªå•ç‹¬çš„æ¸…å•ã€‚</p><p id="afa6" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">ç°åœ¨ï¼Œåˆ†å‰æˆ‘çš„å­˜å‚¨åº“å¹¶åœ¨æ— äººæœºä¸­å¯ç”¨å®ƒã€‚å¯ç”¨åï¼Œåˆ›å»ºä»¥ä¸‹ç§˜å¯†ï¼Œå°†éœ€è¦è¿™äº›ç§˜å¯†æ¥å°†æ˜ åƒæ¨é€åˆ°docker hubå¹¶åœ¨Kubernetesé›†ç¾¤ä¸­éƒ¨ç½²åº”ç”¨ç¨‹åº:</p><ul class=""><li id="564d" class="kr ks hh jp b jq km ju kn jy kt kc ku kg kv kk kw kx ky kz bi translated">docker _ç”¨æˆ·å:Docker hubç”¨æˆ·å</li><li id="6489" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">docker_password: Docker hubå¯†ç </li><li id="25cf" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">k8s _ CRT:Kubernetes CAè¯ä¹¦çš„Base-64ç¼–ç å­—ç¬¦ä¸²</li><li id="7db5" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">k8s_server:æŒ‡å‘Kubernetesç®¡ç†å™¨èŠ‚ç‚¹çš„URLã€‚å¯¹äºæœ¬å®éªŒï¼Œå®ƒå°†æ˜¯minikubeå®ä¾‹ã€‚</li><li id="2882" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">k8s_token: KubernetesæœåŠ¡å¸æˆ·ä»¤ç‰Œ(ébase64ç¼–ç )</li></ul><p id="dcf1" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">å‰ä¸¤ä¸ªç§˜å¯†æ˜¯docker hubå‡­è¯ï¼Œå› æ­¤Droneå¯ä»¥æ¨é€åœ¨ç®¡é“è¿è¡ŒæœŸé—´æ„å»ºçš„å›¾åƒã€‚å¦å¤–ä¸‰ä¸ªç§˜å¯†æ˜¯å…³äºKuberneteséƒ¨ç½²æ’ä»¶é…ç½®çš„ã€‚</p><p id="897a" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">è¦é…ç½®<em class="lp"> k8s_crt </em>å¯†ç ï¼Œå¯åœ¨<em class="lp"> ~/ä¸Šæ‰¾åˆ°minikube CAè¯ä¹¦ã€‚minikube/ca.crt </em>æ–‡ä»¶ã€‚è¦å¯¹å…¶è¿›è¡Œbase64ç¼–ç ï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="f40a" class="ly iq hh lu b fi lz ma l mb mc">$ cd ~/.minikube<br/>$ cat ca.crt|base64 -w 0</span></pre><p id="520c" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">å°†è¾“å‡ºå¤åˆ¶å¹¶ç²˜è´´åˆ°æ–°çš„<em class="lp"> k8s_crt </em> secretä¸­ï¼Œç¡®ä¿å®ƒæ²¡æœ‰è¢«åˆ†æˆå¤šè¡Œï¼Œå®ƒå¿…é¡»åœ¨ä¸€è¡Œä¸­ã€‚å¯¹äº<em class="lp"> k8s_token </em> secretï¼Œè¦è·å–æœåŠ¡å¸æˆ·ä»¤ç‰Œï¼Œåœ¨<em class="lp"> kube-system </em>åç§°ç©ºé—´ä¸­æŸ¥æ‰¾åä¸º<em class="lp"> default-token-xxxx </em>çš„Kubernetes secretï¼Œå¹¶è·å–å…¶å€¼:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="a698" class="ly iq hh lu b fi lz ma l mb mc">$ kubectl get secret -n kube-system|grep default<br/><strong class="lu hi">default</strong>-token-vpbs9 kubernetes.io/service-account-token 3 301d</span><span id="149c" class="ly iq hh lu b fi md ma l mb mc">$ kubectl describe secret default-token-vpbs9 -n kube-system</span><span id="2a23" class="ly iq hh lu b fi md ma l mb mc">Name: default-token-vpbs9<br/>Namespace: kube-system<br/>Labels: &lt;none&gt;<br/>Annotations: kubernetes.io/service-account.name: default<br/>kubernetes.io/service-account.uid: 5e9b0fec-3d0f-4734-b2d8-d6bee635671a<br/>Type: kubernetes.io/service-account-token</span><span id="8903" class="ly iq hh lu b fi md ma l mb mc">Data<br/>====<br/>ca.crt: 1111 bytes<br/>namespace: 11 bytes<br/><strong class="lu hi">token: eyJhbGciOiJSUzI1NiIsImtpZCI6IlBzV0dVbkFEVVI4cUNjNDVlbml5WG1qMVN2cFY3TG5qclZyMlB0QmZWM2MifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkZWZhdWx0LXRva2VuLXZwYnM5Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImRlZmF1bHQiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiI1ZTliMGZlYy0zZDBmLTQ3MzQtYjJkOC1kNmJlZTYzNTY3MWEiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06ZGVmYXVsdCJ9.AKT7mFFdAwRcy8phR8MeIllsWGo2kU52SejZ5nD05K99M8BsHBdYTwM0HBLJTeDtAk8fs1KMaZ0OY0__Ct52E4r2RM3XCyYKXwMNPRgrgyvQ3QuHxD6Qux7O5LT6gX0LKjbzFk7VKey3trgQTgJZ4oOan_b3NMQs4nDSR2mM6Yt848x92w-vBOZ5Z0XUAbpjnSszK46zNQEqBeT3qX6PUfqOQfwDGqDJbwiZ033KwycPgZQ4ZLdD1mo6DHQtoRRXEyaetgCVlEqGIgHBTJyPAlQSxwu_nY4L4PMI8M8VcTJKC40wENUlNCfQzw_JWnwbtjfsFVwqd5theAzXVt3qKA</strong></span></pre><p id="d148" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">æ‚¨å¯ä»¥å°è¯•ä½¿ç”¨æ­¤å‘½ä»¤æå–â€œtokenâ€å­—æ®µçš„å€¼:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="907e" class="ly iq hh lu b fi lz ma l mb mc">$ kubectl get secret `kubectl get secret -n kube-system|grep default|awk '{print $1}'|grep -v NAME` -o go-template='{{ .data.token | base64decode }}' -n kube-system</span></pre><p id="aab2" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">æ‚¨åº”è¯¥å¾—åˆ°è¿™ä¸ªå€¼:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="2204" class="ly iq hh lu b fi lz ma l mb mc">eyJhbGciOiJSUzI1NiIsImtpZCI6IlBzV0dVbkFEVVI4cUNjNDVlbml5WG1qMVN2cFY3TG5qclZyMlB0QmZWM2MifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkZWZhdWx0LXRva2VuLXZwYnM5Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImRlZmF1bHQiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiI1ZTliMGZlYy0zZDBmLTQ3MzQtYjJkOC1kNmJlZTYzNTY3MWEiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06ZGVmYXVsdCJ9.AKT7mFFdAwRcy8phR8MeIllsWGo2kU52SejZ5nD05K99M8BsHBdYTwM0HBLJTeDtAk8fs1KMaZ0OY0__Ct52E4r2RM3XCyYKXwMNPRgrgyvQ3QuHxD6Qux7O5LT6gX0LKjbzFk7VKey3trgQTgJZ4oOan_b3NMQs4nDSR2mM6Yt848x92w-vBOZ5Z0XUAbpjnSszK46zNQEqBeT3qX6PUfqOQfwDGqDJbwiZ033KwycPgZQ4ZLdD1mo6DHQtoRRXEyaetgCVlEqGIgHBTJyPAlQSxwu_nY4L4PMI8M8VcTJKC40wENUlNCfQzw_JWnwbtjfsFVwqd5theAzXVt3qKA</span></pre><p id="d6e1" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">å¤åˆ¶è¯¥å€¼å¹¶åˆ›å»ºä¸€ä¸ªåä¸º<em class="lp"> k8s_token </em>çš„ç§˜å¯†ï¼Œè¿˜è¦ç¡®ä¿å®ƒæ²¡æœ‰è¢«åˆ†æˆå¤šè¡Œï¼Œå®ƒå¿…é¡»åœ¨ä¸€è¡Œä¸­ã€‚åœ¨æ‚¨åˆ›å»ºäº†å‰é¢çš„ç§˜å¯†ä¹‹åï¼Œåˆ›å»ºä¸€ä¸ªåä¸º<em class="lp">çš„åç§°ç©ºé—´guestbook-demo </em>:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="fd52" class="ly iq hh lu b fi lz ma l mb mc">$ kubectl create ns guestbook-demo<br/>namespace/guestbook-demo created</span></pre><p id="4627" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">ç°åœ¨æˆ‘ä»¬å·²ç»å‡†å¤‡å¥½å¯åŠ¨ä¸€ä¸ªæ–°çš„æ„å»ºã€‚åœ¨æ— äººæœºç•Œé¢ä¸Šï¼Œåœ¨ç¤ºä¾‹åº”ç”¨ç¨‹åºå­˜å‚¨åº“ä¸­ï¼Œå•å‡»â€œ+ NEW BUILDâ€æŒ‰é’®å¯åŠ¨æ–°çš„æ„å»ºã€‚åœ¨å·¦ä¾§ï¼Œæ‚¨å°†çœ‹åˆ°æ­£åœ¨æ‰§è¡Œçš„ç®¡é“æ­¥éª¤ï¼Œå¦‚æœå…¶ä¸­ä»»ä½•ä¸€ä¸ªæ­¥éª¤å¤±è´¥ï¼Œæ‚¨å¯ä»¥å•å‡»å®ƒæŸ¥çœ‹è¯¦ç»†ä¿¡æ¯:</p><figure class="lg lh li lj fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es me"><img src="../Images/c14e2f5822194ed7929a336ba6e7b030.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WMzVIw-kw6RtZeVb"/></div></div></figure><p id="0e16" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">å½“ç®¡é“æˆåŠŸå®Œæˆæ—¶ï¼Œæ‚¨å¯ä»¥é€šè¿‡æ£€æŸ¥åˆ›å»ºäº†å“ªäº›èµ„æºæ¥æ£€æŸ¥å®Œæˆäº†ä»€ä¹ˆ:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="413e" class="ly iq hh lu b fi lz ma l mb mc">$ kubectl get all -n guestbook-demo<br/>NAME                                READY STATUS  RESTARTS AGE<br/>pod/frontend-64bcc69c4b-6cc22       1/1   Running 2        4h<br/>pod/frontend-64bcc69c4b-f9djm       1/1   Running 2        4h<br/>pod/frontend-64bcc69c4b-g4n9v       1/1   Running 2        4h<br/>pod/redis-follower-594666cdcd-xs9rk 1/1   Running 2        4h<br/>pod/redis-follower-594666cdcd-z5tqj 1/1   Running 2        4h<br/>pod/redis-leader-fb76b4755-vh7cm    1/1   Running 2        4h</span><span id="2841" class="ly iq hh lu b fi md ma l mb mc">NAME                   TYPE         CLUSTER-IP    EXTERNAL-IP   PORT(S)      AGE<br/>service/frontend       LoadBalancer 10.101.46.1   &lt;pending&gt; 80:31526/TCP 4h<br/>service/redis-follower ClusterIP    10.109.70.101 &lt;none&gt;     6379/TCP     4h<br/>service/redis-leader   ClusterIP    10.99.118.103 &lt;none&gt;     6379/TCP     4h</span><span id="d524" class="ly iq hh lu b fi md ma l mb mc">NAME                           READY UP-TO-DATE AVAILABLE AGE<br/>deployment.apps/frontend       3/3   3          3         4h<br/>deployment.apps/redis-follower 2/2   2          2         4h<br/>deployment.apps/redis-leader 1/1     1          1         4h</span><span id="8ce2" class="ly iq hh lu b fi md ma l mb mc">NAME                                      DESIRED CURRENT READY AGE<br/>replicaset.apps/frontend-64bcc69c4b       3       3       3     4h<br/>replicaset.apps/redis-follower-594666cdcd 2       2       2     4h<br/>replicaset.apps/redis-leader-fb76b4755    1       1       1     4h</span></pre><p id="d9ba" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">æ‚¨åº”è¯¥çœ‹åˆ°å‰ç«¯å’ŒRedis podsã€æœåŠ¡ã€éƒ¨ç½²ä»¥åŠå®ƒä»¬çš„å‰¯æœ¬é›†ï¼Œå®ƒä»¬éƒ½å¤„äºè¿è¡ŒçŠ¶æ€ã€‚ç°åœ¨ï¼Œè¦è®¿é—®ç•™è¨€ç°¿åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦å…¬å¼€åº”ç”¨ç¨‹åºçš„å‰ç«¯æœåŠ¡ã€‚å› ä¸ºå‰ç«¯æœåŠ¡å±äº<em class="lp">è´Ÿè½½å¹³è¡¡å™¨</em>ç±»å‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨minikubeæœåŠ¡å‘½ä»¤æ¥å…¬å¼€å®ƒ:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="4286" class="ly iq hh lu b fi lz ma l mb mc">$ minikube service frontend -n guestbook-demo<br/>|--------------|--------|-----------|---------------------------|<br/>|   NAMESPACE  |  NAME  |TARGET PORT|           URL             |<br/>|--------------|--------|-----------|---------------------------|<br/>|guestbook-demo|frontend|        80 |<a class="ae kl" href="http://192.168.99.100:31856" rel="noopener ugc nofollow" target="_blank">http://192.168.99.100:31856</a>|<br/>|--------------|--------|-----------|---------------------------|<a class="ae kl" href="https://medium.com/p/fa9fdc6a3659/edit" rel="noopener">https://medium.com/p/fa9fdc6a3659/edit</a></span></pre><p id="bcbb" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">ğŸ‰åœ¨é»˜è®¤æµè§ˆå™¨ä¸­æ‰“å¼€æœåŠ¡ç•™è¨€ç°¿-æ¼”ç¤º/å‰ç«¯â€¦</p><p id="a60d" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">è¯¥å‘½ä»¤å°†æ‰“å¼€ä¸€ä¸ªæµè§ˆå™¨çª—å£ï¼Œè¯¥çª—å£å°†è®¿é—®å‰ç«¯æœåŠ¡URLã€‚è¯¥URLæ˜¯åˆ›å»ºæœåŠ¡æ—¶éšæœºåˆ†é…çš„minikube IPåœ°å€å’Œç«¯å£ã€‚æ‚¨ç°åœ¨å¯ä»¥æµ‹è¯•ç•™è¨€ç°¿åº”ç”¨ç¨‹åºäº†ï¼</p><figure class="lg lh li lj fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mf"><img src="../Images/d251b1388e02e16bfe4321d1e84f6288.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T-H7z7sHBxRngIVV"/></div></div></figure><h1 id="83f7" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">ç»“è®º</h1><p id="1c28" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†æ— äººæœºéƒ¨ç½²ä»ä½¿ç”¨<em class="lp"> docker-compose </em>çš„åŸºæœ¬dockerå®‰è£…æ‰©å±•åˆ°åœ¨æœ¬åœ°minikubeé›†ç¾¤ä¸Šä½¿ç”¨Helm chartsçš„Kuberneteséƒ¨ç½²ã€‚ä½†æ˜¯ï¼Œè¿™ç§æ— äººæœºå®‰è£…ç›¸å½“ç®€å•ï¼Œå®ƒç¼ºå°‘ä¸€äº›ç”Ÿäº§éƒ¨ç½²ä¸­é¢„æœŸçš„åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½å°†åœ¨æœªæ¥çš„å¸–å­ä¸­ä»‹ç»ã€‚Kuberneteså°†å…è®¸æˆ‘ä»¬åšè´Ÿè½½å¹³è¡¡ã€podæ°´å¹³æ‰©å±•ã€åº”ç”¨ç¨‹åºç‰ˆæœ¬æ¨å‡ºå’Œå›æ»šç­‰äº‹æƒ…ã€‚</p><p id="b6f8" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">æ­¤å¤–ï¼ŒKubernetesæ’ä»¶ä¼¼ä¹è¿˜å¤„äºéå¸¸æ—©æœŸçš„å¼€å‘é˜¶æ®µï¼Œæˆ‘æµ‹è¯•çš„é‚£ä¸ªæ’ä»¶å¯ä»¥å·¥ä½œï¼Œä½†ç¼ºå°‘ä¸€äº›åŠŸèƒ½ï¼Œæ¯”å¦‚åˆ›å»ºåç§°ç©ºé—´ï¼Œæˆ–è€…åœ¨å•ä¸ªæ¸…å•æ–‡ä»¶ä¸­éƒ¨ç½²å¤šä¸ªèµ„æºã€‚æˆ‘å¸Œæœ›Harnessåœ¨æœªæ¥å‘å¸ƒä¸€ä¸ªé€‚å½“æ”¯æŒçš„éƒ¨ç½²æ’ä»¶ã€‚</p><p id="bd77" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">æ€»çš„æ¥è¯´ï¼Œæˆ‘å¯¹Droneçš„æ˜“éƒ¨ç½²æ€§éå¸¸æ»¡æ„ï¼Œå³ä½¿æ˜¯åœ¨Kubernetesé›†ç¾¤ä¸Šã€‚åœ¨ä»¥åçš„æ–‡ç« ä¸­ï¼Œæˆ‘å°†ç»§ç»­æ¢ç´¢åœ¨è¿™ä¸ªå¹³å°ä¸Šå¯ä»¥ç”¨å®ƒåšä»€ä¹ˆï¼Œä»¥åŠå®ƒä¸æ›´æˆç†Ÿçš„äº§å“ç›¸æ¯”å¦‚ä½•ã€‚</p></div></div>    
</body>
</html>