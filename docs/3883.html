<html>
<head>
<title>Introduction to drone.io CI/CD platform Part 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">drone.io CI/CD平台简介第2部分</h1>
<blockquote>原文：<a href="https://medium.com/globant/introduction-to-drone-io-ci-cd-platform-part-2-fa9fdc6a3659?source=collection_archive---------0-----------------------#2022-06-01">https://medium.com/globant/introduction-to-drone-io-ci-cd-platform-part-2-fa9fdc6a3659?source=collection_archive---------0-----------------------#2022-06-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/81ca5064f77861a2a89d92d9e54f8d38.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3ZWm4YKJR0zh_RPZ"/></div></div></figure><h1 id="1895" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">介绍</h1><p id="db05" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">这是我几周前写的关于Drone.io的文章的第二部分。在本文中，我们将使用<a class="ae kl" href="https://helm.sh/" rel="noopener ugc nofollow" target="_blank"> Helm charts </a>在Kubernetes集群上部署无人机，并使用无人机在该集群上构建和部署一个示例应用程序。</p><p id="8d21" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">像在上一篇文章中一样，我们将仅出于测试目的进行本地无人机部署，需要为正确的生产安装配置许多其他元素，如https、卷配置、机密处理、权限、负载平衡器或入口控制器等。这些话题将在以后的文章中讨论。</p><p id="32e0" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">对于本实验室，我们将使用<a class="ae kl" href="https://minikube.sigs.k8s.io/docs/" rel="noopener ugc nofollow" target="_blank"> minikube </a>作为Kubernetes集群，以遵循本实验室的指示，但也可以使用任何其他Kubernetes引擎。要再次访问无人机界面，我们将使用<a class="ae kl" href="https://ngrok.com/" rel="noopener ugc nofollow" target="_blank"> ngrok </a>，请参考<a class="ae kl" rel="noopener" href="/globant/introduction-to-drone-io-ci-cd-platform-1d43f8bc1728">之前的帖子</a>了解如何设置它。</p><p id="dc38" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">本文将回顾以下部分:</p><ul class=""><li id="24de" class="kr ks hh jp b jq km ju kn jy kt kc ku kg kv kk kw kx ky kz bi translated">体系结构</li><li id="7e11" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">Kubernetes部署</li><li id="3f05" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">进入无人机界面</li><li id="ae79" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">部署示例应用程序</li><li id="e778" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">结论</li></ul><h1 id="8e8d" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">体系结构</h1><p id="e008" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">让我们回顾一下无人机架构组件:</p><ul class=""><li id="8bd7" class="kr ks hh jp b jq km ju kn jy kt kc ku kg kv kk kw kx ky kz bi translated">无人机服务器</li><li id="cd60" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">无人机特工(称为奔跑者)</li><li id="6bb9" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">无人机管道配置文件(在每个git存储库上)</li><li id="efea" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">一个SCM存储库，由Drone提供应用程序</li></ul><p id="8346" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">这是前一篇文章中描述所有组件之间交互的架构图:</p><figure class="lg lh li lj fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lf"><img src="../Images/4a8d7dcc608e129f3595f16d34d4f4e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jp3D3q6WK-ptFgVIGhRL9w.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx">Drone.io architecture diagram</figcaption></figure><p id="e8de" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">现在让我们看看这些组件是如何融入Kubernetes集群的:</p><figure class="lg lh li lj fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lo"><img src="../Images/57c48dc37825de6e6645556eee55b255.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xIaEAuF_-72X_SMRl6PXIQ.png"/></div></div><figcaption class="lk ll et er es lm ln bd b be z dx">Drone.io Kubernetes deployment diagram</figcaption></figure><p id="1f90" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">在Kubernetes集群中，服务器和运行器将作为由<a class="ae kl" href="https://kubernetes.io/docs/concepts/workloads/controllers/replicaset/" rel="noopener ugc nofollow" target="_blank"> <em class="lp"> ReplicaSet </em> </a>控制并由<a class="ae kl" href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" rel="noopener ugc nofollow" target="_blank"> <em class="lp"> Deployment </em> </a>资源部署的pod运行，这为无人机安装提供了高可用性和可伸缩性。靶标管道将在任何集群节点中可用的任何运行程序单元中执行。pod可以根据在服务器和运行程序中执行的构建负载逐步升级。</p><h1 id="b0be" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">Kubernetes部署</h1><h1 id="dff7" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">先决条件</h1><ul class=""><li id="a8f5" class="kr ks hh jp b jq jr ju jv jy lq kc lr kg ls kk kw kx ky kz bi translated">像<a class="ae kl" href="https://minikube.sigs.k8s.io/" rel="noopener ugc nofollow" target="_blank"> minikube </a>这样的Kubernetes星团。</li><li id="904f" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">掌舵包经理。</li><li id="d8c3" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">Kubernetes CLI，<a class="ae kl" href="https://kubernetes.io/docs/reference/kubectl/kubectl/" rel="noopener ugc nofollow" target="_blank"> kubectl </a>命令</li><li id="610b" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">指向无人机服务器的可公开访问的主机名。因为本实验是本地安装，所以我们将再次使用ngrok来获取公共主机名。</li><li id="787c" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">SCM平台OAuth ID和令牌。在这篇文章中，我们将使用GitHub，请参考上一篇文章来阅读如何设置它，或者参考<a class="ae kl" href="https://docs.drone.io/server/overview/" rel="noopener ugc nofollow" target="_blank">官方文档</a>来了解如何设置其他SCM平台。</li><li id="79da" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">服务器和跑步者之间通信的秘密。这只是一串文本，将用作它们之间的密码。</li><li id="5a1e" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">GitHub和Docker Hub帐户。</li></ul><p id="c3b7" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">让我们回顾一下在开始在Kubernetes部署无人机之前您需要做的事情:</p><ul class=""><li id="aa3c" class="kr ks hh jp b jq km ju kn jy kt kc ku kg kv kk kw kx ky kz bi translated">运行ngrok:</li></ul><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="b321" class="ly iq hh lu b fi lz ma l mb mc">$ ngrok http 80</span></pre><ul class=""><li id="4247" class="kr ks hh jp b jq km ju kn jy kt kc ku kg kv kk kw kx ky kz bi translated">创建一个GitHub OAuth应用程序(或者更新现有的应用程序，如果您已经完成了上一篇文章中的实验)，按照上一篇文章中的说明进行配置，使用上一步中的ngrok URL。</li></ul><p id="6372" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">现在我们已经准备好开始这个实验了！</p><h1 id="df3a" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">安装minikube</h1><p id="3b2c" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">Minikube安装相当简单，我们使用Linux作为这个实验室的平台，如果你使用任何其他平台，请参考minikube <a class="ae kl" href="https://minikube.sigs.k8s.io/docs/start/" rel="noopener ugc nofollow" target="_blank">安装说明</a>。首先，下载minikube二进制文件并安装。从终端运行:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="5a9c" class="ly iq hh lu b fi lz ma l mb mc">$ curl -LO <a class="ae kl" href="https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64" rel="noopener ugc nofollow" target="_blank">https://storage.googleapis.com/minikube/releases/latest/minikube-linux-amd64</a></span><span id="6428" class="ly iq hh lu b fi md ma l mb mc">sudo install minikube-linux-amd64 /usr/local/bin/minikube</span></pre><p id="c01d" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">完成这些之后，我们就可以启动一个minikube本地集群了。以非root用户身份从终端运行:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="920e" class="ly iq hh lu b fi lz ma l mb mc">$ minikube start</span></pre><p id="cfa6" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">等待几分钟，minikube将为主节点和工作节点启动一个虚拟机器。minikube集群完成启动后，通过运行<em class="lp"> kubectl </em>命令对其进行测试。可以<a class="ae kl" href="https://kubernetes.io/docs/tasks/tools/" rel="noopener ugc nofollow" target="_blank">安装<em class="lp"> kubectl </em> </a>，或者使用minikube根据当前minikube Kubernetes版本安装:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="f022" class="ly iq hh lu b fi lz ma l mb mc">$ minikube kubectl — get po -A</span></pre><p id="d0de" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">为了便于使用，将其作为shell脚本的别名添加，将以下行添加到shell的配置文件中:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="8700" class="ly iq hh lu b fi lz ma l mb mc">alias kubectl=”minikube kubectl --“</span></pre><p id="7b4d" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">现在我们可以使用kubectl来访问集群。例如，让我们来看看集群节点:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="1620" class="ly iq hh lu b fi lz ma l mb mc">$ kubectl get nodes<br/>NAME     STATUS ROLES                AGE VERSION</span><span id="5bf0" class="ly iq hh lu b fi md ma l mb mc">minikube Ready  control-plane,master 29d v1.21.2</span></pre><p id="cc52" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">如果您看不到类似的输出或任何类型的错误，您应该遵循<a class="ae kl" href="https://minikube.sigs.k8s.io/docs/handbook/troubleshooting/" rel="noopener ugc nofollow" target="_blank">故障排除</a>文档。</p><h1 id="918a" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">安装舵</h1><p id="7dd7" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">头盔安装就像minikube一样简单。有适用于不同操作系统的软件包，但要安装最新版本，请下载官方安装脚本并运行它:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="abb6" class="ly iq hh lu b fi lz ma l mb mc">$ curl -fsSL -o get_helm.sh <a class="ae kl" href="https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3</a><br/>$ chmod 700 get_helm.sh<br/>$ ./get_helm.sh</span></pre><p id="b874" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">测试舵安装是否正确:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="628a" class="ly iq hh lu b fi lz ma l mb mc">$ helm version<br/>version.BuildInfo{Version:”v3.8.2", GitCommit:”6e3701edea09e5d55a8ca2aae03a68917630e91b”, GitTreeState:”clean”, GoVersion:”go1.17.5"}</span></pre><p id="729a" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">我们现在准备在minikube集群上安装无人机。</p><h1 id="2fbc" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">使用Helm安装服务器和转轮</h1><p id="7b52" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">在Kubernetes上安装无人机包括安装两个组件:服务器和运行器。首先要做的是添加官方无人机头盔库:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="e300" class="ly iq hh lu b fi lz ma l mb mc">$ helm repo add drone <a class="ae kl" href="https://charts.drone.io" rel="noopener ugc nofollow" target="_blank">https://charts.drone.io</a><br/>“drone” has been added to your repositories</span><span id="0dca" class="ly iq hh lu b fi md ma l mb mc">$ helm repo update<br/>Hang tight while we grab the latest from your chart repositories……Successfully got an update from the “drone” chart repository</span><span id="68ab" class="ly iq hh lu b fi md ma l mb mc">Update Complete. ⎈Happy Helming!⎈</span></pre><p id="5195" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">添加Helm存储库后，下一步是创建一个名称空间，在其中部署无人机组件:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="3b0c" class="ly iq hh lu b fi lz ma l mb mc">$ kubectl create ns drone<br/>namespace/drone created</span></pre><h1 id="cc0c" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">安装服务器</h1><p id="4f63" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">安装helm图表时，必须向Helm命令提供一个yaml文件，其中包含正在部署的应用程序的定制。这些文件包含了我们在无人机简介的第一部分中提到的相同配置参数，但是是yaml格式，加上任何特定于Kubernetes的配置选项。有关这些值的解释，请参考该文章。这是服务器的<em class="lp"> values.yaml </em>文件:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="b7f4" class="ly iq hh lu b fi lz ma l mb mc">env:</span><span id="dfa5" class="ly iq hh lu b fi md ma l mb mc">  DRONE_SERVER_HOST: xxxxxxxxxx.ngrok.io<br/>  DRONE_SERVER_PROTO: http<br/>  DRONE_RPC_SECRET: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx<br/>  DRONE_GITHUB_CLIENT_ID: xxxxxxxxxxxxxxxxxxxx<br/>  DRONE_GITHUB_CLIENT_SECRET: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx<br/>  DRONE_TLS_AUTOCERT: false<br/>  DRONE_USER_CREATE: username:githubuser,admin:true</span><span id="dd1b" class="ly iq hh lu b fi md ma l mb mc">  # Optional, needed in case to debug<br/>  DRONE_LOGS_DEBUG: true<br/>  DRONE_LOGS_TRACE: true</span></pre><p id="e724" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">编辑值文件后，用您自己的值替换它们，并继续安装服务器:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="eeac" class="ly iq hh lu b fi lz ma l mb mc">$ helm install — namespace drone drone drone/drone -f drone-server-values.yaml<br/>NAME: drone<br/>LAST DEPLOYED: Thu May 26 14:15:22 2022<br/>NAMESPACE: drone<br/>STATUS: deployed<br/>REVISION: 1<br/>TEST SUITE: None</span><span id="cdc4" class="ly iq hh lu b fi md ma l mb mc">NOTES:<br/>1. Get the application URL by running these commands:<br/>export POD_NAME=$(kubectl get pods — namespace drone -l “app.kubernetes.io/name=drone,app.kubernetes.io/instance=drone” -o jsonpath=”{.items[0].metadata.name}”)<br/>export CONTAINER_PORT=$(kubectl get pod — namespace drone $POD_NAME -o jsonpath=”{.spec.containers[0].ports[0].containerPort}”)<br/>echo “Visit <a class="ae kl" href="http://127.0.0.1:8080" rel="noopener ugc nofollow" target="_blank">http://127.0.0.1:8080</a> to use your application”<br/>kubectl — namespace drone port-forward $POD_NAME 8080:$CONTAINER_PORT</span></pre><h1 id="48a7" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">安装转轮</h1><p id="8da9" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">同理，我们需要为跑者准备好helm <em class="lp"> values.yaml </em>文件:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="aa39" class="ly iq hh lu b fi lz ma l mb mc">rbac:<br/>  buildNamespaces:<br/>    - drone</span><span id="b0ac" class="ly iq hh lu b fi md ma l mb mc">Env:<br/>  # This secret has to be the same configured on the serverDRONE_RPC_SECRET: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx<br/>  DRONE_NAMESPACE_DEFAULT: drone<br/>  # This is the drone server hostname internal to kubernetes, not the external hostname<br/>  DRONE_RPC_HOST: drone<br/>  DRONE_RPC_PROTO: http<br/>  DRONE_RUNNER_NAME: “Drone_kube_runner_1”<br/>  DRONE_DEBUG: true<br/>  DRONE_TRACE: true</span></pre><p id="2bc5" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">编辑值文件后，继续安装流道:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="8615" class="ly iq hh lu b fi lz ma l mb mc">$ helm install — namespace drone drone-runner-kube drone/drone-runner-kube -f drone-runner-kube-values.yaml</span><span id="b8da" class="ly iq hh lu b fi md ma l mb mc">NAME: drone-runner-kube<br/>LAST DEPLOYED: Thu May 26 14:16:34 2022<br/>NAMESPACE: drone<br/>STATUS: deployed<br/>REVISION: 1<br/>TEST SUITE: None</span></pre><h1 id="41c3" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">验证安装</h1><p id="3d82" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">要验证安装是否成功，请检查部署的资源，所有资源都应处于<em class="lp">运行</em>状态:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="24d2" class="ly iq hh lu b fi lz ma l mb mc">$ kubectl get all -n drone</span><span id="9f1f" class="ly iq hh lu b fi md ma l mb mc">NAME                                  READY STATUS RESTARTS AGE<br/>pod/drone-586c4d64bf-46qt9             1/1  Running 0      2m26s<br/>pod/drone-runner-kube-7f79d87b75-fffn5 1/1  Running 0      75s</span><span id="1871" class="ly iq hh lu b fi md ma l mb mc">NAME                      TYPE      CLUSTER-IP EXTERNAL-IP PORT(S) AGE<br/>service/drone             ClusterIP 10.101.218.16 &lt;none&gt;   80/TCP 2m26s<br/>service/drone-runner-kube ClusterIP 10.111.102.5 &lt;none&gt;    3000/TCP 75s</span><span id="d795" class="ly iq hh lu b fi md ma l mb mc">NAME                              READY UP-TO-DATE AVAILABLE AGE<br/>deployment.apps/drone             1/1   1          1         2m26s<br/>deployment.apps/drone-runner-kube 1/1   1          1         75s</span><span id="124b" class="ly iq hh lu b fi md ma l mb mc">NAME                                         DESIRED CURRENT READY AGE<br/>replicaset.apps/drone-586c4d64bf             1       1       1  2m26s<br/>replicaset.apps/drone-runner-kube-7f79d87b75 1       1       1    75s</span></pre><p id="bed9" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">如果没有，则检查pods日志:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="ac90" class="ly iq hh lu b fi lz ma l mb mc">$ kubectl — namespace drone logs \<br/>-l ‘app.kubernetes.io/name=drone’ \<br/>-l ‘app.kubernetes.io/component=server’</span></pre><p id="2038" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">如果服务器成功启动，您应该会看到如下消息:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="0a31" class="ly iq hh lu b fi lz ma l mb mc">time=”2020–05–26T13:49:03Z” level=info msg=”starting the server” addr=”:3000"</span></pre><p id="00c4" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">对于跑步者，您应该会看到这样的消息:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="2164" class="ly iq hh lu b fi lz ma l mb mc">time=”2022–05–26T14:05:05Z” level=info msg=”successfully pinged the remote server”<br/>time=”2022–05–26T14:05:05Z” level=info msg=”polling the remote server” capacity=100 endpoint=”http://drone" kind=pipeline type=kubernetes</span></pre><p id="994d" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">如果其中任何一个有错误，请在Drone的<a class="ae kl" href="http://discourse.drone.io/" rel="noopener ugc nofollow" target="_blank">对话服务器</a>上寻求帮助。</p><h1 id="65dc" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">进入无人机界面</h1><p id="13eb" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">要访问无人机接口，我们需要公开部署服务器时创建的Kubernetes服务。有许多方法可以将Kubernetes服务公开给外界，但是由于我们使用minikube和ngrok来提供对集群的外部访问，我们将使用kubectl的port-forward选项将无人机接口公开给ngrok转发请求的端口。任何其他方法，如<em class="lp">负载平衡器</em>、<em class="lp">外部名称</em>或<em class="lp">入口控制器</em>不在本教程的范围之内。要将无人机服务转发到端口80，请运行以下命令</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="0c9a" class="ly iq hh lu b fi lz ma l mb mc">$ sudo kubectl — namespace drone port-forward svc/drone 80:80<br/>Password:</span><span id="7656" class="ly iq hh lu b fi md ma l mb mc">Forwarding from 127.0.0.1:80 -&gt; 80<br/>Forwarding from [::1]:80 -&gt; 80</span></pre><p id="9461" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">我们需要使用sudo，因为我们绑定到一个低于1024的端口。现在访问<a class="ae kl" href="http://localhost" rel="noopener ugc nofollow" target="_blank"> http://localhost </a>，您将看到我们在上一篇文章中看到的相同界面:</p><figure class="lg lh li lj fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/b41f2af9d7278cca88395c67b8c1a114.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*U6ZRpw54mYXEIhnN"/></div></div></figure><h1 id="7399" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">部署示例应用程序</h1><p id="e7f7" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">既然无人机服务器和runner已经部署在Kubernetes集群上，我们将部署一个示例应用程序。我们将使用Kubernetes文档中的一个示例应用程序，即<a class="ae kl" href="https://kubernetes.io/docs/tutorials/stateless-application/guestbook/" rel="noopener ugc nofollow" target="_blank">演示留言簿</a>。无人机管道将构建图像，将其推送到docker hub，并部署在minikube Kubernetes集群中。</p><p id="e46e" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">对于Kubernetes集群中的应用程序部署，有各种无人机插件，我们将<a class="ae kl" href="https://plugins.drone.io/plugins/plugin-kube" rel="noopener ugc nofollow" target="_blank">使用来自<a class="ae kl" href="https://plugins.drone.io/" rel="noopener ugc nofollow" target="_blank">插件市场</a>的一个</a>。这是示例应用程序的<a class="ae kl" href="https://github.com/juanluisbaptiste/kubernetes-engine-samples" rel="noopener ugc nofollow" target="_blank"> my fork </a>中的<a class="ae kl" href="https://github.com/juanluisbaptiste/kubernetes-engine-samples/blob/main/.drone.yml" rel="noopener ugc nofollow" target="_blank"> <em class="lp"> .drone.yml </em> </a>管道文件:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="24d0" class="ly iq hh lu b fi lz ma l mb mc">---<br/>kind: pipeline<br/>type: kubernetes<br/>name: guestbook-demo</span><span id="7fcd" class="ly iq hh lu b fi md ma l mb mc">steps:<br/>  - name: docker<br/>    image: plugins/docker<br/>    settings:<br/>      repo: juanluisbaptiste/guestbook-demo<br/>      dockerfile: guestbook/php-redis/Dockerfile<br/>      context: guestbook/php-redis<br/>      username:<br/>        from_secret: docker_username<br/>      password:<br/>        from_secret: docker_password<br/>      tags:<br/>        - latest<br/>  - name: Deploy demo guestbook redis follower service<br/>    image: danielgormly/drone-plugin-kube:0.2.0<br/>    settings:<br/>      build_number: ${DRONE_BUILD_NUMBER}<br/>      template: guestbook/redis-follower-service.yaml<br/>      ca:<br/>        from_secret: k8s_crt<br/>      server:<br/>        from_secret: k8s_server<br/>      token:<br/>        from_secret: k8s_token<br/>  - name: Deploy demo guest book redis follower deployment<br/>    image: danielgormly/drone-plugin-kube:0.2.0<br/>    settings:<br/>      build_number: ${DRONE_BUILD_NUMBER}<br/>      template: guestbook/redis-follower-deployment.yaml<br/>      ca:<br/>        from_secret: k8s_crt<br/>      server:<br/>        from_secret: k8s_server<br/>      token:<br/>        from_secret: k8s_token<br/>  - name: Deploy demo guestbook redis leader service<br/>    image: danielgormly/drone-plugin-kube:0.2.0<br/>    settings:<br/>      build_number: ${DRONE_BUILD_NUMBER}<br/>      template: guestbook/redis-leader-service.yaml<br/>      ca:<br/>        from_secret: k8s_crt<br/>      server:<br/>        from_secret: k8s_server<br/>      token:<br/>        from_secret: k8s_token<br/>  - name: Deploy demo guest book redis leader deployment<br/>    image: danielgormly/drone-plugin-kube:0.2.0<br/>    settings:<br/>      build_number: ${DRONE_BUILD_NUMBER}<br/>      template: guestbook/redis-leader-deployment.yaml<br/>      ca:<br/>        from_secret: k8s_crt<br/>      server:<br/>        from_secret: k8s_server<br/>      token:<br/>        from_secret: k8s_token<br/>  - name: Deploy demo guestbook frontend service<br/>    image: danielgormly/drone-plugin-kube:0.2.0<br/>    settings:<br/>      build_number: ${DRONE_BUILD_NUMBER}<br/>      template: guestbook/frontend-service.yaml<br/>      ca:<br/>        from_secret: k8s_crt<br/>      server:<br/>        from_secret: k8s_server<br/>      token:<br/>        from_secret: k8s_token<br/>  - name: Deploy demo guest book frontend deployment<br/>    image: danielgormly/drone-plugin-kube:0.2.0<br/>    settings:<br/>      build_number: ${DRONE_BUILD_NUMBER}<br/>      template: guestbook/frontend-deployment.yaml<br/>      ca:<br/>        from_secret: k8s_crt<br/>      server:<br/>        from_secret: k8s_server<br/>      token:<br/>        from_secret: k8s_token</span></pre><p id="7c9c" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">管道将构建留言簿PHP前端，并将其推送到docker hub。然后，它将为应用程序创建一个Kubernetes名称空间，并部署刚刚构建的映像以及一组Redis leader和follower数据库。不幸的是，Kubernetes插件还处于开发的早期阶段，目前它还不支持定义多个资源的清单的部署，所以我们需要为每个资源使用一个单独的清单。</p><p id="afa6" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">现在，分叉我的存储库并在无人机中启用它。启用后，创建以下秘密，将需要这些秘密来将映像推送到docker hub并在Kubernetes集群中部署应用程序:</p><ul class=""><li id="564d" class="kr ks hh jp b jq km ju kn jy kt kc ku kg kv kk kw kx ky kz bi translated">docker _用户名:Docker hub用户名</li><li id="6489" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">docker_password: Docker hub密码</li><li id="25cf" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">k8s _ CRT:Kubernetes CA证书的Base-64编码字符串</li><li id="7db5" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">k8s_server:指向Kubernetes管理器节点的URL。对于本实验，它将是minikube实例。</li><li id="2882" class="kr ks hh jp b jq la ju lb jy lc kc ld kg le kk kw kx ky kz bi translated">k8s_token: Kubernetes服务帐户令牌(非base64编码)</li></ul><p id="dcf1" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">前两个秘密是docker hub凭证，因此Drone可以推送在管道运行期间构建的图像。另外三个秘密是关于Kubernetes部署插件配置的。</p><p id="897a" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">要配置<em class="lp"> k8s_crt </em>密码，可在<em class="lp"> ~/上找到minikube CA证书。minikube/ca.crt </em>文件。要对其进行base64编码，请运行以下命令:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="f40a" class="ly iq hh lu b fi lz ma l mb mc">$ cd ~/.minikube<br/>$ cat ca.crt|base64 -w 0</span></pre><p id="520c" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">将输出复制并粘贴到新的<em class="lp"> k8s_crt </em> secret中，确保它没有被分成多行，它必须在一行中。对于<em class="lp"> k8s_token </em> secret，要获取服务帐户令牌，在<em class="lp"> kube-system </em>名称空间中查找名为<em class="lp"> default-token-xxxx </em>的Kubernetes secret，并获取其值:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="a698" class="ly iq hh lu b fi lz ma l mb mc">$ kubectl get secret -n kube-system|grep default<br/><strong class="lu hi">default</strong>-token-vpbs9 kubernetes.io/service-account-token 3 301d</span><span id="149c" class="ly iq hh lu b fi md ma l mb mc">$ kubectl describe secret default-token-vpbs9 -n kube-system</span><span id="2a23" class="ly iq hh lu b fi md ma l mb mc">Name: default-token-vpbs9<br/>Namespace: kube-system<br/>Labels: &lt;none&gt;<br/>Annotations: kubernetes.io/service-account.name: default<br/>kubernetes.io/service-account.uid: 5e9b0fec-3d0f-4734-b2d8-d6bee635671a<br/>Type: kubernetes.io/service-account-token</span><span id="8903" class="ly iq hh lu b fi md ma l mb mc">Data<br/>====<br/>ca.crt: 1111 bytes<br/>namespace: 11 bytes<br/><strong class="lu hi">token: eyJhbGciOiJSUzI1NiIsImtpZCI6IlBzV0dVbkFEVVI4cUNjNDVlbml5WG1qMVN2cFY3TG5qclZyMlB0QmZWM2MifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkZWZhdWx0LXRva2VuLXZwYnM5Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImRlZmF1bHQiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiI1ZTliMGZlYy0zZDBmLTQ3MzQtYjJkOC1kNmJlZTYzNTY3MWEiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06ZGVmYXVsdCJ9.AKT7mFFdAwRcy8phR8MeIllsWGo2kU52SejZ5nD05K99M8BsHBdYTwM0HBLJTeDtAk8fs1KMaZ0OY0__Ct52E4r2RM3XCyYKXwMNPRgrgyvQ3QuHxD6Qux7O5LT6gX0LKjbzFk7VKey3trgQTgJZ4oOan_b3NMQs4nDSR2mM6Yt848x92w-vBOZ5Z0XUAbpjnSszK46zNQEqBeT3qX6PUfqOQfwDGqDJbwiZ033KwycPgZQ4ZLdD1mo6DHQtoRRXEyaetgCVlEqGIgHBTJyPAlQSxwu_nY4L4PMI8M8VcTJKC40wENUlNCfQzw_JWnwbtjfsFVwqd5theAzXVt3qKA</strong></span></pre><p id="d148" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">您可以尝试使用此命令提取“token”字段的值:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="907e" class="ly iq hh lu b fi lz ma l mb mc">$ kubectl get secret `kubectl get secret -n kube-system|grep default|awk '{print $1}'|grep -v NAME` -o go-template='{{ .data.token | base64decode }}' -n kube-system</span></pre><p id="aab2" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">您应该得到这个值:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="2204" class="ly iq hh lu b fi lz ma l mb mc">eyJhbGciOiJSUzI1NiIsImtpZCI6IlBzV0dVbkFEVVI4cUNjNDVlbml5WG1qMVN2cFY3TG5qclZyMlB0QmZWM2MifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlLXN5c3RlbSIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJkZWZhdWx0LXRva2VuLXZwYnM5Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9zZXJ2aWNlLWFjY291bnQubmFtZSI6ImRlZmF1bHQiLCJrdWJlcm5ldGVzLmlvL3NlcnZpY2VhY2NvdW50L3NlcnZpY2UtYWNjb3VudC51aWQiOiI1ZTliMGZlYy0zZDBmLTQ3MzQtYjJkOC1kNmJlZTYzNTY3MWEiLCJzdWIiOiJzeXN0ZW06c2VydmljZWFjY291bnQ6a3ViZS1zeXN0ZW06ZGVmYXVsdCJ9.AKT7mFFdAwRcy8phR8MeIllsWGo2kU52SejZ5nD05K99M8BsHBdYTwM0HBLJTeDtAk8fs1KMaZ0OY0__Ct52E4r2RM3XCyYKXwMNPRgrgyvQ3QuHxD6Qux7O5LT6gX0LKjbzFk7VKey3trgQTgJZ4oOan_b3NMQs4nDSR2mM6Yt848x92w-vBOZ5Z0XUAbpjnSszK46zNQEqBeT3qX6PUfqOQfwDGqDJbwiZ033KwycPgZQ4ZLdD1mo6DHQtoRRXEyaetgCVlEqGIgHBTJyPAlQSxwu_nY4L4PMI8M8VcTJKC40wENUlNCfQzw_JWnwbtjfsFVwqd5theAzXVt3qKA</span></pre><p id="d6e1" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">复制该值并创建一个名为<em class="lp"> k8s_token </em>的秘密，还要确保它没有被分成多行，它必须在一行中。在您创建了前面的秘密之后，创建一个名为<em class="lp">的名称空间guestbook-demo </em>:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="fd52" class="ly iq hh lu b fi lz ma l mb mc">$ kubectl create ns guestbook-demo<br/>namespace/guestbook-demo created</span></pre><p id="4627" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">现在我们已经准备好启动一个新的构建。在无人机界面上，在示例应用程序存储库中，单击“+ NEW BUILD”按钮启动新的构建。在左侧，您将看到正在执行的管道步骤，如果其中任何一个步骤失败，您可以单击它查看详细信息:</p><figure class="lg lh li lj fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es me"><img src="../Images/c14e2f5822194ed7929a336ba6e7b030.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*WMzVIw-kw6RtZeVb"/></div></div></figure><p id="0e16" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">当管道成功完成时，您可以通过检查创建了哪些资源来检查完成了什么:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="413e" class="ly iq hh lu b fi lz ma l mb mc">$ kubectl get all -n guestbook-demo<br/>NAME                                READY STATUS  RESTARTS AGE<br/>pod/frontend-64bcc69c4b-6cc22       1/1   Running 2        4h<br/>pod/frontend-64bcc69c4b-f9djm       1/1   Running 2        4h<br/>pod/frontend-64bcc69c4b-g4n9v       1/1   Running 2        4h<br/>pod/redis-follower-594666cdcd-xs9rk 1/1   Running 2        4h<br/>pod/redis-follower-594666cdcd-z5tqj 1/1   Running 2        4h<br/>pod/redis-leader-fb76b4755-vh7cm    1/1   Running 2        4h</span><span id="2841" class="ly iq hh lu b fi md ma l mb mc">NAME                   TYPE         CLUSTER-IP    EXTERNAL-IP   PORT(S)      AGE<br/>service/frontend       LoadBalancer 10.101.46.1   &lt;pending&gt; 80:31526/TCP 4h<br/>service/redis-follower ClusterIP    10.109.70.101 &lt;none&gt;     6379/TCP     4h<br/>service/redis-leader   ClusterIP    10.99.118.103 &lt;none&gt;     6379/TCP     4h</span><span id="d524" class="ly iq hh lu b fi md ma l mb mc">NAME                           READY UP-TO-DATE AVAILABLE AGE<br/>deployment.apps/frontend       3/3   3          3         4h<br/>deployment.apps/redis-follower 2/2   2          2         4h<br/>deployment.apps/redis-leader 1/1     1          1         4h</span><span id="8ce2" class="ly iq hh lu b fi md ma l mb mc">NAME                                      DESIRED CURRENT READY AGE<br/>replicaset.apps/frontend-64bcc69c4b       3       3       3     4h<br/>replicaset.apps/redis-follower-594666cdcd 2       2       2     4h<br/>replicaset.apps/redis-leader-fb76b4755    1       1       1     4h</span></pre><p id="d9ba" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">您应该看到前端和Redis pods、服务、部署以及它们的副本集，它们都处于运行状态。现在，要访问留言簿应用程序，我们需要公开应用程序的前端服务。因为前端服务属于<em class="lp">负载平衡器</em>类型，我们可以使用minikube服务命令来公开它:</p><pre class="lg lh li lj fd lt lu lv lw aw lx bi"><span id="4286" class="ly iq hh lu b fi lz ma l mb mc">$ minikube service frontend -n guestbook-demo<br/>|--------------|--------|-----------|---------------------------|<br/>|   NAMESPACE  |  NAME  |TARGET PORT|           URL             |<br/>|--------------|--------|-----------|---------------------------|<br/>|guestbook-demo|frontend|        80 |<a class="ae kl" href="http://192.168.99.100:31856" rel="noopener ugc nofollow" target="_blank">http://192.168.99.100:31856</a>|<br/>|--------------|--------|-----------|---------------------------|<a class="ae kl" href="https://medium.com/p/fa9fdc6a3659/edit" rel="noopener">https://medium.com/p/fa9fdc6a3659/edit</a></span></pre><p id="bcbb" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">🎉在默认浏览器中打开服务留言簿-演示/前端…</p><p id="a60d" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">该命令将打开一个浏览器窗口，该窗口将访问前端服务URL。该URL是创建服务时随机分配的minikube IP地址和端口。您现在可以测试留言簿应用程序了！</p><figure class="lg lh li lj fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mf"><img src="../Images/d251b1388e02e16bfe4321d1e84f6288.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*T-H7z7sHBxRngIVV"/></div></div></figure><h1 id="83f7" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">结论</h1><p id="1c28" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">在本文中，我们将无人机部署从使用<em class="lp"> docker-compose </em>的基本docker安装扩展到在本地minikube集群上使用Helm charts的Kubernetes部署。但是，这种无人机安装相当简单，它缺少一些生产部署中预期的功能，这些功能将在未来的帖子中介绍。Kubernetes将允许我们做负载平衡、pod水平扩展、应用程序版本推出和回滚等事情。</p><p id="b6f8" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">此外，Kubernetes插件似乎还处于非常早期的开发阶段，我测试的那个插件可以工作，但缺少一些功能，比如创建名称空间，或者在单个清单文件中部署多个资源。我希望Harness在未来发布一个适当支持的部署插件。</p><p id="bd77" class="pw-post-body-paragraph jn jo hh jp b jq km js jt ju kn jw jx jy ko ka kb kc kp ke kf kg kq ki kj kk ha bi translated">总的来说，我对Drone的易部署性非常满意，即使是在Kubernetes集群上。在以后的文章中，我将继续探索在这个平台上可以用它做什么，以及它与更成熟的产品相比如何。</p></div></div>    
</body>
</html>