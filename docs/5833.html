<html>
<head>
<title>Deploying Verrazzano on OKE</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在OKE部署Verrazzano</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/deploying-verrazzano-on-oke-d506101f93e?source=collection_archive---------2-----------------------#2021-10-28">https://medium.com/oracledevs/deploying-verrazzano-on-oke-d506101f93e?source=collection_archive---------2-----------------------#2021-10-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/385e05e627dc2e4a0061ba76bcdbddcc.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*lFXdzdufK0TGdzjelM_uKw.png"/></div></figure><p id="0980" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">甲骨文最近发布了<a class="ae jj" href="https://verrazzano.io" rel="noopener ugc nofollow" target="_blank"> Verrazzano </a>，这是一个“端到端的容器平台，用于在多云和混合环境中部署云原生和传统应用。”如果这是一个很大的负担，那是因为Verrazzano(简称v8o)包了很多。在本帖中，我们将探索在<a class="ae jj" href="https://docs.oracle.com/en-us/iaas/Content/ContEng/home.htm#top" rel="noopener ugc nofollow" target="_blank"> OKE </a>上部署Verrazzano。</p><p id="c4c8" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">单一集群部署模式非常简单:</p><ul class=""><li id="6cd5" class="jk jl hh in b io ip is it iw jm ja jn je jo ji jp jq jr js bi translated">创建一个Kubernetes集群</li><li id="f259" class="jk jl hh in b io jt is ju iw jv ja jw je jx ji jp jq jr js bi translated">安装Verrazzano平台操作器</li><li id="517f" class="jk jl hh in b io jt is ju iw jv ja jw je jx ji jp jq jr js bi translated">安装Verrazzano</li></ul><p id="b27c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">之后，您可以部署您选择的应用程序。</p><h2 id="1f86" class="jy jz hh bd ka kb kc kd ke kf kg kh ki iw kj kk kl ja km kn ko je kp kq kr ks bi translated">创建OKE集群</h2><p id="08fe" class="pw-post-body-paragraph il im hh in b io kt iq ir is ku iu iv iw kv iy iz ja kw jc jd je kx jg jh ji ha bi translated">我们将从使用<a class="ae jj" href="https://github.com/oracle-terraform-modules/terraform-oci-oke" rel="noopener ugc nofollow" target="_blank">https://github . com/Oracle-terra form-modules/terra form-OCI-OKE</a>创建OKE集群开始。因为我们只是带着Verrazzano兜一圈，所以我们只需要最基本的功能。遵循快速入门指南，创建提供程序并创建terraform.tfvars.example的副本，并将该副本重命名为terraform.tfvars。确保启用/创建了以下功能/资源:</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="b343" class="jy jz hh ld b fi lh li l lj lk">create_bastion_host = true<br/>bastion_access = ["anywhere"]</span><span id="c9ae" class="jy jz hh ld b fi ll li l lj lk">create_operator                    = true<br/>enable_operator_instance_principal = true<br/>node_pools = {<br/>  np1 = { shape = "VM.Standard.E4.Flex", ocpus = 2, memory = 32, node_pool_size = 2, boot_volume_size = 150}<br/>}</span></pre><p id="249e" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">按照快速入门的其余部分运行terraform init并应用。</p><p id="4243" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">创建集群后，使用方便的输出将ssh命令复制到操作员主机:</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="5d95" class="jy jz hh ld b fi lh li l lj lk">ssh_to_operator = "ssh -i ~/.ssh/id_rsa -J opc@xyz.xyz.xyz.xyz opc@10.0.0.12"</span></pre><p id="4b43" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">从这里开始，所有的kubectl命令都在操作员主机上执行。</p><h2 id="fcee" class="jy jz hh bd ka kb kc kd ke kf kg kh ki iw kj kk kl ja km kn ko je kp kq kr ks bi translated">安装Verrazzano操作器</h2><p id="b633" class="pw-post-body-paragraph il im hh in b io kt iq ir is ku iu iv iw kv iy iz ja kw jc jd je kx jg jh ji ha bi translated">让我们安装Verrazzano操作符:</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="d222" class="jy jz hh ld b fi lh li l lj lk">$ kubectl apply -f https://github.com/verrazzano/verrazzano/releases/download/v1.0.1/operator.yaml</span></pre><p id="92a5" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">并等待部署完成:</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="cd23" class="jy jz hh ld b fi lh li l lj lk">$ kubectl -n verrazzano-install rollout status deployment/verrazzano-platform-operator</span><span id="c06f" class="jy jz hh ld b fi ll li l lj lk">Waiting for deployment “verrazzano-platform-operator” rollout to finish: 0 of 1 updated replicas are available…</span></pre><p id="6a26" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">再过几分钟，操作员应该已经部署好了。验证操作员正在运行:</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="0e48" class="jy jz hh ld b fi lh li l lj lk">$ <!-- -->kubectl -n verrazzano-install get pods</span><span id="719c" class="jy jz hh ld b fi ll li l lj lk">NAME                                            READY   STATUS    RESTARTS   AGE</span><span id="77da" class="jy jz hh ld b fi ll li l lj lk">verrazzano-platform-operator-5f788568fd-w8cz7   1/1     Running   0          80s</span></pre><h2 id="0b84" class="jy jz hh bd ka kb kc kd ke kf kg kh ki iw kj kk kl ja km kn ko je kp kq kr ks bi translated">安装Verrazzano</h2><p id="70f3" class="pw-post-body-paragraph il im hh in b io kt iq ir is ku iu iv iw kv iy iz ja kw jc jd je kx jg jh ji ha bi translated">我们现在可以安装Verrazzano了。在本练习中，我们将使用开发配置文件:</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="44d4" class="jy jz hh ld b fi lh li l lj lk">kubectl apply -f - &lt;&lt;EOF<br/>apiVersion: install.verrazzano.io/v1alpha1<br/>kind: Verrazzano<br/>metadata:<br/>  name: hello-verrazzano<br/>spec:<br/>  profile: dev<br/>EOF</span></pre><p id="172a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">现在我们需要等待Verrazzano安装:</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="5238" class="jy jz hh ld b fi lh li l lj lk">kubectl wait \<br/>    --timeout<strong class="ld hi">=</strong>20m \<br/>    --for<strong class="ld hi">=</strong>condition<strong class="ld hi">=</strong>InstallComplete \<br/>    verrazzano/</span></pre><h2 id="00ec" class="jy jz hh bd ka kb kc kd ke kf kg kh ki iw kj kk kl ja km kn ko je kp kq kr ks bi translated">访问Verrazzano</h2><p id="f411" class="pw-post-body-paragraph il im hh in b io kt iq ir is ku iu iv iw kv iy iz ja kw jc jd je kx jg jh ji ha bi translated">为了访问Verrazzano，您需要获得控制台URL:<a class="ae jj" href="https://verrazzano.io/docs/operations/" rel="noopener ugc nofollow" target="_blank">https://verrazzano.io/docs/operations/</a></p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="0879" class="jy jz hh ld b fi lh li l lj lk">$ kubectl get vz -o yaml</span></pre><p id="2817" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">您将得到一个打印的URL列表。比如我的Verrazzano控制台网址是<a class="ae jj" href="https://verrazzano.default.168.138.102.88.nip.io" rel="noopener ugc nofollow" target="_blank">https://Verrazzano . default . 168 . 138 . 102 . 88 . nip . io</a></p><p id="96e7" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在浏览器中访问此url，系统会提示您登录:</p><figure class="ky kz la lb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es lm"><img src="../Images/31914773ae5fba6d60da6baa01397ba5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-u2685KLBKwv0Ge87dxJiA.png"/></div></div></figure><p id="cd09" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">用户名是<strong class="in hi"> verrazzano </strong>，您可以通过发出以下命令获得密码:</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="28f3" class="jy jz hh ld b fi lh li l lj lk">kubectl get secret \<br/>    --namespace verrazzano-system verrazzano \<br/>    -o jsonpath={.data.password} | base64 \<br/>    --decode; echo</span></pre><p id="b0bf" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">您现在应该可以访问Verrazzano控制台了:</p><figure class="ky kz la lb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es lr"><img src="../Images/6b63d8c36f935cb7186cf608bf6da020.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fUj4QPb3Zm__7aTdoWpiVw.png"/></div></div></figure><h2 id="b3fd" class="jy jz hh bd ka kb kc kd ke kf kg kh ki iw kj kk kl ja km kn ko je kp kq kr ks bi translated">将应用程序部署到Verrazzano</h2><p id="157a" class="pw-post-body-paragraph il im hh in b io kt iq ir is ku iu iv iw kv iy iz ja kw jc jd je kx jg jh ji ha bi translated">我们将部署hello-helidon应用程序。创建名称空间:</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="5a36" class="jy jz hh ld b fi lh li l lj lk">kubectl create namespace hello-helidon</span></pre><p id="f5d8" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">并添加标签来标识由Verrazzano管理并为Istio:</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="fdf7" class="jy jz hh ld b fi lh li l lj lk">kubectl label namespace hello-helidon verrazzano-managed<strong class="ld hi">=</strong>true istio-injection<strong class="ld hi">=</strong>enabled</span></pre><p id="bb3e" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">接下来，部署Verrazzano <a class="ae jj" href="https://verrazzano.io/docs/applications/#components" rel="noopener ugc nofollow" target="_blank">组件</a>:</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="61d1" class="jy jz hh ld b fi lh li l lj lk">kubectl apply -f https://raw.githubusercontent.com/verrazzano/verrazzano/master/examples/hello-helidon/hello-helidon-comp.yaml</span></pre><p id="8132" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">然后创建<a class="ae jj" href="https://verrazzano.io/docs/applications/#application-configurations" rel="noopener ugc nofollow" target="_blank">应用配置</a>:</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="3bd4" class="jy jz hh ld b fi lh li l lj lk">kubectl apply -f https://raw.githubusercontent.com/verrazzano/verrazzano/master/examples/hello-helidon/hello-helidon-app.yaml</span></pre><p id="49c8" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">现在获取您的pod的名称:</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="01c6" class="jy jz hh ld b fi lh li l lj lk">$ kubectl get pods -n hello-helidon</span><span id="ab9c" class="jy jz hh ld b fi ll li l lj lk">NAME                                        READY   STATUS    RESTARTS   AGEhello-helidon-deployment-54979d7d74-6c9nw   1/1     Running   0          2m18s</span></pre><p id="b916" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">并检查应用程序是否准备好了:</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="5494" class="jy jz hh ld b fi lh li l lj lk">$ kubectl wait — timeout=300s — for=condition=Ready -n hello-helidon pod/hello-helidon-deployment-54979d7d74–6c9nw</span><span id="f26a" class="jy jz hh ld b fi ll li l lj lk">pod/hello-helidon-deployment-54979d7d74-6c9nw condition met</span></pre><p id="2cf8" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">查找负载平衡器的主机名:</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="2bd6" class="jy jz hh ld b fi lh li l lj lk">HOST<strong class="ld hi">=</strong>$<strong class="ld hi">(</strong>kubectl get gateway hello-helidon-hello-helidon-appconf-gw \<br/>    -n hello-helidon \<br/>    -o jsonpath<strong class="ld hi">=</strong>'{.spec.servers[0].hosts[0]}'<strong class="ld hi">)</strong></span></pre><p id="326a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">然后，您可以测试应用程序:</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="2fe1" class="jy jz hh ld b fi lh li l lj lk">$ <!-- -->curl -sk \<br/>    -X GET \<br/>    "https://${HOST}/greet"</span></pre><p id="dffa" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这应该会返回给你:</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="d153" class="jy jz hh ld b fi lh li l lj lk">{"message":"Hello World!"}</span></pre><h2 id="7ec2" class="jy jz hh bd ka kb kc kd ke kf kg kh ki iw kj kk kl ja km kn ko je kp kq kr ks bi translated">可观察性</h2><p id="8b1c" class="pw-post-body-paragraph il im hh in b io kt iq ir is ku iu iv iw kv iy iz ja kw jc jd je kx jg jh ji ha bi translated">现在，我们已经让我们的应用程序运行并可访问，我们还想看看它的日志和指标。Verrazzano为您提供了用于日志记录的ELK堆栈，以及用于度量和性能监控的Prometheus和Grafana的组合。</p><p id="e77a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我们先来看看格拉夫纳。在Verrazzano控制台的主页上，您会看到一个到Grafana的链接。您可以使用与登录Grafana时相同的用户名和密码组合。登录后，点击“主页”并选择“Helidon监控仪表板”:</p><figure class="ky kz la lb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es ls"><img src="../Images/db79c81521a3df6590622de9e6d544b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gHha9a_2qtHi-FzzqlyYgw.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx">Helidon Monitoring Dashboard</figcaption></figure><p id="50bc" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">类似地，访问Kibana仪表板并点击左侧菜单中的可视化图标。系统将提示您创建一个索引模式。选择verrazzano*并按照向导添加索引模式。搜索hello-helidon，您应该能够看到以下内容:</p><figure class="ky kz la lb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es lx"><img src="../Images/366201e24bdd3bf459260e89771605bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BWCkbOUwKip_-B2sFwIFJg.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx">Kibana dashboard</figcaption></figure><p id="3016" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">从这里，您可以创建自己的可视化和仪表板。</p><p id="e516" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如果我们想窥视Kubernetes星团本身呢？再说一次，维拉扎诺会掩护你的。在Verrazzano控制台中，找到Rancher的链接并单击它。用户名为“admin ”,您可以按如下方式检索密码:</p><pre class="ky kz la lb fd lc ld le lf aw lg bi"><span id="ff4d" class="jy jz hh ld b fi lh li l lj lk">kubectl get secret \<br/>    --namespace cattle-system rancher-admin-secret \<br/>    -o jsonpath={.data.password} | base64 \<br/>    --decode; echo</span></pre><p id="a8b9" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">登录后，您将进入集群页面，您将看到一个资源管理器按钮。点击它，您将能够查看您的Kubernetes集群:</p><figure class="ky kz la lb fd ii er es paragraph-image"><div role="button" tabindex="0" class="ln lo di lp bf lq"><div class="er es ly"><img src="../Images/4f1726001f542f4782b227a73134e300.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nkJ27dDFKGpXvJ-QQY9O1w.png"/></div></div><figcaption class="lt lu et er es lv lw bd b be z dx">Rancher Kubernetes dashboard</figcaption></figure><h2 id="163f" class="jy jz hh bd ka kb kc kd ke kf kg kh ki iw kj kk kl ja km kn ko je kp kq kr ks bi translated">摘要</h2><p id="6c58" class="pw-post-body-paragraph il im hh in b io kt iq ir is ku iu iv iw kv iy iz ja kw jc jd je kx jg jh ji ha bi translated">Verrazzano打包了一套很好的功能，可以帮助您处理Kubernetes的操作方面。从监控到日志记录和安全性，Kubernetes或应用程序管理员可以获得很高的工作效率。</p><p id="d640" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我希望这篇文章对你有所帮助。未来，我们将探索Verrazzano的其他特性，包括多集群部署和网络安全等。</p></div></div>    
</body>
</html>