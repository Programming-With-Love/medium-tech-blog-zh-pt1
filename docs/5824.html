<html>
<head>
<title>K3s on OCI: A Kubernetes cluster in under 5 mins</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">K3s:不到5分钟的库伯内特星团</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/k3s-on-oci-a-kubernetes-cluster-in-under-5-mins-d7c194c19d59?source=collection_archive---------0-----------------------#2021-10-13">https://medium.com/oracledevs/k3s-on-oci-a-kubernetes-cluster-in-under-5-mins-d7c194c19d59?source=collection_archive---------0-----------------------#2021-10-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/a69c2790c87111b648b80460aee17041.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dFIzwK8CgUEwQxyu4ZWvrA.png"/></div></div></figure><p id="03c9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><a class="ae jn" href="https://k3s.io/" rel="noopener ugc nofollow" target="_blank"> K3s </a>是一个<a class="ae jn" href="https://www.cncf.io/sandbox-projects/" rel="noopener ugc nofollow" target="_blank">沙盒</a> <a class="ae jn" href="https://www.cncf.io/" rel="noopener ugc nofollow" target="_blank"> CNCF </a>项目，它提供了一个轻量级的<a class="ae jn" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a>，该项目针对边缘和物联网用例进行了优化，或者适用于当您想要运行Kubernetes但不想花那么多钱、时间或者您不想这么做的时候<a class="ae jn" href="https://github.com/kelseyhightower/kubernetes-the-hard-way" rel="noopener ugc nofollow" target="_blank"> Kubernetes —艰难的方式</a>。</p><p id="e4df" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">让我们在OCI身上试试。</p><h2 id="9a72" class="jo jp hh bd jq jr js jt ju jv jw jx jy ja jz ka kb je kc kd ke ji kf kg kh ki bi translated">具有嵌入式数据库的单服务器设置</h2><p id="c212" class="pw-post-body-paragraph ip iq hh ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated">在这篇文章中，我们想看看它是否有效。这里的想法是做一个简单的部署，稍微打探一下。或者，如果您需要在Oracle Cloud Free Tier<a class="ae jn" href="https://www.oracle.com/cloud/free/" rel="noopener ugc nofollow" target="_blank">上运行，在这种情况下，您也可以尝试在ARM上运行K3s。</a></p><p id="f735" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">对于快速和肮脏，我们将需要以下:</p><ul class=""><li id="aeef" class="ko kp hh ir b is it iw ix ja kq je kr ji ks jm kt ku kv kw bi translated">一个VCN</li><li id="cfcf" class="ko kp hh ir b is kx iw ky ja kz je la ji lb jm kt ku kv kw bi translated">互联网网关</li><li id="b037" class="ko kp hh ir b is kx iw ky ja kz je la ji lb jm kt ku kv kw bi translated">允许SSH的公共子网和附加安全列表</li><li id="1d60" class="ko kp hh ir b is kx iw ky ja kz je la ji lb jm kt ku kv kw bi translated">通往Internet网关的公共子网的路由表</li><li id="d0d7" class="ko kp hh ir b is kx iw ky ja kz je la ji lb jm kt ku kv kw bi translated">计算虚拟机</li></ul><p id="d7d9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">因此，让我们使用terraform vcn模块来为我们做更脏的工作:</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="d30a" class="jo jp hh lh b fi ll lm l ln lo">module "vcn" {</span><span id="1fcb" class="jo jp hh lh b fi lp lm l ln lo">  source = "oracle-terraform-modules/vcn/oci"<br/>  version = "3.0.0"</span><span id="5818" class="jo jp hh lh b fi lp lm l ln lo">  # general oci parameters<br/>  compartment_id = var.compartment_id<br/>  label_prefix = var.label_prefix</span><span id="e8a6" class="jo jp hh lh b fi lp lm l ln lo">  # gateways<br/>  create_internet_gateway = true<br/>  create_nat_gateway = false<br/>  create_service_gateway = true</span><span id="8ecd" class="jo jp hh lh b fi lp lm l ln lo">  # vcn<br/>  vcn_cidrs = ["10.0.0.0/16"]<br/>  vcn_dns_label = "k3s"<br/>  vcn_name = "k3s"<br/>  lockdown_default_seclist = false<br/>}</span></pre><p id="a394" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">运行terraform apply创建VCN。接下来，登录OCI控制台，导航至<strong class="ir hi">网络</strong> &gt; <strong class="ir hi">虚拟云网络</strong>，点击您的VCN。创建一个子网，确保您选择了internet路由表以及DHCP和安全列表的默认选项。也给它一个CIDR块，例如10.0.0.0/24。</p><p id="f299" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">创建子网后，导航至<strong class="ir hi">计算</strong> &gt; <strong class="ir hi">实例</strong>。单击创建实例，选择Oracle Linux 8、k3s VCN和您刚刚创建的公共子网。确保选择了“分配公共IPv4地址”,并上传/生成ssh密钥。对于引导卷，我们给它一个100GB的大容量(尽管我们不需要那么多)。如果你更倾向于ARM，可以把形状改成安培，选择VM。标准。A1。也是Flex。</p><p id="b43c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">实例可用后，通过ssh连接到虚拟机:</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="bd93" class="jo jp hh lh b fi ll lm l ln lo">ssh -i /path/to/private/key opc@public_ip_address</span></pre><p id="015a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">登录后，我们可以安装K3s:</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="be77" class="jo jp hh lh b fi ll lm l ln lo">curl -sfL https://get.k3s.io | sh -</span></pre><p id="e6f1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">更改k3s.yaml文件的权限:</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="caf2" class="jo jp hh lh b fi ll lm l ln lo">sudo chmod go+r /etc/rancher/k3s/k3s.yaml</span></pre><p id="4c19" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">运行kubectl:</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="d723" class="jo jp hh lh b fi ll lm l ln lo">kubectl get nodes</span></pre><p id="79b3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这应该行得通。</p><p id="bfbc" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">让我们安装Kubernetes仪表板:</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="126a" class="jo jp hh lh b fi ll lm l ln lo">GITHUB_URL=https://github.com/kubernetes/dashboard/releases</span><span id="646e" class="jo jp hh lh b fi lp lm l ln lo">VERSION_KUBE_DASHBOARD=$(curl -w ‘%{url_effective}’ -I -L -s -S ${GITHUB_URL}/latest -o /dev/null | sed -e ‘s|.*/||’)</span><span id="7e7f" class="jo jp hh lh b fi lp lm l ln lo">k3s kubectl create -f <a class="ae jn" href="https://raw.githubusercontent.com/kubernetes/dashboard/${VERSION_KUBE_DASHBOARD}/aio/deploy/recommended.yaml" rel="noopener ugc nofollow" target="_blank">https://raw.githubusercontent.com/kubernetes/dashboard/${VERSION_KUBE_DASHBOARD}/aio/deploy/recommended.yaml</a></span></pre><p id="bfa1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">创建管理用户和集群角色绑定，并保存到文件“dashboard.admin-user.yaml”:</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="3ffc" class="jo jp hh lh b fi ll lm l ln lo">apiVersion: v1<br/>kind: ServiceAccount<br/>metadata:<br/>  name: admin-user<br/>  namespace: kubernetes-dashboard</span><span id="98a5" class="jo jp hh lh b fi lp lm l ln lo">---<br/>apiVersion: rbac.authorization.k8s.io/v1<br/>kind: ClusterRoleBinding<br/>metadata:<br/>  name: admin-user<br/>roleRef:<br/>  apiGroup: rbac.authorization.k8s.io<br/>  kind: ClusterRole<br/>  name: cluster-admin<br/>subjects:<br/>- kind: ServiceAccount<br/>  name: admin-user<br/>  namespace: kubernetes-dashboard</span></pre><p id="08c6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">创建具有管理员权限的用户并获取不记名令牌:</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="3b83" class="jo jp hh lh b fi ll lm l ln lo">kubectl create -f dashboard.admin-user.yaml</span></pre><p id="c617" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">退出ssh会话并设置端口转发:</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="a6f2" class="jo jp hh lh b fi ll lm l ln lo">ssh -L 8001:localhost:8001 opc@public_ip</span></pre><p id="585a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">获取不记名令牌并运行kubectl代理:</p><pre class="lc ld le lf fd lg lh li lj aw lk bi"><span id="4bd4" class="jo jp hh lh b fi ll lm l ln lo">k3s kubectl -n kubernetes-dashboard describe secret admin-user-token | grep ‘^token’</span><span id="7a22" class="jo jp hh lh b fi lp lm l ln lo">k3s kubectl proxy</span></pre><p id="13e3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">使用您的浏览器访问位于<a class="ae jn" href="http://localhost:8001/api/v1/namespaces/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/" rel="noopener ugc nofollow" target="_blank">的仪表板，http://localhost:8001/API/v1/namespace/kubernetes-dashboard/services/https:kubernetes-dashboard:/proxy/</a></p><p id="e7cd" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">确保您选择了“令牌”选项来登录并粘贴您在上面获取的无记名令牌的值。</p><p id="116d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您现在可以登录您的Kubernetes仪表板了。</p><h2 id="f768" class="jo jp hh bd jq jr js jt ju jv jw jx jy ja jz ka kb je kc kd ke ji kf kg kh ki bi translated">结论</h2><p id="2934" class="pw-post-body-paragraph ip iq hh ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated">嗯，这非常简单:一个Kubernetes集群在不到10分钟的时间内启动并运行，同时输入这个。不可否认，它是所有东西的单一节点，所以我想看看我能通过一点自动化实现什么:4分钟和11分钟。在以后的文章中，我们将更多地尝试其他部署选项，并使用其他OCI服务。</p><p id="2a8c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">参考资料:<a class="ae jn" href="https://rancher.com/docs/k3s/latest/en/installation/kube-dashboard/" rel="noopener ugc nofollow" target="_blank">https://rancer . com/docs/k3s/last/en/installation/kube-dashboard/</a></p></div></div>    
</body>
</html>