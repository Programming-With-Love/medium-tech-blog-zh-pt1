<html>
<head>
<title>Introduction to Node &amp; Express</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node &amp; Express简介</h1>
<blockquote>原文：<a href="https://medium.com/javascript-scene/introduction-to-node-express-90c431f9e6fd?source=collection_archive---------3-----------------------#2016-11-16">https://medium.com/javascript-scene/introduction-to-node-express-90c431f9e6fd?source=collection_archive---------3-----------------------#2016-11-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/8d9ee77936ebc978642bb87683b79b4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_BDozShS6r8dDACjRps4Lg.png"/></div></div></figure><blockquote class="ip iq ir"><p id="56e3" class="is it iu iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">这个帖子系列为<a class="ae jr" href="https://ericelliottjs.com/product/lifetime-access-pass/" rel="noopener ugc nofollow" target="_blank">“跟随Eric Elliott学习JavaScript”</a>的成员提供了配套的视频和练习。会员的视频课在这里:<a class="ae jr" href="https://ericelliottjs.com/premium-content/introduction-to-node-express/" rel="noopener ugc nofollow" target="_blank">《节点与快车入门》视频课程</a>。还不是会员？<a class="ae jr" href="https://ericelliottjs.com/product/lifetime-access-pass/" rel="noopener ugc nofollow" target="_blank">现在报名</a>。</p></blockquote></div><div class="ab cl js jt go ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="ha hb hc hd he"><p id="c129" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">Node是一个JavaScript环境，构建在谷歌Chrome网络浏览器中使用的同一JavaScript引擎上。它有一些很棒的特性，这些特性使它成为构建服务器端应用程序中间层的有吸引力的选择，包括web服务器和用于平台API的web服务。</p><p id="c26a" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">非阻塞事件驱动的I/O模型为它提供了非常有吸引力的性能，轻松击败了PHP和Ruby on Rails等线程服务器环境，这些环境在I/O上阻塞，并通过为每个用户旋转单独的线程来处理多个并发用户。</p><p id="d808" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">我已经将拥有数千万用户的生产应用程序从PHP和Ruby on Rails移植到Node，使响应处理时间和单个服务器同时处理的用户数量提高了2到10倍。</p><p id="69d0" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated"><strong class="iv hi">节点特性:</strong></p><ul class=""><li id="750a" class="kc kd hh iv b iw ix ja jb jz ke ka kf kb kg jq kh ki kj kk bi translated">快！(默认情况下为非阻塞I/O)。</li><li id="309d" class="kc kd hh iv b iw kl ja km jz kn ka ko kb kp jq kh ki kj kk bi translated">事件驱动。</li><li id="31a1" class="kc kd hh iv b iw kl ja km jz kn ka ko kb kp jq kh ki kj kk bi translated">一流的网络。</li><li id="5289" class="kc kd hh iv b iw kl ja km jz kn ka ko kb kp jq kh ki kj kk bi translated">一流的流式API。</li><li id="8256" class="kc kd hh iv b iw kl ja km jz kn ka ko kb kp jq kh ki kj kk bi translated">用于与操作系统、文件系统等接口的优秀标准库…</li><li id="03d3" class="kc kd hh iv b iw kl ja km jz kn ka ko kb kp jq kh ki kj kk bi translated">当您需要用C++之类的低级语言扩展Node的功能时，支持编译的二进制模块。</li><li id="cdc9" class="kc kd hh iv b iw kl ja km jz kn ka ko kb kp jq kh ki kj kk bi translated">受运行任务关键型应用程序的大型企业的信任和支持。(Adobe、谷歌、微软、网飞、贝宝、优步、沃尔玛等……)。</li><li id="8204" class="kc kd hh iv b iw kl ja km jz kn ka ko kb kp jq kh ki kj kk bi translated">容易上手。</li></ul><h1 id="b3cb" class="kq kr hh bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">安装节点</h1><p id="041c" class="pw-post-body-paragraph is it hh iv b iw lo iy iz ja lp jc jd jz lq jg jh ka lr jk jl kb ls jo jp jq ha bi translated">在我们开始之前，让我们确保您已经安装了Node。Node始终有两个受支持的版本，长期支持版本(稳定)和当前版本。对于生产项目，尝试LTS版本。如果你想玩未来的尖端功能，选择当前版本。</p><h2 id="8945" class="lt kr hh bd ks lu lv lw kw lx ly lz la jz ma mb le ka mc md li kb me mf lm mg bi translated">Windows操作系统</h2><p id="eed3" class="pw-post-body-paragraph is it hh iv b iw lo iy iz ja lp jc jd jz lq jg jh ka lr jk jl kb ls jo jp jq ha bi translated">点击<a class="ae jr" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank">节点网站</a>，点击其中一个绿色大安装按钮。</p><h2 id="83e8" class="lt kr hh bd ks lu lv lw kw lx ly lz la jz ma mb le ka mc md li kb me mf lm mg bi translated">Mac或Linux</h2><p id="19a1" class="pw-post-body-paragraph is it hh iv b iw lo iy iz ja lp jc jd jz lq jg jh ka lr jk jl kb ls jo jp jq ha bi translated">如果你在Mac或Linux系统上，我最喜欢用nvm安装Node。</p><p id="7780" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">要安装或更新nvm，您可以使用cURL使用<a class="ae jr" href="https://github.com/creationix/nvm/blob/v0.32.1/install.sh" rel="noopener ugc nofollow" target="_blank">安装脚本</a>:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="3e04" class="lt kr hh mm b fi mq mr l ms mt">curl -o- https://raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh | bash</span></pre><p id="8f9a" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">或Wget:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="b222" class="lt kr hh mm b fi mq mr l ms mt">wget -qO- https://raw.githubusercontent.com/creationix/nvm/v0.33.11/install.sh | bash</span></pre><p id="3a67" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">一旦安装了nvm，您可以使用它来安装任何版本的节点。</p><h1 id="b6da" class="kq kr hh bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">你好，世界！</h1><p id="76f6" class="pw-post-body-paragraph is it hh iv b iw lo iy iz ja lp jc jd jz lq jg jh ka lr jk jl kb ls jo jp jq ha bi translated">Node &amp; Express非常简单，您可以用一个基本的web服务器来服务“Hello，world！”在大约12行代码中:</p><figure class="mh mi mj mk fd ii"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="56f3" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">在这段代码运行之前，您需要对您的应用程序进行一些设置。首先创建一个新的git repo:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="9f76" class="lt kr hh mm b fi mq mr l ms mt">mkdir my-node-app &amp;&amp; cd my-node-app<br/>git init</span></pre><p id="4864" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">你需要一个<code class="du mw mx my mm b">package.json</code>文件来存储你的应用程序的配置。要创建一个，请使用Node:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="95b1" class="lt kr hh mm b fi mq mr l ms mt">npm init</span></pre><p id="135a" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">回答几个问题(应用名称、git回购等)，你就可以开始了。然后，您需要安装Express:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="3622" class="lt kr hh mm b fi mq mr l ms mt">npm install --save express</span></pre><p id="79a1" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">安装完依赖项后，您可以通过键入以下内容来运行应用程序:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="b53f" class="lt kr hh mm b fi mq mr l ms mt">node index.js</span></pre><p id="55bc" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">用<code class="du mw mx my mm b">curl</code>测试一下:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="b455" class="lt kr hh mm b fi mq mr l ms mt">curl localhost:3000</span></pre><p id="bf8e" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">或者在浏览器中访问<code class="du mw mx my mm b">localhost:3000</code>。</p><p id="a1eb" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">就是这样！您刚刚构建了第一个节点应用程序。</p><h1 id="2615" class="kq kr hh bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">环境变量</h1><p id="b9c3" class="pw-post-body-paragraph is it hh iv b iw lo iy iz ja lp jc jd jz lq jg jh ka lr jk jl kb ls jo jp jq ha bi translated">您可以使用环境变量来配置节点应用程序。这使得在不同的环境中使用不同的配置变得容易，比如开发人员的本地机器、测试服务器、中间服务器和生产服务器。</p><p id="5e9e" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">您还应该使用环境变量将应用程序机密(如API密钥)注入到应用程序中，而无需将它们签入源代码控制。一些部署环境允许您使用包含应用程序配置设置的<code class="du mw mx my mm b">.env</code>文件，但是您会遇到这样的问题，“我如何将<code class="du mw mx my mm b">.env</code>设置加载到应用程序可以使用的环境变量中？”</p><p id="414c" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">为此，请尝试使用节点的<a class="ae jr" href="https://github.com/motdotla/dotenv" rel="noopener ugc nofollow" target="_blank"> dotenv </a>:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="74f6" class="lt kr hh mm b fi mq mr l ms mt">npm install --save dotenv</span></pre><p id="76e4" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">然后在条目文件的顶部添加一行:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="f8e3" class="lt kr hh mm b fi mq mr l ms mt">require('dotenv').config();</span></pre><p id="9e82" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">现在你可以从一个<code class="du mw mx my mm b">.env</code>文件中加载<code class="du mw mx my mm b">port</code>设置。在项目根目录下创建一个名为<code class="du mw mx my mm b">.env</code>的新文件，如下所示:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="d40e" class="lt kr hh mm b fi mq mr l ms mt">PORT=5150</span></pre><p id="af14" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">保存它，并重新启动应用程序，您应该会看到:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="ad29" class="lt kr hh mm b fi mq mr l ms mt">listening on port 5150</span></pre><p id="92e3" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">您不想将您的<code class="du mw mx my mm b">.env</code>文件签入Git，所以将其添加到您的<code class="du mw mx my mm b">.gitignore</code>文件中。事实上，当我们这样做的时候，让我们也添加一些其他的东西:</p><figure class="mh mi mj mk fd ii"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="44e1" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">您仍然希望记录您的应用程序所需的设置，所以我喜欢签入一份编辑了应用程序机密的<code class="du mw mx my mm b">.env</code>文件。该应用的新用户可以复制文件，将其命名为<code class="du mw mx my mm b">.env</code>，自定义设置，然后关闭并运行。我将签入的副本命名为<code class="du mw mx my mm b">.env.example</code>，并在项目的<code class="du mw mx my mm b">README.md</code>文件中包含对开发人员的说明。</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="fead" class="lt kr hh mm b fi mq mr l ms mt">PORT=5150<br/>AWS_KEY=&lt;your AWS key here&gt;</span></pre><p id="6680" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">请注意，您应该小心，所有的应用程序机密都被编辑在您的<code class="du mw mx my mm b">.env.example</code>文件中，如所示。</p><blockquote class="mz"><p id="5486" class="na nb hh bd nc nd ne nf ng nh ni jq dx translated">不要将您的应用程序秘密签入Git存储库。</p></blockquote><h1 id="d96e" class="kq kr hh bd ks kt ku kv kw kx ky kz la lb nj ld le lf nk lh li lj nl ll lm ln bi translated">测试节点应用程序</h1><p id="26ec" class="pw-post-body-paragraph is it hh iv b iw lo iy iz ja lp jc jd jz lq jg jh ka lr jk jl kb ls jo jp jq ha bi translated">我喜欢用<a class="ae jr" href="https://github.com/visionmedia/supertest" rel="noopener ugc nofollow" target="_blank"> Supertest </a>测试节点应用，它抽象出了http连接问题，并提供了一个简单、流畅的API。对于http端点，我使用<a class="ae jr" href="https://www.sitepoint.com/javascript-testing-unit-functional-integration/" rel="noopener ugc nofollow" target="_blank">功能测试</a>，这意味着我不用担心嘲讽数据库等等。我只是用一些值点击API，并期望得到一个具体的响应。</p><p id="abb8" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">这里有一个简单的Supertest和<a class="ae jr" rel="noopener" href="/javascript-scene/why-i-use-tape-instead-of-mocha-so-should-you-6aa105d8eaf4">磁带</a>的例子:</p><figure class="mh mi mj mk fd ii"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="49c4" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">我还为我用来构建API的任何更小的、可重用的模块编写单元测试。</p><p id="8d94" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">请注意，我们不是处理网络，而是直接导入express应用程序。Supertest不需要读取您的应用程序配置来知道要连接到哪个端口。它在幕后处理所有这些细节，但要实现这一点，您需要在应用文件中导出您的应用:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="0309" class="lt kr hh mm b fi mq mr l ms mt">module.exports = app;</span></pre><p id="da52" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">出于这个和其他原因，我将我的应用程序分成几个不同的部分，<code class="du mw mx my mm b">app.js</code>我构建和配置应用程序本身，<code class="du mw mx my mm b">server.js</code>我导入应用程序，处理网络细节，并调用<code class="du mw mx my mm b">app.listen()</code>。</p><h2 id="34cd" class="lt kr hh bd ks lu lv lw kw lx ly lz la jz ma mb le ka mc md li kb me mf lm mg bi translated">设置节点路径</h2><p id="037c" class="pw-post-body-paragraph is it hh iv b iw lo iy iz ja lp jc jd jz lq jg jh ka lr jk jl kb ls jo jp jq ha bi translated">当你开始把你的应用分成模块时，你可能会厌倦这样的相对路径要求:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="6086" class="lt kr hh mm b fi mq mr l ms mt">const app = require('../../app');</span></pre><p id="ef55" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">幸运的是，你不需要使用它们。将你的应用程序文件放在名为<code class="du mw mx my mm b">source</code>或<code class="du mw mx my mm b">src</code>的目录中，然后设置<code class="du mw mx my mm b">NODE_PATH</code>环境变量。您可以使用<code class="du mw mx my mm b">cross-env</code>来设置环境变量，以便它们能够跨平台工作(在Windows上读取、运行您的应用程序):</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="3fce" class="lt kr hh mm b fi mq mr l ms mt">npm install --save cross-env</span></pre><p id="6fc6" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">然后在您的<code class="du mw mx my mm b">package.json</code>脚本中，您可以安全地设置您的环境变量:</p><figure class="mh mi mj mk fd ii"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="8600" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">使用<code class="du mw mx my mm b">NODE_PATH</code>设置，您可以要求如下模块:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="c633" class="lt kr hh mm b fi mq mr l ms mt">const app = require('app');</span></pre><p id="cd39" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">好多了！</p><h1 id="16b1" class="kq kr hh bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">中间件</h1><p id="687c" class="pw-post-body-paragraph is it hh iv b iw lo iy iz ja lp jc jd jz lq jg jh ka lr jk jl kb ls jo jp jq ha bi translated">Express是最流行的节点应用程序框架，它的特色是使用连续传递的中间件。当您想要为潜在的许多不同路线运行相同的代码时，该代码的合适位置可能是中间件。</p><p id="d8b6" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">中间件是一个传递请求和响应对象的函数，以及一个调用的延续函数，称为<code class="du mw mx my mm b">next()</code>。假设您想为每个请求/响应对添加一个<code class="du mw mx my mm b">requestId</code>,这样当您调试或搜索日志时，就可以很容易地追溯到单个请求。</p><p id="70f6" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">你可以像这样写一些中间件:</p><figure class="mh mi mj mk fd ii"><div class="bz dy l di"><div class="mu mv l"/></div></figure><h1 id="e40c" class="kq kr hh bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">内存管理</h1><p id="ce5c" class="pw-post-body-paragraph is it hh iv b iw lo iy iz ja lp jc jd jz lq jg jh ka lr jk jl kb ls jo jp jq ha bi translated">由于Node是单线程的，这意味着所有用户将共享相同的内存空间。换句话说，与在浏览器中不同，您必须小心不要将特定于用户的数据存储在闭包中，因为其他连接可以获取这些数据。出于这个原因，我喜欢使用<code class="du mw mx my mm b">res.locals</code>来存储临时用户数据，这些数据只在用户的请求/响应周期内可用:</p><figure class="mh mi mj mk fd ii"><div class="bz dy l di"><div class="mu mv l"/></div></figure><p id="ab2f" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">这也是上面提到的<code class="du mw mx my mm b">requestId</code>比较好的存放方式。</p><h1 id="f5d3" class="kq kr hh bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">调试节点应用程序</h1><p id="9f56" class="pw-post-body-paragraph is it hh iv b iw lo iy iz ja lp jc jd jz lq jg jh ka lr jk jl kb ls jo jp jq ha bi translated">Node v6.4.x+附带了一个集成的Chrome调试器，因此您可以连接Node使用与您在浏览器中调试JS应用程序相同的工具。</p><p id="96c1" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">要使用它，只需在想要设置断点的任何地方添加调试器语句，然后运行:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="0db6" class="lt kr hh mm b fi mq mr l ms mt">node --inspect-brk source/app.js</span></pre><p id="24b9" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">在浏览器中打开<code class="du mw mx my mm b">chrome://inspect/</code>，点击目标，你会得到一个交互式调试环境。</p><figure class="mh mi mj mk fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es nm"><img src="../Images/a7469289a439d4e7c6a104c6f4b9219a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U0VOYcBh6FBzVhtsjqvf4Q.png"/></div></div></figure><p id="f083" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">我默认使用<code class="du mw mx my mm b">--inspect-brk</code>来告诉它在开始时中断，但是你可以省去它。请记住，您可能需要在浏览器中或从curl中点击您的路线来触发路线处理程序并点击您的断点。</p><p id="95b9" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">你可能已经知道，Chrome的开发工具充满了有价值的调试见解。您可以分析、检查内存管理并观察内存泄漏，一次一行地单步执行代码，将鼠标悬停在变量上以查看值，等等</p><h1 id="fa5a" class="kq kr hh bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">让它崩溃吧</h1><p id="9439" class="pw-post-body-paragraph is it hh iv b iw lo iy iz ja lp jc jd jz lq jg jh ka lr jk jl kb ls jo jp jq ha bi translated">进程崩溃。像所有事情一样，您的服务器的运行时可能会在某个时候遇到它无法处理的错误。别担心。记录错误，关闭服务器，并启动一个新实例。</p><p id="f65d" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">你绝对不能做的是:</p><pre class="mh mi mj mk fd ml mm mn mo aw mp bi"><span id="779a" class="lt kr hh mm b fi mq mr l ms mt">process.on('uncaughtException', (err) =&gt; {<br/>  console.log('Oops!');<br/>});</span></pre><p id="1974" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">当出现未捕获的异常时，您必须关闭进程，因为根据定义，如果您不知道应用程序出了什么问题，您的应用程序就处于未知、未定义的状态，几乎任何事情都可能出错。</p><p id="01df" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">你可能会泄露资源。您的用户可能看不到正确的数据。你可能会有各种疯狂的，不确定的行为。当出现您没有特别计划的异常时，记录错误，尽可能清理资源，并关闭进程。</p><p id="91bc" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">我编写了一个模块，让Node的错误处理变得更加简单。查看<a class="ae jr" href="https://github.com/ericelliott/express-error-handler" rel="noopener ugc nofollow" target="_blank">快速错误处理程序</a>。</p><h2 id="4d9b" class="lt kr hh bd ks lu lv lw kw lx ly lz la jz ma mb le ka mc md li kb me mf lm mg bi translated">故障修复</h2><p id="ad1d" class="pw-post-body-paragraph is it hh iv b iw lo iy iz ja lp jc jd jz lq jg jh ka lr jk jl kb ls jo jp jq ha bi translated">有各种各样的服务器监控实用程序来检测崩溃和修复服务，以保持事情顺利运行，即使面对意外的异常。</p><p id="2a8c" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">为此我强烈推荐<a class="ae jr" href="http://pm2.keymetrics.io/" rel="noopener ugc nofollow" target="_blank"> PM2 </a>。我使用它，它受到微软、IBM和PayPal等公司的信任。</p><p id="5ed7" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">要安装，运行<code class="du mw mx my mm b">npm install -g pm2</code>。使用<code class="du mw mx my mm b">npm install --save-dev pm2</code>在本地安装。然后你就可以用<code class="du mw mx my mm b">pm2 start source/app.js</code>启动应用了。</p><p id="6e5b" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">你可以用<code class="du mw mx my mm b">pm2 list</code>管理正在运行的应用实例，用<code class="du mw mx my mm b">pm2 stop</code>停止实例。详见<a class="ae jr" href="http://pm2.keymetrics.io/docs/usage/quick-start/" rel="noopener ugc nofollow" target="_blank">快速启动</a>。</p><p id="c159" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">额外好处:PM2可以配置为与<a class="ae jr" href="https://keymetrics.io/" rel="noopener ugc nofollow" target="_blank"> Keymetrics </a>集成，这可以通过友好的web界面提供对您的生产应用程序实例的深刻见解。</p><h1 id="f759" class="kq kr hh bd ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln bi translated">结论</h1><p id="a6c9" class="pw-post-body-paragraph is it hh iv b iw lo iy iz ja lp jc jd jz lq jg jh ka lr jk jl kb ls jo jp jq ha bi translated">我们只是触及了节点的表面。还有很多东西需要学习，包括会话管理、令牌认证、API设计等等。我已经在<a class="ae jr" href="http://pjabook.com" rel="noopener ugc nofollow" target="_blank">“JavaScript应用程序编程”</a>(免费在线)中更深入地讨论了其中的一些主题。</p></div><div class="ab cl js jt go ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="ha hb hc hd he"><p id="b568" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">想了解更多关于Node的知识吗？我们将为EricElliottJS.com的成员推出一个新的节点视频系列。如果你不是会员，你就错过了。</p><figure class="mh mi mj mk fd ii er es paragraph-image"><a href="https://ericelliottjs.com"><div class="er es ie"><img src="../Images/ebd7dfc9ae8d8938e30bdbdbe428fd4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3njisYUeHOdyLCGZ8czt_w.jpeg"/></div></a></figure></div><div class="ab cl js jt go ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="ha hb hc hd he"><p id="5e7e" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated"><strong class="iv hi"> <em class="iu">埃里克·艾略特</em> </strong> <em class="iu">著有</em> <a class="ae jr" href="http://pjabook.com" rel="noopener ugc nofollow" target="_blank"> <em class="iu">【编程JavaScript应用】</em> </a> <em class="iu">(奥赖利)，以及</em> <a class="ae jr" href="http://ericelliottjs.com/product/lifetime-access-pass/" rel="noopener ugc nofollow" target="_blank"> <em class="iu">《跟埃里克·艾略特学JavaScript》</em></a><em class="iu">。他为Adobe Systems</em><strong class="iv hi"><em class="iu"/></strong><em class="iu"/><strong class="iv hi"><em class="iu">Zumba Fitness</em></strong><em class="iu"/><strong class="iv hi"><em class="iu">华尔街日报</em></strong><em class="iu"/><strong class="iv hi"><em class="iu">ESPN</em></strong><em class="iu"/><em class="iu">BBC</em><em class="iu">等顶级录音师贡献了软件经验</em></p><p id="61a2" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd jz jf jg jh ka jj jk jl kb jn jo jp jq ha bi translated">他大部分时间都在旧金山湾区和世界上最美丽的女人在一起。</p></div></div>    
</body>
</html>