<html>
<head>
<title>Ktor for fast server prototyping</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于快速服务器原型制作的Ktor</h1>
<blockquote>原文：<a href="https://blog.kotlin-academy.com/ktor-for-fast-server-prototyping-6e7c6d2ec296?source=collection_archive---------5-----------------------#2019-10-28">https://blog.kotlin-academy.com/ktor-for-fast-server-prototyping-6e7c6d2ec296?source=collection_archive---------5-----------------------#2019-10-28</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/31e41750a9cd4ebce70255ae9348faa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OTQVzaeXTrtH2k3r"/></div></div><figcaption class="jv jw gj gh gi jx jy bd b be z dk">Photo by <a class="ae jz" href="https://unsplash.com/@seletcky?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Mark Seletcky</a> on <a class="ae jz" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="10e2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Ktor是一个用Kotlin创建服务器和客户端应用程序的框架。正如创造者所说——它的最终目标是为互联的多平台应用提供端到端的解决方案。</p><p id="b32f" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在本文中，您将找到简单服务器应用程序的Ktor设置和实现的基础。</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><h1 id="08b5" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">装置</h1><p id="d465" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">对于快速原型，你通常不需要创建一个新的项目——你甚至可以在一个Android项目中添加Ktor模块作为一个Gradle子项目。具有Ktor依赖关系的最基本的build.gradle如下所示:</p><figure class="mi mj mk ml gt jo"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="35b1" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">你还应该在<code class="fe mo mp mq mr b">src/resources</code>中定义<code class="fe mo mp mq mr b">application.conf</code>文件，这样<code class="fe mo mp mq mr b">application</code>插件就会知道如何启动你的应用程序:</p><figure class="mi mj mk ml gt jo"><div class="bz fp l di"><div class="mm mn l"/></div></figure><h1 id="cabb" class="lf lg in bd lh li ms lk ll lm mt lo lp lq mu ls lt lu mv lw lx ly mw ma mb mc bi translated">履行</h1><h2 id="d2c5" class="mx lg in bd lh my mz dn ll na nb dp lp kl nc nd lt kp ne nf lx kt ng nh mb ni bi translated">运行正常的</h2><p id="0c1c" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">让我们从一个简单的端点开始，它将返回预定义的值和Http状态代码:</p><figure class="mi mj mk ml gt jo"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="76f5" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">让我们在本地测试这个端点。执行<code class="fe mo mp mq mr b">./gradlew run</code>并等待应用程序启动。然后使用curl或您最喜欢的rest客户端，看看会发生什么:</p><pre class="mi mj mk ml gt nj mr nk nl aw nm bi"><span id="7474" class="mx lg in mr b gy nn no l np nq">$ curl -i localhost:8080/<br/>HTTP/1.1 200 OK<br/>Content-Length: 13<br/>Content-Type: text/plain; charset=UTF-8</span><span id="501b" class="mx lg in mr b gy nr no l np nq">Test message</span></pre><p id="cb3e" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们收到了一条原始回复。在应用客户端，我们不喜欢文本响应，我们在任何地方都使用JSON。如何从你的API返回JSON？没有更简单的了。我们将利用Ktor JSON的一个特性。</p><blockquote class="ns nt nu"><p id="00da" class="ka kb nv kc b kd ke kf kg kh ki kj kk nw km kn ko nx kq kr ks ny ku kv kw kx ig bi translated">KTOR的特性是可插拔依赖——在大多数情况下，它拦截请求和响应，并能够对它们做一些事情。在应用DSL中，我们使用安装功能添加该特性。</p></blockquote><p id="0710" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">添加依赖项:</p><pre class="mi mj mk ml gt nj mr nk nl aw nm bi"><span id="3fc1" class="mx lg in mr b gy nn no l np nq">implementation "io.ktor:ktor-gson:$ktor_version"</span></pre><p id="4b29" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">并在应用程序中安装该功能:</p><figure class="mi mj mk ml gt jo"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="c206" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如您所见，添加了<code class="fe mo mp mq mr b">mapOf("status" to "Test message")</code>——Gson会将该结构解析为可读的Json。</p><p id="1028" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">重新构建项目并再次测试您的端点:</p><pre class="mi mj mk ml gt nj mr nk nl aw nm bi"><span id="35d1" class="mx lg in mr b gy nn no l np nq">$ curl -i localhost:8080/<br/>HTTP/1.1 200 OK<br/>Content-Length: 25<br/>Content-Type: application/json; charset=UTF-8</span><span id="9fca" class="mx lg in mr b gy nr no l np nq">{"status":"Test message"}</span></pre><h2 id="3b16" class="mx lg in bd lh my mz dn ll na nb dp lp kl nc nd lt kp ne nf lx kt ng nh mb ni bi translated">创建、读取、更新、删除</h2><p id="544c" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">为了使用CRUD功能，我们将使用以下带有内存数据源实现的存储库:</p><figure class="mi mj mk ml gt jo"><div class="bz fp l di"><div class="mm mn l"/></div></figure><h2 id="7333" class="mx lg in bd lh my mz dn ll na nb dp lp kl nc nd lt kp ne nf lx kt ng nh mb ni bi translated">创建和更新-接收功能</h2><p id="a4ad" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">我们将创建<code class="fe mo mp mq mr b">post</code>路线，在这里我们将<strong class="kc io">接收</strong>一个合适的项目，将该项目添加到存储库中，并且<strong class="kc io">用一些<strong class="kc io">结果</strong>来响应</strong>:</p><figure class="mi mj mk ml gt jo"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="f5b2" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">我们在调用中使用了<code class="fe mo mp mq mr b">io.ktor.reqeust.receive&lt;*&gt;</code>函数——因为我们在前面的步骤中添加了<code class="fe mo mp mq mr b">gson()</code>, JSON项将被转换为<code class="fe mo mp mq mr b">Item</code>数据类。</p><pre class="mi mj mk ml gt nj mr nk nl aw nm bi"><span id="8802" class="mx lg in mr b gy nn no l np nq">$ curl -i -XPOST -H "Content-type: application/json" <br/>-d '{<br/>      "id":"3",<br/>      "message":"First message"<br/>    }'<br/>'localhost:8080/items'</span></pre><p id="9c14" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">应该返回什么:</p><pre class="mi mj mk ml gt nj mr nk nl aw nm bi"><span id="40bc" class="mx lg in mr b gy nn no l np nq">HTTP/1.1 201 Created<br/>Content-Length: 36<br/>Content-Type: application/json; charset=UTF-8</span><span id="9729" class="mx lg in mr b gy nr no l np nq">{"id":"3","message":"First message"}</span></pre><h2 id="9b92" class="mx lg in bd lh my mz dn ll na nb dp lp kl nc nd lt kp ne nf lx kt ng nh mb ni bi translated">删除—调用参数</h2><p id="8a8a" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">为了创建<code class="fe mo mp mq mr b">delete</code>端点，我们将利用<strong class="kc io">调用参数</strong>属性。</p><figure class="mi mj mk ml gt jo"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="a782" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如你所见，我们在路径定义中定义了<code class="fe mo mp mq mr b">{id}</code>。Ktor能够<strong class="kc io">识别和检索路径参数</strong>，所以我们以后可以使用它。</p><h2 id="7020" class="mx lg in bd lh my mz dn ll na nb dp lp kl nc nd lt kp ne nf lx kt ng nh mb ni bi translated">阅读—获取</h2><p id="4e2b" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">最后，让我们实现<code class="fe mo mp mq mr b">get</code>端点，它将检索项目的完整列表:</p><figure class="mi mj mk ml gt jo"><div class="bz fp l di"><div class="mm mn l"/></div></figure><p id="a96a" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">在执行GET on <code class="fe mo mp mq mr b">/items</code>之后，您应该会收到您放入存储库的所有项目:</p><pre class="mi mj mk ml gt nj mr nk nl aw nm bi"><span id="e907" class="mx lg in mr b gy nn no l np nq">$ curl -i localhost:8080/items<br/>HTTP/1.1 200 OK<br/>Content-Length: 77<br/>Content-Type: application/json; charset=UTF-8</span><span id="4147" class="mx lg in mr b gy nr no l np nq">[{"id":"3","message":"First message"},{"id":"23","message":"Second message"}]</span></pre><h1 id="866a" class="lf lg in bd lh li ms lk ll lm mt lo lp lq mu ls lt lu mv lw lx ly mw ma mb mc bi translated">摘要</h1><ul class=""><li id="6500" class="nz oa in kc b kd md kh me kl ob kp oc kt od kx oe of og oh bi translated">✔·科特林首先——不需要处理复杂的基于Java的API</li><li id="61c7" class="nz oa in kc b kd oi kh oj kl ok kp ol kt om kx oe of og oh bi translated">️✔易于入手—只需一个依赖项即可实现</li><li id="89bc" class="nz oa in kc b kd oi kh oj kl ok kp ol kt om kx oe of og oh bi translated">✔可读性—所见即所得。路由DSL是定义端点的一种非常优雅的方式</li><li id="2de8" class="nz oa in kc b kd oi kh oj kl ok kp ol kt om kx oe of og oh bi translated">❌没有春天那么多的整合</li><li id="8f33" class="nz oa in kc b kd oi kh oj kl ok kp ol kt om kx oe of og oh bi translated">❌还没有黄金标准</li></ul><p id="deb3" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">以前我首选的API原型工具是express . js——现在Ktor取代了它的位置。我发现它非常容易使用——几乎每一个功能都像我期望的那样工作。对于更大的项目，我仍然会使用Spring——它更成熟，有很多集成。</p><p id="7b00" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">那些利弊只是我的拙见。你应该亲自看看Ktor如何在后端和前端为你服务。</p></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><h1 id="0718" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">链接和资源</h1><div class="on oo gp gr op oq"><a href="https://ktor.io" rel="noopener  ugc nofollow" target="_blank"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd io gy z fp ov fr fs ow fu fw im bi translated">ktor-kot Lin的异步Web框架</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">Ktor是一个框架，用于在连接的系统中使用强大的Kotlin构建异步服务器和客户机。</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">ktor.io</p></div></div><div class="oz l"><div class="pa l pb pc pd oz pe jt oq"/></div></div></a></div><div class="on oo gp gr op oq"><a href="https://github.com/rozkminiacz/ktor-playground" rel="noopener  ugc nofollow" target="_blank"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd io gy z fp ov fr fs ow fu fw im bi translated">rozkminiacz/ktor-游乐场</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">github.com</p></div></div><div class="oz l"><div class="pf l pb pc pd oz pe jt oq"/></div></div></a></div><div class="on oo gp gr op oq"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-create-a-rest-api-client-and-its-integration-tests-in-kotlin-multiplatform-d76c9a1be348"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd io gy z fp ov fr fs ow fu fw im bi translated">如何在Kotlin多平台中创建REST API客户端及其集成测试</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">这篇文章是我在博客xurxodev.com上的原文的英文翻译。</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">blog.kotlin-academy.com</p></div></div><div class="oz l"><div class="pg l pb pc pd oz pe jt oq"/></div></div></a></div></div><div class="ab cl ky kz hr la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ig ih ii ij ik"><h1 id="d0db" class="lf lg in bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">单击👏说“谢谢！”并帮助他人找到这篇文章。</h1><p id="981e" class="pw-post-body-paragraph ka kb in kc b kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt mh kv kw kx ig bi translated">了解卡帕头最新的重大新闻。学院，<a class="ae jz" href="https://kotlin-academy.us17.list-manage.com/subscribe?u=5d3a48e1893758cb5be5c2919&amp;id=d2ba84960a" rel="noopener ugc nofollow" target="_blank">订阅时事通讯</a>，<a class="ae jz" href="https://twitter.com/ktdotacademy" rel="noopener ugc nofollow" target="_blank">观察推特</a>并在媒体上关注我们。</p><p id="c662" class="pw-post-body-paragraph ka kb in kc b kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">如果您需要Kotlin工作室，请查看我们如何帮助您:<a class="ae jz" href="https://www.kt.academy/" rel="noopener ugc nofollow" target="_blank"> kt.academy </a>。</p><figure class="mi mj mk ml gt jo gh gi paragraph-image"><a href="https://kotlin-academy.us17.list-manage.com/subscribe?u=5d3a48e1893758cb5be5c2919&amp;id=d2ba84960a"><div class="gh gi ph"><img src="../Images/3146970f03e44cb07afe660b0d43e045.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*54OqlYA4etu7wfpmMP5TKQ.png"/></div></a></figure></div></div>    
</body>
</html>