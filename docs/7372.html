<html>
<head>
<title>Square In-App Payments SDK for React Native</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React Native的Square应用内支付SDK</h1>
<blockquote>原文：<a href="https://medium.com/square-corner-blog/square-in-app-payments-sdk-for-react-native-499520539d9a?source=collection_archive---------1-----------------------#2019-03-15">https://medium.com/square-corner-blog/square-in-app-payments-sdk-for-react-native-499520539d9a?source=collection_archive---------1-----------------------#2019-03-15</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="3a25" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">Square应用内支付SDK的React原生插件</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/7ce4d82928a3e34dd16d7a0b6afa6c80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*c8MmIMXKv_T3j5hE"/></div></div></figure><blockquote class="ji jj jk"><p id="168d" class="jl jm jn jo b jp jq ii jr js jt il ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">注意，我们已经行动了！如果您想继续了解Square的最新技术内容，请访问我们的新家<a class="ae ki" href="https://developer.squareup.com/blog" rel="noopener ugc nofollow" target="_blank">https://developer.squareup.com/blog</a></p></blockquote><p id="0244" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated">自从我们的应用内支付SDK发布以来，我们已经收到了很多关于React Native何时可用的请求。它正式在这里！你可以简单地在React原生项目中<code class="du km kn ko kp b">npm install — save react-native-square-in-app-payments</code>并遵循<a class="ae ki" href="https://github.com/square/in-app-payments-react-native-plugin/blob/master/docs/get-started.md" rel="noopener ugc nofollow" target="_blank">这里</a>的设置指南，开始在React原生应用中接受付款。</p><p id="a1d2" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated">如果你还不熟悉<a class="ae ki" rel="noopener" href="/square-corner-blog/introducing-square-in-app-payments-sdk-1fc93b32814c">应用内支付SDK </a>，它使开发者能够在他们自己的移动应用内接受Square-powered支付。</p><p id="5b97" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated">现在，说只安装SDK并继续前进太容易了，所以我们将深入研究我构建的React本机应用程序，以展示这是如何工作的。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es kq"><img src="../Images/f7bc8e4a44ac354c583a41b100f43d94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QrRbrkcWAMME8DWg"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx"><em class="kv">Our Order Ahead React Native App for buying Square Legos and demoed at ShopTalk.</em></figcaption></figure><h1 id="f85b" class="kw kx hh bd ky kz la lb lc ld le lf lg in lh io li iq lj ir lk it ll iu lm ln bi translated">获取您的开发人员环境设置</h1><p id="6b7e" class="pw-post-body-paragraph jl jm hh jo b jp lo ii jr js lp il ju kj lq jx jy kk lr kb kc kl ls kf kg kh ha bi translated">先决条件:</p><ul class=""><li id="3a85" class="lt lu hh jo b jp jq js jt kj lv kk lw kl lx kh ly lz ma mb bi translated"><a class="ae ki" href="https://developer.android.com/studio" rel="noopener ugc nofollow" target="_blank"> Android Studio </a>(点击链接下载安装)</li><li id="24e6" class="lt lu hh jo b jp mc js md kj me kk mf kl mg kh ly lz ma mb bi translated"><a class="ae ki" href="https://developer.apple.com/xcode/" rel="noopener ugc nofollow" target="_blank"> Xcode </a>(可以通过macOS上的App Store安装)</li><li id="ebde" class="lt lu hh jo b jp mc js md kj me kk mf kl mg kh ly lz ma mb bi translated"><a class="ae ki" href="https://squareup.com/us/en/developers" rel="noopener ugc nofollow" target="_blank">广场账户</a>(此处报名)</li><li id="9788" class="lt lu hh jo b jp mc js md kj me kk mf kl mg kh ly lz ma mb bi translated"><a class="ae ki" href="https://facebook.github.io/react-native/docs/getting-started" rel="noopener ugc nofollow" target="_blank"> React Native CLI </a>(遵循“使用本机代码构建项目”指南)</li></ul><p id="4948" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated">需要明确的是，如果你计划让你的应用程序在各自的平台上运行，并希望使用它们的模拟器进行开发，你只需要Android Studio或Xcode。</p><h1 id="9039" class="kw kx hh bd ky kz la lb lc ld le lf lg in lh io li iq lj ir lk it ll iu lm ln bi translated">步骤1:安装和设置React本机CLI</h1><p id="78aa" class="pw-post-body-paragraph jl jm hh jo b jp lo ii jr js lp il ju kj lq jx jy kk lr kb kc kl ls kf kg kh ha bi translated"><code class="du km kn ko kp b">npm install -g react-native-cli</code></p><p id="31be" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated">确保遵循<a class="ae ki" href="https://facebook.github.io/react-native/docs/getting-started" rel="noopener ugc nofollow" target="_blank"> React Native </a>安装指南中的<em class="jn">“使用本机代码构建项目”</em>。使用<code class="du km kn ko kp b">react-native-square-in-app-payments</code>插件需要应用内支付SDK，这是iOS和Android的原生代码。此外，遵循该指南的一部分要求您安装React Native CLI(上面的命令),这有助于在开发时方便链接库和运行模拟器。</p><h1 id="f3b5" class="kw kx hh bd ky kz la lb lc ld le lf lg in lh io li iq lj ir lk it ll iu lm ln bi translated">第二步:在你的项目中添加应用内支付反应插件</h1><p id="dd4a" class="pw-post-body-paragraph jl jm hh jo b jp lo ii jr js lp il ju kj lq jx jy kk lr kb kc kl ls kf kg kh ha bi translated">在你设置好React Native之后，你会想要按照Square <a class="ae ki" href="https://github.com/square/in-app-payments-react-native-plugin/blob/master/docs/get-started.md" rel="noopener ugc nofollow" target="_blank">指南将应用内支付添加到你的React Native项目</a>中。如果你是从零开始，你可能想看一看<a class="ae ki" href="https://github.com/square/in-app-payments-react-native-plugin/tree/master/react-native-in-app-payments-quickstart" rel="noopener ugc nofollow" target="_blank">快速入门示例应用</a>，它展示了一个允许用户购买cookie的示例应用。您也可以下载示例应用程序，然后在那里进行修改。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mh"><img src="../Images/a5705c304380312441c742b1b15c4595.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EjKx-XdCp-zNW1dG"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx"><em class="kv">Quick-start App for React Native In-App Payments Plugin.</em></figcaption></figure><h1 id="3af2" class="kw kx hh bd ky kz la lb lc ld le lf lg in lh io li iq lj ir lk it ll iu lm ln bi translated">使用应用内支付SDK进行React本地开发需要了解的事项</h1><h1 id="f5bb" class="kw kx hh bd ky kz la lb lc ld le lf lg in lh io li iq lj ir lk it ll iu lm ln bi translated">React应用内支付SDK的本机接口</h1><p id="ea14" class="pw-post-body-paragraph jl jm hh jo b jp lo ii jr js lp il ju kj lq jx jy kk lr kb kc kl ls kf kg kh ha bi translated"><strong class="jo hi"> SQIPCore </strong> —用于在React本地应用中初始化应用内支付SDK。</p><p id="df0b" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated"><strong class="jo hi"> SQIPCardEntry </strong> —处理标准信用卡表单捕获。值得注意的是，如果你想为你的用户在文件中存储一张<a class="ae ki" href="https://docs.connect.squareup.com/payments/transactions/cookbook/save-cards-on-file" rel="noopener ugc nofollow" target="_blank">卡，那么你只需要使用这个接口，因为你不能使用数字钱包存储卡的详细信息。</a></p><p id="72a3" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated"><strong class="jo hi"> SQIPApplePay </strong> —虽然名字相当简单，但是这个接口是用来处理ApplePay流程的。</p><p id="02b9" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated"><strong class="jo hi"> SQIPGooglePay </strong> —与Apply Pay接口相同，但用于处理GooglePay。</p><p id="0a49" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated">每个接口都有一些方法来启动流、处理错误或用户关闭表单，以及完成授权以获得一个nonce(一次性使用的令牌)。您仍然需要有一个后端实现来使用nonce，用于在客户档案中存储卡或处理交易。您可以在上的<a class="ae ki" href="https://docs.connect.squareup.com/payments/in-app-payments-sdk/how-it-works" rel="noopener ugc nofollow" target="_blank"> Square文档</a>中找到更多关于该流程如何工作的信息。</p><h1 id="f335" class="kw kx hh bd ky kz la lb lc ld le lf lg in lh io li iq lj ir lk it ll iu lm ln bi translated">路线/导航</h1><p id="fed1" class="pw-post-body-paragraph jl jm hh jo b jp lo ii jr js lp il ju kj lq jx jy kk lr kb kc kl ls kf kg kh ha bi translated">尽管这可能会因您使用的库而异，但还是有必要解释一下我们在示例中使用的库。<a class="ae ki" href="https://reactnavigation.org/" rel="noopener ugc nofollow" target="_blank"> React导航</a>是React原生应用中路由和导航的常用库。</p><p id="3512" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated">您可以通过运行以下命令来添加它:</p><p id="f987" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated"><code class="du km kn ko kp b">npm install — save react-navigation react-native-gesture-handler</code></p><p id="2cb6" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated"><code class="du km kn ko kp b">react-native link react-native-gesture-handler</code></p><p id="2842" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated">导航库的基本前提是在React本机应用程序的根目录下创建一个中心枢纽，可以控制在任何给定时间应该显示哪个“屏幕”。这个库有几种不同类型的导航，但是我们坚持使用<a class="ae ki" href="https://reactnavigation.org/docs/en/hello-react-navigation.html" rel="noopener ugc nofollow" target="_blank">堆栈导航器</a>。它的工作方式就像一个堆栈数据结构，让每个屏幕“继续”到堆栈，当用户返回时，它只是将它们弹出堆栈。</p><h1 id="390c" class="kw kx hh bd ky kz la lb lc ld le lf lg in lh io li iq lj ir lk it ll iu lm ln bi translated">订单提前示例应用程序</h1><p id="44bd" class="pw-post-body-paragraph jl jm hh jo b jp lo ii jr js lp il ju kj lq jx jy kk lr kb kc kl ls kf kg kh ha bi translated">为了<em class="jn">(如此微不足道)</em>展示React原生应用内支付插件可以做什么，我们创建了一个应用程序，让人们在会议上挑选自己的方形乐高人，并演示新的<a class="ae ki" rel="noopener" href="/p/orders-push-public-beta-25bda7c31521">订单推送测试版</a>如何将其推入方形销售点(POS)。</p><p id="be6b" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated">在我们应用的基础上，我们使用来自<a class="ae ki" href="https://reactnavigation.org/" rel="noopener ugc nofollow" target="_blank"> React导航</a>的<code class="du km kn ko kp b">createAppContainer</code>和<code class="du km kn ko kp b">createStackNavigator</code>来包装我们的React应用，并处理我们所有的路由和导航。这也是我们将使用<code class="du km kn ko kp b">componentDidMount()</code>生命周期方法中的<code class="du km kn ko kp b">SQIPCore</code>初始化应用内支付SDK的地方。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mi mj l"/></div><figcaption class="kr ks et er es kt ku bd b be z dx">The root of the Order Ahead application.</figcaption></figure><p id="1331" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated">我们通过只有两个屏幕来保持简单。主屏幕显示我们所有的产品(在这种情况下，乐高人)，另一个屏幕是我们的结帐。</p><p id="fdd0" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated">应用程序中的许多代码都致力于设计组件的样式，这可能是它自己的博客文章。从这里可以学到的关键部分是如何与应用内支付SDK进行交互。</p><p id="7dca" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated">接下来，我们将深入我们的Checkout screen，并查看CheckoutScreen组件的<code class="du km kn ko kp b">componentWillMount()</code>方法。这是我们设置iOS卡入口主题的地方。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mi mj l"/></div><figcaption class="kr ks et er es kt ku bd b be z dx">componentWillMount() method of our CheckoutScreen component.</figcaption></figure><p id="1d93" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated">然后，在启动信用卡表单流之后，我们必须创建一些生命周期方法来处理事件，并获取我们的nonce来处理卡的详细信息。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mi mj l"/></div></figure><p id="f82d" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated">为了分解这一点，我们开始卡流的基本方法是<code class="du km kn ko kp b">onStartCardEntry()</code>方法。然后我们有<code class="du km kn ko kp b">onCardNonceRequestSuccess</code>、<code class="du km kn ko kp b">onCardEntryCancel</code>和<code class="du km kn ko kp b">onCardEntryComplete</code>来处理流程中的不同事件。</p><p id="5e4f" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated"><code class="du km kn ko kp b">onCardNonceRequestSuccess</code> —当我们使用应用内支付SDK成功请求nonce时进行处理，以便我们可以将其发送到我们的后端进行进一步处理。</p><p id="1d87" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated"><code class="du km kn ko kp b">onCardEntryCancel</code> —应该用于处理用户在填写卡条目表单并触发卡随机数响应之前是否关闭该表单。</p><p id="d129" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated"><code class="du km kn ko kp b">onCardEntryComplete</code> —用于关闭表单，但也可用于处理应用程序的任何状态更新。</p></div><div class="ab cl mk ml go mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ha hb hc hd he"><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es kq"><img src="../Images/ec09572eb46faf64edb7a81119ff546c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*prFcvMdGncCv4nS7QP8Yyg.gif"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx">The React Native Order Ahead App in action.</figcaption></figure><p id="d26f" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated">现在，就我们的前端而言(在我们的React本机应用程序中)，这就是我们处理支付所需的全部内容。该应用程序应该只关心使用应用内支付SDK来安全地捕获那些卡的细节，获得随机数，将其传递到后端进行进一步处理，然后<em class="jn">对处理的结果做出</em> -ing <em class="jn">(再次，如此双关)</em>。</p><p id="77cd" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated">此外，需要明确的是，这只是在React本地应用中实现<a class="ae ki" href="https://github.com/square/in-app-payments-react-native-plugin" rel="noopener ugc nofollow" target="_blank">应用内支付SDK插件</a>的<em class="jn">一种</em>方式。你当然也可以添加对Google Pay和/或Apple Pay的数字钱包支持，这只是集中在演示卡流。</p><p id="8818" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated">我们其余的创建订单和将订单推送到Square POS、<a class="ae ki" href="https://docs.connect.squareup.com/payments/transactions/overview" rel="noopener ugc nofollow" target="_blank">收取交易费用</a>(接受付款)和/或<a class="ae ki" href="https://docs.connect.squareup.com/payments/transactions/cookbook/save-cards-on-file" rel="noopener ugc nofollow" target="_blank">存储客户卡详细信息</a>的功能将发生在您的后端。如果你有兴趣建立自己的应用程序，你可以点击链接了解更多关于我们的<a class="ae ki" rel="noopener" href="/p/orders-push-public-beta-25bda7c31521">订单推送测试版</a>和我们的<a class="ae ki" href="https://docs.connect.squareup.com/payments/transactions/cookbook" rel="noopener ugc nofollow" target="_blank">文件交易卡</a>，或者<a class="ae ki" href="http://squ.re/slack" rel="noopener ugc nofollow" target="_blank">加入我们的Slack社区</a>寻求帮助。</p><p id="ba43" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated">如果你计划使用我们的React原生应用内支付插件在Square上开发一些东西，并想写点什么<em class="jn">(或任何与Square相关的东西)</em>，请加入我们的<a class="ae ki" href="http://squ.re/slack" rel="noopener ugc nofollow" target="_blank"> Slack社区</a>并让我们知道<em class="jn">(你也可以加入进来打个招呼)</em>，我们总是很乐意谈论你正在开发的任何东西。</p></div><div class="ab cl mk ml go mm" role="separator"><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp mq"/><span class="mn bw bk mo mp"/></div><div class="ha hb hc hd he"><p id="216c" class="pw-post-body-paragraph jl jm hh jo b jp jq ii jr js jt il ju kj jw jx jy kk ka kb kc kl ke kf kg kh ha bi translated">如果您想了解我们的最新内容，请务必关注这个<a class="ae ki" href="https://medium.com/square-corner-blog" rel="noopener">博客</a> &amp;我们的<a class="ae ki" href="https://twitter.com/SquareDev" rel="noopener ugc nofollow" target="_blank"> Twitter </a>账户，并注册我们的<a class="ae ki" href="https://www.workwithsquare.com/developer-newsletter.html?channel=Online%20Social&amp;sqmethod=Blog" rel="noopener ugc nofollow" target="_blank">开发者简讯</a>！我们还有一个Slack社区，用于与其他实现Square APIs的开发者联系和交流。</p></div></div>    
</body>
</html>