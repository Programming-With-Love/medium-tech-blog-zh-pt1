<html>
<head>
<title>Kotlin DSL, BuildSrc, Product Flavors, Flavor Icon and more</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kotlin DSL、BuildSrc、产品风味、风味图标等</h1>
<blockquote>原文：<a href="https://blog.kotlin-academy.com/kotlin-dsl-buildsrc-product-flavors-flavor-icon-and-more-abf30c65e8fd?source=collection_archive---------1-----------------------#2021-07-06">https://blog.kotlin-academy.com/kotlin-dsl-buildsrc-product-flavors-flavor-icon-and-more-abf30c65e8fd?source=collection_archive---------1-----------------------#2021-07-06</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jl jm jn jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/da19cfbdcbda232e33f7b54a507e1420.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q0CdecxbBFRZxSBBDm7yVQ.png"/></div></div></figure><p id="b36e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">很长一段时间，我想将Gradle文件迁移到Kotlin DSL，但我总是拖延。我终于结束了它，我还实现了buildSrc。检查依赖项和版本非常重要。特别是在有多个模块的应用程序中，我们可以用buildSrc模块来防止每个模块中不同的依赖管理。<br/>科特林DSL🤝建筑Src</p><p id="1a06" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们看看，我们能做什么？</p><p id="6931" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们将在这篇文章中做什么？</p><ol class=""><li id="cab7" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks ky kz la lb bi translated">将<code class="fe lc ld le lf b">settings.gradle</code>重构为<code class="fe lc ld le lf b">settings.gradle.kts</code>，</li><li id="ebe5" class="kt ku in jx b jy lg kc lh kg li kk lj ko lk ks ky kz la lb bi translated">创建<code class="fe lc ld le lf b">buildSrc</code>包到项目根目录，</li><li id="578b" class="kt ku in jx b jy lg kc lh kg li kk lj ko lk ks ky kz la lb bi translated">将<code class="fe lc ld le lf b">.gradle </code>文件改为<code class="fe lc ld le lf b">.kts </code>文件，</li><li id="2482" class="kt ku in jx b jy lg kc lh kg li kk lj ko lk ks ky kz la lb bi translated">将版本和依赖字符串移动到Kotlin文件中，</li><li id="f65b" class="kt ku in jx b jy lg kc lh kg li kk lj ko lk ks ky kz la lb bi translated">从<code class="fe lc ld le lf b">build.gradle</code>中提取密钥并移动<code class="fe lc ld le lf b">key.properties</code>文件，</li><li id="65d2" class="kt ku in jx b jy lg kc lh kg li kk lj ko lk ks ky kz la lb bi translated">使用Kotlin DSL创建产品风格和设置配置。</li></ol><p id="86ea" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">默认的项目目录如下所示:</p><div class="ll lm ln lo gt ab cb"><figure class="lp jo lq lr ls lt lu paragraph-image"><img src="../Images/12f3c88be1b2c7f3edf0db9f426b9b93.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/format:webp/1*u7cHbhXXNlF8ffY8bo43VA.png"/></figure><figure class="lp jo lv lr ls lt lu paragraph-image"><img src="../Images/ea95b49e25d755639efc2f1c09795512.png" data-original-src="https://miro.medium.com/v2/resize:fit:716/format:webp/1*9pIoTAZmHZplQHYh2GfI-Q.png"/></figure></div></div><div class="ab cl lw lx hr ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ig ih ii ij ik"><h1 id="07cf" class="md me in bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated"><strong class="ak"> 1。将</strong> <code class="fe lc ld le lf b"><strong class="ak">settings.gradle</strong></code> <strong class="ak">重构到settings.gradle.kts </strong></h1><p id="4bd9" class="pw-post-body-paragraph jv jw in jx b jy nb ka kb kc nc ke kf kg nd ki kj kk ne km kn ko nf kq kr ks ig bi translated">重命名<code class="fe lc ld le lf b">settings.gradle </code>文件<code class="fe lc ld le lf b">settings.gradle.kts </code>并更改几行代码:</p><pre class="ll lm ln lo gt ng lf nh ni aw nj bi"><span id="b63c" class="nk me in lf b gy nl nm l nn no"><em class="np">//before<br/></em>rootProject.name = "KotlinDSL-BuildSrcExample"<br/>include ':app'</span><span id="e98c" class="nk me in lf b gy nq nm l nn no"><em class="np">// after</em><br/>rootProject.name = "KotlinDSL-BuildSrcExample"<br/>include(":app")</span></pre><h1 id="c680" class="md me in bd mf mg nr mi mj mk ns mm mn mo nt mq mr ms nu mu mv mw nv my mz na bi translated"><strong class="ak"> 2。创建buildSrc包</strong></h1><p id="ef8d" class="pw-post-body-paragraph jv jw in jx b jy nb ka kb kc nc ke kf kg nd ki kj kk ne km kn ko nf kq kr ks ig bi translated">将“buildSrc”模块创建到项目根目录。并在其中创建<code class="fe lc ld le lf b">build.gradle.kts</code>文件。</p><pre class="ll lm ln lo gt ng lf nh ni aw nj bi"><span id="3ff6" class="nk me in lf b gy nl nm l nn no">import org.gradle.kotlin.dsl.<em class="np">`kotlin-dsl`<br/><br/></em>plugins <strong class="lf io">{<br/>    </strong><em class="np">`kotlin-dsl`<br/></em><strong class="lf io">}<br/><br/></strong><em class="np">repositories </em><strong class="lf io">{<br/>    </strong>mavenCentral()<br/><strong class="lf io">}</strong></span></pre><p id="b8be" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在重建项目。</p><figure class="ll lm ln lo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi nw"><img src="../Images/364130dc6eab920d433bf34882dfb738.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2fINsrbFhUY76kVRJpCk3Q.png"/></div></div></figure><p id="17b9" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们有一个buildSrc模块。因此，我们可以在模块中创建Kotlin文件。</p><div class="ll lm ln lo gt ab cb"><figure class="lp jo nx lr ls lt lu paragraph-image"><img src="../Images/f7388a67fbe384fe6f8e13923c8a09dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*0c12p_dEN8PmlX0VLMMWxQ.png"/></figure><figure class="lp jo ny lr ls lt lu paragraph-image"><img src="../Images/38240f10583b64ab5d15d7758d0a1be8.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/format:webp/1*YNjCOiJxNiyLSdNtDMOmxQ.png"/></figure></div><p id="a04e" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">稍后我们会将<code class="fe lc ld le lf b">Configs.kt</code>、<code class="fe lc ld le lf b">Versions.kt</code>、<code class="fe lc ld le lf b">Libraries.kt</code>添加到<code class="fe lc ld le lf b">buildSrc/src//main/kotlin</code>目录中。</p><h1 id="82e6" class="md me in bd mf mg nr mi mj mk ns mm mn mo nt mq mr ms nu mu mv mw nv my mz na bi translated">3.将<code class="fe lc ld le lf b">.gradle </code>文件重构为<code class="fe lc ld le lf b">.kts </code>文件</h1><p id="e8f8" class="pw-post-body-paragraph jv jw in jx b jy nb ka kb kc nc ke kf kg nd ki kj kk ne km kn ko nf kq kr ks ig bi translated">我们必须将<code class="fe lc ld le lf b">.gradle </code>文件改为<code class="fe lc ld le lf b">.gradle.kts</code>。这是最难的部分:</p><ul class=""><li id="d12c" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks nz kz la lb bi translated"><strong class="jx io"> build.gradle(项目)</strong></li></ul><figure class="ll lm ln lo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oa"><img src="../Images/d21e2f760d2c8b875aadab7e671e8bec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SzTq8UzMl6Mrhzc9D6UwVg.png"/></div></div></figure><p id="849b" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">我们在Gradle文件中使用Kotlin。让我们把定义<code class="fe lc ld le lf b">Libraries.kt</code>和<code class="fe lc ld le lf b">Versions.kt</code>的科特林对象交给<code class="fe lc ld le lf b">buildSrc/src/main/kotlin</code></p><p id="af16" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你好科特林·✋</p><figure class="ll lm ln lo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi jk"><img src="../Images/da19cfbdcbda232e33f7b54a507e1420.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q0CdecxbBFRZxSBBDm7yVQ.png"/></div></div></figure><ul class=""><li id="cb97" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks nz kz la lb bi translated"><strong class="jx io"> build.gradle(app模块)</strong></li></ul><figure class="ll lm ln lo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi ob"><img src="../Images/a73ba33dff405c6f3f87c3644eaa1cf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JT78a4pJXquSX_33KDTZ1g.png"/></div></div></figure><h1 id="9aa8" class="md me in bd mf mg nr mi mj mk ns mm mn mo nt mq mr ms nu mu mv mw nv my mz na bi translated">4.将版本和依赖字符串移动到Kotlin文件</h1><figure class="ll lm ln lo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oc"><img src="../Images/4034ddd14117bab357b47419ed75f549.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nzJixCfOxUzZw5cyIKu0nw.png"/></div></div></figure><p id="789d" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">现在，我们将应用配置从<code class="fe lc ld le lf b">defaultConfig </code>移至<code class="fe lc ld le lf b">Configs.kt</code>。</p><figure class="ll lm ln lo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi od"><img src="../Images/00fb39ae7b410f965fd837f3ae489a69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uchm_sTHa60tFVtOnSxqBg.png"/></div></div></figure><h1 id="76a2" class="md me in bd mf mg nr mi mj mk ns mm mn mo nt mq mr ms nu mu mv mw nv my mz na bi translated">5.从Gradle文件中提取密钥(key.properties)</h1><p id="bf6d" class="pw-post-body-paragraph jv jw in jx b jy nb ka kb kc nc ke kf kg nd ki kj kk ne km kn ko nf kq kr ks ig bi translated">为了更可靠的代码，我们必须从Gradle中提取密钥，并像<code class="fe lc ld le lf b">key.properties:</code>一样移动另一个文件</p><ul class=""><li id="6788" class="kt ku in jx b jy jz kc kd kg kv kk kw ko kx ks nz kz la lb bi translated">在项目根目录下创建<code class="fe lc ld le lf b">key.properties</code>文件，</li><li id="7875" class="kt ku in jx b jy lg kc lh kg li kk lj ko lk ks nz kz la lb bi translated">在该文件中存储密钥(如签名密钥)，</li><li id="9082" class="kt ku in jx b jy lg kc lh kg li kk lj ko lk ks nz kz la lb bi translated">创建一个助手类来获取键值。</li></ul><pre class="ll lm ln lo gt ng lf nh ni aw nj bi"><span id="8616" class="nk me in lf b gy nl nm l nn no">// build.gradle.kts (module :app)<br/>signingConfigs <strong class="lf io">{<br/>    </strong>create("signingConfigRelease") <strong class="lf io">{<br/>        </strong>storeFile = file(KeyHelper.getValue(KeyHelper.KEY_STORE_FILE))<br/>        storePassword = KeyHelper.getValue(KeyHelper.KEY_STORE_PASS)<br/>        keyAlias = KeyHelper.getValue(KeyHelper.KEY_ALIAS)<br/>        keyPassword = KeyHelper.getValue(KeyHelper.KEY_PASS)<br/>    <strong class="lf io">}<br/>}</strong></span><span id="60f6" class="nk me in lf b gy nq nm l nn no"><strong class="lf io">--------------------------------------------------------------------</strong></span><span id="18ee" class="nk me in lf b gy nq nm l nn no">// KeyHelper.kt<br/>object KeyHelper {<br/><br/>    const val KEY_STORE_FILE = "storeFile"<br/>    const val KEY_STORE_PASS = "storePassword"<br/>    const val KEY_ALIAS = "keyAlias"<br/>    const val KEY_PASS = "keyPassword"<br/><br/>    private val properties by <em class="np">lazy </em><strong class="lf io">{<br/>        </strong>Properties().<em class="np">apply </em><strong class="lf io">{ </strong>load(FileInputStream(File("key.properties"))) <strong class="lf io">}<br/>    }<br/><br/>    </strong>fun getValue(key: String): String {<br/>        return properties.getProperty(key)<br/>    }<br/>}</span></pre><figure class="ll lm ln lo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi oe"><img src="../Images/759d1c8b685b2fe1b6b9df51f34151b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sjtChblwmc331OVd6KTWDA.png"/></div></div></figure><h1 id="00de" class="md me in bd mf mg nr mi mj mk ns mm mn mo nt mq mr ms nu mu mv mw nv my mz na bi translated">6.产品口味和配置</h1><p id="4de3" class="pw-post-body-paragraph jv jw in jx b jy nb ka kb kc nc ke kf kg nd ki kj kk ne km kn ko nf kq kr ks ig bi translated">让我们一起创造风味，并用Kotlin DSL设置配置。</p><p id="7683" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">创建至少一个<code class="fe lc ld le lf b">flavorDimensions</code>和你的<code class="fe lc ld le lf b">productFlavors</code>。如果您有特定于环境的值，您可以在productFlavors中定义:</p><pre class="ll lm ln lo gt ng lf nh ni aw nj bi"><span id="43ca" class="nk me in lf b gy nl nm l nn no">flavorDimensions("appType")<br/>productFlavors <strong class="lf io">{<br/>    </strong>create("_dev") <strong class="lf io">{<br/>        </strong>dimension = "appType"<br/>        applicationIdSuffix = ".dev"<br/>        versionNameSuffix = "-dev"<br/><br/>        manifestPlaceholders(<br/>            <em class="np">mapOf</em>(<br/>                "appIcon" <em class="np">to </em>"@mipmap/ic_launcher_prod",<br/>                "appIconRound" <em class="np">to </em>"@mipmap/ic_launcher_prod_round"<br/>            )<br/>        )<br/>        resValue("string", "app_name", "KotlinDslExample$versionNameSuffix")<br/>        buildConfigField("String", "ONESIGNAL_APP_ID", KeyHelper.KEY_ONESIGNAL_APP_ID_DEV)<br/>    <strong class="lf io">}</strong></span></pre><figure class="ll lm ln lo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi of"><img src="../Images/0cb1c5ed7ff00ecfc80749eaf3fc79c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RQOSx8Poa1O4rDeQj0yxbg.png"/></div></div></figure><blockquote class="og oh oi"><p id="9290" class="jv jw np jx b jy jz ka kb kc kd ke kf oj kh ki kj ok kl km kn ol kp kq kr ks ig bi translated"><em class="in">在我的例子中，除了完全改变的值之外，基本url的改变只是在扩展部分。而我是在</em> <code class="fe lc ld le lf b"><em class="in">applicationVariants.all</em></code> <em class="in">挡处理的。</em></p></blockquote><figure class="ll lm ln lo gt jo gh gi paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="gh gi om"><img src="../Images/59bdc3bb000bef30d6b31f29bb28e668.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tv6JWjBYA_MrHGyLViA0yA.png"/></div></div></figure></div><div class="ab cl lw lx hr ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ig ih ii ij ik"><p id="bd63" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">仅此而已。我知道这花了一些时间，但我想谈谈细节。如果你发现任何错误的信息，请留下评论。我会修好它的。</p><p id="a973" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果这篇文章对你有帮助，请鼓掌👏</p></div><div class="ab cl lw lx hr ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ig ih ii ij ik"><h1 id="4cb7" class="md me in bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">资源</h1><p id="da13" class="pw-post-body-paragraph jv jw in jx b jy nb ka kb kc nc ke kf kg nd ki kj kk ne km kn ko nf kq kr ks ig bi translated">项目:<a class="ae on" href="https://github.com/mustafayigitt/KotlinDSL-BuildSrcExample" rel="noopener ugc nofollow" target="_blank">https://github.com/mustafayigitt/KotlinDSL-BuildSrcExample</a></p><p id="5827" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">领英:<a class="ae on" href="https://www.linkedin.com/in/mustafayigitt/" rel="noopener ugc nofollow" target="_blank">https://www.linkedin.com/in/mustafayigitt/</a></p><p id="7789" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">网址:<a class="ae on" href="https://www.mustafayigit.net/" rel="noopener ugc nofollow" target="_blank">https://www.mustafayigit.net/</a></p></div><div class="ab cl lw lx hr ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ig ih ii ij ik"><h1 id="c68d" class="md me in bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">点击👏说“谢谢！”并帮助他人找到这篇文章。</h1><p id="05ac" class="pw-post-body-paragraph jv jw in jx b jy nb ka kb kc nc ke kf kg nd ki kj kk ne km kn ko nf kq kr ks ig bi translated">了解卡帕头最新的重大新闻。学院，<a class="ae on" href="https://kotlin-academy.us17.list-manage.com/subscribe?u=5d3a48e1893758cb5be5c2919&amp;id=d2ba84960a" rel="noopener ugc nofollow" target="_blank">订阅时事通讯</a>，<a class="ae on" href="https://twitter.com/ktdotacademy" rel="noopener ugc nofollow" target="_blank">观察Twitter </a>并在Medium上关注我们。</p><p id="8cea" class="pw-post-body-paragraph jv jw in jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">如果您需要Kotlin工作室，请查看我们如何帮助您:<a class="ae on" href="https://kt.academy/" rel="noopener ugc nofollow" target="_blank"> kt.academy </a>。</p><figure class="ll lm ln lo gt jo gh gi paragraph-image"><a href="https://kotlin-academy.us17.list-manage.com/subscribe?u=5d3a48e1893758cb5be5c2919&amp;id=d2ba84960a"><div class="gh gi oo"><img src="../Images/0f75035864c8777980691ea01b2909c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V9G3D67yqAvCKwAlxLkvDQ.png"/></div></a></figure></div></div>    
</body>
</html>