<html>
<head>
<title>Shared web credentials: A simpler way to log in</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">共享web凭据:一种更简单的登录方式</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/shared-web-credentials-a-simpler-way-to-log-in-f94bca0d683b?source=collection_archive---------1-----------------------#2015-04-17">https://medium.com/pinterest-engineering/shared-web-credentials-a-simpler-way-to-log-in-f94bca0d683b?source=collection_archive---------1-----------------------#2015-04-17</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="16f1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Garrett Moon | Pinterest工程师，iOS核心体验</p><p id="f6f6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们的首要任务是在我们构建的所有产品中，跨平台地创造出色的用户体验。作为其中的一部分，我们每天都在努力减少使用Pinterest的工作量。所以当苹果宣布支持<a class="ae jc" href="https://developer.apple.com/library/ios/documentation/Security/Reference/SharedWebCredentialsRef/" rel="noopener ugc nofollow" target="_blank">共享网络凭证</a>时，我们很高兴能让Pinners更容易登录。</p><p id="7868" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">共享web凭证允许iOS应用程序读取和写入Safari在iOS和Mac上使用的同一商店的密码。例如，如果一个Pinner在他们的Mac上注册了Pinterest，他们可以下载我们的iPhone应用程序并立即登录，而不需要记住或输入他们的凭据。神奇！</p><h2 id="70a1" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">如何</h2><p id="8c4e" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">在您可以开始使用API之前，有两个要求可以让iOS使用共享的web凭据来信任您的应用程序。</p><ul class=""><li id="bc80" class="kd ke hh ig b ih ii il im ip kf it kg ix kh jb ki kj kk kl bi translated">将您的域添加到Xcode项目功能部分的“关联域”中:</li></ul><figure class="kn ko kp kq fd kr er es paragraph-image"><div class="er es km"><img src="../Images/0fe7c38ff2f821d4a970ae327c42ac30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1080/format:webp/0*NDpS8Z_vq2z492E_.png"/></div></figure><ul class=""><li id="319b" class="kd ke hh ig b ih ii il im ip kf it kg ix kh jb ki kj kk kl bi translated">签署一个JSON文件，并将其托管在https://<yourdomain.com>/apple-app-site-association。请注意https。</yourdomain.com></li><li id="7684" class="kd ke hh ig b ih ku il kv ip kw it kx ix ky jb ki kj kk kl bi translated">该文件应包含一个字典，其中列出了您批准的应用程序标识符，并经过签名以确保它未被篡改。下面的清单显示了一个为阅读而格式化的JSON文件示例:</li><li id="125d" class="kd ke hh ig b ih ku il kv ip kw it kx ix ky jb ki kj kk kl bi translated">清单1–1服务器端web凭据:</li><li id="7291" class="kd ke hh ig b ih ku il kv ip kw it kx ix ky jb ki kj kk kl bi translated"><code class="du kz la lb lc b">{ "webcredentials": { "apps": [ "YWBN8XTPBJ.com.example.myApp"] } }</code></li><li id="e55a" class="kd ke hh ig b ih ku il kv ip kw it kx ix ky jb ki kj kk kl bi translated">我们使用我们的pinterest.com证书和密钥来签署JSON文件(更多关于证书的要求<a class="ae jc" href="https://developer.apple.com/library/ios/documentation/Security/Reference/SharedWebCredentialsRef/" rel="noopener ugc nofollow" target="_blank">在这里</a>)。要签署证书，请使用以下命令:</li><li id="8e9e" class="kd ke hh ig b ih ku il kv ip kw it kx ix ky jb ki kj kk kl bi translated">清单1–2签署凭证文件:</li><li id="bafd" class="kd ke hh ig b ih ku il kv ip kw it kx ix ky jb ki kj kk kl bi translated"><code class="du kz la lb lc b">echo '{"webcredentials":{"apps":["YWBN8XTPBJ.com.example.myApp"]}}' &gt; json.txt cat json.txt | openssl smime -sign -inkey pinterest.com.key -signer pinterest.com.pem -certfile intermediate.pem -noattr -nodetach -outform DER &gt; apple-app-site-association</code></li><li id="adf2" class="kd ke hh ig b ih ku il kv ip kw it kx ix ky jb ki kj kk kl bi translated">最后一步，将制作好的文件放在你网站的<a class="ae jc" href="https://example.com/apple-app-site-association." rel="noopener ugc nofollow" target="_blank">https://example.com/apple-app-site-association.</a>下</li><li id="1d6d" class="kd ke hh ig b ih ku il kv ip kw it kx ix ky jb ki kj kk kl bi translated">这个过程应该相对简单，但是有几个问题。</li><li id="a2b1" class="kd ke hh ig b ih ku il kv ip kw it kx ix ky jb ki kj kk kl bi translated">首先，请确定您在iCloud钥匙串中拥有与您的域相匹配的凭据。如果没有它们，API方法将失败，并出现错误(-25300，未找到匹配项)。如果用户单击“Not Now ”,将不会出现错误，但会返回零个凭据。</li><li id="5626" class="kd ke hh ig b ih ku il kv ip kw it kx ix ky jb ki kj kk kl bi translated">此外，如果你第一次没有正确设置好一切，你会想在测试之间删除应用程序。Apple会在安装应用程序时验证您的域应用程序链接，因此在修复问题后重新启动应用程序不会导致新的检查。</li><li id="9516" class="kd ke hh ig b ih ku il kv ip kw it kx ix ky jb ki kj kk kl bi translated">现在，要在应用程序中请求用户的凭证，只需进行一个简单的函数调用:</li><li id="2b27" class="kd ke hh ig b ih ku il kv ip kw it kx ix ky jb ki kj kk kl bi translated"><code class="du kz la lb lc b">SecRequestSharedWebCredential(NULL, NULL, ^(CFArrayRef credentials, CFErrorRef error) { if (error) { //handle error } else { if ([(__bridge NSArray *)credentials count] &gt; 0) { NSDictionary *dictionary = [(__bridge NSArray *)credentials objectAtIndex:0]; NSString *accountName = dictionary[(__bridge id)(kSecAttrAccount)]; NSString *password = dictionary[(__bridge id)(kSecSharedPassword)]; } else { // No accounts } } });</code></li></ul><h2 id="5dc6" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">设计</h2><p id="7af3" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">想象一下，你刚刚在网上注册了Pinterest，然后下载了我们的iOS应用。加载应用程序后，您可以立即使用您的凭据登录，这是理想的体验。</p><figure class="kn ko kp kq fd kr er es paragraph-image"><div class="er es ld"><img src="../Images/6179988f4473856123537a109b0c622e.png" data-original-src="https://miro.medium.com/v2/resize:fit:586/format:webp/0*k6BeAGYBDXcMKK0S.png"/></div></figure><p id="3d08" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然而，你不想惹恼那些对使用这个特性没有兴趣的用户。因此，如果用户点击“现在不要”，那么每次他们在登录屏幕上时，就停止显示对话框。</p><figure class="kn ko kp kq fd kr er es paragraph-image"><div class="er es le"><img src="../Images/dae256d120b2e2252471d4978068f338.png" data-original-src="https://miro.medium.com/v2/resize:fit:584/format:webp/0*yRHNpKapKTUFB-7D.png"/></div></figure><p id="d736" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要创建最无缝的体验，请在应用程序的其他部分集成共享的web凭据。</p><ul class=""><li id="4e1d" class="kd ke hh ig b ih ii il im ip kf it kg ix kh jb ki kj kk kl bi translated">当用户成功登录时，调用SecAddSharedWebCredential更新用户的凭据，以便他们以后访问您的网站时可以使用它们。</li><li id="b9ab" class="kd ke hh ig b ih ku il kv ip kw it kx ix ky jb ki kj kk kl bi translated">如果您有密码更改功能，请务必如上所述更新钥匙串中的凭证。</li><li id="9ef7" class="kd ke hh ig b ih ku il kv ip kw it kx ix ky jb ki kj kk kl bi translated">最后，确保在您的登录屏幕上有一个使用凭证登录的按钮。</li></ul><h2 id="0b36" class="jd je hh bd jf jg jh ji jj jk jl jm jn ip jo jp jq it jr js jt ix ju jv jw jx bi translated">结果</h2><p id="c0f0" class="pw-post-body-paragraph ie if hh ig b ih jy ij ik il jz in io ip ka ir is it kb iv iw ix kc iz ja jb ha bi translated">在引入对共享web凭证的支持后，我们看到Pinners的参与度有了适度的提高，这使得这一小小的努力物有所值。鼓励人们使用像iCloud Keychain这样的功能将有助于用户创建更安全的密码，而不必记住它们，这对所有参与者来说都是一个胜利。</p><p id="8a35" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="lf"> Garrett Moon是移动团队的iOS工程师。</em></p><p id="15db" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="lf">鸣谢:感谢高级安全工程师Amine Kamel提供正确签署JSON文件的方法。</em></p><p id="25b3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="lf">获取Pinterest工程新闻和更新，关注我们的工程</em><a class="ae jc" href="https://www.pinterest.com/malorie/pinterest-engineering-news/" rel="noopener ugc nofollow" target="_blank"><em class="lf">Pinterest</em></a><em class="lf">，</em> <a class="ae jc" href="https://www.facebook.com/pinterestengineering" rel="noopener ugc nofollow" target="_blank"> <em class="lf">脸书</em> </a> <em class="lf">和</em><a class="ae jc" href="https://twitter.com/PinterestEng" rel="noopener ugc nofollow" target="_blank"><em class="lf">Twitter</em></a><em class="lf">。有兴趣加入团队吗？查看我们的</em> <a class="ae jc" href="https://about.pinterest.com/en/careers/engineering-product" rel="noopener ugc nofollow" target="_blank"> <em class="lf">招聘网站</em> </a> <em class="lf">。</em></p></div></div>    
</body>
</html>