<html>
<head>
<title>SOA Suite 12c in Docker containers. Only a couple of commands, no installers, no third party scripts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Docker容器中的SOA套件12c。只有几个命令，没有安装程序，没有第三方脚本</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/soa-suite-12c-in-docker-containers-b12263e36824?source=collection_archive---------0-----------------------#2018-06-01">https://medium.com/oracledevs/soa-suite-12c-in-docker-containers-b12263e36824?source=collection_archive---------0-----------------------#2018-06-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="2999" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于开发人员来说，安装一个成熟的本地SOA套件环境从来都不是他们的最爱(除了极少数人)。这很费时间，需要你一个接一个地下载并运行不同的安装程序。如果您想从头开始，但尚未在虚拟机中完成安装并创建快照，您可以从头开始。有一种简单的新方法可以启动并运行SOA套件环境，只需几个命令就可以不用下载任何安装程序，也不需要依赖除Oracle之外的任何一方提供的脚本。最终的环境是一个Oracle企业版数据库、一个管理服务器和一个受管服务器。它们都运行在单独的Docker容器中，其端口暴露给主机。这3个容器可以在一个8Gb虚拟机中一起运行。Oracle在其容器注册表中为SOA套件映像提供的文档应该用作基础，但是由于如果您遵循它会遇到一些错误，您可以使用这篇博客文章来帮助您快速解决它们。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jc"><img src="../Images/3b7671524f9cbf0b0a6ce24bde331c50.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/0*-6688S47vNwZ8Tw6.PNG"/></div></figure></div><div class="ab cl jk jl go jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="ha hb hc hd he"><h1 id="63a3" class="jr js hh bd jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko bi translated">简短的历史</h1><h2 id="e5a9" class="kp js hh bd jt kq kr ks jx kt ku kv kb ip kw kx kf it ky kz kj ix la lb kn lc bi translated">快速入门和不同的安装程序</h2><p id="8c81" class="pw-post-body-paragraph ie if hh ig b ih ld ij ik il le in io ip lf ir is it lg iv iw ix lh iz ja jb ha bi translated">在11g时代，如果开发人员想要运行本地环境，他需要安装数据库(通常是XE)、WebLogic Server、SOA基础设施、运行存储库创建实用程序(RCU)以及一个或多个SOA、BPM、OSB。在12c中，引入了SOA套件快速入门。QuickStart使用Apache Derby数据库而不是Oracle数据库，并且缺少ESS、split Admin Server / Managed Server、NodeManager等功能，这使得该环境无法与客户环境相提并论。如果您想安装一个独立版本，您仍然需要完成所有的手动步骤或者自己自动完成它们(使用安装程序的响应文件和域创建的WLST文件)。作为一种替代方案，在这段时间里，甲骨文非常友好地提供了预装了所有东西的VirtualBox映像(<a class="ae li" href="http://www.oracle.com/technetwork/middleware/soasuite/learnmore/soa-vm-2870913.html" rel="noopener ugc nofollow" target="_blank">像这个</a>或<a class="ae li" href="http://www.oracle.com/technetwork/middleware/soasuite/learnmore/prebuiltvm-soasuite122110-3070567.html" rel="noopener ugc nofollow" target="_blank">这个</a>)。对于更复杂的设置，Edwin Biemond / Lucas Jellema提供了<a class="ae li" href="https://technology.amis.nl/2014/07/31/rapid-creation-of-virtual-machines-for-soa-suite-12-1-3-server-run-time-environment-leveraging-vagrant-puppet-and-biemond/" rel="noopener ugc nofollow" target="_blank">流浪者文件和博客帖子</a>来快速创建一个12c环境。</p><p id="9085" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在Docker容器中运行SOA套件的一个好处是软件被隔离在容器中。您可以快速删除和重新创建域。此外，一般来说，Docker与VMWare、VirtualBox或Oracle VM相比资源效率更高，并且容器可以轻松地运送到其他环境/机器。</p><p id="0194" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> Dockerfiles </strong></p><p id="769e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Docker已经变得非常流行，并且已经有了一些在Docker容器中运行SOA套件的尝试。起初，这些工作是由创建自己的docker文件并使用安装程序和响应文件来创建映像的人来完成的。后来Oracle提供了他们自己的Later文件，但是您仍然需要来自edelivery.oracle.com的安装程序并首先构建映像。甲骨文官方提供的Docker文件可以在GitHub <a class="ae li" href="https://github.com/oracle/docker-images" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="0815" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">集装箱登记处</strong></p><p id="3b9d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">甲骨文最近(2017年初)推出了其<a class="ae li" href="https://container-registry.oracle.com/" rel="noopener ugc nofollow" target="_blank">容器注册表</a>。容器注册表是一个Docker注册表，它包含预构建的映像，因此只是Docker文件。Oracle数据库出现，WebLogic和SOA基础设施以及现在(2018年5月)完整的SOA套件。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jc"><img src="../Images/41104bc3b98258ada253ebad052335f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/0*51wUVYVOGqhxIPZH.PNG"/></div></figure><p id="2ad5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你如何使用这个？您将您的OTN帐户链接到<a class="ae li" href="https://container-registry.oracle.com/" rel="noopener ugc nofollow" target="_blank">容器注册中心</a>。这只需要做一次。接下来，您可以接受您想要使用的图像的许可协议。容器注册表包含每个图像的有用描述，说明如何使用它以及可以配置什么。请记住，由于容器注册中心最近进行了重组，图像的名称已经更改，并且不是所有的手册都已经更新。这也是为什么您想要标记图像，以便您可以以一致的方式在本地访问它们。</p><h1 id="7c2f" class="jr js hh bd jt ju lj jw jx jy lk ka kb kc ll ke kf kg lm ki kj kk ln km kn ko bi translated">下载并运行！</h1><p id="4673" class="pw-post-body-paragraph ie if hh ig b ih ld ij ik il le in io ip lf ir is it lg iv iw ix lh iz ja jb ha bi translated">对于SOA套件，您需要接受企业版数据库和SOA套件的协议。你不需要SOA基础设施；它是SOA套件映像的一部分。</p><h2 id="a856" class="kp js hh bd jt kq kr ks jx kt ku kv kb ip kw kx kf it ky kz kj ix la lb kn lc bi translated">注册</h2><pre class="jd je jf jg fd lo lp lq lr aw ls bi"><span id="3fd0" class="kp js hh lp b fi lt lu l lv lw">docker login -u OTNusername -p OTNpassword container-registry.oracle.com</span></pre><h2 id="2010" class="kp js hh bd jt kq kr ks jx kt ku kv kb ip kw kx kf it ky kz kj ix la lb kn lc bi translated">提取、标记、创建环境文件</h2><p id="b778" class="pw-post-body-paragraph ie if hh ig b ih ld ij ik il le in io ip lf ir is it lg iv iw ix lh iz ja jb ha bi translated">提取图像可能需要一段时间…(在Wifi下可能需要几个小时)。用于拉取的命令与容器注册表中的图像文档中给出的示例略有不同，因为图像名称最近已经更改。为了一致的访问，标记它们。<strong class="ig hi">数据库</strong></p><pre class="jd je jf jg fd lo lp lq lr aw ls bi"><span id="4b02" class="kp js hh lp b fi lt lu l lv lw">docker pull container-registry.oracle.com/database/enterprise:12.2.0.1</span><span id="9759" class="kp js hh lp b fi lx lu l lv lw">docker tag container-registry.oracle.com/database/enterprise:12.2.0.1 oracle/database:12.2.0.1-ee</span></pre><p id="53b3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">数据库需要一个配置文件。然而，从映像创建容器时执行的安装无法正确应用该文件中的设置。我已经更新了配置文件，以反映实际创建的内容:</p><pre class="jd je jf jg fd lo lp lq lr aw ls bi"><span id="43b4" class="kp js hh lp b fi lt lu l lv lw">db.env.list<br/>ORACLE_SID=orclcdb<br/>ORACLE_PDB=orclpdb1<br/>ORACLE_PWD=Oradoc_db1</span></pre><p id="679f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> SOA套件</strong></p><pre class="jd je jf jg fd lo lp lq lr aw ls bi"><span id="feaf" class="kp js hh lp b fi lt lu l lv lw">docker pull container-registry.oracle.com/middleware/soasuite:12.2.1.3</span><span id="08d9" class="kp js hh lp b fi lx lu l lv lw">docker tag container-registry.oracle.com/middleware/soasuite:12.2.1.3 oracle/soa:12.2.1.3</span></pre><p id="18ef" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">管理服务器还需要一个配置文件:</p><pre class="jd je jf jg fd lo lp lq lr aw ls bi"><span id="b48b" class="kp js hh lp b fi lt lu l lv lw">adminserver.env.list<br/>CONNECTION_STRING=soadb:1521/ORCLPDB1.localdomain<br/>RCUPREFIX=SOA1<br/>DB_PASSWORD=Oradoc_db1<br/>DB_SCHEMA_PASSWORD=Welcome01<br/>ADMIN_PASSWORD=Welcome01<br/>MANAGED_SERVER=soa_server1<br/>DOMAIN_TYPE=soa</span></pre><p id="9e71" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如您所见，由于RCU前缀是可配置的，您可以对多个SOA架构使用同一个数据库。受控服务器还需要一个配置文件:</p><pre class="jd je jf jg fd lo lp lq lr aw ls bi"><span id="fd48" class="kp js hh lp b fi lt lu l lv lw">soaserver.env.list<br/>MANAGED_SERVER=soa_server1<br/>DOMAIN_TYPE=soa<br/>ADMIN_HOST=soaas<br/>ADMIN_PORT=7001 </span></pre><p id="909e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">确保管理服务器配置文件中提到的受管服务器与受管服务器配置文件中的受管服务器相匹配。管理服务器安装会为受控服务器创建boot.properties。如果服务器名称不匹配，受控服务器将不会引导。</p><p id="96f5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建本地文件夹和网络</p><p id="a18c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">由于您可能不希望在删除容器并再次启动它时丢失域或数据库文件，因此您可以在主机上创建一个位置，在该位置将创建域，数据库可以存储其文件。对于以下命令，确保运行容器的用户拥有userid/groupid 1000，以允许用户访问目录。以root用户身份运行以下命令。它们与手册略有不同，因为如果SOAVolume/SOA不存在，就会出现错误。</p><pre class="jd je jf jg fd lo lp lq lr aw ls bi"><span id="fbc9" class="kp js hh lp b fi lt lu l lv lw">mkdir -p /scratch/DockerVolume/SOAVolume/SOA<br/>chown 1000:1000 /scratch/DockerVolume/SOAVolume/<br/>chmod -R 700 /scratch/DockerVolume/SOAVolume/ </span></pre><p id="6c38" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为数据库和SOA服务器创建网络:</p><pre class="jd je jf jg fd lo lp lq lr aw ls bi"><span id="4476" class="kp js hh lp b fi lt lu l lv lw">docker network create -d bridge SOANet</span></pre><h1 id="8a79" class="jr js hh bd jt ju lj jw jx jy lk ka kb kc ll ke kf kg lm ki kj kk ln km kn ko bi translated">奔跑</h1><p id="ecfe" class="pw-post-body-paragraph ie if hh ig b ih ld ij ik il le in io ip lf ir is it lg iv iw ix lh iz ja jb ha bi translated"><strong class="ig hi">启动数据库</strong></p><p id="63d7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你首先需要数据库。您可以通过以下方式运行它:</p><pre class="jd je jf jg fd lo lp lq lr aw ls bi"><span id="25aa" class="kp js hh lp b fi lt lu l lv lw">#Start the database<br/>docker run — name soadb — network=SOANet -p 1521:1521 -p 5500:5500 -v /scratch/DockerVolume/SOAVolume/DB:/opt/oracle/oradata — env-file /software/db.env.list oracle/database:12.2.0.1-ee</span></pre><p id="5edf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这将安装并启动数据库。上面描述的db.env.list在这种情况下应该在/software中。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jc"><img src="../Images/bb586cb5b393f0290e7d44c2e5d0b4bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/0*I8EIRGt6uxEwO1Wl.PNG"/></div></figure><p id="8b78" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> SOA套件</strong></p><p id="8921" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在记录的示例中，表明您可以在单独的容器中运行管理服务器和受控服务器。你可以，他们会启动。但是，管理服务器无法管理受管服务器，并且WebLogic控制台/ EM不显示受管服务器的状态。Docker容器中的配置使用具有单一主机名的单个机器，并指示受管服务器和管理服务器都在那里运行。为了解决这个问题，我将建议两个简单的解决方法。</p><p id="f299" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">港口转运。独立容器中的管理服务器和受控服务器</strong></p><p id="35bb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以创建从管理服务器到受控服务器的端口转发。这允许WebLogic Console / EM和管理服务器访问端口8001上Docker容器中“localhost”处的受管服务器。</p><pre class="jd je jf jg fd lo lp lq lr aw ls bi"><span id="6a41" class="kp js hh lp b fi lt lu l lv lw">#This command starts an interactive shell which runs the Admin Server. Wait until it is up before continuing!<br/>docker run -i -t — name soaas — network=SOANet -p 7001:7001 -v /scratch/DockerVolume/SOAVolume/SOA:/u01/oracle/user_projects — env-file /software/adminserver.env.list oracle/soa:12.2.1.3</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jc"><img src="../Images/6bf0051dd87b2b31f683ffe654d0e9f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/0*q3uLRoq2VThUTDTr.PNG"/></div></figure><pre class="jd je jf jg fd lo lp lq lr aw ls bi"><span id="1605" class="kp js hh lp b fi lt lu l lv lw">#This command starts an interactive shell which runs the Managed Server.<br/>docker run -i -t — name soams — network=SOANet -p 8001:8001 — volumes-from soaas — env-file /software/soaserver.env.list oracle/soa:12.2.1.3 “/u01/oracle/dockertools/startMS.sh”</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jc"><img src="../Images/a7d523d7e3571a04c4a302197fb9005c.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/0*hmRvbSB4cotigEUV.PNG"/></div></figure><p id="1a6a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">#以下命令安装并运行socat，进行从管理服务器端口8001到受控服务器端口8001的端口映射</p><pre class="jd je jf jg fd lo lp lq lr aw ls bi"><span id="abac" class="kp js hh lp b fi lt lu l lv lw">docker exec -u root soaas yum -y install socat<br/>docker exec -d -u root soaas “/usr/bin/socat” TCP4-LISTEN:8001,fork TCP4:soams:8001" </span></pre><p id="b0df" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">容器非常有限。它不包含ping、netstat、wget、ifconfig、iptables和其他几种常用工具的可执行文件。socat似乎是进行端口转发的一个简单的解决方案(比iptables或SSH隧道更简单),并且工作得很好。</p><p id="c37c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">单一容器中的管理服务器和受控服务器</strong></p><p id="a9c0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">另一种方法是在同一个容器中运行受控服务器和管理服务器。在这里，您用两个配置文件启动管理服务器，这样所有的环境变量都可用。一旦启动了管理服务器，就可以使用docker exec在单独的shell中启动受管服务器。</p><pre class="jd je jf jg fd lo lp lq lr aw ls bi"><span id="169b" class="kp js hh lp b fi lt lu l lv lw">#Start Admin Server<br/>docker run -i -t — name soaas — network=SOANet -p 7001:7001 -p 8001:8001 -v /scratch/DockerVolume/SOAVolume/SOA:/u01/oracle/user_projects — env-file /software/adminserver.env.list — env-file /software/soaserver.env.list oracle/soa:12.2.1.3<br/> <br/>#Start Managed Server<br/>docker exec -it soaas “/u01/oracle/dockertools/startMS.sh”</span></pre><p id="fef3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">启动节点管理器</strong></p><p id="c22c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您愿意(但不是必须)，可以在两种设置中启动NodeManager，如；</p><pre class="jd je jf jg fd lo lp lq lr aw ls bi"><span id="ad31" class="kp js hh lp b fi lt lu l lv lw">docker exec -d soaas "/u01/oracle/user_projects/domains/InfraDomain/bin/startNodeManager.sh"</span></pre><p id="441c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">节点管理器运行在端口5658上。</p><h1 id="bc80" class="jr js hh bd jt ju lj jw jx jy lk ka kb kc ll ke kf kg lm ki kj kk ln km kn ko bi translated">看起来怎么样？</h1><p id="6fa4" class="pw-post-body-paragraph ie if hh ig b ih ld ij ik il le in io ip lf ir is it lg iv iw ix lh iz ja jb ha bi translated">一个正常运行的SOA环境。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jc"><img src="../Images/b1708bd85fede80d04d5b46f055d0f5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*n4bUHY7J5PYeJFCg.png"/></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jc"><img src="../Images/034a91b4f0abcf01fd6a6702c8b7ca6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*lrUjbz7cvJ6mB_0K.png"/></div></figure></div><div class="ab cl jk jl go jm" role="separator"><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp jq"/><span class="jn bw bk jo jp"/></div><div class="ha hb hc hd he"><p id="6c84" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="ly">原载于2018年6月1日</em><a class="ae li" href="http://javaoraclesoa.blogspot.com/2018/05/soa-suite-12c-in-docker-containers-only.html" rel="noopener ugc nofollow" target="_blank"><em class="ly">【javaoraclesoa.blogspot.com】</em></a><em class="ly">。</em></p></div></div>    
</body>
</html>