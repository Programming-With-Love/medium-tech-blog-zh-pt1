<html>
<head>
<title>Kubernetes Networking– A Comprehensive Guide To The Networking Concepts In Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetes网络——Kubernetes网络概念的综合指南</h1>
<blockquote>原文：<a href="https://medium.com/edureka/kubernetes-networking-a46d9f994bab?source=collection_archive---------0-----------------------#2018-09-24">https://medium.com/edureka/kubernetes-networking-a46d9f994bab?source=collection_archive---------0-----------------------#2018-09-24</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/5295240adc9de99c2469cfc93f3f60bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*d_0qwYJQ_OEqrX33akWYwg.png"/></div><figcaption class="il im et er es in io bd b be z dx">Kubernetes Networking — Edureka</figcaption></figure><p id="1080" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在之前关于<strong class="ir hi">什么是Kubernetes </strong>的博客中，你一定对Kubernetes有所了解。在这个关于Kubernetes网络的博客中，我将主要关注Kubernetes中涉及的网络概念。</p><p id="a0be" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这个关于Kubernetes网络的博客中，您将了解以下主题:</p><ul class=""><li id="85be" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm js jt ju jv bi translated">什么是Kubernetes？</li><li id="f591" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">Kubernetes的网络</li><li id="c757" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">财富向导用例</li><li id="217e" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">亲自动手</li></ul><h1 id="d070" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">什么是Kubernetes？</h1><p id="03a8" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">您可以将Kubernetes定义为一个开源容器编排工具，它为自动化容器化应用程序的部署提供了一个可移植的平台。</p><p id="7a67" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，任何与Kubernetes一起工作的人都必须对Kubernetes集群有一个清楚的了解，因为这将有助于你理解Kubernetes网络。</p><h1 id="9872" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">库伯内特星团</h1><p id="a338" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">Kubernetes平台提供了所需的状态管理，这使得集群服务能够运行，并在基础设施中进行fed配置。我举个例子解释一下。</p><p id="d380" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">考虑一个YAML文件，其中包含需要提供给集群服务的所有配置信息。因此，这个文件被提供给集群服务的API，然后由集群服务来决定如何在环境中调度pods。因此，假设pod 1有两个包含三个副本的容器映像，pod 2有一个包含两个副本的容器映像，将由群集服务将这些pod-副本对分配给工作线程。</p><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es le"><img src="../Images/7c5eea1a725aca1fad650848e764f1a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vv8SmmvwXVz3AbFk_Lhm5w.png"/></div></div><figcaption class="il im et er es in io bd b be z dx">Kubernetes Cluster Services - Kubernetes Networking</figcaption></figure><p id="646a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">参考上图。现在，如您所见，集群服务为第一个工作线程分配了两个pod副本对，为第二个工作线程分配了一个pod副本对，为第三个工作线程分配了两个pod副本对。现在，Kubelet进程负责将集群服务与工作人员进行通信。</p><p id="b48c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">因此，集群服务的整个设置和工作人员本身组成了这个<strong class="ir hi"> Kubernetes集群</strong>！！</p><p id="84ba" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">你认为这些单独分配的吊舱是如何相互通信的？</p><p id="100c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">答案就在Kubernetes网络！</p><p id="4c67" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">网络概念主要有4个问题需要解决。</p><ul class=""><li id="e5e9" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm js jt ju jv bi translated">集装箱对集装箱通信</li><li id="bc97" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">吊舱对吊舱通信</li><li id="ba2f" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">Pod到服务通信</li><li id="09d8" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">服务通信外部</li></ul><p id="8d03" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，让我告诉你如何解决上述问题与Kubernetes网络。</p><h1 id="9aaf" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">Kubernetes网络</h1><p id="24b9" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">集群中的pod、服务和外部服务之间的通信引入了Kubernetes网络的概念。</p><p id="5971" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">所以，为了让你更好的理解，让我把这些概念分成以下几个部分。</p><ul class=""><li id="8915" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm js jt ju jv bi translated">pod和集装箱通信</li><li id="8d41" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">服务</li><li id="fcb2" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">通过入口网络连接外部服务</li></ul><h1 id="3dbe" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">pod和集装箱通信</h1><p id="a420" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">在我告诉你吊舱是如何通信的之前，我先给你介绍一下什么是吊舱？</p><h2 id="9ee6" class="ln kc hh bd kd lo lp lq kh lr ls lt kl ja lu lv kp je lw lx kt ji ly lz kx ma bi translated">分离舱</h2><p id="2ce4" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">Pods是Kubernetes应用程序的基本单元，它由一个或多个容器组成，这些容器分配在同一台主机上，用于共享网络堆栈和其他资源。因此，这意味着pod中的所有容器都可以到达本地主机上的其他容器。</p><p id="79ab" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，让我简单介绍一下这些豆荚是如何交流的？</p><p id="eb2e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">有两种类型的沟通。<strong class="ir hi">节点间通信</strong>和<strong class="ir hi">节点内通信。</strong></p><p id="b425" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">因此，让我们从节点内通信开始，但在此之前，让我向您介绍一下pod网络的组件。</p><p id="d755" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">节点内Pod网络</strong></p><p id="3648" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">节点内pod网络基本上是同一pod上两个不同节点之间的通信。我举个例子给你解释一下。</p><p id="44b5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">假设数据包从pod1传输到pod2。</p><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mb"><img src="../Images/b5f4e46f4b997b27f273756b9eb2df7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:584/format:webp/1*MqaxUtnjntBhEifUtyYAig.png"/></div></div><figcaption class="il im et er es in io bd b be z dx">Intra-node Pod Network - Kubernetes Networking</figcaption></figure><ul class=""><li id="4c15" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm js jt ju jv bi translated">数据包在eth0离开Pod 1的网络，并在veth0进入根网络</li><li id="aaa9" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">然后，数据包传递到Linux网桥(cbr0 ),它使用ARP请求发现目的地</li><li id="8d64" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">因此，如果veth1有IP，网桥现在知道将数据包转发到哪里。</li></ul><p id="d974" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，类似地，让我告诉你关于节点间pod通信。</p><p id="c89e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">节点间pod网络</strong></p><p id="8c5d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">考虑两个具有不同网络名称空间、网络接口和Linux桥的节点。</p><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mc"><img src="../Images/f8133ae68b9e02e9931340097b4f369d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hPkbW87wt0Tm8WohnKHtFg.png"/></div></div><figcaption class="il im et er es in io bd b be z dx">Inter-node Pod Network - Kubernetes Networking</figcaption></figure><p id="6054" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，假设数据包从pod1传输到位于不同节点的pod4。</p><ul class=""><li id="87d3" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm js jt ju jv bi translated">数据包离开pod 1网络，并在veth0进入根网络</li><li id="e748" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">然后数据包被传递到Linux网桥(cbr0 ),它的职责是发出一个ARP请求来找到目的地。</li><li id="c595" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">当网桥意识到这个数据包没有目的地址时，它会返回到主网络接口eth0。</li><li id="95eb" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">数据包现在离开节点1，在另一个节点上找到它的目的地，并进入路由表，路由表将数据包路由到其CIDR块包含pod4的节点。</li><li id="7d17" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">现在，数据包到达节点2，然后网桥接收数据包，发出ARP请求，以确定属于veth0的IP。</li><li id="5d5b" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">最后，数据包穿过管道对，到达pod4。</li></ul><p id="0079" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这就是豆荚之间的交流方式。现在，让我们继续，看看服务是如何帮助pod通信的。</p><p id="b034" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">那么，你认为服务是什么？</p><h2 id="d794" class="ln kc hh bd kd lo lp lq kh lr ls lt kl ja lu lv kp je lw lx kt ji ly lz kx ma bi translated">服务</h2><p id="9841" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">基本上，服务是一种资源，它配置一个代理将请求转发给一组pod，这些pod将接收流量&amp;这由选择器决定。一旦服务被创建，它就有一个分配的IP地址，该地址将接受端口上的请求。</p><p id="badb" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，有各种服务类型可以让您选择在集群IP地址之外公开服务。</p><p id="aa02" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">服务类型</strong></p><p id="61e3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">主要有4种类型的服务。</p><p id="7d2d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> ClusterIP: </strong>这是默认的服务类型，它通过使服务仅在集群内可达来公开集群内部IP上的服务。</p><p id="e051" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> NodePort: </strong>这在一个静态端口上公开了每个节点的IP上的服务。因为节点端口服务将路由到的<strong class="ir hi">集群IP </strong>服务是自动创建的。我们可以联系集群外部的节点端口服务。</p><p id="c589" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">负载平衡器:</strong>这是一种使用云提供商的负载平衡器对外公开服务的服务类型。因此，会自动创建外部负载平衡器将路由到的NodePort和ClusterIP服务。</p><p id="a39d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> ExternalName </strong>:该服务类型通过返回一个<strong class="ir hi"> CNAME </strong>记录及其值，将服务映射到<strong class="ir hi"> externalName </strong>字段的内容。</p><p id="dfb7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">伙计们，这就是服务。现在，您可能想知道外部服务如何连接到这些网络，对吗？</p><p id="8def" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">嗯，那不是别人，正是<strong class="ir hi">入口网络</strong>。</p><h1 id="406c" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">入口网络</h1><p id="069b" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">嗯，入口网络是公开服务的最强大的方式，因为它是允许入站连接的规则的集合，可以配置为通过可到达的URL向外部提供服务。因此，它基本上充当Kubernetes集群的入口点，管理对集群中服务的外部访问。</p><p id="f2af" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，让我用一个例子向你解释入口网络的工作原理。</p><p id="387b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们有两个节点，具有pod和根网络名称空间，带有一个Linux桥。除此之外，我们还在根网络中添加了一个名为flannel0(网络插件)的新虚拟以太网设备。</p><p id="e0aa" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，我们希望数据包从pod1流向pod 4。</p><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mc"><img src="../Images/98d150a61c9b86dc747cb5a12f5176a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tKRh13ytV0ymBY9RkT2pLA.png"/></div></div><figcaption class="il im et er es in io bd b be z dx">Ingress Network - Kubernetes Networking</figcaption></figure><ul class=""><li id="7613" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm js jt ju jv bi translated">因此，数据包在eth0离开pod1的网络，并在veth0进入根网络。</li><li id="f19a" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">然后，它被传递到cbr0，CB r0发出ARP请求以找到目的地，此后它发现该节点上没有人拥有目的地IP地址。</li><li id="d918" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">因此，网桥将数据包发送到flannel0，因为该节点的路由表配置了flannel0。</li><li id="4999" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">现在，法兰绒守护进程与Kubernetes的API服务器对话，以了解所有pod IPss及其各自的节点，从而创建pod IP到节点IP的映射。</li><li id="010e" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">网络插件将此数据包封装在UDP数据包中，并使用额外的报头将源和目的IP更改为各自的节点，然后通过eth0将此数据包发送出去。</li><li id="73fe" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">现在，因为路由表已经知道如何在节点之间路由流量，所以它将数据包发送到目的节点2。</li><li id="9cbb" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">数据包到达节点2的eth0，然后返回到flannel0进行解封装，并在根网络命名空间中将其发送回去。</li><li id="389d" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">同样，数据包被转发到Linux网桥，以发出ARP请求来找出属于veth1的IP。</li><li id="d0db" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">数据包最终穿过根网络，到达目的地Pod4。</li></ul><p id="2ca2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这就是外部服务如何在入口网络的帮助下连接的。现在，当我谈到网络插件时，让我给你介绍一下流行的网络插件列表。</p><p id="8a5c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，我已经告诉你这么多关于Kubernetes网络，让我给你看一个现实生活中的案例研究。</p><h1 id="3cc6" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">案例研究:使用Kubernetes网络的财富向导</h1><p id="0b6b" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">Wealth Wizards是一个在线财务规划平台，结合了财务规划和智能软件技术，以可承受的成本提供专家建议。</p><h1 id="2cab" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">挑战</h1><p id="c88f" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">现在，对于该公司来说，快速发现并消除代码漏洞，同时全面了解其云环境非常重要，但他们希望通过访问限制来控制流量。</p><p id="0f93" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">因此，他们使用Kubernetes基础架构来管理集群的供应和部署，并借助工具来管理跨Kube集群的微服务部署和配置。</p><p id="9367" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">他们还使用了Kubernetes的网络策略功能，允许他们通过访问限制来控制流量。</p><p id="c580" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在的问题是，这些策略是面向应用程序的，只能随着应用程序的发展而发展，但是，没有强制执行这些策略的组件。</p><p id="333b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">因此，该公司能找到的唯一解决方案是使用网络插件，因此他们开始使用Weave Net。</p><h1 id="ef4f" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">解决办法</h1><p id="d6d9" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">这个网络插件创建了一个虚拟网络，它有一个网络策略控制器来管理和执行Kubernetes中的规则。不仅如此，它还跨多个主机连接Docker容器，并支持它们的自动发现。</p><p id="2f76" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">因此，假设您在集群中有一个工作负载，并且您想要停止集群中任何其他工作负载与它的对话。您可以通过创建一个网络策略来实现这一点，该策略限制访问，只允许通过特定端口上的入口控制器进入。</p><p id="0ac8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，随着他在每个Kubernetes节点上的部署，该插件管理pod间的路由，并可以操纵IPtables规则。简单地说，每个策略都被转换成一组IPtables规则，在每台机器上进行协调和配置，以翻译Kubernetes标记。</p><p id="5c6b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">好了，现在你已经了解了这么多关于Kubernetes网络的理论，让我来告诉你实际上是怎么做的。</p><h1 id="9b75" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">亲自动手</h1><p id="d1c1" class="pw-post-body-paragraph ip iq hh ir b is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ld jk jl jm ha bi translated">所以，假设你们所有人都在系统上安装了Kubernetes，我有一个场景要展示。</p><p id="e23b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">假设您想要存储产品名称和产品ID，为此您将需要一个web应用程序。基本上，你需要一个web应用程序容器，你还需要一个后端的MySQL容器，这个MySQL容器应该链接到web应用程序容器。</p><p id="b384" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我实际执行上面的例子怎么样。</p><p id="86e2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们开始吧！</p><p id="ee1c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">第一步:</strong>在你想要的目录下创建一个文件夹，并更改该文件夹的工作目录路径。</p><pre class="lf lg lh li fd me mf mg mh aw mi bi"><span id="1072" class="ln kc hh mf b fi mj mk l ml mm">mkdir HandsOn <br/>cd HandsOn/</span></pre><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mn"><img src="../Images/bab58883ab395d4388ef148c9d300948.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m_ZV31AUGPD0nKTEe-eoVQ.png"/></div></div></figure><p id="49b6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤2: </strong>现在为web应用程序和MySQL数据库创建部署YAML文件。</p><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mo"><img src="../Images/182263821a8c6b4ab9abfa8a8eda1645.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FxOC49ZOj2bc8BwYTffMNQ.png"/></div></div></figure><p id="bb20" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤3: </strong>一旦创建了部署文件，就部署这两个应用程序。</p><pre class="lf lg lh li fd me mf mg mh aw mi bi"><span id="7e92" class="ln kc hh mf b fi mj mk l ml mm">kubectl apply -f webapp.yml <br/>kubectl apply -f mysql.yml</span></pre><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mn"><img src="../Images/327aff60bb5d16792732f904be575295.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IR_N4o4sQApwdd82bXggRQ.png"/></div></div></figure><p id="ea04" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤3.1: </strong>检查两个部署。</p><pre class="lf lg lh li fd me mf mg mh aw mi bi"><span id="3a7a" class="ln kc hh mf b fi mj mk l ml mm">kubectl get deployment</span></pre><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mn"><img src="../Images/635797ca5aa5a0a0ec0aba8ed3e0ca75.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*78KR_uxo_iaQNXGg3QXOfQ.png"/></div></div></figure><p id="4ac0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">步骤4: 现在，您必须为这两个应用程序创建服务。</p><pre class="lf lg lh li fd me mf mg mh aw mi bi"><span id="6b82" class="ln kc hh mf b fi mj mk l ml mm">kubectl apply -f webservice.yml <br/>kubectl apply -f sqlservice.yml</span></pre><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mn"><img src="../Images/d1ac1837ea347b9ab4b4af36045ac38a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4QPKKK0Ct_lHoXnbjBlk6Q.png"/></div></div></figure><p id="7079" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤4.1: </strong>创建服务后，部署服务。</p><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mp"><img src="../Images/fcd75de909bcf1b86aef0e499ddc2fdc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2omg-EZlolwA-NaXRKqKug.png"/></div></div></figure><p id="eb23" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤4.2: </strong>检查服务是否已经创建。</p><pre class="lf lg lh li fd me mf mg mh aw mi bi"><span id="2a0c" class="ln kc hh mf b fi mj mk l ml mm">kubectl get service</span></pre><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mn"><img src="../Images/db471b7654524d27c27610c8e564ec26.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZuKDS1CfeG_v0VCJCktK6Q.png"/></div></div></figure><p id="125e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">第5步:</strong>现在，检查运行pod的配置。</p><pre class="lf lg lh li fd me mf mg mh aw mi bi"><span id="81be" class="ln kc hh mf b fi mj mk l ml mm">kubectl get pods</span></pre><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mn"><img src="../Images/ad13ee12f8031403541aa8cab7494191.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JEBp9A-nD0xvl2KA-k8UPg.png"/></div></div></figure><p id="3369" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤6: </strong>进入webapp pod内的容器。</p><pre class="lf lg lh li fd me mf mg mh aw mi bi"><span id="0295" class="ln kc hh mf b fi mj mk l ml mm">kubectl exec -it container_id bash <br/>nano var/www/html/index.php</span></pre><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mq"><img src="../Images/43622f19d4b0614d8348a9b09aa692ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5QSVa2jh8ZTQ058xHgzvdw.png"/></div></div></figure><p id="4fae" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤6.1 </strong>:现在，将<strong class="ir hi"> $servername </strong>从localhost改为SQL服务名，本例中为“<strong class="ir hi"> webapp-sql1 </strong>”，将<strong class="ir hi"> $password </strong>从“”改为“<strong class="ir hi"> edureka </strong>”。此外，填写所需的所有数据库详细信息，并使用键盘快捷键<strong class="ir hi"> Ctrl+x </strong>保存您的index.php文件，然后按<strong class="ir hi"> y </strong>保存并按<strong class="ir hi">输入</strong>。</p><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mn"><img src="../Images/0ee7797b794950c8373331009d4f4758.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2KFI0cciFS1gTJo_HmxMoA.png"/></div></div></figure><p id="df90" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">第7步:</strong>现在，进入pod中的MySQL容器。</p><pre class="lf lg lh li fd me mf mg mh aw mi bi"><span id="e896" class="ln kc hh mf b fi mj mk l ml mm">kubectl exec it container_id bash</span></pre><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mn"><img src="../Images/28346dee3d18ec02c0a9daddbcedaeff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YHnPUwHRnMEwxSm67QwSyw.png"/></div></div></figure><p id="ed68" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤7.1: </strong>获得使用MySQL容器的权限。</p><pre class="lf lg lh li fd me mf mg mh aw mi bi"><span id="ca53" class="ln kc hh mf b fi mj mk l ml mm">mysql -u root -p edureka</span></pre><p id="dc86" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">其中-u代表用户，而-p是您的机器的密码。</p><p id="5208" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤7.2: </strong>在MySQL中创建一个数据库，用于从webapp获取数据。</p><pre class="lf lg lh li fd me mf mg mh aw mi bi"><span id="6216" class="ln kc hh mf b fi mj mk l ml mm">CREATE DATABASE ProductDetails;</span></pre><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mn"><img src="../Images/844e74ef035ba48f6ade1cff510afd56.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0flBaVdwlLzGYHK7wmzK_A.png"/></div></div></figure><p id="386a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤7.3: </strong>使用创建的数据库。</p><pre class="lf lg lh li fd me mf mg mh aw mi bi"><span id="4fc4" class="ln kc hh mf b fi mj mk l ml mm">USE ProductDetails;</span></pre><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mn"><img src="../Images/68226bf9410829d2a68dd6427f7949a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3iF8wO6KiS8aUvUIaoYlYw.png"/></div></div></figure><p id="766e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤7.4: </strong>在MySQL数据库中创建一个表，用于从webapp获取数据。</p><pre class="lf lg lh li fd me mf mg mh aw mi bi"><span id="2063" class="ln kc hh mf b fi mj mk l ml mm">CREATE TABLE products(product_name VARCHAR(10), product_id VARCHAR(11));</span></pre><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mn"><img src="../Images/1fee1aa46f3c99ab0cc622cde5bf6774.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XLOtA-VCtvllK9Bl4Sd2uA.png"/></div></div></figure><p id="2521" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤7.5: </strong>现在，使用命令<strong class="ir hi"> exit </strong>退出MySQL容器。</p><p id="9fbc" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤8: </strong>检查您的web应用程序工作的端口号。</p><pre class="lf lg lh li fd me mf mg mh aw mi bi"><span id="063b" class="ln kc hh mf b fi mj mk l ml mm">kubectl get services</span></pre><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mn"><img src="../Images/1f71efab6e5fe6bf785a26409c34896a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hXeBDy-KEAIoMLhA6AjoVQ.png"/></div></div></figure><p id="e10f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤8.1: </strong>现在，在分配的端口号上打开web应用程序。</p><figure class="lf lg lh li fd ii er es paragraph-image"><div class="er es mr"><img src="../Images/e83d6496d79ac6391734d778a2379b7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*L3UoeKfOPgkFlFPUseWkpA.png"/></div></figure><p id="2959" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤9: </strong>一旦你点击<strong class="ir hi">提交查询</strong>，转到你的MySQL服务正在运行的节点，然后进入容器内部。</p><figure class="lf lg lh li fd ii er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es mr"><img src="../Images/c14338a24a16827d0336490eb5373cb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1282/format:webp/1*gon8sE7PDddyXItflGkonw.png"/></div></div></figure><p id="dc88" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这将向您显示所有列表产品的输出，您已经填写了这些产品的详细信息。</p><p id="4d5c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这就结束了这个关于Kubernetes网络的博客。如果你想查看更多关于人工智能、Python、道德黑客等市场最热门技术的文章，那么你可以参考<a class="ae md" href="https://www.edureka.co/blog/?utm_source=medium&amp;utm_medium=content-link&amp;utm_campaign=kubernetes-networking" rel="noopener ugc nofollow" target="_blank"> Edureka的官方网站。</a></p><p id="27e8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">请留意本系列中的其他文章，它们将解释Kubernetes的各个方面。</p><blockquote class="ms mt mu"><p id="94bc" class="ip iq mv ir b is it iu iv iw ix iy iz mw jb jc jd mx jf jg jh my jj jk jl jm ha bi translated">1.<a class="ae md" rel="noopener" href="/edureka/what-is-kubernetes-container-orchestration-tool-d972741550f6">什么是Kubernetes？</a></p><p id="d1d0" class="ip iq mv ir b is it iu iv iw ix iy iz mw jb jc jd mx jf jg jh my jj jk jl jm ha bi translated">2.<a class="ae md" rel="noopener" href="/edureka/install-kubernetes-on-ubuntu-5cd1f770c9e4">在Ubuntu上安装Kubernetes</a></p><p id="1a5f" class="ip iq mv ir b is it iu iv iw ix iy iz mw jb jc jd mx jf jg jh my jj jk jl jm ha bi translated">3.<a class="ae md" rel="noopener" href="/edureka/kubernetes-tutorial-fe6de6a20325"> Kubernetes教程</a></p><p id="36c2" class="ip iq mv ir b is it iu iv iw ix iy iz mw jb jc jd mx jf jg jh my jj jk jl jm ha bi translated">4.<a class="ae md" rel="noopener" href="/edureka/kubernetes-dashboard-d909b8b6579c"> Kubernetes仪表板安装&amp;视图</a></p><p id="a57a" class="ip iq mv ir b is it iu iv iw ix iy iz mw jb jc jd mx jf jg jh my jj jk jl jm ha bi translated">5.<a class="ae md" rel="noopener" href="/edureka/kubernetes-architecture-c43531593ca5"> Kubernetes建筑</a></p><p id="37c1" class="ip iq mv ir b is it iu iv iw ix iy iz mw jb jc jd mx jf jg jh my jj jk jl jm ha bi translated">6.<a class="ae md" rel="noopener" href="/edureka/kubernetes-vs-docker-45231abeeaf1">Kubernetes vs Docker Swarm</a></p><p id="1681" class="ip iq mv ir b is it iu iv iw ix iy iz mw jb jc jd mx jf jg jh my jj jk jl jm ha bi translated">7.<a class="ae md" rel="noopener" href="/edureka/kubernetes-interview-questions-c9790e5abddb"> Kubernetes面试问题</a></p><p id="bfa5" class="ip iq mv ir b is it iu iv iw ix iy iz mw jb jc jd mx jf jg jh my jj jk jl jm ha bi translated">8.<a class="ae md" rel="noopener" href="/edureka/amazon-eks-ac646c23abf8">与亚马逊EKS合作开发Kubernetes应用</a></p><p id="5c2f" class="ip iq mv ir b is it iu iv iw ix iy iz mw jb jc jd mx jf jg jh my jj jk jl jm ha bi translated">9.<a class="ae md" rel="noopener" href="/edureka/kubernetes-ingress-controller-nginx-c5cf9e8ff031">在AWS上设置Kubernetes入口控制器</a></p><p id="a868" class="ip iq mv ir b is it iu iv iw ix iy iz mw jb jc jd mx jf jg jh my jj jk jl jm ha bi translated">10.<a class="ae md" rel="noopener" href="/edureka/logging-monitoring-elasticsearch-fluentd-kibana-e2cd477a576b">如何用Elasticsearch和Kibana可视化Kubernetes集群</a></p></blockquote></div><div class="ab cl mz na go nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="ha hb hc hd he"><p id="2c70" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="mv">原载于2018年9月24日www.edureka.co</em><em class="mv">的</em> <a class="ae md" href="https://www.edureka.co/blog/kubernetes-networking/" rel="noopener ugc nofollow" target="_blank"> <em class="mv">。</em></a></p></div></div>    
</body>
</html>