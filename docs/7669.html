<html>
<head>
<title>Building React Components for Multiple Brands and Applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为多个品牌和应用构建React组件</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/building-react-components-for-multiple-brands-and-applications-7e9157a39db4?source=collection_archive---------2-----------------------#2017-02-14">https://medium.com/walmartglobaltech/building-react-components-for-multiple-brands-and-applications-7e9157a39db4?source=collection_archive---------2-----------------------#2017-02-14</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/6fbd9e4df2343ff4a57c935b9f23c75d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7bG_2QAIOzbKNeesEkkTzg.png"/></div></figure><p id="a091" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">有几个不同的品牌组成了沃尔玛家族，包括<a class="ae jj" href="https://www.samsclub.com/" rel="noopener ugc nofollow" target="_blank">山姆会员店</a>、<a class="ae jj" href="http://www.asda.com/" rel="noopener ugc nofollow" target="_blank">阿斯达</a>，以及像<a class="ae jj" href="http://www.walmart.ca/en" rel="noopener ugc nofollow" target="_blank">沃尔玛加拿大</a>这样的地区分店。电子商务应用程序使用大量功能相似的功能，例如；信用卡组件、登录表单、入职、传送带、导航等等。孤立地为这些品牌中的每一个开发电子商务应用程序会减少代码重用的机会，导致这些功能相似的组件的大量重复工作。在@WalmartLabs，<a class="ae jj" rel="noopener" href="/walmartlabs/how-to-achieve-reusability-with-react-components-81edeb7fb0e0#.arwumefxh">代码可重用性对我们来说很重要</a>。这就是为什么我们的应用架构以多租户/多品牌为中心——为一个品牌构建一个组件，然后将它用于具有不同视觉或内容的其他品牌。下面，您将看到我们react组件的多品牌战略。</p><p id="9d82" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">就上下文而言，我们的大多数服务都是围绕不同类型的多租户构建的。当您调用服务时，通常会在头部或有效负载中传递租户，服务为该特定租户提供数据。该服务可能提取不同的项目数据，例如samsclub.com对walmart.com。</p><p id="062b" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">然后，我们试图将这一想法扩展到前端应用。因为我们使用React with Redux，所以可视化组件已经与应用程序状态、动作和reducers分离。这意味着我们可以将React组件抽象到一个GitHub组织中，并将Redux动作、reducers和连接的组件抽象到另一个组织中。通过在私有的npm注册表中发布所有这些内容，我们使得开发人员不仅可以轻松安装、试用和升级共享的UI元素，还可以安装、试用和升级实现我们的业务逻辑和API调用的动作和缩减器。<a class="ae jj" rel="noopener" href="/walmartlabs/how-to-achieve-reusability-with-react-components-81edeb7fb0e0#.arwumefxh">你可以在这里阅读更多关于我们如何再利用的信息。</a></p><p id="eef6" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">当然，如果这是故事的结尾，我们所有的应用程序看起来和行为都是一样的。事实上，每个品牌在视觉指南、业务需求或内容方面都有不同的要求，这些要求必须考虑在内。</p><h1 id="94ab" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">视觉差异</h1><p id="aa61" class="pw-post-body-paragraph il im hh in b io ki iq ir is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji ha bi translated">纯粹的视觉差异可以通过造型来处理。我们的大部分设计都是在组件层面。我们有一个“样式”文件夹，该文件夹中有租户文件夹，这些租户文件夹中有租户特定的样式。</p><p id="e0a7" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">看起来有点像这样:</p><pre class="kn ko kp kq fd kr ks kt ku aw kv bi"><span id="fb4c" class="kw jl hh ks b fi kx ky l kz la">Component<br/>- src<br/>- styles<br/>  - walmart<br/>  - samsclub<br/>  - grocery</span></pre><p id="8322" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在组件层管理样式时出现的一个问题是组件之间的css冲突。我在命名上特别没有创意，而且肯定会有冲突。我们正朝着使用<a class="ae jj" href="https://github.com/css-modules/css-modules" rel="noopener ugc nofollow" target="_blank"> CSS模块</a>(他们有一个非常出色的标志)的方向发展，这有助于消除意外冲突的问题(在我们的原型中已经得到支持)。</p><p id="2013" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">关于图标这个话题，我们把常见的图标抽象成一个单独的GitHub组织，根据需要导入到组件中。</p><p id="f95f" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这些特定于租户的CSS文件和图标在构建时使用Webpack捆绑在一起。</p><h1 id="1740" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">内容差异</h1><p id="89b7" class="pw-post-body-paragraph il im hh in b io ki iq ir is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji ha bi translated">不同的品牌基于其服务的地区也有不同的内容要求。一个超级简单的例子是，walmart.ca和沃尔玛. ca说“添加到购物车”，但asda.com只说“添加”，而我们的乔治服装品牌说“添加到篮子”，我们的grocery.walmart.com有一个图标。</p><figure class="kn ko kp kq fd ii er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es lb"><img src="../Images/26c64ab737fbe48bd7dc04955e63024c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a-3DlvR6-xabNhFenEcRkg.png"/></div></div></figure><p id="cde9" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我们使用<a class="ae jj" href="https://github.com/yahoo/react-intl" rel="noopener ugc nofollow" target="_blank"> React-Intl </a>来承担内容管理的重任。内容是在组件级别管理的，非常类似于样式，每个租户都有自己的内容文件。您可以在您的租户内容文件夹中指定特定于您的租户/品牌的内容(就像CSS一样)，但是内容的独特之处在于，对于未指定的密钥，我们默认为walmart.com内容。在组件构建期间，根据您的租户构建参数，我们的webpack构建将仅保留您的租户内容以及来自walmart.com内容的默认未指定密钥。</p><h1 id="7588" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">更大的差异</h1><p id="45a2" class="pw-post-body-paragraph il im hh in b io ki iq ir is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji ha bi translated">甚至租户之间更大的差异，比如共享组件中的DOM变化，我们有两种不同的策略。对于较小的DOM变化，我们使用组件属性来启用、禁用和操作子组件。这方面的一个例子是我们的登录表单；山姆会员店喜欢在密码表格里有一个小小的“显示密码”按钮，而沃尔玛却没有。我将制作一个名为“displayShowPassword”的道具来管理这个租户特定的功能。</p><p id="67ed" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">需要注意的一点是，如果您严重依赖于使用props来管理不同的租户特性，这可能会使您的组件变得更大，使其在开发中更难管理，并且会占用更大的文件空间。如果您的代码路径对租户来说是互斥的，这一点尤其正确。我们正在努力解决这个问题。</p><p id="6f69" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">对于较大的变化，我们使用高阶组件和复合组件。当然，这要求每个共享组件从第一天起就要考虑这种可配置性，这涉及到最初开发时的深谋远虑。然而，从长远来看，我们发现可重用性的回报值得额外的预先考虑。</p><h1 id="5fe7" class="jk jl hh bd jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh bi translated">巨大差异的例子</h1><p id="db33" class="pw-post-body-paragraph il im hh in b io ki iq ir is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji ha bi translated">我们将采用两个不同租户的“登录用例”。考虑下面的图片，在图片的左侧有一个电子邮件，密码，还显示了忘记密码链接和登录按钮。在右边，我们取一个电子邮件和密码，还有一个<strong class="in hi"> <em class="lg">标题</em> </strong>和<strong class="in hi"> <em class="lg">几个额外的链接</em> </strong>以及登录按钮。我们可以清楚地看到，UI中有一些元素可以在租户之间共享(例如，租户都需要一个电子邮件地址/密码，并允许用户登录)，但也有租户特定的功能变化(例如，右边的租户需要额外的链接和标题)。</p><p id="f109" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">现在，在我们深入研究如何做之前，我想解决这样一个问题“这些看起来真的是不同的UI，为什么我们要努力让它成为多品牌而不是建立一个新的？”虽然组件看起来很不一样，但是从长期来看，扩展一个现有的组件比创建一个新的组件要容易得多(通常在短期内也是如此)。例如，在登录时，您可能有特殊的安全或隐私要求，必须注意这些要求，然后确保您符合ADA，然后您支持所有的浏览器和mweb，处理错误情况，为表单编写自动化(哦，是的，我们也共享自动化)，进行API调用和其他数据业务(记住，我们也共享我们的redux)。所有这些都是开箱即用的，最初的组件都需要复制。将来，如果samsclub转换得更好，或者沃尔玛希望创建一个帐户部分，它可能会希望“显示密码”。本质上，当一个团队进行bug修复或a/b测试并对表单进行改进时，这些增加会在所有租户/品牌中共享。</p><p id="b17c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">好吧，很抱歉在“为什么”上跑题了，让我们来谈谈如何解决代码共享的问题，同时提供定制/可扩展性？</p><p id="af01" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">嗯，我们将应用上面讨论的两点中的两点，即<strong class="in hi">组合</strong>和使用<strong class="in hi">道具</strong>来控制组件中的特性，</p><figure class="kn ko kp kq fd ii er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es lb"><img src="../Images/6592799d4be85df41e79cfac4447fdb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*3w8MYZu8-HuChhbQPSrlSg.gif"/></div></div><figcaption class="lh li et er es lj lk bd b be z dx">Walmart and Sams Login Forms respectfully</figcaption></figure><figure class="kn ko kp kq fd ii er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es ll"><img src="../Images/01c6ea5fe2bcc89c6de94c9800b319ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*X8Kmo4nhFo0ZvJea."/></div></div></figure><p id="7ec5" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我们将举一个不同的例子来解决一个来自面向方面编程世界的问题。<strong class="in hi">面向方面编程</strong> ( <strong class="in hi"> AOP </strong>)是一种编程范例，旨在通过允许分离横切关注点来增加模块化。在本例中，我们将尝试对React组件进行<strong class="in hi">“分析跟踪”</strong>，这是一个横切关注点。<strong class="in hi"> </strong>我们如何解决这个问题？</p><p id="4df1" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">我们将应用上面提到的“高阶组件”的概念。</p><figure class="kn ko kp kq fd ii er es paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="er es lm"><img src="../Images/e738e2a869c7487be5bafca8db586541.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7Dfmiy7JH4clBEnW."/></div></div></figure><p id="dafa" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如果租户有不同的跟踪方式，那么我们将为每个租户提供不同的特设细节。</p><p id="4ac7" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">除了上面提到的策略，确保组件的编码遵循基本的软件开发原则，如<strong class="in hi"><em class="lg"/></strong><strong class="in hi"><em class="lg">不要重复自己(干)</em> </strong>等。，这有助于不同租户之间的代码共享。</p><p id="e453" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这些是我们在@WalmartLabs的多租户战略的基本要素。我们发现这是开发健壮的、可维护的应用程序的一个很好的基础，这些应用程序共享一个公共的后端，而不牺牲本地化和品牌。</p><p id="97b5" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">感谢<a class="ae jj" rel="noopener" href="/@vmayakumar"> Mayakumar </a>和<a class="ae jj" rel="noopener" href="/@vasa"> Vasa </a>在伟大的例子中投球！</p></div></div>    
</body>
</html>