<html>
<head>
<title>Pin2Interest: A scalable system for content classification</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Pin2Interest:一个可扩展的内容分类系统</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/pin2interest-a-scalable-system-for-content-classification-41a586675ee7?source=collection_archive---------1-----------------------#2019-08-16">https://medium.com/pinterest-engineering/pin2interest-a-scalable-system-for-content-classification-41a586675ee7?source=collection_archive---------1-----------------------#2019-08-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="da2c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Eileen Li |软件工程师，知识</p><p id="a5b6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">内容理解是任何优秀推荐系统的核心。通过了解每个Pin是关于什么的，Pinterest可以将Pinners与最相关、最鼓舞人心、最符合他们兴趣的内容联系起来。</p><h1 id="5449" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">兴趣分类</h1><p id="6d96" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated"><strong class="ig hi">兴趣分类法</strong>捕捉Pinterest中出现的流行概念，并将它们组织成一个结构化的层次结构。这种高度精选的分类树目前有10级粒度，拥有“女性时尚”、“DIY工艺”等24个顶级概念和数万个总兴趣。结构和词汇将继续扩大和增长。为了让您对我们的兴趣类型有所了解，以下是我们“家居装饰”垂直领域的一个示例:</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div class="er es kf"><img src="../Images/bb1388d16fc1fa4242d715cf38ac1589.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/0*M3v-Dx3ZoUVz9Z88"/></div></figure><p id="3815" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">兴趣分类法是我们对内容进行分类的集中方式，包括图钉、图板、图钉和搜索查询。</p><h1 id="65f1" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">将图钉映射到兴趣</h1><p id="f53b" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">我们构建了<strong class="ig hi"> Pin2Interes </strong> t (P2I)来将我们的200B+pin语料库映射到一个动态分类中。P2I为属于我们丰富的兴趣分类的图钉提供高质量、人类可理解的<strong class="ig hi"> </strong>标签。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es kn"><img src="../Images/eeef00dd069e3bdc83a803cdfe36c219.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*OuYiZbc4J3vq3ySb"/></div></div></figure><p id="92f7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于上面的Pin，我们得到P2I结果，格式为<em class="ks"> (taxonomy_level，label，score) </em>:</p><ul class=""><li id="8ad4" class="kt ku hh ig b ih ii il im ip kv it kw ix kx jb ky kz la lb bi translated"><em class="ks"> (3，狗，0.83) </em></li><li id="416a" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated"><em class="ks"> (2，哺乳动物，0.7) </em></li><li id="cb1c" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated"><em class="ks"> (1，动物，0.82) </em></li><li id="e5c1" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated"><em class="ks"> (3，滑雪，0.83) </em></li><li id="2f84" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated"><em class="ks"> (3，单板滑雪，0.79) </em></li><li id="1db7" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated"><em class="ks"> (2、冬季运动，0.75) </em></li><li id="e46f" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated"><em class="ks"> (3，单板滑雪，0.79) </em></li><li id="f385" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated"><em class="ks"> (2、冬季运动，0.75) </em></li><li id="5bbb" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated"><em class="ks"> (3次滑雪旅行，0.76) </em></li><li id="645e" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated"><em class="ks"> (2、出行思路，0.65) </em></li><li id="b5db" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated"><em class="ks"> (1，行程，0.71) </em></li></ul><p id="7618" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在分类学中，<em class="ks">狗</em>是<em class="ks">哺乳动物</em>的孩子，而哺乳动物又是<em class="ks">动物</em>的孩子，而<em class="ks">滑雪</em>和<em class="ks">单板滑雪</em>是<em class="ks">冬季运动</em>的孩子。</p><h1 id="94b7" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">个案研究</h1><p id="8443" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">P2I在Pinterest的不同系统中被广泛使用。来自P2I的结果可以用来识别和删除不安全的内容，生成个性化的建议，并为机器学习模型创建排名功能。P2I结果也可能直接暴露于Pinners。</p><p id="ef50" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以下是P2I信号消费者的一些例子:</p><ul class=""><li id="d7d8" class="kt ku hh ig b ih ii il im ip kv it kw ix kx jb ky kz la lb bi translated">用户到兴趣(U2I) —用户到兴趣的映射</li><li id="41c9" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated">兴趣查询(Q2I) —搜索查询到兴趣的映射</li><li id="1aff" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated">主页订阅排名—关于您的主页订阅的建议</li><li id="ab58" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated">搜索排名和检索—来自搜索结果的推荐</li><li id="1dfd" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated">广告兴趣定位和检索—展示推广内容的产品</li></ul><h1 id="a1bb" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">使用P2I作为分级特征</h1><p id="77dd" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">P2I是其他<em class="ks"> X </em> 2I系统构建的基础。结果是一个公共的分类空间，其中可以在用户、查询、板、管脚等之间建立关系。</p><p id="8f5b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们在搜索系统中根据搜索查询和pin兴趣的相似性创建排名特征，并且我们在用户和pin之间的home feed上做类似的事情。事实上，我们利用了兴趣分类结构，并为分类的不同级别创建了不同的特性，代表了从广泛到更细粒度的兴趣匹配。</p><p id="385e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">示例:</p><ul class=""><li id="1e4e" class="kt ku hh ig b ih ii il im ip kv it kw ix kx jb ky kz la lb bi translated">feature 1—cos _ sim _ l1 _ interests =<em class="ks">sum(pin/query的匹配L1兴趣的乘积)</em></li><li id="4173" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated">feature 2—cos _ sim _ l2 _ interests =<em class="ks">sum(pin/query匹配L2兴趣的乘积)</em></li></ul><h1 id="8968" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">使用P2I进行广告兴趣定位</h1><p id="71ee" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated"><strong class="ig hi">兴趣定位</strong>是一款广告产品，允许广告商通过从兴趣分类中选择类别来选择他们想要到达的受众。</p><p id="95fe" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于以下查询Pin:</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es kn"><img src="../Images/d0d2c9de65aab5dcc4b3bf02a2a49383.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vf8RK-BYXfidw5bn"/></div></div></figure><p id="b594" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们在大头针特写上展示了一些相关结果:</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es lh"><img src="../Images/bcbf3c7111cd003cbead7eb30c0cfeb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2kRapzJf3BIwAmIA"/></div></div></figure><p id="1402" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">推广的pin，标有“Promoted By”的，是被广告主推广过的，为Pinterest带来收入的pin。使用我们的兴趣定位产品，每个推广的Pin都有广告客户指定的兴趣，如<em class="ks">旅游</em>和<em class="ks">户外运动。</em>P2I信号用于通过确保查询Pin与目标共享相同的兴趣来实施兴趣目标。在上面的示例中，用红色圈出的两个提升的Pin与查询Pin共享相同的<em class="ks">差旅</em>兴趣，而没有任何重叠兴趣的其他候选人已被过滤掉。</p><h1 id="f284" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">它是如何工作的</h1><p id="2679" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">P2I是一个机器学习系统，大致由两个模块组成:<strong class="ig hi">候选生成</strong>和<strong class="ig hi">排名</strong>。管道是用burning(Scala+MapReduce)编写的，每天运行，为我们的pin语料库重新分类兴趣。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es li"><img src="../Images/c90ae957837453f6ab722fba3dbf6a0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*X8ghGf7j8eQi2olS"/></div></div></figure><h1 id="bb90" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">候选生成</h1><p id="68ae" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">在候选生成中，我们使用相对廉价、高召回率的方法来获得可能与每个Pin相关的兴趣。在此阶段，我们通过以下方法产生最多200名候选人(平均70名):</p><h1 id="0641" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">词汇扩展</h1><p id="92d6" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">我们通过对来自Pin的文本执行词法扩展来获得少量高度精确的匹配。词汇扩展可以包括匹配具有低编辑距离的术语、注释的重新排序、词汇化等。</p><p id="f995" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以下是一些例子:</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es lj"><img src="../Images/2eadbe52ee2934439fa1b47225e651ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*XN1oNBZp0PG1EGB2"/></div></div></figure><h1 id="98fc" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">引脚/电路板共现</h1><p id="5414" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">使用这些高度精确的词汇匹配，我们然后通过聚合pin上的共现术语和板上的共现pin来构建一个更大的网络。</p><p id="24df" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">结果是<em class="ks">{ pin:[兴趣候选列表]}，</em>的映射，这是第二阶段的输入，排名。</p><h1 id="58e2" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">等级</h1><p id="2d71" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">然后，我们对来自候选生成阶段的每个(Pin，interest)对进行评分，并在我们的最终分类输出中保留那些具有最高相关性分数的对。更具体地说，我们提取每个候选对的特征，并使用二元分类器对它们进行排序(1表示相关，0表示不相关)。我们目前使用梯度推进决策树(GBDT)为我们的模型。</p><p id="c9b6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一些功能包括:</p><ul class=""><li id="ce98" class="kt ku hh ig b ih ii il im ip kv it kw ix kx jb ky kz la lb bi translated">嵌入相似性特征(文本嵌入，如FastText，Pin嵌入，如<a class="ae lk" rel="noopener" href="/pinterest-engineering/pinsage-a-new-graph-convolutional-neural-network-for-web-scale-recommender-systems-88795a107f48"> PinSage </a></li><li id="e3e5" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated">来自Pin <a class="ae lk" rel="noopener" href="/pinterest-engineering/understanding-pins-through-keyword-extraction-40cf94214c18">注解</a>的Tf-idf特征(其中Pin是文档，interest是术语)</li><li id="5565" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated">分类功能(利用层次结构，如L1父匹配)</li><li id="4a80" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated">销接合特征(性别、受欢迎程度等。)</li><li id="2a47" class="kt ku hh ig b ih lc il ld ip le it lf ix lg jb ky kz la lb bi translated">上下文特征(Pin类型、国家等。)</li></ul><h1 id="70e9" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">立即引起兴趣</h1><p id="e18a" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">新创建的pin通过我们称之为“即时利息”的替代流程与利息预测相关联。这个流程与日常批处理工作流有许多相同的逻辑，但是我们对新Pin的了解要少得多。相同的模型被触发，只有在管脚创建期间可用的特征。这些预测在每日批处理工作流运行之前可用，并且对于新pin的激活和分发非常重要。</p><h1 id="625a" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">攀登P2I</h1><p id="b0e4" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">该系统旨在适应不断增长的分类法。当增加新的兴趣时，P2I只是工作而没有任何额外的工程工作。不需要重新训练模型，因为可以利用现有管道为每个新兴趣提取特征。这种灵活性允许团队快速迭代来自产品团队的请求(例如趋势兴趣)并为分类法的许多版本重用相同的系统。</p><p id="0bab" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该团队面临的另一个挑战是让系统对数千亿个pin有效工作。我们已经建立了一个模块化系统，其中的组件可以并行工作、调试和改进。瓶颈很容易被识别和标记。在适当的时候利用压缩。工程师们已经学会了在开发的每一步都要考虑效率，因为每个引脚多占用0.01%的资源，乘以2000亿就会放大到有意义的程度。</p><h1 id="9ef4" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">走向国际</h1><p id="7e9f" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">让Pinterest国际化对我们业务的成功至关重要。P2I旨在通过很少或没有工程工作来支持更多国家。我们当前的系统支持17种语言，并且还在增加。</p><p id="ef3a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">兴趣分类的每个节点代表一个概念，独立于任何语言。不管是“猫”还是“聊天”(法语)，猫别针的概念都差不多。在内部，我们使用数字id而不是文本标签来唯一地标识兴趣。兴趣文本仅在候选生成的词汇扩展期间使用。为了帮助这个阶段，我们在词汇扩展之前提供了从语言<em class="ks"> X </em>到英语的翻译。因此，从工程角度来看，向P2I添加额外的语言非常简单。</p><h1 id="c39a" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">结论</h1><p id="7492" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated"><strong class="ig hi"> Pin2Interest </strong>将Pin映射到一个动态的、高度精确的分类中。该系统是灵活的，并适应新的要求，如兴趣分类的变化和国际扩张。结果是一个强大的信号，对我们数千亿条内容进行分类，并被Pinterest上的系统使用。</p><p id="8f71" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">【鸣谢:】团队成员、、宋翠、美和孝树(PM) &amp;、郭(EM)，以及斯坦福大学学生团队成员Attila Dobi、Dhananjay Shrouty、Heath Vinicombe、Rui Li、Troy Ma &amp;在此表示感谢。</p></div></div>    
</body>
</html>