<html>
<head>
<title>Building a video player app in Android (Part 4 / 5)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Android中构建视频播放器应用程序(第4 / 5部分)</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/building-a-video-player-app-in-android-part-4-5-c69f12b49143?source=collection_archive---------8-----------------------#2018-03-09">https://medium.com/androiddevelopers/building-a-video-player-app-in-android-part-4-5-c69f12b49143?source=collection_archive---------8-----------------------#2018-03-09</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="1c97" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">使用ExoPlayer、播放列表、媒体会话、音频聚焦、画中画</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/2eed2a5c9bda533975efea4a4131b83e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UJISwRlkYE8nJzVJdudikw.png"/></div></div></figure><p id="2a91" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">本系列文章的目标是让您开始使用ExoPlayer构建一个简单但功能丰富的视频播放器应用程序(支持播放列表、媒体会话、音频焦点和画中画)。</p><p id="6a61" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这是5部分系列的第4部分，包括:</p><ul class=""><li id="db2f" class="ke kf hh jk b jl jm jo jp jr kg jv kh jz ki kd kj kk kl km bi translated"><a class="ae kn" rel="noopener" href="/@nazmul/building-a-video-player-app-in-android-part-1-5-d95770ef762d"> ExoPlayer简介</a></li><li id="cfa1" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated"><a class="ae kn" rel="noopener" href="/@nazmul/building-a-video-player-app-in-android-part-2-5-e5a5392879fa"> ExoPlayer播放列表、用户界面定制和事件</a></li><li id="ef2e" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated">【ExoPlayer的MediaSession连接器扩展</li><li id="c2a6" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated">支持音频聚焦(<strong class="jk hi">本文</strong>)</li><li id="f7ef" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated"><a class="ae kn" rel="noopener" href="/@nazmul/building-a-video-player-app-in-android-part-5-5-725c1ec2557a">支持PIP </a></li></ul><p id="853d" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">本系列的前一篇文章介绍了将ExoPlayer实例连接到MediaSession所需的步骤。这篇文章详细介绍了在应用程序中支持音频聚焦的细节。</p><h1 id="ef4c" class="kt ku hh bd kv kw kx ky kz la lb lc ld in le io lf iq lg ir lh it li iu lj lk bi translated">音频焦点</h1><p id="acb5" class="pw-post-body-paragraph ji jj hh jk b jl ll ii jn jo lm il jq jr ln jt ju jv lo jx jy jz lp kb kc kd ha bi translated">Android允许许多应用程序通过自动混合所有音频流来同时播放音频。然而，如果用户听到多个应用程序同时播放音频，就会产生干扰。这就像许多人试图同时与一个用户交谈，其结果是他们无法真正听到或注意到任何一个人。为了避免这一点，Android提供了一个<a class="ae kn" href="https://developer.android.com/guide/topics/media-apps/audio-focus.html" rel="noopener ugc nofollow" target="_blank"> API </a>，允许应用程序共享音频焦点，在任何给定时间只有一个应用程序可以保持音频焦点。</p><p id="97af" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">您可以从以下来源了解有关音频焦点的详细信息以及如何实现它。</p><ul class=""><li id="9a6e" class="ke kf hh jk b jl jm jo jp jr kg jv kh jz ki kd kj kk kl km bi translated"><a class="ae kn" rel="noopener" href="/google-developers/audio-focus-1-6b32689e4380">了解媒体上的音频焦点文章</a>。这篇文章深入探讨了什么是音频聚焦，什么是闪避，什么是音频属性，以及你应该为你的应用考虑哪些重要的用例。</li><li id="dfef" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated"><a class="ae kn" href="https://github.com/googlesamples/android-MediaBrowserService" rel="noopener ugc nofollow" target="_blank">使用音频聚焦的Android示例应用</a>。有一个处理音频焦点的<code class="du lq lr ls lt b"><a class="ae kn" href="https://github.com/googlesamples/android-MediaBrowserService/blob/ed830016fdf702c65698924b5d617d496e08606e/Application/src/main/java/com/example/android/mediasession/service/PlayerAdapter.java" rel="noopener ugc nofollow" target="_blank">AudioFocusHelper</a></code> <a class="ae kn" href="https://github.com/googlesamples/android-MediaBrowserService/blob/ed830016fdf702c65698924b5d617d496e08606e/Application/src/main/java/com/example/android/mediasession/service/PlayerAdapter.java" rel="noopener ugc nofollow" target="_blank">类</a>(用Java编写)。</li></ul><h1 id="74e3" class="kt ku hh bd kv kw kx ky kz la lb lc ld in le io lf iq lg ir lh it li iu lj lk bi translated">使用ExoPlayer实现Kotlin</h1><p id="552b" class="pw-post-body-paragraph ji jj hh jk b jl ll ii jn jo lm il jq jr ln jt ju jv lo jx jy jz lp kb kc kd ha bi translated">在Kotlin中很容易使用委托模式来创建一个子类，该子类使用超类的一个实例来提供所有继承的行为。这样，您就可以只关注子类中的差异，而无需编写任何样板代码。下面的代码展示了如何扩展<code class="du lq lr ls lt b">SimpleExoPlayer</code>类来处理音频焦点。您可以像使用<code class="du lq lr ls lt b">SimpleExoPlayer</code>一样使用这个类，通过传递您的应用程序所需的音频焦点类型(使用<code class="du lq lr ls lt b">AudioAttributes</code>)。</p><p id="091a" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">下面是为播放音乐的应用程序创建音频属性的代码片段(视频文件的音轨)。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lu lv l"/></div></figure><p id="3063" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">下面是扩展了<code class="du lq lr ls lt b">SimpleExoPlayer</code>的<code class="du lq lr ls lt b">AudioFocusWrapper</code>类的代码片段。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lu lv l"/></div></figure><h1 id="7fb9" class="kt ku hh bd kv kw kx ky kz la lb lc ld in le io lf iq lg ir lh it li iu lj lk bi translated">画中画和音频焦点</h1><p id="b81c" class="pw-post-body-paragraph ji jj hh jk b jl ll ii jn jo lm il jq jr ln jt ju jv lo jx jy jz lp kb kc kd ha bi translated">到目前为止，我们的应用程序不能在后台运行。一旦任何其他应用程序启动，或者用户切换到主屏幕，播放就会停止。因此，在这种情况下，音频焦点并没有多大用处。然而，一旦你为应用程序添加了将自己最小化到一个小窗口并在其他应用程序运行时播放媒体的功能，音频焦点就变得非常重要。</p><p id="5493" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">想象一下这个场景，你启动视频播放器应用程序并开始播放视频，然后将其最小化为PIP窗口，然后启动YouTube。此时，用户可以看到YouTube和视频播放器应用程序。</p><ul class=""><li id="21f3" class="ke kf hh jk b jl jm jo jp jr kg jv kh jz ki kd kj kk kl km bi translated">当您选择在YouTube应用程序中播放视频时，这应该会暂停示例应用程序中的播放。</li><li id="f7c0" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated">当您选择在示例应用程序中播放视频时，这应该会暂停视频应用程序中的播放。</li></ul><p id="4eea" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">我们将在本系列的下一篇(也是最后一篇)文章中探讨这个问题👍。</p><h1 id="f919" class="kt ku hh bd kv kw kx ky kz la lb lc ld in le io lf iq lg ir lh it li iu lj lk bi translated">GitHub上的源代码</h1><p id="33e2" class="pw-post-body-paragraph ji jj hh jk b jl ll ii jn jo lm il jq jr ln jt ju jv lo jx jy jz lp kb kc kd ha bi translated">通过遵循这5篇文章，你应该能够创建一个视频播放器应用程序，类似于我们已经创建的这个示例(你也可以从Android Studio获得)。</p><div class="lw lx ez fb ly lz"><a href="https://github.com/googlesamples/android-VideoPlayer" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hi fi z dy me ea eb mf ed ef hg bi translated">谷歌样品/安卓视频播放器</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">在GitHub上创建一个帐户，为android视频播放器的开发做出贡献。</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">github.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn jg lz"/></div></div></a></div><h1 id="c3b4" class="kt ku hh bd kv kw kx ky kz la lb lc ld in le io lf iq lg ir lh it li iu lj lk bi translated">进一步学习的资源</h1><p id="d56c" class="pw-post-body-paragraph ji jj hh jk b jl ll ii jn jo lm il jq jr ln jt ju jv lo jx jy jz lp kb kc kd ha bi translated"><strong class="jk hi"> ExoPlayer </strong></p><ul class=""><li id="7671" class="ke kf hh jk b jl jm jo jp jr kg jv kh jz ki kd kj kk kl km bi translated"><a class="ae kn" href="https://codelabs.developers.google.com/codelabs/exoplayer-intro/#0" rel="noopener ugc nofollow" target="_blank"> IO17 ExoPlayer codelab </a></li><li id="4498" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated"><a class="ae kn" href="https://www.youtube.com/watch?v=6VjF638VObA" rel="noopener ugc nofollow" target="_blank"> IO14 ExoPlayer介绍视频</a></li><li id="5905" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated"><a class="ae kn" href="https://www.youtube.com/watch?v=jAZn-J1I8Eg" rel="noopener ugc nofollow" target="_blank"> IO17 ExoPlayer会话视频</a></li><li id="fdb2" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated"><a class="ae kn" rel="noopener" href="/google-exoplayer/exoplayer-2-x-why-what-and-when-74fd9cb139">为什么选择ExoPlayer？</a></li><li id="e16a" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated"><a class="ae kn" rel="noopener" href="/google-exoplayer/exoplayer-2-6-1-whats-new-a9e54bffffc5">exo player v 2 . 6 . 1的最新变化</a></li></ul><p id="9c14" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><strong class="jk hi">媒体会话，音频焦点</strong></p><ul class=""><li id="0871" class="ke kf hh jk b jl jm jo jp jr kg jv kh jz ki kd kj kk kl km bi translated"><a class="ae kn" rel="noopener" href="/google-exoplayer/the-mediasession-extension-for-exoplayer-82b9619deb2d">exo player的MediaSession扩展</a></li><li id="af13" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated"><a class="ae kn" rel="noopener" href="/google-developers/understanding-mediasession-part-1-3-e4d2725f18e4">什么是媒体会话</a></li><li id="f69c" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated"><a class="ae kn" rel="noopener" href="/google-developers/audio-focus-1-6b32689e4380">什么是音频焦点</a></li></ul><p id="8671" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">破折号，HLS </p><ul class=""><li id="ebe0" class="ke kf hh jk b jl jm jo jp jr kg jv kh jz ki kd kj kk kl km bi translated"><a class="ae kn" href="https://goo.gl/r9fXXf" rel="noopener ugc nofollow" target="_blank">破折号，HLS </a></li><li id="8321" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated"><a class="ae kn" href="https://goo.gl/SNvMgQ" rel="noopener ugc nofollow" target="_blank"> Dash优于HLS等</a></li></ul><p id="2650" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><strong class="jk hi">画中画</strong></p><ul class=""><li id="7098" class="ke kf hh jk b jl jm jo jp jr kg jv kh jz ki kd kj kk kl km bi translated"><a class="ae kn" rel="noopener" href="/google-developers/making-magic-moments-with-picture-in-picture-e02964bf75ae">奥利奥中的画中画模式</a></li></ul></div></div>    
</body>
</html>