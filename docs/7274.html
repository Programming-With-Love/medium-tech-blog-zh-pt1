<html>
<head>
<title>A deep dive into authorization and delayed capture.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">深入探究授权和延迟捕获。</h1>
<blockquote>原文：<a href="https://medium.com/square-corner-blog/a-deep-dive-into-authorization-and-delayed-capture-24ce2b9fd5e?source=collection_archive---------4-----------------------#2017-11-17">https://medium.com/square-corner-blog/a-deep-dive-into-authorization-and-delayed-capture-24ce2b9fd5e?source=collection_archive---------4-----------------------#2017-11-17</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="5423" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">在本帖中，我们将深入探讨持有卡中的金额并在以后捕获或取消它的可用选项。</h2></div><blockquote class="iw"><p id="8f74" class="ix iy hh bd iz ja jb jc jd je jf jg dx translated">注意，我们已经行动了！如果您想继续了解Square的最新技术内容，请访问我们的新家<a class="ae jh" href="https://developer.squareup.com/blog" rel="noopener ugc nofollow" target="_blank">https://developer.squareup.com/blog</a></p></blockquote><p id="50b6" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc jg ha bi translated">在实践中，对卡进行暂挂或“预授权”交易与用API直接向卡收费非常相似。</p><h2 id="d436" class="kd ke hh bd kf kg kh ki kj kk kl km kn jr ko kp kq jv kr ks kt jz ku kv kw kx bi translated">何时延迟捕获？</h2><p id="1b79" class="pw-post-body-paragraph ji jj hh jk b jl ky ii jn jo kz il jq jr la jt ju jv lb jx jy jz lc kb kc jg ha bi translated">选择延迟捕获交易而不是直接收费通常由您的业务类型决定。你可以在某人借设备或租房时持有他的卡。其他常见的用例包括，在客户“试驾”产品之前，需要确认他们有足够的资金购买产品，或者在购买流程中实现小费或可选小费的空间。</p><p id="5cac" class="pw-post-body-paragraph ji jj hh jk b jl ld ii jn jo le il jq jr lf jt ju jv lg jx jy jz lh kb kc jg ha bi translated">收费时唯一的区别是请求中包含的<code class="du li lj lk ll b">delay_capture</code>参数，如下所示:</p><pre class="lm ln lo lp fd lq ll lr ls aw lt bi"><span id="58cf" class="kd ke hh ll b fi lu lv l lw lx">POST /v2/locations/LOCATION_ID/transactions{<br/>  "idempotency_key": "74ae1696-b1e3-4328-af6d-f1e04d947a13",<br/>  "amount_money": {<br/>    "amount": 5000,<br/>    "currency": "USD"<br/>  },<br/>  "card_nonce": "card_nonce_from_square_123",<br/>  <strong class="ll hi">"delay_capture": false</strong><br/>}</span></pre><p id="89bd" class="pw-post-body-paragraph ji jj hh jk b jl ld ii jn jo le il jq jr lf jt ju jv lg jx jy jz lh kb kc jg ha bi translated">然后事务的状态将显示为<code class="du li lj lk ll b">AUTHORIZED</code>，而不是通常的<code class="du li lj lk ll b">CAPTURED</code>，如下所示:</p><pre class="lm ln lo lp fd lq ll lr ls aw lt bi"><span id="2cae" class="kd ke hh ll b fi lu lv l lw lx">{<br/>   "transaction": {<br/>     "id": "KnL67ZIwXCPtzOrqj0HrkxMF",<br/>     "location_id": "18YC4JDH91E1H",<br/>     "created_at": "2016-03-10T22:57:56Z",<br/>     "tenders": [<br/>       {<br/>         "id": "MtZRYYdDrYNQbOvV7nbuBvMF",<br/>         "location_id": "18YC4JDH91E1H",<br/>         "transaction_id": "KnL67ZIwXCPtzOrqj0HrkxMF",<br/>         "created_at": "2016-03-10T22:57:56Z",<br/>         "amount_money": {<br/>           "amount": 5000,<br/>           "currency": "USD"<br/>         },<br/>         "type": "CARD",<br/>         "card_details": {<br/><strong class="ll hi">           "status": "AUTHORIZED",<br/></strong>           "card": {<br/>             "card_brand": "VISA",<br/>             "last_4": "1111"<br/>           },<br/>           "entry_method": "KEYED"<br/>         }<br/>       }<br/>     ],<br/>     "product": "EXTERNAL_API"<br/>   }<br/> }</span></pre><p id="68df" class="pw-post-body-paragraph ji jj hh jk b jl ld ii jn jo le il jq jr lf jt ju jv lg jx jy jz lh kb kc jg ha bi translated">如果您的客户帐户中没有足够的资金或信用，此交易将失败。</p><p id="7a46" class="pw-post-body-paragraph ji jj hh jk b jl ld ii jn jo le il jq jr lf jt ju jv lg jx jy jz lh kb kc jg ha bi translated">您现在有一笔已授权的费用，您有六天时间来获取付款或将其作废。</p><h2 id="be8d" class="kd ke hh bd kf kg kh ki kj kk kl km kn jr ko kp kq jv kr ks kt jz ku kv kw kx bi translated">获取付款</h2><p id="c785" class="pw-post-body-paragraph ji jj hh jk b jl ky ii jn jo kz il jq jr la jt ju jv lb jx jy jz lc kb kc jg ha bi translated">如果您决定为您的授权捕获付款，您需要使用CaptureTransaction端点:</p><pre class="lm ln lo lp fd lq ll lr ls aw lt bi"><span id="6c04" class="kd ke hh ll b fi lu lv l lw lx">POST /v2/locations/{location_id}/transactions/{transaction_id}/capture</span></pre><p id="f4ef" class="pw-post-body-paragraph ji jj hh jk b jl ld ii jn jo le il jq jr lf jt ju jv lg jx jy jz lh kb kc jg ha bi translated">根据上面的交易示例，我们将使用:</p><pre class="lm ln lo lp fd lq ll lr ls aw lt bi"><span id="f8b3" class="kd ke hh ll b fi lu lv l lw lx">POST /v2/locations/<!-- -->18YC4JDH91E1H<!-- -->/transactions/<!-- -->KnL67ZIwXCPtzOrqj0HrkxMF<!-- -->/capture</span></pre><p id="ffc8" class="pw-post-body-paragraph ji jj hh jk b jl ld ii jn jo le il jq jr lf jt ju jv lg jx jy jz lh kb kc jg ha bi translated">这个端点不提供响应，所以空的json对象<code class="du li lj lk ll b">{}</code>意味着捕获成功。您可以在以后通过<a class="ae jh" href="https://docs.connect.squareup.com/api/connect/v2#endpoint-retrievetransaction" rel="noopener ugc nofollow" target="_blank">检索事务</a>来获得事务细节。</p><h2 id="d34a" class="kd ke hh bd kf kg kh ki kj kk kl km kn jr ko kp kq jv kr ks kt jz ku kv kw kx bi translated">使付款无效</h2><p id="1557" class="pw-post-body-paragraph ji jj hh jk b jl ky ii jn jo kz il jq jr la jt ju jv lb jx jy jz lc kb kc jg ha bi translated">授权交易将在6天后自动失效，但最佳做法是在您知道您不会获得资金时，立即使付款<em class="ly">失效，这样您的客户就可以重新获得他们的资金或信用。</em></p><p id="88ea" class="pw-post-body-paragraph ji jj hh jk b jl ld ii jn jo le il jq jr lf jt ju jv lg jx jy jz lh kb kc jg ha bi translated">作废与捕获非常相似，只是端点的URL略有不同。</p><pre class="lm ln lo lp fd lq ll lr ls aw lt bi"><span id="e45c" class="kd ke hh ll b fi lu lv l lw lx">POST /v2/locations/{location_id}/transactions/{transaction_id}/<strong class="ll hi">void</strong></span></pre><p id="f1fd" class="pw-post-body-paragraph ji jj hh jk b jl ld ii jn jo le il jq jr lf jt ju jv lg jx jy jz lh kb kc jg ha bi translated">根据上面的交易示例，我们将使用:</p><pre class="lm ln lo lp fd lq ll lr ls aw lt bi"><span id="96ca" class="kd ke hh ll b fi lu lv l lw lx">POST /v2/locations/<!-- -->18YC4JDH91E1H<!-- -->/transactions/<!-- -->KnL67ZIwXCPtzOrqj0HrkxMF<!-- -->/void</span></pre><p id="826c" class="pw-post-body-paragraph ji jj hh jk b jl ld ii jn jo le il jq jr lf jt ju jv lg jx jy jz lh kb kc jg ha bi translated">这个端点也不提供响应，所以一个空的json对象<code class="du li lj lk ll b">{}</code>意味着授权交易成功作废。</p><p id="583a" class="pw-post-body-paragraph ji jj hh jk b jl ld ii jn jo le il jq jr lf jt ju jv lg jx jy jz lh kb kc jg ha bi translated">现在，您可以使用Square的电子商务API对交易进行授权了。如果你有任何问题，请在评论中告诉我们。下次见！</p></div></div>    
</body>
</html>