<html>
<head>
<title>Top 30 Useful Google Apps Script Snippets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">前30个有用的Google Apps脚本片段</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/top-30-useful-google-apps-script-snippets-8ad13077530f?source=collection_archive---------1-----------------------#2020-10-19">https://medium.com/google-developer-experts/top-30-useful-google-apps-script-snippets-8ad13077530f?source=collection_archive---------1-----------------------#2020-10-19</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/6d6282aedaf53a9461b193a31f5dd22f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WMZrVUrgB7QzaP46TLPxhw.png"/></div></div></figure><p id="b313" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">以下是我最喜欢的30个Google Apps脚本片段。这些片段会节省你的时间。</p><h1 id="9705" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">SpreadsheetApp</h1><h2 id="c682" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">访问电子表格(独立脚本)</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="3946" class="km jp hh lf b fi lj lk l ll lm">const spreadsheet = SpreadsheetApp.openById("Spreadsheet ID")</span></pre><p id="6240" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="jn">电子表格ID </em>可以从电子表格URL获得</p><p id="a58c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">https://docs . Google . com/spreadsheets/d/[<em class="jn">电子表格ID </em> ]/edit</p><h2 id="4edf" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">对电子表格的访问(容器绑定脚本)</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="6706" class="km jp hh lf b fi lj lk l ll lm">const spreadsheet = SpreadsheetApp.getActive()</span></pre><h2 id="9351" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">获取值</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="9dde" class="km jp hh lf b fi lj lk l ll lm">const values = spreadsheet<br/>  .getSheetByName('sheet name')<br/>  .getDataRange()<br/>  .getValues()</span></pre><h2 id="0b3f" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">设置值</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="83ba" class="km jp hh lf b fi lj lk l ll lm">spreadsheet<br/>  .getRange(range)<br/>  .setValues(values)</span></pre><h2 id="6ee0" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">添加自定义菜单</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="2228" class="km jp hh lf b fi lj lk l ll lm">const onOpen = () =&gt; {<br/>  SpreadsheetApp<br/>    .getActiveSpreadsheet()<br/>    .addMenu('Menu name', [<br/>      {name: 'sub menu name 1', functionName: 'functionName1'},<br/>      {name: 'sub menu name 2', functionName: 'functionName2'},<br/>    ])<br/>}</span></pre><h2 id="94dc" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">onEdit触发器</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="dcd2" class="km jp hh lf b fi lj lk l ll lm">const onEdit = e =&gt; {<br/>  const { range, oldValue, value } = e<br/>}</span></pre><h2 id="708d" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">onSelectionChange触发器</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="85c8" class="km jp hh lf b fi lj lk l ll lm">const onSelectionChange = e =&gt; {<br/>  const { range, user } = e<br/>}</span></pre><h1 id="8fab" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">谷歌日历</h1><h2 id="7184" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">创建事件</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="5d09" class="km jp hh lf b fi lj lk l ll lm">CalendarApp.getDefaultCalendar().createEvent(title, start, end)</span></pre><h2 id="0908" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">获取事件</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="5723" class="km jp hh lf b fi lj lk l ll lm">const events = CalendarApp<br/>  .getDefaultCalendar()<br/>  .getEvents(start, end)<br/>  .map(event =&gt; ({<br/>    title: event.getTitle(),<br/>    description: event.getDescription(),<br/>    start: event.getStartTime(),<br/>    end: event.getEndTime()<br/>  }))</span></pre><p id="b589" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您可以从<a class="ae ln" href="https://developers.google.com/apps-script/reference/calendar/calendar-event" rel="noopener ugc nofollow" target="_blank"> CalendarEvent </a>类中获取其他属性</p><h2 id="c15a" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">访问非默认日历</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="c090" class="km jp hh lf b fi lj lk l ll lm">const calendar = CalendarApp.getCalendarById('Calendar ID')</span></pre><h1 id="5e36" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">谷歌邮箱</h1><h2 id="3d17" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">发送电子邮件</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="aa80" class="km jp hh lf b fi lj lk l ll lm">GmailApp.sendEmail('tanabee@example.com', 'subject', 'body')</span></pre><h2 id="511e" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">搜索线索</h2><p id="da94" class="pw-post-body-paragraph ip iq hh ir b is lo iu iv iw lp iy iz ja lq jc jd je lr jg jh ji ls jk jl jm ha bi translated">如果你想得到10个最新的线程，</p><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="4aa2" class="km jp hh lf b fi lj lk l ll lm">const threads = GmailApp.search('', 0, 10)</span></pre><p id="75a3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您可以将<a class="ae ln" href="https://support.google.com/mail/answer/7190?hl=en" rel="noopener ugc nofollow" target="_blank">搜索操作符</a>设置为第一个参数。</p><h2 id="ebde" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">获取消息</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="2866" class="km jp hh lf b fi lj lk l ll lm">const messages = GmailApp.search('', 0, 10).flatMap(thread =&gt; <br/>  thread.getMessages().map(message =&gt; ({<br/>    subject: message.getSubject(),<br/>    body: message.getBody(),<br/>    date: message.getDate(),<br/>    from: message.getFrom(),<br/>    to: message.getTo(),<br/>  }))<br/>)</span></pre><p id="df44" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您可以从<a class="ae ln" href="https://developers.google.com/apps-script/reference/gmail/gmail-message" rel="noopener ugc nofollow" target="_blank"> GmailMessage </a>类中获取其他属性</p><h1 id="d441" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">Google Drive</h1><h2 id="eb4e" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">获取特定文件夹中的文件夹和文件</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="407a" class="km jp hh lf b fi lj lk l ll lm">const folder = DriveApp.getFolderById('Folder ID')</span><span id="850f" class="km jp hh lf b fi lt lk l ll lm">const files = folder.getFiles()<br/>while (files.hasNext()) {<br/>  let file = files.next()<br/>  console.log('file: ', file.getName())<br/>}</span><span id="e25f" class="km jp hh lf b fi lt lk l ll lm">const folders = folder.getFolders()<br/>while (folders.hasNext()) {<br/>  let folder = folders.next()<br/>  console.log('folder: ', folder.getName())<br/>}</span></pre><h1 id="9ce6" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">谷歌表单</h1><h1 id="e3c1" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">获取输入值</h1><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="0d77" class="km jp hh lf b fi lj lk l ll lm">const onSubmit = event =&gt; {<br/>  const answer = event.response<br/>    .getItemResponses()<br/>    .map(itemResponse =&gt; ({<br/>      item: itemResponse.getItem().getTitle(),<br/>      response: itemResponse.getResponse()<br/>    }))<br/>}</span></pre><p id="a139" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您需要添加表单提交触发器。</p><h1 id="dfa2" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">谷歌文档</h1><h2 id="1a4c" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">访问Google文档(独立脚本)</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="32f0" class="km jp hh lf b fi lj lk l ll lm">const doc = DocumentApp.openById('Document ID')</span></pre><p id="32d2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="jn">文档ID </em>可从电子表格URL获得</p><p id="4232" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">https://docs . Google . com/Document/d/[<em class="jn">文档ID </em> ]/edit</p><h2 id="ba7a" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">访问Google文档(容器绑定脚本)</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="91c3" class="km jp hh lf b fi lj lk l ll lm">const doc = DocumentApp.getActiveDocument()</span></pre><h2 id="2a3b" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">添加自定义菜单</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="f5c8" class="km jp hh lf b fi lj lk l ll lm">const onOpen = () =&gt; {<br/>  DocumentApp<br/>    .getUi()<br/>    .createMenu('menu name')<br/>    .addItem('item name', 'functionName')<br/>    .addToUi()<br/>}</span></pre><h1 id="3ebd" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">公用事业</h1><h2 id="9410" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">格式化日期</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="f811" class="km jp hh lf b fi lj lk l ll lm">const date = Utilities.formatDate(new Date(), 'Asia/Tokyo', 'YYYY-MM-dd HH:mm:ss')</span></pre><h2 id="1d4d" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">睡眠</h2><p id="bd16" class="pw-post-body-paragraph ip iq hh ir b is lo iu iv iw lp iy iz ja lq jc jd je lr jg jh ji ls jk jl jm ha bi translated">如果您希望脚本休眠1秒钟</p><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="d5ed" class="km jp hh lf b fi lj lk l ll lm">Utilities.sleep(1000)</span></pre><h2 id="27cc" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">生成UUID</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="b32c" class="km jp hh lf b fi lj lk l ll lm">const uuid = Utilities.getUuid()</span></pre><h1 id="e286" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">引发</h1><h2 id="f6a4" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">1分钟后执行功能</h2><p id="a677" class="pw-post-body-paragraph ip iq hh ir b is lo iu iv iw lp iy iz ja lq jc jd je lr jg jh ji ls jk jl jm ha bi translated">Google Apps脚本对脚本运行时间有一个<a class="ae ln" href="https://developers.google.com/apps-script/guides/services/quotas#current_limitations" rel="noopener ugc nofollow" target="_blank">限制</a>。如果希望脚本的工作超过限制，可以提前安排下一次执行。</p><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="2dd9" class="km jp hh lf b fi lj lk l ll lm">const date = new Date()<br/>date.setMinutes(date.getMinutes() + 1);// after 1 min<br/>ScriptApp.newTrigger('functionName').timeBased().at(date).create();</span></pre><h1 id="f5e9" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">属性服务</h1><h2 id="c8fc" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">获取属性</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="cd19" class="km jp hh lf b fi lj lk l ll lm">const value = PropertiesService.getScriptProperties().getProperty(key)</span></pre><h2 id="f2f2" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">设置属性</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="3b55" class="km jp hh lf b fi lj lk l ll lm">PropertiesService.getScriptProperties().setProperty(key, value)</span></pre><h1 id="8e8c" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">语言应用程序</h1><h2 id="a532" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">翻译</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="2526" class="km jp hh lf b fi lj lk l ll lm">const text = LanguageApp.translate('Hello World', 'en', 'ja')</span></pre><h1 id="4b7a" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">网络应用</h1><h2 id="5e3f" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">网站(无HTML模板)</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="1596" class="km jp hh lf b fi lj lk l ll lm">const doGet = e =&gt; {<br/>  const params = JSON.stringify(e.parameter)<br/>  return HtmlService.createHtmlOutput(params)<br/>}</span></pre><h2 id="74cb" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">网站(带HTML模板)</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="a615" class="km jp hh lf b fi lj lk l ll lm">const doGet = e =&gt; {<br/>  return HtmlService.createHtmlOutputFromFile('index')<br/>}</span></pre><p id="d27c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您需要创建index.html文件。</p><h2 id="0660" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">获取API</h2><p id="d08d" class="pw-post-body-paragraph ip iq hh ir b is lo iu iv iw lp iy iz ja lq jc jd je lr jg jh ji ls jk jl jm ha bi translated">通过访问e.parameter可以得到查询字符串。</p><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="6a8d" class="km jp hh lf b fi lj lk l ll lm">const doGet = e =&gt; {<br/>  const params = JSON.stringify(e.parameter)<br/>  return ContentService<br/>    .createTextOutput(params)<br/>    .setMimeType(MimeType.JSON)<br/>}</span></pre><h2 id="84b9" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">发布API</h2><p id="011f" class="pw-post-body-paragraph ip iq hh ir b is lo iu iv iw lp iy iz ja lq jc jd je lr jg jh ji ls jk jl jm ha bi translated">您可以通过访问e.postData.contents来获取请求正文。</p><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="5adc" class="km jp hh lf b fi lj lk l ll lm">const doPost = e =&gt;  {<br/>  const body = e.postData.contents<br/>  return ContentService<br/>    .createTextOutput(body)<br/>    .setMimeType(ContentService.MimeType.JSON)<br/>}</span></pre><h1 id="d069" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">UrlFetchApp</h1><p id="2f64" class="pw-post-body-paragraph ip iq hh ir b is lo iu iv iw lp iy iz ja lq jc jd je lr jg jh ji ls jk jl jm ha bi translated">使用UrlFetchApp类时，可以访问其他资源。</p><h2 id="a46a" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">获取API请求</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="07f0" class="km jp hh lf b fi lj lk l ll lm">const content = UrlFetchApp.fetch(url).getContentText()</span></pre><h2 id="2ea6" class="km jp hh bd jq kn ko kp ju kq kr ks jy ja kt ku kc je kv kw kg ji kx ky kk kz bi translated">发布API请求</h2><pre class="la lb lc ld fd le lf lg lh aw li bi"><span id="0ce3" class="km jp hh lf b fi lj lk l ll lm">const res = UrlFetchApp.fetch(url, {<br/>  method: 'POST',<br/>  headers: { "Content-Type": 'application/json' },<br/>  payload: JSON.stringify(data)<br/>})</span></pre></div><div class="ab cl lu lv go lw" role="separator"><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz ma"/><span class="lx bw bk ly lz"/></div><div class="ha hb hc hd he"><p id="8316" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">感谢您阅读本文！</p></div></div>    
</body>
</html>