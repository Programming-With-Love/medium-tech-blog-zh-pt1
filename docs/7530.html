<html>
<head>
<title>The Right Way of Implementing E2E in Azure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Azure中实现E2E的正确方法</h1>
<blockquote>原文：<a href="https://medium.com/version-1/the-right-way-of-implementing-e2e-in-azure-a7844fb7048d?source=collection_archive---------0-----------------------#2022-03-28">https://medium.com/version-1/the-right-way-of-implementing-e2e-in-azure-a7844fb7048d?source=collection_archive---------0-----------------------#2022-03-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="6957" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">介绍</h1><p id="242c" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">现代企业应用程序开发不仅涵盖高效安全的工作应用程序，还涵盖若干非功能性需求，如应用程序可用性监控、性能监控、服务可用性和应用程序日志记录，以便更好地维护和支持应用程序。Microsoft Azure平台可以很好地支持这些非功能性和功能性需求。在这篇博客中，我们将使用Azure基础设施，如Azure AD B2C、App service、Azure Monitor、Application Insights、Logic App和APIM，覆盖web应用的端到端流程。</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ka"><img src="../Images/ce7da46f942bbc36e9c150bbbca3ff77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LOfBoCMZ3v-pFpEPlY3TDA.png"/></div></div><figcaption class="km kn et er es ko kp bd b be z dx">High Level Flow Diagram for the Web App</figcaption></figure><h1 id="6633" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak">什么是Azure AD B2C，目的是什么？</strong></h1><p id="95fc" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">Azure AD B2C是一项独立于Azure Active Directory (Azure AD)的服务。它基于与Azure AD相同的技术构建，但目的不同。它允许企业构建面向客户的应用程序，然后允许任何人注册这些应用程序，对用户帐户没有任何限制。</p><p id="2c92" class="pw-post-body-paragraph jc jd hh je b jf kq jh ji jj kr jl jm jn ks jp jq jr kt jt ju jv ku jx jy jz ha bi translated">它被广泛应用于企业级，因为它为任何希望使用白标认证解决方案对其web/移动应用程序的最终用户进行认证的企业或个人提供了一个平台。除了身份验证，Azure AD B2C服务还用于授权，例如通过身份验证的用户对API资源的访问。</p><p id="fe7f" class="pw-post-body-paragraph jc jd hh je b jf kq jh ji jj kr jl jm jn ks jp jq jr kt jt ju jv ku jx jy jz ha bi translated">在我们后面的案例研究中，请求清除了防火墙IP限制，被应用程序网关重定向到AD B2C。Azure AD B2C正在使用凭据对用户进行身份验证，从而生成令牌、guid等。</p><h1 id="e7f0" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak">什么是APIM，如何使用它？</strong></h1><p id="a4b3" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">Azure API Management (APIM)提供了一种为现有后端服务开发一致的现代API网关的方法。</p><p id="08cd" class="pw-post-body-paragraph jc jd hh je b jf kq jh ji jj kr jl jm jn ks jp jq jr kt jt ju jv ku jx jy jz ha bi translated">API管理帮助组织向外部、合作伙伴和内部开发人员发布API，以有效地提供释放其数据和服务潜力的平台。世界各地的企业都在一个敏捷的环境中工作，以扩展他们作为数字平台的运营，创建新的渠道，寻找新的客户，并推动与现有客户的更深入接触。API管理提供了核心能力，如开发人员参与、业务洞察力、分析、安全性和保护，确保了API计划的成功。在我们的例子中，我们使用Azure API管理来获取后端服务，并基于它启动一个成熟的API程序。</p><h1 id="d911" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak">保护APIM的应用程序？</strong></h1><p id="f587" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">在我们的研究中，我们使用AD B2C在认证后生成有效令牌。当应用程序向APIM端点发出相关调用时，需要在APIM层验证该令牌。</p><p id="9060" class="pw-post-body-paragraph jc jd hh je b jf kq jh ji jj kr jl jm jn ks jp jq jr kt jt ju jv ku jx jy jz ha bi translated">使用APIM策略和XML标记，例如APIM的<strong class="je hi"> &lt; validate-jwt &gt; </strong>，我们可以验证jwt令牌。此外，为了更好地保护应用程序，我们可以使用XML标签，比如<strong class="je hi">&lt;write-uri&gt;</strong>，它可以向前端用户隐藏实际的URL。</p><p id="692b" class="pw-post-body-paragraph jc jd hh je b jf kq jh ji jj kr jl jm jn ks jp jq jr kt jt ju jv ku jx jy jz ha bi translated">此外，APIM还提供了一些功能，如限制呼叫率(通过订阅或通过密钥)，我们正在将这些功能用于我们的案例研究体系结构中。</p><blockquote class="kv kw kx"><p id="b35a" class="jc jd ky je b jf kq jh ji jj kr jl jm kz ks jp jq la kt jt ju lb ku jx jy jz ha bi translated">示例:在以下示例中，每60秒钟10个呼叫的速率限制是由呼叫者IP地址键入的。每次策略执行后，该时间段内允许的剩余调用都存储在变量<code class="du lc ld le lf b">remainingCallsPerIP</code>中</p><p id="f775" class="jc jd ky je b jf kq jh ji jj kr jl jm kz ks jp jq la kt jt ju lb ku jx jy jz ha bi translated"><policies> <br/> &lt;入站&gt; <br/> &lt;基站/ &gt; <br/> &lt;按键通话限速="10" <br/>续保-期间="60" <br/>增量-条件= @(上下文。response . status code = = 200)"<br/>counter-key = @(context。请求. IpAddress)" <br/>剩余呼叫-变量-name = " remainingCallsPerIP "/&gt;<br/>&lt;/入站&gt; <br/> &lt;出站&gt; <br/> &lt;基/出站&gt;<br/>&lt;/保单&gt;<br/>/保单&gt;</policies></p></blockquote><p id="4c1f" class="pw-post-body-paragraph jc jd hh je b jf kq jh ji jj kr jl jm jn ks jp jq jr kt jt ju jv ku jx jy jz ha bi translated">更多详情:</p><div class="lg lh ez fb li lj"><a href="https://docs.microsoft.com/en-us/azure/api-management/api-management-access-restriction-policies#LimitCallRateByKey" rel="noopener  ugc nofollow" target="_blank"><div class="lk ab dw"><div class="ll ab lm cl cj ln"><h2 class="bd hi fi z dy lo ea eb lp ed ef hg bi translated">Azure API管理访问限制策略</h2><div class="lq l"><h3 class="bd b fi z dy lo ea eb lp ed ef dx translated">本主题为以下API管理策略提供了参考。有关添加和配置的信息…</h3></div><div class="lr l"><p class="bd b fp z dy lo ea eb lp ed ef dx translated">docs.microsoft.com</p></div></div><div class="ls l"><div class="lt l lu lv lw ls lx kk lj"/></div></div></a></div><h1 id="8355" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak">逻辑应用及其在流程中的应用？</strong></h1><p id="ee4c" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">Azure Logic应用程序提供了一种在云中简化和实施可扩展集成和工作流的方法。它提供了一个可视化的设计器，将您的过程建模和自动化为一系列称为工作流的步骤。逻辑应用程序允许开发人员设计通过触发器和一系列步骤来表达意图的工作流，每个步骤调用一个应用程序服务应用程序接口应用程序，同时安全地处理身份验证和最佳实践，如持久执行。</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es ly"><img src="../Images/f3d469a93a1e9b7706b2f29f922de70e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4GNfJWqgW_IOFrD8kmNA1Q.png"/></div></div></figure><p id="e0eb" class="pw-post-body-paragraph jc jd hh je b jf kq jh ji jj kr jl jm jn ks jp jq jr kt jt ju jv ku jx jy jz ha bi translated">在这里的案例场景中，我们在架构图中使用逻辑应用程序工作流，因为来自后端服务的响应数据需要修改，然后由前端应用程序使用。这里的逻辑应用程序工作流提供了一种开发和管理流程的简单方法，帮助我们改变响应的结构，同时还向响应中添加自定义字段。这里的替代方案可以是使用Azure Functions，但这取决于具体的用例场景。</p><h1 id="a49d" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak">使用应用洞察的优势</strong></h1><p id="4e15" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">Application Insights是一项主要针对web应用程序的Azure性能管理服务，使您能够在Azure中对网站性能进行所有监控。</p><p id="7ab1" class="pw-post-body-paragraph jc jd hh je b jf kq jh ji jj kr jl jm jn ks jp jq jr kt jt ju jv ku jx jy jz ha bi translated">这在我们的案例中是有益的，因为它也提供了一个强大的分析工具，有助于诊断问题并了解人们如何使用您的web应用程序。它帮助我们满足非功能性要求，如网站可用性、性能标准和出现问题时的警报。我们可以为每个应用洞察资源创建多达100个可用性测试。</p><p id="a93a" class="pw-post-body-paragraph jc jd hh je b jf kq jh ji jj kr jl jm jn ks jp jq jr kt jt ju jv ku jx jy jz ha bi translated">在我们的案例中可能用到的一些测试有:</p><ul class=""><li id="d42a" class="lz ma hh je b jf kq jj kr jn mb jr mc jv md jz me mf mg mh bi translated">使用<strong class="je hi"> URL Ping测试监控可用性</strong>验证端点是否使用高级HTTP请求进行响应。衡量与此响应相关的绩效。能够设置自定义成功标准。</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es mi"><img src="../Images/80382ed7ee7d91b36db1b91494f1479d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QH99JCV2GvMcu_Ctb-w_AA.png"/></div></div></figure><ul class=""><li id="f2cf" class="lz ma hh je b jf kq jj kr jn mb jr mc jv md jz me mf mg mh bi translated">类似于URL Ping测试，Azure提供了<strong class="je hi">标准测试(预览版)。</strong>除了验证端点是否响应和测量性能，标准测试还包括SSL证书有效性、主动生命周期检查、HTTP请求动词(例如<code class="du lc ld le lf b">GET</code>、<code class="du lc ld le lf b">HEAD</code>、<code class="du lc ld le lf b">POST</code>等)。)、自定义标头以及与您的HTTP请求相关联的自定义数据。</li><li id="1348" class="lz ma hh je b jf mj jj mk jn ml jr mm jv mn jz me mf mg mh bi translated"><strong class="je hi">报告</strong> —针对应用洞察的可用性警报。我们可以使用SLA工作簿作为一种方式，通过您的Application Insights资源和Azure订阅的单一控制台来计算和报告Web测试的SLA(服务级别协议)。停机和停机报告提供了强大的预建查询和数据可视化功能，以增强您对客户的连接性、典型应用程序响应时间和经历的停机时间的了解。</li><li id="f0f4" class="lz ma hh je b jf mj jj mk jn ml jr mm jv mn jz me mf mg mh bi translated">Application Insights为监控性能提供了<strong class="je hi">主动诊断</strong>“例如，如果您依赖的某项服务出现故障，或者您刚刚部署的新版本运行不太好，那么您一查看电子邮件就会知道。”提供的<strong class="je hi">实时指标流</strong>允许我们查看延迟等指标，以及检查故障等的方法。<strong class="je hi">应用地图</strong>自动发现您的应用拓扑，将性能信息置于其上，让您轻松识别分布式环境中的性能瓶颈和有问题的流程。</li></ul><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es mo"><img src="../Images/7a03e812193cdda12d1ef2da6abf4a22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XzzZgFJpYeNuDVpEMbAn7Q.png"/></div></div></figure><h1 id="6dc9" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated"><strong class="ak">结论</strong></h1><p id="a8a3" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">这篇5到6分钟的文章旨在让您了解Azure环境中的开发和端到端实现。本文提出了一个架构流程，可以被不同的企业用于他们的项目。虽然在这里我试图把重点放在Azure提供的一些最好的工具上，但是实际的实现当然是基于用例以及业务场景的。</p><figure class="kb kc kd ke fd kf er es paragraph-image"><div role="button" tabindex="0" class="kg kh di ki bf kj"><div class="er es mp"><img src="../Images/456fb45e466654ac779adb915b4f4639.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B05yMlNPdue_mrQaIS0A5A.jpeg"/></div></div></figure><p id="c41c" class="pw-post-body-paragraph jc jd hh je b jf kq jh ji jj kr jl jm jn ks jp jq jr kt jt ju jv ku jx jy jz ha bi translated"><strong class="je hi">关于作者:<br/> </strong> Siddhant Kandoi是这里1版的全栈工程师。</p></div></div>    
</body>
</html>