<html>
<head>
<title>Introducing git fastclone</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">git fastclone简介</h1>
<blockquote>原文：<a href="https://medium.com/square-corner-blog/introducing-git-fastclone-576ee734c509?source=collection_archive---------0-----------------------#2015-11-16">https://medium.com/square-corner-blog/introducing-git-fastclone-576ee734c509?source=collection_archive---------0-----------------------#2015-11-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="c17c" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">如何让你的克隆人走得更快？</h2></div><p id="1df0" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="js">由</em> <a class="jt ju ge" href="https://medium.com/u/c10a005a830c?source=post_page-----576ee734c509--------------------------------" rel="noopener" target="_blank">撰写<em class="js">张志和</em> </a> <em class="js">。</em></p><blockquote class="jv"><p id="226d" class="jw jx hh bd jy jz ka kb kc kd ke jr dx translated">注意，我们已经行动了！如果您想继续了解Square的最新技术内容，请访问我们的新家<a class="ae kf" href="https://developer.squareup.com/blog" rel="noopener ugc nofollow" target="_blank">https://developer.squareup.com/blog</a></p></blockquote><h1 id="32ac" class="kg kh hh bd ki kj kk kl km kn ko kp kq in kr io ks iq kt ir ku it kv iu kw kx bi translated">为什么选择fastclone？</h1><p id="6560" class="pw-post-body-paragraph iw ix hh iy b iz ky ii jb jc kz il je jf la jh ji jj lb jl jm jn lc jp jq jr ha bi translated">当您的应用程序和组织在增长时，模块边界会被重新定义。这可以采取拆分大型组件的形式，或者合并并重写几个相关的较小组件。在进行这些工作时，您可能会发现自己拥有许多git子模块和一个整体构建。不断增长的构建时间会让您更加沮丧和低效，如果在许多机器上重复，较小任务的成本会被放大。</p><p id="4234" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><a class="ae kf" href="https://github.com/square/git-fastclone" rel="noopener ugc nofollow" target="_blank"> Fastclone </a>通过在一个简单的ruby gem中为每个存储库及其子模块创建一个参考repo来缓解这些问题，只需输入git fastclone就可以运行这个ruby gem。它从源位置更新镜像并将它们克隆到目标目录中，以递归和多线程的方式快速工作。</p><p id="f538" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">第一个克隆将花费一些时间，但是当在构建从属上有重复的克隆或者同一个repo有多个签出时，Fastclone会大放异彩:</p><figure class="le lf lg lh fd li er es paragraph-image"><div role="button" tabindex="0" class="lj lk di ll bf lm"><div class="er es ld"><img src="../Images/46342e9e65a4c5fdff5948ddcc4036fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yVMd1QinESJeB8Q8XY8UgA.png"/></div></div></figure><h1 id="40c8" class="kg kh hh bd ki kj kk kl km kn ko kp kq in lp io ks iq lq ir ku it lr iu kw kx bi translated">在后台</h1><p id="c4d9" class="pw-post-body-paragraph iw ix hh iy b iz ky ii jb jc kz il je jf la jh ji jj lb jl jm jn lc jp jq jr ha bi translated">为了得到一个干净的结帐，我们保持我们的。git目录，并使用git服务器快速检查增量更新。之后，我们按照我们要求的版本对一个合适的工作副本进行并行组装。</p><p id="4f2b" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们使用git clone-mirror在没有工作树的情况下进行检查。因为没有工作树来更新git fetch——all总是用远程状态覆盖本地状态。这些参考文献库有完整的历史。通过使用— reference，git clone和git子模块init都可以配置为通过远程使用引用存储库。通过将这些放在一起，我们得到了一个具有完整历史的递归检验。</p><p id="8071" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">处理子模块的其余工作是线程管理和缓存。每个存储库的gitmodules。缓存子模块依赖树允许我们在克隆操作的早期旋转所有的更新线程。因为子模块链接不会经常改变，所以我们需要从git服务器预取子模块，这比延迟预取有显著的加速。</p><p id="cb58" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">子模块和git检验缓存保存在/var/tmp/git-fastclone中。这可以通过环境变量进行配置。</p><p id="d294" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">关于子模块的一个注意事项:为了CI或开发的目的获得一个干净的签出是一个绝对的负担。你可以拉取，但是你不会得到子模块的改变——也许你的一些子模块有子模块。当队友删除子模块中的文件，而git子模块update-init-recursive也不会成功时，事情就变得更有趣了。随着开发人员和子模块越来越多，这种边缘情况会变得越来越糟糕。随着存储库变得越来越大，克隆也需要更多的时间。许多简单的时间优化发现自己与边缘情况不一致，并影响您的结帐的整体可靠性。</p><h1 id="3690" class="kg kh hh bd ki kj kk kl km kn ko kp kq in lp io ks iq lq ir ku it lr iu kw kx bi translated">内部使用</h1><p id="4c3e" class="pw-post-body-paragraph iw ix hh iy b iz ky ii jb jc kz il je jf la jh ji jj lb jl jm jn lc jp jq jr ha bi translated">Square使用git-fastclone作为我们的iOS和硬件CI系统的一部分。能够快速克隆到一个空目录中，节省了我们的时间，并确保我们总是知道我们的构建的开始状态——不管在以前的构建中发生了什么。这反过来增加了系统的整体可靠性，并有利于我们的工程师。</p><h1 id="b379" class="kg kh hh bd ki kj kk kl km kn ko kp kq in lp io ks iq lq ir ku it lr iu kw kx bi translated">维护</h1><p id="4ea3" class="pw-post-body-paragraph iw ix hh iy b iz ky ii jb jc kz il je jf la jh ji jj lb jl jm jn lc jp jq jr ha bi translated">Fastclone使用最稳定的git接口。未来对git的更改很可能不会影响fastclone。</p><p id="be31" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们将在编写时发布对git-fastclone的改进和错误修复。非常欢迎对附加功能的请求，如果您觉得我们的小工具有用，我们很乐意倾听。</p><p id="f227" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">拿过来<a class="ae kf" href="https://github.com/square/git-fastclone" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><p id="a440" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">感谢<a class="ae kf" href="https://www.linkedin.com/in/mtauraso" rel="noopener ugc nofollow" target="_blank">迈克尔·陶拉索</a>最早的快速克隆版本和这篇文章。</p></div><div class="ab cl ls lt go lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ha hb hc hd he"><div class="le lf lg lh fd lz"><a rel="noopener follow" target="_blank" href="/@jamescat"><div class="ma ab dw"><div class="mb ab mc cl cj md"><h2 class="bd hi fi z dy me ea eb mf ed ef hg bi translated">詹姆斯·张-简介</h2><div class="mg l"><h3 class="bd b fi z dy me ea eb mf ed ef dx translated">面试是软件工程师招聘过程中有缺陷但必要的一部分。一直在给予和…</h3></div><div class="mh l"><p class="bd b fp z dy me ea eb mf ed ef dx translated">medium.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn ln lz"/></div></div></a></div></div></div>    
</body>
</html>