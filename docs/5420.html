<html>
<head>
<title>Using cloud-init to extend the Root Partition on a new Linux Instance on OCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用cloud-init在OCI上的新Linux实例上扩展根分区</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/automated-process-to-extend-the-root-partition-on-a-new-linux-instance-using-cloud-init-on-oci-21c75a8e552a?source=collection_archive---------0-----------------------#2018-03-24">https://medium.com/oracledevs/automated-process-to-extend-the-root-partition-on-a-new-linux-instance-using-cloud-init-on-oci-21c75a8e552a?source=collection_archive---------0-----------------------#2018-03-24</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/3ce36d979bb3d189d0e15c7c9797b073.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*y6etsOe4GfvkwD14KQDPHA.png"/></div></figure><p id="6ab0" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">自2018年3月开始，当您在Oracle云基础架构OCI上启动虚拟机或裸机实例时，您可以指定是否使用所选映像的默认启动卷大小(~46.6GB)，或者您可以指定高达16 TB的自定义大小。</p><p id="12e5" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">Oracle建议您使用分区工具<strong class="in hi"> growpart、gdisk、parted、</strong>或<strong class="in hi"> fdisk </strong>调整分区的大小。为了扩展文件系统，你必须使用像<strong class="in hi"> xfs_growfs </strong>或<strong class="in hi"> resize2fs </strong>这样的工具，这取决于你的映像的文件系统类型和选择的<strong class="in hi"> Linux发行版</strong>。</p><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es jk"><img src="../Images/af254f9491e6a4d078fce9eb2db83f99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*HjkbxQHAc3E3xKFaeCufXw.png"/></div></figure><p id="b3dd" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">在Oracle Linux &amp; CentOS上，您可以使用<code class="du jp jq jr js b">cloud-init-growpart</code>以及<code class="du jp jq jr js b">gdisk</code>和<code class="du jp jq jr js b">cloud-init</code>来完全自动化这个过程。<code class="du jp jq jr js b">libicu</code>是运行<code class="du jp jq jr js b">gdisk </code>所需的库，自动安装在OL7.x/CentOS 7.x上，在Release 6上需要单独安装。</p><p id="8b29" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">接下来，当您在OCI控制台(或通过API/SDK/Terraform)中启动一个新实例时，您将创建一个<a class="ae jj" href="http://cloudinit.readthedocs.io/en/latest/topics/format.html" rel="noopener ugc nofollow" target="_blank"> cloud-init userdata脚本</a> (shell脚本)，它将自动安装这些包并自动重启您的实例以更新根分区(GPT)。</p><figure class="jl jm jn jo fd ii er es paragraph-image"><div class="er es jt"><img src="../Images/c724794f0c07cdec10f1ebc013aed3ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1142/format:webp/1*PgTgwmd67mF09qtuzIb9mw.png"/></div></figure><p id="7441" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">为了说明这一点，在OCI上创建一个新实例，指定一个定制的引导卷大小，并将下面的代码片段复制并粘贴到选择<code class="du jp jq jr js b">PASTE CLOUD-INIT SCRIPT</code>时出现的框中。点击位于<code class="du jp jq jr js b">Add SSH KEY button</code>下方的显示高级选项链接后，此框可用:</p><figure class="jl jm jn jo fd ii er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es ju"><img src="../Images/e564db8e7e0d4f32d21cf518b0beb711.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kaqnscDQzhca0XF5VXgs1A.png"/></div></div><figcaption class="jz ka et er es kb kc bd b be z dx">Show Advanced Options link</figcaption></figure><pre class="jl jm jn jo fd kd js ke kf aw kg bi"><span id="8825" class="kh ki hh js b fi kj kk l kl km">#!/bin/sh</span><span id="e937" class="kh ki hh js b fi kn kk l kl km">sudo yum -y install cloud-utils-growpart</span><span id="3689" class="kh ki hh js b fi kn kk l kl km">sudo yum -y install gdisk</span><span id="e44e" class="kh ki hh js b fi kn kk l kl km">#Required for OL6.x/CentOS6.x<br/>sudo yum -y install libicu</span><span id="3b6f" class="kh ki hh js b fi kn kk l kl km">sudo reboot</span></pre><figure class="jl jm jn jo fd ii er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es ko"><img src="../Images/38056b398227c46e28a2fc2f3a33c1bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*scxP9mz8pefa_Qw2Tr1wKA.png"/></div></div><figcaption class="jz ka et er es kb kc bd b be z dx">Custom Boot Volume size along with Cloud-init script at Launch Instance page on OCI</figcaption></figure><p id="5dc7" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">现在，您可以启动实例并等待所有过程完成(根据所选计算机形状，可能需要2到5分钟)。完成后(重启后)，您可以验证您的根分区应该具有您为自定义启动卷指定的大小。</p><figure class="jl jm jn jo fd ii er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es kp"><img src="../Images/eb7b5185919d5a0a492e96cfed287f0e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nf2uqy-NQK8HBBOQTZ0PpA.png"/></div></div></figure></div></div>    
</body>
</html>