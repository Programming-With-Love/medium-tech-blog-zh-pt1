<html>
<head>
<title>Building a video player app in Android (Part 5 / 5)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Android中构建视频播放器应用程序(第5 / 5部分)</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/building-a-video-player-app-in-android-part-5-5-725c1ec2557a?source=collection_archive---------6-----------------------#2018-03-09">https://medium.com/androiddevelopers/building-a-video-player-app-in-android-part-5-5-725c1ec2557a?source=collection_archive---------6-----------------------#2018-03-09</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="1c97" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">使用ExoPlayer、播放列表、媒体会话、音频聚焦、画中画</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/2eed2a5c9bda533975efea4a4131b83e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UJISwRlkYE8nJzVJdudikw.png"/></div></div></figure><p id="afdb" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">本系列文章的目标是让您开始使用ExoPlayer构建一个简单但功能丰富的视频播放器应用程序(支持播放列表、媒体会话、音频焦点和画中画)。</p><p id="9d3c" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这是5部分系列的最后一部分，包括:</p><ul class=""><li id="db2f" class="ke kf hh jk b jl jm jo jp jr kg jv kh jz ki kd kj kk kl km bi translated"><a class="ae kn" rel="noopener" href="/@nazmul/building-a-video-player-app-in-android-part-1-5-d95770ef762d"> ExoPlayer简介</a></li><li id="cfa1" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated"><a class="ae kn" rel="noopener" href="/@nazmul/building-a-video-player-app-in-android-part-2-5-e5a5392879fa"> ExoPlayer播放列表、用户界面定制和事件</a></li><li id="ef2e" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated">【ExoPlayer的MediaSession连接器扩展</li><li id="c2a6" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated"><a class="ae kn" rel="noopener" href="/@nazmul/building-a-video-player-app-in-android-part-4-5-c69f12b49143">支持音频聚焦</a></li><li id="f7ef" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated">支持PIP ( <strong class="jk hi">本条</strong>)</li></ul><p id="fd8e" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">本系列的前一篇文章介绍了为您的应用程序添加音频焦点支持所需的步骤。本文将详细介绍如何为该应用程序添加画中画(PIP)支持。</p><h1 id="c57d" class="kt ku hh bd kv kw kx ky kz la lb lc ld in le io lf iq lg ir lh it li iu lj lk bi translated">点</h1><p id="3462" class="pw-post-body-paragraph ji jj hh jk b jl ll ii jn jo lm il jq jr ln jt ju jv lo jx jy jz lp kb kc kd ha bi translated">Android Oreo中引入了画中画(PIP ),它允许将一个活动最小化到一个小窗口中，该窗口位于其他活动之上。您可以设置此窗口的方向，使其浮动在屏幕上所有其他窗口的顶部。这里有一个例子。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es lq"><img src="../Images/c1d6d48119e238a6acfdc3f08880b1e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/1*GCFNlfdbf4A3CT8-w7ZQiw.gif"/></div></figure><p id="7f1a" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">为AndroidManifest.xml中的活动启用PIP模式非常容易。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="c678" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">注意——您还可以将另一个属性<code class="du lt lu lv lw b">android:resizeableActivity</code>设置为true，这将使该活动的大小可以针对<a class="ae kn" href="https://developer.android.com/guide/topics/ui/multi-window.html" rel="noopener ugc nofollow" target="_blank">多窗口模式</a>进行调整。</p><p id="e685" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">一旦你标记了你的活动支持画中画，然后你必须让它进入画中画模式的基础上，一些用户的行动。通常，当用户点击home按钮时，您可以通过覆盖<code class="du lt lu lv lw b"><a class="ae kn" href="https://developer.android.com/reference/android/app/Activity.html#onUserLeaveHint()" rel="noopener ugc nofollow" target="_blank">onUserLeaveHint()</a></code>方法来触发它。当用户点击home按钮时，它会将当前活动移到后台。这里有一个例子。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="1f09" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">请注意，当活动最小化时，我们将纵横比设置为16:9。你可以为这个最小化的窗口设置任何你想要的长宽比。</p><p id="6de8" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">一旦显示视频播放器的活动进入PIP模式，我们就会通过下面的方法得到通知。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="lr ls l"/></div></figure><p id="622a" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">当活动进入或退出画中画模式时，调用<code class="du lt lu lv lw b">onPictureInPictureChanged(…) </code>方法。在我们的例子中，我们覆盖了这个方法，并在活动最小化时隐藏播放器UI控件。<code class="du lt lu lv lw b">PlayerView</code>有一个<code class="du lt lu lv lw b">useController</code>字段，可以设置为false以隐藏这些控件。当活动最大化时，我们允许这些UI控件再次显示。</p><h1 id="307d" class="kt ku hh bd kv kw kx ky kz la lb lc ld in le io lf iq lg ir lh it li iu lj lk bi translated">音频焦点</h1><p id="6cea" class="pw-post-body-paragraph ji jj hh jk b jl ll ii jn jo lm il jq jr ln jt ju jv lo jx jy jz lp kb kc kd ha bi translated">从UX的角度来看，支持画中画使得与媒体会话的集成和支持音频聚焦变得有意义。</p><p id="7a07" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">当应用程序可以将自己最小化到一个小窗口中，并在其他应用程序运行时播放媒体时，音频焦点变得非常重要。</p><p id="41d2" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">考虑这种情况，用户启动视频播放器应用程序并开始播放视频。然后他们把它最小化成一个PIP窗口，然后启动YouTube。此时，用户可以看到YouTube和视频播放器应用程序。</p><ul class=""><li id="8e8a" class="ke kf hh jk b jl jm jo jp jr kg jv kh jz ki kd kj kk kl km bi translated">当您选择在YouTube应用程序中播放视频时，这应该会暂停示例应用程序中的播放。</li><li id="a119" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated">当您选择在示例应用程序中播放视频时，这应该会暂停YouTube中的播放。</li></ul><p id="95a4" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这正是在上一篇文章中使用AudioFocusWrapper类(为SimpleExoPlayer提供音频焦点支持)时发生的情况。</p><h1 id="e9b0" class="kt ku hh bd kv kw kx ky kz la lb lc ld in le io lf iq lg ir lh it li iu lj lk bi translated">媒体会话</h1><p id="f16f" class="pw-post-body-paragraph ji jj hh jk b jl ll ii jn jo lm il jq jr ln jt ju jv lo jx jy jz lp kb kc kd ha bi translated">因为应用程序使用的是MediaSession(我们在本系列的第三篇文章中添加了media session)，所以控制回放的UI是由系统自动提供的，无需编写任何代码！🙌这样，用户可以很容易地播放/暂停/跳过等。就在画中画窗口。</p><h1 id="3c82" class="kt ku hh bd kv kw kx ky kz la lb lc ld in le io lf iq lg ir lh it li iu lj lk bi translated">GitHub上的源代码</h1><p id="33e2" class="pw-post-body-paragraph ji jj hh jk b jl ll ii jn jo lm il jq jr ln jt ju jv lo jx jy jz lp kb kc kd ha bi translated">通过遵循这5篇文章，你应该能够创建一个视频播放器应用程序，类似于我们已经创建的这个示例(你也可以从Android Studio获得)。</p><div class="lx ly ez fb lz ma"><a href="https://github.com/googlesamples/android-VideoPlayer" rel="noopener  ugc nofollow" target="_blank"><div class="mb ab dw"><div class="mc ab md cl cj me"><h2 class="bd hi fi z dy mf ea eb mg ed ef hg bi translated">谷歌样品/安卓视频播放器</h2><div class="mh l"><h3 class="bd b fi z dy mf ea eb mg ed ef dx translated">在GitHub上创建一个帐户，为android视频播放器的开发做出贡献。</h3></div><div class="mi l"><p class="bd b fp z dy mf ea eb mg ed ef dx translated">github.com</p></div></div><div class="mj l"><div class="mk l ml mm mn mj mo jg ma"/></div></div></a></div><h1 id="306c" class="kt ku hh bd kv kw kx ky kz la lb lc ld in le io lf iq lg ir lh it li iu lj lk bi translated">进一步学习的资源</h1><p id="d56c" class="pw-post-body-paragraph ji jj hh jk b jl ll ii jn jo lm il jq jr ln jt ju jv lo jx jy jz lp kb kc kd ha bi translated"><strong class="jk hi"> ExoPlayer </strong></p><ul class=""><li id="7671" class="ke kf hh jk b jl jm jo jp jr kg jv kh jz ki kd kj kk kl km bi translated"><a class="ae kn" href="https://codelabs.developers.google.com/codelabs/exoplayer-intro/#0" rel="noopener ugc nofollow" target="_blank"> IO17 ExoPlayer codelab </a></li><li id="4498" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated"><a class="ae kn" href="https://www.youtube.com/watch?v=6VjF638VObA" rel="noopener ugc nofollow" target="_blank"> IO14 ExoPlayer介绍视频</a></li><li id="5905" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated"><a class="ae kn" href="https://www.youtube.com/watch?v=jAZn-J1I8Eg" rel="noopener ugc nofollow" target="_blank"> IO17 ExoPlayer会话视频</a></li><li id="fdb2" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated"><a class="ae kn" rel="noopener" href="/google-exoplayer/exoplayer-2-x-why-what-and-when-74fd9cb139">为什么选择ExoPlayer？</a></li><li id="e16a" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated"><a class="ae kn" rel="noopener" href="/google-exoplayer/exoplayer-2-6-1-whats-new-a9e54bffffc5">exo player v 2 . 6 . 1的最新变化</a></li></ul><p id="9c14" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><strong class="jk hi">媒体会话，音频焦点</strong></p><ul class=""><li id="0871" class="ke kf hh jk b jl jm jo jp jr kg jv kh jz ki kd kj kk kl km bi translated"><a class="ae kn" rel="noopener" href="/google-exoplayer/the-mediasession-extension-for-exoplayer-82b9619deb2d">exo player的MediaSession扩展</a></li><li id="af13" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated"><a class="ae kn" rel="noopener" href="/google-developers/understanding-mediasession-part-1-3-e4d2725f18e4">什么是媒体会话</a></li><li id="f69c" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated"><a class="ae kn" rel="noopener" href="/google-developers/audio-focus-1-6b32689e4380">什么是音频焦点</a></li></ul><p id="8671" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><strong class="jk hi">破折号，HLS </strong></p><ul class=""><li id="ebe0" class="ke kf hh jk b jl jm jo jp jr kg jv kh jz ki kd kj kk kl km bi translated"><a class="ae kn" href="https://goo.gl/r9fXXf" rel="noopener ugc nofollow" target="_blank">破折号，HLS </a></li><li id="8321" class="ke kf hh jk b jl ko jo kp jr kq jv kr jz ks kd kj kk kl km bi translated"><a class="ae kn" href="https://goo.gl/SNvMgQ" rel="noopener ugc nofollow" target="_blank"> Dash优于HLS等的优势</a></li></ul><p id="2650" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><strong class="jk hi">画中画</strong></p><ul class=""><li id="7098" class="ke kf hh jk b jl jm jo jp jr kg jv kh jz ki kd kj kk kl km bi translated"><a class="ae kn" rel="noopener" href="/google-developers/making-magic-moments-with-picture-in-picture-e02964bf75ae">奥利奥的画中画模式</a></li></ul></div></div>    
</body>
</html>