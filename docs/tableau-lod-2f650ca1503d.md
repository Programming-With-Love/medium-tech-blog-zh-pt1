# 了解 LOD 表达式如何在 Tableau 中工作

> 原文：<https://medium.com/edureka/tableau-lod-2f650ca1503d?source=collection_archive---------1----------------------->

![](img/75764426bd1807cf4c63591b15596d6c.png)

任何 BI 工具的目的都是为了给 ***数据分析*** 一个更好的流程。如果一个人，作为一个专业人士，在解决一个问题时面临使用工具的困难，流动的状态就被打破了。这个问题的一个常见原因是需要处理 Tableau (LOD) 中已经聚合到不同 ***细节级别的数据。***

在 Gartner 的魔力象限中，Tableau 连续第六次位居榜首，这无疑说明了它在市场中的需求。这可能是最好的时机。

本博客将帮助您理解 LOD 表达式并讨论以下主题:

*   为什么在 Tableau 中需要细节层次？
*   Tableau 中的细节层次是什么？
*   行级和视图级表达式
*   LOD 表达式的类型
*   聚合和 LOD 表达式
*   过滤器和 LOD 表达式
*   创建 LOD 表达式
*   支持 Tableau 中细节级别的数据源
*   表格计算与表格的详细程度
*   Tableau 中细节层次的限制

# 为什么需要 LOD？

在分析数据时，经常会遇到一些问题。这些问题通常问起来简单，但很难回答。它们通常听起来像这样:

![](img/771a0375b4de789b169deb7a3699b976.png)

为了解决这些类型的问题，Tableau 9.0 中引入了一种新的语法，称为细节层次的**。这种新的语法简化并扩展了 Tableau 的计算语言，使得直接解决这些问题成为可能。**

# **LOD 是什么？**

**![](img/362ce8a71fa0cf839f912eb8e7b2c154.png)**

***LOD 表达式代表了一种优雅而强大的方式来回答涉及单个可视化中多个粒度级别的问题。***

**Tableau 或 LOD 表达式中的细节级别允许您计算数据源级别和可视化级别的值。然而，LOD 表达式为您提供了对想要计算的粒度级别的更多控制。它们可以在一个*更细粒度的*级别(包括计算)、一个*更细粒度的*级别(不包括计算)或一个*完全独立的级别* l(固定计算)执行。**

# **行级和视图级表达式**

## **行级别**

**在 Tableau 中，为基础表中的每一行计算引用**未聚合的**数据源列的表达式。在这种情况下，表达式的维数是*行级别*。行级表达式的一个示例是:**

**`[Sales] / [Profit]`**

**该计算将在数据库的每一行中进行评估。每行中的销售值将除以该行中的利润值，产生一个新列，其中包含相乘的结果(利润率)。**

**如果使用此定义创建一个计算，用名称[ProfitRatio]保存它，然后将它从数据窗格拖到工具架上，Tableau 通常会聚合视图的计算字段:**

**`SUM[ProfitRatio]`**

## **视图级别**

**相比之下，引用**聚合**数据源列的表达式是在视图中由维度定义的维度上计算的。在这种情况下，表达式的维度是视图级别。视图级表达式的一个示例是:**

**`SUM(Sales) / SUM(Profit)`**

**如果您将该计算拖到一个架子上(或者作为特别计算直接在架子上键入)，Tableau 会将它包含在一个 **AGG 函数**中:**

**`AGG(SUM(Sales) / SUM(Profit))`**

**这就是所谓的**聚合计算**。**

# **聚合和 LOD 表达式**

## **LOD 表达式比视图详细程度粗糙**

**当表达式引用视图中尺寸的一个**子集时，它比视图具有更粗糙的细节级别。****

**例如，对于包含维[类别]和[段]的视图，您可以在 Tableau 中创建一个仅使用其中一个维的详细级别:**

**`{FIXED [Segment] : SUM([Sales])}`**

**在这种情况下，表达式的细节层次比视图粗糙。它的值基于一个维度([段])，而视图基于两个维度([段]和[类别])。**

**结果是在视图中使用细节层次表达式导致某些值被复制——也就是说，**出现多次**。**

## **细节层次表达比视图细节层次更精细**

**当表达式引用视图中尺寸的**超集时，它具有比视图更精细的细节层次。****

**当您在视图中使用这样的表达式时，Tableau 会将结果聚合到视图级别。例如，Tableau 中的以下详细级别引用了两个维度:**

**`{FIXED [Segment], [Category] : SUM([Sales])}`**

**当该表达式用在只有[Segment]作为其细节层次的视图中时，值*必须聚合*。如果将该表达式拖到架子上，您将看到以下内容:**

**`AVG([{FIXED [Segment]], [Category]] : SUM([Sales]])}])`**

**Tableau 会自动分配一个**聚合**(在本例中为平均值)。您可以根据需要更改聚合。**

## **将详细等级表达式添加到视图中**

**Tableau 表达式中的细节级别是在视图中聚合还是复制由**表达式类型**和**粒度**决定。**

*   **包含表达式将具有与视图相同的细节级别，或者比视图更精细的细节级别。因此，价值观永远不会被复制。**
*   **固定表达式可以具有比视图更精细的细节级别、更粗糙的细节级别或相同的细节级别。是否需要聚合固定细节级别的结果取决于视图中的维度。**
*   **排除表达式总是导致复制的值出现在视图中。当包含排除细节级别表达式的计算被搁置时，Tableau 默认使用 **ATTR 聚合**，而不是求和或 AVG，以表明表达式实际上没有被聚合，并且更改聚合不会对视图产生影响。**

**将详细等级表达式添加到视图中的工具架时，除非将其用作尺寸标注，否则它们总是自动包裹在集合中。**

# **过滤器和 LOD 表达式**

**![](img/ac414f4cc5273b3dd3e9f163e5561112.png)**

**此处的图像从上到下描述了过滤器的执行顺序。右侧的文本显示了 LOD 表达式在此序列中的求值位置。**

**提取过滤器(橙色)仅适用于从数据源创建 Tableau 提取。表格计算过滤器(深蓝色)在计算执行后应用，因此隐藏标记而不过滤出计算中使用的基础数据。**

**固定计算在维度筛选器之前应用，因此除非您提升筛选器架上的字段以提高上下文筛选器的视图性能，否则它们将被忽略。**

# **LOD 表达式的类型**

## **包括计算**

**除了视图中的维度之外，INCLUDE 还使用指定的维度计算值。当包含不在视图中的尺寸时，这种详细程度的表达式最有用。**

****例如:** `{ INCLUDE [Customer Name] : SUM([Sales]) }`**

**![](img/08aff36c48d2bad8dfdf7728dd73cc38.png)**

## **排除计算**

**排除从表达式中显式删除尺寸，也就是说，从视图详细程度中减去尺寸。Tableau 中的这种细节级别对于消除视图中的尺寸非常有用。**

****例如:** `{EXCLUDE [Region]: SUM([Sales])}`**

**![](img/103354a996f11dc09eda6d1b5946e4c5.png)**

## **固定计算**

**固定使用指定的尺寸计算值，而不参考视图的详细程度，即不参考视图中的任何其他尺寸。此详细程度表达式还会忽略视图中除上下文过滤器、数据源过滤器和提取过滤器之外的所有过滤器。**

****例如:****

**![](img/621cdd00b365a247758aabd20cd79fd6.png)**

# **创建 LOD 表达式**

## **LOD 表达式的语法**

**详细等级表达式具有以下结构:**

**`{[FIXED | INCLUDE | EXCLUDE]<dimension declaration> : <aggregate expressions>}`**

*****第一步:设置可视化*****

1.  **打开 Tableau Desktop 并连接到 **Sample-Superstore** 保存的数据源。**
2.  **导航到新工作表。**
3.  **从**数据**窗格的维度下，将区域拖动到列架上。**
4.  **从**数据**窗格的“度量”下，将“销售额”拖到“行”架上。将出现一个条形图，显示每个地区的销售总额。**

**![](img/45bb27af2a043d68a806a2e96ab07217.png)**

*****第二步:创建 LOD 表达式*****

**您可能还想查看每个地区每个客户的平均销售额，而不是每个地区所有销售额的总和。您可以使用 LOD 表达式来做到这一点。**

1.  **选择分析>创建计算字段。**
2.  **在打开的计算编辑器中，执行以下操作:**

*   **命名计算，每个客户的销售额。**
*   **输入以下 LOD 表达式:**

**`{INCLUDE [Customer Name] : SUM([SALES]) }`**

**![](img/06753ad07c915f85c5dbc9636bb02862.png)**

**3.完成后，单击确定。新创建的 LOD 表达式将添加到“数据”窗格中的“测量”下。**

*****第三步:在可视化中使用 LOD 表达式*****

1.  **从**数据**窗格中的“度量”下，将“每位客户的销售额”拖到“行”架上，并将其放在 SUM(Sales)的左侧。**
2.  **在行架上，右键单击每个客户的销售额，然后选择度量(总和) >平均值。现在，您可以看到每个地区所有销售额的总和以及每个客户的平均销售额。例如，您可以看到，在中部地区，销售总额约为 **500，000 美元**，每位客户的平均销售额约为 **800 美元**。**

**![](img/08aff36c48d2bad8dfdf7728dd73cc38.png)**

# **支持 LOD 表达式的数据源**

**![](img/0e91960f14e4d983d9b445254385a8bf.png)**

# **表格计算与 LOD**

**LOD 表达式不是表格计算的新形式。虽然它们可以取代许多表格计算，但它们的主要目的是开辟新的可能性。LOD 表达式和表格计算的操作方式不同。**

**![](img/a22757a95b2829dfe63281ac8abb9e0c.png)**

# **LOD 的局限性**

**以下是适用于 LOD 表达式的约束。**

*   **引用浮点度量值的 LOD 表达式在需要比较表达式中的值的视图中使用时，往往表现得不可靠。**
*   **LOD 不会显示在数据源页面上。**
*   **在维度声明中引用参数时，请始终使用参数名，而不是参数值。**
*   **使用数据混合时，主数据源中的链接字段必须位于视图中，然后才能使用辅助数据源中的详细程度表达式。**

**此外，一些数据源有复杂性限制。Tableau 不会禁用这些数据库的计算，但是如果计算变得太复杂，就有可能出现查询错误。至此，我们结束了这篇关于 Tableau 中 LOD 的文章。**

**如果你想查看更多关于人工智能、DevOps、道德黑客等市场最热门技术的文章，你可以参考 Edureka 的官方网站。**

**请留意这个系列中的其他文章和视频，它们会帮助你理解 Tableau 的各种概念。**

> **1. [Tableau 教程](/edureka/tableau-tutorial-37d2d6a9684b)**
> 
> **2.[什么是画面？](/edureka/what-is-tableau-1d9f4c641601)**
> 
> **3. [Tableau 函数](/edureka/tableau-functions-ce794b10e588)**
> 
> **4. [Tableau 仪表盘](/edureka/tableau-dashboards-3e19dd713bc7)**
> 
> **5.[表格图表](/edureka/tableau-charts-111758e2ea97)**
> 
> **6. [Tableau 提示和技巧](/edureka/tableau-tips-and-tricks-a18bf8991afc)**
> 
> **7.[循序渐进指导学习 Tableau 公共](/edureka/tableau-public-942228327953)**
> 
> **8. [Tableau 桌面 vs Tableau 公共 vs Tableau 阅读器](/edureka/tableau-desktop-vs-tableau-public-vs-tableau-reader-fbb2a3aa0bac)**
> 
> **9.[如何在 Tableau 中创建和使用参数？](/edureka/parameters-in-tableau-ac552e6b0cde-ac552e6b0cde)**
> 
> **10.Tableau 中的布景是什么，如何创建它们**
> 
> **11.[数据混合](/edureka/tableau-lod-2f650ca1503d)**
> 
> **12 .[Tableau 中的圆环图](/edureka/donut-chart-in-tableau-a2e6fadf6534)**
> 
> **13.[2020 年你必须准备的 50 大 Tableau 面试问题](/edureka/tableau-interview-questions-and-answers-4f80523527d)**
> 
> **14.[如何以及何时使用不同的 Tableau 图表](/edureka/tableau-charts-111758e2ea97)**

***原载于 2019 年 2 月 20 日 https://www.edureka.co*[](https://www.edureka.co/blog/tableau-lod/)**。****