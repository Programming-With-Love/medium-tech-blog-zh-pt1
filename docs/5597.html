<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://medium.com/oracledevs/building-oci-custom-images-with-packer-7e12b10077ad?source=collection_archive---------0-----------------------#2019-04-13">https://medium.com/oracledevs/building-oci-custom-images-with-packer-7e12b10077ad?source=collection_archive---------0-----------------------#2019-04-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/350b4cd9055ed155b1dc211729949d07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dGjyd72fiUPjdNAl3Gz50w.png"/></div></div></figure><p id="8e76" class="pw-post-body-paragraph hq hr hs ht b hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ha bi translated"><strong class="ht ip">使用打包程序构建OCI自定义图像</strong></p><p id="6446" class="pw-post-body-paragraph hq hr hs ht b hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ha bi translated">2019年4月</p><p id="dc80" class="pw-post-body-paragraph hq hr hs ht b hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ha bi translated">在云中构建和部署应用程序既省时又简单，但是要获得所提供的全部价值，就需要找到解决特定问题的最佳工具。近两年前，我从Hashicorp的Packer和Terraform找到了工具，它们很容易拿起，并且具有很高的实用水平。“基础设施即代码”和“声明式构建”的概念在酷和简单两方面吸引了我。</p><p id="f8cf" class="pw-post-body-paragraph hq hr hs ht b hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ha bi translated">Terraform是另一篇文章和研讨会(<a class="ae iq" href="http://go.oracle.com/packer-oci" rel="noopener ugc nofollow" target="_blank">这里有一个实践研讨会，可以指导您构建打包映像</a>)，但简而言之:Terraform可以构建网络，并在云中建立/保持映像和服务。Packer是帮助您构建这些图像的工具。</p><p id="c18e" class="pw-post-body-paragraph hq hr hs ht b hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ha bi translated">Packer让你定义图像为代码，简单的JSON。</p><p id="f5b5" class="pw-post-body-paragraph hq hr hs ht b hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ha bi translated">从这个简单的JSON开始，您可以在各种环境(云、Virtualbox、VMWare、KVM)中构建定制的映像，这些映像将包含JSON中定义的相同配置。这可能是添加包、用户和数据。它可能是配置一个桌面或者为邮件子系统、mySQL数据库或者wordpress主机添加一个服务。</p><p id="f0c3" class="pw-post-body-paragraph hq hr hs ht b hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ha bi translated"><strong class="ht ip">烘焙vs油炸</strong></p><p id="03aa" class="pw-post-body-paragraph hq hr hs ht b hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ha bi translated">当我们不在做饭的时候，构建图像类似于烹饪一道菜。硬件、成分和技术都很灵活，可以适应各种方法。在为云构建映像时，大多数时候，自动化/编排映像的构建是有意义的。该构建过程通常看起来像这样:</p><figure class="is it iu iv fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ir"><img src="../Images/db653d7ea27c029514e24fc4b9edeeba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pjFAS_8z1UDlqURFtuTvnQ.png"/></div></div></figure><p id="13e0" class="pw-post-body-paragraph hq hr hs ht b hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ha bi translated">启动实例的ISO映像(base OL、Ubuntu、CentOS或red hat ISO)→定制脚本(Ansible、Chef、cloud-init) →运行定制实例</p><p id="11f5" class="pw-post-body-paragraph hq hr hs ht b hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ha bi translated">上面的流程是看起来最像油炸的模型。从一个锅开始(基本图像)添加你的配料，用脚本定制(可能包括:Chef、Ansible或脚本yum安装/更新),你的产品就是晚餐。对于每个相似的映像，它将下载相同的组件，运行相同的脚本，并创建一个新的自定义实例——花费制作第一个所需的所有时间。如果片段很小(只是包安装和一些配置文件)，这是可以接受的，但是如果您的最终状态很复杂、很大(占用空间)或者软件安装需求增长到几千兆字节，这在时间和带宽方面的成本就要高得多。</p><p id="cf5b" class="pw-post-body-paragraph hq hr hs ht b hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ha bi translated">一个客户使用Linux rsync实用程序复制了超过20GBs的数据来支持他们的应用服务器。同时启动5个这样的服务器将使用超过100GBs的网络流量，从它们的rsync服务器到新产生的实例。</p><figure class="is it iu iv fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es iw"><img src="../Images/24b1c35f2a202cf33d350358b0d2841f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z0QJWGa1XvbVKMbfcpIy3A.png"/></div></div></figure><p id="0181" class="pw-post-body-paragraph hq hr hs ht b hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ha bi translated">与此相反的模式是构建一个定制映像，从这个映像开始，加载所有需要的东西(例如通过rsync复制20GB ),然后启动这个定制映像的5个副本(实例)。这种差别很细微，但在设置时间和总体部署速度方面很重要。</p><p id="d389" class="pw-post-body-paragraph hq hr hs ht b hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ha bi translated">这里的想法是预先“烘焙”和映像，以便在需要时使用。这可能不是两者之间的黑白对比，因为您可能希望“烘焙”安装了最大、运行时间最长的组件的映像，但在引导预烘焙的映像后进行较小的定制。使用常识和最佳方法取决于读者。</p><figure class="is it iu iv fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ix"><img src="../Images/68baeb7ab5cfc9da13d6d4d4521e0658.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5RFNm_zrblQXhue75x1Gbg.png"/></div></div></figure><p id="552c" class="pw-post-body-paragraph hq hr hs ht b hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ha bi translated">打包机是烘焙的好工具。它可以在您的厨房(内部数据中心或笔记本电脑)以及Oracle、AWS和Google的云厨房中为您提供帮助。</p><p id="966c" class="pw-post-body-paragraph hq hr hs ht b hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ha bi translated"><strong class="ht ip">打包机</strong></p><p id="1609" class="pw-post-body-paragraph hq hr hs ht b hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ha bi translated">Packer可以在您的笔记本电脑、服务器或任何您可以访问的云基础架构服务器上运行。它可以快速安装https://www.packer.io/intro/getting-started/install.html的T2，并且占用很少的资源。构建你的第一个映像可以在大约15分钟内完成(参见<a class="ae iq" href="http://go.oracle.com/packer-oci" rel="noopener ugc nofollow" target="_blank">使用打包器</a>构建OCI映像)获得一个试用账户和一些基本映像构建的说明。</p><p id="a221" class="pw-post-body-paragraph hq hr hs ht b hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ha bi translated">Hashicorp的Packer使用包含几个部分的模板方法自动构建机器映像，它需要一个构建器和一个供应器。</p><p id="93c7" class="pw-post-body-paragraph hq hr hs ht b hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ha bi translated">通过更改“构建器”，您可以选择想要放置最终资产(映像/虚拟机)的位置</p><p id="aecc" class="pw-post-body-paragraph hq hr hs ht b hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ha bi translated">您定义您的“构建者”:</p><ul class=""><li id="af64" class="iy iz hs ht b hu hv hy hz ic ja ig jb ik jc io jd je jf jg bi translated">您希望它在哪里构建和部署(Virtualbox、AWS、OCI等)。)</li><li id="dd0d" class="iy iz hs ht b hu jh hy ji ic jj ig jk ik jl io jd je jf jg bi translated">你想建立什么样的形象(RedHat，CentOS，任何你能达到的)</li><li id="ca0d" class="iy iz hs ht b hu jh hy ji ic jj ig jk ik jl io jd je jf jg bi translated">您的云细节(可用性、数据中心、凭据信息)</li></ul><p id="7ecc" class="pw-post-body-paragraph hq hr hs ht b hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ha bi translated">接下来，您定义一个“置备程序”，这是自定义环境的本质，它可以包括:</p><ul class=""><li id="72b3" class="iy iz hs ht b hu hv hy hz ic ja ig jb ik jc io jd je jf jg bi translated">文件—您想要包含的文件</li><li id="3bec" class="iy iz hs ht b hu jh hy ji ic jj ig jk ik jl io jd je jf jg bi translated">shell —在正在构建的服务器上交互运行的脚本</li><li id="71fe" class="iy iz hs ht b hu jh hy ji ic jj ig jk ik jl io jd je jf jg bi translated">shell-local —在运行打包程序的服务器上交互运行的脚本</li><li id="5575" class="iy iz hs ht b hu jh hy ji ic jj ig jk ik jl io jd je jf jg bi translated">其他编排供应器— ansible、chef、powershell (windows)、puppet、salt。</li></ul><p id="6147" class="pw-post-body-paragraph hq hr hs ht b hu hv hw hx hy hz ia ib ic id ie if ig ih ii ij ik il im in io ha bi translated">虽然原生容器开发越来越受欢迎，但在可预见的未来，仍然需要虚拟机。无论是在云中还是在数据中心中，使用自动化使这些虚拟机映像更易于构建和维护是让它们轻松融入我们的标准开发运维实践的关键。学习打包机增加了又一个工具的工具箱。</p><h1 id="97a6" class="jm jn hs bd jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj bi translated">立即开始您的免费试用和指导教程！</h1><ol class=""><li id="15f7" class="iy iz hs ht b hu kk hy kl ic km ig kn ik ko io kp je jf jg bi translated"><a class="ae iq" href="https://myservices.us.oraclecloud.com/mycloud/signup?language=en&amp;sourceType=:ex:tb:::RC_NAMK190212P00041:PackerOCI_HOL&amp;SC=:ex:tb:::RC_NAMK190212P00041:PackerOCI_HOL&amp;pcode=NAMK190212P00041" rel="noopener ugc nofollow" target="_blank">请求云试用</a></li><li id="1ea0" class="iy iz hs ht b hu jh hy ji ic jj ig jk ik jl io kp je jf jg bi translated">访问http://go.oracle.com/packer-oci<a class="ae iq" href="http://go.oracle.com/packer-oci" rel="noopener ugc nofollow" target="_blank">的实验室指南</a></li><li id="cc4a" class="iy iz hs ht b hu jh hy ji ic jj ig jk ik jl io kp je jf jg bi translated">如果您需要技术帮助或希望我们的云解决方案中心的工程师指导您完成研讨会，您可以向http://go.oracle.com/cloudcoach<a class="ae iq" href="http://go.oracle.com/cloudcoach" rel="noopener ugc nofollow" target="_blank">的</a>请求云蔻驰。</li></ol></div></div>    
</body>
</html>