<html>
<head>
<title>How to automate dependency management in Mendix using Maven</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Maven在Mendix中自动化依赖管理</h1>
<blockquote>原文：<a href="https://medium.com/mendix/how-to-automate-dependency-management-in-mendix-using-maven-6af490512f79?source=collection_archive---------0-----------------------#2020-02-03">https://medium.com/mendix/how-to-automate-dependency-management-in-mendix-using-maven-6af490512f79?source=collection_archive---------0-----------------------#2020-02-03</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><div class=""/><figure class="fi fk is it iu iv fe ff paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="fe ff ir"><img src="../Images/c7d20a5a01f0d40995f700d4d6e39127.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TX94O2s3h2QyW0wio3nqCw.png"/></div></div></figure><p id="0d13" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">几周前，我决定发布一个新的应用商店模块，AmazonSQSConnector。GitHub repo 在一年多前就已经创建好了，但是我从来没有花时间去准备发布的模块。我打开项目，创建了一个“待办事项”列表。最重要的任务是更新AWS (Amazon Web Services)依赖项。每次当我不得不更新App Store模块中的依赖项时，搜索正确的依赖项并将其包含在模块包中是很麻烦的。在这篇博客中，我将向您展示我如何使用Apache Maven自动化Mendix模块的依赖管理。</p><p id="deea" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">我过去做的是下载所有(可传递的)依赖项，并将它们添加到Mendix项目的<code class="eh ka kb kc kd b">/userlib</code>文件夹中。我们来考察一下能否用Maven编译代码，收集依赖关系，导出模块包。我认识的几个人在他们的Mendix应用商店模块中使用Gradle，但我发现自己更熟悉Maven。</p><h1 id="2810" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">创建POM</h1><p id="6a53" class="pw-post-body-paragraph jc jd hu bd b je lc jg jh ji ld jk jl jm le jo jp jq lf js jt ju lg jw jx jy hn dt translated">第一步是启动一个Maven项目，在根目录中包含一个空的<code class="eh ka kb kc kd b">POM.xml</code>(项目对象模型)文件。在Maven可以编译代码之前，Mendix Java API库被添加到依赖列表中。</p><figure class="lh li lj lk fq iv"><div class="bz el l di"><div class="ll lm l"/></div></figure><p id="0343" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">我使用了几个属性来确保配置可以很容易地更改为新的Mendix版本。可以在POM中硬编码默认值，但是也可以在命令行或Eclipse Maven插件中传递属性值。</p><figure class="lh li lj lk fq iv"><div class="bz el l di"><div class="ll lm l"/></div></figure><h1 id="f75a" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">指定目录结构</h1><p id="fc69" class="pw-post-body-paragraph jc jd hu bd b je lc jg jh ji ld jk jl jm le jo jp jq lf js jt ju lg jw jx jy hn dt translated">之后，我查看了Mendix项目的文件夹结构，它不同于默认的Maven Java项目。源文件位于<code class="eh ka kb kc kd b">/javasource</code>文件夹，编译后的源代码位于<code class="eh ka kb kc kd b">/deployment/run/bin</code>文件夹。</p><figure class="lh li lj lk fq iv"><div class="bz el l di"><div class="ll lm l"/></div></figure><h1 id="83c3" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">清理项目文件夹</h1><p id="ae1b" class="pw-post-body-paragraph jc jd hu bd b je lc jg jh ji ld jk jl jm le jo jp jq lf js jt ju lg jw jx jy hn dt translated">每当执行构建时，我都希望清理项目文件夹。Apache Maven提供了清理输出和目标目录的插件。我想将<code class="eh ka kb kc kd b">/userlib</code>文件夹添加到配置中，以确保每次执行构建时都会重新创建该文件夹。</p><figure class="lh li lj lk fq iv"><div class="bz el l di"><div class="ll lm l"/></div></figure><h1 id="6c35" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">复制依赖关系</h1><p id="0a53" class="pw-post-body-paragraph jc jd hu bd b je lc jg jh ji ld jk jl jm le jo jp jq lf js jt ju lg jw jx jy hn dt translated">最初，我们的目标是管理Mendix的依赖关系。我现在必须将依赖项复制到<code class="eh ka kb kc kd b">/userlib</code>文件夹中，这可以使用复制依赖项插件来完成。我必须确保Mendix依赖项没有被复制，因为它们是由运行时启动器自动添加到类路径中的。复制依赖项任务被绑定到包阶段。</p><figure class="lh li lj lk fq iv"><div class="bz el l di"><div class="ll lm l"/></div></figure><h1 id="15a9" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">导出模块包</h1><p id="d05d" class="pw-post-body-paragraph jc jd hu bd b je lc jg jh ji ld jk jl jm le jo jp jq lf js jt ju lg jw jx jy hn dt translated">此时，应用程序正在正确编译和运行。使用正确的依赖项自动创建模块包会很好。Mendix附带了mxutil.exe命令行工具，它提供了导出模块包的可能性。<code class="eh ka kb kc kd b">--filter-required-libs</code>标志给出了包含具有相应。需要一个Lib文件。我不得不寻找一种使用Maven创建文件和执行命令的方法。Apache Ant结合Ant-Contrib库提供了我正在寻找的特性。我必须将Ant-Contrib添加到POM文件的依赖列表中。</p><figure class="lh li lj lk fq iv"><div class="bz el l di"><div class="ll lm l"/></div></figure><p id="c1aa" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">Apache Ant使用XML文件来执行任务。我创建了一个<code class="eh ka kb kc kd b">build.xml</code>文件，可以在其中指定任务。构建文件可以访问Maven公开的变量，例如<code class="eh ka kb kc kd b">${basedir}</code>。在开始之前，我必须定义Ant-Contrib任务。</p><figure class="lh li lj lk fq iv"><div class="bz el l di"><div class="ll lm l"/></div></figure><p id="9939" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated"><code class="eh ka kb kc kd b">build.xml</code>文件的第一部分遍历<code class="eh ka kb kc kd b">/userlib</code>文件夹中的<code class="eh ka kb kc kd b">*.jar</code>文件(不包括Ant依赖项)并创建<code class="eh ka kb kc kd b">.RequiredLib</code>文件。</p><figure class="lh li lj lk fq iv"><div class="bz el l di"><div class="ll lm l"/></div></figure><p id="a643" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">对于<code class="eh ka kb kc kd b">/userlib</code>文件夹中的每个文件，执行<code class="eh ka kb kc kd b">touchRequiredLibFile</code>目标。</p><p id="a535" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">文件的第二部分执行<code class="eh ka kb kc kd b">mxutil.exe</code>并将MPK文件复制到发布目录，包括它的版本号。</p><figure class="lh li lj lk fq iv"><div class="bz el l di"><div class="ll lm l"/></div></figure><p id="041e" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated"><code class="eh ka kb kc kd b">build.xml</code>文件已准备好执行。我必须使用antrun-plugin指定目标名称(<code class="eh ka kb kc kd b">createRequiredLibs</code>和<code class="eh ka kb kc kd b">exportModulePackage</code>)，按照正确的顺序执行POM文件中的任务。执行被绑定到安装阶段。</p><figure class="lh li lj lk fq iv"><div class="bz el l di"><div class="ll lm l"/></div></figure><h1 id="ea94" class="ke kf hu bd kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dt translated">快跑！</h1><p id="6ecc" class="pw-post-body-paragraph jc jd hu bd b je lc jg jh ji ld jk jl jm le jo jp jq lf js jt ju lg jw jx jy hn dt translated">现在我可以使用下面的Maven命令编译代码并复制依赖项。当然，Maven应该被安装并添加到您的路径中。</p><pre class="lh li lj lk fq ln kd lo lp aw lq dt"><span id="7a5f" class="lr kf hu kd b fv ls lt l lu lv">mvn clean package</span></pre><p id="bd83" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">为了创建模块包，我必须在命令中添加安装阶段。</p><pre class="lh li lj lk fq ln kd lo lp aw lq dt"><span id="76b9" class="lr kf hu kd b fv ls lt l lu lv">mvn clean install</span></pre><p id="34a0" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">这次旅程之后，Mendix模块的构建过程完全自动化了(除了发布到App Store，特性请求！)，这将使我能够更容易地发布更新，并清楚地标记依赖关系。我希望鼓励更多的Mendix开发者使用这种(或其他)依赖管理解决方案发布高质量的应用商店模块。如果你有任何问题，请联系我！</p><p id="e763" class="pw-post-body-paragraph jc jd hu bd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy hn dt translated">自己试试，克隆下面的GitHub repo。</p><div class="lw lx fm fo ly lz"><a href="https://github.com/WebFlight/AmazonSQSConnector.git" rel="noopener  ugc nofollow" target="_blank"><div class="ma ab ej"><div class="mb ab mc cl cj md"><h2 class="bd hv fv z el me eo ep mf er et ht dt translated">WebFlight/AmazonSQSConnector</h2><div class="mg l"><h3 class="bd b fv z el me eo ep mf er et ek translated">欢迎使用Mendix AmazonSQSConnector模块。该模块可用于Mendix应用程序连接亚马逊简单…</h3></div><div class="mh l"><p class="bd b gc z el me eo ep mf er et ek translated">github.com</p></div></div><div class="mi l"><div class="mj l mk ml mm mi mn ja lz"/></div></div></a></div></div></div>    
</body>
</html>