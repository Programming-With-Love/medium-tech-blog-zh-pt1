<html>
<head>
<title>Making Oracle Database persistent with Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Docker使Oracle数据库持久化</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/making-oracle-database-persistent-with-docker-bb186a08e965?source=collection_archive---------0-----------------------#2017-08-22">https://medium.com/oracledevs/making-oracle-database-persistent-with-docker-bb186a08e965?source=collection_archive---------0-----------------------#2017-08-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="dbf5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以你已经从GitHub 构建了最新的<a class="ae jc" href="https://github.com/oracle/docker-images/tree/master/OracleDatabase" rel="noopener ugc nofollow" target="_blank"> Oracle数据库EE v12.2.0.1。现在，您希望将其部署在Oracle Container Cloud Service(OCCS)中。</a></p><p id="4261" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">除了创建服务YAML之外，如果希望Oracle DB容器在Worker节点卷上拥有持久数据，还需要执行一些额外的步骤:/opt/oracle/oradata</p><p id="c0e6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jd">注意——也许有其他方法可以达到同样的目的，下面只是一个例子。</em></p><p id="86c5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们回顾一下这个示例的步骤，包括在Worker节点中设置一个用户，以便Docker容器中的Oracle DB可以写入本地卷。如果您不采取这些步骤，那么如果您的容器有一个volume参数，它就不能成功运行。这是因为数据库容器中的默认用户“oracle”没有足够的权限写入本地主机卷，出于安全原因，您需要启用它。</p><p id="444a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这种情况并非OCCS独有。如果您只是在任何Docker主机上通过命令行运行映像，情况也是如此。</p><p id="1a59" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是怎么做的。</p><p id="f956" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建服务YAML。利用GitHub 中的<a class="ae jc" href="https://github.com/oracle/docker-images/tree/master/OracleDatabase#running-oracle-database-in-a-docker-container" rel="noopener ugc nofollow" target="_blank">设置您的服务。在第一次迭代中，还不包括体积参数。</a></p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/702247ed28b156c0c56be48dda8e33b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PH4cnUX-YnUjMwpjBcrOHw.jpeg"/></div></div></figure><p id="f4e7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">部署新服务。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/c9de7035a294a6cf6ca120a290818204.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BcgAFIjhjvry80Zb-h3VIQ.jpeg"/></div></div></figure><p id="47c2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦容器开始运行，您将需要使用Docker exec命令来查找用户“<em class="jd"> oracle </em>”的用户id。</p><p id="df3d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为此，首先，SSH进入运行数据库容器的Worker节点。您可以在Hosts页面上找到Worker节点的公共IP。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/69a8151d9e7ceda767fe14b69d3cc974.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JAI9HeM5Vk8uf0eUHa6qpQ.jpeg"/></div></div></figure><p id="f5b2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">SSH进入Worker节点，运行以下命令进入容器以获取用户id:</p><pre class="jf jg jh ji fd jq jr js jt aw ju bi"><span id="7a9b" class="jv jw hh jr b fi jx jy l jz ka">$ ssh opc@&lt;host ip address&gt; -i path_to/privateKey</span></pre><p id="3716" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在工作节点上以root用户身份运行:</p><pre class="jf jg jh ji fd jq jr js jt aw ju bi"><span id="33ef" class="jv jw hh jr b fi jx jy l jz ka">$ sudo -s</span></pre><p id="7721" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">找到容器ID并执行到其中:</p><pre class="jf jg jh ji fd jq jr js jt aw ju bi"><span id="00cb" class="jv jw hh jr b fi jx jy l jz ka"># docker ps<br/># docker exec -i -t &lt;imageID&gt; /bin/bash<br/>$ id</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kb"><img src="../Images/0c513de7c743059398386710386274b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HNFsaAXzarz3VPodVqcrqw.jpeg"/></div></div></figure><p id="30a1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这个例子中，用户id是54321，这是相当典型的。</p><p id="0768" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，退出容器，在Worker节点上创建一个名为“oracledb”的新用户，使用相同的用户id，并授予该用户对<em class="jd"> /opt/oracle </em>的权限。</p><p id="8c6a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jd">注意—用户“oracle”已经存在于Worker节点上，但是与容器中的用户“oracle”使用不同的用户id。因此，您只需要使用与容器用户相同的用户id，创建一个具有任何唯一名称的新用户。</em></p><pre class="jf jg jh ji fd jq jr js jt aw ju bi"><span id="449e" class="jv jw hh jr b fi jx jy l jz ka">$ exit<br/># useradd -u &lt;userID&gt; oracledb<br/># chown -R oracledb /opt/oracle</span></pre><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es kb"><img src="../Images/a7785f4736cc0a4f28e972bc0efd94e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3C8oReyalbwlsCUpVEfD2g.jpeg"/></div></div></figure><p id="3cc1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，停止并删除部署。编辑数据库服务以添加回卷参数:</p><p id="7787" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">卷:<br/>-'/opt/Oracle/oradata:/opt/Oracle/oradata:rw '</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/85dbada6ae33f7a4a8b716ca7f9012bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yLVI3Ti8Q3qFvOacw88mRA.jpeg"/></div></div></figure><p id="0944" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">保存服务并再次部署。几分钟后(取决于您的Worker节点有多少OCPU ), DB容器就完全设置好了，并将持久化它的数据。要查看数据库设置的进度，只需使用容器页面上的查看日志按钮，直到看到数据库可以使用的消息。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="jk jl di jm bf jn"><div class="er es je"><img src="../Images/bd98165c8746a6490100f635e8f2a705.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vEx0_i0ed6g0luDBN7xePw.jpeg"/></div></div></figure></div></div>    
</body>
</html>