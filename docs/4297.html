<html>
<head>
<title>Modern Security in Android (part 3)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android中的现代安全性(第三部分)</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/modern-security-in-android-part-3-bea8cc6f984f?source=collection_archive---------3-----------------------#2020-05-24">https://medium.com/google-developer-experts/modern-security-in-android-part-3-bea8cc6f984f?source=collection_archive---------3-----------------------#2020-05-24</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="17e7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">安全快速指南</p><p id="892d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这篇文章与我最近一次关于<strong class="ig hi">“Android开发者的现代安全”</strong>的演讲有关。</p><p id="8c44" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以下是这个系列的博客列表:</p><ul class=""><li id="4101" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated"><a class="ae jl" rel="noopener" href="/knowing-android/modern-security-in-android-part-1-6282bcb71e6c">第1部分—加密第1卷</a></li><li id="027a" class="jc jd hh ig b ih jm il jn ip jo it jp ix jq jb jh ji jj jk bi translated"><a class="ae jl" rel="noopener" href="/knowing-android/modern-security-in-android-part-2-743cd7c0941a">第2部分—加密第2卷</a></li><li id="b534" class="jc jd hh ig b ih jm il jn ip jo it jp ix jq jb jh ji jj jk bi translated"><a class="ae jl" rel="noopener" href="/knowing-android/modern-security-in-android-part-3-bea8cc6f984f"> <strong class="ig hi">第三部分—加密第三卷</strong> </a></li><li id="f4a1" class="jc jd hh ig b ih jm il jn ip jo it jp ix jq jb jh ji jj jk bi translated"><a class="ae jl" rel="noopener" href="/@dinorahto/modern-security-in-android-part-4-495655c7d4fe">第4部分—生物识别作为本地认证</a></li><li id="cb43" class="jc jd hh ig b ih jm il jn ip jo it jp ix jq jb jh ji jj jk bi translated"><a class="ae jl" rel="noopener" href="/knowing-android/modern-security-in-android-part-5-a814a9ab7a1f">第5部分—本地代码模块</a></li><li id="0749" class="jc jd hh ig b ih jm il jn ip jo it jp ix jq jb jh ji jj jk bi translated"><a class="ae jl" href="https://ddinorahtovar.medium.com/modern-security-in-android-part-6-8b17b7a85cce" rel="noopener">第6部分— SSL、TLS、安全数据层</a></li></ul><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="jx jy di jz bf ka"><div class="er es jr"><img src="../Images/bc68986e8c9e8fd982564cecda8ce41b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U_9XlSbr9euHKiWu95UJTw.jpeg"/></div></div><figcaption class="kd ke et er es kf kg bd b be z dx"><strong class="bd kh">Modern Security for Android Developers</strong></figcaption></figure><p id="5f01" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在上一篇文章中，我们讨论了Jetpack安全性以及它如何处理密钥管理。</p><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="ki kj l"/></div></figure><p id="bad9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦你创建了万能钥匙，下一步就是使用它。在Jetpack Security中，您可以加密文件或共享的首选项。</p><h2 id="3cde" class="kk kl hh bd kh km kn ko kp kq kr ks kt ip ku kv kw it kx ky kz ix la lb lc ld bi translated">共享首选项</h2><p id="c608" class="pw-post-body-paragraph ie if hh ig b ih le ij ik il lf in io ip lg ir is it lh iv iw ix li iz ja jb ha bi translated">共享偏好设置是在Android中保存数据的最原始的方式，你可以存储键和值，这些数据以XML文件的形式存储在应用内部目录中，用户无法访问。根据建议，开发人员应该使用标志:<code class="du lj lk ll lm b"><a class="ae jl" href="https://developer.android.com/reference/android/content/Context.html#MODE_PRIVATE" rel="noopener ugc nofollow" target="_blank">MODE_PRIVATE</a></code>作为文件创建标志，其中创建的文件只能由调用应用程序(或所有共享相同用户ID的应用程序)访问</p><blockquote class="ln lo lp"><p id="ed02" class="ie if lq ig b ih ii ij ik il im in io lr iq ir is ls iu iv iw lt iy iz ja jb ha bi translated"><strong class="ig hi">根据建议，Google坚持认为开发者应该使用标志: <code class="du lj lk ll lm b"><em class="hh">MODE_PRIVATE</em></code> <em class="hh">来限制其他应用程序访问数据。然而，由于你可以在Android Studio中使用简单的数据路径从应用程序沙箱中提取任何数据- </em></strong></p><p id="0648" class="ie if lq ig b ih ii ij ik il im in io lr iq ir is ls iu iv iw lt iy iz ja jb ha bi translated">data/data/<com.your.package>/shared _ prefs/yourfile . XML</com.your.package></p><p id="1531" class="ie if lq ig b ih ii ij ik il im in io lr iq ir is ls iu iv iw lt iy iz ja jb ha bi translated">我们可以看到这个文件中的任何内容，所以如果你在存储用户的令牌或个人数据，它将在几秒钟内暴露。</p></blockquote><p id="53f4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然而，由于您可以使用Android Studio中的设备监视器在<strong class="ig hi">调试模式</strong>下从应用程序中提取数据，因此很明显Jetpack security没有使用SharedPreferences和File对于加密正在使用:<a class="ae jl" href="https://developer.android.com/reference/androidx/security/crypto/EncryptedSharedPreferences" rel="noopener ugc nofollow" target="_blank">encrypted shared preferences</a>和<a class="ae jl" href="https://developer.android.com/reference/androidx/security/crypto/EncryptedFile" rel="noopener ugc nofollow" target="_blank"> EncryptedFile </a></p><p id="5de8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第一个方法包装SharedPreferences类，并使用两种方案方法自动加密密钥和值:</p><ul class=""><li id="9975" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated"><strong class="ig hi">密钥</strong>使用确定性加密算法加密，使得密钥可以被加密和正确查找。</li><li id="e085" class="jc jd hh ig b ih jm il jn ip jo it jp ix jq jb jh ji jj jk bi translated"><strong class="ig hi">值</strong>使用<a class="ae jl" href="https://tools.ietf.org/html/rfc5116#section-5.2" rel="noopener ugc nofollow" target="_blank"> AES-256 GCM </a>加密，具有不确定性。</li></ul><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="ki kj l"/></div><figcaption class="kd ke et er es kf kg bd b be z dx">Creation of EncryptedSharedPreferences</figcaption></figure><p id="deaa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">SharedPreferences需要使用上下文来创建EncryptedSharedPreferences的实例，我们需要调用静态方法<em class="lq"> create() </em>来创建实例。</p><ul class=""><li id="f8fd" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">masterKeyAlias:将用于本文顶部的加密的密钥</li><li id="2663" class="jc jd hh ig b ih jm il jn ip jo it jp ix jq jb jh ji jj jk bi translated">上下文:为了访问存储的首选项。</li><li id="15ac" class="jc jd hh ig b ih jm il jn ip jo it jp ix jq jb jh ji jj jk bi translated">prefKeyEncryptionScheme:用于存储密钥的方案。</li><li id="0c2d" class="jc jd hh ig b ih jm il jn ip jo it jp ix jq jb jh ji jj jk bi translated">prefValueEncryptionScheme:用于存储值的方案。</li></ul><p id="4f0f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于共享偏好设置中的读写，您可以像往常一样:</p><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="ki kj l"/></div></figure><h1 id="7b2e" class="lu kl hh bd kh lv lw lx kp ly lz ma kt mb mc md kw me mf mg kz mh mi mj lc mk bi translated">文件</h1><p id="acd5" class="pw-post-body-paragraph ie if hh ig b ih le ij ik il lf in io ip lg ir is it lh iv iw ix li iz ja jb ha bi translated"><a class="ae jl" href="https://developer.android.com/reference/androidx/security/crypto/EncryptedFile" rel="noopener ugc nofollow" target="_blank"> EncryptedFile </a>也是FileInputStream和FileOutputStream的自定义实现，为您的应用提供安全的读写流。</p><p id="8995" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了从文件流中提供安全的读写操作，安全库使用流验证加密和相关数据(AEAD ),它为数据提供验证加密，并且当要加密的数据太大而无法在一个步骤中处理时非常有用，这与Tink库使用的方法相同，典型的使用案例包括大型文件的加密或实时数据流的加密。</p><p id="1256" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">选择基础加密模式，使得可以通过解密和认证密文的一部分来快速获得部分明文，而不需要处理整个密文。</p><p id="13e6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">文件的缺点是加密必须一次完成，除了再次重新加密整个文件之外，没有办法修改现有的密文或向其添加内容，当然，我们有一个限制问题:</p><ul class=""><li id="d216" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated"><strong class="ig hi">明文:</strong>可以是0范围内的任意长度..2 ⁸和<em class="lq">关联数据</em>可以具有范围0内的任意长度..2()–1字节</li></ul><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="ki kj l"/></div></figure><p id="4910" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有两个主要的类与整个EncryptedFile组件相关；第一个是我们要加密的文件和EncryptedFile。构建者:</p><ul class=""><li id="13aa" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">file:一个文件实例，它将一如既往地包含名称和路径</li><li id="4d35" class="jc jd hh ig b ih jm il jn ip jo it jp ix jq jb jh ji jj jk bi translated">上下文:为了访问文件位置</li><li id="5db7" class="jc jd hh ig b ih jm il jn ip jo it jp ix jq jb jh ji jj jk bi translated">masterKeyAlias:将用于本文顶部的加密的密钥</li><li id="3f62" class="jc jd hh ig b ih jm il jn ip jo it jp ix jq jb jh ji jj jk bi translated">fileEncryptionScheme:用于将字节写入文件的方案。</li></ul><p id="c1a2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于文件的读写，你可以像往常一样:</p><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="ki kj l"/></div></figure></div><div class="ab cl ml mm go mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ha hb hc hd he"><p id="ad82" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">【2020年6月4日更新:<br/>看起来这个库必须在*上实现它。pro文件是否要发布到生产中，如果不发布，应用程序会崩溃这是Tink库评论的一个问题:<a class="ae jl" href="https://github.com/google/tink/issues/361" rel="noopener ugc nofollow" target="_blank">https://github.com/google/tink/issues/361</a></p><pre class="js jt ju jv fd ms lm mt mu aw mv bi"><span id="acdc" class="kk kl hh lm b fi mw mx l my mz"><em class="lq"># Security<br/></em>-keepclassmembers class * extends com.google.crypto.tink.shaded.protobuf.GeneratedMessageLite {<br/>  <em class="lq">&lt;fields&gt;</em>;<br/>}</span></pre></div><div class="ab cl ml mm go mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="ha hb hc hd he"><p id="e519" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这就是这篇文章的全部内容，如果你需要帮助:</p><p id="e0b7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我很乐意帮忙，你可以在这里找到我:<br/>Medium:<a class="ae jl" rel="noopener" href="/@dinorahto">https://medium.com/@dinorahto</a><br/>stack overflow:<a class="ae jl" href="https://stackoverflow.com/users/4613259/dinorah-tovar" rel="noopener ugc nofollow" target="_blank">https://stackoverflow.com/users/4613259/dinorah-tovar</a></p><p id="3e34" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">编码快乐！👩🏻‍💻</p></div></div>    
</body>
</html>