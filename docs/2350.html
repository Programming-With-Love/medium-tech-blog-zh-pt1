<html>
<head>
<title>Manajemen Queue untuk Menghandle Concurrent Request dengan Kue.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Manajemen Queue untuk Menghandle Concurrent Request dengan Kue.js</h1>
<blockquote>原文：<a href="https://medium.easyread.co/manajemen-queue-antrian-untuk-menghandle-concurrent-request-dengan-kue-di-node-js-94e87cc3eea6?source=collection_archive---------3-----------------------#2018-11-18">https://medium.easyread.co/manajemen-queue-antrian-untuk-menghandle-concurrent-request-dengan-kue-di-node-js-94e87cc3eea6?source=collection_archive---------3-----------------------#2018-11-18</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><figure class="gl gn jm jn jo jp gh gi paragraph-image"><div class="gh gi jl"><img src="../Images/27fac03476eb290d753736f73638f970.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*b33CEqX2ygmS1B5OjJY4fw.png"/></div><figcaption class="js jt gj gh gi ju jv bd b be z dk">Source Image from: javascripttuts.com</figcaption></figure><p id="e6eb" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi ku translated"><span class="l kv kw kx bm ky kz la lb lc di"> N </span> ode.js adalah salah satu teknologi <em class="ld"> server side </em> berbasis <em class="ld"> javascript </em> yang bersifat <em class="ld"> non-blocking </em> dan <em class="ld"> asynchronous </em> . Hal tersebut berarti, setiap <em class="ld"> request </em> yang diberikan dapat langsung dieksekusi tanpa harus menunggu <em class="ld"> request </em> sebelumnya selesai dieksekusi. Lebih cepat dan responsif? Tentu. Tapi apakah semua <em class="ld"> task </em> cocok dengan sifat ini? Jawabannya, tidak semua skenario proses cocok dengan sifat ini.</p><h1 id="6dfc" class="le lf in bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated"><span class="l kv kw kx bm ky kz la lb lc di"> P </span> ercobaan Pertama</h1><p id="2ea3" class="pw-post-body-paragraph jw jx in jy b jz mc kb kc kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt ig bi translated">Mari kita melakukan eksperimen. Sebagai contoh, kita sedang membangun sebuah sistem <em class="ld"> e-commerce </em> yang dapat melakukan transaksi pemesanan barang <em class="ld"> . </em> Berikut data barang dalam database.</p><figure class="mi mj mk ml gt jp gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mh"><img src="../Images/45337e679da5477d245663d3b13e29dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wOmh3xsSv2f6mGZvXzPePg.png"/></div></div></figure><p id="10be" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">Dalam sistem ini, setiap transaksi pembelian kita harus mengurangi jumlah stok barang sesuai dengan jumlah item yang dipesan. Apabila stok habis atau tidak mencukupi jumlah item yang dipesan, maka pesanan tidak dapat dilanjutkan.</p><p id="911e" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">Berikut adalah kode <em class="ld"> transaction-controller </em> untuk mengurangi jumlah stok.</p><figure class="mi mj mk ml gt jp"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="d317" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">Kemudian saya mensimulasikan sebuah tes untuk menjalankan transaksi pemesanan secara bersamaan. Berikut kode-nya.</p><figure class="mi mj mk ml gt jp"><div class="bz fp l di"><div class="mq mr l"/></div></figure><p id="0eaf" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">Setelah menjalankan tes, beginilah hasilnya..</p><figure class="mi mj mk ml gt jp gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi ms"><img src="../Images/bfc5e57116c37faba23b901a6133c179.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*MldUtZ9jFTnzHvXGkN3qmg.gif"/></div></div></figure><p id="69a9" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">Dari hasil tes tersebut, kita mengetahui bahwa seluruh (empat) transaksi pemesanan berhasil dieksekusi. Padahal, produk dengan id 5 dan 6 hanya memiliki 2 stok barang yang tersisa.</p><p id="d0a8" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">Dan stok yang tersisa di database saat ini menjadi 0.</p><figure class="mi mj mk ml gt jp gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi mh"><img src="../Images/2201d07351933a81038be3d71fd3851a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NLDs7Bqn4Rp97YtHRR-SKQ.png"/></div></div></figure><p id="3d54" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">Dengan hasil eksperimen tersebut, kita memperoleh kesimpulan bahwa, jika kita menggunakan konsep <em class="ld"> asynchronous </em> , apabila ada 2 atau lebih pengguna melakukan transaksi secara <em class="ld"> concurrent </em> (bersamaan) dalam suatu waktu, maka sistem akan mengeksekusi seluruh <em class="ld"> task </em> tersebut secara bersamaan. Hal ini menjadi tidak relevan, mengingat pada setiap transaksi pemesanan, kita harus melihat apakah stok barang yang dipesan masih tersedia (stok mencukupi) atau tidak.</p><h1 id="9e3b" class="le lf in bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">Lalu, bagaimana solusinya?</h1><p id="868c" class="pw-post-body-paragraph jw jx in jy b jz mc kb kc kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt ig bi translated">Solusinya adalah dengan menggunakan antrian (queue). Dimana <em class="ld"> queue </em> memiliki konsep <strong class="jy io"> FIRST-IN-FIRST-OUT </strong> yang dapat memetakan pesanan yang dilakukan secara bersamaan ( <em class="ld"> asynchronous </em> ) menjadi terurut dan bergiliran satu per satu ( <em class="ld"> synchronous </em> ).</p><p id="e16b" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">Ada banyak library yang dapat kita gunakan untuk menghandle queue. Seperti <strong class="jy io"> Kafka, RabbitMQ, Bull, Kue </strong> , dll. Namun, kali ini kita akan menggunakan <strong class="jy io"> Kue </strong> dan mengintegrasikannya ke dalam proyek <em class="ld"> e-commerce </em> di atas.</p><h2 id="2a24" class="mt lf in bd lg mu mv dn lk mw mx dp lo kh my mz ls kl na nb lw kp nc nd ma ne bi translated">Langkah Pertama</h2><p id="1ef6" class="pw-post-body-paragraph jw jx in jy b jz mc kb kc kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt ig bi translated">Yang harus dilakukan adalah instalasi <a class="ae nf" href="https://redis.io/" rel="noopener ugc nofollow" target="_blank"> redis </a> . Karena Kue membutuhkannya untuk melakukan <em class="ld"> storing </em> <em class="ld"> jobs </em> yang diberikan. Anda dapat langsung mengunduhnya <a class="ae nf" href="https://redis.io/download" rel="noopener ugc nofollow" target="_blank"> disini </a> . Kemudian, melakukan instalasi module <strong class="jy io"> Kue </strong> itu sendiri dengan <em class="ld"> command </em> <strong class="jy io"> npm install </strong> <strong class="jy io"> — save kue </strong> .</p><h2 id="92ef" class="mt lf in bd lg mu mv dn lk mw mx dp lo kh my mz ls kl na nb lw kp nc nd ma ne bi translated">Langkah Kedua</h2><p id="bd7c" class="pw-post-body-paragraph jw jx in jy b jz mc kb kc kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt ig bi translated">Mengintegrasikan <strong class="jy io"> Kue </strong> dengan <em class="ld"> controller </em> transaksi kita.</p><pre class="mi mj mk ml gt ng nh ni nj aw nk bi"><span id="241c" class="mt lf in nh b gy nl nm l nn no">//transaction.js</span><span id="5734" class="mt lf in nh b gy np nm l nn no">const kue = require('kue');<br/>const queue = kue.createQueue();</span></pre><p id="7b3a" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">Kita harus mendefinisikan setiap request ke dalam sebuah <em class="ld"> job </em> yang akan dimasukan ke dalam antrian dengan memanggil <em class="ld"> object function </em> <strong class="jy io"> .create() </strong> .</p><pre class="mi mj mk ml gt ng nh ni nj aw nk bi"><span id="2dbe" class="mt lf in nh b gy nl nm l nn no">const job = queue.create('order', { data });</span></pre><p id="79e7" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">Setiap <em class="ld"> job </em> memiliki <em class="ld"> events </em> yang dapat digunakan untuk melakukan <em class="ld"> tracking­ </em> dalam antrian. Kita menggunakan <em class="ld"> object function </em> <strong class="jy io"> .on() </strong> untuk meregistrasikan <em class="ld"> events </em> . Untuk melihat apa saja <em class="ld"> events </em> yang dapat dipakai, anda dapat langsung mengunjungi <a class="ae nf" href="https://github.com/Automattic/kue" rel="noopener ugc nofollow" target="_blank"> dokumentasi <strong class="jy io"> Kue </strong> </a> . Disini, kita hanya akan menggunakan event <em class="ld"> failed </em> dan <em class="ld"> complete </em> . Untuk mengetahui apakah sebuah <em class="ld"> job </em> mengalami <em class="ld"> error </em> atau sukses di eksekusi.</p><pre class="mi mj mk ml gt ng nh ni nj aw nk bi"><span id="d430" class="mt lf in nh b gy nl nm l nn no">job.on('failed', err =&gt; { console.log(err) });</span><span id="e634" class="mt lf in nh b gy np nm l nn no">job.on('complete', result =&gt; { console.log(result) });</span></pre><p id="2bc4" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">J <em class="ld"> ob </em> diakhiri dengan method <strong class="jy io"> .save() </strong> untuk memasukannya ke dalam antrian.</p><pre class="mi mj mk ml gt ng nh ni nj aw nk bi"><span id="f17c" class="mt lf in nh b gy nl nm l nn no">job.save();</span></pre><p id="35ed" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">Terakhir, kita harus mendefinisikan proses yang harus dijalankan ketika sebuah job masuk ke dalam <em class="ld"> queue </em> (antrian).</p><pre class="mi mj mk ml gt ng nh ni nj aw nk bi"><span id="05c5" class="mt lf in nh b gy nl nm l nn no">queue.process('order', (job, done) =&gt; { /* doSomeTask(); */ done(); });</span></pre><p id="9d77" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">Berikut hasil akhir pengintegrasian <strong class="jy io"> Kue </strong> ke dalam <em class="ld"> controller </em> .</p><figure class="mi mj mk ml gt jp"><div class="bz fp l di"><div class="mq mr l"/></div></figure><h1 id="c61c" class="le lf in bd lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb bi translated">Percobaan Kedua</h1><p id="a0c6" class="pw-post-body-paragraph jw jx in jy b jz mc kb kc kd md kf kg kh me kj kk kl mf kn ko kp mg kr ks kt ig bi translated">Mari kita uji lagi dengan melakukan <em class="ld"> concurrent ordering test </em> sama seperti di atas, setelah kita mengintegrasikan kue dalam <em class="ld"> project </em> <em class="ld"> e-commerce </em> . NOTE: Saya telah menambah jumlah stok produk dengan id 5 dan 6 masing-masing 4 pcs.</p><figure class="mi mj mk ml gt jp gh gi paragraph-image"><div role="button" tabindex="0" class="mm mn di mo bf mp"><div class="gh gi nq"><img src="../Images/8b7360b61aba8adf49c1e7391daf7af7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Huh-DvKuBplyJqSQBZhpRg.gif"/></div></div></figure><p id="43ce" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">Kali ini, tidak semua transaksi mengembalikan json <strong class="jy io"> { isOk: true } </strong> . Hal ini terjadi karena setiap <em class="ld"> request </em> dilakukan secara berurutan, satu per satu, tidak lagi bersamaan. Setiap <em class="ld"> request </em> dimasukan ke dalam antrian, dan menunggu jika <em class="ld"> request </em> sebelumnya belum selesai di eksekusi. Kemudian setiap <em class="ld"> job </em> melakukan pengecekan, apakah stok barang masih tersedia. Jika tersedia, maka pesanan dapat dilanjutkan. Jika stok habis atau tidak mencukupi, maka akan mengembalikan pesan error.</p><p id="a31e" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">Sekian sedikit penjelasan saya mengenai cara menghandle <em class="ld"> concurrent task </em> dan solusi menggunakan antrian. Apabila ada kesalahan atau perlu penambahan, silakan isi kolom komentar.</p><p id="5d6f" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated">Untuk <em class="ld"> source code </em> lengkap <em class="ld"> project </em> <em class="ld"> e-commerce </em> diatas, anda dapat mengakses dan berkontribusi disini:</p><div class="nr ns gp gr nt nu"><a href="https://github.com/alfari16/microservices-ecommerce" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd io gy z fp nz fr fs oa fu fw im bi translated">alfari16/microservices-ecommerce</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">An E-Commerce Platform that use microservices architecture - alfari16/microservices-ecommerce</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">github.com</p></div></div><div class="od l"><div class="oe l of og oh od oi jq nu"/></div></div></a></div></div><div class="ab cl oj ok hr ol" role="separator"><span class="om bw bk on oo op"/><span class="om bw bk on oo op"/><span class="om bw bk on oo"/></div><div class="ig ih ii ij ik"><p id="ea7a" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><em class="ld"> Artikel ini di tulis oleh </em> <a class="oq or ep" href="https://medium.com/u/6e41e9409c88?source=post_page-----94e87cc3eea6--------------------------------" rel="noopener" target="_blank"> <em class="ld"> Alif Irfan Anshory </em> </a> <em class="ld"> . Beliau sering menulis artikel mengenai Software Engineering. Follow profilnya untuk mendapatkan update-an terbaru artikel-artikel beliau. </em></p><p id="6fd9" class="pw-post-body-paragraph jw jx in jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ig bi translated"><em class="ld"> Jika anda merasa artikel ini menarik dan bermanfaat, bagikan ke lingkaran pertemanan anda, agar mereka dapat membaca artikel ini. <br/> Atau jika anda tertarik untuk membagikan cerita anda pada publikasi ini, anda boleh mengirimkan cerita anda ataupun mengikuti langkah-langkah yang ada </em> <a class="ae nf" href="https://medium.com/easyread/about-easyread-74b20960e180" rel="noopener"> <strong class="jy io"> <em class="ld"> disini </em> </strong> </a> <em class="ld"> . </em></p></div><div class="ab cl oj ok hr ol" role="separator"><span class="om bw bk on oo op"/><span class="om bw bk on oo op"/><span class="om bw bk on oo"/></div><div class="ig ih ii ij ik"><figure class="mi mj mk ml gt jp"><div class="bz fp l di"><div class="os mr l"/></div></figure></div></div>    
</body>
</html>