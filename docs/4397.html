<html>
<head>
<title>State Descriptions on Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android上的状态描述</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/state-descriptions-on-android-b2029283871f?source=collection_archive---------0-----------------------#2021-12-09">https://medium.com/google-developer-experts/state-descriptions-on-android-b2029283871f?source=collection_archive---------0-----------------------#2021-12-09</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="d7d0" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">了解什么是状态描述，为什么它们对可访问性很重要，以及如何在旧版本的Android上使用它们。</h2></div><p id="0a14" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">状态描述是Android上可访问性工具箱的一个相对较新的补充，是在Android 11 (API 30)中添加的。它是一个专用属性，用于描述UI组件的当前状态。</p><p id="4714" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这个API之前，我们必须重载内容描述来提供这些额外的信息:</p><figure class="js jt ju jv fd jw er es paragraph-image"><div class="ab fe cl jx"><img src="../Images/568aa0fde98c672a529dcff614085b90.png" data-original-src="https://miro.medium.com/v2/format:webp/1*cYSSA0BnRDqgOObaVJ-EYA.png"/></div></figure><p id="80b9" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，我们可以将状态描述分开:</p><figure class="js jt ju jv fd jw er es paragraph-image"><div class="ab fe cl jx"><img src="../Images/42164056f196986bd483778eae570c57.png" data-original-src="https://miro.medium.com/v2/format:webp/1*QOz9pE6yEiOOtBo5fTY3Hg.png"/></div></figure><p id="b242" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这篇文章中，我们将看看state description属性，以及如何在Jetpack Compose UIs和传统的基于视图的系统中使用它。</p><h1 id="3fcb" class="ka kb hh bd kc kd ke kf kg kh ki kj kk in kl io km iq kn ir ko it kp iu kq kr bi translated">我什么时候需要状态描述？</h1><p id="ac39" class="pw-post-body-paragraph iw ix hh iy b iz ks ii jb jc kt il je jf ku jh ji jj kv jl jm jn kw jp jq jr ha bi translated">当UI组件以可视方式改变来表达状态时，状态描述很有帮助。</p><p id="319b" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">像<code class="du kx ky kz la b">CheckBox</code>、<code class="du kx ky kz la b">RadioButton</code>和<code class="du kx ky kz la b">Switch</code>这样的内置组件对于辅助功能服务来说都是众所周知的。该服务可以查询这些组件，并自动向用户显示它们的状态:</p><figure class="js jt ju jv fd jw er es paragraph-image"><div class="ab fe cl jx"><img src="../Images/ec4fd0861947fa5076ea176cdb612ef0.png" data-original-src="https://miro.medium.com/v2/format:webp/1*WCz0V9DBiPjIVYeXhCKZTg.png"/></div><figcaption class="lb lc et er es ld le bd b be z dx">A not-ticked and ticked CheckBox</figcaption></figure><p id="40a6" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><code class="du kx ky kz la b">RadioButton</code>和<code class="du kx ky kz la b">Switch</code>享有相似的功能。Google TalkBack将显示“已选择”/“未选择”和“开”/“关”作为各自的状态描述。</p><p id="80e5" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">对于自定义的小部件、图标或徽章，没有这样的固有属性。辅助功能服务不知道我们的自定义音量指示器或麦克风标记，所以以前需要将状态信息放入内容描述中。</p><figure class="js jt ju jv fd jw er es paragraph-image"><div role="button" tabindex="0" class="lg lh di li bf lj"><div class="er es lf"><img src="../Images/c1441170106f5a3b685df12ad2c5336f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8u0pC6zFOuDHGj6hv1MmQw.png"/></div></div></figure><p id="5d6f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">有了state description属性，我们可以保持内容描述的简短和集中。</p><h1 id="06bb" class="ka kb hh bd kc kd ke kf kg kh ki kj kk in kl io km iq kn ir ko it kp iu kq kr bi translated">Jetpack撰写UI中的状态描述</h1><p id="5ab3" class="pw-post-body-paragraph iw ix hh iy b iz ks ii jb jc kt il je jf ku jh ji jj kv jl jm jn kw jp jq jr ha bi translated">在这个例子中，我们使用<code class="du kx ky kz la b">Slider</code>组件来表示最低/最高价格过滤器。如果我们用TalkBack检查，它使用默认的状态描述，这不是很有帮助；我们想让它显示价格。</p><figure class="js jt ju jv fd jw er es paragraph-image"><div class="ab fe cl jx"><img src="../Images/c561afe3d14e463cd6c4056b72721319.png" data-original-src="https://miro.medium.com/v2/format:webp/1*JNSLdu-qX9p5YBiboCWYsg.png"/></div><figcaption class="lb lc et er es ld le bd b be z dx">Left: without a custom state description, right: with</figcaption></figure><p id="3d3f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">可以使用<code class="du kx ky kz la b">Modifier.semantics</code>在撰写UI中设置状态描述。这里，我们正在更新默认描述，以便它告诉我们当前选择的价格:</p><pre class="js jt ju jv fd lk la ll lm aw ln bi"><span id="9606" class="lo kb hh la b fi lp lq l lr ls">Slider(<br/>    value = sliderPosition,<br/>    onValueChange = { sliderPosition = it },<br/><strong class="la hi">    modifier = Modifier.semantics {</strong><br/><strong class="la hi">        val money = (sliderPosition * 100).toInt()<br/>        stateDescription = "£$money"</strong><br/><strong class="la hi">    }</strong><br/>)</span></pre><p id="5ac3" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这适用于最新版本的Talkback (12.1)，甚至适用于旧版本的Android(我在Android 10上测试过，在引入状态描述API之前)。Jetpack Compose UI可以一直工作到Android 5.1 (API 21)，所以这是一个好消息。</p><h2 id="ab1e" class="lo kb hh bd kc lt lu lv kg lw lx ly kk jf lz ma km jj mb mc ko jn md me kq mf bi translated">基于视图的用户界面系统中的状态描述</h2><p id="373d" class="pw-post-body-paragraph iw ix hh iy b iz ks ii jb jc kt il je jf ku jh ji jj kv jl jm jn kw jp jq jr ha bi translated">在基于视图的系统中，我们可以使用来自<a class="ae mg" href="https://developer.android.com/reference/androidx/core/view/ViewCompat#setStateDescription(android.view.View,%20java.lang.CharSequence)" rel="noopener ugc nofollow" target="_blank"> AppCompat </a>的<code class="du kx ky kz la b">ViewCompat</code> API。它使用视图标签将支持一直回溯到Android 4.4 (API 19)！</p><pre class="js jt ju jv fd lk la ll lm aw ln bi"><span id="a0c0" class="lo kb hh la b fi lp lq l lr ls">val localizedDesc = "On" // TODO: localize it..!<br/><strong class="la hi">ViewCompat.setStateDescription(micView, localizedDesc)</strong></span></pre><p id="019b" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这让我们可以在任何视图上设置一个状态描述，这些视图是可访问性服务(比如对讲)应该使用的。</p><h2 id="e74b" class="lo kb hh bd kc lt lu lv kg lw lx ly kk jf lz ma km jj mb mc ko jn md me kq mf bi translated">下一步是什么？</h2><p id="944b" class="pw-post-body-paragraph iw ix hh iy b iz ks ii jb jc kt il je jf ku jh ji jj kv jl jm jn kw jp jq jr ha bi translated">到目前为止，这个新属性已经在视图和编写ui中被反向移植了，这很酷。如果你还没有看过，我推荐你看一下Shailen Tuli的这个视频，它是关于“为可访问性传递状态”的:</p><figure class="js jt ju jv fd jw"><div class="bz dy l di"><div class="mi mj l"/></div></figure><p id="463f" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">seekbar有一个地方没有像预期的那样奏效。<a class="ae mg" href="https://issuetracker.google.com/issues/208178383" rel="noopener ugc nofollow" target="_blank">开始本期</a>获取关于这个bug的更新！</p><p id="6bab" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><a class="ae mg" href="http://twitter.com/ataulm" rel="noopener ugc nofollow" target="_blank">如果你有意见或问题，请告诉我</a>！</p><p id="93e3" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="mh">感谢</em><a class="ae mg" href="https://twitter.com/Lojanda" rel="noopener ugc nofollow" target="_blank"><em class="mh">Jolanda</em></a><em class="mh">和</em><a class="ae mg" href="https://twitter.com/calren24" rel="noopener ugc nofollow" target="_blank"><em class="mh">Caren</em></a><em class="mh">的评论和帮助整理bug！</em></p></div></div>    
</body>
</html>