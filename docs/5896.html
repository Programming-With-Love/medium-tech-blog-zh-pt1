<html>
<head>
<title>Add a Custom HTTP Request or Response Header to OCI Load Balancer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">向OCI负载平衡器添加自定义HTTP请求或响应标头</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/add-custom-http-request-or-response-header-to-oci-load-balancer-7eb7861e168c?source=collection_archive---------0-----------------------#2022-03-30">https://medium.com/oracledevs/add-custom-http-request-or-response-header-to-oci-load-balancer-7eb7861e168c?source=collection_archive---------0-----------------------#2022-03-30</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="2b59" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">今天，我们将讨论添加自定义HTTP请求或响应头。有些客户要求有时需要我们根据后端应用程序的设计添加自定义标题。</p><p id="8cbf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Oracle云基础设施上的应用负载平衡器工作在第7层，因此它支持HTTP和HTTPS。它可以根据基于主机或基于路径的规则分发HTTP和HTTPS流量。应用程序负载平衡器是一种上下文感知的负载分布，它可以基于HTTP头转发和操作请求。它还具有可配置的健康检查状态代码范围，此外，根据后端服务器的要求，可以插入定制的请求和响应头。</p><p id="0b72" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">自定义标题如何工作</strong></p><p id="985a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">自定义请求和响应头允许您指定负载平衡器添加到请求和响应中的附加头。这些规则使您能够向后端服务器提供元数据，使您能够判断哪个侦听器发出了请求、客户端IP地址的地理位置、通知WebLogic负载平衡器终止了SSL等等。</p><p id="4790" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">默认情况下，应用程序负载平衡器将某些头添加到它在后端和客户端之间代理的所有HTTP(S)请求和响应中。更多信息，请参见<a class="ae jc" href="https://docs.oracle.com/en-us/iaas/Content/Balance/Reference/httpheaders.htm" rel="noopener ugc nofollow" target="_blank">https://docs . Oracle . com/en-us/iaas/Content/Balance/Reference/http headers . htm</a></p><p id="2f11" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本例中，客户希望复制其现有的本地环境，方法是使用X-Forwarded-For或X-REAL-IP添加一个特定的HTTP头作为CLIENTIP，其值为实际客户端IP。</p><p id="bdc1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在我们完成这些步骤之前，让我们理解:<strong class="ig hi">什么是规则集？</strong></p><p id="cb1a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">规则集是与负载平衡器连接并应用于一个或多个负载平衡器侦听器的规则的命名集合。您必须首先建立包含规则的规则集，然后才能将其应用于侦听器。规则是表示负载平衡器侦听器对流量采取的操作的对象。负载平衡器的设置包括规则集。创建或编辑负载平衡器侦听器时，可以指定要使用的规则集。规则集可以包含以下几种规则:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/f7c94f62a3d4612511960acdb8e8a1b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wTRXHi743IUj290MtuF4sQ.png"/></div></div></figure><p id="2478" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">以下是将定制请求标题添加到OCI LB的步骤:</strong></p><p id="a4fa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">1.登录https://cloud.oracle.com/的OCI控制台—<a class="ae jc" href="https://cloud.oracle.com/" rel="noopener ugc nofollow" target="_blank"/></p><p id="07ac" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.导航到-</p><p id="8bb7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jp">联网&gt;负载平衡器&gt;选择您的负载平衡器并查看详细信息</em></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jq"><img src="../Images/0699156dec3906afe32c8bf29ab8d7ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_mC1OrsU7hO4_TPvbpbQJw.png"/></div></div></figure><p id="181c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3.在左侧向下滚动</p><ul class=""><li id="96c9" class="jr js hh ig b ih ii il im ip jt it ju ix jv jb jw jx jy jz bi translated"><em class="jp">选择规则集&gt;选择创建规则集&gt;命名&gt;选择指定请求标题规则</em>并选择动作“添加请求标题”。</li><li id="f0d2" class="jr js hh ig b ih ka il kb ip kc it kd ix ke jb jw jx jy jz bi translated">根据用户需要的变量或名称键入标题名称，并选择值为{X-Real-IP}或{X-Forwarded-For}。</li><li id="2174" class="jr js hh ig b ih ka il kb ip kc it kd ix ke jb jw jx jy jz bi translated">请看下面的截图，注意我选择了不同的标题名称来显示不同的值。</li></ul><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kf"><img src="../Images/70d3d4e6e5d4039e92cc10c1aa46258b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dhR8XswB088Le_bC3x6Ffw.png"/></div></div></figure><p id="2d02" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">4.保存更改以保存规则集。</p><p id="6fae" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">5.选择同一页面下的监听器–</p><p id="8ad6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">编辑<em class="jp">监听器&gt;向下滚动到规则集</em>，并将步骤4中创建的规则集附加到监听器。这将把规则集应用到负载平衡器监听器。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kg"><img src="../Images/170b61d4ee2406468466f3ce83a27781.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mojKhbn4uJsdnGeZ7iEwAw.png"/></div></div></figure><p id="42c0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在配置完成了。让我们从后端服务器实例开始检查，我们可以看到实例接收到插入的自定义头，实际的客户端IP用于测试负载平衡器。我们使用了下面的tcpdump命令来检查这一点:</p><blockquote class="kh ki kj"><p id="f4db" class="ie if jp ig b ih ii ij ik il im in io kk iq ir is kl iu iv iw km iy iz ja jb ha bi translated">tcpdump -Xx -s 0 -i <interface>端口<port_num> | grep <filter> -A 2 -B 2</filter></port_num></interface></p></blockquote><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kn"><img src="../Images/c47f60dab5a33e1e18d5399c24db9b1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*asw7iIYyrIgC7uPTZVuEoA.png"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es kn"><img src="../Images/7e1206660774d72d8713fd8318d9f882.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3zhTI4ZMU3T4sPz1z9lFtg.png"/></div></div></figure><p id="6770" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">正如我们在上面的截图中所看到的，一个新的自定义头(值为<strong class="ig hi"> CLIENTIP和CLIENTip </strong>，值为<strong class="ig hi"> X-Forwarded-For和X-Real-IP </strong>(实际的客户端IP地址)被传递到后端服务器。</p><p id="4754" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">接下来的步骤</strong></p><p id="7d65" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有关更多信息，请参见OCI文档中的OCI网络负载平衡器。我们希望您体验Oracle云基础架构提供的这些新特性和所有企业级功能。</p><p id="e345" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您对OCI应用负载均衡器有任何疑问，请随时写信@<strong class="ig hi"><em class="jp">piyush.jalan93@gmail.com</em></strong>&amp;敬请关注下一篇文章。我还要感谢我的同事Animesh Dixit对这个博客的贡献。</p><p id="4327" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">谢谢大家！</p></div></div>    
</body>
</html>