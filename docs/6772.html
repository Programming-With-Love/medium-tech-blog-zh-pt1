<html>
<head>
<title>Using Marten with Postgres as a Document Database</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Marten和Postgres作为文献数据库</h1>
<blockquote>原文：<a href="https://medium.com/quick-code/using-marten-with-postgres-as-a-document-database-5481567a3630?source=collection_archive---------2-----------------------#2019-12-18">https://medium.com/quick-code/using-marten-with-postgres-as-a-document-database-5481567a3630?source=collection_archive---------2-----------------------#2019-12-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/37d0c3b1e58b30cadf3ced864a8e3dde.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R4VXwtloO62JmX1qQAHlMg.jpeg"/></div></div></figure><p id="4d4a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在过去的两周里，我一直在学习AWS DynamoDB的学习材料。AWS DynamoDB是很好的服务，但似乎很难有效使用。在这篇文章中，我将探索一个名为Marten的C#库。它使用Postgres作为NoSQL商店。为什么？Postgres非常支持JSON类型。它为NoSQL选项(如DynamoDB)提供了一个很好的替代方案。将我的解决方案捆绑到像DynamoDB这样的服务上，感觉就像我将自己捆绑到一个特定于供应商服务的特定实现上。假设我需要将我的解决方案部署在云服务之外的其他地方。Postgres是一种独立于云服务的关系数据库管理服务。其他地方可能不会使用DynamoDB。貂皮的<a class="ae jn" href="https://martendb.io/" rel="noopener ugc nofollow" target="_blank">网站将其描述为:</a></p><blockquote class="jo jp jq"><p id="8a9e" class="ip iq jr ir b is it iu iv iw ix iy iz js jb jc jd jt jf jg jh ju jj jk jl jm ha bi translated">多语言持久性。NET系统使用坚如磐石的PostgreSQL数据库</p></blockquote><p id="86b6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这一切意味着什么？多语言是那些精通多种语言和框架的开发人员使用的术语。他们可以根据相似的标准编写解决方案，而不管技术如何。给他们NodeJS，。NET、Java——没关系。怎么翻译成貂皮？根据<a class="ae jn" href="https://en.wikipedia.org/wiki/Polyglot_persistence" rel="noopener ugc nofollow" target="_blank">维基百科</a>的说法，多语言持久性意味着混合使用多种存储技术。Postgres仍然是一个关系数据库——没有什么可以阻止您将其用作关系存储。也没什么能阻止你把它当作NoSQL的商店。</p><p id="d622" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">SQL是我必须克服的个人弱点。我更喜欢写C#之类的代码。SQL极其强大。在我工作过的大多数环境中，SQL Server是中流砥柱。探索不同的事物是使用Postgres学习SQL的一个重要原因。</p><h1 id="590f" class="jv jw hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">在Windows 10上安装Postgres</h1><p id="e9bb" class="pw-post-body-paragraph ip iq hh ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">首先让我们下载并安装Postgres。我用的是Windows 10——只有下载<a class="ae jn" href="https://www.postgresql.org/download/windows/" rel="noopener ugc nofollow" target="_blank">合适的软件包</a>才有意义。出于我的目的，我将使用12.1。我不是波斯特格雷专家。事实上，我是个彻头彻尾的00b。然而，我确实喜欢用不同的方式解决问题。下载Postgres后，我逐步完成安装步骤。</p><p id="bc81" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我过去曾短暂地使用过pgAdmin。我记得它没有那么精致。我发现导航有点简洁。出于我的目的，我将尝试使用CLI与数据库引擎进行交互。我将安装pgAdmin以防万一。我尝试使用HeidiSQL连接到Postgres，但发现它有点问题。HeidiSQL非常适合MySQL或MariaDb。</p><p id="54a9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Postgres安装包含两个部分—Postgres数据库引擎的安装是第一部分。第二部分是StackBuilder配置——我跳过了。我将只通过C#的SDK连接到数据库。根据以前的经验，StackBuilder添加了npg SQL——这是我通过Nuget添加的。在包级别定义依赖关系似乎是一个更好的主意。</p><h1 id="3ecc" class="jv jw hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">在环境变量中设置Postgres</h1><p id="d3ae" class="pw-post-body-paragraph ip iq hh ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">我希望Postgres命令可以在CLI中使用。确保将其添加到环境变量下的path变量中。</p><figure class="kz la lb lc fd ii er es paragraph-image"><div class="er es ky"><img src="../Images/abe0bf176d3e0f711b783b67b3ad61c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:676/format:webp/1*7c_zS9sht3AvnYXxZboYpw.png"/></div></figure><figure class="kz la lb lc fd ii er es paragraph-image"><div class="er es ld"><img src="../Images/cc00288ac3379af92a50a3972bdae999.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*1xbqAXMRIopfGVOLbJ3NMQ.png"/></div></figure><figure class="kz la lb lc fd ii er es paragraph-image"><div class="er es le"><img src="../Images/01bc217991fc77e22d01a3acb114dcd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1226/format:webp/1*f_xjCtKsGJjjBCEW308GzA.png"/></div></figure><figure class="kz la lb lc fd ii er es paragraph-image"><div class="er es lf"><img src="../Images/3c04c8b4652d1486cb89872a96e91415.png" data-original-src="https://miro.medium.com/v2/resize:fit:1052/format:webp/1*UUAUWjrXT9VlaudHxOyG-Q.png"/></div></figure><h1 id="4e54" class="jv jw hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">使用CLI创建示例数据库</h1><p id="b60c" class="pw-post-body-paragraph ip iq hh ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">在path变量中设置Postgres允许您通过CLI客户端(如Windows终端)连接到Postgres实例。我们也需要一个示例数据库来编写文档。启动Windows终端。使用<code class="du lg lh li lj b">psql -U postgres</code>通过一个CLI客户机(比如Powershell Core)连接到postgres实例。</p><figure class="kz la lb lc fd ii er es paragraph-image"><div class="er es lk"><img src="../Images/70faf55dbd6357cea7e89def0a6742c7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/format:webp/1*JCCgy42ArAL-k0l3dIzPzA.png"/></div></figure><p id="ced5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">-U标志是数据库的用户名，在我的例子中是它的postgres。该用户名与安装过程中提供的用户名相同。系统将提示您提供密码，该密码与安装过程中使用的密码相同。</p><p id="fc22" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">让我们创建一个数据库，并将其命名为<code class="du lg lh li lj b">marten_demo</code>。类型<code class="du lg lh li lj b">CREATE DATABASE marten_demo;</code>。分号非常重要，它终止了一行。</p><figure class="kz la lb lc fd ii er es paragraph-image"><div class="er es ll"><img src="../Images/c034e25a80e3442d4947d9affee3e73a.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/format:webp/1*_iC5xdyNozbqY7FUOA_RVQ.png"/></div></figure><p id="5b64" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您可以使用<code class="du lg lh li lj b">\l</code>命令来验证数据库是否存在。</p><figure class="kz la lb lc fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lm"><img src="../Images/67e86d494e30011bc52468ea9f7c7c66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_1CCm8TO1PCo5NjcEagPNA.png"/></div></div></figure><h1 id="0833" class="jv jw hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">Marten演示C#项目</h1><p id="0016" class="pw-post-body-paragraph ip iq hh ir b is kt iu iv iw ku iy iz ja kv jc jd je kw jg jh ji kx jk jl jm ha bi translated">创建好数据库后，让我们编写一些代码来存储和读取文档。对于演示，我使用Visual Studio 2019社区版。启动Visual Studio并选择<strong class="ir hi">创建一个新项目</strong>:</p><figure class="kz la lb lc fd ii er es paragraph-image"><div class="er es ln"><img src="../Images/c2b3e9baf29dec2732cde22475e28f42.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*PUrGzKfA-F8zNw4KxIeasg.png"/></div></figure><p id="8efb" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">选择控制台应用程序(。NET Core)从模板。</p><figure class="kz la lb lc fd ii er es paragraph-image"><div class="er es lo"><img src="../Images/98756f546712f6461e31fae1b90426b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*PGyVH92AUyxA_yeqohj2jQ.png"/></div></figure><p id="0ae8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">给这个项目起个名字<code class="du lg lh li lj b">Marten.Demo:</code></p><figure class="kz la lb lc fd ii er es paragraph-image"><div class="er es lp"><img src="../Images/d79343e86ad16fec056cd36200dc2cc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*JNlq52XBKNzOGXrdn_hX0w.png"/></div></figure><p id="caec" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">通过右键单击项目来添加Marten nuget包。选择<strong class="ir hi">管理NuGet包… </strong></p><figure class="kz la lb lc fd ii er es paragraph-image"><div class="er es lq"><img src="../Images/2a2eadbfd5988042088d17eccddcc76b.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*v9fAeoux1WdHhJQ54O2OQA.png"/></div></figure><p id="d285" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在Nuget浏览器中，选择“浏览”选项卡—默认情况下选择“已安装”。在搜索文本框中输入Marten:</p><figure class="kz la lb lc fd ii er es paragraph-image"><div class="er es lr"><img src="../Images/cf19fb65d9edd08c7cb135ad2b2a4a29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*-XM85qtW41R8mdrbkVQLYg.png"/></div></figure><p id="66af" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">单击安装按钮:</p><figure class="kz la lb lc fd ii er es paragraph-image"><div class="er es ls"><img src="../Images/11658995c13728951c35654a2a04663d.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*tdL4t0LYIIdEmuzAcjrEzQ.png"/></div></figure><p id="bd05" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">创建以下代码:</p><figure class="kz la lb lc fd ii"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="c386" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">按ctrl + f5测试它。您应该会看到<code class="du lg lh li lj b">han</code>出现在控制台中。</p><figure class="kz la lb lc fd ii er es paragraph-image"><div class="er es lv"><img src="../Images/9bb103df849b1fbfcee7ccf4d5cfdb45.png" data-original-src="https://miro.medium.com/v2/resize:fit:480/format:webp/1*delfCrfgiCua2VzttHKUGA.png"/></div></figure><p id="2139" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">好吧，这里发生了什么？我们基本上将User类的一个实例作为JSON存储在postgres数据库中。不过需要注意的重要一点是，JSON并不是以字符串的形式存储的。</p><p id="6402" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">导航回CLI窗口。键入<code class="du lg lh li lj b">\c marten_demo</code>连接到我们创建的数据库。键入<code class="du lg lh li lj b">\dt</code>获取数据库中的表列表:</p><figure class="kz la lb lc fd ii er es paragraph-image"><div class="er es lw"><img src="../Images/ed7179ba3ce2f23c7ce1aba2f0860ef4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/1*hZTC7mJNC7xV9VCNDNnIZg.png"/></div></figure><p id="f7e2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">用户对象存储在<code class="du lg lh li lj b">mt_doc_user</code>表中。您可以执行选择来查看数据:</p><figure class="kz la lb lc fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lx"><img src="../Images/0b63e6dc8b6fb1efc94acafbcc109656.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9aPt9FQWIhQ-4o8IdBL5KA.png"/></div></div></figure><p id="4d73" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您键入命令<code class="du lg lh li lj b">\d+</code>，您将得到表格的定义:</p><figure class="kz la lb lc fd ii er es paragraph-image"><div class="er es ly"><img src="../Images/ed149aa0e1e8b4035fabc2845ea88316.png" data-original-src="https://miro.medium.com/v2/resize:fit:850/format:webp/1*6RxMOQsKrnH2U8hoAzLPoQ.png"/></div></figure><p id="7ba8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">数据列有一个<code class="du lg lh li lj b">jsonb</code>类型。不是一串。我见过很多应用程序使用SQL Server将JSON或XML存储为字符串。意义何在？其意义在于，你的数据被存储为JSON而不是字符串。</p><h1 id="49f2" class="jv jw hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">参考</h1><ul class=""><li id="9409" class="lz ma hh ir b is kt iw ku ja mb je mc ji md jm me mf mg mh bi translated">马腾:<a class="ae jn" href="https://martendb.io/" rel="noopener ugc nofollow" target="_blank">https://martendb.io/</a></li><li id="6f2f" class="lz ma hh ir b is mi iw mj ja mk je ml ji mm jm me mf mg mh bi translated">Postgres创建数据库:<a class="ae jn" href="https://www.guru99.com/postgresql-create-database.html" rel="noopener ugc nofollow" target="_blank">https://www.guru99.com/postgresql-create-database.html</a></li></ul></div></div>    
</body>
</html>