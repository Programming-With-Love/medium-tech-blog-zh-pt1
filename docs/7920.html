<html>
<head>
<title>Did Domain Driven Design help me to ease out the approach towards Event Driven Architecture?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">领域驱动设计是否帮助我简化了事件驱动架构的方法？</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/did-domain-driven-design-help-me-to-ease-out-the-approach-towards-event-driven-architecture-b52e770ebcc?source=collection_archive---------0-----------------------#2020-10-20">https://medium.com/walmartglobaltech/did-domain-driven-design-help-me-to-ease-out-the-approach-towards-event-driven-architecture-b52e770ebcc?source=collection_archive---------0-----------------------#2020-10-20</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="d2a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我又回来了——带着我在做架构决策的一段时间里学到的一些概念和方法。由于有多种可能的架构设计方法，选择正确的架构及其设计变得越来越困难。</p><p id="d7eb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">我们先来了解一下DDD </strong></p><p id="723e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">领域驱动设计(简称DDD)，顾名思义，是应用程序的架构围绕领域(业务需求)的方法。模块的边界是由业务逻辑领域定义的。这种开发模型的核心取决于领域的功能、过程和规则。</p><p id="9763" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">领域驱动设计中使用了一些范例:</p><ul class=""><li id="db06" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated"><strong class="ig hi">模型</strong>——用于描述领域细节的抽象系统</li><li id="fa98" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated"><strong class="ig hi">通用/无处不在的语言</strong>——该领域的每个成员都能理解的语言</li><li id="6c7f" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated"><strong class="ig hi">有界上下文</strong> —描述领域边界的模型周围的细节</li></ul><p id="15c9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">DDD的前提是</p><ul class=""><li id="5775" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">通过在代码中嵌入领域术语来关注核心领域逻辑，这允许您建立一种无处不在的语言。</li><li id="2af8" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">通过捕获领域术语中的领域模型来建模基础设计。</li><li id="f4f7" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">技术专家和领域专家以迭代的方式协作来设置有界的上下文。</li></ul><p id="0d4b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">领域驱动设计的最重要的方面是设置领域/子域的上下文，其中领域将是不同业务领域的非常高层次的隔离，子域将是领域中的特定部分，表示用户使用特定的无处不在的语言和领域模型的结构。</p><p id="4255" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在不深入DDD的细节的情况下，我们应该知道的另一个范例是上下文映射，它包括识别和分类域内有界上下文之间的关系。一个或多个上下文可以在目标、重用组件(代码)、消费者和生产者方面相互关联。</p><figure class="jr js jt ju fd jv er es paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="er es jq"><img src="../Images/e5891e35b2ab377936621d4d0a936bdf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7sUvKvRGXn7Pa5IUooc9cA.png"/></div></div><figcaption class="kc kd et er es ke kf bd b be z dx">Fig 1. Domain model design</figcaption></figure><p id="a087" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">事件驱动架构</strong></p><p id="5242" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">事件是指系统状态的任何变化。事件的一些示例包括CPU利用率达到阈值、订单被分派、药品订单被分发等。事件驱动架构由各种组件组成，特别是(事件的)生产者、(特定事件的)消费者和以异步方式处理中继事件的事件通道。事件被转发到下游，并由订阅“主题”的消费者进行处理。正如您所看到的，事件驱动的体系结构基于发布/订阅或事件流模型，如下所述:</p><p id="f8de" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">发布/订阅模式</strong></p><p id="a947" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这个基础设施模型中，事件只发送给订阅了事件流/主题的消费者。</p><figure class="jr js jt ju fd jv er es paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="er es kg"><img src="../Images/026c62d93c2dd6b1f5b1e1aee6347b74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MUiLy_44fPwGbHTfEuHl4w.png"/></div></div><figcaption class="kc kd et er es ke kf bd b be z dx">Fig 2. Pub / Sub model</figcaption></figure><p id="62b8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">事件流模型</strong></p><p id="dc7f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这个模型中，事件被写入日志，消费者可以读取事件的任何部分，并通过加入流开始监听。可以采取各种动作来响应流事件，例如ETL、数据摄取、数据丰富等。这通常被称为数据的“实时”处理。</p><figure class="jr js jt ju fd jv er es paragraph-image"><div role="button" tabindex="0" class="jw jx di jy bf jz"><div class="er es kh"><img src="../Images/d8172bb728a8c93626542954e4e92f51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xdUQUjpzbKDObxXC5DpKSA.png"/></div></div><figcaption class="kc kd et er es ke kf bd b be z dx">Fig 3. Event Streaming model</figcaption></figure><p id="f72f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在上面的例子中，一旦订单被处理，它就可以被发送到像Kafka这样的事件总线，供下游消费。本例中的一个下游消费者可能是包装，它可以计算总重量并将其映射到成本。</p><p id="1154" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">补充架构</strong></p><p id="9ca4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">DDD是理解应用程序试图解决的领域/业务的自然方式，事件有助于数据通信，人们可能会问一个问题，“它们是互补的吗？”</p><p id="f665" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">指导DDD和事件聚合的原则帮助我们将焦点从名词(领域对象)转移到领域中的动词(事件)。关注事件流有助于我们理解变化是如何在系统中传播的——比如通信模式、工作流、弄清楚谁在与谁交谈、谁对什么数据负责等等。</p><p id="7ebd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">事件代表了领域中的事实，应该是领域中无处不在的语言的一部分。它们应该被建模为领域事件，并帮助我们定义构成服务边界的有界上下文。术语“域事件”是指在特定域内发生的需要传递到其他域的事件。</p><p id="dee5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">领域事件有助于以一种普遍存在的方式表达领域内的规则。这也有助于在相同领域的类之间分离关注点。事件风暴是一种技术，用于通过领域专家和技术架构师和设计师的协作来识别领域事件。</p><p id="609c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">活动风暴会议指南定义了以下前提，这些前提有助于将DDD和活动架构结合在一起</p><ul class=""><li id="f46b" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">命令——表示执行某种对接收方产生影响的动作的意图。</li><li id="c1f5" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">事件—领域中发生的事件/事实</li><li id="1846" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">聚合—由一个或多个实体组成，其中一个实体充当聚合根。</li></ul><p id="340d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于一个订单管理系统</p><ul class=""><li id="2155" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">命令:创建订单、提交付款、预订产品、分配订单</li><li id="7345" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">事件:订单已创建、产品已保留、付款已批准、付款已拒绝、订单已分配</li><li id="d4ef" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">汇总:订单、付款</li></ul><p id="42b3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将DDD与事件驱动架构结合使用时需要考虑的几点</p><ul class=""><li id="585e" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">使用事件优先领域驱动的设计方法，重点是从数据流和通信的角度理解领域的本质。事件通常更善于捕捉领域中无处不在的语言。</li><li id="d878" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">事件风暴技术是这个旅程中很好的第一步。定义命令、事件和集合将有助于清晰地分离关注点。</li><li id="4bb9" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">在使用像反讹误层这样的概念设计系统时坚持有界上下文，这些概念包括像确保传入的集成事件对于子域/服务有效或当发布有界上下文已经将事件的类型改变为接收有界上下文不识别的类型时映射到不同的事件类型这样的责任。</li><li id="e0d6" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">坚持自包含和自描述事件的概念——使它们与技术和实现无关。探索快乐和不快乐的事件，这可能有助于确定对构建软件的复杂程度的真实估计。</li><li id="5407" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">对于不愉快事件的补偿行为，遵循不同的模式，如Saga模式，其中事务可以跨服务实现。跨越多个服务的业务事务是一个传奇——一系列本地事务。每个本地事务执行一个活动，并发布一个消息或事件来触发saga中的下一个本地事务。如果本地事务由于违反业务规则而失败，则saga会执行一系列补偿事务，以撤销之前的本地事务所做的更改。</li></ul><p id="4fb0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">总结</strong></p><p id="9994" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">DDD和事件架构相辅相成。域事件有助于明确表达域中事务或操作的结果。在一个域中，这样的事件可以用于实现最终的一致性，并有助于可伸缩性，而不会影响关注点的分离。人们可以使用多种基础设施，如Kafka、RabbitMQ、MediatR等。根据需求实现域事件。DDD和有界上下文以及事件架构有助于在开发微服务时遵循模式和原则。从上面可以看出，关注点分离可以被广泛地遵循。</p><p id="b61f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">鸣谢</strong></p><p id="482d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">合著者:<a class="ki kj ge" href="https://medium.com/u/e8ad3283f426?source=post_page-----b52e770ebcc--------------------------------" rel="noopener" target="_blank">马约尔·帕特基</a></p></div></div>    
</body>
</html>