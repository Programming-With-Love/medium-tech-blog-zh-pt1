<html>
<head>
<title>Node.js Sequelize with Oracle Database — it’s official</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Node.js与Oracle数据库的序列化——这是正式的</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/node-js-sequelize-with-oracle-database-its-official-dbbad242ff4c?source=collection_archive---------0-----------------------#2022-10-21">https://medium.com/oracledevs/node-js-sequelize-with-oracle-database-its-official-dbbad242ff4c?source=collection_archive---------0-----------------------#2022-10-21</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="4a69" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Node.js Sequelize ORM的Oracle数据库方言现已推出。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jc"><img src="../Images/037961aae5d22651d17953022fc2b2f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:182/format:webp/1*eqrvRzIrKOZzF0EJH0lJ5g.png"/></div><figcaption class="jk jl et er es jm jn bd b be z dx">Sequelize</figcaption></figure><p id="c467" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jo">这是由</em><a class="ae jp" rel="noopener" href="/@nilabja10201992"><em class="jo">Nilabja Bhattacharya</em></a><em class="jo">撰写的客座博文，他是负责驱动程序和框架的Oracle数据库开发团队的成员。</em></p><p id="5881" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Sequelize是一个现代的TypeScript和Node.js ORM，正如它在<a class="ae jp" href="https://sequelize.org/" rel="noopener ugc nofollow" target="_blank">网站</a>上所说，“可靠的事务支持、关系、急切和延迟加载、读取复制等等。”它是最受欢迎的Node.js框架，每周获得近150万次下载。Oracle数据库以市场领先的性能、可伸缩性、可靠性和安全性而闻名，无论是在内部还是在云中。他们一起组成了一个伟大的组合。</p><p id="4b6f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您现在可以“正式”使用Oracle数据库和Sequelize了，因为Oracle方言已经合并到主线Sequelize代码中。感谢所有早期的代码先驱、Oracle团队和Sequelize团队，感谢他们合并了支持。</p><p id="d90b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这篇博客文章概述了与Oracle数据库的Sequelize交互。未来的文章将会介绍一个例子。</p><p id="cab2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，安装<a class="ae jp" href="https://www.npmjs.com/package/sequelize" rel="noopener ugc nofollow" target="_blank"> Sequelize 6.25 </a>(或更高版本)和<a class="ae jp" href="https://www.npmjs.com/package/oracledb" rel="noopener ugc nofollow" target="_blank"> node-oracledb </a> 5.5(或更高版本)。我们已经对Oracle数据库19c和21c进行了测试。</p><h2 id="f64a" class="jq jr hh bd js jt ju jv jw jx jy jz ka ip kb kc kd it ke kf kg ix kh ki kj kk bi translated">用Sequelize连接到Oracle数据库</h2><p id="8a7a" class="pw-post-body-paragraph ie if hh ig b ih kl ij ik il km in io ip kn ir is it ko iv iw ix kp iz ja jb ha bi translated">要连接到数据库，您必须创建一个Sequelize实例。这可以通过将Oracle数据库连接参数单独传递给Sequelize构造函数、传递单个连接URI或传递用户名、口令和连接字符串来实现:</p><pre class="jd je jf jg fd kq kr ks kt aw ku bi"><span id="eebc" class="jq jr hh kr b fi kv kw l kx ky">const { Sequelize } = require('sequelize');</span><span id="9432" class="jq jr hh kr b fi kz kw l kx ky">// Option 1: Passing a connection URI<br/>const sequelize = new Sequelize(<br/>  'oracle://&lt;username&gt;:&lt;password&gt;@&lt;ip&gt;:&lt;port&gt;/&lt;servicename&gt;');</span><span id="3192" class="jq jr hh kr b fi kz kw l kx ky">// Option 2: Passing parameters separately<br/>const sequelize = new Sequelize(&lt;servicename&gt;, &lt;username&gt;, &lt;password&gt;, {<br/>  host: &lt;ip&gt;,<br/>  port: &lt;port&gt;,<br/>  dialect: 'oracle'<br/>});</span><span id="0e0f" class="jq jr hh kr b fi kz kw l kx ky">// Option 3: Passing connection string, username, password<br/>const sequelize = new Sequelize({<br/>  dialect: 'oracle',<br/>  username: &lt;username&gt;,<br/>  password: &lt;password&gt;,<br/>  dialectOptions: {connectString: &lt;connection string&gt;}});</span></pre><p id="0771" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当您想要使用<a class="ae jp" href="https://oracle.github.io/node-oracledb/doc/api.html#tnsnames" rel="noopener ugc nofollow" target="_blank"> Oracle Net别名</a>或<a class="ae jp" href="https://oracle.github.io/node-oracledb/doc/api.html#easyconnect" rel="noopener ugc nofollow" target="_blank"> Easy Connect Plus </a>语法进行连接时，使用最后一种方式会很方便。它还允许将其他选项传递给节点-oracledb驱动程序<a class="ae jp" href="https://oracle.github.io/node-oracledb/doc/api.html#getconnectiondb" rel="noopener ugc nofollow" target="_blank">连接API </a>。</p><p id="3fd8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Oracle方言文档中的Sequelize在这里是<a class="ae jp" href="https://sequelize.org/docs/v6/other-topics/dialect-specific-things/#oracle-database" rel="noopener ugc nofollow" target="_blank"/>。</p><h2 id="e70d" class="jq jr hh bd js jt ju jv jw jx jy jz ka ip kb kc kd it ke kf kg ix kh ki kj kk bi translated">连接池</h2><p id="5a06" class="pw-post-body-paragraph ie if hh ig b ih kl ij ik il km in io ip kn ir is it ko iv iw ix kp iz ja jb ha bi translated">Sequelize带有一个通用的连接池，而不是公开数据库供应商的连接池实现。这确实意味着您无法获得内置于node-oracledb连接池中的一些高可用性特性。</p><p id="6a42" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Sequelize的连接池可以通过在创建实例时提供池选项来设置，例如:</p><pre class="jd je jf jg fd kq kr ks kt aw ku bi"><span id="d6b6" class="jq jr hh kr b fi kv kw l kx ky">const sequelize = new Sequelize({<br/>  dialect: 'oracle',<br/>  username: &lt;username&gt;,<br/>  password: &lt;password&gt;,<br/>  dialectOptions: {connectString: &lt;connection string&gt;},<br/>  pool: {<br/>    max: 5,<br/>    min: 0,<br/>    acquire: 30000,<br/>    idle: 10000<br/>}});</span></pre><h2 id="19e7" class="jq jr hh bd js jt ju jv jw jx jy jz ka ip kb kc kd it ke kf kg ix kh ki kj kk bi translated">在序列中定义模型</h2><p id="e3a4" class="pw-post-body-paragraph ie if hh ig b ih kl ij ik il km in io ip kn ir is it ko iv iw ix kp iz ja jb ha bi translated">Sequelize中的模型代表一个数据库表，它告诉我们关于它所代表的实体的一些事情，比如表的名称、它所包含的列以及它们的数据类型。模型是Sequelize的主要特性之一，它将数据库表抽象成JavaScript对象。</p><pre class="jd je jf jg fd kq kr ks kt aw ku bi"><span id="5f96" class="jq jr hh kr b fi kv kw l kx ky">// This defines a model for 'person'.<br/>// The keys in the parameter represent the database column names<br/>// and the values set the column configurations.<br/>// This example creates the database table PERSON with<br/>// columns ID, NAME, AGE, and HEIGHT.</span><span id="1d3c" class="jq jr hh kr b fi kz kw l kx ky">person_object = sequelize.define('person', {<br/>  ID: {<br/>    type: DataTypes.INTEGER,  // maps to INTEGER<br/>    autoIncrement: true,      // automatically increment the value<br/>    primaryKey: true,         // this is the table's primary key<br/>    allowNull: false,         // value cannot be null<br/>  },<br/>  NAME: {<br/>    type: DataTypes.STRING,   // maps to VARCHAR2<br/>    allowNull: false,         // value cannot be null<br/>  },<br/>  AGE: {<br/>    type: DataTypes.INTEGER,  // maps to INTEGER<br/>    allowNull: true,          // value can be null<br/>  },<br/>  HEIGHT: {<br/>    type: DataTypes.DECIMAL,  // maps to NUMBER<br/>    allowNull: true,          // value can be null<br/>  }<br/>});</span></pre><p id="0e0c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">更多信息请参考<a class="ae jp" href="https://sequelize.org/docs/v6/core-concepts/model-basics/#using-sequelizedefine" rel="noopener ugc nofollow" target="_blank">https://sequelize . org/docs/V6/core-concepts/model-basics/# using-sequelize define</a></p><p id="dfdb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Oracle方言的数据类型映射可以在<a class="ae jp" href="https://github.com/sequelize/sequelize/blob/v6/src/dialects/oracle/data-types.js" rel="noopener ugc nofollow" target="_blank">https://github . com/sequelize/sequelize/blob/V6/src/dialects/Oracle/data-types . js</a>中找到</p><h2 id="99cf" class="jq jr hh bd js jt ju jv jw jx jy jz ka ip kb kc kd it ke kf kg ix kh ki kj kk bi translated">模型同步</h2><p id="3f88" class="pw-post-body-paragraph ie if hh ig b ih kl ij ik il km in io ip kn ir is it ko iv iw ix kp iz ja jb ha bi translated">模型可以通过调用<code class="du la lb lc kr b"><a class="ae jp" href="https://sequelize.org/master/class/src/model.js~Model.html#static-method-sync" rel="noopener ugc nofollow" target="_blank">model.sync(options)</a></code>与数据库同步。这通过执行SQL语句对数据库进行更改。</p><ul class=""><li id="6d92" class="ld le hh ig b ih ii il im ip lf it lg ix lh jb li lj lk ll bi translated"><code class="du la lb lc kr b">User.sync()</code> -如果不存在，则创建一个表(如果已经存在，则不做任何事情)</li><li id="0d84" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated"><code class="du la lb lc kr b">User.sync({ force: true })</code> -这将创建一个表格，如果它已经存在，首先删除它</li><li id="b731" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated"><code class="du la lb lc kr b">User.sync({ alter: true })</code> -检查数据库中一个表的当前状态(它有哪些列，它们的数据类型是什么，等等)，然后在表中执行必要的更改，使它与模型相匹配。</li></ul><p id="c9ef" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一个例子是:</p><pre class="jd je jf jg fd kq kr ks kt aw ku bi"><span id="a613" class="jq jr hh kr b fi kv kw l kx ky">// Refresh the database to the Sequelize models defined<br/>await sequelize.sync({force: true});</span></pre><p id="7f5a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有关更多信息，请参考<a class="ae jp" href="https://sequelize.org/docs/v6/core-concepts/model-basics/#model-synchronization" rel="noopener ugc nofollow" target="_blank">https://sequel ize . org/docs/V6/core-concepts/model-basics/# model-synchron ization</a></p><h2 id="007d" class="jq jr hh bd js jt ju jv jw jx jy jz ka ip kb kc kd it ke kf kg ix kh ki kj kk bi translated">使用Sequelize在Oracle数据库表中插入多行</h2><p id="728d" class="pw-post-body-paragraph ie if hh ig b ih kl ij ik il km in io ip kn ir is it ko iv iw ix kp iz ja jb ha bi translated">在Sequelize中，您可以使用<code class="du la lb lc kr b"><a class="ae jp" href="https://sequelize.org/api/v6/class/src/model.js~model#static-method-bulkCreate" rel="noopener ugc nofollow" target="_blank">Model.bulkCreate()</a></code>方法通过一条SQL语句有效地创建多条记录。Oracle方言将<code class="du la lb lc kr b">bulkCreate()</code>映射到node-oracledb的<code class="du la lb lc kr b"><a class="ae jp" href="https://oracle.github.io/node-oracledb/doc/api.html#batchexecution" rel="noopener ugc nofollow" target="_blank">executeMany()</a></code>函数来获得这种效率。</p><pre class="jd je jf jg fd kq kr ks kt aw ku bi"><span id="fb58" class="jq jr hh kr b fi kv kw l kx ky">// Sequelize way to insert multiple rows to the table.<br/>// The build() function is a helper to read the data from <br/>// a CSV file into the format expected by Sequelize<br/>await census.bulkCreate(build(cols, rows));</span></pre><p id="fd37" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">更多信息请参考<a class="ae jp" href="https://sequelize.org/docs/v6/core-concepts/model-querying-basics/#creating-in-bulk" rel="noopener ugc nofollow" target="_blank">https://sequel ize . org/docs/V6/core-concepts/model-query-basics/#批量创建</a></p><h2 id="e26c" class="jq jr hh bd js jt ju jv jw jx jy jz ka ip kb kc kd it ke kf kg ix kh ki kj kk bi translated">使用Sequelize查询Oracle数据库</h2><p id="3c31" class="pw-post-body-paragraph ie if hh ig b ih kl ij ik il km in io ip kn ir is it ko iv iw ix kp iz ja jb ha bi translated">您可以使用Sequelize的<code class="du la lb lc kr b"><a class="ae jp" href="https://sequelize.org/api/v6/class/src/model.js~model#static-method-findAll" rel="noopener ugc nofollow" target="_blank">findAll()</a></code>方法来查询数据库表。它支持各种选项。下面的查询示例通过将结果限制在离所提供的偏移量10行的范围内来进行分页。</p><pre class="jd je jf jg fd kq kr ks kt aw ku bi"><span id="5222" class="jq jr hh kr b fi kv kw l kx ky">// Query the database for 10 rows starting from the offset<br/>const rows = await census.findAll({<br/>  order: ['id'],<br/>  limit: 10,<br/>  offset: (currentPage - 1) * 10<br/>});</span></pre><h2 id="e94a" class="jq jr hh bd js jt ju jv jw jx jy jz ka ip kb kc kd it ke kf kg ix kh ki kj kk bi translated">结论</h2><p id="0a28" class="pw-post-body-paragraph ie if hh ig b ih kl ij ik il km in io ip kn ir is it ko iv iw ix kp iz ja jb ha bi translated">我们很高兴Oracle方言现在包含在Sequelize中。让我们知道你建造的所有伟大的东西。</p><h2 id="3dd4" class="jq jr hh bd js jt ju jv jw jx jy jz ka ip kb kc kd it ke kf kg ix kh ki kj kk bi translated">资源</h2><ul class=""><li id="7502" class="ld le hh ig b ih kl il km ip lr it ls ix lt jb li lj lk ll bi translated"><a class="ae jp" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js </a></li><li id="3c13" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated"><a class="ae jp" href="https://sequelize.org/" rel="noopener ugc nofollow" target="_blank">Sequelize.org</a></li><li id="2d0f" class="ld le hh ig b ih lm il ln ip lo it lp ix lq jb li lj lk ll bi translated"><a class="ae jp" href="https://oracle.github.io/node-oracledb/" rel="noopener ugc nofollow" target="_blank">用于Oracle数据库的节点oracledb驱动程序</a></li></ul><h1 id="b95b" class="lu jr hh bd js lv lw lx jw ly lz ma ka mb mc md kd me mf mg kg mh mi mj kj mk bi translated">加入对话！</h1><p id="b189" class="pw-post-body-paragraph ie if hh ig b ih kl ij ik il km in io ip kn ir is it ko iv iw ix kp iz ja jb ha bi translated">如果你对甲骨文开发人员在他们的自然栖息地发生的事情感到好奇，请加入我们的公共休闲频道！我们不介意成为你的鱼缸🐠</p></div></div>    
</body>
</html>