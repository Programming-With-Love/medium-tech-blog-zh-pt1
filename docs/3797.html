<html>
<head>
<title>How To Create and Deploy a Python Azure Function Using Azure DevOps CI/CD</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Azure DevOps CI/CD创建和部署Python Azure函数</h1>
<blockquote>原文：<a href="https://medium.com/globant/how-to-create-and-deploy-a-python-azure-function-using-azure-devops-ci-cd-2aa8f8675716?source=collection_archive---------0-----------------------#2021-12-22">https://medium.com/globant/how-to-create-and-deploy-a-python-azure-function-using-azure-devops-ci-cd-2aa8f8675716?source=collection_archive---------0-----------------------#2021-12-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="305f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Azure函数是一种在云中运行小段代码的简单方式。您不必担心托管这些代码所需的基础设施。您可以用C#、Java、JavaScript、PowerShell、Python或Azure Functions 文章中的<a class="ae jc" href="https://docs.microsoft.com/en-us/azure/azure-functions/supported-languages" rel="noopener ugc nofollow" target="_blank">支持的语言中列出的任何语言来编写函数。</a></p><p id="34db" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当您将Azure功能部署到生产环境时，有许多部署策略，您的部署策略完全取决于您的应用程序架构和您使用的DevOps工具。例如，如果您正在使用Jenkins，您可以设置构建管道并在Jenkins中部署应用程序。</p><p id="844c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用Azure DevOps，你就有了一个现成的模板来部署你的功能app。在这篇文章中，我们将看到如何使用Azure DevOps部署Azure function应用程序。</p><ul class=""><li id="1d74" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated"><em class="jm">简介</em></li><li id="40f1" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated"><em class="jm">先决条件</em></li><li id="ef03" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated"><em class="jm">创建本地项目</em></li><li id="1a98" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated"><em class="jm">打造Azure功能App。</em></li><li id="eeb3" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated"><em class="jm">建立管道</em></li><li id="2648" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated"><em class="jm">释放管道</em></li><li id="ab93" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated"><em class="jm">演示</em></li><li id="c9cb" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated"><em class="jm">总结</em></li><li id="8122" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated"><em class="jm">结论</em></li></ul><h1 id="9c7d" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak"> 1-简介</strong></h1><p id="1f28" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">函数应用程序包含您的函数代码所在的单个函数。每个函数应用程序包含一个或多个函数作为单独的端点。当功能应用的授权级别为匿名时，您可以直接从互联网访问功能应用端点。</p><p id="9821" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以使用针对Visual Studio代码的<a class="ae jc" href="https://marketplace.visualstudio.com/items?itemName=ms-azuretools.vscode-azurefunctions" rel="noopener ugc nofollow" target="_blank"> Azure Functions扩展</a>直接将我们的Azure函数从VSCode部署到function app。但是，当您在团队中工作时，直接从本地机器部署并不是一个理想的解决方案。我们需要建立一个渠道，让整个团队能够合作。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es kv"><img src="../Images/edb1fa090702faa855518c47734ebc01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*AYzeuwisQFuGmuYq"/></div></div></figure><p id="d790" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">我们必须构建两条管道来使用Azure DevOps部署该应用程序:构建管道和发布管道</strong></p><h2 id="8e56" class="lh jt hh bd ju li lj lk jy ll lm ln kc ip lo lp kg it lq lr kk ix ls lt ko lu bi translated">构建管道</h2><p id="4de5" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">该管道从Azure Repos或任何版本控制中获取代码，并经历一系列操作，如安装、测试、构建以及最终生成为部署做好准备的工件。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lv"><img src="../Images/4da980f1f0bd091bdd80d9fb2947e3b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HrdjIGBocEPSpsbk"/></div></div></figure><h2 id="332d" class="lh jt hh bd ju li lj lk jy ll lm ln kc ip lo lp kg it lq lr kk ix ls lt ko lu bi translated">释放管道</h2><p id="35ac" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">这个管道获取工件，并将其部署到功能应用程序中。您可以拥有发布到生产环境的预部署条件，如批准、部署触发器等。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lw"><img src="../Images/59a7791d947fa7c73adbe333e9d1a543.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*K5z91o-TCALGtd_e"/></div></div></figure><h1 id="5c01" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak"> 2-先决条件</strong></h1><p id="dc6a" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">首先，您需要设置一个Microsoft Azure帐户来使用Function App Service部署代码。让我们通过下面的链接创建帐户。</p><ul class=""><li id="9b20" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated"><a class="ae jc" href="https://azure.microsoft.com/en-us/" rel="noopener ugc nofollow" target="_blank">微软Azure账户</a></li><li id="98e9" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated"><a class="ae jc" href="https://azure.microsoft.com/en-us/services/devops/" rel="noopener ugc nofollow" target="_blank">登录Azure DevOps </a></li><li id="fba4" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated">Visual Studio代码</li><li id="0321" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated"><a class="ae jc" href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-run-local#install-the-azure-functions-core-tools" rel="noopener ugc nofollow" target="_blank"> Azure Functions核心工具</a>3 . x版本</li><li id="5172" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated">Visual Studio代码的<a class="ae jc" href="https://marketplace.visualstudio.com/items?itemName=ms-python.python" rel="noopener ugc nofollow" target="_blank"> Python扩展</a>。</li><li id="e1c8" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated">针对Visual Studio代码的Azure函数应用程序扩展。</li><li id="800e" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated"><a class="ae jc" href="https://git-scm.com/downloads" rel="noopener ugc nofollow" target="_blank">用于Windows的GIT</a></li><li id="f480" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated"><a class="ae jc" href="https://docs.microsoft.com/en-us/azure/azure-functions/" rel="noopener ugc nofollow" target="_blank">Azure上的功能App</a>。</li></ul><h1 id="0b72" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak"> 3-创建本地项目</strong></h1><p id="756d" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">在本节中，您将使用Visual Studio代码在Python中创建本地Azure Functions项目。在本文的后面，您将向Azure发布您的函数代码。</p><ol class=""><li id="077a" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb lx jj jk jl bi translated">在活动栏中选择Azure图标，然后在<strong class="ig hi"> Azure: Functions区域</strong>中选择“创建新项目…”图标。</li></ol><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es ly"><img src="../Images/64315c2771ed732c18a9df2dfd034be8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1188/0*Xzm2IsKbZfISMv0r"/></div></div></figure><p id="de84" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.为项目工作环境选择一个目录位置，然后选择“选择”。</p><p id="786f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3.根据提示提供以下信息:</p><ul class=""><li id="c36b" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated"><em class="jm">为你的函数项目选择一种语言:选择</em> <strong class="ig hi"> <em class="jm"> Python。</em> </strong></li><li id="44f9" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated">选择一个Python别名来创建一个虚拟环境:选择您的Python解释器的位置。如果没有显示位置，输入Python二进制文件的完整路径。</li><li id="9e4f" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated"><em class="jm">为你的项目的第一个函数选择一个模板:选择</em> <strong class="ig hi"> <em class="jm"> HTTP触发器。</em> </strong></li><li id="18d7" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated"><em class="jm">提供一个函数名:Type </em> <strong class="ig hi"> <em class="jm"> HttpExample。</em> </strong></li><li id="8147" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated"><em class="jm">授权级别:选择</em> <strong class="ig hi"> <em class="jm">匿名</em> </strong> <em class="jm">，使得任何人都可以调用你的函数端点。选择您希望如何打开您的项目:选择</em> <strong class="ig hi"> <em class="jm">添加到工作区。</em>T48】</strong></li></ul><p id="44ed" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">4.使用这些信息，Visual Studio代码生成一个带有HTTP触发器的Azure Functions项目。您可以在浏览器中查看本地项目文件。</p><h2 id="55e9" class="lh jt hh bd ju li lj lk jy ll lm ln kc ip lo lp kg it lq lr kk ix ls lt ko lu bi translated">在本地运行该功能</h2><p id="b8f2" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">Visual Studio代码与<a class="ae jc" href="https://docs.microsoft.com/en-us/azure/azure-functions/functions-run-local" rel="noopener ugc nofollow" target="_blank">Azure Functions Core tools</a>集成，让你在自己的计算机上本地运行这个项目。</p><ol class=""><li id="bab1" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb lx jj jk jl bi translated">按<em class="jm"> F5 </em>启动功能app项目。核心工具的输出显示在终端面板中。您的应用程序在终端面板中启动。您可以看到本地运行的HTTP触发函数的URL端点。</li></ol><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es lz"><img src="../Images/ce023846f9f97da35ed963143d8e1e69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3P1TlBn0Vn0xXQpG"/></div></div></figure><p id="cbe6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.运行核心工具，进入Azure: Functions区域。在“函数”下，展开“本地项目”&gt;“函数”。右键单击(Windows)<strong class="ig hi">HttpExampleProject</strong>函数并选择立即执行函数。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es ma"><img src="../Images/5854a9178fbb5f32bf971ce5bb553947.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/0*etyUpG_k_whoHvYV"/></div></figure><p id="b8d9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3.在“输入请求正文”中，您会看到请求消息正文值<strong class="ig hi">{“name”:“Azure”}</strong>。按回车键将此请求消息发送到您的函数。</p><p id="22fe" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">4.当函数在本地执行并返回响应时，Visual Studio代码中会引发一个通知。有关功能执行的信息显示在终端面板中。</p><p id="3fdc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">5.按Ctrl + C停止核心工具并断开调试器。</p><p id="93ca" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在您验证了该函数在本地计算机上正确运行后，就可以使用Azure DevOps来创建CI/CD管道，以将该函数部署到Azure Function App。</p><p id="9dbd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在Azure Devops中创建管道之前，首先我们需要在Azure Portal上创建一个功能应用程序，如下所示:</p><h1 id="1564" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak"> 4-创建Azure功能应用</strong></h1><p id="f4ae" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">登录门户网站，点击<strong class="ig hi">创建资源</strong>，或者您可以从搜索栏中搜索函数app，以创建并给出必填字段，如app名称、存储帐户、资源组、运行时堆栈等。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es mb"><img src="../Images/70831404ea6557ec7cd2e4a4055b7255.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*80sa-mlFhRJhWEnZ"/></div></div></figure><p id="1866" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您的设置应该会在一段时间后完成。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es mc"><img src="../Images/7eca74a6a78a8b6a475dd48ca05af950.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VpE806H0CSQzuGgR"/></div></div></figure><p id="84b9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是创建的函数应用程序，只要它的授权级别是匿名的，您就可以使用该URL访问API。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es md"><img src="../Images/b7bb1b1d320d99be307234cb11282daa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fKUJR1JAR5vp0unC"/></div></div></figure><h1 id="0c14" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">5-建立管道</h1><p id="b1b8" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">我们需要首先构建管道作为持续集成的一部分。这个管道的工作方式是，当你将代码签入Github或Azure Repos时，这个管道构建项目，测试它，并使构建工件为部署做好准备。让我们按照所有的步骤来设置这个管道。</p><ol class=""><li id="16d5" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb lx jj jk jl bi translated">在Azure DevOps中创建项目</li><li id="88ef" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb lx jj jk jl bi translated">创建一个Repo并将你的代码放入Azure Repos</li><li id="327b" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb lx jj jk jl bi translated">创建一个从源存储库中获取数据的管道。</li><li id="e60d" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb lx jj jk jl bi translated">安装所有依赖项</li><li id="184f" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb lx jj jk jl bi translated">运行测试</li><li id="ef44" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb lx jj jk jl bi translated">构建代码</li><li id="644c" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb lx jj jk jl bi translated">从源复制文件用于暂存</li><li id="b685" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb lx jj jk jl bi translated">存档所有复制的文件</li><li id="3c01" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb lx jj jk jl bi translated">最后，发布神器。</li><li id="4cd2" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb lx jj jk jl bi translated">启用与触发器的持续集成</li></ol><p id="31a1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们在您的Azure DevOps帐户中创建一个项目。我将这个项目命名为<strong class="ig hi"> Azure_function_demo </strong>，这是一个私有项目。您可以根据自己选择的可见性将项目设为公共或私有。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es md"><img src="../Images/5008d73b801187c6b5dc5dc82db3598d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*cu8Xpl2c1u7iYu6u"/></div></div></figure><h2 id="c4c5" class="lh jt hh bd ju li lj lk jy ll lm ln kc ip lo lp kg it lq lr kk ix ls lt ko lu bi translated">将您的代码放在Azure Repos中</h2><p id="74d3" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">是时候创建一个repo了，将上面示例项目中的所有代码放到这个repo中。我创建了一个名为<strong class="ig hi"> Azure_function_demo </strong>的repo，并将所有代码推送到这个repo中。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es md"><img src="../Images/d7fb38f766d5deef554ef16ca7040ab4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fXaHVwGLqEkgF4rr"/></div></div></figure><h2 id="a66c" class="lh jt hh bd ju li lj lk jy ll lm ln kc ip lo lp kg it lq lr kk ix ls lt ko lu bi translated">创建生成管道</h2><p id="ec52" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">让我们通过选择一个源和存储库分支，并通过选择一个经典编辑器来创建一个管道。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es md"><img src="../Images/1677275ebb561b0d629dc15a83408d92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*gleBXImSD1z0WVcs"/></div></div></figure><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es md"><img src="../Images/3b50d2c2ce30a31e8bb4c1199c1ddaab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*8XSeivoKOaY01Dy-"/></div></div></figure><p id="64f6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在下一页，为Python模板选择Azure函数，因为Azure为我们提供了现成的模板。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es md"><img src="../Images/e00d2b5eb966e04d6844b48728daae46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ptPS8LMXEvpS0d5L"/></div></div></figure><p id="c2dc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">单击“应用”按钮后，您可以看到包含所有这些任务的下一个屏幕。您可以根据需要更改管线名称。我已经改成Azure_function_demo-CI了。如果您注意到它使用Python版的任务，安装依赖项、构建扩展、归档文件并发布工件。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es md"><img src="../Images/1663fac40f30d0a8eed4ba9f6beedcc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZkK5sxqvyUvXVQZS"/></div></div></figure><p id="375a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">点击保存将此保存到任何文件夹中。让我们来定义触发器。</p><h2 id="1dc9" class="lh jt hh bd ju li lj lk jy ll lm ln kc ip lo lp kg it lq lr kk ix ls lt ko lu bi translated">定义触发器</h2><blockquote class="me mf mg"><p id="338d" class="ie if jm ig b ih ii ij ik il im in io mh iq ir is mi iu iv iw mj iy iz ja jb ha bi translated">让我们来定义这个构建的触发器。单击触发器选项卡，并启用持续集成。对Azure_function_demo repo主分支的任何提交都会触发此管道。</p></blockquote><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es md"><img src="../Images/ec68cbd23c373399bc6c4b70c462ea17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2gQ8vvhVaa25IgKQ"/></div></div></figure><p id="35c8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这次让我们通过单击队列来手动构建管道。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es md"><img src="../Images/05f9d4171ea160b2fdc535dd59f762f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*3MGrdj0i0QN8dhep"/></div></div></figure><p id="cffc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">单击代理作业1查看结果。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es md"><img src="../Images/5b868bf5b5fd24780ea15ad5b9a3105a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TWjc8YIFVwhE_dwj"/></div></div></figure><p id="08bb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">单击日志屏幕中的工件链接。您将能够在如下的zip文件中看到创建的工件。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es md"><img src="../Images/be86b91a4333bfbb3d94ab6df05f210d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zhOyHC7OMcbwM-hP"/></div></div></figure><p id="c923" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以下载zip文件来交叉验证您创建的所有函数是否都在其中。</p><h1 id="c0e6" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">6-释放管道</h1><p id="dd68" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">我们已经完成了持续集成部分，让我们为持续交付构建一个发布管道。单击“发布”、“新发布”,然后按照下面的说明进行操作。</p><ol class=""><li id="93a5" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb lx jj jk jl bi translated">定义工件。</li><li id="b6e4" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb lx jj jk jl bi translated">选择用于部署的模板。</li><li id="4827" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb lx jj jk jl bi translated">给舞台起个名字。</li><li id="207e" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb lx jj jk jl bi translated">定义舞台上的任务。</li><li id="337f" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb lx jj jk jl bi translated">添加工件。</li><li id="568b" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb lx jj jk jl bi translated">启用持续部署的触发器。</li></ol><h2 id="8845" class="lh jt hh bd ju li lj lk jy ll lm ln kc ip lo lp kg it lq lr kk ix ls lt ko lu bi translated">定义工件</h2><p id="f381" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">第一步是定义工件，以便它在构建管道完成后获取特定的工件。确保你有一个触发器。</p><p id="1dd5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当您点击发布时，您会看到一个带有新管道按钮的空白页面。点击它来创建一个新的发布管道。选择一个名为<strong class="ig hi"> <em class="jm">的模板，将一个功能app部署到Azure Functions。</em>T3】</strong></p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es md"><img src="../Images/ac06a67cff3f5c16c9c763b45e65671c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*L8nyOrPAXef3Q-zN"/></div></div></figure><p id="133d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你可以说出艺名。我把它命名为戴夫。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es md"><img src="../Images/69eee0e61676dc551389c75eead42999.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0tPzHmhgyVUcvuGV"/></div></div></figure><p id="8f77" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">单击阶段的作业任务部分以定义任务。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es md"><img src="../Images/5d47c36dccc02f0d68664c92f34d2cfd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PJ27dpt2RR7XIxEK"/></div></div></figure><p id="a50b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们需要通过选择源管道来添加工件</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es md"><img src="../Images/50b2e93e88e3d5efcd5ded1ae46ef38e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5x2o8_EhgeF1ByfX"/></div></div></figure><p id="75d8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">添加之后，您就可以定义触发器了。点击闪光图标</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es md"><img src="../Images/c40a99201bcff540ff20d4bcf6ed5b3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*G-9K36qpY8tKbxHY"/></div></div></figure><h1 id="12c1" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">7-演示</h1><p id="02cd" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">演示时间到了。一旦您将代码签入到master，它就会触发构建管道。通常，您不直接将代码签入master，而是创建一个pull请求。为了简单起见，我使用了主分支。</p><p id="7f93" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我手动触发构建管道，然后自动触发发布管道。一旦构建完成，创建的工件将触发发布管道。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es md"><img src="../Images/7d471fcd99e2c91cceda6fa2e9316720.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Im4ZdYPikCqMCOBe"/></div></div></figure><p id="2a86" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦成功，就可以去门户里的功能app验证功能了。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es md"><img src="../Images/8cf2ae826e76eaf5e135faafe97fc871.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Gc4of4G-h5lywEOd"/></div></div></figure><p id="0af1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以直接在门户中测试该函数，也可以使用函数URL并在浏览器或postman中点击它。您可以从门户以及使用函数URL看到下面的响应。</p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es md"><img src="../Images/d1b882d1b907b30a630c519a286f106a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Kda47howgqbqvhj_"/></div></div></figure><p id="fbdf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">点击下面已部署功能的URL后，您将看到下面的响应。</p><p id="c791" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"><em class="jm">https://demo-fun-API . azure websites . net/API/HTTPExampleProject？</em>name = Abhilash</strong></p><figure class="kw kx ky kz fd la er es paragraph-image"><div role="button" tabindex="0" class="lb lc di ld bf le"><div class="er es mk"><img src="../Images/b91947317d02f841a07b6862730b22f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6vGrTWsZRooXaTQo"/></div></div></figure><h1 id="c1bf" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">8-摘要</h1><ul class=""><li id="86d3" class="jd je hh ig b ih kq il kr ip ml it mm ix mn jb ji jj jk jl bi translated">构建Python REST API的一种方式是使用Azure function app。</li><li id="82a1" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated">当你将Azure功能部署到产品中时，有很多部署策略。部署策略完全取决于您的应用程序架构和您使用的DevOps工具。</li><li id="4db9" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated">使用Azure DevOps，您就有了一个现成的模板来部署您的功能应用程序。</li><li id="0363" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated">您必须构建两条管道来使用Azure DevOps部署此应用程序:构建管道和发布管道。</li><li id="f2fd" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated">只要源存储库中有一个提交，构建管道就会生成工件。</li><li id="8c0b" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated">发布管道获取工件并将其发布到适当的环境中。</li><li id="fc27" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated">应该提供/创建适当的服务连接，以便与管道一起工作，实现身份验证目的</li><li id="98c2" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated">您可以使用任务组将常见任务放在整个环境中的一个位置。</li><li id="a00b" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated">您可以使用Azure key vault来存储您的存储帐户的访问密钥。</li><li id="1e50" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb ji jj jk jl bi translated">您可以在创建任务时利用管道变量。这是将关键数据放入管道各个阶段的便捷方式。</li></ul><h1 id="377a" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">9-结论</h1><p id="6d4f" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">这是使用Azure DevOps部署功能app的基本方式。我没有在这些管道中使用变量、Azure key vault、任务组，因为我们正在部署到一个环境中。这些超出了本文的范围。</p><h1 id="6d42" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated"><strong class="ak">参考文献</strong></h1><ol class=""><li id="ea6e" class="jd je hh ig b ih kq il kr ip ml it mm ix mn jb lx jj jk jl bi translated"><a class="ae jc" href="https://docs.microsoft.com/en-us/azure/azure-functions/create-first-function-vs-code-csharp?tabs=in-process" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-us/azure/azure-functions/create-first-function-vs-code-cs harp？tabs =进程中</a></li><li id="5020" class="jd je hh ig b ih jn il jo ip jp it jq ix jr jb lx jj jk jl bi translated"><a class="ae jc" href="https://docs.microsoft.com/en-in/azure/developer/javascript/tutorial/vscode-function-app-http-trigger/tutorial-vscode-serverless-node-test-local" rel="noopener ugc nofollow" target="_blank">https://docs . Microsoft . com/en-in/azure/developer/JavaScript/tutorial/vs code-function-app-http-trigger/tutorial-vs code-server less-node-test-local</a></li></ol><figure class="kw kx ky kz fd la er es paragraph-image"><div class="er es mo"><img src="../Images/a2688d22b350678deaf6bf43981dff4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:590/format:webp/1*LcjMehQpMwkS4L550sBqig.png"/></div><figcaption class="mp mq et er es mr ms bd b be z dx">Visit us at <a class="ae jc" href="https://www.globant.com/studio/cloud-ops" rel="noopener ugc nofollow" target="_blank">https://www.globant.com/studio/cloud-ops</a></figcaption></figure></div></div>    
</body>
</html>