<html>
<head>
<title>Introduction to Liquibase and Managing Your Database Source Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Liquibase介绍和管理您的数据库源代码</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/introduction-to-liquibase-and-managing-your-database-source-code-70f0ec634542?source=collection_archive---------0-----------------------#2017-10-16">https://medium.com/oracledevs/introduction-to-liquibase-and-managing-your-database-source-code-70f0ec634542?source=collection_archive---------0-----------------------#2017-10-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="cf24" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在之前的博客中，我展示了如何借助Oracle开发者云服务 ( <a class="ae jc" href="https://cloud.oracle.com/developer_service" rel="noopener ugc nofollow" target="_blank"> DevCS </a>)作为整体Oracle DB DevOps解决方案的一部分来<a class="ae jc" href="http://blogs.oracle.com/developers/lifecycle-management-and-devops-for-oracle-databases" rel="noopener ugc nofollow" target="_blank">管理SQL脚本生命周期。我想再添加一个实用程序，作为SQL脚本管理的替代或补充——liqui base。</a></p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/c95ac55fbbf5b7579996a687f5ccc8a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:428/format:webp/0*0L_MR9G3K8n5I2GL.png"/></div></figure><p id="2b94" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jc" href="http://www.liquibase.org/" rel="noopener ugc nofollow" target="_blank"> <strong class="ig hi"> Liquibase </strong> </a>是一个用于管理数据库模式脚本修订的开源解决方案。它跨各种类型的数据库工作，并支持用于定义DB结构的各种文件格式。Liquibase中最吸引人的特性可能是它从特定点回滚和前滚更改的能力——使您不必知道在特定数据库实例上运行的最后一次更改/脚本是什么。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jl"><img src="../Images/d9ac86b88ec822d1b4d6dd544c17299c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*OpmIVbmOQ6BYKdUZZIJIwg.png"/></div></figure><p id="9ea1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Liquibase使用脚本(称为“变更集”)来管理您对数据库所做的更改。变更集文件可以是各种格式，包括XML、JSON、YAML和SQL。在下面的例子中，我使用的是XML格式。</p><p id="9b07" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">随着您在开发生命周期中不断更改和增强您的数据库结构，您将添加更多的变更集。主文件列出了所有变更集文件(或它们所在的目录)。并行Liquibase跟踪数据库中已经运行的变更集。</p><p id="04d7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当您发出liquibase <strong class="ig hi"> update </strong>命令时，liquibase会查看数据库的当前状态，并识别已经发生了哪些更改。然后，它运行其余的更改——让您看到正在定义的结构的最新版本。</p><p id="07c3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通过将Liquibase集成到您的整体代码版本管理系统和持续集成平台中，您可以将数据库版本与应用程序版本同步。对我来说，这当然意味着与Oracle开发人员云服务(DevCS)的集成，您可以通过Oracle数据库云服务免费获得DevCS。在下面的视频中，我展示了一个流程，包括:</p><ul class=""><li id="9745" class="jm jn hh ig b ih ii il im ip jo it jp ix jq jb jr js jt ju bi translated">在问题系统中跟踪我的DBA任务</li><li id="eea3" class="jm jn hh ig b ih jv il jw ip jx it jy ix jz jb jr js jt ju bi translated">用Liquibase修改本地MySQL数据库(进行前滚和后滚)</li><li id="8ed3" class="jm jn hh ig b ih jv il jw ip jx it jy ix jz jb jr js jt ju bi translated">添加定义新表的变更集</li><li id="b0a8" class="jm jn hh ig b ih jv il jw ip jx it jy ix jz jb jr js jt ju bi translated">致力于Git</li><li id="61c1" class="jm jn hh ig b ih jv il jw ip jx it jy ix jz jb jr js jt ju bi translated">在Oracle数据库云服务中实施变更的自动构建</li><li id="fa98" class="jm jn hh ig b ih jv il jw ip jx it jy ix jz jb jr js jt ju bi translated">使用UT/PLSQL进行自动测试</li></ul><p id="1016" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是一个10分钟的快速演示:</p><figure class="je jf jg jh fd ji"><div class="bz dy l di"><div class="ka kb l"/></div></figure><p id="2b1f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于那些想要尝试和复制这一点的人，这里有一些资源。</p><p id="f7f4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建包含三列的“department”表的变更集:</p><pre class="je jf jg jh fd kc kd ke kf aw kg bi"><span id="fe6f" class="kh ki hh kd b fi kj kk l kl km">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;databaseChangeLog ae jc" href="http://www.liquibase.org/xml/ns/dbchangelog" rel="noopener ugc nofollow" target="_blank"&gt;http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="<a class="ae jc" href="http://www.liquibase.org/xml/ns/dbchangelog-ext" rel="noopener ugc nofollow" target="_blank">http://www.liquibase.org/xml/ns/dbchangelog-ext</a>" xmlns:xsi="<a class="ae jc" href="http://www.w3.org/2001/XMLSchema-instance" rel="noopener ugc nofollow" target="_blank">http://www.w3.org/2001/XMLSchema-instance</a>" xsi:schemaLocation="<a class="ae jc" href="http://www.liquibase.org/xml/ns/dbchangelog" rel="noopener ugc nofollow" target="_blank">http://www.liquibase.org/xml/ns/dbchangelog</a> <a class="ae jc" href="http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd" rel="noopener ugc nofollow" target="_blank">http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd</a> <a class="ae jc" href="http://www.liquibase.org/xml/ns/dbchangelog-ext" rel="noopener ugc nofollow" target="_blank">http://www.liquibase.org/xml/ns/dbchangelog-ext</a> <a class="ae jc" href="http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd" rel="noopener ugc nofollow" target="_blank">http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd</a>"&gt;<br/>   &lt;changeSet id="0" author="shay"&gt;<br/>      &lt;createTable tableName="department"&gt;<br/>         &lt;column name="id" type="int"&gt;<br/>            &lt;constraints primaryKey="true" nullable="false" /&gt;<br/>         &lt;/column&gt;<br/>         &lt;column name="name" type="varchar(50)"&gt;<br/>            &lt;constraints nullable="false" /&gt;<br/>         &lt;/column&gt;<br/>         &lt;column name="active" type="boolean" defaultValueBoolean="true" /&gt;<br/>      &lt;/createTable&gt;<br/>   &lt;/changeSet&gt;<br/>&lt;/databaseChangeLog&gt;</span></pre><p id="c3c9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建PL/SQL函数、包和过程的变更集。请注意，第3行中的<strong class="ig hi"> dbms="oracle" </strong>表示该脚本仅在我们连接到oracle数据库时运行:</p><pre class="je jf jg jh fd kc kd ke kf aw kg bi"><span id="c073" class="kh ki hh kd b fi kj kk l kl km">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;databaseChangeLog ae jc" href="http://www.liquibase.org/xml/ns/dbchangelog" rel="noopener ugc nofollow" target="_blank"&gt;http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="<a class="ae jc" href="http://www.liquibase.org/xml/ns/dbchangelog-ext" rel="noopener ugc nofollow" target="_blank">http://www.liquibase.org/xml/ns/dbchangelog-ext</a>" xmlns:xsi="<a class="ae jc" href="http://www.w3.org/2001/XMLSchema-instance" rel="noopener ugc nofollow" target="_blank">http://www.w3.org/2001/XMLSchema-instance</a>" xsi:schemaLocation="<a class="ae jc" href="http://www.liquibase.org/xml/ns/dbchangelog" rel="noopener ugc nofollow" target="_blank">http://www.liquibase.org/xml/ns/dbchangelog</a> <a class="ae jc" href="http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd" rel="noopener ugc nofollow" target="_blank">http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd</a> <a class="ae jc" href="http://www.liquibase.org/xml/ns/dbchangelog-ext" rel="noopener ugc nofollow" target="_blank">http://www.liquibase.org/xml/ns/dbchangelog-ext</a> <a class="ae jc" href="http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd" rel="noopener ugc nofollow" target="_blank">http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd</a>"&gt;<br/>   &lt;changeSet author="shay" id="createProcedure-example" dbms="oracle"&gt;<br/>      &lt;createProcedure&gt;create or replace function betwnstr( a_string varchar2, a_start_pos integer, a_end_pos integer ) return varchar2<br/>is<br/>begin<br/>return substr( a_string, a_start_pos, a_end_pos - a_start_pos+1 );<br/>end;&lt;/createProcedure&gt;<br/>      &lt;createProcedure&gt;create or replace package test_betwnstr as<br/>-- %suite(Between string function)<br/>-- %test(Returns substring from start position to end position)<br/>procedure basic_usage;<br/>end;&lt;/createProcedure&gt;<br/>      &lt;createProcedure&gt;create or replace package body test_betwnstr as<br/>procedure basic_usage is<br/>begin<br/>ut.expect( betwnstr( '1234567', 2, 5 ) ).to_equal('2345');<br/>end;<br/>end;&lt;/createProcedure&gt;<br/>   &lt;/changeSet&gt;<br/>&lt;/databaseChangeLog&gt;</span></pre><p id="ccef" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">向表中添加记录的变更集。<rollback>行有rollback标记，它定义了如何对此插入进行回滚:</rollback></p><pre class="je jf jg jh fd kc kd ke kf aw kg bi"><span id="4e3e" class="kh ki hh kd b fi kj kk l kl km">&lt;?xml version="1.0" encoding="UTF-8"?&gt;<br/>&lt;databaseChangeLog ae jc" href="http://www.liquibase.org/xml/ns/dbchangelog" rel="noopener ugc nofollow" target="_blank"&gt;http://www.liquibase.org/xml/ns/dbchangelog" xmlns:ext="<a class="ae jc" href="http://www.liquibase.org/xml/ns/dbchangelog-ext" rel="noopener ugc nofollow" target="_blank">http://www.liquibase.org/xml/ns/dbchangelog-ext</a>" xmlns:xsi="<a class="ae jc" href="http://www.w3.org/2001/XMLSchema-instance" rel="noopener ugc nofollow" target="_blank">http://www.w3.org/2001/XMLSchema-instance</a>" xsi:schemaLocation="<a class="ae jc" href="http://www.liquibase.org/xml/ns/dbchangelog" rel="noopener ugc nofollow" target="_blank">http://www.liquibase.org/xml/ns/dbchangelog</a> <a class="ae jc" href="http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd" rel="noopener ugc nofollow" target="_blank">http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd</a> <a class="ae jc" href="http://www.liquibase.org/xml/ns/dbchangelog-ext" rel="noopener ugc nofollow" target="_blank">http://www.liquibase.org/xml/ns/dbchangelog-ext</a> <a class="ae jc" href="http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd" rel="noopener ugc nofollow" target="_blank">http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-ext.xsd</a>"&gt;<br/>   &lt;changeSet author="shay" id="4"&gt;<br/>      &lt;insert tableName="department"&gt;<br/>         &lt;column name="id" value="10" /&gt;<br/>         &lt;column name="name" value="Sales" /&gt;<br/>      &lt;/insert&gt;<br/>      &lt;rollback&gt;delete from department where id=10&lt;/rollback&gt;<br/>   &lt;/changeSet&gt;<br/>&lt;/databaseChangeLog&gt;</span></pre><p id="3270" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">关于我的<a class="ae jc" href="https://cloud.oracle.com/developer_service" rel="noopener ugc nofollow" target="_blank"> DevCS </a>项目和构建设置的一些提示。</p><ol class=""><li id="6633" class="jm jn hh ig b ih ii il im ip jo it jp ix jq jb kn js jt ju bi translated">为了简单起见，我将liquibase和JDBC jar文件加载到我的git存储库中——这使得我的构建步骤很容易找到并执行这些文件。我猜你也可以用Maven来托管这些。</li><li id="412e" class="jm jn hh ig b ih jv il jw ip jx it jy ix jz jb kn js jt ju bi translated">我在我的构建中使用了一个密码参数，所以我不需要硬编码密码，为我的构建增加了一点安全性。在您的构建中使用$符号引用参数— <em class="ko"> $password </em></li><li id="990a" class="jm jn hh ig b ih jv il jw ip jx it jy ix jz jb kn js jt ju bi translated">想了解更多关于使用ut/PLSQL自动化测试的知识— <a class="ae jc" href="https://blogs.oracle.com/shay/extending-oracle-database-devops-with-automated-plsql-unit-testing" rel="noopener ugc nofollow" target="_blank">查看这篇博客文章</a>。</li></ol></div><div class="ab cl kp kq go kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="ha hb hc hd he"><p id="858e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="ko">原载于2017年10月16日</em><a class="ae jc" href="https://blogs.oracle.com/shay/introduction-to-liquibase-and-managing-your-database-source-code" rel="noopener ugc nofollow" target="_blank"><em class="ko">blogs.oracle.com</em></a><em class="ko">。</em></p></div></div>    
</body>
</html>