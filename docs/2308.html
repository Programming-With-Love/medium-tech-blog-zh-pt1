<html>
<head>
<title>Today I Learned: Store Emoji pada Mysql</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Today I Learned: Store Emoji pada Mysql</h1>
<blockquote>åŽŸæ–‡ï¼š<a href="https://medium.easyread.co/today-i-learned-store-emoji-pada-mysql-25b9937f5e5?source=collection_archive---------3-----------------------#2018-05-25">https://medium.easyread.co/today-i-learned-store-emoji-pada-mysql-25b9937f5e5?source=collection_archive---------3-----------------------#2018-05-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="8b4b" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">Bug sederhana yang cukup lucu tentang bagaimana menyimpan emoji di Mysql server</h2></div><figure class="kc kd ke kf gt kg gh gi paragraph-image"><div class="ab gu cl kh"><img src="../Images/c22cbc3f01bae72a9c1c89373c214501.png" data-original-src="https://miro.medium.com/v2/format:webp/1*57FMtR88ueSTPH9xNODrrw.png"/></div></figure><p id="8c77" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">Hari ini saya dan team saya di <a class="ae lg" href="http://kurio.co/article-feed" rel="noopener ugc nofollow" target="_blank"> Kurio </a> , baru mempelajari sebuah hal yang <em class="lh"> sedikit lucu </em> berkaitan dengan proses <em class="lh"> encoding charset </em> dan <em class="lh"> collation </em> pada <em class="lh"> Mysql </em> . Hal ini berawal saat salah satu dari <em class="lh"> microservice </em> kami memiliki fungsi menyimpan data, dan data yang akan disimpan berbentuk emoji. Sekilas terlihat baik-baik saja, namun hal aneh justru terjadi.</p><pre class="kc kd ke kf gt li lj lk ll aw lm bi"><span id="ef20" class="ln lo in lj b gy lp lq l lr ls">// Data yang akan disimpan</span><span id="a749" class="ln lo in lj b gy lt lq l lr ls">{<br/>        "type": "text",<br/>        "text": "ðŸ˜ˆðŸ¤  Lorem Ipsum Dolor sit Amet ðŸ˜±",<br/>        "color": "#FFFFFF"<br/>}</span></pre><p id="dfa6" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">Saat menyimpan data tersebut ke dalam <em class="lh"> database </em> , API kami justru mengembalikan pesan <em class="lh"> error </em> yang cukup aneh, yaitu</p><pre class="kc kd ke kf gt li lj lk ll aw lm bi"><span id="48c6" class="ln lo in lj b gy lp lq l lr ls">"Number": 1366<br/>"Message": "Incorrect string value: '\\xF0\\x9F\\x98\\x88 \\xF0...' for column 'text' at row 1"</span></pre><p id="bc6a" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated"><em class="lh"> Nah, </em> sebenarnya hal di atas merupakan hal sederhana dan <em class="lh"> sedikit lucu </em> , akan tetapi jika tidak diatasi dengan baik akan mengakibatkan hal yang bersifat fatal ataupun <em class="lh"> crucial </em> . Secara khusus jika aplikasi kita nantinya akan memiliki banyak <em class="lh"> encoding </em> khusus seperti karakter emoji lainnya.</p><h1 id="9737" class="lu lo in bd lv lw lx ly lz ma mb mc md jt me ju mf jw mg jx mh jz mi ka mj mk bi translated">Antisipasi dan Solusi</h1><p id="b832" class="pw-post-body-paragraph kk kl in km b kn ml jo kp kq mm jr ks kt mn kv kw kx mo kz la lb mp ld le lf ig bi translated">Untuk mengatasi hal tersebut, saya dan tim melakukan 2 buah perubahan kecil, yakni:</p><ul class=""><li id="5186" class="mq mr in km b kn ko kq kr kt ms kx mt lb mu lf mv mw mx my bi translated">Mengubah <em class="lh"> encoding </em> <em class="lh"> charset </em> dan <em class="lh"> collation </em> <em class="lh"> database </em> kami;</li><li id="867b" class="mq mr in km b kn mz kq na kt nb kx nc lb nd lf mv mw mx my bi translated">Mengubah <em class="lh"> encoding charset </em> dan <em class="lh"> collation </em> pada <em class="lh"> connection driver </em> kami dari aplikasi (Golang) ke <em class="lh"> Mysql </em> .</li></ul><h2 id="3496" class="ln lo in bd lv ne nf dn lz ng nh dp md kt ni nj mf kx nk nl mh lb nm nn mj no bi translated">Change Database Encoding Charset and Collation</h2><figure class="kc kd ke kf gt kg gh gi paragraph-image"><div class="gh gi np"><img src="../Images/c4b92449546269ee77e43bc9b509d2d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:570/format:webp/1*SUVbutxte_c_IcwzOc2HUQ.png"/></div></figure><p id="3281" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">Kami menggunakan <em class="lh"> database </em> <code class="fe nq nr ns lj b">Mysql 5.7<strong class="km io"> </strong></code> dengan <em class="lh"> charset </em> <code class="fe nq nr ns lj b">utf-8</code> sebagai <em class="lh"> charset </em> default kami pada <em class="lh"> Mysql </em> .</p><p id="d671" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">Setelah cukup lama mencari beberapa referensi di internet, kami akhirnya menemukan bahwa <em class="lh"> issue </em> ini hanya terjadi pada <code class="fe nq nr ns lj b">Mysql 5.3.3</code> ke atas. Hal ini disebabkan karena jika kita menggunakan <em class="lh"> charset </em> <code class="fe nq nr ns lj b">utf-8</code> pada <em class="lh"> Mysql </em> versi tersebut, maka <em class="lh"> charset </em> tersebut belum mendukung ( <em class="lh"> support </em> ) semua <em class="lh"> charset </em> <code class="fe nq nr ns lj b">utf-8</code> secara umum. Sehingga saat melakukan proses penyimpanan karakter bersifat <em class="lh"> unicode </em> seperti emoji, <em class="lh"> Mysql </em> akan mengembalikan pesan <em class="lh"> error </em> tersebut yang artinya <em class="lh"> type </em> tidak didukung ( <em class="lh"> not supported type </em> ). Sehingga untuk mengatasi hal ini, kami pun mengubah <em class="lh"> encoding </em> dan <em class="lh"> collation </em> <em class="lh"> database </em> kami menjadi <code class="fe nq nr ns lj b">utf8mb4</code> .</p><p id="8a2d" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">Berikut untuk perubahan keseluruhan database:</p><pre class="kc kd ke kf gt li lj lk ll aw lm bi"><span id="4c18" class="ln lo in lj b gy lp lq l lr ls">ALTER DATABASE<br/>    database_name<br/>    CHARACTER SET = utf8mb4<br/>    COLLATE = utf8mb4_unicode_ci;</span></pre><p id="326b" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">Untuk perubahan per table :</p><pre class="kc kd ke kf gt li lj lk ll aw lm bi"><span id="8d32" class="ln lo in lj b gy lp lq l lr ls">ALTER TABLE<br/>    table_name<br/>    CONVERT TO CHARACTER SET utf8mb4<br/>    COLLATE utf8mb4_unicode_ci;</span></pre><p id="d93d" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated"><em class="lh"> Nah, </em> dengan begini, <em class="lh"> database </em> kami seharusnya sudah mendukung format emoji secara keseluruhan. Namun saat kami melakukan <em class="lh"> testing </em> , ternyata hal tersebut masih terjadi, dan tentu saja sedikit membingungkan.</p><h2 id="192f" class="ln lo in bd lv ne nf dn lz ng nh dp md kt ni nj mf kx nk nl mh lb nm nn mj no bi translated">Change Connection Charset in Mysql Driver</h2><p id="fb99" class="pw-post-body-paragraph kk kl in km b kn ml jo kp kq mm jr ks kt mn kv kw kx mo kz la lb mp ld le lf ig bi translated">Untuk <em class="lh"> service </em> yang kami bangun, kami menggunakan Golang sebagai platform bahasanya, Golang 1.10 lebih jelasnya. Ternyata, setelah membaca beberapa <em class="lh"> issue </em> di bahasa pemograman lain seperti PHP, Java, kita tidak hanya mengubah konfigurasi pada <em class="lh"> database </em> saja, akan tetapi kita juga harus mengubah <em class="lh"> charset </em> pada level aplikasi kita, <em class="lh"> driver connection- </em> nya.</p><figure class="kc kd ke kf gt kg gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/7176ec21f7893672e5337828bd630e83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1262/format:webp/1*Lzf5Olx1zchvH4ZRMthdhg.png"/></div><figcaption class="nu nv gj gh gi nw nx bd b be z dk">Contoh charset pada PHP</figcaption></figure><p id="4c15" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">Untuk golang sendiri, karena kami menggunakan <em class="lh"> package </em> <code class="fe nq nr ns lj b">github.com/go-sql-driver/mysql</code> sebagai <em class="lh"> driver </em> kami, maka kami harus menambahkan charset yang sesuai untuk <em class="lh"> connection </em> kami.</p><p id="ecf5" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated"><strong class="km io"> Before: </strong></p><pre class="kc kd ke kf gt li lj lk ll aw lm bi"><span id="1667" class="ln lo in lj b gy lp lq l lr ls">dsn := `root:root@tcp(127.0.0.1 :3306)/DB_NAME?parseTime=1&amp;loc=Asia%2FJakarta`</span><span id="cbc3" class="ln lo in lj b gy lt lq l lr ls">dbConn, _:= sql.Open(`mysql`, dsn)</span></pre><p id="8964" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated"><strong class="km io"> After: </strong></p><pre class="kc kd ke kf gt li lj lk ll aw lm bi"><span id="af51" class="ln lo in lj b gy lp lq l lr ls">dsn :=`root:root@tcp(127.0.0.1 :3306)/DB_NAME?parseTime=1&amp;loc=Asia%2FJakarta<strong class="lj io">&amp;charset=utf8mb4&amp;collation=utf8mb4_unicode_ci`</strong></span><span id="4506" class="ln lo in lj b gy lt lq l lr ls">dbConn, _:= sql.Open(`mysql`, dsn)</span></pre><p id="1105" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">Setelah melakukan hal ini, akhirnya <em class="lh"> bug </em> aneh yang <em class="lh"> sedikit lucu </em> ini <em class="lh"> solved </em> .</p><h2 id="3e24" class="ln lo in bd lv ne nf dn lz ng nh dp md kt ni nj mf kx nk nl mh lb nm nn mj no bi translated">Conclusion</h2><p id="b74d" class="pw-post-body-paragraph kk kl in km b kn ml jo kp kq mm jr ks kt mn kv kw kx mo kz la lb mp ld le lf ig bi translated"><em class="lh"> Error </em> dan <em class="lh"> bug </em> ini sebenarnya tidak terlalu besar, namun jika tidak ditangani dengan baik maka akan bersifat fatal dan <em class="lh"> crucial. </em> Terlebih jika penanganan <em class="lh"> error </em> yang kita lakukan kurang tepat, contoh: Jika terjadi <em class="lh"> error </em> kita secara langsung mengembalikan status <code class="fe nq nr ns lj b">500: Internal Server Error</code> , ditambah jika kita membuat suatu <em class="lh"> service </em> yang berhubungan dengan emoji, dan memiliki <em class="lh"> load user </em> yang cukup banyak, maka akan terjadi keanehan dan <em class="lh"> panic </em> yang cukup besar karena selalu mendapat <em class="lh"> error </em> status <code class="fe nq nr ns lj b">500: Internal Server Error</code> .</p><p id="118f" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated">Namun, hari ini saya baru saja belajar mengenai betapa pentingnya untuk teliti memilih <em class="lh"> encoding </em> dan hal-hal lainnya yang bersifat <em class="lh"> configurable </em> pada <em class="lh"> database </em> , terlepas dari jenis <em class="lh"> database </em> yang digunakan (RDBMS or NoSQL).</p><p id="c8c6" class="pw-post-body-paragraph kk kl in km b kn ko jo kp kq kr jr ks kt ku kv kw kx ky kz la lb lc ld le lf ig bi translated"><strong class="km io"> References: </strong></p><ol class=""><li id="eeab" class="mq mr in km b kn ko kq kr kt ms kx mt lb mu lf ny mw mx my bi translated">Answer by Selvamani P in stackoverflow.com <a class="ae lg" href="https://stackoverflow.com/a/39465494" rel="noopener ugc nofollow" target="_blank"> https://stackoverflow.com/a/39465494 </a></li><li id="03a3" class="mq mr in km b kn mz kq na kt nb kx nc lb nd lf ny mw mx my bi translated">Answer by Mathias Bynens in dba.stackexchange.com <br/> <a class="ae lg" href="https://dba.stackexchange.com/a/21684" rel="noopener ugc nofollow" target="_blank"> https://dba.stackexchange.com/a/21684 </a></li></ol></div><div class="ab cl nz oa hr ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="ig ih ii ij ik"><figure class="kc kd ke kf gt kg"><div class="bz fp l di"><div class="og oh l"/></div></figure></div></div>    
</body>
</html>