<html>
<head>
<title>Modern user storage on Android</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android上的现代用户存储</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/modern-user-storage-on-android-e9469e8624f9?source=collection_archive---------3-----------------------#2020-03-11">https://medium.com/androiddevelopers/modern-user-storage-on-android-e9469e8624f9?source=collection_archive---------3-----------------------#2020-03-11</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/6e9e7c1e309967e2ac3089702e16219f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lqaruGW1a8Db8xJVWjwsfA.png"/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx">Illustration by <a class="ae hu" rel="noopener" href="/@VPoltrack">Virginia Poltrack</a>.</figcaption></figure><div class=""/><p id="a7e5" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了保护用户数据并减少应用程序消耗的空间量，Android 10对外部存储权限的<a class="ae hu" href="https://developer.android.com/training/data-storage#scoped-storage" rel="noopener ugc nofollow" target="_blank">行为进行了更改。</a><a class="ae hu" href="https://android-developers.googleblog.com/2020/02/Android-11-developer-preview.html" rel="noopener ugc nofollow" target="_blank"> Android 11开发者预览版</a>延续了这一努力，同时增加了旨在帮助开发者适应变化的改进。</p><p id="2a13" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Google Play上发布的大多数申请<a class="ae hu" href="https://developer.android.com/reference/android/Manifest.permission#READ_EXTERNAL_STORAGE" rel="noopener ugc nofollow" target="_blank">存储许可</a>的应用都是出于共同的原因，比如将文件保存在SD卡上或读取媒体文件。这些应用程序能够在卸载后将大量文件保存在磁盘上。他们还可以从其他应用程序中读取潜在的敏感文件。</p><p id="d8d3" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在Android 10中，我们调整了存储权限的工作方式，为应用程序提供了所需的访问权限。这也通过鼓励应用程序将文件保存在指定的目录中来限制文件混乱，当一个应用程序被删除时，这些目录会被清除。</p><p id="03e1" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Android 10的存储变化遵循了三个基本原则:</p><ul class=""><li id="598e" class="js jt hx iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated"><strong class="iw hy">更好的归属</strong>:系统知道哪些文件属于哪些app，让用户更容易管理自己的文件。当一个应用程序被卸载时，它创建的内容不应该保留，除非用户希望它保留</li><li id="76cc" class="js jt hx iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated"><strong class="iw hy">保护应用程序数据</strong>:当一个应用程序将<a class="ae hu" href="https://developer.android.com/training/data-storage/app-specific" rel="noopener ugc nofollow" target="_blank">应用程序特定的</a>文件写入外部存储器时，这些文件不应该对其他应用程序可见</li><li id="55db" class="js jt hx iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated"><strong class="iw hy">保护用户数据</strong>:当用户下载文件时，例如敏感的电子邮件附件，这些文件对大多数应用程序来说应该是不可见的</li></ul><p id="6c67" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">面向Android 10的应用程序可以贡献给自己的外部应用程序目录，并组织媒体收藏(音频、视频、图像和下载)，而无需请求存储权限。“存储”权限仅允许应用程序读取由音频、视频和图像收藏中的其他应用程序共享的媒体文件。但是，它不提供对下载集合中非应用程序创建的文件的读取权限。在Android 10中，应用程序访问其他应用程序创建的非媒体文件的唯一方法是使用<a class="ae hu" href="https://developer.android.com/guide/topics/providers/document-provider" rel="noopener ugc nofollow" target="_blank">存储访问框架</a>提供的文档选择器。</p><p id="2f0a" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在Android 11中，我们将通过引入以下更改来继续改善与作用域存储相关的开发人员体验。</p><h1 id="7e83" class="kg kh hx bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">媒体商店改进</h1><p id="4b17" class="pw-post-body-paragraph iu iv hx iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">Android 10要求所有应用程序使用MediaStore APIs来访问照片、视频和音乐文件。这将继续是我们的建议。然而，我们知道许多应用程序严重依赖于使用文件路径的API，包括第三方库，这些API无法轻松切换到使用文件描述符。所以在Android 11中，使用文件路径的API和库将再次<a class="ae hu" href="https://developer.android.com/preview/privacy/storage#media-files-raw-paths" rel="noopener ugc nofollow" target="_blank">启用</a>。您的应用程序可以使用requestLegacyExternalStorage清单属性来确保运行Android 10的用户的兼容性。</p><p id="7d54" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在幕后，使用文件路径的I/O请求被委托给MediaStore API。当用于读取独立存储外部的文件时，这种重定向会对性能产生一些影响。此外，与MediaStore APIs相比，使用文件路径并不能提供任何功能优势，因此我们强烈建议直接使用MediaStore。</p><p id="082a" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在Android 10上，用户需要确认应用程序请求编辑或删除的每个文件。使用Android 11，应用程序可以同时请求修改或删除几个媒体文件<a class="ae hu" href="https://developer.android.com/preview/privacy/storage#media-file-access" rel="noopener ugc nofollow" target="_blank"/>。系统图库应用程序永远不会显示这些对话框。我们希望这一改进能让用户体验更加流畅。</p><figure class="lk ll lm ln fd hj er es paragraph-image"><div class="er es lj"><img src="../Images/4d0ad947f53b38247847e52ae61da25b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1238/0*oyE3jpmd6l50oexF"/></div></figure><h1 id="a277" class="kg kh hx bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">存储访问框架变化</h1><p id="e6bf" class="pw-post-body-paragraph iu iv hx iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">在我们限制对广泛存储的访问后，一些应用程序开发人员试图使用存储访问框架来遍历整个文件系统。然而，SAF并不是支持广泛访问共享存储的合适工具。因此我们<a class="ae hu" href="https://developer.android.com/preview/privacy/storage#file-directory-restrictions" rel="noopener ugc nofollow" target="_blank">更新了它，将可见性</a>限制在某些路径上。</p><p id="c438" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在Android 11中，用户将无法授予对根下载目录、每个可靠SD卡卷的根目录或外部应用程序目录的目录访问权限。应用程序仍然可以使用存储访问框架API和文档选择器来要求用户从共享存储中选择单个文件。</p><h1 id="c49e" class="kg kh hx bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">文件管理器应用程序的特殊权限</h1><p id="d916" class="pw-post-body-paragraph iu iv hx iw b ix le iz ja jb lf jd je jf lg jh ji jj lh jl jm jn li jp jq jr ha bi translated">对于需要广泛访问共享存储的应用程序，如文件管理器或备份应用程序，Android 11将引入一个名为<code class="du lo lp lq lr b"><strong class="iw hy">MANAGE_EXTERNAL_STORAGE</strong></code>的特殊权限。这将授予对所有共享存储的读写权限，包括非媒体文件。但是，内部和外部存储中特定于应用程序的目录的内容将无法访问。</p><p id="3f58" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们希望继续允许一些应用程序广泛访问外部存储上的文件，前提是它们有真正需要的用例。在Android 11中，这些应用程序可以声明<code class="du lo lp lq lr b"><strong class="iw hy">MANAGE_EXTERNAL_STORAGE</strong></code>，这将允许它们请求用户在设置中授予它们“所有文件访问权限”。以下是几个将被允许的应用程序示例:</p><ul class=""><li id="7ced" class="js jt hx iw b ix iy jb jc jf ju jj jv jn jw jr jx jy jz ka bi translated">文件管理器——主要用于让用户管理文件的应用程序</li><li id="3cbe" class="js jt hx iw b ix kb jb kc jf kd jj ke jn kf jr jx jy jz ka bi translated">备份和恢复—需要批量访问文件的应用程序(例如，切换设备或备份到云)</li></ul><p id="58b3" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">但是，如果您的应用程序需要访问单个文件，如字处理器应用程序，您应该使用存储访问框架。你可以点击查看Google Play关于此许可的政策<a class="ae hu" href="https://support.google.com/googleplay/android-developer/answer/9956427" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="93f8" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在Android 11上，如果你的应用需要<code class="du lo lp lq lr b"><strong class="iw hy">MANAGE_EXTERNAL_STORAGE</strong></code>或者使用依赖于文件路径的API，你可以通过在你的Android清单中声明<code class="du lo lp lq lr b">requestLegacyExternalStorage=true</code>来支持旧版本的向后兼容性。</p><p id="25b5" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">你可以在<a class="ae hu" href="https://developer.android.com/preview/privacy/storage" rel="noopener ugc nofollow" target="_blank">开发者文档</a>和我们的<a class="ae hu" href="https://youtu.be/UnJ3amzJM94" rel="noopener ugc nofollow" target="_blank">Android Dev Summit 2019</a>演讲中了解更多信息。</p><figure class="lk ll lm ln fd hj"><div class="bz dy l di"><div class="ls lt l"/></div></figure><p id="aa9b" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们重视您的反馈！您可以通过<a class="ae hu" href="http://bit.ly/2vd4wF4" rel="noopener ugc nofollow" target="_blank">问题跟踪器</a>报告问题或功能请求。请继续关注即将发布的关于如何将作用域存储与MediaStore和存储访问框架API结合使用的文章。</p></div></div>    
</body>
</html>