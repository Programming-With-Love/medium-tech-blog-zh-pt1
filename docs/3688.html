<html>
<head>
<title>EKS (AWS) AND RBAC, step by step</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">EKS (AWS)和RBAC，步步为营</h1>
<blockquote>原文：<a href="https://medium.com/globant/rbac-and-eks-aws-step-by-step-e2f9c38f1aeb?source=collection_archive---------1-----------------------#2021-06-09">https://medium.com/globant/rbac-and-eks-aws-step-by-step-e2f9c38f1aeb?source=collection_archive---------1-----------------------#2021-06-09</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><h1 id="88eb" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">介绍</h1><p id="1e21" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated"><strong class="je hi">亚马逊弹性Kubernetes服务(亚马逊EKS) </strong>提供了一套丰富的控件，可用于有效保护集群及其应用。本文将关注两个关键控制:环境分段和基于角色的访问控制。</p><p id="e158" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">环境分割</strong>作为障碍，使得横向移动困难，隔离安全问题。无论是恶意攻击还是技术故障，适当的隔离都可以限制向其他内部区域的传播，从而降低潜在的影响。<strong class="je hi">基于角色的访问控制(RBAC) </strong>是一种根据企业内个人用户的角色来管理对计算机或网络资源的访问的方法。</p><p id="d310" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">本指南旨在提供分步信息，以实现以下目标:</strong></p><ol class=""><li id="090a" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kk kl km kn bi translated">创建三个不同的环境:开发、质量保证和生产</li><li id="ca4d" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kk kl km kn bi translated">创建三个不同的角色:管理员、开发人员、生产维护人员</li></ol><ul class=""><li id="b967" class="kf kg hh je b jf ka jj kb jn kh jr ki jv kj jz kt kl km kn bi translated">管理员将拥有对所有环境的完全访问权限</li><li id="2f33" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kt kl km kn bi translated">开发人员将有充分的访问开发，有限的访问质量和没有访问生产</li><li id="ce94" class="kf kg hh je b jf ko jj kp jn kq jr kr jv ks jz kt kl km kn bi translated">生产维护无权访问开发和qa，但可以完全访问生产</li></ul><p id="2a81" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">3.创建三个不同的用户，每个角色一个</p><p id="277d" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">4.将aws-cli配置为从一个用户“跳转”到另一个用户，以检查每个环境的权限</p><p id="a84f" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">本文涵盖了以下几点:</strong></p><p id="988c" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">1-概念</p><p id="835b" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">2-配置</p><p id="ca73" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">3-测试</p><p id="acf1" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">4-结论</p><p id="6d9c" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">5-参考文献</p><h1 id="be5b" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">1-概念</h1><h2 id="1ab2" class="ku if hh bd ig kv kw kx ik ky kz la io jn lb lc is jr ld le iw jv lf lg ja lh bi translated">EKS</h2><p id="5bb2" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">EKS是由AWS构建的Kubernetes平台。云提供商允许创建必要的元素，以便在短时间内启动并运行Kubernetes集群。</p><h2 id="34a0" class="ku if hh bd ig kv kw kx ik ky kz la io jn lb lc is jr ld le iw jv lf lg ja lh bi translated">授权/认证模型</h2><p id="6fb2" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">将AWS的授权和身份验证模式与k8s提供的模式相集成的最有价值的方法之一是RBAC(基于角色的访问控制)</p><figure class="lj lk ll lm fd ln er es paragraph-image"><div class="er es li"><img src="../Images/b7365f2c808c7ed8f19307cf7a6149c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*g752u8zaArs43oNq"/></div></figure><p id="981a" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">在这个模型中，身份验证委托给aws，而授权通过aws_cli软件保留在k8s集群中，该软件允许从AWS云中的命令行执行操作。</p><h1 id="9962" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">2-配置</h1><p id="0089" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">一个有效的EKS集群，安装并配置了aws-cli，安装并配置了kubectl来管理EKS集群。以下步骤设计用于*NIX系统</p><h2 id="f089" class="ku if hh bd ig kv kw kx ik ky kz la io jn lb lc is jr ld le iw jv lf lg ja lh bi translated">创建名称空间</h2><p id="3d2c" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">在这一步中，我们设置了三个名称空间，这些名称空间将被应用到配置中。这只是一个开发环境的典型情况。</p><figure class="lj lk ll lm fd ln"><div class="bz dy l di"><div class="lq lr l"/></div></figure><h2 id="ddb9" class="ku if hh bd ig kv kw kx ik ky kz la io jn lb lc is jr ld le iw jv lf lg ja lh bi translated">创建IAM角色、组和策略</h2><p id="327f" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">三个角色、组和策略的创建如下:</p><p id="6749" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">管理员</strong></p><figure class="lj lk ll lm fd ln"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="dbde" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">开发商</strong></p><figure class="lj lk ll lm fd ln"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="3f86" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">生产</strong></p><figure class="lj lk ll lm fd ln"><div class="bz dy l di"><div class="lq lr l"/></div></figure><h2 id="7d4e" class="ku if hh bd ig kv kw kx ik ky kz la io jn lb lc is jr ld le iw jv lf lg ja lh bi translated">角色和权限绑定</h2><p id="33ac" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">在这一步中，k8s角色收到了他们的授权。每个权限和api组和资源做什么的细节将在另一篇文章中解释。</p><p id="f923" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">管理EKS集群角色和集群角色绑定创建</strong></p><p id="d38b" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">在这一步中，预定义的Kubernetes管理员角色被分配给整个集群的“我们的”AWS角色</p><figure class="lj lk ll lm fd ln"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="1f50" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">EKS开发人员角色和角色绑定</strong></p><p id="a60d" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">在这一步中，我们将开发人员权限绑定到开发环境。</p><figure class="lj lk ll lm fd ln"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="7649" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">EKS QA的开发人员角色和角色绑定</strong></p><p id="1eff" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">在这一步，我们将开发人员权限绑定到qa环境。</p><figure class="lj lk ll lm fd ln"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="7ed4" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">支持EKS prod的角色和角色绑定</strong></p><p id="9e9e" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">在此步骤中，我们将生产支持角色权限绑定到生产环境。</p><figure class="lj lk ll lm fd ln"><div class="bz dy l di"><div class="lq lr l"/></div></figure><h2 id="0394" class="ku if hh bd ig kv kw kx ik ky kz la io jn lb lc is jr ld le iw jv lf lg ja lh bi translated">创建EKS角色</h2><p id="ade6" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">在这些步骤中，我们在集群中创建角色，并使它们明确用于RBAC配置</p><p id="dddf" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">我们从以下内容开始配置图编辑:</p><p id="dd25" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><em class="ls"> kubectl编辑配置图-n kube-系统AWS-授权</em></p><p id="7dc5" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">并按以下方式添加角色</p><figure class="lj lk ll lm fd ln"><div class="bz dy l di"><div class="lq lr l"/></div></figure><h2 id="c7db" class="ku if hh bd ig kv kw kx ik ky kz la io jn lb lc is jr ld le iw jv lf lg ja lh bi translated">为测试创建IAM用户</h2><p id="2382" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">现在是时候为测试创建一些用户和配置了。对于本教程中的porpoise来说，这一步不是必需的，但是对于测试最近创建的角色的能力来说，这一步很有用</p><p id="1590" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">开发者</strong></p><figure class="lj lk ll lm fd ln"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="49da" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">管理员</strong></p><figure class="lj lk ll lm fd ln"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="a247" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">生产</strong></p><figure class="lj lk ll lm fd ln"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="d738" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><strong class="je hi">为EKS添加用户配置</strong></p><figure class="lj lk ll lm fd ln"><div class="bz dy l di"><div class="lq lr l"/></div></figure><h1 id="b571" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">3-测试</h1><p id="484a" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">现在，只需在命令行中设置AWS_PROFILE变量，就可以从一个用户跳到另一个用户</p><p id="c81f" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><em class="ls">导出AWS_PROFILE=admin </em></p><h2 id="8ec2" class="ku if hh bd ig kv kw kx ik ky kz la io jn lb lc is jr ld le iw jv lf lg ja lh bi translated">测试凭据</h2><p id="addc" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated"><em class="ls">AWS STS get-caller-identity</em></p><h1 id="e4fc" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">4-结论</h1><p id="16b0" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">在Kubernetes中，RBAC是处理授权过程的强大工具。与AWS EKS的集成有点棘手，因为在配置映射中的结构是:</p><p id="1407" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">用户名:管理员用户</p><p id="0a85" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">尽管标签名如此，但它指的是AWS角色，这可能会造成混淆，因为AWS对自己的容器管理服务下了赌注，如ECS和EKS是基于Kubernetes作为orchestrator的成功而出现的。</p><h1 id="e273" class="ie if hh bd ig ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb bi translated">5-参考文献</h1><p id="9cd5" class="pw-post-body-paragraph jc jd hh je b jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">基本角色定义</p><p id="1674" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><a class="ae lt" href="https://kubernetes.io/docs/reference/access-authn-authz/rbac/#discovery-roles" rel="noopener ugc nofollow" target="_blank">https://kubernetes . io/docs/reference/access-authn-authz/RBAC/# discovery-roles</a></p><p id="0113" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">Kubernetes cheatsheet</p><p id="b7e2" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><a class="ae lt" href="https://kubernetes.io/docs/reference/kubectl/cheatsheet" rel="noopener ugc nofollow" target="_blank">https://kubernetes.io/docs/reference/kubectl/cheatsheet</a></p><p id="952c" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated">Kubernetes中的动词和资源</p><p id="a041" class="pw-post-body-paragraph jc jd hh je b jf ka jh ji jj kb jl jm jn kc jp jq jr kd jt ju jv ke jx jy jz ha bi translated"><a class="ae lt" href="https://kubernetes.io/docs/reference/access-authn-authz/authorization/" rel="noopener ugc nofollow" target="_blank">https://kubernetes . io/docs/reference/access-authn-authz/authorization/</a></p></div></div>    
</body>
</html>