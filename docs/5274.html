<html>
<head>
<title>Installing non official OSs on a KVM Server with multi-VNIC Guests on Oracle Cloud Infrastructure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在基于Oracle云基础架构的多虚拟网卡客户机上安装非官方操作系统</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/configuring-a-kvm-server-with-multi-vnic-guests-on-bare-metal-cloud-service-a31e61367408?source=collection_archive---------0-----------------------#2017-08-05">https://medium.com/oracledevs/configuring-a-kvm-server-with-multi-vnic-guests-on-bare-metal-cloud-service-a31e61367408?source=collection_archive---------0-----------------------#2017-08-05</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="7ab6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Oracle官方BYOH <a class="ae jc" href="https://docs.us-phoenix-1.oraclecloud.com/Content/Resources/Assets/installing_kvm_multi_vnics.pdf" rel="noopener ugc nofollow" target="_blank">使用多虚拟网卡在裸机实例上安装和配置KVM白皮书</a>支持并推荐在Oracle云基础设施(OCI)实例上配置KVM服务器。另外，它提供了最新的内容！</p><p id="04d6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">本教程提供了一个例子，说明在Oracle Cloud Infrastructure (OCI)上配置了<a class="ae jc" href="https://www.linux-kvm.org/page/Main_Page" rel="noopener ugc nofollow" target="_blank"> KVM(基于内核的虚拟机)</a> hypervisor之后，如何轻松地在裸机KVM实例上安装<a class="ae jc" href="https://www.debian.org/" rel="noopener ugc nofollow" target="_blank"> Debian </a>和其他非官方操作系统。</p><p id="c4a2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这个过程允许您在BMCS KVM实例上运行任何您需要的操作系统，作为Oracle Cloud 上的<a class="ae jc" href="https://www.oracle.com/cloud/compute/virtual-machines/what-is-virtual-machine/" rel="noopener ugc nofollow" target="_blank">来宾虚拟机。有关BMCS官方图片的更多信息，请参见</a><a class="ae jc" href="https://docs.us-phoenix-1.oraclecloud.com/Content/Compute/References/images.htm" rel="noopener ugc nofollow" target="_blank">甲骨文提供的图片</a></p><h1 id="2822" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">入门指南</h1><p id="4bc3" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">KVM，基于内核的虚拟机，是一个虚拟化软件，它能够在硬件虚拟化扩展的帮助下运行多个客户操作系统。它支持多种客户操作系统，如Linux、Windows、Solaris、Haiku、REACT OS等等。KVM可以使用命令行或可用的图形工具进行管理。virt-Manager(Virtual Machine Manager)是管理基于KVM的虚拟机的最广泛使用的应用程序，它支持创建、编辑、启动和停止基于KVM的虚拟机，以及在主机之间实时或冷迁移虚拟机。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/a8c2c62a65c7aca73a18e7632ad65c00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tZinN02QpJUGL1Tg.png"/></div></div></figure><h1 id="3ada" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">要求</h1><ul class=""><li id="690a" class="ks kt hh ig b ih kb il kc ip ku it kv ix kw jb kx ky kz la bi translated">BMCS实例(标准1.36、高1.36或高1.36)</li><li id="f723" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">在Windows Server实例上运行时，应用程序许可证可能需要通过软件保障进行许可证移动。有关您的许可权的问题应该向Microsoft或您的Microsoft经销商提出</li><li id="6109" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">请注意，将您的许可证带到OCI时，您要独自承担在裸机KVM服务器实例上使用的任何第三方操作系统/应用程序的许可义务</li><li id="4132" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">您的KVM VM OS ISO需要上传到您的裸机(BM) KVM服务器实例中</li><li id="7e8c" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">连接到BM KVM服务器实例的附加块存储卷，用于保存KVM VM qco w2磁盘映像</li><li id="d349" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">KVM只有在cpu支持硬件虚拟化(Intel VT或AMD-V)的情况下才能工作，要了解您的CPU是否支持VT特性，请运行以下命令。</li></ul><blockquote class="lg"><p id="7ddb" class="lh li hh bd lj lk ll lm ln lo lp jb dx translated">$ sudo egrep '(vmx | SVM)'/proc/CPU info</p></blockquote><p id="fd16" class="pw-post-body-paragraph ie if hh ig b ih lq ij ik il lr in io ip ls ir is it lt iv iw ix lu iz ja jb ha bi translated">如果上述命令返回任何显示vmx或svm的输出，则您的硬件支持VT，否则不支持。裸机实例支持“vmx”硬件虚拟化。</p><h1 id="84b1" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">安装KVM</h1><p id="4063" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">发出以下命令来安装最新的qemu包和virt-manager，它提供了管理虚拟机的图形界面。</p><blockquote class="lg"><p id="039b" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">$ sudo yum install QEMU-KVM QEMU-img virt-manager lib virt lib virt-python lib virt-client virt-install virt-viewer</p></blockquote><h1 id="cd38" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo ma jq jr js mb ju jv jw mc jy jz ka bi translated">安装VNC</h1><p id="3427" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">运行以下命令安装VNC软件包</p><blockquote class="lg"><p id="90b3" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">$ sudo yum groupinstall“带GUI的服务器”</p><p id="f0af" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">$ sudo yum install " @ X Window System " xorg-X11-xauth xorg-X11-fonts-* xorg-X11-utils tiger VNC-server-y</p></blockquote><p id="d406" class="pw-post-body-paragraph ie if hh ig b ih lq ij ik il lr in io ip ls ir is it lt iv iw ix lu iz ja jb ha bi translated">现在，复制vncserver@。对vncserver@的服务:1.service。</p><blockquote class="lg"><p id="5892" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">$ cd /lib/systemd/system</p><p id="216d" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">$ sudo cp vncserver@。服务vncserver@:1 .服务</p><p id="31ab" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">$ sudo vi vncserver\@\:1.service</p></blockquote><p id="1793" class="pw-post-body-paragraph ie if hh ig b ih lq ij ik il lr in io ip ls ir is it lt iv iw ix lu iz ja jb ha bi translated">将vncserver@1.service中的<user>替换为VNC用户名，使用如下所示的“opc”用户名。</user></p><blockquote class="lg"><p id="5217" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">ExecStart =/sbin/run user-l OPC-c "/usr/bin/VNC server % I-geometry 1280 x 1024 "</p><p id="c9da" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">PIDFile=/home/opc/。vnc/%H%i.pid</p></blockquote><p id="3ce0" class="pw-post-body-paragraph ie if hh ig b ih lq ij ik il lr in io ip ls ir is it lt iv iw ix lu iz ja jb ha bi translated">为vncserver@中定义的opc用户设置VNC密码。服务</p><blockquote class="lg"><p id="87cd" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated"># su - opc</p><p id="9104" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated"># vncpasswd</p><p id="3dec" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">密码:</p><p id="f16e" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">验证:</p><p id="18dd" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">#退出</p></blockquote><p id="2ea8" class="pw-post-body-paragraph ie if hh ig b ih lq ij ik il lr in io ip ls ir is it lt iv iw ix lu iz ja jb ha bi translated">配置防火墙以允许VNC连接</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es md"><img src="../Images/e4f6373ad596b57e9dba65ee0e673f96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jltetsUA_uOqqhgAQyBpEQ.png"/></div></div></figure><p id="cd18" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将VNC配置为自动启动</p><blockquote class="lg"><p id="91be" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">$ sudo systemctl后台程序-重新加载</p><p id="83d2" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">$ sudo system CTL enable VNC server @:1 . service</p><p id="0893" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">$ sudo ln-s '/usr/lib/systemd/system/vncserver @:1 . service ' '/etc/systemd/system/multi-user . target . wants/vncserver @:1 . service '</p><p id="eb63" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">$ sudo system CTL start vncserver @:1 . service</p></blockquote><h1 id="c998" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo ma jq jr js mb ju jv jw mc jy jz ka bi translated">为多虚拟网卡准备KVM服务器</h1><p id="0a3a" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">在Oracle Linux 7.x KVM服务器实例上，执行以下操作:</p><blockquote class="lg"><p id="ec3f" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">$ sudo VI/etc/默认/grub</p><p id="23af" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">#在GRUB_CMDLINE_LINUX行中追加以下参数</p><p id="f8ce" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">Intel _ io MMU = on ixgbe . max _ VFS = 16 rd black list = ixgbevf</p></blockquote><p id="3688" class="pw-post-body-paragraph ie if hh ig b ih lq ij ik il lr in io ip ls ir is it lt iv iw ix lu iz ja jb ha bi translated">下面是一个例子:</p><blockquote class="lg"><p id="3ef3" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">$ sudo cat /etc/default/grub |grep命令行</p><p id="b6e4" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">GRUB _<strong class="ak">CMDLINE</strong>_ LINUX = " crash kernel = auto LANG = en _ US。UTF-8 console=tty0 console=ttyS0，9600 rd . luks = 0 rd . LVM = 0 rd . MD = 0dm = 0 IP = DHCP netroot = iscsi:169 . 254 . 0 . 2::::iqn . 2015–02 . Oracle . boot:uefi iscsi _ param = node . session . timeo . replacement _ time out = 6000<strong class="ak">Intel _ io MMU = on IX gbe . max _ VFS = 16 rd black list = IX</strong></p></blockquote><p id="dba3" class="pw-post-body-paragraph ie if hh ig b ih lq ij ik il lr in io ip ls ir is it lt iv iw ix lu iz ja jb ha bi translated">保存并退出vi。</p><p id="900b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，运行以下命令来</p><p id="0928" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">-将本机英特尔VF驱动程序列入黑名单，并使用操作系统本机驱动程序</p><blockquote class="lg"><p id="6f7f" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">$ sudo echo " black list ixbevf " &gt;/etc/modprobe . d/black list-ixbevf . conf</p></blockquote><p id="39ba" class="pw-post-body-paragraph ie if hh ig b ih lq ij ik il lr in io ip ls ir is it lt iv iw ix lu iz ja jb ha bi translated">-启用调谐</p><blockquote class="lg"><p id="58cf" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">$ sudo systemctl启用优化</p><p id="f0f2" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">$ sudo systemctl开始调整</p><p id="d61e" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">$ sudo tuned-adm配置文件虚拟主机</p></blockquote><p id="0672" class="pw-post-body-paragraph ie if hh ig b ih lq ij ik il lr in io ip ls ir is it lt iv iw ix lu iz ja jb ha bi translated">-重新创建grub以验证所有更改</p><blockquote class="lg"><p id="efd0" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">$ sudo grub 2-mkconfig-o/boot/EFI/EFI/red hat/grub . CFG</p></blockquote><p id="77de" class="pw-post-body-paragraph ie if hh ig b ih lq ij ik il lr in io ip ls ir is it lt iv iw ix lu iz ja jb ha bi translated">使用您的BMCS用户界面，编辑您的BM虚拟云网络安全列表，并打开端口5901(如果该端口对应于您正在使用的VNC端口)</p><blockquote class="lg"><p id="13de" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated"><em class="me">来源:0.0.0.0/0 </em></p><p id="5000" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated"><em class="me"> IP协议:TCP </em></p><p id="2d50" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated"><em class="me">源端口范围:全部</em></p><p id="83cc" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated"><em class="me">目的端口范围:5901 </em></p><p id="b608" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated"><em class="me">允许:端口TCP流量:5901 </em></p></blockquote><p id="b82b" class="pw-post-body-paragraph ie if hh ig b ih lq ij ik il lr in io ip ls ir is it lt iv iw ix lu iz ja jb ha bi translated">重启裸机KVM服务器实例，加载KVM内核模块并重启gnome。重启完成后，您应该能够通过任何VNC应用程序(如<a class="ae jc" href="https://www.realvnc.com/en/download/viewer/" rel="noopener ugc nofollow" target="_blank"> vncviewer </a>)访问裸机KVM服务器实例</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es mf"><img src="../Images/da95de132f071f201cd65bddd91c21ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3IXYy_iCPp-zYCMI.png"/></div></div></figure><p id="b187" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意:您需要使用passwd命令通过SSH重置opc用户密码，以便能够通过VNC连接到您的BM KVM服务器gnome界面。</p><h1 id="9e8a" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">创建BMCS虚拟网络信息中心</h1><p id="4f11" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">下一步是创建一个vNIC并将其附加到BM KVM服务器实例中。使用BMCS仪表板，单击BM KVM实例的详细信息，选择“连接的虚拟网卡”,然后单击“创建虚拟网卡”选项。</p><p id="ed2d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是Debian在可用性域1 (AD1)上使用名为“New-BM-172”的虚拟云网络(VCN)的一个例子</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es mg"><img src="../Images/b77a17009896895c52d97a9b1f375f84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ycUO4I4itMI1Tdis.png"/></div></div></figure><p id="984a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建后，您将看到以下内容:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/0075f7cc54b82d5a3d36aacf4c370f7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0j9YiE3aE2mP1wS3.png"/></div></div></figure><p id="0790" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请注意“MAC地址”和VLAN标签信息，因为您稍后会用到它们。现在，您已经准备好配置KVM来宾虚拟机，并向其中添加上述虚拟网卡。</p><h1 id="e577" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">创建KVM BM实例</h1><p id="c0b0" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">如上所述，可以使用命令行或可用的图形工具来管理KVM。在本教程中，您将使用virt-manager GUI和一个终端应用程序。使用VNC连接到BM KVM服务器实例，打开gnome终端并运行</p><p id="1032" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">单击“创建新的虚拟机”按钮，并按照要求的选项进行操作，例如</p><p id="6781" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">选择ISO图像</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es mh"><img src="../Images/4f64579520fc759518cf41392b38b895.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/0*6B6VM20qnTBV2GCx.png"/></div></figure><p id="34a5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">指向您的ISO位置</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es mi"><img src="../Images/a89b3857c4a3559f4876849612523345.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/0*zeA9LgYOQtqR9Pwh.png"/></div></figure><p id="4bd9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">选择内存量和CPU数量。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es mj"><img src="../Images/4ca8eb6981d352036c0883fbd8a50d1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/format:webp/0*fub7rG0sefhQboQ0.png"/></div></figure><p id="2f5c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">选择存储(qcow2)文件或设备(即；/dev/sdb))</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es mk"><img src="../Images/7203338ff15faabf72862f70f616437b.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/0*EFdjnkLs27i93XOh.png"/></div></figure><p id="3dcf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">键入KVM来宾虚拟机的名称。您可以使用与vNIC设置相同的名称，也可以使用不同的名称。</p><p id="eb34" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在来宾安装过程中，使用您在vNIC设置中选择的相同操作系统主机名。</p><p id="6539" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">不要忘记选择“安装前自定义配置”选项</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es ml"><img src="../Images/c3d52f9fde99d054739db4609fd69f73.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/format:webp/0*45BrqljSdAQV9R1X.png"/></div></figure><p id="6b26" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">删除默认添加的默认网卡，单击开始安装选项，但不要启动它</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es mm"><img src="../Images/cff268210217630288fa23241520b83e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UNfzEt4ZYSXEntVb.png"/></div></div></figure><p id="663e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">点击“强制关闭”选项，如下所示</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es mn"><img src="../Images/ce41d128e37a3381b55edcf186bf7742.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Pw2i_rF68GEEaS8o.png"/></div></div></figure><p id="81f9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在开始KVM来宾虚拟机安装之前，您需要将BMCS虚拟网卡添加到其中。</p><h1 id="b8b7" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">将BMCS虚拟网卡与KVM虚拟机相关联</h1><p id="ec55" class="pw-post-body-paragraph ie if hh ig b ih kb ij ik il kc in io ip kd ir is it ke iv iw ix kf iz ja jb ha bi translated">找到与您创建的、与BM KVM服务器关联的vNIC相关的PCI总线信息。之后，您将使用在上述vNIC步骤中获得的VLAN信息。</p><p id="e8a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">运行以下命令并替换VLAN标签ID的VLAN信息变量，以标识与BMCS虚拟网卡相关联的PCI设备，如下例所示</p><blockquote class="lg"><p id="f7b0" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">$ sudo virsh node dev-dump XML ` ethtool-I ens2f 0 | grep bus-info | awk ' { print $ 2 } ' | sed 's/^/pci_/' | sed ' s/\:/_/g ' | sed ' s/\。/_/g'` | grep "地址域" | sed '<strong class="ak">VLAN-信息</strong>q；d' | sed 's/^ * &lt;地址/ &lt;地址类型=\"pci\"/'</p></blockquote><p id="6532" class="pw-post-body-paragraph ie if hh ig b ih lq ij ik il lr in io ip ls ir is it lt iv iw ix lu iz ja jb ha bi translated">下面是基于上述vNIC过程的样子，注意VLAN信息变量被改为3，以匹配与Debian 88 vNIC相关的VLAN标签ID。</p><blockquote class="lg"><p id="3d22" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">$ sudo virsh node dev-dump XML ` ethtool-I ens2f 0 | grep bus-info | awk ' { print $ 2 } ' | sed 's/^/pci_/' | sed ' s/\:/_/g ' | sed ' s/\。/_/g'` | grep "地址域" | sed '<strong class="ak">3</strong>q；d' | sed 's/^ * &lt;地址/ &lt;地址类型=\"pci\"/'</p><p id="57f9" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated"><strong class="ak"> &lt;地址类型="pci "域='0x0000 '总线='0x13 '槽='0x10 '功能='0x4'/ &gt; </strong></p></blockquote><p id="3652" class="pw-post-body-paragraph ie if hh ig b ih lq ij ik il lr in io ip ls ir is it lt iv iw ix lu iz ja jb ha bi translated">创建一个名为kvm-vnic-attach.xml的文件(可以使用xml文件的任何名称),并确保它与您的vnic配置(MAC地址、VLAN标签ID (BMCS UI仪表板——附加的vNICS选项)以及上面的virsh nodedev-dumpxml输出)匹配，如下所示</p><blockquote class="lg"><p id="3a95" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">$ sudo VI/tmp/KVM-vnic-attach . XML</p><p id="c2db" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">####BMCS虚拟网卡信息+虚拟节点开发-转储xml输出</p><p id="e444" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated"><interface type="’hostdev’" managed="’yes’"/></p><p id="1602" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated"><source/></p><p id="145f" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated"><strong class="ak"> &lt;地址类型="pci "域='0x0000 '总线='0x13 '槽='0x10 '功能='0x4'/ &gt; </strong></p><p id="bf0b" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated"/><p id="9e0c" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated"><vlan/></p><p id="9990" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated"><tag id="’&lt;strong" class="ak"> 3  '/ &gt;</tag></p><p id="5980" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated"/><p id="43fe" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated"><mac address="’&lt;strong" class="ak">00:00:17:01:02:1E'/&gt;</mac></p><p id="dffc" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated"/><p id="e9d4" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated"># # # #/tmp/KVM-vnic-attach . XML的结尾</p></blockquote><p id="90ea" class="pw-post-body-paragraph ie if hh ig b ih lq ij ik il lr in io ip ls ir is it lt iv iw ix lu iz ja jb ha bi translated">保存并退出。</p><p id="fe23" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">运行以下命令行，将新hostdev NIC连接到KVM guest虚拟机。</p><blockquote class="lg"><p id="805e" class="lh li hh bd lj lk lv lw lx ly lz jb dx translated">$ sudo virsh attach-device debian 8/tmy/KVM-vnic-attach . XML-config</p></blockquote><p id="ff3c" class="pw-post-body-paragraph ie if hh ig b ih lq ij ik il lr in io ip ls ir is it lt iv iw ix lu iz ja jb ha bi translated">设备连接成功</p><p id="fd73" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">继续安装KVM虚拟管理器。打开virt-manager并验证您的新vNIC是否已添加到来宾XML配置中</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es mo"><img src="../Images/242c03fe554e05a0f2f1015d5fecdd67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-Wg_gndJ4w0GxoKI.png"/></div></div></figure><p id="ef12" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">选择引导选项，并将光盘设置为引导顺序的主光盘</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es mp"><img src="../Images/87748160ca209a0c5eb15fcb9c2b1f6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*P8jGMdr3T8mcUO5O.png"/></div></div></figure><p id="5de0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">检查光盘是否与本地ISO文件连接</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es mp"><img src="../Images/11d711f777a7a7d2d87f10d2e024f106.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Zpc17LTlQzDdsog_.png"/></div></div></figure><p id="f8d5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">并照常安装KVM客户操作系统。剩下的唯一一步是根据您的vNIC/VCN配置设置一个静态IP地址，这可以在KVM guest安装期间或之后完成。</p><p id="1726" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是本教程中使用的vNIC数据的一个示例。</p><p id="46be" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">静态IP:172.0.0.47</p><p id="f807" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">掩模:255.255.255.0</p><p id="2516" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">温伯格:172.0.0.1</p><p id="b593" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">域名系统:169.254.169.254</p><p id="7adc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">安装完成后，断开CD-ROM ISO，启动新的KVM guest虚拟机，您应该能够使用与您的BMCS虚拟网卡关联的公共IP地址以及您配置的服务连接到它。</p><p id="58e4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">BMCS KVM服务器上的Debian 8.8.0 Guest</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es mq"><img src="../Images/07aaea0542ee08363ef9991fb1f0953b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*_y-Rco57VZN1XIBq.png"/></div></div></figure><p id="8002" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用BMCS虚拟网卡公共IP地址的ssh连接</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es mr"><img src="../Images/54ff543044ebbda3a842342821833e57.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hcCUA0wn2kYxIcxz.png"/></div></div></figure><p id="4f7d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是一些在裸机KVM服务器实例上运行的其他KVM客户操作系统示例</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ms"><img src="../Images/f363a9340aedb302c17731ff87a50b13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EXGsPIp6QC5TDYGO.png"/></div></div></figure><p id="1483" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您在BMCS上的BM KVM服务器+多vNIC设置已经完成！</p><h1 id="94ea" class="jd je hh bd jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka bi translated">其他安全建议:</h1><ul class=""><li id="0401" class="ks kt hh ig b ih kb il kc ip ku it kv ix kw jb kx ky kz la bi translated">禁用ssh密码认证并启用SSH密钥认证(在/home/opc/中添加您的SSH公钥。ssh/授权密钥文件)</li><li id="e31e" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">保持KVM客户机防火墙处于启用状态，仅打开所需的端口</li><li id="71a2" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">定期修补您的KVM来宾虚拟机</li><li id="0a0e" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">尽可能使用VPN</li><li id="aa4d" class="ks kt hh ig b ih lb il lc ip ld it le ix lf jb kx ky kz la bi translated">安装一个堡垒服务器登录到您的BMCS KVM服务器，并使用内部IP地址只为后者</li></ul></div></div>    
</body>
</html>