<html>
<head>
<title>Exploring Android Q: Sharing Shortcuts</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">探索Android Q:分享快捷方式</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/exploring-android-q-sharing-shortcuts-a59e3b4821da?source=collection_archive---------2-----------------------#2019-03-29">https://medium.com/google-developer-experts/exploring-android-q-sharing-shortcuts-a59e3b4821da?source=collection_archive---------2-----------------------#2019-03-29</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/d6eb327f364b049c69f3f1339dacdbb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hLiL0qqfmMziUOENPc6WEQ.png"/></div></div></figure><blockquote class="ip iq ir"><p id="976a" class="is it iu iv b iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq ha bi translated">这篇文章最初发布在<a class="ae jr" href="https://joebirch.co/" rel="noopener ugc nofollow" target="_blank">https://joebirch.co/</a></p></blockquote><p id="3b75" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">几周前，我们看到了Android Q测试版的发布</p><p id="d33e" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">这个版本的Android带来了一系列令人兴奋的变化，我们需要让我们的应用程序做好准备。在这一组文章中，我将深入其中的每一篇，以便我们为应用程序做好充分准备！</p><p id="047d" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated"><strong class="iv hi">注:</strong>你可以在这里找到这篇文章<a class="ae jr" href="https://github.com/hitherejoe/Android-Q-Playground/tree/master" rel="noopener ugc nofollow" target="_blank">的代码。</a></p></div><div class="ab cl jv jw go jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="ha hb hc hd he"><p id="5525" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">正如Android Q的<a class="ae jr" href="https://developer.android.com/preview/features#settings-panels" rel="noopener ugc nofollow" target="_blank">测试版发行说明</a>所述，我们看到的变化之一是Android的直接分享功能的工作方式发生了一些变化。Direct Share API允许开发人员提供我们希望通过share sheet共享内容的直接收件人，无论是您最喜欢的消息应用程序中的联系人还是电子邮件，这都为您提供了一种直接与他们共享内容的快捷方式。然而，尽管这个特性非常简洁，但它的执行却从来没有那么顺利。最大的问题之一是加载这些联系人的延迟——请查看下面的示例屏幕共享:</p><figure class="kd ke kf kg fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kc"><img src="../Images/1ffd75a1020786e79bae54d500114a7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dgbsieh4ZNi1u-0x"/></div></div></figure><p id="8439" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">信用:<a class="ae jr" href="https://www.youtube.com/channel/UCBJycsmduvYEL83R_U4JriQ" rel="noopener ugc nofollow" target="_blank">马克斯·布朗利</a></p><p id="e6b7" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">你会注意到这里有一个直接股票期权加载的延迟。每当我打开股票单时，这种情况也经常发生在我身上。很多时候，我会不小心与联系人分享一些东西，而不是与应用程序分享，因为在延迟之后，更多的选项被加载，并将我最初的选择推得更低。为了改善share sheets提供的体验，我们现在可以使用一种新方法，称为共享快捷方式。这改变了应用程序为共享提供这些直接选项的方式，这意味着当打开共享表时，它们将被更快地检索到，消除了以前会出现的一些笨拙。</p><p id="3865" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">要做到这一点，我们需要提供一个将在运行时使用的共享目标列表。这种实现方式非常类似于我们在应用程序中使用的快捷方式API，它允许用户轻松访问我们应用程序的功能。类似于我们如何声明静态应用程序快捷方式，定义这些共享快捷方式首先要在我们的<strong class="iv hi"> res/xml </strong>目录中声明一个共享目标。这里，我们用嵌套的share-target声明了一个shortcuts元素——这个目标用于定义:</p><ul class=""><li id="ff53" class="kh ki hh iv b iw ix ja jb js kj jt kk ju kl jq km kn ko kp bi translated"><strong class="iv hi">目标类</strong>:用于声明共享活动被调用时要发起的活动</li><li id="773a" class="kh ki hh iv b iw kq ja kr js ks jt kt ju ku jq km kn ko kp bi translated"><strong class="iv hi"> Mime type </strong>:应该显示共享目标的数据类型。</li><li id="b0db" class="kh ki hh iv b iw kq ja kr js ks jt kt ju ku jq km kn ko kp bi translated"><strong class="iv hi">类别名称</strong>:共享类别的名称，这也将在配置共享目标时以编程方式使用。当涉及到共享目标时，可以定义多个类别。</li></ul><p id="7caa" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">例如，如果我有一个名为<strong class="iv hi"> ShareActivity </strong>的活动处理纯文本共享，那么定义它的<strong class="iv hi"> shortcuts xml </strong>文件将如下所示:</p><pre class="kd ke kf kg fd kv kw kx ky aw kz bi"><span id="e19a" class="la lb hh kw b fi lc ld l le lf">&lt;?xml version="1.0" encoding="utf-8"?&gt;<br/>&lt;shortcuts xmlns:android="http://schemas.android.com/apk/res/android"&gt;<br/>    &lt;share-target android:targetClass="co.joebirch.androidqplayground.ShareActivity"&gt;<br/>        &lt;data android:mimeType="text/plain" /&gt;<br/>        &lt;category android:name="co.joebirch.androidqplayground.category.TEXT_SHARE_TARGET" /&gt;<br/>    &lt;/share-target&gt;<br/>&lt;/shortcuts&gt;</span></pre><p id="5e68" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">定义好之后，我们需要在应用程序清单文件中创建对共享快捷方式的引用:</p><pre class="kd ke kf kg fd kv kw kx ky aw kz bi"><span id="f15c" class="la lb hh kw b fi lc ld l le lf">&lt;activity android:name=".MainActivity"&gt;<br/>    ...</span><span id="150a" class="la lb hh kw b fi lg ld l le lf">    &lt;meta-data android:name="android.app.shortcuts"<br/>               android:resource="@xml/share_shortcuts" /&gt;<br/>&lt;/activity&gt;</span></pre><p id="ac90" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">接下来，我们需要将我们的快捷方式添加到系统<a class="ae jr" href="https://developer.android.com/reference/android/content/pm/ShortcutManager" rel="noopener ugc nofollow" target="_blank">快捷方式管理器</a>中，这样系统就知道我们的快捷方式，并且可以在系统共享表中显示它们。这里我们将使用<a class="ae jr" href="https://developer.android.com/reference/android/support/v4/content/pm/ShortcutInfoCompat" rel="noopener ugc nofollow" target="_blank"> ShortcutInfoCompat </a>类的构建器，这将帮助我们创建显示在共享表中的快捷方式。</p><pre class="kd ke kf kg fd kv kw kx ky aw kz bi"><span id="4084" class="la lb hh kw b fi lc ld l le lf">ShortcutInfoCompat.Builder(context, Integer.toString(id))<br/>    .setShortLabel(id.toString())<br/>    .setIcon(IconCompat.createWithResource(context, R.drawable.ic_android_black_24dp))<br/>    .setIntent(Intent(Intent.ACTION_DEFAULT))<br/>    .setLongLived()<br/>    .setCategories(setOf(CATEGORY_TEXT_SHARE_TARGET))<br/>    .setPerson(<br/>        Person.Builder()<br/>            .setName(id.toString())<br/>            .build()<br/>    )<br/>    .build()</span></pre><p id="792f" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">虽然你以前可能使用过这个类来创建应用程序的快捷方式，但是你会注意到，从Android Q:</p><ul class=""><li id="b241" class="kh ki hh iv b iw ix ja jb js kj jt kk ju kl jq km kn ko kp bi translated"><strong class="iv hi"> setCategories </strong>:虽然构建器的这一功能之前已经可用，但如果您使用共享快捷方式，现在需要进行设置。这是为了让系统能够过滤掉违反共享意图的行为。</li><li id="3e78" class="kh ki hh iv b iw kq ja kr js ks jt kt ju ku jq km kn ko kp bi translated"><strong class="iv hi"> setLongLived </strong>:当一个快捷方式被设置为长期有效时，意味着即使在它作为动态快捷方式被删除后，系统服务仍然可以从缓存中访问它。</li><li id="1248" class="kh ki hh iv b iw kq ja kr js ks jt kt ju ku jq km kn ko kp bi translated"><strong class="iv hi"> setPerson </strong>:可以用来设置与该快捷方式关联的<a class="ae jr" href="https://developer.android.com/reference/android/app/Person" rel="noopener ugc nofollow" target="_blank"> Person </a>实例。虽然这不是共享快捷方式所必需的属性，但它有助于系统在共享表中提供适当的建议。注意:还有一个<strong class="iv hi"> setPersons </strong> builder函数，可以用来添加多个人员实例。</li></ul><p id="e3e1" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">请注意，这些共享目标可能仍需要在您的应用程序中更新，因为这可能不是一次性添加它们的情况。例如，您可能正在使用一个消息应用程序，在该应用程序中，用户添加了一个可以聊天的新朋友，或者甚至想要根据用户经常与谁共享内容来更改共享快捷方式。</p><p id="38c2" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">一旦我们有了快捷方式，我们就可以使用快捷方式管理器来添加快捷方式:</p><pre class="kd ke kf kg fd kv kw kx ky aw kz bi"><span id="a104" class="la lb hh kw b fi lc ld l le lf">ShortcutManagerCompat.addDynamicShortcuts(context, shortcuts)</span></pre><p id="d4f1" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">你会注意到这里我们使用的是<a class="ae jr" href="https://developer.android.com/reference/android/support/v4/content/pm/ShortcutManagerCompat" rel="noopener ugc nofollow" target="_blank"> ShortcutManagerCompat </a>类，而不是我们之前使用的<a class="ae jr" href="https://developer.android.com/reference/android/content/pm/ShortcutManager" rel="noopener ugc nofollow" target="_blank"> ShortcutManager </a>。<a class="ae jr" href="https://developer.android.com/reference/android/support/v4/content/pm/ShortcutManagerCompat" rel="noopener ugc nofollow" target="_blank"> ShortcutManagerCompat </a>来自AndroidX，在使用DirectShare API时为我们提供了向后兼容性，我们以前会用它来代替共享快捷方式。然而，如果我们想要利用<a class="ae jr" href="https://developer.android.com/reference/android/support/v4/content/pm/ShortcutManagerCompat" rel="noopener ugc nofollow" target="_blank"> ShortcutManagerCompat </a>，那么我们必须向将要处理共享意图的活动添加一些额外的元数据。</p><pre class="kd ke kf kg fd kv kw kx ky aw kz bi"><span id="7726" class="la lb hh kw b fi lc ld l le lf">&lt;activity android:name=".ShareActivity"&gt;<br/>    &lt;intent-filter&gt;<br/>        &lt;action android:name="android.intent.action.SEND" /&gt;<br/>        &lt;category android:name="android.intent.category.DEFAULT" /&gt;<br/>        &lt;data android:mimeType="text/plain" /&gt;<br/>    &lt;/intent-filter&gt;</span><span id="859c" class="la lb hh kw b fi lg ld l le lf">    &lt;meta-data<br/>            android:name="android.service.chooser.chooser_target_service"<br/>            android:value="androidx.sharetarget.ChooserTargetServiceCompat" /&gt;</span><span id="8a1f" class="la lb hh kw b fi lg ld l le lf">&lt;/activity&gt;</span></pre><p id="6775" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">我们现在可以运行我们的应用程序，调用共享操作，并看到我们的共享快捷方式显示在共享表中:</p><figure class="kd ke kf kg fd ii er es paragraph-image"><div class="er es lh"><img src="../Images/90e3ecf6c2c69e2eae8713464c987264.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/0*8wmIBun1cHRgIRE0"/></div></figure><p id="a2b4" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">另一个需要注意的重要事情是，这些本质上仍然是app快捷方式。因此，当我们使用ShortcutManager(或ShortcutManagerCompat)添加它们时，即使它们已被添加为共享目标，当长按应用程序图标时，它们仍会从应用程序启动器中显示。</p></div><div class="ab cl jv jw go jx" role="separator"><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka kb"/><span class="jy bw bk jz ka"/></div><div class="ha hb hc hd he"><p id="56ee" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">虽然不是所有的应用程序都可以使用新的共享快捷方式功能，但如果你是Android用户，这肯定会改善Android系统的体验。如果您正在开发一个目前使用DirectShare API的应用程序，那么迁移到这种新方法对您来说是最有利的。当设备运行Android Q时，使用快捷管理器的共享目标将被置于比通过DirectShare API添加的目标更高的优先级。如果其他应用程序已经实现了这种新的方法，那么你将面临快捷方式对用户隐藏的风险。</p><p id="e54e" class="pw-post-body-paragraph is it hh iv b iw ix iy iz ja jb jc jd js jf jg jh jt jj jk jl ju jn jo jp jq ha bi translated">本文概述了我们如何在应用程序中实现共享快捷方式的新方法，以及这样做时需要注意的一些事情。这些变化会影响你的应用吗？你对上面提到的任何事情有疑问吗？请不要忘记你的任何想法！</p><div class="li lj ez fb lk ll"><a href="https://twitter.com/hitherejoe" rel="noopener  ugc nofollow" target="_blank"><div class="lm ab dw"><div class="ln ab lo cl cj lp"><h2 class="bd hi fi z dy lq ea eb lr ed ef hg bi translated">乔·伯奇(@hitherejoe) |推特</h2><div class="ls l"><h3 class="bd b fi z dy lq ea eb lr ed ef dx translated">乔伯奇的最新推文(@hitherejoe)。Android Lead @Buffer。谷歌开发专家为@Android，@GooglePay &amp;…</h3></div><div class="lt l"><p class="bd b fp z dy lq ea eb lr ed ef dx translated">twitter.com</p></div></div><div class="lu l"><div class="lv l lw lx ly lu lz in ll"/></div></div></a></div></div></div>    
</body>
</html>