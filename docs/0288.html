<html>
<head>
<title>Room ğŸ”— RxJava</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">æˆ¿é—´ğŸ”—RxJava</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/androiddevelopers/room-rxjava-acb0cd4f3757?source=collection_archive---------1-----------------------#2017-06-23">https://medium.com/androiddevelopers/room-rxjava-acb0cd4f3757?source=collection_archive---------1-----------------------#2017-06-23</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/5414fdb8d24f521c1c8447ba7ee2c326.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X5aKXziMA3VUPhzicQiSzw.jpeg"/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx">Room and RxJava â€” easily linked together (<a class="ae hu" href="https://unsplash.com/photos/PDxYfXVlK2M" rel="noopener ugc nofollow" target="_blank">Source</a>)</figcaption></figure><div class=""/><p id="cafd" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">ä½¿ç”¨RxJavaåœ¨æˆ¿é—´ä¸­è¿›è¡ŒæŸ¥è¯¢</p><p id="bec1" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">æ›´å°‘çš„æ ·æ¿ä»£ç ï¼Œç¼–è¯‘æ—¶æ£€æŸ¥çš„SQLæŸ¥è¯¢ï¼Œæœ€é‡è¦çš„æ˜¯ï¼Œå¼‚æ­¥å’Œå¯è§‚å¯ŸæŸ¥è¯¢çš„èƒ½åŠ›â€”â€”å¬èµ·æ¥æ€ä¹ˆæ ·ï¼Ÿæ‰€æœ‰è¿™äº›éƒ½å¯ä»¥é€šè¿‡<a class="ae hu" href="https://developer.android.com/topic/libraries/architecture/room.html" rel="noopener ugc nofollow" target="_blank"> Room </a>ã€æ¥è‡ª<a class="ae hu" href="https://developer.android.com/topic/libraries/architecture/index.html" rel="noopener ugc nofollow" target="_blank">æ¶æ„ç»„ä»¶</a>çš„æŒä¹…æ€§åº“æ¥å®ç°ã€‚å¼‚æ­¥æŸ¥è¯¢è¿”å›<a class="ae hu" href="https://developer.android.com/topic/libraries/architecture/livedata.html" rel="noopener ugc nofollow" target="_blank"> LiveData </a>æˆ–RxJavaçš„<a class="ae hu" href="http://reactivex.io/RxJava/javadoc/io/reactivex/Maybe.html" rel="noopener ugc nofollow" target="_blank">å¯èƒ½æ˜¯</a>ã€<a class="ae hu" href="http://reactivex.io/RxJava/javadoc/io/reactivex/Single.html" rel="noopener ugc nofollow" target="_blank"> Single </a>æˆ–<a class="ae hu" href="http://reactivex.io/RxJava/javadoc/io/reactivex/Flowable.html" rel="noopener ugc nofollow" target="_blank">flowered</a>ã€‚è¿”å›LiveDataå’ŒFlowableçš„æŸ¥è¯¢æ˜¯å¯è§‚å¯Ÿçš„æŸ¥è¯¢ã€‚å®ƒä»¬å…è®¸æ‚¨åœ¨æ•°æ®å‘ç”Ÿå˜åŒ–æ—¶è·å¾—è‡ªåŠ¨æ›´æ–°ï¼Œä»¥ç¡®ä¿æ‚¨çš„UIåæ˜ æ•°æ®åº“ä¸­çš„æœ€æ–°å€¼ã€‚å¦‚æœä½ å·²ç»åœ¨ä½ çš„åº”ç”¨ä¸­ä½¿ç”¨äº†RxJava 2ï¼Œé‚£ä¹ˆå°†Roomä¸<code class="du js jt ju jv b"><a class="ae hu" href="http://reactivex.io/RxJava/javadoc/io/reactivex/Maybe.html" rel="noopener ugc nofollow" target="_blank">Maybe</a></code>ã€<code class="du js jt ju jv b"><a class="ae hu" href="http://reactivex.io/RxJava/javadoc/io/reactivex/Single.html" rel="noopener ugc nofollow" target="_blank">Single</a></code>å’Œ<code class="du js jt ju jv b"><a class="ae hu" href="http://reactivex.io/RxJava/javadoc/io/reactivex/Flowable.html" rel="noopener ugc nofollow" target="_blank">Flowable</a></code>ä¸€èµ·ä½¿ç”¨å°†ä¼šè½»è€Œæ˜“ä¸¾ã€‚</p><blockquote class="jw jx jy"><p id="b17a" class="iu iv jz iw b ix iy iz ja jb jc jd je ka jg jh ji kb jk jl jm kc jo jp jq jr ha bi translated">åæœŸç¼–è¾‘:ä»' 2.0.0-beta01 'å¼€å§‹ï¼ŒRoomä¹Ÿæ”¯æŒ<code class="du js jt ju jv b"><a class="ae hu" href="http://reactivex.io/RxJava/javadoc/io/reactivex/Observable.html" rel="noopener ugc nofollow" target="_blank">Observable</a></code></p></blockquote></div><div class="ab cl kd ke go kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ha hb hc hd he"><blockquote class="jw jx jy"><p id="b97a" class="iu iv jz iw b ix iy iz ja jb jc jd je ka jg jh ji kb jk jl jm kc jo jp jq jr ha bi translated">åæœŸç¼–è¾‘2:ä»2.1.0-alpha01å®¤å¼€å§‹ï¼Œç”¨<code class="du js jt ju jv b">@Insert</code>ã€<code class="du js jt ju jv b">@Delete</code>æˆ–<code class="du js jt ju jv b">@Update</code>æ ‡æ³¨çš„DAOæ–¹æ³•æ”¯æŒRxè¿”å›ç±»å‹<code class="du js jt ju jv b">Completable</code>ã€<code class="du js jt ju jv b">Single&lt;T&gt;</code>å’Œ<code class="du js jt ju jv b"> Maybe&lt;T&gt;</code>ã€‚</p></blockquote></div><div class="ab cl kd ke go kf" role="separator"><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki kj"/><span class="kg bw bk kh ki"/></div><div class="ha hb hc hd he"><p id="7ef4" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">è®©æˆ‘ä»¬è€ƒè™‘ä¸‹é¢çš„UI:ç”¨æˆ·èƒ½å¤Ÿçœ‹åˆ°å’Œç¼–è¾‘ä»–ä»¬çš„ç”¨æˆ·åã€‚è¿™äº›ä¿¡æ¯å’Œå…¶ä»–å…³äºç”¨æˆ·çš„ä¿¡æ¯éƒ½ä¿å­˜åœ¨æ•°æ®åº“ä¸­ã€‚ä¸‹é¢ä»‹ç»å¦‚ä½•æ’å…¥ã€æ›´æ–°ã€åˆ é™¤å’ŒæŸ¥è¯¢ç”¨æˆ·ã€‚</p><h1 id="400b" class="kk kl hx bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">æ’å…¥</h1><p id="b8e7" class="pw-post-body-paragraph iu iv hx iw b ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn lm jp jq jr ha bi translated">ä¸RxJavaçš„æˆ¿é—´é›†æˆå…è®¸æ’å…¥ä»¥ä¸‹ç›¸åº”çš„è¿”å›ç±»å‹:</p><ul class=""><li id="c0b6" class="ln lo hx iw b ix iy jb jc jf lp jj lq jn lr jr ls lt lu lv bi translated"><code class="du js jt ju jv b">Completable</code> â€”æ’å…¥å®Œæˆåç«‹å³è°ƒç”¨<code class="du js jt ju jv b">onComplete</code></li><li id="4fee" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr ls lt lu lv bi translated"><code class="du js jt ju jv b">Single&lt;Long&gt;</code>æˆ–<code class="du js jt ju jv b">Maybe&lt;Long&gt;</code>â€”<code class="du js jt ju jv b">onSuccess</code>ä¸Šå‘å‡ºçš„å€¼æ˜¯æ’å…¥é¡¹ç›®çš„è¡Œid</li><li id="2e3d" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr ls lt lu lv bi translated"><code class="du js jt ju jv b">Single&lt;List&lt;Long&gt;&gt;</code>æˆ–<code class="du js jt ju jv b">Maybe&lt;List&lt;Long&gt;&gt;</code> â€”å…¶ä¸­<code class="du js jt ju jv b">onSuccess</code>ä¸Šå‘å‡ºçš„å€¼æ˜¯æ’å…¥é¡¹ç›®çš„è¡Œidåˆ—è¡¨</li></ul><p id="0889" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">å¦‚æœæ•°æ®æ’å…¥é”™è¯¯ï¼Œ<code class="du js jt ju jv b">Completable</code>ã€<code class="du js jt ju jv b">Single</code>å’Œ<code class="du js jt ju jv b">Maybe</code>å°†åœ¨<code class="du js jt ju jv b">onError</code>ä¸­å‘å‡ºå¼‚å¸¸ã€‚</p><pre class="mb mc md me fd mf jv mg mh aw mi bi"><span id="81c6" class="mj kl hx jv b fi mk ml l mm mn">@Insert<br/>Completable insert(User user);</span><span id="366a" class="mj kl hx jv b fi mo ml l mm mn">// or<br/>@Insert<br/>Maybe&lt;Long&gt; insert(User user);</span><span id="2610" class="mj kl hx jv b fi mo ml l mm mn">// or<br/>@Insert<br/>Single&lt;Long&gt; insert(User[] user);</span><span id="dcfc" class="mj kl hx jv b fi mo ml l mm mn">// or<br/>@Insert<br/>Maybe&lt;List&lt;Long&gt;&gt; insert(User[] user);</span><span id="b7db" class="mj kl hx jv b fi mo ml l mm mn">// or<br/>@Insert<br/>Single&lt;List&lt;Long&gt;&gt; insert(User[] user);</span></pre><p id="77ba" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">ç”¨<code class="du js jt ju jv b">observeOn</code>æ“ä½œå™¨æŒ‡å®š<code class="du js jt ju jv b">Observer</code>è§‚å¯Ÿ<code class="du js jt ju jv b">Observable</code>çš„<code class="du js jt ju jv b">Scheduler</code>å’Œ<code class="du js jt ju jv b">subscribeOn</code>æŒ‡å®š<code class="du js jt ju jv b">Observable</code>æ“ä½œçš„<code class="du js jt ju jv b">Scheduler</code>ã€‚</p><h1 id="1af2" class="kk kl hx bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">æ›´æ–°/åˆ é™¤</h1><p id="77ce" class="pw-post-body-paragraph iu iv hx iw b ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn lm jp jq jr ha bi translated">æˆ¿é—´ä¸RxJavaçš„é›†æˆå…è®¸æ›´æ–°/åˆ é™¤ä»¥ä¸‹ç›¸åº”çš„é€€è´§ç±»å‹:</p><ul class=""><li id="0a8a" class="ln lo hx iw b ix iy jb jc jf lp jj lq jn lr jr ls lt lu lv bi translated"><code class="du js jt ju jv b">Completable</code> â€”æ›´æ–°/åˆ é™¤å®Œæˆåç«‹å³è°ƒç”¨<code class="du js jt ju jv b">onComplete</code></li><li id="f7d8" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr ls lt lu lv bi translated"><code class="du js jt ju jv b">Single&lt;Integer&gt;</code>æˆ–<code class="du js jt ju jv b">Maybe&lt;Integer&gt;</code> â€”å…¶ä¸­onSuccessä¸Šå‘å‡ºçš„å€¼æ˜¯å—æ›´æ–°/åˆ é™¤å½±å“çš„è¡Œæ•°</li></ul><pre class="mb mc md me fd mf jv mg mh aw mi bi"><span id="79ca" class="mj kl hx jv b fi mk ml l mm mn">@Update<br/>Completable update(User user);</span><span id="1a28" class="mj kl hx jv b fi mo ml l mm mn">// or<br/>@Update<br/>Single&lt;Integer&gt; update(User user);</span><span id="2e8c" class="mj kl hx jv b fi mo ml l mm mn">// or<br/>@Update<br/>Single&lt;Integer&gt; updateAll(User[] user);</span><span id="4c7a" class="mj kl hx jv b fi mo ml l mm mn">// or<br/>@Delete<br/>Single&lt;Integer&gt; deleteAll(User[] user);</span><span id="7a69" class="mj kl hx jv b fi mo ml l mm mn">// or<br/>@Delete<br/>Single&lt;Integer&gt; deleteAll(User[] user);</span></pre><p id="cbb0" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">ç”¨<code class="du js jt ju jv b">observeOn</code>æ“ä½œå™¨æŒ‡å®š<code class="du js jt ju jv b">Observer</code>è§‚å¯Ÿ<code class="du js jt ju jv b">Observable</code>çš„<code class="du js jt ju jv b">Scheduler</code>å’Œ<code class="du js jt ju jv b">subscribeOn</code>æŒ‡å®š<code class="du js jt ju jv b">Observable</code>æ“ä½œçš„<code class="du js jt ju jv b">Scheduler</code>ã€‚</p><h1 id="0222" class="kk kl hx bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">è¯¢é—®</h1><p id="b499" class="pw-post-body-paragraph iu iv hx iw b ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn lm jp jq jr ha bi translated">ä¸ºäº†ä»æ•°æ®åº“ä¸­è·å–ç”¨æˆ·ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ•°æ®è®¿é—®å¯¹è±¡ç±»(<code class="du js jt ju jv b">UserDao</code>)ä¸­ç¼–å†™ä»¥ä¸‹æŸ¥è¯¢:</p><pre class="mb mc md me fd mf jv mg mh aw mi bi"><span id="2ad2" class="mj kl hx jv b fi mk ml l mm mn">@Query(â€œSELECT * FROM Users WHERE id = :userIdâ€)<br/>User getUserById(String userId);</span></pre><p id="27a6" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">è¿™ç§æ–¹æ³•æœ‰ä¸¤ä¸ªç¼ºç‚¹:</p><ol class=""><li id="a6d2" class="ln lo hx iw b ix iy jb jc jf lp jj lq jn lr jr mp lt lu lv bi translated">è¿™æ˜¯ä¸€ä¸ªé˜»å¡çš„åŒæ­¥è°ƒç”¨</li><li id="7317" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr mp lt lu lv bi translated">æ¯æ¬¡ä¿®æ”¹ç”¨æˆ·æ•°æ®æ—¶ï¼Œæˆ‘ä»¬éƒ½éœ€è¦æ‰‹åŠ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•</li></ol><p id="6e2b" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Roomæä¾›è§‚å¯Ÿæ•°æ®åº“ä¸­æ•°æ®çš„é€‰é¡¹ï¼Œå¹¶å€ŸåŠ©RxJava <a class="ae hu" href="http://reactivex.io/RxJava/javadoc/io/reactivex/Maybe.html" rel="noopener ugc nofollow" target="_blank"> Maybe </a>ã€<a class="ae hu" href="http://reactivex.io/RxJava/javadoc/io/reactivex/Single.html" rel="noopener ugc nofollow" target="_blank"> Single </a>å’Œ<a class="ae hu" href="http://reactivex.io/RxJava/javadoc/io/reactivex/Flowable.html" rel="noopener ugc nofollow" target="_blank">flow</a>å¯¹è±¡æ‰§è¡Œå¼‚æ­¥æŸ¥è¯¢ã€‚</p><p id="d635" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">å¦‚æœä½ æ‹…å¿ƒçº¿ç¨‹ï¼ŒRoomä¼šè®©ä½ æ”¾æ¾ï¼Œå¹¶ç¡®ä¿<strong class="iw hy">å¯è§‚å¯Ÿçš„æŸ¥è¯¢æ˜¯åœ¨ä¸»çº¿ç¨‹</strong>ä¹‹å¤–å®Œæˆçš„ã€‚é€šè¿‡åœ¨<code class="du js jt ju jv b">observeOn</code>æ–¹æ³•ä¸­è®¾ç½®<code class="du js jt ju jv b">Scheduler</code>ï¼Œç”±æ‚¨å†³å®šåœ¨å“ªä¸ªçº¿ç¨‹ä¸Šå‘ä¸‹æ¸¸å‘å‡ºäº‹ä»¶ã€‚</p><p id="aaa6" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">å¯¹äºè¿”å›<code class="du js jt ju jv b">Maybe</code>æˆ–<code class="du js jt ju jv b">Single</code>çš„æŸ¥è¯¢ï¼Œç¡®ä¿æ‚¨ä½¿ç”¨ä¸åŒäº<code class="du js jt ju jv b">AndroidSchedulers.mainThread()</code>çš„<code class="du js jt ju jv b">Scheduler</code>è°ƒç”¨<code class="du js jt ju jv b">subscribeOn</code>ã€‚</p><p id="0723" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">è¦å¼€å§‹åœ¨RxJava 2ä¸­ä½¿ç”¨Roomï¼Œåªéœ€å°†ä»¥ä¸‹ä¾èµ–é¡¹æ·»åŠ åˆ°æ‚¨çš„<code class="du js jt ju jv b">build.gradle</code>æ–‡ä»¶ä¸­:</p><pre class="mb mc md me fd mf jv mg mh aw mi bi"><span id="91bf" class="mj kl hx jv b fi mk ml l mm mn">// RxJava support for Room<br/>implementation â€œandroid.arch.persistence.room:rxjava2:1.0.0-alpha5â€</span><span id="3dad" class="mj kl hx jv b fi mo ml l mm mn">// Testing support<br/>androidTestImplementation â€œandroid.arch.core:core-testing:1.0.0-alpha5â€</span></pre><h2 id="67ce" class="mj kl hx bd km mq mr ms kq mt mu mv ku jf mw mx ky jj my mz lc jn na nb lg nc bi translated"><strong class="ak">ä¹Ÿè®¸æ˜¯</strong></h2><pre class="mb mc md me fd mf jv mg mh aw mi bi"><span id="2d99" class="mj kl hx jv b fi mk ml l mm mn">@Query(â€œSELECT * FROM Users WHERE id = :userIdâ€)<br/><strong class="jv hy">Maybe</strong>&lt;User&gt; getUserById(String userId);</span></pre><p id="8ca4" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">äº‹æƒ…æ˜¯è¿™æ ·çš„:</p><ol class=""><li id="060c" class="ln lo hx iw b ix iy jb jc jf lp jj lq jn lr jr mp lt lu lv bi translated">å½“æ•°æ®åº“ä¸­æ²¡æœ‰ç”¨æˆ·å¹¶ä¸”æŸ¥è¯¢æ²¡æœ‰è¿”å›è¡Œæ—¶ï¼Œ<code class="du js jt ju jv b">Maybe</code>å°†<strong class="iw hy">å®Œæˆ</strong>ã€‚</li><li id="a94b" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr mp lt lu lv bi translated">å½“æ•°æ®åº“ä¸­æœ‰<strong class="iw hy">ç”¨æˆ·æ—¶ï¼Œ<code class="du js jt ju jv b">Maybe</code>å°†è§¦å‘<code class="du js jt ju jv b"><strong class="iw hy">onSuccess</strong></code> <strong class="iw hy">å¹¶å®Œæˆ</strong>ã€‚</strong></li><li id="7d46" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr mp lt lu lv bi translated">å¦‚æœåœ¨<code class="du js jt ju jv b">Maybe</code>å®Œæˆå<strong class="iw hy">ç”¨æˆ·è¢«æ›´æ–°</strong>ï¼Œåˆ™<strong class="iw hy">ä¸ä¼šå‘ç”Ÿä»»ä½•äº‹æƒ…</strong>ã€‚</li></ol><h2 id="ec8c" class="mj kl hx bd km mq mr ms kq mt mu mv ku jf mw mx ky jj my mz lc jn na nb lg nc bi translated"><strong class="ak">å•èº«</strong></h2><pre class="mb mc md me fd mf jv mg mh aw mi bi"><span id="560b" class="mj kl hx jv b fi mk ml l mm mn">@Query(â€œSELECT * FROM Users WHERE id = :userIdâ€)<br/><strong class="jv hy">Single</strong>&lt;User&gt; getUserById(String userId);</span></pre><p id="b17d" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">ä»¥ä¸‹æ˜¯ä¸€äº›åœºæ™¯:</p><ol class=""><li id="7b33" class="ln lo hx iw b ix iy jb jc jf lp jj lq jn lr jr mp lt lu lv bi translated">å½“<strong class="iw hy">æ•°æ®åº“</strong>ä¸­æ²¡æœ‰ç”¨æˆ·å¹¶ä¸”æŸ¥è¯¢æ²¡æœ‰è¿”å›è¡Œæ—¶ï¼Œ<code class="du js jt ju jv b">Single</code>å°†è§¦å‘<code class="du js jt ju jv b"><strong class="iw hy">onError(EmptyResultSetException.class)</strong></code></li><li id="0fe2" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr mp lt lu lv bi translated">å½“æ•°æ®åº“ä¸­æœ‰<strong class="iw hy">ç”¨æˆ·æ—¶ï¼Œ<code class="du js jt ju jv b">Single</code>ä¼šè§¦å‘<code class="du js jt ju jv b"><strong class="iw hy">onSuccess</strong></code>ã€‚</strong></li><li id="ede0" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr mp lt lu lv bi translated">å¦‚æœåœ¨<code class="du js jt ju jv b">Single</code>å®Œæˆå<strong class="iw hy">ç”¨æˆ·è¢«æ›´æ–°</strong>ï¼Œåˆ™<strong class="iw hy">ä¸ä¼šå‘ç”Ÿä»»ä½•äº‹æƒ…</strong>ã€‚</li></ol><h2 id="c924" class="mj kl hx bd km mq mr ms kq mt mu mv ku jf mw mx ky jj my mz lc jn na nb lg nc bi translated"><strong class="ak">å¯æµåŠ¨/å¯è§‚å¯Ÿ</strong></h2><pre class="mb mc md me fd mf jv mg mh aw mi bi"><span id="cca7" class="mj kl hx jv b fi mk ml l mm mn">@Query(â€œSELECT * FROM Users WHERE id = :userIdâ€)<br/><strong class="jv hy">Flowable</strong>&lt;User&gt; getUserById(String userId);</span></pre><p id="3326" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">ä¸‹é¢æ˜¯<code class="du js jt ju jv b">Flowable</code> / <code class="du js jt ju jv b">Observable</code>çš„è¡Œä¸ºæ–¹å¼:</p><ol class=""><li id="5e97" class="ln lo hx iw b ix iy jb jc jf lp jj lq jn lr jr mp lt lu lv bi translated">å½“<strong class="iw hy">æ•°æ®åº“</strong>ä¸­æ²¡æœ‰ç”¨æˆ·ï¼ŒæŸ¥è¯¢æ²¡æœ‰è¿”å›è¡Œæ—¶ï¼Œ<code class="du js jt ju jv b"><strong class="iw hy">Flowable</strong></code> <strong class="iw hy">ä¸ä¼šå‘å‡º</strong>ã€<code class="du js jt ju jv b">onNext</code>å’Œ<code class="du js jt ju jv b">onError</code>ã€‚</li><li id="6e96" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr mp lt lu lv bi translated">å½“æ•°æ®åº“ä¸­æœ‰<strong class="iw hy">ç”¨æˆ·æ—¶ï¼Œ<code class="du js jt ju jv b">Flowable</code>å°†è§¦å‘<code class="du js jt ju jv b"><strong class="iw hy">onNext</strong></code>ã€‚</strong></li><li id="e057" class="ln lo hx iw b ix lw jb lx jf ly jj lz jn ma jr mp lt lu lv bi translated">æ¯æ¬¡<strong class="iw hy">ç”¨æˆ·æ•°æ®æ›´æ–°</strong>æ—¶ï¼Œ<code class="du js jt ju jv b">Flowable</code>å¯¹è±¡ä¼šè‡ªåŠ¨<strong class="iw hy">å‘å‡º</strong>ï¼Œè®©ä½ æ ¹æ®æœ€æ–°æ•°æ®æ›´æ–°UIã€‚</li></ol><h1 id="c044" class="kk kl hx bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">æµ‹è¯•</h1><p id="7d6f" class="pw-post-body-paragraph iu iv hx iw b ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm jn lm jp jq jr ha bi translated">æµ‹è¯•ä¸€ä¸ªè¿”å›<code class="du js jt ju jv b">Maybe</code> / <code class="du js jt ju jv b">Single</code> / <code class="du js jt ju jv b">Flowable</code>çš„æŸ¥è¯¢ä¸æµ‹è¯•å®ƒçš„åŒæ­¥å¯¹ç­‰é¡¹æ²¡æœ‰å¤ªå¤§çš„ä¸åŒã€‚åœ¨<code class="du js jt ju jv b">UserDaoTest</code>ä¸­ï¼Œæˆ‘ä»¬ç¡®ä¿ä½¿ç”¨å†…å­˜æ•°æ®åº“ï¼Œå› ä¸ºå½“è¿›ç¨‹è¢«ç»ˆæ­¢æ—¶ï¼Œå­˜å‚¨åœ¨è¿™é‡Œçš„ä¿¡æ¯ä¼šè¢«è‡ªåŠ¨æ¸…é™¤ã€‚</p><pre class="mb mc md me fd mf jv mg mh aw mi bi"><span id="ffcc" class="mj kl hx jv b fi mk ml l mm mn">@RunWith(AndroidJUnit4.class)<br/>public class UserDaoTest {<br/>â€¦<br/>private UsersDatabase mDatabase;</span><span id="0551" class="mj kl hx jv b fi mo ml l mm mn">@Before<br/>public void initDb() throws Exception {<br/>    mDatabase = Room.<em class="jz">inMemoryDatabaseBuilder</em>(<br/>                     InstrumentationRegistry.<em class="jz">getContext</em>(),<br/>                     UsersDatabase.class)<br/>            // allowing main thread queries, just for testing<br/>            .allowMainThreadQueries()<br/>            .build();<br/>}<br/><br/>@After<br/>public void closeDb() throws Exception {<br/>    mDatabase.close();<br/>}</span></pre><p id="a18f" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">å°†<code class="du js jt ju jv b">InstantTaskExecutorRule</code>è§„åˆ™æ·»åŠ åˆ°æ‚¨çš„æµ‹è¯•ä¸­ï¼Œä»¥ç¡®ä¿Roomç«‹å³æ‰§è¡Œæ‰€æœ‰æ•°æ®åº“æ“ä½œã€‚</p><pre class="mb mc md me fd mf jv mg mh aw mi bi"><span id="14b2" class="mj kl hx jv b fi mk ml l mm mn">@Rule<br/>public InstantTaskExecutorRule instantTaskExecutorRule = <br/>                                      new InstantTaskExecutorRule();</span></pre><p id="58fa" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">è®©æˆ‘ä»¬å®ç°ä¸€ä¸ªæµ‹è¯•ï¼Œè®¢é˜…<code class="du js jt ju jv b">getUserById</code>çš„å‘å°„ï¼Œå¹¶æ£€æŸ¥å½“ç”¨æˆ·è¢«æ’å…¥æ—¶ï¼Œæ­£ç¡®çš„æ•°æ®æ˜¯å¦ç”±<code class="du js jt ju jv b">Flowable</code>å‘å°„ã€‚</p><pre class="mb mc md me fd mf jv mg mh aw mi bi"><span id="0742" class="mj kl hx jv b fi mk ml l mm mn">@Test<br/>public void insertAndGetUserById() {<br/>    // Given that we have a user in the data source<br/>    mDatabase.userDao().insertUser(<em class="jz">USER</em>);</span><span id="f597" class="mj kl hx jv b fi mo ml l mm mn">    // When subscribing to the emissions of user<br/>    mDatabase.userDao()<br/>             .getUserById(<em class="jz">USER</em>.getId())<br/>             .test()<br/>             // assertValue asserts that there was only one emission<br/>             .assertValue(new Predicate&lt;User&gt;() {<br/>                @Override<br/>                public boolean test(User user) throws Exception {<br/>                    // The emitted user is the expected one<br/>                    return user.getId().equals(<em class="jz">USER</em>.getId()) &amp;&amp;<br/>                      user.getUserName().equals(<em class="jz">USER</em>.getUserName());<br/>                }<br/>            });<br/>}</span></pre><p id="26a1" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">å°±æ˜¯è¿™æ ·ï¼å¦‚æœæ‚¨åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨RxJava 2ï¼Œä¹Ÿè¦è®©æ‚¨çš„æ•°æ®åº“å…·æœ‰ååº”æ€§ï¼Œå¹¶ç¡®ä¿æ‚¨çš„UIæ€»æ˜¯æ˜¾ç¤ºæœ€æ–°çš„æ•°æ®ã€‚ç‚¹å‡»æŸ¥çœ‹ä½¿ç”¨Roomå’ŒRxJava <a class="ae hu" href="https://github.com/googlesamples/android-architecture-components/tree/master/BasicRxJavaSample" rel="noopener ugc nofollow" target="_blank">çš„ç¤ºä¾‹åº”ç”¨ç¨‹åºã€‚</a></p></div></div>    
</body>
</html>