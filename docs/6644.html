<html>
<head>
<title>Data-driven migration testing with REST APIs and Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用REST APIs和Python进行数据驱动的迁移测试</h1>
<blockquote>原文：<a href="https://medium.com/quick-code/data-driven-migration-testing-with-rest-apis-and-python-4585fb13b23f?source=collection_archive---------1-----------------------#2019-05-27">https://medium.com/quick-code/data-driven-migration-testing-with-rest-apis-and-python-4585fb13b23f?source=collection_archive---------1-----------------------#2019-05-27</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="16fa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">数据迁移是将信息(数据)从一个系统转移到新系统的过程。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/2545fd7f78bb8bdad8862bc0e3d5afe1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mNUAms4XoRHJi6iUVuHpHA.png"/></div></div><figcaption class="jo jp et er es jq jr bd b be z dx">Image courtesy: <a class="ae js" href="https://www.cobalt.net/" rel="noopener ugc nofollow" target="_blank">https://www.cobalt.net</a></figcaption></figure><h2 id="76a9" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ip ke kf kg it kh ki kj ix kk kl km kn bi translated">背景</h2><p id="d4be" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">在通过在数据库上运行迁移脚本来迁移数据之后，确保迁移的数据“正确地”进入数据库是很重要的，尤其是在数据的正确性是首要考虑的问题并且任何与该数据有关的问题都可能是昂贵的情况下，例如涉及有价值的数据、敏感信息、基于一些复杂的业务逻辑从迁移的数据中导出的数据等的交易记录。</p><h2 id="a58b" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ip ke kf kg it kh ki kj ix kk kl km kn bi translated">问题陈述</h2><p id="632a" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">考虑这个简单的例子，我们打算将数据从多个CSV文件迁移到数据库，来自数据库的数据在银行账户管理系统的API层进行处理。这个系统有不同的电话号码的不同用户。</p><p id="934a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里，我们有两个CSV(<em class="kt">users . CSV</em>包含银行账户持有人的主要详细信息，以及<em class="kt"> user_account_details.csv </em>包含不同用户在各自账户中的余额和奖励金额的详细信息)。在现实世界中，可能有更多这样的CSV文件。事实上，可以有另一个数据库来代替CSV。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ku"><img src="../Images/f6f11924361eb34e75a200983b0d0b5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RgOs3b0eQ3CQXPZs4dDXFg.png"/></div></div></figure><p id="3669" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如前所述，确保这些数据“正确地”进入数据库是至关重要的。<strong class="ig hi">因此，在API层测试迁移脚本和业务逻辑变得很重要。</strong>因为实际数据的正确性是这里最关心的问题，所以仅仅做一些简单的测试，比如针对来自CSV的参考数据记录的计数断言迁移数据记录的计数，可能是不够的(事实上，这是不可能的！).</p><h2 id="1461" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ip ke kf kg it kh ki kj ix kk kl km kn bi translated">方法</h2><p id="b57d" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">所以我用Python编程语言使用了类似<a class="ae js" href="http://docs.lemoncheesecake.io/en/latest/ddt.html" rel="noopener ugc nofollow" target="_blank"><em class="kt">lemoncheesecake</em></a>的测试框架/运行器的<a class="ae js" href="https://en.wikipedia.org/wiki/Data-driven_testing" rel="noopener ugc nofollow" target="_blank">数据驱动测试</a>功能。将会有一个<a class="ae js" href="http://docs.lemoncheesecake.io/en/latest/tests-and-suites.html" rel="noopener ugc nofollow" target="_blank"><em class="kt">lemoncheesecake</em></a>测试套件，该套件将具有参数化的测试，该测试将运行来自参考CSV(该CSV可能本质上是馈送给迁移脚本以迁移数据的相同文件)的不同记录，并通过进行实际的相关REST API调用来验证不同的数据点。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kv"><img src="../Images/c2919603c9ee2d7ad9873b51c9f5c9b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jt6jA1I-cHDrhZWp4JwA0w.png"/></div></div></figure><p id="9fd1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是测试套件的样子。当然，在现实世界中，通过断言从API响应返回的值，可以实现更多的验证。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="kw kx l"/></div></figure></div></div>    
</body>
</html>