<html>
<head>
<title>What happens when Vagrant multi-machines and Oracle VirtualBox, meet host-only networking?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">流浪多机和Oracle VirtualBox，遇到纯主机联网会怎么样？</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/what-happens-when-vagrant-multi-machines-and-oracle-virtualbox-meet-host-only-networking-d459b48ce87c?source=collection_archive---------4-----------------------#2020-02-06">https://medium.com/oracledevs/what-happens-when-vagrant-multi-machines-and-oracle-virtualbox-meet-host-only-networking-d459b48ce87c?source=collection_archive---------4-----------------------#2020-02-06</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/b6d5e68945e040136065ad4041f1252c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xa8WkxZeche3cB1LwvQD0g.png"/></div></div></figure><p id="3979" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您只想运行一台虚拟机，那么通常会希望它能够连接到主机。如果您有多个虚拟机，您会希望它们能够连接到主机和其他虚拟机。</p><p id="909d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">支持虚拟机连接是通过纯主机网络实现的。</p><p id="fe53" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">使用Oracle VirtualBox进行漫游是管理多个虚拟机的一种很好的方式，但是仅主机联网也可以单独使用Oracle VirtualBox来建立。</p></div><div class="ab cl jn jo go jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ha hb hc hd he"><p id="2393" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">首先，作为一项预先检查，确定主机上是否存在其它仅限主机的网络很有帮助。只需用VBoxManage命令查询Oracle VirtualBox。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="1bce" class="kd ke hh jz b fi kf kg l kh ki">&gt; VBoxManage list hostonlyifs</span></pre><p id="18b6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果存在现有的纯主机网络，您可以像这样删除它们:</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="eb4a" class="kd ke hh jz b fi kf kg l kh ki">&gt; VBoxManage hostonlyif remove "VirtualBox Host-Only Ethernet Adapter"<br/>0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%</span><span id="1e53" class="kd ke hh jz b fi kj kg l kh ki">&gt;</span></pre><p id="1983" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">由于我们将创建一个仅包含主机的网络，请确保参与其中的虚拟机已关闭。一旦创建了网络，虚拟机将只参与启动。</p><p id="583a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果使用vagger，则使用以下命令关闭活动的虚拟机:</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="0c6a" class="kd ke hh jz b fi kf kg l kh ki">&gt; vagrant halt<br/>==&gt; email-MDA: Attempting graceful shutdown of VM...<br/>==&gt; email-MTA: Attempting graceful shutdown of VM...</span><span id="e93d" class="kd ke hh jz b fi kj kg l kh ki">&gt;</span></pre><p id="e01d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Oracle VirtualBox CLI将告诉您虚拟机的运行状态。这将验证虚拟机是否已关闭。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="59e0" class="kd ke hh jz b fi kf kg l kh ki">&gt;VBoxManage list runningvms</span><span id="2959" class="kd ke hh jz b fi kj kg l kh ki">&gt;</span></pre><p id="699c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">此外，Oracle Virtual Box GUI将显示虚拟机的运行状态。</p><figure class="ju jv jw jx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kk"><img src="../Images/1d095d064a4b76d771f587186ab0eb7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*VQZvZKyY2BWJjeRNqYwEvQ.jpeg"/></div></div></figure></div><div class="ab cl jn jo go jp" role="separator"><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js jt"/><span class="jq bw bk jr js"/></div><div class="ha hb hc hd he"><p id="82a1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，我们准备在主机上从VirtualBox创建仅主机网络。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="ca35" class="kd ke hh jz b fi kf kg l kh ki">&gt; VBoxManage hostonlyif create<br/>0%...10%...20%...30%...40%...50%...60%...70%...80%...90%...100%<br/>Interface 'VirtualBox Host-Only Ethernet Adapter #2' was successfully created</span><span id="64d7" class="kd ke hh jz b fi kj kg l kh ki">&gt;</span></pre><p id="c2a7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Oracle VirtualBox将选择主机专用网络的名称。您通常会看到类似“VirtualBox主机专用以太网适配器”的网络名称。在上面的例子中，接口被命名为“VirtualBox主机专用以太网适配器#2”。</p><p id="c2ba" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">下一步是配置我们刚刚创建的仅限主机的网络。我们在配置中指定的IP地址将是该网络主机的IP地址。我们使用网络ID 192 . 168 . 1 . 0，因此主机IP地址将变为192.168.1.1。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="41a7" class="kd ke hh jz b fi kf kg l kh ki">&gt; VBoxManage hostonlyif ipconfig "VirtualBox Host-Only Ethernet Adapter #2" --ip 192.168.1.1 --netmask 255.255.255.0</span><span id="fdc5" class="kd ke hh jz b fi kj kg l kh ki">&gt;</span></pre><p id="1eac" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">从Oracle VirtualBox中，我们可以确认这个特定网络的主机IP地址是192.168.1.1。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="e603" class="kd ke hh jz b fi kf kg l kh ki">&gt; VBoxManage list hostonlyifs<br/>Name:            VirtualBox Host-Only Ethernet Adapter<br/>GUID:            775f4a47-d503-4c28-a266-4e8f05662d68<br/>DHCP:            Disabled<br/>IPAddress:       192.168.1.1<br/>NetworkMask:     255.255.255.0<br/>IPV6Address:     fe80::5dcc:2878:a2ae:1d40<br/>IPV6NetworkMaskPrefixLength: 64<br/>HardwareAddress: 0a:00:27:00:00:0e<br/>MediumType:      Ethernet<br/>Wireless:        No<br/>Status:          Up<br/>VBoxNetworkName: HostInterfaceNetworking-VirtualBox Host-Only Ethernet Adapter</span><span id="725b" class="kd ke hh jz b fi kj kg l kh ki">&gt;</span></pre><p id="e1bd" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">同样，在主机命令行中使用ipconfig命令，我们可以确认该网络的主机IP地址是192.168.1.1。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="2f95" class="kd ke hh jz b fi kf kg l kh ki">&gt; ipconfig</span><span id="4f1d" class="kd ke hh jz b fi kj kg l kh ki">Windows IP Configuration</span><span id="d85b" class="kd ke hh jz b fi kj kg l kh ki">..</span><span id="be01" class="kd ke hh jz b fi kj kg l kh ki">Ethernet adapter VirtualBox Host-Only Network #2:</span><span id="da90" class="kd ke hh jz b fi kj kg l kh ki">Connection-specific DNS Suffix  . :<br/>   Link-local IPv6 Address . . . . . : fe80::30f6:6255:ec99:62f4%13<br/>   IPv4 Address. . . . . . . . . . . : 192.168.1.1<br/>   Subnet Mask . . . . . . . . . . . : 255.255.255.0<br/>   Default Gateway . . . . . . . . . :</span><span id="68d1" class="kd ke hh jz b fi kj kg l kh ki">..</span><span id="c206" class="kd ke hh jz b fi kj kg l kh ki">&gt;</span></pre><p id="f5e4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在启动虚拟机之前，我们需要确保VirtualBox网络主机专用设置与我们刚刚创建的网络相匹配。因此，对于我们打算添加到网络中的所有虚拟机，设置需要是“VirtualBox主机专用以太网适配器#2”。</p><figure class="ju jv jw jx fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kl"><img src="../Images/9963457ec0a1d6d62eedec4865e3f391.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RCFEPR0sz71jTcuE_j7Imw.jpeg"/></div></div></figure><p id="5ae1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在我们已经准备好启动虚拟机了。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="5393" class="kd ke hh jz b fi kf kg l kh ki">&gt; vagrant up</span></pre><p id="5fc1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这些多机的漫游文件预先设置了静态IP地址，如下所示:</p><ul class=""><li id="70e0" class="km kn hh ir b is it iw ix ja ko je kp ji kq jm kr ks kt ku bi translated">主机名“email-MDA”(IP地址= 192.168.1.10)</li><li id="7939" class="km kn hh ir b is kv iw kw ja kx je ky ji kz jm kr ks kt ku bi translated">主机名“电子邮件-MTA”(IP地址= 192.168.1.9)</li></ul><p id="4233" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">虚拟机启动后，只需登录其中一台机器:</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="3827" class="kd ke hh jz b fi kf kg l kh ki">&gt; vagrant ssh email-MDA</span><span id="7631" class="kd ke hh jz b fi kj kg l kh ki">Welcome to Oracle Linux Server release 8.0 (GNU/Linux package kernel-uek is not installed)</span><span id="7f08" class="kd ke hh jz b fi kj kg l kh ki">The Oracle Linux End-User License Agreement can be viewed here:</span><span id="ec28" class="kd ke hh jz b fi kj kg l kh ki">* /usr/share/eula/eula.en_US</span><span id="c101" class="kd ke hh jz b fi kj kg l kh ki">For additional packages, updates, documentation and community help, see:</span><span id="84a1" class="kd ke hh jz b fi kj kg l kh ki">* <a class="ae la" href="http://yum.oracle.com/" rel="noopener ugc nofollow" target="_blank">http://yum.oracle.com/</a></span><span id="07d5" class="kd ke hh jz b fi kj kg l kh ki">Last login: Sat Feb  1 03:23:36 2020 from 10.0.2.2<br/>[vagrant@smtp-mda ~]$</span></pre><p id="e242" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在执行ping操作，确认纯主机网络已经启用了虚拟机之间的连接。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="5d66" class="kd ke hh jz b fi kf kg l kh ki">[vagrant@smtp-mda ~]$ ping 192.168.1.9 -c 1<br/>PING 192.168.1.9 (192.168.1.9) 56(84) bytes of data.<br/>64 bytes from 192.168.1.9: icmp_seq=1 ttl=64 time=0.414 ms</span><span id="57ff" class="kd ke hh jz b fi kj kg l kh ki">--- 192.168.1.9 ping statistics ---<br/>1 packets transmitted, 1 received, 0% packet loss, time 0ms<br/>rtt min/avg/max/mdev = 0.414/0.414/0.414/0.000 ms<br/>[vagrant@smtp-mda ~]$ </span></pre><p id="e4e9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在ping主机，证明它也是仅包含主机的网络的一部分，并且具有连通性。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="f7bc" class="kd ke hh jz b fi kf kg l kh ki">[vagrant@smtp-mda ~]$ ping 192.168.1.1 -c 1<br/>PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data.<br/>64 bytes from 192.168.1.1: icmp_seq=1 ttl=128 time=1.07 ms</span><span id="ca0c" class="kd ke hh jz b fi kj kg l kh ki">--- 192.168.1.1 ping statistics ---<br/>1 packets transmitted, 1 received, 0% packet loss, time 0ms<br/>rtt min/avg/max/mdev = 1.067/1.067/1.067/0.000 ms<br/>[vagrant@smtp-mda ~]$ exit<br/>logout<br/>Connection to 127.0.0.1 closed.</span><span id="fb96" class="kd ke hh jz b fi kj kg l kh ki">&gt;</span></pre><p id="6fdf" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">有2台虚拟机，让我们在另一台虚拟机上执行类似的连接测试。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="4555" class="kd ke hh jz b fi kf kg l kh ki">&gt; vagrant ssh email-MTA</span><span id="cae9" class="kd ke hh jz b fi kj kg l kh ki">Welcome to Oracle Linux Server release 8.0 (GNU/Linux package kernel-uek is not installed)</span><span id="2718" class="kd ke hh jz b fi kj kg l kh ki">The Oracle Linux End-User License Agreement can be viewed here:</span><span id="6eb4" class="kd ke hh jz b fi kj kg l kh ki">* /usr/share/eula/eula.en_US</span><span id="184d" class="kd ke hh jz b fi kj kg l kh ki">For additional packages, updates, documentation and community help, see:</span><span id="3d7b" class="kd ke hh jz b fi kj kg l kh ki">* <a class="ae la" href="http://yum.oracle.com/" rel="noopener ugc nofollow" target="_blank">http://yum.oracle.com/</a></span><span id="ca42" class="kd ke hh jz b fi kj kg l kh ki">Last login: Sat Feb  1 03:35:27 2020 from 10.0.2.2<br/>[vagrant@smtp-mta ~]$</span></pre><p id="e56d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在对备用虚拟机执行ping操作。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="8134" class="kd ke hh jz b fi kf kg l kh ki">[vagrant@smtp-mta ~]$ ping 192.168.1.10 -c 1<br/>PING 192.168.1.10 (192.168.1.10) 56(84) bytes of data.<br/>64 bytes from 192.168.1.10: icmp_seq=1 ttl=64 time=1.99 ms</span><span id="0921" class="kd ke hh jz b fi kj kg l kh ki">--- 192.168.1.10 ping statistics ---<br/>1 packets transmitted, 1 received, 0% packet loss, time 0ms<br/>rtt min/avg/max/mdev = 1.986/1.986/1.986/0.000 ms<br/>[vagrant@smtp-mta ~]$ </span></pre><p id="fdbc" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">像之前一样Ping主机。</p><pre class="ju jv jw jx fd jy jz ka kb aw kc bi"><span id="7805" class="kd ke hh jz b fi kf kg l kh ki">[vagrant@smtp-mta ~]$ ping 192.168.1.1 -c 1<br/>PING 192.168.1.1 (192.168.1.1) 56(84) bytes of data.<br/>64 bytes from 192.168.1.1: icmp_seq=1 ttl=128 time=0.974 ms</span><span id="5b7d" class="kd ke hh jz b fi kj kg l kh ki">--- 192.168.1.1 ping statistics ---<br/>1 packets transmitted, 1 received, 0% packet loss, time 0ms<br/>rtt min/avg/max/mdev = 0.974/0.974/0.974/0.000 ms<br/>[vagrant@smtp-mta ~]$ exit<br/>logout<br/>Connection to 127.0.0.1 closed.</span><span id="6164" class="kd ke hh jz b fi kj kg l kh ki">&gt;</span></pre><p id="06f4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">虚拟机已启动，纯主机网络将所有设备连接在一起。</p><p id="7d3d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Oracle VirtualBox和纯主机网络让这一切成为现实！</p><p id="196e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Paul Guerin是一名专注于Oracle数据库的国际顾问。Paul在东南亚的全球交付中心工作，但他的客户来自澳大利亚、欧洲、亚洲和北美。此外，他还出席了一些世界领先的甲骨文会议，包括甲骨文2013年世界开放大会。自2015年以来，他的工作一直是IOUG最佳实践技巧小册子以及AUSOUG、Oracle Technology Network和Oracle Developers (Medium)出版物的主题。2019年，他被授予My Oracle支持社区最有价值贡献者。他是一名DBA OCP，并将继续参与Oracle ACE计划。</p></div></div>    
</body>
</html>