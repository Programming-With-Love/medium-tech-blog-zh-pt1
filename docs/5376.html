<html>
<head>
<title>Embedding OpenLayers in Oracle JET for Advanced Maps and GIS style User Interfaces</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Oracle JET中嵌入OpenLayers以实现高级地图和GIS风格的用户界面</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/embedding-openlayers-in-oracle-jet-for-advanced-maps-and-gis-style-user-interfaces-1972f01f42c?source=collection_archive---------0-----------------------#2018-01-01">https://medium.com/oracledevs/embedding-openlayers-in-oracle-jet-for-advanced-maps-and-gis-style-user-interfaces-1972f01f42c?source=collection_archive---------0-----------------------#2018-01-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="1037" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Oracle JET是用于创建富web应用程序的工具包。许多应用将具有与位置相关的方面。这种应用程序可以从高级地图功能中受益，这些功能用于在地图中呈现数据，允许用户与地图进行交互，以便制定查询、导航到相关细节或操作数据。OpenLayers是用于在web应用程序中处理地图的最著名的开源JavaScript库之一。它提供了一个API来构建丰富的基于web的地理应用程序，类似于Google Maps和Bing Maps。OpenLayers合作良好的地理数据提供商之一是开放街道地图(<a class="ae jc" href="http://wiki.openstreetmap.org/wiki/Main_Page" rel="noopener ugc nofollow" target="_blank">OSM</a>)——也是完全开源的。</p><p id="1ef1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本文中，我将报告我在Oracle JET中集成OpenLayers和OSM的第一步。在几个简单的步骤中，我将创建如下图所示的JET应用程序——一个JET复选框集和一个OpenLayers地图的混合，在该复选框集中可以选择国家，该OpenLayers地图通过JavaScript操作来显示(和隐藏)所选择(和取消选择)的国家的标记。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/af6177c82ca336ee5caa79c0eaccf77f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/0*DLsC8oc5Nb6V9RYl."/></div></figure><p id="fc47" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">本文将为您在JET中使用OpenLayers提供一个起点。本文的源代码可以从GitHub下载:【https://github.com/lucasjellema/jet-and-openlayers】T2。</p><p id="9e33" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">步骤:</p><ul class=""><li id="4099" class="jl jm hh ig b ih ii il im ip jn it jo ix jp jb jq jr js jt bi translated">创建新的JET应用程序(例如使用JET CLI)</li><li id="8f70" class="jl jm hh ig b ih ju il jv ip jw it jx ix jy jb jq jr js jt bi translated">下载OpenLayers发行版并添加到JET应用程序的文件夹中</li><li id="0eb8" class="jl jm hh ig b ih ju il jv ip jw it jx ix jy jb jq jr js jt bi translated">为OpenLayers库配置JET应用程序</li><li id="8249" class="jl jm hh ig b ih ju il jv ip jw it jx ix jy jb jq jr js jt bi translated">将DIV作为地图容器添加到HTML文件中</li><li id="24a4" class="jl jm hh ig b ih ju il jv ip jw it jx ix jy jb jq jr js jt bi translated">添加JavaScript代码来初始化和操作ViewModel JS文件的映射</li></ul><p id="d3e6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">更详细地说:</p><h1 id="945f" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">1.创建新的Oracle JET应用程序</h1><p id="0265" class="pw-post-body-paragraph ie if hh ig b ih kx ij ik il ky in io ip kz ir is it la iv iw ix lb iz ja jb ha bi translated">例如，遵循Oracle JET网页上描述的步骤:<a class="ae jc" href="http://www.oracle.com/webfolder/technetwork/jet/globalGetStarted.html" rel="noopener ugc nofollow" target="_blank">http://www . Oracle . com/Web folder/tech network/JET/global get started . html</a></p><p id="35d0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用</p><pre class="je jf jg jh fd lc ld le lf aw lg bi"><span id="09dc" class="lh ka hh ld b fi li lj l lk ll">ojet create projectname</span></pre><p id="a09d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建新的JET应用程序</p><h1 id="d831" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">2.下载OpenLayers发行版并添加到JET应用程序中</h1><p id="6006" class="pw-post-body-paragraph ie if hh ig b ih kx ij ik il ky in io ip kz ir is it la iv iw ix lb iz ja jb ha bi translated">从https://github.com/openlayers/openlayers/releases/<a class="ae jc" href="https://github.com/openlayers/openlayers/releases/" rel="noopener ugc nofollow" target="_blank">下载OpenLayers发行版——一个包含OpenLayers (4.x)的JavaScript和CSS文件的zip文件</a></p><p id="22b6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在JET应用程序的js/libs目录中，创建一个新目录<em class="lm"> openlayers </em>，并向其中添加新库和任何附带文件。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="lo lp di lq bf lr"><div class="er es ln"><img src="../Images/54e699677b494d44df49e89f8cedec3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Nk69ugQ3V6RaZYbn."/></div></div></figure><h1 id="62eb" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">3.为OpenLayers库配置JET应用程序</h1><p id="4f2d" class="pw-post-body-paragraph ie if hh ig b ih kx ij ik il ky in io ip kz ir is it la iv iw ix lb iz ja jb ha bi translated">在<em class="lm"> js </em>目录中，更新<em class="lm">js/main-release-paths . JSON</em>文件以包含新的库。</p><pre class="je jf jg jh fd lc ld le lf aw lg bi"><span id="3081" class="lh ka hh ld b fi li lj l lk ll">"ol": "libs/openlayers/ol-debug"<br/>, "olcss": "libs/openlayers/ol.css" <br/>}</span></pre><p id="2adc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在您的RequireJS引导文件中，通常是<em class="lm"> main.js </em>，在路径映射部分添加一个到新文件的链接，并在<em class="lm"> require() </em>定义中包含新库。</p><pre class="je jf jg jh fd lc ld le lf aw lg bi"><span id="dfaf" class="lh ka hh ld b fi li lj l lk ll">paths: //injector:mainReleasePaths { ... <br/>'ol': 'libs/openlayers/ol-debug' <br/>} //endinjector</span></pre><p id="29b0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在同一个文件中，为OpenLayers添加一个Shim配置</p><pre class="je jf jg jh fd lc ld le lf aw lg bi"><span id="3293" class="lh ka hh ld b fi li lj l lk ll">// Shim configurations for modules that do not expose AMD shim: { 'jquery': { exports: ['jQuery', '$'] } ,'ol': { exports: ['ol'] } } }</span></pre><p id="3776" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，将模块<em class="lm">‘ol’</em>添加到调用中，要求ad作为回调函数中的参数(如果要对该模块进行特殊初始化的话):</p><pre class="je jf jg jh fd lc ld le lf aw lg bi"><span id="9ef2" class="lh ka hh ld b fi li lj l lk ll">require(['ojs/ojcore', 'knockout', 'appController','ol', 'ojs/ojknockout', 'ojs/ojbutton', 'ojs/ojtoolbar', 'ojs/ojmenu','ojs/ojmodule'], function (oj, ko, app, ol) { // this callback gets executed when all required modules are loaded ...</span></pre><p id="13d1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，要在JET应用程序的视图中实际包含地图:</p><h1 id="bad4" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">4.将DIV作为地图容器添加到HTML文件中</h1><p id="7a1a" class="pw-post-body-paragraph ie if hh ig b ih kx ij ik il ky in io ip kz ir is it la iv iw ix lb iz ja jb ha bi translated">该视图包含一个DIV，它将作为地图的容器。它还包含一个复选框集，其中包含五个不同国家的复选框。复选框集是绑定到ViewModel的数据；选择状态的任何变化都将触发事件监听器。此外，ViewModel中的<em class="lm"> currentCountries </em>变量会随着用户的任何更改而更新。</p><pre class="je jf jg jh fd lc ld le lf aw lg bi"><span id="0263" class="lh ka hh ld b fi li lj l lk ll">&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/openlayers/4.6.4/ol-debug.css" /&gt; <br/>&lt;h2&gt;Workarea with Map - Select Countries&lt;/h2&gt; <br/>&lt;div id="div1"&gt; <br/>&lt;oj-checkboxset id="countriesCheckboxSetId" labelled-by="mainlabelid" class="oj-choice-direction-row" value="{{currentCountries}}" on-value-changed="[[selectionListener]]"&gt; <br/>&lt;oj-option id="uruopt" value="uy"&gt;Uruguay&lt;/oj-option&gt; &lt;oj-option id="romopt" value="ro"&gt;Romania&lt;/oj-option&gt; &lt;oj-option id="moropt" value="ma"&gt;Morocco&lt;/oj-option&gt; &lt;oj-option id="spaopt" value="es"&gt;Spain&lt;/oj-option&gt; &lt;oj-option id="indopt" value="in"&gt;India&lt;/oj-option&gt; <br/>&lt;/oj-checkboxset&gt; <br/>&lt;br/&gt; <br/>&lt;/div&gt; <br/>&lt;div id="map2" class="map"&gt;&lt;/div&gt;</span></pre><h1 id="9ff5" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">5.添加JavaScript代码来初始化和操作ViewModel JS文件的映射</h1><p id="0ef2" class="pw-post-body-paragraph ie if hh ig b ih kx ij ik il ky in io ip kz ir is it la iv iw ix lb iz ja jb ha bi translated">在workArea.js中添加OpenLayers依赖项:</p><pre class="je jf jg jh fd lc ld le lf aw lg bi"><span id="97b5" class="lh ka hh ld b fi li lj l lk ll">define( ['ojs/ojcore', 'knockout', 'jquery', 'ol', 'ojs/ojknockout', 'ojs/ojinputtext', 'ojs/ojbutton', 'ojs/ojlabel', 'ojs/ojcheckboxset'], function (oj, ko, $, ol) {<br/> 'use strict'; function WorkAreaViewModel() { <br/>var self = this;</span></pre><p id="5d84" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面的代码定义了一个country map——五个元素(五个国家各一个)的集合，包含每个国家的经度和纬度，以及显示名称和国家代码(也是地图中的键)。随后，为每个国家创建一个OpenLayers <em class="lm">特征</em>，并从countryMap元素中引用以备后用。</p><pre class="je jf jg jh fd lc ld le lf aw lg bi"><span id="9381" class="lh ka hh ld b fi li lj l lk ll">self.currentCountries = ko.observableArray([]); <br/>self.countryMap = {}; <br/>self.countryMap['in'] = { "place_id": "177729185", "licence": "Data © OpenStreetMap contributors, ODbL 1.0. http://www.openstreetmap.org/copyright", "osm_type": "relation", "osm_id": "304716", "boundingbox": ["6.5546079", "35.6745457", "68.1113787", "97.395561"], "lat": "22.3511148", "lon": "78.6677428", "display_name": "India", "class": "boundary", "type": "administrative", "importance": 0.3133568788165, "icon": "http://nominatim.openstreetmap.org/images/mapicons/poi_boundary_administrative.p.20.png", "address": { "country": "India", "country_code": "in" } }; self.countryMap['es'] = { "place_id": "179962651", "licence": "Data © OpenStreetMap contributors, ODbL 1.0. http://www.openstreetmap.org/copyright", "osm_type": "relation", "osm_id": "1311341", "boundingbox": ["27.4335426", "43.9933088", "-18.3936845", "4.5918885"], "lat": "40.0028028", "lon": "-4.003104", "display_name": "Spain", "class": "boundary", "type": "administrative", "importance": 0.22447060272487, "icon": "http://nominatim.openstreetmap.org/images/mapicons/poi_boundary_administrative.p.20.png", "address": { "country": "Spain", "country_code": "es" } }; self.countryMap['ma'] = { "place_id": "217466685", "licence": "Data © OpenStreetMap contributors, ODbL 1.0. http://www.openstreetmap.org/copyright", "osm_type": "relation", "osm_id": "3630439", "boundingbox": ["21.3365321", "36.0505269", "-17.2551456", "-0.998429"], "lat": "31.1728192", "lon": "-7.3366043", "display_name": "Morocco", "class": "boundary", "type": "administrative", "importance": 0.19300832455819, "icon": "http://nominatim.openstreetmap.org/images/mapicons/poi_boundary_administrative.p.20.png", "address": { "country": "Morocco", "country_code": "ma" } } self.countryMap['ro'] = { "place_id": "177563889", "licence": "Data © OpenStreetMap contributors, ODbL 1.0. http://www.openstreetmap.org/copyright", "osm_type": "relation", "osm_id": "90689", "boundingbox": ["43.618682", "48.2653964", "20.2619773", "30.0454257"], "lat": "45.9852129", "lon": "24.6859225", "display_name": "Romania", "class": "boundary", "type": "administrative", "importance": 0.30982735099944, "icon": "http://nominatim.openstreetmap.org/images/mapicons/poi_boundary_administrative.p.20.png", "address": { "country": "Romania", "country_code": "ro" } }; self.countryMap['uy'] = { "place_id": "179428864", "licence": "Data © OpenStreetMap contributors, ODbL 1.0. http://www.openstreetmap.org/copyright", "osm_type": "relation", "osm_id": "287072", "boundingbox": ["-35.7824481", "-30.0853962", "-58.4948438", "-53.0755833"], "lat": "-32.8755548", "lon": "-56.0201525", "display_name": "Uruguay", "class": "boundary", "type": "administrative", "importance": 0.18848351906936, "icon": "http://nominatim.openstreetmap.org/images/mapicons/poi_boundary_administrative.p.20.png", "address": { "country": "Uruguay", "country_code": "uy" } }; </span><span id="acdd" class="lh ka hh ld b fi ls lj l lk ll">for (const c in self.countryMap) { <br/>  // create a feature for each country in the map </span><span id="8e1a" class="lh ka hh ld b fi ls lj l lk ll">  var coordinates = ol.proj.transform([1 * self.countryMap.lon, 1 *   self.countryMap.lat], 'EPSG:4326', 'EPSG:3857'); <br/>  var featurething = new ol.Feature({ name: self.countryMap.display_name, geometry: new ol.geom.Point(coordinates) }); <br/>  self.countryMap.feature = featurething; <br/>}</span></pre><p id="8c38" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后添加代码来初始化地图本身——在DOM准备就绪时执行</p><pre class="je jf jg jh fd lc ld le lf aw lg bi"><span id="34dd" class="lh ka hh ld b fi li lj l lk ll">$(document).ready ( // when the document is fully loaded and the DOM has been initialized <br/>// then instantiate the map <br/>function () { <br/>initMap(); <br/>}) <br/>function initMap() { <br/>self.elem = document.getElementById("text-input"); <br/>self.map = new ol.Map({ <br/>  target: 'map2'<br/>, layers: [ new ol.layer.Tile({ source: new ol.source.OSM() }) ]<br/>, view: new ol.View({ center: ol.proj.fromLonLat([-2, -5]), zoom: 3 }) }); <br/>}</span></pre><p id="78fb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">并且DIV目标容器可用:</p><p id="6aaa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">还要添加selectionListener的代码，以便在选择或取消选择国家时执行。<br/>这段代码为当前选择的每个国家添加了OpenLayers <em class="lm">特性</em>。接下来，构建一个包含这些特征的<em class="lm">层</em>，并有一个特定的样式(带大X的红圈)与之关联。最后，将该图层添加到地图中，以便在网页中显示要素。</p><pre class="je jf jg jh fd lc ld le lf aw lg bi"><span id="fa07" class="lh ka hh ld b fi li lj l lk ll">// triggered whenever a checkbox is selected or deselected self.selectionListener = function (event) { console.log("Country Selection Changed"); var vectorSource = new ol.source.Vector({}); // to hold features for currently selected countries for (var i = 0; i &lt; self.currentCountries().length; i++) { // add the feature to the map for each currently selected country vectorSource.addFeature(self.countryMap[self.currentCountries()[i]].feature); }//for var layers = self.map.getLayers(); // remove the feature layer from the map if it already was added if (layers.getLength() &gt; 1) { self.map.removeLayer(layers.item(1)); } //Create and add the vector layer with features to the map // define the style to apply to these features: bright red, circle with radius 10 and a X as (text) content var vector_layer = new ol.layer.Vector({ source: vectorSource ,style: function(feature) { var style = new ol.style.Style({ image: new ol.style.Circle({ radius: 10, stroke: new ol.style.Stroke({ color: '#fff' }), fill: new ol.style.Fill({ //color: '#3399CC' // light blue color: 'red' // light blue }) }), text: new ol.style.Text({ text: "X", fill: new ol.style.Fill({ color: '#fff' }) }) }); return style; } } ) self.map.addLayer(vector_layer); }//selectionListener }</span></pre><h1 id="b14c" class="jz ka hh bd kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw bi translated">参考</h1><p id="a532" class="pw-post-body-paragraph ie if hh ig b ih kx ij ik il ky in io ip kz ir is it la iv iw ix lb iz ja jb ha bi translated">GitHub回购中的源代码:<a class="ae jc" href="https://github.com/lucasjellema/jet-and-openlayers" rel="noopener ugc nofollow" target="_blank">https://github.com/lucasjellema/jet-and-openlayers</a></p><p id="61fd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Enno Schulte (Virtual7)关于将Socket.io作为第三方库添加到JET 3.x应用程序的博客文章:<a class="ae jc" href="http://www.virtual7.de/blog/2017/07/oracle-jet-3-add-third-party-libraries-example-socket-io/" rel="noopener ugc nofollow" target="_blank">http://www . virtual 7 . de/blog/2017/07/Oracle-JET-3-add-third-party-libraries-example-socket-io/</a></p><p id="b639" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">关于向JET 4.0添加第三方库的文档:<a class="ae jc" href="https://docs.oracle.com/middleware/jet410/jet/developer/GUID-EC40DF3C-57FB-4919-A066-73E573D66B67.htm#JETDG-GUID-EC40DF3C-57FB-4919-A066-73E573D66B67" rel="noopener ugc nofollow" target="_blank">https://docs . Oracle . com/middleware/JET 410/JET/developer/GUID-EC 40 df3 c-57FB-4919-A066-73e 573d 66 b 67 . htm # JETDG-GUID-EC 40 df3 c-57FB-4919-A066-73e 573d 66 b 67</a></p><p id="80ca" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">OJET Docs复选框集—<a class="ae jc" href="http://www.oracle.com/webfolder/technetwork/jet/jsdocs/oj.ojCheckboxset.html" rel="noopener ugc nofollow" target="_blank">http://www . Oracle . com/web folder/tech network/jet/jsdocs/OJ . ojcheckboxset . html</a></p><p id="268f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="lm">原载于2018年1月1日</em><a class="ae jc" href="https://technology.amis.nl/2018/01/01/embedding-openlayers-in-oracle-jet-for-advanced-maps-and-gis-style-user-interfaces/" rel="noopener ugc nofollow" target="_blank"><em class="lm">technology . amis . nl</em></a><em class="lm">。</em></p></div></div>    
</body>
</html>