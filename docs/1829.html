<html>
<head>
<title>Can Spark Applications Coexist with NoSQL Databases?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Spark应用程序可以与NoSQL数据库共存吗？</h1>
<blockquote>原文：<a href="https://medium.com/capital-one-tech/can-spark-applications-coexist-with-nosql-databases-9f63edca9400?source=collection_archive---------0-----------------------#2021-12-14">https://medium.com/capital-one-tech/can-spark-applications-coexist-with-nosql-databases-9f63edca9400?source=collection_archive---------0-----------------------#2021-12-14</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="d7cb" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">NoSQL后端Spark应用的四个技巧</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/f2e377e9d36e87002abdb93a92455cb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jfkJCLFltskXbQoQG42B4A.jpeg"/></div></div></figure><p id="5c09" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><em class="ke">阿帕奇火花<br/>阿帕奇卡珊德拉<br/> MongoDB </em></p><p id="e1ae" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这些在科技行业都不是不知名的名字。他们每个人都在分布式计算领域赢得了值得称赞的空间——Apache Spark作为统一分析并行处理框架，Apache Cassandra和MongoDB作为NoSQL数据库的领导者。虽然它们中的每一个都提供了很大的好处——比如内存中的大规模并行处理、更快的读取响应和灵活的模式设计——但当涉及到<a class="ae kf" href="https://en.wikipedia.org/wiki/Online_transaction_processing" rel="noopener ugc nofollow" target="_blank">在线事务处理(OLTP) </a>时，在应用程序中一起使用它们需要一些战术策略。</p><p id="68d8" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这篇博客将关注在NoSQL (Apache Cassandra和MongoDB)后端运行Apache Spark应用程序的技巧。这些技巧基于我的团队在构建一个<a class="ae kf" href="https://www.capitalone.com/tech/cloud/what-is-cloud-native/" rel="noopener ugc nofollow" target="_blank">云原生</a>平台来处理客户信用卡交易时遇到的问题。在云原生环境中构建和管理分布式应用也带来了挑战。任何对分布式系统感兴趣的人都会同意TCP/IP是分布式系统的生命线，所以让我们参观一个我喜欢称之为<em class="ke"> TCP/IP sPark的虚构的地方。我希望你在TCP/IP sPARK的经历能帮助你克服这些挑战……</em></p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/950576148291fe095698c35408a58815.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L9HdisjXltE8IM-30luWaA.png"/></div></div></figure><h1 id="5399" class="kg kh hh bd ki kj kk kl km kn ko kp kq in kr io ks iq kt ir ku it kv iu kw kx bi translated">欢迎使用TCP/IP sPark</h1><p id="d001" class="pw-post-body-paragraph ji jj hh jk b jl ky ii jn jo kz il jq jr la jt ju jv lb jx jy jz lc kb kc kd ha bi translated">谁不喜欢去主题公园？它们很有趣，令人难忘，所以在这篇博客中，我们要去TCP/IP sPark，在它著名的CassandraLand和MongoLand部分有很多有趣的游乐设施。如果你像我一样——喜欢主题公园和构建/管理分布式应用程序的人——那就跟着做吧。</p><p id="bb90" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">我们将从去卡珊德拉兰开始我们的旅程，并学习一些在TCP/IP sPark中更好地乘车的经验/技巧。那我们就去蒙哥兰再捡几个。我希望你会发现这次旅行有趣又快乐！</p><p id="4a00" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">为了更好地享受你的旅行，带更多的回忆回家，Apache Spark、Mongo和Cassandra上的一些刷新程序可能会有所帮助。</p><h1 id="218f" class="kg kh hh bd ki kj kk kl km kn ko kp kq in kr io ks iq kt ir ku it kv iu kw kx bi translated">Cassandra land——使用Cassandra和Spark的两个技巧</h1><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/d169b552f13d61c3d310a13cdc677907.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4t4WeXRJ8_LtU004wvakpw.png"/></div></div></figure><p id="adda" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">卡珊德拉兰的标志性游乐设施是象征环摩天轮。骑手们一圈又一圈，每次轮子落地，他们的参赛作品都会在卡珊德拉注册，就像这样:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ld"><img src="../Images/e3e5639e68952609c967d1792894dc45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x17qCY_jraXuM26OR_az0w.png"/></div></div></figure><h1 id="673d" class="kg kh hh bd ki kj kk kl km kn ko kp kq in kr io ks iq kt ir ku it kv iu kw kx bi translated">卡珊德拉第1课—卡珊德拉关键序列至关重要</h1><p id="789d" class="pw-post-body-paragraph ji jj hh jk b jl ky ii jn jo kz il jq jr la jt ju jv lb jx jy jz lc kb kc kd ha bi translated">哦！季票持有者DOE在乘坐象征环摩天轮后失踪，公园保安正试图在CassandraLand找到他的下落。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es le"><img src="../Images/2c3a306379deab7deb22b8a36dadbf78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*46N6dL-VnBTrdha4Bzzydw.png"/></div></div></figure><p id="a804" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">当像上面一样查询DOE的详细信息时，我们的Spark应用程序变得不高兴，并开始转动自己的轮子。摩天轮&gt;载入图标。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lf"><img src="../Images/41853886cc38fea7df71e720ab7fdc87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YAP4MbEVnCv9xwT0AmZquA.png"/></div></div></figure><p id="74a1" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">为什么会这样？这里的教训是<strong class="jk hi"> Cassandra键序列在查询时很重要。</strong>根据Cassandra在磁盘中对数据进行分区的固有特性，如果不遵循key sequence，它将无法从其分区中快速获取数据。相反，它将对每个查询进行表扫描，使Cassandra数据库集群不堪重负。</p><p id="be2b" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">但是不用担心！FooBar发现了这个问题，并按如下方式修复了它:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lg"><img src="../Images/a765986a6516015db1577f625f086036.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iAmFohcC-szSlJ1GMQoQIA.png"/></div></div></figure><p id="d626" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">好像DOE去礼品店买TCP/IP sPark纪念品去了。买纪念品来记住你的公园之旅总是很重要的，就像记住你的卡珊德拉按键序列一样重要。</p><h1 id="f82d" class="kg kh hh bd ki kj kk kl km kn ko kp kq in kr io ks iq kt ir ku it kv iu kw kx bi translated">Cassandra第2课—使用基于案例的数据建模</h1><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/461a73b996687e15998ec0ad209942b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2jrKdgs2HZ2UVXl_wGTl4g.png"/></div></div></figure><p id="5dc0" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">另一个受欢迎的卡珊德拉乐园是分区过山车。如果你选择了正确的座位(分区键)，你将在令人兴奋的毫秒内回到基站。当顾客在享受他们的过山车之旅时，他们的信息会像下面这样被保存下来，这样游乐设施运营商就可以跟踪每天乘坐过它的人:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lh"><img src="../Images/d18530fe5cd3765a56d58b3e46c5357e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2QP0NuM1l9UWtdtHMM0-bw.png"/></div></div></figure><p id="cad8" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这一点很重要，因为像大多数过山车一样，Partitioner过山车提供了储物柜，当你在乘坐时可以存放你的东西。但是一些顾客可能喜欢把他们的东西放在身边，或者急着上车而忘记使用储物柜。如果你是这些人中的一员，你的东西很容易从口袋里掉出来，或者因为太兴奋而忘记了你的东西。</p><p id="ac76" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">因此，每当过山车操作员在过山车下或其中一个座位上发现什么东西时，就需要找到那天所有被处理的乘客。</p><p id="9690" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">虽然可以在客户模式中找到信息，但这不是最佳的方法。在Cassandra中，这被认为是某种反模式。Cassandra数据是分区的，其用例定义了模式。</p><p id="463b" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这里的教训是<strong class="jk hi">首先基于用例</strong>设计你的模式，如果需要，数据生产者必须随着使用的发展复制数据。</p><h1 id="3e6c" class="kg kh hh bd ki kj kk kl km kn ko kp kq in kr io ks iq kt ir ku it kv iu kw kx bi translated">MongoLand——使用MongoDB和Spark的两个技巧</h1><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/8286f609f5fe15fd541f9cf7b27bc5a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*myKnvXGs8Sq8syfYNW02sw.png"/></div></div></figure><p id="638d" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在从卡珊德拉兰收集了一些经验和建议后，我们的公园游客正前往期待已久的蒙哥兰。</p><p id="b6e1" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">当客户在无模式传送带上一圈又一圈时，他们的信息被保存在后端，如下所示:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es li"><img src="../Images/940b7e18122e98d08233376e70abe424.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A1HdLL_j6ZY_6WuQKk7aww.png"/></div></div></figure><h1 id="958d" class="kg kh hh bd ki kj kk kl km kn ko kp kq in kr io ks iq kt ir ku it kv iu kw kx bi translated">Mongo第1课—正确管理MongoDB连接</h1><p id="eec2" class="pw-post-body-paragraph ji jj hh jk b jl ky ii jn jo kz il jq jr la jt ju jv lb jx jy jz lc kb kc kd ha bi translated">从我们对卡珊德拉兰的访问中，我们知道DOE是TCP/IP sPark的季票持有者。他们已经被提升到更高的会员级别，我们需要在系统中更新这一点。但是为了处理这个信息更新，旋转木马不得不停止，并且其他乘客对他们的乘坐被减慢和中断感到不高兴。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lj"><img src="../Images/93b8ccc7a53b28c0622259bd47b7da47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LG1UZ65xG6meLgv58jGPhg.png"/></div></div></figure><p id="93fb" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这里的教训是Mongo连接应该在JVM或分区级别处理，如下所示:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lk"><img src="../Images/e7aaf6ef785447bddc51de9da19d3150.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X0SYU3jTLH1QBSmUsx3DVA.png"/></div></div></figure><p id="980a" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">如果没有在分区或JVM级别处理连接，应用程序可能会打开许多不需要的连接，这取决于您在哪里处理连接。这有可能使您的应用程序和数据库集群停机，也会让其他carousel骑手不高兴。</p><h1 id="28c7" class="kg kh hh bd ki kj kk kl km kn ko kp kq in kr io ks iq kt ir ku it kv iu kw kx bi translated">Mongo第2课—索引非常有用</h1><p id="b1cf" class="pw-post-body-paragraph ji jj hh jk b jl ky ii jn jo kz il jq jr la jt ju jv lb jx jy jz lc kb kc kd ha bi translated">从无模式旋转木马的失败中恢复过来后，我们仍然没有处理DOE的会员更新。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es ll"><img src="../Images/f3f4ec5318625b99a5320f1b24764928.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hgz7z7E1_uI0HiCrYfHQVQ.png"/></div></div></figure><p id="59c3" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">当我们试图这样做的时候，我们又一次看到了旋转的摩天轮，或者在这个例子中，旋转木马。就像我们去卡珊德拉兰一样。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lf"><img src="../Images/41853886cc38fea7df71e720ab7fdc87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YAP4MbEVnCv9xwT0AmZquA.png"/></div></div></figure><p id="920e" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这里的教训是，Mongo索引非常重要，在您需要查找和更新信息(如DOE的新公园会员状态)的情况下非常有用。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lm"><img src="../Images/1d564c5d3268c3ece8dcb97219be8cf8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aswPZtwKUQNKX480Le_zSQ.png"/></div></div></figure><h1 id="a138" class="kg kh hh bd ki kj kk kl km kn ko kp kq in kr io ks iq kt ir ku it kv iu kw kx bi translated">希望您对TCP/IP sPark的访问愉快！</h1><p id="f57b" class="pw-post-body-paragraph ji jj hh jk b jl ky ii jn jo kz il jq jr la jt ju jv lb jx jy jz lc kb kc kd ha bi translated">希望您的TCP/IP SPark、CassandraLand和MongoLand之旅是有益和难忘的。请记住，在使用Cassandra和Spark时，您应该确保您的键序列是正确的，并且模式是根据您的用例规划的。不要忘记，使用MongoDB和Spark，您应该正确地管理您的连接，尤其是索引，以防特定的更新。</p><p id="39da" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">在TCP/IP sPark的神奇土地上再见！</p></div><div class="ab cl ln lo go lp" role="separator"><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls lt"/><span class="lq bw bk lr ls"/></div><div class="ha hb hc hd he"><p id="93d7" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><em class="ke">披露声明:2021资本一。观点是作者个人的观点。除非本帖中另有说明，否则Capital One不隶属于所提及的任何公司，也不被这些公司认可。使用或展示的所有商标和其他知识产权是其各自所有者的财产。</em></p></div></div>    
</body>
</html>