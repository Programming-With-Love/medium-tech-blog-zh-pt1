<html>
<head>
<title>Using Square’s REST APIs to Build a Sandbox Dashboard Part 1: Authentication &amp; Locations.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Square的REST APIs构建沙盒仪表板第1部分:身份验证和位置。</h1>
<blockquote>原文：<a href="https://medium.com/square-corner-blog/using-squares-rest-apis-to-build-a-sandbox-dashboard-part-1-authentication-locations-3e5b5a551cc7?source=collection_archive---------0-----------------------#2017-05-18">https://medium.com/square-corner-blog/using-squares-rest-apis-to-build-a-sandbox-dashboard-part-1-authentication-locations-3e5b5a551cc7?source=collection_archive---------0-----------------------#2017-05-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><blockquote class="ie"><p id="c21b" class="if ig hh bd ih ii ij ik il im in io dx translated">注意，我们已经行动了！如果您想继续了解Square的最新技术内容，请访问我们的新家<a class="ae ip" href="https://developer.squareup.com/blog" rel="noopener ugc nofollow" target="_blank">https://developer.squareup.com/blog</a></p></blockquote><p id="8a47" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm io ha bi jn translated">我们最常从开发人员那里听到的一件事就是他们的沙盒账户缺少仪表板。这将是一系列文章中的第一篇，每篇文章都讨论我们API的不同部分。在本系列的最后，我们将为您的沙盒帐户提供一个仪表板。我们开始吧！</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="er es jw"><img src="../Images/320f4cc1e3148e8624de3e0085c4b2c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VfVufLIm0dCRT6nsu8wlnA.jpeg"/></div></div><figcaption class="ki kj et er es kk kl bd b be z dx">initial sketch… or entry in world’s worst handwriting contest?</figcaption></figure><h2 id="fa0a" class="km kn hh bd ko kp kq kr ks kt ku kv kw jb kx ky kz jf la lb lc jj ld le lf lg bi translated"><strong class="ak">搭建方形仪表盘</strong></h2><p id="2a80" class="pw-post-body-paragraph iq ir hh is b it lh iv iw ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm io ha bi translated">在Square，有一整个团队致力于我们的仪表板，我不打算复制他们所做的所有工作。不过，我将从一些设置页面一般结构的样板HTML开始，以及一些使页面更有用的JavaScript和CSS。此外，沙盒帐户的仪表板将密切匹配真实仪表板的某些视觉元素。我的目标不是创建一个正方形仪表板的精确副本，而是创建一个可以使用沙盒凭证的功能性仪表板。我能够用几个<code class="du lm ln lo lp b">div</code>和一些CSS <code class="du lm ln lo lp b">flex</code>属性的自由使用来制作左侧导航的一个相当简单的再现。我将导航分解到它自己的<code class="du lm ln lo lp b">header.php</code>文件中，因为它将在我的应用程序中的所有页面之间共享。现在，我的文件结构看起来像这样:</p><pre class="jx jy jz ka fd lq lp lr ls aw lt bi"><span id="c934" class="km kn hh lp b fi lu lv l lw lx">sandbox-dashboard/<br/>----index.php   //The main page of the application<br/>----header.php  //Navigation, shared code between pages<br/>----style.css   //style 🕶</span></pre><p id="1c48" class="pw-post-body-paragraph iq ir hh is b it ly iv iw ix lz iz ja jb ma jd je jf mb jh ji jj mc jl jm io ha bi translated">我的页面看起来像这样:</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="er es md"><img src="../Images/c4c4b4c443aea7c383eae82c19335b7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R22TZyyT_FCet472Ltzmnw.png"/></div></div><figcaption class="ki kj et er es kk kl bd b be z dx">Almost looks like the real thing!</figcaption></figure><h2 id="8b0c" class="km kn hh bd ko kp kq kr ks kt ku kv kw jb kx ky kz jf la lb lc jj ld le lf lg bi translated">开发者沙箱</h2><p id="f1cc" class="pw-post-body-paragraph iq ir hh is b it lh iv iw ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm io ha bi translated">您的开发人员沙盒与您的生产或“真实”帐户工作方式相同，除了一个关键的区别:它是一个游乐场！您使用沙盒凭证进行的电子商务交易不会收费，您进行的任何客户操作都不会影响您的实际客户。在撰写本文时，您无法将API沙盒用于任何v1端点，包括项目和员工管理。</p><h2 id="1590" class="km kn hh bd ko kp kq kr ks kt ku kv kw jb kx ky kz jf la lb lc jj ld le lf lg bi translated">证明</h2><figure class="jx jy jz ka fd kb er es paragraph-image"><div class="er es mf"><img src="../Images/fa7c228d20a7151d5e92ae8f441941c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:332/format:webp/1*DlrvshlITGlvccVvP6zwIg.png"/></div></figure><p id="124f" class="pw-post-body-paragraph iq ir hh is b it ly iv iw ix lz iz ja jb ma jd je jf mb jh ji jj mc jl jm io ha bi translated">使用API沙盒很容易，你所要做的就是使用你的沙盒访问令牌，而不是你的个人访问令牌，或者你将从OAuth获得的访问令牌。首先，我将在左侧导航中添加一个输入元素，让您输入想要使用的访问令牌。请记住，这只是给你们开发者的一个教程，你们<strong class="is hi"> <em class="me">绝不会</em> </strong>想这样暴露你们的秘密。我决定使用<a class="ae ip" href="https://www.w3schools.com/php/php_sessions.asp" rel="noopener ugc nofollow" target="_blank"> PHP的sessions </a>来跟踪您的凭证，并使其易于在访问令牌之间切换。只要您粘贴沙箱(或其他)访问令牌，或者做任何其他事情来触发JavaScript <code class="du lm ln lo lp b">onchange</code>事件，一些页面内JavaScript就会将值发送到简单的PHP页面(<code class="du lm ln lo lp b">setter.php</code>)，该页面会将值存储在会话中。</p><pre class="jx jy jz ka fd lq lp lr ls aw lt bi"><span id="f39b" class="km kn hh lp b fi lu lv l lw lx">//in-page javascript<br/>function setAccessToken() {<br/>   var at = document.getElementById('access-token').value;</span><span id="48cc" class="km kn hh lp b fi mg lv l lw lx">var xhttp = new XMLHttpRequest();<br/>   xhttp.onreadystatechange = function() {<br/>    if (this.readyState == 4 &amp;&amp; this.status == 200) {<br/>     alert("Access Token set");<br/>     console.log(this.responseText);<br/>    }<br/>   };<br/>   xhttp.open("POST", "setter.php", true);<br/>   xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");<br/>   xhttp.send("at="+at);<br/>}<br/>--------------------------------------------------</span><span id="1302" class="km kn hh lp b fi mg lv l lw lx">//setter.php<br/>&lt;?php <br/>session_start();<br/>if (isset($_POST['at'])){<br/> $_SESSION["at"] = $_POST['at'];<br/> echo 'success';<br/>}<br/>else{<br/> echo "failure";<br/>}<br/>?&gt;</span></pre><h2 id="ad9c" class="km kn hh bd ko kp kq kr ks kt ku kv kw jb kx ky kz jf la lb lc jj ld le lf lg bi translated">位置</h2><p id="b010" class="pw-post-body-paragraph iq ir hh is b it lh iv iw ix li iz ja jb lj jd je jf lk jh ji jj ll jl jm io ha bi translated">几乎所有Square的REST端点都要求您在请求的URL中提供一个位置参数。方形仪表板让你选择一个位置，有一系列复杂的模式和下拉菜单。我将只列出位置，并让您指定想要使用的位置的ID，但要做到这一点，我需要添加代码来列出位置。我将使用<a class="ae ip" href="https://github.com/square/connect-php-sdk" rel="noopener ugc nofollow" target="_blank"> Square的PHP SDK </a>来调用列表位置端点，并在屏幕上显示它们。首先，我将添加一个<code class="du lm ln lo lp b">composer.json</code>文件，并将SDK的适当版本添加到其中。</p><pre class="jx jy jz ka fd lq lp lr ls aw lt bi"><span id="e271" class="km kn hh lp b fi lu lv l lw lx">{<br/>    "require": {<br/>        "square/connect": "dev-release/2.1.0"<br/>    }<br/>}</span></pre><p id="2ec6" class="pw-post-body-paragraph iq ir hh is b it ly iv iw ix lz iz ja jb ma jd je jf mb jh ji jj mc jl jm io ha bi translated">一个快速的<code class="du lm ln lo lp b">composer install</code>就安装好了所有的依赖项，我需要在我的<code class="du lm ln lo lp b">header.php</code>中包含的只是<code class="du lm ln lo lp b">require(‘vendor/autoload.php’);</code>来访问SDK的功能(比如<code class="du lm ln lo lp b">listLocations();</code>)。</p><p id="e50b" class="pw-post-body-paragraph iq ir hh is b it ly iv iw ix lz iz ja jb ma jd je jf mb jh ji jj mc jl jm io ha bi translated">我添加了一个新的<code class="du lm ln lo lp b">locations.php</code>文件，并添加了一些逻辑来列出所提供的访问令牌的位置，并简单地将它们转储到屏幕上。</p><pre class="jx jy jz ka fd lq lp lr ls aw lt bi"><span id="6978" class="km kn hh lp b fi lu lv l lw lx">&lt;?php<br/> if(!$_SESSION['at']){<br/>  echo 'Looks like you need to set your access token on the right. Go to your &lt;a href="connect.squareup.com/apps/"&gt;Developer Portal&lt;/a&gt; to find it.'; <br/> }else{<br/>  SquareConnect\Configuration::getDefaultConfiguration()-&gt;setAccessToken($_SESSION['at']);<br/>  $locationApi = new SquareConnect\Api\LocationsApi();<br/>  try {<br/>   $result = $locationApi-&gt;listLocations();<br/>   echo '&lt;div style="display:flex"&gt;';<br/>   foreach ($result-&gt;getLocations() as $location) {<br/>    echo '&lt;div class="location"&gt;';<br/>    echo '&lt;h2&gt;',$location-&gt;getName(),'&lt;/h2&gt;';<br/>    echo '&lt;em&gt;',$location-&gt;getId(),'&lt;/em&gt;';<br/>    echo '&lt;pre&gt;';<br/>    var_dump($location);<br/>    echo "&lt;/pre&gt;";<br/>    echo '&lt;/div&gt;';<br/>   }<br/>   echo '&lt;/div&gt;';<br/>  } catch (Exception $e) {<br/>   echo 'Exception when calling LocationsApi-&gt;listLocations() with the access token &lt;strong&gt;',$_SESSION['at'],'&lt;/strong&gt;', PHP_EOL;<br/>   echo '&lt;pre&gt;';<br/>   echo $e-&gt;getMessage();<br/>  }<br/> }</span></pre><p id="2354" class="pw-post-body-paragraph iq ir hh is b it ly iv iw ix lz iz ja jb ma jd je jf mb jh ji jj mc jl jm io ha bi translated">制作我的文件结构:</p><pre class="jx jy jz ka fd lq lp lr ls aw lt bi"><span id="2eee" class="km kn hh lp b fi lu lv l lw lx">sandbox-dashboard/<br/>----index.php   //The main page of the application<br/>----header.php  //Navigation, shared code between pages<br/>----style.css   //style 🎉<br/>----setter.php  // Sets session variables<br/>----locations.php   </span></pre><p id="1aeb" class="pw-post-body-paragraph iq ir hh is b it ly iv iw ix lz iz ja jb ma jd je jf mb jh ji jj mc jl jm io ha bi translated">将所有这些放在一起，您可以快速查看您的位置和底层json:</p><figure class="jx jy jz ka fd kb er es paragraph-image"><div role="button" tabindex="0" class="kc kd di ke bf kf"><div class="er es mh"><img src="../Images/e6262579d6ee73cde60927d854248f5d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9Opz6YsRHwXHk_pV58nsdQ.png"/></div></div><figcaption class="ki kj et er es kk kl bd b be z dx">A dashboard for my sandbox locations</figcaption></figure><p id="43be" class="pw-post-body-paragraph iq ir hh is b it ly iv iw ix lz iz ja jb ma jd je jf mb jh ji jj mc jl jm io ha bi translated">我希望你喜欢我们的沙盒仪表板系列的第一部分。关注this blog和twitter上的<a class="ae ip" href="https://twitter.com/SquareDev" rel="noopener ugc nofollow" target="_blank"> @SquareDev </a>来了解第2部分，在这里我们开始报告交易。要了解更多关于API沙箱的知识，请查看我们文档中的使用API沙箱的<a class="ae ip" href="https://docs.connect.squareup.com/articles/using-sandbox" rel="noopener ugc nofollow" target="_blank">测试。</a></p></div></div>    
</body>
</html>