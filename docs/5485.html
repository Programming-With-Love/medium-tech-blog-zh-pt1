<html>
<head>
<title>Running Spring Tool Suite and other GUI applications from a Docker container</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">从Docker容器运行Spring工具套件和其他GUI应用程序</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/running-spring-tool-suite-and-other-gui-applications-from-a-docker-container-3c5d66fc7b3d?source=collection_archive---------0-----------------------#2018-08-06">https://medium.com/oracledevs/running-spring-tool-suite-and-other-gui-applications-from-a-docker-container-3c5d66fc7b3d?source=collection_archive---------0-----------------------#2018-08-06</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="ffbd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在Docker容器中运行应用程序有助于将应用程序与主机操作系统隔离开来。从Docker容器中运行GUI应用程序(例如IDE)是一项挑战。我将解释您可能会遇到的几个问题以及如何解决它们。为此，我将使用Spring工具套件作为例子。代码(Dockerfile和docker-compose.yml)也可以在<a class="ae jc" href="https://github.com/MaartenSmeets/provisioning/tree/master/docker/STS" rel="noopener ugc nofollow" target="_blank">这里</a>找到。由于(几个)安全问题，不建议在生产环境中这样做。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/050e3a6291a28a7682e3d6a9b0f40763.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*H2wSxcH_-Y283qBA.png"/></div></figure></div><div class="ab cl jl jm go jn" role="separator"><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq"/></div><div class="ha hb hc hd he"><h1 id="66a2" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">从Docker容器运行GUI</h1><p id="4ee1" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">为了从Docker容器运行GUI应用程序并在主机OS上显示其GUI，需要几个步骤；</p><h2 id="d21e" class="kv jt hh bd ju kw kx ky jy kz la lb kc ip lc ld kg it le lf kk ix lg lh ko li bi translated">使用哪个显示器？</h2><p id="c5c1" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">容器需要知道要使用的显示器。为了使显示可用，可以将display环境变量传递给容器。docker-compose描述了docker容器的环境/卷映射/端口映射和其他内容。这使得以快速和可再现的方式运行容器变得更加容易，并且避免了长命令行。</p><p id="387f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> docker-compose </strong></p><p id="adbf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以通过在docker-compose.yml文件中提供它来做到这一点。参见下面的例子。环境指示主机显示变量作为显示变量传递给容器。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/62e8039105267d9172824302eb93eef1.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*dMyEsdPXOeiWz9WG.png"/></div></figure><p id="b014" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">码头工人</strong></p><p id="d5cc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在Docker命令中(不使用docker-compose时)，您可以使用-e标志或— env来实现这一点。比如说；</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="be46" class="kv jt hh lk b fi lo lp l lq lr">docker run — env DISPLAY=$DISPLAY containername</span></pre><h2 id="e097" class="kv jt hh bd ju kw kx ky jy kz la lb kc ip lc ld kg it le lf kk ix lg lh ko li bi translated">允许访问显示器</h2><p id="444e" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">需要允许Docker容器在Docker主机上显示它的屏幕。这可以通过执行以下命令来完成:</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="9f96" class="kv jt hh lk b fi lo lp l lq lr">xhost local:root</span></pre><p id="a533" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">执行后，在会话期间，允许root使用当前用户显示。由于Docker守护进程作为root运行，Docker容器(一般来说！)现在可以使用当前用户显示。如果您想保持这一点，您应该将其添加到启动脚本中。</p><h2 id="4413" class="kv jt hh bd ju kw kx ky jy kz la lb kc ip lc ld kg it le lf kk ix lg lh ko li bi translated">共享X套接字</h2><p id="9e9f" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">最后要做的是共享X插座(不要问我细节，但这是必需的……)。这可以通过在Docker命令行或docker-compose.yml文件中定义卷映射来实现。对于Ubuntu，这看起来就像你在下图中看到的。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/8ca0b0595f99e005f96536d0478dc19c.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*HVYrM8Y8SvI5tk8V.png"/></div></figure><h1 id="8bf1" class="js jt hh bd ju jv ls jx jy jz lt kb kc kd lu kf kg kh lv kj kk kl lw kn ko kp bi translated">来自Docker容器的Spring工具套件</h1><p id="9e26" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">为了给出一个完整的工作示例，我将展示如何从Docker容器运行Spring Tool Suite。在这个例子中，我使用Docker主机JVM，而不是在容器中安装JVM。如果您想让JVM也在容器中(而不是使用主机JVM)，查看下面的并将其添加到docker文件中。作为基础图片，我使用的是官方的Ubuntu图片。</p><p id="3acf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我使用了以下Dockerfile文件:</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="23b4" class="kv jt hh lk b fi lo lp l lq lr">FROM ubuntu:18.04</span><span id="f970" class="kv jt hh lk b fi lx lp l lq lr">MAINTAINER Maarten Smeets &lt;maarten.smeets@amis.nl&gt;<br/> <br/>ARG uid<br/> <br/>LABEL nl.amis.smeetsm.ide.name=”Spring Tool Suite” nl.amis.smeetsm.ide.version=”3.9.5"<br/> <br/>ADD <a class="ae jc" href="https://download.springsource.com/release/STS/3.9.5.RELEASE/dist/e4.8/spring-tool-suite-3.9.5.RELEASE-e4.8.0-linux-gtk-x86_64.tar.gz" rel="noopener ugc nofollow" target="_blank">https://download.springsource.com/release/STS/3.9.5.RELEASE/dist/e4.8/spring-tool-suite-3.9.5.RELEASE-e4.8.0-linux-gtk-x86_64.tar.gz</a> /tmp/ide.tar.gz<br/> <br/>RUN adduser — uid ${uid} — disabled-password — gecos ‘’ develop<br/> <br/>RUN mkdir -p /opt/ide &amp;&amp; \<br/>    tar zxvf /tmp/ide.tar.gz — strip-components=1 -C /opt/ide &amp;&amp; \<br/>    ln -s /usr/lib/jvm/java-10-oracle /opt/ide/sts-3.9.5.RELEASE/jre &amp;&amp; \<br/>    chown -R develop:develop /opt/ide &amp;&amp; \<br/>    mkdir /home/develop/ws &amp;&amp; \<br/>    chown develop:develop /home/develop/ws &amp;&amp; \<br/>    mkdir /home/develop/.m2 &amp;&amp; \<br/>    chown develop:develop /home/develop/.m2 &amp;&amp; \<br/>    rm /tmp/ide.tar.gz &amp;&amp; \<br/>    apt-get update &amp;&amp; \<br/>    apt-get install -y libxslt1.1 libswt-gtk-3-jni libswt-gtk-3-java &amp;&amp; \<br/>    apt-get autoremove -y &amp;&amp; \<br/>    apt-get clean &amp;&amp; \<br/>    rm -rf /var/lib/apt/lists/* &amp;&amp; \<br/>    rm -rf /tmp/*<br/> <br/>USER develop:develop<br/>WORKDIR /home/develop<br/>ENTRYPOINT /opt/ide/sts-3.9.5.RELEASE/STS -data /home/develop/ws</span></pre><p id="9899" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">指定的包需要能够在容器内运行STS，并创建GUI以在主机上显示。我使用了以下docker-compose.yml文件:</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="6035" class="kv jt hh lk b fi lo lp l lq lr">version: ‘3’</span><span id="1a58" class="kv jt hh lk b fi lx lp l lq lr">services:<br/>    sts:<br/>        build:<br/>            context: .<br/>            dockerfile: Dockerfile<br/>            args:<br/>                uid: ${UID}<br/>        container_name: “sts”<br/>        volumes:<br/>            - /tmp/.X11-unix:/tmp/.X11-unix<br/>            - /home/develop/ws:/home/develop/ws<br/>            - /home/develop/.m2:/home/develop/.m2<br/>            - /usr/lib/jvm/java-10-oracle:/usr/lib/jvm/java-10-oracle<br/>            - /etc/java-10-oracle:/etc/java-10-oracle<br/>        environment:<br/>            - DISPLAY<br/>        user: develop<br/>        ports:<br/>            "8080:8080"</span></pre><p id="377c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意，这个docker-compose文件依赖于主机操作系统。它希望将JDK 10安装在/usr/lib/jvm/java-10-oracle中，并在/etc/java-10-oracle中进行配置。它还希望/home/develop/ws和/home/develop/.m2出现在主机上，以便映射到容器。已经提到了. X11-unix映射是显示GUI屏幕所必需的。在这个文件中还有一些其他需要注意的事情。</p><h2 id="64a1" class="kv jt hh bd ju kw kx ky jy kz la lb kc ip lc ld kg it le lf kk ix lg lh ko li bi translated">用户标识</h2><p id="64e7" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">首先是在容器内部创建非特权用户的方式。这个用户是用作为参数提供的用户id (uid)创建的。我为什么这么做？由容器用户创建的映射卷中的文件将使用容器内用户拥有的uid来创建。如果容器内的用户拥有与容器外不同的uid，这将导致问题。假设我在用户开发平台上运行容器。主机上的这个用户的uid是1002。在容器内部，还有一个uid为1000的用户develop。映射卷上的文件是用uid 1000创建的；容器中用户的uid。然而，在主机上，uid 1000是不同的用户。主机上的开发用户(uid为1002)无法访问这些由容器创建的文件。为了避免这种情况，我在VM内部创建了一个开发用户，其uid与在VM外部使用的用户相同(docker组中发出启动容器命令的用户)。</p><h2 id="4f75" class="kv jt hh bd ju kw kx ky jy kz la lb kc ip lc ld kg it le lf kk ix lg lh ko li bi translated">工作区文件夹和Maven存储库</h2><p id="ca97" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">当使用Docker容器时，通常的做法是避免在容器中存储状态。状态可以是各种各样的东西。我认为STS应用程序工作空间文件夹和Maven存储库也在其中。这就是为什么我在容器中创建了文件夹，并在docker-compose文件中将它们映射到主机。他们将在主机上使用相同名称的文件夹(/home/develop/.m2和/home/develop/ws)。</p><h2 id="4278" class="kv jt hh bd ju kw kx ky jy kz la lb kc ip lc ld kg it le lf kk ix lg lh ko li bi translated">Java 语言(一种计算机语言，尤用于创建网站)</h2><p id="72d1" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">我的Docker容器只有Spring工具套件，它已经足够大了，内部没有超过300Mb的JVM(在Linux上，Java 10的大小几乎是Java 8的两倍)。我使用的是主机JVM。我在我的Ubuntu开发虚拟机上安装了主机JVM，如这里的<a class="ae jc" href="http://javaoraclesoa.blogspot.com/2018/07/automate-installation-of-oracle-jdk-8.html" rel="noopener ugc nofollow" target="_blank">所述</a>。</p><p id="f8d0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了在Docker容器中使用主机JVM，我需要做两件事:将两个文件夹映射到容器:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/e7346cc590676c66f1cc11858c6e444c.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*1YHTVzhwAX8l45NI.png"/></div></figure><p id="cdbc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">并将JVM路径映射到STS上的JRE文件夹:ln-s/usr/lib/JVM/Java-10-Oracle/opt/ide/STS-3 . 9 . 5 . release/JRE。</p><h1 id="10c0" class="js jt hh bd ju jv ls jx jy jz lt kb kc kd lu kf kg kh lv kj kk kl lw kn ko kp bi translated">看到它工作</h1><p id="bab7" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">首先允许访问显示器:</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="b2aa" class="kv jt hh lk b fi lo lp l lq lr">xhost local:root</span></pre><p id="518d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来使变量UID可用:</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="78e2" class="kv jt hh lk b fi lo lp l lq lr">export UID=$UID</span></pre><p id="d715" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后构建:</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="d9c8" class="kv jt hh lk b fi lo lp l lq lr">docker-compose build<br/>Building sts<br/>Step 1/10 : FROM ubuntu:18.04<br/> — -&gt; 735f80812f90<br/> Step 2/10 : MAINTAINER Maarten Smeets &lt;maarten.smeets@amis.nl&gt;<br/> — -&gt; Using cache<br/> — -&gt; 69177270763e<br/> Step 3/10 : ARG uid<br/> — -&gt; Using cache<br/> — -&gt; 85c9899e5210<br/> Step 4/10 : LABEL nl.amis.smeetsm.ide.name=”Spring Tool Suite” nl.amis.smeetsm.ide.version=”3.9.5"<br/> — -&gt; Using cache<br/> — -&gt; 82f56ab07a28<br/> Step 5/10 : ADD <a class="ae jc" href="https://download.springsource.com/release/STS/3.9.5.RELEASE/dist/e4.8/spring-tool-suite-3.9.5.RELEASE-e4.8.0-linux-gtk-x86_64.tar.gz" rel="noopener ugc nofollow" target="_blank">https://download.springsource.com/release/STS/3.9.5.RELEASE/dist/e4.8/spring-tool-suite-3.9.5.RELEASE-e4.8.0-linux-gtk-x86_64.tar.gz</a> /tmp/ide.tar.gz<br/> <br/> — -&gt; Using cache<br/> — -&gt; 61ab67d82b0e<br/> Step 6/10 : RUN adduser — uid ${uid} — disabled-password — gecos ‘’ develop<br/> — -&gt; Using cache<br/> — -&gt; 679f934d3ccd<br/> Step 7/10 : RUN mkdir -p /opt/ide &amp;&amp; tar zxvf /tmp/ide.tar.gz — strip-components=1 -C /opt/ide &amp;&amp; ln -s /usr/lib/jvm/java-10-oracle /opt/ide/sts-3.9.5.RELEASE/jre &amp;&amp; chown -R develop:develop /opt/ide &amp;&amp; mkdir /home/develop/ws &amp;&amp; chown develop:develop /home/develop/ws &amp;&amp; rm /tmp/ide.tar.gz &amp;&amp; apt-get update &amp;&amp; apt-get install -y libxslt1.1 libswt-gtk-3-jni libswt-gtk-3-java &amp;&amp; apt-get autoremove -y &amp;&amp; apt-get clean &amp;&amp; rm -rf /var/lib/apt/lists/* &amp;&amp; rm -rf /tmp/*<br/> — -&gt; Using cache<br/> — -&gt; 5e486a4d6dd0<br/> Step 8/10 : USER develop:develop<br/> — -&gt; Using cache<br/> — -&gt; c3c2b332d932<br/> Step 9/10 : WORKDIR /home/develop<br/> — -&gt; Using cache<br/> — -&gt; d8e45440ce31<br/> Step 10/10 : ENTRYPOINT /opt/ide/sts-3.9.5.RELEASE/STS -data /home/develop/ws<br/> — -&gt; Using cache<br/> — -&gt; 2d95751237d7<br/> Successfully built 2d95751237d7<br/> Successfully tagged t_sts:latest</span></pre><p id="e462" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下次运行:</p><pre class="je jf jg jh fd lj lk ll lm aw ln bi"><span id="02be" class="kv jt hh lk b fi lo lp l lq lr">docker-compose up</span></pre><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es jd"><img src="../Images/84847e663243f06ef72820fd505d80e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*dP3Frgi-Wqh_hERn.png"/></div></figure><p id="f6d8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当您在容器内部的端口8080上运行Spring Boot应用程序时，您可以在端口8080上的主机上使用例如Firefox来访问它。</p></div><div class="ab cl jl jm go jn" role="separator"><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq jr"/><span class="jo bw bk jp jq"/></div><div class="ha hb hc hd he"><p id="698e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="ly">原载于2018年8月6日</em><a class="ae jc" href="http://javaoraclesoa.blogspot.com/2018/08/running-spring-tool-suite-and-other-gui.html" rel="noopener ugc nofollow" target="_blank"><em class="ly">【javaoraclesoa.blogspot.com】</em></a><em class="ly">。</em></p></div></div>    
</body>
</html>