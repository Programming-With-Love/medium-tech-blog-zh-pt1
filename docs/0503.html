<html>
<head>
<title>Dependency injection on Android with Hilt</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于Hilt的Android依赖注入</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/dependency-injection-on-android-with-hilt-67b6031e62d?source=collection_archive---------0-----------------------#2020-06-10">https://medium.com/androiddevelopers/dependency-injection-on-android-with-hilt-67b6031e62d?source=collection_archive---------0-----------------------#2020-06-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/859499c14f0c0376a98497b2190e4e14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gqsETASsCZHY2m0XyEYTMQ.png"/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx">Illustration by <a class="ae hu" href="https://twitter.com/VPoltrack" rel="noopener ugc nofollow" target="_blank">Virginia Poltrack</a></figcaption></figure><div class=""/><div class=""><h2 id="17b7" class="pw-subtitle-paragraph iu hw hx bd b iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl dx translated">Jetpack为DI推荐的库</h2></div><p id="da6c" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">依赖注入(Dependency injection)(DI)是一种广泛应用于编程的技术，非常适合Android开发，依赖被提供给一个类，而不是自己创建。通过遵循DI原则，您为良好的应用程序架构、更高的代码可重用性和易于测试奠定了基础。你有没有在你的app里尝试过手动依赖注入？即使现在有许多现有的依赖注入库，随着项目变得越来越大，它也需要大量的样板代码，因为您必须手工构造每个类及其依赖项，并创建容器来重用和管理依赖项。</p><blockquote class="ki"><p id="c3bd" class="kj kk hx bd kl km kn ko kp kq kr kh dx translated"><strong class="ak">通过遵循DI原则，你为良好的应用架构、更高的代码可重用性和测试的简易性打下了基础</strong>。</p></blockquote><p id="9448" class="pw-post-body-paragraph jm jn hx jo b jp ks iy jr js kt jb ju jv ku jx jy jz kv kb kc kd kw kf kg kh ha bi translated">新的<a class="ae hu" href="https://developer.android.com/training/dependency-injection/hilt-android" rel="noopener ugc nofollow" target="_blank">柄</a>库定义了一种<strong class="jo hy">标准方式</strong>来在你的应用中进行DI，为你的项目中的每个Android类提供容器，并为你自动管理它们的生命周期<em class="kx"/>。</p><p id="74fe" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">Hilt构建在流行的DI库<a class="ae hu" href="https://developer.android.com/training/dependency-injection/dagger-basics" rel="noopener ugc nofollow" target="_blank"> Dagger </a>之上，因此受益于Dagger提供的<strong class="jo hy">编译时正确性、运行时性能、可伸缩性以及</strong> <a class="ae hu" rel="noopener" href="/androiddevelopers/dagger-navigation-support-in-android-studio-49aa5d149ec9"> <strong class="jo hy"> Android Studio支持</strong> </a>。正因为如此，Dagger在谷歌Play商店排名前10k的应用中有30%被广泛采用。但是，由于编译时代码的生成，预计构建时间会增加。</p><p id="dcaf" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">由于许多Android框架类是由操作系统自己实例化的，所以在Android应用程序中使用Dagger时会有一个相关的样板文件。与Dagger不同，Hilt与Jetpack库和Android框架类集成在一起，并删除了大部分样板文件，让您<strong class="jo hy">只关注定义和注入绑定的重要部分</strong>，而不必担心管理Dagger的所有设置和连接。它自动生成并提供:</p><ul class=""><li id="94b7" class="ky kz hx jo b jp jq js jt jv la jz lb kd lc kh ld le lf lg bi translated">用于集成Android框架类和Dagger的组件，否则你将需要手工创建。</li><li id="e3d3" class="ky kz hx jo b jp lh js li jv lj jz lk kd ll kh ld le lf lg bi translated"><strong class="jo hy">范围标注</strong>为Hilt自动生成的组件。</li><li id="299d" class="ky kz hx jo b jp lh js li jv lj jz lk kd ll kh ld le lf lg bi translated"><strong class="jo hy">预定义的绑定和限定符</strong>。</li></ul><p id="a638" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">最棒的是，<strong class="jo hy">匕首和剑柄可以共存，应用程序可以按需迁移</strong>。</p><h1 id="ce52" class="lm ln hx bd lo lp lq lr ls lt lu lv lw jd lx je ly jg lz jh ma jj mb jk mc md bi translated">剑柄在行动</h1><p id="d317" class="pw-post-body-paragraph jm jn hx jo b jp me iy jr js mf jb ju jv mg jx jy jz mh kb kc kd mi kf kg kh ha bi translated">为了向您展示使用Hilt有多简单，让我们在一个典型的Android应用程序中执行一些快速DI。让Hilt给我们的<code class="du mj mk ml mm b">MainActivity</code>注入一个<code class="du mj mk ml mm b">AnalyticsAdapter</code>。</p><p id="753e" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">首先，通过用<code class="du mj mk ml mm b">@HiltAndroidApp</code>注释你的应用程序类来触发Hilt的代码生成，在你的应用程序中启用Hilt:</p><pre class="mn mo mp mq fd mr mm ms mt aw mu bi"><span id="6737" class="mv ln hx mm b fi mw mx l my mz"><strong class="mm hy">@HiltAndroidApp</strong><br/>class MyApplication : Application() { ... }</span></pre><p id="04d7" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">其次，告诉Hilt如何通过用<code class="du mj mk ml mm b">@Inject</code>注释构造函数来提供<code class="du mj mk ml mm b">AnalyticsAdapter</code>的实例:</p><pre class="mn mo mp mq fd mr mm ms mt aw mu bi"><span id="3f0a" class="mv ln hx mm b fi mw mx l my mz">class AnalyticsAdapter <strong class="mm hy">@Inject</strong> constructor() { ... }</span></pre><p id="0a0e" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">第三，为了将<code class="du mj mk ml mm b">AnalyticsAdapter</code>的实例注入到<code class="du mj mk ml mm b">MainActivity</code>中，使用<code class="du mj mk ml mm b">@AndroidEntryPoint</code>注释启用活动中的Hilt，并使用<code class="du mj mk ml mm b">@Inject</code>注释执行字段注入:</p><pre class="mn mo mp mq fd mr mm ms mt aw mu bi"><span id="caf0" class="mv ln hx mm b fi mw mx l my mz"><strong class="mm hy">@AndroidEntryPoint</strong><br/>class MainActivity : AppCompatActivity() {</span><span id="a373" class="mv ln hx mm b fi na mx l my mz">  <strong class="mm hy">@Inject</strong> lateinit var analytics: AnalyticsAdapter</span><span id="f16a" class="mv ln hx mm b fi na mx l my mz">  override fun onCreate(savedInstanceState: Bundle?) {<br/>    super.onCreate(savedInstanceState)</span><span id="5466" class="mv ln hx mm b fi na mx l my mz">    // analytics instance has been populated by Hilt<br/>    // and it's ready to be used<br/>  }<br/>}</span></pre><p id="6fd9" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">要了解更多信息，您可以在下面的备忘单部分轻松查看新注释的功能。</p><h1 id="8381" class="lm ln hx bd lo lp lq lr ls lt lu lv lw jd lx je ly jg lz jh ma jj mb jk mc md bi translated">附带Jetpack支持！</h1><p id="0d40" class="pw-post-body-paragraph jm jn hx jo b jp me iy jr js mf jb ju jv mg jx jy jz mh kb kc kd mi kf kg kh ha bi translated">你可以使用你最喜欢的Jetpack库。到目前为止，我们为ViewModel、WorkManager、Navigation和Compose 提供了直接注入<strong class="jo hy">支持。</strong></p><p id="4428" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">例如，要将一个<a class="ae hu" href="https://developer.android.com/topic/libraries/architecture/viewmodel" rel="noopener ugc nofollow" target="_blank">架构组件视图模型</a> <code class="du mj mk ml mm b">LoginViewModel</code>注入到一个<code class="du mj mk ml mm b">LoginActivity</code>中:用<code class="du mj mk ml mm b">@HiltViewModel</code>注释<code class="du mj mk ml mm b">LoginViewModel</code>，用<code class="du mj mk ml mm b">@Inject</code>注释构造函数，并在<code class="du mj mk ml mm b">@AndroidEntryPoint</code>活动或片段中使用它，如您所料:</p><pre class="mn mo mp mq fd mr mm ms mt aw mu bi"><span id="7e2e" class="mv ln hx mm b fi mw mx l my mz"><strong class="mm hy">@HiltViewModel</strong><br/>class LoginViewModel <strong class="mm hy">@Inject</strong> constructor(<br/>  private val analyticsAdapter: AnalyticsAdapter<br/>): ViewModel { ... }</span><span id="7d3f" class="mv ln hx mm b fi na mx l my mz"><strong class="mm hy">@AndroidEntryPoint<br/></strong>class LoginActivity : AppCompatActivity() {</span><span id="7b54" class="mv ln hx mm b fi na mx l my mz">  private val loginViewModel: LoginViewModel <strong class="mm hy">by viewModels()</strong></span><span id="e48a" class="mv ln hx mm b fi na mx l my mz">  override fun onCreate(savedInstanceState: Bundle?) {<br/>    super.onCreate(savedInstanceState)<br/>    // loginViewModel is ready to be used<br/>  }<br/>}</span></pre><p id="d827" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">在<a class="ae hu" href="https://developer.android.com/training/dependency-injection/hilt-jetpack" rel="noopener ugc nofollow" target="_blank">文档</a>中了解更多关于Jetpack支持的信息。</p><h1 id="0074" class="lm ln hx bd lo lp lq lr ls lt lu lv lw jd lx je ly jg lz jh ma jj mb jk mc md bi translated">开始使用刀柄</h1><p id="0f2d" class="pw-post-body-paragraph jm jn hx jo b jp me iy jr js mf jb ju jv mg jx jy jz mh kb kc kd mi kf kg kh ha bi translated">如果你对Hilt感兴趣并想了解更多，这里有一些资源供你以自己喜欢的方式学习:</p><h2 id="19d7" class="mv ln hx bd lo nb nc nd ls ne nf ng lw jv nh ni ly jz nj nk ma kd nl nm mc nn bi translated">Hilt入门</h2><p id="35a3" class="pw-post-body-paragraph jm jn hx jo b jp me iy jr js mf jb ju jv mg jx jy jz mh kb kc kd mi kf kg kh ha bi translated">通过这个<a class="ae hu" href="https://developer.android.com/training/dependency-injection/hilt-android#setup" rel="noopener ugc nofollow" target="_blank">指南</a>，学习如何在你的Android应用程序中添加Hilt。</p><h2 id="a657" class="mv ln hx bd lo nb nc nd ls ne nf ng lw jv nh ni ly jz nj nk ma kd nl nm mc nn bi translated">证明文件</h2><p id="bd03" class="pw-post-body-paragraph jm jn hx jo b jp me iy jr js mf jb ju jv mg jx jy jz mh kb kc kd mi kf kg kh ha bi translated">如果你是DI或Dagger新手，看看我们的<a class="ae hu" href="https://developer.android.com/training/dependency-injection/hilt-android" rel="noopener ugc nofollow" target="_blank">指南，为Android应用</a>添加刀柄。或者，如果你已经知道Dagger，我们也在dagger.dev 上提供<a class="ae hu" href="https://dagger.dev/hilt" rel="noopener ugc nofollow" target="_blank">文档。</a></p><p id="b7a9" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated">如果你只是对新的注释和你能用Hilt做什么感到好奇，看看下面部分的备忘单。</p><h2 id="8c68" class="mv ln hx bd lo nb nc nd ls ne nf ng lw jv nh ni ly jz nj nk ma kd nl nm mc nn bi translated">对于匕首使用者来说</h2><p id="878b" class="pw-post-body-paragraph jm jn hx jo b jp me iy jr js mf jb ju jv mg jx jy jz mh kb kc kd mi kf kg kh ha bi translated">如果你已经在你的应用程序中使用Dagger或dagger.android，看看这个<a class="ae hu" href="https://dagger.dev/hilt/migration-guide" rel="noopener ugc nofollow" target="_blank">迁移指南</a>或下面提到的codelab来帮助你切换到Hilt。因为Dagger和Hilt可以共存，所以你可以增量地迁移你的应用。</p><h2 id="56ef" class="mv ln hx bd lo nb nc nd ls ne nf ng lw jv nh ni ly jz nj nk ma kd nl nm mc nn bi translated">Codelabs</h2><p id="2107" class="pw-post-body-paragraph jm jn hx jo b jp me iy jr js mf jb ju jv mg jx jy jz mh kb kc kd mi kf kg kh ha bi translated">为了循序渐进地学习Hilt，我们刚刚发布了两个代码实验室:</p><ul class=""><li id="ee67" class="ky kz hx jo b jp jq js jt jv la jz lb kd lc kh ld le lf lg bi translated"><a class="ae hu" href="https://codelabs.developers.google.com/codelabs/android-hilt" rel="noopener ugc nofollow" target="_blank">在你的安卓应用中使用Hilt</a></li><li id="0e7a" class="ky kz hx jo b jp lh js li jv lj jz lk kd ll kh ld le lf lg bi translated"><a class="ae hu" href="https://codelabs.developers.google.com/codelabs/android-dagger-to-hilt" rel="noopener ugc nofollow" target="_blank">从匕首转移到刀柄</a></li></ul><h2 id="6b05" class="mv ln hx bd lo nb nc nd ls ne nf ng lw jv nh ni ly jz nj nk ma kd nl nm mc nn bi translated">示例代码</h2><p id="435c" class="pw-post-body-paragraph jm jn hx jo b jp me iy jr js mf jb ju jv mg jx jy jz mh kb kc kd mi kf kg kh ha bi translated">想看看现有的app是如何使用Hilt的吗？去谷歌I/O 2020应用程序和Android <a class="ae hu" href="https://github.com/android/architecture-samples/tree/dev-hilt" rel="noopener ugc nofollow" target="_blank">架构的<code class="du mj mk ml mm b"><a class="ae hu" href="https://github.com/android/architecture-samples/tree/dev-hilt" rel="noopener ugc nofollow" target="_blank">dev-hilt</a></code>分支——示例Github库</a>检查它的用法。</p><h1 id="5072" class="lm ln hx bd lo lp lq lr ls lt lu lv lw jd lx je ly jg lz jh ma jj mb jk mc md bi translated">小抄</h1><p id="3b17" class="pw-post-body-paragraph jm jn hx jo b jp me iy jr js mf jb ju jv mg jx jy jz mh kb kc kd mi kf kg kh ha bi translated">这个备忘单可以让你快速看到<strong class="jo hy"><em class="kx"/></strong>不同的刀柄和匕首注释做什么，以及<strong class="jo hy"><em class="kx"/></strong>如何使用它们。</p><p id="307b" class="pw-post-body-paragraph jm jn hx jo b jp jq iy jr js jt jb ju jv jw jx jy jz ka kb kc kd ke kf kg kh ha bi translated"><a class="ae hu" href="https://developer.android.com/images/training/dependency-injection/hilt-annotations.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="jo hy">下载PDF格式备忘单</strong> </a></p><figure class="mn mo mp mq fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es no"><img src="../Images/66533780e3358d5805c138c74b74ea28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bmqjwH1MSCkour_u.png"/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx">Hilt and Dagger annotations cheat sheet. <a class="ae hu" href="https://developer.android.com/images/training/dependency-injection/hilt-annotations.pdf" rel="noopener ugc nofollow" target="_blank">Download in PDF here</a>.</figcaption></figure></div></div>    
</body>
</html>