<html>
<head>
<title>Change Data Capture with Debezium</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Debezium改变数据捕获</h1>
<blockquote>原文：<a href="https://medium.com/globant/change-data-capture-with-debezium-6eb523d57b1c?source=collection_archive---------0-----------------------#2021-05-21">https://medium.com/globant/change-data-capture-with-debezium-6eb523d57b1c?source=collection_archive---------0-----------------------#2021-05-21</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="5098" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">理解和实现将更改从关系数据库传播到其他应用程序的简单指南。</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/9adaba0e5d2f7c78d2027d008dd1e8f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BHU6Bd44Cy_qpKRyfBu68g.jpeg"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">Photo by <a class="ae jm" href="https://unsplash.com/photos/rVRvR9VUIoQ" rel="noopener ugc nofollow" target="_blank">sigmund</a></figcaption></figure><p id="44ab" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">有没有觉得有必要将数据库更改传播到任何缓存以保持其健康，或者刷新您正在维护的统计信息以保持其最新，或者传播到您希望数据库更改反映到的任何其他接收器？您实际上是在寻找变更数据捕获。虽然它不是一个新术语，因为数据库专家一直在使用它，但是它在这个数据密集型应用程序的时代变得非常重要，在这个时代，传播或广播数据库更改变得至关重要。</p><p id="3ed5" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">所以正式描述一下:</p><blockquote class="kj kk kl"><p id="9a2b" class="jn jo km jp b jq jr ii js jt ju il jv kn jx jy jz ko kb kc kd kp kf kg kh ki ha bi translated"><em class="hh">“变更数据捕获(CDC)是一套软件设计模式，用于确定和跟踪已变更的数据，以便可以使用变更的数据采取行动”</em> <br/> <em class="hh"> —维基百科</em></p></blockquote><p id="99e6" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated"><strong class="jp hi"> CDC </strong>是一个识别数据库中的任何更改并实时同步到其他应用程序的过程，从而减少通过调度程序或批处理迁移数据所花费的时间。它提高了数据一致性，是可靠、低延迟数据同步的有效方法。</p><h2 id="21bf" class="kq kr hh bd ks kt ku kv kw kx ky kz la jw lb lc ld ka le lf lg ke lh li lj lk bi translated"><strong class="ak">用例:</strong></h2><p id="e5cb" class="pw-post-body-paragraph jn jo hh jp b jq ll ii js jt lm il jv jw ln jy jz ka lo kc kd ke lp kg kh ki ha bi translated">为了理解CDC，让我们考虑一个用例，其中我们需要将数据库(MySQL)中的任何更改同步到内存缓存(Redis)中。首先，让我们分析其他可能的解决方案，选出最佳方案。</p><h2 id="ec4c" class="kq kr hh bd ks kt ku kv kw kx ky kz la jw lb lc ld ka le lf lg ke lh li lj lk bi translated">可能的解决方案:</h2><h2 id="ef15" class="kq kr hh bd ks kt ku kv kw kx ky kz la jw lb lc ld ka le lf lg ke lh li lj lk bi translated">Redis中的同步并行更新和MySQL(双重写入)</h2><p id="a725" class="pw-post-body-paragraph jn jo hh jp b jq ll ii js jt lm il jv jw ln jy jz ka lo kc kd ke lp kg kh ki ha bi translated">一种解决方案是在更新MySQL的同时，在单独的io调用中更新Redis。它有许多缺点。首先，我们需要考虑可靠性。如果数据事务失败，应该恢复Redis操作。第二，如果有多个接收器，网络调用的数量也将线性增加，保持所有系统同步的复杂性也将增加。</p><h2 id="812d" class="kq kr hh bd ks kt ku kv kw kx ky kz la jw lb lc ld ka le lf lg ke lh li lj lk bi translated">调度程序(轮询)</h2><p id="fe01" class="pw-post-body-paragraph jn jo hh jp b jq ll ii js jt lm il jv jw ln jy jz ka lo kc kd ke lp kg kh ki ha bi translated">另一种选择是运行某种调度程序，定期将数据从MySQL同步到Redis。这是有效但昂贵的解决方案。为了保持数据一致性和更频繁地使缓存失效，调度器的频率应该尽可能高，这将增加成本。如果做不到这一点，将导致数据不一致性激增。</p><h2 id="b29c" class="kq kr hh bd ks kt ku kv kw kx ky kz la jw lb lc ld ka le lf lg ke lh li lj lk bi translated">数据库触发器</h2><p id="fd70" class="pw-post-body-paragraph jn jo hh jp b jq ll ii js jt lm il jv jw ln jy jz ka lo kc kd ke lp kg kh ki ha bi translated">数据库触发器是维护数据完整性的缓慢替代方案。此外，如果编写不正确，它们会导致大量的性能问题。此外，当它们被触发时，我们所能做的是有限制的</p><p id="524d" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">在了解了其他可能的解决方案和挑战后，我们现在将了解如何使用CDC和Debezium来解决这个问题。</p><p id="3175" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">介绍(鼓声…)</p><h1 id="7cd5" class="lq kr hh bd ks lr ls lt kw lu lv lw la in lx io ld iq ly ir lg it lz iu lj ma bi translated">Debezium</h1><blockquote class="kj kk kl"><p id="16ee" class="jn jo km jp b jq jr ii js jt ju il jv kn jx jy jz ko kb kc kd kp kf kg kh ki ha bi translated">Debezium是一个分布式平台，它将您现有的数据库转换成事件流，因此应用程序可以看到并立即响应数据库中的每个行级更改。</p><p id="553d" class="jn jo km jp b jq jr ii js jt ju il jv kn jx jy jz ko kb kc kd kp kf kg kh ki ha bi translated">-Debezium.io</p></blockquote><p id="c3f8" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">Debezium是一个开源平台，它使用Kafka connect对DBs中的变化进行流式处理。</p><p id="ece0" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">它主要有4个主要组成部分</p><ol class=""><li id="1dc8" class="mb mc hh jp b jq jr jt ju jw md ka me ke mf ki mg mh mi mj bi translated">动物园管理员</li><li id="8459" class="mb mc hh jp b jq mk jt ml jw mm ka mn ke mo ki mg mh mi mj bi translated">卡夫卡</li><li id="0a9c" class="mb mc hh jp b jq mk jt ml jw mm ka mn ke mo ki mg mh mi mj bi translated">卡夫卡连接</li><li id="fe59" class="mb mc hh jp b jq mk jt ml jw mm ka mn ke mo ki mg mh mi mj bi translated">DB连接器</li></ol><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es mp"><img src="../Images/eebd2744a7c065c8b9d6279e4dbbd786.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2obTjFbo40CruGQM.png"/></div></div><figcaption class="ji jj et er es jk jl bd b be z dx">debezium in action! (Source: debezium.io)</figcaption></figure><h2 id="f2d0" class="kq kr hh bd ks kt ku kv kw kx ky kz la jw lb lc ld ka le lf lg ke lh li lj lk bi translated">它实际上是如何工作的？</h2><p id="1bb3" class="pw-post-body-paragraph jn jo hh jp b jq ll ii js jt lm il jv jw ln jy jz ka lo kc kd ke lp kg kh ki ha bi translated">MySQL和几乎所有其他数据库都维护一个日志文件列表，主要是为了与从/主数据库同步。对任何给定行的所有更改都记录在这些文件中。这些日志使用通过Kafka connect工作的连接器进行流式传输。他们接着坚持卡夫卡的话题。每个主题对应于数据库中的一个表。每个Kafka connect服务都与一个数据库实例相关。但是，Kafka connect服务集群可以部署任意数量的连接器。然后，多个消费者可以通过接收器连接器消费数据。</p><p id="d1c2" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">使用Kafka connect服务Rest API部署连接器。使用连接器传输的事件信息必须是自给自足的，并且使用者必须有合适的解码器来解序列化事件信息。因为JSON数据是冗长的，所以可以使用模式注册中心来维护模式，从而使用像AVRO这样的格式高效地传输事件数据。</p><p id="8f7d" class="pw-post-body-paragraph jn jo hh jp b jq jr ii js jt ju il jv jw jx jy jz ka kb kc kd ke kf kg kh ki ha bi translated">让我们考虑使用debezium的用例解决方案，并遵循以下步骤:</p><ol class=""><li id="fc1e" class="mb mc hh jp b jq jr jt ju jw md ka me ke mf ki mg mh mi mj bi translated">我们将使用MySQL、Kafka Connect、Zookeeper、Kafka的示例docker图像，并为它们启动容器。</li><li id="330a" class="mb mc hh jp b jq mk jt ml jw mm ka mn ke mo ki mg mh mi mj bi translated">观看启动Kafka容器时提到的主题。</li><li id="01d9" class="mb mc hh jp b jq mk jt ml jw mm ka mn ke mo ki mg mh mi mj bi translated">为代理和主题创建一个Kafka消费者，将事件中收到的数据推送到Redis。</li><li id="ff80" class="mb mc hh jp b jq mk jt ml jw mm ka mn ke mo ki mg mh mi mj bi translated">更新数据库以查看Redis中反映的更改。</li></ol><h2 id="717a" class="kq kr hh bd ks kt ku kv kw kx ky kz la jw lb lc ld ka le lf lg ke lh li lj lk bi translated">为什么是Debezium？</h2><ol class=""><li id="dce8" class="mb mc hh jp b jq ll jt lm jw mq ka mr ke ms ki mg mh mi mj bi translated">它是免费的</li><li id="c915" class="mb mc hh jp b jq mk jt ml jw mm ka mn ke mo ki mg mh mi mj bi translated">它是可扩展的</li><li id="56fd" class="mb mc hh jp b jq mk jt ml jw mm ka mn ke mo ki mg mh mi mj bi translated">它具有容错性和可靠性</li><li id="4d30" class="mb mc hh jp b jq mk jt ml jw mm ka mn ke mo ki mg mh mi mj bi translated">它很快</li></ol><h2 id="294f" class="kq kr hh bd ks kt ku kv kw kx ky kz la jw lb lc ld ka le lf lg ke lh li lj lk bi translated">嵌入式Debezium:</h2><p id="3096" class="pw-post-body-paragraph jn jo hh jp b jq ll ii js jt lm il jv jw ln jy jz ka lo kc kd ke lp kg kh ki ha bi translated">并不是每个应用程序都需要可伸缩性，因此对于某些应用程序来说，Debezium的分布式体系结构是一种矫枉过正。因此，这样的系统可以使用嵌入式Debezium。连接器存在于应用程序空间本身，数据被发送到应用程序本身，而不是发送到Kafka。</p><h2 id="5497" class="kq kr hh bd ks kt ku kv kw kx ky kz la jw lb lc ld ka le lf lg ke lh li lj lk bi translated"><strong class="ak">结论:</strong></h2><p id="2f91" class="pw-post-body-paragraph jn jo hh jp b jq ll ii js jt lm il jv jw ln jy jz ka lo kc kd ke lp kg kh ki ha bi translated">变更数据捕获是将行级变更从一个数据库同步到多个使用者应用程序的理想方式。此外，Debezium是一个优秀的分布式平台，它为CDC提供了便利，并带来了许多优势。</p></div></div>    
</body>
</html>