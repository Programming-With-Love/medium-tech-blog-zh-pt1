<html>
<head>
<title>One Cool Trick to Simplify Reducer Functions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">简化减速器功能的一个妙招</h1>
<blockquote>原文：<a href="https://medium.com/javascript-scene/one-cool-trick-to-simplify-reducer-functions-bbbffe488bb6?source=collection_archive---------1-----------------------#2020-06-04">https://medium.com/javascript-scene/one-cool-trick-to-simplify-reducer-functions-bbbffe488bb6?source=collection_archive---------1-----------------------#2020-06-04</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/634d9dfcff2bdcff652bacf4c1b1e769.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CWvvGvP-JU2D5L-cb5JIcA.png"/></div></div></figure><p id="3798" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你花时间去了解它，Redux是一个令人惊奇的工具。Redux的一个常见错误是，reducers必须是纯函数。</p><p id="0939" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">纯函数是这样的函数:</p><ol class=""><li id="fdc5" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm js jt ju jv bi translated">给定相同的参数，总是返回相同的结果，并且</li><li id="579e" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">没有副作用(例如，它不会改变它的输入参数)。</li></ol><p id="5b06" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">问题是，有时候一个reducer需要对一些输入状态进行复杂的更改，但是你不能只是改变状态参数而不引起bug。</p><p id="10e8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">解决方案是一个叫做<a class="ae kb" href="https://github.com/immerjs/immer" rel="noopener ugc nofollow" target="_blank"> Immer </a>的便捷工具。在这个视频中，我将向您介绍Immer，并向您展示如何使用它来降低reducer代码的复杂性。对于一个或两个小的reducers，差别是非常微妙的，但是在一个大的项目中，它可以显著地简化您的应用程序代码。</p><figure class="kc kd ke kf fd ii"><div class="bz dy l di"><div class="kg kh l"/></div></figure><p id="2326" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这里有一个例子。假设您正在构建一个社交网络，您需要跟踪用户喜欢的帖子。当他们喜欢一个帖子时，您可以将一个like对象添加到用户的likes集合中。可能看起来像这样:</p><figure class="kc kd ke kf fd ii"><div class="bz dy l di"><div class="ki kh l"/></div></figure><p id="5265" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">注意我们从<code class="du kj kk kl km b">like.type</code>案例中返回的内容:使用JavaScript object spread语法将有效载荷的位混合到state对象的嵌套属性中:第19–25行的<code class="du kj kk kl km b">...state</code>和<code class="du kj kk kl km b">...state.likes</code>。</p><p id="7a40" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在immer之后，您可以将该部分简化为一行代码(第21行):</p><figure class="kc kd ke kf fd ii"><div class="bz dy l di"><div class="ki kh l"/></div></figure><p id="5c5a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><code class="du kj kk kl km b">produce</code>函数返回一个部分应用程序(一个已经部分应用到它的参数上的函数),然后它接受reducer函数的参数。您传递给它一个回调函数，它接受状态对象的一个<code class="du kj kk kl km b">draft</code>,而不是真正的状态对象。您可以随意改变该对象，就好像它是JavaScript中任何其他可变对象一样。不再传播嵌套属性以避免改变输入参数。</p><p id="686c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在您的回调函数运行后，Immer将草稿与原始状态进行比较，然后应用您的更改构建一个新对象，因此您的函数感觉像是在变异，但行为仍然像一个纯函数。你得到了两个世界的精华:突变的简单性和不变性的好处。</p><h1 id="4a7a" class="kn ko hh bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">后续步骤</h1><p id="c047" class="pw-post-body-paragraph ip iq hh ir b is ll iu iv iw lm iy iz ja ln jc jd je lo jg jh ji lp jk jl jm ha bi translated"><a class="ae kb" href="https://ericelliottjs.com/" rel="noopener ugc nofollow" target="_blank">EricElliottJS.com</a>有关于纯函数、不变性、部分应用以及其他函数式和面向对象编程概念等主题的深入课程。</p><p id="3b26" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><a class="ae kb" href="https://www.youtube.com/channel/UCAbA0FivNSBqTmyYrh6uymQ" rel="noopener ugc nofollow" target="_blank">订阅YouTube </a>。</p></div><div class="ab cl lq lr go ls" role="separator"><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv lw"/><span class="lt bw bk lu lv"/></div><div class="ha hb hc hd he"><p id="3951" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> <em class="lx">埃里克·艾略特</em> </strong> <em class="lx">是一位科技产品和平台顾问，《T5】 <a class="ae kb" href="https://leanpub.com/composingsoftware" rel="noopener ugc nofollow" target="_blank"> <em class="lx">【作曲软件】</em></a><em class="lx"/><a class="ae kb" href="https://ericelliottjs.com" rel="noopener ugc nofollow" target="_blank"><em class="lx">【EricElliottJS.com】</em></a><em class="lx"/><a class="ae kb" href="https://devanywhere.io" rel="noopener ugc nofollow" target="_blank"><em class="lx">devanywhere . io</em></a><em class="lx">的联合创始人，以及dev团队导师。他曾为Adobe Systems、</em> <strong class="ir hi"> <em class="lx">、Zumba Fitness、</em> </strong> <em class="lx"> </em> <strong class="ir hi"> <em class="lx">【华尔街日报、</em></strong><em class="lx"/><strong class="ir hi"><em class="lx">【ESPN、</em></strong><em class="lx"/><strong class="ir hi"><em class="lx">【BBC】</em></strong><em class="lx">等顶级录音艺人和包括</em> <strong class="ir hi"> <em class="lx"> Usher、【Metallica】</em></strong></em></p><p id="5895" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">他和世界上最美丽的女人享受着与世隔绝的生活方式。</p></div></div>    
</body>
</html>