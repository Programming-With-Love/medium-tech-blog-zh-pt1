<html>
<head>
<title>Shotgun Episode 2: Writing Tests that Don’t Break</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">散弹枪第2集:编写不会崩溃的测试</h1>
<blockquote>原文：<a href="https://medium.com/javascript-scene/shotgun-episode-2-writing-tests-that-don-t-break-6fbce334c0c8?source=collection_archive---------5-----------------------#2016-03-18">https://medium.com/javascript-scene/shotgun-episode-2-writing-tests-that-don-t-break-6fbce334c0c8?source=collection_archive---------5-----------------------#2016-03-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/991d0b9dbb03bab579fb88c41f2f5453.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lo8cD5m7VqUXPlKF3lgfNQ.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo: <a class="ae it" href="https://www.flickr.com/photos/luxurydesigner/" rel="noopener ugc nofollow" target="_blank">Brandon Bailey</a> — Midnight Cowboy (CC-BY-2.0)</figcaption></figure><p id="db7f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Shotgun是一个新节目，当我为真正的应用程序和库解决真正的编程挑战时，你可以和我一起乘坐shotgun。这个节目只对EricElliottJS.com的成员开放，但是我在这里记录了这次冒险。</p><p id="6475" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在<a class="ae it" rel="noopener" href="/javascript-scene/shotgun-javascript-video-experience-c8b6a7771d49">第1集</a>中，我们启动了一个全新的React项目——一个使用React的在线课程展示引擎。我们用磁带覆盖了单元测试，用Watch覆盖了auto-lint &amp;测试，用Enzyme覆盖了小故障。</p><h2 id="2bd9" class="js jt hh bd ju jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km bi translated">仍然对酶充满希望</h2><p id="797f" class="pw-post-body-paragraph iu iv hh iw b ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn kr jp jq jr ha bi translated">在第一集中，我们切换到Cheerio进行DOM测试。大概是第5次被<a class="ae it" href="https://github.com/jshomes/course-player/issues/2" rel="noopener ugc nofollow" target="_blank">酵素</a><a class="ae it" href="https://github.com/airbnb/enzyme/issues/41" rel="noopener ugc nofollow" target="_blank">bug</a>出轨了。我真的对Enzyme感到兴奋，但要做好遇到错误和提交错误报告的准备。请随时关注这些链接，调查错误，并提交适当的问题&amp; PRs。如果我有时间，我很乐意做这件事。</p><p id="8a43" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这个早期阶段，对于大多数测试来说，酵素可能会比麦片更慢。但是请记住，在撰写本文时，Enzyme才刚刚成立4个月，许多聪明人正在解决这些问题，并对API进行改进。在6个月内，我希望这将是一个非常不同的故事。</p><h2 id="476f" class="js jt hh bd ju jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km bi translated">编写持久的UI测试</h2><p id="a9dd" class="pw-post-body-paragraph iu iv hh iw b ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn kr jp jq jr ha bi translated">我不知道你怎么想，但是我在构建应用程序的时候会不断地修改我的UI标记。当你测试UI组件的时候，很容易因为一个小小的改变而破坏一系列的单元测试。</p><p id="2a57" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为了防止这种情况，我避免编写对DOM了解过多的测试。例如，在Course Player项目中，我们有一个<em class="ks"> `card-player` </em> div，如下所示:</p><figure class="kt ku kv kw fd ii"><div class="bz dy l di"><div class="kx ky l"/></div></figure><p id="dca6" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如你所见，它有一个<em class="ks">`导航条`</em>、一个选择菜单、一些卡片内容和一个继续按钮。我考虑过将卡片导航下移至卡片内容下方。如果我在<em class="ks"> `nav-bar` </em>元素测试中寻找它，向下移动它会破坏测试，我将不得不进行更多的重构。</p><p id="cbab" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">当我知道有些东西可能会改变形状时，我不会试图通过测试完整的组件输出来复制所有子测试的工作。相反，对于容器元素，我只是测试该元素是否可以被选择，以及它是否可以呈现子元素。让我们看一个例子:</p><figure class="kt ku kv kw fd ii"><div class="bz dy l di"><div class="kx ky l"/></div></figure><p id="bf27" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">看一下<em class="ks"> `output` </em>变量。它选择<em class="ks"> `.nav-bar` </em>元素，获取children集合并检查其【T4 `. length`属性。<em class="ks"> `actual` </em>测试只是确保【T8 `. length`大于零，这告诉你它是否呈现任何子元素。</p><p id="5fc7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">你可能会说，导航条应该检查导航选项是否显示，但是导航元素会有自己的测试来确保传递给它的子元素会被呈现，所以这个测试是多余的，只会使测试套件比它需要的更脆弱。</p><p id="0364" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在，如果我决定将导航列表从'. nav-bar '组件中移除，当然，也许我可以重新考虑将其命名为nav-any one，因为在这一点上，它更像是一个标题栏，而不是导航栏，但如果我们能到达那里，我们将跨越这座桥梁。</p><h2 id="4e63" class="js jt hh bd ju jv jw jx jy jz ka kb kc jf kd ke kf jj kg kh ki jn kj kk kl km bi translated">JSX中的布尔属性</h2><p id="0efd" class="pw-post-body-paragraph iu iv hh iw b ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn kr jp jq jr ha bi translated">HTML有一些布尔属性。在课程播放器中，如果还没有满足卡片要求，我们使用<em class="ks"> `disabled` </em>属性来禁用继续按钮，同时向学生指示应该在尝试继续之前完成卡片。</p><p id="9914" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">编写HTML时，您可能想简单地添加disabled属性，如下所示:</p><figure class="kt ku kv kw fd ii"><div class="bz dy l di"><div class="kx ky l"/></div></figure><p id="6494" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在制作这一集的时候，我试着这样做:</p><figure class="kt ku kv kw fd ii"><div class="bz dy l di"><div class="kx ky l"/></div></figure><p id="4a4a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">它神奇地成功了。</p><p id="690d" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">注意<em class="ks"> `isCompleted` </em>三元表达式。有一分钟，我担心空的disabled值会导致<em class="ks"> `disabled` </em>属性尝试使用falsy值进行渲染，这不是有效的HTML，但我很高兴地被提醒，当您将falsy值传递给布尔属性时，React会做正确的事情:这是一种方便的快捷方式，使处理布尔属性变得轻而易举。</p><p id="fe69" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我想我们都希望事情有时会比实际情况更困难。谢天谢地，React开发人员很懒，他们希望事情第一次就“正常工作”。</p><p id="ac97" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你是会员，现在就可以自由地<a class="ae it" href="https://ericelliottjs.com/premium-content/shotgun-episode-2/" rel="noopener ugc nofollow" target="_blank">进入第二集</a>。</p><p id="6145" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你还不是会员，看看预告视频，加入我们的<a class="ae it" href="https://ericelliottjs.com/product/shotgun-with-eric-elliott-a-javascript-video-experience/" rel="noopener ugc nofollow" target="_blank"/>。Shotgun与<a class="ae it" href="https://ericelliottjs.com/product/lifetime-access-pass/" rel="noopener ugc nofollow" target="_blank">终身访问通行证</a>捆绑在一起，它让您可以访问我们的所有视频:网络广播系列和课程内容，涵盖TDD、原型OO、函数式编程、React、通用应用程序开发、ES6+等主题。</p><figure class="kt ku kv kw fd ii"><div class="bz dy l di"><div class="kz ky l"/></div></figure><h1 id="fcb3" class="la jt hh bd ju lb lc ld jy le lf lg kc lh li lj kf lk ll lm ki ln lo lp kl lq bi translated"><a class="ae it" rel="noopener" href="/javascript-scene/looping-over-child-components-in-react-shotgun-episode-3-396de16289cc">散弹枪第3集:在React的子组件上循环</a></h1></div><div class="ab cl lr ls go lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ha hb hc hd he"><blockquote class="ly"><p id="676d" class="lz ma hh bd mb mc md me mf mg mh jr dx translated"><a class="ae it" href="http://ericelliottjs.com/product/lifetime-access-pass/" rel="noopener ugc nofollow" target="_blank"> <em class="mi">向埃里克·艾略特</em> </a> <em class="mi"> <br/>学习JavaScript成为终身访问会员:<br/>网络广播<br/>视频体验<br/>书籍&amp;更多… </em></p></blockquote></div><div class="ab cl lr ls go lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ha hb hc hd he"><p id="5ca4" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><strong class="iw hi"> <em class="ks">埃里克·埃利奥特</em> </strong> <em class="ks">著有《编写JavaScript应用程序</em><a class="ae it" href="http://pjabook.com" rel="noopener ugc nofollow" target="_blank"><em class="ks"/></a><em class="ks">(O ' Reilly)，以及《学习通用JavaScript App开发用节点&amp;</em><em class="ks">。他为Adobe Systems</em><strong class="iw hi"><em class="ks"/></strong><em class="ks"/><strong class="iw hi"><em class="ks">Zumba Fitness</em></strong><em class="ks"/><strong class="iw hi"><em class="ks">【华尔街日报</em></strong><em class="ks"/><strong class="iw hi"><em class="ks">【ESPN</em></strong><em class="ks"/><strong class="iw hi"><em class="ks">BBC</em></strong><em class="ks">等顶级录音师贡献了软件经验</em></p><p id="61a2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">他大部分时间都在旧金山湾区和世界上最美丽的女人在一起。</p></div></div>    
</body>
</html>