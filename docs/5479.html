<html>
<head>
<title>Optimizing TensorFlow for CPU</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为CPU优化TensorFlow</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/optimizing-tensorflow-for-cpu-d78308cf8fc8?source=collection_archive---------0-----------------------#2018-07-22">https://medium.com/oracledevs/optimizing-tensorflow-for-cpu-d78308cf8fc8?source=collection_archive---------0-----------------------#2018-07-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="846c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">几天前，我参加了一个巴西开发者大会。在许多讲座中，有一个关于英特尔架构的讲座非常有趣。</p><p id="0bb2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">英特尔正在努力通过不同的硬件和软件优化为人工智能项目提供更多性能，如下图所示。英特尔拥有一个针对CPU进行了许多优化的TensorFlow发行版。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/f69ef6006b6880b51980c7670eca812b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RBjKURh6XmIeyPDG1MeFSg.jpeg"/></div></div></figure><p id="188d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这篇文章中，我将展示使用不同的TensorFlow和Python发行版以及Oracle Cloud进行测试的结果。</p><p id="f800" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对于此测试，我使用了来自Oracle Cloud的2个计算实例:</p><ul class=""><li id="3e21" class="jo jp hh ig b ih ii il im ip jq it jr ix js jb jt ju jv jw bi translated">实例1 = 1个OCPU + 7，5GB内存</li><li id="f470" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb jt ju jv jw bi translated">实例2 = 2个OCPUs + 30GB内存</li></ul><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kc"><img src="../Images/684a3605806c5905d7e258ca992b83f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PHk_Dg0FEpRVbgVCp8wLzw.png"/></div></div></figure><p id="858c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这两个计算实例中，我创建了3个不同的Anaconda环境:</p><pre class="jd je jf jg fd kd ke kf kg aw kh bi"><span id="d715" class="ki kj hh ke b fi kk kl l km kn">conda create -n py36tf tensorflow python=3.6</span></pre><ul class=""><li id="a5cc" class="jo jp hh ig b ih ii il im ip jq it jr ix js jb jt ju jv jw bi translated">Python + TensorFlow-mkl(具有英特尔MKL DNN公司的TensorFlow)</li></ul><pre class="jd je jf jg fd kd ke kf kg aw kh bi"><span id="9afa" class="ki kj hh ke b fi kk kl l km kn">conda create -n py36tfmkl tensorflow-mkl python=3.6</span></pre><ul class=""><li id="6149" class="jo jp hh ig b ih ii il im ip jq it jr ix js jb jt ju jv jw bi translated">Python(英特尔)+ TensorFlow-mkl(具有英特尔MKL DNN的TensorFlow)</li></ul><pre class="jd je jf jg fd kd ke kf kg aw kh bi"><span id="ff4c" class="ki kj hh ke b fi kk kl l km kn">conda create -n py36tfmklintel tensorflow-mkl python=3.6 -c intel</span></pre><p id="f456" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了评估TensorFlow的性能，我使用了以下python脚本:</p><pre class="jd je jf jg fd kd ke kf kg aw kh bi"><span id="6246" class="ki kj hh ke b fi kk kl l km kn">import tensorflow as tf<br/>import time<br/><br/>tf.set_random_seed(42)<br/>A = tf.random_normal([10000,10000])<br/>B = tf.random_normal([10000,10000])<br/><br/>def check():<br/>    start_time = time.time()<br/>    with tf.Session() as sess:<br/>        print(sess.run(tf.reduce_sum(tf.matmul(A,B))))<br/>    print("It took {} seconds".format(time.time() - start_time))<br/><br/>check()</span></pre><p id="bd85" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">结果如下:</p><p id="aa1e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在实例1中，花费了70.50秒。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ko"><img src="../Images/24ed885d36492405e5186891acaa367c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ETaZEK2Jy84GylHRmFuRsQ.png"/></div></div></figure><p id="1fd7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在实例2中，花费了35.95秒。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kp"><img src="../Images/3aad3a8a58fb5f7bcdf8d6625e4cbc6c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VldvwD0l77xleULN1mGyNg.png"/></div></div></figure><ul class=""><li id="ce18" class="jo jp hh ig b ih ii il im ip jq it jr ix js jb jt ju jv jw bi translated">Python + TensorFlow-mkl(具有英特尔MKL DNN公司的TensorFlow)</li></ul><p id="d4f6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在实例1中，花费了15.69秒。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kq"><img src="../Images/71c5b596ededd5044b3555c324583d09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R-jhs0QbCGwg0WLGjlZB5w.png"/></div></div></figure><p id="ff45" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在实例2中，花费了8.00秒。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kr"><img src="../Images/c33f60d9983ed0884f2150a2bbf8b862.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QTKHOTA4YmXMqTFwGPUVUg.png"/></div></div></figure><ul class=""><li id="4a02" class="jo jp hh ig b ih ii il im ip jq it jr ix js jb jt ju jv jw bi translated">Python(英特尔)+ TensorFlow-mkl(具有英特尔MKL DNN的TensorFlow)</li></ul><p id="8e20" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在实例1中，花费了15.85秒。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ks"><img src="../Images/1dd51df7bca8286849d5c3ff1715c69e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-rAKLSex-7fo9nalAWHPCw.png"/></div></div></figure><p id="54ce" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在实例2中，花费了8.13秒。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kt"><img src="../Images/7e1c1c01658e3ea89a88ec494b66ac02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1EDJjbRD4yLVI1TpcSMsSw.png"/></div></div></figure><p id="21c8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这两个计算实例中的最佳和最坏情况之间的差异为450%！</p><p id="7c1c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Python + TensorFlow-mkl(具有英特尔MKL DNN公司的TensorFlow)是最好的工具，而Python + TensorFlow是最差的工具。</p><p id="70f0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这些结果证明，您可以使用CPU来训练和执行机器学习和深度学习项目。你所要做的就是使用正确的工具。</p><p id="1dd1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">玩得开心！</p></div><div class="ab cl ku kv go kw" role="separator"><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz la"/><span class="kx bw bk ky kz"/></div><div class="ha hb hc hd he"><p id="868b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="lb">原载于2018年7月22日</em><a class="ae lc" href="http://waslleysouza.com.br/en/2018/07/optimizing-tensorflow-for-cpu/" rel="noopener ugc nofollow" target="_blank"><em class="lb"/></a><em class="lb">。</em></p></div></div>    
</body>
</html>