<html>
<head>
<title>Connect your Android users with a tap: Fast Pair (Part 3 of 3)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用tap: Fast Pair连接您的Android用户(第3部分，共3部分)</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/connect-your-android-users-with-a-tap-fast-pair-ce31d486baff?source=collection_archive---------2-----------------------#2021-07-16">https://medium.com/androiddevelopers/connect-your-android-users-with-a-tap-fast-pair-ce31d486baff?source=collection_archive---------2-----------------------#2021-07-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/c17c31be8bce1dbf08c135f478def54f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pWwXoytU0-9xj6yIMKMblg.png"/></div></div></figure><div class=""/><p id="0b06" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您是设备制造商或开发特定设备附带的应用程序(如可穿戴或物联网应用程序)的开发人员，您可以使用<a class="ae jn" href="https://developers.google.com/nearby/fast-pair/spec" rel="noopener ugc nofollow" target="_blank">快速配对服务</a>来减少您和您的最终用户将您的设备与Android手机配对的工作量。</p><p id="2890" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">事实上，没有支持快速配对的编码，除非你想在你的配套应用中处理配对，而不是让API为你做。</p><p id="f901" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">配对过程只有三个部分:</p><ol class=""><li id="ad39" class="jo jp hs ir b is it iw ix ja jq je jr ji js jm jt ju jv jw bi translated">确保您的外围设备符合所有注册先决条件。</li><li id="ac00" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">向Google注册设备型号。</li><li id="10d8" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">当用户需要配对时，向他们的电话宣传您的设备(在步骤1中收集的信息将显示给用户，如图1所示)。</li></ol><figure class="kd ke kf kg fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es kc"><img src="../Images/0df1606029d5ae3abbbf5f9ed63ed040.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cCDHqd-WZvHLdxtOP9lnwg.jpeg"/></div></div></figure><p id="f648" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">图1:连接的快速配对通知</strong></p><p id="3261" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">一旦用户将你的外围设备置于配对模式，他们的Android手机就会显示一个底部的对话框，显示你设备的名称、照片和一个<strong class="ir ht">连接</strong>按钮(也如图1所示)。</p><p id="4c00" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您的用户只需点击按钮来配对设备，之后他们将享受愉快、无压力的体验。</p><p id="e177" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><a class="ae jn" href="https://developers.google.com/nearby/fast-pair/spec" rel="noopener ugc nofollow" target="_blank">快速配对服务</a>还可以让用户使用手机帮助定位放错地方的设备，甚至显示真正的无线立体声(TWS)耳塞的电池电量。</p><p id="3d39" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最后，Fast Pair可以提示用户为您的设备安装任何配套应用程序。</p><h1 id="6d00" class="kh ki hs bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">注册先决条件</h1><p id="eb06" class="pw-post-body-paragraph ip iq hs ir b is lf iu iv iw lg iy iz ja lh jc jd je li jg jh ji lj jk jl jm ha bi translated">为确保您的设备与Fast Pair一起正常工作并提供增强的最终用户体验，它应满足以下要求:</p><h1 id="61cd" class="kh ki hs bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">隐私和BLE</h1><p id="1f52" class="pw-post-body-paragraph ip iq hs ir b is lf iu iv iw lg iy iz ja lh jc jd je li jg jh ji lj jk jl jm ha bi translated">为了保护您用户的隐私并防止跟踪，我们要求设备使用带有<a class="ae jn" href="https://www.electronicdesign.com/technologies/communications/article/21801870/ble-v42-creating-faster-more-secure-powerefficient-designspart-2" rel="noopener ugc nofollow" target="_blank">随机可解析私有地址(RPA) </a>的<a class="ae jn" href="https://en.wikipedia.org/wiki/Bluetooth_Low_Energy" rel="noopener ugc nofollow" target="_blank">蓝牙低能耗</a> (BLE)广告。</p><p id="287b" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">该地址应该大约每15分钟以及每次广告时段开始时改变一次。但是，在配对模式下不要轮换地址；旋转会阻止连接的建立和维护，因为当地址不再可用时，连接会断开。</p><h1 id="08f8" class="kh ki hs bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">帐户密钥</h1><p id="a3a8" class="pw-post-body-paragraph ip iq hs ir b is lf iu iv iw lg iy iz ja lh jc jd je li jg jh ji lj jk jl jm ha bi translated">快速配对使用<a class="ae jn" href="https://developers.google.com/nearby/fast-pair/spec#AccountKeyList" rel="noopener ugc nofollow" target="_blank">账户密钥</a>来代表外围设备的不同个人用户。一个帐户密钥映射到一个Gmail地址。</p><p id="27eb" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您的外围设备需要存储至少五个帐户密钥，以便多人可以使用同一设备。例如，有父母和青少年的家庭可能共用一辆车，每个人都使用自己的Gmail地址作为帐户密钥。</p><p id="19ed" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">作为一个附加功能，在多个Android手机或平板电脑上使用同一个Gmail帐户的单个个人仍被快速配对服务视为单个帐户密钥。因此，如果十个不同的Android设备共享一个Gmail帐户，就Fast Pair而言，您的外围设备不会知道其中的区别——这只是一个用户。</p><h1 id="1a18" class="kh ki hs bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">BLE关贸总协定</h1><p id="63d9" class="pw-post-body-paragraph ip iq hs ir b is lf iu iv iw lg iy iz ja lh jc jd je li jg jh ji lj jk jl jm ha bi translated">您的设备需要支持BLE关贸总协定的服务和特征配置文件。</p><p id="167f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">使用Fast Pair要求您定义一个具有<code class="du lk ll lm ln b">0xFE2C</code>UUID和以下<a class="ae jn" href="https://developers.google.com/nearby/fast-pair/spec#gatt_service" rel="noopener ugc nofollow" target="_blank">自定义特征</a>的服务:</p><ul class=""><li id="5224" class="jo jp hs ir b is it iw ix ja jq je jr ji js jm lo ju jv jw bi translated">型号ID</li><li id="3ed6" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm lo ju jv jw bi translated">基于密钥的配对</li><li id="f27f" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm lo ju jv jw bi translated">万能钥匙</li><li id="059d" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm lo ju jv jw bi translated">帐户密钥</li></ul><p id="3eb5" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这些是对标准特征和任何自定义特征的补充(可选用于与附带的应用程序通信)。</p><p id="7bff" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你有一个配套的应用程序，并且它安装在中央设备上，你的自定义数据将被中继到该应用程序。否则，自定义数据将被忽略。</p><p id="635e" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">你可以选择让你的应用为<code class="du lk ll lm ln b">com.google.android.gms.nearby.fastpair.ACTION_LOG_BUFFER_FULL</code>注册一个<code class="du lk ll lm ln b">BroadcastReceiver</code>。这是可选的，因为使用此功能需要您的外围设备通知中央设备缓冲区已满，这意味着外围固件和配套应用程序都需要工作才能对数据进行任何操作。</p><h1 id="b513" class="kh ki hs bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">耳机</h1><p id="af8e" class="pw-post-body-paragraph ip iq hs ir b is lf iu iv iw lg iy iz ja lh jc jd je li jg jh ji lj jk jl jm ha bi translated">快速配对的一个常见应用是耳机，它需要支持A2DP或HFP。只要设备支持这些配置文件中的一个，在绑定完成后，Fast Pair就会尝试依次连接到A2DP和HFP。</p><p id="add2" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">对于TWS花蕾，需要以下内容:</p><ul class=""><li id="cfa9" class="jo jp hs ir b is it iw ix ja jq je jr ji js jm lo ju jv jw bi translated">广告有效载荷包括您设备的电池电量。</li><li id="3bb1" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm lo ju jv jw bi translated">用户可以为设备输入自定义名称。</li></ul><p id="c614" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">虽然其他外围设备不需要这些，但Fast Pair支持它们，强烈建议使用它们。</p><h1 id="a760" class="kh ki hs bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">带有配套应用程序的设备</h1><p id="627e" class="pw-post-body-paragraph ip iq hs ir b is lf iu iv iw lg iy iz ja lh jc jd je li jg jh ji lj jk jl jm ha bi translated">Fast Pair具有更通用的应用启动流程，支持各种配套设备。在此流程中，Fast Pair仅发现最近的设备，检查设备配套应用程序(如果尚未安装，则提示用户安装)，并将用户重定向到配套应用程序的指定屏幕。这种流动不涉及BT结合。</p><p id="766b" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">FitBit使用这个流程来简化他们的设备设置过程。使用这种流程的另一个设备示例可能是智能秤或电动牙刷，使用它来推广其配套应用程序并简化开箱即用的体验。</p><figure class="kd ke kf kg fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es kc"><img src="../Images/65402f8e30aaaca6777bf6a9239f276d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8tbhOOZBUl7YYHG3bMW4MA.jpeg"/></div></div></figure><p id="2327" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir ht">图2:配套应用重定向</strong></p><h1 id="2e96" class="kh ki hs bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">双向通信</h1><p id="736a" class="pw-post-body-paragraph ip iq hs ir b is lf iu iv iw lg iy iz ja lh jc jd je li jg jh ji lj jk jl jm ha bi translated">虽然广告是单向通信，但一旦你的设备成功连接到Android手机等中央设备，双向通信就成为可能。</p><p id="d490" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">快速配对为您的外围设备提供了一个<a class="ae jn" href="https://en.wikipedia.org/wiki/List_of_Bluetooth_protocols#Radio_frequency_communication_(RFCOMM)" rel="noopener ugc nofollow" target="_blank"> RFCOMM通道</a>，以保持与中央设备的持续通信。一旦建立了连接，切换到经典蓝牙进行双向通信是完全没问题的。</p><h1 id="ffd9" class="kh ki hs bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">登记</h1><p id="ca49" class="pw-post-body-paragraph ip iq hs ir b is lf iu iv iw lg iy iz ja lh jc jd je li jg jh ji lj jk jl jm ha bi translated">你需要<a class="ae jn" href="https://developers.google.com/nearby/devices/" rel="noopener ugc nofollow" target="_blank">向谷歌</a>注册你的设备型号作为<em class="lp">快速配对提供者</em>。</p><p id="fb2f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">一个<em class="lp">快速配对提供者</em>是一个外围设备——比如一副耳机——告知它有资格进行配对。</p><p id="1b7c" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">另一方面,<em class="lp">快速配对搜索者</em>是一个中央设备——比如安卓手机或平板电脑——它寻找其他设备进行配对。Google Play服务框架处理这部分工作，不需要合作伙伴采取任何行动，因此不在此讨论。</p><p id="d8a7" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要注册您的外围设备，您只需要以下内容:</p><ul class=""><li id="8bb8" class="jo jp hs ir b is it iw ix ja jq je jr ji js jm lo ju jv jw bi translated">设备的名称</li><li id="aea4" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm lo ju jv jw bi translated">设备的图像</li><li id="cb58" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm lo ju jv jw bi translated">设备发射功率(<code class="du lk ll lm ln b">TxPower</code>)的<a class="ae jn" href="https://developers.google.com/nearby/fast-pair/spec#transmit_power" rel="noopener ugc nofollow" target="_blank">测量值</a></li></ul><p id="29a3" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">虽然该设备的名称和图像很简单，但测量功率需要更多的工作。我们建议在距离Android手机一米远的地方测量设备的信号强度，然后在测量值上增加41dBm(在Eddystone-UID 的<a class="ae jn" href="https://github.com/google/eddystone/tree/master/eddystone-uid#tx-power" rel="noopener ugc nofollow" target="_blank">文章中有更详细的描述)。</a></p><p id="00cb" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">提交<code class="du lk ll lm ln b">TxPower</code>有两种选择:您可以在注册时手动提交，或者您的设备可以在设备广告期间将其作为有效载荷的一部分。</p><p id="0134" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您在注册期间提供了设备<code class="du lk ll lm ln b">TxPower</code>，则表明您提交了该型号的所有设备均已校准至准确的<code class="du lk ll lm ln b">TxPower</code>水平。另一方面，如果您决定您的设备将提供<code class="du lk ll lm ln b">TxPower</code>级别作为广告记录的一部分，则<code class="du lk ll lm ln b">TxPower</code>级别将按单位处理。</p><p id="8e53" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">注册完成后，我们将为您提供一个型号ID和一个加密的公钥/私钥对。与任何非对称加密系统一样，强烈建议将私钥存储在设备的安全元件(SE)中，这样对手就无法访问它。(你可以在这篇关于改进你的应用程序的密码术的文章中了解关于非对称密钥<a class="ae jn" rel="noopener" href="/androiddevelopers/improve-your-apps-cryptography-from-message-authentication-to-user-presence-869277f50d34">的更多信息。)</a></p><p id="c97d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在广告期间，您的设备的有效载荷(广告记录)应该<a class="ae jn" href="https://developers.google.com/nearby/fast-pair/spec#AdvertisingWhenDiscoverable" rel="noopener ugc nofollow" target="_blank">包括您从Google收到的型号ID </a>和设备的TxPower级别(如果在注册期间没有提供的话)。</p><h1 id="c856" class="kh ki hs bd kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le bi translated">摘要</h1><p id="81d3" class="pw-post-body-paragraph ip iq hs ir b is lf iu iv iw lg iy iz ja lh jc jd je li jg jh ji lj jk jl jm ha bi translated">快速配对是谷歌作为Google Play服务的一部分提供的一项服务，旨在简化Android用户的配对过程。除了方便配对之外，Fast Pair还提供了许多其他有用的功能，包括帮助用户找到放错位置的设备，并提示他们安装设备的配套应用程序。尽管有许多先决条件来确保您的用户获得最佳体验，但注册过程本身非常容易，因为它只需要设备名称和照片。编码快乐！</p></div></div>    
</body>
</html>