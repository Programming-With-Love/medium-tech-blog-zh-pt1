<html>
<head>
<title>Monitoring Spring Boot applications with Prometheus and Grafana</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Prometheus和Grafana监控Spring Boot应用</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/monitoring-spring-boot-applications-with-prometheus-and-grafana-b33dae198ee2?source=collection_archive---------3-----------------------#2018-11-10">https://medium.com/oracledevs/monitoring-spring-boot-applications-with-prometheus-and-grafana-b33dae198ee2?source=collection_archive---------3-----------------------#2018-11-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="c6c7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了比较反应式Spring Boot服务的不同JDK的性能，我做了一个设置，其中Spring Boot应用程序被包装在Docker容器中。这使得为运行相同Spring Boot应用程序的不同JDK创建不同的容器变得容易。Spring Boot应用程序向普罗米修斯公开了度量标准。Grafana可以读取这些指标，并允许从中做出很好的可视化效果。这篇博文描述了这个设置。下一篇文章将会展示结果。你可以在这里下载代码<a class="ae jc" href="https://github.com/MaartenSmeets/gs-reactive-rest-service.git" rel="noopener ugc nofollow" target="_blank">(在完整的文件夹里)。为了说明这有多简单，我总共花了不到1.5个小时就完成了设置和运行，并撰写了这篇博文。我对普罗米修斯和格拉夫纳没有太多的先验知识，除了卢卡斯·杰利马在艾米斯的一次研讨会。</a></p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/945cd2d069df53fe34aae4207ffa2414.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KPmpSBiYPnJIq1cOyNGXKw.png"/></div></div></figure></div><div class="ab cl jp jq go jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="ha hb hc hd he"><h2 id="d3b0" class="jw jx hh bd jy jz ka kb kc kd ke kf kg ip kh ki kj it kk kl km ix kn ko kp kq bi translated">将Spring Boot包装在码头集装箱中</h2><p id="8bd9" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">用Docker容器包装Spring Boot应用程序很容易。例如这里的<a class="ae jc" href="https://technology.amis.nl/2018/03/18/running-spring-boot-in-a-docker-container-on-openjdk-oracle-jdk-zulu-on-alpine-linux-oracle-linux-ubuntu/" rel="noopener ugc nofollow" target="_blank"/>。您需要执行以下操作:</p><p id="c9f5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如下创建一个docker文件(更改FROM条目以获得不同的JDK)</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kw"><img src="../Images/bbe6850a5d8ad9820f932acfd3b52294.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*pjSwpjU3_pnm-U1a.png"/></div></figure><p id="89f0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">向pom.xml文件添加插件。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kw"><img src="../Images/cc50fd2d2dedc3953a214f9a1bc584e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*5qise5_9z1FqXzXF.png"/></div></figure><p id="1491" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">并定义所使用的属性:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kw"><img src="../Images/e2b880ac26f95d6bcfd214e751f3e9c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*bgdgcS_D7GJxgUFB.png"/></div></figure><p id="18be" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在你可以做mvn清理包dockerfile:build，它会为你创建Docker镜像spring io/GS-reactive-rest-service:latest。您可以使用以下命令来运行:</p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="3322" class="jw jx hh ky b fi lc ld l le lf">docker run -p 8080:8080 -t springio/gs-reactive-rest-service:latest</span></pre><h2 id="79fb" class="jw jx hh bd jy jz ka kb kc kd ke kf kg ip kh ki kj it kk kl km ix kn ko kp kq bi translated">从Spring Boot获得普罗米修斯度量</h2><p id="a25c" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">为了使字符串引导应用程序中的普罗米修斯度量可用，需要添加一些依赖关系(见<a class="ae jc" href="https://dzone.com/articles/monitoring-using-spring-boot-2-prometheus-and-graf" rel="noopener ugc nofollow" target="_blank">这里</a>)。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kw"><img src="../Images/67b8f4acc469736d3ddf13ca0c15dec0.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*Wb4XF_qsBWvhnoxK.png"/></div></figure><p id="b8f6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，您可以运行Docker容器并转到如下URL:<a class="ae jc" href="http://localhost:8080/actuator/prometheus" rel="noopener ugc nofollow" target="_blank">http://localhost:8080/actuator/Prometheus</a>，您将会看到如下内容:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kw"><img src="../Images/a02305ef7be34045bbd47ee230dfaaf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*8zjdCQP_XMf_Xpz2.png"/></div></figure><h2 id="2c5b" class="jw jx hh bd jy jz ka kb kc kd ke kf kg ip kh ki kj it kk kl km ix kn ko kp kq bi translated">提供普罗米修斯配置</h2><p id="a19a" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">我提供了一个小的配置文件，让Prometheus查看来自Spring Boot的指标URL(参见<a class="ae jc" href="https://github.com/MaartenSmeets/gs-reactive-rest-service/blob/master/complete/prom.yml" rel="noopener ugc nofollow" target="_blank">这里</a>):</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kw"><img src="../Images/c98680e31465703ab9851ec7e926c672.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*Cd2RS6sDTaN0GXQs.png"/></div></figure><p id="2065" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">把Spring Boot、普罗米修斯和格拉夫纳放在一起，正如你在上面的截图中看到的，我使用了主机名spring-boot。我可以这样做是因为docker compose配置container_name。如下图所示:</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es lg"><img src="../Images/147cd8b6ab918790255e4cd7944367ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:546/format:webp/0*308x4BV6WrUd-qQj.png"/></div></figure><p id="82f9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Grafana和Prometheus是这些产品的官方Docker图像。我已经将前面提到的配置文件添加到prometheus实例中(Prometheus下的volumes条目)。现在我可以进行docker-compose up，它将启动Spring Boot(可从localhost:8080获得)、带有配置文件的Prometheus(可从localhost:9090获得)和Grafana(可从localhost:3000获得)。它们将被放在同一个Docker网络中，可以通过主机名“prometheus”、“grafana”和“spring-boot”相互访问</p><h2 id="4995" class="jw jx hh bd jy jz ka kb kc kd ke kf kg ip kh ki kj it kk kl km ix kn ko kp kq bi translated">配置Grafana</h2><p id="e84e" class="pw-post-body-paragraph ie if hh ig b ih kr ij ik il ks in io ip kt ir is it ku iv iw ix kv iz ja jb ha bi translated">在Grafana中，很容易将Prometheus添加为数据源。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kw"><img src="../Images/018b514777e7556b4aacc5cfdd2c5b88.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*XiKWevHpGORsa3mw.png"/></div></figure><p id="da11" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">完成此操作后，您可以添加仪表板。一个简单的方法是在Prometheus中创建一个简单的查询，并将其复制到Grafana中以创建一个图表。可能有更好的方法来这样做，但我还没有深入到Grafana，以了解更多关于它的能力。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kw"><img src="../Images/1830435b3518e0b3859c29ce3cd41119.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*So6NsGLKp9q1-0o6.png"/></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div class="er es kw"><img src="../Images/fe97010b98d502aeec86929f453e89c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/0*irQ1AW7owvFNyKOb.png"/></div></figure><p id="b3ff" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，使用Prometheus和Grafana监控Spring Boot应用程序既简单又强大。使用docker-compose文件，也很容易将一个程序集放在一起，以启动/链接不同的容器。如果你想重新开始，这很容易。</p><p id="99f7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要亲自尝试一下，请执行以下操作(我已经使用了下面的VM(需要vagger和VirtualBox来构建)，并且预装了docker和docker-compose maven:<a class="ae jc" href="https://github.com/MaartenSmeets/provisioning/tree/master/ubuntudev" rel="noopener ugc nofollow" target="_blank">这里是</a></p><pre class="je jf jg jh fd kx ky kz la aw lb bi"><span id="db95" class="jw jx hh ky b fi lc ld l le lf">git clone <a class="ae jc" href="https://github.com/MaartenSmeets/gs-reactive-rest-service" rel="noopener ugc nofollow" target="_blank">https://github.com/MaartenSmeets/gs-reactive-rest-service</a><br/>cd gs-reactive-rest-service/complete<br/>mvn clean package<br/>mvn dockerfile:build<br/>docker-compose up</span></pre><p id="b637" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，您可以访问之前指定的URL来访问Spring Boot应用程序Prometheus和Grafana。</p></div><div class="ab cl jp jq go jr" role="separator"><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju jv"/><span class="js bw bk jt ju"/></div><div class="ha hb hc hd he"><p id="a60b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="lh">原载于2018年11月10日</em><a class="ae jc" href="http://javaoraclesoa.blogspot.com/2018/11/monitoring-spring-boot-applications.html" rel="noopener ugc nofollow" target="_blank"><em class="lh">【javaoraclesoa.blogspot.com</em></a><em class="lh">。</em></p></div></div>    
</body>
</html>