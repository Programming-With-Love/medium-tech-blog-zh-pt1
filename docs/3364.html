<html>
<head>
<title>Android app size analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Android应用程序大小分析</h1>
<blockquote>原文：<a href="https://medium.com/globant/android-app-size-analysis-759cc3dbdede?source=collection_archive---------1-----------------------#2017-06-26">https://medium.com/globant/android-app-size-analysis-759cc3dbdede?source=collection_archive---------1-----------------------#2017-06-26</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/de3c1dea02b27223498285ad3344cad9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eCSV8jyRUFBK0AOpN9oL_A.png"/></div></div></figure><p id="c8c6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在我之前的文章中，我谈到了iOS应用程序的<a class="ae jn" rel="noopener" href="/@avijeet.dutta13/ios-app-size-analysis-76206a18a666">应用程序大小分析。在这篇文章中，我将谈论同样的Android应用程序。显然，当你拥有遍布全球的<strong class="ir hi"> 2B </strong>全球活跃用户时，你会希望你的应用能根据你的业务达到最大化。此外，这一点很重要，因为最近谷歌PlayStore的统计数据显示，如果应用程序的下载大小(OTA)大于<strong class="ir hi"> 100 MB </strong>，取消用户设备上此类应用程序下载的几率会增加<strong class="ir hi"> 20% </strong>。</a></p><p id="3d6e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">类似的统计数据也适用于应用程序的安装大小。安装容量超过<strong class="ir hi"> 100 MB </strong>的应用从设备上卸载的可能性是<strong class="ir hi"> 8 </strong>倍。</p><p id="6ea2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="jo">那么你应该怎么做呢？</em></p><h2 id="57aa" class="jp jq hh bd jr js jt ju jv jw jx jy jz ja ka kb kc je kd ke kf ji kg kh ki kj bi translated"><strong class="ak"> 1。使用程序:</strong></h2><p id="ec7b" class="pw-post-body-paragraph ip iq hh ir b is kk iu iv iw kl iy iz ja km jc jd je kn jg jh ji ko jk jl jm ha bi translated">对于发布版本，这是默认启用的。</p><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="9347" class="jp jq hh ku b fi ky kz l la lb">android {<br/>    buildTypes {<br/>        release {<br/>            minifyEnabled true<br/>        }<br/>    }<br/>}</span></pre><p id="2f7f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">ProGuard是一个完整的程序Java代码优化器。它主要做三件重要的事情:</p><p id="fe05" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">a)它通过改变代码表示而不改变核心功能来优化代码。</p><p id="b585" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">b)它混淆了类型、方法、字段、类等的名称，这增加了程序的效率。</p><p id="9d11" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">c)死代码消除:这是三个中最重要的。android程序可以被认为是一个图，其中类、方法、字段作为节点，方法调用和引用作为边。Proguard保留了应用程序的直接入口点，这些入口点只是应用程序清单文件中定义的Android组件(活动、服务、内容提供商、广播接收器和自定义应用程序类)。</p><figure class="kp kq kr ks fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lc"><img src="../Images/67f64c0cef84ea83a57e77e1dff657f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bb1Vm-bwgN8GlMyhK29lpA.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx">Live Code vs Dead Code</figcaption></figure><h2 id="0bdb" class="jp jq hh bd jr js jt ju jv jw jx jy jz ja ka kb kc je kd ke kf ji kg kh ki kj bi translated"><strong class="ak"> 2。构建多个apk:</strong></h2><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="007f" class="jp jq hh ku b fi ky kz l la lb">android {<br/>    splits {<br/>        density {<br/>            enabled true<br/>        }<br/>    }<br/>}</span></pre><p id="a1be" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">该功能根据应用的屏幕密度和CPU架构来定制要安装在特定设备上的应用，而不是下载/安装通用apk，后者具有永远不会在设备中使用的额外资源。这基本上意味着根据屏幕密度和CPU架构分割你的应用程序，然后一起上传到PlayStore。如果你认为这是一个很大的工作量；不要担心，谷歌有一个更好的方法来管理这个问题，通过<a class="ae jn" href="https://developer.android.com/studio/publish/app-signing.html#sign-apk" rel="noopener ugc nofollow" target="_blank"> Google Play应用程序签名</a>，还有额外的好处，可以减轻应用程序的整个签名过程，包括保管<em class="jo">应用程序的发布密钥库</em>等等。</p><h2 id="a6af" class="jp jq hh bd jr js jt ju jv jw jx jy jz ja ka kb kc je kd ke kf ji kg kh ki kj bi translated">3.<strong class="ak">使用矢量绘制:</strong></h2><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="3a84" class="jp jq hh ku b fi ky kz l la lb">android {<br/>    defaultConfig {<br/>        vectorDrawables.useSupportLibrary true<br/>    }<br/>}</span></pre><p id="85c9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这仅仅意味着所有屏幕密度的一个<strong class="ir hi">单一资产</strong>。Android <a class="ae jn" href="https://developer.android.com/topic/libraries/support-library/rev-archive.html" rel="noopener ugc nofollow" target="_blank">支持库</a>版本<strong class="ir hi"> 23.2 </strong>引入了对矢量可绘制向后兼容的支持，直到<strong class="ir hi"> API 14 </strong>。此外，Android N 还支持矢量绘制中的渐变。需要注意的一点是，复杂的向量会降低CPU和RAM的使用速度。所以当你想在应用程序中使用矢量图像时，应该进行彻底的分析。这基本上是应用程序大小缩减与应用程序性能成本之间的权衡。使用矢量图像的应用程序相对小于使用<em class="jo"> xxxhdpi </em>图像的多应用程序。</p><h2 id="2b09" class="jp jq hh bd jr js jt ju jv jw jx jy jz ja ka kb kc je kd ke kf ji kg kh ki kj bi translated">4.删除不需要的替代资源:</h2><pre class="kp kq kr ks fd kt ku kv kw aw kx bi"><span id="5c99" class="jp jq hh ku b fi ky kz l la lb">android {<br/>    defaultConfig {<br/>        ...<br/>        resConfigs "en", "fr" <br/>    }<br/>}</span></pre><p id="62f9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">上面的Gradle配置显示该应用程序只支持英语和法语。这有助于消除应用程序中未使用的资源。例如，一个或多个应用程序依赖项中包含的消息的字符串翻译使用了应用程序不支持的语言。因此，使用此设置，任何未指定语言的资源都将被删除。</p><h2 id="974d" class="jp jq hh bd jr js jt ju jv jw jx jy jz ja ka kb kc je kd ke kf ji kg kh ki kj bi translated">5.使用可下载的字体</h2><p id="cdfb" class="pw-post-body-paragraph ip iq hh ir b is kk iu iv iw kl iy iz ja km jc jd je kn jg jh ji ko jk jl jm ha bi translated">这是Android平台新增的功能。谷歌明白(通过对PlayStore上排名前25的应用程序的调查)PlayStore上的大多数应用程序使用通用字体。现在，由于字体与应用程序捆绑在一起，从操作系统的角度来看，设备上的不同应用程序都有字体的副本。此外，大多数字体都没有为移动优化。谷歌通过<em class="jo">可下载字体想出了解决这个问题的办法。</em></p><figure class="kp kq kr ks fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lh"><img src="../Images/3d398d2e3dd7d10beda362affe3a98a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w2XncPiuDwHxYtzpP_-6Iw.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx">Apps making use of common Fonts through Google Play Service’s Font Provider</figcaption></figure><p id="08a7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">可下载字体是通过应用程序中的Google Play服务提供的按需字体。这可从<a class="ae jn" href="https://developer.android.com/preview/features/downloadable-fonts.html" rel="noopener ugc nofollow" target="_blank">支持库26 </a>获得。这有许多优点，即节省蜂窝数据、电话存储器、节省磁盘空间等等。需要时，通过网络获取字体。使用<em class="jo">字体提供者</em>可以帮助你通过Google Play服务使用所有的Google字体目录(超过<strong class="ir hi"> 800 </strong>)。</p><h2 id="1f15" class="jp jq hh bd jr js jt ju jv jw jx jy jz ja ka kb kc je kd ke kf ji kg kh ki kj bi translated">6.在Android Studio中使用APK分析器:</h2><p id="82af" class="pw-post-body-paragraph ip iq hh ir b is kk iu iv iw kl iy iz ja km jc jd je kn jg jh ji ko jk jl jm ha bi translated">这个工具是你所能得到的最好的了解你的应用程序中打包了什么的工具。因此，明智地使用这个工具，为你的应用程序做出明智的决定。随着Android Studio 3.0 和<em class="jo"> AAPT2 </em>的推出，这将带来更多的东西。尤其是最重要的是包含了ProGuard映射，将文件映射到发布版本上相应的模糊代码。这有助于您了解应用程序中包含的详细信息。</p><figure class="kp kq kr ks fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es li"><img src="../Images/ec0c8c2df5c656fb15568c287d47fef6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nlZVOBcplVmO6WkQP1pKQA.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx">APK Analyzer depicting App Size break-up and method count information.</figcaption></figure><p id="6dcc" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">不仅如此，你还应该经常考虑将一个App的最新apk与之前的apk进行比较。这有助于您理解应用程序两个版本之间的差异，并对其进行验证。也许根据分析删除代码中不必要的东西。</p><figure class="kp kq kr ks fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lj"><img src="../Images/88f81bf603e45d9fbe480e6b13ef8af7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2sVGdSTTL8i6RS5ak3q4Mw.png"/></div></div><figcaption class="ld le et er es lf lg bd b be z dx">APK diff between two versions of an App</figcaption></figure><p id="9ca9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">遵循这些技巧应该让你尽可能地收紧你的应用程序的腰围。</p></div></div>    
</body>
</html>