<html>
<head>
<title>Ruby’s New Exception Keyword Arguments</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Ruby新的异常关键字参数</h1>
<blockquote>原文：<a href="https://medium.com/square-corner-blog/rubys-new-exception-keyword-arguments-4d5bbb504d37?source=collection_archive---------1-----------------------#2018-05-15">https://medium.com/square-corner-blog/rubys-new-exception-keyword-arguments-4d5bbb504d37?source=collection_archive---------1-----------------------#2018-05-15</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="65da" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">`异常:假'和`异常:真'</h2></div><blockquote class="iw"><p id="a4fe" class="ix iy hh bd iz ja jb jc jd je jf jg dx translated">注意，我们已经行动了！如果您想继续了解Square的最新技术内容，请访问我们的新家<a class="ae jh" href="https://developer.squareup.com/blog" rel="noopener ugc nofollow" target="_blank">https://developer.squareup.com/blog</a></p></blockquote><p id="9d36" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc jg ha bi translated">在Ruby 2.6中，多种内核方法获得了一个新的<code class="du kd ke kf kg b">exception: false</code>或<code class="du kd ke kf kg b">exception: true</code>关键字参数。当内核方法失败时，一些方法会引发错误，一些方法会返回<code class="du kd ke kf kg b">nil</code>。这项新功能允许您覆盖默认行为。</p><h2 id="4d66" class="kh ki hh bd kj kk kl km kn ko kp kq kr jr ks kt ku jv kv kw kx jz ky kz la lb bi translated">TL；DR:在Ruby 2.6中，这些例子都可以工作:</h2><figure class="lc ld le lf fd lg"><div class="bz dy l di"><div class="lh li l"/></div></figure><h1 id="daa9" class="lj ki hh bd kj lk ll lm kn ln lo lp kr in lq io ku iq lr ir kx it ls iu la lt bi translated">背景</h1><p id="d849" class="pw-post-body-paragraph ji jj hh jk b jl lu ii jn jo lv il jq jr lw jt ju jv lx jx jy jz ly kb kc jg ha bi translated">当意想不到的事情发生时，Ruby该怎么办？大声失败？默默进行？看情况。您可能更喜欢用不同的方式处理错误，这是有原因的。</p><p id="71d7" class="pw-post-body-paragraph ji jj hh jk b jl lz ii jn jo ma il jq jr mb jt ju jv mc jx jy jz md kb kc jg ha bi translated">许多方法都有一个默认行为，当出错时要么返回<code class="du kd ke kf kg b">nil</code>要么抛出一个错误。Ruby在逐个方法的基础上选择最合适的缺省值。</p><p id="6d01" class="pw-post-body-paragraph ji jj hh jk b jl lz ii jn jo ma il jq jr mb jt ju jv mc jx jy jz md kb kc jg ha bi translated">Ruby具有各种默认行为的一个例子是字符串到数字的转换。例如，<code class="du kd ke kf kg b">'nope'.to_i</code>是许可的并返回<code class="du kd ke kf kg b">0</code>，因为<code class="du kd ke kf kg b">'nope'</code>不是一个数字。另一方面，<code class="du kd ke kf kg b">Integer('nope')</code>是严格的，会引发错误。这里有几个例子来说明这是如何工作的:</p><figure class="lc ld le lf fd lg"><div class="bz dy l di"><div class="lh li l"/></div></figure><p id="97a8" class="pw-post-body-paragraph ji jj hh jk b jl lz ii jn jo ma il jq jr mb jt ju jv mc jx jy jz md kb kc jg ha bi translated">许可字符串#to_i方法对数字的检测不够严格。当找不到时，它只提供默认值零。或者，严格的Kernel#Integer方法会引发一个错误。如果您希望在Ruby 2.5和更早的版本中进行严格的解析，但是没有错误，那么您可以手动挽救:</p><pre class="lc ld le lf fd me kg mf mg aw mh bi"><span id="9d5e" class="kh ki hh kg b fi mi mj l mk ml">Integer('nope') rescue nil<br/>#=&gt; nil</span></pre><h1 id="5483" class="lj ki hh bd kj lk ll lm kn ln lo lp kr in lq io ku iq lr ir kx it ls iu la lt bi translated">数值转换异常错误</h1><p id="f831" class="pw-post-body-paragraph ji jj hh jk b jl lu ii jn jo lv il jq jr lw jt ju jv lx jx jy jz ly kb kc jg ha bi translated">手动救援的问题是<a class="ae jh" href="https://bugs.ruby-lang.org/issues/12732#note-6" rel="noopener ugc nofollow" target="_blank">慢，噪音大</a>。在我的机器上，使用<code class="du kd ke kf kg b">exception: false</code>几乎快了三倍:</p><figure class="lc ld le lf fd lg er es paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="er es mm"><img src="../Images/8c19cc387ceef1341983d870f5fd9fb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VBoB1xkrAHenqX6NwFiWhw.png"/></div></div></figure><p id="cb74" class="pw-post-body-paragraph ji jj hh jk b jl lz ii jn jo ma il jq jr mb jt ju jv mc jx jy jz md kb kc jg ha bi translated">在Ruby 2.6中，您将能够使用<code class="du kd ke kf kg b">Integer('nope', exception: false)</code>而不是<code class="du kd ke kf kg b">Integer('nope') rescue nil</code>来获得更好的性能。这同样适用于<code class="du kd ke kf kg b">Float</code>、<code class="du kd ke kf kg b">Rational</code>和<code class="du kd ke kf kg b">Complex</code>。</p><blockquote class="mt mu mv"><p id="643c" class="ji jj mw jk b jl lz ii jn jo ma il jq mx mb jt ju my mc jx jy mz md kb kc jg ha bi translated"><code class="du kd ke kf kg b">Float('nope', exception: false)</code></p><p id="98bb" class="ji jj mw jk b jl lz ii jn jo ma il jq mx mb jt ju my mc jx jy mz md kb kc jg ha bi translated">代替</p><p id="ca40" class="ji jj mw jk b jl lz ii jn jo ma il jq mx mb jt ju my mc jx jy mz md kb kc jg ha bi translated"><code class="du kd ke kf kg b">Float('nope') rescue nil</code></p></blockquote><h1 id="eccd" class="lj ki hh bd kj lk ll lm kn ln lo lp kr in lq io ku iq lr ir kx it ls iu la lt bi translated">系统出现异常</h1><p id="bfbe" class="pw-post-body-paragraph ji jj hh jk b jl lu ii jn jo lv il jq jr lw jt ju jv lx jx jy jz ly kb kc jg ha bi translated">新的异常关键字参数也可用于Kernel#system。如果命令执行失败，#system方法的默认行为是静默失败并返回<code class="du kd ke kf kg b">nil:</code></p><pre class="lc ld le lf fd me kg mf mg aw mh bi"><span id="4615" class="kh ki hh kg b fi mi mj l mk ml">system 'nope'<br/>#=&gt; nil</span></pre><p id="3f5f" class="pw-post-body-paragraph ji jj hh jk b jl lz ii jn jo ma il jq jr mb jt ju jv mc jx jy jz md kb kc jg ha bi translated">以前，如果您想让#system在执行失败时引发错误，您必须自己编写消息并引发错误。现在您可以简单地添加<code class="du kd ke kf kg b">exception: true</code>，您将得到一条格式良好的错误消息:</p><pre class="lc ld le lf fd me kg mf mg aw mh bi"><span id="2f50" class="kh ki hh kg b fi mi mj l mk ml">system 'nope', exception: true<br/>#!&gt; Errno::ENOENT: No such file or directory - nope</span></pre><p id="2c4f" class="pw-post-body-paragraph ji jj hh jk b jl lz ii jn jo ma il jq jr mb jt ju jv mc jx jy jz md kb kc jg ha bi translated">当命令执行成功但存在非零退出状态时，<code class="du kd ke kf kg b">exception: true</code>也将导致产生一个错误，而不是<code class="du kd ke kf kg b">false</code>返回值。</p><h1 id="3dc1" class="lj ki hh bd kj lk ll lm kn ln lo lp kr in lq io ku iq lr ir kx it ls iu la lt bi translated">结论</h1><p id="8488" class="pw-post-body-paragraph ji jj hh jk b jl lu ii jn jo lv il jq jr lw jt ju jv lx jx jy jz ly kb kc jg ha bi translated">感谢艾伦·帕特森<a class="ae jh" href="https://bugs.ruby-lang.org/issues/12732" rel="noopener ugc nofollow" target="_blank">提出这个数字转换的功能</a>。并且感谢<a class="ae jh" href="https://bugs.ruby-lang.org/users/10073" rel="noopener ugc nofollow" target="_blank"> Takashi Kokubun </a>为<a class="ae jh" href="https://bugs.ruby-lang.org/issues/14386" rel="noopener ugc nofollow" target="_blank">为#system </a>提出这个特性。新的<code class="du kd ke kf kg b">exception:</code>关键字参数将在2018年12月25日发布的Ruby 2.6中发布。这些变化并没有出现在ruby-2.6.0-preview1中，但它们将成为即将发布的ruby-2.6.0-preview2的一部分，现在可以在夜间快照中看到。</p><p id="24c6" class="pw-post-body-paragraph ji jj hh jk b jl lz ii jn jo ma il jq jr mb jt ju jv mc jx jy jz md kb kc jg ha bi translated"><em class="mw">我们在Square使用Ruby做很多事情——包括我们的</em><a class="ae jh" href="https://github.com/square/connect-ruby-sdk#readme" rel="noopener ugc nofollow" target="_blank"><em class="mw">Square Connect Ruby SDK</em></a><em class="mw">和</em> <a class="ae jh" href="https://github.com/square?language=ruby" rel="noopener ugc nofollow" target="_blank"> <em class="mw">开源Ruby项目</em> </a> <em class="mw">。我们热切期待Ruby 2.6的发布！</em></p><figure class="lc ld le lf fd lg er es paragraph-image"><div class="er es na"><img src="../Images/4a5cbd27e651a30316221c83a98144bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:124/format:webp/1*LQtcqjFqw-UGHetMpabgwg.png"/></div><figcaption class="nb nc et er es nd ne bd b be z dx">The Ruby logo is Copyright © 2006, Yukihiro Matsumoto, distributed under <a class="ae jh" href="https://creativecommons.org/licenses/by-sa/2.5" rel="noopener ugc nofollow" target="_blank">CC BY-SA 2.5</a>.</figcaption></figure><p id="f552" class="pw-post-body-paragraph ji jj hh jk b jl lz ii jn jo ma il jq jr mb jt ju jv mc jx jy jz md kb kc jg ha bi translated">想要更多吗？ <a class="ae jh" href="https://www.workwithsquare.com/developer-newsletter.html?channel=Online%20Social&amp;sqmethod=Blog" rel="noopener ugc nofollow" target="_blank"> <em class="mw">注册</em> </a> <em class="mw">为你的每月开发者简讯或</em> <a class="ae jh" href="https://squ.re/2Hks3YE" rel="noopener ugc nofollow" target="_blank"> <em class="mw">顺道拜访</em> </a> <em class="mw">方dev Slack频道，说声“嗨！”</em></p></div></div>    
</body>
</html>