<html>
<head>
<title>Installing PHP8 on an OCI A1 Arm Instance running Oracle Linux 8</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在运行Oracle Linux 8的OCI A1 Arm实例上安装PHP8</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/installing-php8-on-an-oci-a1-arm-instance-running-oracle-linux-8-787e09edee47?source=collection_archive---------0-----------------------#2022-05-05">https://medium.com/oracledevs/installing-php8-on-an-oci-a1-arm-instance-running-oracle-linux-8-787e09edee47?source=collection_archive---------0-----------------------#2022-05-05</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/38712b9e18156d95feabeb3b4502ea53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p50Sem7TTziR-onhiRFcIg.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo by <a class="ae it" href="https://www.pexels.com/photo/black-and-white-penguin-walking-on-sand-2078474/" rel="noopener ugc nofollow" target="_blank">Jean van der Meulen from Pexels</a></figcaption></figure><p id="296e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">你喜欢PHP吗？也许您喜欢编写PHP应用程序，或者您需要使用众多使用PHP的开源应用程序之一？有太多的在这里列出，但你在一个很好的公司！下面是我们将在本文中看到的内容的一个快速快照:运行Oracle Linux 8的A1 (Arm) OCI实例上的PHP8。</p><p id="dec2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Oracle Linux有PHP作为易于安装的RPM ( <em class="js"> sudo dnf install php </em>)。让我们来看看:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="3419" class="kc kd hh jy b fi ke kf l kg kh">$ dnf info php<br/>Last metadata expiration check: 6:04:47 ago on Tue 03 May 2022 02:19:09 PM GMT.<br/>Available Packages<br/>Name         : php<br/>Version      : 7.2.24<br/>Release      : 1.module+el8.2.0+5510+6771133c<br/>Architecture : aarch64<br/>Size         : 1.4 M<br/>Source       : php-7.2.24-1.module+el8.2.0+5510+6771133c.src.rpm<br/>Repository   : ol8_appstream<br/>Summary      : PHP scripting language for creating dynamic web sites<br/>URL          : <a class="ae it" href="http://www.php.net/" rel="noopener ugc nofollow" target="_blank">http://www.php.net/</a><br/>License      : PHP and Zend and BSD and MIT and ASL 1.0<br/>Description  : PHP is an HTML-embedded scripting language. PHP attempts to make it<br/>             : easy for developers to write dynamically generated web pages. PHP also<br/>             : offers built-in database integration for several commercial and<br/>             : non-commercial database management systems, so writing a<br/>             : database-enabled webpage with PHP is fairly simple. The most common<br/>             : use of PHP coding is probably as a replacement for CGI scripts.<br/>             :<br/>             : The php package contains the module (often referred to as mod_php)<br/>             : which adds support for the PHP language to Apache HTTP Server.</span></pre><p id="5f9a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果您想使用PHP7，这没问题，但是由于PHP8是最新的主要版本，有时可能需要PHP8。如果你使用的是基于x86_64(又名amd64)的实例，<a class="ae it" href="https://blog.remirepo.net/" rel="noopener ugc nofollow" target="_blank"> Remirepo </a>已经预建了rpm，使得安装PHP8变得很容易。有一个问题——remi repo没有arm64(又名aarch 64)rpm。</p><p id="9360" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让PHP8在arm64(和OL8)上运行有几个选项:</p><ol class=""><li id="fd5e" class="ki kj hh iw b ix iy jb jc jf kk jj kl jn km jr kn ko kp kq bi translated">使用预构建的RPM安装</li><li id="193f" class="ki kj hh iw b ix kr jb ks jf kt jj ku jn kv jr kn ko kp kq bi translated">从源代码编译</li></ol><h1 id="63ce" class="kw kd hh bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">选项1 —按RPM安装</h1><p id="28b7" class="pw-post-body-paragraph iu iv hh iw b ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn lx jp jq jr ha bi translated">选项1听起来是一个很棒的主意，除了没有一个众所周知的、可信的预构建RPM的来源(至少在我写这篇文章的时候是这样)。去找一个不可信的第三方RPM提供商可能会让人害怕，而且通常不是一个好主意。目前，这排除了这个选项。</p><h1 id="78f2" class="kw kd hh bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">选项2 —从源代码编译</h1><p id="6b0a" class="pw-post-body-paragraph iu iv hh iw b ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn lx jp jq jr ha bi translated">我们只能从源代码编译PHP8。这并不可怕。它只是比预先构建的RPM路线更复杂和更慢一些。下面是实现这一点的“简单方法”。</p><p id="5b6c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">您需要问问自己是否需要Apache。对于许多PHP应用程序来说，它们是基于网络的，需要一个网络服务器。Apache只是一个可以使用的web服务器(这是我在本文中挑选的)。请随意适应您的特定需求！</p><h1 id="0754" class="kw kd hh bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">使用阿帕奇</h1><p id="a339" class="pw-post-body-paragraph iu iv hh iw b ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn lx jp jq jr ha bi translated"><a class="ae it" href="https://www.php.net/manual/en/install.unix.apache2.php" rel="noopener ugc nofollow" target="_blank"> PHP文档</a>有说明，这是基于。从安装Apache开始:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="4ac0" class="kc kd hh jy b fi ke kf l kg kh">sudo dnf install -y httpd httpd-devel<br/>sudo systemctl start httpd</span></pre><p id="e7bd" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在打开所需的端口/协议:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="88a4" class="kc kd hh jy b fi ke kf l kg kh">sudo firewall-cmd --zone=public --add-port=80/tcp<br/>sudo systemctl restart firewalld</span></pre><p id="80d5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">请注意，您可能需要打开不同的端口。TCP/80通常用于未加密的HTTP(如果有的话，除了受控的简单测试之外，您真的不想使用它)。</p><p id="dfbd" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">从<a class="ae it" href="https://www.php.net/downloads" rel="noopener ugc nofollow" target="_blank">https://www.php.net/downloads</a>获得最新的PHP下载网址，并用它来代替我下面提供的网址(以确保你得到你需要的最新最好的版本):</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="e145" class="kc kd hh jy b fi ke kf l kg kh">wget <a class="ae it" href="https://www.php.net/distributions/php-8.1.4.tar.gz" rel="noopener ugc nofollow" target="_blank">https://www.php.net/distributions/php-8.1.4.tar.gz</a><br/>tar -xzvf php-8.1.4.tar.gz<br/>cd php-8.1.4</span></pre><p id="5845" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">显然，随着PHP URL的改变，文件名也会改变。您的里程数可能会有所不同，请确保引用正确的URL和文件名(因为这篇文章将会过时)！</p><p id="a1d0" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">接下来，让我们安装大量需要从源代码编译的开发工具:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="17da" class="kc kd hh jy b fi ke kf l kg kh">sudo dnf group install -y "Development Tools"<br/>sudo dnf install -y re2c bison autoconf make libtool ccache libxml2-devel sqlite-devel libxml2 sqlite sqlite-devel</span></pre><p id="3b55" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这将安装<em class="js">批</em>个软件包。这可能会减少很多，但除非你的存储空间非常紧张和/或互联网连接非常糟糕，这应该不是一个问题。</p><p id="10bd" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">现在我们准备编译和安装:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="e807" class="kc kd hh jy b fi ke kf l kg kh">./buildconf<br/>./configure --with-apxs2=$(which apxs) --enable-opcache<br/>make -j1 (should match number of cores - get via nproc)<br/>make TEST_PHP_ARGS=-j4 test (set -j to # cores)<br/>sudo make install</span></pre><p id="93b6" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">此时我们已经安装了PHP，但是Apache不知道。是时候告诉阿帕奇如何处理了。php文件。编辑(或创建)一个文件<em class="js">/etc/httpd/conf . modules . d/00-PHP . conf</em>(你需要sudo来做这件事——类似于<em class="js">sudo nano/etc/httpd/conf . modules . d/00-PHP . conf</em>或类似的东西)并将以下内容放入其中:</p><p id="1a95" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="js">/etc/httpd/conf . modules . d/00-PHP . conf:</em></p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="e9bb" class="kc kd hh jy b fi ke kf l kg kh">&lt;FilesMatch \.php$&gt;<br/>    SetHandler application/x-httpd-php<br/>&lt;/FilesMatch&gt;</span></pre><p id="0a19" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">接下来需要重启Apache:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="c767" class="kc kd hh jy b fi ke kf l kg kh">sudo systemctl restart httpd</span></pre><p id="c686" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">是时候进行测试并确保它正常工作了！为此，在<em class="js"> /var/www/html/index.php </em>处创建一个新文件，并将以下内容放入其中:</p><p id="c739" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="js">/var/www/html/index . PHP:</em></p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="b2aa" class="kc kd hh jy b fi ke kf l kg kh">&lt;html&gt;<br/>&lt;body&gt;<br/>&lt;h1&gt;&lt;?php print("Hello world!"); ?&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="458a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在你说之前…我知道。上面的HTML很恐怖，不完整(没有head标签等。).虽然它很短，但是它在浏览器中的表现很好！</p><p id="e0b7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">要查看它的运行情况，请使用您的网络浏览器查看<a class="ae it" rel="noopener ugc nofollow" target="_blank" href="/oracledevs/&lt;ip&gt;/index.php">http://&lt;IP&gt;/index . PHP</a>。这并不花哨，但它确实向我们展示了PHP与Apache配合得很好(呈现“Hello world！”屏幕上的文本)。</p><p id="2fc5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果你只需要PHP，而不需要Apache呢？很高兴你问了。这就是我们接下来要讨论的…</p><h1 id="1530" class="kw kd hh bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">没有阿帕奇</h1><p id="04f6" class="pw-post-body-paragraph iu iv hh iw b ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn lx jp jq jr ha bi translated">从从<a class="ae it" href="https://www.php.net/downloads" rel="noopener ugc nofollow" target="_blank">https://www.php.net/downloads</a>获得最新的PHP下载网址开始，用它代替下面的网址(确保你得到你需要的最新最好的版本):</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="de50" class="kc kd hh jy b fi ke kf l kg kh">wget <a class="ae it" href="https://www.php.net/distributions/php-8.1.4.tar.gz" rel="noopener ugc nofollow" target="_blank">https://www.php.net/distributions/php-8.1.4.tar.gz</a><br/>tar -xzvf php-8.1.4.tar.gz<br/>cd php-8.1.4</span></pre><p id="4395" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">就像Apache安装一样，您需要使用正确的(更新的)URL和文件名！</p><p id="598e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">继续安装从源代码编译所需的许多开发工具:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="c8f3" class="kc kd hh jy b fi ke kf l kg kh">sudo dnf group install -y "Development Tools"<br/>sudo dnf install -y re2c bison autoconf make libtool ccache libxml2-devel sqlite-devel libxml2 sqlite sqlite-devel</span></pre><p id="d082" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这是“懒惰”的做法。Gcc和friends(以及其他需要的编译器)可以单独安装，可能会节省一点时间、存储和带宽。但由于存储和带宽相对便宜且高度可用，我选择了简单/懒惰的路线。</p><p id="ce99" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">让我们编译并安装PHP:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="cca6" class="kc kd hh jy b fi ke kf l kg kh">./buildconf<br/>./configure<br/>make -j1 (should match number of cores - get via nproc)<br/>make TEST_PHP_ARGS=-j4 test (set -j to # cores)<br/>sudo make install</span></pre><p id="4f4a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">瞧啊。我们成功了。PHP已经安装好了，可以开始编写脚本了。</p><h1 id="d8d1" class="kw kd hh bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">作为一个容器</h1><p id="b23c" class="pw-post-body-paragraph iu iv hh iw b ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn lx jp jq jr ha bi translated">有时候我们想在容器中部署一个PHP8应用程序。这里有一个docker文件，您可能会觉得有帮助(同样，请确保更新最新的URL和文件名):</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="a3b1" class="kc kd hh jy b fi ke kf l kg kh">ARG TARGETPLATFORM<br/>FROM --platform=$TARGETPLATFORM oraclelinux:8-slim<br/>RUN dnf update -y &amp;&amp; dnf groupinstall "Development Tools" &amp;&amp; dnf install -y sqlite sqlite-devel libxml2-devel libxml2 httpd httpd-devel<br/>RUN cd /tmp &amp;&amp; \<br/>  wget -O /tmp/php-8.1.5.tar.gz <a class="ae it" href="https://www.php.net/distributions/php-8.1.5.tar.gz" rel="noopener ugc nofollow" target="_blank">https://www.php.net/distributions/php-8.1.5.tar.gz</a> &amp;&amp; \<br/>  tar -xzvf /tmp/php-8.1.5.tar.gz -C /tmp &amp;&amp; \<br/>  cd /tmp/php-8.1.5 &amp;&amp; \<br/>  make clean &amp;&amp; \<br/>  ./buildconf &amp;&amp; \<br/>  ./configure --with-apxs2=$(which apxs) --enable-opcache &amp;&amp; \<br/>  make &amp;&amp; \<br/>  make install<br/>RUN printf '&lt;html&gt;\n&lt;body&gt;\n&lt;h1&gt;&lt;?php print("Hello world!"); ?&gt;\n&lt;/body&gt;\n&lt;/html&gt;' &gt; /var/www/html/index.php &amp;&amp; \<br/>  printf '&lt;FilesMatch \.php$&gt;\n    SetHandler application/x-httpd-php\n&lt;/FilesMatch&gt;' &gt; /etc/httpd/conf.modules.d/00-php.conf<br/>RUN systemctl restart httpd<br/>RUN firewall-cmd --zone=public --add-port=80/tcp<br/>RUN systemctl restart firewalld<br/> <br/>EXPOSE 80/tcp<br/>ENTRYPOINT []<br/>CMD []</span></pre><p id="46da" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">注意构建参数<em class="js"> TARGETPLATFORM </em>是如何使用的。这允许您轻松地为不同的体系结构构建容器。假设您在amd64(又名x86_64)系统上，想要为arm64(又名aarch64)构建一个容器映像。这可以通过以下方式实现:</p><pre class="jt ju jv jw fd jx jy jz ka aw kb bi"><span id="8fe8" class="kc kd hh jy b fi ke kf l kg kh">docker build --build-arg TARGETPLATFORM=linux/arm64 -t php8_ol8:latest .</span></pre><p id="980b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">多酷啊。！是啊，我也喜欢！</p><h1 id="98a1" class="kw kd hh bd kx ky kz la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls bi translated">结论</h1><p id="dedf" class="pw-post-body-paragraph iu iv hh iw b ix lt iz ja jb lu jd je jf lv jh ji jj lw jl jm jn lx jp jq jr ha bi translated">我们经历了一段美好的旅程。我们现在有办法在运行Oracle Linux 8的Arm (A1) OCI实例上轻松运行PHP8。拥有针对实例和容器工作负载的解决方案意味着我们可以灵活地处理遇到的任何问题！保持位流，直到下一次…</p><p id="cfb8" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">想讨论一下吗？<a class="ae it" href="https://bit.ly/devrel_slack" rel="noopener ugc nofollow" target="_blank">加入我们的Slack频道</a>，与其他开发者交流！</p></div></div>    
</body>
</html>