<html>
<head>
<title>Building Pin cohesion</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">建立引脚内聚力</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/building-pin-cohesion-229c19fc617e?source=collection_archive---------0-----------------------#2019-03-28">https://medium.com/pinterest-engineering/building-pin-cohesion-229c19fc617e?source=collection_archive---------0-----------------------#2019-03-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="2a84" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">张文科，张向阳，曾庆龙，安德烈<br/> Pinterest工程，内容质量</p><p id="3fde" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在Pinterest，我们正在建立一个视觉发现引擎，通过链接到更多信息，想法变得可行。一旦保存Pin，其链接内容可能会随着时间的推移而更新或过期，因此了解Pin背后的链接页面的质量以改善点击体验至关重要。在本帖中，我们将讨论如何构建基于Spark和TensorFlow的ML管道来计算Pin和链接页面相关性信号。</p><h1 id="f3e6" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">概观</h1><p id="e88a" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">Pinterest拥有来自Pinners的数十亿个图钉(图片是视觉书签)。为了保持现场和非现场内容的一致性，我们每天递增地重新索引web文档，并获取信号来测量Pin和链接页面之间的相关性。我们依靠嵌入的图像和文本内容来衡量视觉和语义的相似性。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kf"><img src="../Images/b9648373f69596d4d59083ce9f8c2dac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KmMzWA5ipNfNQsoTdsbY2Q.png"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx"><strong class="bd je">Figure 1.</strong> Example of related and unrelated pin and web page</figcaption></figure><p id="b4b0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该系统被分解为:文本内聚信号，其比较Pin的显著关键词和来自其链接的网页的文本内容；图像内聚信号，其检测现场和非现场图像之间的图像相似性；图像-文本内聚信号，其利用视觉分类器比较图像和文本；最后，混合分类器将这些信号合并成Pin和登录页面内容之间的接近度的单一度量。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kv"><img src="../Images/956197c3d42c040b10252a8023f2a8e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TwH-qZEDLj-y28XAY935DA.png"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx"><strong class="bd je">Figure 2.</strong> Pin cohesion signal overview</figcaption></figure><h1 id="240e" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">文本相关性</h1><p id="1f8c" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">文本相关性是页面凝聚力的重要标志。直觉上，我们希望看到一个Pin的网页与其语义相匹配。例如，如果我们在标题为“白色沙发”的名为“现代家具”的板上看到一个大头针，我们可能会希望看到它链接到一个家庭装饰产品的零售网站。为了测量这种相似性，我们提取现场和场外文本信号，并在文本嵌入空间中进行比较。</p><p id="d214" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当人们将管脚保存到他们的板上时，由于人工管理的内容，例如板名、管脚的标题和描述等等，我们可以对管脚周围的环境有所了解。这些信号通常足够丰富，我们可以为每个Pin生成文本标签，在计算文本相关度时用作现场文本信号。至于站外信号，我们需要知道网页在说什么。虽然我们可以从HTML中获得大量的内容类型，但我们主要关注页面的标题、描述和正文。标题和描述字段通常传达了网页中最重要的主题，而提取正文给了我们更精确的主题细节。在收集原始文本数据后，我们对它们进行标记化，并用Okapi BM25算法对标记进行评分。与经典的TF-IDF算法相比，BM25算法能更好地消除不同文本长度的差异，并限制常见术语出现次数过多的影响。我们还维护一个本地网页语料库，以确保关键字质量。例如，“免费送货”和“隐私政策”等特定于网站的词更有可能出现在网页上，因此IDF得分较低。通过关键词提取，我们可以将一个链接的文本内容总结为一个文本标签列表，作为我们的非现场文本信号。</p><p id="ad9e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，我们在嵌入空间中比较现场和非现场文本信号，其中文本被表示为向量，并且语义相似的短语将彼此接近。将我们提取的文本信号映射到连续向量空间，我们可以通过计算两者的余弦相似度来推断Pin信息与其链接之间的文本相关度。</p><h1 id="c8fd" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">图像关联性</h1><p id="390b" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">在我们当前的模型下，图像相关度信号由两个子成分组成:<strong class="ig hi">图像</strong> <strong class="ig hi">视觉相似度</strong>和<strong class="ig hi">图像</strong> <strong class="ig hi">语义相似度</strong>。</p><p id="7ec2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">图像视觉相似性是一个原始信号，我们设计它来回答这样一个问题:我们是否可以在网页上找到一个看起来与保存在Pinterest上的图像相似的图像。我们可以通过计算大头针图像与其网页中的每张图像之间的视觉相似性来解决这个问题，然后取最大值。为了实现高精度和高召回率，我们利用一个训练有素的图像相似重复检测模型来预测图像对的视觉相似性得分。该模型是一个张量流前馈神经网络，它利用了视觉嵌入的迁移学习。更多细节可以在<a class="ae kw" rel="noopener" href="/@Pinterest_Engineering/detecting-image-similarity-using-spark-lsh-and-tensorflow-618636afc939">这篇博客</a>中找到。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="er es kx"><img src="../Images/33e49b5355875133585a7000780dd9bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MmdEhaj1wfgDuVL7s5sLpg.png"/></div></div><figcaption class="kr ks et er es kt ku bd b be z dx"><strong class="bd je">Figure 3.</strong> Example of semantic-related Image Pair</figcaption></figure><figure class="kg kh ki kj fd kk er es paragraph-image"><div class="er es ky"><img src="../Images/899477472f8a092d46e6255d0ee5ec33.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/0*yBpZKFspPtpkiEna"/></div><figcaption class="kr ks et er es kt ku bd b be z dx"><strong class="bd je">Figure 4. </strong>Image Classification: “audrey hepburn style”, “1950s fashion”</figcaption></figure><p id="8e00" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然而，视觉相似性检测的失败并不一定意味着图像不连贯。例如，图3中的这两个图像看起来完全不同，但都显示了相同的产品(一辆白色的三层金属手推车)，应该被认为是一个紧密的组合。因此，我们构建了另一个原始信号，通过将图像转换为文本注释来捕获图像语义相似性。这个图像到文本模型是通过训练图像到文本注释分类器来开发的。我们集成了一个视觉模型，该模型将一幅图像分类到去年流量最大的10K搜索查询中，如图4所示。图像特征是使用度量学习训练的视觉嵌入，该度量学习优化了Pinterest的各种视觉任务。搜索查询首先被过滤以去除流行的拼写错误和趋势查询，并且被二进制编码以用于训练。参与最多的Pin映像将被删除重复，并被视为每个类别的正样本。分类器模型包含两个完全连接的层，并被训练以优化sigmoid交叉熵损失。随着图像被转换成预测的文本注释，我们可以容易地判断图像语义相似性，就像文本相关度一样，其中我们在文本嵌入空间中比较现场和非现场文本信号。</p><h1 id="ce70" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">图像和文本的关联性</h1><p id="fc80" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">使用Pinterest视觉搜索，图像通常是用户浏览内容时的焦点，而当用户想要深入了解他们感兴趣的特定内容时，文本更具信息性和可操作性。因此，了解图片和文本在大头针和它的链接页面之间的对齐情况也很重要。</p><p id="9bb3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们目前使用两种方法来比较图像和文本:图像分类和光学字符识别(OCR)。首先，我们重用前面讨论的分类器将图像转换为文本，但是将输出的文本注释与链接页面文本进行比较。其次，我们看到许多大头针图像包含突出链接网页的文本，尤其是那些为Pinterest设计的高质量原生创建者大头针。我们利用OCR技术从图像中提取文本以获得Pin的描述信息。一旦我们将图像映射到文本，我们就使用文本嵌入来比较图像和文本的相似性，如前一节所述。</p><figure class="kg kh ki kj fd kk er es paragraph-image"><div class="er es kz"><img src="../Images/8d19112b8160966aab0cbeabfef5b4e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:908/format:webp/1*K9Ea4qsB5AQnd_05jZ9yyA.png"/></div><figcaption class="kr ks et er es kt ku bd b be z dx"><strong class="bd je">Figure 5.</strong> OCR</figcaption></figure><p id="8c45" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后一组原始信号包括:</p><ul class=""><li id="9335" class="la lb hh ig b ih ii il im ip lc it ld ix le jb lf lg lh li bi translated">文本相关度得分，用于衡量Pin的人为关键词是否与链接的文本内容相关</li><li id="f0b2" class="la lb hh ig b ih lj il lk ip ll it lm ix ln jb lf lg lh li bi translated">图像相关度分数，用于测量Pin和链接页面图像之间的图像视觉和语义相似性，以了解网页是否包含相关主题和样式的图像</li><li id="cc3c" class="la lb hh ig b ih lj il lk ip ll it lm ix ln jb lf lg lh li bi translated">衡量链接的文本内容是否与大头针图像主题互补的图像-文本相关度分数</li><li id="073c" class="la lb hh ig b ih lj il lk ip ll it lm ix ln jb lf lg lh li bi translated">文本-图像相关度得分，用于衡量链接的图像是否与其从网站文本内容中提取的关键词相关</li></ul><p id="bd9e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在所有信号就绪的情况下，我们在人工标记的gold数据集上构建了一个二元分类器，以确定总体Pin内聚力。</p><h1 id="8b30" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">结论</h1><p id="82a5" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">我们建立了引脚内聚信号来衡量引脚和链接页面的相似性。由于Pin cohesion，自2018年11月以来，我们已经看到搜索和参与度方面的指标增长。这种信号为搜索、推荐和首页feed表面提供动力，作为排名信号，以提高Pinterest上的内容质量，并带动网站外的流量。</p><h2 id="a132" class="lo jd hh bd je lp lq lr ji ls lt lu jm ip lv lw jq it lx ly ju ix lz ma jy mb bi translated">承认</h2><p id="92d1" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">Pin cohesion是Pinterest中的一个合作项目。特别感谢我们的实习生和以下团队成员: <em class="mc"> Peter John Daoud、Renju Liu、Nick DeChant、、Omkar Panhalkar、</em>、<em class="mc">、、Heath Vinicombe、Vincent Bannister、Jacob Hanger和李卓远，感谢他们对本项目的所有贡献。</em></p></div></div>    
</body>
</html>