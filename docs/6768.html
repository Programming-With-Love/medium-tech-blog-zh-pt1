<html>
<head>
<title>Authentication with JWT</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">向JWT认证</h1>
<blockquote>原文：<a href="https://medium.com/quick-code/authentication-with-jwt-969d612699de?source=collection_archive---------8-----------------------#2019-12-17">https://medium.com/quick-code/authentication-with-jwt-969d612699de?source=collection_archive---------8-----------------------#2019-12-17</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="86a1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">通常情况下，您希望保护站点的路由，以保护用户的数据和敏感信息。在这种情况下，jsonwebtoken(通常称为JWT)就派上了用场。</p><p id="b691" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">把JWT想象成你参加会议或活动的通行证，你只需填写一次表格。然后组织者给你一张通行证，只要你在会场里，你就可以用它进入会场的许多地方。</p><p id="988d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">JWT的工作方式类似。您的用户登录到您的应用程序。然后，JWT为该用户生成一个令牌，只要您的用户在应用程序中，并且没有注销，就可以使用该令牌访问该应用程序的特权部分。我们将很快讨论它的技术方面。</p><p id="9499" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你可以用许多编程语言实现JWT。在这里，我将使用NodeJS进行演示。如果你想尝试这篇文章中的例子，那么用“npm init -y”创建一个示例项目，然后执行“npm install jsonwebtoken”并返回。</p><p id="03ec" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">JWT的工作方式是，当你的用户登录到你的网站时，它会创建一个包含该用户信息的长字符串令牌。您可以在该令牌中存储任何内容，如user_id、电子邮件或名称。大多数情况下，user_id就足够了。然后，每次你路由到你的网站的不同部分，它会检查令牌是否存在，是否有效。如果不是，你会被踢出网站。通常，您希望将令牌存储在应用程序的客户端，并设置一个到期时间来保证安全性。此外，您希望避免将令牌存储在数据库中。</p><p id="c91e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们写一些假设的代码。顺便说一句，这个演示的目的是让你知道如何在你自己的项目中实现它，而不是一步一步地指导你如何在真实世界的应用程序中实现JWT，因为那样太麻烦了，而且实际上会破坏你理解JWT的目的。好了，现在回到代码</p><pre class="jc jd je jf fd jg jh ji jj aw jk bi"><span id="0424" class="jl jm hh jh b fi jn jo l jp jq">const jwt = require('jsonwebtoken')<br/>​<br/>const user = {<br/>   id: '0123',<br/>   name: 'max',<br/>   email: '<a class="ae jr" href="mailto:max@gmail.com" rel="noopener ugc nofollow" target="_blank">max@gmail.com</a>',<br/>   password: '7235723867'<br/>​<br/>}<br/>​</span></pre><p id="5546" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">假设您的数据库中有一个用户拥有上述信息。当用户使用他们的电子邮件和密码登录时。您的站点使用该用户的id生成一个令牌，并将其存储在客户端的某个地方。</p><pre class="jc jd je jf fd jg jh ji jj aw jk bi"><span id="161f" class="jl jm hh jh b fi jn jo l jp jq">const token = jwt.sign({id: user.id}, 'secretKey')<br/>console.log('JWT Token: '+token)</span></pre><p id="2e8b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">关于如何储存JWT，有很多观点。在决定什么是最适合您的应用程序之前，您应该做一些研究。</p><p id="42b4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">生成令牌后，您的站点会验证令牌。</p><pre class="jc jd je jf fd jg jh ji jj aw jk bi"><span id="241e" class="jl jm hh jh b fi jn jo l jp jq">const verifiedToken = jwt.verify(token, 'secretKey')<br/>console.log('User ID: '+verifiedToken.id)</span></pre><p id="0b1b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从那时起，直到用户试图访问任何受保护路由时注销或令牌过期事件；您的站点检查该令牌的有效性，然后授予访问权限。</p><p id="548d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">验证令牌后，您可以从令牌中访问用户的id，然后您可以编写查询来从数据库中获取有关该用户的所有信息。</p><p id="90fa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">正如您所看到的，jwt.sign()和jwt.verify()都至少有两个参数。先解剖jwt.sign()吧。</p><p id="cde4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">jwt.sign()的第一个参数是一个有效负载，它将存储在令牌中。它可以是字符串或对象。在这里，我传递一个以用户id为有效负载的对象，第二个参数是一个secretKey，它是一个字符串，将用于为您的令牌创建数字签名。如果你想了解更多关于数字签名或者JWT令牌是如何制作的，你可以查看他们自己的文档<a class="ae jr" href="https://jwt.io/" rel="noopener ugc nofollow" target="_blank">这里</a>。顺便说一句，你不应该像上面的例子那样存储密钥。您应该将它保存在源代码之外的环境变量中。</p><p id="d37f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">与jwt.sign()方法类似，jwt.verify()也需要您的secretKey来验证您的令牌。但是jwt.verify()方法中的第一个参数是令牌本身。</p><p id="2458" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以使用JWT设置其他选项。如果你想在NodeJS中实现它们，你可以查看<a class="ae jr" href="https://www.npmjs.com/package/jsonwebtoken" rel="noopener ugc nofollow" target="_blank">这个</a>来获得更多关于JWT的NodeJS实现的细节。</p><p id="e93a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">仅此而已。希望这能让您对JWT及其有用性有所了解，这样您就可以在自己的站点中使用它们，使其更加健壮和安全。</p></div></div>    
</body>
</html>