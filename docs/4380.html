<html>
<head>
<title>Seeing What TalkBack Sees 🔍</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">看到对讲看到的🔍</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/seeing-what-talkback-sees-181b3dfa95e8?source=collection_archive---------2-----------------------#2021-09-13">https://medium.com/google-developer-experts/seeing-what-talkback-sees-181b3dfa95e8?source=collection_archive---------2-----------------------#2021-09-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/7b7794afc94df4a33dd6658220422ecd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iO0tQbpSxXHGUCCV"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo by <a class="ae it" href="https://unsplash.com/@supernov?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Edi Libedinsky</a> on <a class="ae it" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="0bce" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">作为Android开发者，我们应该做的事情之一是确保我们的应用程序尽可能地易于访问。有很多演讲和文章讨论当前MDC a11y支持背后的<a class="ae it" href="https://youtu.be/nTNwZXVRGdY" rel="noopener ugc nofollow" target="_blank">动机、</a><a class="ae it" href="https://youtu.be/bTodlNvQGfY" rel="noopener ugc nofollow" target="_blank">到</a><a class="ae it" href="https://youtu.be/1by5J7c5Vz4" rel="noopener ugc nofollow" target="_blank">支持a11y的</a>、<a class="ae it" href="https://developer.android.com/guide/topics/ui/accessibility/testing" rel="noopener ugc nofollow" target="_blank">测试概述</a>，甚至<a class="ae it" href="https://developer.android.com/guide/topics/ui/accessibility/service" rel="noopener ugc nofollow" target="_blank">创建自己的a11y服务</a>！</p><p id="2ed4" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">有很多资源告诉我应该做什么，但我发现非常缺乏的是在出现问题时帮助我找出该做什么的信息(而且了解我，总会有事情出错)。</p><p id="1d30" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">例如，这是我的应用程序主页的上半部分。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es js"><img src="../Images/0330c9d997bdd33fee1e5768f06e5d31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NRDa7r6emLpVQtLJeAV8Kw.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">TalkBack says “2 items in cart”</figcaption></figure><p id="d1bd" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">当cart action菜单项被聚焦时，我们希望TalkBack能够宣布购物车中当前有多少商品。然而，我注意到，有时TalkBack会在宣布“购物车中有2件商品”后，突然说出数字(而且只是数字)。奇怪！</p><p id="a830" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果我能深入了解对讲“看到”了什么，我就能找出解决问题的方法，让我们的对讲公告不那么混乱。我还没有在官方的Android文档中找到任何关于如何做到这一点的提及，完全是出于运气，我偶然发现了这个 ✨ <a class="ae it" href="https://withintent.uncorkedstudios.com/tutorial-debugging-android-accessibility-818cfd361414" rel="noopener ugc nofollow" target="_blank">惊人的</a> ✨ <a class="ae it" href="https://withintent.uncorkedstudios.com/tutorial-debugging-android-accessibility-818cfd361414" rel="noopener ugc nofollow" target="_blank">文章</a>作者<a class="ae it" rel="noopener" href="/@midori.bowen"> Midori Bowen </a>来自2018(！).</p><h1 id="4a07" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">等等，什么！😻</h1><p id="62a0" class="pw-post-body-paragraph iu iv hh iw b ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn kz jp jq jr ha bi translated">原来在TalkBack的开发者设置深处有一个“启用节点树调试”的选项。美岛莉链接到关于启用这一设置的Android文档，但该页面已被删除。😿</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es js"><img src="../Images/8c433f7377e1acc23ff31780517b488d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZIxuOEyk976bwcnm.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Turn it on! (While you’re there, turn on “Display speech output” as well if you prefer. This will put up a <code class="du la lb lc ld b">Toast</code> of the TalkBack announcements)</figcaption></figure><p id="dc90" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这里提到的“节点树”基本上就是TalkBack如何解释你的视图层次结构。拥有这方面的可见性肯定会让我们更深入地了解幕后发生了什么。</p><p id="b3d4" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><a class="ae it" href="https://withintent.uncorkedstudios.com/tutorial-debugging-android-accessibility-818cfd361414" rel="noopener ugc nofollow" target="_blank">按照OG帖子中概述的步骤</a>启用节点树调试。自从美岛莉的文章发表以来，Android和TalkBack中的一些东西已经发生了变化，但是总的来说，这些步骤会让你知道如何启用日志功能。例如，不再寻找“未分配”，可分配的手势现在副标题为“点击分配”。在某些设备上，TalkBack允许多手指手势，因此有很多选项可以用来触发节点树日志转储。如果一个手势已经有一个动作，如果您愿意，您仍然可以覆盖它。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es le"><img src="../Images/897a5d0458d937b7ff29266058d16f1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0VbAOZw0-VFHQMMn.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">I settled on “Tap with 3 fingers”</figcaption></figure><h1 id="a4dd" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">这是什么？🤔</h1><p id="fa2d" class="pw-post-body-paragraph iu iv hh iw b ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn kz jp jq jr ha bi translated">我们现在可以通过使用我们在TalkBack中设置的手势来触发任何屏幕上的节点树的转储。</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es js"><img src="../Images/61eb7b36a5d1b205de5730f24e4df53c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4u8TeX5sjnMXJBz7.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">TalkBack will tell you it has been done</figcaption></figure><p id="1fc2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在这一点上，我想重申，请不要像我一样，花一个小时寻找日志实际上在哪里(我忘了我有Logcat过滤器🤦‍♀).它们<em class="lf">是Logcat中的</em>，标签为<code class="du la lb lc ld b">TreeDebug</code>。</p><p id="89f1" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">下面是节点树的部分输出(去掉了冗长的时间戳):</p><figure class="jt ju jv jw fd ii"><div class="bz dy l di"><div class="lg lh l"/></div></figure><p id="8697" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">前几行(第2–9行)与状态栏相关，所以我们忽略它。我们的应用程序的内容从第10行(<code class="du la lb lc ld b">type=TYPE_APPLICATION</code>)开始，屏幕上的所有视图都在下面几行中。每个<code class="du la lb lc ld b">ViewGroup</code>都是选项卡式的，这对于弄清楚每个节点如何映射到视图层次结构非常有帮助。这里有很多信息，而且自从美岛莉的帖子以来，有些事情已经发生了变化，所以我想回顾一下我们在日志中可以看到的东西会是很好的。让我们以第18行为例:</p><pre class="jt ju jv jw fd li ld lj lk aw ll bi"><span id="5d68" class="lm jy hh ld b fi ln lo l lp lq">(1100966)652.Switch:(668, 225 - 800, 357):CONTENT{See only Specials}:STATE{OFF}:not checked(action:FOCUS/A11Y_FOCUS/CLICK):focusable:clickable</span></pre><figure class="jt ju jv jw fd ii"><div class="bz dy l di"><div class="lg lh l"/></div></figure><p id="9a6f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">屏幕<em class="lf">是</em>实际上是一个<code class="du la lb lc ld b">RecyclerView</code>，所以让我们也来看看我们接收到了什么信息:</p><figure class="jt ju jv jw fd ii"><div class="bz dy l di"><div class="lg lh l"/></div></figure><p id="af5f" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在...结束时:</p><figure class="jt ju jv jw fd ii"><div class="bz dy l di"><div class="lg lh l"/></div></figure><p id="c2a2" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我能够从<a class="ae it" href="https://github.com/google/talkback/blob/f5d564fdc915a74d8cde4868608f307de9ccf957/utils/src/main/java/com/google/android/accessibility/utils/TreeDebug.java" rel="noopener ugc nofollow" target="_blank">日志树文件</a>的<a class="ae it" href="https://github.com/google/talkback" rel="noopener ugc nofollow" target="_blank">反馈报告</a>中收集所有这些信息。</p><p id="b494" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">注意，除了记录节点树，TalkBack还记录遍历顺序，这在试图找出屏幕上元素获得焦点的顺序时可能很有用。</p><h1 id="9cfd" class="jx jy hh bd jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku bi translated">解决我们的问题…也许👀</h1><p id="6fbf" class="pw-post-body-paragraph iu iv hh iw b ix kv iz ja jb kw jd je jf kx jh ji jj ky jl jm jn kz jp jq jr ha bi translated">回到我们最初的问题，节点树给了我们一个线索(购物车菜单项在我的应用程序的大多数屏幕中):</p><pre class="jt ju jv jw fd li ld lj lk aw ll bi"><span id="11e8" class="lm jy hh ld b fi ln lo l lp lq">(1094239)652.ViewGroup:(948, 77 - 1080, 209):CONTENT{Cart: 2 items in Cart}(action:FOCUS/A11Y_FOCUS/CLICK):focusable:clickable<br/>  (1095200)652.TextView:(1008, 107 - 1023, 140):TEXT{2}(action:A11Y_FOCUS):supportsTextLocation</span></pre><p id="ec5e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">啊哈！看起来<code class="du la lb lc ld b">ViewGroup</code>作为一个整体和<code class="du la lb lc ld b">TextView</code>本身都可以有焦点(看起来<code class="du la lb lc ld b">TextView</code>本身没有<code class="du la lb lc ld b">CONTENT</code>的值，这是TalkBack宣布的)，这<em class="lf">可以</em>解释为什么我有时只听到数字吗？</p><p id="b0be" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我想我仍然没有一个明确的答案，但是在<code class="du la lb lc ld b">TextView</code>上设置<code class="du la lb lc ld b">android:importantForAccessibility="no"</code>应该不会有问题，因为当<code class="du la lb lc ld b">ViewGroup</code>获得焦点时，已经给了用户足够的上下文。</p></div><div class="ab cl lr ls go lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ha hb hc hd he"><p id="b4f5" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我希望随着越来越多的人成为a11y的盟友，我们也能在a11y工具上得到更多的关注，并有更多的技术文章专注于支持a11y超越基础。例如，您知道我们可以改变Talkback所说的内容，以提供更多可操作内容的上下文吗？例如，当选择此<code class="du la lb lc ld b">ViewGroup</code>时:</p><figure class="jt ju jv jw fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es js"><img src="../Images/9d53519a0c12801e994cedc1ffa137f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1pCZLvwvzJtji-6k9pCBLA.png"/></div></div></figure><p id="d1cf" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">双击会将用户带到编辑商店或送货地址屏幕</p><p id="bdaa" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">对讲将宣布“双击更改”，而不是默认的“双击激活”。前者为用户提供了更多的上下文，让他们知道在与元素交互时会发生什么。仔细想想，这是我们下一个a11y帖子的好主意！到时候见！👌</p></div><div class="ab cl lr ls go lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ha hb hc hd he"><p id="88a0" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="lf">最初发布于2021年9月13日</em><a class="ae it" href="https://zarah.dev/2021/09/13/debugging-accessibility.html" rel="noopener ugc nofollow" target="_blank"><em class="lf">https://zarah . dev</em></a><em class="lf">。</em></p></div></div>    
</body>
</html>