<html>
<head>
<title>Node.js RESTful API with DynamoDB Local</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">带有DynamoDB Local的Node.js RESTful API</h1>
<blockquote>原文：<a href="https://medium.com/quick-code/node-js-restful-api-with-dynamodb-local-7e342a934a24?source=collection_archive---------0-----------------------#2018-02-01">https://medium.com/quick-code/node-js-restful-api-with-dynamodb-local-7e342a934a24?source=collection_archive---------0-----------------------#2018-02-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/dc3c704fb9b93c254dd882f97dd9b809.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ejTEhVznAjlYSXsWz5zZ7A.png"/></div></div></figure><div class=""/><p id="6047" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Node通常在<strong class="ir ht"> MEAN </strong>栈中与MongoDB一起使用。然而，使用Amazon的DynamoDB有它自己的好处，尤其是在速度、可伸缩性、可负担性以及将您的时间从配置数据库集群/更新中解放出来。通过这篇文章，我将讨论如何在本地用你的节点项目设置DynamoDB。</p><h2 id="3cc0" class="jn jo hs bd jp jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh bi translated">版本</h2><ul class=""><li id="3210" class="ki kj hs ir b is kk iw kl ja km je kn ji ko jm kp kq kr ks bi translated">节点9.2.1</li><li id="f40f" class="ki kj hs ir b is kt iw ku ja kv je kw ji kx jm kp kq kr ks bi translated">特快4.15.5</li><li id="602d" class="ki kj hs ir b is kt iw ku ja kv je kw ji kx jm kp kq kr ks bi translated">DynamoDB Local — <a class="ae ky" href="https://s3.eu-central-1.amazonaws.com/dynamodb-local-frankfurt/dynamodb_local_latest.tar.gz" rel="noopener ugc nofollow" target="_blank">最新</a></li><li id="6a2e" class="ki kj hs ir b is kt iw ku ja kv je kw ji kx jm kp kq kr ks bi translated"><a class="ae ky" href="http://www.oracle.com/technetwork/java/javase/downloads/jre8-downloads-2133155.html" rel="noopener ugc nofollow" target="_blank"> JRE </a> (Java运行时环境)6.x或更新版本</li></ul></div><div class="ab cl kz la go lb" role="separator"><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le lf"/><span class="lc bw bk ld le"/></div><div class="ha hb hc hd he"><h2 id="ba15" class="jn jo hs bd jp jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh bi translated">设置节点项目</h2><p id="e417" class="pw-post-body-paragraph ip iq hs ir b is kk iu iv iw kl iy iz ja lg jc jd je lh jg jh ji li jk jl jm ha bi translated">为了让事情快速进展，我们将使用express generator为我们搭建一个项目。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="4390" class="jn jo hs lo b fi ls lt l lu lv"><strong class="lo ht">#bash</strong></span><span id="c664" class="jn jo hs lo b fi lw lt l lu lv">$ express node-dynamo-db<br/>   <br/>   create : node-dynamo-db<br/>   create : node-dynamo-db/package.json<br/>   create : node-dynamo-db/app.js<br/>   create : node-dynamo-db/public<br/>   create : node-dynamo-db/routes<br/>   create : node-dynamo-db/routes/index.js<br/>   create : node-dynamo-db/routes/users.js<br/>   create : node-dynamo-db/views<br/>   create : node-dynamo-db/views/index.jade<br/>   create : node-dynamo-db/views/layout.jade<br/>   create : node-dynamo-db/views/error.jade<br/>   create : node-dynamo-db/bin<br/>   create : node-dynamo-db/bin/www<br/>   create : node-dynamo-db/public/javascripts<br/>   create : node-dynamo-db/public/images<br/>   create : node-dynamo-db/public/stylesheets<br/>   create : node-dynamo-db/public/stylesheets/style.css</span><span id="0733" class="jn jo hs lo b fi lw lt l lu lv">install dependencies:<br/>     $ cd node-dynamo-db &amp;&amp; npm install</span><span id="dffb" class="jn jo hs lo b fi lw lt l lu lv">run the app:<br/>     $ DEBUG=node-dynamo-db:* npm start</span><span id="144c" class="jn jo hs lo b fi lw lt l lu lv">$ cd node-dynamo-db<br/>$ npm install</span></pre><p id="3540" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">启动您的服务器，确保一切正常运行。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="1ae8" class="jn jo hs lo b fi ls lt l lu lv">$ npm start</span></pre><p id="7dad" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">导航到<a class="ae ky" href="http://localhost:3000" rel="noopener ugc nofollow" target="_blank"> http://localhost:3000 </a>，您将看到来自express的欢迎页面，如下所示。</p><figure class="lj lk ll lm fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lx"><img src="../Images/3882503b50e02aa674a7d21e27e98d14.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t5zAKeNYDFMigF_oyNIUdA.png"/></div></div><figcaption class="ly lz et er es ma mb bd b be z dx">Generic Express Welcome Page</figcaption></figure><p id="8606" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">接下来，由于没有实时重新加载，我们将安装Nodemon来监视我们的文件，每当发生更改时，它将为我们重新启动服务器。没有Nodemon，你会很快变得沮丧。安装完成后，我们将更新<strong class="ir ht"> package.json </strong>中的<strong class="ir ht"> start </strong>命令，以运行<strong class="ir ht"> nodemon </strong>命令，而不是node。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="1cae" class="jn jo hs lo b fi ls lt l lu lv"><strong class="lo ht">#bash </strong></span><span id="6a82" class="jn jo hs lo b fi lw lt l lu lv">$ npm install -g nodemon</span><span id="9271" class="jn jo hs lo b fi lw lt l lu lv">--------------------------------------------------------------------</span><span id="878e" class="jn jo hs lo b fi lw lt l lu lv"><strong class="lo ht">#package.json </strong></span><span id="d4ef" class="jn jo hs lo b fi lw lt l lu lv">{<br/>  "name": "node-dynamo-db",<br/>  "version": "0.0.0",<br/>  "private": true,<br/>  "scripts": {<br/><strong class="lo ht">    "start": "nodemon  ./bin/www"<br/></strong>  },<br/>  "dependencies": {<br/>    "body-parser": "~1.18.2",<br/>    "cookie-parser": "~1.4.3",<br/>    "debug": "~2.6.9",<br/>    "express": "~4.15.5",<br/>    "jade": "~1.11.0",<br/>    "morgan": "~1.9.0",<br/>    "serve-favicon": "~2.4.5"<br/>  }<br/>}</span></pre><h2 id="800b" class="jn jo hs bd jp jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh bi translated">设置DynamoDB</h2><p id="b6b3" class="pw-post-body-paragraph ip iq hs ir b is kk iu iv iw kl iy iz ja lg jc jd je lh jg jh ji li jk jl jm ha bi translated">首先从上面的链接下载文件，解压并导航到目录。您会注意到DynamoDB是作为可执行文件提供的。jar文件。为了启动数据库，我们需要在。jar文件已定位。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="63cf" class="jn jo hs lo b fi ls lt l lu lv"><strong class="lo ht">#bash </strong></span><span id="7495" class="jn jo hs lo b fi lw lt l lu lv">$ <!-- -->java -Djava.library.path=./DynamoDBLocal_lib -jar DynamoDBLocal.jar -sharedDb</span><span id="931b" class="jn jo hs lo b fi lw lt l lu lv">Initializing DynamoDB Local with the following configuration:<br/>Port: 8000<br/>InMemory: false<br/>DbPath: null<br/>SharedDb: true<br/>shouldDelayTransientStatuses: false<br/>CorsParams: *</span></pre><p id="cbd4" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">嘣，您已经有了一个DynamoDB运行的本地实例！问题是，除非你有照相记忆的天赋，否则你很可能不会记住上面的命令，即使你记住了，每次都要写出来也是胡扯。让我们加快速度，在我们的<strong class="ir ht">中创建一个<a class="ae ky" rel="noopener" href="/@jameshamann/automation-with-cron-d10f7cbbb638">别名</a>命令。bashrc </strong>或<strong class="ir ht">。zshrc，</strong>看你用什么了。我的看起来像这样。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="728b" class="jn jo hs lo b fi ls lt l lu lv"><strong class="lo ht">#bash .zshrc or .bashrc</strong></span><span id="47ac" class="jn jo hs lo b fi lw lt l lu lv">alias ddb="cd path/to/dynamodb_local_latest &amp;&amp; java -Djava.library.path=./DynamoDBLocal_lib -jar DynamoDBLocal.jar -sharedDb"</span></pre><p id="4213" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我将我的别名命名为<strong class="ir ht"> ddb，</strong>，它导航到目录，然后执行。罐子，就这么简单。现在，当重新加载我的终端窗口并运行ddb时，DynamoDB应该旋转起来。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="1160" class="jn jo hs lo b fi ls lt l lu lv"><strong class="lo ht">#bash</strong></span><span id="8d3f" class="jn jo hs lo b fi lw lt l lu lv">$ ddb</span><span id="9aa3" class="jn jo hs lo b fi lw lt l lu lv">Initializing DynamoDB Local with the following configuration:<br/>Port: 8000<br/>InMemory: false<br/>DbPath: null<br/>SharedDb: true<br/>shouldDelayTransientStatuses: false<br/>CorsParams: *</span></pre><p id="76b4" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，我们已经准备好开始创建我们的表，并开始将一些数据植入我们的表中。为了这个演示的目的，我将制作一个围绕汽车的数据库。</p><p id="9486" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在继续之前，让我们更新一下我们的<strong class="ir ht"> package.json </strong>来自动化一些我们会经常运行的命令。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="8515" class="jn jo hs lo b fi ls lt l lu lv">{<br/>  "name": "crafty-api",<br/>  "version": "0.0.0",<br/>  "private": true,<br/>  "scripts": {<br/>   <strong class="lo ht"> "start": "nodemon app.js",<br/></strong>    <strong class="lo ht">"create-db": "cd dynamodb &amp;&amp; node createCarsTable.js &amp;&amp; cd ..",<br/>    "delete-db": "cd dynamodb &amp;&amp; node deleteCarsTable.js &amp;&amp; cd ..",<br/>    "load-data": "cd dynamodb &amp;&amp; node loadCarData.js &amp;&amp; cd ..", <br/>    "read-data": "cd dynamodb &amp;&amp; node readDataTest.js &amp;&amp; cd .."<br/></strong>  },<br/>  "dependencies": {<br/>    "aws-sdk": "^2.176.0",<br/>    "body-parser": "~1.18.2",<br/>    "cookie-parser": "~1.4.3",<br/>    "cors": "^2.8.4",<br/>    "debug": "~2.6.9",<br/>    "ejs": "^2.5.7",<br/>    "express": "~4.15.5",<br/>    "jade": "~1.11.0",<br/>    "morgan": "~1.9.0",<br/>    "newman": "^3.9.1",<br/>    "node-uuid": "^1.4.8",<br/>    "serve-favicon": "~2.4.5",<br/>    "uuid": "^3.2.1"<br/>  }<br/>}</span></pre><p id="0753" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这就是我目前的样子，它只是加快了很多事情，所以考虑添加您自己的工作流程，以加快您的工作流程。此外，对于初学者来说，<a class="ae ky" href="https://blog.coursesity.com/best-node-js-tutorials/" rel="noopener ugc nofollow" target="_blank">最佳Node.js教程</a>是学习Node.js编程的好方法。</p><p id="0732" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">首先，我们需要创建一个表并选择一个<strong class="ir ht">分区键。</strong>亚马逊提供了很好的建议<a class="ae ky" href="https://aws.amazon.com/blogs/database/choosing-the-right-dynamodb-partition-key/" rel="noopener ugc nofollow" target="_blank">这里</a>关于什么是好的密钥。我们需要一个键的原因是，Dynamo DB将我们的数据划分到多个存储单元，并使用这个键来存储和读取数据。因此，<strong class="ir ht">分区键必须是唯一值</strong>。用户标识和设备标识就是很好的例子。</p><p id="0237" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">对于我的表，我选择了<strong class="ir ht"> car_id。</strong></p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="9532" class="jn jo hs lo b fi ls lt l lu lv"><strong class="lo ht">#JavaScript - createCarsTable.js</strong></span><span id="0b62" class="jn jo hs lo b fi lw lt l lu lv">var AWS = require("aws-sdk");</span><span id="93f9" class="jn jo hs lo b fi lw lt l lu lv">AWS.config.update({<br/>  region: "eu-west-2",<br/>  endpoint: "<a class="ae ky" href="http://localhost:8000" rel="noopener ugc nofollow" target="_blank">http://localhost:8000</a>"<br/>});</span><span id="c2da" class="jn jo hs lo b fi lw lt l lu lv">var dynamodb = new AWS.DynamoDB();</span><span id="5cdb" class="jn jo hs lo b fi lw lt l lu lv">var params = {<br/>    TableName : "Cars",<br/>    KeySchema: [<br/>        { AttributeName: "id", KeyType: "HASH"}, <strong class="lo ht"> //Partition key</strong></span><span id="cdd5" class="jn jo hs lo b fi lw lt l lu lv">],<br/>    AttributeDefinitions: [<br/>        { AttributeName: "id", AttributeType: "N" },</span><span id="2c63" class="jn jo hs lo b fi lw lt l lu lv">],<br/>    ProvisionedThroughput: {<br/>        ReadCapacityUnits: 5,<br/>        WriteCapacityUnits: 5<br/>    }<br/>};</span><span id="29c9" class="jn jo hs lo b fi lw lt l lu lv">dynamodb.createTable(params, function(err, data) {<br/>    if (err) {<br/>        console.error("Unable to create table. Error JSON:", JSON.stringify(err, null, 2));<br/>    } else {<br/>        console.log("Created table. Table description JSON:", JSON.stringify(data, null, 2));<br/>    }<br/>});</span></pre><p id="f00a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在运行您的<strong class="ir ht"> create-db </strong>命令，确保Dynamo DB在另一个终端窗口的后台运行，端口8000。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="56fa" class="jn jo hs lo b fi ls lt l lu lv"><strong class="lo ht">#bash</strong></span><span id="381a" class="jn jo hs lo b fi lw lt l lu lv">yarn create-db<br/>yarn run v1.3.2<br/>$ cd dynamodb &amp;&amp; node createCarsTable.js &amp;&amp; cd ..<br/>Created table. Table description JSON: {<br/>  "TableDescription": {<br/>    "AttributeDefinitions": [<br/>      {<br/>        "AttributeName": "id",<br/>        "AttributeType": "N"<br/>      }<br/>    ],<br/>    "TableName": "Cars",<br/>    "KeySchema": [<br/>      {<br/>        "AttributeName": "id",<br/>        "KeyType": "HASH"<br/>      }<br/>    ],<br/>    "TableStatus": "ACTIVE",<br/>    "CreationDateTime": "2018-02-01T16:08:25.308Z",<br/>    "ProvisionedThroughput": {<br/>      "LastIncreaseDateTime": "1970-01-01T00:00:00.000Z",<br/>      "LastDecreaseDateTime": "1970-01-01T00:00:00.000Z",<br/>      "NumberOfDecreasesToday": 0,<br/>      "ReadCapacityUnits": 5,<br/>      "WriteCapacityUnits": 5<br/>    },<br/>    "TableSizeBytes": 0,<br/>    "ItemCount": 0,<br/>    "TableArn": "arn:aws:dynamodb:ddblocal:000000000000:table/Cars"<br/>  }<br/>}<br/>✨  Done in 0.47s.</span></pre><p id="49c7" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在您的表已经设置好了，可以将数据植入其中了。</p><p id="5e1a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这个例子中，我们使用Dynamo DB的<a class="ae ky" href="https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/DynamoDB.html#putItem-property" rel="noopener ugc nofollow" target="_blank"><strong class="ir ht">put item</strong></a><strong class="ir ht"/>方法将一些数据植入数据库。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="b45f" class="jn jo hs lo b fi ls lt l lu lv">#<strong class="lo ht">JSON - carData.json </strong></span><span id="fb44" class="jn jo hs lo b fi lw lt l lu lv">[<br/>  { "id": 1,<br/>    "type" : "Automatic",<br/>    "name" : "Toyota Yaris",<br/>    "manufacturer" : "Toyota",<br/>    "fuel_type" : "Petrol",<br/>    "description" : "A smooth ride"<br/>  },<br/>  { "id": 2,<br/>    "type" : "Manual",<br/>    "name" : "Volkswagen Golf",<br/>    "manufacturer" : "Volkswagen",<br/>    "fuel_type" : "Petrol",<br/>    "description" : "Good Value"<br/>  }<br/>]</span><span id="1478" class="jn jo hs lo b fi lw lt l lu lv">------------------------------------------------------------------</span><span id="d607" class="jn jo hs lo b fi lw lt l lu lv">#<strong class="lo ht">JavaScript - loadCarData.js</strong></span><span id="f1c9" class="jn jo hs lo b fi lw lt l lu lv">var AWS = require("aws-sdk");<br/>var fs = require('fs');</span><span id="2ad2" class="jn jo hs lo b fi lw lt l lu lv">AWS.config.update({<br/>    region: "eu-west-2",<br/>    endpoint: "<a class="ae ky" href="http://localhost:8000" rel="noopener ugc nofollow" target="_blank">http://localhost:8000</a>"<br/>});</span><span id="8683" class="jn jo hs lo b fi lw lt l lu lv">var docClient = new AWS.DynamoDB.DocumentClient();</span><span id="4aec" class="jn jo hs lo b fi lw lt l lu lv">console.log("Importing Cars into DynamoDB. Please wait.");</span><span id="596b" class="jn jo hs lo b fi lw lt l lu lv">var cars = JSON.parse(fs.readFileSync('carData.json', 'utf8'));</span><span id="3580" class="jn jo hs lo b fi lw lt l lu lv">cars.forEach(function(car) {<br/>  console.log(car)</span><span id="3d4f" class="jn jo hs lo b fi lw lt l lu lv">var params = {<br/>        TableName: "Cars",<br/>        Item: {<br/>            "id": car.id,<br/>            "type": car.type,<br/>            "name": car.name,<br/>            "manufacturer": car.manufacturer,<br/>            "fuel_type": car.fuel_type,<br/>            "description": car.description<br/>        }<br/>    };</span><span id="419f" class="jn jo hs lo b fi lw lt l lu lv">docClient.put(params, function(err, data) {<br/>       if (err) {<br/>           console.error("Unable to add Car", car.name, ". Error JSON:", JSON.stringify(err, null, 2));<br/>       } else {<br/>           console.log("PutItem succeeded:", car.name);<br/>       }<br/>    });<br/>});</span></pre><p id="dc33" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您运行您的<strong class="ir ht"> load-data </strong>命令，它应该在我们的<strong class="ir ht"> carData.json </strong>文件中植入两个项目，并将名称记录回控制台，如下所示。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="9a59" class="jn jo hs lo b fi ls lt l lu lv">#<strong class="lo ht">bash </strong></span><span id="e076" class="jn jo hs lo b fi lw lt l lu lv">yarn load-data<br/>yarn run v1.3.2<br/>$ cd dynamodb &amp;&amp; node loadCarData.js &amp;&amp; cd ..<br/>Importing Cars into DynamoDB. Please wait.<br/>{ id: 1,<br/>  type: 'Automatic',<br/>  name: 'Toyota Yaris',<br/>  manufacturer: 'Toyota',<br/>  fuel_type: 'Petrol',<br/>  description: 'A smooth ride' }<br/>{ id: 2,<br/>  type: 'Manual',<br/>  name: 'Volkswagen Golf',<br/>  manufacturer: 'Volkswagen',<br/>  fuel_type: 'Petrol',<br/>  description: 'Good Value' }<br/>PutItem succeeded: Toyota Yaris<br/>PutItem succeeded: Volkswagen Golf<br/>✨  Done in 0.46s.</span></pre><p id="57f8" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在我们的数据在那里，但是我们怎么知道？让我们使用Dynamo DBs<a class="ae ky" href="https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/DynamoDB/DocumentClient.html" rel="noopener ugc nofollow" target="_blank">document client</a>T24】进行一个快速测试。获取方法。DocumentClient只是一个简化DynamoDB项目的类。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="8bc0" class="jn jo hs lo b fi ls lt l lu lv">#<strong class="lo ht">JavaScript - readDataTest.js </strong></span><span id="5929" class="jn jo hs lo b fi lw lt l lu lv">var AWS = require("aws-sdk");</span><span id="445b" class="jn jo hs lo b fi lw lt l lu lv">AWS.config.update({<br/>  region: "eu-west-2",<br/>  endpoint: "<a class="ae ky" href="http://localhost:8000" rel="noopener ugc nofollow" target="_blank">http://localhost:8000</a>"<br/>});</span><span id="1d09" class="jn jo hs lo b fi lw lt l lu lv">var docClient = new AWS.DynamoDB.DocumentClient()</span><span id="13ee" class="jn jo hs lo b fi lw lt l lu lv">var table = "Cars";</span><span id="b07c" class="jn jo hs lo b fi lw lt l lu lv">var id = 1;</span><span id="389c" class="jn jo hs lo b fi lw lt l lu lv">var params = {<br/>    TableName: table,<br/>    Key:{<br/>        "id": id<br/>    }<br/>};</span><span id="4203" class="jn jo hs lo b fi lw lt l lu lv">docClient.get(params, function(err, data) {<br/>    if (err) {<br/>        console.error("Unable to read item. Error JSON:", JSON.stringify(err, null, 2));<br/>    } else {<br/>        console.log("GetItem succeeded:", JSON.stringify(data, null, 2));<br/>    }<br/>});</span></pre><p id="8e90" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">记住我们的JSON文件，我们应该期待<strong class="ir ht">丰田Yaris </strong>被返回到控制台…</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="af1e" class="jn jo hs lo b fi ls lt l lu lv">#<strong class="lo ht">bash</strong><br/>$ yarn read-data<br/>yarn run v1.3.2<br/>$ cd dynamodb &amp;&amp; node readDataTest.js &amp;&amp; cd ..<br/>GetItem succeeded: {<br/>  "Item": {<br/>    "name": "Toyota Yaris",<br/>    "description": "A smooth ride",<br/>    "id": 1,<br/>    "type": "Automatic",<br/>    "fuel_type": "Petrol",<br/>    "manufacturer": "Toyota"<br/>  }<br/>}<br/>✨  Done in 0.56s.</span></pre><p id="3f1a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">嘭！DynamoDB已经设置好并植入了数据，现在我们只需要将所有的元素放在一起。</p><h2 id="ae1e" class="jn jo hs bd jp jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh bi translated"><strong class="ak">把所有的东西放在一起</strong></h2><p id="ebf7" class="pw-post-body-paragraph ip iq hs ir b is kk iu iv iw kl iy iz ja lg jc jd je lh jg jh ji li jk jl jm ha bi translated">目前，我们的节点后端实际上根本没有与Dynamo DB对话，让我们通过合并上面使用的一些方法来改变这种情况，并创建一条返回所有汽车的路线。</p><p id="865e" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为此，我们将使用<a class="ae ky" href="https://docs.aws.amazon.com/AWSJavaScriptSDK/latest/AWS/DynamoDB/DocumentClient.html" rel="noopener ugc nofollow" target="_blank"> DynamoDBs DocClient </a>和<strong class="ir ht"> scan </strong>方法。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="1ff3" class="jn jo hs lo b fi ls lt l lu lv">#<strong class="lo ht">Javascript app.js</strong></span><span id="c1ea" class="jn jo hs lo b fi lw lt l lu lv">var express = require('express');<br/>var path = require('path');<br/>var favicon = require('serve-favicon');<br/>var logger = require('morgan');<br/>var cookieParser = require('cookie-parser');<br/>var bodyParser = require('body-parser');<br/>var AWS = require("aws-sdk");</span><span id="0ba7" class="jn jo hs lo b fi lw lt l lu lv">var app = express();</span><span id="ac22" class="jn jo hs lo b fi lw lt l lu lv">app.listen(3000, () =&gt; console.log('Cars API listening on port 3000!'))</span><span id="9f49" class="jn jo hs lo b fi lw lt l lu lv">AWS.config.update({<br/>  region: "eu-west-2",<br/>  endpoint: "<a class="ae ky" href="http://localhost:8000" rel="noopener ugc nofollow" target="_blank">http://localhost:8000</a>"<br/>});</span><span id="e8cf" class="jn jo hs lo b fi lw lt l lu lv">var docClient = new AWS.DynamoDB.DocumentClient();</span><span id="1e94" class="jn jo hs lo b fi lw lt l lu lv">app.use(logger('dev'));<br/>app.use(bodyParser.json());<br/>app.use(bodyParser.urlencoded({ extended: false }));<br/>app.use(cookieParser());<br/>app.set('view engine', 'jade');</span><span id="71cf" class="jn jo hs lo b fi lw lt l lu lv">app.get('/', function (req, res) {<br/>  res.send({ title: "Cars API Entry Point" })<br/>})</span><span id="0508" class="jn jo hs lo b fi lw lt l lu lv">app.get('/cars', function (req, res) {</span><span id="71e3" class="jn jo hs lo b fi lw lt l lu lv">var params = {<br/>    TableName: "Cars",<br/>    ProjectionExpression: "#id, #name, #type, #manufacturer, #fuel_type, #description",<br/>    ExpressionAttributeNames: {<br/>        "#id": "id",<br/>        "#name": "name",<br/>        "#type": "type",<br/>        "#manufacturer": "manufacturer",<br/>        "#fuel_type": "fuel_type",<br/>        "#description": "description"<br/>    }<br/>};</span><span id="9d4a" class="jn jo hs lo b fi lw lt l lu lv">console.log("Scanning Cars table.");<br/>docClient.scan(params, onScan);</span><span id="9555" class="jn jo hs lo b fi lw lt l lu lv">function onScan(err, data) {<br/>    if (err) {<br/>        console.error("Unable to scan the table. Error JSON:", JSON.stringify(err, null, 2));<br/>    } else {<br/>        res.send(data)<br/>        // print all the Cars<br/>        console.log("Scan succeeded.");<br/>        data.Items.forEach(function(car) {<br/>           console.log(car.id, car.type, car.name)<br/>        });</span><span id="c22a" class="jn jo hs lo b fi lw lt l lu lv">if (typeof data.LastEvaluatedKey != "undefined") {<br/>            console.log("Scanning for more...");<br/>            params.ExclusiveStartKey = data.LastEvaluatedKey;<br/>            docClient.scan(params, onScan);<br/>        }<br/>    }<br/>  }<br/>})</span></pre><p id="e81e" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这就是你希望你的<strong class="ir ht"> app.js </strong>文件看起来的样子。我知道我们可以对此进行重构，并将一些代码移动到routes文件夹中，但是为了使这篇文章尽可能地切中要点，我将把这些留给您。</p><p id="19f5" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如文件所示，我们创建一条名为<strong class="ir ht"> /cars </strong>的新路线，并创建一个params变量，该变量包含表名和我们希望从扫描中返回的内容。然后我们创建一个名为<strong class="ir ht"> onScan </strong>的函数，它将我们的数据发送到客户端，并将我们的结果记录到控制台。如果您的请求有任何问题，这也包含一些错误捕获。</p><p id="9207" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，如果您导航到<a class="ae ky" href="http://localhost:3000/cars" rel="noopener ugc nofollow" target="_blank"><strong class="ir ht">http://localhost:3000/cars</strong></a><strong class="ir ht"/>，您应该会看到类似下面的内容。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="320d" class="jn jo hs lo b fi ls lt l lu lv">#<strong class="lo ht">JSON - response from </strong><a class="ae ky" href="http://localhost:3000/cars" rel="noopener ugc nofollow" target="_blank"><strong class="lo ht">http://localhost:3000/cars</strong></a></span><span id="7f8f" class="jn jo hs lo b fi lw lt l lu lv">{"Items":[{"name":"Volkswagen Golf","description":"Good Value","id":2,"fuel_type":"Petrol","type":"Manual","manufacturer":"Volkswagen"},{"name":"Toyota Yaris","description":"A smooth ride","id":1,"fuel_type":"Petrol","type":"Automatic","manufacturer":"Toyota"}],"Count":2,"ScannedCount":2}</span></pre><p id="e0b9" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">干得好！现在，您已经使用AWS DynamoDB构建了Node.js RESTful API。此外，您可以<a class="ae ky" href="https://blog.coursesity.com/best-express-js-tutorials/" rel="noopener ugc nofollow" target="_blank">学习ExpressJS </a>在服务器端开发更快更智能的web应用程序。</p><p id="bd92" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">让我们再做一条路线，要求DynamoDB通过<strong class="ir ht"> id归还汽车。</strong></p><p id="228a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">让我们称我们的路线为<strong class="ir ht"> /cars/:id。</strong>我们将通过请求url传递ID。然后，我们将使用ID来查询该表，并返回正确的汽车。我们通过分割字符串得到id值，只返回数字。</p><p id="0982" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然而，请记住，当我们创建表时，我们指定了<strong class="ir ht"> id是一个数字类型。</strong>因此，如果我们试图将这个值传递给DynamoDB，它会返回一个错误。我们首先需要使用parseInt()将我们的id值从字符串转换为整数。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="78e8" class="jn jo hs lo b fi ls lt l lu lv"><strong class="lo ht">#JavaScript - app.js</strong></span><span id="d735" class="jn jo hs lo b fi lw lt l lu lv">[...]</span><span id="3b3a" class="jn jo hs lo b fi lw lt l lu lv">app.get('/cars/:id', function (req, res) {</span><span id="d746" class="jn jo hs lo b fi lw lt l lu lv">var carID = parseInt(req.url.slice(6));<br/>  console.log(req.url)<br/>  console.log(carID)</span><span id="db80" class="jn jo hs lo b fi lw lt l lu lv">var params = {<br/>      TableName : "Cars",<br/>      KeyConditionExpression: "#id = :id",<br/>      ExpressionAttributeNames:{<br/>          "#id": "id"<br/>      },<br/>      ExpressionAttributeValues: {<br/>          ":id": carID<br/>      }<br/>  };</span><span id="3d0f" class="jn jo hs lo b fi lw lt l lu lv">docClient.query(params, function(err, data) {<br/>    if (err) {<br/>        console.error("Unable to query. Error:", JSON.stringify(err, null, 2));<br/>    } else {<br/>        console.log("Query succeeded.");<br/>        res.send(data.Items)<br/>        data.Items.forEach(function(car) {<br/>            console.log(car.id, car.name, car.type);<br/>        });<br/>    }<br/>});</span><span id="0967" class="jn jo hs lo b fi lw lt l lu lv">});</span></pre><p id="38f6" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们将转换后的<strong class="ir ht"> carID </strong>值保存在一个变量中，并在params对象中使用它。然后我们使用<strong class="ir ht">查询</strong>方法收集数据并返回给客户端。如果设置正确，您应该能够导航到<a class="ae ky" href="http://localhost:3000/cars/1" rel="noopener ugc nofollow" target="_blank"><strong class="ir ht">http://localhost:3000/cars/1</strong></a><strong class="ir ht"/>并看到Yaris作为JSON返回。如果您检查您的终端，您将看到被查询汽车的<strong class="ir ht"> id、名称和类型</strong>。</p><pre class="lj lk ll lm fd ln lo lp lq aw lr bi"><span id="dd80" class="jn jo hs lo b fi ls lt l lu lv">#<strong class="lo ht">JSON - </strong><a class="ae ky" href="http://localhost:3000/cars/1" rel="noopener ugc nofollow" target="_blank"><strong class="lo ht">http://localhost:3000/cars/1</strong></a></span><span id="3e22" class="jn jo hs lo b fi lw lt l lu lv">[{"name":"Toyota Yaris","description":"A smooth ride","id":1,"type":"Automatic","fuel_type":"Petrol","manufacturer":"Toyota"}]</span><span id="9c5e" class="jn jo hs lo b fi lw lt l lu lv">#<strong class="lo ht">bash</strong></span><span id="1fc9" class="jn jo hs lo b fi lw lt l lu lv">$ yarn start<br/>[nodemon] starting `node app.js`<br/>Cars API listening on port 3000!<br/>/cars/1<br/>1<br/>Query succeeded.<br/>1 'Toyota Yaris' 'Automatic'<br/>GET /cars/1 200 47.279 ms - 126</span></pre><p id="0432" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">从这里，您可以添加额外的路线，以通过汽车名称、汽车类型和外观进行搜索，以实现向数据库的发布。提示:这将类似于我们的<strong class="ir ht"> loadCarData.js </strong>文件，使用DynamoDB的<strong class="ir ht"> PutItem </strong>函数。</p><p id="f608" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">下一次，我会将我们的示例应用程序与AWS DynamoDB一起部署到AWS Elastic Beanstalk，并使用CircleCI实现一个构建管道，使用Postman进行测试。</p><p id="fc34" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你愿意，你可以在这里查看所有代码，例如<a class="ae ky" href="https://github.com/jameshamann/node-dynamo-db-example" rel="noopener ugc nofollow" target="_blank"> Github Repo </a>。</p><p id="c56c" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">一如既往，感谢阅读，点击👏如果你喜欢你所读的，一定要关注并跟上未来的文章。</p><figure class="lj lk ll lm fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es et"><img src="../Images/b2bf99b956f610c689ee76b39772070b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*nkCbG-E0EXjdaOtcaPQ6_g.gif"/></div></div></figure></div></div>    
</body>
</html>