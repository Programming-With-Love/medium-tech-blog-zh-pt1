<html>
<head>
<title>Airflow: The Beginners Guide</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">气流:初学者指南</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/airflow-the-beginners-guide-684fda8c87f8?source=collection_archive---------3-----------------------#2019-12-05">https://medium.com/walmartglobaltech/airflow-the-beginners-guide-684fda8c87f8?source=collection_archive---------3-----------------------#2019-12-05</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="ed68" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Airflow是一个开源平台，用于编程创作、调度和管理工作流。</p><p id="0232" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在Airflow中，工作流被定义为任务的有向无环图(DAG)。Airflow的主要组件是调度器、工作器和web服务器，它们的工作方式如下—</p><ol class=""><li id="cc33" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">调度程序在一组工作线程上执行您的任务，同时遵循指定的依赖关系。</li><li id="0bd8" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">丰富的命令行应用工具使在Dag上执行复杂操作变得容易。</li><li id="fb08" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">Airflow Webserver提供的丰富用户界面使得可视化管道、监控管道进度以及帮助解决问题变得非常容易。</li></ol><p id="66c8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当工作流被定义为代码时，它们变得更易于维护、版本化、可测试和协作。</p><p id="95a5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本教程(气流系列的第一部分)中，我们将通过一个例子来理解气流的基本功能，并将其与传统的Cron方法进行比较。</p><h1 id="464b" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">问题陈述-</h1><p id="d26b" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">假设我们必须自动化一个管道，其中有一组任务，这些任务在UTC时间每天上午9点运行，并按照给定的顺序执行以下操作-</p><ul class=""><li id="017b" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb kt ji jj jk bi translated">数据可用性轮询</li><li id="142e" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb kt ji jj jk bi translated">提取并处理数据</li><li id="cfc5" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb kt ji jj jk bi translated">存储在一些数据存储中(比如hdfs)</li></ul><h1 id="041b" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak">传统方法- </strong></h1><p id="88ec" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">在传统方法中，这可以通过创建三个脚本和一个将所有这些包装在单个单元中的脚本来实现，最后包装的脚本通过安排在UTC时间上午9点的Cron运行。</p><p id="720a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">传统方法的弊端- </strong></p><ul class=""><li id="f075" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb kt ji jj jk bi translated">没有隐含警报</li><li id="29cd" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb kt ji jj jk bi translated">监控Cron日志是一项复杂的任务</li><li id="ce85" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb kt ji jj jk bi translated">没有隐式重试逻辑</li><li id="6265" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb kt ji jj jk bi translated">没有观想</li><li id="c13c" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb kt ji jj jk bi translated">没有/复杂的分布式计算</li><li id="95bb" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb kt ji jj jk bi translated">复杂并行</li><li id="7d23" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb kt ji jj jk bi translated">没有统计数据</li><li id="1795" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb kt ji jj jk bi translated">……[列表永远不会结束]</li></ul><h1 id="6c82" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak">气流来救援- </strong></h1><p id="f59b" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">Airflow是调度+警报+监控平台的组合，可以独立工作，无需对主要工作代码进行任何修改，即实际任务不受影响。</p><p id="4744" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上述任务序列可以通过在Airflow中编写DAG来实现，它是您想要运行的所有任务的集合，以反映它们的关系和依赖性的方式组织。</p><figure class="ku kv kw kx fd ky"><div class="bz dy l di"><div class="kz la l"/></div><figcaption class="lb lc et er es ld le bd b be z dx">Sample Airflow Dag code (<a class="ae lf" href="https://gist.github.com/vipul007ravi" rel="noopener ugc nofollow" target="_blank">https://gist.github.com/vipul007ravi</a>)</figcaption></figure><p id="619c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这个dag代码(比如my_first_dag.py)中，传统方法的包装脚本被运行相同的三个外壳脚本并创建工作流的气流DAG定义所取代。</p><p id="d1ef" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上述气流DAG可分为气流的3个主要部分-</p><ol class=""><li id="1b5a" class="jc jd hh ig b ih ii il im ip je it jf ix jg jb jh ji jj jk bi translated">默认参数—DAG定义中的“args”字典指定了在整个DAG中保持不变的默认值。例如，默认参数指定重试次数，例如，对于此DAG，该参数设置为1。这些值可以在任务级别进行更改。</li><li id="2baa" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">操作员—airflow中的任务由操作员创建，即任务可以由air flow中众多可用操作员之一定义。例如，在上面的代码中，Check_Data_Availability是一个shell脚本任务，因此被指定为BashOperator。</li><li id="88cf" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">从属关系-从属关系定义气流DAG的流量。它可以被指定为下游或上游。例如，在上面的代码中，Extract_Process_Data依赖于Check_Data_Availability，并在Check_Data_Availability任务完成后执行。</li></ol><p id="e032" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这些是气流的主要组成部分。一旦DAG被定义，它就准备好在DAG中指定的时间被调度程序(Cron的替代)拾取，并被发送到工作线程以供执行。</p><h1 id="e963" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated"><strong class="ak">气流UI - </strong></h1><p id="586f" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">DAG在DAGs文件夹中可用后，它会自动被拾取，并可在UI中进行可视化和监控。下面是在用户界面中看到的DAG的快照-</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es lg"><img src="../Images/bb6905324d5f667a33156271d5db9f51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3o4mwQyZsLYm-yAlozuLnw.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx">Webserver UI of Airflow</figcaption></figure><p id="a6b8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们可以看到DAG依赖关系，并在DAG的图形视图中直观显示工作流</p><figure class="ku kv kw kx fd ky er es paragraph-image"><div role="button" tabindex="0" class="lh li di lj bf lk"><div class="er es ln"><img src="../Images/6de43159f3d1f3ac094b7e68fdf35158.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rWwlhkB6p-yH_8UVzlWfIg.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx">Graph View of Dag in Airflow</figcaption></figure><p id="f73f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">上图描述了工作流程，即任务必须执行的顺序。(检查数据可用性-&gt;提取过程数据-&gt;插入Hdfs)</p><h1 id="f470" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">优势-</h1><ol class=""><li id="50ce" class="jc jd hh ig b ih ko il kp ip lo it lp ix lq jb jh ji jj jk bi translated">气流提供了隐含的警报。这意味着我们可以通过指定需要在重试或失败等情况下得到通知的用户的电子邮件id来定义DAG级别的警报。</li><li id="6280" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">Airflow UI提供正在运行的作业的实时日志。此外，它还提供了强大的功能，可以通过归档旧日志来访问它们。</li><li id="d765" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">气流高度可扩展。任务可以分配给不同的工作人员，这使得系统具有高度的可伸缩性，也使得系统具有容错性和高可用性。</li><li id="f900" class="jc jd hh ig b ih jl il jm ip jn it jo ix jp jb jh ji jj jk bi translated">Airflow UI提供有关作业的统计信息，如过去x天Dag/任务所用的时间、甘特图等。</li></ol></div></div>    
</body>
</html>