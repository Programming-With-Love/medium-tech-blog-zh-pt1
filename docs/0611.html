<html>
<head>
<title>Let’s be explicit about our intent(-filters)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们明确一下我们的意图(-过滤器)</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/lets-be-explicit-about-our-intent-filters-c5dbe2dbdce0?source=collection_archive---------2-----------------------#2021-02-18">https://medium.com/androiddevelopers/lets-be-explicit-about-our-intent-filters-c5dbe2dbdce0?source=collection_archive---------2-----------------------#2021-02-18</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/74154bd75aa48609f3a8dd8281cc2d2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*csWzYUmYq_1HQsqBWk3OTA.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Illustration by <a class="ae it" href="https://dribbble.com/Molly_Hensley" rel="noopener ugc nofollow" target="_blank">Molly Hensley</a></figcaption></figure><p id="b862" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Android 12将会有一个重要的变化，它可以提高应用和平台的安全性。这一变化影响到<strong class="iw hi">所有</strong> <strong class="iw hi">针对Android 12 </strong>的应用。</p><p id="fbb8" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">带有声明意图过滤器的活动、服务和广播接收器现在必须明确声明它们是否应该被导出。</p><p id="71c1" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">❗️ <strong class="iw hi">如果你的应用程序因为这些错误信息中的一条而失败，很可能与这个变化有关。</strong></p><blockquote class="js jt ju"><p id="c62a" class="iu iv jv iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr ha bi translated"><code class="du jz ka kb kc b">Installation did not succeed.<br/>The application could not be installed: INSTALL_FAILED_VERIFICATION_FAILURE<br/>List of apks:<br/>[0] ‘…/build/outputs/apk/debug/app-debug.apk’<br/>Installation failed due to: ‘null’</code></p></blockquote><p id="0594" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">或者</p><blockquote class="js jt ju"><p id="4626" class="iu iv jv iw b ix iy iz ja jb jc jd je jw jg jh ji jx jk jl jm jy jo jp jq jr ha bi translated"><code class="du jz ka kb kc b">INSTALL_PARSE_FAILED_MANIFEST_MALFORMED: Failed parse during installPackageLI: /data/app/vmdl538800143.tmp/base.apk (at Binary XML file line #…): com.example.package.ActivityName: Targeting S+ (version 10000 and above) requires that an explicit value for android:exported be defined when intent filters are present”</code></p></blockquote><h1 id="7c85" class="kd ke hh bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">修复</h1><p id="67ca" class="pw-post-body-paragraph iu iv hh iw b ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn lf jp jq jr ha bi translated">修复这些错误的方法是将属性<code class="du jz ka kb kc b">android:exported</code>添加到任何在应用程序的<code class="du jz ka kb kc b">AndroidManifest.xml</code>文件中声明了<code class="du jz ka kb kc b">&lt;intent-filter&gt;</code>的<code class="du jz ka kb kc b">&lt;activity&gt;</code>、<code class="du jz ka kb kc b">&lt;activity-alias&gt;</code>、<code class="du jz ka kb kc b">&lt;service&gt;</code>或<code class="du jz ka kb kc b">&lt;receiver&gt;</code>组件中。</p><p id="df18" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">⚠️ <strong class="iw hi">不要</strong>只需将<code class="du jz ka kb kc b">android:exported=”true”</code>添加到所有这些组件中！检查每个包含<code class="du jz ka kb kc b">&lt;intent-filter&gt;</code>定义的组件，并问自己:“我希望安装在某人设备上的任何应用程序能够启动这个组件吗？”</p><p id="eaa8" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这个问题的答案取决于应用程序做什么，其他应用程序如何与它交互，以及其他应用程序特定的考虑因素。以下是一些常见意图过滤器的常见示例，以及建议值和选择原因的解释:</p><p id="1d46" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">带<code class="du jz ka kb kc b">&lt;category android:name=”android.intent.category.LAUNCHER” /&gt;</code>的活动:<code class="du jz ka kb kc b">android:exported=”true”</code></p><p id="a24e" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这可能是你的应用程序的<code class="du jz ka kb kc b">MainActivity</code>，由于Android上的启动器可能是一个常规应用程序，这个活动必须被导出，否则启动器将无法启动它。</p><p id="6982" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">带<code class="du jz ka kb kc b">&lt;action android:name=”android.intent.action.VIEW” /&gt;</code>的活动:<code class="du jz ka kb kc b">android:exported=”true”</code></p><p id="d1fb" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">此活动负责处理来自其他应用程序的“打开方式”操作。</p><p id="4858" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">带<code class="du jz ka kb kc b">&lt;action android:name=”android.intent.action.SEND” /&gt;</code>或<code class="du jz ka kb kc b">&lt;action android:name=”android.intent.action.SEND_MULTIPLE”/&gt;</code>的活动:<code class="du jz ka kb kc b">android:exported=”true”</code></p><p id="7067" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">此活动负责处理其他应用程序与其共享的内容。参见<a class="ae it" href="https://developer.android.com/training/sharing/receive" rel="noopener ugc nofollow" target="_blank">从其他应用程序接收简单数据</a>。</p><p id="ab6a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">与<code class="du jz ka kb kc b">&lt;action android:name=”android.media.browse.MediaBrowserService” /&gt;</code> : <code class="du jz ka kb kc b">android:exported=”true”</code>的服务</p><p id="0353" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">如果这是一项向其他应用程序公开应用程序媒体库的服务，则应将其导出，以允许其他应用程序连接和浏览该媒体库。该服务可能会直接或间接扩展<code class="du jz ka kb kc b"><a class="ae it" href="http://mediabrowserservicecompat" rel="noopener ugc nofollow" target="_blank">MediaBrowserServiceCompat</a></code>。如果没有，则可能没有必要将其导出。</p><p id="d87a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">使用<code class="du jz ka kb kc b">&lt;action android:name=”com.google.firebase.MESSAGING_EVENT” /&gt;</code>的服务:<code class="du jz ka kb kc b"><strong class="iw hi">android:exported=”false”</strong></code></p><p id="1241" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">这是Firebase Cloud Messaging将调用的服务，并且应该扩展<code class="du jz ka kb kc b">FirebaseMessagingService</code>。这个服务不应该<em class="jv">被导出，因为无论它是否被导出，Firebase都能够启动组件。有关更多信息，请参见<a class="ae it" href="https://firebase.google.com/docs/cloud-messaging/android/client#manifest" rel="noopener ugc nofollow" target="_blank">在Android上设置Firebase云消息客户端应用</a>。</em></p><p id="a93c" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">带<code class="du jz ka kb kc b">&lt;action android:name=”android.intent.action.BOOT_COMPLETED” /&gt;</code>的接收器:<code class="du jz ka kb kc b"><strong class="iw hi">android:exported=”false”</strong></code></p><p id="ec60" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因为系统正在将该动作传递给广播接收机，所以无论它是否被导出，它都可以这样做。</p><h1 id="df13" class="kd ke hh bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">背景</h1><p id="2f7d" class="pw-post-body-paragraph iu iv hh iw b ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn lf jp jq jr ha bi translated">在Android 12之前，声明了意图过滤器的组件(活动、服务和广播接收器<strong class="iw hi">仅</strong>)被自动导出</p><p id="9246" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">默认情况下，会导出此活动:</p><pre class="lg lh li lj fd lk kc ll lm aw ln bi"><span id="1380" class="lo ke hh kc b fi lp lq l lr ls">&lt;activity android:name=".MainActivity"&gt;<br/>    &lt;intent-filter&gt;<br/>        &lt;action android:name="android.intent.action.MAIN" /&gt;<br/>        &lt;category android:name="android.intent.category.LAUNCHER" <br/>    &lt;/intent-filter&gt;<br/>&lt;/activity&gt;</span></pre><p id="8385" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">此活动未导出:</p><pre class="lg lh li lj fd lk kc ll lm aw ln bi"><span id="c2ce" class="lo ke hh kc b fi lp lq l lr ls">&lt;activity android:name=".MainActivity" /&gt;</span></pre><p id="1b2a" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">虽然这似乎是一个合理的默认，但这里的错误可能会使应用程序容易受到攻击。例如，假设我们的应用程序有一个播放视频的活动:</p><pre class="lg lh li lj fd lk kc ll lm aw ln bi"><span id="daf0" class="lo ke hh kc b fi lp lq l lr ls">&lt;activity android:name=”.PlayVideoActivity” /&gt;</span></pre><p id="3215" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">后来，我们发现我们从许多地方显式地链接到这个活动，因此，为了让我们的应用程序更松散地耦合，我们更改了我们的活动，以包括一个意图过滤器，允许系统选择活动:</p><pre class="lg lh li lj fd lk kc ll lm aw ln bi"><span id="0d88" class="lo ke hh kc b fi lp lq l lr ls">&lt;activity android:name=”.PlayVideoActivity”&gt;<br/>    &lt;intent-filter&gt;<br/>        &lt;action android:name=”android.intent.action.VIEW” /&gt;<br/>        &lt;data<br/>            android:mimeType=”video/*”<br/>            android:scheme=”content” /&gt;<br/>    &lt;/intent-filter&gt;<br/>&lt;/activity&gt;</span></pre><p id="5e88" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">突然我们有了一个问题。我们的activity只设计为供我们的应用程序内部使用，现在已导出！</p><p id="d5e7" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">一旦我们瞄准Android 12，系统将通过要求我们明确android:exported的值来阻止这一点。在这种情况下，我们不希望它被导出，所以我们可以设置该属性，并保持我们的应用程序安全。</p><pre class="lg lh li lj fd lk kc ll lm aw ln bi"><span id="631a" class="lo ke hh kc b fi lp lq l lr ls">&lt;activity<br/>    android:name=”.PlayVideoActivity”<br/>    android:exported=”false”&gt;<br/>    &lt;intent-filter&gt;<br/>        &lt;action android:name=”android.intent.action.VIEW” /&gt;<br/>        &lt;data<br/>            android:mimeType=”video/*”<br/>            android:scheme=”content” /&gt;<br/>    &lt;/intent-filter&gt;<br/>&lt;/activity&gt;</span></pre><h1 id="d6d1" class="kd ke hh bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="89a1" class="pw-post-body-paragraph iu iv hh iw b ix lb iz ja jb lc jd je jf ld jh ji jj le jl jm jn lf jp jq jr ha bi translated">Android 12中的一个重要变化是提高安全性。以该版本为目标的应用程序需要明确声明任何<code class="du jz ka kb kc b">activity</code>、<code class="du jz ka kb kc b">activity-alias</code>、<code class="du jz ka kb kc b">service</code>或广播<code class="du jz ka kb kc b">receiver</code>的<code class="du jz ka kb kc b">android:exported</code>属性的值，这些属性在其<code class="du jz ka kb kc b">AndroidManifest.xml</code>文件中包含一个意图过滤器。否则，应用程序将无法安装。</p><p id="7129" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">仔细考虑将该属性设置为什么值，如果有疑问，请选择设置<code class="du jz ka kb kc b">android:exported=”false”</code>。</p><p id="9a35" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">有关意图和意图过滤器的更多信息，请参见<a class="ae it" href="https://developer.android.com/guide/components/intents-filters#Receiving" rel="noopener ugc nofollow" target="_blank">接收隐式意图</a>。</p><p id="0571" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">有关其他安全和隐私更新的更多信息，请参见本页。</p><p id="682b" class="pw-post-body-paragraph iu iv hh iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">关于Android 12中所有变化的更多信息，请查看<a class="ae it" href="https://android-developers.googleblog.com/2021/02/android-12-dp1.html" rel="noopener ugc nofollow" target="_blank">开发者预览版1的博客帖子！</a></p></div></div>    
</body>
</html>