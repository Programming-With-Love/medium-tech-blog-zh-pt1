<html>
<head>
<title>Tailoring Pants for Square</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">裁剪方形裤子</h1>
<blockquote>原文：<a href="https://medium.com/square-corner-blog/tailoring-pants-for-square-6c47ea2d729d?source=collection_archive---------2-----------------------#2016-05-02">https://medium.com/square-corner-blog/tailoring-pants-for-square-6c47ea2d729d?source=collection_archive---------2-----------------------#2016-05-02</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="83cf" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">裤子构建系统发布了1.0版本。</h2></div><p id="337d" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="js">作者写的</em> <a class="jt ju ge" href="https://medium.com/u/f19a554b194?source=post_page-----6c47ea2d729d--------------------------------" rel="noopener" target="_blank"> <em class="js">艾瑞克艾尔斯</em> </a> <em class="js">。</em></p><blockquote class="jv"><p id="0e64" class="jw jx hh bd jy jz ka kb kc kd ke jr dx translated">注意，我们已经行动了！如果您想继续了解Square的最新技术内容，请访问我们的新家<a class="ae kf" href="https://developer.squareup.com/blog" rel="noopener ugc nofollow" target="_blank">https://developer.squareup.com/blog</a></p></blockquote><p id="cade" class="pw-post-body-paragraph iw ix hh iy b iz kg ii jb jc kh il je jf ki jh ji jj kj jl jm jn kk jp jq jr ha bi translated">本周，Pants project <a class="ae kf" href="http://www.pantsbuild.org/1.0.html" rel="noopener ugc nofollow" target="_blank">宣布了开源Pants构建系统的1.0版本。Pants的1.0版本表明该工具已经准备好被更广泛的采用。</a></p><p id="3d53" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">Square是裤子的骄傲贡献者。自2014年以来，Square的开发人员一直在使用和贡献Pants <a class="ae kf" href="https://corner.squareup.com/2014/09/trying-on-pants.html" rel="noopener ugc nofollow" target="_blank">来开发我们的Java服务。当我们第一次加入这个项目时，我们发现一个需要大量定制和内部知识来安装和操作的工具。如今，该工具拥有简化的安装流程、丰富的文档、清晰的可扩展设计、充满活力的社区和稳定的每周发布历史。</a></p><p id="549e" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">对于裤子，我们得到:</p><ul class=""><li id="2fb1" class="kl km hh iy b iz ja jc jd jf kn jj ko jn kp jr kq kr ks kt bi translated">从代码库的当前视图进行可靠的、可重复的构建</li><li id="2b00" class="kl km hh iy b iz ku jc kv jf kw jj kx jn ky jr kq kr ks kt bi translated">简化的开发工作流程</li><li id="b101" class="kl km hh iy b iz ku jc kv jf kw jj kx jn ky jr kq kr ks kt bi translated">简单的IDE设置</li><li id="3843" class="kl km hh iy b iz ku jc kv jf kw jj kx jn ky jr kq kr ks kt bi translated">与第三方工件库的强大集成</li><li id="a7b7" class="kl km hh iy b iz ku jc kv jf kw jj kx jn ky jr kq kr ks kt bi translated">切换分支时结果一致</li><li id="bf11" class="kl km hh iy b iz ku jc kv jf kw jj kx jn ky jr kq kr ks kt bi translated">可与CI构建人员和开发人员笔记本电脑共享的分布式构建缓存</li><li id="459e" class="kl km hh iy b iz ku jc kv jf kw jj kx jn ky jr kq kr ks kt bi translated">许多内置工具可以帮助我们分析大型构建图</li><li id="c215" class="kl km hh iy b iz ku jc kv jf kw jj kx jn ky jr kq kr ks kt bi translated">定义代码模块之间细粒度依赖关系的能力</li><li id="6112" class="kl km hh iy b iz ku jc kv jf kw jj kx jn ky jr kq kr ks kt bi translated">一个可扩展的工具，可以随着我们的需求而增长</li></ul><h1 id="71d9" class="kz la hh bd lb lc ld le lf lg lh li lj in lk io ll iq lm ir ln it lo iu lp lq bi translated">。/pants编译服务</h1><p id="65a1" class="pw-post-body-paragraph iw ix hh iy b iz lr ii jb jc ls il je jf lt jh ji jj lu jl jm jn lv jp jq jr ha bi translated">要理解Square为什么使用Pants这样的工具，有助于理解我们的软件生命周期。我们使用<a class="ae kf" href="http://www.wired.com/2015/09/google-2-billion-lines-codeand-one-place/" rel="noopener ugc nofollow" target="_blank">单一代码库</a> (monorepo)的原因和谷歌一样<a class="ae kf" href="https://www.youtube.com/watch?v=W71BTkUbdqE" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="40ee" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们从master HEAD构建和发布服务。我们的Java代码库几乎完全存放在一个由900多个项目和45，000个源文件组成的<a class="ae kf" href="https://events.rainfocus.com/oow15/catalog/oracle.jsp?event=javaone&amp;search=Monorepi&amp;search.event=javaoneEvent" rel="noopener ugc nofollow" target="_blank">单一repo </a>中。在这种风格的开发中，我们更喜欢使用全局重构和严格的自动化测试来保持所有代码的一致性，而不是在代码库中保持严格的API向后兼容性和长的弃用周期。</p><p id="5033" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">我们也坚定地承诺使用开源库。我们广泛依赖于通过Maven中央存储库发布的工件。当我们升级一个库时，我们可以在一个地方完成，并更新所有服务的代码依赖。</p><h1 id="2497" class="kz la hh bd lb lc ld le lf lg lh li lj in lk io ll iq lm ir ln it lo iu lp lq bi translated">。/裤子创意服务::</h1><p id="8588" class="pw-post-body-paragraph iw ix hh iy b iz lr ii jb jc ls il je jf lt jh ji jj lu jl jm jn lv jp jq jr ha bi translated">有了这么大的代码库，将整个repo加载到IDE中变得不切实际。在Square，我们主要使用IntelliJ IDEA来开发代码。我们用裤子来配置和发射它。对于日常开发来说，最有价值的特性可能就是能够在IntelliJ中快速调出回购的任何部分。只需一个命令，Pants就可以配置IntelliJ来编辑模块及其在repo中定义的所有依赖项。</p><p id="48e4" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">使在IDE中配置任何项目变得容易意味着开发人员可以轻松地对代码库中的任何项目做出贡献。能够在分支之间轻松切换鼓励了开发人员的合作。现在，在执行代码评审时，可以方便地在本地检查彼此的工作。将变更请求限制在小的、可管理的块中，并在等待代码评审完成时在它们之间切换，会更容易。</p><h1 id="99fc" class="kz la hh bd lb lc ld le lf lg lh li lj in lk io ll iq lm ir ln it lo iu lp lq bi translated">。/裤子–救命</h1><p id="a6c9" class="pw-post-body-paragraph iw ix hh iy b iz lr ii jb jc ls il je jf lt jh ji jj lu jl jm jn lv jp jq jr ha bi translated">我们来到Pants项目是为了寻找一种工具来帮助解决我们构建环境中的问题。以前，我们使用Apache Maven来编译和打包二进制文件。Maven是一个强大而流行的工具，它采用模块化设计，易于扩展，并提供了第三方工具和库的出色支持。我们在Maven上进行了大量投资，包括许多用于运行代码生成的定制插件，以及在我们的<a class="ae kf" href="https://github.com/square/kochiku/wiki" rel="noopener ugc nofollow" target="_blank">持续集成</a> (CI)构建系统中支持工件的分布式缓存。</p><p id="c0f0" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">使用Maven和我们的“从头开始构建一切”策略<a class="ae kf" href="http://blog.lexspoon.org/2012/12/recursive-maven-considered-harmful.html" rel="noopener ugc nofollow" target="_blank">使Maven模型变得紧张</a>。Maven被设计成支持一次编辑几个模块，同时依赖二进制工件来获得大多数依赖项。为了支持从头构建整个repo，我们将repo中的每个Maven模块都设置为快照版本。</p><p id="2453" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">以这种方式使用Maven是可行的，但也有缺点。对所有依赖模块进行递归编译会产生大量开销。我们有包装器脚本来帮助我们在这种环境下提高效率，比如说只运行代码生成或者只运行测试的子集。尽管如此，开发人员在某些情况下还是会遇到麻烦，经常不得不处理陈旧的二进制工件和磁盘上的源代码之间的不一致。例如，在使用mvn install之后，从repo中引入新的变更或者切换回一个旧的分支可能会使它们针对陈旧的代码进行编译。当开发人员经常质疑他们开发环境的完整性时，他们会浪费大量时间清理和重建代码库。</p><h1 id="9ae3" class="kz la hh bd lb lc ld le lf lg lh li lj in lk io ll iq lm ir ln it lo iu lp lq bi translated">。/裤子测试服务:测试</h1><p id="237b" class="pw-post-body-paragraph iw ix hh iy b iz lr ii jb jc ls il je jf lt jh ji jj lu jl jm jn lv jp jq jr ha bi translated">我们的首要任务是允许开发人员在IDE中快速配置他们的工作空间。接下来，我们迁移到使用Pants作为工具，在CI构建器中测试和部署工件。在撰写本文时，我们已经用Pants替换了我们在这个回购中使用的所有Maven，包括:</p><ul class=""><li id="358c" class="kl km hh iy b iz ja jc jd jf kn jj ko jn kp jr kq kr ks kt bi translated">在开发人员工作站和笔记本电脑上开发</li><li id="5a4c" class="kl km hh iy b iz ku jc kv jf kw jj kx jn ky jr kq kr ks kt bi translated">在我们的持续集成环境中编译和测试代码</li><li id="1c7b" class="kl km hh iy b iz ku jc kv jf kw jj kx jn ky jr kq kr ks kt bi translated">将工件发布到Maven风格的存储库中</li><li id="1b66" class="kl km hh iy b iz ku jc kv jf kw jj kx jn ky jr kq kr ks kt bi translated">与findbugs和kloc等第三方工具集成</li></ul><p id="991b" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">取代我们对Maven的所有使用并不容易。我们能够通过使用Maven pom.xml文件作为事实来源来生成Pants配置来做到这一点。在过渡阶段，我们支持这两种工具。通过与Pants开源社区的合作，我们能够通过数百个开源贡献来修改Pants。</p><h1 id="3396" class="kz la hh bd lb lc ld le lf lg lh li lj in lk io ll iq lm ir ln it lo iu lp lq bi translated">。/pants暂存-构建-部署</h1><p id="e8b2" class="pw-post-body-paragraph iw ix hh iy b iz lr ii jb jc ls il je jf lt jh ji jj lu jl jm jn lv jp jq jr ha bi translated">Pants开箱即可编辑、编译、测试和打包代码。除此之外，我们还能够利用Pants基于可扩展模块的系统。目前最受欢迎的是一个小型定制任务，通过我们的<a class="ae kf" href="https://github.com/square/p2" rel="noopener ugc nofollow" target="_blank">内部部署系统</a>直接部署到暂存环境中。在这一过程中，其他定制模块运行定制代码生成器，为我们的安全基础设施收集关于构建过程的元信息，并将注释处理器的输出打包到我们的部署系统的yaml文件中。今天，我们有大约24个内部Pants插件来做所有这些事情，加上额外的工具来审计我们的代码库，与我们的CI系统集成，并定制我们的IDE支持。</p><h1 id="f135" class="kz la hh bd lb lc ld le lf lg lh li lj in lk io ll iq lm ir ln it lo iu lp lq bi translated">装运它！</h1><p id="3cae" class="pw-post-body-paragraph iw ix hh iy b iz lr ii jb jc ls il je jf lt jh ji jj lu jl jm jn lv jp jq jr ha bi translated">在Square，Pants帮助我们实现了monorepo风格的大规模开发所承诺的好处。确保开发过程的一致性和可靠性可以提高我们的开发速度。能够快速、可靠地编辑、编译和测试允许开发人员专注于审查和编写代码，而不是纠结于配置工具。我们相信Pants已经为更广泛的采用做好了准备，并鼓励你尝试一下。</p></div><div class="ab cl lw lx go ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="ha hb hc hd he"><div class="md me mf mg fd mh"><a rel="noopener follow" target="_blank" href="/@ericzundel"><div class="mi ab dw"><div class="mj ab mk cl cj ml"><h2 class="bd hi fi z dy mm ea eb mn ed ef hg bi translated">埃里克·艾尔斯-简介</h2><div class="mo l"><h3 class="bd b fi z dy mm ea eb mn ed ef dx translated">嗨Omari，我看了你的帖子，只是想表达我的支持。我觉得你不需要为此负责，或者…</h3></div><div class="mp l"><p class="bd b fp z dy mm ea eb mn ed ef dx translated">medium.com</p></div></div><div class="mq l"><div class="mr l ms mt mu mq mv mw mh"/></div></div></a></div></div></div>    
</body>
</html>