<html>
<head>
<title>Flutter Performance Checks — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">颤振性能检查第一部分</h1>
<blockquote>原文：<a href="https://medium.com/globant/flutter-performance-checks-part-1-6a041fabf1aa?source=collection_archive---------0-----------------------#2020-01-13">https://medium.com/globant/flutter-performance-checks-part-1-6a041fabf1aa?source=collection_archive---------0-----------------------#2020-01-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="0f19" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Flutter，市场上提供的一个可靠的跨平台。我们中的许多人正在开发应用程序，但不知道他们为什么要求我们做一些事情，我们将清除这些主题。</p><p id="09e2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">不要把所有东西都放在构建函数中。flutter devs建议不要把所有东西都放在一个小部件构建方法中。但是为什么呢？<br/>我们来看看。</p><p id="8738" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用“Flutter create app_name”创建一个Flutter应用程序，你会得到类似反例的东西。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/ca4213ebcd7534143fee2fb352417a0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DNGWmJmZdyW335oFQnh3YA.png"/></div></div></figure><p id="2b8c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果我们检查Android Studio中的颤振性能选项卡(稍后将进入天文台——天文台是用于分析的Dart工具)。现在，每次我们点击增加计数器，它就会更新，我的主页，支架，应用程序栏，浮动操作按钮和一个文本小部件也是如此。这可能不是我们正在更新的，所以为什么它每次都在构建？</p><p id="5c72" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">问题在于setState方法</p><pre class="jd je jf jg fd jo jp jq jr aw js bi"><span id="6871" class="jt ju hh jp b fi jv jw l jx jy"><strong class="jp hi">void </strong>_incrementCounter(){<br/>    setState(() {<br/>      <strong class="jp hi">_counter</strong>++;<br/>    });<br/>}</span></pre><p id="e841" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当我们调用setState时，我们通知有状态小部件数据已经被更改，它需要重建树。因此，我们在一个构建方法中包含了所有的小部件，如下所示:</p><pre class="jd je jf jg fd jo jp jq jr aw js bi"><span id="149a" class="jt ju hh jp b fi jv jw l jx jy">@override<br/>Widget build(BuildContext context) {<br/>  <strong class="jp hi">return </strong>Scaffold(<br/>    appBar: AppBar(<br/>      title: Text(<strong class="jp hi">widget</strong>.<strong class="jp hi">title</strong>),<br/>    ),<br/>    body: Center(<br/>      child: Column(<em class="jz"><br/>        </em>mainAxisAlignment: MainAxisAlignment.<strong class="jp hi">center</strong>,<br/>        children: &lt;Widget&gt;[<br/>          Text(<br/>            <strong class="jp hi">'You have pushed the button this many times:'</strong>,<br/>          ),<br/>          Text(<br/>            <strong class="jp hi">'</strong>$<strong class="jp hi">_counter'</strong>,<br/>            style: Theme<br/>                .<em class="jz">of</em>(context)<br/>                .<strong class="jp hi">textTheme<br/>                </strong>.<strong class="jp hi">display1</strong>,<br/>          ),<br/>        ],<br/>      ),<br/>    ),<br/>    floatingActionButton: FloatingActionButton(<br/>      onPressed: _incrementCounter,<br/>      tooltip: <strong class="jp hi">'Increment'</strong>,<br/>      child: Icon(Icons.<em class="jz">add</em>),<br/>    ), <em class="jz"><br/>  </em>);<br/>}</span></pre><p id="5583" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">它构建了所有的小部件。</p><p id="f1f3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">解决方案可能是分离变化的元素并构建一个新的单独的类。</p><p id="700f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们稍微修改一下代码，看看这种方法会有什么问题。</p><pre class="jd je jf jg fd jo jp jq jr aw js bi"><span id="33b6" class="jt ju hh jp b fi jv jw l jx jy"><strong class="jp hi">class </strong>HomePageContainer <strong class="jp hi">extends </strong>StatelessWidget{<br/>  @override<br/>  Widget build(BuildContext context) {<br/>    <strong class="jp hi">return </strong>Scaffold(<br/>      appBar: AppBar(<br/>        title: Text(<strong class="jp hi">"Title of the page"</strong>),<br/>      ),<br/>      body: MyHomePage(title: <strong class="jp hi">'Flutter Demo Home Page'</strong>), <em class="jz"><br/>    </em>);<br/>  }<br/>}</span><span id="2720" class="jt ju hh jp b fi ka jw l jx jy"><strong class="jp hi">class </strong>_MyHomePageState <strong class="jp hi">extends </strong>State&lt;MyHomePage&gt; {<br/>  int <strong class="jp hi">_counter </strong>= 0;</span><span id="8545" class="jt ju hh jp b fi ka jw l jx jy"><strong class="jp hi">void </strong>_incrementCounter() <strong class="jp hi">async</strong>{<br/>    setState(() {<br/>      <strong class="jp hi">_counter</strong>++;<br/>    });<br/>  }</span><span id="5c5a" class="jt ju hh jp b fi ka jw l jx jy">@override<br/>  Widget build(BuildContext context) {<br/>    <strong class="jp hi">return </strong>Center(<br/>        child: Column(<em class="jz"><br/>          </em>mainAxisAlignment: MainAxisAlignment.<strong class="jp hi">center</strong>,<br/>          children: &lt;Widget&gt;[<br/>            Text(<br/>              <strong class="jp hi">'You have pushed the button this many times:'</strong>,<br/>            ),<br/>            Text(<br/>              <strong class="jp hi">'</strong>$<strong class="jp hi">_counter'</strong>,<br/>              style: Theme<br/>                  .<em class="jz">of</em>(context)<br/>                  .<strong class="jp hi">textTheme<br/>                  </strong>.<strong class="jp hi">display1</strong>,<br/>            ),<br/>            RaisedButton(<br/>              onPressed: _incrementCounter,<br/>              child: Text(<strong class="jp hi">"Increment"</strong>),<br/>            )<br/>          ],<br/>        ),<br/>      );<br/>  }<br/>}</span></pre><p id="b101" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们已经创建了一个容器类，它将有一个appbar和scaffold以及一个子小部件，这是我们的changing小部件。目前来看，还不错。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/c117a66a6203a88800f65dc47405a124.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n6njb6uTIfwpcfdo3I165A.png"/></div></div></figure><p id="d177" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">脚手架和应用程序栏不再构建一次以上，所以这是一个好迹象，但为什么三个文本和一个凸起的按钮连续构建6次呢？让我们进入另一个层面，你可能会遇到这样的情况:</p><pre class="jd je jf jg fd jo jp jq jr aw js bi"><span id="651e" class="jt ju hh jp b fi jv jw l jx jy"><strong class="jp hi">class </strong>_MyHomePageState <strong class="jp hi">extends </strong>State&lt;MyHomePage&gt; {<br/>  ...</span><span id="0968" class="jt ju hh jp b fi ka jw l jx jy">@override<br/>  Widget build(BuildContext context) {<br/>    <strong class="jp hi">return </strong>Center(<br/>        child: Column(<br/>          <em class="jz">...</em><br/>          children: &lt;Widget&gt;[<br/>            MessageContainer(),<br/>            Text(<br/>              <strong class="jp hi">'</strong>$<strong class="jp hi">_counter'</strong>,<br/>              ...<br/>            ),<br/>            RaisedButton(<br/>              ...<br/>            )<br/>          ],<br/>        ),<br/>      );<br/>  }<br/>}</span><span id="0fef" class="jt ju hh jp b fi ka jw l jx jy"><strong class="jp hi">class </strong>MessageContainer <strong class="jp hi">extends </strong>StatelessWidget{<br/>  @override<br/>  Widget build(BuildContext context) {<br/>    <strong class="jp hi">return </strong>Text(<br/>      <strong class="jp hi">'You have pushed the button this many times:'</strong>,<br/>    );<br/>  }<br/>}</span></pre><p id="3e11" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在另一种情况下，您会看到这样的情况，一个有状态的小部件包含另一个有状态或无状态的小部件。</p><p id="82da" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在执行这段代码之前，让我们想一想，如果我们单击凸起的按钮，MessageContainer需要重新构建吗？我的意思是，没有任何变化，我们不想改变，因为我们把它分离到了另一个类中，对吗？</p><p id="09d9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">嗯，答案是否定的，每次都要重建。我们单击凸起的按钮，因为在构建方法中我们调用的MessageContainer()根本不是一个常数。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/a7a0712c0f13b5e230a07240a1031c1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5ZvS6E9AvYMaCJbEqQ06og.png"/></div></div></figure><p id="c1dd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以现在我们最好的选择是让它成为我们不想更新的每个小部件的常量。</p><pre class="jd je jf jg fd jo jp jq jr aw js bi"><span id="87d5" class="jt ju hh jp b fi jv jw l jx jy"><strong class="jp hi">class </strong>_MyHomePageState <strong class="jp hi">extends </strong>State&lt;MyHomePage&gt; {<br/>  ...</span><span id="85ae" class="jt ju hh jp b fi ka jw l jx jy">Widget <strong class="jp hi">_raisedButton</strong>;</span><span id="de13" class="jt ju hh jp b fi ka jw l jx jy"><strong class="jp hi">get raisedButton </strong>{<br/>    <strong class="jp hi">if</strong>(<strong class="jp hi">_raisedButton </strong>== <strong class="jp hi">null</strong>)<br/>    <strong class="jp hi">_raisedButton </strong>=  RaisedButton(<br/>      onPressed: _incrementCounter,<br/>      child: <strong class="jp hi">const </strong>Text(<strong class="jp hi">"Increment"</strong>),<br/>    );<br/>    <strong class="jp hi">return _raisedButton</strong>;<br/>  }</span><span id="1df1" class="jt ju hh jp b fi ka jw l jx jy">@override<br/>  Widget build(BuildContext context) {<br/>    <strong class="jp hi">return </strong>Center(<br/>      child: Column(<br/>        mainAxisAlignment: MainAxisAlignment.<strong class="jp hi">center</strong>,<br/>        children: &lt;Widget&gt;[<br/>          <strong class="jp hi">const </strong>MessageContainer(),<br/>          Text(<br/>            <strong class="jp hi">'</strong>$<strong class="jp hi">_counter'</strong>,<br/>            style: Theme.<em class="jz">of</em>(context).<strong class="jp hi">textTheme</strong>.<strong class="jp hi">display1</strong>,<br/>          ),<br/>          <strong class="jp hi">raisedButton</strong>,<br/>        ],<br/>      ),<br/>    );<br/>  }<br/>}</span><span id="f0e8" class="jt ju hh jp b fi ka jw l jx jy"><strong class="jp hi">class </strong>MessageContainer <strong class="jp hi">extends </strong>StatelessWidget {<br/>  <strong class="jp hi">const </strong>MessageContainer();</span><span id="50b5" class="jt ju hh jp b fi ka jw l jx jy">@override<br/>  Widget build(BuildContext context) {<br/>    <strong class="jp hi">return </strong>Text(<br/>      <strong class="jp hi">'You have pushed the button this many times:'</strong>,<br/>    );<br/>  }<br/>}</span></pre><p id="2cea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意:对于方法为:</p><pre class="jd je jf jg fd jo jp jq jr aw js bi"><span id="9c64" class="jt ju hh jp b fi jv jw l jx jy"><strong class="jp hi">return const </strong>RaisedButton(<br/>  onPressed: _incrementCounter,<br/>  child: <strong class="jp hi">const </strong>Text(<strong class="jp hi">"Increment"</strong>),<br/>);</span></pre><p id="d0f8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">as _incrementCounter不是一个静态方法，也不是一个常量，所以我们不能将RaisedButton声明为常量，但我们可以做的是当它为空时将它赋给一个变量，当它不为空时返回。</p><p id="8a08" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">发布链接阅读常量函数文字的更多细节:【https://github.com/dart-lang/sdk/issues/4596 T2】</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/665d90821401954e17b5c11db6b3dc10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qulh4Ek78cBq73ylQZC5Qg.png"/></div></div></figure><p id="1173" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">优化这个级别可能并不坏，因为在大型应用程序中，如果我们不经常这样做，就会出现糟糕的性能问题。因此，在每次屏幕设计后，检查部件重建的次数以及是否需要重建。</p></div><div class="ab cl kc kd go ke" role="separator"><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh ki"/><span class="kf bw bk kg kh"/></div><div class="ha hb hc hd he"><p id="1387" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我希望你喜欢它。我会带着其他类似的性能问题回来解释更多的工具，比如Observatory。</p><p id="7ec9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">还有其他问题，比如即使用户看不到小部件或屏幕，也会调用build方法。从这里开始读:</p><ol class=""><li id="1326" class="kj kk hh ig b ih ii il im ip kl it km ix kn jb ko kp kq kr bi translated"><a class="ae kb" href="https://github.com/flutter/flutter/issues/14124" rel="noopener ugc nofollow" target="_blank">构建方法被多次调用</a></li><li id="9c75" class="kj kk hh ig b ih ks il kt ip ku it kv ix kw jb ko kp kq kr bi translated"><a class="ae kb" rel="noopener" href="/saugo360/flutter-my-futurebuilder-keeps-firing-6e774830bc2">扑:我的未来建筑继续燃烧！</a></li></ol><p id="c896" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">许多文章都有同样的问题，所以我希望你能远离这种令人讨厌的问题。</p><p id="dfae" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">从下面的链接查看我们的第2部分:</p><div class="kx ky ez fb kz la"><a rel="noopener follow" target="_blank" href="/@parthdave93/flutter-performance-check-part-2-e81a645f6715"><div class="lb ab dw"><div class="lc ab ld cl cj le"><h2 class="bd hi fi z dy lf ea eb lg ed ef hg bi translated">颤振性能检查—第二部分</h2><div class="lh l"><h3 class="bd b fi z dy lf ea eb lg ed ef dx translated">关于如何在颤振第2部分检查性能，解释一些基本的功能和检查，我们可以使用…</h3></div><div class="li l"><p class="bd b fp z dy lf ea eb lg ed ef dx translated">medium.com</p></div></div><div class="lj l"><div class="lk l ll lm ln lj lo jm la"/></div></div></a></div><p id="9873" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你知道你可以按拍手吗👏按钮50次？你走得越高，我就越有动力为你们写更多的东西！</p><p id="ef69" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">你好，我是帕斯·戴夫。noob开发者和noob摄影师。你可以在<a class="ae kb" href="https://in.linkedin.com/in/parth-dave-907b8177" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>上找到我，或者在<a class="ae kb" href="https://github.com/parthdave93" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上跟踪我，或者在<a class="ae kb" href="https://twitter.com/the_parth_dave" rel="noopener ugc nofollow" target="_blank"> Twitter </a>上关注我？</p><p id="ed90" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">祝你有一个愉快的飞行日！</p></div></div>    
</body>
</html>