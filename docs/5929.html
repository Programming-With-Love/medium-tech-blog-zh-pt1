<html>
<head>
<title>Migrate WebLogic domain to Verrazzano multi-cluster environment — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将WebLogic域迁移到Verrazzano多集群环境—第1部分</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/migrate-weblogic-domain-to-verrazzano-multi-cluster-environment-part-1-edbcd9d174d2?source=collection_archive---------0-----------------------#2022-06-23">https://medium.com/oracledevs/migrate-weblogic-domain-to-verrazzano-multi-cluster-environment-part-1-edbcd9d174d2?source=collection_archive---------0-----------------------#2022-06-23</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="c900" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在WebLogic环境中运行工作负载的现有客户面临的最大挑战之一是在不执行重大重新架构的情况下对遗留环境进行现代化改造。</p><p id="afa7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本文中，我将解释如何将现有的WebLogic域迁移到受管的Kubernetes集群(在我的例子中为OKE ),在后续文章中，我将利用Verrazzano并将现有的WebLogic域迁移到多集群Verrazzano环境。</p><p id="6b9d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以下是高级目标体系结构:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/13651b8fabc63132e1c4e295d0360c1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FnOl5apCbb2SZAunm0PJow.png"/></div></div></figure><p id="07ef" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们开始吧！</p><p id="683d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Oracle Kubernetes Toolkit提供了一套全面的工具来帮助现有的WebLogic客户将其工作负载迁移到Kubernetes环境。</p><p id="8463" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该工具包由以下产品组成:</p><ol class=""><li id="df6c" class="jo jp hh ig b ih ii il im ip jq it jr ix js jb jt ju jv jw bi translated">Oracle WebLogic部署工具(WDT ),帮助客户将现有的域和配置提升并转移到映像和Kubernetes。</li></ol><p id="30f4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.Oracle WebLogic映像工具，允许您自动构建、修补和更新WebLogic Server Docker映像，包括您自己定制的映像。</p><p id="ebe3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3.WebLogic Kubernetes运算符，它扩展了Kubernetes以允许创建、配置和管理WebLogic Server域。</p><p id="f9ea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">4.WebLogic Kubernetes Toolkit UI，便于向Kubernetes提供和部署WebLogic域和应用程序。</p><p id="c62e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">5.Oracle WebLogic Monitoring Exporter将WebLogic Server指标导出到Prometheus，可以在Grafana仪表板中监视和查看域和部署。</p><p id="d48e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">6.Oracle WebLogic Logging Exporter提供了一个易于配置、健壮且可用于生产的解决方案，可通过Elasticsearch和Kibana访问WLS日志信息。</p><p id="829e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要将现有的WebLogic域迁移到Kubernetes，您应该执行以下步骤:</p><ol class=""><li id="f606" class="jo jp hh ig b ih ii il im ip jq it jr ix js jb jt ju jv jw bi translated">安装Kubernetes集群或使用一个受管理的Kubernetes环境，如Oracle OKE、谷歌GKS、AWS EKS等。在本文中，我将使用Oracle Kubernetes引擎(OKE)。</li><li id="b60c" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb jt ju jv jw bi translated">在Kubernetes集群中部署Oracle WebLogic Operator。您可以跟随<a class="ae kc" href="https://oracle.github.io/weblogic-kubernetes-operator/quickstart/install/" rel="noopener ugc nofollow" target="_blank">这个链接</a>来学习如何在您的Kubernetes集群中安装WebLogic operator(我将在本文后面解释)。</li><li id="5a30" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb jt ju jv jw bi translated">使用WebLogic部署工具(WDT)从现有WebLogic域创建模型、属性和归档文件。模型是以yaml格式对WebLogic Server域配置的独立于版本的描述。属性文件是一个键/值文件，包含用户为域变量定义的值，如用户和密码、数据库连接字符串等。归档文件用于将二进制文件和其他文件资源部署到目标域(以zip格式)。我将在下面的部分解释这些文件。你可以在<a class="ae kc" href="https://oracle.github.io/weblogic-deploy-tooling/" rel="noopener ugc nofollow" target="_blank">这个链接</a>找到更多关于WDT以及如何使用它的信息。</li><li id="bda0" class="jo jp hh ig b ih jx il jy ip jz it ka ix kb jb jt ju jv jw bi translated">从Oracle网站下载WebLogic和JDK归档文件(您希望用于您的域的版本),并使用WebLogic映像工具创建Docker映像。WebLogic映像工具接受WebLogic档案、JDK档案、WDT档案、域模型、域属性文件和域档案文件作为参数，并生成包含所有二进制文件(WebLogic、JDK和WDT)和域文件的Docker映像。这是WebLogic Kubernetes操作员使用的映像部署类型中的<a class="ae kc" href="https://oracle.github.io/weblogic-kubernetes-operator/userguide/managing-domains/model-in-image/" rel="noopener ugc nofollow" target="_blank">模型。你可以通过</a><a class="ae kc" href="https://oracle.github.io/weblogic-image-tool/" rel="noopener ugc nofollow" target="_blank">这个链接</a>了解更多信息。</li></ol><p id="e114" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以下是将现有WebLogic域迁移到Kubernetes的高级流程图:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es kd"><img src="../Images/81abda4913583cc836bd9ee52085c48c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y_ycBKLdQJd7dNJnXflQVw.png"/></div></div></figure><h2 id="5019" class="ke kf hh bd kg kh ki kj kk kl km kn ko ip kp kq kr it ks kt ku ix kv kw kx ky bi translated">创建OKE集群</h2><p id="80b3" class="pw-post-body-paragraph ie if hh ig b ih kz ij ik il la in io ip lb ir is it lc iv iw ix ld iz ja jb ha bi translated">首先，您需要在您选择的Oracle云基础设施(OCI)地区创建您的Kubernetes集群。我不打算在这篇文章中涵盖所有步骤，你需要访问OCI租赁(你可以通过点击<a class="ae kc" href="https://www.oracle.com/au/cloud/free/" rel="noopener ugc nofollow" target="_blank">这个链接</a>创建你自己的租赁)。</p><p id="0ff9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">登录到您的租户后，您应该创建一个隔离专区来提供Kubernetes集群(在我的例子中，我在root隔离专区下创建了一个应用隔离专区)。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es le"><img src="../Images/de9565ac4271a19c49d4c223a46785e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u7gF_TC-KJlUJVq5dme6VQ.png"/></div></div></figure><p id="3b8e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，您应该在您的租户中配置一个OKE集群，您可以使用OCI控制台来配置集群，或者使用terraform脚本来配置集群。我们现在可以使用OCI控制台，在下一篇文章中，我将使用terrafrom来提供多集群环境。</p><p id="5b6e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">导航到开发人员服务-&gt; Kubernetes集群(OKE ),在更改您的隔离专区后，选择“创建集群”。我建议选择“快速创建”，这样它将提供所有资源(VCN、子网、网关、防火墙规则、路由和Kubernetes资源)。您可以使用“Custom create ”,但是在配置OKE集群之前，您需要仔细遵循文档来创建所有资源。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lf"><img src="../Images/dade5c0cd59e0369306bed9e611eac4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DbOffMxlgMAD5t1PVOTUUw.png"/></div></div></figure><p id="eb31" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我使用“公共端点”,这样我就可以从任何地方访问OKE API服务器(对于您的生产工作负载，我建议使用“私有端点”),并且只选择两个工作节点。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lg"><img src="../Images/22bc60f31ee33fc4e326aaf8e96b8e12.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oeCrpzwT_5TqzC4lkm1THw.png"/></div></div></figure><p id="e924" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为您配置所有资源需要几分钟时间。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lh"><img src="../Images/78f03a721109438166498e5c9dcca4c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sXvePdVm32sMLVL_n6zpNg.png"/></div></div></figure><p id="5c77" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在您可以使用云shell连接到Kubernetes集群。执行云外壳，并从Kubernetes集群复制和执行云外壳访问命令。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es li"><img src="../Images/a9d6294c42717996bf3184e1f0739d6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JI9XH5QGw8vlwOuvv-ZqFg.png"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lj"><img src="../Images/2fa16f94254a222727cfa19a26c756d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*4wSAEjNdW8H8Vf9YeK2-eg.png"/></div></div></figure><h2 id="8f33" class="ke kf hh bd kg kh ki kj kk kl km kn ko ip kp kq kr it ks kt ku ix kv kw kx ky bi translated">发现源WebLogic域</h2><p id="4f8d" class="pw-post-body-paragraph ie if hh ig b ih kz ij ik il la in io ip lb ir is it lc iv iw ix ld iz ja jb ha bi translated">我在源(内部)环境中有一个非常简单的WebLogic域，在简单WebLogic群集中有一个受管服务器，在群集中部署了简单的web应用程序。</p><p id="0763" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我可以使用以下命令来发现源环境(生成模型、属性和应用程序归档文件)。</p><pre class="jd je jf jg fd lk ll lm ln aw lo bi"><span id="c4ff" class="ke kf hh ll b fi lp lq l lr ls"><strong class="ll hi"><em class="lt">weblogic-deploy/bin/discoverDomain.sh -oracle_home $MW_HOME     -domain_home $DOMAIN_HOME -archive_file app-archive.zip     -model_file app-model.yaml -variable_file app.properties -target wko    -output_dir .</em></strong></span></pre><p id="a504" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">该命令将生成三个输出:</p><ul class=""><li id="d655" class="jo jp hh ig b ih ii il im ip jq it jr ix js jb lu ju jv jw bi translated">领域模型</li></ul><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lv lw l"/></div></figure><p id="0b67" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在此文件中，所有以@@PROP开头的变量值将从属性文件中填充，所有以@@SECRET开头的变量值将从Kubernetes secrets中填充(在运行时创建域的过程中)。</p><p id="431f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这意味着您应该在部署应用程序之前在Kubernetes中创建这些秘密。</p><ul class=""><li id="a035" class="jo jp hh ig b ih ii il im ip jq it jr ix js jb lu ju jv jw bi translated">域属性</li></ul><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lv lw l"/></div></figure><ul class=""><li id="d55b" class="jo jp hh ig b ih ii il im ip jq it jr ix js jb lu ju jv jw bi translated">在以下文件夹结构中压缩包含应用程序归档文件(ear、war和jar文件)的文件:</li></ul><pre class="jd je jf jg fd lk ll lm ln aw lo bi"><span id="3690" class="ke kf hh ll b fi lp lq l lr ls">wlsdeploy/applications</span></pre><h2 id="79bd" class="ke kf hh bd kg kh ki kj kk kl km kn ko ip kp kq kr it ks kt ku ix kv kw kx ky bi translated">创建码头工人形象并在OCIR推广</h2><p id="c007" class="pw-post-body-paragraph ie if hh ig b ih kz ij ik il la in io ip lb ir is it lc iv iw ix ld iz ja jb ha bi translated">我们将使用imagetool实用程序，通过域模型、属性和应用程序归档来创建docker映像。</p><p id="2c81" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">此外，该实用程序需要融合中间件、jdk和WDT二进制文件作为输入。</p><pre class="jd je jf jg fd lk ll lm ln aw lo bi"><span id="5732" class="ke kf hh ll b fi lp lq l lr ls"><strong class="ll hi">imagetool/bin/imagetool.sh cache addInstaller --type wdt --version latest --path weblogic-deploy.zip --force</strong></span><span id="66b7" class="ke kf hh ll b fi lx lq l lr ls"><strong class="ll hi">imagetool/bin/imagetool.sh cache addInstaller --type=jdk --version=8u291 --path jdk-8u291-linux-x64.tar.gz --force</strong></span><span id="03bc" class="ke kf hh ll b fi lx lq l lr ls"><strong class="ll hi">imagetool/bin/imagetool.sh cache addInstaller --type=fmw --version=12.2.1.4 --path fmw_12.2.1.4.0_wls_quick_slim_Disk1_1of1.zip --force</strong></span><span id="53ab" class="ke kf hh ll b fi lx lq l lr ls"><strong class="ll hi">imagetool/bin/imagetool.sh create --tag mel.ocir.io/apaccpt03/app-repo/appdomain:1.0 --version 12.2.1.4 --jdkVersion 8u202 --wdtModel app-model.yaml --wdtVariables app.properties --wdtArchive app-archive.zip --wdtDomainHome /u01/domains/appdomain --wdtModelOnly</strong></span></pre><p id="603f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，在OCIR创建私有存储库(app-repo/appdomain ),并将映像推送到OCIR。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ly"><img src="../Images/140b7dee064e12bf20928101294a683b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o2YwgXUDIJ4fb-cR413OSg.png"/></div></div></figure><pre class="jd je jf jg fd lk ll lm ln aw lo bi"><span id="16b2" class="ke kf hh ll b fi lp lq l lr ls"><strong class="ll hi">docker login &lt;region name&gt;.ocir.io<br/>Username: </strong><a class="ae kc" href="mailto:apaccpt03/oracleidentitycloudservice/omid.izadkhasti@oracle.com" rel="noopener ugc nofollow" target="_blank"><strong class="ll hi">&lt;tenancy namespace&gt;/oracleidentitycloudservice/</strong></a><strong class="ll hi">&lt;user&gt;<br/>Password:<br/>Login Succeeded</strong></span><span id="adbf" class="ke kf hh ll b fi lx lq l lr ls">## Password is user auth token</span><span id="d0a0" class="ke kf hh ll b fi lx lq l lr ls"><strong class="ll hi">docker push &lt;region name&gt;.ocir.io/</strong><a class="ae kc" href="mailto:apaccpt03/oracleidentitycloudservice/omid.izadkhasti@oracle.com" rel="noopener ugc nofollow" target="_blank"><strong class="ll hi">&lt;tenancy namespace&gt;</strong></a><strong class="ll hi">/app-repo/appdomain:1.0</strong></span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lz"><img src="../Images/f24c5c4a96c9645126b0c51d09515670.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2dLJpUn1VGK1Mtz1PqTfQA.png"/></div></div><figcaption class="ma mb et er es mc md bd b be z dx">the helm repo</figcaption></figure><h2 id="f273" class="ke kf hh bd kg kh ki kj kk kl km kn ko ip kp kq kr it ks kt ku ix kv kw kx ky bi translated">在Kubernetes集群中安装WebLogic运算符</h2><p id="a8fe" class="pw-post-body-paragraph ie if hh ig b ih kz ij ik il la in io ip lb ir is it lc iv iw ix ld iz ja jb ha bi translated">在这一步中，我将在我们的k8s集群中安装WLS操作符。首先，我需要连接到cloud shell并配置对集群的访问(如我之前所述)。</p><p id="03cd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后，我将为WebLogic operator创建一个名称空间。</p><pre class="jd je jf jg fd lk ll lm ln aw lo bi"><span id="eccc" class="ke kf hh ll b fi lp lq l lr ls">omid_izadk@cloudshell:~ (ap-melbourne-1)$ <strong class="ll hi">kubectl create namespace weblogic-operator-ns</strong><br/>namespace/weblogic-operator-ns created</span></pre><p id="78a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我使用WL操作员舵图来安装操作员，因此首先我需要使用以下命令添加舵库:</p><pre class="jd je jf jg fd lk ll lm ln aw lo bi"><span id="b7e3" class="ke kf hh ll b fi lp lq l lr ls">omid_izadk@cloudshell:~ (ap-melbourne-1)$ <strong class="ll hi">helm repo add weblogic-operator </strong><a class="ae kc" href="https://oracle.github.io/weblogic-kubernetes-operator/charts" rel="noopener ugc nofollow" target="_blank"><strong class="ll hi">https://oracle.github.io/weblogic-kubernetes-operator/charts</strong></a><strong class="ll hi"> --force-update  </strong><br/>"weblogic-operator" has been added to your repositories</span></pre><p id="60fb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我在这篇文章中使用了最新版本的操作符图像(3.4.1)</p><pre class="jd je jf jg fd lk ll lm ln aw lo bi"><span id="6f87" class="ke kf hh ll b fi lp lq l lr ls">omid_izadk@cloudshell:~ (ap-melbourne-1)$ <strong class="ll hi">helm show values weblogic-operator/weblogic-operator | grep image</strong><br/># image specifies the container image containing the operator.<br/>image: "<strong class="ll hi">ghcr.io/oracle/weblogic-kubernetes-operator:3.4.1</strong>"</span></pre><p id="5cf8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，使用以下命令在weblogic-operator-ns名称空间中安装WL运算符。</p><pre class="jd je jf jg fd lk ll lm ln aw lo bi"><span id="f5d2" class="ke kf hh ll b fi lp lq l lr ls">omid_izadk@cloudshell:~ (ap-melbourne-1)$ <strong class="ll hi">helm install weblogic-operator \<br/>&gt;   weblogic-operator/weblogic-operator \<br/>&gt;   --namespace weblogic-operator-ns \<br/>&gt;   --set "enableClusterRoleBinding=true" \<br/>&gt;   --set "domainNamespaceSelectionStrategy=LabelSelector" \<br/>&gt;   --set "domainNamespaceLabelSelector=weblogic-operator\=enabled" \<br/>&gt;   --wait</strong><br/>NAME: weblogic-operator<br/>LAST DEPLOYED: Sun Jun 19 04:11:32 2022<br/>NAMESPACE: weblogic-operator-ns<br/>STATUS: deployed<br/>REVISION: 1<br/>TEST SUITE: None</span></pre><p id="a93f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我将使用以下命令来确认operator已经启动并正在运行。</p><pre class="jd je jf jg fd lk ll lm ln aw lo bi"><span id="3388" class="ke kf hh ll b fi lp lq l lr ls">omid_izadk@cloudshell:~ (ap-melbourne-1)$ kubectl <strong class="ll hi">get all -n weblogic-operator-ns</strong><br/>NAME                                    READY   STATUS    RESTARTS   AGE<br/><strong class="ll hi">pod/weblogic-operator-9c5bd58f5-85gkf   1/1     Running   0          2m43s</strong></span><span id="d267" class="ke kf hh ll b fi lx lq l lr ls">NAME                                     TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)    AGE<br/>service/internal-weblogic-operator-svc   ClusterIP   10.96.130.244   &lt;none&gt;        8082/TCP   2m44s</span><span id="9a70" class="ke kf hh ll b fi lx lq l lr ls">NAME                                READY   UP-TO-DATE   AVAILABLE   AGE<br/>deployment.apps/weblogic-operator   1/1     1            1           2m46s</span><span id="c94a" class="ke kf hh ll b fi lx lq l lr ls">NAME                                          DESIRED   CURRENT   READY   AGE<br/>replicaset.apps/weblogic-operator-9c5bd58f5   1         1         1       2m46s</span></pre><h2 id="50b9" class="ke kf hh bd kg kh ki kj kk kl km kn ko ip kp kq kr it ks kt ku ix kv kw kx ky bi translated">安装NGINX入口控制器</h2><p id="d050" class="pw-post-body-paragraph ie if hh ig b ih kz ij ik il la in io ip lb ir is it lc iv iw ix ld iz ja jb ha bi translated">我将安装NGINX入口控制器，以便使用以下命令从公共互联网访问WebLogic托管服务器(如果您愿意，可以使用任何入口控制器代替NGINX)。</p><pre class="jd je jf jg fd lk ll lm ln aw lo bi"><span id="12c7" class="ke kf hh ll b fi lp lq l lr ls">#add nginx helm repository<br/>omid_izadk@cloudshell:~ (ap-melbourne-1)$ <strong class="ll hi">helm repo add ingress-nginx </strong><a class="ae kc" href="https://kubernetes.github.io/ingress-nginx" rel="noopener ugc nofollow" target="_blank"><strong class="ll hi">https://kubernetes.github.io/ingress-nginx</strong></a><strong class="ll hi"> --force-update</strong><br/>"ingress-nginx" has been added to your repositories</span><span id="121e" class="ke kf hh ll b fi lx lq l lr ls">#Create namespace <br/>omid_izadk@cloudshell:~ (ap-melbourne-1)$ <strong class="ll hi">kubectl create namespace nginx</strong><br/>namespace/nginx created</span><span id="b0d2" class="ke kf hh ll b fi lx lq l lr ls">#install nginx helm chart<br/>omid_izadk@cloudshell:~ (ap-melbourne-1)$ <strong class="ll hi">helm install nginx-operator ingress-nginx/ingress-nginx --namespace nginx</strong><br/>NAME: nginx-operator<br/>LAST DEPLOYED: Sun Jun 19 04:23:01 2022<br/>NAMESPACE: nginx<br/>STATUS: deployed<br/>REVISION: 1<br/>TEST SUITE: None</span></pre><h2 id="da58" class="ke kf hh bd kg kh ki kj kk kl km kn ko ip kp kq kr it ks kt ku ix kv kw kx ky bi translated">创建和部署WebLogic域</h2><p id="2c21" class="pw-post-body-paragraph ie if hh ig b ih kz ij ik il la in io ip lb ir is it lc iv iw ix ld iz ja jb ha bi translated">这是创建域文件(yaml格式)和在k8s中创建域的最后一步。WebLogic操作员将获取域配置，并相应地创建管理服务器和受管服务器。</p><p id="275e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">首先，我们需要创建domain.yaml文件，该文件使用我们在前面步骤中创建的图像。下面是domain.yaml文件。</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lv lw l"/></div></figure><p id="2c58" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在创建域之前，您需要为OCIR注册表用户名和密码、WebLogic凭据和运行时加密密码创建名称空间和机密。</p><pre class="jd je jf jg fd lk ll lm ln aw lo bi"><span id="e169" class="ke kf hh ll b fi lp lq l lr ls">omid_izadk@cloudshell:wls-oke (ap-melbourne-1)$ <strong class="ll hi">kubectl create namespace appdomain</strong><br/>namespace/appdomain created</span><span id="81d2" class="ke kf hh ll b fi lx lq l lr ls">omid_izadk@cloudshell:wls-oke (ap-melbourne-1)$ <strong class="ll hi">kubectl -n appdomain create secret generic weblogic-credentials --from-literal=username=weblogic --from-literal=password=Welcome123#</strong><br/>secret/appdomain-weblogic-credentials created</span><span id="8c69" class="ke kf hh ll b fi lx lq l lr ls">omid_izadk@cloudshell:wls-oke (ap-melbourne-1)$ k<strong class="ll hi">ubectl label secret appdomain-weblogic-credentials -n appdomain weblogic.domainUID=appdomain</strong><br/>secret/appdomain-weblogic-credentials labeled</span><span id="6527" class="ke kf hh ll b fi lx lq l lr ls">omid_izadk@cloudshell:wls-oke (ap-melbourne-1)$ <strong class="ll hi">kubectl -n appdomain create secret generic appdomain-runtime-encryption-secret --from-literal=password=Welcome123#</strong></span><span id="ae97" class="ke kf hh ll b fi lx lq l lr ls">omid_izadk@cloudshell:wls-oke (ap-melbourne-1)$ <strong class="ll hi">kubectl create secret docker-registry ocir-secret --docker-server=mel.ocir.io --</strong><a class="ae kc" href="mailto:docker-username='apaccpt03/oracleidentitycloudservice/omid.izadkhasti@oracle.com" rel="noopener ugc nofollow" target="_blank"><strong class="ll hi">docker-username='&lt;tenancy namespace&gt;/oracleidentitycloudservice/omid.izadkhasti@oracle.com</strong></a><strong class="ll hi">' --docker-password='&lt;User Auth Token&gt;' --</strong><a class="ae kc" href="mailto:docker-email='omid.izadkhasti@oracle.com" rel="noopener ugc nofollow" target="_blank"><strong class="ll hi">docker-email='omid.izadkhasti@oracle.com</strong></a><strong class="ll hi">' -n appdomain</strong><br/>secret/ocir-secret created</span></pre><p id="d183" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因为我们使用来自WebLogic运算符的标签，所以应该使用以下命令标记域命名空间:</p><pre class="jd je jf jg fd lk ll lm ln aw lo bi"><span id="4e1e" class="ke kf hh ll b fi lp lq l lr ls">omid_izadk@cloudshell:wls-oke (ap-melbourne-1)$ <strong class="ll hi">kubectl label ns appdomain weblogic-operator=enabled</strong><br/>namespace/appdomain labeled</span></pre><p id="0244" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，我们可以使用以下命令创建域:</p><pre class="jd je jf jg fd lk ll lm ln aw lo bi"><span id="2d83" class="ke kf hh ll b fi lp lq l lr ls">omid_izadk@cloudshell:wls-oke (ap-melbourne-1)$ <strong class="ll hi">kubectl apply -f domain.yaml </strong><br/>domain.weblogic.oracle/appdomain configured</span></pre><p id="f6d5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">几分钟后，您将看到管理和托管服务器启动并运行。</p><pre class="jd je jf jg fd lk ll lm ln aw lo bi"><span id="d9fe" class="ke kf hh ll b fi lp lq l lr ls">omid_izadk@cloudshell:wls-oke (ap-melbourne-1)$ <strong class="ll hi">kubectl get pods -n appdomain</strong><br/>NAME                        READY   STATUS    RESTARTS   AGE<br/>appdomain-adminserver       1/1     Running   0          7m51s<br/>appdomain-managedserver-1   1/1     Running   0          7m8s</span></pre><p id="a926" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要访问应用程序(SimpleHTML应用程序)，您可以创建以下内容:</p><figure class="jd je jf jg fd jh"><div class="bz dy l di"><div class="lv lw l"/></div></figure><p id="7328" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">appdomain-managedserver-1是为托管服务器创建的Kubernetes服务名称，端口7003是服务监听地址。您可以使用以下命令找到服务名和监听地址:</p><pre class="jd je jf jg fd lk ll lm ln aw lo bi"><span id="ffdf" class="ke kf hh ll b fi lp lq l lr ls">mid_izadk@cloudshell:wls-oke (ap-melbourne-1)$ <strong class="ll hi">kubectl get services -n appdomain</strong><br/>NAME                           TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)    AGE<br/>appdomain-adminserver          ClusterIP   None           &lt;none&gt;        7001/TCP   24m<br/>appdomain-cluster-appcluster   ClusterIP   10.96.197.58   &lt;none&gt;        7003/TCP   24m<br/><strong class="ll hi">appdomain-managedserver-1      ClusterIP   None           &lt;none&gt;        7003/TCP   24m</strong></span></pre><p id="33b5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，您可以使用以下命令从公共互联网访问应用程序:</p><pre class="jd je jf jg fd lk ll lm ln aw lo bi"><span id="fac6" class="ke kf hh ll b fi lp lq l lr ls">http://&lt;&lt;NGINX LB Public IP&gt;&gt;/SimpleHTML</span></pre><p id="7e89" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以使用以下命令找到NGINX公共IP地址:</p><pre class="jd je jf jg fd lk ll lm ln aw lo bi"><span id="3e33" class="ke kf hh ll b fi lp lq l lr ls">omid_izadk@cloudshell:wls-oke (ap-melbourne-1)$ <strong class="ll hi">kubectl get services -n nginx</strong><br/>NAME                                                TYPE           CLUSTER-IP      EXTERNAL-IP      PORT(S)                      AGE<br/>nginx-operator-ingress-nginx-controller             LoadBalancer   10.xx.xx.xx    <strong class="ll hi">&lt;&lt;public IP&gt;&gt; </strong>  80:31893/TCP,443:30600/TCP   4h10m<br/>nginx-operator-ingress-nginx-controller-admission   ClusterIP      10.xx.xx.xx   &lt;none&gt;           443/TCP                      4h10m</span></pre><p id="8621" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，您应该会看到以下屏幕(如果一切正常):</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es me"><img src="../Images/b06b7082f9388fd6aa0656c5bdb06c86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FMoq9bhLSFM6iA1Wx5E5Zw.png"/></div></div></figure><p id="0601" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我希望您现在理解了Kubernetes中WebLogic应用程序的基本架构，以及如何将您的简单应用程序迁移到k8s。不要担心，这只是一个开始，在接下来的文章中，我将解释如何拥有更复杂的域(即带有数据源的域)以及如何在Kubernetes中管理域的生命周期。</p><p id="63a4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">此外，我将解释如何在Verrazzano中安装和部署WebLogic域，以及如何在多集群环境中部署相同的域。</p><p id="309b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">想讨论一下吗？当你在等待更多的时候，请加入我们的<a class="ae kc" href="https://bit.ly/devrel_slack" rel="noopener ugc nofollow" target="_blank">公共休闲频道</a>！</p></div></div>    
</body>
</html>