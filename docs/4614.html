<html>
<head>
<title>How to Use ES6 for
Universal JavaScript Apps</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将ES6用于通用JavaScript应用程序</h1>
<blockquote>原文：<a href="https://medium.com/javascript-scene/how-to-use-es6-for-isomorphic-javascript-apps-2a9c3abe5ea2?source=collection_archive---------2-----------------------#2015-04-28">https://medium.com/javascript-scene/how-to-use-es6-for-isomorphic-javascript-apps-2a9c3abe5ea2?source=collection_archive---------2-----------------------#2015-04-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/></div><div class="ab cl ie if go ig" role="separator"><span class="ih bw bk ii ij ik"/><span class="ih bw bk ii ij ik"/><span class="ih bw bk ii ij"/></div><div class="ha hb hc hd he"><p id="d50c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">现在尘埃落定，我终于开始将ES6用于生产应用——因为我编写了<a class="ae jj" href="https://github.com/ericelliott/isomorphic-express-boilerplate" rel="noopener ugc nofollow" target="_blank">通用JavaScript </a>，它必须适用于Node.js和浏览器。</p><p id="7ded" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这不会是一个关于ES6特性或者<a class="ae jj" rel="noopener" href="/@mjackson/universal-javascript-4761051b7ae9">通用JavaScript </a>(又名同构JavaScript)的深度教程。我们将介绍一些基础知识，帮助您开始运行。</p><figure class="jl jm jn jo fd jp jq jr ig js jt paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es jk"><img src="../Images/97e4f385d75a71cec96435a1962d7ee2.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*58R0tzuzVXd_7k89Igm9jA.png"/></div></div></figure><h1 id="8011" class="ka kb hh bd kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx bi translated">使用巴别塔</h1><p id="de67" class="pw-post-body-paragraph il im hh in b io ky iq ir is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ha bi translated">Babel.js是一个很棒的工具，可以让你将ES6代码转换成可以在今天的JavaScript环境中运行的ES5代码，包括Node.js和浏览器，但是不清楚如何设置它。</p></div><div class="ab cl ie if go ig" role="separator"><span class="ih bw bk ii ij ik"/><span class="ih bw bk ii ij ik"/><span class="ih bw bk ii ij"/></div><div class="ha hb hc hd he"><h2 id="15ed" class="ld kb hh bd kc le lf lg kg lh li lj kk iw lk ll ko ja lm ln ks je lo lp kw lq bi translated">安装巴别塔</h2><p id="87fc" class="pw-post-body-paragraph il im hh in b io ky iq ir is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ha bi translated">几乎你找到的每一个教程都会告诉你在全球范围内安装Babel。如果没有人必须共享您的代码，这很好，但是如果您在一个团队中或者正在开发开源库，那么也要在本地安装每个包:</p><pre class="jl jm jn jo fd lr ls lt lu aw lv bi"><span id="d36b" class="ld kb hh ls b fi lw lx l ly lz">$ npm install -g babel-cli<br/>$ npm install --save-dev babel-cli babel-preset-es2015 babel-preset-stage-0</span></pre><p id="61bc" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">现在你可以启动<em class="ma">`巴别塔节点`</em> CLI/REPL:</p><pre class="jl jm jn jo fd lr ls lt lu aw lv bi"><span id="7f32" class="ld kb hh ls b fi lw lx l ly lz">$ babel-node<br/>&gt; Object.assign({}, {msg: 'wow!'}); // =&gt; { msg: 'wow!' }</span></pre><p id="2230" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">对于浏览工作流，您可能也需要这些:</p><pre class="jl jm jn jo fd lr ls lt lu aw lv bi"><span id="459c" class="ld kb hh ls b fi lw lx l ly lz">$ npm install --save-dev babelify browserify</span></pre><p id="fc19" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这将允许您使用所有很酷的新ES6语法，如箭头函数:</p><pre class="jl jm jn jo fd lr ls lt lu aw lv bi"><span id="b7d9" class="ld kb hh ls b fi lw lx l ly lz">(x) =&gt; x + 1;</span></pre><p id="a30c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">但是它不会让你使用新的内置方法，比如<em class="ma"> `Object.assign()` </em>，<em class="ma"> `Object.is()` </em>等等…</p><p id="af03" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这并不是显而易见的，因为这些特性在使用<em class="ma"> `babel-node` </em> REPL时非常好用:</p><pre class="jl jm jn jo fd lr ls lt lu aw lv bi"><span id="d981" class="ld kb hh ls b fi lw lx l ly lz">Object.is(NaN, NaN); // =&gt; true</span></pre><p id="b1b3" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">幸运的是，这可以通过polyfill轻松解决:</p><pre class="jl jm jn jo fd lr ls lt lu aw lv bi"><span id="4d37" class="ld kb hh ls b fi lw lx l ly lz">$ npm install --save core-js</span></pre><p id="1e47" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">然后，在条目文件的顶部:</p><pre class="jl jm jn jo fd lr ls lt lu aw lv bi"><span id="7e02" class="ld kb hh ls b fi lw lx l ly lz">import 'core-js';</span></pre><h2 id="af89" class="ld kb hh bd kc le lf lg kg lh li lj kk iw lk ll ko ja lm ln ks je lo lp kw lq bi translated">林挺</h2><p id="9fe0" class="pw-post-body-paragraph il im hh in b io ky iq ir is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ha bi translated">担心你将不得不放弃林挺你的代码？别担心。ESLint为您提供服务！</p><pre class="jl jm jn jo fd lr ls lt lu aw lv bi"><span id="8b3c" class="ld kb hh ls b fi lw lx l ly lz">$ npm install --save-dev eslint babel-eslint</span></pre></div><div class="ab cl ie if go ig" role="separator"><span class="ih bw bk ii ij ik"/><span class="ih bw bk ii ij ik"/><span class="ih bw bk ii ij"/></div><div class="ha hb hc hd he"><blockquote class="mb"><p id="ff24" class="mc md hh bd me mf mg mh mi mj mk ji dx translated">这是我正在试验的。</p></blockquote></div><div class="ab cl ie if go ig" role="separator"><span class="ih bw bk ii ij ik"/><span class="ih bw bk ii ij ik"/><span class="ih bw bk ii ij"/></div><div class="ha hb hc hd he"><p id="fff4" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">ES6 love在<em class="ma"> `env` </em>和<em class="ma"> `ecmaFeatures` </em>键中。当ESLint遇到特定于ES6的代码时，您需要这些来防止错误。</p><p id="155d" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如果你还想要对象rest &amp; spread ( <a class="ae jj" href="https://github.com/sebmarkbage/ecmascript-rest-spread" rel="noopener ugc nofollow" target="_blank">一个ES7提议</a>常用于React代码)，你还需要<a class="ae jj" href="https://github.com/babel/babel-eslint" rel="noopener ugc nofollow" target="_blank"><em class="ma">` babel-eslint`</em></a><em class="ma">。</em></p><h2 id="5a58" class="ld kb hh bd kc le lf lg kg lh li lj kk iw lk ll ko ja lm ln ks je lo lp kw lq bi translated">收集</h2><p id="1293" class="pw-post-body-paragraph il im hh in b io ky iq ir is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ha bi translated">在大多数情况下，您可以简单地将您的<em class="ma"> `node` </em>调用替换为<em class="ma"> `babel-node` </em>调用。<em class="ma"> `babel-node` </em>在内存中缓存模块，因此会有很大的启动延迟和潜在的大量内存使用。考虑将to编译成ES5用于生产。请继续阅读。</p><p id="96e9" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">Babel的文档让编译看起来轻而易举:</p><pre class="jl jm jn jo fd lr ls lt lu aw lv bi"><span id="12e0" class="ld kb hh ls b fi lw lx l ly lz">$ babel script.js --out-file script-compiled.js</span></pre><p id="61fb" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">再简单不过了，对吧？好吧，如果你不尝试导入任何模块，当然，这将工作得很好。但是如果你做一些不平凡的事情，你会想要编译你的整个代码库，而不仅仅是一个文件。为此，您需要使用<em class="ma"> `-d` </em>选项。</p><pre class="jl jm jn jo fd lr ls lt lu aw lv bi"><span id="1edf" class="ld kb hh ls b fi lw lx l ly lz">$ babel -d build-dir source-dir</span></pre><p id="e59b" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">注意，输出目录在最前面。</p><p id="01d9" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如果您想让调试器正常工作，您将需要使用<em class="ma"> `-s` </em>选项添加源映射:</p><pre class="jl jm jn jo fd lr ls lt lu aw lv bi"><span id="28ea" class="ld kb hh ls b fi lw lx l ly lz">$ babel -d build-dir source-dir -s</span></pre><p id="b91c" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">这样做将告诉Babel，对于它编译的每个文件，它还应该生成一个源映射文件，当您在引擎中单步执行实时代码时，该文件将告诉调试器在哪里可以找到原始源代码。换句话说，您将看到自己编写的代码，而不是Babel生成的编译输出。这通常是你想要的。</p><p id="cd2a" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">要为浏览器编译，你需要使用<a class="ae jj" href="http://webpack.github.io/" rel="noopener ugc nofollow" target="_blank"> Webpack </a>，或者Babelify Browserify转换。我通常在终端使用babelify进行快速编译。例如，要运行一些单元测试:</p><pre class="jl jm jn jo fd lr ls lt lu aw lv bi"><span id="e8e5" class="ld kb hh ls b fi lw lx l ly lz">npm install -g browserify browser-run<br/>browserify -t babelify script.js | browser-run -p 2222</span></pre><ol class=""><li id="fb0c" class="mm mn hh in b io ip is it iw mo ja mp je mq ji mr ms mt mu bi translated">安装<em class="ma"> `browserify` </em>和<em class="ma"> `browser-run` </em>，这样你就可以在终端的任何地方使用它们。</li><li id="3622" class="mm mn hh in b io mv is mw iw mx ja my je mz ji mr ms mt mu bi translated">从<em class="ma"> `script.js` </em>创建一个包，并在chrome中运行该脚本。从您最喜欢的浏览器中点击<a class="ae jj" href="http://localhost:2222" rel="noopener ugc nofollow" target="_blank"> http://localhost:2222 </a>，脚本将在浏览器中运行。控制台日志输出将通过管道返回到控制台。</li></ol><p id="a0ea" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">编译一个包:</p><pre class="jl jm jn jo fd lr ls lt lu aw lv bi"><span id="f4a3" class="ld kb hh ls b fi lw lx l ly lz">$ browserify script.js -t babelify --outfile bundle.js</span></pre><p id="3529" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">配置Webpack对于这个快速教程来说太多了，但是如果你想跳过所有的无用功，你可以使用这个<a class="ae jj" href="https://github.com/cloverfield-tools/prod-module-boilerplate" rel="noopener ugc nofollow" target="_blank">样板用于生产模块</a>。</p><h2 id="e2bf" class="ld kb hh bd kc le lf lg kg lh li lj kk iw lk ll ko ja lm ln ks je lo lp kw lq bi translated">使用现有模块</h2><p id="d239" class="pw-post-body-paragraph il im hh in b io ky iq ir is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ha bi translated">使用上述工具，您可以使用ES6语法导入ES6和节点样式的模块:</p><pre class="jl jm jn jo fd lr ls lt lu aw lv bi"><span id="6f12" class="ld kb hh ls b fi lw lx l ly lz">import 'core-js'; // Node module<br/>import harness from './harness'; // ES6 module</span></pre><p id="830e" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">所以你可以在你的现代ES6代码库中继续使用你将在大规模npm生态系统中找到的所有标准模块——但是由于这么多人仍在使用ES5，我建议你向npm发布你的模块的编译版本。</p><p id="e303" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">对于公共库，我把源码放在一个<em class="ma"> `source` </em>目录下，把ES5编译在<em class="ma"> `dist` </em>或者<em class="ma"> `lib`。</em>目前来看，用<em class="ma">` package . JSON`</em><em class="ma">中的<em class="ma"> `main` </em>键指向编译后的ES5版本可能是个好主意。</em></p><h2 id="afe8" class="ld kb hh bd kc le lf lg kg lh li lj kk iw lk ll ko ja lm ln ks je lo lp kw lq bi translated">自动化</h2><p id="714b" class="pw-post-body-paragraph il im hh in b io ky iq ir is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ha bi translated">我喜欢将这些命令放在我的npm脚本中:</p><figure class="jl jm jn jo fd jp"><div class="bz dy l di"><div class="na nb l"/></div></figure><h2 id="76f4" class="ld kb hh bd kc le lf lg kg lh li lj kk iw lk ll ko ja lm ln ks je lo lp kw lq bi translated">反应</h2><p id="1607" class="pw-post-body-paragraph il im hh in b io ky iq ir is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ha bi translated">React用户的额外收获是:你也被覆盖了。巴贝尔和埃斯林都支持JSX。不错！</p><p id="246f" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi">编辑:</strong>截止到2015年11月8日，Babel 6 API的改动已经打破了babel-react-transform。如果需要，可以安装最新兼容版本的Babel:</p><pre class="jl jm jn jo fd lr ls lt lu aw lv bi"><span id="3284" class="ld kb hh ls b fi lw lx l ly lz">npm install --save-dev babel@5.8.29</span></pre><h2 id="5530" class="ld kb hh bd kc le lf lg kg lh li lj kk iw lk ll ko ja lm ln ks je lo lp kw lq bi translated">聚会时间</h2><p id="51b9" class="pw-post-body-paragraph il im hh in b io ky iq ir is kz iu iv iw la iy iz ja lb jc jd je lc jg jh ji ha bi translated">恭喜你！您已经准备好将ES6用于您的通用应用程序。如果你想知道，这里有一些我最喜欢的ES6的东西，你应该探索一下:</p><ul class=""><li id="321c" class="mm mn hh in b io ip is it iw mo ja mp je mq ji nc ms mt mu bi translated">压缩对象文字</li><li id="0802" class="mm mn hh in b io mv is mw iw mx ja my je mz ji nc ms mt mu bi translated">解构</li><li id="4dd6" class="mm mn hh in b io mv is mw iw mx ja my je mz ji nc ms mt mu bi translated">箭头函数(非常适合单线lambdas)</li><li id="1a5e" class="mm mn hh in b io mv is mw iw mx ja my je mz ji nc ms mt mu bi translated">默认参数</li><li id="0bb9" class="mm mn hh in b io mv is mw iw mx ja my je mz ji nc ms mt mu bi translated">休息参数</li><li id="4216" class="mm mn hh in b io mv is mw iw mx ja my je mz ji nc ms mt mu bi translated">发电机</li></ul><p id="2154" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">您应该马上记住新的默认/覆盖模式:</p><figure class="jl jm jn jo fd jp"><div class="bz dy l di"><div class="na nb l"/></div></figure></div><div class="ab cl ie if go ig" role="separator"><span class="ih bw bk ii ij ik"/><span class="ih bw bk ii ij ik"/><span class="ih bw bk ii ij"/></div><div class="ha hb hc hd he"><blockquote class="mb"><p id="9e44" class="mc md hh bd me mf mg mh mi mj mk ji dx translated">尽情享受吧！</p></blockquote></div><div class="ab cl ie if go ig" role="separator"><span class="ih bw bk ii ij ik"/><span class="ih bw bk ii ij ik"/><span class="ih bw bk ii ij"/></div><div class="ha hb hc hd he"><blockquote class="mb"><p id="654b" class="mc md hh bd me mf mg mh mi mj mk ji dx translated"><a class="ae jj" href="https://ericelliottjs.com/product/lifetime-access-pass/" rel="noopener ugc nofollow" target="_blank">跟随Eric Elliott学习ES6</a></p></blockquote></div><div class="ab cl ie if go ig" role="separator"><span class="ih bw bk ii ij ik"/><span class="ih bw bk ii ij ik"/><span class="ih bw bk ii ij"/></div><div class="ha hb hc hd he"><p id="e60d" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi"> <em class="ma">埃里克·埃利奥特</em> </strong> <em class="ma">是《编程JavaScript应用程序》</em>  <em class="ma">(奥赖利)的作者，纪录片制作人，</em> <strong class="in hi"> <em class="ma">【编程素养】</em> </strong> <em class="ma">。他曾为</em><strong class="in hi"><em class="ma">Adobe Systems</em></strong><em class="ma"/><strong class="in hi"><em class="ma">尊巴健身</em></strong><em class="ma"/><strong class="in hi"><em class="ma">华尔街日报</em></strong><em class="ma"/><strong class="in hi"><em class="ma">ESPN</em></strong><em class="ma"/><strong class="in hi"><em class="ma">BBC</em></strong><em class="ma">等顶级录音师贡献过软件经验</em></p><p id="61a2" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">他大部分时间都在旧金山湾区和世界上最美丽的女人在一起。</p></div></div>    
</body>
</html>