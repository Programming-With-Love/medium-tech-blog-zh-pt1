<html>
<head>
<title>Customizing AnimatedContent in Jetpack Compose 🌟</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Jetpack Compose中自定义动画内容🌟</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/customizing-animatedcontent-in-jetpack-compose-629c67b45894?source=collection_archive---------2-----------------------#2022-07-01">https://medium.com/androiddevelopers/customizing-animatedcontent-in-jetpack-compose-629c67b45894?source=collection_archive---------2-----------------------#2022-07-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/c1909ef92acaa7374f6b910319ff23a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Yu-W3qMxx1YyPm_AJMcXGg.png"/></div></div></figure><div class=""/><div class=""><h2 id="4f1a" class="pw-subtitle-paragraph ip hr hs bd b iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg dx translated">了解如何使用AnimatedContent在不同类型的内容之间进行更多的自定义过渡</h2></div><p id="31ca" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">您是否在不同的组件之间切换，并担心当用户立即看到屏幕上的变化时会产生不和谐的效果，而没有在两者之间进行优雅的转换？好吧，不要再看了！<a class="ae kd" href="https://developer.android.com/jetpack/compose/animation#animatedcontent" rel="noopener ugc nofollow" target="_blank"> AnimatedContent </a>(目前处于实验阶段)是一个可组合组件，它允许你在不同的可组合组件之间进行更平滑、更定制的过渡效果。默认情况下，在<code class="du ke kf kg kh b">AnimatedContent</code>中包装变化的组件，会淡入淡出并缩放内容。这可以让你的应用程序的外观和感觉有很大的不同，不需要太多的努力。</p><p id="b84f" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">让我们看一个简单的例子，在<a class="ae kd" href="https://github.com/android/compose-samples/tree/main/Jetsurvey" rel="noopener ugc nofollow" target="_blank"> Jetsurvey应用</a>中，我们有一个条件，可以在调查结果或调查本身的问题之间切换:</p><figure class="ki kj kk kl fd hj"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="6e0c" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">运行这个程序，我们可以观察到状态变化转换并不像我们希望的那样平滑:</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ko"><img src="../Images/ed3749cecacaa2ee2117fbe90c120d3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*yF3jP7twC5rME9u4vpyCpg.gif"/></div></div><figcaption class="kp kq et er es kr ks bd b be z dx">Instant transition between questions and result</figcaption></figure><p id="7b68" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">如果我们将<code class="du ke kf kg kh b">when</code>语句包装在<code class="du ke kf kg kh b">AnimatedContent</code>中，将新的<code class="du ke kf kg kh b">state</code>作为<code class="du ke kf kg kh b">targetState</code>传入，我们可以很容易地在这两个屏幕之间获得更好的转换:</p><figure class="ki kj kk kl fd hj"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="6878" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">在<code class="du ke kf kg kh b">AnimatedContent</code> lambda中，使用<code class="du ke kf kg kh b">targetState</code>参数而不是<code class="du ke kf kg kh b">state</code>参数很重要，因为这将确保动画在需要快速切换不同状态时流畅运行。运行这个程序，我们可以看到两个组件之间的转换有很大的改进(降低到0.25倍):</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es kt"><img src="../Images/cde73f9dc33a6d9f30e50d07cfec3e5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/0*ixKU6wZgOxIBGSDR"/></div></figure><h1 id="ee6c" class="ku kv hs bd kw kx ky kz la lb lc ld le iy lf iz lg jb lh jc li je lj jf lk ll bi translated">对动画内容使用自定义transitionSpec</h1><p id="2fb4" class="pw-post-body-paragraph jh ji hs jj b jk lm it jm jn ln iw jp jq lo js jt ju lp jw jx jy lq ka kb kc ha bi translated">让我们使用可选的<code class="du ke kf kg kh b">transitionSpec</code>参数对这个转换进行更多的定制，这个参数可以在<code class="du ke kf kg kh b">AnimatedContent</code> composable中找到。默认情况下，<code class="du ke kf kg kh b">transitionSpec</code>将为进入和退出过渡执行自定义的内容淡入淡出和缩放。为了使它更具定制性，让我们将新内容从底部改为<code class="du ke kf kg kh b">slideInVertically</code>和<code class="du ke kf kg kh b">fadeOut</code>以前的内容。</p><figure class="ki kj kk kl fd hj"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="bf8a" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated"><code class="du ke kf kg kh b">slideInVertically</code>函数接受一个<code class="du ke kf kg kh b">initialOffsetY</code>函数。这是一个决定动画开始位置的函数。在这种情况下，我们返回一个内容为<code class="du ke kf kg kh b">fullHeight</code>的<code class="du ke kf kg kh b">initialOffsetY</code>。这意味着动画将从屏幕底部的偏移设置开始(在<code class="du ke kf kg kh b">fullHeight</code>)。这可能看起来有点混乱，但是在Android中绘图时的坐标系是从内容左上角的<code class="du ke kf kg kh b">[0,0]</code>点开始的，所以坐标<code class="du ke kf kg kh b">[0, fullHeight]</code>在内容的底部。我们也可以指定<code class="du ke kf kg kh b"><a class="ae kd" href="https://developer.android.com/jetpack/compose/animation#animationspec" rel="noopener ugc nofollow" target="_blank">animationSpec</a></code>(补间，弹簧等。)来定制动画的持续时间或类型。让我们看看现在是什么样子:</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ko"><img src="../Images/20958a7871723f03e27e22eecba6f7a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*pdwkRiHQUp7aVL815vaRpA.gif"/></div></div></figure><p id="833e" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">那看起来好多了！内容从底部滑入，传出的内容淡出。要查看自定义过渡的其他选项，请参见<a class="ae kd" href="https://developer.android.com/jetpack/compose/animation#enter-exit-transition" rel="noopener ugc nofollow" target="_blank"> EnterTransition和ExitTransition文档</a>。</p><h1 id="d28c" class="ku kv hs bd kw kx ky kz la lb lc ld le iy lf iz lg jb lh jc li je lj jf lk ll bi translated">动画显示问题变化</h1><p id="eb6e" class="pw-post-body-paragraph jh ji hs jj b jk lm it jm jn ln iw jp jq lo js jt ju lp jw jx jy lq ka kb kc ha bi translated">使用<code class="du ke kf kg kh b">AnimatedContent</code>的另一个示例实现是当在集合中的不同问题之间转换时。以前，内容会在没有动画的情况下改变，如下所示:</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ko"><img src="../Images/8d495fc352c0947978190da47c27cb27.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*KxOeG8qb8k9_FUaghHWFeA.gif"/></div></div></figure><p id="315c" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">通过包装<code class="du ke kf kg kh b">AnimatedContent</code>中的<code class="du ke kf kg kh b">Question</code>组件，我们将获得问题转换的默认转换:</p><figure class="ki kj kk kl fd hj"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="f74c" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">为了更好地过渡，我们可以将之前的问题移到屏幕左侧，新问题从右侧进入。让我们如前所示指定<code class="du ke kf kg kh b">transitionSpec</code>:</p><figure class="ki kj kk kl fd hj"><div class="bz dy l di"><div class="km kn l"/></div></figure><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es kt"><img src="../Images/b453d3d4d78240432b4cb786bbdd3143.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*7jNUGaf0kfEKrepB6EQDow.gif"/></div></figure><p id="e423" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">这对于我们的调查很有帮助，正如我们所料，调查内容会顺利进行。但是您可能会注意到，如果我们单击“上一步”按钮，动画就没有多大意义了，因为它从错误的方向退出了屏幕:</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div class="er es kt"><img src="../Images/faed1d1d5b74ed6669dd137d20480879.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*SzXv4AmVfwTLevQPa9DOPQ.gif"/></div></figure><p id="5843" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">我们需要它来反转动画，将“新”内容从左边滑入，旧内容从右边滑出。为此，我们可以扩展我们如何使用<code class="du ke kf kg kh b">transitionSpec</code>。这个有<code class="du ke kf kg kh b"><a class="ae kd" href="https://developer.android.com/reference/kotlin/androidx/compose/animation/AnimatedContentScope" rel="noopener ugc nofollow" target="_blank">AnimatedContentScope</a></code>作为接收器，让我们有能力观察或访问<code class="du ke kf kg kh b">initialState</code>和<code class="du ke kf kg kh b">targetState</code>。这允许我们根据不同的状态有条件地改变我们的逻辑:</p><figure class="ki kj kk kl fd hj"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="3cb5" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">我们可以检查<code class="du ke kf kg kh b">targetState.questionIndex</code>，并将其与<code class="du ke kf kg kh b">initialState.questionIndex</code>进行比较，如果<code class="du ke kf kg kh b">target.questionIndex</code>更大，我们知道我们正在调查中前进。然后，我们将动画设置为<code class="du ke kf kg kh b">slideInHorizontally</code>，内容宽度的起始偏移量为,<code class="du ke kf kg kh b">slideOutHorizontally</code>为内容的负宽度。如果<code class="du ke kf kg kh b">targetState.questionIndex</code>变小，我们知道我们在调查中退步了。然后，我们可以设置与前进相反的用法:<code class="du ke kf kg kh b">-fullWidth</code>用于滑入，而<code class="du ke kf kg kh b">fullWidth</code>用于滑出:</p><figure class="ki kj kk kl fd hj"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="cd77" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">我们现在有了更好的前进和后退动画:</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ko"><img src="../Images/2c96e2c889d17d8400fb69374c4968ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*hLzR-uUa3d0oHcaA57yCgg.gif"/></div></div></figure><p id="c6f6" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">有一个助手方法<code class="du ke kf kg kh b"><a class="ae kd" href="https://developer.android.com/reference/kotlin/androidx/compose/animation/AnimatedContentScope#slideIntoContainer(androidx.compose.animation.AnimatedContentScope.SlideDirection,androidx.compose.animation.core.FiniteAnimationSpec,kotlin.Function1)" rel="noopener ugc nofollow" target="_blank">slideIntoContainer</a></code>，也可以用来实现从某些方向的滑动动画，而不需要计算出所需的初始偏移量。<code class="du ke kf kg kh b">slideIntoContainer(towards = AnimatedContentScope.SlideDirection.Up)</code>可以代替我们使用的<code class="du ke kf kg kh b">slideInHorizontally</code>和<code class="du ke kf kg kh b">slideOutHorizontally</code>。<code class="du ke kf kg kh b">slideIntoContainer</code>和<code class="du ke kf kg kh b">slideIn/OutHorizontally/Vertically</code>的区别在于<code class="du ke kf kg kh b">slideIntoContainer/slideOutOfContainer</code>使用容器尺寸作为初始/目标偏移。当容器的大小因<code class="du ke kf kg kh b">SizeTransform</code>滑入或滑出而改变时，这尤其有用。</p><h1 id="89af" class="ku kv hs bd kw kx ky kz la lb lc ld le iy lf iz lg jb lh jc li je lj jf lk ll bi translated">更改zIndex</h1><p id="2d05" class="pw-post-body-paragraph jh ji hs jj b jk lm it jm jn ln iw jp jq lo js jt ju lp jw jx jy lq ka kb kc ha bi translated">另一个可以定制的属性是<code class="du ke kf kg kh b">AnimatedContent</code>上的<code class="du ke kf kg kh b">targetContentZIndex</code>。<code class="du ke kf kg kh b">targetContentZIndex</code>指定了组件如何堆叠在另一个之上。<code class="du ke kf kg kh b">zIndex</code>越高，可组合组件出现的位置就越靠前。使用上面的同一个示例，我们可以自定义动画，使其看起来像纸叠起来的效果:</p><figure class="ki kj kk kl fd hj"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="44ea" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">我们将<code class="du ke kf kg kh b">targetContentZIndex</code>设置为<code class="du ke kf kg kh b">questionIndex</code>，因为随着调查的深入，这个数字会越来越高。这将产生以下动画:</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ko"><img src="../Images/0c16a362639fca98f2a19756ff17582b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*IsoRIudjkZ-1tCo4QFwthg.gif"/></div></div></figure><h1 id="3013" class="ku kv hs bd kw kx ky kz la lb lc ld le iy lf iz lg jb lh jc li je lj jf lk ll bi translated">自定义大小转换</h1><p id="4a6c" class="pw-post-body-paragraph jh ji hs jj b jk lm it jm jn ln iw jp jq lo js jt ju lp jw jx jy lq ka kb kc ha bi translated"><code class="du ke kf kg kh b">AnimatedContent</code>还提供了为容器尺寸变化定制动画的能力，通过指定一个<code class="du ke kf kg kh b"><a class="ae kd" href="https://developer.android.com/reference/kotlin/androidx/compose/animation/package-summary#SizeTransform(kotlin.Boolean,kotlin.Function2)" rel="noopener ugc nofollow" target="_blank">SizeTransform</a></code>，我们可以调整尺寸变化将如何被动画化。例如，查看<a class="ae kd" href="https://github.com/android/compose-samples/tree/main/Crane" rel="noopener ugc nofollow" target="_blank">起重机示例app </a>:</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ko"><img src="../Images/52b76db969f3abf225f15a19a7410786.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*QMDBNnAEpUXIqbwZItRwNg.gif"/></div></div></figure><p id="6ef4" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">如果我们在屏幕顶部的飞行/睡眠/进食标签周围添加<code class="du ke kf kg kh b">AnimatedContent</code>，我们可以定制尺寸如何随时间变化。在这个例子中，我们使用<code class="du ke kf kg kh b">tween</code>作为<code class="du ke kf kg kh b">sizeAnimationSpec</code>，在动画的不同帧改变容器的大小:</p><figure class="ki kj kk kl fd hj"><div class="bz dy l di"><div class="km kn l"/></div></figure><p id="1a57" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">我们也可以为它提供任何其他的<code class="du ke kf kg kh b"><a class="ae kd" href="https://developer.android.com/jetpack/compose/animation#animationspec" rel="noopener ugc nofollow" target="_blank">animationSpec</a></code> <a class="ae kd" href="https://developer.android.com/jetpack/compose/animation#animationspec" rel="noopener ugc nofollow" target="_blank">选项</a>，例如，我们也可以使用<code class="du ke kf kg kh b">keyframes</code>并使用提供的<code class="du ke kf kg kh b">initialSize</code>和<code class="du ke kf kg kh b">targetSize</code>来确定我们在这个动画中可能想要的不同关键帧。虽然现在一个简单的<code class="du ke kf kg kh b">tween</code>看起来不错。这将产生以下动画:</p><figure class="ki kj kk kl fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ko"><img src="../Images/45c79b0b301e5925de8a7b16624d0d39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*v5Kw_YEJykfG_QEJu8Rxow.gif"/></div></div></figure><h1 id="b7a2" class="ku kv hs bd kw kx ky kz la lb lc ld le iy lf iz lg jb lh jc li je lj jf lk ll bi translated">摘要</h1><p id="fdb2" class="pw-post-body-paragraph jh ji hs jj b jk lm it jm jn ln iw jp jq lo js jt ju lp jw jx jy lq ka kb kc ha bi translated">是一个简单的API，使得组件之间的转换更加令人愉快。要查看完整的代码示例，请看一下这个<a class="ae kd" href="https://github.com/android/compose-samples/pull/842" rel="noopener ugc nofollow" target="_blank"> Jetsurvey pull请求</a>和<a class="ae kd" href="https://github.com/android/compose-samples/pull/843" rel="noopener ugc nofollow" target="_blank"> Crane pull请求</a>，前者引入了这个变化，后者也引入了<code class="du ke kf kg kh b">AnimatedContent</code>。</p><p id="0363" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">值得一提的是，这个API是实验性的，我们正在积极寻找您对它的任何反馈，请查看<a class="ae kd" href="https://developer.android.com/jetpack/compose/animation#animatedcontent" rel="noopener ugc nofollow" target="_blank">动画内容文档</a>了解更多信息。</p><p id="f0aa" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">如果您有任何问题，请随时在Twitter <a class="ae kd" href="https://twitter.com/riggaroo" rel="noopener ugc nofollow" target="_blank"> @riggaroo </a>上联系我，或者如果您有任何反馈或错误要报告，请在<a class="ae kd" href="https://issuetracker.google.com/issues/new?component=1070767&amp;template=1626715" rel="noopener ugc nofollow" target="_blank">撰写动画问题跟踪器</a>上报告。</p><p id="d2a8" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated">过渡愉快！💫</p></div><div class="ab cl lr ls go lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="ha hb hc hd he"><p id="f34f" class="pw-post-body-paragraph jh ji hs jj b jk jl it jm jn jo iw jp jq jr js jt ju jv jw jx jy jz ka kb kc ha bi translated"><em class="ly">感谢</em> <a class="lz ma ge" href="https://medium.com/u/c6093e8a8d5b?source=post_page-----629c67b45894--------------------------------" rel="noopener" target="_blank"> <em class="ly">刘朵朵</em> </a> <em class="ly">和</em> <a class="lz ma ge" href="https://medium.com/u/f4d5f1a633bb?source=post_page-----629c67b45894--------------------------------" rel="noopener" target="_blank"> <em class="ly">新美乐股份公司斯托亚诺维奇</em> </a> <em class="ly">的点评</em></p></div></div>    
</body>
</html>