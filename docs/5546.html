<html>
<head>
<title>Finding the shortest path from Country A to Country B — using Neo4J and Node</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Neo4J和Node查找从A国到B国的最短路径</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/finding-the-shortest-path-from-country-a-to-country-b-using-neo4j-and-node-d36f3aa96fe4?source=collection_archive---------0-----------------------#2019-01-01">https://medium.com/oracledevs/finding-the-shortest-path-from-country-a-to-country-b-using-neo4j-and-node-d36f3aa96fe4?source=collection_archive---------0-----------------------#2019-01-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="e877" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">图形数据库擅长记录节点和边，更擅长执行遍历边的查询。与使用传统SQL的关系数据库相比，图数据库可以更优雅、更高效地处理一些挑战。</p><p id="56c6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">作为一个简单的例子，本文将创建一个Neo4J Graph数据库实例，用世界上的国家(节点)和国家之间的(陆地)边界(边)填充。国家数据由节点应用程序从GitHub文档中检索，该节点应用程序随后使用通过Bolt协议服务器执行的Cypher表达式在Neo4J实例中创建节点和边。节点应用程序利用NPM模块<em class="jc">neo4j-驱动程序</em>。</p><p id="0af0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">与本文相关的代码可以在GitHub中找到:<a class="ae jd" href="https://github.com/AMIS-Services/code-cafe/tree/master/neo4j-graphdatabase" rel="noopener ugc nofollow" target="_blank">https://GitHub . com/AMIS-Services/code-cafe/tree/master/neo4j-graph database</a>。</p><p id="16a3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">学习从法国到印度的最短路线(通过陆地边界的数量)的步骤如下:</p><p id="01e6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">先决条件:Linux主机与Docker引擎可用于运行Docker容器(图像)和互联网连接。仅此而已。</p><ul class=""><li id="5c26" class="je jf hh ig b ih ii il im ip jg it jh ix ji jb jj jk jl jm bi translated">运行Neo4J容器映像(如我的同事Rosanna Denis在<a class="ae jd" href="https://technology.amis.nl/2018/11/16/querying-connected-data-in-graph-databases-with-neo4j/" rel="noopener ugc nofollow" target="_blank">这篇文章</a>中所述)</li><li id="dcc7" class="je jf hh ig b ih jn il jo ip jp it jq ix jr jb jj jk jl jm bi translated">通过浏览器UI访问Neo4J</li><li id="2788" class="je jf hh ig b ih jn il jo ip jp it jq ix jr jb jj jk jl jm bi translated">运行节点JS容器映像</li><li id="dbee" class="je jf hh ig b ih jn il jo ip jp it jq ix jr jb jj jk jl jm bi translated">Git克隆GitHub Repo</li><li id="98b5" class="je jf hh ig b ih jn il jo ip jp it jq ix jr jb jj jk jl jm bi translated">运行节点应用程序(它将获取数据，将其加载到Neo4J中，并执行查询以找到最短路径)</li></ul><h1 id="7264" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">1.运行Neo4J容器映像</h1><p id="92cb" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">Neo4J将在Docker容器中运行，在这个简单的例子中，我们不会将数据映射到容器外部的卷(这意味着我们不会将数据持久存储在Neo4J数据库中)</p><p id="c03c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要启动Neo4J数据库，只需运行:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="17a6" class="le jt hh la b fi lf lg l lh li">docker run --publish=7474:7474 --publish=7687:7687 neo4j:3.0</span></pre><p id="f435" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果图像在本地还不可用，它将被提取(大约200 MB)。</p><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lj"><img src="../Images/bfda137eae7686fff20b46920e29019c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*RLo0D05VqdIcTUk1.png"/></div></div></figure><p id="0b96" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在我的例子中，我在Windows上工作，用vagger通过VirtualBox启动一个Ubuntu虚拟机。此虚拟机被分配了IP地址192.168.188.142(如游民文件中所配置的)。请参见<a class="ae jd" href="https://github.com/AMIS-Services/code-cafe/tree/master/linux-and-docker-host-on-windows-machine" rel="noopener ugc nofollow" target="_blank">https://github . com/AMIS-Services/code-cafe/tree/master/Linux-and-docker-host-on-windows-machine</a>了解更多关于我的设置以及如何在您的环境中模拟它的详细信息。</p><h1 id="3091" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">2.通过浏览器UI访问Neo4J</h1><p id="d3a4" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">现在在Docker主机(或Windows主机)上的浏览器中通过端口7474访问Neo4J，例如:<a class="ae jd" href="http://192.168.188.142:7474" rel="noopener ugc nofollow" target="_blank">http://192 . 168 . 188 . 142:7474</a></p><p id="434e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">用neo4j/neo4j连接。</p><figure class="kv kw kx ky fd lk er es paragraph-image"><div class="er es lr"><img src="../Images/55f0390d7a75bd560fd4c015638d1b9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/0*9p_8hp8yndq7BA54.png"/></div><figcaption class="ls lt et er es lu lv bd b be z dx">logging in to Neo4J in the browser console</figcaption></figure><p id="d6ce" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在将提示您定义新密码。这样做。</p><p id="f43d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">随后键入命令:server connect并提供凭据(neo4j和新密码)以建立与Neo4J的连接:</p><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lj"><img src="../Images/68145c89685dd320eac4765bbaba09f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*SmTbuvXign9yI-0F.png"/></div></div></figure><p id="774e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在可以执行第一个Cypher查询:match (n) return n(相当于关系数据库中的select * from <all tables="" in="" the="" schema="">)。它不会返回任何结果，因为还没有数据加载到数据库中。</all></p><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lw"><img src="../Images/646b65ff665f8b7ef78ac9cc3c7f0934.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gxMDt3ubIdXXVHWk.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">Selecting all objects from the Neo4J database instance</figcaption></figure><h1 id="510f" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">3.运行节点JS容器映像</h1><p id="e79e" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">要运行干净的节点环境，请执行以下命令:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="0ce6" class="le jt hh la b fi lf lg l lh li">docker run -it --rm -p 8080:8080 node:10 bash</span></pre><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lj"><img src="../Images/648f9ae01477efc5f6f081fa9b39b2b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qM3YDIRTIcQbse76.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">Running a Docker container image for a clean Node 10 runtime environment</figcaption></figure><p id="671e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这使用节点10运行时环境运行容器，容器中的端口8080暴露在Docker主机上的端口8080处。这允许我们运行一个节点应用程序，它可以在端口8080处理HTTP请求，并通过Docker主机上的端口8080访问它。容器以交互模式运行。对于带有节点JS运行时环境的容器内的shell会话，显示了命令提示符。</p><h1 id="b552" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">4.Git克隆GitHub Repo</h1><p id="bfd2" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">要获得Node JS应用程序的源代码，从GitHub克隆一个存储库:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="2d5d" class="le jt hh la b fi lf lg l lh li">git clone <a class="ae jd" href="https://github.com/AMIS-Services/code-cafe" rel="noopener ugc nofollow" target="_blank">https://github.com/AMIS-Services/code-cafe</a></span></pre><p id="196c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">然后更改目录:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="dbd5" class="le jt hh la b fi lf lg l lh li">cd code-cafe/neo4j-graphdatabase/</span></pre><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lj"><img src="../Images/64c5728eb3728e920260184d6f32a4cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3V8jAB1AWdNihAE0.png"/></div></div></figure><h1 id="06b9" class="js jt hh bd ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp bi translated">5.运行节点应用程序</h1><p id="d7a3" class="pw-post-body-paragraph ie if hh ig b ih kq ij ik il kr in io ip ks ir is it kt iv iw ix ku iz ja jb ha bi translated">在运行节点应用程序之前，我们首先需要安装所有的依赖项(如package.json中所定义的)。执行:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="5691" class="le jt hh la b fi lf lg l lh li">npm install</span></pre><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lx"><img src="../Images/43b8059f3ceebcef4216438bb0c11973.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BzUq9jh3c7tPK9aQ.png"/></div></div></figure><p id="9289" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">检查文件“neo4j-node.js”的内容，了解如何通过JavaScript与neo4j进行交互。确保使用您的环境的用户、密码和uri的相关值编辑该文件。</p><p id="13f3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在可以执行应用程序(文件neo4j-node.js)了。您可以使用“npm start”运行“neo4j-node.js”。</p><p id="1891" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">节点程序将从GitHub(https://raw . githubusercontent . com/mle doze/countries/master/countries . JSON)中检索一个带有国家的JSON文档。它为区域、次区域和语言，当然也为所有国家建立了节点。它建立了从国家到它们所属的区域和次区域、所讲的语言以及与它们接壤的所有其他国家的关系。</p><p id="0ee3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">节点代码检索带有国家详细信息的JSON文档，并使用一些非常优雅的代码创建带有地区、子地区和语言的唯一值的便利集合:</p><p id="3eb9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jd" href="https://gist.github.com/lucasjellema/f3aedc9f9985bbfd87867f804d028476" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/lucasjellema/F3 aedc 9 f 9985 bbfd 87867 f 804d 028476</a></p><p id="ae4f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">程序将显示关于它正在做什么的输出——包括它正在执行的文字密码语句。注意:在Neo4J中创建所有节点和边可能需要几分钟时间。</p><p id="ef1b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在程序执行结束时，它将显示如下输出:</p><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es ly"><img src="../Images/077a39c63918afe6296ccd77c29028e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*gL6_gFDZQ8bNKzKK.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">Last section of output from neo4j-node.js</figcaption></figure><p id="24ae" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里回答了从法国到印度的最短路径是什么——需要穿越的陆地边界最少。这个问题以密码查询的形式向Neo4J提出:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="9177" class="le jt hh la b fi lf lg l lh li">Match path = shortestpath( (f:Country{name:'France'}) –[:BORDERS_WITH *1..15]-(p:Country{name:'India'})) return path</span></pre><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lj"><img src="../Images/8a1203a40c08f8fd0b55d02210da8aab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6eZrdCiEHVFaRYoi.png"/></div></div></figure><p id="d144" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果在浏览器用户界面中执行此查询，我们将获得查询结果的图形表示:</p><figure class="kv kw kx ky fd lk er es paragraph-image"><div class="er es lz"><img src="../Images/61f82149dbf295dab47079d2a0caa864.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/0*Ol4T6m9f4Y2W7T9W.png"/></div><figcaption class="ls lt et er es lu lv bd b be z dx">Shortest path (in terms of number of nodes to visit) from France to India</figcaption></figure><p id="e4c1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在常规SQL中，这种查询在大多数关系数据库中不是非常容易(也不是非常快速)。但是，请把这篇文章仅仅看作是对Node程序如何与Neo4J交互以及如何使用Cypher查询数据的快速介绍，重点是关系。</p><p id="f574" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">显然，用不同的国家代替法国和印度也可以提出类似的问题。</p><p id="9503" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Neo4J数据库中包含的其他数据:语言(节点)和每个国家使用的语言(边)。检索所有讲法语的国家的简单查询:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="90b7" class="le jt hh la b fi lf lg l lh li">match (f:Language{name:'French'})&lt;- []-(l) return f,l</span></pre><p id="fdfd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">还有一个稍微简单一点的查询，查找所有不说法语的国家，并返回他们说的语言:</p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="0b97" class="le jt hh la b fi lf lg l lh li">MATCH (french:Language{name:'French'}),(c:Country)-[spk:SPEAKS]-&gt; (l) WHERE NOT (c)--&gt;(french) RETURN c, l;</span></pre><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es lj"><img src="../Images/a0729f1954f416cf86c9c1851929abb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*nE5yUreM079xsPCD.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">All countries that do not speak French and the languages they do speak</figcaption></figure><p id="e006" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后一个例子:所有不说法语的法国邻国——以及他们<em class="jc">说的语言:</em></p><pre class="kv kw kx ky fd kz la lb lc aw ld bi"><span id="5a62" class="le jt hh la b fi lf lg l lh li">match (french:Language{name:'French'}), (f:Country{name:'France'})- [:BORDERS_WITH]-&gt;(bc)-[:SPEAKS]-&gt; (language) WHERE NOT (bc)--&amp;gt;(french) return f,bc, language</span></pre><figure class="kv kw kx ky fd lk er es paragraph-image"><div role="button" tabindex="0" class="ll lm di ln bf lo"><div class="er es ma"><img src="../Images/e725be17a908e4c48667df474010b1ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1bsGag9iVXh3eLzO.png"/></div></div><figcaption class="ls lt et er es lu lv bd b be z dx">France, all its neighbouring countries that do no speak French and the Languages they do speak</figcaption></figure></div><div class="ab cl mb mc go md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ha hb hc hd he"><p id="34f4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="jc">原载于2019年1月1日</em><a class="ae jd" href="https://technology.amis.nl/2019/01/01/finding-the-shortest-path-from-country-a-to-country-b-using-neo4j-and-node/" rel="noopener ugc nofollow" target="_blank"><em class="jc">technology . amis . nl</em></a><em class="jc">。</em></p></div></div>    
</body>
</html>