<html>
<head>
<title>Membuat Referensi Lokasi Customer</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Membuat Referensi Lokasi Customer</h1>
<blockquote>原文：<a href="https://medium.easyread.co/membuat-referensi-lokasi-customer-df75810e5a14?source=collection_archive---------5-----------------------#2020-01-25">https://medium.easyread.co/membuat-referensi-lokasi-customer-df75810e5a14?source=collection_archive---------5-----------------------#2020-01-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="5832" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">Simple Tutorial Geospatial Query</h2></div><p id="c00f" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Latar belakang dari tulisan ini adalah <em class="ky"> project </em> untuk membuat <em class="ky"> pricing product </em> berdasarkan lokasi. Dengan harga produk yang sesuai lokasi customer diharapkan bisa meningkatkan jumlah transaksi yang pada akhirnya meningkatkan revenue.</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi kz"><img src="../Images/5b9d74cd5e3faaa4375232f9108731f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4kqEkYybLC0vnS0RFqg1Fw.jpeg"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk"><a class="ae lp" href="https://postgis.net/" rel="noopener ugc nofollow" target="_blank">https://postgis.net/</a></figcaption></figure><p id="befd" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Hal penting dari <em class="ky"> project </em> ini adalah bagaimana mendapatkan informasi lokasi yang sudah dinormalisasi. Dengan <em class="ky"> output </em> ini, kegunaannya bisa untuk berbagai hal lain berikut:</p><ul class=""><li id="787e" class="lq lr in ke b kf kg ki kj kl ls kp lt kt lu kx lv lw lx ly bi translated">Pricing product berdasarkan lokasi</li><li id="d744" class="lq lr in ke b kf lz ki ma kl mb kp mc kt md kx lv lw lx ly bi translated">Product Catalog berdasarkan lokasi</li><li id="2271" class="lq lr in ke b kf lz ki ma kl mb kp mc kt md kx lv lw lx ly bi translated">Promo berdasarkan POI</li><li id="90c3" class="lq lr in ke b kf lz ki ma kl mb kp mc kt md kx lv lw lx ly bi translated">Fraud detection</li></ul><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi me"><img src="../Images/c6170e1e74c821d1e8c2ecc76795190a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0EmdYH-e63H97SpcbIEi5A.png"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk">Flow proses deteksi lokasi dari lat/long</figcaption></figure><p id="a5b4" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Penggunaan geospatial query (database lokasi dan ruang) pada umumnya menggunakan <a class="ae lp" href="https://postgis.net/" rel="noopener ugc nofollow" target="_blank"> PostGIS </a> yang merupakan modul tambahan di postgreSQL. PostGIS cocok untuk segala jenis kebutuhan query geospatial terutama yang complex dan data yang besar. Karena kebutuhan project ini sederhana dan data referensi yang tidak complex penulis mencoba menggunakan open source <a class="ae lp" href="https://github.com/tidwall/tile38" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> tile38 </strong> </a> <strong class="ke io"> , </strong> sumber dari referensi <a class="ae lp" href="https://news.ycombinator.com/item?id=16526929" rel="noopener ugc nofollow" target="_blank"> ini </a> .</p><h2 id="5b93" class="mf mg in bd mh mi mj dn mk ml mm dp mn kl mo mp mq kp mr ms mt kt mu mv mw mx bi translated"><strong class="ak"> <em class="my"> Langkah-Langkah Menggunakan tile38 </em> </strong></h2><ul class=""><li id="998a" class="lq lr in ke b kf mz ki na kl nb kp nc kt nd kx lv lw lx ly bi translated"><strong class="ke io"> Download dan jalankan tile38 server </strong></li></ul><pre class="la lb lc ld gt ne nf ng nh aw ni bi"><span id="0fe9" class="mf mg in nf b gy nj nk l nl nm"><strong class="nf io">tile38-server</strong></span></pre><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi nn"><img src="../Images/5f403b23e2ce115bd3303c2271245559.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Rp9TR2x7Ox0AHxbGyNVoAg.png"/></div></div></figure><ul class=""><li id="3725" class="lq lr in ke b kf kg ki kj kl ls kp lt kt lu kx lv lw lx ly bi translated"><strong class="ke io"> Membuat referensi lokasi </strong></li></ul><p id="510d" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Penentuan lokasi dan standarisasi nama lokasi sangat penting, karena lokasi ini yang nanti digunakan sebagai referensi, misalnya kita akan mencantumkan lokasi dan harganya di product catalog. Referensi lokasi bisa apa aja, misal kita bisa definiskan sendiri area daya beli tinggi dengan area lat/long perkotaan dan area daya beli rendah di lat/long pedesaan. Di project ini, kita akan mencoba menggunakan data city (kabupaten/kota) indonesia dengan data yang diambil dari <a class="ae lp" href="https://datahub.io/JemputData/location_id" rel="noopener ugc nofollow" target="_blank"> website </a> ini, total 512 kab/kota indonesia.</p><p id="f760" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Selanjutnya kita buat script untuk load data ke tile38</p><pre class="la lb lc ld gt ne nf ng nh aw ni bi"><span id="6132" class="mf mg in nf b gy nj nk l nl nm">#!/bin/bash<br/>start_time="$(date -u +%s)"<br/>server=$1<br/>file=$2<br/>i=0<br/>#telnet 127.0.0.1 9851 &lt;&lt;EOF<br/>while IFS= read -r line<br/>do<br/>    echo "$line"<br/>    IFS=',' #delimiter<br/>    read -r var1 var2 var3 &lt;&lt;&lt; "$line" # Dijadikan array<br/>    key=${var1// /_}<br/>    echo "$server/set+fleet+$key+point+$var2+$var3"<br/>    curl "$server/set+fleet+$key+point+$var2+$var3"<br/>     ((i=i+1))<br/>done &lt; "$file"<br/>end_time="$(date -u +%s)"<br/>elapsed="$(bc &lt;&lt;&lt;"$end_time-$start_time")"<br/>echo "Total of $elapsed seconds elapsed for $i process"</span></pre><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi no"><img src="../Images/7d8513d1e792093703a673d8438112b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kXJugNCWPdbm3PfvzRxCPg.png"/></div></div></figure><ul class=""><li id="0797" class="lq lr in ke b kf kg ki kj kl ls kp lt kt lu kx lv lw lx ly bi translated"><strong class="ke io"> Testing lokasi nearby </strong></li></ul><p id="c8fa" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Kita coba test dengan menggunakan lat long dimana penulis berada</p><pre class="la lb lc ld gt ne nf ng nh aw ni bi"><span id="832e" class="mf mg in nf b gy nj nk l nl nm">#nearby fleet point {lat} {long} {radius-meter}</span><span id="f1dc" class="mf mg in nf b gy np nk l nl nm">$ tile38-cli<br/>$ nearby fleet point -6.330212 106.826378 9000</span></pre><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi nq"><img src="../Images/27fe2f153ca1bf0e9c7823538f36fe76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4XVhMR86p-91jKX--TBEEg.png"/></div></div></figure><h2 id="1df4" class="mf mg in bd mh mi mj dn mk ml mm dp mn kl mo mp mq kp mr ms mt kt mu mv mw mx bi translated"><strong class="ak"> Problem </strong></h2><p id="1355" class="pw-post-body-paragraph kc kd in ke b kf mz jo kh ki na jr kk kl nr kn ko kp ns kr ks kt nt kv kw kx ig bi translated">Karena kita bukan perusahaan transportasi yang mengharuskan pelanggan mengaktikan fitur lokasi/gps, sehingga data lat-long tidak selalu dikirim dari apps. Solusinya kita akan mencoba menggunakan lat-long dari IP mobile client.</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi nu"><img src="../Images/60c04f6f2861d9fc39d0b5aaebc77bfb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C2lfV9CJrazG56i4WnTjFQ.png"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk">Flow proses tambahan dengan input IP karena tidak ada lat/long</figcaption></figure><p id="7e85" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><a class="ae lp" href="https://lite.ip2location.com/database/ip-country-region-city-latitude-longitude" rel="noopener ugc nofollow" target="_blank"> <strong class="ke io"> IP2Location </strong> </a> ini penyedia translasi dari IP ke beberapa profile seperti region, city, lat/long. Dalam hal ini kita hanya akan menggunakan IP untuk mendapatkan lat/long. Kenapa tidak langsung translasi ke city saja? Karena city belum tentu sama dengan kab/kota referensi kita.</p><pre class="la lb lc ld gt ne nf ng nh aw ni bi"><span id="b1bf" class="mf mg in nf b gy nj nk l nl nm">import (<br/> "fmt"</span><span id="d038" class="mf mg in nf b gy np nk l nl nm">"github.com/ip2location/ip2location-go"<br/>)</span><span id="7646" class="mf mg in nf b gy np nk l nl nm">func main() {<br/> ip2location.Open("/Users/mfstech/Downloads/IP2LOCATION-LITE-DB5.BIN")<br/> ip := "180.249.192.0"</span><span id="070e" class="mf mg in nf b gy np nk l nl nm">results := ip2location.Get_all(ip)</span><span id="7ab8" class="mf mg in nf b gy np nk l nl nm">fmt.Printf("country_short: %s\n", results.Country_short)<br/> fmt.Printf("country_long: %s\n", results.Country_long)<br/> fmt.Printf("region: %s\n", results.Region)<br/> fmt.Printf("city: %s\n", results.City)<br/> fmt.Printf("isp: %s\n", results.Isp)<br/> fmt.Printf("latitude: %f\n", results.Latitude)<br/> fmt.Printf("longitude: %f\n", results.Longitude)<br/> <br/> ip2location.Close()<br/>}</span></pre><h2 id="79b0" class="mf mg in bd mh mi mj dn mk ml mm dp mn kl mo mp mq kp mr ms mt kt mu mv mw mx bi translated"><strong class="ak"> Implementasi </strong></h2><p id="5ae1" class="pw-post-body-paragraph kc kd in ke b kf mz jo kh ki na jr kk kl nr kn ko kp ns kr ks kt nt kv kw kx ig bi translated">Supaya mudah untuk diimplementasi dan tidak mengganggu <em class="ky"> service </em> yang ada, kita bisa menggunakan arsitektur log aggregator seperti dibawah.</p><figure class="la lb lc ld gt le gh gi paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="gh gi nv"><img src="../Images/e36ba57e163a78a4d289aec70e6d5a90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p4MFVdyVxjmuOMonA3P4IA.png"/></div></div><figcaption class="ll lm gj gh gi ln lo bd b be z dk">Flow proses keseluruhan deteksi lokasi sehingga menjadi database referensi lokasi</figcaption></figure><p id="a49b" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated"><strong class="ke io"> Keterangan gambar: </strong></p><ul class=""><li id="c8d0" class="lq lr in ke b kf kg ki kj kl ls kp lt kt lu kx lv lw lx ly bi translated">Setup log consumer (filebeat) supaya bisa membaca log dan mengirimkan ke Queue (kafka) sebagai sumber data mentah.</li><li id="2bfa" class="lq lr in ke b kf lz ki ma kl mb kp mc kt md kx lv lw lx ly bi translated">Proses parsing log untuk mendapatkan key value (key,lat/long) atau (key,IP). Key bisa kita tautkan dengan customerID</li><li id="3702" class="lq lr in ke b kf lz ki ma kl mb kp mc kt md kx lv lw lx ly bi translated">Deteksi dan normalisasi lokasi dari lat/long atau IP menjadi kab/kota yang penamaannya sudah standard. Proses deteksi ini bisa dibantu dengan penggunaan tile38 menggunakan command nearby.</li><li id="2181" class="lq lr in ke b kf lz ki ma kl mb kp mc kt md kx lv lw lx ly bi translated">Masukan hasil output key-value (customerID, Kab/Kota) ke repository database (redis) yang nantinya bisa dipakai oleh <em class="ky"> service </em> lain.</li></ul><h2 id="a985" class="mf mg in bd mh mi mj dn mk ml mm dp mn kl mo mp mq kp mr ms mt kt mu mv mw mx bi translated"><strong class="ak"> Kesimpulan </strong></h2><ul class=""><li id="5c8c" class="lq lr in ke b kf mz ki na kl nb kp nc kt nd kx lv lw lx ly bi translated">Kita bisa menggunakan geospatial query untuk membuat referensi lokasi customer dengan data mentah lat/long atau IP untuk selanjutnya ditranslate menjadi lokasi yang sudah standard.</li><li id="2ced" class="lq lr in ke b kf lz ki ma kl mb kp mc kt md kx lv lw lx ly bi translated">Ketika ada solusi untuk suatu requirement, coba dibuat sebagai service yang reusable sehingga bisa dibuatkan secara generic dan standard dan bisa dimanfaatkan untuk lebih banyak service.</li><li id="7a3a" class="lq lr in ke b kf lz ki ma kl mb kp mc kt md kx lv lw lx ly bi translated">Design pattern log aggregator bisa dimanfaatkan untuk kebutuhan service semisal referensi data.</li></ul><p id="3013" class="pw-post-body-paragraph kc kd in ke b kf kg jo kh ki kj jr kk kl km kn ko kp kq kr ks kt ku kv kw kx ig bi translated">Terima kasih sudah membaca, semoga tulisan ini bisa bermanfaat atau membuat ide-ide baru buat pembaca :D</p></div><div class="ab cl nw nx hr ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ig ih ii ij ik"><figure class="la lb lc ld gt le"><div class="bz fp l di"><div class="od oe l"/></div></figure></div></div>    
</body>
</html>