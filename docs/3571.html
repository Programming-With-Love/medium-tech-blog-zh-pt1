<html>
<head>
<title>Snapshot Testing (FBSnapshotTestCase / iOSSnapshotTestCase)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">快照测试(FBSnapshotTestCase/iosnapshottestcase)</h1>
<blockquote>原文：<a href="https://medium.com/globant/snapshot-testing-fbsnapshottestcase-iossnapshottestcase-8fa9cc8cbb37?source=collection_archive---------1-----------------------#2020-12-08">https://medium.com/globant/snapshot-testing-fbsnapshottestcase-iossnapshottestcase-8fa9cc8cbb37?source=collection_archive---------1-----------------------#2020-12-08</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/7d3a82bd86a057493b55722e6f70f6bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ct_pJcY9gm7_1ydu.png"/></div></div></figure><h1 id="f655" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">它的作用</h1><p id="038d" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">FBSnapshotTestCase被重命名为iOSSnapshotTestCase。“快照测试用例”采用一个已配置的UIView或CALayer，并使用必要的UIKit或核心动画方法来生成其内容的图像快照。</p><p id="d473" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">iOSSnapshotTestCase在预定义的路径上创建一个参考图像，并将其与代码生成的实际图像进行比较。只有一个像素变化可能是失败的测试案例。</p><p id="c633" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">iOSSnapshotTestCase在您使用多个用户界面以及错误地更改用户界面时非常有用。</p><h1 id="4ce0" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">装置</h1><h1 id="b4fc" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">步骤1:为项目中的快照测试创建测试目标</h1><figure class="kr ks kt ku fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es kq"><img src="../Images/2d63a90234df537ea48bb24965ba7739.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Q8bJ8nOZc2P4teeU.png"/></div></div></figure><h1 id="66a7" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">步骤2:将iOSSnapshotTestCase添加到项目中</h1><blockquote class="kv kw kx"><p id="e28e" class="jn jo ky jp b jq kl js jt ju km jw jx kz kn ka kb la ko ke kf lb kp ki kj kk ha bi translated"><em class="hh">确保在测试目标中添加pod，而不是在应用程序目标中。</em></p></blockquote><h1 id="9029" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">椰子:</h1><p id="5b93" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated"><em class="ky">将以下几行添加到您的podfile: </em></p><p id="d997" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">对于Swift:</p><pre class="kr ks kt ku fd lc ld le lf aw lg bi"><span id="0d79" class="lh iq hh ld b fi li lj l lk ll">target “AppTests” douse_frameworks!pod ‘iOSSnapshotTestCase’end</span></pre><p id="8a5c" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">对于目标C:(不包含Swift支持)</p><pre class="kr ks kt ku fd lc ld le lf aw lg bi"><span id="af77" class="lh iq hh ld b fi li lj l lk ll">target “AppTests” douse_frameworks!pod ‘iOSSnapshotTestCase/Core’end</span></pre><h1 id="aebf" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">迦太基:</h1><p id="9657" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated"><em class="ky">在你的c </em> artfile <em class="ky">中添加以下几行:</em></p><pre class="kr ks kt ku fd lc ld le lf aw lg bi"><span id="e5ae" class="lh iq hh ld b fi li lj l lk ll">github "uber/ios-snapshot-test-case" ~&gt; 6.1.0</span></pre><h1 id="74a9" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">步骤3:设置测试方案</h1><blockquote class="kv kw kx"><p id="19af" class="jn jo ky jp b jq kl js jt ju km jw jx kz kn ka kb la ko ke kf lb kp ki kj kk ha bi translated"><em class="hh">用提到的名称和值</em>在下面的路径中添加环境变量</p></blockquote><h1 id="3499" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">应用目标-&gt;编辑方案-&gt;运行-&gt;环境变量</h1><figure class="kr ks kt ku fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lm"><img src="../Images/64e1484af0153439454539da55966455.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iSUThBf0ZowN3IhD.png"/></div></div></figure><p id="8e60" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><strong class="jp hi">FB _ REFERENCE _ IMAGE _ DIR</strong>:$(SOURCE _ ROOT)/$(PROJECT _ NAME)测试/引用图像</p><p id="27e8" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><strong class="jp hi">IMAGE _ DIFF _ DIR</strong>:$(SOURCE _ ROOT)/$(PROJECT _ NAME)测试/失败差异</p><blockquote class="kv kw kx"><p id="5e8e" class="jn jo ky jp b jq kl js jt ju km jw jx kz kn ka kb la ko ke kf lb kp ki kj kk ha bi translated"><em class="hh">这里我们使用FB_REFERENCE_IMAGE_DIR和IMAGE_DIFF_DIR来存储特定路径上的参考和失败/diffs图像。</em></p></blockquote><h1 id="0e67" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">履行</h1><ol class=""><li id="4ff6" class="ln lo hh jp b jq jr ju jv jy lp kc lq kg lr kk ls lt lu lv bi translated">子类FBSnapshotTestCase而不是XCTestCase。</li></ol><p id="2ea8" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">2.在测试中，根据需要使用FBSnapshotVerifyView或FBSnapshotVerifyViewController。</p><p id="a40e" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">3.使用self.recordMode = true运行一次测试；在测试的设置方法中。</p><p id="f442" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">4.删除启用记录模式的行(self.recordMode = true)并运行测试。</p><figure class="kr ks kt ku fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lw"><img src="../Images/50b4d4d41638b6e1378d8e43aa48e5d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*E5bGE-yYZVqLXZuv.png"/></div></div></figure><blockquote class="kv kw kx"><p id="7c7b" class="jn jo ky jp b jq kl js jt ju km jw jx kz kn ka kb la ko ke kf lb kp ki kj kk ha bi translated">当你在一个测试方法中编写多个测试用例时，确保为每个项目添加不同的标识符。</p></blockquote><figure class="kr ks kt ku fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lx"><img src="../Images/21d14b62b79b154543bbffcb4ca977f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*s2gSwis-7xhTVUYP.png"/></div></div></figure><p id="b936" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">现在你一定有一个问题，它如何与动态用户界面的工作。用简单语言，我们将把动态用户界面变成静态用户界面。这里我们将在设置方法中提供静态文本。您可以为每个元素提供模拟数据。</p><figure class="kr ks kt ku fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ly"><img src="../Images/bc3ec691982d2a11eee94680fdeeef4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GoVClndXFJvNnxqj.png"/></div></div></figure><p id="c67e" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">有时，在为元素添加模拟文本时，您可能会在设置方法中遇到应用程序崩溃问题。因为视图找不到框架。因此，在这种情况下，我们必须为视图添加框架。</p><figure class="kr ks kt ku fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lz"><img src="../Images/e2141cf344014fd1075f53f3262902c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-oKykE-PPU7eVqX9.png"/></div></div></figure></div><div class="ab cl ma mb go mc" role="separator"><span class="md bw bk me mf mg"/><span class="md bw bk me mf mg"/><span class="md bw bk me mf"/></div><div class="ha hb hc hd he"><h1 id="a546" class="ip iq hh bd ir is mh iu iv iw mi iy iz ja mj jc jd je mk jg jh ji ml jk jl jm bi translated">额外:</h1><blockquote class="kv kw kx"><p id="01fb" class="jn jo ky jp b jq kl js jt ju km jw jx kz kn ka kb la ko ke kf lb kp ki kj kk ha bi translated"><em class="hh">iosnapshottestcase总共创建2个文件夹。</em></p><p id="0b7f" class="jn jo ky jp b jq kl js jt ju km jw jx kz kn ka kb la ko ke kf lb kp ki kj kk ha bi translated"><em class="hh"> 1) ReferenceImages_64 </em></p><p id="bcc2" class="jn jo ky jp b jq kl js jt ju km jw jx kz kn ka kb la ko ke kf lb kp ki kj kk ha bi translated"><em class="hh">当我们记录图像时，它将在此生成，其名称为:功能名称+标识符(如果已添加)</em></p><p id="9ab7" class="jn jo ky jp b jq kl js jt ju km jw jx kz kn ka kb la ko ke kf lb kp ki kj kk ha bi translated">2)故障差异</p><p id="36a3" class="jn jo ky jp b jq kl js jt ju km jw jx kz kn ka kb la ko ke kf lb kp ki kj kk ha bi translated"><em class="hh">当测试用例失败时，它将创建失败图像和差异图像(参考图像和失败图像的组合)</em></p></blockquote><figure class="kr ks kt ku fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mm"><img src="../Images/a1ff9902e69adaedd0cc1f86dd4971d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rbUv1yuykZwHduOY.png"/></div></div></figure><h1 id="db1e" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">优点:</h1><p id="c4a9" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">当我们在一个控制器中创建多个UI类时，测试就变得容易了。不要点击我的应用程序来查看正确的视图。它为我提供了一种测试视图相关代码的方法，并且它可以用来可视化视图状态，而不用在模拟器或真实设备中跳来跳去。</p><h1 id="71eb" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">缺点:</h1><p id="74c9" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">当您的参考映像和当前模拟器设备不同时，测试用例将失败。作为它的匹配像素。</p><h1 id="22f8" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">结论</h1><p id="1854" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated"><em class="ky"> FBSnapshotTestCase </em>让我们能够进行单个测试，并立即看到我们对不同状态所做的更改。快照测试速度很快。在一个应用程序的测试套件中有很多测试是没有问题的。如果你还没有用过，你应该试一试。</p><p id="b871" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">参考来自<a class="ae mn" href="https://github.com/uber/ios-snapshot-test-case#carthage" rel="noopener ugc nofollow" target="_blank"> GITHUB </a> <br/>参考图片来自<a class="ae mn" href="https://www.raywenderlich.com/5043-ios-snapshot-test-case-testing-the-ui" rel="noopener ugc nofollow" target="_blank"> Raywenderlich </a></p></div></div>    
</body>
</html>