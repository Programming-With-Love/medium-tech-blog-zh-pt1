<html>
<head>
<title>Setting up HTTPS for your e-commerce website with Let’s Encrypt and Google App Engine.</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Let's Encrypt和Google App Engine为您的电子商务网站设置HTTPS。</h1>
<blockquote>原文：<a href="https://medium.com/square-corner-blog/setting-up-https-for-your-e-commerce-website-with-lets-encrypt-and-google-app-engine-465a866790b5?source=collection_archive---------0-----------------------#2017-05-09">https://medium.com/square-corner-blog/setting-up-https-for-your-e-commerce-website-with-lets-encrypt-and-google-app-engine-465a866790b5?source=collection_archive---------0-----------------------#2017-05-09</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="f291" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated"><em class="iw"> HTTPS是确保客户网络信息安全的重要组成部分——这里有一个快速教程，教你如何在App Engine网站上设置HTTPS，以使用我们的电子商务API。</em></h2></div><p id="8de6" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">网络安全非常重要，尤其是当有人信任你并向你提供他们的支付卡信息时。尽管Square为您处理PCI合规性的复杂部分，但我们确实要求您的电子商务表单从HTTPS域提供服务。网上有很多关于为什么你的网站应该使用HTTPS的文献(包括谷歌的<a class="ae jt" href="https://developers.google.com/web/fundamentals/security/encrypt-in-transit/why-https" rel="noopener ugc nofollow" target="_blank">这篇很棒的文章)，所以让我们来关注如何为你的网站获得一个证书。我用我的个人网站来演示一下。</a></p><figure class="jv jw jx jy fd jz er es paragraph-image"><div class="er es ju"><img src="../Images/efe06d93705e8b983b6b42554765639d.png" data-original-src="https://miro.medium.com/v2/resize:fit:766/0*thKBfRNDffIdGrSl."/></div><figcaption class="kc kd et er es ke kf bd b be z dx">No HTTPS here 😔 …yet</figcaption></figure><h1 id="f3d7" class="kg kh hh bd ki kj kk kl km kn ko kp kq in kr io ks iq kt ir ku it kv iu kw kx bi translated">步骤0:做好准备。</h1><p id="0b96" class="pw-post-body-paragraph ix iy hh iz b ja ky ii jc jd kz il jf jg la ji jj jk lb jm jn jo lc jq jr js ha bi translated">本演练假设您具备以下条件:</p><ul class=""><li id="e9fb" class="ld le hh iz b ja jb jd je jg lf jk lg jo lh js li lj lk ll bi translated">你的电子商务网站的域名</li><li id="5659" class="ld le hh iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated">您托管网站的网络服务器或托管服务</li><li id="5988" class="ld le hh iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated">安装在您电脑上的OpenSSL </li></ul><p id="b0e6" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">我将为我的个人网站<a class="ae jt" href="http://www.tristansokol.com" rel="noopener ugc nofollow" target="_blank">www.tristansokol.com</a>启用HTTPS。我使用谷歌应用引擎为我的网站服务，并将使用<a class="ae jt" href="https://letsencrypt.org/" rel="noopener ugc nofollow" target="_blank">让我们加密</a>——一个免费的、自动化的、开放的认证机构。</p><p id="791a" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">如果你使用不同的虚拟主机，最好看看你的虚拟主机是否支持直接加密。如果是这样的话，为你的网站启用它应该是相当容易的。你可以在这里看到支持的虚拟主机提供商列表:<a class="ae jt" href="https://community.letsencrypt.org/t/web-hosting-who-support-lets-encrypt/6920" rel="noopener ugc nofollow" target="_blank">https://community . lets encrypt . org/t/we B- hosting-who-support-lets-encrypt/6920</a>。</p><p id="84ac" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">还有各种各样的其他证书颁发机构可以为您付费提供类似或更高级的服务。</p><h1 id="fd70" class="kg kh hh bd ki kj kk kl km kn ko kp kq in kr io ks iq kt ir ku it kv iu kw kx bi translated">步骤1:生成您的私钥和CSR(证书签名请求)</h1><p id="15f8" class="pw-post-body-paragraph ix iy hh iz b ja ky ii jc jd kz il jf jg la ji jj jk lb jm jn jo lc jq jr js ha bi translated">首先，使用OpenSSL生成一个新的私钥和证书签名请求。</p><pre class="jv jw jx jy fd lr ls lt lu aw lv bi"><span id="3aef" class="lw kh hh ls b fi lx ly l lz ma">$ openssl req -newkey rsa:2048 -keyout tristansokol.com.private.key -nodes -sha512 -subj "/CN=tristansokol.com" -reqexts SAN -out tristansokol.com.csr.der -outform der -config &lt;(cat /System/Library/OpenSSL/openssl.cnf &lt;(printf "[SAN]\nsubjectAltName=DNS:tristansokol.com,DNS:www.tristansokol.com"))</span></pre><p id="edf3" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">这个命令相当长，所以让我们把它分解一下:</p><ul class=""><li id="e011" class="ld le hh iz b ja jb jd je jg lf jk lg jo lh js li lj lk ll bi translated"><code class="du mb mc md ls b">openssl req</code>是证书请求生成实用程序的命令。</li><li id="7ac4" class="ld le hh iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated"><code class="du mb mc md ls b">-newkey</code>标志告诉openssl我们想要创建一个新的请求和一个新的私钥。它需要一个关于使用哪种算法和生成多大的密钥的争论。在本例中，我指定了一个2048位的RSA密钥。</li><li id="cc7c" class="ld le hh iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated"><code class="du mb mc md ls b">-keyout</code>指定新私钥的写入位置。请记住，我建议您更改文件名以匹配您的网站(而不是我的网站)。</li><li id="ce2f" class="ld le hh iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated"><code class="du mb mc md ls b">-nodes</code>不是“节点”这个词。它指定“no DES”并表示我不想加密新的私钥。</li><li id="931a" class="ld le hh iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated"><code class="du mb mc md ls b">-sha512</code>是我选中的消息摘要来签署我们的请求。</li><li id="8e9a" class="ld le hh iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated"><code class="du mb mc md ls b">-subj</code>设置新请求的主题名称。在这种情况下，我想签署一个域名，所以我将使用我的网站的通用名称(CN)，因此<code class="du mb mc md ls b">“/CN=tristansokol.com” </code>。</li><li id="1bb3" class="ld le hh iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated"><code class="du mb mc md ls b">-reqexts</code>是使用证书请求扩展的标志。在这种情况下，我将对裸域使用主题别名(SAN ),而www。我的网站的版本。</li><li id="e137" class="ld le hh iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated"><code class="du mb mc md ls b">-out</code>指定要写入证书请求的文件名。</li><li id="1160" class="ld le hh iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated"><code class="du mb mc md ls b">-outform</code>让您选择<code class="du mb mc md ls b">der</code>或<code class="du mb mc md ls b">pem</code>输出格式。</li><li id="a9a3" class="ld le hh iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated"><code class="du mb mc md ls b">-config</code>用来指定我们的配置文件。为了使它更简洁，我在这个文件的创建中内嵌了关于我们的网站使用的替代名称的选项。同样，请确保将这些更改为您自己的域。</li></ul><p id="2ab1" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">你可以在官方手册页上阅读更多关于<code class="du mb mc md ls b">openssl req</code>的选项:<a class="ae jt" href="https://www.openssl.org/docs/man1.1.0/apps/req.html" rel="noopener ugc nofollow" target="_blank">https://www.openssl.org/docs/man1.1.0/apps/req.html</a></p><p id="267a" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">现在，您的工作目录中应该有两个新文件了(同样，您的将使用您的域名，而不是我的):</p><ul class=""><li id="b5c1" class="ld le hh iz b ja jb jd je jg lf jk lg jo lh js li lj lk ll bi translated"><code class="du mb mc md ls b">tristansokol.com.csr.der</code></li><li id="077f" class="ld le hh iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated"><code class="du mb mc md ls b">tristansokol.com.private.key</code></li></ul><h1 id="2076" class="kg kh hh bd ki kj kk kl km kn ko kp kq in kr io ks iq kt ir ku it kv iu kw kx bi translated">第二步。运行certbot命令</h1><p id="c755" class="pw-post-body-paragraph ix iy hh iz b ja ky ii jc jd kz il jf jg la ji jj jk lb jm jn jo lc jq jr js ha bi translated">Certbot (以前的Let's Encrypt客户端)是一个从Let's Encrypt获取证书的工具。我在Mac上，所以我将使用<code class="du mb mc md ls b">brew install certbot</code>进行安装。https://certbot.eff.org应该对你的系统有说明。</p><p id="562b" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">下次运行:</p><pre class="jv jw jx jy fd lr ls lt lu aw lv bi"><span id="cad3" class="lw kh hh ls b fi lx ly l lz ma">sudo certbot certonly -a manual --server<a class="ae jt" href="https://acme-v01.api.letsencrypt.org/directory" rel="noopener ugc nofollow" target="_blank"> https://acme-v01.api.letsencrypt.org/directory</a> --csr tristansokol.com.csr.der</span></pre><ul class=""><li id="2f82" class="ld le hh iz b ja jb jd je jg lf jk lg jo lh js li lj lk ll bi translated"><code class="du mb mc md ls b">-a</code>不带参数指定我们将不使用验证器插件。</li><li id="8cfa" class="ld le hh iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated"><code class="du mb mc md ls b">manual</code>表示我正在我的web服务器之外的机器上生成我的证书，并且我将自己进行域验证。</li><li id="795d" class="ld le hh iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated"><code class="du mb mc md ls b">--server </code>指定ACME目录资源。</li><li id="bd5c" class="ld le hh iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated">并且<code class="du mb mc md ls b">--csr</code>指定应该使用的证书签名请求(CSR)。在这种情况下，我将使用我在步骤1中创建的。</li></ul><p id="59e4" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">Certbot现在将带您完成一个引导式演练，以设置您的证书。最终，我走到了下面一步:</p><pre class="jv jw jx jy fd lr ls lt lu aw lv bi"><span id="2650" class="lw kh hh ls b fi lx ly l lz ma">Make sure your web server displays the following content at<a class="ae jt" href="http://tristansokol.com/.well-known/acme-challenge/xxx" rel="noopener ugc nofollow" target="_blank"> http://tristansokol.com/.well-known/acme-challenge/xxx</a> before continuing:</span></pre><p id="7f11" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">这是一个质询(url)和响应对，将用于证明您拥有该域。这意味着我需要向这个站点添加一个额外的请求处理程序来应对这些挑战。幸运的是，使用App Engine相当简单。</p><h1 id="e0ea" class="kg kh hh bd ki kj kk kl km kn ko kp kq in kr io ks iq kt ir ku it kv iu kw kx bi translated">第三步:迎接挑战</h1><p id="a956" class="pw-post-body-paragraph ix iy hh iz b ja ky ii jc jd kz il jf jg la ji jj jk lb jm jn jo lc jq jr js ha bi translated">为了在我的网站的挑战URL上提供挑战响应，我需要做一些事情。首先，我用我应该提供的响应创建了一个新的文本文件，并将其保存为ACME-response.txt。</p><pre class="jv jw jx jy fd lr ls lt lu aw lv bi"><span id="8b03" class="lw kh hh ls b fi lx ly l lz ma">#app.yaml<br/>#SSL challenge and response<br/>- url: /.well-known/acme-challenge/xxx<br/>  static_files: ACME-response.txt<br/>  upload: ACME-response.txt</span></pre><p id="1ce6" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">这告诉App Engine在<code class="du mb mc md ls b">/.well-known/acme-challenge/x(my challenge URL)</code>用我的响应内容来响应请求。然后，我使用带有<code class="du mb mc md ls b">dev_appserver.py app.yaml</code>的<a class="ae jt" href="https://cloud.google.com/appengine/docs/standard/php/tools/using-local-server#PHP_Running_the_development_web_server" rel="noopener ugc nofollow" target="_blank">本地开发服务器</a>，在使用<code class="du mb mc md ls b">gcloud app deploy</code>进行部署之前，再次检查一切是否正常。</p><p id="b752" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">对www重复这些步骤后。我的领域的版本，我可以继续。</p><h1 id="520a" class="kg kh hh bd ki kj kk kl km kn ko kp kq in kr io ks iq kt ir ku it kv iu kw kx bi translated">第二步。(续)使用Certbot结束</h1><p id="faa5" class="pw-post-body-paragraph ix iy hh iz b ja ky ii jc jd kz il jf jg la ji jj jk lb jm jn jo lc jq jr js ha bi translated">随着我的挑战响应准备就绪，Certbot生成了一个证书和两个证书链。</p><ul class=""><li id="51de" class="ld le hh iz b ja jb jd je jg lf jk lg jo lh js li lj lk ll bi translated"><code class="du mb mc md ls b">0000_cert.pem</code></li><li id="52ae" class="ld le hh iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated"><code class="du mb mc md ls b">0000_chain.pem</code></li><li id="8450" class="ld le hh iz b ja lm jd ln jg lo jk lp jo lq js li lj lk ll bi translated"><code class="du mb mc md ls b">0001_chain.pem</code></li></ul><h1 id="5c6b" class="kg kh hh bd ki kj kk kl km kn ko kp kq in kr io ks iq kt ir ku it kv iu kw kx bi translated">步骤4:将我的证书添加到应用引擎</h1><p id="6572" class="pw-post-body-paragraph ix iy hh iz b ja ky ii jc jd kz il jf jg la ji jj jk lb jm jn jo lc jq jr js ha bi translated">现在我已经验证并生成了所有东西，我可以转到我的app engine项目的<a class="ae jt" href="https://console.developers.google.com/project/_/appengine/settings/certificates" rel="noopener ugc nofollow" target="_blank">证书管理页面</a>并点击<strong class="iz hi">上传新证书</strong>。对于<em class="me"> PEM编码的X.509公钥证书</em>，我将上传我刚刚生成的<code class="du mb mc md ls b">0001_chain.pem</code>文件。对于<em class="me">未加密的PEM编码的RSA私有密钥</em>，我上传了第1步中的<code class="du mb mc md ls b">tristansokol.com.private.key</code>文件。</p><p id="112a" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">然后我为我的裸机和www启用了它。域。我还编辑了我的app.yaml文件，为页面的请求处理程序添加了<code class="du mb mc md ls b">secure always</code>。现在，当我导航到我的个人网站时，用户将被自动重定向到https版本，激发访问者对我的网站的信任，并保护我的电子商务客户的安全。</p><figure class="jv jw jx jy fd jz er es paragraph-image"><div class="er es mf"><img src="../Images/eda2790b2066899734e26350c6f9ff5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:730/0*ue81TZ3gVlAq3S0x."/></div><figcaption class="kc kd et er es ke kf bd b be z dx">Wow!</figcaption></figure><p id="85b9" class="pw-post-body-paragraph ix iy hh iz b ja jb ii jc jd je il jf jg jh ji jj jk jl jm jn jo jp jq jr js ha bi translated">要了解更多关于Square电子商务平台的信息，请查看<a class="ae jt" href="https://squareup.com/developers" rel="noopener ugc nofollow" target="_blank">square.com/developer</a>。</p></div></div>    
</body>
</html>