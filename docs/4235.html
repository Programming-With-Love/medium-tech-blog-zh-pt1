<html>
<head>
<title>Those sneaky Kotlin Exceptions</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">那些卑鄙的科特林例外</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/those-sneaky-kotlin-exceptions-597c93d29358?source=collection_archive---------0-----------------------#2019-03-19">https://medium.com/google-developer-experts/those-sneaky-kotlin-exceptions-597c93d29358?source=collection_archive---------0-----------------------#2019-03-19</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/b1979fced5aa0a6ece09c32db8592b4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*ou3ll_BGiEVPNaTGJu9nng.jpeg"/></div><figcaption class="il im et er es in io bd b be z dx"><a class="ae ip" href="https://www.flickr.com/photos/crozefeet/23244411091/in/photolist-Bq2FAt-EvQ5r-5iF9gD-epsV-JbwkM-9qmVns-2kSJ77-psbYce-7daoGd-7ckNMr-4S3ZFB-Jxj6E-bmJHyS-bgpdka-VrfpbE-3bUWvq-9wWJRJ-n5VS1B-2enRYgX-UUQoo9-nMTuvb-RUuAZk-21EEXUY-qkDMfX-9PskjK-7MVBba-6iAVA7-W1PfMb-872Ak5-8HwZuC-ahCKyW-267H5sN-idp64g-4Cshq-q4q5vV-Zbxiuw-WgMEpC-hfwQbm-fYh9Uu-7GABoz-WnXjSY-5vSebs-47aHyK-J6HmKK-RTjWSr-sx4gKt-3rpaLa-bosbmK-9iJnEz-cCgmD" rel="noopener ugc nofollow" target="_blank">https://www.flickr.com/photos/crozefeet/23244411091</a></figcaption></figure><p id="da40" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">如果您正在使用Kotlin进行开发，您可能已经知道与Java不同，不支持检查异常。许多文章支持和反对这两种方法，所以我们不在这里讨论这个。相反，当在Java和Kotlin之间转换时，我想把重点放在互操作性上。</p><h1 id="3999" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">古老的Java方式</h1><p id="862f" class="pw-post-body-paragraph iq ir hh is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn ha bi translated">当您从Java抛出异常时，编译器会强制您声明:</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div class="er es kr"><img src="../Images/dbc81df1168fe6211b40a733faa6facb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*h2VRz1G1LMYSNifVw4DCpQ.png"/></div></figure><p id="97e8" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">同样，当您想调用一个抛出的方法时，编译器会强制您处理:</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es kw"><img src="../Images/b611f8afe16caea6f29aac2c2fd9bc8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xZgRVJooHdKs3FBsLYv7EA.png"/></div></div></figure><h1 id="9fb5" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">但是在科特林</h1><p id="2f21" class="pw-post-body-paragraph iq ir hh is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn ha bi translated">而科特林却不知道这个概念。但是随着Java和Kotlin的顺利合作，这是如何实现的呢？</p><p id="ed47" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">这里要注意的重要事实是<strong class="is hi">检查异常是Java语言的一部分，而不是JVM </strong>！在字节码中，您可以无限制地抛出任何异常！</p><p id="65fd" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">其他JVM语言也利用了这一点，例如Groovy也允许抛出异常而不声明它们。</p><p id="d1af" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">当我们查看抛出异常的Kotlin方法的反编译字节代码时，它可能看起来像这样:</p><pre class="ks kt ku kv fd lb lc ld le aw lf bi"><span id="7406" class="lg jp hh lc b fi lh li l lj lk">public final void throwSomething() {<br/>   throw (Throwable)(new IOException());<br/>}</span></pre><p id="4fb7" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">所以Kotlin编译器将异常隐藏在<code class="du ll lm ln lc b">Throwable</code>后面，它是检查和未检查异常都实现的接口。</p><h1 id="ff10" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">实际上…</h1><p id="e426" class="pw-post-body-paragraph iq ir hh is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn ha bi translated">你可以用Java做类似的事情。它被称为<a class="ae ip" href="https://www.baeldung.com/java-sneaky-throws" rel="noopener ugc nofollow" target="_blank">鬼祟的投掷</a>:</p><pre class="ks kt ku kv fd lb lc ld le aw lf bi"><span id="9718" class="lg jp hh lc b fi lh li l lj lk">public static &lt;E extends Throwable&gt; void sneakyThrow(Throwable e) throws E {<br/>    throw (E) e;<br/>}<br/><br/>private static void throwsSneakyIOException() {<br/>    <em class="lo">sneakyThrow</em>(new IOException("sneaky"));<br/>}</span></pre><h1 id="04ff" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">问题是</h1><p id="e8c1" class="pw-post-body-paragraph iq ir hh is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn ha bi translated">偷偷抛出有一个问题(Kotlin抛出的异常也是如此):如果你想捕捉异常，Java编译器不允许你直接捕捉那个(检查过的)类型:</p><figure class="ks kt ku kv fd ii er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es lp"><img src="../Images/8cbd6a8920b4d1298e63563617aa282b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wnq2_i136pky3hsuz1Nw1w.png"/></div></div></figure><h1 id="9f1a" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">解决方案</h1><p id="cc93" class="pw-post-body-paragraph iq ir hh is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn ha bi translated">Kotlin有一个简单的方法来解决这个问题。使用<code class="du ll lm ln lc b">@Throws</code>注释！</p><pre class="ks kt ku kv fd lb lc ld le aw lf bi"><span id="c19b" class="lg jp hh lc b fi lh li l lj lk"><strong class="lc hi">@Throws(IOException::class)</strong><br/>fun throwSomething() {<br/>   throw IOException("")<br/>}</span></pre><p id="93c3" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">这将被翻译成字节码，就像方法上的Java <code class="du ll lm ln lc b">throws</code>关键字一样。</p><p id="d0c1" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">因此，如果您的代码可能是从Java中调用的，那么您应该添加它，以利用这两种语言的优势！</p><h1 id="8827" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">但是等等…还有更多！</h1><p id="74e7" class="pw-post-body-paragraph iq ir hh is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn ha bi translated">你还会遇到其他问题。例如，如果您使用的是用Java编写的库<a class="ae ip" href="https://github.com/mockito/mockito" rel="noopener ugc nofollow" target="_blank"> Mockito </a>，并且您模仿了一个抛出类似以下内容的Kotlin类:</p><pre class="ks kt ku kv fd lb lc ld le aw lf bi"><span id="9a09" class="lg jp hh lc b fi lh li l lj lk">`when`(mock.doSomething()).thenThrow(IOException(<strong class="lc hi">""</strong>))</span></pre><p id="228c" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">您最终可能会看到如下错误:</p><blockquote class="lq lr ls"><p id="90f1" class="iq ir lo is b it iu iv iw ix iy iz ja lt jc jd je lu jg jh ji lv jk jl jm jn ha bi translated">org . mock ITO . exceptions . base . mock ITO exception:<br/>选中的异常对此方法无效！</p></blockquote><p id="cd04" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">使用<code class="du ll lm ln lc b">Answer</code>很容易解决这个问题</p><pre class="ks kt ku kv fd lb lc ld le aw lf bi"><span id="ebf6" class="lg jp hh lc b fi lh li l lj lk">doAnswer<em class="lo"> </em>{ <br/>    throw IOException("")<br/>}.`when`(mock).doSomething()</span></pre><h1 id="01a3" class="jo jp hh bd jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl bi translated">TL；速度三角形定位法(dead reckoning)</h1><p id="5e3d" class="pw-post-body-paragraph iq ir hh is b it km iv iw ix kn iz ja jb ko jd je jf kp jh ji jj kq jl jm jn ha bi translated">即使Kotlin和Java能够很好地协同工作，有时了解另一面也很重要，正如这些隐藏的异常陷阱所显示的那样。</p><p id="a269" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn ha bi translated">所以要小心，好好表现！</p></div></div>    
</body>
</html>