<html>
<head>
<title>Mount File ke Kubernetes Pod Tanpa Menghapus Existing File</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Mount File ke Kubernetes Pod Tanpa Menghapus Existing File</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.easyread.co/mount-file-ke-kubernetes-pod-tanpa-menghapus-existing-file-1d9fc444c91a?source=collection_archive---------5-----------------------#2019-01-29">https://medium.easyread.co/mount-file-ke-kubernetes-pod-tanpa-menghapus-existing-file-1d9fc444c91a?source=collection_archive---------5-----------------------#2019-01-29</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="f5b0" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">Hal penting yang saya pelajari ketika mencoba mount volume ke docker container tanpa harus menghapus file yang ada di dalam container dalam folder yang sama</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/c4cf2ac77a5aa4e89d6de1787875bd4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fQamrt87H-aoivx4"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@isaacmsmith?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Isaac Smith</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="2f6c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Beberapa minggu yang lalu, saya membuat sebuah series berbahasa Indonesia dengan judul <a class="ae ks" href="https://medium.com/easyread/christmas-tale-of-sofware-engineer-project-kube-xmas-9167ebca70d2" rel="noopener"> <strong class="kv io"> "Kube X-Mas" </strong> </a> yang bercerita tentang bagaimana membuat Kubernetes Clusters di Google Cloud Platform (GCP).</p><p id="d705" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Di proyek tersebut, saya akan mendeploy aplikasi Golang ke dalam sebuah <em class="lp"> cluster </em> Kubernetes di GCP. Seperti yang kita ketahui, ketika membangun sebuah aplikasi, ada baiknya file konfigurasi diletakkan secara terpisah. Terserah apakah konfigurasi berupa <em class="lp"> environment </em> <em class="lp"> variable </em> atau dalam bentuk <em class="lp"> file </em> (.json, .yaml, .toml). Konfigurasi tersebut akan membuat aplikasi menjadi lebih fleksibel dan memudahkan kita untuk dapat menggonta-ganti <em class="lp"> environment </em> dari aplikasi.</p><p id="e014" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Dalam kasus saya kali ini, saya akan men- <em class="lp"> dockerize </em> sebuah aplikasi ke dalam <em class="lp"> Docker Image, </em> lalu kemudian mendeploynya ke dalam Kubernetes. Untuk kasus ini, saya menggunakan Kubernetes Controller untuk meng- <em class="lp"> inject </em> file konfigurasinya, sehingga aplikasi saya dapat berjalan di dalam Kubernetes cluster dengan konfigurasi yang telah saya sisipkan.</p><p id="2ce2" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Sebenarnya untuk men- <em class="lp"> inject </em> file ke dalam container di Kubernetes dapat kita lakukan dengan <a class="ae ks" href="https://kubernetes.io/docs/concepts/storage/volumes/" rel="noopener ugc nofollow" target="_blank"> Volumes </a> dan <a class="ae ks" href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/" rel="noopener ugc nofollow" target="_blank"> ConfigMap </a> . Yang nantinya pertama kali kita lakukan adalah mendefine <em class="lp"> config </em> <em class="lp"> maps </em> yang akan menjadi konfigurasi file kita, lalu memasukkannya ke dalam container aplikasi kita menggunakan Volumes.</p><h2 id="c702" class="lq lr in bd ls lt lu dn lv lw lx dp ly lc lz ma mb lg mc md me lk mf mg mh mi bi translated">The Issue</h2><p id="2050" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">Seperti yang saya sebutkan sebelumnya, saya memiliki aplikasi Golang yang akan di build dan di containerized di dalam sebuah docker-image. Aplikasi ini telah di compile, dan disimpan dalam sebuah docker image. Berikut <code class="fe mo mp mq mr b">Dockerfile</code> yang saya define.</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="8e67" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Jadi, dari <em class="lp"> dockerfile </em> tersebut dapat kita lihat, kita akan membuat sebuah docker-image yang di dalamnya terdapat aplikasi Golang yang telah terkompile dan hasil kompilenya disimpan di folder: <code class="fe mo mp mq mr b">/app/engine</code> . Namun aplikasi ini tentunya butuh <em class="lp"> config-file </em> , <em class="lp"> nah </em> <em class="lp"> config-file </em> inilah yang akan di <em class="lp"> inject </em> oleh Kubernetes.</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/7dcd0ee0c2784dd851b7bfc1a20345a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*a_TDZoHdPpdNWwKuw42Wdg.png"/></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">inject file to docker using kubernetes</figcaption></figure><p id="3086" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Berikut cara saya pertama kali ketika melakukan <em class="lp"> injection </em> <em class="lp"> file </em> <em class="lp"> config </em> ke dalam container saya.</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ms mt l"/></div></figure><p id="d47d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Lalu, <em class="lp"> issue </em> ini pun terjadi. Apa yang saya harapkan adalah ketika menyisipkan file config ke dalam docker container saya, kedua file saya, aplikasi serta confignya terdapat di dalam folder yang sama dan bisa jalan.</p><p id="431f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Karena saya menggunakan folder <code class="fe mo mp mq mr b">/app</code> , maka ilustrasinya seperti berikut:</p><p id="9519" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Sebelum inject config-file:</p><pre class="kd ke kf kg gt mv mr mw mx aw my bi"><span id="7706" class="lq lr in mr b gy mz na l nb nc">app<br/>â””â”€â”€<!-- --> engine</span></pre><p id="9d64" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Yang saya harapkan setelah inject config-file:</p><pre class="kd ke kf kg gt mv mr mw mx aw my bi"><span id="7b6c" class="lq lr in mr b gy mz na l nb nc">app<br/>â”œâ”€â”€ config.toml<br/>â””â”€â”€<!-- --> engine</span></pre><p id="35e9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Yang sebenarnya terjadi setelah inject config-file:</p><pre class="kd ke kf kg gt mv mr mw mx aw my bi"><span id="7541" class="lq lr in mr b gy mz na l nb nc">app<br/>â””â”€â”€<!-- --> config.toml</span></pre><p id="b875" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Yang terjadi adalah direktorinya berganti. Sehingga yang ada di dalam container aplikasi saya hanya <em class="lp"> config-file </em> yang saya <em class="lp"> inject </em> . Kubernetes mengganti semua file yang ada, sehingga aplikasi saya tidak bisa jalan.</p><p id="cd19" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Kemarin saya terjebak di <em class="lp"> issue </em> ini untuk lebih dari 4 jam.Awalnya saya belum sadar mengapa ini bisa terjadi. Saya bingung dan hampir stress ğŸ˜…. Pods aplikasinya selalu <em class="lp"> crash </em> dan <em class="lp"> restarted </em> secara berulang-ulang. Sampai kemudian, saya mencoba <em class="lp"> debug </em> secara perlahan, tentunya setelah cukup segar. Barulah saya sadar kesalahannya.</p><h2 id="f4fc" class="lq lr in bd ls lt lu dn lv lw lx dp ly lc lz ma mb lg mc md me lk mf mg mh mi bi translated">Solutions</h2><p id="445e" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">Setelah menyadari issuenya, ada 2 pilihan yang saya tempuh. Namun saat itu saya memilih pilihan 1.</p><ul class=""><li id="6a9a" class="nd ne in kv b kw kx kz la lc nf lg ng lk nh lo ni nj nk nl bi translated">Memisahkan <code class="fe mo mp mq mr b">WORKDIR</code> di dalam <em class="lp"> docker </em> container. Sebelumnya <code class="fe mo mp mq mr b">/app</code> dimana di dalam <code class="fe mo mp mq mr b">/app</code> terdapat aplikasi saya. Jadi solusinya, saya akan membuat <code class="fe mo mp mq mr b">WORKDIR</code> terpisah, yang nantinya file configuration akan disimpan disini, lalu aplikasi saya tetap di folder <code class="fe mo mp mq mr b">/app</code> . Sehingga dengan demikian aplikasi saya tetap berada di dalam container dan bisa berjalan.</li><li id="913f" class="nd ne in kv b kw nm kz nn lc no lg np lk nq lo ni nj nk nl bi translated">Mencoba sampai <em class="lp"> "mampus" </em> dengan memasukkan <em class="lp"> config-file </em> ke dalam folder yang sama.</li></ul><p id="d2d1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Kemarin, saya memilih pilihan 1, karena belum menyelesaikan masalah cara yang ke-2. Namun beberapa hari kemudian, atas nama <em class="lp"> â€œcuriosityâ€, </em> saya mencoba mencari solusinya. Saya membaca ulang beberapa dokumentasi dan beberapa blog, mungkin saja ada yang mengalami <em class="lp"> issue </em> yang sama.</p><p id="72fb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Hasilnya, saya tidak menemukan apapun, kecuali sebuah artikel yang menjelaskan tentang Kubernetes volumes disini: <a class="ae ks" href="https://blog.sebastian-daschner.com/entries/multiple-kubernetes-volumes-directory" rel="noopener ugc nofollow" target="_blank"> https://blog.sebastian-daschner.com/entries/multiple-kubernetes-volumes-directory </a> .</p><p id="a94d" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Akhirnya saya memutuskan untuk mencoba solusi yang dia sebutkan dengan menggunakan <code class="fe mo mp mq mr b">subPath</code> pada volumes yang saya gunakan.</p><p id="a28f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Sebelumnya:</p><pre class="kd ke kf kg gt mv mr mw mx aw my bi"><span id="90b1" class="lq lr in mr b gy mz na l nb nc">- name: configs          <br/>  mountPath: /app</span></pre><p id="8643" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Dan saya ubah menjadi:</p><pre class="kd ke kf kg gt mv mr mw mx aw my bi"><span id="884a" class="lq lr in mr b gy mz na l nb nc">- name: configs<br/>  mountPath: /app/config.toml<br/>  subPath: config.toml</span></pre><p id="3aa7" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Diluar dugaan, <em class="lp"> syntax </em> ini berhasil ğŸ˜™. Hanya single line <em class="lp"> syntax </em> , yang membuat saya hampir <em class="lp"> stress </em> , terjebak hingga 4 jam lebih.</p><p id="c018" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Sehingga Kubernetes deployment.yaml file saya menjadi berikut.</p><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ms mt l"/></div></figure></div><div class="ab cl nr ns hr nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ig ih ii ij ik"><p id="b9e1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">Saya mendapat satu pelajaran berharga ketika mencoba menyelesaikan masalah ini, meski awalnya saya terjebak selama 4â€“6 jam. Meski hanya dengan satu baris <em class="lp"> code </em> masalah terselesaikan, saya tetap bahagia bisa menyelesaikan ini ğŸ˜„</p><p id="57bf" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">References:</p><ul class=""><li id="9b0f" class="nd ne in kv b kw kx kz la lc nf lg ng lk nh lo ni nj nk nl bi translated"><a class="ae ks" href="https://blog.sebastian-daschner.com/entries/multiple-kubernetes-volumes-directory" rel="noopener ugc nofollow" target="_blank"> https://blog.sebastian-daschner.com/entries/multiple-kubernetes-volumes-directory </a></li></ul></div><div class="ab cl nr ns hr nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ig ih ii ij ik"><p id="7657" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><em class="lp"> Anyway, jika artikel ini berguna, mungkin kamu dapat membagikannya kepada lingkaran pertemananmu, agar yang membutuhkan tidak terjatuh pada lubang yang sama. Dan jangan lupa subscribe Easyread untuk selalu update dengan cerita seperti ini, juga cerita perjalanan saya di dunia Software Engineering :). </em></p></div><div class="ab cl nr ns hr nt" role="separator"><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw nx"/><span class="nu bw bk nv nw"/></div><div class="ig ih ii ij ik"><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="ny mt l"/></div></figure></div></div>    
</body>
</html>