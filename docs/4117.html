<html>
<head>
<title>The Web Bluetooth module for Angular</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于Angular的网络蓝牙模块</h1>
<blockquote>原文：<a href="https://medium.com/google-developer-experts/the-web-bluetooth-module-for-angular-9336c9535d04?source=collection_archive---------2-----------------------#2016-12-29">https://medium.com/google-developer-experts/the-web-bluetooth-module-for-angular-9336c9535d04?source=collection_archive---------2-----------------------#2016-12-29</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/1089ecb7b6e82efa8ffb18e0b1379e94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BSqZjaSJcbBLg1g7prsUFQ.jpeg"/></div></div></figure><p id="a530" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在过去的几个月里，我一直在玩新的<a class="ae jn" href="https://www.chromestatus.com/feature/5264933985976320" rel="noopener ugc nofollow" target="_blank"> Web蓝牙API </a>，它将于2017年2月在Chrome 56中发布。让我告诉你，这个新功能为网络开启了许多新的可能性。</p><p id="e349" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">作为一名Web倡导者，我非常兴奋，迫不及待地构建了一个应用程序，展示将Angular和Web Bluetooth API结合起来是多么容易(甚至更多，关于任何即将推出的Web APIs，请继续关注)。</p><blockquote class="jo"><p id="167e" class="jp jq hh bd jr js jt ju jv jw jx jm dx translated">让我们来认识一下用于角度应用的缺失的Web蓝牙模块</p></blockquote><p id="67b8" class="pw-post-body-paragraph ip iq hh ir b is jy iu iv iw jz iy iz ja ka jc jd je kb jg jh ji kc jk jl jm ha bi translated">然后我开始和我的好友<a class="ae jn" href="https://plus.google.com/+FrancoisBeaufort" rel="noopener ugc nofollow" target="_blank">弗朗索瓦·博福特</a>(向他致敬！)来构建一个<a class="ae jn" href="https://web-platform-awesome-demos.firebaseapp.com/#/home" rel="noopener ugc nofollow" target="_blank">演示应用</a>，这是一种概念验证，演示了如何将Web蓝牙与Angular集成在一起。</p><p id="e45c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在实现了几个用例之后，我想到了一个Angular模块，它抽象出了配置Web蓝牙API所需的所有样板文件。</p><h1 id="b6cc" class="kd ke hh bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">一些免责声明</h1><h2 id="d9e1" class="lb ke hh bd kf lc ld le kj lf lg lh kn ja li lj kr je lk ll kv ji lm ln kz lo bi translated">网络蓝牙API</h2><p id="5788" class="pw-post-body-paragraph ip iq hh ir b is lp iu iv iw lq iy iz ja lr jc jd je ls jg jh ji lt jk jl jm ha bi translated">我假设你已经熟悉了网络蓝牙API:GATT服务器，服务，特性…等等。在阅读下一部分之前，请熟悉这个主题。以下是一些资源:</p><ol class=""><li id="319b" class="lu lv hh ir b is it iw ix ja lw je lx ji ly jm lz ma mb mc bi translated"><a class="ae jn" href="https://developers.google.com/web/updates/2015/07/interact-with-ble-devices-on-the-web" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/web/updates/2015/07/interact-with-ble-devices-on-the-web</a></li><li id="51df" class="lu lv hh ir b is md iw me ja mf je mg ji mh jm lz ma mb mc bi translated"><a class="ae jn" rel="noopener" href="/@urish/start-building-with-web-bluetooth-and-progressive-web-apps-6534835959a6#.rmddefp0o">https://medium . com/@ urish/start-building-with-web-bluetooth-and-progressive-web-apps-6534835959 a6</a></li></ol><h2 id="e04e" class="lb ke hh bd kf lc ld le kj lf lg lh kn ja li lj kr je lk ll kv ji lm ln kz lo bi translated">看得见的</h2><p id="7402" class="pw-post-body-paragraph ip iq hh ir b is lp iu iv iw lq iy iz ja lr jc jd je ls jg jh ji lt jk jl jm ha bi translated">我还假设你对<a class="ae jn" href="http://reactivex.io/rxjs/manual/overview.html#observable" rel="noopener ugc nofollow" target="_blank">可观察对象</a>、<a class="ae jn" href="http://reactivex.io/rxjs/manual/overview.html#observer" rel="noopener ugc nofollow" target="_blank">观察者</a>和<a class="ae jn" href="http://reactivex.io/rxjs/manual/overview.html#subject" rel="noopener ugc nofollow" target="_blank">主体</a>有一些<a class="ae jn" href="http://reactivex.io/rxjs/manual/overview.html" rel="noopener ugc nofollow" target="_blank">基础知识</a>。</p><h2 id="8774" class="lb ke hh bd kf lc ld le kj lf lg lh kn ja li lj kr je lk ll kv ji lm ln kz lo bi translated">芬兰符号</h2><p id="f0b8" class="pw-post-body-paragraph ip iq hh ir b is lp iu iv iw lq iy iz ja lr jc jd je ls jg jh ji lt jk jl jm ha bi translated">您会注意到一些方法以$符号结尾。这是可观测世界中的某种<a class="ae jn" href="https://cycle.js.org/basic-examples.html#what-does-the-suffixed-dollar-sign-mean" rel="noopener ugc nofollow" target="_blank">惯例，我们已经使用了一段时间。因为</a><a class="ae jn" rel="noopener" href="/@benlesh/observables-and-finnish-notation-df8356ed1c9b#.e1uakchpi">这篇</a>博客文章，我们将来可能会放弃这个$符号。</p><figure class="mj mk ml mm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mi"><img src="../Images/18051646757b6dd97bf5e5c6352a6898.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*hTkqd86iz_wxMBNT74EGVA.gif"/></div></div></figure><h1 id="ff3e" class="kd ke hh bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">安装模块</h1><p id="232c" class="pw-post-body-paragraph ip iq hh ir b is lp iu iv iw lq iy iz ja lr jc jd je ls jg jh ji lt jk jl jm ha bi translated">你可以使用<strong class="ir hi">纱线</strong>或<strong class="ir hi"> NPM </strong>来获得这个模块:</p><pre class="mj mk ml mm fd mn mo mp mq aw mr bi"><span id="1778" class="lb ke hh mo b fi ms mt l mu mv">$ yarn add <a class="ae jn" href="http://twitter.com/manekinekko/angular-web-bluetooth" rel="noopener ugc nofollow" target="_blank">@manekinekko/angular-web-bluetooth</a></span><span id="2603" class="lb ke hh mo b fi mw mt l mu mv">$ npm i -S <a class="ae jn" href="http://twitter.com/manekinekko/angular-web-bluetooth" rel="noopener ugc nofollow" target="_blank">@manekinekko/angular-web-bluetooth</a></span></pre><h1 id="e35a" class="kd ke hh bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">使用网络蓝牙模块</h1><p id="486b" class="pw-post-body-paragraph ip iq hh ir b is lp iu iv iw lq iy iz ja lr jc jd je ls jg jh ji lt jk jl jm ha bi translated">该模块易于使用。首先导入<strong class="ir hi"> WebBluetoothModule </strong>模块表单<em class="mx">@ manekinekko/angular-we b-bluetooth</em>:</p><figure class="mj mk ml mm fd ii"><div class="bz dy l di"><div class="my mz l"/></div><figcaption class="na nb et er es nc nd bd b be z dx">app.module.ts</figcaption></figure><p id="2c02" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">调用<strong class="ir hi">web bluetooth module . for root()</strong>方法将提供<strong class="ir hi"> BluetoothCore </strong>服务，您将需要在您自己的服务/组件中使用该服务，就像在<em class="mx">battery-level . component . ts</em>中一样:</p><figure class="mj mk ml mm fd ii"><div class="bz dy l di"><div class="my mz l"/></div><figcaption class="na nb et er es nc nd bd b be z dx">app.component.ts</figcaption></figure><p id="3885" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">web bluetooth module . forroot()</strong>还提供了<strong class="ir hi"> </strong>一个<strong class="ir hi"> BrowserWebBluetooth </strong>实现，它使用了<a class="ae jn" href="https://webbluetoothcg.github.io/web-bluetooth/#dom-bluetooth-requestdevice" rel="noopener ugc nofollow" target="_blank"><strong class="ir hi">navigator . bluetooth</strong></a>的引擎盖。Angular Universal的一个<strong class="ir hi"> ServerWebBluetooth </strong>实现将在稍后推出。当然，使用Angular的DI，如果你愿意，你可以自由地提供你的定制实现。</p><p id="9301" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">battery level service</strong>(<em class="mx">battery-level . service . ts</em>)服务是您将(应该)实现设备/传感器逻辑的地方。在下面的示例中，我们实现了一个电池电量服务，它读取所连接设备的电池电量:</p><figure class="mj mk ml mm fd ii"><div class="bz dy l di"><div class="my mz l"/></div><figcaption class="na nb et er es nc nd bd b be z dx">app.service.ts</figcaption></figure><h1 id="3f5c" class="kd ke hh bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">给我一些解释</h1><p id="1314" class="pw-post-body-paragraph ip iq hh ir b is lp iu iv iw lq iy iz ja lr jc jd je ls jg jh ji lt jk jl jm ha bi translated">好吧！让我们解释一下<strong class="ir hi">getbatterylelevel()</strong>方法内部发生了什么…</p><p id="7019" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">基本上，为了从设备读取值，您需要经历相同的工作流程(对于常见用例):</p><ol class=""><li id="6f2b" class="lu lv hh ir b is it iw ix ja lw je lx ji ly jm lz ma mb mc bi translated">调用<strong class="ir hi"> discover$() </strong>方法来运行发现过程</li></ol><p id="437f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">2.这将把GATT服务器还给你</p><p id="2b7c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">3.然后，您将获得GATT服务器的主要服务</p><p id="b4f0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">4.接下来，得到一个具体的特征</p><p id="5e45" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">5.最后读取从该特性提取的值(作为数据视图)</p><p id="aee9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">6.最后一步将为您提供数据视图类型的值。您必须读取特定于您的设备/传感器的正确值。例如，对于简单的值，如<a class="ae jn" href="https://www.bluetooth.com/specifications/gatt/viewer?attributeXmlFile=org.bluetooth.characteristic.battery_level.xml" rel="noopener ugc nofollow" target="_blank">电池电量</a>，调用<strong class="ir hi"> value.getUint8(0) </strong>就足够了:</p><pre class="mj mk ml mm fd mn mo mp mq aw mr bi"><span id="04f1" class="lb ke hh mo b fi ms mt l mu mv">.map( (value: DataView) =&gt; value.getUint8(0) );</span></pre><p id="c7a2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">但是有时候，事情会更复杂。一些制造商通常提供他们自己的蓝牙GATT特性实现而不遵循标准。如果你需要从一个通常被称为光传感器的<em class="mx">光度仪</em>中读取数值，就会出现这种情况。以下是与德州仪器SensorTag CC2650传感器相关的示例代码:</p><pre class="mj mk ml mm fd mn mo mp mq aw mr bi"><span id="e5e9" class="lb ke hh mo b fi ms mt l mu mv">.map( (data: DataView) =&gt; {<br/>    let value = data.getUint16(0, true /* little endian */);<br/>    let mantissa = value &amp; 0x0FFF;<br/>    let exponent = value &gt;&gt; 12;<br/>    let magnitude = Math.pow(2, exponent);<br/>    let output = (mantissa * magnitude);<br/>    let lux = output / 100.0;<br/>    return +lux.toFixed(2);<br/> });</span></pre><p id="b001" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这通常可以在器件/传感器文档或源代码中找到，如果你幸运的话！</p><figure class="mj mk ml mm fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ne"><img src="../Images/a529b4a5a136e36d828221515d7ad84d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*C5T5hLCleCfLlzB9VHFh4g.gif"/></div></div></figure><h1 id="973a" class="kd ke hh bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">需要开胃菜吗？</h1><p id="66c0" class="pw-post-body-paragraph ip iq hh ir b is lp iu iv iw lq iy iz ja lr jc jd je ls jg jh ji lt jk jl jm ha bi translated">这里有一个基本的回购，可以帮助你开始…</p><div class="nf ng ez fb nh ni"><a href="https://github.com/manekinekko/angular-web-bluetooth-starter" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab dw"><div class="nk ab nl cl cj nm"><h2 class="bd hi fi z dy nn ea eb no ed ef hg bi translated">manekinekko/angular-web-bluetooth-starter</h2><div class="np l"><h3 class="bd b fi z dy nn ea eb no ed ef dx translated">angular-web-bluetooth-starter -一个Angular Web Bluetooth模块的启动器</h3></div><div class="nq l"><p class="bd b fp z dy nn ea eb no ed ef dx translated">github.com</p></div></div><div class="nr l"><div class="ns l nt nu nv nr nw in ni"/></div></div></a></div><h1 id="fbc5" class="kd ke hh bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">有反馈吗？</h1><p id="dcda" class="pw-post-body-paragraph ip iq hh ir b is lp iu iv iw lq iy iz ja lr jc jd je ls jg jh ji lt jk jl jm ha bi translated">欢迎所有的贡献。请在github上打开一个问题，并给我们您的反馈…</p><div class="nf ng ez fb nh ni"><a href="https://github.com/manekinekko/angular-web-bluetooth" rel="noopener  ugc nofollow" target="_blank"><div class="nj ab dw"><div class="nk ab nl cl cj nm"><h2 class="bd hi fi z dy nn ea eb no ed ef hg bi translated">manekinekko/angular-web-bluetooth</h2><div class="np l"><h3 class="bd b fi z dy nn ea eb no ed ef dx translated">Angular-web-Bluetooth-Angular(v2+)缺少的Web蓝牙模块🔥⚡️🚀✨🎉🎊</h3></div><div class="nq l"><p class="bd b fp z dy nn ea eb no ed ef dx translated">github.com</p></div></div><div class="nr l"><div class="nx l nt nu nv nr nw in ni"/></div></div></a></div><h1 id="5a76" class="kd ke hh bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">更进一步</h1><p id="c99e" class="pw-post-body-paragraph ip iq hh ir b is lp iu iv iw lq iy iz ja lr jc jd je ls jg jh ji lt jk jl jm ha bi translated">如果你需要更进一步，使用更多的设备和传感器实现更酷的应用，你可以看看<a class="ae jn" href="https://developers.google.com/web/updates/2015/07/interact-with-ble-devices-on-the-web" rel="noopener ugc nofollow" target="_blank">网络蓝牙API </a>。</p><figure class="mj mk ml mm fd ii er es paragraph-image"><div class="er es ny"><img src="../Images/b3b8afa04ae9f05a3bfd4e81b94c7eac.png" data-original-src="https://miro.medium.com/v2/resize:fit:652/format:webp/1*vT-3DHLDEF8r9W37ujrVRw.png"/></div></figure></div><div class="ab cl nz oa go ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="ha hb hc hd he"><p id="30e7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="mx">在Twitter上关注我</em><a class="ae jn" href="https://twitter.com/manekinekko" rel="noopener ugc nofollow" target="_blank"><em class="mx">@ manekinekko</em></a><em class="mx">了解更多关于网络平台的信息。</em></p></div></div>    
</body>
</html>