<html>
<head>
<title>Custom User Model in Django 3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Django 3中的自定义用户模型</h1>
<blockquote>原文：<a href="https://medium.com/quick-code/custom-user-model-in-django-3-3750fb5656c4?source=collection_archive---------0-----------------------#2020-08-16">https://medium.com/quick-code/custom-user-model-in-django-3-3750fb5656c4?source=collection_archive---------0-----------------------#2020-08-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/aa32e64e932f3795feafdf488b48193f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rAkrFWT2qbrcwI2tPrGA5A.jpeg"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Photo by <a class="ae it" href="https://www.pexels.com/@kevin-ku-92347?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Kevin Ku</a> from <a class="ae it" href="https://www.pexels.com/photo/coding-computer-data-depth-of-field-577585/?utm_content=attributionCopyText&amp;utm_medium=referral&amp;utm_source=pexels" rel="noopener ugc nofollow" target="_blank">Pexels</a></figcaption></figure><h1 id="2859" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">介绍</h1><p id="9ea2" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">嗨，在这篇文章中，我们将学习在Django 3中创建一个自定义的用户模型，我们还将改变Django管理员的默认登录功能。我们将使用<em class="kq">电子邮件</em>和<em class="kq">密码</em>登录。</p><h1 id="f488" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">动机</h1><p id="64fe" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">我不得不为我的应用程序定制用户，我可以制作模型，但问题是<em class="kq"> createsuperuser </em>命令不起作用。为了调试它，我必须做大量的研究，问题是当时的大多数资源都过时了，所以我决定写这篇文章。</p><p id="d71c" class="pw-post-body-paragraph js jt hh ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp ha bi translated">我做了一个<a class="ae it" href="https://github.com/theshubhagrwl/django_custom_user_app" rel="noopener ugc nofollow" target="_blank"> GitHub </a> repo，所以如果你想你可以直接使用它(说明在那里)</p><h1 id="cac1" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">我们开始吧</h1><p id="d1d4" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">首先做一个<strong class="ju hi"> Django项目</strong>并创建一个名为<strong class="ju hi"> users </strong>的app</p><h2 id="3821" class="kw iv hh bd iw kx ky kz ja la lb lc je kd ld le ji kh lf lg jm kl lh li jq lj bi translated">现在我们可以开始在我们的<strong class="ak">用户</strong>应用程序中编辑<strong class="ak"> models.py </strong>文件</h2><p id="5391" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">在编辑之前，让我们做一些理论。</p><p id="0c90" class="pw-post-body-paragraph js jt hh ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp ha bi translated">Django有哪些<strong class="ju hi">经理</strong>？</p><blockquote class="lk ll lm"><p id="8af9" class="js jt kq ju b jv kr jx jy jz ks kb kc ln kt kf kg lo ku kj kk lp kv kn ko kp ha bi translated">管理器是一个接口，通过它向Django模型提供数据库查询操作。Django应用程序中的每个模型至少有一个管理器。-姜戈文件</p></blockquote><p id="7ba4" class="pw-post-body-paragraph js jt hh ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp ha bi translated">简单地说，管理者为我们提供了一种管理模型的方法。我们可以通过使我们的模型成为Manager类的子类来实现这一点。manager类是像<em class="kq"> createsuperuser </em>这样的命令可以被编辑的地方。</p><p id="f624" class="pw-post-body-paragraph js jt hh ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp ha bi translated">现在打开<strong class="ju hi"> models.py </strong>，把下面的代码放进去</p><figure class="lq lr ls lt fd ii"><div class="bz dy l di"><div class="lu lv l"/></div></figure><p id="4f7b" class="pw-post-body-paragraph js jt hh ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp ha bi translated">这里最需要注意的是<em class="kq"> is_staff </em>和<em class="kq"> is_superuser </em>属性。在这种情况下打错字会导致调试困难。</p><h2 id="6899" class="kw iv hh bd iw kx ky kz ja la lb lc je kd ld le ji kh lf lg jm kl lh li jq lj bi translated">我们在这里做了什么？</h2><p id="2b64" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">我们为我们的用户模型做了一个管理器。在这里面，我们做了两个函数叫做<strong class="ju hi"> <em class="kq"> create_user </em> </strong>和<strong class="ju hi"><em class="kq">create _ super user</em></strong>。</p><p id="3002" class="pw-post-body-paragraph js jt hh ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp ha bi translated"><em class="kq"> create_user </em>顾名思义，创建一个新用户，<em class="kq"> create_superuser </em>用于通过将<strong class="ju hi"> <em class="kq"> is_staff </em> </strong>和<strong class="ju hi"> <em class="kq"> is_superuser </em> </strong>设置为true来创建一个超级用户。</p><p id="9f77" class="pw-post-body-paragraph js jt hh ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp ha bi translated">在经理之后，我们有我们通常的模型。</p><p id="5fde" class="pw-post-body-paragraph js jt hh ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp ha bi translated">我们将<strong class="ju hi"> <em class="kq">用户名</em> </strong>设置为无，因为我们不想包含用户名。</p><p id="5ec5" class="pw-post-body-paragraph js jt hh ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp ha bi translated">其中的<strong class="ju hi"> <em class="kq">用户名字段</em> </strong>表示我们声明的‘电子邮件’。这应该是独一无二的。</p><p id="afe9" class="pw-post-body-paragraph js jt hh ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp ha bi translated"><em class="kq"> session_token </em>是可选字段。我把它放在那里，因为我正在制作我的定制令牌。</p><p id="3588" class="pw-post-body-paragraph js jt hh ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp ha bi translated">models.py的最后一行表示CustomUser是UserManager的对象。</p><h1 id="7f4f" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">重要的事情</h1><p id="6c06" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">制作好模型后，打开settings.py文件，在其中添加一行</p><pre class="lq lr ls lt fd lw lx ly lz aw ma bi"><span id="97e1" class="kw iv hh lx b fi mb mc l md me">AUTH_USER_MODEL = 'users.CustomUser'</span></pre><blockquote class="lk ll lm"><p id="c96e" class="js jt kq ju b jv kr jx jy jz ks kb kc ln kt kf kg lo ku kj kk lp kv kn ko kp ha bi translated">Django允许您通过为引用定制模型的AUTH_USER_MODEL设置提供一个值来覆盖默认的用户模型。这个虚线对描述了Django应用程序的名称(必须在INSTALLED_APPS中)，以及您希望用作您的用户模型的Django模型的名称。-姜戈文件</p></blockquote><h1 id="ee4e" class="iu iv hh bd iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr bi translated">最后一步</h1><p id="033d" class="pw-post-body-paragraph js jt hh ju b jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp ha bi translated">现在，您可以运行迁移命令并创建超级用户。</p><pre class="lq lr ls lt fd lw lx ly lz aw ma bi"><span id="acd2" class="kw iv hh lx b fi mb mc l md me">py manage.py makemigrations<br/>py manage.py migrate<br/>py manage.py createsuperuser</span></pre><p id="2973" class="pw-post-body-paragraph js jt hh ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp ha bi translated">它会要求你的电子邮件和密码。告诉它细节。</p><h2 id="ad36" class="kw iv hh bd iw kx ky kz ja la lb lc je kd ld le ji kh lf lg jm kl lh li jq lj bi translated">不要忘记在管理中注册应用程序</h2><pre class="lq lr ls lt fd lw lx ly lz aw ma bi"><span id="8617" class="kw iv hh lx b fi mb mc l md me">admin.site.register(CustomUser)</span></pre><p id="d023" class="pw-post-body-paragraph js jt hh ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp ha bi translated">现在，您可以运行服务器，并在管理面板中使用您的电子邮件和密码登录。</p><p id="60fa" class="pw-post-body-paragraph js jt hh ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp ha bi translated">如果你有任何建议，请告诉我。</p><p id="0780" class="pw-post-body-paragraph js jt hh ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp ha bi translated">如果有帮助，请鼓掌。</p><p id="7df0" class="pw-post-body-paragraph js jt hh ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp ha bi translated">查看我的作品集:【https://theshubhagrwl.netlify.app/ T2】</p><p id="b06f" class="pw-post-body-paragraph js jt hh ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp ha bi translated">在社交平台上与我联系:</p><p id="9035" class="pw-post-body-paragraph js jt hh ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp ha bi translated">领英:【https://www.linkedin.com/in/theshubhagrwl/ T4】</p><p id="3734" class="pw-post-body-paragraph js jt hh ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp ha bi translated">推特:<a class="ae it" href="https://twitter.com/theshubhagrwl" rel="noopener ugc nofollow" target="_blank">https://twitter.com/theshubhagrwl</a>/</p><p id="8519" class="pw-post-body-paragraph js jt hh ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp ha bi translated">GitHub:<a class="ae it" href="https://github.com/theshubhagrwl" rel="noopener ugc nofollow" target="_blank">https://github.com/theshubhagrwl</a></p><p id="d0c4" class="pw-post-body-paragraph js jt hh ju b jv kr jx jy jz ks kb kc kd kt kf kg kh ku kj kk kl kv kn ko kp ha bi translated">insta gram:<a class="ae it" href="https://www.instagram.com/theshubhagrwl/" rel="noopener ugc nofollow" target="_blank">https://www.instagram.com/theshubhagrwl/</a></p></div></div>    
</body>
</html>