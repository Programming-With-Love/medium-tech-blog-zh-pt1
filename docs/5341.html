<html>
<head>
<title>Creating an Oracle Database Docker image</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">创建Oracle数据库Docker映像</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/creating-an-oracle-database-docker-image-f3cea1ea21bb?source=collection_archive---------0-----------------------#2017-11-13">https://medium.com/oracledevs/creating-an-oracle-database-docker-image-f3cea1ea21bb?source=collection_archive---------0-----------------------#2017-11-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/279ce34964bc834d04fefdb349924e7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:568/format:webp/1*ydYgQUZtklQwHJETi6AMQA.png"/></div></div></figure><p id="8418" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Oracle已经在Github 上发布了Oracle数据库的<a class="ae jn" href="https://github.com/oracle/docker-images/tree/master/OracleDatabase" rel="noopener ugc nofollow" target="_blank"> Docker构建文件。有了这些构建文件，用户就可以为Oracle数据库构建自己的Docker映像了。如果你不知道Docker </a>是什么，你应该去看看。这是一项基于Linux容器技术的很酷的技术，它允许你容器化你的应用程序，不管这个应用程序是什么。自然，没过多久，人们也开始关注容器化数据库，这很有意义，尤其是对于开发和测试环境，但不仅限于此。这里有一篇关于如何使用Oracle提供的构建文件来封装Oracle数据库的详细博文。</p></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><h1 id="e800" class="jv jw hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">你需要什么</h1><ul class=""><li id="234b" class="kt ku hh ir b is kv iw kw ja kx je ky ji kz jm la lb lc ld bi translated">Oracle安装zip文件，你可以从<a class="ae jn" href="http://www.oracle.com/technetwork/database/enterprise-edition/downloads/index.html" rel="noopener ugc nofollow" target="_blank"> Oracle技术网</a>下载</li><li id="c5aa" class="kt ku hh ir b is le iw lf ja lg je lh ji li jm la lb lc ld bi translated">来自Github的构建文件，你可以<a class="ae jn" href="https://github.com/oracle/docker-images/" rel="noopener ugc nofollow" target="_blank">下载或者克隆库</a></li></ul><h1 id="2bd4" class="jv jw hh bd jx jy lj ka kb kc lk ke kf kg ll ki kj kk lm km kn ko ln kq kr ks bi translated">环境</h1><p id="5be3" class="pw-post-body-paragraph ip iq hh ir b is kv iu iv iw kw iy iz ja lo jc jd je lp jg jh ji lq jk jl jm ha bi translated">我的环境如下:</p><ul class=""><li id="d937" class="kt ku hh ir b is it iw ix ja lr je ls ji lt jm la lb lc ld bi translated">Oracle Linux 7.3(4 . 1 . 12–94 . 3 . 8 . El 7 uek . x86 _ 64)</li><li id="57e6" class="kt ku hh ir b is le iw lf ja lg je lh ji li jm la lb lc ld bi translated">docker 17 . 03 . 1-ce(docker-engine . x86 _ 64 17 . 03 . 1 . ce-3 . 0 . 1 . el7)</li><li id="4084" class="kt ku hh ir b is le iw lf ja lg je lh ji li jm la lb lc ld bi translated">Oracle数据库12.2.0.1企业版</li></ul><h1 id="01de" class="jv jw hh bd jx jy lj ka kb kc lk ke kf kg ll ki kj kk lm km kn ko ln kq kr ks bi translated">Docker设置</h1><p id="8024" class="pw-post-body-paragraph ip iq hh ir b is kv iu iv iw kw iy iz ja lo jc jd je lp jg jh ji lq jk jl jm ha bi translated">第一件事，如果还没有做的话，就是在环境中设置Docker。幸运的是，这相当简单。Docker是作为Oracle Linux 7 UEK4的一个插件提供的。当我在这样的环境中运行时，我所要做的就是启用<code class="du lu lv lw lx b">addons</code> yum库并安装<code class="du lu lv lw lx b">docker-engine</code>包。注意，这是作为<code class="du lu lv lw lx b">root</code> Linux用户完成的:</p><h1 id="6871" class="jv jw hh bd jx jy lj ka kb kc lk ke kf kg ll ki kj kk lm km kn ko ln kq kr ks bi translated">启用OL7附件报告</h1><pre class="ly lz ma mb fd mc lx md me aw mf bi"><span id="09df" class="mg jw hh lx b fi mh mi l mj mk">[root@localhost ~]# yum-config-manager enable *addons*</span><span id="8a6a" class="mg jw hh lx b fi ml mi l mj mk">Loaded plugins: langpacks</span><span id="3924" class="mg jw hh lx b fi ml mi l mj mk">================================================================== repo: ol7_addons ==================================================================</span><span id="26ea" class="mg jw hh lx b fi ml mi l mj mk">[ol7_addons]</span><span id="d363" class="mg jw hh lx b fi ml mi l mj mk">async = True</span><span id="7b9c" class="mg jw hh lx b fi ml mi l mj mk">bandwidth = 0</span><span id="da96" class="mg jw hh lx b fi ml mi l mj mk">base_persistdir = /var/lib/yum/repos/x86_64/7Server</span><span id="20c8" class="mg jw hh lx b fi ml mi l mj mk">baseurl = http://public-yum.oracle.com/repo/OracleLinux/OL7/addons/x86_64/</span><span id="4e21" class="mg jw hh lx b fi ml mi l mj mk">cache = 0</span><span id="2586" class="mg jw hh lx b fi ml mi l mj mk">cachedir = /var/cache/yum/x86_64/7Server/ol7_addons</span><span id="15f6" class="mg jw hh lx b fi ml mi l mj mk">check_config_file_age = True</span><span id="0362" class="mg jw hh lx b fi ml mi l mj mk">compare_providers_priority = 80</span><span id="43c7" class="mg jw hh lx b fi ml mi l mj mk">cost = 1000</span><span id="cae2" class="mg jw hh lx b fi ml mi l mj mk">deltarpm_metadata_percentage = 100</span><span id="cf48" class="mg jw hh lx b fi ml mi l mj mk">deltarpm_percentage =</span><span id="319f" class="mg jw hh lx b fi ml mi l mj mk">enabled = True</span><span id="b11f" class="mg jw hh lx b fi ml mi l mj mk">enablegroups = True</span><span id="649f" class="mg jw hh lx b fi ml mi l mj mk">exclude =</span><span id="b48e" class="mg jw hh lx b fi ml mi l mj mk">failovermethod = priority</span><span id="a3bf" class="mg jw hh lx b fi ml mi l mj mk">ftp_disable_epsv = False</span><span id="7200" class="mg jw hh lx b fi ml mi l mj mk">gpgcadir = /var/lib/yum/repos/x86_64/7Server/ol7_addons/gpgcadir</span><span id="0257" class="mg jw hh lx b fi ml mi l mj mk">gpgcakey =</span><span id="1ffa" class="mg jw hh lx b fi ml mi l mj mk">gpgcheck = True</span><span id="d576" class="mg jw hh lx b fi ml mi l mj mk">gpgdir = /var/lib/yum/repos/x86_64/7Server/ol7_addons/gpgdir</span><span id="95e9" class="mg jw hh lx b fi ml mi l mj mk">gpgkey = file:///etc/pki/rpm-gpg/RPM-GPG-KEY-oracle</span><span id="b396" class="mg jw hh lx b fi ml mi l mj mk">hdrdir = /var/cache/yum/x86_64/7Server/ol7_addons/headers</span><span id="fa7d" class="mg jw hh lx b fi ml mi l mj mk">http_caching = all</span><span id="5508" class="mg jw hh lx b fi ml mi l mj mk">includepkgs =</span><span id="9018" class="mg jw hh lx b fi ml mi l mj mk">ip_resolve =</span><span id="d2a5" class="mg jw hh lx b fi ml mi l mj mk">keepalive = True</span><span id="d3c1" class="mg jw hh lx b fi ml mi l mj mk">keepcache = False</span><span id="ae94" class="mg jw hh lx b fi ml mi l mj mk">mddownloadpolicy = sqlite</span><span id="ba63" class="mg jw hh lx b fi ml mi l mj mk">mdpolicy = group:small</span><span id="f120" class="mg jw hh lx b fi ml mi l mj mk">mediaid =</span><span id="d6b5" class="mg jw hh lx b fi ml mi l mj mk">metadata_expire = 21600</span><span id="b93d" class="mg jw hh lx b fi ml mi l mj mk">metadata_expire_filter = read-only:present</span><span id="2da5" class="mg jw hh lx b fi ml mi l mj mk">metalink =</span><span id="3b11" class="mg jw hh lx b fi ml mi l mj mk">minrate = 0</span><span id="d1f0" class="mg jw hh lx b fi ml mi l mj mk">mirrorlist =</span><span id="eba9" class="mg jw hh lx b fi ml mi l mj mk">mirrorlist_expire = 86400</span><span id="221b" class="mg jw hh lx b fi ml mi l mj mk">name = Oracle Linux 7Server Add ons (x86_64)</span><span id="baf5" class="mg jw hh lx b fi ml mi l mj mk">old_base_cache_dir =</span><span id="04be" class="mg jw hh lx b fi ml mi l mj mk">password =</span><span id="7f3e" class="mg jw hh lx b fi ml mi l mj mk">persistdir = /var/lib/yum/repos/x86_64/7Server/ol7_addons</span><span id="19b1" class="mg jw hh lx b fi ml mi l mj mk">pkgdir = /var/cache/yum/x86_64/7Server/ol7_addons/packages</span><span id="67c4" class="mg jw hh lx b fi ml mi l mj mk">proxy = False</span><span id="91fd" class="mg jw hh lx b fi ml mi l mj mk">proxy_dict =</span><span id="d28d" class="mg jw hh lx b fi ml mi l mj mk">proxy_password =</span><span id="be35" class="mg jw hh lx b fi ml mi l mj mk">proxy_username =</span><span id="f474" class="mg jw hh lx b fi ml mi l mj mk">repo_gpgcheck = False</span><span id="3d38" class="mg jw hh lx b fi ml mi l mj mk">retries = 10</span><span id="a258" class="mg jw hh lx b fi ml mi l mj mk">skip_if_unavailable = False</span><span id="88ae" class="mg jw hh lx b fi ml mi l mj mk">ssl_check_cert_permissions = True</span><span id="07fc" class="mg jw hh lx b fi ml mi l mj mk">sslcacert =</span><span id="90b3" class="mg jw hh lx b fi ml mi l mj mk">sslclientcert =</span><span id="d7bf" class="mg jw hh lx b fi ml mi l mj mk">sslclientkey =</span><span id="7620" class="mg jw hh lx b fi ml mi l mj mk">sslverify = True</span><span id="c527" class="mg jw hh lx b fi ml mi l mj mk">throttle = 0</span><span id="57b3" class="mg jw hh lx b fi ml mi l mj mk">timeout = 30.0</span><span id="8d8b" class="mg jw hh lx b fi ml mi l mj mk">ui_id = ol7_addons/x86_64</span><span id="3d61" class="mg jw hh lx b fi ml mi l mj mk">ui_repoid_vars = releasever,</span><span id="dccd" class="mg jw hh lx b fi ml mi l mj mk">basearch</span><span id="f73e" class="mg jw hh lx b fi ml mi l mj mk">username =</span></pre><h1 id="3353" class="jv jw hh bd jx jy lj ka kb kc lk ke kf kg ll ki kj kk lm km kn ko ln kq kr ks bi translated">安装对接发动机</h1><pre class="ly lz ma mb fd mc lx md me aw mf bi"><span id="daf8" class="mg jw hh lx b fi mh mi l mj mk">[root@localhost ~]# yum install docker-engine</span><span id="1d9d" class="mg jw hh lx b fi ml mi l mj mk">Loaded plugins: langpacks, ulninfo</span><span id="91f9" class="mg jw hh lx b fi ml mi l mj mk">Resolving Dependencies</span><span id="5054" class="mg jw hh lx b fi ml mi l mj mk">--&gt; Running transaction check</span><span id="9ff6" class="mg jw hh lx b fi ml mi l mj mk">---&gt; Package docker-engine.x86_64 0:17.03.1.ce-3.0.1.el7 will be installed</span><span id="eaed" class="mg jw hh lx b fi ml mi l mj mk">--&gt; Processing Dependency: docker-engine-selinux &gt;= 17.03.1.ce-3.0.1.el7 <strong class="lx hi">for</strong> <!-- -->package: docker-engine-17.03.1.ce-3.0.1.el7.x86_64</span><span id="5edf" class="mg jw hh lx b fi ml mi l mj mk">--&gt; Running transaction check</span><span id="0ff1" class="mg jw hh lx b fi ml mi l mj mk">---&gt; Package selinux-policy-targeted.noarch 0:3.13.1-102.0.3.el7_3.16 will be updated</span><span id="8b89" class="mg jw hh lx b fi ml mi l mj mk">---&gt; Package selinux-policy-targeted.noarch 0:3.13.1-166.0.2.el7 will be an update</span><span id="06d2" class="mg jw hh lx b fi ml mi l mj mk">--&gt; Processing Dependency: selinux-policy = 3.13.1-166.0.2.el7 <strong class="lx hi">for</strong> <!-- -->package: selinux-policy-targeted-3.13.1-166.0.2.el7.noarch</span><span id="8b9f" class="mg jw hh lx b fi ml mi l mj mk">--&gt; Running transaction check</span><span id="3ba3" class="mg jw hh lx b fi ml mi l mj mk">---&gt; Package selinux-policy.noarch 0:3.13.1-102.0.3.el7_3.16 will be updated</span><span id="4f19" class="mg jw hh lx b fi ml mi l mj mk">---&gt; Package selinux-policy.noarch 0:3.13.1-166.0.2.el7 will be an update</span><span id="1503" class="mg jw hh lx b fi ml mi l mj mk">--&gt; Finished Dependency Resolution</span><span id="5bae" class="mg jw hh lx b fi ml mi l mj mk">Dependencies Resolved</span><span id="60f5" class="mg jw hh lx b fi ml mi l mj mk">======================================================================================================================================================</span><span id="d561" class="mg jw hh lx b fi ml mi l mj mk">Package Arch Version Repository Size</span><span id="5b68" class="mg jw hh lx b fi ml mi l mj mk">======================================================================================================================================================</span><span id="020d" class="mg jw hh lx b fi ml mi l mj mk">Installing:</span><span id="fd59" class="mg jw hh lx b fi ml mi l mj mk">docker-engine x86_64 17.03.1.ce-3.0.1.el7 ol7_addons 19 M</span><span id="3bce" class="mg jw hh lx b fi ml mi l mj mk">Updating:</span><span id="56ee" class="mg jw hh lx b fi ml mi l mj mk">selinux-policy-targeted noarch 3.13.1-166.0.2.el7 ol7_latest 6.5 M</span><span id="0eb3" class="mg jw hh lx b fi ml mi l mj mk">Updating <strong class="lx hi">for</strong> <!-- -->dependencies:</span><span id="e986" class="mg jw hh lx b fi ml mi l mj mk">selinux-policy noarch 3.13.1-166.0.2.el7 ol7_latest 435 k</span><span id="4618" class="mg jw hh lx b fi ml mi l mj mk">Transaction Summary</span><span id="2fa4" class="mg jw hh lx b fi ml mi l mj mk">======================================================================================================================================================</span><span id="e099" class="mg jw hh lx b fi ml mi l mj mk">Install 1 Package</span><span id="7f9c" class="mg jw hh lx b fi ml mi l mj mk">Upgrade 1 Package (+1 Dependent package)</span><span id="349f" class="mg jw hh lx b fi ml mi l mj mk">Total download size: 26 M</span><span id="103d" class="mg jw hh lx b fi ml mi l mj mk">Is this ok [y/d/N]: y</span><span id="4132" class="mg jw hh lx b fi ml mi l mj mk">Downloading packages:</span><span id="5077" class="mg jw hh lx b fi ml mi l mj mk">No Presto metadata available <strong class="lx hi">for</strong> <!-- -->ol7_latest</span><span id="b160" class="mg jw hh lx b fi ml mi l mj mk">(1/3): selinux-policy-3.13.1-166.0.2.el7.noarch.rpm | 435 kB 00:00:00</span><span id="f728" class="mg jw hh lx b fi ml mi l mj mk">(2/3): selinux-policy-targeted-3.13.1-166.0.2.el7.noarch.rpm | 6.5 MB 00:00:01</span><span id="9c2d" class="mg jw hh lx b fi ml mi l mj mk">(3/3): docker-engine-17.03.1.ce-3.0.1.el7.x86_64.rpm | 19 MB 00:00:04</span><span id="4cb5" class="mg jw hh lx b fi ml mi l mj mk">------------------------------------------------------------------------------------------------------------------------------------------------------</span><span id="2410" class="mg jw hh lx b fi ml mi l mj mk">Total 6.2 MB/s<!-- --> <!-- -->| 26 MB 00:00:04</span><span id="19c3" class="mg jw hh lx b fi ml mi l mj mk">Running transaction check</span><span id="325b" class="mg jw hh lx b fi ml mi l mj mk">Running transaction test</span><span id="a5bf" class="mg jw hh lx b fi ml mi l mj mk">Transaction test<!-- --> <!-- -->succeeded</span><span id="88a8" class="mg jw hh lx b fi ml mi l mj mk">Running transaction</span><span id="56fc" class="mg jw hh lx b fi ml mi l mj mk">Updating : selinux-policy-3.13.1-166.0.2.el7.noarch 1/5</span><span id="136d" class="mg jw hh lx b fi ml mi l mj mk">Updating : selinux-policy-targeted-3.13.1-166.0.2.el7.noarch 2/5</span><span id="d4a0" class="mg jw hh lx b fi ml mi l mj mk">Installing : docker-engine-17.03.1.ce-3.0.1.el7.x86_64 3/5</span><span id="3819" class="mg jw hh lx b fi ml mi l mj mk">Cleanup : selinux-policy-targeted-3.13.1-102.0.3.el7_3.16.noarch 4/5</span><span id="1199" class="mg jw hh lx b fi ml mi l mj mk">Cleanup : selinux-policy-3.13.1-102.0.3.el7_3.16.noarch 5/5</span><span id="93f2" class="mg jw hh lx b fi ml mi l mj mk">Verifying : selinux-policy-targeted-3.13.1-166.0.2.el7.noarch 1/5</span><span id="a272" class="mg jw hh lx b fi ml mi l mj mk">Verifying : selinux-policy-3.13.1-166.0.2.el7.noarch 2/5</span><span id="a355" class="mg jw hh lx b fi ml mi l mj mk">Verifying : docker-engine-17.03.1.ce-3.0.1.el7.x86_64 3/5</span><span id="d85c" class="mg jw hh lx b fi ml mi l mj mk">Verifying : selinux-policy-targeted-3.13.1-102.0.3.el7_3.16.noarch 4/5</span><span id="61c1" class="mg jw hh lx b fi ml mi l mj mk">Verifying : selinux-policy-3.13.1-102.0.3.el7_3.16.noarch 5/5</span><span id="19c7" class="mg jw hh lx b fi ml mi l mj mk">Installed:</span><span id="ef63" class="mg jw hh lx b fi ml mi l mj mk">docker-engine.x86_64 0:17.03.1.ce-3.0.1.el7</span><span id="9107" class="mg jw hh lx b fi ml mi l mj mk">Updated:</span><span id="9bba" class="mg jw hh lx b fi ml mi l mj mk">selinux-policy-targeted.noarch 0:3.13.1-166.0.2.el7</span><span id="70f9" class="mg jw hh lx b fi ml mi l mj mk">Dependency Updated:</span><span id="15d0" class="mg jw hh lx b fi ml mi l mj mk">selinux-policy.noarch 0:3.13.1-166.0.2.el7</span><span id="d613" class="mg jw hh lx b fi ml mi l mj mk">Complete!</span></pre><p id="2cd7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">就是这样！Docker现已安装在机器上。在继续构建映像之前，我首先必须适当地配置我的环境。</p><h1 id="839e" class="jv jw hh bd jx jy lj ka kb kc lk ke kf kg ll ki kj kk lm km kn ko ln kq kr ks bi translated">启用非超级用户</h1><p id="a3eb" class="pw-post-body-paragraph ip iq hh ir b is kv iu iv iw kw iy iz ja lo jc jd je lp jg jh ji lq jk jl jm ha bi translated">我想做的第一件事是让一个非root用户能够与Docker引擎通信。启用非root用户也相当简单。安装Docker时，一个新的Unix组<code class="du lu lv lw lx b">docker</code>也随之创建。如果您希望允许用户直接与Docker守护进程通信，从而避免作为<code class="du lu lv lw lx b">root</code>用户运行，您所要做的就是将该用户添加到<code class="du lu lv lw lx b">docker</code>组。在我的例子中，我想将<code class="du lu lv lw lx b">oracle</code>用户添加到该组:</p><pre class="ly lz ma mb fd mc lx md me aw mf bi"><span id="be82" class="mg jw hh lx b fi mh mi l mj mk">[root@localhost ~]# id oracle</span><span id="614f" class="mg jw hh lx b fi ml mi l mj mk">uid=1000(oracle) gid=1001(oracle) groups=1001(oracle),1000(dba)</span><span id="e136" class="mg jw hh lx b fi ml mi l mj mk">[root@localhost ~]# usermod -a -G docker oracle</span><span id="a56e" class="mg jw hh lx b fi ml mi l mj mk">[root@localhost ~]# id oracle</span><span id="9a48" class="mg jw hh lx b fi ml mi l mj mk">uid=1000(oracle) gid=1001(oracle) groups=1001(oracle),1000(dba),981(docker)</span></pre><h1 id="6c39" class="jv jw hh bd jx jy lj ka kb kc lk ke kf kg ll ki kj kk lm km kn ko ln kq kr ks bi translated">增加基本图像大小</h1><p id="61b7" class="pw-post-body-paragraph ip iq hh ir b is kv iu iv iw kw iy iz ja lo jc jd je lp jg jh ji lq jk jl jm ha bi translated">在运行映像构建之前，我想仔细检查一个重要参数:Docker容器的默认基本映像大小。过去，默认情况下，Docker的最大容器大小为10 GB。虽然这对于在Docker容器中运行一些应用程序来说已经足够了，但是对于Oracle数据库来说，这需要增加。Oracle数据库12.2.0.1映像需要大约13GB的空间来构建映像。</p><p id="4600" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最近，默认大小已经增加到25GB，这对于Oracle数据库映像来说已经足够了。可以在<code class="du lu lv lw lx b">/etc/sysconfig/docker-storage</code>中找到并再次检查设置，作为<code class="du lu lv lw lx b">storage-opt dm.basesize</code>参数:</p><pre class="ly lz ma mb fd mc lx md me aw mf bi"><span id="960c" class="mg jw hh lx b fi mh mi l mj mk">[root@localhost ~]# cat /etc/sysconfig/docker-storage</span><span id="a07b" class="mg jw hh lx b fi ml mi l mj mk"># This file may be automatically generated by an installation program.</span><span id="743a" class="mg jw hh lx b fi ml mi l mj mk"># By default, Docker uses a loopback-mounted sparse file in</span><span id="03c2" class="mg jw hh lx b fi ml mi l mj mk"># /var/lib/docker. The loopback makes it slower, and there are some</span><span id="2def" class="mg jw hh lx b fi ml mi l mj mk"># restrictive defaults, such as 100GB max storage.</span><span id="eaae" class="mg jw hh lx b fi ml mi l mj mk"># If your installation did not set a custom storage for Docker, you</span><span id="2d0b" class="mg jw hh lx b fi ml mi l mj mk"># may do it below.</span><span id="898f" class="mg jw hh lx b fi ml mi l mj mk"># Example: Use a custom pair of raw logical volumes (one for metadata,</span><span id="9613" class="mg jw hh lx b fi ml mi l mj mk"># one for data).</span><span id="136e" class="mg jw hh lx b fi ml mi l mj mk"># DOCKER_STORAGE_OPTIONS = --storage-opt dm.metadatadev=/dev/mylogvol/my-docker-metadata --storage-opt dm.datadev=/dev/mylogvol/my-docker-data</span><span id="d8ef" class="mg jw hh lx b fi ml mi l mj mk">DOCKER_STORAGE_OPTIONS= --storage-driver devicemapper --storage-opt dm.basesize=25G</span></pre><h1 id="d745" class="jv jw hh bd jx jy lj ka kb kc lk ke kf kg ll ki kj kk lm km kn ko ln kq kr ks bi translated">启动并启用Docker服务</h1><p id="ddd7" class="pw-post-body-paragraph ip iq hh ir b is kv iu iv iw kw iy iz ja lo jc jd je lp jg jh ji lq jk jl jm ha bi translated">最后一步是启动<code class="du lu lv lw lx b">docker</code>服务，并将其配置为在引导时启动。这是通过<code class="du lu lv lw lx b">systemctl</code>命令完成的:</p><pre class="ly lz ma mb fd mc lx md me aw mf bi"><span id="0d5d" class="mg jw hh lx b fi mh mi l mj mk">[root@localhost ~]# systemctl start docker</span><span id="ec2f" class="mg jw hh lx b fi ml mi l mj mk">[root@localhost ~]# systemctl enable docker</span><span id="2e8b" class="mg jw hh lx b fi ml mi l mj mk">Created symlink<!-- --> <!-- -->from /etc/systemd/system/multi-user.target.wants/docker.service to /usr/lib/systemd/system/docker.service.</span><span id="c325" class="mg jw hh lx b fi ml mi l mj mk">[root@localhost ~]# systemctl status docker</span><span id="0927" class="mg jw hh lx b fi ml mi l mj mk">● docker.service - Docker Application Container Engine</span><span id="2429" class="mg jw hh lx b fi ml mi l mj mk">Loaded: loaded (/usr/lib/systemd/system/docker.service; enabled; vendor preset: disabled)</span><span id="430b" class="mg jw hh lx b fi ml mi l mj mk">Drop-In: /etc/systemd/system/docker.service.d</span><span id="d3fc" class="mg jw hh lx b fi ml mi l mj mk">└─docker-sysconfig.conf</span><span id="9722" class="mg jw hh lx b fi ml mi l mj mk">Active: active (running) since Sun 2017-08-20 14:18:16 EDT; 5s ago</span><span id="49c1" class="mg jw hh lx b fi ml mi l mj mk">Docs: https://docs.docker.com</span><span id="ef29" class="mg jw hh lx b fi ml mi l mj mk">Main PID: 19203 (dockerd)</span><span id="ee19" class="mg jw hh lx b fi ml mi l mj mk">Memory: 12.8M</span><span id="65ab" class="mg jw hh lx b fi ml mi l mj mk">CGroup: /system.slice/docker.service</span><span id="6b53" class="mg jw hh lx b fi ml mi l mj mk">├─19203 /usr/bin/dockerd<!-- --> <!-- -->--selinux-enabled --storage-driver devicemapper --storage-opt dm.basesize=25G</span><span id="95ba" class="mg jw hh lx b fi ml mi l mj mk">└─19207 docker-containerd -l unix:///var/run/docker/libcontainerd/docker-containerd.sock --metrics-interval=0 --start-timeout 2m --state...</span></pre><p id="25fc" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最后一步，您可以通过<code class="du lu lv lw lx b">docker info</code>验证设置和基本图像尺寸(检查<code class="du lu lv lw lx b">Base Device Size:</code>):</p><pre class="ly lz ma mb fd mc lx md me aw mf bi"><span id="e84d" class="mg jw hh lx b fi mh mi l mj mk">[root@localhost ~]# docker info</span><span id="1a16" class="mg jw hh lx b fi ml mi l mj mk">Containers: 0</span><span id="dc6c" class="mg jw hh lx b fi ml mi l mj mk">Running: 0</span><span id="1d82" class="mg jw hh lx b fi ml mi l mj mk">Paused: 0</span><span id="097c" class="mg jw hh lx b fi ml mi l mj mk">Stopped: 0</span><span id="96f6" class="mg jw hh lx b fi ml mi l mj mk">Images: 0</span><span id="f3d0" class="mg jw hh lx b fi ml mi l mj mk">Server Version: 17.03.1-ce</span><span id="4ad9" class="mg jw hh lx b fi ml mi l mj mk">Storage Driver: devicemapper</span><span id="6215" class="mg jw hh lx b fi ml mi l mj mk">Pool Name: docker-249:0-202132724-pool</span><span id="fdaa" class="mg jw hh lx b fi ml mi l mj mk">Pool Blocksize: 65.54 kB</span><span id="3a3d" class="mg jw hh lx b fi ml mi l mj mk">Base Device Size: 26.84 GB</span><span id="dcb8" class="mg jw hh lx b fi ml mi l mj mk">Backing Filesystem: xfs</span><span id="18e9" class="mg jw hh lx b fi ml mi l mj mk">Data file: /dev/loop0</span><span id="30c0" class="mg jw hh lx b fi ml mi l mj mk">Metadata file: /dev/loop1</span><span id="deb2" class="mg jw hh lx b fi ml mi l mj mk">Data Space Used: 14.42 MB</span><span id="3b1d" class="mg jw hh lx b fi ml mi l mj mk">Data Space Total: 107.4 GB</span><span id="eeae" class="mg jw hh lx b fi ml mi l mj mk">Data Space Available: 47.98 GB</span><span id="fb85" class="mg jw hh lx b fi ml mi l mj mk">Metadata Space Used: 581.6 kB</span><span id="9224" class="mg jw hh lx b fi ml mi l mj mk">Metadata Space Total: 2.147 GB</span><span id="0260" class="mg jw hh lx b fi ml mi l mj mk">Metadata Space Available: 2.147 GB</span><span id="2765" class="mg jw hh lx b fi ml mi l mj mk">Thin Pool Minimum Free Space: 10.74 GB</span><span id="8c9c" class="mg jw hh lx b fi ml mi l mj mk">Udev Sync Supported: true</span><span id="2572" class="mg jw hh lx b fi ml mi l mj mk">Deferred Removal Enabled: false</span><span id="3ffb" class="mg jw hh lx b fi ml mi l mj mk">Deferred Deletion Enabled: false</span><span id="d1fa" class="mg jw hh lx b fi ml mi l mj mk">Deferred Deleted Device Count: 0</span><span id="41f6" class="mg jw hh lx b fi ml mi l mj mk">Data loop file: /var/lib/docker/devicemapper/devicemapper/data</span><span id="e180" class="mg jw hh lx b fi ml mi l mj mk">WARNING: Usage of loopback devices is strongly discouraged <strong class="lx hi">for</strong> <!-- -->production use. Use `--storage-opt dm.thinpooldev` to specify a custom block storage device.</span><span id="2c06" class="mg jw hh lx b fi ml mi l mj mk">Metadata loop file: /var/lib/docker/devicemapper/devicemapper/metadata</span><span id="fb69" class="mg jw hh lx b fi ml mi l mj mk">Library Version: 1.02.135-RHEL7 (2016-11-16)</span><span id="851a" class="mg jw hh lx b fi ml mi l mj mk">Logging Driver: json-file</span><span id="c4bf" class="mg jw hh lx b fi ml mi l mj mk">Cgroup Driver: cgroupfs</span><span id="732d" class="mg jw hh lx b fi ml mi l mj mk">Plugins:</span><span id="4472" class="mg jw hh lx b fi ml mi l mj mk">Volume: local</span><span id="698a" class="mg jw hh lx b fi ml mi l mj mk">Network: bridge host macvlan null overlay</span><span id="7c5d" class="mg jw hh lx b fi ml mi l mj mk">Swarm: inactive</span><span id="c282" class="mg jw hh lx b fi ml mi l mj mk">Runtimes: runc</span><span id="61f6" class="mg jw hh lx b fi ml mi l mj mk">Default Runtime: runc</span><span id="3a1a" class="mg jw hh lx b fi ml mi l mj mk">Init Binary: docker-init</span><span id="fd09" class="mg jw hh lx b fi ml mi l mj mk">containerd version: 4ab9917febca54791c5f071a9d1f404867857fcc</span><span id="57e4" class="mg jw hh lx b fi ml mi l mj mk">runc version: 54296cf40ad8143b62dbcaa1d90e520a2136ddfe</span><span id="4fe4" class="mg jw hh lx b fi ml mi l mj mk">init version: 949e6fa</span><span id="158c" class="mg jw hh lx b fi ml mi l mj mk">Security Options:</span><span id="d527" class="mg jw hh lx b fi ml mi l mj mk">seccomp</span><span id="67ab" class="mg jw hh lx b fi ml mi l mj mk">Profile: default</span><span id="46ba" class="mg jw hh lx b fi ml mi l mj mk">selinux</span><span id="619f" class="mg jw hh lx b fi ml mi l mj mk">Kernel Version: 4.1.12-94.3.8.el7uek.x86_64</span><span id="b1d0" class="mg jw hh lx b fi ml mi l mj mk">Operating System: Oracle Linux Server 7.3</span><span id="7986" class="mg jw hh lx b fi ml mi l mj mk">OSType: linux</span><span id="e3bd" class="mg jw hh lx b fi ml mi l mj mk">Architecture: x86_64</span><span id="0b06" class="mg jw hh lx b fi ml mi l mj mk">CPUs: 1</span><span id="31d0" class="mg jw hh lx b fi ml mi l mj mk">Total Memory: 7.795 GiB</span><span id="073b" class="mg jw hh lx b fi ml mi l mj mk">Name: localhost.localdomain</span><span id="73c1" class="mg jw hh lx b fi ml mi l mj mk">ID: D7CR:3DGV:QUGO:X7EB:AVX3:DWWW:RJIA:QVVT:I2YR:KJXV:ALR4:WLBV</span><span id="4ae9" class="mg jw hh lx b fi ml mi l mj mk">Docker Root Dir: /var/lib/docker</span><span id="cd99" class="mg jw hh lx b fi ml mi l mj mk">Debug Mode (client): false</span><span id="d446" class="mg jw hh lx b fi ml mi l mj mk">Debug Mode (server): false</span><span id="abe7" class="mg jw hh lx b fi ml mi l mj mk">Registry: https://index.docker.io/v1/</span><span id="c629" class="mg jw hh lx b fi ml mi l mj mk">Experimental: false</span><span id="a11c" class="mg jw hh lx b fi ml mi l mj mk">Insecure Registries:</span><span id="43dc" class="mg jw hh lx b fi ml mi l mj mk">127.0.0.0/8</span><span id="5f2b" class="mg jw hh lx b fi ml mi l mj mk">Live Restore Enabled: false</span></pre><p id="2778" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Docker本身的安装到此结束。</p></div><div class="ab cl jo jp go jq" role="separator"><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt ju"/><span class="jr bw bk js jt"/></div><div class="ha hb hc hd he"><h1 id="4818" class="jv jw hh bd jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks bi translated">构建Oracle数据库Docker映像</h1><p id="0097" class="pw-post-body-paragraph ip iq hh ir b is kv iu iv iw kw iy iz ja lo jc jd je lp jg jh ji lq jk jl jm ha bi translated">现在Docker已经启动并运行，我可以开始构建映像了。首先，我需要获得Docker构建文件和Oracle安装二进制文件，两者都很容易获得，如下所示。注意，我在以下所有步骤中使用了<code class="du lu lv lw lx b">oracle</code> Linux用户，我之前已经启用了这个用户来与Docker守护进程通信:</p><h1 id="f825" class="jv jw hh bd jx jy lj ka kb kc lk ke kf kg ll ki kj kk lm km kn ko ln kq kr ks bi translated">获取所需的文件</h1><h1 id="3716" class="jv jw hh bd jx jy lj ka kb kc lk ke kf kg ll ki kj kk lm km kn ko ln kq kr ks bi translated">Github构建文件</h1><p id="163d" class="pw-post-body-paragraph ip iq hh ir b is kv iu iv iw kw iy iz ja lo jc jd je lp jg jh ji lq jk jl jm ha bi translated">首先，我必须下载Docker构建文件。有各种方法可以做到这一点。例如，我可以直接克隆Git存储库。但是为了简单起见，对于不熟悉git的人，我只使用Github上的下载选项。如果你转到主存储库URL<a class="ae jn" href="https://github.com/oracle/docker-images/" rel="noopener ugc nofollow" target="_blank">https://github.com/oracle/docker-images/</a>，你会看到一个绿色按钮，上面写着“<code class="du lu lv lw lx b">Clone or download</code>”，点击它，你会看到选项“<code class="du lu lv lw lx b">Download ZIP</code>”。或者，您也可以通过静态URL直接下载存储库:<a class="ae jn" href="https://github.com/oracle/docker-images/archive/master.zip" rel="noopener ugc nofollow" target="_blank">https://github.com/oracle/docker-images/archive/master.zip</a></p><pre class="ly lz ma mb fd mc lx md me aw mf bi"><span id="94b0" class="mg jw hh lx b fi mh mi l mj mk">[oracle@localhost ~]$ wget https://github.com/oracle/docker-images/archive/master.zip</span><span id="dddc" class="mg jw hh lx b fi ml mi l mj mk">--2017-08-20 14:31:32-- https://github.com/oracle/docker-images/archive/master.zip</span><span id="b22f" class="mg jw hh lx b fi ml mi l mj mk">Resolving github.com (github.com)... 192.30.255.113, 192.30.255.112</span><span id="a265" class="mg jw hh lx b fi ml mi l mj mk">Connecting to github.com (github.com)|192.30.255.113|:443... connected.</span><span id="6481" class="mg jw hh lx b fi ml mi l mj mk">HTTP request sent, awaiting response... 302 Found</span><span id="2275" class="mg jw hh lx b fi ml mi l mj mk">Location: https://codeload.github.com/oracle/docker-images/zip/master<!-- --> <!-- -->[following]</span><span id="aa7e" class="mg jw hh lx b fi ml mi l mj mk">--2017-08-20 14:31:33-- https://codeload.github.com/oracle/docker-images/zip/master</span><span id="e2b7" class="mg jw hh lx b fi ml mi l mj mk">Resolving codeload.github.com (codeload.github.com)... 192.30.255.120, 192.30.255.121</span><span id="84b4" class="mg jw hh lx b fi ml mi l mj mk">Connecting to codeload.github.com (codeload.github.com)|192.30.255.120|:443... connected.</span><span id="1336" class="mg jw hh lx b fi ml mi l mj mk">HTTP request sent, awaiting response... 200 OK</span><span id="c648" class="mg jw hh lx b fi ml mi l mj mk">Length: unspecified [application/zip]</span><span id="f072" class="mg jw hh lx b fi ml mi l mj mk">Saving to: ‘master.zip’</span><span id="6498" class="mg jw hh lx b fi ml mi l mj mk">[ ] 4,411,616 3.37MB/s<!-- --> <strong class="lx hi">in</strong> <!-- -->1.2s</span><span id="97dd" class="mg jw hh lx b fi ml mi l mj mk">2017-08-20 14:31:34 (3.37 MB/s) - ‘master.zip’ saved [4411616]</span><span id="23c4" class="mg jw hh lx b fi ml mi l mj mk">[oracle@localhost ~]$ unzip master.zip</span><span id="8dd4" class="mg jw hh lx b fi ml mi l mj mk">Archive: master.zip</span><span id="a997" class="mg jw hh lx b fi ml mi l mj mk">21041a743e4b0a910b0e51e17793bb7b0b18efef</span><span id="e97d" class="mg jw hh lx b fi ml mi l mj mk">creating: docker-images-master/</span><span id="9d0f" class="mg jw hh lx b fi ml mi l mj mk">extracting: docker-images-master/.gitattributes</span><span id="44f1" class="mg jw hh lx b fi ml mi l mj mk">inflating: docker-images-master/.gitignore</span><span id="2f79" class="mg jw hh lx b fi ml mi l mj mk">inflating: docker-images-master/.gitmodules</span><span id="efe5" class="mg jw hh lx b fi ml mi l mj mk">inflating: docker-images-master/CODEOWNERS</span><span id="18c1" class="mg jw hh lx b fi ml mi l mj mk">inflating: docker-images-master/CONTRIBUTING.md</span><span id="131c" class="mg jw hh lx b fi ml mi l mj mk">...</span><span id="5272" class="mg jw hh lx b fi ml mi l mj mk">...</span><span id="64c9" class="mg jw hh lx b fi ml mi l mj mk">...</span><span id="700a" class="mg jw hh lx b fi ml mi l mj mk">creating: docker-images-master/OracleDatabase/</span><span id="0396" class="mg jw hh lx b fi ml mi l mj mk">extracting: docker-images-master/OracleDatabase/.gitignore</span><span id="f756" class="mg jw hh lx b fi ml mi l mj mk">inflating: docker-images-master/OracleDatabase/COPYRIGHT</span><span id="8473" class="mg jw hh lx b fi ml mi l mj mk">inflating: docker-images-master/OracleDatabase/LICENSE</span><span id="9353" class="mg jw hh lx b fi ml mi l mj mk">inflating: docker-images-master/OracleDatabase/README.md</span><span id="f14d" class="mg jw hh lx b fi ml mi l mj mk">creating: docker-images-master/OracleDatabase/dockerfiles/</span><span id="36c6" class="mg jw hh lx b fi ml mi l mj mk">...</span><span id="851b" class="mg jw hh lx b fi ml mi l mj mk">...</span><span id="ebe2" class="mg jw hh lx b fi ml mi l mj mk">...</span><span id="d0d0" class="mg jw hh lx b fi ml mi l mj mk">inflating: docker-images-master/README.md</span><span id="30c8" class="mg jw hh lx b fi ml mi l mj mk">[oracle@localhost ~]$</span></pre><h1 id="89dc" class="jv jw hh bd jx jy lj ka kb kc lk ke kf kg ll ki kj kk lm km kn ko ln kq kr ks bi translated">Oracle安装二进制文件</h1><p id="f02b" class="pw-post-body-paragraph ip iq hh ir b is kv iu iv iw kw iy iz ja lo jc jd je lp jg jh ji lq jk jl jm ha bi translated">对于Oracle二进制文件，只需从您通常下载它们的地方下载即可。<a class="ae jn" href="http://www.oracle.com/technetwork/database/enterprise-edition/downloads/index.html" rel="noopener ugc nofollow" target="_blank">甲骨文科技网</a>大概是大多数人去的地方。下载后，您可以继续构建映像:</p><pre class="ly lz ma mb fd mc lx md me aw mf bi"><span id="e23d" class="mg jw hh lx b fi mh mi l mj mk">[oracle@localhost ~]$ ls<!-- --> <!-- -->-al *database*zip</span><span id="4022" class="mg jw hh lx b fi ml mi l mj mk">-rw-r--r--. 1 oracle oracle 1354301440 Aug 20 14:40 linuxx64_12201_database.zip</span></pre><h1 id="24bb" class="jv jw hh bd jx jy lj ka kb kc lk ke kf kg ll ki kj kk lm km kn ko ln kq kr ks bi translated">建立形象</h1><p id="6c81" class="pw-post-body-paragraph ip iq hh ir b is kv iu iv iw kw iy iz ja lo jc jd je lp jg jh ji lq jk jl jm ha bi translated">现在我有了所有的文件，是时候构建Docker映像了。您将在<code class="du lu lv lw lx b">docker-images-master/OracleDatabase/SingleInstance</code>目录中找到一个单独的<a class="ae jn" href="https://github.com/oracle/docker-images/blob/master/OracleDatabase/SingleInstance/README.md" rel="noopener ugc nofollow" target="_blank"> README.md </a>，它更详细地解释了构建过程。确保你总是阅读那个文件，因为它将总是反映构建文件中的最新变化！您还会在<code class="du lu lv lw lx b">docker-images-master/OracleDatabase/SingleInstance/dockerfiles</code>目录中找到一个<code class="du lu lv lw lx b">buildDockerImage.sh</code> shell脚本，它会为您完成构建的前期工作。对于构建，我必须将安装文件复制到正确的版本目录中。因为我要创建一个Oracle数据库12.2.0.1映像，所以我需要将安装zip文件复制到<code class="du lu lv lw lx b">docker-images-master/OracleDatabase/SingleInstance/dockerfiles/12.2.0.1</code>:</p><pre class="ly lz ma mb fd mc lx md me aw mf bi"><span id="7b6a" class="mg jw hh lx b fi mh mi l mj mk">[oracle@localhost ~]$ cd<!-- --> <!-- -->docker-images-master/OracleDatabase/SingleInstance/dockerfiles/12.2.0.1/</span><span id="7507" class="mg jw hh lx b fi ml mi l mj mk">[oracle@localhost 12.2.0.1]$ cp<!-- --> <!-- -->~/linuxx64_12201_database.zip .</span><span id="8e88" class="mg jw hh lx b fi ml mi l mj mk">[oracle@localhost 12.2.0.1]$ ls<!-- --> <!-- -->-al</span><span id="b247" class="mg jw hh lx b fi ml mi l mj mk">total 3372832</span><span id="c98a" class="mg jw hh lx b fi ml mi l mj mk">drwxrwxr-x. 2 oracle oracle 4096 Aug 20 14:44 .</span><span id="5e57" class="mg jw hh lx b fi ml mi l mj mk">drwxrwxr-x. 5 oracle oracle 77 Aug 19 00:35 ..</span><span id="8d44" class="mg jw hh lx b fi ml mi l mj mk">-rwxr-xr-x. 1 oracle oracle 1259 Aug 19 00:35 checkDBStatus.sh</span><span id="857e" class="mg jw hh lx b fi ml mi l mj mk">-rwxr-xr-x. 1 oracle oracle 909 Aug 19 00:35 checkSpace.sh</span><span id="b1e9" class="mg jw hh lx b fi ml mi l mj mk">-rw-rw-r--. 1 oracle oracle 62 Aug 19 00:35 Checksum.ee</span><span id="67ee" class="mg jw hh lx b fi ml mi l mj mk">-rw-rw-r--. 1 oracle oracle 62 Aug 19 00:35 Checksum.se2</span><span id="c14f" class="mg jw hh lx b fi ml mi l mj mk">-rwxr-xr-x. 1 oracle oracle 2964 Aug 19 00:35 createDB.sh</span><span id="0ec9" class="mg jw hh lx b fi ml mi l mj mk">-rw-rw-r--. 1 oracle oracle 9203 Aug 19 00:35 dbca.rsp.tmpl</span><span id="9073" class="mg jw hh lx b fi ml mi l mj mk">-rw-rw-r--. 1 oracle oracle 6878 Aug 19 00:35 db_inst.rsp</span><span id="708b" class="mg jw hh lx b fi ml mi l mj mk">-rw-rw-r--. 1 oracle oracle 2550 Aug 19 00:35 Dockerfile.ee</span><span id="3582" class="mg jw hh lx b fi ml mi l mj mk">-rw-rw-r--. 1 oracle oracle 2552 Aug 19 00:35 Dockerfile.se2</span><span id="5733" class="mg jw hh lx b fi ml mi l mj mk">-rwxr-xr-x. 1 oracle oracle 2261 Aug 19 00:35 installDBBinaries.sh</span><span id="1ff1" class="mg jw hh lx b fi ml mi l mj mk">-rw-r--r--. 1 oracle oracle 3453696911 Aug 20 14:45 linuxx64_12201_database.zip</span><span id="5ee3" class="mg jw hh lx b fi ml mi l mj mk">-rwxr-xr-x. 1 oracle oracle 6151 Aug 19 00:35 runOracle.sh</span><span id="7aee" class="mg jw hh lx b fi ml mi l mj mk">-rwxr-xr-x. 1 oracle oracle 1026 Aug 19 00:35 runUserScripts.sh</span><span id="c12a" class="mg jw hh lx b fi ml mi l mj mk">-rwxr-xr-x. 1 oracle oracle 769 Aug 19 00:35 setPassword.sh</span><span id="c742" class="mg jw hh lx b fi ml mi l mj mk">-rwxr-xr-x. 1 oracle oracle 879 Aug 19 00:35 setupLinuxEnv.sh</span><span id="dffd" class="mg jw hh lx b fi ml mi l mj mk">-rwxr-xr-x. 1 oracle oracle 689 Aug 19 00:35 startDB.sh</span><span id="6d8c" class="mg jw hh lx b fi ml mi l mj mk">[oracle@localhost 12.2.0.1]$</span></pre><p id="f124" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在zip文件已经准备好了，我准备调用<code class="du lu lv lw lx b">dockerfiles</code>文件夹中的<code class="du lu lv lw lx b">buildDockerImage.sh</code> shell脚本。该脚本有两个参数，<code class="du lu lv lw lx b">-v</code>表示版本，<code class="du lu lv lw lx b">-e</code>表示我想要企业版。<strong class="ir hi">注意:映像的构建将提取Oracle Linux slim base映像，并在容器内执行一个</strong> <code class="du lu lv lw lx b"><strong class="ir hi">yum install</strong></code> <strong class="ir hi">和一个</strong> <code class="du lu lv lw lx b"><strong class="ir hi">yum upgrade</strong></code> <strong class="ir hi">。要想成功，必须具备互联网连接</strong>:</p><pre class="ly lz ma mb fd mc lx md me aw mf bi"><span id="c402" class="mg jw hh lx b fi mh mi l mj mk">[oracle@localhost 12.2.0.1]$ cd<!-- --> <!-- -->..</span><span id="d3f6" class="mg jw hh lx b fi ml mi l mj mk">[oracle@localhost dockerfiles]$ ./buildDockerImage.sh -v<!-- --> <!-- -->12.2.0.1 -e</span><span id="388f" class="mg jw hh lx b fi ml mi l mj mk">Checking <strong class="lx hi">if</strong> <!-- -->required packages are present and valid...</span><span id="fa31" class="mg jw hh lx b fi ml mi l mj mk">linuxx64_12201_database.zip: OK</span><span id="dc44" class="mg jw hh lx b fi ml mi l mj mk">==========================</span><span id="aec1" class="mg jw hh lx b fi ml mi l mj mk">DOCKER info:</span><span id="3359" class="mg jw hh lx b fi ml mi l mj mk">Containers: 0</span><span id="ce72" class="mg jw hh lx b fi ml mi l mj mk">Running: 0</span><span id="0a4b" class="mg jw hh lx b fi ml mi l mj mk">Paused: 0</span><span id="0a35" class="mg jw hh lx b fi ml mi l mj mk">Stopped: 0</span><span id="56e2" class="mg jw hh lx b fi ml mi l mj mk">Images: 0</span><span id="bb75" class="mg jw hh lx b fi ml mi l mj mk">Server Version: 17.03.1-ce</span><span id="25d3" class="mg jw hh lx b fi ml mi l mj mk">Storage Driver: devicemapper</span><span id="b569" class="mg jw hh lx b fi ml mi l mj mk">Pool Name: docker-249:0-202132724-pool</span><span id="932e" class="mg jw hh lx b fi ml mi l mj mk">Pool Blocksize: 65.54 kB</span><span id="0285" class="mg jw hh lx b fi ml mi l mj mk">Base Device Size: 26.84 GB</span><span id="e025" class="mg jw hh lx b fi ml mi l mj mk">Backing Filesystem: xfs</span><span id="8d55" class="mg jw hh lx b fi ml mi l mj mk">Data file: /dev/loop0</span><span id="7c01" class="mg jw hh lx b fi ml mi l mj mk">Metadata file: /dev/loop1</span><span id="9cf2" class="mg jw hh lx b fi ml mi l mj mk">Data Space Used: 14.42 MB</span><span id="417b" class="mg jw hh lx b fi ml mi l mj mk">Data Space Total: 107.4 GB</span><span id="160b" class="mg jw hh lx b fi ml mi l mj mk">Data Space Available: 47.98 GB</span><span id="8506" class="mg jw hh lx b fi ml mi l mj mk">Metadata Space Used: 581.6 kB</span><span id="f794" class="mg jw hh lx b fi ml mi l mj mk">Metadata Space Total: 2.147 GB</span><span id="ae8f" class="mg jw hh lx b fi ml mi l mj mk">Metadata Space Available: 2.147 GB</span><span id="353d" class="mg jw hh lx b fi ml mi l mj mk">Thin Pool Minimum Free Space: 10.74 GB</span><span id="ecca" class="mg jw hh lx b fi ml mi l mj mk">Udev Sync Supported: true</span><span id="3fc8" class="mg jw hh lx b fi ml mi l mj mk">Deferred Removal Enabled: false</span><span id="a530" class="mg jw hh lx b fi ml mi l mj mk">Deferred Deletion Enabled: false</span><span id="7730" class="mg jw hh lx b fi ml mi l mj mk">Deferred Deleted Device Count: 0</span><span id="917e" class="mg jw hh lx b fi ml mi l mj mk">Data loop file: /var/lib/docker/devicemapper/devicemapper/data</span><span id="ff72" class="mg jw hh lx b fi ml mi l mj mk">WARNING: Usage of loopback devices is strongly discouraged <strong class="lx hi">for</strong> <!-- -->production use. Use `--storage-opt dm.thinpooldev` to specify a custom block storage device.</span><span id="4487" class="mg jw hh lx b fi ml mi l mj mk">Metadata loop file: /var/lib/docker/devicemapper/devicemapper/metadata</span><span id="5ad9" class="mg jw hh lx b fi ml mi l mj mk">Library Version: 1.02.135-RHEL7 (2016-11-16)</span><span id="2862" class="mg jw hh lx b fi ml mi l mj mk">Logging Driver: json-file</span><span id="c506" class="mg jw hh lx b fi ml mi l mj mk">Cgroup Driver: cgroupfs</span><span id="839d" class="mg jw hh lx b fi ml mi l mj mk">Plugins:</span><span id="8c50" class="mg jw hh lx b fi ml mi l mj mk">Volume: local</span><span id="7cf8" class="mg jw hh lx b fi ml mi l mj mk">Network: bridge host macvlan null overlay</span><span id="7350" class="mg jw hh lx b fi ml mi l mj mk">Swarm: inactive</span><span id="d3b8" class="mg jw hh lx b fi ml mi l mj mk">Runtimes: runc</span><span id="b64d" class="mg jw hh lx b fi ml mi l mj mk">Default Runtime: runc</span><span id="2384" class="mg jw hh lx b fi ml mi l mj mk">Init Binary: docker-init</span><span id="3533" class="mg jw hh lx b fi ml mi l mj mk">containerd version: 4ab9917febca54791c5f071a9d1f404867857fcc</span><span id="1f63" class="mg jw hh lx b fi ml mi l mj mk">runc version: 54296cf40ad8143b62dbcaa1d90e520a2136ddfe</span><span id="03c6" class="mg jw hh lx b fi ml mi l mj mk">init version: 949e6fa</span><span id="529d" class="mg jw hh lx b fi ml mi l mj mk">Security Options:</span><span id="9c0b" class="mg jw hh lx b fi ml mi l mj mk">seccomp</span><span id="aa2f" class="mg jw hh lx b fi ml mi l mj mk">Profile: default</span><span id="2a6c" class="mg jw hh lx b fi ml mi l mj mk">selinux</span><span id="aba2" class="mg jw hh lx b fi ml mi l mj mk">Kernel Version: 4.1.12-94.3.8.el7uek.x86_64</span><span id="2155" class="mg jw hh lx b fi ml mi l mj mk">Operating System: Oracle Linux Server 7.3</span><span id="652b" class="mg jw hh lx b fi ml mi l mj mk">OSType: linux</span><span id="c83d" class="mg jw hh lx b fi ml mi l mj mk">Architecture: x86_64</span><span id="e48d" class="mg jw hh lx b fi ml mi l mj mk">CPUs: 1</span><span id="aaba" class="mg jw hh lx b fi ml mi l mj mk">Total Memory: 7.795 GiB</span><span id="dd3b" class="mg jw hh lx b fi ml mi l mj mk">Name: localhost.localdomain</span><span id="4a8a" class="mg jw hh lx b fi ml mi l mj mk">ID: D7CR:3DGV:QUGO:X7EB:AVX3:DWWW:RJIA:QVVT:I2YR:KJXV:ALR4:WLBV</span><span id="2e47" class="mg jw hh lx b fi ml mi l mj mk">Docker Root Dir: /var/lib/docker</span><span id="2181" class="mg jw hh lx b fi ml mi l mj mk">Debug Mode (client): false</span><span id="08da" class="mg jw hh lx b fi ml mi l mj mk">Debug Mode (server): false</span><span id="df05" class="mg jw hh lx b fi ml mi l mj mk">Registry: https://index.docker.io/v1/</span><span id="e97e" class="mg jw hh lx b fi ml mi l mj mk">Experimental: false</span><span id="d7f7" class="mg jw hh lx b fi ml mi l mj mk">Insecure Registries:</span><span id="6e20" class="mg jw hh lx b fi ml mi l mj mk">127.0.0.0/8</span><span id="a869" class="mg jw hh lx b fi ml mi l mj mk">Live Restore Enabled: false</span><span id="6837" class="mg jw hh lx b fi ml mi l mj mk">==========================</span><span id="8a1c" class="mg jw hh lx b fi ml mi l mj mk">Building image 'oracle/database:12.2.0.1-ee'<!-- --> <!-- -->...</span><span id="71c4" class="mg jw hh lx b fi ml mi l mj mk">Sending build context to Docker daemon 3.454 GB</span><span id="a193" class="mg jw hh lx b fi ml mi l mj mk">Step 1/16<!-- --> <!-- -->: FROM oraclelinux:7-slim</span><span id="7c7a" class="mg jw hh lx b fi ml mi l mj mk">7-slim: Pulling from library/oraclelinux</span><span id="fc1a" class="mg jw hh lx b fi ml mi l mj mk">3152c71f8d80: Pull complete</span><span id="bec1" class="mg jw hh lx b fi ml mi l mj mk">Digest: sha256:e464042b724d41350fb3ac2c2f84bd9d28d98302c9ebe66048a5367682e5fad2</span><span id="62ad" class="mg jw hh lx b fi ml mi l mj mk">Status: Downloaded newer image <strong class="lx hi">for</strong> <!-- -->oraclelinux:7-slim</span><span id="9ca8" class="mg jw hh lx b fi ml mi l mj mk">---&gt; c0feb50f7527</span><span id="be42" class="mg jw hh lx b fi ml mi l mj mk">Step 2/16<!-- --> <!-- -->: MAINTAINER Gerald Venzl</span><span id="e966" class="mg jw hh lx b fi ml mi l mj mk">---&gt; Running <strong class="lx hi">in</strong> <!-- -->e442cae35367</span><span id="6642" class="mg jw hh lx b fi ml mi l mj mk">---&gt; 08f875cea39d</span><span id="58ea" class="mg jw hh lx b fi ml mi l mj mk">...</span><span id="22e5" class="mg jw hh lx b fi ml mi l mj mk">...</span><span id="92e2" class="mg jw hh lx b fi ml mi l mj mk">...</span><span id="d114" class="mg jw hh lx b fi ml mi l mj mk">Step 15/16<!-- --> <!-- -->: EXPOSE 1521 5500</span><span id="e05c" class="mg jw hh lx b fi ml mi l mj mk">---&gt; Running <strong class="lx hi">in</strong> <!-- -->4476c1c236e1</span><span id="80b6" class="mg jw hh lx b fi ml mi l mj mk">---&gt; d01d39e39920</span><span id="1975" class="mg jw hh lx b fi ml mi l mj mk">Removing intermediate container 4476c1c236e1</span><span id="4918" class="mg jw hh lx b fi ml mi l mj mk">Step 16/16<!-- --> <!-- -->: CMD exec<!-- --> <!-- -->$ORACLE_BASE/$RUN_FILE</span><span id="b939" class="mg jw hh lx b fi ml mi l mj mk">---&gt; Running <strong class="lx hi">in</strong> <!-- -->8757674cc3d5</span><span id="fe16" class="mg jw hh lx b fi ml mi l mj mk">---&gt; 98129834d5ad</span><span id="87b4" class="mg jw hh lx b fi ml mi l mj mk">Removing intermediate container 8757674cc3d5</span><span id="1f5f" class="mg jw hh lx b fi ml mi l mj mk">Successfully built 98129834d5ad</span><span id="8ce2" class="mg jw hh lx b fi ml mi l mj mk">Oracle Database Docker Image <strong class="lx hi">for</strong> <!-- -->'ee'<!-- --> <!-- -->version 12.2.0.1 is ready to be extended:</span><span id="f00c" class="mg jw hh lx b fi ml mi l mj mk">--&gt; oracle/database:12.2.0.1-ee</span><span id="7e74" class="mg jw hh lx b fi ml mi l mj mk">Build completed <strong class="lx hi">in</strong> <!-- -->802 seconds.</span></pre><h1 id="5f05" class="jv jw hh bd jx jy lj ka kb kc lk ke kf kg ll ki kj kk lm km kn ko ln kq kr ks bi translated">在Docker容器中启动并连接到Oracle数据库</h1><p id="74de" class="pw-post-body-paragraph ip iq hh ir b is kv iu iv iw kw iy iz ja lo jc jd je lp jg jh ji lq jk jl jm ha bi translated">构建成功后，我现在可以在Docker容器中启动和运行Oracle数据库了。我所要做的就是发出<code class="du lu lv lw lx b">docker run</code>命令并传入适当的参数。一个重要的参数是用于将容器内部的端口映射到外部世界的<code class="du lu lv lw lx b">-p</code>。这是必需的，这样我也可以从Docker容器外部连接到数据库。另一个重要的参数是<code class="du lu lv lw lx b">-v</code>参数，它允许我将数据库的数据文件保存在Docker容器之外的位置。这很重要，因为它允许我保存我的数据，即使容器被扔掉。您应该始终使用<code class="du lu lv lw lx b">-v</code>参数或创建一个命名的Docker卷！我要使用的最后一个有用的参数是<code class="du lu lv lw lx b">--name</code>参数，它指定了Docker容器本身的名称。如果省略，将生成一个随机名称。但是，传递一个名称将允许我稍后通过该名称来引用容器:</p><pre class="ly lz ma mb fd mc lx md me aw mf bi"><span id="2ad5" class="mg jw hh lx b fi mh mi l mj mk">[oracle@localhost dockerfiles]$ cd<!-- --> <!-- -->~</span><span id="0122" class="mg jw hh lx b fi ml mi l mj mk">[oracle@localhost ~]$ mkdir<!-- --> <!-- -->oradata</span><span id="b643" class="mg jw hh lx b fi ml mi l mj mk">[oracle@localhost ~]$ chmod<!-- --> <!-- -->a+w oradata</span><span id="c247" class="mg jw hh lx b fi ml mi l mj mk">[oracle@localhost ~]$ docker run --name oracle-ee -p 1521:1521 -v<!-- --> <!-- -->/home/oracle/oradata:/opt/oracle/oradata<!-- --> <!-- -->oracle/database:12.2.0.1-ee</span><span id="41bd" class="mg jw hh lx b fi ml mi l mj mk">ORACLE PASSWORD FOR SYS, SYSTEM AND PDBADMIN: 3y4RL1K7org=1</span><span id="9f4d" class="mg jw hh lx b fi ml mi l mj mk">LSNRCTL <strong class="lx hi">for</strong> <!-- -->Linux: Version 12.2.0.1.0 - Production on 20-AUG-2017 19:07:55</span><span id="64bd" class="mg jw hh lx b fi ml mi l mj mk">Copyright (c) 1991, 2016, Oracle. All rights reserved.</span><span id="e7eb" class="mg jw hh lx b fi ml mi l mj mk">Starting /opt/oracle/product/12.2.0.1/dbhome_1/bin/tnslsnr: please wait...</span><span id="ca61" class="mg jw hh lx b fi ml mi l mj mk">TNSLSNR <strong class="lx hi">for</strong> <!-- -->Linux: Version 12.2.0.1.0 - Production</span><span id="81b0" class="mg jw hh lx b fi ml mi l mj mk">System parameter file<!-- --> <!-- -->is /opt/oracle/product/12.2.0.1/dbhome_1/network/admin/listener.ora</span><span id="47e8" class="mg jw hh lx b fi ml mi l mj mk">Log messages written to /opt/oracle/diag/tnslsnr/e3d1a2314421/listener/alert/log.xml</span><span id="4a71" class="mg jw hh lx b fi ml mi l mj mk">Listening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1)))</span><span id="5add" class="mg jw hh lx b fi ml mi l mj mk">Listening on: (DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=0.0.0.0)(PORT=1521)))</span><span id="6819" class="mg jw hh lx b fi ml mi l mj mk">Connecting to (DESCRIPTION=(ADDRESS=(PROTOCOL=IPC)(KEY=EXTPROC1)))</span><span id="e7f8" class="mg jw hh lx b fi ml mi l mj mk">STATUS of the LISTENER</span><span id="a585" class="mg jw hh lx b fi ml mi l mj mk">------------------------</span><span id="ac16" class="mg jw hh lx b fi ml mi l mj mk">Alias LISTENER</span><span id="d22f" class="mg jw hh lx b fi ml mi l mj mk">Version TNSLSNR <strong class="lx hi">for</strong> <!-- -->Linux: Version 12.2.0.1.0 - Production</span><span id="64d8" class="mg jw hh lx b fi ml mi l mj mk">Start Date 20-AUG-2017 19:07:56</span><span id="d2e8" class="mg jw hh lx b fi ml mi l mj mk">Uptime 0 days 0 hr. 0 min. 0 sec</span><span id="6d94" class="mg jw hh lx b fi ml mi l mj mk">Trace Level off</span><span id="0182" class="mg jw hh lx b fi ml mi l mj mk">Security ON: Local OS Authentication</span><span id="89f3" class="mg jw hh lx b fi ml mi l mj mk">SNMP OFF</span><span id="4606" class="mg jw hh lx b fi ml mi l mj mk">Listener Parameter File /opt/oracle/product/12.2.0.1/dbhome_1/network/admin/listener.ora</span><span id="da3d" class="mg jw hh lx b fi ml mi l mj mk">Listener Log File /opt/oracle/diag/tnslsnr/e3d1a2314421/listener/alert/log.xml</span><span id="3cac" class="mg jw hh lx b fi ml mi l mj mk">Listening Endpoints Summary...</span><span id="5264" class="mg jw hh lx b fi ml mi l mj mk">(DESCRIPTION=(ADDRESS=(PROTOCOL=ipc)(KEY=EXTPROC1)))</span><span id="e50d" class="mg jw hh lx b fi ml mi l mj mk">(DESCRIPTION=(ADDRESS=(PROTOCOL=tcp)(HOST=0.0.0.0)(PORT=1521)))</span><span id="b16a" class="mg jw hh lx b fi ml mi l mj mk">The listener supports no services</span><span id="73ee" class="mg jw hh lx b fi ml mi l mj mk">The command<!-- --> <!-- -->completed successfully</span><span id="1355" class="mg jw hh lx b fi ml mi l mj mk">[WARNING] [DBT-10102] The listener configuration is not selected <strong class="lx hi">for</strong> <!-- -->the database. EM DB Express URL will not be accessible.</span><span id="9208" class="mg jw hh lx b fi ml mi l mj mk">CAUSE: The database should be registered with a listener <strong class="lx hi">in</strong> <!-- -->order to access the EM DB Express URL.</span><span id="e2e2" class="mg jw hh lx b fi ml mi l mj mk">ACTION: Select a listener to be registered or created with the database.</span><span id="7d4c" class="mg jw hh lx b fi ml mi l mj mk">Copying database files</span><span id="3137" class="mg jw hh lx b fi ml mi l mj mk">1% complete</span><span id="5104" class="mg jw hh lx b fi ml mi l mj mk">13% complete</span><span id="172b" class="mg jw hh lx b fi ml mi l mj mk">25% complete</span><span id="f979" class="mg jw hh lx b fi ml mi l mj mk">Creating and starting Oracle instance</span><span id="42bf" class="mg jw hh lx b fi ml mi l mj mk">26% complete</span><span id="36da" class="mg jw hh lx b fi ml mi l mj mk">30% complete</span><span id="8859" class="mg jw hh lx b fi ml mi l mj mk">31% complete</span><span id="917a" class="mg jw hh lx b fi ml mi l mj mk">35% complete</span><span id="2519" class="mg jw hh lx b fi ml mi l mj mk">38% complete</span><span id="6656" class="mg jw hh lx b fi ml mi l mj mk">39% complete</span><span id="95e2" class="mg jw hh lx b fi ml mi l mj mk">41% complete</span><span id="27ea" class="mg jw hh lx b fi ml mi l mj mk">Completing Database Creation</span><span id="2489" class="mg jw hh lx b fi ml mi l mj mk">42% complete</span><span id="0f04" class="mg jw hh lx b fi ml mi l mj mk">43% complete</span><span id="51bb" class="mg jw hh lx b fi ml mi l mj mk">44% complete</span><span id="3dae" class="mg jw hh lx b fi ml mi l mj mk">46% complete</span><span id="98fc" class="mg jw hh lx b fi ml mi l mj mk">47% complete</span><span id="b52f" class="mg jw hh lx b fi ml mi l mj mk">50% complete</span><span id="1fa3" class="mg jw hh lx b fi ml mi l mj mk">Creating Pluggable Databases</span><span id="bdd7" class="mg jw hh lx b fi ml mi l mj mk">55% complete</span><span id="f012" class="mg jw hh lx b fi ml mi l mj mk">75% complete</span><span id="26b5" class="mg jw hh lx b fi ml mi l mj mk">Executing Post Configuration Actions</span><span id="b0e3" class="mg jw hh lx b fi ml mi l mj mk">100% complete</span><span id="ce81" class="mg jw hh lx b fi ml mi l mj mk">Look at the log file<!-- --> <!-- -->"/opt/oracle/cfgtoollogs/dbca/ORCLCDB/ORCLCDB.log"<!-- --> <strong class="lx hi">for</strong> <!-- -->further details.</span><span id="d72a" class="mg jw hh lx b fi ml mi l mj mk">SQL*Plus: Release 12.2.0.1.0 Production on Sun Aug 20 19:16:01 2017</span><span id="7283" class="mg jw hh lx b fi ml mi l mj mk">Copyright (c) 1982, 2016, Oracle. All rights reserved.</span><span id="256d" class="mg jw hh lx b fi ml mi l mj mk">Connected to:</span><span id="29a7" class="mg jw hh lx b fi ml mi l mj mk">Oracle Database 12c Enterprise Edition Release 12.2.0.1.0 - 64bit Production</span><span id="f5c3" class="mg jw hh lx b fi ml mi l mj mk">SQL&gt;</span><span id="2100" class="mg jw hh lx b fi ml mi l mj mk">System altered.</span><span id="039a" class="mg jw hh lx b fi ml mi l mj mk">SQL&gt;</span><span id="161f" class="mg jw hh lx b fi ml mi l mj mk">Pluggable database altered.</span><span id="b95d" class="mg jw hh lx b fi ml mi l mj mk">SQL&gt; Disconnected from Oracle Database 12c Enterprise Edition Release 12.2.0.1.0 - 64bit Production</span><span id="bcd8" class="mg jw hh lx b fi ml mi l mj mk">#########################</span><span id="dc08" class="mg jw hh lx b fi ml mi l mj mk">DATABASE IS READY TO USE!</span><span id="48e8" class="mg jw hh lx b fi ml mi l mj mk">#########################</span><span id="cfcd" class="mg jw hh lx b fi ml mi l mj mk">The following output is now a tail<!-- --> <!-- -->of the alert.log:</span><span id="7622" class="mg jw hh lx b fi ml mi l mj mk">Completed: alter pluggable database ORCLPDB1 open</span><span id="9214" class="mg jw hh lx b fi ml mi l mj mk">2017-08-20T19:16:01.025829+00:00</span><span id="2039" class="mg jw hh lx b fi ml mi l mj mk">ORCLPDB1(3):CREATE SMALLFILE TABLESPACE "USERS"<!-- --> <!-- -->LOGGING DATAFILE '/opt/oracle/oradata/ORCLCDB/ORCLPDB1/users01.dbf'<!-- --> <!-- -->SIZE 5M REUSE AUTOEXTEND ON NEXT 1280K MAXSIZE UNLIMITED EXTENT MANAGEMENT LOCAL SEGMENT SPACE MANAGEMENT AUTO</span><span id="977e" class="mg jw hh lx b fi ml mi l mj mk">ORCLPDB1(3):Completed: CREATE SMALLFILE TABLESPACE "USERS"<!-- --> <!-- -->LOGGING DATAFILE '/opt/oracle/oradata/ORCLCDB/ORCLPDB1/users01.dbf'<!-- --> <!-- -->SIZE 5M REUSE AUTOEXTEND ON NEXT 1280K MAXSIZE UNLIMITED EXTENT MANAGEMENT LOCAL SEGMENT SPACE MANAGEMENT AUTO</span><span id="b360" class="mg jw hh lx b fi ml mi l mj mk">ORCLPDB1(3):ALTER DATABASE DEFAULT TABLESPACE "USERS"</span><span id="50f7" class="mg jw hh lx b fi ml mi l mj mk">ORCLPDB1(3):Completed: ALTER DATABASE DEFAULT TABLESPACE "USERS"</span><span id="8b46" class="mg jw hh lx b fi ml mi l mj mk">2017-08-20T19:16:01.889003+00:00</span><span id="1c08" class="mg jw hh lx b fi ml mi l mj mk">ALTER SYSTEM SET control_files='/opt/oracle/oradata/ORCLCDB/control01.ctl'<!-- --> <!-- -->SCOPE=SPFILE;</span><span id="14bc" class="mg jw hh lx b fi ml mi l mj mk">ALTER PLUGGABLE DATABASE ORCLPDB1 SAVE STATE</span><span id="0608" class="mg jw hh lx b fi ml mi l mj mk">Completed: ALTER PLUGGABLE DATABASE ORCLPDB1 SAVE STATE</span></pre><p id="b821" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在容器第一次启动时，会创建一个新的数据库。同一容器或指向同一卷的新创建容器的后续启动将再次启动数据库。创建和/或启动数据库后，容器将对Oracle数据库alert.log文件运行<code class="du lu lv lw lx b">tail -f</code>。这样做是为了方便，这样发出一个<code class="du lu lv lw lx b">docker logs</code>命令将会实际打印出在该容器中运行的数据库的日志。一旦数据库被创建或启动，您将在输出中看到行<code class="du lu lv lw lx b"><strong class="ir hi">DATABASE IS READY TO USE!</strong></code>。之后，您可以连接到数据库。</p><h1 id="2b26" class="jv jw hh bd jx jy lj ka kb kc lk ke kf kg ll ki kj kk lm km kn ko ln kq kr ks bi translated">重置数据库管理员帐户密码</h1><p id="f7bd" class="pw-post-body-paragraph ip iq hh ir b is kv iu iv iw kw iy iz ja lo jc jd je lp jg jh ji lq jk jl jm ha bi translated">启动脚本还为数据库管理员帐户生成了一个密码。您可以在输出中的行<code class="du lu lv lw lx b">ORACLE PASSWORD FOR SYS, SYSTEM AND PDBADMIN:</code>旁边找到密码。您可以继续使用该密码，也可以将其重置为您选择的密码。该容器提供了一个名为<code class="du lu lv lw lx b">setPassword.sh</code>的脚本，用于重置密码。在新的shell中，只需对正在运行的容器执行以下命令:</p><pre class="ly lz ma mb fd mc lx md me aw mf bi"><span id="1407" class="mg jw hh lx b fi mh mi l mj mk">[oracle@localhost ~]$ docker exec<!-- --> <!-- -->oracle-ee ./setPassword.sh LetsDocker</span><span id="4538" class="mg jw hh lx b fi ml mi l mj mk">The Oracle base remains unchanged with value /opt/oracle</span><span id="27c1" class="mg jw hh lx b fi ml mi l mj mk">SQL*Plus: Release 12.2.0.1.0 Production on Sun Aug 20 19:17:08 2017</span><span id="9c83" class="mg jw hh lx b fi ml mi l mj mk">Copyright (c) 1982, 2016, Oracle. All rights reserved.</span><span id="8469" class="mg jw hh lx b fi ml mi l mj mk">Connected to:</span><span id="1976" class="mg jw hh lx b fi ml mi l mj mk">Oracle Database 12c Enterprise Edition Release 12.2.0.1.0 - 64bit Production</span><span id="1b9b" class="mg jw hh lx b fi ml mi l mj mk">SQL&gt;</span><span id="ec42" class="mg jw hh lx b fi ml mi l mj mk">User altered.</span><span id="11ee" class="mg jw hh lx b fi ml mi l mj mk">SQL&gt;</span><span id="88f7" class="mg jw hh lx b fi ml mi l mj mk">User altered.</span><span id="0fed" class="mg jw hh lx b fi ml mi l mj mk">SQL&gt;</span><span id="ac03" class="mg jw hh lx b fi ml mi l mj mk">Session altered.</span><span id="0c9b" class="mg jw hh lx b fi ml mi l mj mk">SQL&gt;</span><span id="1e5d" class="mg jw hh lx b fi ml mi l mj mk">User altered.</span><span id="f0c9" class="mg jw hh lx b fi ml mi l mj mk">SQL&gt; Disconnected from Oracle Database 12c Enterprise Edition Release 12.2.0.1.0 - 64bit Production</span></pre><h1 id="ca49" class="jv jw hh bd jx jy lj ka kb kc lk ke kf kg ll ki kj kk lm km kn ko ln kq kr ks bi translated">连接到Oracle数据库</h1><p id="56bd" class="pw-post-body-paragraph ip iq hh ir b is kv iu iv iw kw iy iz ja lo jc jd je lp jg jh ji lq jk jl jm ha bi translated">现在容器正在运行，端口1521映射到外部世界，我可以连接到容器内部的数据库:</p><pre class="ly lz ma mb fd mc lx md me aw mf bi"><span id="bd62" class="mg jw hh lx b fi mh mi l mj mk">[oracle@localhost ~]$ sql system/LetsDocker@//localhost:1521/ORCLPDB1</span><span id="f089" class="mg jw hh lx b fi ml mi l mj mk">SQLcl: Release 4.2.0 Production on Sun Aug 20 19:56:43 2017</span><span id="22c8" class="mg jw hh lx b fi ml mi l mj mk">Copyright (c) 1982, 2017, Oracle. All rights reserved.</span><span id="e752" class="mg jw hh lx b fi ml mi l mj mk">Last Successful login time: Sun Aug 20 2017 12:21:42 -07:00</span><span id="3916" class="mg jw hh lx b fi ml mi l mj mk">Connected to:</span><span id="b889" class="mg jw hh lx b fi ml mi l mj mk">Oracle Database 12c Enterprise Edition Release 12.2.0.1.0 - 64bit Production</span><span id="c1d6" class="mg jw hh lx b fi ml mi l mj mk">SQL&gt; grant connect, resource to gvenzl identified by supersecretpwd;</span><span id="1770" class="mg jw hh lx b fi ml mi l mj mk">Grant succeeded.</span><span id="4602" class="mg jw hh lx b fi ml mi l mj mk">SQL&gt; conn gvenzl/supersecretpwd@//localhost:1521/ORCLPDB1</span><span id="318a" class="mg jw hh lx b fi ml mi l mj mk">Connected.</span><span id="996c" class="mg jw hh lx b fi ml mi l mj mk">SQL&gt;</span></pre><h1 id="1105" class="jv jw hh bd jx jy lj ka kb kc lk ke kf kg ll ki kj kk lm km kn ko ln kq kr ks bi translated">停止Oracle数据库Docker容器</h1><p id="17bc" class="pw-post-body-paragraph ip iq hh ir b is kv iu iv iw kw iy iz ja lo jc jd je lp jg jh ji lq jk jl jm ha bi translated">如果你想停止Docker容器，你可以通过<code class="du lu lv lw lx b">docker stop</code>命令来完成。您所要做的就是发出命令并传递容器名或id。这将触发容器为容器内部的数据库发出一个<code class="du lu lv lw lx b">shutdown immediate</code>。默认情况下，Docker在杀死容器之前只允许10秒钟关闭容器。对于应用程序来说，这可能没什么问题，但是对于Oracle数据库容器这样的持久性容器，您可能需要给容器多一点时间来适当地关闭数据库。您可以通过<code class="du lu lv lw lx b">-t</code>选项来实现这一点，该选项允许您传递一个新的超时值，以秒为单位，让容器成功关闭。我将给数据库30秒的关闭时间，但是需要指出的是，给容器多长时间的关闭时间并不重要。一旦数据库关闭，容器将正常退出。它不会等待您指定的所有秒数，直到返回控制权。因此，即使您给它10分钟(600秒)，它仍然会在数据库关闭后立即返回。在为繁忙的数据库容器指定超时时，请记住这一点:</p><pre class="ly lz ma mb fd mc lx md me aw mf bi"><span id="baeb" class="mg jw hh lx b fi mh mi l mj mk">[oracle@localhost ~]$ docker stop -t 30 oracle-ee</span><span id="0503" class="mg jw hh lx b fi ml mi l mj mk">oracle-ee</span></pre><h1 id="40b5" class="jv jw hh bd jx jy lj ka kb kc lk ke kf kg ll ki kj kk lm km kn ko ln kq kr ks bi translated">重新启动Oracle数据库Docker容器</h1><p id="173a" class="pw-post-body-paragraph ip iq hh ir b is kv iu iv iw kw iy iz ja lo jc jd je lp jg jh ji lq jk jl jm ha bi translated">停止的集装箱总是可以通过<code class="du lu lv lw lx b">docker start</code>命令重新启动:</p><pre class="ly lz ma mb fd mc lx md me aw mf bi"><span id="0857" class="mg jw hh lx b fi mh mi l mj mk">[oracle@localhost ~]$ docker start oracle-ee</span><span id="c9ac" class="mg jw hh lx b fi ml mi l mj mk">oracle-ee</span></pre><p id="81b9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><code class="du lu lv lw lx b">docker start</code>命令会将容器放入后台并立即返回控制权。您可以通过<code class="du lu lv lw lx b">docker logs</code>命令检查容器的状态，该命令应打印相同的<code class="du lu lv lw lx b"><strong class="ir hi">DATABASE IS READY TO USE!</strong></code>行。您还将看到，这一次数据库只是被重新启动，而不是被创建。注意，日志输出后会出现一个<code class="du lu lv lw lx b">docker logs -f</code>，即继续打印新行:</p><pre class="ly lz ma mb fd mc lx md me aw mf bi"><span id="14f6" class="mg jw hh lx b fi mh mi l mj mk">[oracle@localhost ~]$ docker logs oracle-ee</span><span id="74d6" class="mg jw hh lx b fi ml mi l mj mk">...</span><span id="9a39" class="mg jw hh lx b fi ml mi l mj mk">...</span><span id="89ef" class="mg jw hh lx b fi ml mi l mj mk">...</span><span id="a9a7" class="mg jw hh lx b fi ml mi l mj mk">SQL*Plus: Release 12.2.0.1.0 Production on Sun Aug 20 19:30:31 2017</span><span id="47b5" class="mg jw hh lx b fi ml mi l mj mk">Copyright (c) 1982, 2016, Oracle.  All rights reserved.</span><span id="ac6b" class="mg jw hh lx b fi ml mi l mj mk">Connected to an idle instance.</span><span id="e9af" class="mg jw hh lx b fi ml mi l mj mk">SQL&gt; ORACLE instance started.</span><span id="9e0d" class="mg jw hh lx b fi ml mi l mj mk">Total System Global Area 1610612736 bytes</span><span id="bd7e" class="mg jw hh lx b fi ml mi l mj mk">Fixed Size          8793304 bytes</span><span id="d547" class="mg jw hh lx b fi ml mi l mj mk">Variable Size         520094504 bytes</span><span id="f2f7" class="mg jw hh lx b fi ml mi l mj mk">Database Buffers     1073741824 bytes</span><span id="814b" class="mg jw hh lx b fi ml mi l mj mk">Redo Buffers            7983104 bytes</span><span id="0fa2" class="mg jw hh lx b fi ml mi l mj mk">Database mounted.</span><span id="1d4a" class="mg jw hh lx b fi ml mi l mj mk">Database opened.</span><span id="df23" class="mg jw hh lx b fi ml mi l mj mk">SQL&gt; Disconnected from Oracle Database 12c Enterprise Edition Release 12.2.0.1.0 - 64bit Production</span><span id="11b0" class="mg jw hh lx b fi ml mi l mj mk">#########################</span><span id="7f5f" class="mg jw hh lx b fi ml mi l mj mk">DATABASE IS READY TO USE!</span><span id="acf3" class="mg jw hh lx b fi ml mi l mj mk">#########################</span><span id="c60c" class="mg jw hh lx b fi ml mi l mj mk">The following output is now a tail<!-- --> <!-- -->of the alert.log:</span><span id="12c9" class="mg jw hh lx b fi ml mi l mj mk">ORCLPDB1(3):Undo initialization finished serial:0 start:6800170 end:6800239 diff:69 ms (0.1 seconds)</span><span id="97fa" class="mg jw hh lx b fi ml mi l mj mk">ORCLPDB1(3):Database Characterset <strong class="lx hi">for</strong> <!-- -->ORCLPDB1 is AL32UTF8</span><span id="2021" class="mg jw hh lx b fi ml mi l mj mk">ORCLPDB1(3):Opatch validation is skipped <strong class="lx hi">for</strong> <!-- -->PDB ORCLPDB1 (con_id=0)</span><span id="5510" class="mg jw hh lx b fi ml mi l mj mk">ORCLPDB1(3):Opening pdb with no Resource Manager plan active</span><span id="d432" class="mg jw hh lx b fi ml mi l mj mk">2017-08-20T19:30:43.703897+00:00</span><span id="fffc" class="mg jw hh lx b fi ml mi l mj mk">Pluggable database ORCLPDB1 opened read<!-- --> <!-- -->write</span></pre><p id="68e8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">既然数据库已经启动并再次运行，我可以再次连接到内部的数据库:</p><pre class="ly lz ma mb fd mc lx md me aw mf bi"><span id="b93e" class="mg jw hh lx b fi mh mi l mj mk">[oracle@localhost ~]$ sql gvenzl/supersecretpwd@//localhost:1521/ORCLPDB1</span><span id="748f" class="mg jw hh lx b fi ml mi l mj mk">SQLcl: Release 4.2.0 Production on Sun Aug 20 20:10:28 2017</span><span id="1e21" class="mg jw hh lx b fi ml mi l mj mk">Copyright (c) 1982, 2017, Oracle. All rights reserved.</span><span id="c0d1" class="mg jw hh lx b fi ml mi l mj mk">Connected to:</span><span id="517c" class="mg jw hh lx b fi ml mi l mj mk">Oracle Database 12c Enterprise Edition Release 12.2.0.1.0 - 64bit Production</span><span id="4be1" class="mg jw hh lx b fi ml mi l mj mk">SQL&gt; select<!-- --> <!-- -->sysdate from dual;</span><span id="363f" class="mg jw hh lx b fi ml mi l mj mk">SYSDATE</span><span id="a718" class="mg jw hh lx b fi ml mi l mj mk">---------</span><span id="51e4" class="mg jw hh lx b fi ml mi l mj mk">20-AUG-17</span><span id="7936" class="mg jw hh lx b fi ml mi l mj mk">SQL&gt; exit</span><span id="4c96" class="mg jw hh lx b fi ml mi l mj mk">Disconnected from Oracle Database 12c Enterprise Edition Release 12.2.0.1.0 - 64bit Production</span></pre><h1 id="8217" class="jv jw hh bd jx jy lj ka kb kc lk ke kf kg ll ki kj kk lm km kn ko ln kq kr ks bi translated">摘要</h1><p id="30c3" class="pw-post-body-paragraph ip iq hh ir b is kv iu iv iw kw iy iz ja lo jc jd je lp jg jh ji lq jk jl jm ha bi translated">本文总结了如何使用Docker将Oracle数据库容器化。请注意，Oracle还为其他Oracle数据库版本提供了构建文件。上述步骤基本相同，但是您应该始终参考构建文件附带的README.md。在那里，您还可以找到更多关于如何运行Oracle数据库容器的选项。</p><p id="b85e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Github资源库:<a class="ae jn" href="https://github.com/oracle/docker-images/tree/master/OracleDatabase" rel="noopener ugc nofollow" target="_blank">https://github . com/Oracle/docker-images/tree/master/Oracle database</a></p><p id="5c8f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">原文:<a class="ae jn" href="https://geraldonit.com/2017/08/21/creating-an-oracle-database-docker-image/" rel="noopener ugc nofollow" target="_blank">https://geraldonit . com/2017/08/21/creating-an-Oracle-database-docker-image/</a></p></div></div>    
</body>
</html>