<html>
<head>
<title>How to make a Slack bot with Mendix</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用Mendix制作一个Slack bot</h1>
<blockquote>原文：<a href="https://medium.com/mendix/how-to-make-a-slack-bot-with-mendix-781353dfee7?source=collection_archive---------1-----------------------#2021-12-09">https://medium.com/mendix/how-to-make-a-slack-bot-with-mendix-781353dfee7?source=collection_archive---------1-----------------------#2021-12-09</a></blockquote><div><div class="ef hi hj hk hl hm"/><div class="hn ho hp hq hr"><figure class="ht hu fm fo hv hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff hs"><img src="../Images/5a4e7f87891287f305db7cf53f318bf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XlfcacfZ0RoCcStbuzfogw.png"/></div></div></figure><div class=""/><h1 id="94b3" class="jc jd if bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">使用Slack REST API和Mendix发布的REST服务。</h1><blockquote class="ka"><p id="5da8" class="kb kc if bd kd ke kf kg kh ki kj kk ek translated">大家好，欢迎。作为一名为Mendix工作的开发人员传播者，我在这里的大部分职责是花大量时间监控Mendix社区Slack频道(<a class="ae kl" href="https://bit.ly/MxCommunitySlack" rel="noopener ugc nofollow" target="_blank">点击这里！</a>)。</p><p id="cdae" class="kb kc if bd kd ke kf kg kh ki kj kk ek translated">自然地，我们在工作空间中安装了一些令人惊讶的工具，这让我思考——制作一个Slack bot到底需要什么，单独使用Mendix能完成吗？</p></blockquote><p id="c4ef" class="pw-post-body-paragraph km kn if bd b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh kk hn dt translated">在网上搜索后，我发现每个例子都极其复杂，需要大量的Java、Python或Javascript编码技能。虽然我可以沿着这条路走下去，但我致力于用低代码的方式来做这件事。我很高兴我坚持下来了，因为我现在可以告诉你们所有人，这实际上是多么容易，你们所有人也可以使用Mendix制作一个Slack bot，而不用其他任何东西！</p><figure class="li lj lk ll fq hw"><div class="bz el l di"><div class="lm ln l"/></div></figure><h1 id="ffe2" class="jc jd if bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">我们今天做什么？</h1><p id="572b" class="pw-post-body-paragraph km kn if bd b ko lo kq kr ks lp ku kv kw lq ky kz la lr lc ld le ls lg lh kk hn dt translated">在本教程中，我们将制作一个Slack机器人，它可以使用RESTful api发送消息。它还将订阅频道内的事件，因此机器人将能够回复频道中发送的提及或某些关键字。</p><h1 id="5547" class="jc jd if bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">入门指南</h1><p id="6eb0" class="pw-post-body-paragraph km kn if bd b ko lo kq kr ks lp ku kv kw lq ky kz la lr lc ld le ls lg lh kk hn dt translated">在我们开始之前，请确保您注册了Slack，并有一个Slack工作区设置，通过一个通道，您也可以添加机器人。此外，由于Slack会向你的应用程序发布的REST服务发布消息，为了在开发过程中在本地测试你的应用程序，我建议使用隧道工具将你的本地主机暴露给web(为此我使用了<a class="ae kl" href="https://ngrok.com/" rel="noopener ugc nofollow" target="_blank"> NGROK </a>)。</p><h1 id="c86c" class="jc jd if bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">在空闲时设置bot</h1><p id="e710" class="pw-post-body-paragraph km kn if bd b ko lo kq kr ks lp ku kv kw lq ky kz la lr lc ld le ls lg lh kk hn dt translated">要开始，你可以去https://api.slack.com/apps?new_classic_app=1的<a class="ae kl" href="https://api.slack.com/apps?new_classic_app=1" rel="noopener ugc nofollow" target="_blank">点击<strong class="bd lt">创建新应用</strong>。</a></p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div class="ab fr cl lu"><img src="../Images/ad1cdaa1a7bbdd6932797b35e74e0f1b.png" data-original-src="https://miro.medium.com/v2/format:webp/0*K4PJ-0CBg_WixH8t.png"/></div></figure><p id="28e1" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">从头开始选择<strong class="bd lt"/>，给你的机器人起个名字，我要新建一个，叫它message bot。选择您为此创建的Slack工作区以在其中开发您的应用程序，然后单击“<strong class="bd lt">创建应用程序</strong>”。</p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div class="ab fr cl lu"><img src="../Images/4ff48b9458ca56f44eac49d74cb6f873.png" data-original-src="https://miro.medium.com/v2/format:webp/0*0RtVarJ5eQAz8ELr.png"/></div></figure><p id="ba46" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">一旦创建了您的应用程序，您就可以转到“<strong class="bd lt"> OAuth and permissions </strong>”，我们这里需要的是我们的bot的令牌，因此在“<strong class="bd lt">OAuth Tokens for Your Workspace”</strong>下，单击<strong class="bd lt">“Install to workplace”。现在它会说我们需要为我们的机器人添加一个范围。沿着页面往下走，你会看到一个标题为“<strong class="bd lt"> Bot token Scope </strong>”的部分。这就是我们需要的，所以点击<strong class="bd lt">添加OAuth范围</strong>，我们想要的是<strong class="bd lt"> Chat:write，</strong>或者对于<strong class="bd lt">公共频道</strong>你可以添加<strong class="bd lt"> Chat:write.public </strong>。</strong></p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div class="ab fr cl lu"><img src="../Images/67213ea966e813425fb5b64a00ea034a.png" data-original-src="https://miro.medium.com/v2/format:webp/0*5YGXZHr3KVeAVK4C.png"/></div></figure><p id="bd7e" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">这将允许机器人在聊天中实际发布消息。现在，根据你要做的事情，你可能需要添加其他作用域，所以如果你遇到任何错误，看看这些，你应该能够找出你希望机器人做的动作所需的作用域。</p><p id="7709" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">现在回到OAuth，再次点击<strong class="bd lt">“安装到工作区”</strong>。然后单击allow，它将为您生成一个bot令牌。</p><p id="9e56" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">如果它以“<strong class="bd lt"> xoxb </strong> -Your_Token_Vaue”开头，你就会知道它是一个机器人令牌。</p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div class="ab fr cl lu"><img src="../Images/1f5206ae6c62be86f9361b4a97605602.png" data-original-src="https://miro.medium.com/v2/format:webp/0*8ZPKOR-jPcp3qh9I.png"/></div></figure><p id="2882" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">一旦你有了它，我们就可以用它和通道ID一起向作为机器人的通道发送消息。为此，我准备了一个简单的应用程序，我将在这里添加一个方法，使用Slack的API作为机器人发送消息</p><h1 id="24e0" class="jc jd if bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">作为机器人发送消息</h1><p id="ca80" class="pw-post-body-paragraph km kn if bd b ko lo kq kr ks lp ku kv kw lq ky kz la lr lc ld le ls lg lh kk hn dt translated">这个版本可以在几乎所有能够使用HTTP方法或REST调用的传统编程栈(Java、JavaScript、Python等)中工作——在开始开发应用之前，你甚至可以在<a class="ae kl" href="https://www.postman.com/" rel="noopener ugc nofollow" target="_blank"> Postman </a>中试用它。我们需要做的就是用Slack为我们的应用程序创建一个认证系统，然后我们需要集成发布消息的API，然后我们需要发布一个REST端点，Slack可以为通道中的事件发布消息</p><blockquote class="ka"><p id="f486" class="kb kc if bd kd ke kf kg kh ki kj kk ek translated">事件可以是消息、反应、渠道中的提及等等，可以把松弛事件看作类似于一个网络钩子</p></blockquote><p id="d0d1" class="pw-post-body-paragraph km kn if bd b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh kk hn dt translated">要将您的消息发送到服务，您必须提供服务的端点。在这种情况下，它是<a class="ae kl" href="https://slack.com/api/chat.postMessage" rel="noopener ugc nofollow" target="_blank">https://slack.com/api/chat.postMessage</a></p><p id="f028" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">因为端点将HTTP方法的类型描述为POST，所以我们需要确保在这里也使用POST。</p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div class="ab fr cl lu"><img src="../Images/35567e216ecfe0b0d3ad70df8e28c21b.png" data-original-src="https://miro.medium.com/v2/format:webp/0*FG-RGQSnm65IwZTs.png"/></div></figure><p id="4f25" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">你还需要一些标题。我们想为<strong class="bd lt">内容类型</strong>添加一个头，这需要是'<strong class="bd lt">应用程序/json' </strong>。接下来，我们需要另一个名为<strong class="bd lt"> Authorization </strong>的头，这是我们可以使用之前获得的bot令牌的地方。您希望这个头的值是'<strong class="bd lt"> Bearer' </strong>，然后是一个<strong class="bd lt">空格' '</strong>，然后是您的<strong class="bd lt">令牌值</strong>。</p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div class="ab fr cl lu"><img src="../Images/ad2391097af01a82295f879704a2b440.png" data-original-src="https://miro.medium.com/v2/format:webp/0*nhLsGtCeRaWV9r5T.png"/></div></figure><p id="4b11" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">现在，要发送消息，我们必须为此提供一个JSON主体，因为这是一个POST HTTP方法。这里有一个我们将要使用的简化结构，你可以在这里查看完整的API文档页面<a class="ae kl" href="https://api.slack.com/methods/chat.postMessage" rel="noopener ugc nofollow" target="_blank">。</a></p><pre class="li lj lk ll fq ma mb mc md aw me dt"><span id="3167" class="mf jd if mb b fv mg mh l mi mj">{<br/>  “channel”:”{1}”,<br/>  “text”:”{2}”<br/>}</span></pre><figure class="li lj lk ll fq hw fe ff paragraph-image"><div class="ab fr cl lu"><img src="../Images/b6a1c85da2da33f62415a09b584bbecd.png" data-original-src="https://miro.medium.com/v2/format:webp/0*YgcWSDdCcFgtOd3m.png"/></div></figure><blockquote class="mk ml mm"><p id="d693" class="km kn mn bd b ko lv kq kr ks lw ku kv mo lx ky kz mp ly lc ld mq lz lg lh kk hn dt translated">请注意，在Studio Pro中，您可能需要在请求前提供一个额外的花括号。</p></blockquote><p id="e099" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">这个请求已经被精简到最基本的部分——它只有channel和text，channel是一个字符串，text也是一个字符串。还有很多其他的选项可以使用，比如附件和图标，还有很多其他很酷的东西。所以去看看文档页面，玩玩吧。您可以看到我在这里使用了占位符，只是使用标准的Mendix REST动作将我的值从微流传递到请求中。</p><p id="50b2" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">它确实会向我们发送一个响应，但我不会在这里处理它，相反，你可以运行你的应用程序并测试它，如果成功，当你调用这个微流时，你应该会在通道中看到一条消息！</p><p id="1e67" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">要测试消息发送，您需要您的通道ID，它可以从Slack通道的URL中获得(通道URL中最后一个'/'之后的最后一个值)，然后您可以将您的第一条消息作为bot发送！请记住，您需要首先确保您的机器人被添加到频道中，要做到这一点，只需在频道中使用bots @ reference并添加它们。</p><p id="67e2" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">你的消息现在应该从你的Mendix应用程序发送到Slack，并出现在频道中，就好像是机器人发送的一样，只要你运行这个微流。</p><h1 id="897c" class="jc jd if bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">为您的应用订阅频道中的活动</h1><p id="c316" class="pw-post-body-paragraph km kn if bd b ko lo kq kr ks lp ku kv kw lq ky kz la lr lc ld le ls lg lh kk hn dt translated">为了让Slack向我们的Mendix应用程序发布消息，我们需要在Slack bot的设置中启用事件。通过启用该功能，Slack将对我们应用程序发布的REST服务进行更新。我们可以使用它来实现逻辑，以处理用户在使用通道时可能触发的不同类型的事件。您可以订阅特定的事件，为此您可以设置特定的端点，或者您可以将所有更新发布到同一个端点，并构建您自己的逻辑来处理每个独特的事件。例如，当有人对消息作出反应或当新用户加入频道时，可以让机器人做一些事情。对于我的构建，我只添加了一个事件端点，然后处理由我的Mendix应用程序中发布的REST服务调用的微流中的所有逻辑。</p><p id="4be8" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">为此，请访问api.slack.com的“活动订阅|”。</p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div class="ab fr cl lu"><img src="../Images/2efa2b346008a80135b069d8004ea0c1.png" data-original-src="https://miro.medium.com/v2/format:webp/0*uG6R85silULshHaE.png"/></div></figure><p id="dc9f" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">将“启用事件”打开，您将看到一个请求URL字段。这就是我们需要使用我之前提到的工具打开隧道的地方。NGROK工具从您的本地主机打开一个安全连接，并以一种安全的方式将它作为一个可用的端点公开给web。</p><p id="d8be" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">打开你的文件浏览器，找到你下载的ngrok.exe文件。现在，在您的终端或命令提示符下打开这个exe。你也可以点击打开exe文件在你的终端中打开它。然后键入“<strong class="bd lt">ngrok http { YOUR Mendix app PORT NUMBER }</strong>”，我通常使用端口8080作为我的默认MENDIX APP配置，但这将使用您喜欢的任何端口号，例如“<strong class="bd lt"> ngrok http 5000 </strong>”将工作，只要您的MENDIX APP也被设置为在端口5000上运行。</p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div class="ab fr cl lu"><img src="../Images/f11eaec3b79ee0434b934bd89b287280.png" data-original-src="https://miro.medium.com/v2/format:webp/0*pkuC7oJJwqJCM2D5.png"/></div></figure><p id="613a" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">按enter键，ngrok将打开端点，您应该会看到类似这样的内容:</p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div class="ab fr cl lu"><img src="../Images/e67008c82a35894d55a5da51de17b68b.png" data-original-src="https://miro.medium.com/v2/format:webp/0*ahZttDY7SiUS4hKw.png"/></div></figure><p id="809b" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">你应该知道这同时开放了HTTP和HTTPS端点，Slack需要使用HTTPS。</p><h1 id="4d21" class="jc jd if bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">在Mendix中处理事件</h1><p id="a965" class="pw-post-body-paragraph km kn if bd b ko lo kq kr ks lp ku kv kw lq ky kz la lr lc ld le ls lg lh kk hn dt translated">我们现在有了一个可以在Slack中使用的活动端点，但是我们需要在设置好发布的REST服务之后再回到这个问题上来。</p><p id="9d5f" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">切换回Studio Pro，在项目浏览器中右键单击并选择在“Other”下添加一个已发布的REST服务。</p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div class="ab fr cl lu"><img src="../Images/9f9ee2ed380946b2c874f4286f5a3ca0.png" data-original-src="https://miro.medium.com/v2/format:webp/0*SM9nGKt3qXDfa5mH.png"/></div></figure><p id="a049" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">给你的服务起一个名字，我把我的命名为“SlackBot”，然后点击OK</p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div class="ab fr cl lu"><img src="../Images/d5f649da4c9b1f89e56e791076497736.png" data-original-src="https://miro.medium.com/v2/format:webp/0*T93JGgompoMSWMWi.png"/></div></figure><p id="351e" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">接下来，向名为“SlackEvent”的服务添加一个资源，并单击OK</p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div class="ab fr cl lu"><img src="../Images/9d2537ad1da0603c49fe0868701213f3.png" data-original-src="https://miro.medium.com/v2/format:webp/0*7LCAGCgj_rFYspFK.png"/></div></figure><p id="4d55" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">然后向服务添加操作，这是我们定义API方法(GET、POST、PUT、PATCH、DELETE)的地方，配置它自己的操作路径，并配置微流来处理端点的逻辑。</p><p id="e210" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">不需要设置操作路径，默认情况下，端点类似于:</p><h2 id="7f8f" class="mf jd if bd je mr ms mt ji mu mv mw jm kw mx my jq la mz na ju le nb nc jy nd dt translated"><a class="ae kl" href="http://%7BLocalHost%7D/rest/%7BService_Name%7D/%7BVersion_Number%7D/%7BResource_Name%7D/%7BOperation_Path%7D" rel="noopener ugc nofollow" target="_blank">http://{ LocalHost }/rest/{服务名称}/{版本号}/{资源名称}/{操作路径} </a></h2><p id="6090" class="pw-post-body-paragraph km kn if bd b ko lo kq kr ks lp ku kv kw lq ky kz la lr lc ld le ls lg lh kk hn dt translated">以下是如何设置操作的示例:</p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div class="ab fr cl lu"><img src="../Images/2fe572832d9dd780bcd3bbccecca70ec.png" data-original-src="https://miro.medium.com/v2/format:webp/0*qcXst_nwXoBaVy_F.png"/></div></figure><p id="6e11" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">我们现在有了一个可以接受请求的有效URL，但是在我们可以处理每一种事件类型之前还有更多工作要做…..认证。</p><h1 id="9987" class="jc jd if bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">证明</h1><p id="7b0d" class="pw-post-body-paragraph km kn if bd b ko lo kq kr ks lp ku kv kw lq ky kz la lr lc ld le ls lg lh kk hn dt translated">开始的时候我有点困惑，但是实际上很简单。当我们在Slack中添加事件端点时，他们的api将向端点发送一个质询，其请求正文中包含“质询”值，如下所示:</p><pre class="li lj lk ll fq ma mb mc md aw me dt"><span id="446f" class="mf jd if mb b fv mg mh l mi mj">{<br/>  "token":"your_token",<br/>  "challenge":"your_ChallangeValue",<br/>  "type":"url_verification"<br/>}</span></pre><p id="1378" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">您所要做的就是在流程开始时，第一次调用它时，将这个挑战字符串发送回给他们</p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div class="ab fr cl lu"><img src="../Images/987e88b0ea721ba436b3371bcd56673a.png" data-original-src="https://miro.medium.com/v2/format:webp/0*yEPFl-nP6nQiSCMT.png"/></div></figure><h1 id="1831" class="jc jd if bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">为Slack中的事件设置RequestURL</h1><p id="4d47" class="pw-post-body-paragraph km kn if bd b ko lo kq kr ks lp ku kv kw lq ky kz la lr lc ld le ls lg lh kk hn dt translated">如果一切都是正确的，我们可以制定一个URL，我们可以添加到Slack Events订阅页面。URL应该是您的NGROK https端点的组合，其余的将是您发布的服务的服务端点。</p><h2 id="2433" class="mf jd if bd je mr ms mt ji mu mv mw jm kw mx my jq la mz na ju le nb nc jy nd dt translated">大概是:<a class="ae kl" rel="noopener ugc nofollow" target="_blank" href="/mendix/{NGROK_HTTPS_URL}/{Your_Published_Rest_Operation}">https://{ NGROK _ HTTPS _ URL }/{ Your _ Published _ Rest _ Operation }</a></h2><p id="cfe5" class="pw-post-body-paragraph km kn if bd b ko lo kq kr ks lp ku kv kw lq ky kz la lr lc ld le ls lg lh kk hn dt translated">这是我的最后的样子:</p><p id="5c83" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated"><a class="ae kl" href="https://ff98-86-181-134-55.ngrok.io/rest/slackbot/v1/SlackEvent/Event" rel="noopener ugc nofollow" target="_blank">T5】https://ff98-86-181-134-55 . ngrok . io/rest/slack bot/v1/slack Event/Event</a></p><p id="9405" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">请记住，NGROK仅用于开发，因此它将每2小时超时一次，此后，您必须为您的本地主机生成一个新的URL。一旦投入生产，就不再需要这个了，你可以直接使用你的云URL。</p><p id="7477" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">您可以在事件页面上将该值设置为请求URL。如果你成功了，Slack会告诉你它已经验证了终点。</p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div class="ab fr cl lu"><img src="../Images/5981f4e461345f993b7465cc1b6d64b5.png" data-original-src="https://miro.medium.com/v2/format:webp/0*CrSeYaqFnrU1bYCf.png"/></div></figure><p id="6e4e" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">如果出现问题，您可以正常调试您的微流，设置您的<strong class="bd lt"> REST消耗</strong>和<strong class="bd lt"> REST发布</strong>日志级别也可能有助于通过控制台让您更深入地了解发生了什么问题。</p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div class="ab fr cl lu"><img src="../Images/102917d90e607c64a8e9d1bdbecaf27f.png" data-original-src="https://miro.medium.com/v2/format:webp/0*R8LZK9foRLfi7Ox-.png"/></div></figure><p id="a124" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">在你可以定制你的机器人动作之前，我们需要处理的最后一件事是确保它能够识别自己，否则你可以创建一个无限循环，机器人可以在它向群组发布消息时触发自己，如果我们不过滤掉它自己在频道中的活动。</p><p id="e8a2" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">为此，我们必须导入请求有效负载Slack提供我们的应用程序的REST服务。有效载荷将如下所示:</p><pre class="li lj lk ll fq ma mb mc md aw me dt"><span id="8b6c" class="mf jd if mb b fv mg mh l mi mj">{</span><span id="6e76" class="mf jd if mb b fv ne mh l mi mj"> "token":"dKyT4vmA1NJLt6vq8o1WurMd",<br/> "team_id":"T02LUP42T19",<br/> "api_app_id":"A02MJE1059N",<br/> "event":{<br/>   "bot_id":"B02NK4L1XHN",<br/>   "type":"message",<br/>   "text":"Hello from Mendix",<br/>   "user":"U02MEPHFY2K",<br/>   "ts":"1637273612.003700",<br/>   "team":"T02LUP42T19",<br/>   "bot_profile":{<br/>    "id":"B02NK4L1XHN",<br/>    "deleted":false,<br/>    "name":"message bot",<br/>    "updated":1637253238,<br/>    "app_id":"A02MEP8D37Z",<br/>    "icons":{<br/>     "image_36":"<a class="ae kl" href="https://a.slack-edge.com/80588/img/plugins/app/bot_36.png" rel="noopener ugc nofollow" target="_blank">https://a.slack-edge.com/80588/img/plugins/app/bot_36.png</a>",<br/>     "image_48":"<a class="ae kl" href="https://a.slack-edge.com/80588/img/plugins/app/bot_48.png" rel="noopener ugc nofollow" target="_blank">https://a.slack-edge.com/80588/img/plugins/app/bot_48.png</a>",<br/>     "image_72":"<a class="ae kl" href="https://a.slack-edge.com/80588/img/plugins/app/service_72.png" rel="noopener ugc nofollow" target="_blank">https://a.slack-edge.com/80588/img/plugins/app/service_72.png</a>"<br/>       },<br/>      "team_id":"T02LUP42T19"<br/>     },<br/>    "channel":"C02LRPR0XGD",<br/>    "event_ts":"1637273612.003700",<br/>    "channel_type":"channel"<br/>   },<br/>   "type":"event_callback",<br/>   "event_id":"Ev02MGFCNHP1",<br/>   "event_time":1637273612,<br/>   "authorizations":[<br/>    {<br/>     "enterprise_id":null,<br/>     "team_id":"T02LUP42T19",<br/>     "user_id":"U02LUPJ8T4J",<br/>     "is_bot":true,<br/>     "is_enterprise_install":false<br/>    }<br/>  ],<br/>  "is_ext_shared_channel":false,<br/>  "event_context":"4-eyJldCI6Im1lc3NhZ2UiLCJ0aWQiOiJUMDJMVVA0MlQxOSIsImFpZCI6IkEwMk1KRTEwNTlOIiwiY2lkIjoiQzAyTFJQUjBYR0QifQ"<br/>}</span></pre><p id="5e6f" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">创建一个JSON结构，粘贴到JSON中，在结构部分点击R <strong class="bd lt"> efresh </strong>，然后点击OK关闭窗口。</p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div class="ab fr cl lu"><img src="../Images/7267ec4e38c8dc43a119053e1ce953b9.png" data-original-src="https://miro.medium.com/v2/format:webp/0*MF_c9NaKRuLdl8-x.png"/></div></figure><p id="4c72" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">接下来创建一个导入映射，并在Schema source下选择您创建的JSON结构。确保选择所有字段以获得您想要的所有详细信息，或者挑选您需要的信息。</p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div class="ab fr cl lu"><img src="../Images/4875c86fefceebc7dc39898c0a0c38dc.png" data-original-src="https://miro.medium.com/v2/format:webp/0*msxKOlsS7nMAAq-D.png"/></div></figure><p id="8931" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">点击确定关闭窗口，然后在映射编辑器的左上方选择“自动映射”。</p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div class="ab fr cl lu"><img src="../Images/a0f3fbd1551b1bb6734ba1a56a78d21d.png" data-original-src="https://miro.medium.com/v2/format:webp/0*H4TvIFuvEX9VFsoO.png"/></div></figure><p id="7d5f" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">您现在应该会看到类似这样的内容:</p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div class="ab fr cl lu"><img src="../Images/afaf03958d936d24346cc4af69380ed9.png" data-original-src="https://miro.medium.com/v2/format:webp/0*KzMnOrhvK5Cg95H9.png"/></div></figure><p id="e2dc" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">最后，使用这个映射来导入HTTPRequest，并添加一个检查来查看发布消息的用户是否是一个机器人，如果是，则什么也不做并返回空值。</p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div class="ab fr cl lu"><img src="../Images/9acf70b4941ba76bad68d7bec2138d12.png" data-original-src="https://miro.medium.com/v2/format:webp/0*Wj4c7vPMfeNw5Cys.png"/></div></figure><p id="569e" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">你现在可以自由地处理任何事件，以任何你希望的方式。我对此的快速方法是使用<strong class="bd lt">包含</strong>和<strong class="bd lt">查找</strong>关键字来检查消息的内容。这种方法允许您添加任意多的独占分割，通过这样做，您可以在微流中创建一个对话树，这是一种简单的方法(但是您可以进一步将每个响应存储在数据库中，这将使这种设置在运行时可配置)。要发送这个响应，只需重用我们之前用来发送测试消息的postMessage API。</p><p id="e519" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">我的例子看起来是这样的</p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div class="ab fr cl lu"><img src="../Images/433d4f06314646dea01573b930810c9a.png" data-original-src="https://miro.medium.com/v2/format:webp/0*BvFz9ALYZ3lHSo3e.png"/></div></figure><h1 id="cb37" class="jc jd if bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">斜线命令</h1><p id="ba37" class="pw-post-body-paragraph km kn if bd b ko lo kq kr ks lp ku kv kw lq ky kz la lr lc ld le ls lg lh kk hn dt translated">斜杠命令到底是什么？简单地说，它们类似于网钩。当用户输入带有斜杠“/”的某个关键字(在Slack中设置)时，Slack会将更新推送到唯一的端点。</p><p id="c4e4" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">这确实是事件和斜杠命令的最大区别。简单地在您发布的REST服务上添加一个新方法，对于我的例子，我保持简单。当用户键入/ping时，机器人将响应pong。我知道有一点“你好，世界”，但我主要是在这里玩。</p><p id="0ea0" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">添加一个新的端点，并为操作路径输入Ping，这也是一个POST方法。</p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff nf"><img src="../Images/23134d90e143791a1e4ce855fe604915.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*90o5TEMZlrLmqM9Z.png"/></div></div></figure><p id="3470" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">然后在处理逻辑的微流中，只需将响应的内容属性设置为‘Pong’。</p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff ng"><img src="../Images/8992395ab26cdd2a1dc59648be77b6dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*BnxiMbZs5V7-kvB9.png"/></div></div></figure><p id="388e" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">最后，在Slack中，转到左边菜单中的斜杠命令，然后单击“创建新命令”</p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff nh"><img src="../Images/83644a3d250a17c3f6a6505226549d9c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*y6eu6xLKmPZ3sokF.png"/></div></div></figure><p id="6bf8" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">您的端点将再次是来自<strong class="bd lt"> NGROK </strong>的URL和您的HTTP方法的<strong class="bd lt"> URL的组合。</strong></p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff ni"><img src="../Images/1b89acb71f238d1294ca3e077a00be58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JVqgpqNpUHTlVTSv.png"/></div></div></figure><h1 id="014c" class="jc jd if bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">全部完成</h1><p id="f86f" class="pw-post-body-paragraph km kn if bd b ko lo kq kr ks lp ku kv kw lq ky kz la lr lc ld le ls lg lh kk hn dt translated">恭喜，你一路过关斩将。您现在可以测试您的应用程序并了解您的机器人！不要忘记，您必须将您的bot添加到Slack通道，以便它们将更新发送到事件端点。只需在Slack中发送@YourBotName，它就会要求为您添加机器人。因为Slack的API有很多其他的特性可以使用，如果你想要更具体的东西，请告诉我。</p><p id="f16b" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">在你走之前，这是我和我的机器人的简短对话-</p><figure class="li lj lk ll fq hw fe ff paragraph-image"><div role="button" tabindex="0" class="hx hy di hz bf ia"><div class="fe ff nj"><img src="../Images/15043de3cc4fc8c8fc9bd4051df240e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*U0FJM91FSBoB2PeY.png"/></div></div></figure><p id="d57e" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">编码快乐！</p><h1 id="cdcb" class="jc jd if bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz dt translated">阅读更多</h1><div class="ht hu fm fo hv nk"><a href="https://api.slack.com/start" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab ej"><div class="nm ab nn cl cj no"><h2 class="bd ig fv z el np eo ep nq er et ie dt translated">开始你的旅程</h2><div class="nr l"><h3 class="bd b fv z el np eo ep nq er et ek translated">Slack平台的最佳实践和指南Slack平台让您扩展、扩充和自动化您的…</h3></div><div class="ns l"><p class="bd b gc z el np eo ep nq er et ek translated">api.slack.com</p></div></div><div class="nt l"><div class="nu l nv nw nx nt ny ib nk"/></div></div></a></div><div class="ht hu fm fo hv nk"><a href="https://api.slack.com/authentication" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab ej"><div class="nm ab nn cl cj no"><h2 class="bd ig fv z el np eo ep nq er et ie dt translated">证明</h2><div class="nr l"><h3 class="bd b fv z el np eo ep nq er et ek translated">Slack平台的安装、权限和用户安全框架</h3></div><div class="ns l"><p class="bd b gc z el np eo ep nq er et ek translated">api.slack.com</p></div></div><div class="nt l"><div class="nz l nv nw nx nt ny ib nk"/></div></div></a></div><div class="ht hu fm fo hv nk"><a href="https://api.slack.com/messaging" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab ej"><div class="nm ab nn cl cj no"><h2 class="bd ig fv z el np eo ep nq er et ie dt translated">信息发送</h2><div class="nr l"><h3 class="bd b fv z el np eo ep nq er et ek translated">在整个空闲时间内发送、检索、更新、删除消息</h3></div><div class="ns l"><p class="bd b gc z el np eo ep nq er et ek translated">api.slack.com</p></div></div><div class="nt l"><div class="oa l nv nw nx nt ny ib nk"/></div></div></a></div><div class="ht hu fm fo hv nk"><a href="https://api.slack.com/interactivity/slash-commands" rel="noopener  ugc nofollow" target="_blank"><div class="nl ab ej"><div class="nm ab nn cl cj no"><h2 class="bd ig fv z el np eo ep nq er et ie dt translated">启用斜线命令的交互性</h2><div class="nr l"><h3 class="bd b fv z el np eo ep nq er et ek translated">斜线命令允许用户通过在消息编辑器框中键入字符串来调用您的应用程序。提交的斜线…</h3></div><div class="ns l"><p class="bd b gc z el np eo ep nq er et ek translated">api.slack.com</p></div></div><div class="nt l"><div class="ob l nv nw nx nt ny ib nk"/></div></div></a></div></div><div class="ab cl oc od hb oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="hn ho hp hq hr"><p id="adb1" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated"><em class="mn">来自发布者- </em></p><p id="4a90" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated"><em class="mn">如果你喜欢这篇文章，你可以在我们的</em> <a class="ae kl" href="https://medium.com/mendix" rel="noopener"> <em class="mn">中页</em> </a> <em class="mn">找到更多喜欢的。对于精彩的视频和直播会话，您可以前往</em><a class="ae kl" href="https://www.mendix.com/live/" rel="noopener ugc nofollow" target="_blank"><em class="mn">MxLive</em></a><em class="mn">或我们的社区</em><a class="ae kl" href="https://www.youtube.com/c/MendixCommunity/community" rel="noopener ugc nofollow" target="_blank"><em class="mn">Youtube PAG</em></a><em class="mn">e .</em></p><p id="4142" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated"><em class="mn">希望入门的创客，可以注册一个</em> <a class="ae kl" href="https://signup.mendix.com/link/signup/?source=direct" rel="noopener ugc nofollow" target="_blank"> <em class="mn">免费账号</em> </a> <em class="mn">，通过我们的</em> <a class="ae kl" href="https://academy.mendix.com/link/home" rel="noopener ugc nofollow" target="_blank"> <em class="mn">学苑</em> </a> <em class="mn">获得即时学习。</em></p><p id="0245" class="pw-post-body-paragraph km kn if bd b ko lv kq kr ks lw ku kv kw lx ky kz la ly lc ld le lz lg lh kk hn dt translated">有兴趣加入我们的社区吗？你可以加入我们的 <a class="ae kl" href="https://join.slack.com/t/mendixcommunity/shared_invite/zt-hwhwkcxu-~59ywyjqHlUHXmrw5heqpQ" rel="noopener ugc nofollow" target="_blank"> <em class="mn"> Slack社区频道</em> </a> <em class="mn">或者想更多参与的人，看看加入我们的</em><a class="ae kl" href="https://developers.mendix.com/meetups/#meetupsNearYou" rel="noopener ugc nofollow" target="_blank"><em class="mn">Meet ups</em></a><em class="mn">。</em></p></div></div>    
</body>
</html>