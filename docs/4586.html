<html>
<head>
<title>Building a serverless datawarehouse pipeline using GCP</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用GCP构建无服务器数据仓库管道</h1>
<blockquote>原文：<a href="https://medium.com/compendium/building-a-serverless-datawarehouse-pipeline-using-gcp-269c13457b1a?source=collection_archive---------0-----------------------#2021-05-07">https://medium.com/compendium/building-a-serverless-datawarehouse-pipeline-using-gcp-269c13457b1a?source=collection_archive---------0-----------------------#2021-05-07</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="0d9c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">传统上，构建数据仓库需要在基础设施、工具和许可证方面进行大量资本投资，以深入了解您的数据。随着它们的存在和发展，这些解决方案往往会变得维护耗时、复杂，或者在响应新的业务需求时变化缓慢。</p><p id="d075" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">BigQuery是Google云平台提供的无服务器数据仓库解决方案。没有数据，数据仓库就什么都不是，数据通常由连接到数据源的管道提供。</p><p id="e5bd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这篇博文<em class="jc">中，我将只关注GCP提供的无服务器集成</em>。这意味着像<a class="ae jd" rel="noopener" href="/grensesnittet/copy-data-from-cloud-sql-to-bigquery-using-apache-airflow-cloud-composer-part-2-33aa02bf456a"> Cloud Composer </a>和数据融合这样的流行组件不是解决方案的一部分，尽管它们适合整体架构。</p><p id="4a72" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在无服务器模式下，你不必担心运行服务的基础设施，一切都由平台管理。</p><p id="b441" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">其中一个吸引人的部分是运营支出从0美元开始，您只需为您使用的东西付费(通常有一个慷慨的免费层)。如果您的规模很大，无服务器集成可能不是最具成本效益的，也应该探索其他选项。</p><p id="8eb0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jd" href="https://computas.com/om/kontakt/" rel="noopener ugc nofollow" target="_blank">如果你需要专家意见，请随时联系我们！</a></p><h1 id="07dd" class="je jf hh bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">数据源和集成</h1><figure class="kd ke kf kg fd kh er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es kc"><img src="../Images/64de0992cde35520fcab1163cd967079.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fknpsNkG2ZOYyUjwQrtCFA.png"/></div></div></figure><p id="e8e0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">数据源和集成是一个谈论变化的话题。源可以基于api访问或直接访问数据库，以及两者之间的所有选择。有时您集成的系统有明确定义的服务契约(它有哪种类型的数据)，而一些系统(特别是遗留的或定制的)不支持这一点，您必须花时间发现系统内部。</p><p id="0ef9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">数据源的摄取通常是以批处理或流式方式完成的。</p><p id="987f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将<em class="jc">批处理</em>数据接收到GCP的一个好模式是，调用一个程序定期从数据源读取数据，并以可以加载到BigQuery的格式将其存储到云存储中。例如，每日批处理作业可以用以下格式编写对象:SOURCE _ SYSTEM/batch/YEAR/MONTH/day . JSON</p><p id="9f09" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您有<em class="jc">流</em>数据，那么将消息放入队列是一个很好的模式。这使得您可以轻松地升级服务，同时在升级集成层时不会丢失数据。队列还充当多路复用，允许您使用不同的管道处理相同的数据。根据流频率和有效负载，还可以考虑将对象存储在云存储中，以便在需要时方便地重新处理。它确实帮助了我好几次，只是从云存储中重新创建一个BQ表，而不是处理一个缓慢的第三方来源。</p><p id="37c1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">假设您已经准备好了数据源，并且已经选择了集成组件，那么您需要解决调度工作流的问题。GCP为调度和工作流提供了无服务器的替代方案:云调度器和云工作流。</p><p id="6d93" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">云调度器基本上是一个crontab，能够调用http端点，而云工作流可以在做参数和状态的同时调用多个端点。</p><blockquote class="ko kp kq"><p id="bc70" class="ie if jc ig b ih ii ij ik il im in io kr iq ir is ks iu iv iw kt iy iz ja jb ha bi translated">使用所有这些组件有一个注意事项。他们中的一些人在被GCP的统治者杀死之前被限制了奔跑的时间。往积极的方面想。它将迫使你编写可伸缩的代码。使用扇出模式，在几个小时内回填数十亿个数据点是一种美事，当然前提是你不要让源系统过载；)</p></blockquote><h1 id="2ab5" class="je jf hh bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">建筑</h1><figure class="kd ke kf kg fd kh er es paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="er es ku"><img src="../Images/78ac8804cd6db18d17b5c9ddedb4edf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BE7OApIKbMJGklbppmaaLw.png"/></div></div></figure><p id="0b95" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是一个架构外观的例子，展示了所有集成组件如何协同工作。</p><p id="dcab" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这种体系结构中，数据从左向右流动。前面描述的集成组件获取数据，并最终将它们存储在BigQuery中。</p><p id="1aaf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">就我个人而言，我喜欢在BigQuery中有几个层，其中一层是原始的、未修改的层，它只是源系统的副本，添加了一些元数据，例如——提取时间/加载时间。下一层应该是原始数据集的整合层，您应该创建一个满足业务需求的数据模型。</p><p id="0c7c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">对数据进行处理后，是时候将数据导入商业智能工具或定制应用程序了。Data studio是基于网络的免费软件，是一个很好的起点。然而，它是缺乏的，尤其是当您想要部署仪表板、所有权等时</p><p id="7ac0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">考虑到GDPR，使用数据目录来标记您的PII(个人可识别信息)数据是一个非常好的主意，这样您就可以对这些数据的位置有一个总体的了解，以便您可以适当地处理它们。</p><h1 id="37ba" class="je jf hh bd jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb bi translated">关于这个主题的进一步阅读</h1><p id="7c4a" class="pw-post-body-paragraph ie if hh ig b ih kv ij ik il kw in io ip kx ir is it ky iv iw ix kz iz ja jb ha bi translated"><a class="ae jd" href="https://computas.com/tjenester/dataanalyse/datavarehus-i-skyen/" rel="noopener ugc nofollow" target="_blank">我工作的公司刚刚发布了一份白皮书，描述了这个</a>的解决方案架构，由我和我的好同事Per Axel签署。如果你觉得这篇博客很有趣，并且想在google cloud上阅读更多关于dwh的内容，我建议你去看看！它在数据仓库层和业务方面有更多的深度，而<em class="jc">这篇博文只关注集成层。</em></p><p id="7849" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果你需要一个完整的谷歌云企业数据仓库解决方案，我建议看看<a class="ae jd" href="https://www.sharkcell-suite.com/" rel="noopener ugc nofollow" target="_blank">shark cell</a>——它是一个具有一些独特想法的云原生解决方案！</p></div></div>    
</body>
</html>