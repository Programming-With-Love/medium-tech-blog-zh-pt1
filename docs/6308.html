<html>
<head>
<title>The machine learning behind delivering relevant ads</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">投放相关广告背后的机器学习</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/the-machine-learning-behind-delivering-relevant-ads-8987fc5ba1c0?source=collection_archive---------0-----------------------#2021-07-20">https://medium.com/pinterest-engineering/the-machine-learning-behind-delivering-relevant-ads-8987fc5ba1c0?source=collection_archive---------0-----------------------#2021-07-20</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="3cdc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Felix Fang |广告商解决方案集团软件工程师</p><p id="738a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">徐驰|广告解决方案集团软件工程师</p><p id="6b39" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Pinterest是人们进行计划和购物的地方，让品牌的想法和广告有助于将Pinners从灵感变为行动。我们的目标是确保广告继续是附加的，而不是对Pinterest的侵扰。由于平台上独特而强大的第一方信号，广告主可以根据他们在平台上的兴趣、意图和参与度来接触Pinners。</p><p id="af9e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了帮助在数亿观众中向正确的广告人投放正确的广告，我们为广告商提供了实现相关性的功能，包括Actalike (AAL)观众，在业内也被称为长相相似的观众。AAL受众通过受众扩张帮助广告商接触潜在的新用户。</p><p id="7331" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这篇博客中，我们将重点关注相关广告投放的机器学习模型组件，并解释我们如何通过通用用户嵌入表示以及每广告客户分类器模型来实现高质量的受众扩展。我们通过显示比基于回归和基于相似性的方法更好的性能来展示所提出的组合方法的能力。</p><h1 id="6103" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">我们提出的方法:用户嵌入+ MLP分类器</h1><p id="887e" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">AAL方法主要分为两类:基于回归的方法和基于相似性的方法。基于回归的方法将任务视为二元分类问题，离线训练每个种子列表的模型，并使用此类模型直接对候选用户进行评分，如图2a所示。基于相似性的方法从一组用户嵌入中学习种子列表表示，并根据Jaccard相似性、余弦相似性或点积基于最近邻扩大受众，如图2b所示。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kg"><img src="../Images/fcc91462b1478587f22812b35c8ca695.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tOKZ90W9dvA0VO4d"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx">Figure 2a. Regression-based approach. This is a discriminative model, and a linear model is often used since the features are sparse.</figcaption></figure><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kw"><img src="../Images/49a8fe49885e133994d68f975657f4d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IbXB4pRE5xvEUb_H"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx">Figure 2b. Similarity-based approach. This is a generative model, and approximate nearest neighbor searching is used for speed.</figcaption></figure><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es kx"><img src="../Images/29907c96cef3d62dd8937a7e214f70fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yR-ya3M-pog9s4sN"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx">Figure 2c. Combined NN approach. This is a discriminative model, and using dense user embeddings allows using a neural network model.</figcaption></figure><p id="93d1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们发现，每种基于回归或基于相似性的方法都有其独特的优势:基于回归的方法对每个种子列表执行监督学习，并擅长编码种子列表结构(较低的偏差，较高的方差)，而基于相似性的方法执行用户表示学习，这解决了数据稀疏性(较低的方差，较高的偏差)。为了结合两个世界的优势，我们采用预先训练的用户嵌入并显式学习种子列表分类器。因为预先训练的用户嵌入已经编码了高级信息并且是密集的，所以它允许下游分类器模型更快地收敛，并且允许采用神经网络，否则该神经网络在稀疏输入的情况下不能很好地工作。类似的想法可以在[ <a class="ae kf" href="https://docs.google.com/document/d/1PIXm82pDVGS6dc489wB4Px0z5Fpc2T6mM9jlxJ7Pm08/edit#bookmark=id.52i2wpw1fkkf" rel="noopener ugc nofollow" target="_blank"> 5 </a> ]中找到。以下是比较不同受众拓展方法的总结:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ky"><img src="../Images/42dd661d61f4c7c294ae6b78d2e84d54.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xg5atErNOsU4AbK3IP7Hlw.png"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx">Table 1. Comparisons of regression-based, similarity-based, and combined NN approaches.</figcaption></figure><h2 id="1d52" class="kz jd hh bd je la lb lc ji ld le lf jm ip lg lh jq it li lj ju ix lk ll jy lm bi translated">模型架构</h2><p id="54d7" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">我们直接将使用有机<em class="ln"> &lt;用户、pin &gt; </em>交互训练的标准化用户嵌入馈送到我们的每广告客户模型。关于如何训练通用用户嵌入的更多细节可以在[6]中找到。对于每个广告客户，我们参考种子列表作为正面示例，使用来自目标国家/地区的每月活跃用户(mau)作为负面示例，并使用多层感知器(MLP)神经网络构建二元分类器，如图3所示:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lo"><img src="../Images/2eae33455572df5a54db79f6234dde43.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*p-UL2ulSq1cXDV0C"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx">Figure 3. Per-advertiser multi-head model training architecture. Models for advertisers share the same architecture.</figcaption></figure><p id="970c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">接下来，我们想研究样本加权如何改进我们的模型。我们的理由是用户参与可以提供更多关于种子用户成员的信息。与多任务学习不同，这里我们设计的模型只关注相似性预测任务。为此，我们对每个正例使用不同的样本权重。样本权重可以基于诸如印象数、点击率(CTR)等用户参与度量来决定。在这种方法中，我们可以区别对待每个种子用户，并优先考虑那些具有较高历史指标的用户。为了确保样本权重呈正态分布，我们对大于1的样本应用对数变换；对于那些小于1的指标(如CTR)，我们通过10⁶提升指标，然后应用对数变换。然后，我们使用最小-最大缩放将所有样本权重归一化到[0，1]内，以便所有样本权重都在同一缩放比例上。在我们的在线alpha实验中，我们发现这种样本加权在类似观众行为的目标切片中分别提高了0.82%、0.38%和0.44%的收入、印象数和eCPM(每千分之一的有效成本)。</p><p id="959e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了训练该模型，我们针对如下定义的加权二进制交叉熵损失函数进行优化:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es lp"><img src="../Images/dbee6d654b69c977cf7cef98ccc9d48f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1066/format:webp/1*ZcSlH4osyX5sk9g2YuV8rg.png"/></div></figure><p id="842d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">其中<em class="ln"> N </em>表示样本数量，<em class="ln"> M </em>表示不同的参与度指标。基于这些参与度指标，我们计算样本权重。</p><h2 id="15b0" class="kz jd hh bd je la lb lc ji ld le lf jm ip lg lh jq it li lj ju ix lk ll jy lm bi translated">离线评估</h2><p id="69c8" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">为了评估受众扩展的质量，我们假设种子列表中的受众彼此相似。因此，我们将种子列表分为90%和10%的用户，用90%的用户训练一个模型，使用该模型对除90%训练集之外的所有mau进行评分，并检查10%的坚持用户在扩展中如何排名。</p><p id="4b72" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">受众扩张本质上是一个排名问题:从所有符合条件的候选用户中找到最相似的<em class="ln"> k </em>用户。基本上，我们根据种子的相似性分数对所有符合条件的人进行排名，并选择前<em class="ln"> k </em>。我们用<em class="ln"> recall@k </em>和<em class="ln"> precision@k </em>来衡量一个扩展列表有多好。这些被定义为:</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div class="er es lq"><img src="../Images/ba815cc75bb9ae67d89ff87a70b6276a.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*BK7zJwy7dp7LfEfB-_GmNw.png"/></div></figure><p id="5bd9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">其中<em class="ln"> E@k </em>是扩展列表中具有前<em class="ln"> k </em>个用户的用户集合，<em class="ln"> H </em>是坚持的用户集合，<em class="ln"> R </em>是从具有与<em class="ln"> H </em>相同大小的mau中随机选择的用户集合。我们进一步在多个<em class="ln"> k </em>上对<em class="ln"> recall@k </em>和<em class="ln"> precision@k </em>进行平均，以找出给定不同目标扩展大小的方法的性能。</p><p id="662e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们比较了所有方法的结果，以更好地了解联合方法的优势。在此评估中，基于回归的模型是使用基于原始特征训练的逻辑回归模型实现的。基于相似性的模型基于位置敏感散列(LSH)。在所有结果中，我们使用基于回归的模型作为基线，并显示了与基线相比的相对收益。图4中的数字表明，就<em class="ln">召回@k </em>和<em class="ln">精度@k </em>而言，组合NN方法优于回归和基于相似性的方法。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lr"><img src="../Images/5acf674a3115c284edc64571c94a50e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*iN5zTb02M3rOYO28"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx">Figure 4. Overall comparisons among regression-based, similarity-based, and combined NN models (Baseline: regression-based).</figcaption></figure><p id="bb9f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">除了整体比较，我们还评估了不同种子列表大小的模型。具体来说，我们根据种子列表大小将广告商分为五组:几千、几万、几十万、几百万、几千万。图5和图6中的数字告诉我们，基于回归和基于相似的模型分别只在大小种子列表上表现相对较好。然而，我们提出的组合神经网络模型在不同的种子列表大小上优于这两个模型。对于小种子列表，组合模型以及基于相似性的模型都受益于预先训练的通用用户嵌入，从而避免过拟合。对于大型种子列表，结果令人惊讶，因为为了训练组合模型，我们仅使用多达200，000个正样本，而对于基于回归的模型，我们使用所有正样本，即百万种子用户。我们相信使用预先训练的用户嵌入作为输入也允许模型更快地收敛。此外，MLP层能够捕捉非线性关系，并进一步提高组合神经网络模型的性能。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ls"><img src="../Images/838c616483b50fe4aa9b367dcdca99d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9GoYucuxOKFzVJpT"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx">Figure 5. Average recall@k for different seed list sizes among regression-based, similarity-based, and combined NN models (Baseline: regression-based).</figcaption></figure><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es ls"><img src="../Images/44f5e7f58accce0d3bb7c052c3bd1c60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*LVOYXYInjXijoWRe"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx">Figure 6. Average precision@k for different seed list sizes among regression-based, similarity-based, and combined NN models (Baseline: regression-based).</figcaption></figure><h2 id="18d6" class="kz jd hh bd je la lb lc ji ld le lf jm ip lg lh jq it li lj ju ix lk ll jy lm bi translated">生产端到端系统</h2><p id="4677" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">因为回归和基于相似性的模型相互补充，我们以前版本的AAL系统是一个混合解决方案，混合了分类器和基于相似性的模型的扩展。对于新版本，我们生产了建议的组合模型，以大大简化AAL系统的复杂性。因此，我们节省了基础设施和维护成本，并将端到端运行时间加快了20%以上。我们使用Spark和Kubernetes来扩展我们的系统，以支持定期训练的种子列表模型，并根据每个种子列表对用户进行评分(种子列表和用户分别在O(10⁵和O(10⁸的范围内)。</p><h2 id="6a62" class="kz jd hh bd je la lb lc ji ld le lf jm ip lg lh jq it li lj ju ix lk ll jy lm bi translated">在线评估</h2><p id="8c78" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">在我们的在线A/B测试中，混合系统(混合分类器和基于相似性的模型)和组合的NN模型分别是控制和处理候选。图7表明，在我们为期两周的在线实验中，对于AAL广告，我们观察到广告印象用户和收入用户的统计显著增长，这导致AAL广告印象和收入的增长(分别为3.6%和3.1%)。虽然我们观察到AAL广告的点击率下降了5.7%，但我们也看到隐藏率下降了8.3%(HDR)，良好点击率上升了2.7%(GCR)，这表明AAL广告的用户参与质量有所提高。我们从理论上认为，这些指标的变化与我们的离线评估一致:组合神经网络模型的召回率大大提高，这转化为在线实验期间更好的用户接触，从而导致更多用户的广告印象和收入。</p><figure class="kh ki kj kk fd kl er es paragraph-image"><div role="button" tabindex="0" class="km kn di ko bf kp"><div class="er es lt"><img src="../Images/90deef7ad1bc832fee7f7808362ae6d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*YxQt4zoDv0XVZ3Dt"/></div></div><figcaption class="ks kt et er es ku kv bd b be z dx">Figure 7. Online A/B Test Results for Act-alike Ads (Baseline: Blended)</figcaption></figure><h1 id="47b7" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">结论</h1><p id="0d77" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">为了发现高质量的actalike用户用于受众扩展目标，我们使用预先训练的通用用户嵌入，并为每个种子列表建立神经网络分类器。该方法在查全率和查准率方面都优于基于原始特征训练的传统回归模型和基于用户嵌入的相似性模型。我们还使用历史用户参与度指标来进一步提高actalike扩展在线指标。</p><h1 id="adc6" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">未来的工作</h1><p id="9d46" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">AAL系统的统一为许多未来的AAL项目铺平了道路。在撰写本文时，已经推出了进一步提高系统效率和基础设施成本的产品。该团队正在研究更深入的建模结构，如深度因子分解机和上下文AAL，以实现更高质量的AAL受众扩展。</p><p id="bda8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="ln">要在Pinterest了解更多工程知识，请查看我们的</em> <a class="ae kf" href="https://medium.com/pinterest-engineering" rel="noopener"> <em class="ln">工程博客</em> </a> <em class="ln">，并访问我们的</em><a class="ae kf" href="https://labs.pinterest.com/?utm_source=medium&amp;utm_medium=blog-article&amp;utm_campaign=fang-xu-july-20-2021" rel="noopener ugc nofollow" target="_blank"><em class="ln">Pinterest Labs</em></a><em class="ln">网站。要查看和申请空缺职位，请访问我们的</em> <a class="ae kf" href="https://www.pinterestcareers.com/?utm_source=medium&amp;utm_medium=blog-article&amp;utm_campaign=fang-xu-july-20-2021" rel="noopener ugc nofollow" target="_blank"> <em class="ln">职业</em> </a> <em class="ln">页面。</em></p><h1 id="9dd8" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">承认</h1><p id="fc21" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">我们要感谢保罗·努内斯、雅各布·高、斯科特·邹、向崇元、和斯蒂芬妮·德韦特所做的贡献。我们还要感谢陈龙斌、阮亚龙、肖恩·麦柯迪、叶茂和鲁洛夫·范·兹沃尔的领导。</p><h1 id="3cf0" class="jc jd hh bd je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy jz bi translated">参考</h1><p id="f3bd" class="pw-post-body-paragraph ie if hh ig b ih ka ij ik il kb in io ip kc ir is it kd iv iw ix ke iz ja jb ha bi translated">[1]马，强&amp;华，伊珊&amp;文，贾谊&amp;夏，甄&amp;奥曼迪，罗伯特&amp;陈，大同.(2016).给长相相似的观众打分。647–654.10.1109/ICDMW.2016.0097</p><p id="c127" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">[2]多安、科阿&amp;亚达夫、普朗朱尔&amp;雷迪、钱丹。(2019).用于相似建模的对立因子分解自动编码器。2803–2812.10.1145/3357384.3357807.</p><p id="a682" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">[3]刘，海山&amp;帕多，戴维&amp;刘，昆&amp;塔库尔，马诺杰&amp;曹，弗兰克&amp;李，崇哲。(2016).在线社交网络广告的受众拓展。165–174.10.1145/2939672.2939680.</p><p id="a992" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">[4]蒋军，林，谢，姚军，陆，等(2019)。基于端到端神经预测的综合受众拓展。在J. Degenhardt，S. Kallumadi，U. Porwal和A. Trotman(编辑。)，SIGIR 2019年电子商务研讨会的会议录，与第42届国际ACM SIGIR信息检索研究与发展会议共同举办，eCom@SIGIR 2019，法国巴黎，2019年7月25日(第2410卷)。</p><p id="12ac" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">[5]刘、、葛、、张、徐、林、.(2019).推荐系统中基于实时关注度的相似模型。2765–2773.10.1145/3292500.3330707.</p><p id="1b91" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">[6]德韦特，斯蒂芬妮和欧，贾凡。(2019).寻找行为相似的用户:为扩大广告受众转移学习。2251–2259.10.1145/3292500.3330714.</p></div></div>    
</body>
</html>