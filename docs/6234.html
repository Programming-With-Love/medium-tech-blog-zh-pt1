<html>
<head>
<title>Privacy Power-Up: Upgrading Pin Links from HTTP to HTTPS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">隐私启动:将Pin链接从HTTP升级到HTTPS</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/privacy-power-up-upgrading-pin-links-from-http-to-https-9f3cd32a132c?source=collection_archive---------3-----------------------#2019-11-19">https://medium.com/pinterest-engineering/privacy-power-up-upgrading-pin-links-from-http-to-https-9f3cd32a132c?source=collection_archive---------3-----------------------#2019-11-19</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="708a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">玛利亚·德·安杰利斯组合| 2019年夏季Pinterest工程师实习生</p><p id="2b60" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">HTTPS应该无处不在。你的网站可能运行在HTTPS上，给你的用户一个安全的、加密的连接，但是所有的出站链接呢？你能保证他们都用HTTPS吗？在这篇文章中，我们描述了通过利用<a class="ae jc" href="https://spreadprivacy.com/duckduckgo-smarter-encryption" rel="noopener ugc nofollow" target="_blank"> DuckDuckGo更智能的加密技术</a>将Pin链接从HTTP升级到HTTPS的步骤。</p><p id="ed29" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">为什么是HTTPS？</strong></p><p id="5fca" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">虽然Pinterest完全在HTTPS上运行，但它并不是大多数用户的最终目的地。作为Pinners发现和做他们喜欢的事情的地方，Pinterest是到达其他网站的发射台。因此，我们有责任尽可能将Pinners重定向到HTTPS站点，包括在可能的情况下将出站Pin链接从HTTP升级到HTTPS，并最大化通过HTTPS的流量百分比。</p><p id="98e2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">任何HTTP流量存在的原因只是因为许多pin都是以这种方式创建的。当Pinner点击一个Pin链接时，如果内容是用HTTP URL创建的，她将被发送到HTTP站点。然而，如果该网站支持HTTPS，我们想把用户发送到HTTPS版本。我们决定对HTTPS进行在线升级，这样我们就可以在所有Pinterest界面上最大化搜索结果。</p><p id="be8f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">经过改进后，现在大约80%的对外交通通过HTTPS，增加了30%以上。</p><p id="278b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了确保这种变化不会干扰重要的指标，我们进行了一个实验，将这些变化发布给1%的用户，并将他们与同等的控制组进行比较。我们发现Pinterest的基准指标没有变化，所以我们将继续向更多的Pinterest用户发布实验。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/084593aacc9c2629c19e60c3e1c4fb3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*KtflVios-6cOlz4J"/></div></div></figure><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jp"><img src="../Images/8d1abc8effd729537263af352538e295.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Sfy2HR9xDdZTC1yQ"/></div></div></figure><p id="4138" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">图1:这个Pinterest板的管脚通过它们链接的协议进行颜色编码。HTTPS链接是绿色的，HTTP链接是红色的。当实验在第二张图中启用时，大多数红色引脚变成绿色，因为它们的链接可以升级到HTTPS。</p><p id="94c9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">duck duck go的智能加密</strong></p><p id="7f5a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了尽可能高效地工作，我们集成了<a class="ae jc" href="https://spreadprivacy.com/duckduckgo-smarter-encryption" rel="noopener ugc nofollow" target="_blank"> DuckDuckGo更智能的加密技术</a>，该技术会在可用时自动使用加密的网站连接。DuckDuckGo对我们来说是完美的选择，因为他们有一个全面的可升级网站列表，通过比较网站的HTTP和HTTPS版本来生成，如果两个版本相同，就将一个网站添加到HTTPS升级列表中。然后，我们可以定期提取和摄取他们的列表。</p><p id="2571" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> Pinterest架构</strong></p><p id="1483" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当用户滚动他们的Pinterest home feed时，在API层发出获取pin的请求，然后调用Apache Thrift服务PinAndBoardService，后者随后从MySQL数据库获取pin。</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jq"><img src="../Images/6bfe18f2047bc4a0e24331777fe83867.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xqxDR88ZWwBmJRau"/></div></div></figure><p id="1bdd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">图2:引脚获取架构的简化表示。API层向PinAndBoardService发出请求，然后PinAndBoardService从缓存或MySQL中获取Pin。</p><p id="dd05" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">概述</strong></p><p id="04c3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了实现Pin链接转换，我们:</p><ol class=""><li id="0dbb" class="jr js hh ig b ih ii il im ip jt it ju ix jv jb jw jx jy jz bi translated">触发是否在API层运行实验。</li><li id="7f10" class="jr js hh ig b ih ka il kb ip kc it kd ix ke jb jw jx jy jz bi translated">如果启用了实验，则调用API层中PinAndBoardService中新添加的端点。</li><li id="98d9" class="jr js hh ig b ih ka il kb ip kc it kd ix ke jb jw jx jy jz bi translated">在新的PinAndBoardService端点中，当从数据库或缓存中提取Pin时，检查它的URL是否以HTTP开头，如果是这种情况，应该尽可能将其升级到HTTPS。</li><li id="55f0" class="jr js hh ig b ih ka il kb ip kc it kd ix ke jb jw jx jy jz bi translated">通过从URL中剥离域并检查该域是否包含在DuckDuckGo的智能加密提供的安全域列表中，检查Pin是否能够升级到HTTPS。</li><li id="4711" class="jr js hh ig b ih ka il kb ip kc it kd ix ke jb jw jx jy jz bi translated">执行转换并升级链接，以便所有下游服务都将收到安全版本。</li><li id="d8e0" class="jr js hh ig b ih ka il kb ip kc it kd ix ke jb jw jx jy jz bi translated">我们选择在PinAndBoardService中执行链接转换，而不是直接在MySQL数据库中执行，原因如下:</li><li id="1f9f" class="jr js hh ig b ih ka il kb ip kc it kd ix ke jb jw jx jy jz bi translated">如果我们在MySQL层将一个HTTP链接升级到HTTPS，后来该域不再支持HTTPS，Pin链接将断开，我们将无法跟踪更改，因为链接将被永久修改。为了解决这个问题，我们可以在MySQL中同时存储新旧链接，但是这样会比当前的方法空间效率低。</li><li id="01f2" class="jr js hh ig b ih ka il kb ip kc it kd ix ke jb jw jx jy jz bi translated">虽然我们必须在每次从数据库中获取Pin时执行转换(不管它是否已经升级)，但是我们通常可以避免冗余获取，因为Pin被高度缓存。</li></ol><p id="8487" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">下一步</strong></p><p id="319f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">随着我们的发展，我们正在探索永久升级pin以确保HTTPS链接的安全，这是向HTTPS的普遍使用和增加我们平台上所有用户的安全性迈出的一大步。我们还在跟踪我们目前无法升级的链接，以便为DuckDuckGo的智能加密做出潜在贡献，从而改善所有用户的用户体验。</p><p id="7f01" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">致谢</strong></p><p id="16e9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">非常感谢伊曼纽·切塞纳(我的优秀实习导师)和Pinterest安全团队的其他成员！也非常感谢CoreService、Storage &amp; Caching和API团队提供的支持，以及DuckDuckGo提供的对他们更智能的加密技术的早期访问。</p></div></div>    
</body>
</html>