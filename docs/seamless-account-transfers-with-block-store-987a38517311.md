# 通过 Block Store 实现无缝转账

> 原文：<https://medium.com/androiddevelopers/seamless-account-transfers-with-block-store-987a38517311?source=collection_archive---------0----------------------->

![](img/e6b3f9e01cb6a266c4862813ae902d17.png)

新移动设备的魔力。打开脆盒，剥去塑料，露出完美的屏幕，设置设备，将以前的应用程序下载到新设备上。当用户试图使用他们的应用程序时，这种无缝体验就会中断，必须重新进行身份验证。试图记住帐户凭证和经历帐户恢复流程会引起很多摩擦。这种摩擦导致用户最终创建一个新帐户并放弃旧帐户，或者在某些情况下，摩擦如此之大，以至于他们完全放弃了应用程序。

为了解决这个问题，我们提出了块存储 API，使用户在新设备上重新登录应用程序变得简单，就像在设置过程中从备份中恢复一样，这样他们就可以像离开时一样返回到他们的应用程序。请继续阅读，了解更多关于 Block Store 的信息及其优势，以及如何为用户提供神奇的体验！

# 什么是街区商店？

块存储 API 允许您的应用程序存储用户凭据，以后可以检索这些凭据以在新设备上重新验证用户。当用户使用一台设备启动另一台设备时，您的凭据数据会在设备之间传输。

# 块存储的工作原理:

1.  当用户登录到您的应用程序时，或此后的任何时候，您可以保存您为该用户生成的验证令牌以阻止存储。
2.  使用块存储保存令牌后，令牌将被加密并存储在本地设备上。
3.  当用户使用设备到设备恢复流程设置新设备时，数据会转移到新设备。
4.  当用户在新设备上返回到您的应用时，如果他们在进行设备到设备恢复时提供了恢复其数据的同意，块存储将检索您的应用的令牌。

# 为什么使用块存储？

虽然此 API 可以选择使用，但在您的应用中实现它有一些优势:

*   如果用户不必担心记住他们的凭证，他们也会更愿意使用独特的、更难被网络钓鱼的密码。
*   消除登录流程中的摩擦，这种摩擦最终会导致用户不再使用你的应用。
*   集成很简单，并且不管您提供什么样的登录方法，它都能正常工作。
*   谷歌验证用户的身份。

# 如何在我的 app 中添加？

当用户登录到您的应用程序时，您可以通过调用`storeBytes()`来保存您为该用户生成的验证令牌以阻止存储。这将用户的凭据存储到源设备。现在，令牌被加密并存储在本地设备上。

当用户在新设备上执行设备到设备恢复流程时，块存储会检索您的令牌。由于用户已经同意在恢复流程中恢复您的应用程序数据，因此无需额外同意。当用户打开您的应用程序时，您可以通过调用`retrieveBytes()`向 Block Store 请求您的令牌。这个检索到的令牌可用于保持用户在新设备上登录。如果调用应用程序没有令牌，它仍然会调用`onSuccessListener()`，但结果是空字节。如果在同一个设备上调用`storeBytes()`然后再调用`retrieveBytes()`，`retrieveBytes(`仍然会返回之前`storeBytes()`设置的字节。

# 摘要

这就是开始使用 Block Store 所需要知道的全部内容！要了解更多信息，请查看[文档](https://developers.google.com/identity/blockstore/android)。

编码快乐！