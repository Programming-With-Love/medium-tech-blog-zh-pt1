<html>
<head>
<title>Building a simple audio app in Android (Part 2/3)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Android中构建一个简单的音频应用程序(第2/3部分)</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/building-a-simple-audio-app-in-android-part-2-3-a514f6224b83?source=collection_archive---------2-----------------------#2017-08-22">https://medium.com/androiddevelopers/building-a-simple-audio-app-in-android-part-2-3-a514f6224b83?source=collection_archive---------2-----------------------#2017-08-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="dfc5" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">构建应用程序</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/5519da4524d3481d452fdc6306100274.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qWLSbYLIRQtMu1H98VgJPw.png"/></div></div></figure><h1 id="2224" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">介绍</h1><p id="49f4" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">本系列文章的目标是通过创建一个名为“简单的MediaPlayer”的非常基本的音频播放应用程序，让您开始使用Android <code class="du kw kx ky kz b">MediaPlayer</code> API。这是3部分系列的第二部分，包括:</p><ol class=""><li id="7c62" class="la lb hh kc b kd lc kg ld kj le kn lf kr lg kv lh li lj lk bi translated"><a class="ae ll" rel="noopener" href="/@nazmul/building-a-simple-audio-app-in-android-part-1-3-c14d1a66e0f1"> MediaPlayer简介</a></li><li id="c8dc" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lh li lj lk bi translated"><strong class="kc hi">构建app </strong> ( <em class="lr">本文</em>)</li><li id="edcc" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lh li lj lk bi translated"><a class="ae ll" rel="noopener" href="/@nazmul/building-a-simple-audio-app-in-android-part-3-3-ead4a0e10673">与滚动条同步</a></li></ol><h1 id="7769" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">第2/3部分—构建应用程序</h1><p id="37e5" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">本文将涵盖以下内容:</p><ul class=""><li id="6d2c" class="la lb hh kc b kd lc kg ld kj le kn lf kr lg kv ls li lj lk bi translated">如何使用<code class="du kw kx ky kz b">MediaPlayer</code>类(创建、准备、启动、重置、搜索)并对其状态机有一个工作理解。</li></ul><h1 id="e1b4" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">app长什么样？</h1><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lt"><img src="../Images/13618417dc0e545c2522eb005087c4ae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*MyUXr6g7WVEE8n0WeXs-BA.gif"/></div></div></figure><h1 id="ca59" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">源代码在哪里？</h1><div class="lu lv ez fb lw lx"><a href="https://github.com/googlesamples/android-SimpleMediaPlayer" rel="noopener  ugc nofollow" target="_blank"><div class="ly ab dw"><div class="lz ab ma cl cj mb"><h2 class="bd hi fi z dy mc ea eb md ed ef hg bi translated">Google samples/Android-简单媒体播放器</h2><div class="me l"><h3 class="bd b fi z dy mc ea eb md ed ef dx translated">在GitHub上创建一个帐户，为android-SimpleMediaPlayer开发做出贡献。</h3></div><div class="mf l"><p class="bd b fp z dy mc ea eb md ed ef dx translated">github.com</p></div></div><div class="mg l"><div class="mh l mi mj mk mg ml jg lx"/></div></div></a></div><p id="4a45" class="pw-post-body-paragraph ka kb hh kc b kd lc ii kf kg ld il ki kj mm kl km kn mn kp kq kr mo kt ku kv ha bi translated">示例应用程序的源代码可在<a class="ae ll" href="https://github.com/googlesamples/android-SimpleMediaPlayer" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上获得。这个应用程序允许你播放来自<code class="du kw kx ky kz b">res/raw</code>文件夹的MP3文件，而不需要从网络音频源播放。它使用了<code class="du kw kx ky kz b">MediaPlayer</code> API，因此你可以通过与应用程序交互来清楚地了解状态和转换。</p><h1 id="e41c" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">构建应用程序</h1><p id="ece7" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">该应用程序使用系列第1/3部分<a class="ae ll" rel="noopener" href="/@nazmul/introduction-to-mediaplayer-part-1-3-c14d1a66e0f1">中描述的状态机部分。您可以查看示例应用程序的<code class="du kw kx ky kz b"><a class="ae ll" href="https://github.com/googlesamples/android-SimpleMediaPlayer/blob/53fbbbafc9ab14d51041fc52ced2a6926484c274/app/src/main/java/com/example/android/mediaplayersample/MediaPlayerHolder.java" rel="noopener ugc nofollow" target="_blank">MediaPlayerHolder</a></code>类来了解这一点。</a></p><ol class=""><li id="6bd4" class="la lb hh kc b kd lc kg ld kj le kn lf kr lg kv lh li lj lk bi translated"><code class="du kw kx ky kz b">MediaPlayerHolder</code>实现了一个名为<code class="du kw kx ky kz b"><a class="ae ll" href="https://github.com/googlesamples/android-SimpleMediaPlayer/blob/53fbbbafc9ab14d51041fc52ced2a6926484c274/app/src/main/java/com/example/android/mediaplayersample/PlayerAdapter.java" rel="noopener ugc nofollow" target="_blank">PlayerAdapter</a></code>的接口，该接口允许<code class="du kw kx ky kz b"><a class="ae ll" href="https://github.com/googlesamples/android-SimpleMediaPlayer/blob/53fbbbafc9ab14d51041fc52ced2a6926484c274/app/src/main/java/com/example/android/mediaplayersample/MainActivity.java" rel="noopener ugc nofollow" target="_blank">MainActivity</a></code>控制回放功能。</li><li id="51f5" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lh li lj lk bi translated"><code class="du kw kx ky kz b">MainActivity</code>创建一个UI，允许用户播放、暂停和停止媒体播放。它创建了一个<code class="du kw kx ky kz b">MediaPlayerHolder</code>对象。</li><li id="c157" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv lh li lj lk bi translated"><code class="du kw kx ky kz b">MainActivity</code>实现了一个名为<code class="du kw kx ky kz b"><a class="ae ll" href="https://github.com/googlesamples/android-SimpleMediaPlayer/blob/53fbbbafc9ab14d51041fc52ced2a6926484c274/app/src/main/java/com/example/android/mediaplayersample/PlaybackInfoListener.java" rel="noopener ugc nofollow" target="_blank">PlaybackInfoListener</a></code>的接口，允许<code class="du kw kx ky kz b">MediaPlayerHolder</code>在媒体持续时间和进度改变时更新它。</li></ol><h1 id="ea45" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">正在加载媒体(准备，prepareAsync)</h1><p id="65db" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">为了简单起见，音频文件是从这个项目的<code class="du kw kx ky kz b">res/raw</code>文件夹中加载的。此文件夹中有一个文件:<code class="du kw kx ky kz b">jazz_in_paris.mp3</code>。</p><h1 id="8371" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">播放控制(开始、复位、停止、查看)</h1><p id="6d7a" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">在示例应用程序的UI中只有3个按钮——播放、暂停和重置。下面是<code class="du kw kx ky kz b">MainActivity</code>中与此相关的代码。注意:<code class="du kw kx ky kz b">mPlayerAdapter</code>实现了<code class="du kw kx ky kz b">PlayerAdapter</code>，这也是<code class="du kw kx ky kz b">MediaPlayerHolder</code>功能暴露给<code class="du kw kx ky kz b">MainActivity</code>的方式。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mp mq l"/></div></figure><p id="999c" class="pw-post-body-paragraph ka kb hh kc b kd lc ii kf kg ld il ki kj mm kl km kn mn kp kq kr mo kt ku kv ha bi translated">下面是<code class="du kw kx ky kz b">MediaPlayerHolder</code>(实现了<code class="du kw kx ky kz b">PlayerAdapter</code>)中实际管理<code class="du kw kx ky kz b">MediaPlayer</code>的几个方法。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mp mq l"/></div></figure><h1 id="370d" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">媒体播放器生命周期</h1><p id="e3b9" class="pw-post-body-paragraph ka kb hh kc b kd ke ii kf kg kh il ki kj kk kl km kn ko kp kq kr ks kt ku kv ha bi translated">当您播放音频并更改屏幕方向时，回放可能会出现问题。这篇文章仅仅关注于<code class="du kw kx ky kz b">MediaPlayer</code>，并没有深入到你需要实现的客户端服务器架构中，即使当你的应用程序的活动不运行或者不在前台时，你也可以在后台处理音频播放。</p><p id="3435" class="pw-post-body-paragraph ka kb hh kc b kd lc ii kf kg ld il ki kj mm kl km kn mn kp kq kr mo kt ku kv ha bi translated">当屏幕方向改变时，Android会破坏活动并重新创建它。在我们的示例代码中，我们创建了<code class="du kw kx ky kz b">MediaPlayer</code>，并在<code class="du kw kx ky kz b">MainActivity</code>的生命周期中保留它。为了简单起见，我们将覆盖Activity的默认行为来销毁自身，并自己处理屏幕配置更改。</p><p id="d8c3" class="pw-post-body-paragraph ka kb hh kc b kd lc ii kf kg ld il ki kj mm kl km kn mn kp kq kr mo kt ku kv ha bi translated">我们通过向应用程序的<code class="du kw kx ky kz b">AndroidManfiest.xml</code>添加以下内容来实现这一点。你可以在developers.android.com了解更多。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mp mq l"/></div></figure><p id="b099" class="pw-post-body-paragraph ka kb hh kc b kd lc ii kf kg ld il ki kj mm kl km kn mn kp kq kr mo kt ku kv ha bi translated">当没有播放音频时，不要紧抓<code class="du kw kx ky kz b">MediaPlayer’s</code>资源，这一点很重要。<code class="du kw kx ky kz b">MediaPlayer</code>拥有大量由Android操作系统提供的共享资源(比如编解码器)。在不使用时释放这些资源非常重要。<code class="du kw kx ky kz b">MediaPlayerHolder</code>类有一个<code class="du kw kx ky kz b">release()</code>方法，它最终释放了<code class="du kw kx ky kz b">MediaPlayer</code>。这由<code class="du kw kx ky kz b">MainActivity</code>的<code class="du kw kx ky kz b">onStop()</code>方法调用。</p><p id="83d7" class="pw-post-body-paragraph ka kb hh kc b kd lc ii kf kg ld il ki kj mm kl km kn mn kp kq kr mo kt ku kv ha bi translated">一旦一个<code class="du kw kx ky kz b">MediaPlayer</code>被释放，就不能再被使用。所以必须创造一个新的。当调用<code class="du kw kx ky kz b">loadMedia(int)</code>方法时,<code class="du kw kx ky kz b">MediaPlayerHolder</code>负责此事，以便加载和准备要从APK播放的MP3文件。</p><p id="558f" class="pw-post-body-paragraph ka kb hh kc b kd lc ii kf kg ld il ki kj mm kl km kn mn kp kq kr mo kt ku kv ha bi translated">当应用移至后台时，<code class="du kw kx ky kz b">MainActivity</code>不支持媒体播放。在<code class="du kw kx ky kz b">onStop()</code>方法中，停止播放，并释放<code class="du kw kx ky kz b">MediaPlayer</code>。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="mp mq l"/></div></figure><p id="ff05" class="pw-post-body-paragraph ka kb hh kc b kd lc ii kf kg ld il ki kj mm kl km kn mn kp kq kr mo kt ku kv ha bi translated">为了支持后台回放，您应该使用绑定并启动的服务，或者使用<code class="du kw kx ky kz b"><a class="ae ll" rel="noopener" href="/google-developers/understanding-mediasession-part-1-3-e4d2725f18e4">MediaSession</a></code>。我们将在其他文章中讨论这些内容。</p><p id="4ae1" class="pw-post-body-paragraph ka kb hh kc b kd lc ii kf kg ld il ki kj mm kl km kn mn kp kq kr mo kt ku kv ha bi translated">要继续构建应用程序并集成<code class="du kw kx ky kz b">SeekBar</code>以持续同步播放进度和清除器，请查看本系列的<a class="ae ll" rel="noopener" href="/@nazmul/building-a-simple-audio-app-in-android-part-3-3-ead4a0e10673">第3/3部分-与SeekBar </a>同步。</p><div class="lu lv ez fb lw lx"><a rel="noopener follow" target="_blank" href="/@nazmul/building-a-simple-audio-app-in-android-part-3-3-ead4a0e10673"><div class="ly ab dw"><div class="lz ab ma cl cj mb"><h2 class="bd hi fi z dy mc ea eb md ed ef hg bi translated">在Android中构建一个简单的音频应用程序(第3/3部分)</h2><div class="me l"><h3 class="bd b fi z dy mc ea eb md ed ef dx translated">与搜索栏同步</h3></div><div class="mf l"><p class="bd b fp z dy mc ea eb md ed ef dx translated">medium.com</p></div></div><div class="mg l"><div class="mr l mi mj mk mg ml jg lx"/></div></div></a></div><h1 id="141a" class="ji jj hh bd jk jl jm jn jo jp jq jr js in jt io ju iq jv ir jw it jx iu jy jz bi translated">Android媒体资源</h1><ul class=""><li id="b6fe" class="la lb hh kc b kd ke kg kh kj ms kn mt kr mu kv ls li lj lk bi translated"><a class="ae ll" rel="noopener" href="/google-developers/understanding-mediasession-part-1-3-e4d2725f18e4">了解媒体会话</a></li><li id="32ea" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv ls li lj lk bi translated"><a class="ae ll" href="https://developer.android.com/guide/topics/media-apps/media-apps-overview.html" rel="noopener ugc nofollow" target="_blank"> Android媒体API指南—媒体应用概述</a></li><li id="2fcc" class="la lb hh kc b kd lm kg ln kj lo kn lp kr lq kv ls li lj lk bi translated"><a class="ae ll" href="https://developer.android.com/guide/topics/media-apps/working-with-a-media-session.html" rel="noopener ugc nofollow" target="_blank"> Android媒体应用编程接口指南—使用媒体会话</a></li></ul></div></div>    
</body>
</html>