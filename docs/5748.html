<html>
<head>
<title>Adding Image Capability Schema to the Migration Toolbox</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将映像功能方案添加到迁移工具箱</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/adding-image-capability-schema-to-the-migration-toolbox-d0e8fef1f819?source=collection_archive---------3-----------------------#2021-02-05">https://medium.com/oracledevs/adding-image-capability-schema-to-the-migration-toolbox-d0e8fef1f819?source=collection_archive---------3-----------------------#2021-02-05</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="000c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">今年夏天，甲骨文云基础设施(OCI)计算团队<a class="ae jc" href="https://docs.oracle.com/en-us/iaas/releasenotes/changes/4f11f85a-9598-4fce-9741-edc92b4facda/" rel="noopener ugc nofollow" target="_blank">发布了</a>一项名为<a class="ae jc" href="https://docs.oracle.com/en-us/iaas/Content/Compute/Tasks/configuringimagecapabilities.htm" rel="noopener ugc nofollow" target="_blank"> <em class="jd">映像能力模式</em> </a>的功能，这是一项高级功能，可为从定制映像创建的实例一致地设置启动选项。配置选项包括启动模式、网络连接类型、一致的数据块卷命名和传输中加密。除了一致地设置启动选项之外，在将现有虚拟机迁移到OCI时，配置映像功能也很方便。</p><p id="212d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在OCI上运行现有虚拟机的一种方法是<a class="ae jc" href="https://docs.oracle.com/en-us/iaas/Content/Compute/References/bringyourownimage.htm" rel="noopener ugc nofollow" target="_blank">自带镜像</a> (BYOI)。BYOI过程包括将可引导虚拟磁盘上传到对象存储，并将其作为自定义映像导入。作为导入过程的一部分，会对映像应用启动模式。映像的启动模式是在从映像启动的实例上配置的一组预定义的启动选项。可用于导入映像的两种启动模式是模拟和半虚拟化。一般来说，在半虚拟化模式下运行的虚拟机比在模拟模式下运行的虚拟机具有更好的性能。</p><p id="4abb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">模拟和半虚拟化启动模式的默认启动选项如下所示。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/d0709bac9ef4a811450583fdc3cf6f5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*MuMUdC21cEmawbdkWvqPDA.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx">Emulated Launch Mode</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es je"><img src="../Images/17537dd809667e42cce6f7da6fab1cb8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*A6giKzrFC-Bs_W37RMZLSg.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx">Paravirtualized Launch Mode</figcaption></figure><h1 id="47dc" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">非功能性半虚拟化实例</h1><p id="5eea" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">要使用半虚拟化启动模式成功启动实例，需要安装virtIO驱动程序，并在操作系统中配置<strong class="ig hi"> <em class="jd">和</em> </strong>。如果自定义映像作为半虚拟化导入，但操作系统未正确配置，则实例将看似正在运行，但将不起作用。下面是您可能在作为半虚拟化导入但没有安装虚拟化驱动程序的Linux或Windows实例的控制台上看到的内容。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es kt"><img src="../Images/9802be0773c9e773bad630d74dd9f7de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6dDlNV7YRefplvX7hQ_ozQ.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx">Linux Console</figcaption></figure><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es ky"><img src="../Images/441289bf4912e25157082de26f299e8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*ixrvNXYm6hiOdJX5yVqVsA.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx">Windows Console</figcaption></figure><p id="9c1d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">查看半虚拟化设备驱动程序是否导致启动问题的一个快速方法是修改映像的功能，以强制在模拟模式下启动。</p><p id="03eb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要从导入为半虚拟化的映像启动具有仿真选项的实例，首先导航到<strong class="ig hi"> <em class="jd">自定义映像详细信息</em> </strong>页面，然后单击<strong class="ig hi"> <em class="jd">编辑映像功能</em> </strong>按钮。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es kz"><img src="../Images/55cc65b74a83e9d5d5e125a18bcbce1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w_8pXIaiDDjXEJbj9kEGuQ.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx">Edit Custom Image</figcaption></figure><p id="058e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要强制映像使用模拟启动选项，请选择仅模拟值。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es la"><img src="../Images/59bbd3ee25baf55c566cddf4362a0a4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:818/format:webp/1*filaQFMT46tSExws5DZ_lQ.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx">Emulated Launch Options</figcaption></figure><p id="b868" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">单击“保存”按钮修改映像功能并启动一个新实例。通过点击<strong class="ig hi"> <em class="jd">创建实例</em> </strong>按钮，可以从同一个<strong class="ig hi"> <em class="jd">自定义图像细节</em> </strong>页面创建一个新实例。</p><p id="7b1e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果新实例成功启动和引导，自定义映像的操作系统可能不支持半虚拟化。半虚拟化的设备驱动程序可以安装在Windows和最新的Linux发行版上。请关注即将发布的关于准备将现有虚拟机导入OCI的帖子，包括半虚拟化。</p><h1 id="1553" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">将模拟实例转换为半虚拟化</h1><p id="9b24" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">在用半虚拟化设备驱动程序配置了仿真实例之后，可以使用类似的过程在半虚拟化模式下启动新实例。</p><p id="4552" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要创建半虚拟化的实例，请从模拟实例开始创建自定义映像。<strong class="ig hi"> <em class="jd">创建自定义图像</em> </strong>选项在<strong class="ig hi"> <em class="jd">下可用</em> </strong>按钮的<strong class="ig hi"> <em class="jd">实例详情</em> </strong>页面。请注意，实例在映像创建过程中会重新启动，通常只需几分钟。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="er es lb"><img src="../Images/18473e8e1d598a52092dc5bd9e7fbef4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2J8JDTXtAYea-1khLmJ15A.png"/></div></div><figcaption class="jm jn et er es jo jp bd b be z dx">Create Custom Image</figcaption></figure><p id="b253" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">创建自定义图像后，导航到<strong class="ig hi"> <em class="jd">自定义图像详细信息</em> </strong>页面，点击<strong class="ig hi"> <em class="jd">编辑图像能力</em> </strong>按钮。</p><p id="71d2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要强制从模拟实例导出的映像使用半虚拟化启动选项，请仅选择半虚拟化值。</p><figure class="jf jg jh ji fd jj er es paragraph-image"><div class="er es lc"><img src="../Images/f221b2f99c82c778f6eca7413b9bce4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*1hFK4MpVpzthpXPM7-N5zg.png"/></div><figcaption class="jm jn et er es jo jp bd b be z dx">Paravirtualized Launch Options</figcaption></figure><p id="655e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，保存修改后的映像功能并启动一个新实例。通过点击<strong class="ig hi"> <em class="jd">创建实例</em> </strong>按钮，可以从同一个<strong class="ig hi"> <em class="jd">自定义图像细节</em> </strong>页面创建一个新实例。</p><h1 id="2c1b" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">使用OCI CLI</h1><p id="e6b6" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">还可以使用OCI CLI创建映像功能模式。开始使用OCI CLI的最快方法是从OCI控制台使用<a class="ae jc" href="https://docs.oracle.com/en-us/iaas/Content/API/Concepts/cloudshellintro.htm" rel="noopener ugc nofollow" target="_blank">云外壳</a>。</p><p id="fb11" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要使用OCI CLI应用映像功能模式，首先要找到全局模式<strong class="ig hi"> <em class="jd"> id </em> </strong>和<strong class="ig hi"> <em class="jd">当前版本名称</em> </strong>。</p><pre class="jf jg jh ji fd ld le lf lg aw lh bi"><span id="8557" class="li jr hh le b fi lj lk l ll lm">oci compute global-image-capability-schema list --all</span></pre><p id="7a4a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">其次，获取全局模式作为模板。</p><pre class="jf jg jh ji fd ld le lf lg aw lh bi"><span id="c1cb" class="li jr hh le b fi lj lk l ll lm">Syntax:<br/><br/>oci compute global-image-capability-schema-version get \<br/>   --global-image-capability-schema-id &lt;ID&gt; \<br/>   --global-image-capability-schema-version-name &lt;VERSION_NAME&gt;<br/><br/>Example:<br/><br/>oci compute global-image-capability-schema-version get --global-image-capability-schema-id ocid1.computeglobalimgcapschema.oc1.iad.aaaaaaaa743mjhi74zq5j6d42a --global-image-capability-schema-version-name 2c015226-8eed-193c90b &gt; emulated_schema.json</span></pre><p id="48c0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第三，使用全局模式输出创建一个具有适当值的<strong class="ig hi"> <em class="jd">仿真模式. json </em> </strong>文件。务必将<strong class="ig hi"> <em class="jd">源</em> </strong>属性从<strong class="ig hi"> <em class="jd">全局</em> </strong>改为<strong class="ig hi"> <em class="jd">图像</em> </strong>。</p><p id="12e3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是一个带有仿真启动选项的JSON文件示例:</p><pre class="jf jg jh ji fd ld le lf lg aw lh bi"><span id="c093" class="li jr hh le b fi lj lk l ll lm">{<br/>   "Compute.Firmware": {<br/>     "default-value": "BIOS",<br/>     "descriptor-type": "enumstring",<br/>     "source": "IMAGE",<br/>     "values": [<br/>       "BIOS"<br/>     ]<br/>   },<br/>   "Compute.LaunchMode": {<br/>     "default-value": "EMULATED",<br/>     "descriptor-type": "enumstring",<br/>     "source": "IMAGE",<br/>     "values": [<br/>       "EMULATED"<br/>     ]<br/>   },<br/>   "Network.AttachmentType": {<br/>     "default-value": "EMULATED",<br/>     "descriptor-type": "enumstring",<br/>     "source": "IMAGE",<br/>     "values": [<br/>       "EMULATED"<br/>     ]<br/>   },<br/>   "Storage.BootVolumeType": {<br/>     "default-value": "IDE",<br/>     "descriptor-type": "enumstring",<br/>     "source": "IMAGE",<br/>     "values": [<br/>       "IDE"<br/>     ]<br/>   }<br/> }</span></pre><p id="65b6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，为定制映像创建一个映像功能模式。</p><pre class="jf jg jh ji fd ld le lf lg aw lh bi"><span id="1d84" class="li jr hh le b fi lj lk l ll lm">Syntax:<br/><br/>oci compute image-capability-schema create \<br/>   --compartment-id &lt;COMPARTMENT_ID&gt; \<br/>   --image-id &lt;IMAGE_ID&gt; \<br/>   --global-image-capability-schema-version-name &lt;VERSION_NAME&gt; \<br/>   --schema-data=file:// &lt;SCHEMA_DATA_FILE&gt;.json<br/><br/>Example:<br/><br/>oci compute image-capability-schema create --compartment-id ocid1.compartment.oc1..aaaaaaaacubvmt72cs2cjne4tc32pgk --image-id ocid1.image.oc1.iad.aaaaaaaaxkwffehulnmpkeq --global-image-capability-schema-version-name 2c015226-8eed-193c90b --schema-data=file://emulated_schema.json</span></pre><h1 id="edac" class="jq jr hh bd js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn bi translated">最后的想法</h1><p id="603b" class="pw-post-body-paragraph ie if hh ig b ih ko ij ik il kp in io ip kq ir is it kr iv iw ix ks iz ja jb ha bi translated">使用映像功能并不是修复非功能性paravirtualzied实例的唯一方法，但它是迄今为止最快的方法。在发布映像功能模式之前，需要将非功能映像导出到对象存储，需要下载qcow2虚拟磁盘并从导出中提取，然后使用适当的启动模式重新导入磁盘。这个过程可能需要45分钟或更长时间。最广泛的方法是修改源虚拟机并再次尝试BYOI进程。</p><p id="fedc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我希望您在迁移过程中不需要使用映像功能模式，但是如果您需要恢复一个非功能性的半虚拟化实例，现在您有了一个简单的工具。请务必关注未来关于准备将现有虚拟机导入OCI的帖子。这篇文章将介绍在移动任何数据之前您需要做出的一些决定和准备工作，以便平稳地过渡到OCI，一切都按预期进行。</p><p id="3757" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">保持头脑清醒！</p></div></div>    
</body>
</html>