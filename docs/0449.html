<html>
<head>
<title>Speed up your Android Dynamic Features flow testing</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">加速您的Android动态特性流测试</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/speed-up-your-android-dynamic-features-flow-testing-d63986cd716a?source=collection_archive---------5-----------------------#2019-12-20">https://medium.com/androiddevelopers/speed-up-your-android-dynamic-features-flow-testing-d63986cd716a?source=collection_archive---------5-----------------------#2019-12-20</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="cb12" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">使用Gradle Play Publisher插件</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es iw"><img src="../Images/5615e5d75b36a4b72289bbaa602ec3a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*cWV1grgWX1sYwEaP.png"/></div></div></figure><p id="b796" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">越来越多的Android应用程序正在将<a class="ae ke" href="https://developer.android.com/studio/projects/dynamic-delivery" rel="noopener ugc nofollow" target="_blank">动态功能</a>集成到他们的项目中，尽管你需要Play Store来提供这些功能，这使得测试真实的用户流变得很困难(即用户在点击某个地方后打开应用程序并安装一个模块)。</p><p id="23ce" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">Android Studio提供了一种在运行应用程序时选择包括哪些动态功能的方法，尽管它没有提供从Play测试动态功能模块安装的方法。</p><p id="c413" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">幸运的是，我们有<a class="ae ke" href="https://play.google.com/apps/publish/internalappsharing/" rel="noopener ugc nofollow" target="_blank"> Play内部应用程序共享</a>，它允许开发者上传应用程序的版本，并快速轻松地与他人共享以供测试。</p><p id="fa04" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这意味着，要测试完整的流程，我们必须:构建一个捆绑包，上传到Play Console内部app共享，复制上传链接，在一个设备上打开，然后安装App试用。</p><h1 id="42af" class="kf kg hh bd kh ki kj kk kl km kn ko kp in kq io kr iq ks ir kt it ku iu kv kw bi translated">有更好的方法。</h1><p id="2613" class="pw-post-body-paragraph ji jj hh jk b jl kx ii jn jo ky il jq jr kz jt ju jv la jx jy jz lb kb kc kd ha bi translated">有了新版本的<a class="ae ke" href="https://github.com/Triple-T/gradle-play-publisher" rel="noopener ugc nofollow" target="_blank"> Gradle Play Publisher </a>，我们可以在一次点击/命令中实现上述流程的自动化。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="jc jd di je bf jf"><div class="er es lc"><img src="../Images/c90bf162db1943c25ff6220ddc5e0fe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pY_lzsiEOmZryp2hPf4xCw.png"/></div></div></figure><h1 id="a311" class="kf kg hh bd kh ki kj kk kl km kn ko kp in kq io kr iq ks ir kt it ku iu kv kw bi translated">怎么会？</h1><p id="3286" class="pw-post-body-paragraph ji jj hh jk b jl kx ii jn jo ky il jq jr kz jt ju jv la jx jy jz lb kb kc kd ha bi translated">首先，设置Gradle Play Publisher:</p><ol class=""><li id="c950" class="ld le hh jk b jl jm jo jp jr lf jv lg jz lh kd li lj lk ll bi translated">使用<a class="ae ke" href="https://play.google.com/apps/publish" rel="noopener ugc nofollow" target="_blank"> Google Play控制台</a>上传您的应用包的第一个版本</li><li id="166b" class="ld le hh jk b jl lm jo ln jr lo jv lp jz lq kd li lj lk ll bi translated"><a class="ae ke" href="https://github.com/Triple-T/gradle-play-publisher#service-account" rel="noopener ugc nofollow" target="_blank">创建Google Play服务帐户</a></li><li id="1944" class="ld le hh jk b jl lm jo ln jr lo jv lp jz lq kd li lj lk ll bi translated"><a class="ae ke" href="https://play.google.com/apps/publish#ApiAccessPlace" rel="noopener ugc nofollow" target="_blank">授权访问您的游戏控制台</a> <strong class="jk hi">(只有帐户所有者可以这样做)</strong></li><li id="9efa" class="ld le hh jk b jl lm jo ln jr lo jv lp jz lq kd li lj lk ll bi translated"><a class="ae ke" href="https://developer.android.com/studio/publish/app-signing#gradle-sign" rel="noopener ugc nofollow" target="_blank">使用有效的签名配置签署您的发布版本</a>(发布版本所必需的)</li></ol><p id="6ae1" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">接下来，<a class="ae ke" href="https://github.com/Triple-T/gradle-play-publisher#installation" rel="noopener ugc nofollow" target="_blank">将插件</a>添加并应用到根和基础/应用模块build.gradle:</p><p id="0b69" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><strong class="jk hi"> build.gradle → </strong></p><pre class="ix iy iz ja fd lr ls lt lu aw lv bi"><span id="39c9" class="lw kg hh ls b fi lx ly l lz ma">repositories <strong class="ls hi">{<br/>    </strong>google()<br/>    jcenter()<br/>    maven <strong class="ls hi">{ </strong>url "https://plugins.gradle.org/m2/" <strong class="ls hi">}<br/>}<br/><br/></strong>dependencies <strong class="ls hi">{<br/>    ...<br/>    </strong>classpath "com.github.triplet.gradle:play-publisher:2.6.1"<br/>}</span></pre><p id="779f" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><strong class="jk hi"> app/build.gradle → </strong></p><pre class="ix iy iz ja fd lr ls lt lu aw lv bi"><span id="8ce6" class="lw kg hh ls b fi lx ly l lz ma">apply plugin: 'com.github.triplet.play'</span><span id="b220" class="lw kg hh ls b fi mb ly l lz ma">/* ... */</span><span id="c7aa" class="lw kg hh ls b fi mb ly l lz ma">play {<br/>   serviceAccountCredentials = file("service-account-key.json")<br/>   defaultToAppBundles = true<br/>}</span></pre><p id="8638" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><strong class="jk hi">service account credentials</strong>应该指向Json文件，该文件包含您在<a class="ae ke" href="https://github.com/Triple-T/gradle-play-publisher#service-account" rel="noopener ugc nofollow" target="_blank">步骤2 </a>中设置的服务帐户的密钥。</p><p id="becd" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated"><strong class="jk hi"> defaultToAppBundles </strong>设置这个标志为真，告诉插件默认创建应用包(动态特性需要)</p><p id="180c" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">就是这样。可以从控制台或者直接从Android Studio运行<strong class="jk hi"><em class="mc">【installReleasePrivateArtifact】</em></strong>(从<em class="mc"> app &gt;发布</em>下的Gradle tasks中选择)。</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es md"><img src="../Images/1c7570a29f9bfa8238129c0da21cb1ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*rwwpOV24XmVgiMN2QrjetA.png"/></div></figure><p id="a409" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">这些任务将构建一个应用捆绑包，将其上传到Play内部应用共享，并启动Play Store内部应用共享页面，将所有<strong class="jk hi">连接的设备指向新上传的版本。</strong></p><p id="32e6" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">你仍然需要手动点击更新按钮并启动应用程序。</p><h1 id="98be" class="kf kg hh bd kh ki kj kk kl km kn ko kp in kq io kr iq ks ir kt it ku iu kv kw bi translated">使用调试或其他变体版本</h1><p id="057a" class="pw-post-body-paragraph ji jj hh jk b jl kx ii jn jo ky il jq jr kz jt ju jv la jx jy jz lb kb kc kd ha bi translated">还没有上传调试或其他变体版本的任务<a class="ae ke" href="https://github.com/Triple-T/gradle-play-publisher/issues/619" rel="noopener ugc nofollow" target="_blank"> (#619 </a>)，因此如果你想使用调试或任何其他变体版本，你必须稍微不同地配置插件。</p><p id="ab6c" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">您必须设置<strong class="jk hi"> <em class="mc"> artifactDir </em> </strong>并使任务依赖于<em class="mc"> bundle${Variant} </em>任务。</p><pre class="ix iy iz ja fd lr ls lt lu aw lv bi"><span id="8da5" class="lw kg hh ls b fi lx ly l lz ma">play <strong class="ls hi">{<br/>    </strong>serviceAccountCredentials = file(“service-account-key.json”)<br/>    defaultToAppBundles = true</span><span id="ab9b" class="lw kg hh ls b fi mb ly l lz ma">    // Defines the path to Debug bundles<br/>    artifactDir = file(“build/outputs/bundle/debug”)<br/><strong class="ls hi">}</strong></span><span id="33f8" class="lw kg hh ls b fi mb ly l lz ma">afterEvaluate <strong class="ls hi">{<br/>    </strong>tasks.named(“uploadReleasePrivateBundle”).configure <strong class="ls hi">{<br/>        </strong>dependsOn(“bundleDebug”)<br/>    <strong class="ls hi">}<br/>}</strong></span></pre><p id="3ae0" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">使用此设置，当运行<strong class="jk hi"><em class="mc">" installReleasePrivateArtifact "</em></strong>时，它将始终使用调试变量。</p><h1 id="0ee2" class="kf kg hh bd kh ki kj kk kl km kn ko kp in kq io kr iq ks ir kt it ku iu kv kw bi translated">演示</h1><p id="7e67" class="pw-post-body-paragraph ji jj hh jk b jl kx ii jn jo ky il jq jr kz jt ju jv la jx jy jz lb kb kc kd ha bi translated">在下面的视频中，你可以看到它的工作。我们启动任务，因为自上次上传以来没有任何变化(为了缩短视频)，插件会自动启动最后一个内部应用程序共享URL到连接的设备。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="me mf l"/></div></figure></div><div class="ab cl mg mh go mi" role="separator"><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml mm"/><span class="mj bw bk mk ml"/></div><div class="ha hb hc hd he"><p id="32b5" class="pw-post-body-paragraph ji jj hh jk b jl jm ii jn jo jp il jq jr js jt ju jv jw jx jy jz ka kb kc kd ha bi translated">希望你喜欢阅读。更多信息，你可以在twitter @ marxallski关注我</p><div class="mn mo ez fb mp mq"><a href="https://twitter.com/marxallski" rel="noopener  ugc nofollow" target="_blank"><div class="mr ab dw"><div class="ms ab mt cl cj mu"><h2 class="bd hi fi z dy mv ea eb mw ed ef hg bi translated">🇸🇬的马塞尔</h2><div class="mx l"><h3 class="bd b fi z dy mv ea eb mw ed ef dx translated">来自🇸🇬的Marcel的最新推文(@ marxallski)。开发商代言人🥑给这个绿色的小机器人🤖在@Google…</h3></div><div class="my l"><p class="bd b fp z dy mv ea eb mw ed ef dx translated">twitter.com</p></div></div><div class="mz l"><div class="na l nb nc nd mz ne jg mq"/></div></div></a></div></div></div>    
</body>
</html>