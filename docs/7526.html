<html>
<head>
<title>Synonyms in Elasticsearch</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Elasticsearch中的同义词</h1>
<blockquote>原文：<a href="https://medium.com/version-1/synonyms-in-elasticsearch-c527280ba8a5?source=collection_archive---------0-----------------------#2022-03-22">https://medium.com/version-1/synonyms-in-elasticsearch-c527280ba8a5?source=collection_archive---------0-----------------------#2022-03-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/3b4b750b0e58d20360b0f70d5fea114a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*uJwHeFDa2O0bu2rU"/></div></div></figure><p id="bd68" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">同义词— </strong>意思与另一个词完全或几乎相同的词。</p><p id="e019" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这篇短文中，我们将演示如何在Elasticsearch中实现名字的同义词，例如，当我们搜索“Ann”时，匹配名为“Anne”的人。</p><p id="c6aa" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们还将介绍一些弹性搜索的基础知识。</p><p id="cc16" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">TL；博士</strong></p><p id="0ad6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如何在Elasticsearch中使用同义词:</p><ul class=""><li id="df54" class="jn jo hh ir b is it iw ix ja jp je jq ji jr jm js jt ju jv bi translated">获取或创建每行包含一组同义词的CSV文件，例如beverly、bev</li><li id="cb7c" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">将CSV文件上传到<strong class="ir hi">配置</strong>目录下的所有Elasticsearch索引节点。</li><li id="559d" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">将同义词文件名作为<strong class="ir hi">分析器中的<strong class="ir hi">标记过滤器</strong>添加到索引中。</strong></li><li id="35f5" class="jn jo hh ir b is jw iw jx ja jy je jz ji ka jm js jt ju jv bi translated">将分析器添加到您想要实现这些同义词的任何搜索中。</li></ul></div><div class="ab cl kb kc go kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="ha hb hc hd he"><p id="01fe" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">弹性同义词—简介</strong></p><p id="88e9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在搜索应用程序中，同义词并不是一个“好东西”。用户理所当然地期望，如果他们搜索名为“Anne”的人，结果也将包括名为“Ann”的人；或者当我们搜索" Raj "时找到" Rajendra"。</p><p id="0356" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您想运行演示，您需要一个运行Elasticsearch索引节点的Elasticsearch实例&amp;一个Kibana服务器——我们将全程使用<a class="ae ki" href="https://www.elastic.co/guide/en/kibana/current/console-kibana.html" rel="noopener ugc nofollow" target="_blank"> Kibana开发控制台</a>,并通过Linux终端与Elasticsearch配置进行交互。</p><p id="95a5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你没有弹性集群，弹性<a class="ae ki" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/docker.html" rel="noopener ugc nofollow" target="_blank"> Docker </a>图片是一个很好的起点。</p></div><div class="ab cl kb kc go kd" role="separator"><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg kh"/><span class="ke bw bk kf kg"/></div><div class="ha hb hc hd he"><p id="42db" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤1 —创建弹性搜索指数&amp;添加一些数据</strong></p><p id="439d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Elasticsearch中的<strong class="ir hi">索引</strong>大致类似于数据库——也就是说，它是相关数据的容器。</p><p id="28cb" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们将创建一个小索引，并使用Elasticsearch dev控制台添加一些关于人们及其最喜欢的颜色的数据。</p><p id="1a05" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">下面的代码将向名为<strong class="ir hi"> <em class="kj"> ppl_idx，</em> </strong>的新索引中添加六条记录。注意，当我们添加第一条记录时，该索引是隐式创建的。复制&amp;粘贴代码到开发控制台&amp;执行…</p><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="b009" class="kt ku hh kp b fi kv kw l kx ky">POST ppl_idx/_doc<br/>{<br/>  "firstName": "Mike",<br/>  "middleName": "Dave",<br/>  "lastName": "Smith",<br/>  "favouriteColour": "yellow"<br/>}</span><span id="70a7" class="kt ku hh kp b fi kz kw l kx ky">POST ppl_idx/_doc<br/>{<br/>  "firstName": "Vanessa",<br/>  "middleName": "",<br/>  "lastName": "Jones",<br/>  "favouriteColour": "white"<br/>}</span><span id="3c66" class="kt ku hh kp b fi kz kw l kx ky">POST ppl_idx/_doc<br/>{<br/>  "firstName": "Venkatesh",<br/>  "middleName": "Rajendra",<br/>  "lastName": "Kumar",<br/>  "favouriteColour": "blue"<br/>}</span><span id="3214" class="kt ku hh kp b fi kz kw l kx ky">POST ppl_idx/_doc<br/>{<br/>  "firstName": "David",<br/>  "middleName": "Dennis",<br/>  "lastName": "Dunstable",<br/>  "favouriteColour": "yellow"<br/>}</span><span id="e7bf" class="kt ku hh kp b fi kz kw l kx ky">POST ppl_idx/_doc<br/>{<br/>  "firstName": "Nessa",<br/>  "middleName": "Cloe",<br/>  "lastName": "White",<br/>  "favouriteColour": "Teal"<br/>}</span><span id="8b81" class="kt ku hh kp b fi kz kw l kx ky">POST ppl_idx/_doc<br/>{<br/>  "firstName": "Rachel",<br/>  "middleName": "Lisa",<br/>  "lastName": "Topaz",<br/>  "favouriteColour": "blue"<br/>}</span></pre><p id="5a43" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们可以查询索引来检查数据是否已经加载好:</p><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="6000" class="kt ku hh kp b fi kv kw l kx ky">GET ppl_idx/_search<br/>{<br/>  "query": {<br/>    "match_all": {}<br/>  }<br/>}</span></pre><p id="a707" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这个对弹性API的调用使用了<strong class="ir hi"> <em class="kj">搜索</em> </strong>方法，并简单地返回所有记录。如果一切顺利，我们将看到六次点击，记录返回为JSON:</p><figure class="kk kl km kn fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es la"><img src="../Images/9581eee6102338459a3d047e304e4b31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bwFDiFhKqhZjnL50h_8pVQ.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx">Search command in the left pane, results in the right-hand pane</figcaption></figure><p id="116c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">第二步——尝试一些搜索</strong></p><p id="d949" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">所以现在，让我们试着搜索几个人，我们会聪明一点，使用弹性的<strong class="ir hi"> <em class="kj">多重匹配</em> </strong>来搜索不止一个字段:无论是<strong class="ir hi">第一个</strong>还是<strong class="ir hi">中间的</strong>名字，只要有人叫“大卫”。默认情况下，搜索不区分大小写，以防您想知道…</p><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="d092" class="kt ku hh kp b fi kv kw l kx ky">GET ppl_idx/_search<br/>{<br/>  "query": {<br/>    "multi_match": {<br/>      "query": "david", <br/>      "fuzziness": "auto",<br/>      "fields": ["firstName","middleName^0.8"]<br/>    }<br/>  }<br/>}</span></pre><p id="cd79" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">此外，请注意“中间名”旁边的<strong class="ir hi"> ^0.8 </strong>，这是一个简单的<em class="kj">权重，而</em>意味着中间名的匹配只有名字匹配的80%重要。因此，在我们的结果中，名字搜索结果会出现在中间名之前。</p><p id="eaf5" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">模糊性</strong>也设置为自动-这使得弹性搜索可以执行模糊匹配，并可能捕捉到几乎匹配的搜索词，如打字错误。</p><p id="ddcd" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这种情况下，这将只返回一条记录-<em class="kj">大卫·丹尼斯·邓斯特布尔</em>，所有的D！</p><figure class="kk kl km kn fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lf"><img src="../Images/85763e7663556cef2e1477a693fa1338.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VthS_jhOWuZsL-s_CcCMig.png"/></div></div></figure><p id="7816" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">但是“迈克·戴夫·史密斯”增加了一张唱片；用户会期望搜索工具理解Dave和David是一回事，并在搜索结果中返回两个记录。</p><p id="db53" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">同义词上…</p><p id="8019" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">第3步-创建一个同义词csv并上传到弹性搜索</strong></p><p id="9ea1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">所以我们现在需要告诉弹性搜索关于名字的同义词，我们在索引中添加了以下可能有同义词的名字:</p><p id="37f9" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">迈克·戴夫·史密斯<br/>凡妮莎·琼斯<br/>文卡特什·拉杰德拉·库马尔<br/>大卫·丹尼斯·邓斯特布尔<br/>妮莎·克洛伊·怀特<br/>瑞秋·丽莎·托帕斯</p><p id="2134" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这里有几个同义词，例如“文卡特什”可以缩写为“文卡特”，凡妮莎和妮莎也是同义词。我们可以创建一个简单的文件来列出这些，并保存为csv文件；我会叫我的——<strong class="ir hi"><em class="kj">名字。csv </em> </strong></p><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="d412" class="kt ku hh kp b fi kv kw l kx ky">vanessa,nessa<br/>venkatesh,venkat<br/>rajendra,raj<br/>mike,michael,mick,micky<br/>david,dave<br/>rachel,rach<br/>dennis,den</span></pre><p id="8c24" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">请注意，一行中可以有任意多的同义词，例如“mike”有四个条目。</p><p id="9775" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在我们将csv文件上传到<strong class="ir hi">各</strong>弹性索引节点上的配置目录中:</p><figure class="kk kl km kn fd ii er es paragraph-image"><div class="er es lg"><img src="../Images/c49161bed44012c6ebd13dc5fc522173.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*DbkDtfiyJMk5UcdvOVB7Og.png"/></div><figcaption class="lb lc et er es ld le bd b be z dx">names.csv synonyms file in the elastic config directory</figcaption></figure><p id="75d8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在我们需要创建一个弹性搜索<strong class="ir hi">分析器</strong>来实现我们的同义词列表…</p><p id="123a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">什么是弹性研究分析仪？</strong></p><p id="5ca3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在高层次上，分析器控制弹性搜索对文档进行索引的方式。例如，您可以添加一个带有“<a class="ae ki" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-asciifolding-tokenfilter.html" rel="noopener ugc nofollow" target="_blank"> Ascii折叠</a>”<strong class="ir hi">令牌过滤器</strong>的分析器，它将把像“似曾相识”这样的重音字符转换成基本的拉丁Unicode字符——“似曾相识”</p><p id="9feb" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">因此，当您搜索时，您仍然可以匹配重音字符——请注意，分析器可以包含多个执行不同行为的字符和令牌过滤器。此<a class="ae ki" href="https://www.elastic.co/blog/found-text-analysis-part-1" rel="noopener ugc nofollow" target="_blank">弹力博客帖子</a>更详细。</p><p id="ac31" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">继续我们的例子…</p><p id="671f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤4 -创建弹性分析仪</strong></p><p id="b75d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们需要一个分析器来引用我们的同义词文件。以下对Elasticsearch的调用将一个名为<strong class="ir hi"> <em class="kj"> names_analyser </em> </strong>的新分析器添加到我们名为<strong class="ir hi"> <em class="kj"> ppl_idx </em> </strong>的索引中。</p><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="272e" class="kt ku hh kp b fi kv kw l kx ky">PUT /ppl_idx<br/>{<br/>  "settings": {<br/>    "analysis": {<br/>      "analyzer": {<br/>        "<strong class="kp hi">names_analyzer</strong>": {<br/>          "tokenizer": "standard",<br/>          "filter": [<br/>            "lowercase",<br/>            "names_synonyms"<br/>          ]<br/>        }<br/>      },<br/>      "filter": {<br/>        "names_synonyms": {<br/>          "type": "synonym",<br/>          "synonyms_path": "names.csv",<br/>          "updateable": true<br/>        }<br/>      }<br/>    }<br/>  }<br/>}</span></pre><p id="361e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">那么我们在这里做了什么？我们来分解一下…..</p><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="aebc" class="kt ku hh kp b fi kv kw l kx ky">PUT /ppl_idx</span></pre><p id="fe65" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">很简单，一个对http PUT方法的REST调用，有效载荷是下面的JSON文档…</p><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="462f" class="kt ku hh kp b fi kv kw l kx ky">"settings": {<br/>    "analysis": {<br/>      "analyzer": {</span></pre><p id="0749" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这些元素告诉Elastic我们想要对分析设置进行设置更改，特别是一个分析器…</p><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="fba2" class="kt ku hh kp b fi kv kw l kx ky">        "names_analyzer": {<br/>          "tokenizer": "standard",<br/>          "filter": [<br/>            "lowercase",<br/>            "names_synonyms"</span></pre><p id="372c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这里我们定义我们的分析器，我们给它一个名字:<strong class="ir hi"> <em class="kj"> names_analyzer </em> </strong></p><p id="23ee" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然后我们设置<strong class="ir hi">记号赋予器</strong>，它告诉Elastic如何将搜索文本分解成离散的部分(<strong class="ir hi">术语</strong>)，在我们的例子中，标准记号赋予器就可以了。点击查看更多关于记号赋予器<a class="ae ki" href="https://www.elastic.co/guide/en/elasticsearch/reference/current/analysis-tokenizers.html" rel="noopener ugc nofollow" target="_blank">的信息。</a></p><p id="b668" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">接下来，我们告诉分析器要使用的令牌过滤器，我们定义内置的<strong class="ir hi">小写</strong>过滤器来将所有搜索文本设置为小写——这是因为我们随后的同义词过滤器执行<strong class="ir hi">精确匹配，</strong>所以大小写很重要，因为<strong class="ir hi"> names.csv </strong>都是小写。</p><p id="e550" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然后，我们还指定了一个名为<strong class="ir hi"> names_synonyms，</strong>的令牌过滤器，接下来定义的是<strong class="ir hi"> </strong></p><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="866c" class="kt ku hh kp b fi kv kw l kx ky">"filter": {<br/>        "names_synonyms": {<br/>          "type": "synonym",<br/>          "synonyms_path": "names.csv",<br/>          "updateable": true</span></pre><p id="7fb0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">快到了！这是我们之前在分析器中引用的<strong class="ir hi"> names_synonyms </strong>过滤器。<strong class="ir hi"> Type </strong>告诉Elastic要执行的行为— <strong class="ir hi"> synonym </strong>，查找所有具有相同含义的单词(例如rachel，rach)并将所有单词添加到搜索中。</p><p id="ce0e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> synonyms_path </strong>告诉Elastic在检查同义词时在哪里找到要匹配的搜索词列表。</p><p id="03df" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">可更新</strong> —当设置为true时，这允许我们更新我们的同义词文件并重新加载分析器，而不需要使我们的索引离线。</p><p id="97f4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们现在准备尝试我们的同义词分析器…</p><p id="3094" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤5——在搜索中实现我们的同义词分析器</strong></p><p id="8113" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">对！所有的部分都准备好了，我们只需要对我们的搜索负载做一个小小的修改，通过添加<strong class="ir hi">“analyzer”:“names _ analyzer”</strong>到搜索中来实现我们的新分析器。</p><p id="9bc7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们会像文章开头一样搜索“大卫”,但希望这次我们会找到两个匹配项——同时添加“迈克·戴夫·史密斯”…</p><pre class="kk kl km kn fd ko kp kq kr aw ks bi"><span id="bbe8" class="kt ku hh kp b fi kv kw l kx ky">GET ppl_idx/_search<br/>{<br/>  "query": {<br/>    "multi_match": {<br/>      "query": "david", <br/>      "fuzziness": "auto",<br/>      "fields": ["firstName","middleName^0.8"],<br/>      <strong class="kp hi">"analyzer": "names_analyzer"</strong><br/>    }<br/>  }<br/>}</span></pre><figure class="kk kl km kn fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lh"><img src="../Images/ee46eae99522383424fc49c9624c3194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zbxLMfU7wrDozPSx55RSVg.png"/></div></div><figcaption class="lb lc et er es ld le bd b be z dx">Ta-Da! Two Hits, Two Dave’s</figcaption></figure><p id="c6f0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">运行该查询，我们现在得到两个匹配项，返回了David和Mike Dave，他们都有相同的最喜欢的颜色！谁知道呢？</p><p id="cba3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤5.1 —测试同义词</strong></p><p id="ba0f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">还有另一种快速测试新分析器的方法——<strong class="ir hi"><em class="kj">_ analyze</em></strong>方法。</p><p id="693e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">下面，我们可以通过输入“hello raj”作为测试文本，并告诉Elastic使用我们的新分析器进行分析，来测试raj同义词是否有效。然后我们可以看到Elastic如何分解搜索并处理令牌…</p><figure class="kk kl km kn fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es li"><img src="../Images/6c92e189a990da992fae1ae9dc49aa74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oD2q8JNvAe_omyo89cVJKw.png"/></div></div></figure><p id="2f7f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">结果标记显示了我们的搜索文本和同义词查找“rajendra”的两个字母数字标记，作为names.csv文件中的第三个标记。这三个都将在搜索中匹配。</p><p id="d947" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">结论</strong></p><p id="2441" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在这篇文章中，我们在Elasticsearch中创建了一个小型搜索索引，包含姓名和最喜欢的颜色的数据:-)</p><p id="ad8e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然后我们上传了一个名字的同义词查找文件&amp;将其添加到一个<strong class="ir hi">分析器</strong>中作为一个<strong class="ir hi">令牌过滤器</strong>。然后，我们将<strong class="ir hi">分析器</strong>添加到我们的<strong class="ir hi">索引</strong>中。</p><p id="ac0c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最后，我们修改了我们的搜索请求以使用这个分析器，结果不仅返回被搜索的名字，还返回该名字的任何同义词。所以搜索“David”也会返回任何叫“Dave”的人。</p><p id="7795" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">最终想法—偏差&amp;集群</strong></p><p id="e378" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">从来都不简单，是吗？</p><p id="5a8d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">同义词的查找文件在我们的搜索系统中很有可能存在偏见。仅限于西方姓名或女性姓名质量更高的查找文件可能会导致搜索偏向这些群体。</p><p id="63c3" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">另一种方法可能是考虑语音搜索，根据<em class="kj">发音</em>相似来匹配单词，这对于我们的“anne”对“ann”的例子来说应该很好，但是对于名字的缩写版本来说会有效吗？</p><p id="bf43" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Elasticsearch <a class="ae ki" href="https://www.elastic.co/guide/en/elasticsearch/plugins/current/analysis-phonetic.html" rel="noopener ugc nofollow" target="_blank">语音分析插件</a>实现了这一行为。如果我有机会尝试，我一定会写一篇关于我的发现的帖子。</p><p id="b511" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">此外，如果我们有一个多节点的Elasticsearch集群，我们需要在所有节点上保持同义词查找文件<strong class="ir hi">相同</strong>——任何差异都意味着相同的搜索每次都可能返回不同的结果！</p><p id="2099" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">最终，最终字</strong></p><p id="b543" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我并不自称是Elasticsearch方面的专家，但我努力寻找清晰的文档来让同义词发挥作用，这篇文章是我阅读的许多文档和文章的混合体。希望对少数人有帮助。</p><p id="8b91" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你确实找到了更好\更容易做到这一点的方法，请在下面留下评论，我很乐意了解更多。</p><figure class="kk kl km kn fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lj"><img src="../Images/112d1f5e8843eaff5604aed11cccff60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*akW9aXuh8bpftAqGQEzg0w.jpeg"/></div></div></figure><p id="d5df" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">关于作者:</strong></p><p id="b022" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Mike Knee是第1版的Azure数据开发人员。</p></div></div>    
</body>
</html>