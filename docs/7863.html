<html>
<head>
<title>Retail Graph — Walmart’s Product Knowledge Graph</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">零售图表——沃尔玛的产品知识图表</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/retail-graph-walmarts-product-knowledge-graph-6ef7357963bc?source=collection_archive---------0-----------------------#2020-03-13">https://medium.com/walmartglobaltech/retail-graph-walmarts-product-knowledge-graph-6ef7357963bc?source=collection_archive---------0-----------------------#2020-03-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/963ffcb94e68e5f805d156a5eb2cf761.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gYDpWO-DRDevmM-HPb_GEg.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Graph Data (Image credit actify)</figcaption></figure><h1 id="1413" class="it iu hh bd iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq bi translated"><strong class="ak">语境</strong></h1><p id="8e36" class="pw-post-body-paragraph jr js hh jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ha bi translated">电子商务目录是通过从卖家(3P)、供应商/品牌(1P)获取数据创建的。合作伙伴(卖家、供应商、品牌)提供的数据往往不完整，有时会遗漏客户正在寻找的关键信息。即使合作伙伴遵守规范(发送产品数据的约定格式)，标题、描述和图片中仍隐藏着大量数据。除了我们的合作伙伴提供的数据，互联网上还有大量的非结构化数据，如产品手册、产品评论、博客、社交媒体网站等。</p><p id="4d17" class="pw-post-body-paragraph jr js hh jt b ju kp jw jx jy kq ka kb kc kr ke kf kg ks ki kj kk kt km kn ko ha bi translated">在沃尔玛，我们正致力于构建一个<strong class="jt hi"> <em class="ku">零售图</em> </strong>，该图捕捉关于产品及其相关实体的知识，以帮助我们的客户更好地发现我们目录中的产品。这是一个产品知识图表，可以回答关于零售环境中的产品和相关知识的问题。这种系统可以用于支持语义搜索、推荐系统等。本文进一步阐述了什么是零售图，我们如何构建它，围绕图模型的技术选择，数据库和一些用例。</p><h1 id="53e1" class="it iu hh bd iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq bi translated"><strong class="ak">沃尔玛的<em class="kv">零售图</em> </strong>是什么</h1><p id="f872" class="pw-post-body-paragraph jr js hh jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ha bi translated">零售图捕捉零售世界中存在的产品和实体之间的联系。实体是存在的物体、事物、概念或抽象概念，例如客厅、野生动物摄影、明亮的颜色、返校、农舍风格。我们主要关注两种类型的实体——抽象的(主观的，比如对孩子友好的)和具体的(属性，比如红色)。前者帮助我们回答诸如“夏季泳池派对用品”、“农舍客厅家具”、“野生动物摄影镜头”等问题，而后者帮助我们回答诸如“蓝色牛仔裤”、“木制餐桌”等问题。该图还将产品之间的关系分为两大类——替代品和补充品(配件、兼容产品等)。它还试图将抽象的概念，如明亮的颜色，映射到具体的产品属性。</p><p id="9c83" class="pw-post-body-paragraph jr js hh jt b ju kp jw jx jy kq ka kb kc kr ke kf kg ks ki kj kk kt km kn ko ha bi translated">我们在沃尔玛目录上工作过，知道建立这样一个系统的一些挑战。最大的挑战是缺乏产品数据的单一权威来源。此外，我们的目录也有来自合作伙伴的错误数据。所以，我们从:</p><ul class=""><li id="a0a2" class="kw kx hh jt b ju kp jy kq kc ky kg kz kk la ko lb lc ld le bi translated">构建一个二分图，一边是产品，另一边是相关实体</li><li id="e121" class="kw kx hh jt b ju lf jy lg kc lh kg li kk lj ko lb lc ld le bi translated">利用我们现有的分类法，并随着我们发现新的分类法而丰富实体。</li><li id="8284" class="kw kx hh jt b ju lf jy lg kc lh kg li kk lj ko lb lc ld le bi translated">将产品(SKU)与实体联系起来。</li></ul><figure class="ll lm ln lo fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lk"><img src="../Images/629080bd4c11f0320173600cd7e77913.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k5nMIwgM1nzRX4xuh5ajfg.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Conceptual Representation Of Walmart Retail Graph (edge labels are in legends) — Figure 1</figcaption></figure><h1 id="b0d6" class="it iu hh bd iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq bi translated"><strong class="ak">构建零售图表</strong></h1><p id="35d8" class="pw-post-body-paragraph jr js hh jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ha bi translated">在高层次上，我们主要关注以下关系，以构建我们的零售图:<br/> 1。产品&lt; - &gt;实体<br/> 2。产品&lt; - &gt;产品(广义分类为替代品&amp;补品)</p><ol class=""><li id="f3e0" class="kw kx hh jt b ju kp jy kq kc ky kg kz kk la ko lp lc ld le bi translated"><strong class="jt hi">产品&lt; - &gt;实体<br/> </strong>为了构建产品到实体图，我们首先从产品内容中提取实体，然后将它们链接到抽象或具体的概念，形成三元组。我们添加了一个治理层，允许人们验证低于某个置信水平的三元组，以保持高质量。</li></ol><figure class="ll lm ln lo fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lq"><img src="../Images/274691915868fc2445cec8f6dac69091.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DAXMghHbJxxJ8a1evlCyOA.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx"><strong class="bd iv">Process to build Product &lt;-&gt; Entity Graph — Figure 2</strong></figcaption></figure><p id="59c3" class="pw-post-body-paragraph jr js hh jt b ju kp jw jx jy kq ka kb kc kr ke kf kg ks ki kj kk kt km kn ko ha bi translated"><strong class="jt hi"> a .实体提取</strong></p><p id="3197" class="pw-post-body-paragraph jr js hh jt b ju kp jw jx jy kq ka kb kc kr ke kf kg ks ki kj kk kt km kn ko ha bi translated">实体提取模块的目标是从产品标题和描述中提取“实体”。产品描述内容各种口味都有。有时内容冗长，有时可能是要点中的小短语。牢记这一点，我们开发了两种算法来从产品内容中提取实体:</p><p id="9ad4" class="pw-post-body-paragraph jr js hh jt b ju kp jw jx jy kq ka kb kc kr ke kf kg ks ki kj kk kt km kn ko ha bi translated"><strong class="jt hi"> i .基于NLP的模型</strong> <br/>我们首先从产品标题、描述和其他元数据中提取实体。这是通过构建一个语言模型来实现的，该模型利用了由Standford Core NLP提供的POS Tagger。这种模式更适合我们的用例，因为产品标题和描述通常以要点形式出现，突出产品亮点，而不是结构良好的句子。下面是我们基于NLP的模型的输出示例。</p><figure class="ll lm ln lo fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ls"><img src="../Images/ca487f4eb5deaa3b5d36ce3373e695b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ibts42CRV0sxhpiR4jbvvQ.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Entity Extraction Output From NLP Model — Figure 3</figcaption></figure><p id="250b" class="pw-post-body-paragraph jr js hh jt b ju kp jw jx jy kq ka kb kc kr ke kf kg ks ki kj kk kt km kn ko ha bi translated"><strong class="jt hi">二。启发式模型<br/> </strong>我们采用的另一种方法产生了良好的结果，那就是使用规则来解析描述。卖家/供应商使用特定的格式(HTML标签)来突出产品的关键特征。我们围绕如何解析和提取关键信息建立了规则，对它们应用了一组试探法。以下是产品描述及其输出的示例:</p><figure class="ll lm ln lo fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lt"><img src="../Images/c2f57a7d9f8da02efc55e9c8accdd4d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RQbBCqe6_f3zoD8zInIYLQ.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Entity Extraction Output From Heuristic Model — Figure 4</figcaption></figure><p id="ac1b" class="pw-post-body-paragraph jr js hh jt b ju kp jw jx jy kq ka kb kc kr ke kf kg ks ki kj kk kt km kn ko ha bi translated">在生产中，我们使用上述两种模型。这给了我们一个在启发式模型和NLP模型之间的很好的平衡，启发式模型非常精确，NLP模型给了我们很好的覆盖率。</p><p id="71b0" class="pw-post-body-paragraph jr js hh jt b ju kp jw jx jy kq ka kb kc kr ke kf kg ks ki kj kk kt km kn ko ha bi translated"><strong class="jt hi"> b .实体链接</strong></p><p id="7813" class="pw-post-body-paragraph jr js hh jt b ju kp jw jx jy kq ka kb kc kr ke kf kg ks ki kj kk kt km kn ko ha bi translated">一旦实体被提取出来，我们需要确定它们代表什么以及它们与产品的关系(SKU)。例如，对于像“中世纪沙发”这样的实体，我们必须确定在沙发的上下文中中世纪代表什么。这是通过称为实体链接的过程来实现的，在该过程中，我们试图找到所提取的实体与其SKU之间的关系。实体链接模块的另一个重要功能是消除给定上下文的歧义。例如,“樱桃”在蜡烛的上下文中可以表示气味，在果汁的上下文中可以表示味道，在家具的上下文中可以表示光洁度，在布料的上下文中可以表示颜色，在杂货店的上下文中可以表示水果。这里所指的上下文通常是产品类别或产品类型。链接者将上下文(产品类型)和实体作为输入，产生一个三元组(主语-宾语-谓语)。由于产品数据没有单一准确的真实来源，将实体联系起来的任务变得很困难。我们首先从一组最畅销的SKU(假设最畅销的SKU有更准确的数据)创建一个产品类型、属性名称和属性值三元组的字典。第一步是使用这个字典，并确定可能的候选不可知的上下文。之后，第二个模型运行，通过使用上下文对它们进行排序。</p><p id="7ca7" class="pw-post-body-paragraph jr js hh jt b ju kp jw jx jy kq ka kb kc kr ke kf kg ks ki kj kk kt km kn ko ha bi translated">对于上面提取的实体，链接器输出如下所示:</p><figure class="ll lm ln lo fd ii er es paragraph-image"><div class="er es lu"><img src="../Images/1c5f469ca3bd2d0dea91944080e0414c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*ATvfaHXN1gnoP_O_2-BsFQ.png"/></div><figcaption class="ip iq et er es ir is bd b be z dx">Triples from entity linking — Figure 5</figcaption></figure><p id="edd6" class="pw-post-body-paragraph jr js hh jt b ju kp jw jx jy kq ka kb kc kr ke kf kg ks ki kj kk kt km kn ko ha bi translated"><strong class="jt hi"> c .实体治理<br/> </strong>作为实体提取的一部分，大量的“噪音”也被提取出来。我们已经使用现有的产品元数据来构建字典，该字典用作将提取的实体分类为噪声或“未知”概念的参考。然后，我们添加了一个治理模块，它可以使用启发式和手动标记的组合来清除噪音。这确保了进入知识图的数据总是干净和可靠的。</p><p id="3618" class="pw-post-body-paragraph jr js hh jt b ju kp jw jx jy kq ka kb kc kr ke kf kg ks ki kj kk kt km kn ko ha bi translated"><strong class="jt hi"> 2。产品&lt; - &gt;产品<br/> </strong>为了识别给定SKU的替代品，我们利用文本数据和图像数据。在某些产品类别中，如家具、服装，视觉相似性在确定替代品时起着重要作用。我们为我们的SKU构建了图像嵌入和文本嵌入，并将它们推送到<a class="ae lr" href="https://github.com/facebookresearch/faiss" rel="noopener ugc nofollow" target="_blank"> FAISS </a>索引中。(Faiss是一个由脸书开发的用于高效相似性搜索和密集向量聚类的库)。对于每个SKU，我们从文本嵌入和图像嵌入中生成其KNN(k-最近邻),以得到候选集。在那之后，我们应用一个特定类别的排序逻辑来得到最终的集合。例如，在家具类别的情况下，“家居装饰风格”(世纪中期/沿海/农舍)在确定可替代性方面起着关键作用，并且它会使排名逻辑产生偏差。</p><h1 id="0af2" class="it iu hh bd iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq bi translated">体系结构</h1><p id="5635" class="pw-post-body-paragraph jr js hh jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ha bi translated">当我们开始构建零售图的旅程时，我们并不确定系统的最终状态会是什么样子。我们只知道我们需要一个组件来提取实体，链接它们，然后存储它们。鉴于我们目录的规模，我们知道每个目录都必须扩展到数以亿计的产品。此外，还需要快速试验、构建概念验证并快速迭代以获得反馈。我们决定采用<a class="ae lr" href="https://evolutionaryarchitecture.com/" rel="noopener ugc nofollow" target="_blank">进化架构</a>原则来构建我们的系统。</p><blockquote class="lv"><p id="a250" class="lw lx hh bd ly lz ma mb mc md me ko dx translated">一个进化的架构支持渐进的、被引导的变化，作为跨越多个维度的首要原则。</p></blockquote><p id="5dc3" class="pw-post-body-paragraph jr js hh jt b ju mf jw jx jy mg ka kb kc mh ke kf kg mi ki kj kk mj km kn ko ha bi translated">实体提取和链接构建为简单的库，然后作为REST API公开，供其他系统集成。我们还在实体提取和实体链接器库的基础上构建了Hive UDFs，以便在本地Hadoop集群上大规模运行它们。</p><h2 id="31e3" class="mk iu hh bd iv ml mm mn iz mo mp mq jd kc mr ms jh kg mt mu jl kk mv mw jp mx bi translated"><strong class="ak">数据处理管道</strong></h2><p id="fffa" class="pw-post-body-paragraph jr js hh jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ha bi translated">我们有两条管道——一条用于生成产品实体，另一条用于产品产品。它们在由我们的数据平台团队管理的本地Hadoop集群上定期运行。一旦流程完成，我们利用批量摄取API将它们摄取到Azure上的Cosmos DB中。以下是数据处理管道的高度概述:</p><figure class="ll lm ln lo fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es my"><img src="../Images/b151adfc54f3045d2c99c68d668d7c45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3IUKsFMbpjEbPZtQZIZ76w.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Product &lt;-&gt; Entity Pipeline — Figure 6 (Graph Image credit actify)</figcaption></figure><figure class="ll lm ln lo fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mz"><img src="../Images/accb964adcdd490d0e1899a03bd6e334.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tIi6nBF93LSJqXX4P4uwvQ.png"/></div></div><figcaption class="ip iq et er es ir is bd b be z dx">Product &lt;-&gt; Product Substitute Generation — Figure 7</figcaption></figure><h2 id="c431" class="mk iu hh bd iv ml mm mn iz mo mp mq jd kc mr ms jh kg mt mu jl kk mv mw jp mx bi translated">图形数据模型和图形数据库</h2><p id="886d" class="pw-post-body-paragraph jr js hh jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ha bi translated">在集中讨论LPG之前，我们已经针对我们的读写用例评估了LPG(标签属性图)和RDF(资源描述框架)图形数据模型。<a class="ae lr" href="https://tech.flipkart.com/flipkart-commerce-graph-evaluation-of-graph-data-stores-8fe0f964affd" rel="noopener ugc nofollow" target="_blank">这是两者之间的一个很好的对比。在内部对图形数据库进行了几次实验后，我们缩小了范围，选择了</a><a class="ae lr" href="https://docs.microsoft.com/en-us/azure/cosmos-db/graph-modeling" rel="noopener ugc nofollow" target="_blank"> Azure Cosmos DB(图形模型)</a>。我们与Azure团队紧密合作，为我们提供了对批量数据摄取的Java支持。对于图形遍历，我们使用<a class="ae lr" href="https://tinkerpop.apache.org/gremlin.html" rel="noopener ugc nofollow" target="_blank"> gremlin </a>。</p><h2 id="2ca7" class="mk iu hh bd iv ml mm mn iz mo mp mq jd kc mr ms jh kg mt mu jl kk mv mw jp mx bi translated"><strong class="ak">沃尔玛内部的应用</strong></h2><p id="7476" class="pw-post-body-paragraph jr js hh jt b ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko ha bi translated">构建沃尔玛目录规模的产品知识图需要相当长的时间。我们已经采取了一次一个类别的方法，在建立这一点时，学习，然后扩展到其他类别。我们通过专注于家居和花园类别开始了这项工作。我们在沃尔玛产品页面上做了一个A/B测试，与我们的商品推荐团队合作，使用了产品产品关系。<br/>我们的电子商务语义搜索团队正与我们紧密合作，利用零售图中的关系构建一个新的查询理解系统。我们目前正在进行交叉测试，A/B测试，以收集客户对我们新的语义搜索实现的反馈。</p><p id="7084" class="pw-post-body-paragraph jr js hh jt b ju kp jw jx jy kq ka kb kc kr ke kf kg ks ki kj kk kt km kn ko ha bi translated"><strong class="jt hi">闭幕词</strong></p><p id="5049" class="pw-post-body-paragraph jr js hh jt b ju kp jw jx jy kq ka kb kc kr ke kf kg ks ki kj kk kt km kn ko ha bi translated">很难在一篇文章中详细介绍零售图表的所有方面，但我希望这能提供一个体面的概述。我们只是触及了这个问题的表面，还有很长的路要走。像这样的计划需要快速的迭代、大量的实验以及在找到正确的方法之前愿意从错误中学习。我很幸运有一个伟大的工程师和数据科学家团队来合作这个有趣的项目！</p></div></div>    
</body>
</html>