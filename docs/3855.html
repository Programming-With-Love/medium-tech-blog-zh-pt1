<html>
<head>
<title>Secure Microservices Configuration Properties via HashiCorp Vault</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">通过HashiCorp Vault保护微服务配置属性</h1>
<blockquote>原文：<a href="https://medium.com/globant/secure-microservices-configuration-properties-via-hashicorp-vault-b6db753063e?source=collection_archive---------1-----------------------#2022-04-11">https://medium.com/globant/secure-microservices-configuration-properties-via-hashicorp-vault-b6db753063e?source=collection_archive---------1-----------------------#2022-04-11</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/a8ae74b6f1e2587cbe929b2d01328762.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1i9Xt_cI4KqYwjs8PNAzkQ.png"/></div></div></figure><h1 id="d2de" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated"><strong class="ak">什么是跳马？</strong></h1><p id="803f" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">HashiCorp Vault是一个平台，用于保护、存储和严格控制对令牌、密码、证书和加密密钥的访问，以保护动态基础架构中的敏感数据和其他机密。使用vault，我们可以从vault键/值存储、数据库等中检索凭证。以安全的方式。保险库，总的来说解决了软件开发中如何管理机密的安全问题。</p><p id="d9f5" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">它是存储应用程序所需的最敏感和最机密的属性的中心位置。它提供加密，以更安全的方式存储这些秘密。我们还可以为Vault服务器提供各种访问控制机制。为了确保任何可疑的活动和任何未经授权的用户试图访问这些秘密，Vault提供了审计跟踪日志，以便我们可以很容易地确定谁试图访问这些文件。Vault还提供了最重要的功能，即在特定时间段后对机密进行动态滚动。</p><p id="09d7" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">现代系统需要访问大量秘密:数据库凭证、外部服务的API密钥、面向服务架构通信的凭证等。了解谁在访问什么秘密已经非常困难，并且是特定于平台的。如果没有定制的解决方案，添加密钥滚动、安全存储和详细的审计日志几乎是不可能的。这就是Vault介入的地方。</p><h1 id="6f68" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">如何设置Vault服务器？</h1><p id="885b" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">在下面的步骤中，我们将介绍Windows操作系统的安装步骤。</p><p id="4e2c" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">1)从https://www.vaultproject.io/downloads<a class="ae kq" href="https://www.vaultproject.io/downloads" rel="noopener ugc nofollow" target="_blank">下载zip文件</a></p><p id="20b9" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">2)将其解压缩，并将目录路径保存在环境变量中</p><p id="6457" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">3)在环境变量中或通过命令在命令提示符下设置VAULT _ ADDR = ' http://127 . 0 . 0 . 1:8200 '</p><ul class=""><li id="3d46" class="kr ks hh jp b jq kl ju km jy kt kc ku kg kv kk kw kx ky kz bi translated">export VAULT _ ADDR = ' http://127 . 0 . 0 . 1:8200 '</li></ul><p id="4f11" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">4)启动Vault服务器有两种方式</p><p id="b7ae" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">a)在开发模式下，我们可以手动传递将进一步用于客户端身份验证的根令牌</p><ul class=""><li id="11cc" class="kr ks hh jp b jq kl ju km jy kt kc ku kg kv kk kw kx ky kz bi translated">vault服务器—dev—dev-root-token-id = " 00000000–0000–0000–0000–000000000 "</li></ul><p id="9605" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">b)使用基于文件的模式(用于生产和其他环境)</p><ul class=""><li id="0185" class="kr ks hh jp b jq kl ju km jy kt kc ku kg kv kk kw kx ky kz bi translated">创造。包含以下内容的存储库配置的hcl配置文件</li></ul></div><div class="ab cl la lb go lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ha hb hc hd he"><figure class="li lj lk ll fd ii er es paragraph-image"><div class="er es lh"><img src="../Images/2ab9199fbb3792bb279ee5f4b0d52565.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*Eh5hXpGpjTq3laILop8yeQ.png"/></div><figcaption class="lm ln et er es lo lp bd b be z dx"><strong class="bd ir">vaultconfig.hcl</strong></figcaption></figure></div><div class="ab cl la lb go lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ha hb hc hd he"><p id="d40b" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">然后使用该文件启动vault服务器</p><ul class=""><li id="5c7b" class="kr ks hh jp b jq kl ju km jy kt kc ku kg kv kk kw kx ky kz bi translated">vault server-config = vault config . HCl</li></ul><p id="8a7c" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">启动Vault服务器后，我们将对其进行初始化。在初始化期间，生成加密密钥，创建解封密钥，并创建初始根令牌。</p><ul class=""><li id="3b26" class="kr ks hh jp b jq kl ju km jy kt kc ku kg kv kk kw kx ky kz bi translated">保险库操作员初始化</li></ul><p id="84d3" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">初始化后，我们将获得解封密钥和一个用于vault服务器的令牌，我们可以用它来解封vault，该令牌将用于登录Vault服务器。请记住，启动后我们至少需要3个密钥来解封保险库，所以请确保我们将这3个密钥保存在安全的地方，因为没有这个保险库将无法解密秘密。</p><ul class=""><li id="977a" class="kr ks hh jp b jq kl ju km jy kt kc ku kg kv kk kw kx ky kz bi translated">保险库操作员解封</li></ul><p id="31ae" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">5)通过令牌登录到vault服务器</p><ul class=""><li id="83a2" class="kr ks hh jp b jq kl ju km jy kt kc ku kg kv kk kw kx ky kz bi translated">保险库登录<token/></li></ul><p id="ab2c" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">6)一旦我们登录，我们可以启用秘密引擎以键值方法存储秘密数据</p><ul class=""><li id="295d" class="kr ks hh jp b jq kl ju km jy kt kc ku kg kv kk kw kx ky kz bi translated">启用存储库机密-版本= 1-路径=机密kv</li></ul><p id="328d" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">7)完成所有工作后，我们现在可以为各个应用程序将机密放入保险库中</p><ul class=""><li id="394b" class="kr ks hh jp b jq kl ju km jy kt kc ku kg kv kk kw kx ky kz bi translated"><application-name>/【T2金库千伏放秘】= <vaule/></application-name></li></ul><h1 id="3078" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">HashiCorp的Vault支持多少集成选项？</h1><p id="24b8" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">1) Linux Shell集成</p><p id="0ee9" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">2) Java Spring Boot应用集成</p><p id="915c" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">3) Python</p><p id="6eb5" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">4)节点。射流研究…</p><p id="1da7" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">5)可行的自动化</p><p id="b11a" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">在本教程中，我们将介绍微服务的Spring Boot集成选项，并了解Spring cloud如何为HashiCorp的Vault提供集成支持。</p><figure class="li lj lk ll fd ii er es paragraph-image"><div class="er es lq"><img src="../Images/3cb6302cdb53064ad60512a7bd664cc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1242/format:webp/1*FthyncZhV1hnsmwnsoYqWg.png"/></div><figcaption class="lm ln et er es lo lp bd b be z dx"><strong class="bd ir">Vault Integration In Microservices</strong></figcaption></figure><h1 id="51cc" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">什么是跳马？</h1><p id="4087" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">Spring cloud vault为HashiCorp的vault提供了Spring抽象。它提供了与Vault集成的依赖关系，并允许用户与Vault服务器交互，以访问数据库用户名和密码、api令牌、加密代码等秘密。Spring框架在spring-vault-core包中提供了库依赖，因此我们可以将它集成到任何Spring boot应用程序构建文件中，如下所示</p><p id="2957" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><strong class="jp hi">美芬</strong>—</p><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lr"><img src="../Images/3447d8052a4f672c4a06c39503626e00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_TBF_jdZUgyoOI2Rcj_pSQ.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx"><strong class="bd ir">pom.xml</strong></figcaption></figure><p id="08b5" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated"><strong class="jp hi">梯度</strong></p><figure class="li lj lk ll fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ls"><img src="../Images/0ad38a36a7a222236af8772922381462.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QMDuMMV3Wlwg7HDBYMEH0w.png"/></div></div><figcaption class="lm ln et er es lo lp bd b be z dx"><strong class="bd ir">build.gradle</strong></figcaption></figure><h1 id="abc7" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">Spring Boot微服务的保险库集成</h1><p id="8383" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">在微服务架构中，我们已经有了Spring cloud的一部分，称为中央配置服务器，用于外部化和集中微服务的配置相关属性。有两个选项本地位置和git存储库，我们可以在其中保存我们的配置属性。除此之外，我们还可以选择另一个Vault服务器，在Vault中存储我们的机密和敏感属性，使数据库凭据、Api令牌和加密代码更加安全。</p><p id="20fe" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">Spring cloud config已经包含了Spring vault core的依赖项，所以我们不需要在中央配置服务器构建文件中添加任何额外的东西。</p><p id="e29f" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">我们需要在中央配置application.yml文件中添加Vault的配置，该文件将用于连接Vault服务器，并通过向其传递令牌来获取属性。</p></div><div class="ab cl la lb go lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ha hb hc hd he"><figure class="li lj lk ll fd ii er es paragraph-image"><div class="er es lt"><img src="../Images/a06dfbe9417535bd246d46678e17b393.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/format:webp/1*Ae-ikmVFJPABsSRELEwUJg.png"/></div><figcaption class="lm ln et er es lo lp bd b be z dx"><strong class="bd ir">application.yml</strong></figcaption></figure></div><div class="ab cl la lb go lc" role="separator"><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf lg"/><span class="ld bw bk le lf"/></div><div class="ha hb hc hd he"><p id="cac5" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">让我们通过一个HTTP请求来测试我们的配置服务器，以获取秘密属性。你可以使用CURL，或者像POSTMAN这样的REST客户端工具。</p><p id="c816" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">$ curl-X " GET " " http://localhost:8888/myapp/default "-H " X-Config-Token:your Token "</p><p id="3308" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">这将返回如下所示的响应:</p><figure class="li lj lk ll fd ii er es paragraph-image"><div class="er es lu"><img src="../Images/433bcb9b0777879d7b3391f0b67c25cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*gdMbuH92diS-cDQ2HJ0tcQ.png"/></div></figure><p id="bd29" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">在上面的json响应中，我们可以看到第一个属性源，它是存储在Vault中的机密的Vault服务器。</p><p id="f8e2" class="pw-post-body-paragraph jn jo hh jp b jq kl js jt ju km jw jx jy kn ka kb kc ko ke kf kg kp ki kj kk ha bi translated">现在，当我们启动客户端微服务时，它首先会向中央配置服务器询问配置属性，然后中央配置服务器会通过传递令牌密钥进行身份验证，向Vault询问数据库凭据或任何其他机密配置属性。一旦请求被完全认证，秘密就通过中央配置服务器被提供给相应的微服务。</p><h1 id="291a" class="ip iq hh bd ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm bi translated">结论</h1><p id="7978" class="pw-post-body-paragraph jn jo hh jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ha bi translated">本教程向您展示了如何在Spring cloud vault中保存您的秘密配置。使用Spring Cloud Config，您可以做更多的事情，例如加密您存储的值，并将其与Spring Vault配合使用，以将您的秘密存储在更安全的位置。</p></div></div>    
</body>
</html>