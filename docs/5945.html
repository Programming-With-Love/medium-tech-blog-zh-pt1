<html>
<head>
<title/>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1/>
<blockquote>原文：<a href="https://medium.com/oracledevs/ingest-json-files-in-oci-nosql-created-in-oci-compartment-dc35b30771cf?source=collection_archive---------8-----------------------#2022-07-25">https://medium.com/oracledevs/ingest-json-files-in-oci-nosql-created-in-oci-compartment-dc35b30771cf?source=collection_archive---------8-----------------------#2022-07-25</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><h2 id="4636" class="hf hg hh bd hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id bi translated">摄取OCI NoSQL在OCI车厢中创建的JSON文件</h2><figure class="if ig ih ii fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ie"><img src="../Images/0cef43b1016ee3fc3b4f98ad6de28dc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dk4cWaalVYDSpueoB-YEaQ.png"/></div></div></figure><p id="5887" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated"><strong class="is jl">简介</strong></p><p id="6c7e" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated">为了提供独特的客户体验，许多现代应用程序需要低延迟和接收大量数据的能力。同时，应用程序需要保持高可用性和零容错。</p><p id="8b9e" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated">由于上述需求，Oracle NoSQL数据库云服务(一种完全托管的数据库服务)在现代应用程序中越来越受欢迎。它为开发人员提供了一种使用文档、列和键值数据库模型构建应用程序的方法，通过数据复制提供了可预测的个位数毫秒级响应时间，从而实现了高可用性。该服务提供ACID事务、无服务器扩展、全面的安全性以及针对按需和调配容量模式的低按使用付费价格。</p><p id="7025" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated">在这篇文章中，我想讨论如何摄取OCI NoSQL表中的多个JSON文件。这可以通过使用各种SDK来实现。在这种情况下，我想讨论如何在一个使用<strong class="is jl"> python SDK </strong>在OCI区间中创建的表中实现这一点。</p><p id="30a8" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated"><strong class="is jl">先决条件</strong>:要做这个练习，你需要有一个OCI云自由层账户，可在这里:<a class="ae jm" href="https://signup.cloud.oracle.com/?language=en&amp;sourceType=:ex:tb:::::&amp;SC=:ex:tb:::::&amp;pcode=" rel="noopener ugc nofollow" target="_blank"> OCI云自由层</a>。</p><p id="53e1" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated">我们可以分三步完成:</p><p id="dd1f" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated"><strong class="is jl"> <em class="jn">步骤#1:创建环境</em> </strong> <br/> A .创建一个OCI区间。如果你不熟悉OCI隔间，请参考<a class="ae jm" href="https://www.youtube.com/watch?v=lqwchN7uH7g" rel="noopener ugc nofollow" target="_blank">如何在OCI创建隔间— YouTube </a>。</p><p id="f690" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated">B.创建OCI计算机。有关更多详细信息，请参考<a class="ae jm" href="https://www.youtube.com/watch?v=tlwlLd4GvCc" rel="noopener ugc nofollow" target="_blank">在Oracle云基础设施上创建Linux实例</a>。</p><p id="cc4f" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated">C.在OCI计算机中安装Python。</p><pre class="if ig ih ii fd jo jp jq jr aw js bi"><span id="0777" class="hf hg hh jp b fi jt ju l jv jw">    sudo yum install -y python3</span></pre><p id="202c" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated"><em class="jn">或者，也可以从本地机器调用python。</em></p><p id="6d9e" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated">D.配置OCICLI。请参考<a class="ae jm" href="https://docs.oracle.com/en-us/iaas/Content/API/SDKDocs/cliinstall.htm" rel="noopener ugc nofollow" target="_blank">快速入门</a>。</p><p id="8167" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated"><strong class="is jl"> <em class="jn">第二步:准备数据</em> </strong></p><p id="dab2" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated">对于我们的演示，我们已经创建了2个样本JSON文件。</p><p id="84e6" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated">A.JSON文件是使用vi编辑器在OCI compute<em class="jn">/home/OPC/sample</em>路径下创建的。</p><p id="64a3" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated">第一个JSON文件:/home/OPC/sample/bakery product _ 01 . JSON</p><pre class="if ig ih ii fd jo jp jq jr aw js bi"><span id="24ea" class="hf hg hh jp b fi jt ju l jv jw">{<br/>  "id": "0001",<br/>  "type": "donut",<br/>  "name": "Cake",<br/>  "ppu": 0.55,<br/>  "batters":<br/>   {<br/>    "batter":<br/>     [<br/>      { "id": "1001", "type": "Regular" },<br/>      { "id": "1002", "type": "Chocolate" },<br/>      { "id": "1003", "type": "Blueberry" },<br/>      { "id": "1004", "type": "Strawberry" }<br/>     ]<br/>   ,<br/>  "topping":<br/>    [<br/>     { "id": "5001", "type": "None" },<br/>     { "id": "5002", "type": "Glazed" },<br/>     { "id": "5005", "type": "Sugar" },<br/>     { "id": "5007", "type": "Powdered Sugar" },<br/>     { "id": "5006", "type": "Chocolate with Sprinkles" },<br/>     { "id": "5003", "type": "Chocolate" },<br/>     { "id": "5004", "type": "Maple" }<br/>       ]<br/>   }<br/> }</span></pre><p id="41ae" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated">第二个JSON文件:/home/OPC/sample/bakery product _ 02 . JSON</p><pre class="if ig ih ii fd jo jp jq jr aw js bi"><span id="52aa" class="hf hg hh jp b fi jt ju l jv jw">{<br/>  "id": "0002",<br/>  "type": "donut",<br/>  "name": "Raised",<br/>  "ppu": 0.55,<br/>  "batters":<br/>   {<br/>    "batter":<br/>     [<br/>      { "id": "1001", "type": "Regular" }<br/>     ]<br/>   ,<br/>  "topping":<br/>    [<br/>     { "id": "5001", "type": "None" },<br/>     { "id": "5002", "type": "Glazed" },<br/>     { "id": "5005", "type": "Sugar" },<br/>     { "id": "5003", "type": "Chocolate" },<br/>     { "id": "5004", "type": "Maple" }<br/>    ]<br/>   }<br/>}</span></pre><p id="96f7" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated"><strong class="is jl"> <em class="jn">第三步:加载数据</em> </strong></p><p id="1151" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated">A.收集OCI区间信息:需要收集我们想要创建表的区间的OCID。</p><p id="d43c" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated">登录OCI云门户并导航至隔离舱:</p><figure class="if ig ih ii fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jx"><img src="../Images/21005b94d0ce186adeab5e38fc9b84f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gYrRA-Ip9ARoyJesQI7OPg.png"/></div></div></figure><figure class="if ig ih ii fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es jy"><img src="../Images/8fe4ea684e4e10c2133471884dc3d637.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EVXywdez9fVM3rvheXNKBQ.png"/></div></div></figure><p id="c056" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated">B.创建一个名为loadjsondata.py的python文件来创建表和加载数据。这部分代码将用于连接隔离舱。</p><pre class="if ig ih ii fd jo jp jq jr aw js bi"><span id="8584" class="hf hg hh jp b fi jt ju l jv jw">import sys<br/>import os<br/>import json<br/>import glob</span><span id="8430" class="hf hg hh jp b fi jz ju l jv jw">from borneo import (<br/>    AuthorizationProvider, DeleteRequest, GetRequest,<br/>    IllegalArgumentException, NoSQLHandle, NoSQLHandleConfig, PutRequest,<br/>    QueryRequest, Regions, TableLimits, TableRequest)<br/>from borneo.iam import SignatureProvider<br/>from borneo.kv import StoreAccessTokenProvider<br/>from oci.config import from_file</span><span id="1781" class="hf hg hh jp b fi jz ju l jv jw">#<br/># EDIT: these values based on desired region and/or endpoint for a local<br/># server<br/>#<br/>cloud_region = None</span><span id="a815" class="hf hg hh jp b fi jz ju l jv jw"># Cloud Service Only<br/>#<br/># EDIT: set these variables to the credentials to use if you are not using<br/># a configuration file in ~/.oci/config<br/># Use of these credentials vs a file is determined by a value of tenancy<br/># other than None.<br/>#<br/>tenancy = None  # tenancy'd OCID (string)<br/>user = None  # user's OCID (string)<br/>private_key = 'path-to-private-key-or-private-key-content'<br/>fingerprint = 'fingerprint for uploaded public key'<br/># pass phrase (string) for private key, or None if not set<br/>pass_phrase = None</span><span id="53a4" class="hf hg hh jp b fi jz ju l jv jw">class CloudsimAuthorizationProvider(AuthorizationProvider):<br/>    """<br/>    Cloud Simulator Only.</span><span id="cd1f" class="hf hg hh jp b fi jz ju l jv jw">This class is used as an AuthorizationProvider when using the Cloud<br/>    Simulator, which has no security configuration. It accepts a string<br/>    tenant_id that is used as a simple namespace for tables.<br/>    """</span><span id="c389" class="hf hg hh jp b fi jz ju l jv jw">def __init__(self, tenant_id):<br/>        super(CloudsimAuthorizationProvider, self).__init__()<br/>        self._tenant_id = tenant_id</span><span id="c208" class="hf hg hh jp b fi jz ju l jv jw">def close(self):<br/>        pass</span><span id="3824" class="hf hg hh jp b fi jz ju l jv jw">def get_authorization_string(self, request=None):<br/>        return 'Bearer ' + self._tenant_id</span><span id="3c15" class="hf hg hh jp b fi jz ju l jv jw">def get_handle(nosql_env, nosql_compartment):<br/>    """<br/>    Returns a NoSQLHandle based on the requested environment. The<br/>    differences among the supported environments are encapsulated in this<br/>    method.<br/>    """<br/>    if nosql_env == 'cloud':<br/>        endpoint = cloud_region<br/>        #<br/>        # Get credentials using SignatureProvider. SignatureProvider has<br/>        # several ways to accept credentials. See the documentation:<br/>        #  <a class="ae jm" href="https://nosql-python-sdk.readthedocs.io/en/stable/api/borneo.iam.SignatureProvider.html" rel="noopener ugc nofollow" target="_blank">https://nosql-python-sdk.readthedocs.io/en/stable/api/borneo.iam.SignatureProvider.html</a><br/>        #<br/>        if tenancy is not None:<br/>            print('Using directly provided credentials')<br/>            #<br/>            # Credentials are provided directly<br/>            #<br/>            provider = SignatureProvider(tenant_id=tenancy,<br/>                                         user_id=user,<br/>                                         fingerprint=fingerprint,<br/>                                         private_key=private_key,<br/>                                         pass_phrase=pass_phrase)<br/>        else:<br/>            #<br/>            # Credentials will come from a file.<br/>            #<br/>            # By default the file is ~/.oci/config. A config_file = &lt;path&gt;<br/>            # argument can be passed to specify a different file.<br/>            #<br/>            print('Using credentials and DEFAULT profile from ' +<br/>                  '~/.oci/config')<br/>            provider = SignatureProvider()<br/>            oci_config = from_file()</span><span id="66ca" class="hf hg hh jp b fi jz ju l jv jw">endpoint= eval('Regions.'+str.upper(oci_config.get('region')).replace('-','_'))</span><span id="9b59" class="hf hg hh jp b fi jz ju l jv jw">else:<br/>        raise IllegalArgumentException('Unknown environment: ' + nosql_env)</span><span id="1f9c" class="hf hg hh jp b fi jz ju l jv jw">return NoSQLHandle(NoSQLHandleConfig(endpoint, provider).set_default_compartment(nosql_compartment))<br/>def main():</span><span id="a437" class="hf hg hh jp b fi jz ju l jv jw">table_name = 'Bakeryproduct'<br/>    data=''</span><span id="7c55" class="hf hg hh jp b fi jz ju l jv jw">if len(sys.argv) != 3:<br/>        print('Usage: python createtable.py cloud compartment_OCID')<br/>        raise SystemExit</span><span id="7b59" class="hf hg hh jp b fi jz ju l jv jw">nosql_env = sys.argv[1:][0]<br/>    nosql_compartment= sys.argv[2:][0]<br/>    print('Using compartment: ' + str(nosql_compartment))<br/>    print('Using environment: ' + str(nosql_env))</span></pre><p id="e27a" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated">C.下面的代码将用于创建一个表并加载多个JSON文件。</p><pre class="if ig ih ii fd jo jp jq jr aw js bi"><span id="567d" class="hf hg hh jp b fi jt ju l jv jw">handle = None<br/>    try:</span><span id="34b6" class="hf hg hh jp b fi jz ju l jv jw">#<br/># Create a handle<br/>#<br/>        handle = get_handle(nosql_env, nosql_compartment )</span><span id="0427" class="hf hg hh jp b fi jz ju l jv jw">#<br/># Create a table<br/>#<br/>        statement = (<br/>            'CREATE TABLE if not exists {}( id INTEGER, type STRING, name STRING, ppu Double, batters JSON, PRIMARY KEY ( id ) )').format(table_name)<br/>        request = TableRequest().set_statement(statement).set_table_limits(<br/>            TableLimits(30, 10, 1))<br/>        handle.do_table_request(request, 50000, 3000)<br/>        print('Table is created')<br/> # Put a few rows<br/> #<br/> #<br/>        path_to_json = '/home/opc/sample/'<br/>        json_files = ''<br/>        json_files = os.path.join(path_to_json, '*.json')<br/>        file_list = glob.glob(json_files)<br/>        for file in file_list:<br/>            with open(file) as jfile:<br/>                data = json.load(jfile)<br/>                request = PutRequest().set_table_name(table_name)<br/>                request.set_value(data)<br/>                handle.put(request)</span><span id="7dfd" class="hf hg hh jp b fi jz ju l jv jw">print('Data load is complete')<br/>    except Exception as e:<br/>        print(e)<br/>    finally:<br/>        # If the handle isn't closed Python will not exit properly<br/>        if handle is not None:<br/>            handle.close()</span><span id="81b3" class="hf hg hh jp b fi jz ju l jv jw">if __name__ == '__main__':<br/>    main()</span></pre><p id="1f2c" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated">整个代码可以用我们之前创建的隔离舱OCID来执行。</p><pre class="if ig ih ii fd jo jp jq jr aw js bi"><span id="2027" class="hf hg hh jp b fi jt ju l jv jw"><strong class="jp jl">python3 loadjsondata.py cloud <em class="jn">&lt;OCI compartment OCID&gt;</em></strong></span><span id="45de" class="hf hg hh jp b fi jz ju l jv jw">sample output:<br/>Using compartment: ****************************<br/>Using environment: cloud<br/>Using credentials and DEFAULT profile from ~/.oci/config<br/>Table is created<br/>Data load is complete</span></pre><p id="1af9" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated">D.验证表</p><p id="a733" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated">导航到云门户中的数据库以查找表。</p><figure class="if ig ih ii fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es ka"><img src="../Images/963acfa600bd14dbbf0bc12424303654.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o3l4yteWHZ76W3dkXHEivg.png"/></div></div></figure><figure class="if ig ih ii fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kb"><img src="../Images/9684655542aab4222516f28005f42b15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D0M03Wd2mlyTbqvI2YgtIQ.png"/></div></div></figure><p id="cd35" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated">表是用JSON数据类型创建的。</p><figure class="if ig ih ii fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kc"><img src="../Images/8e72c0e9d5610aa6e09ad9d91c0024ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nFsokVp2FkWXStbjy_r_Mw.png"/></div></div></figure><p id="cc63" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated">让我们从控制台查询数据，看看结果！</p><figure class="if ig ih ii fd ij er es paragraph-image"><div role="button" tabindex="0" class="ik il di im bf in"><div class="er es kd"><img src="../Images/b4dce9d4d864e34d76cce9697f74c71d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pWJ91_jiD2LeZcRMJLd2Bw.png"/></div></div></figure><h2 id="99c8" class="hf hg hh bd hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id bi translated"><strong class="ak">结论</strong></h2><p id="a81e" class="pw-post-body-paragraph iq ir hh is b it ke iv iw ix kf iz ja hr kg jc jd hv kh jf jg hz ki ji jj jk ha bi translated">当然，你可以使用任何你选择的其他SDK，比如Java，Go等等。在Oracle NoSQL数据库云服务中执行常规操作。</p><p id="50f3" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated"><strong class="is jl">附录:</strong></p><p id="6a87" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated">下面是完整的代码片段</p><figure class="if ig ih ii fd ij"><div class="bz dy l di"><div class="kj kk l"/></div></figure><p id="74fb" class="pw-post-body-paragraph iq ir hh is b it iu iv iw ix iy iz ja hr jb jc jd hv je jf jg hz jh ji jj jk ha bi translated">想进一步讨论吗？加入我们的<a class="ae jm" href="https://bit.ly/devrel_slack" rel="noopener ugc nofollow" target="_blank">甲骨文开发者公共松弛期</a>！</p></div></div>    
</body>
</html>