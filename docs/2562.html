<html>
<head>
<title>Today I Learned — Retrieving Crontab After Accidentally Delete It using Crontab -R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">今天我学习了——在使用Crontab -R不小心删除Crontab后重新获得它</h1>
<blockquote>原文：<a href="https://medium.easyread.co/today-i-learned-retrieving-crontab-after-accidentally-delete-it-using-crontab-r-1f9699ef94f5?source=collection_archive---------0-----------------------#2021-03-02">https://medium.easyread.co/today-i-learned-retrieving-crontab-after-accidentally-delete-it-using-crontab-r-1f9699ef94f5?source=collection_archive---------0-----------------------#2021-03-02</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><blockquote class="jk jl jm"><p id="a988" class="jn jo jp jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ig bi translated">今天是和往常一样平静的一天。已经是晚上7点了，我想合上笔记本电脑吃晚饭。突然，我的一个朋友告诉我，他不小心运行了命令<strong class="jq io"> crontab -r </strong>而不是<strong class="jq io"> crontab -e </strong>来更新我们服务器中的cronjob。然后，我们一起慌了。</p></blockquote><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi km"><img src="../Images/b35c779a3f59cf30be1d518067fc3b29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*137IeXJj50G6Tu2R"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">Photo by <a class="ae lc" href="https://unsplash.com/@richardbrutyo?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Richard Brutyo</a> on <a class="ae lc" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure></div><div class="ab cl ld le hr lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ig ih ii ij ik"><p id="cd11" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy lk ka kb kc ll ke kf kg lm ki kj kk kl ig bi translated">接下来——我们一起寻找出路，得出了两个解决方案。</p><ol class=""><li id="b55c" class="ln lo in jq b jr js jv jw lk lp ll lq lm lr kl ls lt lu lv bi translated">试图通过<strong class="jq io"> <em class="jp"> syslog </em> </strong>查找cron日志</li></ol><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="b032" class="mb mc in lx b gy md me l mf mg"><strong class="lx io">grep CRON /var/log/syslog</strong></span></pre><p id="a766" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy lk ka kb kc ll ke kf kg lm ki kj kk kl ig bi translated">使用这个命令，我们可以看到系统运行的所有系统日志。<em class="jp"> grep </em>函数将只捕捉包含单词<em class="jp"> cron </em>的日志。</p><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div role="button" tabindex="0" class="ks kt di ku bf kv"><div class="gh gi mh"><img src="../Images/1a299a6656a9bdb6ca8ed3f4fc962e8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LVx-sVHjaAO9nl7AK1F_mw.png"/></div></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">grep CRON /var/log/syslog</figcaption></figure><p id="c7e9" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy lk ka kb kc ll ke kf kg lm ki kj kk kl ig bi translated">从这些日志中，我们可以发现命令<code class="fe mi mj mk lx b"><strong class="jq io"><em class="jp">/tmp/test/hello_world.sh</em></strong></code> <em class="jp"> </em>每1分钟运行一次。使用这些信息，我们可以获取在这里找到的所有命令，并将它们重写到现有的crontab中。</p><p id="6d65" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy lk ka kb kc ll ke kf kg lm ki kj kk kl ig bi translated">2.检查<code class="fe mi mj mk lx b"> <strong class="jq io"><em class="jp">/tmp/</em></strong></code>试试运气</p><pre class="kn ko kp kq gt lw lx ly lz aw ma bi"><span id="6e40" class="mb mc in lx b gy md me l mf mg"><strong class="lx io">ll /tmp/ | grep crontab</strong></span></pre><figure class="kn ko kp kq gt kr gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/0a4ad701d541f1274a731dd0e3364535.png" data-original-src="https://miro.medium.com/v2/resize:fit:1064/format:webp/1*iD2q03DsGs2Db791LUfgPw.png"/></div><figcaption class="ky kz gj gh gi la lb bd b be z dk">ll /tmp/ | grep crontab</figcaption></figure><p id="6a87" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy lk ka kb kc ll ke kf kg lm ki kj kk kl ig bi translated">许多程序不直接写入实际文件。相反，程序将首先写入<code class="fe mi mj mk lx b"><strong class="jq io"><em class="jp">/tmp/</em></strong></code>文件，当它们完成更新时，它们将做一些步骤来检查和验证(取决于程序)，然后最终写入实际的原始文件。</p><p id="2639" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy lk ka kb kc ll ke kf kg lm ki kj kk kl ig bi translated">crontab的一个例子是:如果crontab中有冲突的更改(您正在尝试更新文件，而另一个也在做同样的事情)，那么在<code class="fe mi mj mk lx b"><strong class="jq io"><em class="jp">/tmp/</em></strong></code>中将会有一个前缀为<strong class="jq io"> <em class="jp"> crontab的新目录。* </em> </strong>存储您的版本更新。</p><p id="be0e" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy lk ka kb kc ll ke kf kg lm ki kj kk kl ig bi translated">如果运气在我们这边，<em class="jp">好歹在</em> <strong class="jq io"> <em class="jp">我们这边——运气在我们这边</em> </strong>，我们可以在这里找到旧档案。使用这些旧文件，我们可以重写现有的crontab。</p></div><div class="ab cl ld le hr lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ig ih ii ij ik"><p id="a758" class="pw-post-body-paragraph jn jo in jq b jr js jt ju jv jw jx jy lk ka kb kc ll ke kf kg lm ki kj kk kl ig bi translated">有了这种情况之后，进行定期的crontab配置备份似乎是一个好主意——只需将它写入crontab配置中。然后，cron可以在未来拯救自己。😂</p></div><div class="ab cl ld le hr lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ig ih ii ij ik"><blockquote class="jk jl jm"><p id="b40f" class="jn jo jp jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ig bi translated">最后，我们能够恢复我们的crontab配置。我终于合上笔记本，吃了晚饭。</p><p id="c73a" class="jn jo jp jq b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl ig bi translated">祝大家愉快！</p></blockquote></div><div class="ab cl ld le hr lf" role="separator"><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li lj"/><span class="lg bw bk lh li"/></div><div class="ig ih ii ij ik"><h1 id="a22b" class="mm mc in bd mn mo mp mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni bi translated"><strong class="ak">参考</strong></h1><ol class=""><li id="df99" class="ln lo in jq b jr nj jv nk lk nl ll nm lm nn kl ls lt lu lv bi translated"><a class="ae lc" href="http://intosimple.blogspot.com/2013/10/retrieving-crontab-after-accidental.html" rel="noopener ugc nofollow" target="_blank">意外移除后取回crontab</a></li><li id="33ae" class="ln lo in jq b jr no jv np lk nq ll nr lm ns kl ls lt lu lv bi translated"><a class="ae lc" href="https://unix.stackexchange.com/questions/136350/recover-cron-jobs-accidently-removed-with-crontab-r" rel="noopener ugc nofollow" target="_blank">用crontab -r恢复意外删除的cron作业</a></li></ol></div></div>    
</body>
</html>