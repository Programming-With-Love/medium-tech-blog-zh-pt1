<html>
<head>
<title>Using a Pre-Trained TensorFlow Model on Android — Part 1</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Android上使用预先训练好的TensorFlow模型—第1部分</h1>
<blockquote>原文：<a href="https://medium.com/capital-one-tech/using-a-pre-trained-tensorflow-model-on-android-e747831a3d6?source=collection_archive---------2-----------------------#2017-08-13">https://medium.com/capital-one-tech/using-a-pre-trained-tensorflow-model-on-android-e747831a3d6?source=collection_archive---------2-----------------------#2017-08-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/8ae0c2f33f59882e89eafbbb75e222d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QyLRQMprzQkyr9ZvecrRYQ.png"/></div></div></figure><p id="c17f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">以前在Android上嵌入一个预先训练好的TensorFlow模型真的很难，现在轻松多了！</p><h2 id="c9de" class="jn jo hh bd jp jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh bi translated">多给我讲讲！</h2><p id="54be" class="pw-post-body-paragraph ip iq hh ir b is ki iu iv iw kj iy iz ja kk jc jd je kl jg jh ji km jk jl jm ha bi translated">在DC安得康做了我的“Android开发者的机器学习”演讲后(<a class="ae kn" href="https://www.youtube.com/watch?v=Lt-KLtkDlh8" rel="noopener ugc nofollow" target="_blank">截屏</a>，<a class="ae kn" href="https://speakerdeck.com/daj/machine-learning-for-android-developers" rel="noopener ugc nofollow" target="_blank">幻灯片</a>)，我开始抱怨将TensorFlow模型嵌入Android应用的复杂性。幸运的是，一些谷歌IOT开发者的拥护者在那里。除了发表精彩的演讲和举办精彩的黑客马拉松，他们还能回答很多问题。:-) <a class="ae kn" href="https://plus.google.com/+WaynePiekarski" rel="noopener ugc nofollow" target="_blank"> Wayne Piekarski </a>向我展示了这个Android Things项目示例:</p><div class="ko kp ez fb kq kr"><a href="https://github.com/androidthings/sample-tensorflow-imageclassifier" rel="noopener  ugc nofollow" target="_blank"><div class="ks ab dw"><div class="kt ab ku cl cj kv"><h2 class="bd hi fi z dy kw ea eb kx ed ef hg bi translated">人造物体/样本-张量流-图像分类器</h2><div class="ky l"><h3 class="bd b fi z dy kw ea eb kx ed ef dx translated">在GitHub上创建一个帐户，为sample-tensor flow-image classifier的开发做出贡献。</h3></div><div class="kz l"><p class="bd b fp z dy kw ea eb kx ed ef dx translated">github.com</p></div></div><div class="la l"><div class="lb l lc ld le la lf in kr"/></div></div></a></div><p id="5490" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这个项目演示了一种嵌入预训练模型的简单方法，简单地通过向您的<code class="du lg lh li lj b">build.gradle</code>添加一个依赖项，然后使用<code class="du lg lh li lj b">TensorFlowInferenceInterface</code>类(文档在<a class="ae kn" href="https://github.com/tensorflow/tensorflow/tree/master/tensorflow/contrib/android" rel="noopener ugc nofollow" target="_blank">tensor flow contrib README</a>中)。</p><h2 id="6fc6" class="jn jo hh bd jp jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh bi translated">这以前是怎么运作的？</h2><p id="f769" class="pw-post-body-paragraph ip iq hh ir b is ki iu iv iw kj iy iz ja kk jc jd je kl jg jh ji km jk jl jm ha bi translated">这里有一个可爱的图表，展示了一个Android应用程序如何通过使用Java原生接口(JNI)桥接到NDK，从Java调用TensorFlow:</p><figure class="ll lm ln lo fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lk"><img src="../Images/33f9a2f0f493b6ef9151efb589a5d212.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b7SNeh2-5sZfjxgvpruHSQ.png"/></div></div><figcaption class="lp lq et er es lr ls bd b be z dx">Source: <a class="ae kn" href="https://jalammar.github.io/Supercharging-android-apps-using-tensorflow/" rel="noopener ugc nofollow" target="_blank">https://jalammar.github.io/Supercharging-android-apps-using-tensorflow/</a></figcaption></figure><p id="0b6a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">TensorFlowAndroidMNIST<a class="ae kn" href="https://github.com/miyosuda/TensorFlowAndroidMNIST" rel="noopener ugc nofollow" target="_blank">项目给出了一个让这一切工作的方法的例子。作者编写了JNI代码，并将其构建成一个<code class="du lg lh li lj b">libtensorflow_mnist.so</code>本地库，然后从Java <code class="du lg lh li lj b">DigitDetector</code>中调用它:</a></p><figure class="ll lm ln lo fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es lt"><img src="../Images/0532b2887bef45bd991658f18b937975.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mg36JkW6Oa6hqJpPYhL04A.png"/></div></div></figure><p id="bcc2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这种代码很复杂，很难维护，例如，JNI代码的构建需要不同于正常的Android Studio/Gradle构建。</p><p id="7637" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在上面的例子中，只支持<code class="du lg lh li lj b">armeabi-v7a</code>架构，所以我预计这个项目会在其他架构上崩溃(例如x86模拟器)。</p><h2 id="1412" class="jn jo hh bd jp jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh bi translated">你得承认，越来越好了！</h2><p id="8bc0" class="pw-post-body-paragraph ip iq hh ir b is ki iu iv iw kj iy iz ja kk jc jd je kl jg jh ji km jk jl jm ha bi translated">为了让这变得更容易，谷歌在2016年末添加了<code class="du lg lh li lj b">TensorFlowInferenceInterface</code>类(<a class="ae kn" href="https://github.com/tensorflow/tensorflow/commits/341da02072ee1c1093a5dca6ad45a1488306193d/tensorflow/contrib/android/java/org/tensorflow/contrib/android/TensorFlowInferenceInterface.java" rel="noopener ugc nofollow" target="_blank"> GitHub提交</a>)。这有助于标准化如何与Java中的TensorFlow模型进行交互。它提供了这些预构建的库:</p><ul class=""><li id="c874" class="lu lv hh ir b is it iw ix ja lw je lx ji ly jm lz ma mb mc bi translated"><code class="du lg lh li lj b">libandroid_tensorflow_inference_java.jar</code>—Java接口层。</li><li id="55c0" class="lu lv hh ir b is md iw me ja mf je mg ji mh jm lz ma mb mc bi translated"><code class="du lg lh li lj b">libtensorflow_inference.so</code> —与张量流模型对话的JNI代码。</li></ul><p id="ebc1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><a class="ae kn" href="https://github.com/MindorksOpenSource/AndroidTensorFlowMNISTExample" rel="noopener ugc nofollow" target="_blank">AndroidTensorFlowMNISTExample</a>项目给出了这种方法的一个例子:</p><figure class="ll lm ln lo fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mi"><img src="../Images/4da6ecf0282789b058833b27e4b7b43d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2yTBa4u8VzjJTKZ8O6bcew.png"/></div></div></figure><p id="1802" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">您可以看到在tensorflowenceinterface的<a class="ae kn" href="https://github.com/tensorflow/tensorflow/blob/r1.0/tensorflow/contrib/android/java/org/tensorflow/contrib/android/TensorFlowInferenceInterface.java" rel="noopener ugc nofollow" target="_blank"> r1.0版本中可用的方法的完整列表(方法名称在</a><a class="ae kn" href="https://github.com/tensorflow/tensorflow/blob/r1.2/tensorflow/contrib/android/java/org/tensorflow/contrib/android/TensorFlowInferenceInterface.java" rel="noopener ugc nofollow" target="_blank"> r1.2 </a>和更新版本中已经全部更改)。</p><h2 id="6d41" class="jn jo hh bd jp jq jr js jt ju jv jw jx ja jy jz ka je kb kc kd ji ke kf kg kh bi translated">未来就在现在</h2><p id="815e" class="pw-post-body-paragraph ip iq hh ir b is ki iu iv iw kj iy iz ja kk jc jd je kl jg jh ji km jk jl jm ha bi translated">2017年2月，TensorFlow 中添加了一个Android特定的<a class="ae kn" href="https://github.com/tensorflow/tensorflow/tree/master/tensorflow/contrib/android" rel="noopener ugc nofollow" target="_blank"> contrib，它允许将所有原生二进制文件和Java代码构建到单个库中(打包为AAR文件)。</a><a class="ae kn" href="https://github.com/tensorflow/tensorflow/commit/d726686d2dff34a11f85841dfc52bf45698ac49d#diff-8f7c6468dd704fc099a7fce03a5cdd0bR17" rel="noopener ugc nofollow" target="_blank">2017年5月</a>该依赖关系在JCenter上发布。</p><p id="364f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，要嵌入现有的张量流模型，我们需要做的就是:</p><ol class=""><li id="3b6f" class="lu lv hh ir b is it iw ix ja lw je lx ji ly jm mj ma mb mc bi translated">在您的<code class="du lg lh li lj b">build.gradle</code>中包含<code class="du lg lh li lj b">compile 'org.tensorflow:tensorflow-android:+'</code>依赖项。</li><li id="1705" class="lu lv hh ir b is md iw me ja mf je mg ji mh jm mj ma mb mc bi translated">使用<code class="du lg lh li lj b">TensorFlowInferenceInterface</code>与您的模型交互。</li></ol><p id="33a4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我通过更新<a class="ae kn" href="https://github.com/MindorksOpenSource/AndroidTensorFlowMNISTExample" rel="noopener ugc nofollow" target="_blank">AndroidTensorFlowMNISTExample</a>项目来使用新的Gradle依赖项，亲自尝试了一下。这是我的拉请求:</p><div class="ko kp ez fb kq kr"><a href="https://github.com/MindorksOpenSource/AndroidTensorFlowMNISTExample/pull/1" rel="noopener  ugc nofollow" target="_blank"><div class="ks ab dw"><div class="kt ab ku cl cj kv"><h2 class="bd hi fi z dy kw ea eb kx ed ef hg bi translated">通过daj Pull使用“org . tensor flow:tensor flow-Android”依赖关系支持所有架构…</h2><div class="ky l"><h3 class="bd b fi z dy kw ea eb kx ed ef dx translated">org . tensor flow:tensor flow-Android:1 . 2 . 0依赖项下载了一个AAR文件，该文件包含适用于所有应用程序的本机二进制文件…</h3></div><div class="kz l"><p class="bd b fp z dy kw ea eb kx ed ef dx translated">github.com</p></div></div><div class="la l"><div class="mk l lc ld le la lf in kr"/></div></div></a></div><p id="0154" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">阅读<a class="ae kn" rel="noopener" href="/@daj/using-a-pre-trained-tensorflow-model-on-android-part-2-153ebdd4c465">第2部分</a>，了解更多关于<code class="du lg lh li lj b">TensorFlowInferenceInterface</code>和<code class="du lg lh li lj b">org.tensorflow:tensorflow-android</code>依赖关系如何工作的信息！</p><p id="3837" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="ml">声明:这些观点仅代表作者个人观点。除非本帖中另有说明，否则Capital One不属于所提及的任何公司，也不被其认可。使用或展示的所有商标和其他知识产权都是其各自所有者的所有权。本文为2017首都一。</em></p><p id="3208" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="ml">欲了解更多关于API、开源、社区活动和Capital One的开发者文化，请访问我们的一站式开发者门户网站DevExchange:</em><a class="ae kn" href="https://developer.capitalone.com/" rel="noopener ugc nofollow" target="_blank"><em class="ml">https://developer.capitalone.com/</em></a></p></div></div>    
</body>
</html>