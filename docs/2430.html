<html>
<head>
<title>Build Progressive Web Apps — Chapter 4</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">构建渐进式Web应用程序—第4章</h1>
<blockquote>原文：<a href="https://medium.easyread.co/build-progressive-web-apps-chapter-4-b85ef6e6d465?source=collection_archive---------1-----------------------#2019-11-25">https://medium.easyread.co/build-progressive-web-apps-chapter-4-b85ef6e6d465?source=collection_archive---------1-----------------------#2019-11-25</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="a15c" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">创建简单的SPA(单页应用程序)</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/af63217b321f2a7971dc8c3b35c4561f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Bybbz6Aw38hO_rIB"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@andsmall?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Andrew Small</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><h1 id="a676" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated">构建渐进式Web应用程序-列表</h1><p id="0fc5" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated"><a class="ae ks" href="https://medium.com/easyread/build-progressive-web-apps-6248a7152730" rel="noopener"> <strong class="ln io">第0章—PWA</strong></a><br/><a class="ae ks" href="https://medium.com/easyread/build-progressive-web-apps-chapter-1-d3d2b449ab42" rel="noopener"><strong class="ln io">第1章—PWA</strong></a><strong class="ln io"><br/></strong><a class="ae ks" href="https://medium.com/easyread/build-progressive-web-apps-chapter-2-pwa-components-428295c2d524" rel="noopener"><strong class="ln io">第2章—PWA的组件&amp;</strong></a><strong class="ln io"><br/></strong><a class="ae ks" href="https://medium.com/easyread/build-progressive-web-apps-chapter-3-a73269d627b2" rel="noopener"><strong class="ln io">第3章—准备和工具</strong> </a> <strong class="ln io"> <br/>第4章—创建简单的SPA(单页应用</strong></p></div><div class="ab cl mh mi hr mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ig ih ii ij ik"><p id="f1f7" class="pw-post-body-paragraph ll lm in ln b lo mo jo lq lr mp jr lt lu mq lw lx ly mr ma mb mc ms me mf mg ig bi translated">我们将创建一个渐进式web应用程序，其中包含可以静态访问的页面。我们将预先准备一个显示基于AJAX的页面内容的标准web应用程序，也称为单页应用程序或SPA。</p><h1 id="9427" class="kt ku in bd kv kw kx ky kz la lb lc ld jt le ju lf jw lg jx lh jz li ka lj lk bi translated"><strong class="ak">准备资产</strong></h1><p id="248f" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">首先，下载Materialize CSS框架，我们将使用它来简化shell应用程序的创建。将下载的文件解压缩到first-pwa /文件夹中。我们的应用程序的文件结构应该如下所示:</p><pre class="kd ke kf kg gt mt mu mv mw aw mx bi"><span id="6e64" class="my ku in mu b gy mz na l nb nc"><em class="nd">first-pwa</em><br/><em class="nd">├── css/<br/>│ ├── materialize.css<br/>│ └── materialize.min.css<br/>├── js/<br/>│ ├── materialize.js<br/>│ └── materialize.min.js<br/>├── LICENSE<br/>├── README.md</em></span></pre><p id="e758" class="pw-post-body-paragraph ll lm in ln b lo mo jo lq lr mp jr lt lu mq lw lx ly mr ma mb mc ms me mf mg ig bi translated">接下来，在项目文件夹中创建一个名为<strong class="ln io">index.html</strong>的文件来保存shell app模板:</p><pre class="kd ke kf kg gt mt mu mv mw aw mx bi"><span id="9447" class="my ku in mu b gy mz na l nb nc">&lt;!DOCTYPE html&gt;<br/>&lt;html lang="en"&gt;<br/>&lt;head&gt;<br/>  &lt;meta charset="UTF-8"/&gt;<br/>  &lt;title&gt;My First PWA&lt;/title&gt;<br/>  &lt;meta name="description" content="My first PWA"/&gt;<br/>  &lt;meta name="viewport" content="width=device-width, initial-scale=1"&gt;<br/>  &lt;link rel="stylesheet" href="css/materialize.min.css"&gt;<br/>&lt;/head&gt;<br/>&lt;body&gt;<br/>    <br/>  &lt;!-- Navigasi --&gt;<br/>  &lt;nav class="teal lighten-1" role="navigation"&gt;<br/>    &lt;div class="nav-wrapper container"&gt;<br/>      &lt;a href="#" class="brand-logo" id="logo-container"&gt;My App&lt;/a&gt;<br/>      &lt;a href="#" class="sidenav-trigger" data-target="nav-mobile"&gt;☰&lt;/a&gt;<br/>      <br/>      &lt;ul class="topnav right hide-on-med-and-down"&gt;&lt;/ul&gt;<br/>      &lt;ul class="sidenav" id="nav-mobile"&gt;&lt;/ul&gt;<br/>    &lt;/div&gt;<br/>  &lt;/nav&gt;<br/>  &lt;!-- Akhir Navigasi --&gt;</span><span id="3ab8" class="my ku in mu b gy ne na l nb nc">&lt;div class="container" id="body-content"&gt;&lt;/div&gt;<br/>  &lt;script src="js/materialize.min.js"&gt;&lt;/script&gt;<br/>  &lt;script src="js/nav.js"&gt;&lt;/script&gt;<br/>&lt;/body&gt;<br/>&lt;/html&gt;</span></pre><p id="d698" class="pw-post-body-paragraph ll lm in ln b lo mo jo lq lr mp jr lt lu mq lw lx ly mr ma mb mc ms me mf mg ig bi translated">在上面的<strong class="ln io">index.html</strong>文件中，我们使用<code class="fe nf ng nh mu b"><strong class="ln io">&lt;nav&gt;</strong></code>标签和id为<code class="fe nf ng nh mu b"><strong class="ln io">#body-content</strong></code>的内容元素创建了一个导航元素。在导航中有<code class="fe nf ng nh mu b"><strong class="ln io">.brand-logo</strong></code>和两个菜单元素，即<code class="fe nf ng nh mu b"><strong class="ln io">.topnav</strong></code>显示顶部菜单和<code class="fe nf ng nh mu b"><strong class="ln io">.sidenav</strong></code>显示侧面菜单。侧边菜单只会在手机屏幕模式下出现，顶部菜单只会在大屏幕模式下出现。在模板中将菜单元素和<code class="fe nf ng nh mu b"><strong class="ln io">#body-content</strong></code>元素都留空。原因是，我们使用AJAX填充它。</p><p id="0206" class="pw-post-body-paragraph ll lm in ln b lo mo jo lq lr mp jr lt lu mq lw lx ly mr ma mb mc ms me mf mg ig bi translated">然后在js/文件夹中创建一个名为<strong class="ln io"> nav.js </strong>的新文件。这个脚本将包含我们所有的JavaScript代码。在文件中编写以下代码:</p><pre class="kd ke kf kg gt mt mu mv mw aw mx bi"><span id="31d4" class="my ku in mu b gy mz na l nb nc">document.addEventListener("DOMContentLoaded", function() {<br/>  // Activate sidebar nav<br/>  var elems = document.querySelectorAll(".sidenav");<br/>  M.Sidenav.init(elems);<br/>  loadNav();<br/> <br/>  function loadNav() {<br/>    var xhttp = new XMLHttpRequest();<br/>    xhttp.onreadystatechange = function() {<br/>      if (this.readyState == 4) {<br/>        if (this.status != 200) return;<br/> <br/>        // Muat daftar tautan menu<br/>        document.querySelectorAll(".topnav, .sidenav").forEach(function(elm) {<br/>          elm.innerHTML = xhttp.responseText;<br/>        });<br/>      }<br/>    };<br/>    xhttp.open("GET", "nav.html", true);<br/>    xhttp.send();<br/>  }<br/>});</span></pre><p id="0203" class="pw-post-body-paragraph ll lm in ln b lo mo jo lq lr mp jr lt lu mq lw lx ly mr ma mb mc ms me mf mg ig bi translated">在上面的代码中，我们激活了物化框架的侧边栏元素，这样当点击汉堡菜单时它就会出现(第3–4行)。我们还可以使用XMLHttpRequest方法激活包含AJAX代码的<code class="fe nf ng nh mu b"><strong class="ln io">loadNav()</strong></code>，以检索nav.html文件的内容，并将其保存在菜单元素<code class="fe nf ng nh mu b"><strong class="ln io">.topnav</strong></code>和<code class="fe nf ng nh mu b"><strong class="ln io">.sidenav</strong></code> <strong class="ln io">中。</strong></p><p id="1e16" class="pw-post-body-paragraph ll lm in ln b lo mo jo lq lr mp jr lt lu mq lw lx ly mr ma mb mc ms me mf mg ig bi translated">注意:我们所有的JavaScript代码都存储在DOMContentLoaded事件调用函数的代码块中，以保护html文档中所有元素安装完成后运行的代码。</p><p id="9ea3" class="pw-post-body-paragraph ll lm in ln b lo mo jo lq lr mp jr lt lu mq lw lx ly mr ma mb mc ms me mf mg ig bi translated">在浏览器中尝试之前，我们准备了另外一个文件，即<strong class="ln io">nav.html</strong>，它列出了<code class="fe nf ng nh mu b"><strong class="ln io">sidenav</strong></code> <strong class="ln io"> </strong>和<code class="fe nf ng nh mu b"><strong class="ln io">topnav</strong></code>的菜单。在<strong class="ln io">index.html</strong>文件旁边的项目文件夹中创建一个<strong class="ln io">nav.html</strong>文件:</p><pre class="kd ke kf kg gt mt mu mv mw aw mx bi"><span id="ca54" class="my ku in mu b gy mz na l nb nc">&lt;li&gt;&lt;a class="waves-effect" href="#home"&gt;Home&lt;/a&gt;&lt;/li&gt;<br/>&lt;li&gt;&lt;a class="waves-effect" href="#about"&gt;About&lt;/a&gt;&lt;/li&gt;<br/>&lt;li&gt;&lt;a class="waves-effect" href="#contact"&gt;Contact&lt;/a&gt;&lt;/li&gt;</span></pre><p id="47b2" class="pw-post-body-paragraph ll lm in ln b lo mo jo lq lr mp jr lt lu mq lw lx ly mr ma mb mc ms me mf mg ig bi translated">现在在浏览器中打开应用程序。但是请记住，我们的应用程序使用<strong class="ln io"> XMLHttpRequest </strong>方法通过<strong class="ln io"> AJAX </strong>来检索数据，这将不会使用协议file: //来运行。因此，如果您只是直接在浏览器中打开index.html文件(通过双击index.html文件或将文件拖到浏览器中)，应用程序将无法在<code class="fe nf ng nh mu b"><strong class="ln io">sidenav</strong></code> <strong class="ln io"> </strong>和<code class="fe nf ng nh mu b"><strong class="ln io">topnav</strong></code>中显示菜单列表。您必须使用http协议运行应用程序，如“简介”一章中“运行PWA应用程序”一节中的指南所示。</p><p id="8227" class="pw-post-body-paragraph ll lm in ln b lo mo jo lq lr mp jr lt lu mq lw lx ly mr ma mb mc ms me mf mg ig bi translated">当在浏览器中成功正确地打开一个应用程序时，将会出现一个包含应用程序标题的元素栏。你也可以尝试缩小浏览器的尺寸来模拟手机屏幕的大小，这样汉堡菜单按钮就会出现在左上角，点击它就会弹出一个侧边栏。</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi ni"><img src="../Images/26a61b421644bd559af6935b5fee22b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2nZJPFelIdtJuKiW.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Running PWA Applications</figcaption></figure></div><div class="ab cl mh mi hr mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ig ih ii ij ik"><h1 id="f48a" class="kt ku in bd kv kw nj ky kz la nk lc ld jt nl ju lf jw nm jx lh jz nn ka lj lk bi translated">显示页面内容</h1><p id="eafe" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">我们已经成功地展示了一个带有导航菜单的shell应用程序。我们首先通过显示页面内容来完成应用程序。内容将被异步调用<strong class="ln io"/>或使用<strong class="ln io"> AJAX </strong>技术并存储在<strong class="ln io">中。正文内容</strong>元素。在<strong class="ln io"> nav.js </strong>文件中添加以下代码(写入<strong class="ln io"> DOMContentLoaded </strong>回调事件中):</p><pre class="kd ke kf kg gt mt mu mv mw aw mx bi"><span id="ac88" class="my ku in mu b gy mz na l nb nc">// Load page content<br/>var page = window.location.hash.substr(1);<br/>if (page == "") page = "home";<br/>loadPage(page);<br/> <br/>function loadPage(page) {<br/>  var xhttp = new XMLHttpRequest();<br/>  xhttp.onreadystatechange = function() {<br/>    if (this.readyState == 4) {<br/>      var content = document.querySelector("#body-content");<br/>      if (this.status == 200) {<br/>        content.innerHTML = xhttp.responseText;<br/>      } else if (this.status == 404) {<br/>        content.innerHTML = "&lt;p&gt;Halaman tidak ditemukan.&lt;/p&gt;";<br/>      } else {<br/>        content.innerHTML = "&lt;p&gt;Ups.. halaman tidak dapat diakses.&lt;/p&gt;";<br/>      }<br/>    }<br/>  };<br/>  xhttp.open("GET", "pages/" + page + ".html", true);<br/>  xhttp.send();<br/>}</span></pre><p id="5163" class="pw-post-body-paragraph ll lm in ln b lo mo jo lq lr mp jr lt lu mq lw lx ly mr ma mb mc ms me mf mg ig bi translated">在上面的代码中，我们首先从页面url中检索散列作为要调用的页面的名称。例如，我们打开网址<a class="ae ks" href="http://127.0.0.1:8887/#contact" rel="noopener ugc nofollow" target="_blank"><strong class="ln io">http://127 . 0 . 0 . 1:8887/#联系人</strong> </a> <strong class="ln io"> </strong>意味着我们访问联系人页面。如果没有找到散列，这意味着将显示默认主页。我们使用AJAX调用<code class="fe nf ng nh mu b"><strong class="ln io">loadPage()</strong></code>函数来调用分页文件的内容。然后，页面内容将被保存到。主体内容元素。如果没有找到这个页面(状态代码404)，那么我们显示一个段落元素，告诉我们这个页面不在可用页面列表中。页面内容文件存储在pages/文件夹中。</p><p id="dc33" class="pw-post-body-paragraph ll lm in ln b lo mo jo lq lr mp jr lt lu mq lw lx ly mr ma mb mc ms me mf mg ig bi translated">在之前的nav.html文件中我们增加了三个页面的三个链接，包括<strong class="ln io">首页</strong>、<strong class="ln io">关于</strong>和<strong class="ln io">联系人</strong>。那意味着我们必须准备这些三页的文件。在pages/文件夹中创建以下三个文件。</p><h2 id="5d95" class="my ku in bd kv no np dn kz nq nr dp ld lu ns nt lf ly nu nv lh mc nw nx lj ny bi translated">pages/home.html</h2><pre class="kd ke kf kg gt mt mu mv mw aw mx bi"><span id="e9a5" class="my ku in mu b gy mz na l nb nc">&lt;h2&gt;Selamat datang!&lt;/h2&gt;<br/>&lt;p&gt;Selamat datang di laman aplikasi web progresif pertama saya.&lt;/p&gt;</span></pre><h2 id="4dd5" class="my ku in bd kv no np dn kz nq nr dp ld lu ns nt lf ly nu nv lh mc nw nx lj ny bi translated"><strong class="ak"> pages/about.html </strong></h2><pre class="kd ke kf kg gt mt mu mv mw aw mx bi"><span id="397c" class="my ku in mu b gy mz na l nb nc">&lt;h2&gt;Tentang Saya&lt;/h2&gt;<br/>&lt;p&gt;Saya adalah programmer masa depan.&lt;/p&gt;</span></pre><h2 id="4143" class="my ku in bd kv no np dn kz nq nr dp ld lu ns nt lf ly nu nv lh mc nw nx lj ny bi translated"><strong class="ak"> pages/contact.html </strong></h2><pre class="kd ke kf kg gt mt mu mv mw aw mx bi"><span id="4355" class="my ku in mu b gy mz na l nb nc">&lt;h2&gt;Hubungi Saya&lt;/h2&gt;<br/>&lt;p&gt;Hubungi saya melalui email <a class="ae ks" href="mailto:saya@mail.com" rel="noopener ugc nofollow" target="_blank">saya@mail.com</a>&lt;/p&gt;</span></pre><p id="45e4" class="pw-post-body-paragraph ll lm in ln b lo mo jo lq lr mp jr lt lu mq lw lx ly mr ma mb mc ms me mf mg ig bi translated">现在，如果您尝试重新加载页面<a class="ae ks" href="http://127.0.0.1:8887/" rel="noopener ugc nofollow" target="_blank"><strong class="ln io">http://127 . 0 . 0 . 1:8887/</strong></a>就会出现主页内容。同样，如果你打开网址<a class="ae ks" href="http://127.0.0.1:8887/#about" rel="noopener ugc nofollow" target="_blank"><strong class="ln io">http://127 . 0 . 0 . 1:8887/#关于</strong> </a>和<a class="ae ks" href="http://127.0.0.1:8887/#contact" rel="noopener ugc nofollow" target="_blank"><strong class="ln io">http://127 . 0 . 0 . 1:8887/# contact</strong>t</a>页面内容会根据选择的页面出现。只是当你点击菜单的时候，页面内容并没有立即改变。我们必须首先为每个菜单链接创建一个点击事件监听器。</p></div><div class="ab cl mh mi hr mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ig ih ii ij ik"><h1 id="458e" class="kt ku in bd kv kw nj ky kz la nk lc ld jt nl ju lf jw nm jx lh jz nn ka lj lk bi translated">向单击菜单添加事件侦听器</h1><p id="4ff0" class="pw-post-body-paragraph ll lm in ln b lo lp jo lq lr ls jr lt lu lv lw lx ly lz ma mb mc md me mf mg ig bi translated">通过为菜单上的每个链接添加事件监听器代码来修改<code class="fe nf ng nh mu b"><strong class="ln io">loadNav()</strong></code>函数，如下所示:</p><pre class="kd ke kf kg gt mt mu mv mw aw mx bi"><span id="dc09" class="my ku in mu b gy mz na l nb nc">function loadNav() {<br/>  var xhttp = new XMLHttpRequest();<br/>  xhttp.onreadystatechange = function() {<br/>    if (this.readyState == 4) {<br/>      if (this.status != 200) return;<br/> <br/>      // Muat daftar tautan menu<br/>      document.querySelectorAll(".topnav, .sidenav").forEach(function(elm) {<br/>        elm.innerHTML = xhttp.responseText;<br/>      });<br/> <br/>      // Daftarkan event listener untuk setiap tautan menu<br/>      document.querySelectorAll(".sidenav a, .topnav a").forEach(function(elm) {<br/>        elm.addEventListener("click", function(event) {<br/>          // Tutup sidenav<br/>          var sidenav = document.querySelector(".sidenav");<br/>          M.Sidenav.getInstance(sidenav).close();<br/> <br/>          // Muat konten halaman yang dipanggil<br/>          page = event.target.getAttribute("href").substr(1);<br/>          loadPage(page);<br/>        });<br/>      });<br/>    }<br/>  };<br/>  xhttp.open("GET", "nav.html", true);<br/>  xhttp.send();<br/>}</span></pre><p id="e8e5" class="pw-post-body-paragraph ll lm in ln b lo mo jo lq lr mp jr lt lu mq lw lx ly mr ma mb mc ms me mf mg ig bi translated">重新加载页面，现在当点击菜单时，页面内容应该立即改变。</p><p id="665b" class="pw-post-body-paragraph ll lm in ln b lo mo jo lq lr mp jr lt lu mq lw lx ly mr ma mb mc ms me mf mg ig bi translated">您可以从以下链接下载此<strong class="ln io"> codelab </strong>:</p><p id="5395" class="pw-post-body-paragraph ll lm in ln b lo mo jo lq lr mp jr lt lu mq lw lx ly mr ma mb mc ms me mf mg ig bi translated"><a class="ae ks" href="https://github.com/jansutris10/Simple_SPA" rel="noopener ugc nofollow" target="_blank"><em class="nd">https://github.com/jansutris10/Simple_SPA</em></a></p></div><div class="ab cl mh mi hr mj" role="separator"><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm mn"/><span class="mk bw bk ml mm"/></div><div class="ig ih ii ij ik"><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="nz oa l"/></div></figure></div></div>    
</body>
</html>