<html>
<head>
<title>Verify Data Type Conversions: 12 Things Developers Will Love About Oracle Database 12c Release 2 Part 7</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">验证数据类型转换:开发人员会喜欢的关于Oracle Database 12c第2版第7部分的12件事</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/verify-data-type-conversions-12-things-developers-will-love-about-oracle-database-12c-release-2-ad90c97de0e5?source=collection_archive---------5-----------------------#2016-11-10">https://medium.com/oracledevs/verify-data-type-conversions-12-things-developers-will-love-about-oracle-database-12c-release-2-ad90c97de0e5?source=collection_archive---------5-----------------------#2016-11-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="5c97" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是那些太常见的问题之一。<a class="ae jc" href="https://asktom.oracle.com/pls/apex/f?p=100:11:0::::P11_QUESTION_ID:9528368000346452927" rel="noopener ugc nofollow" target="_blank">验证日期确实是日期</a>。</p><p id="95fe" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">造成这种情况的主要原因是将日期存储为字符串的糟糕做法。最大的问题之一是让人们能够在“日期”列中存储明显不是日期的东西:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="ef97" class="jm jn hh ji b fi jo jp l jq jr">create table dodgy_dates ( <br/>  id int, <br/>  is_this_a_date varchar2(20) <br/>); </span><span id="82f9" class="jm jn hh ji b fi js jp l jq jr">insert into dodgy_dates values (1, 'abc');</span></pre><p id="8df4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以及一大堆可能是日期的值。如果您提供了正确的格式掩码:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="ddce" class="jm jn hh ji b fi jo jp l jq jr">insert into dodgy_dates values (2, '20150101'); <br/>insert into dodgy_dates values (3, '01-jan-2016'); <br/>insert into dodgy_dates values (4, '01/01/2016');</span></pre><p id="502f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">只返回有效日期是很棘手的。如果您尝试使用to_date()转换所有内容，您会得到异常:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="2a70" class="jm jn hh ji b fi jo jp l jq jr">select t.* from dodgy_dates t <br/>where to_date(is_this_a_date) &lt; sysdate; </span><span id="628f" class="jm jn hh ji b fi js jp l jq jr">ORA-01858: a non-numeric character was found where a numeric was expected</span></pre><p id="a929" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">或者也许:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="b505" class="jm jn hh ji b fi jo jp l jq jr">ORA-01861: literal does not match format string</span></pre><p id="e643" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">或者</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="ca70" class="jm jn hh ji b fi jo jp l jq jr">ORA-01843: not a valid month</span></pre><figure class="jd je jf jg fd ju er es paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="er es jt"><img src="../Images/b2c104352d47ab9c339e84f98c126e07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zS4fn-nljiJkqc05.jpg"/></div></div></figure><p id="d8be" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以通过编写自己的is_date()函数来解决这个问题。或者，如果你真的很勇敢，使用正则表达式。</p><p id="5566" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">无论哪种方式，都是很多不必要的工作。</p><p id="31f1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，为了让您的生活更轻松，我们创建了一个新函数validate_conversion。您传递给它一个值和一个数据类型。然后，Oracle数据库会告诉您它是否可以进行转换。如果可以，它返回一个。否则你得零分。</p><p id="d4ef" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要返回表中可能是实际日期的行，请将其放在where子句中:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="2889" class="jm jn hh ji b fi jo jp l jq jr">select t.* from dodgy_dates t <br/>where validate_conversion(is_this_a_date as date) = 1; </span><span id="18f9" class="jm jn hh ji b fi js jp l jq jr">ID         IS_THIS_A_DATE <br/>---------- -------------------- <br/>3          01-jan-2016</span></pre><p id="220e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">没有错误。但是第二排和第四排去哪里了呢？他们也可能是约会对象！</p><p id="32a9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Validate_conversion一次只测试一种日期格式。默认情况下，这是您的NLS日期格式</p><p id="18e3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">每个客户端都可以设置自己的格式。所以如果你依靠这个，你可能会得到意想不到的结果…</p><p id="272c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了避免这种情况，我强烈建议您将格式作为参数传递。例如:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="9d61" class="jm jn hh ji b fi jo jp l jq jr">select t.* from dodgy_dates t <br/>where  validate_conversion(is_this_a_date as date, 'yyyymmdd') = 1; </span><span id="79db" class="jm jn hh ji b fi js jp l jq jr">ID         IS_THIS_A_DATE <br/>---------- -------------------- <br/>2          20150101</span></pre><p id="f653" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因此，要返回所有可能的日期，您需要多次调用这个函数:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="421c" class="jm jn hh ji b fi jo jp l jq jr">select t.* from dodgy_dates t <br/>where validate_conversion(is_this_a_date as date, 'yyyymmdd') = 1 or<br/>  validate_conversion(is_this_a_date as date, 'dd/mm/yyyy') = 1 or <br/>  validate_conversion(is_this_a_date as date, 'dd-mon-yyyy') = 1; </span><span id="fc5b" class="jm jn hh ji b fi js jp l jq jr">ID         IS_THIS_A_DATE <br/>---------- -------------------- <br/>2          20150101 <br/>3          01-jan-2016 <br/>4          01/01/2016</span></pre><p id="6362" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这不仅仅是为了约会。您可以对以下任何数据类型使用validate_conversion:</p><ul class=""><li id="6512" class="kb kc hh ig b ih ii il im ip kd it ke ix kf jb kg kh ki kj bi translated">binary_double</li><li id="aade" class="kb kc hh ig b ih kk il kl ip km it kn ix ko jb kg kh ki kj bi translated">二进制_浮点</li><li id="f8b8" class="kb kc hh ig b ih kk il kl ip km it kn ix ko jb kg kh ki kj bi translated">日期</li><li id="98ae" class="kb kc hh ig b ih kk il kl ip km it kn ix ko jb kg kh ki kj bi translated">日秒间隔</li><li id="7c23" class="kb kc hh ig b ih kk il kl ip km it kn ix ko jb kg kh ki kj bi translated">年与月的间隔</li><li id="ad3c" class="kb kc hh ig b ih kk il kl ip km it kn ix ko jb kg kh ki kj bi translated">数字</li><li id="f08d" class="kb kc hh ig b ih kk il kl ip km it kn ix ko jb kg kh ki kj bi translated">时间戳</li><li id="d4d9" class="kb kc hh ig b ih kk il kl ip km it kn ix ko jb kg kh ki kj bi translated">带时区的时间戳</li></ul><p id="92f6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您想将字符串转换成日期，那么在select中需要类似的逻辑。这将针对各种格式掩码测试表达式。如果匹配，使用相关掩码调用to_date:</p><pre class="jd je jf jg fd jh ji jj jk aw jl bi"><span id="a99f" class="jm jn hh ji b fi jo jp l jq jr">case <br/>  when <br/>    validate_conversion(is_this_a_date as date, 'yyyymmdd') = 1 <br/>    then to_date(is_this_a_date, 'yyyymmdd') <br/>  when <br/>    validate_conversion(is_this_a_date as date, 'dd/mm/yyyy') = 1 <br/>    then to_date(is_this_a_date, 'dd/mm/yyyy') <br/>  when <br/>    validate_conversion(is_this_a_date as date, 'dd-mon-yyyy') = 1 <br/>    then to_date(is_this_a_date, 'dd-mon-yyyy') <br/>end</span></pre></div><div class="ab cl kp kq go kr" role="separator"><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku kv"/><span class="ks bw bk kt ku"/></div><div class="ha hb hc hd he"><p id="b46b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">【blogs.oracle.com】全文原载于2016年11月10日<a class="ae jc" href="https://blogs.oracle.com/sql/12-things-developers-will-love-about-oracle-database-12c-release-2" rel="noopener ugc nofollow" target="_blank"><em class="kw"/></a><em class="kw">。</em></p></div></div>    
</body>
</html>