<html>
<head>
<title>Poor Man’s Auto Update</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">可怜人的自动更新</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/poor-mans-auto-update-eb5bfdfe39cf?source=collection_archive---------1-----------------------#2022-06-28">https://medium.com/oracledevs/poor-mans-auto-update-eb5bfdfe39cf?source=collection_archive---------1-----------------------#2022-06-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="a734" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">由克里斯·本森</p><figure class="je jf jg jh fd ji er es paragraph-image"><div role="button" tabindex="0" class="jj jk di jl bf jm"><div class="er es jd"><img src="../Images/51bd1642d9a04c44e2ce272e8e5e2b73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eeLt9i2ipA4wIR-EAZ0pBQ.jpeg"/></div></div><figcaption class="jp jq et er es jr js bd b be z dx">Photo by Miguel Á. Padriñán: <a class="ae jc" href="https://www.pexels.com/photo/close-up-shot-of-keys-on-a-red-surface-2882668/" rel="noopener ugc nofollow" target="_blank">https://www.pexels.com/photo/close-up-shot-of-keys-on-a-red-surface-2882668/</a></figcaption></figure><p id="6500" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">回到过去，GitHub允许匿名下载。现在它需要用户名/密码或ssh密钥。当Pi不在你的控制范围内时，那就不好了。因此，介绍克里斯本森穷人的自动更新。无论你做什么，不要在家里这样做，我是专业人士，了解安全漏洞。</p><p id="83d4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">场景是这样的:你有一个运行在你的Raspberry Pi上的脚本，你需要更新它。让我们假设您的脚本被设置为作为一个同步作业在启动时运行。你可以在这里阅读关于在树莓Pi <a class="ae jc" href="https://bc-robotics.com/tutorials/setting-cron-job-raspberry-pi/" rel="noopener ugc nofollow" target="_blank">上设置一个chron作业的信息。</a></p><h1 id="cfb4" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">步伐</h1><ol class=""><li id="f517" class="kr ks hh ig b ih kt il ku ip kv it kw ix kx jb ky kz la lb bi translated">在Pi上创建本地目录结构，其中“file.py”是您的脚本。</li></ol><pre class="je jf jg jh fd lc ld le lf aw lg bi"><span id="9eef" class="lh ju hh ld b fi li lj l lk ll">/updater<br/>├── repo<br/>│ ├── file.py<br/>├── file.py<br/>├── updater.py<br/></span></pre><p id="f4a2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.复制这个bash脚本。</p><p id="7645" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><a class="ae jc" href="https://github.com/chrisbensen/chris-blogs/blob/main/WeekendHacks/PoorManAutoUpdate/files/updater.sh" rel="noopener ugc nofollow" target="_blank"> updater.sh </a></p><pre class="je jf jg jh fd lc ld le lf aw lg bi"><span id="a8e8" class="lh ju hh ld b fi li lj l lk ll">#!/bin/bash</span><span id="aff4" class="lh ju hh ld b fi lm lj l lk ll">curl -X GET \<br/>  &lt;UrlToFile&gt; \<br/>  -o file.py</span><span id="ccbe" class="lh ju hh ld b fi lm lj l lk ll">file1=”/users/pi/updater/repo/file.py”<br/>file2=”/users/pi/updater/file.py”</span><span id="e6cb" class="lh ju hh ld b fi lm lj l lk ll">if cmp -s “$file1” “$file2”; then<br/>  # same, do nothing<br/>  echo “same”<br/>else<br/>  # different<br/>  echo “different”<br/>  cp $file1 $file2</span><span id="eb41" class="lh ju hh ld b fi lm lj l lk ll">  reboot<br/>fi</span></pre><p id="7341" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3.创建Oracle云对象存储桶。<br/> 4。公开那个桶。<br/> 5。将您的文件复制到桶中。<br/> 6。通过更改&lt; UrlToFile &gt;来编辑脚本。从Object Details中获取URL，并从末尾删除文件名，这样就只有URL的以下部分:<code class="du ln lo lp ld b">{accountRestEndpointURL}/{containerName}/{objectName}</code> <br/> 7。编辑脚本，使路径正确。<br/> 8。设置一个同步作业，根据需要随时运行“updater.py”来检查更新。每5分钟一次可能有点过了，但是让我们从这开始吧。你可以在这里阅读关于在树莓Pi <a class="ae jc" href="https://bc-robotics.com/tutorials/setting-cron-job-raspberry-pi/" rel="noopener ugc nofollow" target="_blank">上设置一个chron作业的信息。</a></p><p id="f5f9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">您可以在这里阅读关于从对象存储<a class="ae jc" href="https://docs.oracle.com/en/cloud/cloud-at-customer/occ-get-started/download-file.html" rel="noopener ugc nofollow" target="_blank">下载文件的文档。</a></p><h1 id="efb8" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">概观</h1><p id="9633" class="pw-post-body-paragraph ie if hh ig b ih kt ij ik il ku in io ip lq ir is it lr iv iw ix ls iz ja jb ha bi translated">文件<code class="du ln lo lp ld b">updater/repo/file.py</code>是被复制下来的文件。然后，该脚本将其与更新程序目录中的文件进行比较。如果它们是不同的，更新目录用新的更新。<code class="du ln lo lp ld b">updater/file.py</code>是您希望符号链接指向的人。</p><p id="9fde" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><code class="du ln lo lp ld b">updater.py</code>中的<strong class="ig hi">重启</strong>将重启Pi，启动更新后的<code class="du ln lo lp ld b">file.py</code>脚本。我知道这不是绝对最好的方法，但它确实有效，而且相当简单。</p><p id="bd27" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所以你有它，一个穷人的自动更新。</p><h1 id="92c3" class="jt ju hh bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">结论</h1><p id="dd14" class="pw-post-body-paragraph ie if hh ig b ih kt ij ik il ku in io ip lq ir is it lr iv iw ix ls iz ja jb ha bi translated">现在我确实知道，有了OCI对象存储，你可以使用一个API进行预认证请求。如果您使用来自Pi的REST调用，您可以保持对象存储私有。然而，这是额外的工作，我将把它留给用户，或者以后的文章！</p><p id="c82d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">同时，你可以在我们的公共Slack 上谈论这个<a class="ae jc" href="https://bit.ly/devrel_slack" rel="noopener ugc nofollow" target="_blank">，或者</a><a class="ae jc" href="https://signup.cloud.oracle.com/?language=en&amp;sourceType=:ex:tb:::::&amp;SC=:ex:tb:::::&amp;pcode=" rel="noopener ugc nofollow" target="_blank">注册免费等级</a>并亲自尝试。</p></div></div>    
</body>
</html>