<html>
<head>
<title>Restore RecyclerView scroll position</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">恢复RecyclerView视图滚动位置</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/restore-recyclerview-scroll-position-a8fbdc9a9334?source=collection_archive---------0-----------------------#2020-05-04">https://medium.com/androiddevelopers/restore-recyclerview-scroll-position-a8fbdc9a9334?source=collection_archive---------0-----------------------#2020-05-04</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/3ef0d041827392982de1593b540e5bf6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Puym1q-RbTIqxvBDFlXpLA.png"/></div></div><figcaption class="hq hr et er es hs ht bd b be z dx">Illustration by <a class="ae hu" href="https://www.instagram.com/elladobbie/" rel="noopener ugc nofollow" target="_blank">Ella Dobson</a></figcaption></figure><div class=""/><p id="f391" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">你可能遇到过这样的问题:当你的<code class="du js jt ju jv b">Activity</code> / <code class="du js jt ju jv b">Fragment</code>被重新创建时，一个<code class="du js jt ju jv b">RecyclerView</code>丢失了滚动位置。这通常是因为<code class="du js jt ju jv b">Adapter</code>数据是异步加载的，在<code class="du js jt ju jv b">RecyclerView</code>需要布局时数据还没有加载，所以无法恢复滚动位置。</p><p id="3644" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">从<code class="du js jt ju jv b"><a class="ae hu" href="https://developer.android.com/jetpack/androidx/releases/recyclerview" rel="noopener ugc nofollow" target="_blank"><strong class="iw hy">1.2.0-alpha02</strong></a></code>开始，<code class="du js jt ju jv b">RecyclerView</code>提供了一个新的API，让<code class="du js jt ju jv b">Adapter</code> <strong class="iw hy">块布局恢复，直到它准备好</strong>。请继续阅读，了解如何使用这个新的API以及它是如何工作的。</p><h1 id="e2f2" class="jw jx hx bd jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt bi translated">恢复滚动位置</h1><p id="afe2" class="pw-post-body-paragraph iu iv hx iw b ix ku iz ja jb kv jd je jf kw jh ji jj kx jl jm jn ky jp jq jr ha bi translated">有几种方法可以确保您可能已经采用的正确滚动位置。最好的方法是确保在第一次布局通过之前总是在<code class="du js jt ju jv b">Adapter</code>上设置数据，方法是将您想要显示的数据缓存在内存、<code class="du js jt ju jv b">ViewModel</code>或存储库中。如果这种方法不可行，其他解决方案要么更复杂，比如避免在<code class="du js jt ju jv b">RecyclerView</code>上设置<code class="du js jt ju jv b">Adapter</code>，这可能会带来标题等项目的问题，要么误用<code class="du js jt ju jv b"><a class="ae hu" href="https://developer.android.com/reference/androidx/recyclerview/widget/RecyclerView.LayoutManager?hl=en#onRestoreInstanceState(android.os.Parcelable)https://developer.android.com/reference/androidx/recyclerview/widget/RecyclerView.LayoutManager?hl=en#onRestoreInstanceState(android.os.Parcelable)" rel="noopener ugc nofollow" target="_blank">LayoutManager.onRestoreInstanceState</a></code> API。</p><p id="b493" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><code class="du js jt ju jv b">recyclerview:1.2.0-alpha02</code>解决方案是一种新的<code class="du js jt ju jv b">Adapter</code>方法，允许您设置状态恢复策略(通过<code class="du js jt ju jv b"><a class="ae hu" href="https://developer.android.com/reference/androidx/recyclerview/widget/RecyclerView.Adapter.StateRestorationPolicy" rel="noopener ugc nofollow" target="_blank">StateRestorationPolicy</a></code>枚举)。这有3个选项:</p><ul class=""><li id="921a" class="kz la hx iw b ix iy jb jc jf lb jj lc jn ld jr le lf lg lh bi translated"><code class="du js jt ju jv b"><a class="ae hu" href="https://developer.android.com/reference/androidx/recyclerview/widget/RecyclerView.Adapter.StateRestorationPolicy#ALLOW" rel="noopener ugc nofollow" target="_blank">ALLOW</a></code>—<em class="li">默认</em>状态，在下一个布局走刀中立即恢复<code class="du js jt ju jv b">RecyclerView</code>状态</li><li id="192f" class="kz la hx iw b ix lj jb lk jf ll jj lm jn ln jr le lf lg lh bi translated"><code class="du js jt ju jv b"><a class="ae hu" href="https://developer.android.com/reference/androidx/recyclerview/widget/RecyclerView.Adapter.StateRestorationPolicy#PREVENT_WHEN_EMPTY" rel="noopener ugc nofollow" target="_blank">PREVENT_WHEN_EMPTY</a></code> —仅当适配器不为空时恢复<code class="du js jt ju jv b">RecyclerView</code>状态(<code class="du js jt ju jv b">adapter.getItemCount() &gt; 0</code>)。如果您的数据是异步加载的，<code class="du js jt ju jv b">RecyclerView</code>会一直等待，直到数据加载完毕，然后状态才会恢复。如果您有默认项目，如标题或装载进度指示器作为您的<code class="du js jt ju jv b">Adapter</code>的一部分，那么您应该使用<code class="du js jt ju jv b">PREVENT</code>选项，除非默认项目是使用<code class="du js jt ju jv b"><a class="ae hu" href="https://developer.android.com/reference/androidx/recyclerview/widget/ConcatAdapter" rel="noopener ugc nofollow" target="_blank">ConcatAdapter</a></code>添加的(点击了解更多<a class="ae hu" rel="noopener" href="/androiddevelopers/merge-adapters-sequentially-with-mergeadapter-294d2942127a">)。<code class="du js jt ju jv b">ConcatAdapter</code>等待其所有适配器准备就绪，然后才恢复状态。</a></li><li id="4cf9" class="kz la hx iw b ix lj jb lk jf ll jj lm jn ln jr le lf lg lh bi translated"><code class="du js jt ju jv b"><a class="ae hu" href="https://developer.android.com/reference/androidx/recyclerview/widget/RecyclerView.Adapter.StateRestorationPolicy#PREVENT" rel="noopener ugc nofollow" target="_blank">PREVENT</a></code> —所有状态恢复被推迟，直到您设置<code class="du js jt ju jv b">ALLOW</code>或<code class="du js jt ju jv b">PREVENT_WHEN_EMPTY</code>。</li></ul><p id="b350" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在适配器上设置状态恢复策略，如下所示:</p><pre class="lo lp lq lr fd ls jv lt lu aw lv bi"><span id="ecc8" class="lw jx hx jv b fi lx ly l lz ma">adapter.stateRestorationPolicy = PREVENT_WHEN_EMPTY</span></pre></div><div class="ab cl mb mc go md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ha hb hc hd he"><p id="fb2a" class="pw-post-body-paragraph iu iv hx iw b ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">就是这样！一个简短而甜蜜的帖子，让你了解<code class="du js jt ju jv b">RecyclerView</code>的懒惰状态恢复特性。开始使用它🏁👩‍💻👨‍💻！</p></div></div>    
</body>
</html>