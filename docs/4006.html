<html>
<head>
<title>The power of Chrome Devtools Protocol</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Chrome Devtools协议的力量</h1>
<blockquote>原文：<a href="https://medium.com/globant/the-power-of-chrome-devtools-protocol-cbb2c47f1c29?source=collection_archive---------0-----------------------#2022-10-11">https://medium.com/globant/the-power-of-chrome-devtools-protocol-cbb2c47f1c29?source=collection_archive---------0-----------------------#2022-10-11</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="bd4b" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">第一部分—追踪域</h2></div><figure class="ix iy iz ja fd jb er es paragraph-image"><div class="er es iw"><img src="../Images/ee0312d22b1594e2fb197685ce291c01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/0*zsiauewyoOnZafVF"/></div></figure><p id="acb2" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">首先，我想描述一下CDP是什么意思。<a class="ae ka" href="https://chromedevtools.github.io/devtools-protocol/" rel="noopener ugc nofollow" target="_blank">“Chrome Devtools协议”</a>是一个强大的调试和剖析Chrome的协议。通过这个协议，你将可以访问不同的“域”,这将允许你像使用Chrome开发工具那样与浏览器进行交互。这就是测试自动化和性能测试出现的时候，我想通过描述如何独立于任何自动化工具将CDP集成到测试自动化或性能测试过程中来开始这篇文章，只需使用CDP而无需做太多的工作。在您可以使用的功能之间，有跟踪、性能、模拟网络条件(网络节流)、读取控制台消息、模拟地理位置等等。</p><p id="c0ae" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">我将在这篇文章中描述一些在测试过程中发生在日常生活中的测试场景，它将利用这个伟大的协议，你将通过编程访问Chrome拥有的宝石。</p><p id="30a9" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">文章分为不同的部分，如:</p><ul class=""><li id="8ebf" class="kb kc hh jg b jh ji jk jl jn kd jr ke jv kf jz kg kh ki kj bi translated"><a class="ae ka" href="https://chromedevtools.github.io/devtools-protocol/tot/Tracing/" rel="noopener ugc nofollow" target="_blank">跟踪</a>域，它将允许您获取跟踪指标。</li><li id="4c85" class="kb kc hh jg b jh kk jk kl jn km jr kn jv ko jz kg kh ki kj bi translated"><a class="ae ka" href="https://chromedevtools.github.io/devtools-protocol/tot/Network/" rel="noopener ugc nofollow" target="_blank">网络</a>域，我们将捕获网络请求并将其导出到HAR文件。</li><li id="78d9" class="kb kc hh jg b jh kk jk kl jn km jr kn jv ko jz kg kh ki kj bi translated">R <a class="ae ka" href="https://chromedevtools.github.io/devtools-protocol/tot/Runtime/" rel="noopener ugc nofollow" target="_blank"> untime </a>域，允许我们从浏览器中提取控制台日志、错误和警告。</li><li id="28c5" class="kb kc hh jg b jh kk jk kl jn km jr kn jv ko jz kg kh ki kj bi translated"><a class="ae ka" href="https://chromedevtools.github.io/devtools-protocol/tot/Performance/" rel="noopener ugc nofollow" target="_blank">性能</a>允许您获取性能指标的域。</li></ul><h1 id="b159" class="kp kq hh bd kr ks kt ku kv kw kx ky kz in la io lb iq lc ir ld it le iu lf lg bi translated">必需的包</h1><p id="dc86" class="pw-post-body-paragraph je jf hh jg b jh lh ii jj jk li il jm jn lj jp jq jr lk jt ju jv ll jx jy jz ha bi translated">使用CDP需要一些依赖项。我已经将它们添加到我的package.json文件中，作为每个域提供的不同特性的实用工具。</p><pre class="ix iy iz ja fd lm ln lo lp aw lq bi"><span id="b31c" class="lr kq hh ln b fi ls lt l lu lv">npm install chrome-remote-interface<br/>npm install chrome-har<br/>npm install devtools-protocol<br/>npm install <a class="ae ka" href="http://twitter.com/types/har-format" rel="noopener ugc nofollow" target="_blank">@types/har-format</a></span></pre><h2 id="5308" class="lr kq hh bd kr lw lx ly kv lz ma mb kz jn mc md lb jr me mf ld jv mg mh lf mi bi translated">包装参考</h2><ul class=""><li id="02c4" class="kb kc hh jg b jh lh jk li jn mj jr mk jv ml jz kg kh ki kj bi translated"><strong class="jg hi">chrome-remote-interface</strong>→CDP上的抽象。这里可以找到<a class="ae ka" href="https://github.com/cyrus-and/chrome-remote-interface" rel="noopener ugc nofollow" target="_blank">这里</a>。</li><li id="34dc" class="kb kc hh jg b jh kk jk kl jn km jr kn jv ko jz kg kh ki kj bi translated"><strong class="jg hi"> chrome-har </strong> →将网络事件消息转换为har格式。这里可以找到<a class="ae ka" href="https://github.com/sitespeedio/chrome-har" rel="noopener ugc nofollow" target="_blank">。</a></li><li id="ecfb" class="kb kc hh jg b jh kk jk kl jn km jr kn jv ko jz kg kh ki kj bi translated"><strong class="jg hi"> devtools-protoco </strong> l →协议类型的类型脚本定义。这里可以找到<a class="ae ka" href="https://www.npmjs.com/package/devtools-protocol" rel="noopener ugc nofollow" target="_blank">的</a>。</li><li id="23b3" class="kb kc hh jg b jh kk jk kl jn km jr kn jv ko jz kg kh ki kj bi translated"><strong class="jg hi">@ types/har-format</strong>→har格式的打字稿定义。这里可以找到<a class="ae ka" href="https://www.npmjs.com/package/@types/har-format" rel="noopener ugc nofollow" target="_blank"/>。</li></ul><h1 id="e323" class="kp kq hh bd kr ks kt ku kv kw kx ky kz in la io lb iq lc ir ld it le iu lf lg bi translated">放弃</h1><p id="fca7" class="pw-post-body-paragraph je jf hh jg b jh lh ii jj jk li il jm jn lj jp jq jr lk jt ju jv ll jx jy jz ha bi translated">由于这篇文章和更多的调查工作，我已经在提到的包之上开发了一个包装器，它将展示如何使用这个协议。它可以在https://github.com/germanbisogno/cdp-utils的<a class="ae ka" href="https://github.com/germanbisogno/cdp-utils" rel="noopener ugc nofollow" target="_blank">找到，它不是任何实际工具或库的替代品；相反，它只是一个包装器，带有用于测试自动化或性能测试的通用工具。如果您希望在您的项目中使用提到的包，您可以使用chrome-remote-interface或chrome-har直接导入这些包，就像该项目在其package.json中引用的那样。</a></p><p id="500f" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">请查看下图，以便更好地理解:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="er es mm"><img src="../Images/79976389c7f0241dbe42740e30e3a467.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*NzjoCqrytNAxqRsW"/></div></div><figcaption class="mr ms et er es mt mu bd b be z dx">A basic representation of how Test Frameworks can interact with CDP through Chrome Remote Interface.</figcaption></figure><h1 id="27c8" class="kp kq hh bd kr ks kt ku kv kw kx ky kz in la io lb iq lc ir ld it le iu lf lg bi translated">使用跟踪域</h1><p id="cc61" class="pw-post-body-paragraph je jf hh jg b jh lh ii jj jk li il jm jn lj jp jq jr lk jt ju jv ll jx jy jz ha bi translated">Chrome开发者工具允许你记录性能，你可以将它导出到一个JSON文件，如下图所示，你可以使用开发者工具手动完成:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="er es mv"><img src="../Images/4db7e8f37c85c20fdc542c41814af4db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*r2ZAlpK9b-KHsBFY"/></div></div><figcaption class="mr ms et er es mt mu bd b be z dx">The tab shown in the image above is to Analyze runtime performance. You can start the recording by clicking in the top left circle.</figcaption></figure><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="er es mw"><img src="../Images/91466d505c6a2e1ae7e292ff8e635596.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*v8HpvZfVnOtsdTej"/></div></div><figcaption class="mr ms et er es mt mu bd b be z dx">The image above shows the recording in progress.</figcaption></figure><p id="fecf" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">对于这个例子，我们将记录一个简单的在Google中搜索的测试动作。完成记录后，它会显示许多关于跟踪的丰富信息，例如:</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="er es mx"><img src="../Images/f29a6faad52533790a05eee29f8c9521.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ivxp7fHgd_d7QOiI"/></div></div><figcaption class="mr ms et er es mt mu bd b be z dx">How the result of a recording looks like.</figcaption></figure><p id="5054" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">正如你所看到的，有关于加载、脚本、渲染和绘画的信息，它还捕捉了我的手动测试的截图(在谷歌中搜索)。</p><p id="41e7" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">如果你需要更多关于如何使用性能标签的信息，你可以点击查看<a class="ae ka" href="https://developer.chrome.com/docs/devtools/evaluate-performance/reference/" rel="noopener ugc nofollow" target="_blank">。</a></p><h1 id="2f11" class="kp kq hh bd kr ks kt ku kv kw kx ky kz in la io lb iq lc ir ld it le iu lf lg bi translated">我们如何实现自动化？</h1><p id="1b3e" class="pw-post-body-paragraph je jf hh jg b jh lh ii jj jk li il jm jn lj jp jq jr lk jt ju jv ll jx jy jz ha bi translated">这可以通过使用<a class="ae ka" href="https://chromedevtools.github.io/devtools-protocol/tot/Tracing/" rel="noopener ugc nofollow" target="_blank">跟踪</a>域来完成，该域目前是CDP中的一个实验性功能，将捕获我们之前使用开发人员工具所做的工作。</p><p id="40fc" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">请注意，像<a class="ae ka" href="https://github.com/puppeteer/puppeteer" rel="noopener ugc nofollow" target="_blank">木偶师</a>、<a class="ae ka" href="https://github.com/DevExpress/testcafe" rel="noopener ugc nofollow" target="_blank">测试咖啡馆</a>和<a class="ae ka" href="https://www.selenium.dev/blog/2021/announcing-selenium-4/" rel="noopener ugc nofollow" target="_blank"> Selenium 4 </a>这样的优秀框架已经在使用这个协议。你也可以看看这些并实现它们。</p><p id="4392" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">我们将使用CDP，我选择了Selenium作为测试框架来展示如何将其与该协议集成。现在，让我们进入代码！</p><p id="9346" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">首先，我们需要为CDP连接创建一个cdpClient.ts文件:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="my mz l"/></div></figure><p id="24d8" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">现在我们有了一个实例化CDP客户端的类，让我们创建一个抽象类traceOperations.ts，在这种情况下为<code class="du na nb nc ln b">startTrace</code>和<code class="du na nb nc ln b">stopTrace</code>定义两个功能，然后我们将从这个类扩展到其余的专用类。</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="my mz l"/></div></figure><p id="e626" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">请注意，当我们停止跟踪时，将有可能从不同的域中检索数据，如运行时、跟踪和性能，其中包括在我们开始和停止跟踪时获取指标。</p><p id="2564" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">让我们实现<code class="du na nb nc ln b">Tracing</code>类并从<code class="du na nb nc ln b">TraceOperations.</code>扩展它</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="my mz l"/></div></figure><p id="29bc" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">我们在这里使用了一些命令，如<code class="du na nb nc ln b">Tracing.start</code>，它将启动跟踪并接收跟踪配置，我们稍后将描述可以在其上配置什么。</p><p id="c6b4" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">我们利用两个事件<code class="du na nb nc ln b">Tracing.dataCollected</code>来从Chrome中产生的事件中收集数据，以及在数据收集后执行<code class="du na nb nc ln b">Tracing.End</code>时调用的<code class="du na nb nc ln b">Tracing.tracingComplete</code>，然后我们将能够将跟踪存储到一个JSON文件中，该文件可以从Chrome中导入，或者只是将事件返回到测试中，并执行断言或任何其他您想要对数据执行的操作。</p><p id="9a29" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">有关跟踪事件格式的更多信息，请参见此<a class="ae ka" href="https://docs.google.com/document/d/1CvAClvFfyA5R-PhYUmn5OOQtYMH4h6I0nSsKchNAySU/preview" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><h1 id="1e1a" class="kp kq hh bd kr ks kt ku kv kw kx ky kz in la io lb iq lc ir ld it le iu lf lg bi translated">配置文件</h1><p id="59b6" class="pw-post-body-paragraph je jf hh jg b jh lh ii jj jk li il jm jn lj jp jq jr lk jt ju jv ll jx jy jz ha bi translated">请注意，<code class="du na nb nc ln b">Tracing.start</code>命令需要一个配置，此处描述为<a class="ae ka" href="https://chromedevtools.github.io/devtools-protocol/tot/Tracing/#type-TraceConfig" rel="noopener ugc nofollow" target="_blank"/>，在本例中，我们提供了cdp.config.json部分，其中指定了我们希望包含在跟踪中的类别。例如:</p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="my mz l"/></div></figure><p id="99d5" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">注意第5行中使用了“-*”。您排除了任何类别，在本例中，我们已经明确指定了它们，例如，“disabled-by-default-dev tools . screen shot”将用于在我们的跟踪中包含屏幕截图。</p><h1 id="0275" class="kp kq hh bd kr ks kt ku kv kw kx ky kz in la io lb iq lc ir ld it le iu lf lg bi translated">开发一个测试！</h1><p id="ca2c" class="pw-post-body-paragraph je jf hh jg b jh lh ii jj jk li il jm jn lj jp jq jr lk jt ju jv ll jx jy jz ha bi translated">我们有一个类来建立客户端连接，另一个类来执行跟踪。因此，让我们在Selenium测试中实现它们吧！。它将在谷歌搜索给定的标准。</p><p id="2d96" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">值得一提的是，在下面的例子中，我们使用POM ( <em class="nd">页面对象模型</em>，一种用于测试自动化的模式)来创建一个Google页面。你可以在这里找到更多关于这个模式<a class="ae ka" href="https://www.browserstack.com/guide/page-object-model-in-selenium" rel="noopener ugc nofollow" target="_blank">的详细信息。</a></p><figure class="ix iy iz ja fd jb"><div class="bz dy l di"><div class="my mz l"/></div></figure><p id="cf90" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">请注意，在前面的代码中需要强调几件重要的事情— remote-debugging-port=${port}。这将需要在一个特定的端口，通常是9222，使用CDP来启动Chrome。在本例中，我们使用endpoint-utils包来获得一个空闲端口；这里可以找到<a class="ae ka" href="https://github.com/inikulin/endpoint-utils" rel="noopener ugc nofollow" target="_blank">。如果您正在并行运行测试，那么最好使用一个工具来为每个CDP会话获取一个空闲端口。</a></p><p id="6b67" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">最后，我们可以在Chrome中导入tracing.json文件，瞧！我们手中又有了丰富的信息！</p><figure class="ix iy iz ja fd jb er es paragraph-image"><div role="button" tabindex="0" class="mn mo di mp bf mq"><div class="er es mv"><img src="../Images/555456f936a735b791c123ca9b433e2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lxoM4Qu8CLAbZq0o"/></div></div><figcaption class="mr ms et er es mt mu bd b be z dx">Importing the resulting file into the performance tab in Chrome.</figcaption></figure><p id="fcf8" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">希望你已经享受了前一节，你可以开始使用跟踪域了！</p><h1 id="1377" class="kp kq hh bd kr ks kt ku kv kw kx ky kz in la io lb iq lc ir ld it le iu lf lg bi translated">结论</h1><p id="7953" class="pw-post-body-paragraph je jf hh jg b jh lh ii jj jk li il jm jn lj jp jq jr lk jt ju jv ll jx jy jz ha bi translated">我们讨论了跟踪领域和它的一些不同特性，正如你所看到的，这就是为什么我把这篇文章称为“CDP的力量”。这是非常强大的，我们可以利用Chrome和许多其他领域进行许多操作，这对开发人员和测试人员或任何对这个伟大协议感兴趣的人来说都是一个真正的瑰宝。当您测试您的应用程序、创建基线和监控您的测试结果时，有许多丰富的信息需要获取。</p><p id="a0fd" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">我们将在接下来的文章中继续讨论更多的领域。我还想介绍更多关于处理所有这些信息的内容，并通过引入更多的处理和报告工具以一种时尚的方式将其可视化。</p><p id="13f5" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated">希望你喜欢这次旅行！下次见！</p><p id="77f9" class="pw-post-body-paragraph je jf hh jg b jh ji ii jj jk jl il jm jn jo jp jq jr js jt ju jv jw jx jy jz ha bi translated"><strong class="jg hi">感谢阅读！</strong></p></div></div>    
</body>
</html>