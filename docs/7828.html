<html>
<head>
<title>React Native Memory profiling (JSC vs V8 vs Hermes)</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">React本机内存分析(JSC vs V8 vs Hermes)</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/react-native-memory-profiling-jsc-vs-v8-vs-hermes-1626949a653b?source=collection_archive---------0-----------------------#2019-12-06">https://medium.com/walmartglobaltech/react-native-memory-profiling-jsc-vs-v8-vs-hermes-1626949a653b?source=collection_archive---------0-----------------------#2019-12-06</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/aeabc780ac257b8be0da494730b5080f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1220/format:webp/1*gnJPYjsowUCRhz1rHPe1jg.png"/></div></div></figure><p id="f913" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们的Android应用程序面临着内存问题，因为斯托克·JSC在Android中进行了最少的垃圾收集。我们尝试了各种方法来减少应用程序的内存占用，但都没有成功。<br/>对于包含大量条目(在我们的例子中大约1k)的react本机平面列表，这个问题变得非常严重。随着屏幕之间的每次导航，内存不断增加，甚至在清除数据后也没有下降。</p><h1 id="93cb" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">救助者</h1><p id="8dfe" class="pw-post-body-paragraph ip iq hh ir b is kl iu iv iw km iy iz ja kn jc jd je ko jg jh ji kp jk jl jm ha bi translated">2019年6月中旬，@kudochien在推特上发布了关于<a class="ae kq" href="https://www.npmjs.com/package/react-native-v8" rel="noopener ugc nofollow" target="_blank"> react-native-v8 </a>包的消息，该包可以使我们将v8与react-native for android捆绑在一起，而不是JSC。</p><figure class="kr ks kt ku fd ii"><div class="bz dy l di"><div class="kv kw l"/></div></figure><p id="2f00" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">与此同时，<a class="ae kq" href="https://www.npmjs.com/package/jsc-android/v/245459.0.0" rel="noopener ugc nofollow" target="_blank"> jsc-android </a>发布了新版本245459.0.0，Hermes也在@ChainReactConf期间发布。</p><p id="3114" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">因此，我们决定比较<a class="ae kq" href="https://www.npmjs.com/package/jsc-android/v/241213.1.0" rel="noopener ugc nofollow" target="_blank">股票JSC (v241213.1.0) </a>、新<a class="ae kq" href="https://www.npmjs.com/package/jsc-android/v/245459.0.0" rel="noopener ugc nofollow" target="_blank"> JSC(v245459.0.0) </a>、<a class="ae kq" href="https://facebook.github.io/react-native/docs/hermes/" rel="noopener ugc nofollow" target="_blank">爱马仕</a>和<a class="ae kq" href="https://www.npmjs.com/package/react-native-v8" rel="noopener ugc nofollow" target="_blank"> react-native-v8 </a>的内存占用。</p><p id="ff68" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了模拟真实世界的用例，我们创建了一个样本存储库。</p><div class="kx ky ez fb kz la"><a href="https://github.com/bhaskarGyan/react-native-memory-profile" rel="noopener  ugc nofollow" target="_blank"><div class="lb ab dw"><div class="lc ab ld cl cj le"><h2 class="bd hi fi z dy lf ea eb lg ed ef hg bi translated">bhaskarGyan/react-native-memory-profile</h2><div class="lh l"><h3 class="bd b fi z dy lf ea eb lg ed ef dx translated">要对其进行内存分析的签出分支npm i在单独的终端中运行服务器，npm运行…</h3></div><div class="li l"><p class="bd b fp z dy lf ea eb lg ed ef dx translated">github.com</p></div></div><div class="lj l"><div class="lk l ll lm ln lj lo in la"/></div></div></a></div><p id="a67f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们考虑了以下用例:</p><ol class=""><li id="b701" class="lp lq hh ir b is it iw ix ja lr je ls ji lt jm lu lv lw lx bi translated">包含约1k个项目的平面列表</li><li id="3f9c" class="lp lq hh ir b is ly iw lz ja ma je mb ji mc jm lu lv lw lx bi translated">巨大的数组列表来模拟存储/删除大记录(一个记录是新数组(999999))。在反应状态下加入(“—”)</li><li id="e5b5" class="lp lq hh ir b is ly iw lz ja ma je mb ji mc jm lu lv lw lx bi translated">使用<a class="ae kq" href="https://www.npmjs.com/package/react-navigation" rel="noopener ugc nofollow" target="_blank">反应导航</a>的内存占用</li></ol><p id="9b76" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> ABI用过的</strong> - &gt; x86_64</p><h1 id="bdbf" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">观察</h1><h2 id="c005" class="md jo hh bd jp me mf mg jt mh mi mj jx ja mk ml kb je mm mn kf ji mo mp kj mq bi translated">TL；速度三角形定位法(dead reckoning)</h2><p id="ab49" class="pw-post-body-paragraph ip iq hh ir b is kl iu iv iw km iy iz ja kn jc jd je ko jg jh ji kp jk jl jm ha bi translated">新JSC v241213.1.0处理内存的能力强于之前的版本v241213.1.0，其次是爱马仕。</p><p id="f450" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然而，react-native-v8在应用启动内存、处理平面列表的内存、处理大数据的内存占用以及最重要的垃圾收集方面远远超过了他们。</p><figure class="kr ks kt ku fd ii"><div class="bz dy l di"><div class="kv kw l"/></div></figure><h1 id="68d9" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">示例应用程序</h1><figure class="kr ks kt ku fd ii er es paragraph-image"><div class="er es mr"><img src="../Images/699265dcbce3963a9bcd721720945ce5.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/1*Oe1HTcr-QidgeBWpFjLtFg.png"/></div><figcaption class="ms mt et er es mu mv bd b be z dx">App Home Screen</figcaption></figure><h1 id="936c" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">步伐</h1><ul class=""><li id="2472" class="lp lq hh ir b is kl iw km ja mw je mx ji my jm mz lv lw lx bi translated">主页-&gt;平面列表</li><li id="b0c3" class="lp lq hh ir b is ly iw lz ja ma je mb ji mc jm mz lv lw lx bi translated">滚动到最后一项(870项)-&gt;主页</li><li id="61e8" class="lp lq hh ir b is ly iw lz ja ma je mb ji mc jm mz lv lw lx bi translated">内存饥渴数组-&gt;添加记录(100) -&gt;删除-&gt;首页</li><li id="6f90" class="lp lq hh ir b is ly iw lz ja ma je mb ji mc jm mz lv lw lx bi translated">平面列表-&gt;内存饥饿数组-&gt;添加记录(100) -&gt;主页</li></ul><h1 id="b455" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">结果</h1><h2 id="158a" class="md jo hh bd jp me mf mg jt mh mi mj jx ja mk ml kb je mm mn kf ji mo mp kj mq bi translated">库存JSC (v241213.1.0)</h2><p id="e89b" class="pw-post-body-paragraph ip iq hh ir b is kl iu iv iw km iy iz ja kn jc jd je ko jg jh ji kp jk jl jm ha bi translated">这是三个国家中表现最差的。内存占用非常高，垃圾收集很少</p><p id="8921" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> App启动内存(MB) </strong> — 59(总)，20 (JS) <br/> <strong class="ir hi">平单加载后(MB) (870项)</strong> - &gt; 239(总)，128 (JS) <br/> <strong class="ir hi">添加记录后(添加16条记录后App崩溃)(MB) </strong> - &gt; 1153(总)，1098(JS) <br/> <strong class="ir hi">垃圾回收</strong> —最小</p><h2 id="e2bf" class="md jo hh bd jp me mf mg jt mh mi mj jx ja mk ml kb je mm mn kf ji mo mp kj mq bi translated">内存消耗图</h2><figure class="kr ks kt ku fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es na"><img src="../Images/59a32ea10849fa7954fdace8ad363fd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P5Hk-3dt884gMxWn9aVpyQ.png"/></div></div><figcaption class="ms mt et er es mu mv bd b be z dx">Stock JSC Memory Graph</figcaption></figure><h2 id="d0cf" class="md jo hh bd jp me mf mg jt mh mi mj jx ja mk ml kb je mm mn kf ji mo mp kj mq bi translated">新JSC (v245459.0.0)</h2><p id="2524" class="pw-post-body-paragraph ip iq hh ir b is kl iu iv iw km iy iz ja kn jc jd je ko jg jh ji kp jk jl jm ha bi translated">在处理内存和垃圾收集方面，它比JSC股票要好。</p><p id="746a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> App启动内存(MB) </strong> — 53(合计)、15 (JS) <br/> <strong class="ir hi">平单加载后(MB) (870项)</strong> - &gt; 191(合计)、107 (JS) <br/> <strong class="ir hi">添加记录后(MB) </strong> - &gt; 714(合计)、596(JS) <br/> <strong class="ir hi">垃圾回收</strong> - &gt;是的，内存降到了20</p><h2 id="dfbe" class="md jo hh bd jp me mf mg jt mh mi mj jx ja mk ml kb je mm mn kf ji mo mp kj mq bi translated">内存消耗图</h2><figure class="kr ks kt ku fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es na"><img src="../Images/255df079613155cb155ced0ef7405bda.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3xoU0tTH_EZnkjwnDpEtpg.png"/></div></div><figcaption class="ms mt et er es mu mv bd b be z dx">New JSC Memory Graph</figcaption></figure><h2 id="86cd" class="md jo hh bd jp me mf mg jt mh mi mj jx ja mk ml kb je mm mn kf ji mo mp kj mq bi translated">React-Native-V8</h2><p id="fa4f" class="pw-post-body-paragraph ip iq hh ir b is kl iu iv iw km iy iz ja kn jc jd je ko jg jh ji kp jk jl jm ha bi translated"><strong class="ir hi"> App启动内存(MB) </strong> — 40(总)，9(JS)[↓55%(JS)】<br/><strong class="ir hi">平单加载后(MB) (870项)</strong> - &gt; 105(总)，36(JS)[↓70%(JS)<br/><strong class="ir hi">添加记录后(100) </strong> - &gt; 82(总)，25(JS)【GC ran in-中</p><h2 id="3463" class="md jo hh bd jp me mf mg jt mh mi mj jx ja mk ml kb je mm mn kf ji mo mp kj mq bi translated">内存消耗图</h2><figure class="kr ks kt ku fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es na"><img src="../Images/af83e9e656746894a133141b98d7e194.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r6jFyFL-bIT1vp9r5Uiwcg.png"/></div></div><figcaption class="ms mt et er es mu mv bd b be z dx">React-Native-V8 Memory Graph</figcaption></figure><h2 id="31b7" class="md jo hh bd jp me mf mg jt mh mi mj jx ja mk ml kb je mm mn kf ji mo mp kj mq bi translated">爱马仕</h2><p id="ab48" class="pw-post-body-paragraph ip iq hh ir b is kl iu iv iw km iy iz ja kn jc jd je ko jg jh ji kp jk jl jm ha bi translated">爱马仕于2019年7月11日@ChainReactConf公布。它是一个开源的JavaScript引擎，针对在Android上运行React原生应用进行了优化。</p><p id="1da1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> App启动内存(MB) </strong> — 33(总)，7(JS)[↓65%(JS)】<br/><strong class="ir hi">平表加载后(MB) (870项)</strong> - &gt; 397(总)，110(JS)<br/><strong class="ir hi">GC后(MB) ** - &gt; 358(总)，48(JS)<br/>* *添加记录后(添加50条记录后App崩溃)【T44</strong></p><h2 id="8287" class="md jo hh bd jp me mf mg jt mh mi mj jx ja mk ml kb je mm mn kf ji mo mp kj mq bi translated">内存消耗图</h2><figure class="kr ks kt ku fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es na"><img src="../Images/5f98d02d206e9aa0ea96c10361ca5c78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hSBUsE5NOrTbPngaU8smPw.png"/></div></div><figcaption class="ms mt et er es mu mv bd b be z dx">Hermes Memory Graph</figcaption></figure><h1 id="2c14" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">结论:</h1><p id="03b5" class="pw-post-body-paragraph ip iq hh ir b is kl iu iv iw km iy iz ja kn jc jd je ko jg jh ji kp jk jl jm ha bi translated">根据内存分析图，react-native-v8是获胜者，紧随其后的是Hermes。</p><figure class="kr ks kt ku fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es na"><img src="../Images/c99ee8d78e5cc68d780798bf3f34e70d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T2dIz7o5Ub65DTpf7IOhKA.png"/></div></div></figure><p id="ca8f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然而，在react-native中选择JS引擎并没有什么灵丹妙药。这完全取决于一个人的用例。现在react-native向用户提供选择JS引擎的选项，这很好。</p><p id="a987" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">根据不同的JS引擎来衡量你的应用程序的性能，并选择最适合你的用例是非常重要的。</p></div></div>    
</body>
</html>