<html>
<head>
<title>How to view reports from Azure Pipelines on a website?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在网站上查看来自Azure Pipelines的报告？</h1>
<blockquote>原文：<a href="https://medium.com/globant/how-to-view-reports-from-azure-pipelines-on-a-website-f7cb33f2e82b?source=collection_archive---------0-----------------------#2022-04-19">https://medium.com/globant/how-to-view-reports-from-azure-pipelines-on-a-website-f7cb33f2e82b?source=collection_archive---------0-----------------------#2022-04-19</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><div class=""><h2 id="a00a" class="pw-subtitle-paragraph ie hg hh bd b if ig ih ii ij ik il im in io ip iq ir is it iu iv dx translated">使用Azure存储帐户</h2></div><p id="ed4b" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">有时我们需要一个工具来可视化在Azure Devops管道中完成的任务的结果或报告。</p><p id="275c" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">为此，在本文中，我将向您展示一个<strong class="iy hi">集成</strong>，其中在管道中生成的<strong class="iy hi">报告</strong>可以上传到<strong class="iy hi"> Azure存储帐户中。</strong>此外，这是一种易于维护的经济解决方案。</p><p id="218d" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在本文中，我将讨论一个使用<strong class="iy hi">分步模板和</strong> <strong class="iy hi">模板的例子！</strong></p></div><div class="ab cl js jt go ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="ha hb hc hd he"><h1 id="93d0" class="jz ka hh bd kb kc kd ke kf kg kh ki kj in kk io kl iq km ir kn it ko iu kp kq bi translated">目标是什么？🎯</h1><p id="5bf3" class="pw-post-body-paragraph iw ix hh iy b iz kr ii jb jc ks il je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">您的目标是在内部使用的门户中以一致和有序的方式可视化报告，以便在将来添加应用程序，并在将来灵活地添加应用程序</p><figure class="kx ky kz la fd lb er es paragraph-image"><div class="er es kw"><img src="../Images/5dc0276a7c0b450445ce8c451cbfaea8.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/0*1A3eNM0Ti7kFRk5o"/></div></figure><p id="f45d" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">本文中解释的例子将使用Serenity BDD工具(smoke test的自动化测试)。Serenity任务将在云中的一个隔离的私有代理中执行。结果将在Azure Pipelines的代理内自动生成，路径如下:"/target/site/serenity/index . html "</p><p id="3c73" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">然后，使用CI/CD中的任务脚本，将报告上传到存储帐户中的blob空间，并使用报告中的数据更新网站内容(之前由管理员上传)。</p><p id="a65b" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">因此，您将拥有一个<strong class="iy hi">静态网站，该网站使用来自Azure Pipeline </strong>的冒烟测试的每次执行的报告或结果进行更新，并且团队QA将拥有一个报告查看门户。</p><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es le"><img src="../Images/9c2e49a0081dc2827d1c0567de809838.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0PKhBTD16V3mmvMO"/></div></div><figcaption class="lj lk et er es ll lm bd b be z dx">Reporting portal screenshot</figcaption></figure><blockquote class="ln lo lp"><p id="edf2" class="iw ix lq iy b iz ja ii jb jc jd il je lr jg jh ji ls jk jl jm lt jo jp jq jr ha bi translated"><em class="hh">您可以使用从Azure Pipelines生成的任何其他报告</em></p></blockquote></div><div class="ab cl js jt go ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="ha hb hc hd he"><h1 id="271b" class="jz ka hh bd kb kc kd ke kf kg kh ki kj in kk io kl iq km ir kn it ko iu kp kq bi translated">先决条件📝</h1><p id="f400" class="pw-post-body-paragraph iw ix hh iy b iz kr ii jb jc ks il je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">要实施此解决方案，您需要:</p><ul class=""><li id="9070" class="lu lv hh iy b iz ja jc jd jf lw jj lx jn ly jr lz ma mb mc bi translated">Azure订阅:存储帐户的所有者角色</li><li id="bc79" class="lu lv hh iy b iz md jc me jf mf jj mg jn mh jr lz ma mb mc bi translated">Azure管道权限:创建脚本任务</li><li id="cbe5" class="lu lv hh iy b iz md jc me jf mf jj mg jn mh jr lz ma mb mc bi translated">安装了“Az CLI”的代理池管道</li><li id="96e5" class="lu lv hh iy b iz md jc me jf mf jj mg jn mh jr lz ma mb mc bi translated">Serenity BDD(可选):您可以使用其他报告或信息来发布。</li><li id="d434" class="lu lv hh iy b iz md jc me jf mf jj mg jn mh jr lz ma mb mc bi translated">网站模板:<a class="ae mi" href="https://github.com/mzcode01/SerenityReportSite" rel="noopener ugc nofollow" target="_blank">链接</a></li></ul><h2 id="7cfc" class="mj ka hh bd kb mk ml mm kf mn mo mp kj jf mq mr kl jj ms mt kn jn mu mv kp mw bi translated">准备存储帐户</h2><p id="2919" class="pw-post-body-paragraph iw ix hh iy b iz kr ii jb jc ks il je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">除了创建存储帐户之外，第一步是准备公开网站</p><p id="8615" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在菜单“数据管理&gt;静态网站”中，必须启用“静态网站”功能，并且必须定义文件“索引文件名称”和“错误文件路径”。那么URL将在“主要端点”中获得</p><p id="0248" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">结果将是一个名为<em class="lq"> $web </em>的<strong class="iy hi"> Blob容器，网站将在其中托管。</strong></p><p id="0a77" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated"><em class="lq">有关逐步指导，请参见</em> <a class="ae mi" href="https://docs.microsoft.com/en-us/azure/storage/blobs/storage-blob-static-website-how-to" rel="noopener ugc nofollow" target="_blank"> <em class="lq">在Azure存储中托管一个静态网站</em> </a></p><div class="mx my ez fb mz na"><a href="https://docs.microsoft.com/en-us/azure/storage/blobs/storage-blob-static-website-how-to" rel="noopener  ugc nofollow" target="_blank"><div class="nb ab dw"><div class="nc ab nd cl cj ne"><h2 class="bd hi fi z dy nf ea eb ng ed ef hg bi translated">在Azure存储中托管静态网站</h2><div class="nh l"><h3 class="bd b fi z dy nf ea eb ng ed ef dx translated">登录Azure门户开始使用。找到您的存储帐户并显示帐户概述。选择静态…</h3></div><div class="ni l"><p class="bd b fp z dy nf ea eb ng ed ef dx translated">docs.microsoft.com</p></div></div><div class="nj l"><div class="nk l nl nm nn nj no lc na"/></div></div></a></div><blockquote class="ln lo lp"><p id="0466" class="iw ix lq iy b iz ja ii jb jc jd il je lr jg jh ji ls jk jl jm lt jo jp jq jr ha bi translated"><em class="hh">当然，Azure为我们提供了高级功能，如自定义域、指标、安全性、网络、多区域托管或Header，但这些主题不会在本文中讨论</em></p><p id="532f" class="iw ix lq iy b iz ja ii jb jc jd il je lr jg jh ji ls jk jl jm lt jo jp jq jr ha bi translated"><em class="hh">更多信息请见</em><a class="ae mi" href="https://docs.microsoft.com/en-us/azure/storage/blobs/storage-blob-static-website#mapping-a-custom-domain-to-a-static-website-url" rel="noopener ugc nofollow" target="_blank"><em class="hh">Azure存储中的静态网站托管</em> </a></p></blockquote><h2 id="fe34" class="mj ka hh bd kb mk ml mm kf mn mo mp kj jf mq mr kl jj ms mt kn jn mu mv kp mw bi translated">为应用程序创建Blob</h2><p id="b156" class="pw-post-body-paragraph iw ix hh iy b iz kr ii jb jc ks il je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">下一步是为应用程序创建一个Blob容器，其中将保存从管道生成的报告。</p><p id="0d40" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在“数据存储”中，您将完成一个名称，并选择“Blob”，如“公共访问级别”。</p><figure class="kx ky kz la fd lb er es paragraph-image"><div class="er es np"><img src="../Images/5152c9bcd4e1611d0d37e80fdc915283.png" data-original-src="https://miro.medium.com/v2/resize:fit:834/0*1KAr6QOL0AxABGpF"/></div></figure><p id="0bc2" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">记住名称"<em class="lq"> containername" </em>以进行后续步骤。</p><h2 id="8411" class="mj ka hh bd kb mk ml mm kf mn mo mp kj jf mq mr kl jj ms mt kn jn mu mv kp mw bi translated">将Blob配置到Web</h2><p id="12d9" class="pw-post-body-paragraph iw ix hh iy b iz kr ii jb jc ks il je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">您可以使用任何带有文件夹和功能的HTML站点。在free-css.com的帮助下，我们准备了一个网站(<a class="ae mi" href="https://github.com/mzcode01/SerenityReportSite" rel="noopener ugc nofollow" target="_blank">附上模板</a>)，以下是一些您需要更改和理解的修改:</p><ul class=""><li id="748d" class="lu lv hh iy b iz ja jc jd jf lw jj lx jn ly jr lz ma mb mc bi translated"><strong class="iy hi">Index.html</strong>→为每个应用程序定义卡片，并创建一个到app1.html的链接。</li><li id="7781" class="lu lv hh iy b iz md jc me jf mf jj mg jn mh jr lz ma mb mc bi translated"><strong class="iy hi">app1.html</strong>→是每个应用程序的报告站点吗</li><li id="5a5a" class="lu lv hh iy b iz md jc me jf mf jj mg jn mh jr lz ma mb mc bi translated"><strong class="iy hi"> reports_app1.html </strong> →是指向blob存储(“containername”)的链接的报告列表。该文件将在管道运行时更新</li></ul><p id="2091" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">当您修改文件时，必须将它们上传到容器“$web”中。一种方法是在VSCode或Azure Portal或Az CLI中登录Azure。</p><h2 id="5f8f" class="mj ka hh bd kb mk ml mm kf mn mo mp kj jf mq mr kl jj ms mt kn jn mu mv kp mw bi translated">配置Azure管道</h2><p id="01dd" class="pw-post-body-paragraph iw ix hh iy b iz kr ii jb jc ks il je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">最后一步是将任务脚本添加到冒烟测试的管道中(在我们的例子中)</p><p id="71c9" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">您需要从“安全+网络&gt;访问密钥”中获得SA(存储帐户)的访问密钥。如果您更改以下脚本，就有机会使用SAS键。</p><p id="3893" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">在脚本中，定义以下变量:</p><ul class=""><li id="b63a" class="lu lv hh iy b iz ja jc jd jf lw jj lx jn ly jr lz ma mb mc bi translated"><strong class="iy hi">ReportAccounName</strong>= SAName</li><li id="4f82" class="lu lv hh iy b iz md jc me jf mf jj mg jn mh jr lz ma mb mc bi translated">报告账户键 =键1</li><li id="cb8b" class="lu lv hh iy b iz md jc me jf mf jj mg jn mh jr lz ma mb mc bi translated"><strong class="iy hi">report file</strong>= reports _ app 1 . html→命名web中的报表列表</li><li id="9c0e" class="lu lv hh iy b iz md jc me jf mf jj mg jn mh jr lz ma mb mc bi translated"><strong class="iy hi">ReportStorageURL</strong>=<a class="ae mi" href="https://SAName.blob.core.windows.net" rel="noopener ugc nofollow" target="_blank">https://<em class="lq">SAName</em>. Blob . core . windows . net</a>→Blob的URL</li><li id="f247" class="lu lv hh iy b iz md jc me jf mf jj mg jn mh jr lz ma mb mc bi translated"><strong class="iy hi">report container</strong>= container Name→为每个应用程序创建的容器的名称</li></ul><p id="cd5d" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">请记住:</p><ul class=""><li id="65c4" class="lu lv hh iy b iz ja jc jd jf lw jj lx jn ly jr lz ma mb mc bi translated">代理管道需要安装“Az CLI”。</li><li id="e70c" class="lu lv hh iy b iz md jc me jf mf jj mg jn mh jr lz ma mb mc bi translated">在步骤#3中，将定义要上传的带有index.html的报告的路径。</li><li id="d094" class="lu lv hh iy b iz md jc me jf mf jj mg jn mh jr lz ma mb mc bi translated">在步骤#6中，将定义到报告路径的链接。</li></ul><pre class="kx ky kz la fd nq nr ns nt aw nu bi"><span id="2345" class="mj ka hh nr b fi nv nw l nx ny">steps:<br/>- script: |<br/>#1Define vars to SA<br/>ACCOUNTNAME=”$(ReportAccounName)”<br/>ACCOUNTKEY=”$(ReportAccountKey)”</span><span id="61eb" class="mj ka hh nr b fi nz nw l nx ny">#2Define vars to update website<br/>FILE=”$(ReportFile)”<br/>NAME=”$(ReportFile)”<br/>BUILD=”$(Build.BuildNumber)”<br/>STORAGEURL=”$(ReportStorageURL)”<br/>CONTAINERREPORT=”$(ReportContainer)”</span><span id="9c5a" class="mj ka hh nr b fi nz nw l nx ny">#3Uplodad Report/files to SA<br/>az storage blob upload-batch -d ‘’$CONTAINERREPORT/$BUILD’’ -s $(System.DefaultWorkingDirectory)/target/site — account-name $ACCOUNTNAME — account-key $ACCOUNTKEY</span><span id="5e61" class="mj ka hh nr b fi nz nw l nx ny">##Add report in the website<br/>#4Create work directory<br/>mkdir download<br/>cd download</span><span id="681f" class="mj ka hh nr b fi nz nw l nx ny">#5Download file of list of report from website<br/>az storage blob download — container-name ‘$web’ -f $FILE -n $NAME — account-name $ACCOUNTNAME — account-key $ACCOUNTKEY</span><span id="df47" class="mj ka hh nr b fi nz nw l nx ny">#6Add in line 25 name of report and link in the list of report<br/>sed -i ’25 i &lt;a href=\”’$STORAGEURL/$CONTAINERREPORT/$BUILD’/serenity/index.html\” target=\”iframe_a\”&gt;’$BUILD’&lt;/a&gt;&lt;br&gt;’ $FILE</span><span id="68c8" class="mj ka hh nr b fi nz nw l nx ny">#7Update list of report to website<br/>az storage blob upload — container-name ‘$web’ -f $FILE -n $NAME — account-name $ACCOUNTNAME — account-key $ACCOUNTKEY</span></pre><h1 id="a9b9" class="jz ka hh bd kb kc oa ke kf kg ob ki kj in oc io kl iq od ir kn it oe iu kp kq bi translated">最终建筑🎉</h1><p id="c737" class="pw-post-body-paragraph iw ix hh iy b iz kr ii jb jc ks il je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">最后，对于执行的每个冒烟测试管道，网站上将出现一个名为Build和report display的新条目。在这里，您可以看到解决方案的最终架构。</p><figure class="kx ky kz la fd lb er es paragraph-image"><div role="button" tabindex="0" class="lf lg di lh bf li"><div class="er es of"><img src="../Images/0df59f8bd286b58382af8499ff5ecbcd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MNPwnBtOdfzGuXq9"/></div></div></figure><blockquote class="ln lo lp"><p id="9ac4" class="iw ix lq iy b iz ja ii jb jc jd il je lr jg jh ji ls jk jl jm lt jo jp jq jr ha bi translated">安全提示:我试着简单地解释一下这个过程。但是指示的步骤打开了网站和内容。如果该解决方案对您有用，那么在SA上进行安全性工作是很重要的，例如通过Vnet进行过滤。</p></blockquote></div><div class="ab cl js jt go ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="ha hb hc hd he"><h1 id="d699" class="jz ka hh bd kb kc kd ke kf kg kh ki kj in kk io kl iq km ir kn it ko iu kp kq bi translated">摘要</h1><p id="1354" class="pw-post-body-paragraph iw ix hh iy b iz kr ii jb jc ks il je jf kt jh ji jj ku jl jm jn kv jp jq jr ha bi translated">这是一个简单解决方案的第一个版本，可能会根据需要进行改进，并且使用非常便宜的资源。</p><p id="f8e5" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">您可以将这一理念应用于任何CI/CD、任何类型的报告、任何web风格或其他云提供商。</p><p id="f648" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">接下来的步骤将是通过IaC的最佳实践创建所有任务</p></div><div class="ab cl js jt go ju" role="separator"><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx jy"/><span class="jv bw bk jw jx"/></div><div class="ha hb hc hd he"><h1 id="3a75" class="jz ka hh bd kb kc kd ke kf kg kh ki kj in kk io kl iq km ir kn it ko iu kp kq bi translated">参考</h1><ul class=""><li id="1e5d" class="lu lv hh iy b iz kr jc ks jf og jj oh jn oi jr lz ma mb mc bi translated"><a class="ae mi" href="https://www.free-css.com/free-css-templates?start=12" rel="noopener ugc nofollow" target="_blank">免费css模板</a></li><li id="b081" class="lu lv hh iy b iz md jc me jf mf jj mg jn mh jr lz ma mb mc bi translated"><a class="ae mi" href="https://www.free-css.com/free-css-templates/page272/revetive" rel="noopener ugc nofollow" target="_blank"> Free-css模板示例</a></li><li id="1bcf" class="lu lv hh iy b iz md jc me jf mf jj mg jn mh jr lz ma mb mc bi translated"><a class="ae mi" href="https://github.com/mzcode01/SerenityReportSite" rel="noopener ugc nofollow" target="_blank"> Github模板</a></li><li id="34ff" class="lu lv hh iy b iz md jc me jf mf jj mg jn mh jr lz ma mb mc bi translated"><a class="ae mi" href="https://docs.microsoft.com/en-us/cli/azure/storage/blob?view=azure-cli-latest" rel="noopener ugc nofollow" target="_blank">微软文档az-cli </a></li><li id="55c8" class="lu lv hh iy b iz md jc me jf mf jj mg jn mh jr lz ma mb mc bi translated"><a class="ae mi" href="https://docs.microsoft.com/en-us/azure/storage/blobs/storage-blob-static-website" rel="noopener ugc nofollow" target="_blank">微软文档静态网站</a></li></ul><p id="1dc0" class="pw-post-body-paragraph iw ix hh iy b iz ja ii jb jc jd il je jf jg jh ji jj jk jl jm jn jo jp jq jr ha bi translated">致<a class="oj ok ge" href="https://medium.com/u/f7acacf97957?source=post_page-----f7cb33f2e82b--------------------------------" rel="noopener" target="_blank"> Pablo Rubini </a>，感谢你帮我开发任务。</p></div></div>    
</body>
</html>