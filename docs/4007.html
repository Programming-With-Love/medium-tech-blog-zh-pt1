<html>
<head>
<title>Load Testing NodeJS APIs with Autocannon</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用自动扫描加载测试节点API</h1>
<blockquote>原文：<a href="https://medium.com/globant/load-testing-nodejs-apis-with-autocannon-c3770478cb36?source=collection_archive---------1-----------------------#2022-10-11">https://medium.com/globant/load-testing-nodejs-apis-with-autocannon-c3770478cb36?source=collection_archive---------1-----------------------#2022-10-11</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><h2 id="4c3f" class="hf hg hh bd b fp hi hj hk hl hm hn dx ho translated" aria-label="kicker paragraph">NODEJS系列</h2><div class=""/><div class=""><h2 id="f5e6" class="pw-subtitle-paragraph in hq hh bd b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je dx translated">如何使用自动扫描加载测试节点API的指南</h2></div><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es jf"><img src="../Images/cf1a39a0c85d7947213913928e9619f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c_MB2L-eXkwTnYqeZrf1LQ.png"/></div></div></figure><p id="4b4e" class="pw-post-body-paragraph jr js hh jt b ju jv ir jw jx jy iu jz ka kb kc kd ke kf kg kh ki kj kk kl km ha bi translated">作为开发人员，我们总是担心API的响应时间，这样它就不会成为消费者的瓶颈。因此，我们需要确保响应时间不会影响应用程序的性能，即使多个用户同时使用它。</p><p id="e275" class="pw-post-body-paragraph jr js hh jt b ju jv ir jw jx jy iu jz ka kb kc kd ke kf kg kh ki kj kk kl km ha bi translated">测试始终是应用程序不可或缺的一部分，以确保其顺利运行。我们如何测试我们的API来支持并发用户请求？—  <strong class="jt hr"> Autocannon，一个负载测试包，可以在我们的应用中模拟高流量。</strong></p></div><div class="ab cl ko kp go kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ha hb hc hd he"><h2 id="3c69" class="kv kw hh bd kx ky kz la lb lc ld le lf ka lg lh li ke lj lk ll ki lm ln lo hn bi translated">自动扫描</h2><p id="6f54" class="pw-post-body-paragraph jr js hh jt b ju lp ir jw jx lq iu jz ka lr kc kd ke ls kg kh ki lt kk kl km ha bi translated"><a class="ae lu" href="https://www.npmjs.com/package/autocannon" rel="noopener ugc nofollow" target="_blank"> Autocannon </a>是一个用NodeJS编写的HTTP/1.1基准测试工具，广泛用于衡量一个应用的性能。使用autocannon，我们可以每秒模拟多个请求来对我们的应用程序进行负载测试。</p><h2 id="0289" class="kv kw hh bd kx ky kz la lb lc ld le lf ka lg lh li ke lj lk ll ki lm ln lo hn bi translated">装置</h2><p id="61a6" class="pw-post-body-paragraph jr js hh jt b ju lp ir jw jx lq iu jz ka lr kc kd ke ls kg kh ki lt kk kl km ha bi translated">在项目中全局安装autocannon。</p><pre class="jg jh ji jj fd lv lw lx ly aw lz bi"><span id="6673" class="kv kw hh lw b fi ma mb l mc md">npm install -g autocannon</span></pre><h2 id="4263" class="kv kw hh bd kx ky kz la lb lc ld le lf ka lg lh li ke lj lk ll ki lm ln lo hn bi translated">测试命令</h2><pre class="jg jh ji jj fd lv lw lx ly aw lz bi"><span id="eceb" class="kv kw hh lw b fi ma mb l mc md">autocannon [opts] URL</span></pre><h2 id="875c" class="kv kw hh bd kx ky kz la lb lc ld le lf ka lg lh li ke lj lk ll ki lm ln lo hn bi translated"><strong class="ak">可用选项</strong></h2><p id="2e6e" class="pw-post-body-paragraph jr js hh jt b ju lp ir jw jx lq iu jz ka lr kc kd ke ls kg kh ki lt kk kl km ha bi translated">更多选项你可以在这里找到<a class="ae lu" href="https://www.npmjs.com/package/autocannon" rel="noopener ugc nofollow" target="_blank">。</a></p><pre class="jg jh ji jj fd lv lw lx ly aw lz bi"><span id="1630" class="kv kw hh lw b fi ma mb l mc md"><strong class="lw hr">-c | --connections</strong><br/>Number of concurrent connections to use<br/>By default, its value is 10</span><span id="29fe" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">-p | --pipeline</strong><br/>Number of pipelined requests to use<br/>By default, its value is 1</span><span id="fa74" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">-d | --duration<br/></strong>Number of seconds to run the autocannon<br/>By default, its value is 10</span><span id="0b7c" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">-w | --workers</strong><br/>Number of worker threads to fire requests</span><span id="212b" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">-m | --method<br/></strong>HTTP method to use<br/>By default, its value is 'GET'</span><span id="a4a8" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">-t | --timeout</strong><br/>Number of seconds before timing out and resetting a connection<br/>By default, its value is 10</span><span id="4949" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">-j | --json</strong><br/>Print the output as newline delimited JSON<br/>By default, its value is false</span><span id="5b5d" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">-f | --forever</strong><br/>Run the benchmark forever</span></pre><p id="4303" class="pw-post-body-paragraph jr js hh jt b ju jv ir jw jx jy iu jz ka kb kc kd ke kf kg kh ki kj kk kl km ha bi translated">运行该命令时，如果遇到任何错误，如<strong class="jt hr">运行系统</strong>上禁用的脚本，请按如下方式设置执行策略:</p><pre class="jg jh ji jj fd lv lw lx ly aw lz bi"><span id="118b" class="kv kw hh lw b fi ma mb l mc md">Set-ExecutionPolicy -Scope CurrentUser -ExecutionPolicy Unrestricted</span></pre></div><div class="ab cl ko kp go kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ha hb hc hd he"><p id="0840" class="pw-post-body-paragraph jr js hh jt b ju jv ir jw jx jy iu jz ka kb kc kd ke kf kg kh ki kj kk kl km ha bi translated"><em class="kn">我们来玩一些代码示例。</em></p><p id="5c05" class="pw-post-body-paragraph jr js hh jt b ju jv ir jw jx jy iu jz ka kb kc kd ke kf kg kh ki kj kk kl km ha bi translated">我建立了一个示例项目，其中我的数据库只包含一个名为“爱好”的集合。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div class="er es mf"><img src="../Images/2fb520db5767fea24ce10adf3a9a6d02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*3n-_sqAbjkZxPqUtbS492g.png"/></div><figcaption class="mg mh et er es mi mj bd b be z dx">Hobbies Model</figcaption></figure><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es mk"><img src="../Images/582159f7ab40de96a8b97735400980ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6YFSlt3r6uHXLRHu9ASYKg.png"/></div></div><figcaption class="mg mh et er es mi mj bd b be z dx">Get all Hobbies &amp; Save new Hobbies</figcaption></figure><h2 id="19ab" class="kv kw hh bd kx ky kz la lb lc ld le lf ka lg lh li ke lj lk ll ki lm ln lo hn bi translated">为我的GET请求自动调用命令</h2><pre class="jg jh ji jj fd lv lw lx ly aw lz bi"><span id="f614" class="kv kw hh lw b fi ma mb l mc md">autocannon -c 500 -d 5 <a class="ae lu" href="http://localhost:8000/getAll" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/getAll</a> // Running 500 connections in 5 seconds</span></pre><h2 id="0486" class="kv kw hh bd kx ky kz la lb lc ld le lf ka lg lh li ke lj lk ll ki lm ln lo hn bi translated">试验结果</h2><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es ml"><img src="../Images/8967e0f1955ce704c64edf987785ed9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PLO9Izop6S93paijbmuOGw.png"/></div></div><figcaption class="mg mh et er es mi mj bd b be z dx">Credit: Author</figcaption></figure><h2 id="f0ee" class="kv kw hh bd kx ky kz la lb lc ld le lf ka lg lh li ke lj lk ll ki lm ln lo hn bi translated">我的发布请求的自动取消命令</h2><pre class="jg jh ji jj fd lv lw lx ly aw lz bi"><span id="d686" class="kv kw hh lw b fi ma mb l mc md">autocannon -m POST -H “Content-Type:application/x-www-form-urlencoded” -b “name=swimming&amp;active=true” <a class="ae lu" href="http://localhost:8000/save" rel="noopener ugc nofollow" target="_blank">http://localhost:8000/save</a>  // specify Header(-H) and Body (-b)</span></pre><h2 id="e0e1" class="kv kw hh bd kx ky kz la lb lc ld le lf ka lg lh li ke lj lk ll ki lm ln lo hn bi translated">试验结果</h2><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es mm"><img src="../Images/d90991bf955641bd1302e1dcb256e1e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ob-6UhSDGbaOTFwScHjU1A.png"/></div></div><figcaption class="mg mh et er es mi mj bd b be z dx">Credit: Author</figcaption></figure><p id="3109" class="pw-post-body-paragraph jr js hh jt b ju jv ir jw jx jy iu jz ka kb kc kd ke kf kg kh ki kj kk kl km ha bi translated">Autocannon输出两个数据表:</p><ol class=""><li id="9b06" class="mn mo hh jt b ju jv jx jy ka mp ke mq ki mr km ms mt mu mv bi translated"><strong class="jt hr">请求延迟— </strong> <em class="kn">显示请求时间为2.5%(快)、50%(中)、97.5%(慢)、99%(最慢)以及平均时间。</em></li><li id="2abd" class="mn mo hh jt b ju mw jx mx ka my ke mz ki na km ms mt mu mv bi translated"><strong class="jt hr">请求量— </strong> <em class="kn">显示每秒发送的请求数和下载的字节数。</em></li></ol></div><div class="ab cl ko kp go kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ha hb hc hd he"><p id="be2a" class="pw-post-body-paragraph jr js hh jt b ju jv ir jw jx jy iu jz ka kb kc kd ke kf kg kh ki kj kk kl km ha bi translated">除了从命令行运行测试命令，我们还可以通过编程来运行它们。</p><pre class="jg jh ji jj fd lv lw lx ly aw lz bi"><span id="db5c" class="kv kw hh lw b fi ma mb l mc md">autocannon(opts[, cb])</span></pre><p id="c51a" class="pw-post-body-paragraph jr js hh jt b ju jv ir jw jx jy iu jz ka kb kc kd ke kf kg kh ki kj kk kl km ha bi translated"><strong class="jt hr"> <em class="kn"> opts </em> </strong>是autocannon实例的配置选项，而<strong class="jt hr"> <em class="kn"> cb </em> </strong>是测试完成时调用的回调。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es nb"><img src="../Images/ef02866072c4bcb5132e69c89ba52c06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TaJQB5Jl9XWuR3GZSePN9Q.png"/></div></div><figcaption class="mg mh et er es mi mj bd b be z dx">Autocannon GET &amp; POST requests programmatically</figcaption></figure><h2 id="0a75" class="kv kw hh bd kx ky kz la lb lc ld le lf ka lg lh li ke lj lk ll ki lm ln lo hn bi translated">试验结果</h2><figure class="jg jh ji jj fd jk er es paragraph-image"><div class="er es nc"><img src="../Images/0fa40b67f26b331790fd6037234b9c99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1210/format:webp/1*jutEdLFF9F9uv-HchqlPVw.png"/></div><figcaption class="mg mh et er es mi mj bd b be z dx">Credit: Author</figcaption></figure><p id="dcd7" class="pw-post-body-paragraph jr js hh jt b ju jv ir jw jx jy iu jz ka kb kc kd ke kf kg kh ki kj kk kl km ha bi translated">如果你仔细观察上面的测试结果，你会发现很多事情如下所示:</p><pre class="jg jh ji jj fd lv lw lx ly aw lz bi"><span id="8c44" class="kv kw hh lw b fi ma mb l mc md"><strong class="lw hr">start</strong><br/>Date object when test started</span><span id="c62c" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">finish</strong><br/>Date object when test ended</span><span id="3076" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">errors</strong><br/>Number of connection errors</span><span id="c5ae" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">timeouts</strong><br/>Number of connection timeouts</span><span id="b986" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">mismatches</strong><br/>Number of requests with a mismatched body</span><span id="d09b" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">non2xx</strong><br/>Number of non-2xx response status codes received</span><span id="9960" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">requests</strong><br/>Number of requests per second</span><span id="184b" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">latency</strong><br/>Request time</span><span id="9393" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">throughput<br/></strong>Response data throughput per second</span></pre><p id="d8f1" class="pw-post-body-paragraph jr js hh jt b ju jv ir jw jx jy iu jz ka kb kc kd ke kf kg kh ki kj kk kl km ha bi translated"><strong class="jt hr"> <em class="kn">请求</em> </strong>、<strong class="jt hr"> <em class="kn">延迟</em> </strong>和<strong class="jt hr"> <em class="kn">吞吐量</em> </strong>是百分位对象，具有以下值:</p><pre class="jg jh ji jj fd lv lw lx ly aw lz bi"><span id="b1b1" class="kv kw hh lw b fi ma mb l mc md"><strong class="lw hr">min</strong><br/>The lowest value.</span><span id="4ab3" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">max</strong><br/>The highest value.</span><span id="8900" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">average</strong><br/>The average (mean) value.</span><span id="f62b" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">stddev</strong><br/>The standard deviation.</span><span id="27bf" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">p*</strong><br/>The percentile value. The percentile properties are: <!-- -->p2_5<!-- -->, <!-- -->p50<!-- -->, <!-- -->p75<!-- -->, <!-- -->p90<!-- -->, <!-- -->p97_5<!-- -->, <!-- -->p99<!-- -->, <!-- -->p99_9<!-- -->, <!-- -->p99_99<!-- -->, <!-- -->p99_999<!-- -->.</span></pre></div><div class="ab cl ko kp go kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ha hb hc hd he"><h2 id="078d" class="kv kw hh bd kx ky kz la lb lc ld le lf ka lg lh li ke lj lk ll ki lm ln lo hn bi translated">自动扫描事件</h2><p id="0a63" class="pw-post-body-paragraph jr js hh jt b ju lp ir jw jx lq iu jz ka lr kc kd ke ls kg kh ki lt kk kl km ha bi translated">autocannon实例是一个事件发射器。所以它会发出几个事件。下面给出一些。更多可以在这里找到<a class="ae lu" href="https://www.npmjs.com/package/autocannon" rel="noopener ugc nofollow" target="_blank"/>。</p><figure class="jg jh ji jj fd jk er es paragraph-image"><div role="button" tabindex="0" class="jl jm di jn bf jo"><div class="er es nd"><img src="../Images/e6fef64033692ce3cd06e7812d6c6b44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xcdj1g2EXbQdAHpzlvMp3w.png"/></div></div><figcaption class="mg mh et er es mi mj bd b be z dx">Credit: Author</figcaption></figure><pre class="jg jh ji jj fd lv lw lx ly aw lz bi"><span id="ed95" class="kv kw hh lw b fi ma mb l mc md"><strong class="lw hr">start<br/></strong>Emitted when autocannon instance is setup and started<strong class="lw hr">.</strong></span><span id="deba" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">done<br/></strong>Emitted when the autocannon finishes a benchmark.</span><span id="c4cf" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">track<br/></strong>Track the progress of autocannon. <br/>Configuration options for tracking are:</span><span id="405f" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">   1. outputStream<br/>   </strong>The stream to output to.</span><span id="d7b2" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">   2. renderProgressBar<br/>   </strong>A boolean value indicating whether to display progress bar or    not. By default, it’s value is true.</span><span id="582e" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">   3. renderResultsTable<br/>   </strong>A boolean value indicating whether to display result table or not. By default, it’s value is true.</span><span id="3429" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">   4. renderLatencyTable<br/>  </strong> A boolean value indicating whether to display latency table. By default, it’s value is false.</span><span id="53f9" class="kv kw hh lw b fi me mb l mc md"><strong class="lw hr">   5. progressBarString<br/>  </strong> A string defining the format of the progress display output.</span></pre></div><div class="ab cl ko kp go kq" role="separator"><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt ku"/><span class="kr bw bk ks kt"/></div><div class="ha hb hc hd he"><p id="d3e8" class="pw-post-body-paragraph jr js hh jt b ju jv ir jw jx jy iu jz ka kb kc kd ke kf kg kh ki kj kk kl km ha bi translated">用Autocannon对你的API进行负载测试。谢谢:)</p></div></div>    
</body>
</html>