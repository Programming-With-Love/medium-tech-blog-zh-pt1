<html>
<head>
<title>Broadcasting Messages with SignalR using Angular &amp; .NET Core API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Angular &amp;通过SignalR广播消息。网络核心API</h1>
<blockquote>原文：<a href="https://medium.com/globant/broadcasting-messages-with-signalr-using-angular-net-core-api-e8d893dd11de?source=collection_archive---------0-----------------------#2022-01-13">https://medium.com/globant/broadcasting-messages-with-signalr-using-angular-net-core-api-e8d893dd11de?source=collection_archive---------0-----------------------#2022-01-13</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div class="er es ie"><img src="../Images/4eec1385d5c9801ed653fc15fd88c4da.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/format:webp/1*4o46tSkG1PlSXhIvNA-CJQ.png"/></div><figcaption class="il im et er es in io bd b be z dx">PC: Google Images</figcaption></figure><p id="245d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">本文简要介绍了如何使用SignalR向实时web应用程序广播消息。</p><h1 id="90b7" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">阅读本文后，您会:</h1><ul class=""><li id="b199" class="kl km hh ir b is kn iw ko ja kp je kq ji kr jm ks kt ku kv bi translated">了解信号R的基本概况及其在现实世界中的应用。</li><li id="d50c" class="kl km hh ir b is kw iw kx ja ky je kz ji la jm ks kt ku kv bi translated">建立项目。</li><li id="0f6f" class="kl km hh ir b is kw iw kx ja ky je kz ji la jm ks kt ku kv bi translated">检查代码。</li></ul><p id="17a6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">先决条件</strong></p><p id="7701" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这篇文章有一些附加条件。您应该对在REST API中公开CRUD操作有一个大致的了解&amp;通过任何web应用程序使用它。对于本文，我使用Angular 9(兼容Angular的所有版本)来消费和显示数据。</p><p id="4f9b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> <em class="lb">工具/框架/语言</em> </strong></p><ul class=""><li id="6c2d" class="kl km hh ir b is it iw ix ja lc je ld ji le jm ks kt ku kv bi translated"><a class="ae lf" href="https://visualstudio.microsoft.com/downloads/" rel="noopener ugc nofollow" target="_blank"> Visual Studio 201 </a> 9与<strong class="ir hi">ASP.NET</strong>工作量</li><li id="afc6" class="kl km hh ir b is kw iw kx ja ky je kz ji la jm ks kt ku kv bi translated"><a class="ae lf" href="https://code.visualstudio.com/?wt.mc_id=vscom_downloads" rel="noopener ugc nofollow" target="_blank"> Visual Studio代码</a></li><li id="daf2" class="kl km hh ir b is kw iw kx ja ky je kz ji la jm ks kt ku kv bi translated"><a class="ae lf" href="https://angular.io/guide/setup-local" rel="noopener ugc nofollow" target="_blank">角度CLI </a></li><li id="3836" class="kl km hh ir b is kw iw kx ja ky je kz ji la jm ks kt ku kv bi translated"><a class="ae lf" href="https://nodejs.org/en/" rel="noopener ugc nofollow" target="_blank"> Node.js </a></li><li id="d2bb" class="kl km hh ir b is kw iw kx ja ky je kz ji la jm ks kt ku kv bi translated"><a class="ae lf" href="https://www.nuget.org/packages/Microsoft.AspNet.SignalR/" rel="noopener ugc nofollow" target="_blank">微软。AspNet.SignalR( <em class="lb">版本</em> 2.4.2) </a></li></ul><h1 id="fd95" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">介绍</h1><p id="9763" class="pw-post-body-paragraph ip iq hh ir b is kn iu iv iw ko iy iz ja lg jc jd je lh jg jh ji li jk jl jm ha bi translated">SignalR 是一个开源库，用于简化向应用程序添加实时web功能的过程。</p><blockquote class="lj lk ll"><p id="dfe6" class="ip iq lb ir b is it iu iv iw ix iy iz lm jb jc jd ln jf jg jh lo jj jk jl jm ha bi translated"><strong class="ir hi">实时web功能</strong>能够让服务器代码在内容可用时立即将内容推送至连接的客户端，而不是让服务器等待客户端请求新数据。</p></blockquote><p id="58c4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">它提供了一个简单的API，用于创建从服务器端调用客户端浏览器(和其他客户端平台)中的JavaScript函数的服务器到客户端的远程过程调用(RPC)。NET代码。它还包括用于连接管理(例如，连接和断开事件)和连接分组的API。它自动处理连接管理，并让您同时向所有连接的客户端广播消息，就像一个聊天室。您还可以向特定的客户端发送消息。客户端和服务器之间的连接是持久的，不像传统的HTTP连接，每次通信都要重新建立连接。</p><blockquote class="lj lk ll"><p id="0fde" class="ip iq lb ir b is it iu iv iw ix iy iz lm jb jc jd ln jf jg jh lo jj jk jl jm ha bi translated">SignalR支持<strong class="ir hi"> <em class="hh">【服务器推送】</em> </strong>功能，其中服务器代码可以使用远程过程调用(RPC)在浏览器中调出客户端代码，而不是当今web上常见的请求-响应模型。</p></blockquote><p id="33f0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">SignalR应用程序可以使用内置的第三方扩展提供程序扩展到数千个客户端。</p><h1 id="69a7" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">SignalR和WebSocket</h1><p id="0d3d" class="pw-post-body-paragraph ip iq hh ir b is kn iu iv iw ko iy iz ja lg jc jd je lh jg jh ji li jk jl jm ha bi translated">SignalR在可用的地方使用新的WebSocket传输，并在必要时回退到旧的传输。虽然你当然可以直接使用WebSocket编写你的应用程序，但是使用SignalR意味着你需要实现的许多额外功能已经为你完成了。最重要的是，这意味着您可以编写应用程序来利用WebSocket，而不必担心为旧客户端创建单独的代码路径。SignalR还让您不必担心WebSocket的更新，因为SignalR已更新为支持底层传输中的更改，为您的应用程序提供了跨WebSocket版本的一致接口。</p><h1 id="dc58" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated"><strong class="ak">信号装置的应用</strong></h1><ol class=""><li id="f1c5" class="kl km hh ir b is kn iw ko ja kp je kq ji kr jm lp kt ku kv bi translated"><strong class="ir hi">通知</strong>:如果你想通知单个客户或所有客户，那么我们可以使用SignalR。通知可以是一些警告、提醒、反馈或评论等等。</li><li id="484d" class="kl km hh ir b is kw iw kx ja ky je kz ji la jm lp kt ku kv bi translated"><strong class="ir hi">聊天</strong>:使用SignalR很容易实现一个聊天应用程序，可以是一对一聊天，也可以是群聊。</li><li id="c81c" class="kl km hh ir b is kw iw kx ja ky je kz ji la jm lp kt ku kv bi translated"><strong class="ir hi">游戏</strong> : SignalR帮助创建一个游戏应用程序，该程序需要频繁地从服务器推送等等。</li></ol><p id="33b7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">我使用信号R的用例</strong></p><blockquote class="lj lk ll"><p id="896b" class="ip iq lb ir b is it iu iv iw ix iy iz lm jb jc jd ln jf jg jh lo jj jk jl jm ha bi translated">在一个处理大量数据和许多用户的项目中，我们使用了计时器，它在特定的时间间隔内调用服务器来了解工作(它可以是批准/拒绝场景或文件导入等)。)状态，基于该状态需要向哪些客户端通知工作完成状态。当有大量用户时，这些计时器会影响应用程序的性能。</p><p id="69e3" class="ip iq lb ir b is it iu iv iw ix iy iz lm jb jc jd ln jf jg jh lo jj jk jl jm ha bi translated">所以为了提高性能，我们选择使用SignalR让服务器通知客户端是否有任何后台更新。</p></blockquote><h1 id="11f1" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">让我们展示一些代码…</h1><p id="fb6a" class="pw-post-body-paragraph ip iq hh ir b is kn iu iv iw ko iy iz ja lg jc jd je lh jg jh ji li jk jl jm ha bi translated">为了理解SignalR是如何工作的，我创建了一个旨在管理员工和经理的web应用程序。当我们对员工数据执行CRUD操作时，我们将从Angular应用程序中的SignalR hub获得广播消息，并立即在所有连接的客户端浏览器中显示修改后的数据。</p><blockquote class="lj lk ll"><p id="cd7e" class="ip iq lb ir b is it iu iv iw ix iy iz lm jb jc jd ln jf jg jh lo jj jk jl jm ha bi translated">为了能够使用SignalR，我们需要在API中将其添加为NuGet包，在节点模块中将其添加为npm包。</p></blockquote><p id="279b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">步骤</strong></p><h2 id="409c" class="lq jo hh bd jp lr ls lt jt lu lv lw jx ja lx ly kb je lz ma kf ji mb mc kj md bi translated"><strong class="ak"> 1。API端点</strong></h2><ul class=""><li id="6a65" class="kl km hh ir b is kn iw ko ja kp je kq ji kr jm ks kt ku kv bi translated">在Visual Studio中，创建一个ASP.NET核心Web API应用程序。</li></ul><figure class="mf mg mh mi fd ii er es paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="er es me"><img src="../Images/cd21491b2bda7e10273c321b62c93c4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ujAyf29rn_kYWsLQmE_6tQ.png"/></div></div><figcaption class="il im et er es in io bd b be z dx">Fig-#1</figcaption></figure><ul class=""><li id="5f54" class="kl km hh ir b is it iw ix ja lc je ld ji le jm ks kt ku kv bi translated">单击Next后，选择要使用的目标框架。对于本文，我使用了<strong class="ir hi">。NET 5.0 </strong>。</li></ul><blockquote class="lj lk ll"><p id="7b32" class="ip iq lb ir b is it iu iv iw ix iy iz lm jb jc jd ln jf jg jh lo jj jk jl jm ha bi translated">注意:-我们选择了默认的“启用开放API支持”选项。这个特性将帮助我们在应用程序中启用swagger API文档。</p></blockquote><figure class="mf mg mh mi fd ii er es paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="er es me"><img src="../Images/ee0c9cbd28acaef6282a02acac607e1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gH8IZh6onHuoJ2D0_zh-Lw.png"/></div></div><figcaption class="il im et er es in io bd b be z dx">Fig-#2</figcaption></figure><ul class=""><li id="e502" class="kl km hh ir b is it iw ix ja lc je ld ji le jm ks kt ku kv bi translated">我们现在可以为我们的API创建CRUD操作。要了解同样的<em class="lb">待办事项</em>步骤，可以参考<a class="ae lf" href="https://docs.microsoft.com/en-us/aspnet/core/tutorials/first-web-api?view=aspnetcore-6.0&amp;tabs=visual-studio" rel="noopener ugc nofollow" target="_blank"> Web API创建</a>。</li><li id="fb33" class="kl km hh ir b is kw iw kx ja ky je kz ji la jm ks kt ku kv bi translated">我们可以安装NuGet包<strong class="ir hi"> <em class="lb">“微软。</em>AspNet . SignalR</strong>现在。</li><li id="64cc" class="kl km hh ir b is kw iw kx ja ky je kz ji la jm ks kt ku kv bi translated">要安装NuGet软件包，我们可以导航到软件包管理器控制台并输入以下命令:</li></ul><blockquote class="lj lk ll"><p id="4072" class="ip iq lb ir b is it iu iv iw ix iy iz lm jb jc jd ln jf jg jh lo jj jk jl jm ha bi translated"><strong class="ir hi">安装包微软。AspNet . SignalR-版本2.4.2 </strong></p></blockquote><figure class="mf mg mh mi fd ii er es paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="er es me"><img src="../Images/8e65693475c607a28eb2cacab6d701a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZZmr8RrKJL7kWHmjhUDHig.png"/></div></div><figcaption class="il im et er es in io bd b be z dx">Fig-#3</figcaption></figure><h2 id="9d74" class="lq jo hh bd jp lr ls lt jt lu lv lw jx ja lx ly kb je lz ma kf ji mb mc kj md bi translated"><strong class="ak"> 2。信号代码配置</strong></h2><ul class=""><li id="92f7" class="kl km hh ir b is kn iw ko ja kp je kq ji kr jm ks kt ku kv bi translated">我们创建了<strong class="ir hi"> IHubClient </strong>接口和<strong class="ir hi"> BroadcastHub </strong>类来向Angular应用程序广播实时消息。<strong class="ir hi">接口和类都将用于向Angular应用程序广播实时消息。</strong></li></ul><figure class="mf mg mh mi fd ii er es paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="er es me"><img src="../Images/3116a66d5612e3a798de50f14937f6b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pH8--RNUmaYeqoIIfdAIIg.png"/></div></div><figcaption class="il im et er es in io bd b be z dx">Fig-#4</figcaption></figure><p id="4680" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">注意:- </strong> BroadcastHub继承自Hub &lt; IHubClient &gt;。<strong class="ir hi"> <em class="lb"> Hub类提供了与连接到Hub的SignalR连接进行通信的方法。</em>T19】</strong></p><figure class="mf mg mh mi fd ii er es paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="er es me"><img src="../Images/bf726781c03c59eecdaf19cc76d69827.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ThneMpU0bIdiwLO3B42pww.png"/></div></div><figcaption class="il im et er es in io bd b be z dx">Fig-#5</figcaption></figure><h2 id="2740" class="lq jo hh bd jp lr ls lt jt lu lv lw jx ja lx ly kb je lz ma kf ji mb mc kj md bi translated">3.Startup.cs更改和创建通知中心</h2><figure class="mf mg mh mi fd ii er es paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="er es me"><img src="../Images/4be9edd67b78ee7349af438a998ac40f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ePskifZRnZrr1aNYNzpEzA.png"/></div></div><figcaption class="il im et er es in io bd b be z dx">Fig-#6</figcaption></figure><blockquote class="lj lk ll"><p id="0a2f" class="ip iq lb ir b is it iu iv iw ix iy iz lm jb jc jd ln jf jg jh lo jj jk jl jm ha bi translated">在注册SignalR之前，请确保您已经调用了CORS中间件。我们可以在<a class="ae lf" href="https://docs.microsoft.com/en-us/aspnet/web-api/overview/security/enabling-cross-origin-requests-in-web-api" rel="noopener ugc nofollow" target="_blank">CORS</a>大会上深入了解更多信息。</p></blockquote><h2 id="90d5" class="lq jo hh bd jp lr ls lt jt lu lv lw jx ja lx ly kb je lz ma kf ji mb mc kj md bi translated">4.广播消息</h2><p id="966f" class="pw-post-body-paragraph ip iq hh ir b is kn iu iv iw ko iy iz ja lg jc jd je lh jg jh ji li jk jl jm ha bi translated">在创建任何新员工并保存更改后，我们会将更改通知客户。</p><figure class="mf mg mh mi fd ii er es paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="er es me"><img src="../Images/5777c2833db287dd4bd445a4cf020862.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CTlEAckncENYMqbfTFbcOQ.png"/></div></div><figcaption class="il im et er es in io bd b be z dx">Fig-#7</figcaption></figure><p id="2285" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">SignalR支持两种类型的消息:- <br/> 1。客户。All — 用于向连接到SignalR服务器的<strong class="ir hi"> <em class="lb">所有</em> </strong>客户端广播消息。<br/> 2。<strong class="ir hi">客户。Client(ConnectionId) </strong> —用于根据<strong class="ir hi">图4 </strong>中指定的<strong class="ir hi"> <em class="lb">连接id </em> </strong>向<strong class="ir hi"> <em class="lb">特定客户端</em> </strong>广播消息。</p><figure class="mf mg mh mi fd ii er es paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="er es me"><img src="../Images/883e1e9d526bb5e2d83ee6f8d5ff889f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wo0_aL6T4Yz6msU9LdSRlA.png"/></div></div><figcaption class="il im et er es in io bd b be z dx">Fig-#8</figcaption></figure><h2 id="4365" class="lq jo hh bd jp lr ls lt jt lu lv lw jx ja lx ly kb je lz ma kf ji mb mc kj md bi translated">5.UI集成</h2><ul class=""><li id="bca6" class="kl km hh ir b is kn iw ko ja kp je kq ji kr jm ks kt ku kv bi translated">使用下面的命令创建一个新的角度应用。<br/> <strong class="ir hi"> ng新信号员</strong>。</li><li id="ba41" class="kl km hh ir b is kw iw kx ja ky je kz ji la jm ks kt ku kv bi translated">我们可以选择创建路由的选项。(默认情况下，它为假)</li><li id="45c7" class="kl km hh ir b is kw iw kx ja ky je kz ji la jm ks kt ku kv bi translated">安装所有节点包需要一些时间。我们可以使用下面的npm命令安装<strong class="ir hi"> Signal R Client </strong>包。<br/> <strong class="ir hi"> npm安装</strong><a class="ae lf" href="http://twitter.com/microsoft/signalr" rel="noopener ugc nofollow" target="_blank"><strong class="ir hi">@微软/signalr </strong> </a> <strong class="ir hi"> </strong>。</li><li id="6c6e" class="kl km hh ir b is kw iw kx ja ky je kz ji la jm ks kt ku kv bi translated">现在，我们可以创建组件并集成API来执行CRUD操作。有关API与Angular集成的更多信息，我们可以参考<a class="ae lf" href="https://angular.io/tutorial/toh-pt6" rel="noopener ugc nofollow" target="_blank"><strong class="ir hi">Angular-API-Integration</strong></a>。</li><li id="30ba" class="kl km hh ir b is kw iw kx ja ky je kz ji la jm ks kt ku kv bi translated">为了收听服务器广播的消息，我们需要与<strong class="ir hi"><em class="lb">SignalR hub connection builder</em></strong>建立连接，连接开始。此连接将从服务器侦听来自SignalR hub的消息。每当服务器发送消息时，<strong class="ir hi"> <em class="lb">不刷新</em> </strong>所有浏览器(即多个会话)将被通知更新后的信息。</li><li id="7063" class="kl km hh ir b is kw iw kx ja ky je kz ji la jm ks kt ku kv bi translated">我们需要将下面的代码添加到组件的ngOnInit()中，在这里我们要监听广播的消息。在我的例子中，我已经调用了employees.component.ts。</li></ul><figure class="mf mg mh mi fd ii er es paragraph-image"><div role="button" tabindex="0" class="mj mk di ml bf mm"><div class="er es mn"><img src="../Images/dc832d1f3c0a2662ca2a33664770ae97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pciTK1mYTbaCb55xmIkjEA.png"/></div></div></figure><p id="b76c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">总结</strong></p><p id="d180" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们了解了如何使用SignalR为我们的应用程序提供实时功能。<em class="lb">此外，我们已经使用SignalR hub </em>从服务器向所有连接的客户端广播了一条消息。</p><p id="9beb" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi"> <em class="lb">参考文献</em> </strong></p><ol class=""><li id="9163" class="kl km hh ir b is it iw ix ja lc je ld ji le jm lp kt ku kv bi translated"><a class="ae lf" href="https://docs.microsoft.com/en-us/aspnet/signalr/overview/getting-started/tutorial-getting-started-with-signalr" rel="noopener ugc nofollow" target="_blank">教程:与SignalR 2 |微软文档的实时聊天</a></li></ol><h1 id="2ab9" class="jn jo hh bd jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk bi translated">感谢阅读。请在下面随意评论您对这篇文章的想法…</h1></div></div>    
</body>
</html>