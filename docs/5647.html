<html>
<head>
<title>Installing Apache and PHP 7 on OCI</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在OCI上安装Apache和PHP 7</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/installing-apache-and-php-7-on-oci-c0ccc2c8409d?source=collection_archive---------0-----------------------#2019-08-28">https://medium.com/oracledevs/installing-apache-and-php-7-on-oci-c0ccc2c8409d?source=collection_archive---------0-----------------------#2019-08-28</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/></div><div class="ab cl ie if go ig" role="separator"><span class="ih bw bk ii ij ik"/><span class="ih bw bk ii ij ik"/><span class="ih bw bk ii ij"/></div><div class="ha hb hc hd he"><figure class="im in io ip fd iq er es paragraph-image"><div role="button" tabindex="0" class="ir is di it bf iu"><div class="er es il"><img src="../Images/2500bf9a3435b220b60daa0360cf7539.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bZSykEoQa1Evx5A75Vvw3w.png"/></div></div><figcaption class="ix iy et er es iz ja bd b be z dx">Installing Apache web server with PHP 7 on Oracle Cloud Infrastructure</figcaption></figure><p id="97dc" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated"><strong class="jd hi">2020年2月28日—我更新了这篇文章，以适应OCI当前的用户界面和流程。</strong></p><p id="0a52" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">到目前为止，我们已经能够使用Node.js作为我们的网络服务器。这是因为我们的网络服务器并不复杂。然而，随着我们准备进入Oracle云基础设施的更高级主题，我们将成为托管网页的更好平台。由于Apache HTTPD目前享有大约60%的web服务器市场份额，所以我们使用Apache作为我们的web服务器是有意义的。此外，我们将使用PHP和Apache来处理我们对动态网页的需求。在这篇文章中，我将涵盖以下内容:</p><ol class=""><li id="cec9" class="jz ka hh jd b je jf ji jj jm kb jq kc ju kd jy ke kf kg kh bi translated">停止我们当前的节点Web服务器</li><li id="1a43" class="jz ka hh jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh bi translated">安装Apache Web服务器</li><li id="e719" class="jz ka hh jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh bi translated">配置我们的OCI环境</li><li id="3554" class="jz ka hh jd b je ki ji kj jm kk jq kl ju km jy ke kf kg kh bi translated">为Apache安装PHP</li></ol><h1 id="2896" class="kn ko hh bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">停止我们当前的节点Web服务器</h1><p id="37e0" class="pw-post-body-paragraph jb jc hh jd b je ll jg jh ji lm jk jl jm ln jo jp jq lo js jt ju lp jw jx jy ha bi translated">我们需要停止在端口3000上运行的现有web服务器。为此，我们需要关闭并禁用现有的node.js web服务器，这些服务器监听该地址并在服务器重启时自动启动。</p><p id="cc39" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">SSH到您的每个计算实例，并执行以下命令:</p><pre class="im in io ip fd lq lr ls lt aw lu bi"><span id="c89b" class="lv ko hh lr b fi lw lx l ly lz">cd /etc/systemd/system<br/>sudo systemctl disable starthelloserver.service<br/>sudo rm starthelloserver.service<br/>cd ~</span></pre><p id="2ad2" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">下次我们重新启动服务器时，helloServer将不会启动。这为我们自动启动新的Apache web服务器腾出了空间。</p><h1 id="ad7d" class="kn ko hh bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">安装Apache Web服务器</h1><p id="99ba" class="pw-post-body-paragraph jb jc hh jd b je ll jg jh ji lm jk jl jm ln jo jp jq lo js jt ju lp jw jx jy ha bi translated">为了安装Apache软件，我们需要SSH到当前托管Node.js web服务器的两个计算实例。安装命令非常简单:</p><pre class="im in io ip fd lq lr ls lt aw lu bi"><span id="2cc9" class="lv ko hh lr b fi lw lx l ly lz">sudo yum install httpd -y</span></pre><p id="30a8" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">之后，如果计算实例重启，我们需要确保服务器默认启动。以下命令将会解决这个问题:</p><pre class="im in io ip fd lq lr ls lt aw lu bi"><span id="d7bf" class="lv ko hh lr b fi lw lx l ly lz">sudo systemctl enable httpd</span></pre><p id="9953" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">让我们用下面的命令强制启动Apache服务器:</p><pre class="im in io ip fd lq lr ls lt aw lu bi"><span id="b733" class="lv ko hh lr b fi lw lx l ly lz">sudo systemctl restart httpd</span></pre><p id="0287" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">确保对两个计算实例都这样做。此时，Apache已经安装并正在运行。现在我们只需要配置OCI，允许通过负载均衡器对其进行web访问。</p><h1 id="f8fc" class="kn ko hh bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">配置我们的OCI环境</h1><p id="5a88" class="pw-post-body-paragraph jb jc hh jd b je ll jg jh ji lm jk jl jm ln jo jp jq lo js jt ju lp jw jx jy ha bi translated">在我们能够通过负载平衡器访问web服务器之前，我们需要配置现有的后端集来监听端口80。为此，只需从负载均衡器中找到您的负载均衡器(在<strong class="jd hi"> <em class="ma">网络</em> </strong>菜单项下)。单击负载平衡器，然后找到并单击后端的链接。选择两个现有的计算实例，并使用Actions按钮编辑端口号。</p><figure class="im in io ip fd iq er es paragraph-image"><div role="button" tabindex="0" class="ir is di it bf iu"><div class="er es mb"><img src="../Images/a49a51838024a843ab700bb264ca06f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xUb9lteJOarFWPPc4zzWfg.png"/></div></div><figcaption class="ix iy et er es iz ja bd b be z dx">How to edit the port for a backend set</figcaption></figure><p id="5238" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">现在，使用以下命令对每个实例进行SSH，并在防火墙中打开端口80:</p><pre class="im in io ip fd lq lr ls lt aw lu bi"><span id="201e" class="lv ko hh lr b fi lw lx l ly lz">sudo firewall-cmd --permanent --add-port=80/tcp</span></pre><p id="183c" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">既然我们在这里，我们不妨去掉旧的3000端口。</p><pre class="im in io ip fd lq lr ls lt aw lu bi"><span id="0300" class="lv ko hh lr b fi lw lx l ly lz">sudo firewall-cmd --permanent --remove-port=3000/tcp</span></pre><p id="44d5" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">现在让我们激活这些更改:</p><pre class="im in io ip fd lq lr ls lt aw lu bi"><span id="1efd" class="lv ko hh lr b fi lw lx l ly lz">sudo firewall-cmd --reload</span></pre><p id="17f6" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated"><strong class="jd hi">注意:</strong>这些防火墙命令可能与其他平台上的命令不同。</p><p id="2982" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">现在，您应该能够打开浏览器到<code class="du mc md me lr b">https://&lt;your domain name&gt;</code>并看到Apache主页:</p><figure class="im in io ip fd iq er es paragraph-image"><div role="button" tabindex="0" class="ir is di it bf iu"><div class="er es mf"><img src="../Images/093911efe71c3aa99e321665ab63ba71.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j7xpHHsPRJfIdccnsNYkMw.png"/></div></div></figure><h1 id="4952" class="kn ko hh bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">为Apache安装PHP</h1><p id="02a6" class="pw-post-body-paragraph jb jc hh jd b je ll jg jh ji lm jk jl jm ln jo jp jq lo js jt ju lp jw jx jy ha bi translated">这遵循为Apache安装PHP的标准过程。</p><pre class="im in io ip fd lq lr ls lt aw lu bi"><span id="cae6" class="lv ko hh lr b fi lw lx l ly lz">sudo yum install <a class="ae mg" href="https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm" rel="noopener ugc nofollow" target="_blank">https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm</a></span><span id="96bf" class="lv ko hh lr b fi mh lx l ly lz">sudo yum install <a class="ae mg" href="http://rpms.remirepo.net/enterprise/remi-release-7.rpm" rel="noopener ugc nofollow" target="_blank">http://rpms.remirepo.net/enterprise/remi-release-7.rpm</a></span><span id="9b9f" class="lv ko hh lr b fi mh lx l ly lz">sudo yum install yum-utils</span><span id="cb7b" class="lv ko hh lr b fi mh lx l ly lz">sudo yum-config-manager --enable remi-php73</span><span id="4f2c" class="lv ko hh lr b fi mh lx l ly lz">sudo yum install php php-mcrypt php-cli php-gd php-curl php-mysql php-ldap php-zip php-fileinfo</span></pre><p id="8dc4" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">请注意，这些命令中有许多需要您在终端中键入<code class="du mc md me lr b">y</code>来接受。现在，您可以从命令行检查已经安装的PHP版本:</p><pre class="im in io ip fd lq lr ls lt aw lu bi"><span id="5100" class="lv ko hh lr b fi lw lx l ly lz">php -v</span></pre><p id="50ee" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">这将向您显示以下内容:</p><figure class="im in io ip fd iq er es paragraph-image"><div role="button" tabindex="0" class="ir is di it bf iu"><div class="er es mi"><img src="../Images/b9ae263af3a4ca5849ef2ce80141eb1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WyxEFsVlVkNmG6tpDH53Ng.png"/></div></div></figure><h2 id="aff0" class="lv ko hh bd kp mj mk ml kt mm mn mo kx jm mp mq lb jq mr ms lf ju mt mu lj mv bi translated">测试PHP安装</h2><p id="c5fa" class="pw-post-body-paragraph jb jc hh jd b je ll jg jh ji lm jk jl jm ln jo jp jq lo js jt ju lp jw jx jy ha bi translated">使用ssh连接到您的每个服务器实例，导航到/var/www/html并使用以下命令创建一个名为【info.php】<em class="ma">和的文件:</em></p><pre class="im in io ip fd lq lr ls lt aw lu bi"><span id="7c5f" class="lv ko hh lr b fi lw lx l ly lz">sudo vi /var/www/html/info.php</span></pre><p id="c11f" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">编辑文件以包含以下内容:</p><pre class="im in io ip fd lq lr ls lt aw lu bi"><span id="2a2e" class="lv ko hh lr b fi lw lx l ly lz">&lt;?php<br/>phpinfo();<br/>?&gt;</span></pre><p id="00ad" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">保存文件，并在另一个计算实例中做同样的事情。现在，您可以将web浏览器指向<code class="du mc md me lr b">https://&lt;your domain name&gt;/info.php</code>，查看Apache和PHP安装的详细信息:</p><figure class="im in io ip fd iq er es paragraph-image"><div role="button" tabindex="0" class="ir is di it bf iu"><div class="er es mw"><img src="../Images/736f40ea5840fced5b5c3d989dbe32a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OonwI68zRo9KvsDqsSpS7Q.png"/></div></div></figure><p id="4e24" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">您可以通过刷新浏览器并查看info.php页面顶部系统行上的服务器名称来验证负载平衡器是否正常工作。</p><p id="bc11" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated"><strong class="jd hi">注意:</strong>如果您没有看到正确显示的页面，而是看到了实际的PHP代码，请重启compute实例并重试。有时需要重启Apache</p><h1 id="3d95" class="kn ko hh bd kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk bi translated">结论</h1><p id="befe" class="pw-post-body-paragraph jb jc hh jd b je ll jg jh ji lm jk jl jm ln jo jp jq lo js jt ju lp jw jx jy ha bi translated">希望这有助于揭开在OCI上运行PHP的神秘面纱。自然，如果我们有大量的web服务器需要管理，手动进行这些更改将是一种浪费。更好的大规模方法是创建一个完全配置的服务器映像，并使用该映像创建新的计算实例，并将它们添加到负载平衡器的备份集中。</p><p id="b28c" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">在我的下一篇文章中，我将向您展示如何创建一个简单的PHP网站，该网站利用OCIs内置身份云服务(IDCS)通过要求用户登录网站来帮助您控制对网站内容的访问。</p><p id="867c" class="pw-post-body-paragraph jb jc hh jd b je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt ju jv jw jx jy ha bi translated">一如既往，我希望你喜欢这篇文章，并发现它很有用。如果是的话，请给我一个掌声，像往常一样，随时问任何问题。</p></div></div>    
</body>
</html>