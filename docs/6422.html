<html>
<head>
<title>Using nullability annotations in interop between JAVA and Kotlin</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在JAVA和Kotlin的互操作中使用可空性注释</h1>
<blockquote>原文：<a href="https://medium.com/quick-code/the-case-of-npe-in-interop-between-java-and-kotlin-8790b2b73e18?source=collection_archive---------6-----------------------#2018-02-04">https://medium.com/quick-code/the-case-of-npe-in-interop-between-java-and-kotlin-8790b2b73e18?source=collection_archive---------6-----------------------#2018-02-04</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="1386" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Kotlin在最近几年越来越受欢迎，现在在Android开发社区非常流行。一年前我开始研究Kotlin，和大多数程序员一样，我很敬畏。这是迈向前端开发新时代的正确且几乎完全的一步。</p><p id="94bf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当想到Kotlin时，人们脑海中浮现的第一个优点当然是零安全特性。它很好，但也有一些陷阱需要注意，尤其是当你在一个应用程序代码库中同时拥有java和kotlin的时候。在这篇文章中，我将解释其中的一些，让你意识到它可能带来的负面影响。</p><p id="2f78" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">如果您认为NullPointerException已经消失，请耐心等待。这里有一个NPE的例子:</p><p id="952f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">假设你有一个Java方法，在某些情况下可能会返回<code class="du jc jd je jf b">null</code>。看看下面的代码示例。</p><pre class="jg jh ji jj fd jk jf jl jm aw jn bi"><span id="e6fd" class="jo jp hh jf b fi jq jr l js jt">public String getMyString(boolean giveMeNull) {<br/>     return giveMeNull ? null : “GOOD”;<br/>}</span></pre><p id="5e95" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">看起来很无辜？如果试图从Kotlin源代码中调用这个方法作为函数会发生什么？如果你用true作为参数调用这个函数，你会得到一个异常。为什么？？</p><p id="4e9e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Kotlin编译器依赖注释<code class="du jc jd je jf b">@Nullable</code>来决定返回类型或参数类型。因为我们的Java方法返回类型上没有<code class="du jc jd je jf b">@Nullable</code>注释，Kotlin认为返回类型是不可空的，这就是为什么它会出错。</p><p id="f173" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这对一些android库方法和类也有不好的影响。我找到的其中一个就是<code class="du jc jd je jf b">SpannableString </code>级。考虑下面的示例代码:</p><pre class="jg jh ji jj fd jk jf jl jm aw jn bi"><span id="c0e5" class="jo jp hh jf b fi jq jr l js jt">val mainString: String? = null</span><span id="24bd" class="jo jp hh jf b fi ju jr l js jt">val spannableString = SpannableString(mainString)</span></pre><p id="7c40" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这种情况下，你也会获得NPE奖。android.text包中的<code class="du jc jd je jf b">SpannableString </code>构造函数在参数上没有定义<code class="du jc jd je jf b">@Nullablle </code>注释，如果提供的参数是<code class="du jc jd je jf b">null</code>，它会抛出一个NPE，原因很明显。现在，如果这是从java源调用的，你可能通过确保参数不为空来捕捉空值，但是因为在Kotlin中你没有意识到空值检查，你可能会落入这个陷阱。</p><p id="14f4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">好了，就这样..这些看起来很小的问题，你甚至可能不会遇到，但是记住它们绝对是安全的。安全编码！！再见。</p><p id="09db" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">有关更多信息，请查看官方文档<a class="ae jv" href="https://kotlinlang.org/docs/reference/java-interop.html#nullability-annotations" rel="noopener ugc nofollow" target="_blank">https://kot linlang . org/docs/reference/Java-interop . html # nullability-annotations</a></p></div></div>    
</body>
</html>