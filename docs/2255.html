<html>
<head>
<title>Today I Learned Series : Embedding Native Data Type in Golang</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">今天我学习了系列:在Golang中嵌入本地数据类型</h1>
<blockquote>原文：<a href="https://medium.easyread.co/today-i-learned-series-embedding-native-data-type-in-golang-2ac3703fe73d?source=collection_archive---------2-----------------------#2018-01-30">https://medium.easyread.co/today-i-learned-series-embedding-native-data-type-in-golang-2ac3703fe73d?source=collection_archive---------2-----------------------#2018-01-30</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="1717" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">今天我在Easyread上学习了系列</h2></div><figure class="ke kf kg kh gt ki gh gi paragraph-image"><div role="button" tabindex="0" class="kj kk di kl bf km"><div class="gh gi kd"><img src="../Images/20759d4d6177967a3472952abb281ea2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*57FMtR88ueSTPH9xNODrrw.png"/></div></div><figcaption class="kp kq gj gh gi kr ks bd b be z dk">Today I Learned from Google Images</figcaption></figure><p id="7c33" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">今天我在为我们公司的新功能工作。在开发它的时候，我会遇到新的问题。</p><p id="5614" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我很好奇，Golang中的本地数据类型是否可以嵌入到struct中。</p><pre class="ke kf kg kh gt lp lq lr ls aw lt bi"><span id="9407" class="lu lv in lq b gy lw lx l ly lz">type  SomeStruct  struct {<br/> map[string]interface{}<br/> []int64<br/> FieldA string `json:"field_a"`<br/>}</span></pre><p id="00a9" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">但是试过之后，发现这是非法选项。然后，我尝试了一种新的方法。也就是定义一种新的数据类型。</p><pre class="ke kf kg kh gt lp lq lr ls aw lt bi"><span id="50ee" class="lu lv in lq b gy lw lx l ly lz">type CustomMap map[string]interface{}<br/>type CustomArrayInt []int64</span></pre><p id="a004" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">然后把它嵌入到我想要的结构中</p><pre class="ke kf kg kh gt lp lq lr ls aw lt bi"><span id="1734" class="lu lv in lq b gy lw lx l ly lz">type  SomeStruct  struct {<br/> CustomMap <br/> CustomArrayInt <br/> FieldA string `json:"field_a"`<br/>}</span></pre><p id="d385" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">不知何故，这是有效的。运行这段代码时没有编译错误。</p><h2 id="f168" class="lu lv in bd ma mb mc dn md me mf dp mg lc mh mi mj lg mk ml mm lk mn mo mp mq bi translated">转换成JSON</h2><p id="1d43" class="pw-post-body-paragraph kt ku in kv b kw mr jo ky kz ms jr lb lc mt le lf lg mu li lj lk mv lm ln lo ig bi translated">然后，我很好奇，如果我用上面的struct把数据转换成JSON会发生什么。</p><pre class="ke kf kg kh gt lp lq lr ls aw lt bi"><span id="e825" class="lu lv in lq b gy lw lx l ly lz">func convertToJSON() string {<br/> mapOne := CustomMap{<br/>  "age":    20,<br/>  "gender": "male",<br/> }<br/> numbers := CustomArrayInt{<br/>  2, 3, 4, 5,<br/> }<br/> sample := SomeStruct{<br/>  CustomMap:      mapOne,<br/>  CustomArrayInt: numbers,<br/>  FieldA:         "sample",<br/> }<br/> jbyt, err := json.Marshal(sample)<br/> if err != nil {<br/>  log.Fatal(err)<br/> }<br/> return string(jbyt)<br/>}</span></pre><p id="053b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当打印这个结果时，它打印:</p><pre class="ke kf kg kh gt lp lq lr ls aw lt bi"><span id="9ce8" class="lu lv in lq b gy lw lx l ly lz">{<br/>"CustomMap":<br/>   { "age":20,<br/>     "gender":"male"<br/>   },<br/>"CustomArrayInt":[2,3,4,5],<br/> "field_a":"sample"<br/>}</span></pre><p id="b53b" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">嗯，这不是我所期望的。我想会是这样的:</p><pre class="ke kf kg kh gt lp lq lr ls aw lt bi"><span id="6edc" class="lu lv in lq b gy lw lx l ly lz">{<br/> "age":20,<br/> "gender" : "male", <br/> "CustomArrayInt":[2,3,4,5],<br/> "field_a": "sample"<br/>}</span></pre><p id="2d21" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">但是我错了。如果使用嵌入式结构，情况会有所不同。</p><p id="5d61" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">稍后为了让JSON看起来更干净，我添加了JSON标签</p><pre class="ke kf kg kh gt lp lq lr ls aw lt bi"><span id="c8af" class="lu lv in lq b gy lw lx l ly lz">type SomeStruct struct {<br/> CustomMap      `json:"custom_map"`<br/> CustomArrayInt `json:"custom_array"`<br/> FieldA         string `json:"field_a"`<br/>}</span></pre><p id="753c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">所以它的JSON更像下面这个样子。更漂亮。</p><pre class="ke kf kg kh gt lp lq lr ls aw lt bi"><span id="83d4" class="lu lv in lq b gy lw lx l ly lz">{<br/> "custom_map":<br/>  { "age":20,<br/>    "gender":"male"<br/>  },<br/>"custom_array":[2,3,4,5],<br/>"field_a":"sample"<br/>}</span></pre><p id="b172" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">但是，我确定。我今天学到了一件新东西。Golang游乐场的源代码:</p><div class="mw mx gp gr my mz"><a href="https://play.golang.org/p/iJ-Vihgb_vx" rel="noopener  ugc nofollow" target="_blank"><div class="na ab fo"><div class="nb ab nc cl cj nd"><h2 class="bd io gy z fp ne fr fs nf fu fw im bi translated">围棋运动场</h2><div class="ng l"><h3 class="bd b gy z fp ne fr fs nf fu fw dk translated">操场服务不仅仅被官方Go项目使用(Go by Example是另一个例子),我们…</h3></div><div class="nh l"><p class="bd b dl z fp ne fr fs nf fu fw dk translated">play.golang.org</p></div></div></div></a></div></div><div class="ab cl ni nj hr nk" role="separator"><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn no"/><span class="nl bw bk nm nn"/></div><div class="ig ih ii ij ik"><figure class="ke kf kg kh gt ki"><div class="bz fp l di"><div class="np nq l"/></div></figure></div></div>    
</body>
</html>