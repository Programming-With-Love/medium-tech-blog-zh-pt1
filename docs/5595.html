<html>
<head>
<title>Manage Oracle Container Engine for Kubernetes with Ansible Modules</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Ansible模块管理用于Kubernetes的Oracle容器引擎</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/manage-oracle-container-engine-for-kubernetes-with-ansible-modules-38682382e8c1?source=collection_archive---------2-----------------------#2019-04-04">https://medium.com/oracledevs/manage-oracle-container-engine-for-kubernetes-with-ansible-modules-38682382e8c1?source=collection_archive---------2-----------------------#2019-04-04</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex ie if ig ih er es paragraph-image"><div class="ab fe cl ii"><img src="../Images/40c08dfc9a761722b3bb283d63acfbaf.png" data-original-src="https://miro.medium.com/v2/format:webp/0*QuX76iAj0t6_pjav.png"/></div></figure><p id="8c92" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><em class="jj">本帖由</em><a class="jk jl ge" href="https://medium.com/u/4defe20cc06d?source=post_page-----38682382e8c1--------------------------------" rel="noopener" target="_blank"><em class="jj">Rohit Chaware</em></a><em class="jj">和</em><a class="jk jl ge" href="https://medium.com/u/2ae078946a2?source=post_page-----38682382e8c1--------------------------------" rel="noopener" target="_blank"><em class="jj">siva Kumar Thyagarajan</em></a><em class="jj">联合撰写。</em></p><p id="c2d9" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">去年，我们宣布了适用于Oracle云基础设施的Ansible模块。这些Ansible模块使您能够自动调配和配置Oracle云基础架构资源。</p><p id="1a80" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">许多开发人员和部署人员正在采用Kubernetes来可靠地部署、编排、扩展和管理云中的分布式应用程序。然而，在云提供商的基础设施(计算、网络和存储)上设置和维护Kubernetes集群既复杂又耗时，并且需要对Kubernetes集群操作和云提供商的基础设施层有深入的了解。</p><p id="9524" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">Oracle Cloud infra structure<a class="ae jm" href="https://blogs.oracle.com/cloud-infrastructure/kubernetes-a-cloud-and-data-center-operating-system" rel="noopener ugc nofollow" target="_blank">Container Engine for Kubernetes</a>是一项完全托管、可扩展且高度可用的服务，您可以使用它将容器化的应用程序部署到云中。该服务使您能够快速创建、管理和使用利用底层Oracle云基础架构计算、网络和存储服务的Kubernetes集群，而无需自行安装和维护复杂的支持Kubernetes基础架构。开发人员可以专注于构建容器原生微服务和无服务器应用，而无需担心Kubernetes集群的部署和管理。</p><p id="9426" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">Oracle Cloud infra structure Console、<a class="ae jm" href="https://www.terraform.io/docs/providers/oci/" rel="noopener ugc nofollow" target="_blank"> Terraform provider </a>和各种SDK为Kubernetes(有时缩写为OKE)的容器引擎提供支持。但是，如果您使用Ansible进行基础设施自动化和配置管理，我们的<a class="ae jm" href="http://github.com/oracle/oci-ansible-modules" rel="noopener ugc nofollow" target="_blank"> Ansible模块</a>包括特定于Kubernetes容器引擎的模块，以帮助您自动创建Kubernetes集群、节点池和其他相关构件。这篇文章描述了如何使用Kubernetes和Ansible的容器引擎来创建和管理一个Kubernetes集群。</p><p id="47e9" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">此处描述的步骤显示了如何执行以下任务:</p><ol class=""><li id="7021" class="jn jo hh in b io ip is it iw jp ja jq je jr ji js jt ju jv bi translated">为Kubernetes集群的容器引擎创建所有必要的先决资源(VCN、子网和相关资源)。</li><li id="f9ea" class="jn jo hh in b io jw is jx iw jy ja jz je ka ji js jt ju jv bi translated">使用Kubernetes的容器引擎创建一个Kubernetes集群。</li><li id="3727" class="jn jo hh in b io jw is jx iw jy ja jz je ka ji js jt ju jv bi translated">创建节点池。</li><li id="fd22" class="jn jo hh in b io jw is jx iw jy ja jz je ka ji js jt ju jv bi translated">为集群下载kubeconfig文件。</li><li id="05f0" class="jn jo hh in b io jw is jx iw jy ja jz je ka ji js jt ju jv bi translated">在集群上部署一个示例应用程序。</li></ol><p id="788f" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated"><strong class="in hi">注意:</strong>这篇文章只展示了大剧本中的相关片段。要获得可以用来为Kubernetes集群创建和管理容器引擎的完整行动手册，请参见<a class="ae jm" href="https://github.com/oracle/oci-ansible-modules/tree/master/samples/container_engine/deploy_app_on_k8s_cluster" rel="noopener ugc nofollow" target="_blank"> deploy_app_on_k8s_cluster示例</a>。该示例的自述文件提供了如何针对您的Oracle云基础架构租赁重现本行动手册中的步骤的说明。</p><h1 id="2f18" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">步骤1:创建先决资源</h1><p id="c9c9" class="pw-post-body-paragraph il im hh in b io kz iq ir is la iu iv iw lb iy iz ja lc jc jd je ld jg jh ji ha bi translated">要为Kubernetes创建一个带有容器引擎的Kubernetes集群，您需要一个虚拟云网络(VCN)以及五个子网、一个互联网网关、一个路由表和两个安全列表，详见文档中的<a class="ae jm" href="https://docs.cloud.oracle.com/iaas/Content/ContEng/Concepts/contengnetworkconfig.htm" rel="noopener ugc nofollow" target="_blank">。你可以参考</a><a class="ae jm" href="https://github.com/oracle/oci-ansible-modules/blob/master/samples/container_engine/deploy_app_on_k8s_cluster/setup.yaml" rel="noopener ugc nofollow" target="_blank">这个剧本</a>来设置Kubernetes的容器引擎的先决条件。本行动手册采用Oracle云基础架构网络和身份与访问管理(IAM)服务的可转换模块来创建各种构件。</p><h1 id="0540" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">步骤2:创建一个Kubernetes集群</h1><p id="f663" class="pw-post-body-paragraph il im hh in b io kz iq ir is la iu iv iw lb iy iz ja lc jc jd je ld jg jh ji ha bi translated">使用您在上一步中创建的VCN和子网，您可以通过使用<a class="ae jm" href="https://oracle-cloud-infrastructure-ansible-modules.readthedocs.io/en/latest/modules/oci_cluster_module.html" rel="noopener ugc nofollow" target="_blank"> oci_cluster </a>模块创建一个新的Kubernetes集群。通过使用<a class="ae jm" href="https://oracle-cloud-infrastructure-ansible-modules.readthedocs.io/en/latest/modules/oci_cluster_options_facts_module.html" rel="noopener ugc nofollow" target="_blank">OCI _ cluster _ options _ facts</a>模块，您可以动态地检索Kubernetes版本以用于集群中的主节点和工作节点(参见<a class="ae jm" href="https://github.com/oracle/oci-ansible-modules/blob/master/samples/container_engine/deploy_app_on_k8s_cluster/sample.yaml" rel="noopener ugc nofollow" target="_blank">示例</a>)。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="af86" class="ln kc hh lj b fi lo lp l lq lr">- name: Create a Kubernetes cluster with OKE<br/>  oci_cluster:<br/>    compartment_id: "{{ cluster_compartment }}"<br/>    name: "{{ cluster_name }}"<br/>    vcn_id: "{{ vcn_id }}"<br/>    kubernetes_version: "{{ k8s_version }}"<br/>    options:<br/>      service_lb_subnet_ids:<br/>        - "{{ lb_subnet1_id }}"<br/>        - "{{ lb_subnet2_id }}"<br/>  register: result<br/>- set_fact:<br/>    cluster_id: "{{ result.cluster.id }}"</span></pre><h1 id="6826" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">步骤3:创建节点池</h1><p id="ca7d" class="pw-post-body-paragraph il im hh in b io kz iq ir is la iu iv iw lb iy iz ja lc jc jd je ld jg jh ji ha bi translated">现在，您可以使用<a class="ae jm" href="https://oracle-cloud-infrastructure-ansible-modules.readthedocs.io/en/latest/modules/oci_node_pool_module.html" rel="noopener ugc nofollow" target="_blank"> oci_node_pool </a>模块创建一个节点池，在三个工作节点子网中各有一个节点(每个子网位于不同的可用性域中，以确保高可用性)。您还可以使用<a class="ae jm" href="https://oracle-cloud-infrastructure-ansible-modules.readthedocs.io/en/latest/modules/oci_node_pool_options_facts_module.html" rel="noopener ugc nofollow" target="_blank">OCI _ node _ pool _ options _ facts</a>模块来选择节点的图像和形状(参见<a class="ae jm" href="https://github.com/oracle/oci-ansible-modules/blob/master/samples/container_engine/deploy_app_on_k8s_cluster/sample.yaml" rel="noopener ugc nofollow" target="_blank">示例</a>)。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="e0f1" class="ln kc hh lj b fi lo lp l lq lr">- name: Create a node pool<br/>  oci_node_pool:<br/>    cluster_id: "{{ cluster_id }}"<br/>    compartment_id: "{{ cluster_compartment }}"<br/>    name: "{{ node_pool_name }}"<br/>    kubernetes_version: "{{ k8s_version }}"<br/>    node_image_name: "{{ node_image_name }}"<br/>    node_shape: "{{ node_shape }}"<br/>    quantity_per_subnet: 1<br/>    subnet_ids:<br/>      - "{{ ad1_subnet_id }}"<br/>      - "{{ ad2_subnet_id }}"<br/>      - "{{ ad3_subnet_id }}"</span></pre><h1 id="4465" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">步骤4:为集群下载kubeconfig文件</h1><p id="1532" class="pw-post-body-paragraph il im hh in b io kz iq ir is la iu iv iw lb iy iz ja lc jc jd je ld jg jh ji ha bi translated">您可以使用<a class="ae jm" href="https://oracle-cloud-infrastructure-ansible-modules.readthedocs.io/en/latest/modules/oci_kubeconfig_module.html" rel="noopener ugc nofollow" target="_blank"> oci_kubeconfig </a>模块下载集群的kubeconfig文件。指定集群的OCID，并将文件路径指定为dest的值，以指示kubeconfig文件的写入位置。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="d64d" class="ln kc hh lj b fi lo lp l lq lr">- name: Download kubeconfig<br/>  oci_kubeconfig:<br/>    cluster_id: "{{ cluster_id }}"<br/>    dest: "{{ kubeconfig_path }}"<br/>    force: true</span></pre><h1 id="b1b9" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">步骤5:在集群上部署一个示例应用程序</h1><p id="3746" class="pw-post-body-paragraph il im hh in b io kz iq ir is la iu iv iw lb iy iz ja lc jc jd je ld jg jh ji ha bi translated">您现在可以通过使用<a class="ae jm" href="https://docs.ansible.com/ansible/2.5/modules/k8s_raw_module.html" rel="noopener ugc nofollow" target="_blank"> k8s_raw </a>模块来部署一个示例应用程序。要断言成功部署，请使用同一个模块检索部署细节。</p><pre class="le lf lg lh fd li lj lk ll aw lm bi"><span id="27c8" class="ln kc hh lj b fi lo lp l lq lr">- name: Create a deployment and a service on the created OKE cluster<br/>  k8s_raw:<br/>    kubeconfig: "{{ kubeconfig_path }}"<br/>    state: present<br/>    src: "{{ deployment_yaml_path }}"<br/>  register: result</span><span id="379e" class="ln kc hh lj b fi ls lp l lq lr">- name: Get the deployment to assert successful deployment<br/>  k8s_raw:<br/>    kubeconfig: "{{ kubeconfig_path }}"<br/>    namespace: default<br/>    kind: Deployment<br/>    name: "{{ deployment_name }}"<br/>  register: deployment</span></pre><h1 id="7f9e" class="kb kc hh bd kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky bi translated">结论</h1><p id="2877" class="pw-post-body-paragraph il im hh in b io kz iq ir is la iu iv iw lb iy iz ja lc jc jd je ld jg jh ji ha bi translated">在这篇博客文章中，我们展示了如何使用Oracle Cloud infra structure ansi ble modules为Kubernetes提供一个Kubernetes集群以及容器引擎中的一个节点池，并将一个示例应用程序部署到新的Kubernetes集群。有关这些模块的更多信息，请观看此视频:</p><figure class="le lf lg lh fd ih"><div class="bz dy l di"><div class="lt lu l"/></div></figure><p id="650b" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">要使用我们的Ansible模块尝试更多示例和解决方案，请浏览GitHub上的<a class="ae jm" href="https://github.com/oracle/oci-ansible-modules" rel="noopener ugc nofollow" target="_blank"> oci-ansible-modules </a>项目中的<a class="ae jm" href="https://github.com/oracle/oci-ansible-modules/tree/master/samples" rel="noopener ugc nofollow" target="_blank"> samples </a>目录。有关这些可用模块的文档以及有关可用动态清单脚本的详细信息，请参见<a class="ae jm" href="https://docs.cloud.oracle.com/iaas/Content/API/SDKDocs/ansiblegetstarted.htm" rel="noopener ugc nofollow" target="_blank">入门</a>和<a class="ae jm" href="https://oracle-cloud-infrastructure-ansible-modules.readthedocs.io/en/latest/modules/list_of_cloud_modules.html" rel="noopener ugc nofollow" target="_blank">可用模块文档</a>。</p><p id="792e" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">如果您需要帮助，请使用以下渠道:</p><ul class=""><li id="3614" class="jn jo hh in b io ip is it iw jp ja jq je jr ji lv jt ju jv bi translated"><a class="ae jm" href="https://github.com/oracle/oci-ansible-modules/issues" rel="noopener ugc nofollow" target="_blank"> oci-ansible-modules GitHub问题页面</a></li><li id="aa22" class="jn jo hh in b io jw is jx iw jy ja jz je ka ji lv jt ju jv bi translated"><a class="ae jm" href="https://stackoverflow.com/" rel="noopener ugc nofollow" target="_blank">栈溢出</a>，在你的帖子中使用<a class="ae jm" href="https://stackoverflow.com/questions/tagged/oracle-cloud-infrastructure" rel="noopener ugc nofollow" target="_blank">Oracle-cloud-infra structure</a>和<a class="ae jm" href="https://stackoverflow.com/questions/tagged/oci-ansible-modules" rel="noopener ugc nofollow" target="_blank"> oci-ansible-modules </a>标签</li><li id="f9c6" class="jn jo hh in b io jw is jx iw jy ja jz je ka ji lv jt ju jv bi translated">Oracle云论坛的<a class="ae jm" href="https://community.oracle.com/community/groundbreakers/oracle-cloud/cloud-infrastructure/content?filterID=contentstatus%5Bpublished%5D~category%5Bdeveloper-tools%5D" rel="noopener ugc nofollow" target="_blank">开发者工具</a>部分</li><li id="9376" class="jn jo hh in b io jw is jx iw jy ja jz je ka ji lv jt ju jv bi translated"><a class="ae jm" href="https://community.oracle.com/community/groundbreakers/oracle-cloud/cloud-infrastructure/content" rel="noopener ugc nofollow" target="_blank">我的甲骨文支持</a></li></ul><p id="5210" class="pw-post-body-paragraph il im hh in b io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji ha bi translated">快乐自动化使用Ansible！</p></div></div>    
</body>
</html>