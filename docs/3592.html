<html>
<head>
<title>Configure Web Application Firewall(WAF) with Azure Application Gateway</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Azure应用程序网关配置Web应用程序防火墙(WAF)</h1>
<blockquote>原文：<a href="https://medium.com/globant/configure-web-application-firewall-waf-with-azure-application-gateway-68961542f4e2?source=collection_archive---------0-----------------------#2020-12-29">https://medium.com/globant/configure-web-application-firewall-waf-with-azure-application-gateway-68961542f4e2?source=collection_archive---------0-----------------------#2020-12-29</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="46a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">WAF的需求是什么？</strong></p><p id="5185" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为什么我们需要保护web应用程序免受攻击，为什么web应用程序是这么多攻击的目标？</p><p id="4d30" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第一个原因是，我们正在使用已知的技术开发web应用程序。许多已知的web开发平台(如PHP和ASP)都有已知的安全缺陷，攻击者利用这些弱点来利用应用程序。这些应用程序在后端使用的数据库引擎也是如此。</p><p id="569b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">第二个原因是攻击的范围很广。web应用程序的主要用户通过互联网进行连接。任何人都可能试图从互联网上使用或攻击您的应用程序。</p><p id="2824" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">几乎所有这些攻击都可以归为几类，SQL注入攻击、跨站脚本、远程文件包含、丢失HTTP头、僵尸程序、爬虫和扫描程序在互联网上冲浪，试图找到脆弱的web应用程序、破坏web应用程序的过大请求等等。</p><p id="c3f6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">所有这些攻击都是可以预防的。一种方法是在代码级别进行预防，这很有挑战性，这是开发人员的责任。此外，它需要在应用程序的多个层进行大量的维护、修补和监控。另一种简单得多的方法是购买web应用程序防火墙(WAFs ),并将其部署在web服务器的前面，以阻止常见的攻击。这为您的web应用程序提供了集中保护，使其免受常见利用和漏洞的攻击。</p><blockquote class="jc jd je"><p id="c4d8" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated"><strong class="ig hi"> web应用防火墙</strong> (WAF)是一种特定形式的网络安全系统，它根据配置的策略过滤、监控和阻止进出web服务的HTTP流量，通常有预定义的规则集可供选择。</p></blockquote><p id="f4bb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">什么是Azure Web应用防火墙？</strong></p><p id="0861" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">微软Azure也有一个WAF服务，为你的web应用提供集中保护，防止常见的攻击和漏洞。Azure Web应用防火墙是Azure应用网关(第7层负载平衡器)的功能之一，其主要目标是保护Web应用免受常见攻击，如SQL注入、跨站点脚本等。它还遵循开放Web应用程序安全项目(<strong class="ig hi"> OWASP) </strong>核心规则集。Azure WAF服务允许您从OWASP核心规则集中选择部分或全部规则。</p><p id="4348" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Azure应用网关有一个公共IP，或者前端，你的应用用户将使用这个IP地址连接到你的应用网关。应用网关将接收传入的流量，并根据一些规则将流量重定向到后端池中适当的后端。后端池中可以有应用服务、虚拟机、虚拟机规模集，甚至其他IP地址。</p><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es jj"><img src="../Images/51a023113ce8215e4dc506bfb96d65fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nach_aT7FxGtdl9evXj6bg.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx">Image Source : Microsoft</figcaption></figure><p id="c298" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">好处</strong></p><ul class=""><li id="7826" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">它可以通过Azure门户、REST APIs、PowerShell和CLI进行配置、部署和管理。</li><li id="45aa" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">它适用于所有类型的web应用程序(ASP。NET，PHP，JSP等。)</li><li id="66f4" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">应用层不需要任何代码更改。</li><li id="96f3" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">实时保护监控日志。</li><li id="ccbe" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">根据应用需求定制规则。</li></ul><blockquote class="jc jd je"><p id="11d2" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated">你可以在这里找到<a class="ae kn" href="https://docs.microsoft.com/en-us/azure/web-application-firewall/ag/ag-overview#features" rel="noopener ugc nofollow" target="_blank">服务的所有其他功能</a></p></blockquote><p id="8fb5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">晶圆模式</strong></p><ul class=""><li id="ab82" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated"><strong class="ig hi">检测:</strong>如果我们在“检测”模式下运行WAF，则监控所有威胁警报并将其记录到日志文件中。在这种模式下，任何传入的请求都不会被阻止，并且会被记录在WAF日志中。</li><li id="e88e" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated"><strong class="ig hi">预防:</strong>针对攻击检测并阻止传入请求，攻击者在“预防”模式下简单接收403禁止错误。此模式还会在WAF日志中记录此类攻击。</li></ul><blockquote class="jc jd je"><p id="3e5c" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated">对于任何应用，建议从WAF的检测模式开始。首先监控WAF日志中所选的规则，分析日志并重新访问规则集，以确定所选的规则集对于要在阻止模式中阻止的流量是否是正确的组合。</p></blockquote><p id="973a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">晶圆定价</strong></p><p id="6478" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Azure web应用防火墙费用基于我们在部署期间选择的版本:</p><ul class=""><li id="de28" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated"><strong class="ig hi"> Web应用防火墙:</strong>在这里，你将拥有一个至少中等规模的Azure应用网关的每小时价格。此外，价格取决于WAF将处理的数据量。</li><li id="08c2" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated"><strong class="ig hi"> Web应用防火墙V2: </strong>在这里，您将看到每小时的价格和基于“容量单位”数量的成本。您可以在此了解更多关于容量单位<a class="ae kn" href="https://docs.microsoft.com/id-id/azure/application-gateway/application-gateway-autoscaling-zone-redundant#pricing" rel="noopener ugc nofollow" target="_blank">的信息</a></li></ul><blockquote class="jc jd je"><p id="7f47" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated"><a class="ae kn" href="https://azure.microsoft.com/en-in/updates/azure-application-gateway-standardv2-wafv2-skus-generally-available/" rel="noopener ugc nofollow" target="_blank">这里</a>是WAF和WAF V2在功能方面的比较。你也可以在这里做自己的价格估算</p></blockquote><p id="20ec" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">实施步骤</strong></p><p id="8c2a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在这个例子中，我们将使用一个简单的ASP.NET核心Web API应用程序。此应用程序包含一个“天气预报”端点，该端点将随机显示未来5天的温度，单位为摄氏度(°C)、华氏度(°F)以及摘要。我已经把这个应用部署到一个新的Azure App服务中，App服务名为“my-appgateway-demo-webapp”。</p><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es ko"><img src="../Images/55875a3c768fb13e0e601b4e7677271f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sENO2kGzks0MJhNph66cqw.png"/></div></div></figure><p id="98a8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在，为了保护这个应用程序，我将使用Azure应用程序网关配置Web应用程序防火墙(WAF)</p><p id="3a1c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi kp translated">第一步:</p><ul class=""><li id="f736" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">登录azure门户，进入Azure Marketplace并搜索应用程序网关</li><li id="f98e" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">选择应用程序网关</li><li id="bba3" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">点击创建</li></ul><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es ky"><img src="../Images/33c82e6b119f8bc74969b9a4e6f4ba7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BYrHxwppBX8_MrNwNf-IGQ.png"/></div></div></figure><p id="dcf1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi kp translated"><span class="l kq kr ks bm kt ku kv kw kx di"> S </span>第二步:</p><ul class=""><li id="c57d" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">选择<strong class="ig hi">订阅</strong></li><li id="3219" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">选择<strong class="ig hi">资源组</strong></li><li id="0c2a" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">输入<strong class="ig hi">应用网关名称</strong></li><li id="0740" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">选择<strong class="ig hi">区域</strong></li><li id="cb11" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">选择<strong class="ig hi">层</strong>至“晶圆”或“晶圆V2”</li><li id="6433" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">如果选择WAF，输入<strong class="ig hi">实例计数</strong></li></ul><blockquote class="jc jd je"><p id="b2aa" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated">注意:在v1层中，只有当您部署了两个或更多实例时，才支持高可用性</p></blockquote><ul class=""><li id="2c2a" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">如果您选择WAF，选择<strong class="ig hi"> SKU尺寸</strong>为“中”或“大”(取决于您的应用尺寸)</li></ul><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es kz"><img src="../Images/8776d764c48c3715dd2e3898b99a2bc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W0VUajLfYmxQvL8RahB-cg.png"/></div></div></figure><ul class=""><li id="0fa6" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">如果选择晶圆V2，在<strong class="ig hi">启用自动缩放</strong>选项中选择是或否</li><li id="cd70" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">如果在启用自动缩放中选择是，则输入<strong class="ig hi">最小刻度</strong> &amp; <strong class="ig hi">最大刻度单位</strong></li></ul><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es la"><img src="../Images/203beba328154de6d85f7fab990d6bd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gWsl24PzTWFsyJu3ys8xxQ.png"/></div></div></figure><ul class=""><li id="59be" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">如果在启用自动缩放中选择否，则输入<strong class="ig hi">缩放单位</strong></li><li id="5d02" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">保持<strong class="ig hi">防火墙状态</strong>为“启用”</li><li id="4e46" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">根据您的要求，保持<strong class="ig hi">防火墙模式</strong>为“预防”或“检测”</li><li id="8c69" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">保持<strong class="ig hi">可用性区域</strong>为无</li><li id="0738" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">保持<strong class="ig hi"> HTTP2 </strong>为“禁用”</li><li id="9b04" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">在<strong class="ig hi">配置虚拟网络下，</strong>选择现有的虚拟网络或通过选择<strong class="ig hi">创建新的</strong>创建一个新的虚拟网络</li></ul><blockquote class="jc jd je"><p id="d1b2" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated">注意:您需要一个有空子网的虚拟网络，或者一个只包含应用程序网关的子网。</p></blockquote><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es lb"><img src="../Images/68ca7666d34e9d0e69ab677a06bb7ffb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WxHO-9mdY1ti1X9FgIadMw.png"/></div></div></figure><ul class=""><li id="c38c" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">输入虚拟网络的<strong class="ig hi">名称</strong></li><li id="7313" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">以CIDR符号输入虚拟网络<strong class="ig hi">地址空间</strong></li><li id="79ed" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">以CIDR记法输入<strong class="ig hi">子网</strong>地址范围</li></ul><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es lc"><img src="../Images/b51a29a21fe9dd0e8f029dc301d5796e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c3YMF2Fpj3pMaq3pcDtaqQ.png"/></div></div></figure><p id="6e7e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi kp translated">第三步:</p><ul class=""><li id="bc7a" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">根据您的要求从“公共”、“私有”或“两者”中选择<strong class="ig hi">前端IP地址类型</strong></li></ul><p id="e087" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本例中，我们将选择公共类型IP地址</p><ul class=""><li id="1f2e" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">添加新的<strong class="ig hi">公共IP地址</strong>并输入<strong class="ig hi">名称</strong></li></ul><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es ld"><img src="../Images/0a8010f23bc234beb9a6999eb635252b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wLaXnF0x0_7c4t6kjpyzng.png"/></div></div></figure><p id="18f7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi kp translated">第四步:</p><ul class=""><li id="e899" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">在下一个后端部分，单击“添加后端池”选项</li></ul><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es le"><img src="../Images/aeae8ce4b1dc071cc38ddd919628f06b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2-XjLfCNYGo4C-2vJj0LQw.png"/></div></div></figure><ul class=""><li id="8dcd" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">输入后端池的<strong class="ig hi">名称</strong></li><li id="f6b6" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">保持<strong class="ig hi">添加没有目标的后端池</strong>为“否”</li><li id="81b8" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">选择<strong class="ig hi">目标类型</strong>和各自的<strong class="ig hi">目标</strong>，有多个选项可供选择，选择符合您要求的一个</li></ul><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es lf"><img src="../Images/65c31c90aa5bceba192c498ddc973ced.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0hqoKDvD178CmMEH305Nuw.png"/></div></div></figure><p id="eac5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因为我们已经有了一个web应用程序，所以在本例中，我们选择“App Services”作为目标类型</p><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es lg"><img src="../Images/d1b275e229155799ce7bd7d4d54cf00e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_-fJ6mgzykSRf1ic6MKsvQ.png"/></div></div></figure><p id="f12c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi kp translated">第五步:</p><ul class=""><li id="cd9b" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">在下一个配置部分，单击“添加路由规则”选项</li></ul><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es lh"><img src="../Images/101ca823adedd38f2777a71d029656e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gu_FJPaJI0xnkTh8sqSxyw.png"/></div></div></figure><ul class=""><li id="a314" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">输入<strong class="ig hi">规则名称</strong></li><li id="a689" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">路由规则需要侦听器。单击“监听器”选项卡</li><li id="ff40" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">输入<strong class="ig hi">听众姓名</strong></li><li id="7988" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">选择<strong class="ig hi">前端IP </strong>选项为“公共”</li><li id="e365" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">根据您的要求，保持<strong class="ig hi">协议</strong>为“HTTP”或“HTTPS”</li><li id="b218" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">如果选择HTTP，则输入<strong class="ig hi">端口的</strong>号</li></ul><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es li"><img src="../Images/523e93afcc1ad14ee270a4fbd7d17584.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NnZLOjhcYRjQqz9z7IC6gA.png"/></div></div></figure><ul class=""><li id="4bc4" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">如果选择HTTPS，则输入<strong class="ig hi">端口</strong>号</li><li id="57c7" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated"><strong class="ig hi">选择证书</strong>选项“上传证书”或“从密钥库中选择证书”。</li><li id="65bd" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">如果选择上传证书，则从本地机器选择<strong class="ig hi"> PFX证书文件</strong>，并输入<strong class="ig hi">证书名称</strong>和<strong class="ig hi">密码</strong></li></ul><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es lj"><img src="../Images/2a15b87565825dae6a86c488b6d96ec9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7mDk7BfR9u0PLRTMt7RzMQ.png"/></div></div></figure><p id="c2d7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本例中，我们将选择协议为HTTP</p><ul class=""><li id="adde" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">在附加设置部分，根据您的要求将<strong class="ig hi">监听器类型</strong>设为“基本”或“多站点”</li></ul><blockquote class="jc jd je"><p id="7bf1" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated">注意:如果您在这个应用程序网关后面托管一个站点，请选择一个基本侦听器。如果您正在配置多个web应用程序或同一父域的多个子域，请选择多站点侦听器</p></blockquote><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es lk"><img src="../Images/cc7028418fe770fdde30045c7cd18bb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1tCFcb-Ova3uV6c90uhOew.png"/></div></div></figure><ul class=""><li id="513c" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">路由规则也需要后端目标。单击“后端目标”选项卡</li><li id="db7e" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">选择<strong class="ig hi">目标类型</strong>选项为“后端池”</li><li id="5d63" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">选择此规则应将流量路由到的<strong class="ig hi">后端目标</strong>。在我们的示例中，我们可以选择刚刚在上述步骤4中创建的后端池</li><li id="6843" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">对于HTTP设置，单击“新建”创建新的HTTP设置。HTTP设置定义此规则的行为，包括后端使用的端口和协议，以及基于cookie的会话相似性和连接排出等设置。</li></ul><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es ll"><img src="../Images/3203f2a1dadefb0d412cd66e3ad0f1e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RQbW3xIsXyBbaEdfkuK-YA.png"/></div></div></figure><ul class=""><li id="05bd" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">在“添加HTTP设置”窗口中输入<strong class="ig hi"> HTTP设置名称</strong></li><li id="46e9" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">根据您的要求，保持<strong class="ig hi">后端协议</strong>为“HTTP”或“HTTPS”</li><li id="f5fb" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">如果选择HTTP，则输入<strong class="ig hi">后端端口</strong>号</li></ul><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es lm"><img src="../Images/508240dccb93d3039504197bdff5639a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2nhSx9eFrRVeKd3Kau0FAQ.png"/></div></div></figure><ul class=""><li id="c90f" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">如果选择HTTPS，那么输入<strong class="ig hi">后端端口</strong>号。此外，在可信根证书部分，根据您的要求，保留<strong class="ig hi">使用众所周知的CA证书</strong>作为“是”或“否”</li></ul><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es ln"><img src="../Images/168c84bf00d651cc72e364952bf7947c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mbHB2bjlwqUQhVvAeoroag.png"/></div></div></figure><p id="ca15" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本例中，我们将选择HTTP作为后端协议</p><ul class=""><li id="7f68" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">在附加设置部分，保持<strong class="ig hi">基于Cookie的关联</strong>和<strong class="ig hi">连接排出</strong>为“禁用”。为了在同一服务器上保持用户会话，应用网关可以使用cookies。如果客户端支持使用cookies，您可以启用此功能</li><li id="0c2d" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">输入<strong class="ig hi">请求超时(秒)</strong>。请求超时是应用程序网关在返回“连接超时”错误消息之前等待从后端池接收响应的秒数。默认情况下是20秒</li><li id="ca3b" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">进入<strong class="ig hi">覆盖后台路径</strong>、<strong class="ig hi">T5、<strong class="ig hi">、</strong>默认为空。Override backend path <strong class="ig hi"> </strong>允许您覆盖URL中的路径，以便特定路径的请求可以被路由到另一个路径。</strong></li></ul><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es lo"><img src="../Images/c50c2b664a431c5af95ce87c6a30ee1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I3NDskzm-sfX_w_JZsVHIg.png"/></div></div></figure><ul class=""><li id="804c" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">在主机名部分，根据您的要求，用新的主机名将<strong class="ig hi">替换为“是”或“否”</strong></li><li id="080d" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">如果选择是，选择<strong class="ig hi">主机名覆盖</strong>作为“从后端目标选择主机名”或“用特定域名覆盖”</li></ul><p id="683f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">由于我们在后端目标池中已经有了应用程序服务，在本例中，我们将选择“用新主机名覆盖”选项为“是”,并从后端目标中选择主机名</p><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es lp"><img src="../Images/6bbe2676f4890dab2f556177c9af8db4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WNQB8AE3Jg8vCNZ9p6yVqg.png"/></div></div></figure><ul class=""><li id="fec2" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">选择<strong class="ig hi">创建自定义探头</strong>为“是”或“否”。如果您选择“是”,那么一旦设置了应用程序网关，它将自动创建具有某个随机名称的健康探测器，并附加到此Http设置</li></ul><p id="8ee5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了给我们的健康探测器起一个有意义的名字，在本例中我们将选择Create custom probes为No，并将在步骤6中配置健康探测器。</p><ul class=""><li id="c418" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">单击“添加”保存路由规则，然后单击“下一步”添加标记，最后单击“审阅+创建”</li><li id="9a5f" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">验证通过后，单击创建。Azure创建应用程序网关可能需要几分钟时间</li></ul><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es lq"><img src="../Images/aa6fb01738bb8fca00d074061ddfcaa4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1OahNis7qosQU4MVers8BA.png"/></div></div></figure><p id="2d8b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi kp translated">第六步:</p><p id="43ea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在应用程序网关已配置好，我们需要配置健康探测器。健康探测器用于ping您的主机并检查后端服务器是否在线。您可以按照以下步骤创建健康探测器。</p><ul class=""><li id="d1fb" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">在应用网关刀片上，单击“健康探测器”设置，然后单击“添加”</li></ul><figure class="jk jl jm jn fd jo er es paragraph-image"><div class="er es lr"><img src="../Images/f20de64743a65322813c26e2666f39ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*6ItNOLZGo01pRXYa4WT-6w.png"/></div></figure><ul class=""><li id="214e" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">输入探头的<strong class="ig hi">名称</strong></li><li id="34d3" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">保持<strong class="ig hi">协议</strong>为“Http”或“HTTPS”取决于您在上面第5步定义HTTP设置时选择的协议</li></ul><p id="f7f2" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因为在我们的示例中，我们已经在Http设置中选择了HTTP协议，所以也将在health probe中选择HTTP</p><ul class=""><li id="a51a" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">选择<strong class="ig hi">从后端HTTP设置中选择主机名</strong>为“是”或“否”</li></ul><p id="2986" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因为在我们的示例中，我们已经在后端池中定义了主机名，所以将从后端HTTP设置<strong class="ig hi"> </strong>中选择“选择主机名”作为“是”</p><ul class=""><li id="31c4" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">选择<strong class="ig hi">从后端HTTP设置中选择端口</strong>为“是”或“否”</li></ul><p id="fc65" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">因为在我们的示例中，我们已经在HTTP设置中定义了端口号，所以将从后端Http设置中选择Pick port作为Yes</p><ul class=""><li id="edc8" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">输入探头的相对<strong class="ig hi">路径</strong></li></ul><p id="7af8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">由于我们在azure app service中托管的应用程序具有端点“weatherforecast ”,现在我们需要在该路径中配置相同的名称</p><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es ls"><img src="../Images/5c12f8021c465544b82f2e8c5f677268.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dhItXrtI1h0UliGFQDRHng.png"/></div></div></figure><ul class=""><li id="13e9" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">以秒为单位输入探头的<strong class="ig hi">间隔(秒)</strong>。该值表示两次连续探测之间的时间间隔。默认情况下是30秒</li><li id="b128" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">以秒为单位输入探头的<strong class="ig hi">超时(秒)</strong>。如果在此期间未收到有效响应，探测将被标记为失败。默认情况下是30秒</li><li id="b698" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">输入探针的<strong class="ig hi">不健康阈值</strong>重试次数。如果连续探测失败计数达到此阈值，后端服务器将被标记为停机。默认情况下，它是3</li></ul><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es lt"><img src="../Images/0f15f4ddde21dfaeed495222fee95fc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2_R4vBs138jp6rOvZPfPqg.png"/></div></div></figure><ul class=""><li id="8040" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">选择<strong class="ig hi">使用探针匹配条件</strong>为“是”或“否”。</li><li id="96c5" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">在<strong class="ig hi"> HTTP响应状态代码匹配中输入逗号分隔的状态代码列表(如200、201)或代码范围(如220–226)。</strong>如果在上面的使用探测器匹配条件中选择是，默认情况下，状态代码为200–399的HTTP(S)响应被认为是健康的。</li><li id="cd18" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">输入<strong class="ig hi"> HTTP响应体匹配。</strong>与此处输入的字符串匹配的响应将被视为成功。匹配仅查找响应正文中是否存在字符串，而不是完整的正则表达式。默认情况下，它是空的。</li></ul><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es lu"><img src="../Images/a02e283a31ba10b85ea9bb44df040b5a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QlntXm0L_DacOtr8TLCUqQ.png"/></div></div></figure><ul class=""><li id="0264" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">选择<strong class="ig hi"> HTTP设置。</strong>运行状况探测器将与此处选择的HTTP设置关联，因此将监控与所选HTTP设置关联的后端池的运行状况</li></ul><blockquote class="jc jd je"><p id="a20c" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated">注意:与此探测器配置中选择的协议具有相同协议的HTTP设置可用于关联</p></blockquote><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es lv"><img src="../Images/0fc8ad813eaee7b1523bd1f3293b11ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YbuXx9ttlqKcnkTd4hL4Bw.png"/></div></div></figure><ul class=""><li id="82ef" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">在添加运行状况探测器之前，单击Test测试后端运行状况</li></ul><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es lw"><img src="../Images/db518f9dc53ee3da7f3c3392767534e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x3GBwhe2KlzpR81YsOpQMg.png"/></div></div></figure><ul class=""><li id="425b" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">状态为“健康”后，单击“添加”将此健康探测器添加到应用程序网关中。</li></ul><p id="7b07" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">应用网关刀片中的“后端健康”设置是检查后端服务器池健康的另一种方式</p><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es lx"><img src="../Images/4b938777819d1456fd490b7826357db4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v_1SLbUccbcfsz1RPm05VA.png"/></div></div></figure><p id="67ad" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在完成步骤1到步骤6之后，现在您的应用程序网关WAF已经成功启动并运行，可以处理传入的请求了。</p><p id="96ea" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">可选步骤:</strong></p><p id="f3ed" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一旦WAF启动，您就可以根据您的需求对其进行配置。</p><ol class=""><li id="0538" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ly kf kg kh bi translated"><strong class="ig hi">更改防火墙模式</strong>:防火墙模式将是您在步骤2中选择的模式。如果您希望以后更改此设置，您可以从Web应用程序防火墙设置选项中进行更改，如下所示:</li></ol><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es lz"><img src="../Images/a5f8f3084d118db36cf666c2704ddac0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h-MPI-8oeeFkPjW3aqXCUA.png"/></div></div></figure><p id="25a6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">2.<strong class="ig hi">更改规则集</strong>:默认情况下，适用的规则集是“OWASP 3.0”，这也是推荐的。但是，您可以从其他规则集中进行选择，也可以从Web应用程序防火墙设置的规则选项卡中进行选择，如下所示:</p><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es ma"><img src="../Images/d100bdf57e39cd9f6701a20a27788d1c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l6W5kPzSXJaHiN6l927Oog.png"/></div></div></figure><p id="6ef5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">3.<strong class="ig hi">选择/取消选择规则/规则组</strong>:默认情况下，启用规则集的所有规则，禁用高级规则配置选项。通过启用高级规则配置，我们可以根据您的应用选择/取消选择规则/规则组。</p><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es mb"><img src="../Images/bb54509ad96ae73c28ffef2f3e74af95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EP6cTR5f1mYveWJeoNiVvg.png"/></div></div></figure><p id="81e1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">4.<strong class="ig hi">设置定制规则</strong>:WAF管理员可以编写定制规则，包括规则名称、规则优先级和一系列匹配条件。这些规则比托管规则集中的其他规则具有更高的优先级。根据匹配条件，自定义规则将阻止或允许流量。你可以在这里了解更多关于WAF v2 <a class="ae kn" href="https://docs.microsoft.com/en-us/azure/web-application-firewall/ag/custom-waf-rules-overview" rel="noopener ugc nofollow" target="_blank">中的自定义规则。</a></p><blockquote class="jc jd je"><p id="3cf0" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated">注意:最多可以创建100个自定义规则。</p></blockquote><p id="6391" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">测试应用网关部署</strong></p><ul class=""><li id="00b7" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">在应用程序网关中，转到概述选项卡，并找到“前端公共IP地址”</li></ul><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es mc"><img src="../Images/33d6fd45c3673a1aa5f920d32cb3ed90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M3JPBLjjNwT2Td7yzEGlNQ.png"/></div></div></figure><p id="d332" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">或者，您可以转到前端IP配置选项卡，并找到公共IP地址</p><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es md"><img src="../Images/73940695e446faad95b3551366347d3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NZ749qsyOQWStLT2U_jr1g.png"/></div></div></figure><ul class=""><li id="10e8" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">复制公共IP地址，并将其粘贴到浏览器的地址栏中</li><li id="6b40" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">检查响应。有效的响应表示应用程序网关已启动并正在运行，并且成功连接到后端应用程序服务</li></ul><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es me"><img src="../Images/32295950b5ba2df38ddc9d59a4017973.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4V4PYJsMiaq2EI72OUFs4Q.png"/></div></div></figure><p id="a03e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">晶圆监控</strong></p><p id="ae7b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要查看WAF上触发的规则的更多信息，您首先需要打开诊断日志，通过添加诊断设置来实现。存储日志有三个选项:</p><ul class=""><li id="feaf" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">存储帐户</li><li id="9530" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">活动中心</li><li id="deec" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">Azure监视器日志</li></ul><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es mf"><img src="../Images/b165de1a170801b11c3f5d90cc35d3d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*je70HiWnlCWl8LisIVvx0w.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx">Image Source : Microsoft</figcaption></figure><p id="47fe" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本例中，我们将把他们定向到Azure存储帐户</p><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es mg"><img src="../Images/ba84badd9b2db828b91ace99f549e5ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4P15PzuRM3znOP8bY4OJVg.png"/></div></div></figure><p id="aa05" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在已经为WAF启用了诊断日志记录，使用Azure Storage Explorer我们可以查看日志文件。应用程序网关将日志存储在以下3个容器中</p><ul class=""><li id="eea6" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">洞察-日志-应用程序网关访问日志</li><li id="03ef" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">洞察-日志-应用程序网关防火墙日志</li><li id="a4e1" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">洞察-日志-应用网关性能日志</li></ul><p id="7288" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">WAF日志容器是<strong class="ig hi">insights-logs-applicationgatewayfirewalllog</strong>。在存储帐户中，浏览容器，直到找到PT1H.json文件。该文件是WAF上防火墙操作的每小时日志。</p><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es mh"><img src="../Images/682f854f5c229061786385aa4fc5d7fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZIOiiUz5BBfBIQD40Z-zyg.png"/></div></div></figure><p id="362d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">WAF日志中的每个条目都将包含关于请求及其触发原因的信息，例如ruleId、消息详细信息。下面是分别针对跨站点脚本和SQL注入攻击的示例日志</p><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es mi"><img src="../Images/05a1a4db6db3d2424d40e0e3cc30f94d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-HelrM25eKFXqWSsFv5vkw.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx">XSS Attack Log Sample</figcaption></figure><figure class="jk jl jm jn fd jo er es paragraph-image"><div role="button" tabindex="0" class="jp jq di jr bf js"><div class="er es mj"><img src="../Images/bf99e499303de73abdd8b6b9c62a01f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7cTb6tLcgoE5pRllBoM31w.png"/></div></div><figcaption class="jv jw et er es jx jy bd b be z dx">SQL Injection Attack Log Sample</figcaption></figure><blockquote class="jc jd je"><p id="771e" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated">你可以在这里了解更多关于晶圆日志<a class="ae kn" href="https://docs.microsoft.com/en-us/azure/web-application-firewall/ag/web-application-firewall-logs" rel="noopener ugc nofollow" target="_blank"/></p></blockquote><p id="fd83" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">限制</strong></p><p id="4286" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以下是WAF和Azure应用程序网关的限制列表:</p><ul class=""><li id="209e" class="jz ka hh ig b ih ii il im ip kb it kc ix kd jb ke kf kg kh bi translated">每个订阅最多可以部署1000个应用程序网关实例。</li><li id="1280" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">对于应用程序网关的单个实例，最多可以配置100个HTTP侦听器。还要记住，简单的HTTP到HTTPS重定向需要您部署两个不同的侦听器。</li><li id="7a00" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">中型WAF的最大文件上传大小为100 MB，大型WAF的最大文件上传大小为500 MB</li><li id="e79b" class="jz ka hh ig b ih ki il kj ip kk it kl ix km jb ke kf kg kh bi translated">WAF层中的应用网关仅支持动态IP地址。除非您手动重启应用程序网关，否则动态IP不会改变。这仅适用于WAF层，不适用于WAF 2层。如果您需要高可用性和静态IP，必须使用WAF版本2。</li></ul><blockquote class="jc jd je"><p id="2cf8" class="ie if jf ig b ih ii ij ik il im in io jg iq ir is jh iu iv iw ji iy iz ja jb ha bi translated">你可以在这里找到服务的所有其他限制<a class="ae kn" href="https://github.com/MicrosoftDocs/azure-docs/blob/master/includes/application-gateway-limits.md" rel="noopener ugc nofollow" target="_blank"/></p></blockquote><p id="00bb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">结论</strong></p><p id="06f7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Microsoft Web应用程序防火墙解决方案易于部署，并且在防止对您的Web应用程序的恶意攻击方面更加有效。对于大多数常见的情况，Microsoft默认规则非常强大，您也可以设置自定义规则。</p><p id="e6b9" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">WAF和健壮应用程序编码使得web应用程序更加安全和健壮。</p></div></div>    
</body>
</html>