<html>
<head>
<title>Load Testing Automation on Oracle Developer Cloud Service using Artillery</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用cannon在Oracle开发者云服务上实现负载测试自动化</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/load-testing-automation-on-oracle-developer-cloud-service-using-artillery-55c9809614cd?source=collection_archive---------0-----------------------#2017-07-06">https://medium.com/oracledevs/load-testing-automation-on-oracle-developer-cloud-service-using-artillery-55c9809614cd?source=collection_archive---------0-----------------------#2017-07-06</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="bd45" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这篇博客介绍了在Oracle Developer Cloud Service上使用一个名为cannon的负载测试框架对REST服务进行负载测试自动化。基于Nodejs的REST应用将部署在Oracle应用容器云服务上</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es jc"><img src="../Images/ff323b1714911c79452c437f760a1a65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1224/format:webp/0*Ve2VNC3tCyuO_pdE.png"/></div></figure><p id="2050" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">注:</strong>关于如何使用开发者云服务在应用容器云上开发和部署基于Nodejs的REST服务应用的详细信息，请参见此处的博客链接<a class="ae jk" href="https://community.oracle.com/community/cloud_computing/platform-as-a-service-paas/oracle-developer-cloud-service/blog/2016/09/07/oracle-developer-cloud-to-build-and-deploy-nodejs-rest-project-on-application-container-cloud" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="b039" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">使用的技术堆栈</strong></p><ul class=""><li id="bb91" class="jl jm hh ig b ih ii il im ip jn it jo ix jp jb jq jr js jt bi translated"><strong class="ig hi"> Eclipse: </strong>火炮负载测试脚本和Nodejs开发的IDE。</li><li id="a2c4" class="jl jm hh ig b ih ju il jv ip jw it jx ix jy jb jq jr js jt bi translated"><strong class="ig hi">测试框架:</strong>火炮</li><li id="438e" class="jl jm hh ig b ih ju il jv ip jw it jx ix jy jb jq jr js jt bi translated"><strong class="ig hi"> Oracle开发人员云:</strong>用于负载测试自动化</li><li id="f94a" class="jl jm hh ig b ih ju il jv ip jw it jx ix jy jb jq jr js jt bi translated"><strong class="ig hi"> Oracle应用容器云:</strong>部署基于Nodejs的REST web服务的云服务，在其上进行负载测试。</li></ul><p id="5b63" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">关于火炮</strong></p><p id="04cc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">cannon是一个简单但功能强大的负载测试工具包。它可以让您的应用程序在高负载下性能更好。火炮的测试结果，给了我们洞察力，使我们的应用程序更快，更可伸缩，更有弹性。更多关于火炮的信息，请访问—<a class="ae jk" href="https://artillery.io/" rel="noopener ugc nofollow" target="_blank">https://artillery.io/</a></p><p id="b931" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">为什么是火炮？</strong></p><p id="f8c8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">关于Nodejs REST应用</strong></p><p id="4200" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Nodejs REST应用程序有一个get和post函数。get函数给出一个静态消息和错误属性为false的响应。而post函数“add”给出作为服务输入传递的两个数的和。Nodejs模块express和bodyPaser用于创建REST服务。下面是main.js的代码片段，其中包含REST web服务代码。</p><pre class="jd je jf jg fd jz ka kb kc aw kd bi"><span id="e79e" class="ke kf hh ka b fi kg kh l ki kj">var express = require("express");<br/>var bodyParser = require("body-parser");<br/>var app = express();<br/>app.use(bodyParser.urlencoded());<br/>app.use(bodyParser.json());<br/>var router = express.Router();<br/><br/>router.get('/message',function(req,res){<br/>  res.json({"error" : false, "message" : "Hello!"});<br/>});<br/><br/>router.post('/add',function(req,res){<br/>  res.json({"error" : false, "message" : "success", "data" : req.body.num1 + req.body.num2});<br/>});<br/><br/>app.use('/',router);<br/><br/>app.listen(process.env.PORT || 3000,function(){<br/>  console.log("I am listening at PORT 3000");<br/>})</span></pre><p id="f21e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">请参考我在Mocha.js测试自动化上的<a class="ae jk" href="https://community.oracle.com/community/cloud_computing/platform-as-a-service-paas/oracle-developer-cloud-service/blog/2017/06/04/mochajs-for-test-automation-of-nodejs-rest-api-on-oracle-developer-cloud-service" rel="noopener ugc nofollow" target="_blank">博客</a>，里面讲解了使用开发者云服务的Node.js REST服务开发和部署。此外，该服务将使用Node.js容器部署在Oracle应用容器云服务上。</p><p id="b26f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">火炮载荷测试文件</strong></p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es kk"><img src="../Images/114e9d609ceef359afbe6e8fa04bdb4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/0*lrkksHoT5R2c-jcq.png"/></div></figure><ol class=""><li id="26e8" class="jl jm hh ig b ih ii il im ip jn it jo ix jp jb kl jr js jt bi translated"><strong class="ig hi"> add.yml — </strong>这是使用cannon进行负载测试的配置文件。</li><li id="86a2" class="jl jm hh ig b ih ju il jv ip jw it jx ix jy jb kl jr js jt bi translated"><strong class="ig hi"> number.csv — </strong>该文件充当负载测试数据的存储库。add.yml文件包含</li><li id="c1aa" class="jl jm hh ig b ih ju il jv ip jw it jx ix jy jb kl jr js jt bi translated"><strong class="ig hi"> package.json — </strong>它由执行火炮载荷测试的依赖项和命令组成</li></ol><p id="0e0b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">火炮载荷测试文件描述:</strong></p><p id="b692" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> add.yml </strong></p><p id="482f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是火炮框架的配置文件。在这个文件中，我们配置了需要测试的REST端点，在这种情况下是测试数据有效负载文件“numbers.csv ”,以及定义了Post、Get等函数类型的测试场景和要测试的方法的路径URL。我们还在这个YAML文件中定义了测试阶段，如持续时间和请求到达率，其中持续时间意味着测试将持续60秒，有20个新的<em class="km">虚拟用户</em>(平均每秒到达)。您可以给这个文件起一个自己选择的名称，但是要确保在test命令的package.json中配置相同的名称。</p><pre class="jd je jf jg fd jz ka kb kc aw kd bi"><span id="5835" class="ke kf hh ka b fi kg kh l ki kj">config:<br/>  target: 'https://mochatest-paasdemo015.apaas.us6.oraclecloud.com'<br/>  phases:<br/>    - duration: 60<br/>      arrivalRate: 20<br/>  payload:<br/>    path: "numbers.csv"<br/>    fields:<br/>      - "num1"<br/>      - "num2"<br/>    order: "sequence"  <br/>      <br/>scenarios:<br/>  - <br/>    name: "Test Add"<br/>    flow:<br/>      - <br/>       post:<br/>        url: "/add"<br/>        json:<br/>             num1: ${{ num1 }}<br/>             num2: ${{ num1 }}</span></pre><p id="41cb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> package.json </strong></p><p id="daa4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">package.json包含代码执行的依赖项。它还定义了命令“run add.yml ”,在add.yml文件中配置的端点上运行负载测试，该文件作为参数传递给命令执行。</p><pre class="jd je jf jg fd jz ka kb kc aw kd bi"><span id="1e63" class="ke kf hh ka b fi kg kh l ki kj">{<br/>  "name": "LintingTest",<br/>  "version": "0.0.1",<br/>  "scripts": {<br/>    "test": "artillery run add.yml"<br/>  },<br/>  "dependencies": {<br/>  },<br/>  "devDependencies": {<br/>    "artillery": "^1.6.0"<br/>  }<br/>}</span></pre><p id="e4a4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> number.csv </strong></p><p id="3377" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这是一个CSV文件，包含两个数字的列表，作为在REST端点的add函数上执行负载测试的测试数据。</p><pre class="jd je jf jg fd jz ka kb kc aw kd bi"><span id="5760" class="ke kf hh ka b fi kg kh l ki kj">1,2 2,3 3,4 4,5 5,6 6,7 7,8 8,9 9,10</span></pre><p id="3b3a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">构建配置:</strong></p><p id="68bc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下面是<strong class="ig hi"> LoadTestBuild、</strong>的构建作业配置截图，该构建作业将在cannon框架的帮助下，对部署在Oracle应用程序容器云上的基于Nodejs的REST API应用程序执行负载测试。</p><p id="f46e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为构建作业选择一个名称。对于这个博客，我将其命名为“<strong class="ig hi"> LoadTestBuild </strong>”。因为这是针对Nodejs应用程序的，所以可以将JDK保留为默认值。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es kn"><img src="../Images/106e6de38c6c968a062ec93dc954b585.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*j_-gSadkZkwzmT3r.png"/></div></div></figure><p id="776c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">选择已上载负载测试相关脚本和文件的存储库。</p><p id="ca7b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">注意:您可以选择使用包含Nodejs应用程序相关代码的同一个项目来加载测试脚本。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es ks"><img src="../Images/c66f46b93e13091811d7bcf27a38e2eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*g6tMPrf1V7MXozZm.png"/></div></div></figure><p id="9f97" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">这里我们将SCM轮询设置为触发器。这确保了每次我们上传代码到Git仓库时，都会触发<strong class="ig hi">‘LoadTestBuild’</strong>，如博客中的构建触发图所示。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es kt"><img src="../Images/776953ba1e60b8bde1df2e5a9416301e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*1Zd2oBnuY_7sa3nT.png"/></div></div></figure><p id="6619" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将构建的Nodejs版本配置为4.8.0，如下面的屏幕截图所示。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es kt"><img src="../Images/f51ef0a3260b60a2808fb7f5905c7963.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*L0tIefsz6I08JHJu.png"/></div></div></figure><p id="f08b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们将使用执行shell构建步骤。作为构建步骤的一部分，首先我们将文件夹更改为项目文件夹<strong class="ig hi">‘ArtilleryTest’</strong>。我们将使用npm安装来安装所有的火炮模块，如下图所示。然后使用“npm test”命令在YAML文件中配置的REST端点上执行负载测试，如博客中所述。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es ku"><img src="../Images/e72baa12954ad65e25041db99b4bcf37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sQf4bqf2SYMzJ5z4.png"/></div></div></figure><p id="c8ca" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在执行时，可以在构建控制台上看到负载测试结果，如下所示。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es kv"><img src="../Images/ae023f34033489e25323046382b7c62e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Z8LwbucZTjxsUpul.png"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es kw"><img src="../Images/8b114e9d96581af1dc66cff8558b191a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*r_vieAdwwY_TSjvh.png"/></div></div></figure><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="er es kx"><img src="../Images/b52405032f1545e31788fd4b098be3ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YTnkqZLVHxRGLz9q.png"/></div></div></figure><p id="512a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">解码上述结果:</strong></p><p id="6845" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">当测试运行时，将每10秒钟打印一次中间统计数据(默认)，并在测试结束时打印一份完整的报告。</p><p id="728a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">启动的场景</strong> —是最近10秒内创建的虚拟用户数。</p><p id="c0a4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">完成的场景</strong> —是在之前的10秒钟内(或在整个测试中)完成其场景的虚拟用户的数量。注意:这是完成的会话数，而不是在10秒间隔内启动和完成的会话数。</p><p id="e9dc" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> Requests completed </strong> —发送的HTTP请求和响应或WebSocket消息的数量</p><p id="d06d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> RPS sent </strong> —是在之前的10秒钟内(或在整个测试过程中)每秒完成的平均请求数</p><p id="db83" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">请求延迟</strong> <strong class="ig hi">和场景持续时间</strong> —以毫秒为单位，p95和p99的值是第95和第99个百分位数的值(请求延迟p99的值为400毫秒意味着100个请求中有99个花费了400毫秒或更少的时间来完成)。如果您看到NaN(“非数字”)被报告为一个值，这意味着没有收到足够的响应来计算百分比。</p><p id="785c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">代码— </strong>是HTTP响应代码的计数。</p><p id="679c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">编码快乐！</p><p id="a35a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">* *本文表达的观点是我个人的观点，不一定代表甲骨文的观点</p></div><div class="ab cl ky kz go la" role="separator"><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld le"/><span class="lb bw bk lc ld"/></div><div class="ha hb hc hd he"><p id="f6b8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="km">原载于2017年7月6日community.oracle.com</em><em class="km">的</em> <a class="ae jk" href="https://community.oracle.com/community/cloud_computing/platform-as-a-service-paas/oracle-developer-cloud-service/blog/2017/07/06/load-testing-automation-on-oracle-developer-cloud-service-using-artillery" rel="noopener ugc nofollow" target="_blank"> <em class="km">。</em></a></p></div></div>    
</body>
</html>