<html>
<head>
<title>Demystifying Jetpack Glance for app widgets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">揭秘Jetpack Glance for app widgets</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/demystifying-jetpack-glance-for-app-widgets-8fbc7041955c?source=collection_archive---------0-----------------------#2022-03-07">https://medium.com/androiddevelopers/demystifying-jetpack-glance-for-app-widgets-8fbc7041955c?source=collection_archive---------0-----------------------#2022-03-07</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/32343e47328a19b3b050a52191ee9031.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mlswR3fyxaIG-C1OUifYVw.jpeg"/></div></div></figure><div class=""/><p id="4e16" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们最近<a class="ae jn" href="https://android-developers.googleblog.com/2021/12/announcing-jetpack-glance-alpha-for-app.html" rel="noopener ugc nofollow" target="_blank">宣布了</a>Glance的第一个Alpha版本，最初支持<a class="ae jn" href="https://developer.android.com/guide/topics/appwidgets/overview" rel="noopener ugc nofollow" target="_blank"> AppWidgets </a>，现在支持用于Wear OS 的<a class="ae jn" href="https://android-developers.googleblog.com/2022/01/announcing-glance-tiles-for-wear-os.html" rel="noopener ugc nofollow" target="_blank"> Tiles。这个新框架建立在</a><a class="ae jn" href="https://developer.android.com/jetpack/androidx/releases/compose-runtime" rel="noopener ugc nofollow" target="_blank"> Jetpack Compose runtime </a>之上，旨在更快更容易地构建“glanceables”，如app widgets，而不必处理大量样板代码或生命周期事件来连接不同的组件。</p><p id="dd47" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然而，重要的是要理解Glance APIs不能与Jetpack Compose互操作，并且也有一定的限制。在本帖中，我们将揭开这些限制的神秘面纱，并强调使用Glance构建AppWidgets时需要考虑的要点。</p><p id="2ac6" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">内容分为以下几个主题:</p><ul class=""><li id="4450" class="jo jp hs ir b is it iw ix ja jq je jr ji js jm jt ju jv jw bi translated">声明应用程序小部件</li><li id="3b1c" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">主题和样式</li><li id="7514" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">更新、重组和副作用</li><li id="0138" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">Android Studio工具</li></ul><blockquote class="kc kd ke"><p id="85cc" class="ip iq kf ir b is it iu iv iw ix iy iz kg jb jc jd kh jf jg jh ki jj jk jl jm ha bi translated"><strong class="ir ht">重要提示:</strong>这篇博客是为<strong class="ir ht"> Glance-alpha03 </strong>版本而写的。未来的版本可能会废弃下面的一些内容。</p></blockquote><h1 id="0aed" class="kj kk hs bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">声明应用程序小部件</h1><p id="db60" class="pw-post-body-paragraph ip iq hs ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated">Glance的主要目标是简化应用程序小部件的UI创建，并连接不同的部分，以便您可以专注于构建漂亮的应用程序小部件。我们正在简化某些任务，请注意有一些限制，仍然需要手工操作。</p><figure class="ln lo lp lq fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lm"><img src="../Images/2538af05567a591621b026ae648df88d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*71XVQqC7r96UlSK-"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx">App widgets mechanism (<a class="ae jn" href="https://developer.android.com/guide/topics/appwidgets#components" rel="noopener ugc nofollow" target="_blank">source</a>)</figcaption></figure><h1 id="a35b" class="kj kk hs bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">"为什么我需要GlanceAppWidgetReceiver？"</h1><p id="275c" class="pw-post-body-paragraph ip iq hs ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated">Android操作系统使用<a class="ae jn" href="https://developer.android.com/reference/android/content/BroadcastReceiver" rel="noopener ugc nofollow" target="_blank"> BroadcastReceivers </a>来通知应用程序小部件“生命周期”事件，例如当它第一次启用或需要更新时。为了简化API，Android SDK提供了<a class="ae jn" href="https://developer.android.com/reference/android/appwidget/AppWidgetProvider" rel="noopener ugc nofollow" target="_blank"> AppWidgetProvider </a>类。Glance通过<a class="ae jn" href="https://developer.android.com/reference/androidx/glance/appwidget/GlanceAppWidgetReceiver" rel="noopener ugc nofollow" target="_blank">GlanceAppWidgetReceiver</a>类更进一步，连接接收器和GlanceAppWidget实例，管理不同的事件，并在必要时刷新其内容。</p><pre class="ln lo lp lq fd lv lw lx ly aw lz bi"><span id="c6fc" class="ma kk hs lw b fi mb mc l md me">class MyAppWidgetReceiver : GlanceAppWidgetReceiver() {</span><span id="812b" class="ma kk hs lw b fi mf mc l md me">  override val glanceAppWidget = MyAppWidget()</span><span id="cbb9" class="ma kk hs lw b fi mf mc l md me">}</span></pre><blockquote class="kc kd ke"><p id="57c3" class="ip iq kf ir b is it iu iv iw ix iy iz kg jb jc jd kh jf jg jh ki jj jk jl jm ha bi translated"><strong class="ir ht">注意:</strong>可能会有捕获应用程序窗口小部件事件的用例，例如<strong class="ir ht"> onEnabled </strong>，但这并不是构建UI所必需的。</p></blockquote><h1 id="2854" class="kj kk hs bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">"我还需要在XML中定义元数据吗？"</h1><p id="446b" class="pw-post-body-paragraph ip iq hs ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated">目前，是的。我们正在寻找简化这一步骤的方法，但目前，请遵循<a class="ae jn" href="https://developer.android.com/guide/topics/appwidgets#AppWidgetProviderInfo" rel="noopener ugc nofollow" target="_blank">官方应用小部件指南</a>。</p><h1 id="3c8f" class="kj kk hs bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">"我需要提供android:previewLayout还是android:previewImage？"</h1><p id="f126" class="pw-post-body-paragraph ip iq hs ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated">是的，否则启动器中的应用程序小部件选择器将无法显示预览，使用户很难理解你的应用程序小部件功能。</p><p id="8160" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">你两个都需要吗？虽然我们建议同时提供这两种功能以获得更好的体验，但是previewLayout只在Android 12和更高版本中使用，并且需要您用XML重新定义应用程序小部件UI(同样，我们正在寻找简化这一点的方法)。</p><h1 id="6a63" class="kj kk hs bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">主题和样式</h1><p id="0bbc" class="pw-post-body-paragraph ip iq hs ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated">本节涵盖了AppWidgets和Glance主题化的一些常见混淆点。</p><h1 id="5660" class="kj kk hs bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">"我可以使用Jetpack Compose<a class="ae jn" href="https://developer.android.com/reference/kotlin/androidx/compose/material/package-summary#MaterialTheme(androidx.compose.material.Colors,androidx.compose.material.Typography,androidx.compose.material.Shapes,kotlin.Function0)" rel="noopener ugc nofollow" target="_blank">material theme</a>composable吗？"</h1><p id="7ceb" class="pw-post-body-paragraph ip iq hs ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated">不，我们不建议将Jetpack组件与Glance混合使用。用MaterialTheme(或任何种类的“撰写主题”)包装Glance组件不会对Glance组件产生任何影响。(参见下面的一些限制。)</p><p id="3ab9" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">与这里描述的一些其他特性一样，我们正在努力提供一个API来简化这一点。在此之前，将您的样式、颜色和属性保存在单个Kotlin对象中，并手动将它们应用到您的组件中。</p><h1 id="3fdd" class="kj kk hs bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">"我应该提供颜色值还是颜色资源Id？"</h1><p id="9263" class="pw-post-body-paragraph ip iq hs ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated">如果你想利用“<a class="ae jn" href="https://developer.android.com/guide/topics/appwidgets/enhance#dynamic-colors" rel="noopener ugc nofollow" target="_blank">动态颜色</a>”或者对明暗主题的支持，你应该使用颜色资源ID。否则，应用程序微件不会动态更改其颜色(例如，在亮暗模式之间切换时)，因为颜色值在微件的第一次放置时就已解析。</p><pre class="ln lo lp lq fd lv lw lx ly aw lz bi"><span id="2ca0" class="ma kk hs lw b fi mb mc l md me">Box(modifier = modifier<br/>  .appWidgetBackground()<br/>  .background(R.color.m3_sys_color_dynamic_dark_background)<br/>) { … }</span></pre><blockquote class="kc kd ke"><p id="ff2b" class="ip iq kf ir b is it iu iv iw ix iy iz kg jb jc jd kh jf jg jh ki jj jk jl jm ha bi translated"><strong class="ir ht">注:</strong>我们使用的是<a class="ae jn" href="https://github.com/material-components/material-components-android" rel="noopener ugc nofollow" target="_blank">素材组件库</a>提供的<a class="ae jn" href="https://github.com/material-components/material-components-android/blob/master/docs/theming/Color.md" rel="noopener ugc nofollow" target="_blank">色彩资源</a>。要处理白天或夜晚主题或向后兼容的设备，请将颜色包装到另一个ID中，并在每个文件夹中重新定义它(即:values/colors.xml、values-v31/colors.xml等)</p></blockquote><h1 id="43cc" class="kj kk hs bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">"我可以提供自定义字体吗？"</h1><p id="d832" class="pw-post-body-paragraph ip iq hs ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated">不，应用程序小部件的限制会阻止Glance显示自定义字体。检查<a class="ae jn" href="https://developer.android.com/reference/androidx/glance/text/TextStyle" rel="noopener ugc nofollow" target="_blank"> TextStyle </a>类以查看可用的字体和样式。</p><h1 id="27d8" class="kj kk hs bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">"我如何创建类似于Jetpack Compose中的<a class="ae jn" href="https://developer.android.com/jetpack/compose/themes/material#shape" rel="noopener ugc nofollow" target="_blank">形状</a>？"</h1><p id="5e44" class="pw-post-body-paragraph ip iq hs ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated">Glance for AppWidgets将可组合代码翻译成实际的<em class="kf"> RemoteViews + XML </em>。这意味着您没有像Jetpack Compose中那样的“<em class="kf">免费画布</em>”。适用于<em class="kf"> RemoteViews </em>的限制同样适用于Glance。</p><p id="1592" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">获得形状(如圆角)的最佳方式是退回到<em class="kf"> drawables + XML </em>:</p><pre class="ln lo lp lq fd lv lw lx ly aw lz bi"><span id="1954" class="ma kk hs lw b fi mb mc l md me">&lt;shape android:shape=”rectangle”&gt;</span><span id="edcf" class="ma kk hs lw b fi mf mc l md me">  &lt;corners <br/>    android:radius=”@dimen/app_widget_background_corner_radius” /&gt;</span><span id="fbfa" class="ma kk hs lw b fi mf mc l md me">  &lt;solid android:color=”@color/color_background” /&gt;</span><span id="9692" class="ma kk hs lw b fi mf mc l md me">&lt;/shape&gt;</span></pre><p id="c471" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">并将drawable ID传递给composable:</p><pre class="ln lo lp lq fd lv lw lx ly aw lz bi"><span id="201e" class="ma kk hs lw b fi mb mc l md me">Box(modifier = modifier.background(<br/>  ImageProvider(R.drawable.rounded_corner_background)<br/>))</span></pre><h1 id="a0c0" class="kj kk hs bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">更新应用程序小部件</h1><p id="ceaa" class="pw-post-body-paragraph ip iq hs ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated">好了，你已经建立了你的简略图。但是如何更新、加载要显示的数据，或者处理数据/状态变化呢？👇</p><h1 id="ea55" class="kj kk hs bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">"我需要接收者更新应用程序部件吗？"</h1><p id="afdc" class="pw-post-body-paragraph ip iq hs ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated">需要接收器来处理Android OS事件，如“onUpdate”，但是您可以在应用程序中的任何地方更新GlanceAppWidget实例，只要您是在协程中进行更新。避免向接收方发送更新事件，而是使用以下机制之一:</p><pre class="ln lo lp lq fd lv lw lx ly aw lz bi"><span id="faea" class="ma kk hs lw b fi mb mc l md me">// Update a specific instance of MyAppWidget.<br/>MyAppWidget().<strong class="lw ht">update</strong>(context, glanceId)</span><span id="8660" class="ma kk hs lw b fi mf mc l md me">// Update all placed instances of MyAppWidget.<br/>MyAppWidget().<strong class="lw ht">updateAll</strong>(context)</span><span id="9209" class="ma kk hs lw b fi mf mc l md me">// Iterate over all placed instances of MyAppWidget<br/>// and update if the state of the instance matches<br/>// the given predicate.<br/>MyAppWidget().<strong class="lw ht">updateIf</strong>&lt;Preferences&gt;(context) { <em class="kf">state</em> -&gt;<br/><em class="kf">  state[KEY_TYPE] == TYPE_DESTINATION</em><br/>}</span></pre><blockquote class="kc kd ke"><p id="a9e3" class="ip iq kf ir b is it iu iv iw ix iy iz kg jb jc jd kh jf jg jh ki jj jk jl jm ha bi translated"><strong class="ir ht">注意:</strong>使用<a class="ae jn" href="https://developer.android.com/reference/androidx/glance/appwidget/GlanceAppWidgetManager#getGlanceIds(java.lang.Class)" rel="noopener ugc nofollow" target="_blank">glanceappwidgetmanager . getglanceids(..)</a>检索龟头的方法。</p></blockquote><p id="e77d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">此外，我们建议查看“<a class="ae jn" href="https://developer.android.com/guide/topics/appwidgets/advanced#update-widgets" rel="noopener ugc nofollow" target="_blank">更新小部件内容的优化</a>”指南，但是不要使用<a class="ae jn" href="https://developer.android.com/reference/android/appwidget/AppWidgetManager#updateAppWidget(int,%20android.widget.RemoteViews)" rel="noopener ugc nofollow" target="_blank"> AppWidgetManager </a>而是使用本节中的一种机制。</p><h1 id="65a7" class="kj kk hs bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">"我如何从配置活动中更新小部件？"</h1><p id="b35e" class="pw-post-body-paragraph ip iq hs ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated"><strong class="ir ht"><em class="kf">Android:configure</em></strong>允许你提供一个活动，该活动将在小工具第一次放置时(或者在<a class="ae jn" href="https://developer.android.com/guide/topics/appwidgets/configuration#reconfigure-widgets" rel="noopener ugc nofollow" target="_blank">重新配置</a>时)启动。如本<a class="ae jn" href="https://developer.android.com/guide/topics/appwidgets/configuration" rel="noopener ugc nofollow" target="_blank">指南</a>中所述，您可以从<strong class="ir ht"> <em class="kf">意图</em> </strong>中检索<strong class="ir ht"> <em class="kf"> appWidgetId </em> </strong>。目前还没有将其转化为GlanceId的机制。在我们研究它的时候，您可以使用来自<a class="ae jn" href="https://developer.android.com/reference/androidx/glance/appwidget/GlanceAppWidgetManager#getGlanceIds(java.lang.Class)" rel="noopener ugc nofollow" target="_blank">glanceappwidgetmanager . getglanceids(..)</a>自会最后放置<strong class="ir ht"> <em class="kf"> appWidgetId </em> </strong>。</p><h1 id="6b9e" class="kj kk hs bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">“我可以从非主线程/作用域更新我的应用程序小部件吗？”</h1><p id="f889" class="pw-post-body-paragraph ip iq hs ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated">是的，允许并鼓励从不同的线程/作用域调用任何更新方法，但这并不意味着您可以在<strong class="ir ht"> <em class="kf"> Content() </em> </strong>函数中执行长期任务。</p><h1 id="070a" class="kj kk hs bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">“我能用<a class="ae jn" href="https://developer.android.com/jetpack/compose/side-effects" rel="noopener ugc nofollow" target="_blank">副作用</a>吗？”</h1><p id="f4c8" class="pw-post-body-paragraph ip iq hs ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated">因为目前还不支持对Glance进行重组，而且大部分副作用都依赖于它，所以我们不建议使用副作用。尽管它们在Jetpack Compose中很常见，但它们在Glance中不受支持，因为应用程序小部件没有绑定到生命周期(例如一个<strong class="ir ht"> <em class="kf">活动</em> </strong>)，并且该进程可能在任何时候被终止。</p><h1 id="736f" class="kj kk hs bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">“我能用<a class="ae jn" href="https://developer.android.com/reference/kotlin/androidx/compose/runtime/package-summary#remember(kotlin.Function0)" rel="noopener ugc nofollow" target="_blank">还记得</a>吗？”</h1><p id="0e82" class="pw-post-body-paragraph ip iq hs ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated"><strong class="ir ht"> <em class="kf">记住</em> </strong>是Jetpack Compose中用于管理<a class="ae jn" href="https://developer.android.com/jetpack/compose/state" rel="noopener ugc nofollow" target="_blank">状态</a>的机制，通过在Compose中存储值。简而言之，这是不可能的，因为每次小部件更新时，组合都会被破坏。相反，在GlanceAppWidget中定义一个<a class="ae jn" href="https://developer.android.com/reference/androidx/glance/state/GlanceStateDefinition" rel="noopener ugc nofollow" target="_blank"> GlanceStateDefinition </a>，以确保应用程序小部件的状态是持久的，即使进程被终止。</p><p id="6d56" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这里有一个简单的例子:</p><pre class="ln lo lp lq fd lv lw lx ly aw lz bi"><span id="1885" class="ma kk hs lw b fi mb mc l md me">// Define the state definition in your app widget…<br/>override val stateDefinition = <strong class="lw ht">PreferencesGlanceStateDefinition</strong></span><span id="5ff3" class="ma kk hs lw b fi mf mc l md me">// … inside a composable.<br/>val counter: Int = <strong class="lw ht">currentState</strong>(CounterKey) ?: 0</span><span id="fc0e" class="ma kk hs lw b fi mf mc l md me">// … somewhere outside of the composition (e.g <a class="ae jn" href="https://developer.android.com/reference/androidx/glance/appwidget/action/ActionCallback" rel="noopener ugc nofollow" target="_blank">ActionCallback</a>).<br/><strong class="lw ht">updateAppWidgetState</strong>(context, glanceId) { state -&gt;<br/>  state[CounterKey] = (state[CounterKey] ?: 0) + 1<br/>}</span><span id="82ac" class="ma kk hs lw b fi mf mc l md me">// Don’t forget to trigger the update. :)<br/>MyAppWidget().<strong class="lw ht">update</strong>(context, glanceId)</span></pre><blockquote class="kc kd ke"><p id="1fc6" class="ip iq kf ir b is it iu iv iw ix iy iz kg jb jc jd kh jf jg jh ki jj jk jl jm ha bi translated"><strong class="ir ht">注意:</strong> <a class="ae jn" href="https://developer.android.com/reference/kotlin/androidx/glance/appwidget/state/package-summary" rel="noopener ugc nofollow" target="_blank"> updateAppWidgetState </a>不会自动触发app widget更新。你必须手动触发它。</p></blockquote><h1 id="4788" class="kj kk hs bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">“我如何获取数据？”</h1><p id="407a" class="pw-post-body-paragraph ip iq hs ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated">我们正在想办法让这变得更容易，但这不是Glance所特有的。使用RemoteViews开发应用程序小部件也是如此。</p><p id="604d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">从后台异步获取数据的最佳方式是使用<a class="ae jn" href="https://developer.android.com/jetpack/androidx/releases/work" rel="noopener ugc nofollow" target="_blank">工作管理器</a>，并按照<a class="ae jn" href="https://developer.android.com/guide/background" rel="noopener ugc nofollow" target="_blank">后台工作指南</a>中的建议存储数据。重要的部分是避免连续地启动新的工作线程(例如，在<em class="kf">glanceappwidgetreceiver . on update</em>中)或者在数据已经被加载时。</p><h1 id="54a1" class="kj kk hs bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">Android Studio工具</h1><p id="f635" class="pw-post-body-paragraph ip iq hs ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated">我们正在努力提供更好的工具来加速Glance的开发。</p><h1 id="f51c" class="kj kk hs bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">“我可以使用@Preview浏览吗”</h1><p id="98d1" class="pw-post-body-paragraph ip iq hs ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated">目前没有。鉴于Glance通过将组件翻译成实际的RemoteViews和XML来工作的方式，Android Studio提供的预览面板不能用于开箱即用的Glance组件。我们正在寻找实现这一目标的方法。</p><h1 id="3425" class="kj kk hs bd kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg bi translated">“如何更快地应用更改？”</h1><p id="a93a" class="pw-post-body-paragraph ip iq hs ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated">为了加快开发速度，我们建议创建以下启动配置。这可以确保应用程序小部件得到更新，而无需启动活动或移除应用程序小部件并重新放置。</p><ol class=""><li id="e689" class="jo jp hs ir b is it iw ix ja jq je jr ji js jm mg ju jv jw bi translated">在Android Studio中，选择<strong class="ir ht">运行&gt;编辑配置… </strong></li><li id="79d5" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm mg ju jv jw bi translated">创建新配置:</li><li id="f8ec" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm mg ju jv jw bi translated">勾选<strong class="ir ht">总是安装软件包管理器</strong>复选框。</li><li id="5a0c" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm mg ju jv jw bi translated">在<strong class="ir ht">启动选项</strong>下，从<strong class="ir ht">启动</strong>菜单中选择<strong class="ir ht">无</strong>。</li></ol><figure class="ln lo lp lq fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es mh"><img src="../Images/f00bef6c52691217cbfb6358d446829d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*0lGA3w_c9ETIstSx"/></div></div><figcaption class="lr ls et er es lt lu bd b be z dx"><em class="mi">Android Studio Run configuration panel</em></figcaption></figure><h2 id="5a92" class="ma kk hs bd kl mj mk ml kp mm mn mo kt ja mp mq kx je mr ms lb ji mt mu lf mv bi translated">下一步是什么？</h2><p id="b196" class="pw-post-body-paragraph ip iq hs ir b is lh iu iv iw li iy iz ja lj jc jd je lk jg jh ji ll jk jl jm ha bi translated">我们希望这篇文章对您在使用Glance时可能遇到的一些常见问题有所帮助。以下是一些附加资源:</p><ul class=""><li id="91a9" class="jo jp hs ir b is it iw ix ja jq je jr ji js jm jt ju jv jw bi translated">试试Glance并提供你的反馈！</li><li id="06ad" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">跟随<a class="ae jn" href="https://developer.android.com/jetpack/androidx/releases/glance" rel="noopener ugc nofollow" target="_blank">扫视释放</a></li><li id="8a92" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">查看演示<br/><a class="ae jn" href="https://github.com/android/user-interface-samples/tree/main/AppWidget" rel="noopener ugc nofollow" target="_blank">——GitHub</a><br/>——<a class="ae jn" href="https://cs.android.com/androidx/platform/frameworks/support/+/androidx-main:glance/glance-appwidget/integration-tests/demos/src/main/java/androidx/glance/appwidget/demos/" rel="noopener ugc nofollow" target="_blank">Android x回购演示</a>中的官方样本</li><li id="9473" class="jo jp hs ir b is jx iw jy ja jz je ka ji kb jm jt ju jv jw bi translated">加入社群<br/>-stack overflow<a class="ae jn" href="https://stackoverflow.com/questions/tagged/glance" rel="noopener ugc nofollow" target="_blank">#glance</a>，<a class="ae jn" href="https://stackoverflow.com/questions/tagged/glance-appwidget" rel="noopener ugc nofollow" target="_blank"> #glance-appwidget </a> <br/> -加入<a class="ae jn" href="https://surveys.jetbrains.com/s3/kotlin-slack-sign-up" rel="noopener ugc nofollow" target="_blank"> Kotlin Slack group </a>(频道# glance)</li></ul><blockquote class="kc kd ke"><p id="f8fe" class="ip iq kf ir b is it iu iv iw ix iy iz kg jb jc jd kh jf jg jh ki jj jk jl jm ha bi translated"><strong class="ir ht"> PS: </strong>随时在Twitter上ping我(<a class="ae jn" href="https://twitter.com/marxallski" rel="noopener ugc nofollow" target="_blank">@ marxalski</a>)，让我看看你用Glance创造的东西！</p></blockquote></div></div>    
</body>
</html>