<html>
<head>
<title>Monitoring A/B experiments in real-time</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">实时监控A/B实验</h1>
<blockquote>原文：<a href="https://medium.com/pinterest-engineering/monitoring-a-b-experiments-in-real-time-5cd3ee611c1?source=collection_archive---------1-----------------------#2016-06-03">https://medium.com/pinterest-engineering/monitoring-a-b-experiments-in-real-time-5cd3ee611c1?source=collection_archive---------1-----------------------#2016-06-03</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="e6a0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">Bryant Xiao | Pinterest工程师，数据</p><p id="6482" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">作为一家数据驱动型公司，我们非常依赖A/B实验来对新产品和新功能做出决策。我们运行这些实验的效率会强烈影响我们迭代的速度。通过为实验人员提供实时指标，我们增加了成功进行实验的机会，并加快了进度。</p><p id="7f91" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我们有<a class="ae jc" href="https://engineering.pinterest.com/blog/scalable-ab-experiments-pinterest" rel="noopener ugc nofollow" target="_blank">日常工作流程</a>来为每个实验计算数百个指标。虽然这些每日指标提供了关于行为的重要见解，但它们通常要到第二天才可用。如果触发不正确，导致Pinners实际上没有被记录呢？如果有一个bug导致指标大幅下降怎么办？不平衡的群体怎么办？在实时仪表盘之前，没有办法知道，直到第二天。此外，任何后续的更改/修正都需要一天才能看到效果，这会减慢我们的速度。</p><p id="91f3" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">实时实验仪表板解决了这些问题。在这里，我们将分享我们如何构建实时实验指标管道，以及我们如何使用它来正确设置实验，捕捉错误并尽早避免灾难性的变化，包括:</p><ol class=""><li id="91f0" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated">使用MemSQL设置实时数据管道</li><li id="7d47" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">构建每小时和按需指标计算框架</li><li id="66a8" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">实时实验指标的用例</li></ol><h2 id="2ea8" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated">数据管道</h2><p id="d1ff" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">下面是实时实验指标的高级架构。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es kr"><img src="../Images/c435b15145b89abff41ea1f89e6b19b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OxvwSJ8l4aQLFQKb.png"/></div></div></figure><h2 id="c34c" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated">流线型火车</h2><p id="c6b1" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated"><a class="ae jc" href="http://blog.memsql.com/spark-streamliner/" rel="noopener ugc nofollow" target="_blank"> Streamliner </a>是一个集成的MemSQL和Apache Spark解决方案，用于从Kafka等实时数据源传输数据。我们使用它从Kafka获取数据，并保存到MemSQL中(Kafka-&gt;Spark Streaming-&gt;MemSQL)。等待时间足够我们进行接近实时的分析。</p><h2 id="fbc7" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated">MemSQL</h2><p id="1699" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">MemSQL是一个高吞吐量、高可伸缩性、高兼容性的分布式关系数据库。它的高性能查询功能允许我们进行近乎实时的特别分析。我们使用MemSQL作为我们的实时数据库来存储所有数据，并采用24小时保留策略。存储在MemSQL中的数据用于计算计划的和按需的指标。然后，结果将用于填充仪表板。</p><h2 id="d103" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated">仪表盘</h2><p id="a781" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">MemSQL提供了几种使用流行的MySQL兼容客户端和库连接到MemSQL后端的方法。我们使用MemSQL提供的<a class="ae jc" href="https://github.com/memsql/memsql-python" rel="noopener ugc nofollow" target="_blank"> Python库</a>连接到数据库，并运行调度的作业或按需查询。</p><p id="78ee" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">实时实验指标仪表板由两部分组成:</p><ol class=""><li id="3859" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb ji jj jk jl bi translated">过去24小时内预先计算的每小时指标</li><li id="ad83" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb ji jj jk jl bi translated">过去一小时内的实时指标</li></ol><h2 id="6fca" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated">预先计算的指标</h2><p id="7488" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">考虑到更细粒度的实验指标(不到一个小时)可能会有噪声，并且按需计算效率不高，我们决定每小时执行一次cron作业来预先计算过去一个小时的这些指标。当我们转到实时控制面板时，这些预先计算的指标会立即加载。每个单元格是一个小时的度量。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="er es ld"><img src="../Images/2310d858f5fe009823663cc67c443676.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*28xZR7yMd82KY4XU.png"/></div></div></figure><h2 id="491d" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated">实时指标</h2><p id="7333" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">我们还可以在最后一小时内按需计算指标，这使我们能够在实验启动后立即查看见解。</p><figure class="ks kt ku kv fd kw er es paragraph-image"><div class="er es le"><img src="../Images/d4d8e432505435937c0b1d3c6fe9b33d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/0*IM7xLPoSRtTe03m8.png"/></div></figure><h2 id="a0b3" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated">应用程序</h2><p id="23c9" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated"><strong class="ig hi">验证触发</strong> <br/>触发问题仍然较为常见，包括:</p><ul class=""><li id="8294" class="jd je hh ig b ih ii il im ip jf it jg ix jh jb lf jj jk jl bi translated">我们可能忘记激活实验或调用错误的API，因此没有Pinners被记录；</li><li id="9d70" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb lf jj jk jl bi translated">或者我们可能错误地激活实验，以至于一组中的Pinners永远不会被触发；</li><li id="6a0c" class="jd je hh ig b ih jm il jn ip jo it jp ix jq jb lf jj jk jl bi translated">或者看到治疗的Pinners被错误地触发到控制组</li></ul><p id="0479" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">避免这些触发问题是成功进行实验的关键。</p><p id="d8bd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">为了防止出错，最好在打开所有组之前验证触发是否正常工作(例如，将组大小从0%扩大到1%)。我们以前常常跟踪Kafka主题来寻找触发记录，这对大多数开发人员来说是痛苦的。通过实时实验仪表板，验证可以免费完成。一旦我们触发了所有组，我们就可以计算按需指标，它会向我们显示在指定的时间间隔内每个组中触发了多少Pinners。</p><p id="d070" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">确认小组规模变更</strong></p><p id="6bc0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">由于我们的<a class="ae jc" href="https://engineering.pinterest.com/blog/building-pinterest%E2%80%99s-ab-testing-platform" rel="noopener ugc nofollow" target="_blank">新实验平台</a>允许组大小的变化几乎立即生效，所以也可以实时确认组的变化。更改组大小后，我们可以在一小时后检查预先计算的每小时指标。例如，如果我们从1%增加到5 %,新加入的每小时Pinners应该是前一小时的大约5倍。如果我们不想等待，我们也可以按需计算指标并进行粗略的估计。</p><p id="05d8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">检查组平衡</strong></p><p id="b075" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">不平衡组是实验中的另一个常见问题，所以我们越早发现不平衡越好。同样，实时实验仪表板会有所帮助。在增加组大小几个小时后，我们可以查看预先计算的每小时指标，这将显示在过去几个小时内有多少不同的用户被触发到每个组中。</p><p id="d1e1" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">监控核心指标</strong></p><p id="e539" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">实时实验仪表板的另一个用例是快速检测灾难性的变化。在扩大组规模或进行任何更改后，我们可以看到核心指标的表现。如果指标显著下降，我们应该立即检查实验，看看是否有任何错误。我们可能还想关闭实验进行调查，并防止进一步的损害。</p><h2 id="4e3b" class="jr js hh bd jt ju jv jw jx jy jz ka kb ip kc kd ke it kf kg kh ix ki kj kk kl bi translated">摘要</h2><p id="fe69" class="pw-post-body-paragraph ie if hh ig b ih km ij ik il kn in io ip ko ir is it kp iv iw ix kq iz ja jb ha bi translated">实时实验指标对于快速了解实验非常有帮助。这个系统已经投入生产六个多月了，已经在很多情况下帮助了我们。如果您对实验框架和分析平台感兴趣，<a class="ae jc" href="https://careers.pinterest.com/careers/engineering/san-francisco" rel="noopener ugc nofollow" target="_blank">请加入我们的</a>数据工程团队！</p><p id="6311" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="lg">鸣谢:Pinterest的多个团队为构建实时实验仪表板提供了有见地的反馈和建议。主要撰稿人包括Bryant Xiao、、Justin Mejorada-Pier、Shuo Xiang、、John Elliott以及数据工程团队的其他成员。</em></p></div></div>    
</body>
</html>