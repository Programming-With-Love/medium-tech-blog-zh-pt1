<html>
<head>
<title>Yelp Reviews Sentiment Prediction via PySpark, MongoDB, AWS EMR</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Yelpé€šè¿‡PySparkã€MongoDBã€AWS EMRè¯„è®ºæƒ…ç»ªé¢„æµ‹</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://medium.com/quick-code/yelp-reviews-sentiment-prediction-via-pyspark-mongodb-aws-emr-8bf0e21f5a92?source=collection_archive---------3-----------------------#2018-02-01">https://medium.com/quick-code/yelp-reviews-sentiment-prediction-via-pyspark-mongodb-aws-emr-8bf0e21f5a92?source=collection_archive---------3-----------------------#2018-02-01</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="d21f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ä½œè€…:<a class="jc jd ge" href="https://medium.com/u/f8ecd6cdacf9?source=post_page-----8bf0e21f5a92--------------------------------" rel="noopener" target="_blank">å°¼æŸ¥Â·é²å¥‡æ‹‰ç“¦ç‰¹</a>ï¼Œ<a class="jc jd ge" href="https://medium.com/u/f9b481f9624?source=post_page-----8bf0e21f5a92--------------------------------" rel="noopener" target="_blank">è’‚å¨œÂ·å½­</a>ï¼Œ<a class="jc jd ge" href="https://medium.com/u/13c0d3a0ad3?source=post_page-----8bf0e21f5a92--------------------------------" rel="noopener" target="_blank">éº¦è‰²Â·æ</a></p><p id="15fa" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">æƒ…æ„Ÿåˆ†ææˆ–è§‚ç‚¹æŒ–æ˜æ˜¯ä¸€ç§å¸¸è§çš„è‡ªç„¶è¯­è¨€å¤„ç†é—®é¢˜ï¼Œç”¨äºç¡®å®šæ–‡æœ¬æ˜¯æ­£é¢è¿˜æ˜¯è´Ÿé¢çš„ã€‚åœ¨ä¸€ä¸ªé¡¾å®¢è¶Šæ¥è¶Šå¤šåœ°åœ¨ç½‘ä¸Šå‘è¡¨æ„è§çš„ä¸–ç•Œé‡Œï¼Œä¼ä¸šäº†è§£è‡ªå·±çš„ç½‘ä¸Šå£°èª‰è‡³å…³é‡è¦ã€‚</p><p id="6541" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">æˆ‘ä»¬å°†ä½¿ç”¨Apache Sparkçš„æœºå™¨å­¦ä¹ åº“åœ¨Yelpæ•°æ®é›†ä¸Šæ¢ç´¢ä¸€ç§ç®€å•çš„æ–¹æ³•ï¼Œä»¥é¢„æµ‹ç»™å®šè¯„è®ºæ–‡æœ¬çš„æƒ…ç»ªã€‚æˆ‘ä»¬è¿˜å°†åˆ†æå“ªäº›æœ¯è¯­å¯¹ç§¯ææˆ–æ¶ˆæçš„é¤é¦†è¯„è®ºè´¡çŒ®æœ€å¤§ã€‚</p><p id="2701" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ç”±äºç‰¹å¾ç³»æ•°çš„å¯è§£é‡Šæ€§ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<strong class="ig hi">çº¿æ€§æ”¯æŒå‘é‡æœº</strong>å’Œ<strong class="ig hi">é€»è¾‘å›å½’</strong>æ¥é¢„æµ‹è¯„è®ºæ˜¯æ­£é¢è¿˜æ˜¯è´Ÿé¢ã€‚å®ƒä»¬éƒ½æ˜¯NLPåº”ç”¨çš„æœ‰æ•ˆåˆ†ç±»ç®—æ³•ã€‚</p><ol class=""><li id="d719" class="jf jg hh ig b ih ii il im ip jh it ji ix jj jb jk jl jm jn bi translated"><strong class="ig hi">åœ¨AWS EMRå®ä¾‹ä¸Šè®¾ç½®MongoDBå’ŒZeppelin Notebook</strong></li></ol><p id="808f" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">æˆ‘ä»¬è®¾ç½®äº†ä¸€ä¸ªAWS EMRå®ä¾‹ï¼Œæœ‰1ä¸ªä¸»å®ä¾‹å’Œ3ä¸ªå·¥ä½œå®ä¾‹(æ¯ä¸ªå®ä¾‹éƒ½æœ‰ä¸€ä¸ªm3.xlargeï¼Œæœ‰15 GBå†…å­˜å’Œ8ä¸ªå†…æ ¸)ã€‚è¿™å¯¹äº1.5 Mçš„è¯„è®ºå­é›†å¾ˆæœ‰æ•ˆï¼Œä½†æ˜¯æ›´å¤šçš„è¯„è®ºå¯ä»¥é€šè¿‡å…·æœ‰æ›´å¤§å†…å­˜å¤§å°çš„èŠ‚ç‚¹æˆ–è€…å…·æœ‰æ›´å¤šèŠ‚ç‚¹çš„é›†ç¾¤æ¥å¤„ç†ã€‚åŸå§‹æ•°æ®é›†å­˜å‚¨åœ¨äºšé©¬é€ŠS3æ¡¶ä¸­ã€‚MongoDBè®¾ç½®åœ¨ä¸»èŠ‚ç‚¹ä¸Šï¼ŒYelpçš„è¡¨ä»S3å¯¼å…¥ï¼Œæˆ‘ä»¬ä»é‚£é‡ŒåŠ è½½åˆ°Zeppelin Notebookã€‚</p><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es jo"><img src="../Images/edb5be498f5ca9779e665c04dff0482a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VwVFYxsKVhmEVnjEEtvHdA.png"/></div></div></figure><p id="02fe" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">è¦å¯åŠ¨PySparkå’ŒMongoDBä¹‹é—´çš„è¿æ¥:</p><pre class="jp jq jr js fd ka kb kc kd aw ke bi"><span id="9d19" class="kf kg hh kb b fi kh ki l kj kk">from pyspark.sql import SparkSession<br/>spark = SparkSession.builder.appName("yelp).getOrCreate()</span><span id="9631" class="kf kg hh kb b fi kl ki l kj kk">#connect to 'database' called yelp, 'collection' called review<br/>review = spark.read.format("com.mongodb.spark.sql.DefaultSource")\<br/>                .option("uri", "mongodb://127.0.0.1:27017/yelp.review").load()</span></pre><p id="ce43" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 2ã€‚é¢„å¤„ç†è¯„å®¡æ•°æ®</strong></p><p id="3764" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸‹é¢çš„å‡½æ•°æ¸…ç†è¯„è®ºæ–‡æœ¬ï¼Œåˆ é™¤ä»»ä½•æ ‡ç‚¹ç¬¦å·æˆ–æ•°å­—ã€‚</p><pre class="jp jq jr js fd ka kb kc kd aw ke bi"><span id="fcc0" class="kf kg hh kb b fi kh ki l kj kk">import string<br/>import re</span><span id="f9b2" class="kf kg hh kb b fi kl ki l kj kk">def remove_punct(text):<br/>    regex = re.compile('[' + re.escape(string.punctuation) + '0-9\\r\\t\\n]')<br/>    nopunct = regex.sub(" ", text)  <br/>    return nopunct</span></pre><p id="95ce" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">æˆ‘ä»¬è¿˜éœ€è¦å°†æ˜Ÿçº§è½¬æ¢ä¸ºäºŒè¿›åˆ¶ç­‰çº§ï¼Œ1è¡¨ç¤ºæ­£é¢è¯„ä»·ï¼Œ0è¡¨ç¤ºè´Ÿé¢è¯„ä»·ã€‚å¦‚æœè¯„ä»·è¶…è¿‡4æ˜Ÿï¼Œåˆ™ä¸ºæ­£é¢è¯„ä»·ï¼›å¦‚æœä½äº4æ˜Ÿï¼Œåˆ™ä¸ºè´Ÿé¢è¯„ä»·ã€‚4æ˜Ÿä»¥ä¸Šçš„é—¨æ§›æ˜¯å› ä¸ºäººä»¬å€¾å‘äºé«˜ä¼°é¤å…(ä¾‹å¦‚ï¼Œäººä»¬é€šå¸¸ä¸è®¤ä¸º3æ˜Ÿé¤å…æ˜¯ä¸€å®¶å¥½é¤å…)ã€‚</p><pre class="jp jq jr js fd ka kb kc kd aw ke bi"><span id="6254" class="kf kg hh kb b fi kh ki l kj kk">def convert_rating(rating):<br/>    if rating &gt;=4:<br/>        return 1<br/>    else:<br/>        return 0</span></pre><p id="5728" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">æˆ‘ä»¬å°†æŠŠè¿™äº›å‡½æ•°è½¬æ¢æˆPySparkçš„ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ï¼Œå¹¶åœ¨æŸ¥è¯¢æ•´ä¸ªâ€œreviewâ€é›†åˆæ—¶å°†å®ƒä»¬åº”ç”¨äºtextå’Œratingåˆ—ã€‚</p><pre class="jp jq jr js fd ka kb kc kd aw ke bi"><span id="749b" class="kf kg hh kb b fi kh ki l kj kk">from pyspark.sql.functions import udf</span><span id="ac63" class="kf kg hh kb b fi kl ki l kj kk">punct_remover = udf(lambda x: remove_punct(x))<br/>rating_convert = udf(lambda x: convert_rating(x))</span><span id="dddf" class="kf kg hh kb b fi kl ki l kj kk">#select 1.5 mn rows of reviews text and corresponding star rating with punc removed and ratings converted<br/>resultDF = df.select('review_id', punct_remover('text'), rating_convert('stars')).limit(1500000)</span><span id="b691" class="kf kg hh kb b fi kl ki l kj kk">#user defined functions change column names so we rename the columns back to its original names<br/>resultDF = resultDF.withColumnRenamed('&lt;lambda&gt;(text)', 'text')<br/>resultDF = resultDF.withColumnRenamed('&lt;lambda&gt;(stars)', 'stars')</span></pre><p id="a777" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">æˆ‘ä»¬è¿˜éœ€è¦å¯¹æ–‡æœ¬è¿›è¡Œæ ‡è®°(åˆ†è§£æˆå•è¯)å¹¶åˆ é™¤åœç”¨è¯(å¸¸è§çš„è‹±è¯­æœ¯è¯­ï¼Œå¦‚â€œandâ€ã€â€œthenâ€ã€â€œå› æ­¤â€)ã€‚è¿™äº›éƒ½å°†ä½¿ç”¨ç°æœ‰çš„SparkMLå’Œç®¡é“åº“æ¥å®Œæˆã€‚</p><pre class="jp jq jr js fd ka kb kc kd aw ke bi"><span id="8d89" class="kf kg hh kb b fi kh ki l kj kk">from pyspark.ml.feature import *</span><span id="91f6" class="kf kg hh kb b fi kl ki l kj kk">#tokenizer and stop word remover<br/>tok = Tokenizer(inputCol="text", outputCol="words")<br/>#stop word remover<br/>stopwordrm = StopWordsRemover(inputCol='words', outputCol='words_nsw')</span><span id="cfae" class="kf kg hh kb b fi kl ki l kj kk"># Build the pipeline <br/>pipeline = Pipeline(stages=[tok, stopwordrm])<br/># Fit the pipeline <br/>review_tokenized = pipeline.fit(resultDF).transform(resultDF).cache()</span></pre><p id="41b6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">æˆ‘ä»¬ç¼“å­˜æ¸…ç†åçš„æ•°æ®ï¼Œè¿™æ ·æ¯æ¬¡è°ƒç”¨æ•°æ®å¸§æ—¶éƒ½ä¸éœ€è¦é‡æ–°è®¡ç®—ã€‚</p><p id="0933" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 3)ç‰¹å¾é€‰æ‹©:é€‰æ‹©å¹¶æ•´åˆæœ€é‡è¦çš„nå…ƒæ–‡æ³•(å¯é€‰)</strong></p><p id="e736" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ä¸ºäº†æé«˜æœºå™¨å­¦ä¹ æ¨¡å‹çš„å‡†ç¡®æ€§ï¼Œæˆ‘ä»¬å°è¯•æ•´åˆäºŒå…ƒæ¨¡å‹å’Œä¸‰å…ƒæ¨¡å‹ã€‚è¿™æ˜¯åœ¨åœç”¨è¯è¢«ç§»é™¤ä¹‹å‰é€šè¿‡æ ‡è®°åŒ–çš„æ–‡æœ¬åˆ—æ¥å®Œæˆçš„ã€‚</p><p id="7820" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ä¸ºäº†é€‰æ‹©æœ€é‡è¦çš„n gramï¼Œæˆ‘ä»¬å°†äºŒå…ƒæ¨¡å‹æˆ–ä¸‰å…ƒæ¨¡å‹çš„<a class="ae je" href="http://datameetsmedia.com/bag-of-words-tf-idf-explained/" rel="noopener ugc nofollow" target="_blank"> TF-IDFçŸ©é˜µ</a>åˆ†åˆ«è¾“å…¥åˆ°æ”¯æŒå‘é‡æœºæ¨¡å‹ä¸­ï¼Œå¹¶æŒ‘é€‰å‡ºå…·æœ‰æœ€å¤§ç³»æ•°æƒé‡(æ­£è´Ÿ)çš„n gramã€‚è¿™å¾ˆæœ‰æ•ˆï¼Œå› ä¸º<a class="ae je" href="http://proceedings.mlr.press/v3/chang08a/chang08a.pdf" rel="noopener ugc nofollow" target="_blank"> SVMå·²ç»è¢«è¯æ˜æ˜¯ç‰¹å¾é€‰æ‹©çš„å¥½æ–¹æ³•</a>ã€‚</p><p id="f00c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">æˆ‘ä»¬å°†è¿™äº›ngramsè¿æ¥å›è¯„è®ºä¸­ï¼Œä»¥ä¾¿å®ƒä»¬ä½œä¸ºä¸€ä¸ªå•è¯è€Œä¸æ˜¯ä¸¤ä¸‰ä¸ªå•ç‹¬çš„å•è¯è¢«çº³å…¥æ¨¡å‹ä¸­(ä¾‹å¦‚ï¼Œâ€œä¼Ÿå¤§çš„å®¢æˆ·æœåŠ¡â€å˜æˆäº†â€œä¼Ÿå¤§çš„å®¢æˆ·æœåŠ¡â€)ã€‚</p><p id="2cd5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">æœ€å¥½çš„æ¨¡å‹ç”±ä¸€å…ƒæ¨¡å‹å’Œä¸‰å…ƒæ¨¡å‹ç»„æˆã€‚ä¸‹é¢æ˜¯æˆ‘ä»¬å¦‚ä½•é€‰æ‹©ä¸‰å…ƒæ¨¡å‹çš„ä¸€ä¸ªä¾‹å­:</p><pre class="jp jq jr js fd ka kb kc kd aw ke bi"><span id="84f6" class="kf kg hh kb b fi kh ki l kj kk"># add ngram column<br/>n = 3<br/>ngram = NGram(inputCol = 'words', outputCol = 'ngram', n = n)<br/>add_ngram = ngram.transform(review_tokenized)</span><span id="c7d4" class="kf kg hh kb b fi kl ki l kj kk"># count vectorizer and tfidf<br/>cv_ngram = CountVectorizer(inputCol='ngram', outputCol='tf_ngram')<br/>cvModel_ngram = cv_ngram.fit(add_ngram)<br/>cv_df_ngram = cvModel_ngram.transform(add_ngram)</span><span id="e593" class="kf kg hh kb b fi kl ki l kj kk"># create TF-IDF matrix<br/>idf_ngram = IDF().setInputCol('tf_ngram').setOutputCol('tfidf_ngram')<br/>tfidfModel_ngram = idf_ngram.fit(cv_df_ngram)<br/>tfidf_df_ngram = tfidfModel_ngram.transform(cv_df_ngram)</span><span id="2fd0" class="kf kg hh kb b fi kl ki l kj kk"># split into training &amp; testing set<br/>splits_ngram = tfidf_df_ngram.select(['tfidf_ngram', 'label']).randomSplit([0.8,0.2],seed=100)<br/>train_ngram = splits_ngram[0].cache()<br/>test_ngram = splits_ngram[1].cache()</span><span id="5ae8" class="kf kg hh kb b fi kl ki l kj kk"># Convert feature matrix to LabeledPoint vectors<br/>train_lb_ngram = train_ngram.rdd.map(lambda row: LabeledPoint(row[1], MLLibVectors.fromML(row[0])))<br/>test_lb_ngram = train_ngram.rdd.map(lambda row: LabeledPoint(row[1], MLLibVectors.fromML(row[0])))</span><span id="7e48" class="kf kg hh kb b fi kl ki l kj kk"># fit SVM model of only trigrams<br/>numIterations = 50<br/>regParam = 0.3<br/>svm = SVMWithSGD.train(train_lb_ngram, numIterations, regParam=regParam)</span><span id="c83d" class="kf kg hh kb b fi kl ki l kj kk">#extract top 20 trigrams based on weights<br/>top_ngram = svm_coeffs_df_ngram.sort_values('weight')['ngram'].values[:20]<br/>bottom_ngram = svm_coeffs_df_ngram.sort_values('weight', ascending=False)['ngram'].values[:20]<br/>ngram_list = list(top_ngram) + list(bottom_ngram)</span></pre><p id="9240" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">è¦åœ¨åŸæ–‡ä¸­è¿æ¥è¿™äº›é¡¶çº§ä¸‰å…ƒæ¨¡å‹:</p><pre class="jp jq jr js fd ka kb kc kd aw ke bi"><span id="7cba" class="kf kg hh kb b fi kh ki l kj kk"># replace the word with selected ngram<br/>def ngram_concat(text):<br/>    text1 = text.lower()<br/>    for ngram in ngram_list:<br/>        if ngram in text1:<br/>            new_ngram = ngram.replace(' ', '_')<br/>            text1 = text1.replace(ngram, new_ngram)<br/>    return text1</span><span id="5d10" class="kf kg hh kb b fi kl ki l kj kk">ngram_df = udf(lambda x: ngram_concat(x))<br/>ngram_df = review_tokenized.select(ngram_df('text'), 'label')\<br/>                          .withColumnRenamed('&lt;lambda&gt;(text)', 'text')</span></pre><p id="b189" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ä¸€æ—¦å®ç°äº†è¿™ä¸€ç‚¹ï¼Œå°±éœ€è¦é‡å¤æ­¥éª¤2)ä¸­çš„ç®¡é“ï¼Œä»¥ä½¿ç”¨ä¸²è”çš„ngramæ›´æ–°æ ‡è®°åŒ–çš„åˆ—(è€Œä¸æ˜¯å°†ç®¡é“åº”ç”¨äºresultDFï¼Œè€Œæ˜¯å°†å…¶åº”ç”¨äºngram_df)ã€‚</p><p id="0fc6" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 4)æ„å»ºæœ€ç»ˆçš„â€œå•è¯åŒ…â€TF-IDFç‰¹å¾çŸ©é˜µ</strong></p><p id="7526" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">è¦æ„å»ºæœ€ç»ˆçš„TF-IDFç‰¹å¾çŸ©é˜µ:</p><pre class="jp jq jr js fd ka kb kc kd aw ke bi"><span id="229c" class="kf kg hh kb b fi kh ki l kj kk"># count vectorizer and tfidf<br/>cv = CountVectorizer(inputCol='words_nsw', outputCol='tf')<br/>cvModel = cv.fit(review_tokenized)<br/>count_vectorized = cvModel.transform(review_tokenized)</span><span id="1b1b" class="kf kg hh kb b fi kl ki l kj kk">tfidfModel = idf.fit(count_vectorized)<br/>tfidf_df = tfidfModel.transform(count_vectorized)</span></pre><p id="6adf" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 5)æ”¯æŒå‘é‡æœº</strong></p><p id="1f55" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ä¸ºäº†æµ‹è¯•æ¨¡å‹çš„æ€§èƒ½ï¼Œæˆ‘ä»¬å°†æ•°æ®åˆ†ä¸ºè®­ç»ƒé›†å’Œæµ‹è¯•é›†:</p><pre class="jp jq jr js fd ka kb kc kd aw ke bi"><span id="a2ba" class="kf kg hh kb b fi kh ki l kj kk"># split into training and testing set<br/>splits = tfidf_df.select(['tfidf', 'label']).randomSplit([0.8,0.2],seed=100)<br/>train = splits[0].cache()<br/>test = splits[1].cache()</span></pre><p id="af60" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">æˆ‘ä»¬åœ¨è®­ç»ƒé›†ä¸Šå°†TF-IDFç‰¹å¾çŸ©é˜µæ‹Ÿåˆåˆ°SVMæ¨¡å‹ã€‚ä¸€ä¸ªè¶…å‚æ•°regParamç”¨äºæ§åˆ¶è¿‡åº¦æ‹Ÿåˆã€‚å€¼0.3åœ¨è®­ç»ƒé›†å’Œæµ‹è¯•é›†ä¸Šéƒ½äº§ç”Ÿäº†æœ€å¥½çš„f1åˆ†æ•°ã€‚</p><pre class="jp jq jr js fd ka kb kc kd aw ke bi"><span id="3995" class="kf kg hh kb b fi kh ki l kj kk">numIterations = 50<br/>regParam = 0.3<br/>svm = SVMWithSGD.train(train_lb, numIterations, regParam=regParam)</span><span id="ad98" class="kf kg hh kb b fi kl ki l kj kk">test_lb = test.rdd.map(lambda row: LabeledPoint(row[1], MLLibVectors.fromML(row[0])))<br/>scoreAndLabels_test = test_lb.map(lambda x: (float(svm.predict(x.features)), x.label))<br/>score_label_test = spark.createDataFrame(scoreAndLabels_test, ["prediction", "label"])</span></pre><p id="dc95" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 6)æ­£è§„åŒ–(å¼¹æ€§ç½‘)ç‰©æµå›å½’</strong></p><p id="c239" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ä½¿ç”¨ç›¸åŒçš„è®­ç»ƒæ•°æ®ï¼Œæˆ‘ä»¬è¿˜åº”ç”¨äº†æ­£åˆ™åŒ–é€»è¾‘å›å½’ã€‚<a class="ae je" href="http://www.cs.toronto.edu/~kswersky/wp-content/uploads/svm_vs_lr.pdf" rel="noopener ugc nofollow" target="_blank"> SVMä¸“æ³¨äºå¯»æ‰¾æœ€å¤§åŒ–æœ€è¿‘ç‚¹åˆ°è¾¹ç¼˜çš„è·ç¦»çš„åˆ†ç¦»å¹³é¢ï¼Œè€Œé€»è¾‘å›å½’æœ€å¤§åŒ–æ•°æ®çš„æ¦‚ç‡</a>(å³ç¦»è¶…å¹³é¢è¶Šè¿œè¶Šå¥½)ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿˜è°ƒæ•´äº†æœ€ä½³è¶…å‚æ•°RegParamå’ŒElasticNetParamä»¥è·å¾—æœ€ä½³ç»“æœã€‚æˆ‘ä»¬å°†æ¨¡å‹æ‹Ÿåˆå¦‚ä¸‹:</p><pre class="jp jq jr js fd ka kb kc kd aw ke bi"><span id="2ab1" class="kf kg hh kb b fi kh ki l kj kk"># Elastic Net Logit<br/>lambda_par = 0.02<br/>alpha_par = 0.3<br/>lr = LogisticRegression().\<br/>        setLabelCol('label').\<br/>        setFeaturesCol('tfidf').\<br/>        setRegParam(lambda_par).\<br/>        setMaxIter(100).\<br/>        setElasticNetParam(alpha_par)<br/>lrModel = lr.fit(train)<br/>lr_pred = lrModel.transform(test)</span></pre><p id="ea66" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 7)è¯„ä¼°</strong></p><p id="5e4e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">è¯·æ³¨æ„ï¼Œç”±äºæ•°æ®é›†ä¸å¹³è¡¡(æ­£é¢è¯„ä»·å¤šäºè´Ÿé¢è¯„ä»·)ï¼Œf1åˆ†æ•°è¢«é€‰ä¸ºè¯„ä¼°åŸºç¡€ã€‚å‡†ç¡®åº¦ä¸èƒ½è¯´æ˜å…¨éƒ¨æƒ…å†µï¼Œè€Œf1-ä½œä¸ºå‡†ç¡®åº¦å’Œå¬å›ç‡çš„åŠ æƒå¹³å‡å€¼-å¯ä»¥æ­ç¤ºæ¨¡å‹åœ¨è¯†åˆ«é¢„æµ‹ç›¸å…³æ€§å’Œæ­£ç¡®é¢„æµ‹çœŸæ­£ç›¸å…³ç»“æœçš„ç™¾åˆ†æ¯”æ–¹é¢çš„è¡¨ç°ã€‚</p><p id="6459" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">è¯„ä¼°SVMæ¨¡å‹:</p><pre class="jp jq jr js fd ka kb kc kd aw ke bi"><span id="f1ea" class="kf kg hh kb b fi kh ki l kj kk">f1_eval = MulticlassClassificationEvaluator(labelCol="label", predictionCol="prediction", metricName="f1")<br/>svm_f1 = f1_eval.evaluate(score_label_test)<br/>print("F1 score: %.4f" % svm_f1)</span></pre><p id="03af" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">è¯„ä¼°ç‰©æµå›å½’æ¨¡å‹:</p><pre class="jp jq jr js fd ka kb kc kd aw ke bi"><span id="0cbb" class="kf kg hh kb b fi kh ki l kj kk">f1_eval = MulticlassClassificationEvaluator(labelCol="label", predictionCol="prediction", metricName="f1")<br/>lr_f1 = f1_eval.evaluate(lr_pred)<br/>print("F1 score: %.4f" % lr_f1)</span></pre><p id="ec22" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">åœ¨æµ‹è¯•é›†ä¸Šï¼ŒSVMæ¨¡å‹çš„f1å€¼æœ€é«˜ï¼Œä¸º87.32%ã€‚</strong>é€»è¾‘å›å½’æ¨¡å‹åœ¨æµ‹è¯•é›†ä¸Šçš„f1å€¼ä¸º84.21%ã€‚</p><p id="58ca" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi"> 8)ç‰¹å¾åˆ†æ</strong></p><p id="ab5b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¥è‡ªæœ€ç»ˆSVMæ¨¡å‹çš„ç³»æ•°æƒé‡æ¥æŸ¥çœ‹å“ªäº›æœ¯è¯­å¯¹æ­£é¢è¯„è®ºæˆ–è´Ÿé¢è¯„è®ºçš„è´¡çŒ®æœ€å¤§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä¸æœ€ç§¯æçš„ç³»æ•°ç›¸å…³è”çš„æœ¯è¯­ä»£è¡¨é‚£äº›å¯¹ç§¯æè¯„ä»·è´¡çŒ®æœ€å¤§çš„æœ¯è¯­ã€‚ä¸æœ€è´Ÿç³»æ•°ç›¸å…³è”çš„æœ¯è¯­è¡¨ç¤ºå¯¹è´Ÿé¢è¯„ä»·è´¡çŒ®æœ€å¤§çš„é‚£äº›æœ¯è¯­ã€‚</p><p id="8f4c" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">ä¸‹é¢æ˜¯ä¸€ä¸ªå•è¯äº‘ï¼Œç”¨è“è‰²è¡¨ç¤ºæœ€â€œç§¯æâ€çš„è¯è¯­ï¼Œç”¨çº¢è‰²è¡¨ç¤ºæœ€â€œæ¶ˆæâ€çš„è¯è¯­ã€‚</p><figure class="jp jq jr js fd jt er es paragraph-image"><div role="button" tabindex="0" class="ju jv di jw bf jx"><div class="er es km"><img src="../Images/a052e489fe05a16038c9393dfc1f0e0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5E2UA4W_03UOMr1jK4DY6Q.png"/></div></div></figure><p id="ee7e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œæœ€ç§¯æçš„è¯è¯­åŒ…æ‹¬â€œå‹å¥½çš„å‘˜å·¥â€ã€â€œç¾å‘³â€ã€â€œå‡ºè‰²çš„å®¢æˆ·æœåŠ¡â€ã€â€œç¾å‘³çš„é£Ÿç‰©â€ã€‚è¿™è¡¨æ˜é¡¾å®¢æ»¡æ„çš„é‡è¦å› ç´ æ˜¯å‘˜å·¥ã€é£Ÿç‰©å£å‘³å’ŒæœåŠ¡ã€‚å¯ä»¥é€šè¿‡åˆ é™¤è¯¸å¦‚â€œæ£’æäº†â€ã€â€œæ¨èâ€ç­‰çŸ­è¯­æ¥è¿›ä¸€æ­¥æ”¹è¿›ã€‚ä»¥ä¾¿æ›´å¤šæœ‰æ„ä¹‰çš„æ ‡è®°å¯ä»¥å‡ºç°ã€‚</p><p id="9b5e" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">æœ€è´Ÿé¢çš„è¯è¯­åŒ…æ‹¬â€œåˆ†é’Ÿâ€ã€â€œä»·æ ¼è¿‡é«˜â€ã€â€œæ·¡è€Œæ— å‘³â€ã€â€œé£Ÿç‰©è¿˜å¯ä»¥â€ã€â€œæ²¡ä»€ä¹ˆç‰¹åˆ«çš„â€ã€‚è¿™è¡¨æ˜ï¼Œè´Ÿé¢è¯„ä»·æ˜¯ç”±æ¼«é•¿çš„ç­‰å¾…æ—¶é—´ã€ä»·æ ¼è¿‡é«˜çš„é£Ÿç‰©ã€ç³Ÿç³•çš„é£Ÿç‰©å‘³é“é€ æˆçš„ï¼Œè¿™ç§ç»å†å¹¶ä¸è¢«è§†ä¸ºä»€ä¹ˆç‰¹åˆ«çš„äº‹æƒ…ã€‚</p><p id="316d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">è¿™ç¯‡æ–‡ç« æ€»ç»“äº†äº§ç”Ÿæœ€ä½³ç»“æœçš„æ­¥éª¤ã€‚è¦æŸ¥çœ‹æˆ‘ä»¬å°è¯•çš„æ‰€æœ‰æ­¥éª¤çš„æ‰€æœ‰ä»£ç ï¼Œè¯·æŸ¥çœ‹è¿™ä¸ª<a class="ae je" href="https://github.com/nicharuc/yelp-sentiment-prediction/blob/master/yelp_nlp_svm.md" rel="noopener ugc nofollow" target="_blank"> GitHub </a>ã€‚</p></div><div class="ab cl kn ko go kp" role="separator"><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks kt"/><span class="kq bw bk kr ks"/></div><div class="ha hb hc hd he"><figure class="jp jq jr js fd jt"><div class="bz dy l di"><div class="ku kv l"/></div></figure><p id="6ecd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><strong class="ig hi">è¯·ç‚¹å‡»ğŸ‘æŒ‰é’®ä¸‹é¢å‡ ä¸‹ï¼Œä»¥ç¤ºæ”¯æŒï¼â¬‡â¬‡è°¢è°¢ï¼ä¸è¦å¿˜è®°éµå¾ªä¸‹é¢çš„å¿«é€Ÿä»£ç ã€‚</strong></p><blockquote class="kw"><p id="d6c0" class="kx ky hh bd kz la lb lc ld le lf jb dx translated">æ‰¾åˆ°å…³äºå„ç§ç¼–ç¨‹è¯­è¨€çš„<a class="ae je" href="http://www.quickcode.co/" rel="noopener ugc nofollow" target="_blank">å¿«é€Ÿä»£ç </a>çš„å…è´¹è¯¾ç¨‹ã€‚è·å–<a class="ae je" href="https://www.messenger.com/t/1493528657352302" rel="noopener ugc nofollow" target="_blank"> Messenger </a>çš„æ–°æ›´æ–°ã€‚</p></blockquote></div></div>    
</body>
</html>