<html>
<head>
<title>CameraX: a glimpse into the past, present, and future</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">CameraX:对过去、现在和未来的一瞥</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/camerax-a-glimpse-into-the-past-present-and-future-19e22d8d2748?source=collection_archive---------0-----------------------#2020-07-22">https://medium.com/androiddevelopers/camerax-a-glimpse-into-the-past-present-and-future-19e22d8d2748?source=collection_archive---------0-----------------------#2020-07-22</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/708d244178058838575477a94a332803.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IqKj3tX9w6hM9y_71dM4VA.png"/></div></div></figure><div class=""/><p id="82b3" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">CameraX 是一个非捆绑的<a class="ae jn" href="https://developer.android.com/jetpack" rel="noopener ugc nofollow" target="_blank"> Android Jetpack </a>库，可以帮助你轻松地在你的Android应用中添加相机功能。由于种类繁多的Android设备和复杂的编程模型，传统上在Android上构建具有相机功能的应用程序很困难。成千上万的开发人员现在正在使用CameraX，许多人已经实现了APK大小的缩减、业务指标的改进，并且还精简了他们的资源，使他们的工程师能够专注于构建酷的新功能。</p><p id="9ee3" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这篇文章讲述了CameraX如何颠覆现有的相机框架编程模型，它如何帮助您在Android上扩展您的应用程序，并介绍了自<a class="ae jn" rel="noopener" href="/androiddevelopers/androids-camerax-jetpack-library-is-now-in-beta-bf4cf0cc3ea6">测试版</a>以来的新功能，例如将ML Kit等智能功能集成到您的应用程序中的简单方法。</p><h2 id="ed3f" class="jo jp hs bd jq jr js jt ju jv jw jx jy ja jz ka kb je kc kd ke ji kf kg kh ki bi translated">逆转过去的复杂性</h2><p id="3bbd" class="pw-post-body-paragraph ip iq hs ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated">我们首先在网上搜索您遇到的各种问题，并对该领域的一些现有设备进行试验。我们惊讶地了解到，你们中的许多人仅仅为了让事情正常工作，就求助于跨越制造商、芯片组、甚至特定设备的大型if-else代码块。这种行为的一个原因是，使用<a class="ae jn" href="https://developer.android.com/reference/android/hardware/Camera" rel="noopener ugc nofollow" target="_blank"> Camera1 </a>或<a class="ae jn" href="https://developer.android.com/reference/android/hardware/camera2/package-summary" rel="noopener ugc nofollow" target="_blank"> Camera2 </a>框架API，您从一组特定于设备和操作系统的输入开始，以获得想要的输出，比如拍照。按照设计，这要求您提前了解设备配置，以帮助您实现目标——这使得在推出新设备时很难扩展您的代码。</p><figure class="kp kq kr ks fd hj er es paragraph-image"><div class="er es ko"><img src="../Images/99ecc7ae5a077448b6f7935ce7d6c61f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1024/format:webp/1*i7lmVnjaerzlrw7X_qt0Ww.png"/></div><figcaption class="kt ku et er es kv kw bd b be z dx">Camera1 / Camera2 framework programming model</figcaption></figure><p id="030a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们必须从根本上重新思考编程模型。您的许多反馈启发我们翻转漏斗，从基于用例的方法开始(如下图所示)。</p><figure class="kp kq kr ks fd hj er es paragraph-image"><div class="er es kx"><img src="../Images/424de4a51e3f79ef54a2b079f0cd3d78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Nalw_k3vszZ9e9CnjGl8rA.png"/></div><figcaption class="kt ku et er es kv kw bd b be z dx">CameraX programming model</figcaption></figure><p id="9cb6" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">通过这种新方法，该团队创建了一个非捆绑库CameraX，它与所有主要的Android版本无关，可以在94%以上的API 21设备上工作，而不需要特定于设备的if-else块。在CameraX中，您首先通过创建一个用例来指定您的目标，例如使用<a class="ae jn" href="https://developer.android.com/reference/androidx/camera/core/ImageCapture" rel="noopener ugc nofollow" target="_blank"> ImageCapture </a>用例“拍照”。然后，CameraX会确定有助于您实现目标的特定于操作系统和设备的配置。今天，用例支撑着CameraX的体验，从<a class="ae jn" href="https://developer.android.com/reference/androidx/camera/core/Preview" rel="noopener ugc nofollow" target="_blank">预览</a>、<a class="ae jn" href="https://developer.android.com/reference/androidx/camera/core/ImageAnalysis" rel="noopener ugc nofollow" target="_blank">图像分析</a>和<a class="ae jn" href="https://developer.android.com/reference/androidx/camera/core/ImageCapture" rel="noopener ugc nofollow" target="_blank">图像捕捉</a>开始。</p><h2 id="e456" class="jo jp hs bd jq jr js jt ju jv jw jx jy ja jz ka kb je kc kd ke ji kf kg kh ki bi translated">帮助开发人员扩展测试</h2><p id="976c" class="pw-post-body-paragraph ip iq hs ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated">除了现有的框架API实现和使用复杂性之外，许多开发人员在跨大量Android设备和各种相机配置大规模测试他们的应用时遇到了困难。我们了解到，即使对于最基本的相机应用程序，您的大量资源也花费在测试大型设备池上，导致了前面提到的特定于设备的解决方案。鉴于测试是整个开发的关键部分，这启发我们建立了一个专门的CameraX测试实验室，提供跨多个Android设备的测试覆盖。</p><figure class="kp kq kr ks fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es ky"><img src="../Images/6f63b1123a1e1c9a83ab99bb4847b048.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kPuNR3WsCU4kCQUodqVaCg.jpeg"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">Samsung Galaxy J1 Ace inside the lighting controlled CameraX test box</figcaption></figure><p id="ad16" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">今天，这个实验室里有90多台Android设备。两部手机安装在一个定制的测试盒内，带有受控的照明和一个电机，以模拟相机应用程序的旋转和方向。这90多台设备代表了约4.5亿台活跃的Android设备，涵盖所有操作系统级别(自棉花糖以来)、价格层级(我们最低端的手机零售价低于100美元)、芯片组(涵盖联发科、高通和优尼科)和制造商(<a class="ae jn" href="https://developer.android.com/training/camerax/devices" rel="noopener ugc nofollow" target="_blank">完整的设备列表</a>)。</p><h2 id="d961" class="jo jp hs bd jq jr js jt ju jv jw jx jy ja jz ka kb je kc kd ke ji kf kg kh ki bi translated">缩小差距</h2><p id="8d2a" class="pw-post-body-paragraph ip iq hs ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated">在过去的几年里，Android制造商取得了巨大的进步，为移动设备带来了高动态范围(HDR)、模糊散景和夜间摄影等新功能。然而，到目前为止，这种功能只能通过手机的本机(或系统)摄像头应用程序来实现。<a class="ae jn" href="https://developer.android.com/training/camerax/vendor-extensions" rel="noopener ugc nofollow" target="_blank"> CameraX厂商扩展</a>(又名扩展)缩小了差距，并向所有开发人员开放了五种特定于制造商的功能。这包括:</p><ul class=""><li id="da7b" class="kz la hs ir b is it iw ix ja lb je lc ji ld jm le lf lg lh bi translated"><a class="ae jn" href="https://developer.android.com/reference/androidx/camera/extensions/HdrImageCaptureExtender" rel="noopener ugc nofollow" target="_blank"> HDR </a>:使用制造商的多帧处理能力来合并多个帧，并提供保留场景高光和低光的图像。</li><li id="6fd7" class="kz la hs ir b is li iw lj ja lk je ll ji lm jm le lf lg lh bi translated"><a class="ae jn" href="https://developer.android.com/reference/androidx/camera/extensions/NightImageCaptureExtender" rel="noopener ugc nofollow" target="_blank">夜晚</a>:利用厂商的低光多帧处理能力，在低光条件下提供更具吸引力的画面。</li><li id="3268" class="kz la hs ir b is li iw lj ja lk je ll ji lm jm le lf lg lh bi translated"><a class="ae jn" href="https://developer.android.com/reference/androidx/camera/extensions/AutoImageCaptureExtender" rel="noopener ugc nofollow" target="_blank">自动</a>:根据当前的环境照明条件，自动确定并提供HDR或夜景图像。</li><li id="fa40" class="kz la hs ir b is li iw lj ja lk je ll ji lm jm le lf lg lh bi translated">散景:提供背景模糊的图像，非常适合人们摄影。</li><li id="f8cb" class="kz la hs ir b is li iw lj ja lk je ll ji lm jm le lf lg lh bi translated"><a class="ae jn" href="https://developer.android.com/reference/androidx/camera/extensions/BeautyImageCaptureExtender" rel="noopener ugc nofollow" target="_blank">美颜</a>:启用图像内的脸部美颜效果。</li></ul><p id="d53d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最好的部分:当启用扩展时，你不需要特定于设备的if-else块——只需编写一次代码，它就可以在所有支持的设备上工作。您可以使用<a class="ae jn" href="https://developer.android.com/reference/androidx/camera/extensions/ExtensionsManager.ExtensionsAvailability" rel="noopener ugc nofollow" target="_blank"> ExtensionsManager检查特定设备上是否启用了扩展。扩展可用性</a>。如果有可用的扩展，您可以向用户显示必要的UI元素(如果适用)，并配置预览和ImageCapture用例来使用扩展，而不是普通的图像捕获。只需几行代码，您就可以显著提高图像质量和整体用户体验。</p><figure class="kp kq kr ks fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lo"><img src="../Images/bc9d8985caac2c556ac9ebfae28e8cbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cQd5tesF6qdROu_fw1orqw.png"/></div></div><figcaption class="kt ku et er es kv kw bd b be z dx">HDR off (left) vs. HDR on (right) on Samsung S10+ taken using CameraX Extensions</figcaption></figure><p id="bfd1" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这些扩展适用于三星(S10+以上的所有旗舰产品)、摩托罗拉(他们的大多数设备都是用Android 10升级或推出的)、Oppo (Reno Pro 2)和几款使用Unisoc移动处理器的入门级手机。我们很高兴能够缩小与扩展的差距，并感谢所有制造商不断扩大具有这些功能的设备的数量。</p><h2 id="7de4" class="jo jp hs bd jq jr js jt ju jv jw jx jy ja jz ka kb je kc kd ke ji kf kg kh ki bi translated">启用新功能</h2><p id="b1a6" class="pw-post-body-paragraph ip iq hs ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated">从2019年谷歌I/O大会上<a class="ae jn" href="https://www.youtube.com/watch?v=kuv8uK-5CLY" rel="noopener ugc nofollow" target="_blank"> CameraX的Alpha发布</a>，2020年2月<a class="ae jn" rel="noopener" href="/androiddevelopers/androids-camerax-jetpack-library-is-now-in-beta-bf4cf0cc3ea6"> Beta </a>，到今天。随着<a class="ae jn" href="https://developer.android.com/jetpack/androidx/releases/camera" rel="noopener ugc nofollow" target="_blank">最新</a>测试版的发布，我们很高兴地分享CameraX改进的兼容性，引入<a class="ae jn" href="https://developer.android.com/reference/kotlin/androidx/camera/view/PreviewView" rel="noopener ugc nofollow" target="_blank">预览视图</a>以获得无缝预览，以及新的样本和实用程序以使CameraX的使用更加简单。</p><p id="984a" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">从改善设备兼容性开始，我们已经能够解决几个设备特定的问题，如错误的设备纵横比(在LG G3上)，在某些情况下无法切换相机(在Pixel 2上)，以及通过在CameraX中添加修复和变通方法来修复<a class="ae jn" href="https://issuetracker.google.com/159039233" rel="noopener ugc nofollow" target="_blank">点击对焦(在Samsung J7上)</a>。此外，根据您在<a class="ae jn" href="https://issuetracker.google.com/issues?q=status:open%20componentid:618491" rel="noopener ugc nofollow" target="_blank">公开错误报告</a>中的意见(谢谢！)，我们在CameraX测试实验室中添加了额外的测试，比如UI小部件集成和纵横比测试。如果您发现任何特定于设备的问题，请<a class="ae jn" href="https://issuetracker.google.com/issues?q=status:open%20componentid:618491" rel="noopener ugc nofollow" target="_blank">让我们知道</a>，我们很乐意解决这些问题。</p><p id="634e" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">虽然CameraX确实提供了<a class="ae jn" href="https://developer.android.com/reference/androidx/camera/core/Preview" rel="noopener ugc nofollow" target="_blank">预览</a>用例，但你们中的许多人一直在寻求一种更简单的解决方案来获得屏幕预览。<a class="ae jn" href="https://developer.android.com/reference/kotlin/androidx/camera/view/PreviewView" rel="noopener ugc nofollow" target="_blank">预览视图</a>是向与相机交互的应用程序添加视图的最简单方式。它不需要关于相机API或底层硬件的深入知识，因为它由CameraX驱动，所以它是节能的，并为用户提供非常低的延迟。默认情况下，它通过使用<a class="ae jn" href="https://developer.android.com/reference/android/view/SurfaceView" rel="noopener ugc nofollow" target="_blank">表面视图</a>来实现这一点，如果设备与<a class="ae jn" href="https://developer.android.com/reference/android/view/SurfaceView" rel="noopener ugc nofollow" target="_blank">表面视图</a>不兼容，它将自动退回到<a class="ae jn" href="https://developer.android.com/reference/android/view/TextureView" rel="noopener ugc nofollow" target="_blank">纹理视图</a>。</p><p id="3931" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><a class="ae jn" href="https://developer.android.com/reference/kotlin/androidx/camera/view/PreviewView" rel="noopener ugc nofollow" target="_blank">预览视图</a>也有助于改善用户体验。新的<a class="ae jn" href="https://developer.android.com/reference/kotlin/androidx/camera/view/PreviewView?hl=id&amp;authuser=2#getpreviewstreamstate" rel="noopener ugc nofollow" target="_blank">getPreviewStreamState()</a>API使您的应用程序能够在预览流或空闲时得到通知。您可以使用这个新的API在预览空闲时在<a class="ae jn" href="https://developer.android.com/reference/kotlin/androidx/camera/view/PreviewView" rel="noopener ugc nofollow" target="_blank">预览视图</a>的顶部显示一个占位符图像，并在预览流动时隐藏该占位符。这可以避免预览开始时出现令人不愉快的黑屏。你可以在这篇<a class="ae jn" rel="noopener" href="/androiddevelopers/display-a-camera-preview-with-previewview-86562433d86c">博文</a>中了解更多关于如何使用<a class="ae jn" href="https://developer.android.com/reference/kotlin/androidx/camera/view/PreviewView" rel="noopener ugc nofollow" target="_blank">预览视图</a>的信息。</p><figure class="kp kq kr ks fd hj er es paragraph-image"><div class="er es lp"><img src="../Images/a7fa6cdf67659bc8a7e1aaded6fe3a66.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/0*Q6MYp_hGBRXczbuw"/></div><figcaption class="kt ku et er es kv kw bd b be z dx">ML Kit + CameraX Google Translate showcase (<a class="ae jn" href="https://github.com/googlesamples/mlkit/tree/master/android/translate-showcase" rel="noopener ugc nofollow" target="_blank">GitHub</a>)</figcaption></figure><p id="3d98" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最后，<a class="ae jn" href="https://developer.android.com/reference/androidx/camera/core/ImageAnalysis" rel="noopener ugc nofollow" target="_blank"> ImageAnalysis </a>通过提供每帧缓冲区访问开始。一旦我们将这个用例与<a class="ae jn" href="https://developers.google.com/ml-kit" rel="noopener ugc nofollow" target="_blank"> ML Kit </a>的交钥匙API结合起来，它将开辟许多新的可能性，如文本识别、图像标记，甚至使用您自己训练的Tensorflow Lite模型来检测和识别对象。或者，您可以将CameraX直接用于TensorFlow Lite运行时(<a class="ae jn" href="https://github.com/android/camera-samples/tree/master/CameraXTfLite" rel="noopener ugc nofollow" target="_blank"> GitHub </a>)。要深入了解最新的CameraX更新，请观看此视频:</p><figure class="kp kq kr ks fd hj"><div class="bz dy l di"><div class="lq lr l"/></div></figure><p id="a88e" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">目前，Play Store上有数千个应用程序部署了CameraX，涵盖汽车、银行、约会、聊天、电子商务、搜索、社交等多个类别。发现CameraX很有帮助的一些开发人员包括:</p><ul class=""><li id="287a" class="kz la hs ir b is it iw ix ja lb je lc ji ld jm le lf lg lh bi translated"><a class="ae jn" href="https://play.google.com/store/apps/details?id=co.uk.getmondo" rel="noopener ugc nofollow" target="_blank"> Monzo Bank </a>使用CameraX a)消除了9000行代码，包括UI代码，b)将识别图像捕获和自拍视频记录的退出率从25%降低到5%左右(<a class="ae jn" href="https://developer.android.com/stories/apps/monzo-camerax" rel="noopener ugc nofollow" target="_blank">案例研究</a>)。</li><li id="e99b" class="kz la hs ir b is li iw lj ja lk je ll ji lm jm le lf lg lh bi translated"><a class="ae jn" href="https://play.google.com/store/apps/details?id=com.cyberlink.youperfect" rel="noopener ugc nofollow" target="_blank"> YouCam Perfect </a>使用CameraX(相比camera2)可以减少70%的代码行，并且极大地提高了新产品开发的效率。</li><li id="e957" class="kz la hs ir b is li iw lj ja lk je ll ji lm jm le lf lg lh bi translated"><a class="ae jn" href="https://play.google.com/store/apps/details?id=best.sweet.selfie" rel="noopener ugc nofollow" target="_blank"> Ufoto </a>使用CameraX来简化他们的资源，使他们的工程师能够专注于构建很酷的新功能。当从Camera1迁移到CameraX时，他们也观察到了可测量的改进。例如，在某些设备中，图像捕捉速度快10%，而在某些设备中，预览帧速率高30%。</li></ul><h1 id="9132" class="ls jp hs bd jq lt lu lv ju lw lx ly jy lz ma mb kb mc md me ke mf mg mh kh mi bi translated">下一步是什么</h1><p id="c001" class="pw-post-body-paragraph ip iq hs ir b is kj iu iv iw kk iy iz ja kl jc jd je km jg jh ji kn jk jl jm ha bi translated">我们将不断提高Android设备的兼容性和可靠性，同时让CameraX更易于使用(<a class="ae jn" href="https://issuetracker.google.com/issues?q=status:fixed%20componentid:618491" rel="noopener ugc nofollow" target="_blank">开发者报告的CameraX已修复问题列表</a>)。例如，在接下来的几个月里，我们将在CameraX测试实验室中添加更多设备。我们坚信，开发人员不应该担心底层的相机堆栈或特定于设备的怪癖，这样他们就可以专注于构建用户喜欢的出色应用程序。有超过2，000名开发人员在生产中使用CameraX，我们建议您尝试采用和部署最新版本的CameraX Beta。</p><p id="51ad" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果你想用CameraX弄脏你的手，看看我们的<a class="ae jn" href="https://codelabs.developers.google.com/codelabs/camerax-getting-started/#0" rel="noopener ugc nofollow" target="_blank">教程</a>和我们的<a class="ae jn" href="https://github.com/android/camera-samples/tree/master/CameraXBasic" rel="noopener ugc nofollow" target="_blank">官方样本</a>。在您试用CameraX之后，我们希望听到您看到的改进类型。如果您发现最新版本有任何问题，请尽可能用错误报告<a class="ae jn" href="https://issuetracker.google.com/issues?q=status:open%20componentid:618491" rel="noopener ugc nofollow" target="_blank">提交一个错误</a>(我们每周进行一次分类)。您还可以通过电子邮件向<a class="ae jn" href="https://groups.google.com/a/android.com/g/camerax-developers" rel="noopener ugc nofollow" target="_blank"> Android CameraX讨论组</a>发送问题，或者在<a class="ae jn" href="https://stackoverflow.com/" rel="noopener ugc nofollow" target="_blank"> StackOverflow </a>上发布标签为“android-camerax”的帖子。</p><p id="5af2" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们衷心感谢您，我们出色的开发人员、合作伙伴、制造商和CameraX团队成员，感谢您帮助塑造和构建CameraX Jetpack库。</p></div></div>    
</body>
</html>