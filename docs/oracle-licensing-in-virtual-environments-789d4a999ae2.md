# 虚拟环境中的 Oracle 许可

> 原文：<https://medium.com/version-1/oracle-licensing-in-virtual-environments-789d4a999ae2?source=collection_archive---------1----------------------->

![](img/7136bb0c42fda2231a0ffbb1a99eaed7.png)

虚拟化已经以各种形式存在了几十年，然而，它最初是在企业级硬件上发现的:大型机、基于 IBM Power 的机架和大型“机箱”机器。随着过去 15 年左右 VMware 的推出和广泛采用，使用商品级硬件实现虚拟化变得更加容易。

虚拟化 Oracle 工作负载需要更长时间才能让企业获得所需的舒适度，以确保性能和支持不受影响。随着越来越多的客户转向 VMware，Oracle 不得不改进其实践，以确保他们的支持和许可组织不会感受到重大影响:虽然硬件减少意味着许可收入减少，但这需要与被许可方的衍生业务价值相平衡。

> 相关阅读:[为什么选择第 1 版作为您的 Oracle 合作伙伴？](https://www.version1.com/about-us/our-technology-partnerships/oracle/)

这最终演变成一个复杂的“生态系统”，在过去 10 年里发生了巨大变化，让客户，事实上除了最密切参与这一演变的人之外，所有人都普遍感到困惑。

虚拟环境中的 Oracle 许可长期以来一直是 Oracle 客户担心的问题，甚至有些客户仍然拒绝将其 Oracle 工作负载放在 VMware 上。尽管越来越多的人在考虑将 Oracle 工作负载迁移到云，但虚拟化仍然是一个相关的问题，无论是作为私有云平台还是整合资产，而不是迁移到云。重要的是，**我们仍然看到虚拟化给客户带来了巨额账单。**这可能会导致不必要的许可证购买，甚至是不必要和不适当的 ula。

与 Oracle 许可的许多方面一样，这是一个深入的主题，但本博客旨在阐明许可部署在 VMware 上的 Oracle 的背景、立场和方法。综上所述；

> **您没有理由避免在虚拟环境中运行 Oracle。**我们超过 96%的企业客户使用 VMware 来处理 Oracle 工作负载:没有一种解决方案可以满足所有客户的需求，需要一种经过深思熟虑的方法。

# **背景**

根据与相关处理能力相关的指标来许可技术产品的概念是有意义的:大型服务器通常会运行更重要的工作负载，技术产品将提供更多价值(由于处理器数量的增加)。这是一种由来已久的机制，用于支付与衍生价值成比例的许可费。

随着基于 X86 的虚拟化在 2000 年代末和 2010 年代得到越来越多的采用，VMware 在企业中有了很大的发展。将许多专用物理服务器整合到 VMware 主机中、提高 CPU 利用率、减少硬件占用空间和成本是任何愿意支付 VMware 许可证费用的人都可以获得的主要好处。不可避免地，这意味着 Oracle 工作负载缓慢但肯定会成为虚拟化的潜在目标:利用率更高，许可证更少。

这一点值得思考一下:将许多效率低下、未充分利用的服务器整合到更少的优化物理主机中，意味着分配给工作负载的处理能力总体下降。我可以轻松虚拟化两台 16 核服务器并消耗这些资源，而不是让它们以 20%的 CPU 利用率运行，因此(简单地说)通过优化我拥有的处理器的负载平衡，将 Oracle 的许可费减少了 75%。

# **进化和功能变化**

随着时间的推移，Oracle 对其支持(技术上)运行在 VMware 上的 Oracle 的能力表示担忧:导致客户对虚拟化持谨慎态度。事实上，感知的风险从未真正成为现实:Oracle 认证其产品与给定操作系统的组合——他们不针对底层平台或服务器进行认证。这种担忧已经消退，没有证据表明，我们也没有听说客户需要在物理服务器上重现问题才能获得支持。

*在 VMware 上运行 Oracle 时，支持从来都不是问题*

当 Oracle 意识到 VMware 提供的不仅仅是整合工作负载的能力时，下一个变化出现了:虚拟机可以在物理主机之间实时迁移。这意味着工作负载可以无缝地(对用户而言)从给定的 VMware 服务器移动到 VMware 环境中的另一台服务器。这种*在不同物理服务器之间迁移 Oracle 工作负载的能力*被 Oracle 解释为意味着**潜在的**服务器也需要获得许可。

在早期版本中，这种 vMotion 功能仅限于给定的集群:运行 Oracle 软件的虚拟机可以迁移并驻留在集群中的任何其他主机上。因此，Oracle 要求客户许可运行 Oracle 的虚拟机所在集群中的所有主机，因为在他们看来，任何潜在的主机都需要许可。

随着 VMware 功能的增加，可以在任何群集之间迁移虚拟机，只要它们由单个 vCenter 管理。Oracle 调整了他们的许可实践以反映:在这些版本的 vCenter(5.1–5.5)中，vCenter 下所有群集中的所有主机都需要获得许可，因为所有主机都是虚拟机运行的潜在目标。

在 VMware 的更高版本(6.0 以上)中，甚至可以在由不同 vCenters 管理的主机之间移动虚拟机，以及迁移到云。Oracle 再次推动了许可规则的演变，以反映这一新功能:vCenters 下运行这一更高版本 VMware 的所有 ESX 主机都需要获得许可。重申:所有 VMware 主机(该版本)都需要获得许可；没有有效的许可边界。

总之，该政策有效地规定了以下内容:现在，这些内容大多与 VMware 的旧版本有关，只是出于兴趣和展示政策演变的目的才包括在内。概括地说,“按版本”规则如下:

*   VMware 5.0 和更低版本:许可任何存在 Oracle 产品的群集的所有主机
*   VMware 5.1–5.5:许可存在 Oracle 产品的给定 vCenter 下的所有主机
*   VMware 6.0 及更高版本:许可运行此版本 ESX 的所有主机，而不考虑 Oracle 产品所在的 vCenter

> 相关阅读:[如何更新您现有的应用程序，以实现更大的创新和灵活性](https://www.version1.com/it-service/digital-services/modernise-with-oci/)

# **通信与合同**

上述内容对许可有重大影响，因此人们会认为这在许可/合同条款中有非常清楚明确的规定。迄今为止，情况并非如此。唯一提到 VMware 的与许可相关的文档是 Oracle 的硬分区文档([链接](https://www.oracle.com/assets/partitioning-070609.pdf))。本文档指导 Oracle 期望客户如何许可，以及哪些技术可用于许可基于子容量的服务器:即，通过调整处理器配置以减少许可证分配，客户可以在**单个服务器**中做什么。虽然该文档声明 VMware 是软分区:但没有进一步的细节，也没有对上述可变规则的深入了解。

这是一个难题。当这些规则似乎没有明确规定或在任何地方公布时，怎么能指望客户确保他们得到适当的许可呢？

下一个问题:这个硬分区文档是非合同性的，仅用于教育目的。这意味着它不会从客户的订购文件或主协议(OMA/OLSA)中引用—这由整个协议条款阐明，该条款清楚地表明“完整协议”是订单加上主协议加上**合同上**引用的政策/信息。没有引用硬分区文档:虽然 Oracle 使用它来统计**他们对所需许可证的**看法，但值得记住的是，由于它不是合同性的，因此它对客户没有任何约束力。像任何其他供应商一样，Oracle 许可合同是 Oracle 和被许可方之间的合同:只有合同的内容具有约束力。合同中未包含的任何计算，无论是否有文件记录，都不受合同约束，因此可能受到质疑。

那么，典型的客户合同说明了什么？

*处理器:指安装和/或运行软件的所有处理器。*

没有提及 VMware、集群(忽略关于主动-被动集群的故障转移条款)或虚拟化。

*处理器定义是客户根据合同***有义务许可其使用软件的唯一依据。**

*因此，Oracle VMware 政策似乎取决于处理器定义中的“已安装”一词:Oracle 软件在哪些处理器上运行是显而易见的:运行装有 Oracle 软件的虚拟机的物理服务器。Oracle 断言，任何主机适应 Oracle 工作负载迁移的*潜力*都构成了安装。但是，可以说，对安装的任何合理解释都是基于立即启动和使用软件的能力:不言而喻，这只能发生在安装了软件的虚拟机上。*

*想想看，假设有一台安装了 Oracle 软件的虚拟机和 100 台 VMware 主机，那么所消耗的最大处理能力相当于 100 台主机中最大的物理主机。假设所有主机都有 48 个内核。在典型操作期间，虚拟机(和 Oracle 软件)可以安装和/或运行在 48 个内核上(实际上，由于虚拟机的虚拟 CPU (vCPU)分配，可能会少很多)。在正常运行期间，不能消耗超过 48 个内核的任何东西；**Oracle 软件只能为客户提供 48 核的处理能力/优势。***

*这可归结为以下情况:48 个核心的业务优势源自 Oracle 软件，根据 Oracle 惯例，该软件应获得 4，800 个核心的许可，其中包括 4752 个核心的许可，这些核心中没有一个将/可以用于托管 Oracle 工作负载。*

*如果我们将虚拟机设置为具有 vMotion 功能，那么从逻辑上来说，首先必须有一个时间点，通过“旧”和“新”虚拟机(仍然“只有”总共 96 个内核“运行”该软件)，在两台物理服务器(源服务器和目标服务器)上可以使用该软件。一旦您深入了解了 vMotion 的技术细节(我们不会在这里介绍！)，但事实并非如此，永远不会出现从两台主机同时访问 Oracle 软件的情况，也不会出现目标和源虚拟机 vCPUs 都能够同时运行该软件的情况。作为一个用户，我只连接到一个实例--这里没有 2 倍的业务优势，没有负载平衡，这意味着提供了两倍的容量。同样，业务优势是 48 个内核，而不是 96 个。*

# ***审计***

*因此……按照上述逻辑进行许可在技术上和合同上都没有理由，但这种情况会继续发生，因为审核流程是由甲骨文或其合作伙伴(“JPE”)([link](https://www.linkedin.com/pulse/why-tightrope-walker-makes-best-oracle-license-brian-lavelle/))合作伙伴承担的。他们要求运行的脚本只是收集 VMware 主机的全套**(包括处理器配置):这并不反映大部分“已安装”内核的偶然性。***

***在审计场景中，客户需要向 Oracle 提供合理的协助，但这应仅包括资产的相关元素，而不一定是供应商脚本/数据收集流程所要求的。***

****这里有一个例子:你****也有权决定什么是合理的******

*****和*****

******甲骨文知道你的财产的一切，包括甲骨文永远不会运行的服务器，这合理吗？******

*****即使对于选择通过根据工作负载的特征对工作负载进行隔离或分组(集群、主机关联性等)来实施良好的资产管理，或者确保收集日志来证明虚拟机的历史放置情况的客户，Oracle 也不会接受这种降低许可证要求的善意措施。*****

*****对于客户和被审计的人来说，这种情况太常见了；这给许多不知情的被许可方带来了痛苦(和重大的许可索赔)。因此，有时可以主动或“事后”让 Oracle 指定某些“批准的”机制来限制许可证要求，这构成了一种阻碍 vMotion 工作负载能力的手段；特别是使用网络和磁盘隔离。Oracle 保留“批准”(或不批准)您为限制工作负载迁移而实施的某些机制的权利，并且通常希望提交一组架构和技术细节以获得他们的批准，这可能需要一些时间。*****

*****此外，还可以将扩展的特定语言放入合同中，以概述基于上述隔离机制的许可基础。*****

*****实际上，获得 Oracle 的这种批准并不容易，而且会给网络和存储管理员增加相当大的开销。此外，这种类型的隔离对于数据库/应用服务器技术来说是有意义的，但是，对于部署了 Oracle Java 的工作负载来说却很难做到这一点，因为这些工作负载本质上普遍存在于许多领域中，并且通常不会被隔离。*****

# *****选择*****

*****考虑到所有这些，可以为客户考虑几个备选方案(注意，我们在这里将一个复杂的主题总结成一个简单的列表！):*****

*****1)遵循 VMware 政策并遵守未公布的非合同规则*****

*****2)联系 Oracle 授权您的磁盘和网络隔离，管理工作负载以确保它们仅驻留在此类环境中*****

*****3)在不求助于 Oracle 的情况下实施磁盘和网络隔离，这需要在审计时获得后续批准*****

*****4)在审核时，仅发布安装和/或运行 Oracle 软件的 ESX 服务器的必要数据:即安装了 Oracle 软件的虚拟机所在的位置*****

*****5)利用替代虚拟化技术:尽管如此，您仍然需要接受上述评估*****

# *******总结*******

*****我们看到这些选项中的每一个都在全球客户中使用——需要仔细考虑以了解其复杂性、风险、成本和收益。您应该确保在选定一个选项之前，熟悉合同的每个方面以及甲骨文可能的回应。此外，贵公司的所有相关方必须了解您采用的政策以及这将如何影响您的许可。*****

*****最后，请记住:技术产品的许可费应该基于你从中获得的价值:即与许可产品给你带来的利益成比例的费用。*****

> ******任何对 Oracle 应用的 VMware 政策的合理看法都会质疑一台* ***潜在*** *主机如何为您带来价值******

*****这一政策的长期存在意味着它已经被接受，并且通常不会受到质疑:这使得企业远离或完全避免 VMware 所能提供的优势。*****

*****还要记住**您是在向 VMware 支付许可费**来获得 vMotion 工作负载迁移的能力。使用 VMware，Oracle 产品，实际上还有许多其他供应商的产品，以透明和受控的方式进行迁移，不依赖于任何 Oracle/产品供应商的输入或集成。*****

*****正如开始时提到的，这是一个有许多微妙之处的复杂主题，如果选择了错误的方法，看起来肯定会优化许可和处理成本的方法可能会导致意想不到的许可责任。*****

*****我们拥有与客户和 Oracle 合作的丰富经验，能够为前者实现潜在的成本节约，并确保后者的许可证合规性。如果您对虚拟化或任何其他 Oracle 许可主题有任何疑问，请随时联系 [**me**](https://www.linkedin.com/in/paulbullen/) 或 [**与我们**](https://www.version1.com/it-service/software-asset-management/oracle-license-optimisation/) 交谈。*****

*******关于作者** Paul Bullen 是第 1 版的首席 Oracle 许可顾问&实践主管。*****