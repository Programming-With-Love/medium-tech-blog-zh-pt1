<html>
<head>
<title>Microservices service discovery on Oracle Cloud with Spring Cloud and Zookeeper</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于Spring Cloud和Zookeeper的Oracle Cloud微服务服务发现</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/microservices-service-discovery-on-oracle-cloud-with-spring-cloud-and-zookeeper-627e6bb59ea2?source=collection_archive---------5-----------------------#2018-01-16">https://medium.com/oracledevs/microservices-service-discovery-on-oracle-cloud-with-spring-cloud-and-zookeeper-627e6bb59ea2?source=collection_archive---------5-----------------------#2018-01-16</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><blockquote class="ie if ig"><p id="dc50" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated">有关微服务主题的博客帖子的主目录，请参考—<a class="ae jg" rel="noopener" href="/oracledevs/bunch-of-microservices-related-blogs-57b5f1f062e5">https://medium . com/Oracle devs/bunch-of-microservice-related-blogs-57 b5 f1f 062 e 5</a></p></blockquote><p id="a5a2" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">本博客借助基于Oracle云构建的示例应用程序演示了以下技术(通常用于微服务)</p><ul class=""><li id="c2a2" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated">服务<em class="ij">注册表</em>和<em class="ij">发现</em></li><li id="7a05" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated"><em class="ij">同步</em>服务间<em class="ij">通信</em>(基于REST)与<em class="ij">客户端负载均衡</em></li></ul><p id="52e4" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">无论是单片还是微服务，应用程序很少孤立工作。他们需要与其他服务协作来满足业务需求。为此，从属服务需要知道其他服务的坐标，即主机和端口详细信息(大多数情况下)</p><p id="a57f" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">静态配置是最简单的选项(如属性文件、环境变量等)。)但是它不能很好地适应分布式的、基于云的架构，因为由于这些服务的<em class="ij">弹性</em> &amp; <em class="ij">短暂</em>的本质，坐标不是固定的/可预测的</p><p id="36fe" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">出现了许多问题，但这里有一些常见的/明显的</p><ul class=""><li id="227c" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated">系统停机时间:更改服务URIs以计入添加/删除的实例</li><li id="2ea4" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">复杂性:有多个这样的服务(和依赖项)需要处理。</li></ul><p id="1fa6" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">解决这些问题的一个广泛使用的模式/解决方案是<em class="ij">服务注册</em>和<em class="ij">发现</em></p><ul class=""><li id="9ef1" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated">服务注册中心:应用程序向这个集中的注册中心注册，它们的生命周期(取消注册等)也受到管理</li><li id="e911" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated"><strong class="ik hi">服务发现</strong>:依赖的应用程序(客户端应用程序)查询注册表，以获得它们想要调用的服务的实例</li></ul></div><div class="ab cl jy jz go ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ha hb hc hd he"><p id="266f" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">博客中的示例应用程序使用了流行的<a class="ae jg" href="http://projects.spring.io/spring-cloud/" rel="noopener ugc nofollow" target="_blank">春云</a>伞中的项目，具体来说就是<a class="ae jg" href="https://cloud.spring.io/spring-cloud-netflix/" rel="noopener ugc nofollow" target="_blank">春云网飞</a></p><ul class=""><li id="5300" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated"><strong class="ik hi">动物园管理员— </strong>中央<em class="ij">服务注册中心</em>组件</li><li id="49bc" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated"><strong class="ik hi">网飞假装</strong>——用于<em class="ij">同步服务间通信</em> (RPC)的声明式REST客户端，它是</li><li id="52dc" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">通过Spring Cloud注解进一步丰富激活<strong class="ik hi"> Ribbon </strong>客户端(另一个网飞项目)。这使得无缝<em class="ij">服务发现</em>以及<em class="ij">客户端负载平衡</em>成为可能</li><li id="db52" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">有几个(微)服务(简单的<strong class="ik hi"> Spring Boot </strong>应用程序)来演示服务发现</li></ul><blockquote class="ie if ig"><p id="8161" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated">Spring Boot应用运行在Oracle应用容器云上，Oracle应用容器云是一种云原生的多语言aPaaS(应用平台即服务)</p></blockquote><div class="kf kg ez fb kh ki"><a href="https://cloud.oracle.com/application-container-cloud" rel="noopener  ugc nofollow" target="_blank"><div class="kj ab dw"><div class="kk ab kl cl cj km"><h2 class="bd hi fi z dy kn ea eb ko ed ef hg bi translated">应用容器云| ACC | Oracle云</h2><div class="kp l"><h3 class="bd b fi z dy kn ea eb ko ed ef dx translated">云中的Java标准版和Node.js。</h3></div><div class="kq l"><p class="bd b fp z dy kn ea eb ko ed ef dx translated">cloud.oracle.com</p></div></div><div class="kr l"><div class="ks l kt ku kv kr kw kx ki"/></div></div></a></div></div><div class="ab cl jy jz go ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ha hb hc hd he"><h1 id="bcb0" class="ky kz hh bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">架构和解决方案深度探讨</h1><blockquote class="ie if ig"><p id="0d27" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated"><em class="hh">Github上有示例应用</em></p></blockquote><div class="kf kg ez fb kh ki"><a href="https://github.com/abhirockzz/accs-microservices-service-discovery" rel="noopener  ugc nofollow" target="_blank"><div class="kj ab dw"><div class="kk ab kl cl cj km"><h2 class="bd hi fi z dy kn ea eb ko ed ef hg bi translated">abhirockzz/accs-微服务-服务-发现</h2><div class="kp l"><h3 class="bd b fi z dy kn ea eb ko ed ef dx translated">通过在GitHub上创建帐户，为accs-微服务-服务发现开发做出贡献。</h3></div><div class="kq l"><p class="bd b fp z dy kn ea eb ko ed ef dx translated">github.com</p></div></div><div class="kr l"><div class="lw l kt ku kv kr kw kx ki"/></div></div></a></div><p id="dd62" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">这是一个高级图表</p><figure class="ly lz ma mb fd mc er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es lx"><img src="../Images/f65893cfa5fc761897a2907a1a8ea84d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y6By8Mr-1xUuCaR13Q_WZA.jpeg"/></div></div></figure><ul class=""><li id="0eb5" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated">库存服务向Zookeeper注册</li><li id="32ab" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">产品服务从Zookeeper获取库存服务坐标</li><li id="283b" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">所有通信都通过内部/私有覆盖网络进行，即所有应用都使用<code class="du mi mj mk ml b">manifest.json</code>中的<code class="du mi mj mk ml b">“isClustered” : “true”</code>设置</li></ul><blockquote class="ie if ig"><p id="429b" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated">在<a class="ae jg" href="https://docs.oracle.com/en/cloud/paas/app-container-cloud/dvcjv/preparing-clustered-application-deployment.html" rel="noopener ugc nofollow" target="_blank">文档</a> — TL中有更多关于“集群”魔法的细节；灾难恢复是指它为应用程序之间的内部通信建立一个专用网络</p></blockquote><h2 id="9d99" class="mm kz hh bd la mn mo mp le mq mr ms li jh mt mu lm ji mv mw lq jj mx my lu mz bi translated">库存</h2><p id="e295" class="pw-post-body-paragraph ih ii hh ik b il na in io ip nb ir is jh nc iv iw ji nd iz ja jj ne jd je jf ha bi translated">如上所述，这是一个普通的Spring Boot web应用程序(<code class="du mi mj mk ml b">@RestController</code>)，它公开了一个REST端点来获取商品的库存/存货(<em class="ij">)这个实现本身有点做作，但它足够简单来演示这个概念</em></p><p id="038f" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">以下是这项服务最重要的几点</p><ul class=""><li id="69ec" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated">确保它自动向Zookeeper注册</li><li id="7a4a" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">这是一个<strong class="ik hi"> Worker </strong>应用程序，也就是说，它没有公共URL。这是一个<em class="ij">内部</em>服务，只需要被其他(可能是面向公众的)应用程序访问</li></ul><blockquote class="ie if ig"><p id="b714" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated">这里是一个关于工人应用的介绍性博客</p></blockquote><ul class=""><li id="4f26" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated">它使用一个定制的<code class="du mi mj mk ml b">ZookeeperDiscoveryProperties</code> bean来配置与Zookeeper的交互</li><li id="7a15" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">该服务被配置为<a class="ae jg" href="https://github.com/abhirockzz/accs-microservices-service-discovery/blob/master/inventory/src/main/java/com/oracle/cloud/accs/inventory/InventoryApplication.java#L35" rel="noopener ugc nofollow" target="_blank">向Zookeeper通告其IP地址</a>，并使用应用程序名称(在本例中为其<code class="du mi mj mk ml b">InventoryService</code>)获取IP信息</li></ul><pre class="ly lz ma mb fd nf ml ng nh aw ni bi"><span id="3fec" class="mm kz hh ml b fi nj nk l nl nm">InetAddress <strong class="ml hi">inetAddress </strong>= Address.getByName( System.getenv(“<strong class="ml hi">ORA_APP_NAME</strong>”));</span><span id="fdb5" class="mm kz hh ml b fi nn nk l nl nm"><strong class="ml hi">hostIP </strong>= inetAddress.getHostAddress();</span></pre><h2 id="424f" class="mm kz hh bd la mn mo mp le mq mr ms li jh mt mu lm ji mv mw lq jj mx my lu mz bi translated">产品</h2><p id="02e7" class="pw-post-body-paragraph ih ii hh ik b il na in io ip nb ir is jh nc iv iw ji nd iz ja jj ne jd je jf ha bi translated">这是另一个Spring Boot网络应用程序。它充当库存服务的客户端</p><ul class=""><li id="23e8" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated">使用一个<code class="du mi mj mk ml b"><a class="ae jg" href="https://github.com/abhirockzz/accs-microservices-service-discovery/blob/master/product/src/main/java/com/oracle/cloud/product/InventoryClient.java" rel="noopener ugc nofollow" target="_blank">@FeignClient</a></code> <a class="ae jg" href="https://github.com/abhirockzz/accs-microservices-service-discovery/blob/master/product/src/main/java/com/oracle/cloud/product/InventoryClient.java" rel="noopener ugc nofollow" target="_blank">带注释的接口</a>，它定义了库存服务REST端点的接口</li><li id="e976" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">使用<code class="du mi mj mk ml b">@EnableFeignClients</code>来激活基于Ribbon的特性，该特性自动使feign客户端能够从Zookeeper中发现应用实例(基于名称),并在所有实例之间平衡调用负载</li></ul><h2 id="08d5" class="mm kz hh bd la mn mo mp le mq mr ms li jh mt mu lm ji mv mw lq jj mx my lu mz bi translated">动物园管理员</h2><p id="e9cc" class="pw-post-body-paragraph ih ii hh ik b il na in io ip nb ir is jh nc iv iw ji nd iz ja jj ne jd je jf ha bi translated">如上所述，Zookeeper是中央服务注册中心，作为一个独立的基础设施组件部署，可以从运行在应用程序容器云上的上述服务中访问</p></div><div class="ab cl jy jz go ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ha hb hc hd he"><h1 id="d779" class="ky kz hh bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">构建和部署</h1><p id="1baf" class="pw-post-body-paragraph ih ii hh ik b il na in io ip nb ir is jh nc iv iw ji nd iz ja jj ne jd je jf ha bi translated">首先从Github获取项目— <code class="du mi mj mk ml b">git clone <a class="ae jg" href="https://github.com/abhirockzz/accs-microservices-service-discovery" rel="noopener ugc nofollow" target="_blank">https://github.com/abhirockzz/accs-microservices-service-discovery</a></code></p><h2 id="ac47" class="mm kz hh bd la mn mo mp le mq mr ms li jh mt mu lm ji mv mw lq jj mx my lu mz bi translated">建设</h2><p id="9de9" class="pw-post-body-paragraph ih ii hh ik b il na in io ip nb ir is jh nc iv iw ji nd iz ja jj ne jd je jf ha bi translated"><strong class="ik hi">库存服务</strong></p><ul class=""><li id="a8d4" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated"><code class="du mi mj mk ml b">cd inventory</code></li><li id="547e" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated"><code class="du mi mj mk ml b">mvn clean install</code></li></ul><p id="c596" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">构建过程将在<code class="du mi mj mk ml b">target </code>目录中创建<code class="du mi mj mk ml b">inventory-dist.zip</code></p><p id="6367" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated"><strong class="ik hi">产品服务</strong></p><ul class=""><li id="ec4a" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated"><code class="du mi mj mk ml b">cd product</code></li><li id="9545" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated"><code class="du mi mj mk ml b">mvn clean install</code></li></ul><p id="4dce" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">构建过程将在<code class="du mi mj mk ml b">target </code>目录中创建<code class="du mi mj mk ml b">product-dist.zip</code></p><h2 id="c86b" class="mm kz hh bd la mn mo mp le mq mr ms li jh mt mu lm ji mv mw lq jj mx my lu mz bi translated">部署也称为向云推进</h2><p id="2f1d" class="pw-post-body-paragraph ih ii hh ik b il na in io ip nb ir is jh nc iv iw ji nd iz ja jj ne jd je jf ha bi translated">借助Oracle Application Container Cloud，您在部署应用程序方面有多种选择。本博客将利用<strong class="ik hi"> PSM CLI </strong>，这是一个用于管理Oracle云服务的强大命令行界面</p><blockquote class="ie if ig"><p id="4b77" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated">其他部署选项包括<a class="ae jg" href="https://docs.oracle.com/en/cloud/paas/app-container-cloud/apcsr/index.html" rel="noopener ugc nofollow" target="_blank"> REST API </a>、<a class="ae jg" href="https://docs.oracle.com/en/cloud/paas/developer-cloud/csdcs/deploying-application-oracle-developer-cloud-service.html#GUID-6FE6D850-65DC-471D-A249-F7CCA9CAB56F" rel="noopener ugc nofollow" target="_blank"> Oracle开发者云</a>，当然还有<a class="ae jg" href="https://docs.oracle.com/en/cloud/paas/app-container-cloud/csjse/creating-application.html" rel="noopener ugc nofollow" target="_blank">控制台/UI </a></p></blockquote><p id="89eb" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">您可以在您的机器上下载并设置PSM CLI(使用<code class="du mi mj mk ml b">psm setup</code> ) — <a class="ae jg" href="https://docs.oracle.com/en/cloud/paas/java-cloud/pscli/using-command-line-interface-1.html" rel="noopener ugc nofollow" target="_blank">详情请点击</a></p><p id="5d0f" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">部署这两个应用程序</p><blockquote class="ie if ig"><p id="d1c3" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated">一旦执行，异步进程就会启动，CLI会返回其作业ID，以便您跟踪应用程序的创建</p></blockquote><p id="326a" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">在开始部署服务之前，您需要确保</p><ul class=""><li id="ccd0" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated">您已经运行了Zookeeper，并且可以从Oracle应用程序容器云中访问它</li><li id="3b93" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">更新<code class="du mi mj mk ml b">deployment.json</code>(用于两个应用程序)以输入动物园管理员信息</li></ul><pre class="ly lz ma mb fd nf ml ng nh aw ni bi"><span id="dca5" class="mm kz hh ml b fi nj nk l nl nm">{<br/> “memory”: “2G”,<br/> “instances”: 1,<br/> “environment”: {<br/> “ZOOKEEPER”: “&lt;as per your setup&gt;”<br/> }<br/>}</span></pre><ul class=""><li id="d7b2" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated"><strong class="ik hi">库存服务</strong>——<code class="du mi mj mk ml b">psm accs push -n InventoryService -r java -s hourly -m manifest.json -d deployment.json -p target/inventory-dist.zip</code></li><li id="41a8" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated"><strong class="ik hi">产品服务</strong> — <code class="du mi mj mk ml b"> psm accs push -n ProductService -r java -s hourly -m manifest.json -d deployment.json -p target/product-dist.zip</code></li></ul><p id="462c" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">您应该在应用程序容器云应用程序页面上看到这两种服务</p><figure class="ly lz ma mb fd mc er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es no"><img src="../Images/19e8ea364f6d579f607bf9397f935f84.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wd2INYZu7NQobjhy2-G2vA.png"/></div></div><figcaption class="np nq et er es nr ns bd b be z dx">Spring Boot apps deployed to App Container Cloud</figcaption></figure><h2 id="a466" class="mm kz hh bd la mn mo mp le mq mr ms li jh mt mu lm ji mv mw lq jj mx my lu mz bi translated">确认服务注册</h2><p id="27a4" class="pw-post-body-paragraph ih ii hh ik b il na in io ip nb ir is jh nc iv iw ji nd iz ja jj ne jd je jf ha bi translated">在我们继续之前，让我们检查Zookeeper以确认库存和产品服务已经注册，并查看相关的细节</p><blockquote class="ie if ig"><p id="2100" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated">你可以从这里下载<a class="ae jg" href="https://zookeeper.apache.org/releases.html" rel="noopener ugc nofollow" target="_blank">Zookeeper</a>然后使用它的CLI — <code class="du mi mj mk ml b">bin/zkCli.cmd</code></p></blockquote><p id="55db" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">默认情况下，信息存储在<code class="du mi mj mk ml b">/services</code>路径中— <code class="du mi mj mk ml b">ls /services</code>将显示两个服务确实都已注册</p><figure class="ly lz ma mb fd mc er es paragraph-image"><div class="er es nt"><img src="../Images/78f20f94281a455c8a9e19004fa47030.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/1*Sb5myvW2zFDXBQ4moHNirA.png"/></div><figcaption class="np nq et er es nr ns bd b be z dx">ACCS service registration in Zookeeper</figcaption></figure><p id="05df" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">让我们来看看库存服务的细节，因为这是最终将由产品服务<em class="ij">发现</em>(并<em class="ij">调用</em>)的细节——使用<code class="du mi mj mk ml b">ls /services/InventoryService</code>进一步深入库存服务，您将看到一个唯一的实例已经被注册</p><figure class="ly lz ma mb fd mc er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es nu"><img src="../Images/ce9acaabf5fce58cf4e06717c5466362.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y_Ll5Uabd0BFTcOUyoxBbg.png"/></div></div><figcaption class="np nq et er es nr ns bd b be z dx">ACCS Inventory service instance in Zookeeper</figcaption></figure><blockquote class="ie if ig"><p id="d640" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated">使用应用程序名称(通过<code class="du mi mj mk ml b"><em class="hh">ORA_APP_NAME </em></code>环境变量获得)和应用程序容器云中的运行时(Docker)容器名称(<code class="du mi mj mk ml b"><em class="hh">APAAS_CONTAINER_NAME </em></code>变量)的组合格式来创建唯一实例ID</p></blockquote><p id="58b9" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">我们可以获取已经注册的确切信息— <code class="du mi mj mk ml b">get /services/InventoryService/&lt;instance_id&gt;</code></p><figure class="ly lz ma mb fd mc er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es nv"><img src="../Images/27a9814a9e5350949dd59ab683763bf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pwDOstfzXSMTC41h6uqAsw.png"/></div></div><figcaption class="np nq et er es nr ns bd b be z dx">Instance information in Zookeeper</figcaption></figure><p id="71df" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">JSON代码片段(从上面的代码片段裁剪而来)包含所需的信息——我们特别感兴趣的是主机(IP)和端口。这里是JSON有效负载供您参考(<em class="ij">注意突出显示的部分</em>)</p><figure class="ly lz ma mb fd mc er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es nw"><img src="../Images/e92524aab8e1d155ac1e21d42b7bea07.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oOIEJrAjppQoPaSmCWBNZQ.png"/></div></div><figcaption class="np nq et er es nr ns bd b be z dx">Service registration (JSON) payload</figcaption></figure><blockquote class="ie if ig"><p id="79d2" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated">另一件需要注意的重要事情是<code class="du mi mj mk ml b">address </code>的值(在本例中为10 . 44 . 0 . 1)—它是库存服务的内部IP。因为我们已经配置了服务之间的私有覆盖网络通信，所以产品服务将能够使用这个IP来调用库存服务</p></blockquote></div><div class="ab cl jy jz go ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ha hb hc hd he"><h1 id="6247" class="ky kz hh bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">试车</h1><p id="381e" class="pw-post-body-paragraph ih ii hh ik b il na in io ip nb ir is jh nc iv iw ji nd iz ja jj ne jd je jf ha bi translated">好了，一切都准备好了——我们现在可以开始玩了</p><h2 id="2d01" class="mm kz hh bd la mn mo mp le mq mr ms li jh mt mu lm ji mv mw lq jj mx my lu mz bi translated">健全测验</h2><p id="d1e7" class="pw-post-body-paragraph ih ii hh ik b il na in io ip nb ir is jh nc iv iw ji nd iz ja jj ne jd je jf ha bi translated">让我们通过调用产品服务端点从一个简单的测试开始</p><p id="adb2" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">例如<code class="du mi mj mk ml b">curl -X <a class="ae jg" href="https://ProductService-ocloud100.apaas.us2.oraclecloud.com/product/iphone2" rel="noopener ugc nofollow" target="_blank">https://ProductService-ocloud100.apaas.us2.oraclecloud.com/product/iPhone</a>X</code></p><p id="abac" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">您应该会得到一个JSON响应。请注意<code class="du mi mj mk ml b">node</code>属性(有点奇怪),它是为了显示哪个应用程序实例(容器)处理了请求而特意添加的<em class="ij">——每次调用服务时，您都会得到不同的(随机生成的)库存计数</em></p><blockquote class="ie if ig"><p id="1af4" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated">如果您仔细观察，您应该会注意到,<code class="du mi mj mk ml b">node </code>属性的值实际上是Zookeeper中库存服务的服务实例ID的一部分(请参考上图再次检查这一点)</p></blockquote><figure class="ly lz ma mb fd mc er es paragraph-image"><div class="er es nx"><img src="../Images/7fea282ed676c83bede789c88be1c489.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*VkEtz1reDalbvR6v33LOQw.png"/></div><figcaption class="np nq et er es nr ns bd b be z dx">Product service response</figcaption></figure><h2 id="b666" class="mm kz hh bd la mn mo mp le mq mr ms li jh mt mu lm ji mv mw lq jj mx my lu mz bi translated">超过尺寸范围</h2><p id="e2ca" class="pw-post-body-paragraph ih ii hh ik b il na in io ip nb ir is jh nc iv iw ji nd iz ja jj ne jd je jf ha bi translated">让我们将我们的库存服务提升到两个实例，然后再看看整个流程(<em class="ij">服务注册、服务发现和客户端负载平衡</em>)是如何进行的——这一次使用了目标服务的多个实例</p><figure class="ly lz ma mb fd mc er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es ny"><img src="../Images/ff93ff78c63c0acfaf0e7de8027ff19c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dj4G-ZJlmyWZjTsDr7UEeA.png"/></div></div><figcaption class="np nq et er es nr ns bd b be z dx">Scale out the Inventory service</figcaption></figure><p id="db36" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">让我们再检查一下动物园管理员— <code class="du mi mj mk ml b">ls /services/InventoryService</code></p><figure class="ly lz ma mb fd mc er es paragraph-image"><div role="button" tabindex="0" class="md me di mf bf mg"><div class="er es nz"><img src="../Images/d12fdede0b59427ede9afdca0f51bb9a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e_dvKm6XliopuhhrnoNp-A.png"/></div></div><figcaption class="np nq et er es nr ns bd b be z dx">New ACCS app instance added to Zookeeper service registry</figcaption></figure><p id="fc97" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">请注意，由于向外扩展，我们刚刚添加了额外的/新的实例(ID被裁剪)</p><p id="977d" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">现在我们可以再次访问产品服务(几次)，例如<code class="du mi mj mk ml b">curl -X <a class="ae jg" href="https://ProductService-ocloud100.apaas.us2.oraclecloud.com/product/iphone2" rel="noopener ugc nofollow" target="_blank">https://ProductService-ocloud100.apaas.us2.oraclecloud.com/product/</a>motoZ</code></p><figure class="ly lz ma mb fd mc er es paragraph-image"><div class="er es oa"><img src="../Images/b937b484c576dbf0e742753348fcab0f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*sMX2u1MdlO1JIqJVPHtmQg.png"/></div><figcaption class="np nq et er es nr ns bd b be z dx">Response from Product service</figcaption></figure><p id="a850" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">再次注意突出显示的部分——<code class="du mi mj mk ml b">node </code>属性的值指向我们生成的新实例(gt在Zookeeper中注册了该实例)。如果您一直调用产品服务，您将会看到它在库存服务的两个实例之间保持平衡</p><h2 id="4db1" class="mm kz hh bd la mn mo mp le mq mr ms li jh mt mu lm ji mv mw lq jj mx my lu mz bi translated">按比例减少</h2><p id="e2b3" class="pw-post-body-paragraph ih ii hh ik b il na in io ip nb ir is jh nc iv iw ji nd iz ja jj ne jd je jf ha bi translated">一旦你缩小了库存服务应用程序，你将在Zookeeper中留下一个条目</p><h1 id="3f64" class="ky kz hh bd la lb ob ld le lf oc lh li lj od ll lm ln oe lp lq lr of lt lu lv bi translated">快速回顾</h1><ul class=""><li id="9547" class="jk jl hh ik b il na ip nb jh og ji oh jj oi jf jp jq jr js bi translated">我们部署了几个Spring Boot应用程序，它们将自己注册到Zookeeper — <strong class="ik hi">服务注册表</strong>中</li><li id="20aa" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">当产品服务能够通过从Zookeeper中计算出其坐标来调用库存服务时，我们能够看到<strong class="ik hi">服务发现</strong>在起作用</li><li id="7e40" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">来自产品服务的调用在库存服务的多个实例之间进行了负载平衡</li></ul></div><div class="ab cl jy jz go ka" role="separator"><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd ke"/><span class="kb bw bk kc kd"/></div><div class="ha hb hc hd he"><h1 id="14b8" class="ky kz hh bd la lb lc ld le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv bi translated">其他注意事项</h1><p id="01aa" class="pw-post-body-paragraph ih ii hh ik b il na in io ip nb ir is jh nc iv iw ji nd iz ja jj ne jd je jf ha bi translated">这些没有在这个博客中涉及，但是值得一提</p><ul class=""><li id="03b8" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated">多语言支持——Spring Cloud Zookeeper仅限于Java应用程序(如果不是只有Spring的话)。通常，多语言支持是通过sidecar(通常基于REST)或特定于语言的绑定获得的</li><li id="5d35" class="jk jl hh ik b il jt ip ju jh jv ji jw jj jx jf jp jq jr js bi translated">Spring Cloud还支持其他服务发现后端，如Consul、网飞尤里卡等。</li></ul><p id="d2bb" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">好了，这篇博文到此为止！</p><h1 id="47dd" class="ky kz hh bd la lb ob ld le lf oc lh li lj od ll lm ln oe lp lq lr of lt lu lv bi translated">不要忘记…</h1><ul class=""><li id="42ff" class="jk jl hh ik b il na ip nb jh og ji oh jj oi jf jp jq jr js bi translated">查看Oracle Application Container Cloud教程—每个运行时都有适合的内容！</li></ul><div class="kf kg ez fb kh ki"><a href="https://docs.oracle.com/en/cloud/paas/app-container-cloud/create-first-applications.html" rel="noopener  ugc nofollow" target="_blank"><div class="kj ab dw"><div class="kk ab kl cl cj km"><h2 class="bd hi fi z dy kn ea eb ko ed ef hg bi translated">Oracle应用容器云服务—创建您的第一批应用</h2><div class="kp l"><h3 class="bd b fi z dy kn ea eb ko ed ef dx translated">Oracle应用容器云服务教程。学习创建你的第一个应用程序。</h3></div><div class="kq l"><p class="bd b fp z dy kn ea eb ko ed ef dx translated">docs.oracle.com</p></div></div></div></a></div><ul class=""><li id="fea7" class="jk jl hh ik b il im ip iq jh jm ji jn jj jo jf jp jq jr js bi translated">关于应用容器云的其他博客</li></ul><div class="kf kg ez fb kh ki"><a rel="noopener follow" target="_blank" href="/tag/app-container-cloud/latest"><div class="kj ab dw"><div class="kk ab kl cl cj km"><h2 class="bd hi fi z dy kn ea eb ko ed ef hg bi translated">关于应用容器云的最新故事和新闻—中型</h2><div class="kp l"><h3 class="bd b fi z dy kn ea eb ko ed ef dx translated">阅读关于应用容器云的最新文章。每天，成千上万的声音阅读、书写和分享重要的…</h3></div><div class="kq l"><p class="bd b fp z dy kn ea eb ko ed ef dx translated">medium.com</p></div></div><div class="kr l"><div class="oj l kt ku kv kr kw kx ki"/></div></div></a></div><p id="fe33" class="pw-post-body-paragraph ih ii hh ik b il im in io ip iq ir is jh iu iv iw ji iy iz ja jj jc jd je jf ha bi translated">干杯！</p><blockquote class="ie if ig"><p id="91d2" class="ih ii ij ik b il im in io ip iq ir is it iu iv iw ix iy iz ja jb jc jd je jf ha bi translated">本文表达的观点是我个人的观点，不一定代表甲骨文的观点。</p></blockquote></div></div>    
</body>
</html>