<html>
<head>
<title>Navigation: Nested graphs and include tag</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">导航:嵌套图形和包含标签</h1>
<blockquote>原文：<a href="https://medium.com/androiddevelopers/navigation-nested-graphs-and-include-tag-92fd62739b73?source=collection_archive---------3-----------------------#2021-05-10">https://medium.com/androiddevelopers/navigation-nested-graphs-and-include-tag-92fd62739b73?source=collection_archive---------3-----------------------#2021-05-10</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><figure class="hg hh ez fb hi hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es hf"><img src="../Images/791201c44c9a597711d7ea5690bae9e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aMhXsBRVNVdLePMq"/></div></div></figure><div class=""/><p id="5e10" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这是第二个导航系列的第三篇文章。如果你更喜欢看这些内容而不是阅读，看看下面的视频:</p><figure class="jn jo jp jq fd hj"><div class="bz dy l di"><div class="jr js l"/></div></figure><h1 id="341c" class="jt ju hs bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">介绍</h1><p id="e629" class="pw-post-body-paragraph ip iq hs ir b is kr iu iv iw ks iy iz ja kt jc jd je ku jg jh ji kv jk jl jm ha bi translated">在本系列的前几篇文章中，我们添加了coffee tracker功能，增强了导航UI的用户体验，并实现了条件导航。这次我们将看到如何通过使用嵌套图和使用include标签导入其他图来组织导航图。这将允许我们模块化应用程序，并查看导航如何与模块一起工作。<br/>现在启动Android Studio，看看如何使用导航模块。</p><h1 id="7ab6" class="jt ju hs bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">嵌套导航图</h1><p id="2695" class="pw-post-body-paragraph ip iq hs ir b is kr iu iv iw ks iy iz ja kt jc jd je ku jg jh ji kv jk jl jm ha bi translated">让我们从导航图开始。嵌套图可以帮助您在父导航图中对一系列目的地进行分组。<br/>查看导航图，coffeeList和coffeeEntryDialog目的地是转换成嵌套图的好选择。为此，我按住shift键选择两个片段，并选择move to nested graph。</p><figure class="jn jo jp jq fd hj er es paragraph-image"><div class="er es kw"><img src="../Images/04fc220efe2150d0d517ebeef061e299.png" data-original-src="https://miro.medium.com/v2/resize:fit:1078/format:webp/1*50vplH8VU9i4jrh-9jSn8w.png"/></div><figcaption class="kx ky et er es kz la bd b be z dx">Move coffeeList and coffeeEntryDialogFragment to a nested graph</figcaption></figure><p id="ce53" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，切换到代码视图，您可以看到嵌套图只是根图中的一个新的导航图。</p><pre class="jn jo jp jq fd lb lc ld le aw lf bi"><span id="8718" class="lg ju hs lc b fi lh li l lj lk">&lt;navigation xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"<br/>    xmlns:tools="http://schemas.android.com/tools"<br/>    app:startDestination="@id/donutList"&gt;<br/><br/>    &lt;fragment<br/>        android:id="@+id/donutList"<br/>        android:name="com.android.samples.donuttracker.donut.DonutList"<br/>        android:label="@string/donut_list" &gt;<br/>        &lt;action<br/>            android:id="@+id/action_donutList_to_donutEntryDialogFragment"<br/>            app:destination="@id/donutEntryDialogFragment" /&gt;<br/>        &lt;action<br/>            android:id="@+id/action_donutList_to_selectionFragment"<br/>            app:destination="@id/selectionFragment" /&gt;<br/>    &lt;/fragment&gt;<br/>    &lt;dialog<br/>        android:id="@+id/donutEntryDialogFragment"<br/>        android:name="com.android.samples.donuttracker.donut.DonutEntryDialogFragment"<br/>        android:label="DonutEntryDialogFragment"&gt;<br/>        &lt;deepLink app:uri="myapp://navdonutcreator.com/donutcreator" /&gt;<br/>        &lt;argument<br/>            android:name="itemId"<br/>            app:argType="long"<br/>            android:defaultValue="-1L" /&gt;<br/>    &lt;/dialog&gt;<br/>    &lt;fragment<br/>        android:id="@+id/selectionFragment"<br/>        android:name="com.android.samples.donuttracker.setup.SelectionFragment"<br/>        android:label="@string/settings"<br/>        tools:layout="@layout/fragment_selection" &gt;<br/>        &lt;action<br/>            android:id="@+id/action_selectionFragment_to_donutList"<br/>            app:destination="@id/donutList" /&gt;<br/>    &lt;/fragment&gt;<br/><strong class="lc ht">    &lt;navigation<br/>        android:id="@+id/coffeeGraph"<br/>        app:startDestination="@id/coffeeList"&gt;<br/>        &lt;fragment<br/>            android:id="@+id/coffeeList"<br/>            android:name="com.android.samples.donuttracker.coffee.CoffeeList"<br/>            android:label="@string/coffee_list"&gt;<br/>            &lt;action<br/>                android:id="@+id/action_coffeeList_to_coffeeEntryDialogFragment"<br/>                app:destination="@id/coffeeEntryDialogFragment" /&gt;<br/>        &lt;/fragment&gt;<br/>        &lt;dialog<br/>            android:id="@+id/coffeeEntryDialogFragment"<br/>            android:name="com.android.samples.donuttracker.coffee.CoffeeEntryDialogFragment"<br/>            android:label="CoffeeEntryDialogFragment"&gt;<br/>            &lt;argument<br/>                android:name="itemId"<br/>                android:defaultValue="-1L"<br/>                app:argType="long" /&gt;<br/>        &lt;/dialog&gt;<br/>    &lt;/navigation&gt;</strong><br/>&lt;/navigation&gt;</span></pre><p id="21b9" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">所选片段之间的导航被移动到嵌套图中。<br/>嵌套图形必须有一个id。您可以使用此id创建操作来导航到嵌套图，但不能直接导航到其子目标。嵌套图有自己的开始目标，不会单独显示其子目标。</p><pre class="jn jo jp jq fd lb lc ld le aw lf bi"><span id="ad09" class="lg ju hs lc b fi lh li l lj lk">&lt;navigation<br/>    <strong class="lc ht">android:id="@+id/coffeeGraph"</strong><br/>    app:startDestination="@id/coffeeList"&gt;</span></pre><p id="e41b" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">如果您双击嵌套图，那么您可以看到嵌套的目的地和它们之间的动作。</p><h1 id="54be" class="jt ju hs bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">包括标签</h1><p id="6055" class="pw-post-body-paragraph ip iq hs ir b is kr iu iv iw ks iy iz ja kt jc jd je ku jg jh ji kv jk jl jm ha bi translated">除了使用嵌套图，我还可以将图提取到一个新的导航xml文件中。我创建了一个名为coffee_graph的新xml文件，并将嵌套图的内容移动到这个新文件中。</p><pre class="jn jo jp jq fd lb lc ld le aw lf bi"><span id="884d" class="lg ju hs lc b fi lh li l lj lk">&lt;navigation xmlns:android="http://schemas.android.com/apk/res/android"<br/>    xmlns:app="http://schemas.android.com/apk/res-auto"<br/>    xmlns:tools="http://schemas.android.com/tools"<br/>    android:id="@+id/coffeeGraph"<br/>    app:startDestination="@id/coffeeList"&gt;<br/>    &lt;fragment<br/>        android:id="@+id/coffeeList"<br/>        android:name="com.android.samples.donuttracker.coffee.CoffeeList"<br/>        android:label="@string/coffee_list"&gt;<br/>        &lt;action<br/>            android:id="@+id/action_coffeeList_to_coffeeEntryDialogFragment"<br/>            app:destination="@id/coffeeEntryDialogFragment" /&gt;<br/>    &lt;/fragment&gt;<br/>    &lt;dialog<br/>        android:id="@+id/coffeeEntryDialogFragment"<br/>        android:name="com.android.samples.donuttracker.coffee.CoffeeEntryDialogFragment"<br/>        android:label="CoffeeEntryDialogFragment"&gt;<br/>        &lt;argument<br/>            android:name="itemId"<br/>            android:defaultValue="-1L"<br/>            app:argType="long" /&gt;<br/>    &lt;/dialog&gt;<br/>&lt;/navigation&gt;</span></pre><p id="6f16" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我可以使用include标记将这个新图嵌套在另一个图中。使用include标签提供了与嵌套图形相同的功能，但是允许您使用来自其他模块或库的图形。</p><pre class="jn jo jp jq fd lb lc ld le aw lf bi"><span id="4ede" class="lg ju hs lc b fi lh li l lj lk">&lt;include app:graph="@navigation/coffee_graph"/&gt;</span></pre><p id="769f" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">与嵌套图类似，包含图不显示包含图中的目的地列表，这意味着我需要更新引用coffeeList的菜单id。</p><pre class="jn jo jp jq fd lb lc ld le aw lf bi"><span id="4e42" class="lg ju hs lc b fi lh li l lj lk">&lt;item<br/>    android:id="@id/coffeeGraph"<br/>    android:icon="@drawable/coffee_cup"<br/>    android:title="@string/coffee_name" /&gt;</span></pre><p id="502d" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我更新菜单以使用包含的图形的id。因为CoffeeList是包含图的startDestination，所以我可以使用图id来导航到这个图。如果你现在试用这个应用程序，一切都应该和以前一样正常。现在，咖啡追踪的导航图是独立的，这是模块化应用程序的好时机，看看导航如何与模块一起工作。<br/>如果你想跟进，你可以查看一下<a class="ae ll" href="https://github.com/google-developer-training/android-demos/tree/starter/DonutTracker/NestedGraphs_Include" rel="noopener ugc nofollow" target="_blank">这个回购</a>，里面有我到目前为止做的所有修改。<br/>我创建了两个新模块:核心和咖啡。我将所有常见的类(如Donut、Coffee、DAOs、Database和其他常见资源)移到核心模块中。<br/>接下来，我将coffee跟踪中使用的所有片段、视图模型和适配器类移动到coffee模块中。coffee tracking中使用的布局和其他资源也被移到这里，还有coffee_graph。</p><figure class="jn jo jp jq fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lm"><img src="../Images/edd32be48326a024e022de87101ba129.png" data-original-src="https://miro.medium.com/v2/resize:fit:712/format:webp/1*jWItBG79cGg-XTvcTwX4OQ.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">Existing classes and resources are moved to core and coffee modules</figcaption></figure><p id="9228" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">咖啡模块取决于核心模块。</p><pre class="jn jo jp jq fd lb lc ld le aw lf bi"><span id="5c9e" class="lg ju hs lc b fi lh li l lj lk">dependencies <strong class="lc ht">{<br/><br/>    </strong>implementation project(":core")<br/>    //...<br/>}</span></pre><p id="7f80" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">最后，在app模块中，添加咖啡和核心模块作为依赖。</p><pre class="jn jo jp jq fd lb lc ld le aw lf bi"><span id="bc58" class="lg ju hs lc b fi lh li l lj lk">dependencies <strong class="lc ht">{<br/>    </strong>implementation project(":coffee")<br/>    implementation project(":core")<br/>    //..</span><span id="c1ae" class="lg ju hs lc b fi ln li l lj lk">}</span></pre><p id="1525" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">请注意，导航图中没有任何变化；它不受这些变化的影响</p><figure class="jn jo jp jq fd hj er es paragraph-image"><div role="button" tabindex="0" class="hk hl di hm bf hn"><div class="er es lo"><img src="../Images/de39960eb3ac55072ce778d9dedb8749.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KpwOmgWdn9-nTLHcuQZXBA.png"/></div></div><figcaption class="kx ky et er es kz la bd b be z dx">No changes in the navigation graph</figcaption></figure><p id="19c5" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，如果我运行应用程序，一切都像以前一样工作，但使用模块代替！你可以在这里查看最终代码<a class="ae ll" href="https://github.com/google-developer-training/android-demos/tree/main/DonutTracker/NestedGraphs_Include" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="d269" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">随着这一变化，我将咖啡跟踪器模块及其导航流程与应用程序的其余部分分离开来，这意味着咖啡跟踪器模块可以独立于甜甜圈跟踪器使用。</p><h1 id="1eba" class="jt ju hs bd jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq bi translated">摘要</h1><p id="078c" class="pw-post-body-paragraph ip iq hs ir b is kr iu iv iw ks iy iz ja kt jc jd je ku jg jh ji kv jk jl jm ha bi translated">在本文中，我们已经看到了如何创建嵌套图，以及如何使用include标签来模块化donut tracker应用程序。</p><p id="9ce9" class="pw-post-body-paragraph ip iq hs ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在下一篇文章中，我们将更进一步，并学习如何使用功能模块导航。敬请期待！</p></div></div>    
</body>
</html>