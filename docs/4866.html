<html>
<head>
<title>Lambda mixup</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">λ混合</h1>
<blockquote>原文：<a href="https://blog.kotlin-academy.com/lambda-mixup-75a60696bdce?source=collection_archive---------1-----------------------#2018-10-15">https://blog.kotlin-academy.com/lambda-mixup-75a60696bdce?source=collection_archive---------1-----------------------#2018-10-15</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><figure class="im in gp gr io ip gh gi paragraph-image"><div role="button" tabindex="0" class="iq ir di is bf it"><div class="gh gi il"><img src="../Images/9ab7dd0e0957f881f8b7497aaf88001f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*qhC1hXzsTswCVSd2.jpg"/></div></div></figure><div class=""/><p id="7f8e" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">对于我们这些使用<a class="ae kt" href="https://www.sonarqube.org/" rel="noopener ugc nofollow" target="_blank"> SonarQube </a>在CI上检查代码的人来说，对Kotlin的官方支持最近终于到来，我们开始在我们的服务器上部署它的最新版本。但是，当我查看我们第一份报告中的警告并试图快速修复其中一些警告时，我遇到了一个关于我的lambdas的令人困惑的情况。</p><p id="6c53" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">假设你有一个函数<code class="fe ku kv kw kx b">foo</code>，它有两个参数，这两个参数都有默认值。它可能看起来像这样:</p><pre class="ky kz la lb gt lc kx ld le aw lf bi"><span id="4bce" class="lg lh iy kx b gy li lj l lk ll">fun foo(lambda1: () -&gt; Unit = {}, lambda2: () -&gt; Unit = {}) {<br/>    lambda1()<br/>    println("----")<br/>    lambda2()<br/>}</span></pre><p id="f450" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这个函数应该执行它的两个参数函数，并在它们之间打印一些破折号。例如，如果我们这样称呼它:</p><pre class="ky kz la lb gt lc kx ld le aw lf bi"><span id="3dc3" class="lg lh iy kx b gy li lj l lk ll">foo({ println("1") }, { println("2") })</span></pre><p id="a6a7" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">结果应该是:</p><pre class="ky kz la lb gt lc kx ld le aw lf bi"><span id="d23f" class="lg lh iy kx b gy li lj l lk ll">1<br/>----<br/>2</span></pre><p id="dd40" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">但是现在，如果我只用一个参数调用这个函数会发生什么？它是在破折号打印之前还是之后执行？</p><p id="fd61" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">事实证明，这要视情况而定。假设我这样称呼它:</p><pre class="ky kz la lb gt lc kx ld le aw lf bi"><span id="9081" class="lg lh iy kx b gy li lj l lk ll">foo({ println("A") })</span></pre><p id="a5a7" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">结果将是:</p><pre class="ky kz la lb gt lc kx ld le aw lf bi"><span id="9345" class="lg lh iy kx b gy li lj l lk ll">A<br/>----</span></pre><p id="3799" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">这正是我所期待的。我只给了一个参数，没有命名，所以Kotlin正确地假设它是函数签名中的第一个参数。但是如果我在代码中写下这一行，SonarQube会建议我利用一个很好的Kotlin技巧，将lambda从括号中移除。所以让我们试试，把代码改成这样:</p><pre class="ky kz la lb gt lc kx ld le aw lf bi"><span id="d638" class="lg lh iy kx b gy li lj l lk ll">foo { println("A") }</span></pre><p id="ac4f" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">让我们运行它:</p><pre class="ky kz la lb gt lc kx ld le aw lf bi"><span id="29eb" class="lg lh iy kx b gy li lj l lk ll">----<br/>A</span></pre><p id="4fa9" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">显然，删除括号改变了我们代码的行为。这是为什么呢？</p><p id="0aa5" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">嗯，问题来自于我们刚刚使用的语法糖(将一个lambda移出括号)只适用于函数签名中的最后一个lambda。在我们的例子中，它是第二个λ。所以Kotlin现在假设我们提供的参数，在括号之外，是我们的第二个(也是最后一个)参数，并在破折号之后执行它。</p><p id="21a7" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">毫无疑问，这是一个极限情况，但是如果你在代码中使用RxJava，你可能有一些对subscribe方法的调用需要两个或三个lambda(<code class="fe ku kv kw kx b">onNext</code>、<code class="fe ku kv kw kx b">onComplete</code>或<code class="fe ku kv kw kx b">onError</code>事件的回调),把它们封装在一个有可选参数的函数中是很诱人的，这样如果你没有为某些类型的事件(特别是错误事件)提供处理程序，你就不会冒异常的风险。只是要注意，在函数中使用几个lambdas可能有点棘手！</p><p id="a37d" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这种情况下，手动重载函数可能是明智的。例如，您可以选择声明以下单独的方法:</p><pre class="ky kz la lb gt lc kx ld le aw lf bi"><span id="a316" class="lg lh iy kx b gy li lj l lk ll">fun foo(lambda1: () -&gt; Unit = {}) = foo(lambda1) {}<br/>fun foo(lambda1: () -&gt; Unit, lambda2: () -&gt; Unit) {...}</span></pre><p id="363a" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">在这种情况下，你可以用零个、一个或两个参数调用你的函数，用一个lambda调用<code class="fe ku kv kw kx b">foo()</code>总是会得到相同的结果，不管你用不用括号。然而，代价是不能只使用第二个参数来调用它。</p><p id="fbfa" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">只有你能判断这是否可以接受。如果您只需要使用第一个或第二个参数进行调用，您可能最好保持原始语法，并始终使用命名参数来确保哪个参数应该接收lambda表达式是显而易见的。</p><p id="e327" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">所以下一次SonarQube告诉你把一个lambda移出括号时，在遵从之前要三思。花时间仔细检查代码中的这个微小变化不会有任何意想不到的副作用，这肯定会让您省去一些麻烦。</p></div><div class="ab cl lm ln hr lo" role="separator"><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr ls"/><span class="lp bw bk lq lr"/></div><div class="ig ih ii ij ik"><p id="53a3" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">你需要Kotlin工作室吗？请访问我们的网站,看看我们能为您做些什么。</p><p id="1d5c" class="pw-post-body-paragraph jv jw iy jx b jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks ig bi translated">了解卡帕头最新的重大新闻。学院、<a class="ae kt" href="https://kotlin-academy.us17.list-manage.com/subscribe?u=5d3a48e1893758cb5be5c2919&amp;id=d2ba84960a" rel="noopener ugc nofollow" target="_blank">订阅时事通讯</a>、<a class="ae kt" href="https://twitter.com/ktdotacademy" rel="noopener ugc nofollow" target="_blank">观察推特</a>并在媒体上关注。</p><figure class="ky kz la lb gt ip gh gi paragraph-image"><a href="http://eepurl.com/diMmGv"><div class="gh gi lt"><img src="../Images/5ce68714efe3efc036e06786166954ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uDqv_d5NZnPUJA0FeZqhqQ.png"/></div></a></figure></div></div>    
</body>
</html>