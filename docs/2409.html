<html>
<head>
<title>Understanding about RFC 3339 for Datetime and Timezone Formatting in Software Engineering</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">对软件工程中日期时间和时区格式RFC 3339的理解</h1>
<blockquote>原文：<a href="https://medium.easyread.co/understanding-about-rfc-3339-for-datetime-formatting-in-software-engineering-940aa5d5f68a?source=collection_archive---------0-----------------------#2019-10-14">https://medium.easyread.co/understanding-about-rfc-3339-for-datetime-formatting-in-software-engineering-940aa5d5f68a?source=collection_archive---------0-----------------------#2019-10-14</a></blockquote><div><div class="fc ib ic id ie if"/><div class="ig ih ii ij ik"><div class=""/><div class=""><h2 id="b336" class="pw-subtitle-paragraph jk im in bd b jl jm jn jo jp jq jr js jt ju jv jw jx jy jz ka kb dk translated">不是每个工程师都知道的小而简单的事情，却是每个工程师都应该明白的非常重要的事情。</h2></div><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi kc"><img src="../Images/bbf4023d849d5b1d6b6158c08b33f5aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*eKULaIgRlJNEPbHH"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">Photo by <a class="ae ks" href="https://unsplash.com/@aronvisuals?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Aron Visuals</a> on <a class="ae ks" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">Unsplash</a></figcaption></figure><p id="3e59" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">几天前，在构建<a class="ae ks" href="https://mabar.id" rel="noopener ugc nofollow" target="_blank"> Mabar </a>时，我们就日期时间格式展开了一场大辩论。有一个问题是我们的时区不一致。所以，后来经过长时间的争论和讨论，我们达成了一项协议，使用我们的时区标准。</p><p id="8f28" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我们最终决定使用RFC 3339作为日期时间格式的标准。也就是说，后端和前端都将使用这种格式来交流日期时间格式。此外，我们同意使用UTC+0作为默认时区，即使在创建事件和从服务器接收事件细节时也是如此。并让前端和后端根据他们的时区进行转换。</p><p id="fb95" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated"><strong class="kv io"> <em class="lp">那么RFC 3339是什么呢？</em> </strong></p><h2 id="47fe" class="lq lr in bd ls lt lu dn lv lw lx dp ly lc lz ma mb lg mc md me lk mf mg mh mi bi translated">RFC 3339简介</h2><p id="e862" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">RFC代表征求意见。RFC是来自互联网工程任务组(<a class="ae ks" href="https://www.ietf.org/" rel="noopener ugc nofollow" target="_blank"> IETF </a>)的正式文档，是委员会起草和相关方随后审查的结果</p><p id="76c1" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">这个委员会已经发布了这么多RFC文档。并成为各行各业的标准。他们的文档之一是RFC 3339，这是一个用于日期时间格式化的文档。<em class="lp">RFC 3339的链接可以在这里访问:</em><a class="ae ks" href="https://www.ietf.org/rfc/rfc3339.txt" rel="noopener ugc nofollow" target="_blank"><em class="lp">https://www.ietf.org/rfc/rfc3339.txt</em></a></p><p id="87e3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">一般来说，如果你看RFC文档，它主要讨论的是日期时间格式，总结一下，你会看到建议的日期时间格式是如何像下面的例子。</p><pre class="kd ke kf kg gt mo mp mq mr aw ms bi"><span id="9066" class="lq lr in mp b gy mt mu l mv mw">2019-10-12T07:20:50.52Z</span></pre><p id="5350" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">是的，就这样。</p><p id="c689" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">但是有一个问题。对于日期时间格式，ISO已经标准化了。这是日期时间的ISO 8601标准。对于已经熟悉ISO 8601的人来说，RFC 3339非常相似。有什么不同？</p><p id="9e89" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">所以，如果你再看一遍RFC文档。RFC 3339使用/遵循互联网日期时间的ISO 8601配置文件。在第5.6章中明确说明</p><figure class="kd ke kf kg gt kh gh gi paragraph-image"><div role="button" tabindex="0" class="ki kj di kk bf kl"><div class="gh gi mx"><img src="../Images/a4cf2914d49a954275176e5357111015.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1PiiebUwve3R3WiCzUa6LQ.png"/></div></div><figcaption class="ko kp gj gh gi kq kr bd b be z dk">RFC 3339 Chapter 5.6</figcaption></figure><p id="444c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">所以实际上，约会ISO 8601并没有很大的区别。使这两者不同的唯一一点是日期和时间之间的“T”语法。ISO 8601使用“T”字符来分隔日期和时间。在RFC 3339中，您可以仅使用空格来替换“T”字符。</p><p id="62f4" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">例如:</p><pre class="kd ke kf kg gt mo mp mq mr aw ms bi"><span id="552a" class="lq lr in mp b gy mt mu l mv mw"># This is acceptable in ISO 8601 and RFC 3339 <strong class="mp io"><em class="lp">(with T)</em></strong><br/>2019-10-12<strong class="mp io">T</strong>07:20:50.52Z</span><span id="945d" class="lq lr in mp b gy my mu l mv mw"># This is only accepted in RFC 3339 <strong class="mp io"><em class="lp">(without T)</em></strong><br/>2019-10-12 07:20:50.52Z</span></pre><p id="7fad" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">只是它。所以总的来说，它还是和ISO 8601一样。</p><h2 id="ae72" class="lq lr in bd ls lt lu dn lv lw lx dp ly lc lz ma mb lg mc md me lk mf mg mh mi bi translated">了解时区</h2><p id="1d48" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">当我向我的好朋友询问RFC 3339的时候，我有点震惊，没有人了解这个。即使对ISO 8601来说，也只有少数人知道这件事的细节。</p><p id="582f" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">尤其是读取时区格式。从我朋友的1-10分中，我只能说只有1分理解时区格式。</p><pre class="kd ke kf kg gt mo mp mq mr aw ms bi"><span id="5655" class="lq lr in mp b gy mt mu l mv mw">2019-10-12T07:20:50.52Z</span></pre><p id="9f68" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">看看上面的例子。当我问别人时，他们会说现在是雅加达时间，因为我们住在雅加达。所以他会以为是雅加达时间。但这是错误的。因为如果我们把那个时间转换成雅加达时间应该是:<code class="fe mz na nb mp b">2019–10–12 14:20:50.52</code>。</p><p id="01a8" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">怎么可能呢？我怎么能说那个例子中的雅加达时间是应该是<code class="fe mz na nb mp b">2019–10–12 14:20:50.52</code>？</p><p id="9dcc" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在RFC 3339中，我们也可以从格式中知道时区。它显示在“<strong class="kv io">Z”</strong>语法中。“Z”表示UTC+0。“Z”代表祖鲁语时区，等同于GMT或UTC(<a class="ae ks" href="https://stackoverflow.com/a/9706777/4075313" rel="noopener ugc nofollow" target="_blank">https://stackoverflow.com/a/9706777/4075313</a>)。所以如果我们把Z放在日期时间上，这意味着它的时区是UTC+0。</p><p id="4f01" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">更详细示例:</p><pre class="kd ke kf kg gt mo mp mq mr aw ms bi"><span id="291d" class="lq lr in mp b gy mt mu l mv mw">2019-10-12T07:20:50.52<strong class="mp io">Z</strong>      <strong class="mp io">(UTC+0)</strong><br/>2019-10-12T07:20:50.52<strong class="mp io">+00:00</strong> <strong class="mp io">(UTC+0)</strong><br/>2019-10-12T14:20:50.52<strong class="mp io">+07:00</strong> <strong class="mp io">(UTC+7)</strong><br/>2019-10-12T03:20:50.52<strong class="mp io">-04:00</strong> <strong class="mp io">(UTC-4)</strong></span></pre><p id="d42c" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">看这加粗的文字。它将解释时区是如何以日期时间格式书写的。</p><h2 id="21e4" class="lq lr in bd ls lt lu dn lv lw lx dp ly lc lz ma mb lg mc md me lk mf mg mh mi bi translated">为什么重要？</h2><p id="ef06" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">这对于处理来自多个时区的请求非常重要。如果你的应用程序只接受与你的时区相同的请求(目前)，那么工程师可能不会很好地处理这个问题。</p><p id="5d33" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">对于工程师来说，为什么像Golang这样的一些编程语言已经能处理这个问题就真的很重要呢？这是因为有时工程师不太理解，可能会带来新的问题。</p><p id="8999" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">我给你讲个故事吧。</p><p id="59f6" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">所以，我会举一个例子来说明为什么这真的很重要。我和我的朋友最近就遇到了这种情况。我们有一个关于未决交易的问题，需要查看并核实。</p><p id="e00e" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">在我们的应用中，我们使用UTC+0，他(我的朋友)知道这一点。因此，要修复挂起的事务，我只需要获得事务发生时的详细信息，并检查在挂起的事务周围是否有另一个事务挂起，并在那时重新验证所有挂起的事务。</p><p id="e789" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">当我询问数据库中行的事务时间(创建时间)时，问题就来了。他用我们的时区(UTC+7)自动添加小时，但不改变时区格式。这给我带来了额外的时间来核实当时所有的交易。因为我查询了错误的日期时间范围。</p><p id="7fef" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">举个例子，</p><pre class="kd ke kf kg gt mo mp mq mr aw ms bi"><span id="cb95" class="lq lr in mp b gy mt mu l mv mw">#This is our datetime stored in DB<br/>2019-10-12T<strong class="mp io">07</strong>:20:50.52<strong class="mp io">Z</strong></span></pre><p id="a551" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">然后我让他通过聊天说出交易时间。他给了我这个。</p><pre class="kd ke kf kg gt mo mp mq mr aw ms bi"><span id="1067" class="lq lr in mp b gy mt mu l mv mw"># He add the hour with +7 but not change the timezone<br/>2019-10-12T<strong class="mp io">14</strong>:20:50.52<strong class="mp io">Z</strong></span></pre><p id="5ac3" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">那么这里出了什么问题呢？看“小时”值。他加了7发给我。但是时区仍然是“Z”(UTC+0)。因为我知道要读RFC 3339，所以我在想这是UTC+0，因为他写的是“Z”。</p><p id="32df" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">有了这个日期和时间，我就可以对数据库进行一些查询了。但是，我得到的并不完全是我想要的。当我试图通过ID查询时，它显示的与他给我的不同。恐怕有一个对DB的更新查询，导致它与他给我的不同。</p><p id="1cdb" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">而且给我带来了困惑。为了验证这一点，我再次问他，这是否是UTC+0值，他说，他已经在小时上加了+7。我觉得像啊…🤯</p><p id="3182" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">然后，我对他说，当添加小时时，请同时更改时区。所以它不会给阅读日期时间的人带来困惑。</p><p id="6aba" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">因此，如果我们将前面的示例更改为时区为UTC+7，应该是这样的</p><pre class="kd ke kf kg gt mo mp mq mr aw ms bi"><span id="e628" class="lq lr in mp b gy mt mu l mv mw">#This is our datetime stored in DB<br/>2019-10-12T<strong class="mp io">07</strong>:20:50.52<strong class="mp io">Z</strong></span><span id="b018" class="lq lr in mp b gy my mu l mv mw">#This is how it should be converted to UTC+7<br/>2019-10-12T<strong class="mp io">14</strong>:20:50.52<strong class="mp io">+07:00</strong></span></pre></div><div class="ab cl nc nd hr ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ig ih ii ij ik"><h2 id="4062" class="lq lr in bd ls lt lu dn lv lw lx dp ly lc lz ma mb lg mc md me lk mf mg mh mi bi translated"><strong class="ak">外卖</strong></h2><p id="bab4" class="pw-post-body-paragraph kt ku in kv b kw mj jo ky kz mk jr lb lc ml le lf lg mm li lj lk mn lm ln lo ig bi translated">对于工程师来说，理解格式以避免数据不一致是非常重要的。幸运的是，从我上面的经验来看，我仍然在阅读给定的日期时间。如果有一个应用程序将读取日期时间，那么会有这么多不一致的数据，因为我们手动添加了错误的时区。</p><p id="1c81" class="pw-post-body-paragraph kt ku in kv b kw kx jo ky kz la jr lb lc ld le lf lg lh li lj lk ll lm ln lo ig bi translated">所以这里有一些要点:</p><ul class=""><li id="4cbd" class="nj nk in kv b kw kx kz la lc nl lg nm lk nn lo no np nq nr bi translated">“Z”:代表零时区(UTC+0)。或者等于RFC 3339中的+00:00。</li><li id="b252" class="nj nk in kv b kw ns kz nt lc nu lg nv lk nw lo no np nq nr bi translated">RFC 3339遵循ISO 8601日期时间格式。唯一的区别是RFC允许我们用“空格”代替“T”。</li></ul><h2 id="960c" class="lq lr in bd ls lt lu dn lv lw lx dp ly lc lz ma mb lg mc md me lk mf mg mh mi bi translated">参考资料:</h2><ul class=""><li id="30ec" class="nj nk in kv b kw mj kz mk lc nx lg ny lk nz lo no np nq nr bi translated">https://www.ietf.org/rfc/rfc3339.txt<a class="ae ks" href="https://www.ietf.org/rfc/rfc3339.txt" rel="noopener ugc nofollow" target="_blank"/></li><li id="b96c" class="nj nk in kv b kw ns kz nt lc nu lg nv lk nw lo no np nq nr bi translated">[1]:<a class="ae ks" href="https://whatis.techtarget.com/definition/Request-for-Comments-RFC" rel="noopener ugc nofollow" target="_blank">https://what is . tech target . com/definition/Request-for-Comments-RFC</a></li></ul></div><div class="ab cl nc nd hr ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="ig ih ii ij ik"><figure class="kd ke kf kg gt kh"><div class="bz fp l di"><div class="oa ob l"/></div></figure></div></div>    
</body>
</html>