<html>
<head>
<title>Goldilocks scripting — make Vagrant just right!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">金发女郎脚本——让流浪者恰到好处！</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/goldilocks-scripting-make-vagrant-just-right-caff51fadb21?source=collection_archive---------7-----------------------#2021-07-19">https://medium.com/oracledevs/goldilocks-scripting-make-vagrant-just-right-caff51fadb21?source=collection_archive---------7-----------------------#2021-07-19</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/98ea93af3aa66e8ea6b5b796ab78ae34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rIRnpTKKhhMSzlUHc_bgEw.png"/></div></div></figure><p id="e82c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">原型制作</strong></p><p id="28b2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">开发人员创建应用程序通常需要安装许多必备组件。虽然并不总是需要在虚拟机中开发应用程序，但这是将应用程序与工作站上的其他工作负载分离的有效方法。</p><p id="decb" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">虽然可以在启动VM后手动执行这些任务，但是在travel file中编写任务脚本更容易。</p><p id="ee5b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Oracle vagger项目位于以下链接:</p><div class="jn jo ez fb jp jq"><a href="https://github.com/oracle/vagrant-projects" rel="noopener  ugc nofollow" target="_blank"><div class="jr ab dw"><div class="js ab jt cl cj ju"><h2 class="bd hi fi z dy jv ea eb jw ed ef hg bi translated">甲骨文/流浪者-项目</h2><div class="jx l"><h3 class="bd b fi z dy jv ea eb jw ed ef dx translated">一组自动提供Oracle和其他软件的浮动项目，使用Oracle Linux……</h3></div><div class="jy l"><p class="bd b fp z dy jv ea eb jw ed ef dx translated">github.com</p></div></div><div class="jz l"><div class="ka l kb kc kd jz ke in jq"/></div></div></a></div><p id="6c0b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">当您将安装脚本编写在Vagrantfile中时，设置您的开发环境并不会变得更容易。</p><p id="24e7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们打算使用OEL8创建一个应用程序，所以我们将使用适当的项目。ie ~/vagger-projects/Oracle Linux/8</p><p id="501a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">顺便说一句，如果应用开发是你的事情，你可能想看看<a class="ae kf" href="https://signup.cloud.oracle.com/?language=en" rel="noopener ugc nofollow" target="_blank">甲骨文云基础设施的免费层帐户。</a></p></div><div class="ab cl kg kh go ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="ha hb hc hd he"><h2 id="a150" class="kn ko hh bd kp kq kr ks kt ku kv kw kx ja ky kz la je lb lc ld ji le lf lg lh bi translated">打开虚拟机的防火墙</h2><p id="6b59" class="pw-post-body-paragraph ip iq hh ir b is li iu iv iw lj iy iz ja lk jc jd je ll jg jh ji lm jk jl jm ha bi translated">在流浪OEL中，防火墙守护程序默认是不启用的，因此要对防火墙进行更改，防火墙守护程序需要运行。</p><p id="87f4" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要在vacator中设置防火墙，我们首先需要在vacator文件中设置防火墙守护进程:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="3ca5" class="kn ko hh ls b fi lw lx l ly lz">config.vm.provision "shell", run: "always", inline: "systemctl unmask firewalld"<br/>config.vm.provision "shell", run: "always", inline: "systemctl start firewalld"</span></pre><p id="beb6" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在，因为我们的应用程序将使用HTTP和端口5000，所以也要在travel file中定义它们:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="a72e" class="kn ko hh ls b fi lw lx l ly lz">config.vm.provision "shell", run: "always", inline: "firewall-cmd --add-port=5000/tcp"<br/>config.vm.provision "shell", run: "always", inline: "firewall-cmd --add-service=http"</span></pre><p id="4c3f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">要使设置持久，请添加以下内容:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="014a" class="kn ko hh ls b fi lw lx l ly lz">config.vm.provision "shell", run: "always", inline: "firewall-cmd --runtime-to-permanent"</span></pre><p id="b3a2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在防火墙已经设置好了，以适应我们想要开发的应用程序。</p></div><div class="ab cl kg kh go ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="ha hb hc hd he"><h2 id="b9af" class="kn ko hh bd kp kq kr ks kt ku kv kw kx ja ky kz la je lb lc ld ji le lf lg lh bi translated">在主机上设置端口转发</h2><p id="b2b9" class="pw-post-body-paragraph ip iq hh ir b is li iu iv iw lj iy iz ja lk jc jd je ll jg jh ji lm jk jl jm ha bi translated">可以通过Oracle VirtualBox manager手动设置对虚拟机的外部访问。ie VBoxManage controlvm。</p><p id="d1d8" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然而，用流浪者更容易做到这一点。</p><p id="2f06" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">添加此行以匹配端口5000的防火墙设置:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="0cde" class="kn ko hh ls b fi lw lx l ly lz">  # Oracle port forwarding<br/>  # config.vm.network "forwarded_port", guest: 22, host: 2220<br/>  config.vm.network "forwarded_port", guest: 5000, host: 5000</span></pre><p id="22d1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">默认情况下，流浪者将配置NAT(网络地址转换),因此我们不需要单独进行配置。</p><p id="3c46" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">调配后，我们将能够使用URL 127.0.0.1:5000从主机访问应用程序。</p></div><div class="ab cl kg kh go ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="ha hb hc hd he"><h2 id="9985" class="kn ko hh bd kp kq kr ks kt ku kv kw kx ja ky kz la je lb lc ld ji le lf lg lh bi translated">在虚拟机上安装开发人员工具</h2><p id="00b6" class="pw-post-body-paragraph ip iq hh ir b is li iu iv iw lj iy iz ja lk jc jd je ll jg jh ji lm jk jl jm ha bi translated">当然——开发人员离不开一些开发工具，比如Vim和Git，所以把这几行添加到lavong file中:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="5ff5" class="kn ko hh ls b fi lw lx l ly lz">config.vm.provision "shell", run: "always", inline: "yum install -y vim"<br/>config.vm.provision "shell", run: "always", inline: "yum install -y git"</span></pre><p id="542f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">另外，Python不是默认安装的，所以让我们添加一行来安装它。</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="f05d" class="kn ko hh ls b fi lw lx l ly lz">config.vm.provision "shell", run: "always", inline: "yum install -y python3"</span></pre><p id="c09f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们需要为应用程序创建一个目录，因此用下面一行创建一个目录:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="1f0c" class="kn ko hh ls b fi lw lx l ly lz">config.vm.provision "shell", run: "always", inline: "mkdir /home/vagrant/myapp"</span></pre><p id="026d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">然后将目录的所有者从root更改为游民:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="2eb8" class="kn ko hh ls b fi lw lx l ly lz">config.vm.provision "shell", run: "always", inline: "chown vagrant /home/vagrant/myapp"</span></pre><p id="7b36" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">所以我们需要的所有核心工具都定义在流浪者文件中。</p></div><div class="ab cl kg kh go ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="ha hb hc hd he"><h2 id="e2da" class="kn ko hh bd kp kq kr ks kt ku kv kw kx ja ky kz la je lb lc ld ji le lf lg lh bi translated">启动流浪者</h2><p id="26ff" class="pw-post-body-paragraph ip iq hh ir b is li iu iv iw lj iy iz ja lk jc jd je ll jg jh ji lm jk jl jm ha bi translated">在完成了living file之后，我们准备好第一次启动，并且将开始供应。</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="ef3c" class="kn ko hh ls b fi lw lx l ly lz">&gt; vagrant up</span></pre><p id="6175" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在构建阶段，您应该会看到添加到travel file中的配置的日志。</p><figure class="ln lo lp lq fd ii er es paragraph-image"><div class="er es ma"><img src="../Images/a07f3f3a9d223568fc2765e7d6f984bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:914/format:webp/1*BAbZEB8uZt03jpN_IQTk0w.png"/></div></figure><p id="ca56" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">注意—添加的配置行仅在虚拟机首次启动时执行，在后续启动时会被忽略。</p></div><div class="ab cl kg kh go ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="ha hb hc hd he"><h2 id="b23f" class="kn ko hh bd kp kq kr ks kt ku kv kw kx ja ky kz la je lb lc ld ji le lf lg lh bi translated">检查供应情况</h2><p id="101a" class="pw-post-body-paragraph ip iq hh ir b is li iu iv iw lj iy iz ja lk jc jd je ll jg jh ji lm jk jl jm ha bi translated">在主机上，使用Oracle VirtualBox管理器，我们可以确认端口转发是否存在。</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="0085" class="kn ko hh ls b fi lw lx l ly lz">$ '/C/Program Files/Oracle/VirtualBox/vboxmanage' showvminfo 'ol8-vagrant' | grep 'Rule'</span></pre><figure class="ln lo lp lq fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es mb"><img src="../Images/3dc62ad1767ad4ee3e7241ada6b52165.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*V58FCiTnwL2i4mu6eABfkw.png"/></div></div></figure><p id="3d18" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">因此端口转发为5000。</p><p id="659a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">防火墙还需要为端口5000打开，因此使用以下命令启动虚拟机的防火墙守护程序，并查询设置。</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="0221" class="kn ko hh ls b fi lw lx l ly lz"># systemctl unmask firewalld<br/># systemctl start firewalld<br/># firewall-cmd --list-all</span></pre><figure class="ln lo lp lq fd ii er es paragraph-image"><div class="er es mc"><img src="../Images/18db252b4bd06b803b93af5c512ef723.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*qhlUHQ5TJ-Wa0fdfXHgEgQ.png"/></div></figure><p id="5b1d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">HTTP和端口5000是开放的。</p><p id="b62c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在让我们看看Python是否存在。</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="f168" class="kn ko hh ls b fi lw lx l ly lz">$ python3</span></pre><figure class="ln lo lp lq fd ii er es paragraph-image"><div class="er es md"><img src="../Images/dc7b899093678dcfa6d370ae6401611f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*kagtebBRvJ8rb6PXgnh-jQ.png"/></div></figure><p id="d74f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Python出现了。</p><p id="b0ea" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">到目前为止一切顺利，现在让我们运行一个测试应用程序。</p></div><div class="ab cl kg kh go ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="ha hb hc hd he"><h2 id="c913" class="kn ko hh bd kp kq kr ks kt ku kv kw kx ja ky kz la je lb lc ld ji le lf lg lh bi translated">运行测试应用程序</h2><p id="0fe5" class="pw-post-body-paragraph ip iq hh ir b is li iu iv iw lj iy iz ja lk jc jd je ll jg jh ji lm jk jl jm ha bi translated">我们希望使用Python Flask作为开发框架，因此需要为流浪者帐户安装它。</p><p id="1f8d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">“myapp”目录应该已经存在了，因为我们已经将它包含在了Vagrantfile中，所以让我们安装Flask。</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="e6eb" class="kn ko hh ls b fi lw lx l ly lz">$ cd myapp<br/>$ python3 -m venv .<br/>$ . ./bin/activate<br/>$ pip install Flask</span></pre><p id="3e6f" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在让我们在目录~/myapp中创建一个名为myapp.py的文件，其内容如下:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="d56a" class="kn ko hh ls b fi lw lx l ly lz"><strong class="ls hi">from</strong> flask <strong class="ls hi">import</strong> Flask<br/><br/>app = Flask<strong class="ls hi">(</strong>__name__<strong class="ls hi">)</strong><br/><br/>@app.route<strong class="ls hi">(</strong>"/"<strong class="ls hi">)</strong><br/><strong class="ls hi">def</strong> hello_world<strong class="ls hi">():</strong><br/>    <strong class="ls hi">return</strong> "&lt;p&gt;Vagrant scripting rocks!&lt;/p&gt;"</span></pre><p id="b128" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在运行myapp.py:</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="c7fc" class="kn ko hh ls b fi lw lx l ly lz">$ export FLASK_APP=myapp<br/>$ flask run</span></pre><p id="d826" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">转到主机的浏览器，尝试127.0.0.1:5000</p><figure class="ln lo lp lq fd ii er es paragraph-image"><div class="er es me"><img src="../Images/1cf962636da0b51234bbe4a9bd95792e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1320/format:webp/1*ZdxKhMvMQq94A0PoSY3pBg.png"/></div></figure><p id="f64d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这不管用。</p><p id="76d0" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">原因很简单。</p><p id="7dab" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">我们需要通知Flask将应用程序暴露给外部网络。</p><pre class="ln lo lp lq fd lr ls lt lu aw lv bi"><span id="683b" class="kn ko hh ls b fi lw lx l ly lz">$ export FLASK_APP=myapp<br/>$ flask run --host 0.0.0.0</span></pre><p id="271c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">因此，指定0.0.0.0允许从虚拟机的主机访问虚拟机中运行的应用程序。</p><p id="4223" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">现在从主机再次尝试127.0.0.1:5000。</p><figure class="ln lo lp lq fd ii er es paragraph-image"><div class="er es mf"><img src="../Images/5d0446634ac52a9f6356e02e2b470722.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*J5K3JsqwK6o1LPql3N_-ow.png"/></div></figure><p id="ed12" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">是真的——流浪脚本石头！</p><h1 id="c813" class="mg ko hh bd kp mh mi mj kt mk ml mm kx mn mo mp la mq mr ms ld mt mu mv lg mw bi translated">加入对话！</h1><p id="2736" class="pw-post-body-paragraph ip iq hh ir b is li iu iv iw lj iy iz ja lk jc jd je ll jg jh ji lm jk jl jm ha bi translated">如果你对甲骨文开发人员在他们的自然栖息地发生的事情感到好奇，来加入我们的公共休闲频道吧！我们不介意成为你的鱼缸🐠</p></div><div class="ab cl kg kh go ki" role="separator"><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl km"/><span class="kj bw bk kk kl"/></div><div class="ha hb hc hd he"><p id="7033" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><em class="mx"> Paul Guerin是一名专注于Oracle数据库的国际顾问。此外，他还出席了一些世界领先的甲骨文会议，包括甲骨文2013年世界开放大会。自2015年以来，他的工作一直是IOUG最佳实践技巧小册子以及AUSOUG、Oracle Technology Network、Quest和Oracle Developers (Medium)出版物的主题。2019年，他被授予My Oracle支持社区最有价值贡献者。他是一名DBA OCP，并将继续参与Oracle ACE计划。</em></p></div></div>    
</body>
</html>