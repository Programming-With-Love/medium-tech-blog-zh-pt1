<html>
<head>
<title>Run Always Free Docker Container on Oracle Cloud Infrastructure</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Oracle云基础设施上运行始终免费的Docker容器</h1>
<blockquote>原文：<a href="https://medium.com/oracledevs/run-always-free-docker-container-on-oracle-cloud-infrastructure-c88e36b65610?source=collection_archive---------0-----------------------#2020-02-06">https://medium.com/oracledevs/run-always-free-docker-container-on-oracle-cloud-infrastructure-c88e36b65610?source=collection_archive---------0-----------------------#2020-02-06</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><p id="4901" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">在本文中，我想展示如何在Oracle云基础设施上快速免费运行Docker容器——在OCI的永远免费层使用虚拟机。例如，我将运行一个NGINX容器映像，并通过公共互联网从客户端访问它</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es jc"><img src="../Images/761a9f5252e2119702bef867e8403f52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NmGVAn0hRFx_f-5A.png"/></div></div></figure><p id="20c0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">一些提醒:容器的工作负载必须符合这个总是空闲的VM: VM的形状。Standard.E2.1.Micro，1/8 OCPU，1 GB RAM和高达480 Mbps的网络带宽(参见<a class="ae jo" href="https://docs.cloud.oracle.com/en-us/iaas/Content/FreeTier/resourceref.htm" rel="noopener ugc nofollow" target="_blank">文档</a>)。启动卷提供45GB多一点的磁盘存储空间。为了能够访问容器，还必须在安全列表的入口规则中配置虚拟机上映射到容器的端口。我们需要在VM中自己安装Docker它只配置了一个Oracle Linux映像。</p><p id="8fa4" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">本文在很大程度上依赖于Todd Sharp的文章:<a class="ae jo" href="https://blogs.oracle.com/developers/getting-started-with-rabbitmq-in-the-oracle-cloud" rel="noopener ugc nofollow" target="_blank">Oracle Cloud中的RabbitMQ入门</a>。</p><p id="08bb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">步骤:</p><ol class=""><li id="656b" class="jp jq hh ig b ih ii il im ip jr it js ix jt jb ju jv jw jx bi translated">给自己找一份OCI的租约(可以免费试用)；登录到控制台</li><li id="9476" class="jp jq hh ig b ih jy il jz ip ka it kb ix kc jb ju jv jw jx bi translated">生成SSH密钥对</li><li id="617c" class="jp jq hh ig b ih jy il jz ip ka it kb ix kc jb ju jv jw jx bi translated">创建一个总是自由形状的计算实例；配置SSH密钥，并记下分配给虚拟机的公共IP</li><li id="eebd" class="jp jq hh ig b ih jy il jz ip ka it kb ix kc jb ju jv jw jx bi translated">在虚拟机的安全列表中设置入口规则，以打开您想要运行的任何容器所需的端口</li><li id="7e65" class="jp jq hh ig b ih jy il jz ip ka it kb ix kc jb ju jv jw jx bi translated">SSH进入虚拟机，安装Docker</li><li id="44cd" class="jp jq hh ig b ih jy il jz ip ka it kb ix kc jb ju jv jw jx bi translated">运行Docker容器映像</li><li id="7c16" class="jp jq hh ig b ih jy il jz ip ka it kb ix kc jb ju jv jw jx bi translated">在虚拟机的公共IP地址访问容器映像提供的服务</li></ol><p id="2720" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">本文将这些步骤描述为手动步骤。在下一次迭代中，我希望自动化这个过程，并使之成为红色专家联盟正在Katacoda上制作的<a class="ae jo" href="https://katacoda.com/redexpertalliance/courses/oci-course" rel="noopener ugc nofollow" target="_blank"> OCI在线动手实验室</a>的一部分。</p><h1 id="c235" class="kd ke hh bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">1.获得一份租约，并确保您可以创建永远免费的虚拟机形状的实例</h1><p id="6876" class="pw-post-body-paragraph ie if hh ig b ih lb ij ik il lc in io ip ld ir is it le iv iw ix lf iz ja jb ha bi translated">一旦您获得了OCI租赁(无论是免费试用还是付费帐户)，您应该能够创建shape VM.Standard.E2.1.Micro的两个免费虚拟机实例。但是，我发现在我的几个Ashburn租赁中，始终免费的shape的服务限制设置为0。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lg"><img src="../Images/9368f848f0bf9b25a14fd13148343a8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*NHkOAS-aKG0Ec5pH.png"/></div></div></figure><p id="1edd" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我认为这是一个小故障，你不应该也不会遇到。但是，如果您这样做了，您可以决定创建一个非自由的VM实例或者请求提高限制。您可以直接从控制台很容易地做到这一点，尽管需要一些时间来处理:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es lh"><img src="../Images/f390f25cd6f388819d7adfe6500d5359.png" data-original-src="https://miro.medium.com/v2/resize:fit:696/format:webp/0*sweL393YPXJS31Je.png"/></div></figure><h1 id="385f" class="kd ke hh bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">2.生成SSH密钥对</h1><p id="c522" class="pw-post-body-paragraph ie if hh ig b ih lb ij ik il lc in io ip ld ir is it le iv iw ix lf iz ja jb ha bi translated">使用Linux上的ssh-keygen或Windows上的PuTTY Key Generator等工具生成SSH密钥对。详见<a class="ae jo" href="https://docs.cloud.oracle.com/en-us/iaas/Content/GSG/Tasks/creatingkeys.htm?Highlight=ssh%20key" rel="noopener ugc nofollow" target="_blank"> OCI文件</a>。</p><p id="4714" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">以下是我在Linux上做的事情:</p><pre class="jd je jf jg fd li lj lk ll aw lm bi"><span id="564e" class="ln ke hh lj b fi lo lp l lq lr">ssh-keygen -t rsa -N "" -b 2048 -C "docker-vm-key" -f ./docker-vm-key</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es ls"><img src="../Images/bab76c2345886183ffd5a2d361493b68.png" data-original-src="https://miro.medium.com/v2/resize:fit:1060/format:webp/0*7sb38toWX_KeOuvf.png"/></div></figure><p id="d961" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">生成了两个文件:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es lt"><img src="../Images/f8ee0ad63b25d4e4e615e63fcdc4f328.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/0*NABohl8mIsvTHJpq.png"/></div></figure><p id="9bdb" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">文件docker-vm-key包含私钥(不受密码保护),文件docker-vm-key.pub包含公钥，我们将把它粘贴到OCI上的虚拟机定义中。</p><h1 id="fd0e" class="kd ke hh bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">3.创建计算实例</h1><p id="1a36" class="pw-post-body-paragraph ie if hh ig b ih lb ij ik il lc in io ip ld ir is it le iv iw ix lf iz ja jb ha bi translated">在OCI控制台菜单中，导航至计算|实例:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es lu"><img src="../Images/6663088aabd67c9d130082a0fcb57039.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/0*zeNgiJYLGdPJTmQd.png"/></div></figure><p id="f940" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">单击创建实例:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lv"><img src="../Images/6650e931262cf1ce20b44648f13702ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jMLbQnrcE3HYQLmX.png"/></div></div></figure><p id="b1d8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">我已经接受了大部分默认值。我为实例定义了名称:<em class="lw"> free-docker-runner </em>，并选择了一个预先存在的区间。我选择了一个现有的虚拟网络和该网络中的一个公共子网。我还表示，我希望分配一个公共IP地址。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lx"><img src="../Images/46745783a6f515e3e0f6c33e9972417d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ZazvsrgotT2z6JkI.png"/></div></div></figure><p id="603d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">最后，粘贴SSH <strong class="ig hi"> Public </strong>键并点击Create。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lg"><img src="../Images/638a86e0a71165a513116c92543c274b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*yhM2RxjIt3F0P4vM.png"/></div></div></figure><p id="eaa5" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">现在将调配虚拟机，如下所示:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es ly"><img src="../Images/ee87053c91d84605f0df557726ab0add.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*xGhUET08TkqbImko.png"/></div></div></figure><p id="4aec" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">过了一会儿，虚拟机启动并运行，并分配了一个公共IP地址:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lz"><img src="../Images/df44734857a26793ea37b31615dfd2e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*h0JYNsMZtsitKN2t.png"/></div></div></figure><p id="b95b" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">下图显示了此时的情况:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es ma"><img src="../Images/0b904fd57444c42dada8f1c7c97a87a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1272/format:webp/0*buppgWcJ5Wqgm3TK.png"/></div></figure><h1 id="893f" class="kd ke hh bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">4.在虚拟机的安全列表中设置入口规则，以打开您想要运行的任何容器所需的端口</h1><p id="01f8" class="pw-post-body-paragraph ie if hh ig b ih lb ij ik il lc in io ip ld ir is it le iv iw ix lf iz ja jb ha bi translated">虚拟机与虚拟云网络中的公共子网相关联。在我的例子中，这是VCN vcn-lab中的公共子网vcn-lab。此子网的(一个)安全列表应配置有入口规则，使所需的流量能够到达将映射到容器映像的端口。打开公共子网的详细信息页面。点击安全列表(或创建一个新列表)</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mb"><img src="../Images/e419bf9aec9fee94513b7fd64789e23c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*fgaHDl-hyONzSeh9.png"/></div></div></figure><p id="22f0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">让我们假设我们将运行NGINX容器映像。我们将在VM中映射到NGINX容器的端口是我们可以自己选择的。让我们选择3456和3457——没有很好的理由。如果我们希望虚拟机上的端口3456和3457能够接收来自公共互联网的请求，我们需要相应地配置一个入口规则:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mc"><img src="../Images/b3d87050d0071f296d9e9c5243069941.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ysPduL1Uq4AxcTRL.png"/></div></div></figure><p id="d1d7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">源CIDR设置为0 . 0 . 0 . 0/0；将源端口范围留空(即<em class="lw"> All </em>)意味着此规则适用于任何客户端。</p><h1 id="3dd7" class="kd ke hh bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">5.SSH进入虚拟机，安装Docker</h1><p id="af5b" class="pw-post-body-paragraph ie if hh ig b ih lb ij ik il lc in io ip ld ir is it le iv iw ix lf iz ja jb ha bi translated">此时，我们有一个正在运行的VM实例。它拥有全新的Oracle Linux 7.7操作系统。但还不是码头工人。让我们使用SSH(或在Windows上使用PuTTY)在虚拟机中打开一个终端窗口，使用以下命令:</p><pre class="jd je jf jg fd li lj lk ll aw lm bi"><span id="e628" class="ln ke hh lj b fi lo lp l lq lr">ssh opc@public-id-address -i rsa-private-key-file</span></pre><p id="2876" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">将public-id-address替换为分配给虚拟机的公共IP。将<em class="lw"> rsa-private-key-file </em>替换为包含SSH私有密钥的文件的引用:</p><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es md"><img src="../Images/03798512561eac89188c7470df1dfa8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/0*jJbK9YkifMcalPI6.png"/></div></figure><p id="c602" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要安装Docker，请执行以下命令:</p><pre class="jd je jf jg fd li lj lk ll aw lm bi"><span id="5019" class="ln ke hh lj b fi lo lp l lq lr">sudo yum-config-manager --enable ol7_addons <br/>sudo yum install docker-engine -y <br/>sudo systemctl start docker <br/>sudo systemctl enable docker</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es me"><img src="../Images/4dd2638f5fafa76489c5d205ffa58777.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*tAhI8bQyLIaDPQ3T.png"/></div></div></figure><p id="f742" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">要以非根用户身份运行Docker，请阅读这些说明。</p><h1 id="a68a" class="kd ke hh bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">6.运行Docker容器映像</h1><p id="6755" class="pw-post-body-paragraph ie if hh ig b ih lb ij ik il lc in io ip ld ir is it le iv iw ix lf iz ja jb ha bi translated">安装Docker后，我们现在可以运行我们选择的容器映像了。对于本文，我选择了nginx——因为它非常简单。它也可以是任何其他图像。</p><p id="c370" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用以下命令运行nginx容器映像:</p><pre class="jd je jf jg fd li lj lk ll aw lm bi"><span id="34ee" class="ln ke hh lj b fi lo lp l lq lr">sudo docker run -d \<br/> --restart always \ <br/> --hostname nginx.lucasjellema.com \<br/> -p 3456:443 \<br/> -p 3457:80 \<br/> --name my-nginx \<br/> nginx</span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es lg"><img src="../Images/f65e024e654b6f1b4a6f47ccc05d50af.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*p6ro7RkbMhhFB6fn.png"/></div></div></figure><p id="1f3a" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">使用<em class="lw"> sudo docker ps </em>验证集装箱是否正在运行。如你所见，它正在运行。</p><p id="23d7" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">并尝试从nginx容器获得响应，映射到VM中的端口3457(和3456):</p><pre class="jd je jf jg fd li lj lk ll aw lm bi"><span id="a171" class="ln ke hh lj b fi lo lp l lq lr">curl <a class="ae jo" href="http://localhost:3457" rel="noopener ugc nofollow" target="_blank">http://localhost:3457</a></span></pre><figure class="jd je jf jg fd jh er es paragraph-image"><div class="er es mf"><img src="../Images/ab5658e867932afa674de5c845fa52e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/0*YSPpiqk6pv7hhs1F.png"/></div></figure><h1 id="d7ad" class="kd ke hh bd kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la bi translated">7.在空闲虚拟机的公共IP地址访问容器映像提供的服务</h1><p id="c1e2" class="pw-post-body-paragraph ie if hh ig b ih lb ij ik il lc in io ip ld ir is it le iv iw ix lf iz ja jb ha bi translated">打开浏览器，在端口3457分配给容器的公共IP上打开。nginx的欢迎页面应该出现在浏览器中。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mg"><img src="../Images/544e43892439dd0a6791345176afdc04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/0*_1uOOEHk9QcsyWTt.png"/></div></div></figure><p id="dbe8" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">此时，一个Docker容器正在OCI上一个始终免费的VM中运行，为来自公共互联网上任何地方的HTTP请求提供服务。</p><figure class="jd je jf jg fd jh er es paragraph-image"><div role="button" tabindex="0" class="ji jj di jk bf jl"><div class="er es mh"><img src="../Images/530e1fdea0c2e8125f5f0bb74f7597a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EAnIH8QmzaxerAbQ.png"/></div></div></figure><p id="b7b0" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated">代替nginx，我们当然可以运行任何容器映像(如果它符合自由VM的形状)。</p></div><div class="ab cl mi mj go mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ha hb hc hd he"><p id="c64d" class="pw-post-body-paragraph ie if hh ig b ih ii ij ik il im in io ip iq ir is it iu iv iw ix iy iz ja jb ha bi translated"><em class="lw">原载于2020年2月6日</em><a class="ae jo" href="https://technology.amis.nl/2020/02/06/run-always-free-docker-container-on-oracle-cloud-infrastructure/" rel="noopener ugc nofollow" target="_blank"><em class="lw">https://technology . amis . nl</em></a><em class="lw">。</em></p></div></div>    
</body>
</html>