<html>
<head>
<title>Unified Monitoring of ETL Performance with BumbleBee</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用BumbleBee统一监控ETL性能</h1>
<blockquote>原文：<a href="https://medium.com/walmartglobaltech/unified-monitoring-of-etl-performance-with-bumblebee-bc2580954584?source=collection_archive---------2-----------------------#2021-08-04">https://medium.com/walmartglobaltech/unified-monitoring-of-etl-performance-with-bumblebee-bc2580954584?source=collection_archive---------2-----------------------#2021-08-04</a></blockquote><div><div class="ds gv gw gx gy gz"/><div class="ha hb hc hd he"><div class=""/><figure class="ev ex if ig ih ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es ie"><img src="../Images/f2db52ce2339fd79cafd94c19460252e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qy4Gu7aZ2I9BdjK7p6qogA.png"/></div></div></figure><p id="c5c2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在大数据领域，ETL过程的性能很重要，但是对这种过程性能的监控也是一个同样重要的方面。</p><p id="ad48" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这里，当我们谈论监控时，不仅仅是ETL过程有多好或多快。我们还考虑给定工作流相对于其父和子(ren)工作流的完整性、给定工作流的代码质量等属性。</p><p id="9427" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">有一组工具可用于测量这些属性并将其显示在仪表板上。这种工具计算与特定属性相关联的特定指标。在单个控制面板中显示工作流的所有这些指标是一项挑战。虽然拥有一个统一的仪表板有其优势。单一仪表板将提供整个工作流程的整体绩效的整体视图。</p><p id="c941" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在沃尔玛，我们有各种工具/框架来衡量代码质量、负载测试、单元测试等指标。这些框架有它们自己的计算指标，当然，这些指标是分开存储的。</p><p id="0193" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">由于所有这些指标的数据源各不相同，因此很难在一个地方获得所有指标的统一视图。因此，某些指标有多个控制面板，用户应该了解所有相应的控制面板，以便导航到正确的控制面板。</p><p id="b51d" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">为了解决上述问题，我们提出了一个名为“BumbleBee”的聚合服务，旨在累积各种指标。</p><p id="e1c7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">为什么是大黄蜂？</strong></p><p id="617e" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">这个想法类似于大黄蜂所做的。一只大黄蜂从一朵花走到另一朵花，以采集油桃，并将油桃转化为花蜜，花蜜也可以被其他人食用。因此这个工具被命名为大黄蜂。</p><p id="007c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">BumbleBee从代码质量、纱线利用率、负载/性能测试结果等来源收集各种指标，并将它们保存在一个数据库(nectar)中，这反过来使我们能够在团队级别的一个仪表板上显示所有相关指标。</p><p id="f3f1" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">大黄蜂生态系统:</strong></p><figure class="jo jp jq jr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es jn"><img src="../Images/6748d9774009a29e8838cde710f2af7b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RFfJxxgNyhj7Io4B3fwvWA.png"/></div></div></figure><p id="b120" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">大黄蜂是什么？</strong></p><p id="487c" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">BumbleBee是一个Scala服务，它将来自不同来源的各种性能指标聚合到一个数据库中，这个数据库可以再次用作仪表板的真实来源。它可以部署在能够连接到airflow DB的任何边缘节点上。它还可以通过适当的配置与Yarn APIs对话。它使用各种组件，如ServiceRunner容器，它负责以定义的时间间隔进行轮询，以及在分析完成时从Sonar得到通知的web钩子。</p><p id="c4ac" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">BumbleBee开始检索气流应用和与该气流应用相关的纱线资源(如果有的话)。但现在，它通过同时轮询气流和纱线，从气流和纱线中读取所有应用程序细节(即使不与任何气流应用程序相关联)。</p><p id="8bfe" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">随着集成测试(针对ETL工作负载)在气流上运行，BumbleeBee服务被进一步扩展以跟踪集成测试指标。我们正在存储任务级信息，以便我们可以从纱线端获得集成测试工作流程及其资源消耗的粒度视图。除此之外，它还可以跟踪来自Automaton(负载/性能测试工具)的性能/负载测试指标和来自Sonar-Qube的代码质量指标，以分别提供API性能和代码质量标准的趋势。</p><p id="2c23" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">BumbleeBee中的轮询是如何工作的？</p><p id="99ad" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">BumbleBee有一个非常简单的流程来持续跟踪和检索这些指标。它连续轮询(可配置)具有给定配置的相应服务，如项目详情、相应纱线簇等。检索指标，并将其存储到具有合适模式的数据库中。所有这些指标都存储在同一个数据库下的不同表中。任何BI工具都可以用来连接数据库，并根据编写的查询可视化聚集的指标。</p><p id="8339" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">设计图:</strong></p><figure class="jo jp jq jr fd ii er es paragraph-image"><div role="button" tabindex="0" class="ij ik di il bf im"><div class="er es js"><img src="../Images/626da5b2293dfaab06b93119856947a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nVA4kdyjdJXXTzfqNhxWpg.png"/></div></div></figure><p id="3f4b" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated"><strong class="ir hi">深入了解大黄蜂的工作原理</strong></p><p id="0cfe" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">对于气流任务，BumbleBee会检查自上次执行以来创建或完成的任务，并将它们的详细信息保存到数据库中，然后尝试从气流任务日志中检索纱线应用程序id(如果可用)。</p><p id="8e0a" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">在检索到yarn应用程序id后，它进一步检索应用程序资源，如内存、内核、执行时间等。用于纱线组。一旦我们有了气流纱应用程序，我们需要一些机制来识别其中的集成测试工作流程。BumbleBee在配置中有一个规定，您可以传递有效的工作流前缀，即使它们没有关联的Yarn应用程序id，也会被考虑在内。随着这一改变，它开始存储父集成测试工作流及其任务。</p><p id="d5f2" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">Automaton对API服务执行负载测试，并将通过电子邮件和slack通道发布结果，因此BumbleBee可以使用该slack通道来读取负载测试更新，它将尝试从Automaton API获取负载/性能测试指标，并将存储API和状态代码级别的指标，这些指标也可以汇总以显示项目级别的性能。</p><p id="a440" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">BumbleBee使用Web钩子和执行器从Sonar获取代码质量度量。它有一个网络挂钩，可以为任何声纳项目进行配置。当给定项目的代码分析完成时，Sonar称之为web钩子。在web钩子调用时，BumbleBee从Sonar获取代码质量度量，并将它们存储在数据库中。</p><p id="c0a7" class="pw-post-body-paragraph ip iq hh ir b is it iu iv iw ix iy iz ja jb jc jd je jf jg jh ji jj jk jl jm ha bi translated">有了BumbleBee，我们计划走出孤岛，将服务/ETL性能的所有重要指标放在一个仪表板上。大黄蜂(昆虫)采集的花蜜是富含糖分的，同样，我们大黄蜂采集的花蜜(度量)是数据丰富的。这些指标不仅对可视化或仪表板有用，而且有助于确定性能改进的候选对象。</p></div></div>    
</body>
</html>